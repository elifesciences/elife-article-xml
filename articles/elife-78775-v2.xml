<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD with MathML3 v1.2 20190208//EN"  "JATS-archivearticle1-mathml3.dtd"><article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.2"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn publication-format="electronic" pub-type="epub">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">78775</article-id><article-id pub-id-type="doi">10.7554/eLife.78775</article-id><article-categories><subj-group subj-group-type="display-channel"><subject>Research Article</subject></subj-group><subj-group subj-group-type="heading"><subject>Evolutionary Biology</subject></subj-group><subj-group subj-group-type="heading"><subject>Genetics and Genomics</subject></subj-group></article-categories><title-group><article-title>High-resolution species assignment of <italic>Anopheles</italic> mosquitoes using <italic>k</italic>-mer distances on targeted sequences</article-title></title-group><contrib-group><contrib contrib-type="author" corresp="yes" id="author-273931"><name><surname>Boddé</surname><given-names>Marilou</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-2107-5100</contrib-id><email>mmb52@cam.ac.uk</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="other" rid="fund2"/><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-273932"><name><surname>Makunin</surname><given-names>Alex</given-names></name><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf2"/></contrib><contrib contrib-type="author" id="author-71450"><name><surname>Ayala</surname><given-names>Diego</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-4726-580X</contrib-id><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="other" rid="fund4"/><xref ref-type="fn" rid="con3"/><xref ref-type="fn" rid="conf2"/></contrib><contrib contrib-type="author" id="author-273933"><name><surname>Bouafou</surname><given-names>Lemonde</given-names></name><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="other" rid="fund5"/><xref ref-type="fn" rid="con4"/><xref ref-type="fn" rid="conf2"/></contrib><contrib contrib-type="author" id="author-273934"><name><surname>Diabaté</surname><given-names>Abdoulaye</given-names></name><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="fn" rid="con5"/><xref ref-type="fn" rid="conf2"/></contrib><contrib contrib-type="author" id="author-273935"><name><surname>Ekpo</surname><given-names>Uwem Friday</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-0543-5463</contrib-id><xref ref-type="aff" rid="aff5">5</xref><xref ref-type="fn" rid="con6"/><xref ref-type="fn" rid="conf2"/></contrib><contrib contrib-type="author" id="author-273936"><name><surname>Kientega</surname><given-names>Mahamadi</given-names></name><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="fn" rid="con7"/><xref ref-type="fn" rid="conf2"/></contrib><contrib contrib-type="author" id="author-273937"><name><surname>Le Goff</surname><given-names>Gilbert</given-names></name><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="fn" rid="con8"/><xref ref-type="fn" rid="conf2"/></contrib><contrib contrib-type="author" id="author-71448"><name><surname>Makanga</surname><given-names>Boris K</given-names></name><xref ref-type="aff" rid="aff6">6</xref><xref ref-type="fn" rid="con9"/><xref ref-type="fn" rid="conf2"/></contrib><contrib contrib-type="author" id="author-125287"><name><surname>Ngangue</surname><given-names>Marc F</given-names></name><xref ref-type="aff" rid="aff7">7</xref><xref ref-type="fn" rid="con10"/><xref ref-type="fn" rid="conf2"/></contrib><contrib contrib-type="author" id="author-273938"><name><surname>Omitola</surname><given-names>Olaitan Olamide</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-3827-6320</contrib-id><xref ref-type="aff" rid="aff5">5</xref><xref ref-type="fn" rid="con11"/><xref ref-type="fn" rid="conf2"/></contrib><contrib contrib-type="author" id="author-125285"><name><surname>Rahola</surname><given-names>Nil</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-4067-6438</contrib-id><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="fn" rid="con12"/><xref ref-type="fn" rid="conf2"/></contrib><contrib contrib-type="author" id="author-23841"><name><surname>Tripet</surname><given-names>Frederic</given-names></name><xref ref-type="aff" rid="aff8">8</xref><xref ref-type="fn" rid="con13"/><xref ref-type="fn" rid="conf2"/></contrib><contrib contrib-type="author" id="author-255508"><name><surname>Durbin</surname><given-names>Richard</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="other" rid="fund3"/><xref ref-type="fn" rid="con14"/><xref ref-type="fn" rid="conf2"/></contrib><contrib contrib-type="author" corresp="yes" id="author-65651"><name><surname>Lawniczak</surname><given-names>Mara KN</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-3006-2080</contrib-id><email>mara@sanger.ac.uk</email><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con15"/><xref ref-type="fn" rid="conf2"/></contrib><aff id="aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/013meh722</institution-id><institution>Department of Genetics, University of Cambridge</institution></institution-wrap><addr-line><named-content content-type="city">Cambridge</named-content></addr-line><country>United Kingdom</country></aff><aff id="aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/05cy4wa09</institution-id><institution>Wellcome Sanger Institute</institution></institution-wrap><addr-line><named-content content-type="city">Hinxton</named-content></addr-line><country>United Kingdom</country></aff><aff id="aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/00357kh21</institution-id><institution>Institut de Recherche pour le Développement, MIVEGEC, Univ. Montpellier, CNRS, IRD</institution></institution-wrap><addr-line><named-content content-type="city">Montpellier,</named-content></addr-line><country>France</country></aff><aff id="aff4"><label>4</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/05m88q091</institution-id><institution>Institut de Recherche en Sciences de la Santé, Direction Régionale de l'Ouest</institution></institution-wrap><addr-line><named-content content-type="city">Bobo-Dioulasso</named-content></addr-line><country>Burkina Faso</country></aff><aff id="aff5"><label>5</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/050s1zm26</institution-id><institution>Federal University of Agriculture Abeokuta</institution></institution-wrap><addr-line><named-content content-type="city">Abeokuta</named-content></addr-line><country>Nigeria</country></aff><aff id="aff6"><label>6</label><institution>Institut de Recherche en Ecologie Tropicale</institution><addr-line><named-content content-type="city">Libreville</named-content></addr-line><country>Gabon</country></aff><aff id="aff7"><label>7</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/01wyqb997</institution-id><institution>Centre International de Recherches Medicales de Franceville</institution></institution-wrap><addr-line><named-content content-type="city">Franceville</named-content></addr-line><country>Gabon</country></aff><aff id="aff8"><label>8</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/00340yn33</institution-id><institution>Centre for Applied Entomology and Parasitology, Keele University</institution></institution-wrap><addr-line><named-content content-type="city">Newcastle</named-content></addr-line><country>United Kingdom</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Matute</surname><given-names>Daniel R</given-names></name><role>Reviewing Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/0130frc33</institution-id><institution>University of North Carolina, Chapel Hill</institution></institution-wrap><country>United States</country></aff></contrib><contrib contrib-type="senior_editor"><name><surname>Soldati-Favre</surname><given-names>Dominique</given-names></name><role>Senior Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/01swzsf04</institution-id><institution>University of Geneva</institution></institution-wrap><country>Switzerland</country></aff></contrib></contrib-group><pub-date publication-format="electronic" date-type="publication"><day>12</day><month>10</month><year>2022</year></pub-date><pub-date pub-type="collection"><year>2022</year></pub-date><volume>11</volume><elocation-id>e78775</elocation-id><history><date date-type="received" iso-8601-date="2022-03-18"><day>18</day><month>03</month><year>2022</year></date><date date-type="accepted" iso-8601-date="2022-10-11"><day>11</day><month>10</month><year>2022</year></date></history><pub-history><event><event-desc>This manuscript was published as a preprint at .</event-desc><date date-type="preprint" iso-8601-date="2022-03-20"><day>20</day><month>03</month><year>2022</year></date><self-uri content-type="preprint" xlink:href="https://doi.org/10.1101/2022.03.18.484650"/></event></pub-history><permissions><copyright-statement>© 2022, Boddé et al</copyright-statement><copyright-year>2022</copyright-year><copyright-holder>Boddé et al</copyright-holder><ali:free_to_read/><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><ali:license_ref>http://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-78775-v2.pdf"/><self-uri content-type="figures-pdf" xlink:href="elife-78775-figures-v2.pdf"/><abstract><p>The ANOSPP amplicon panel is a genus-wide targeted sequencing panel to facilitate large-scale monitoring of <italic>Anopheles</italic> species diversity. Combining information from the 62 nuclear amplicons present in the ANOSPP panel allows for a more senstive and specific species assignment than single gene (e.g. COI) barcoding, which is desirable in the light of permeable species boundaries. Here, we present NNoVAE, a method using Nearest Neighbours (NN) and Variational Autoencoders (VAE), which we apply to <italic>k-</italic>mers resulting from the ANOSPP amplicon sequences in order to hierarchically assign species identity. The NN step assigns a sample to a species-group by comparing the <italic>k</italic>-mers arising from each haplotype’s amplicon sequence to a reference database. The VAE step is required to distinguish between closely related species, and also has sufficient resolution to reveal population structure within species. In tests on independent samples with over 80% amplicon coverage, NNoVAE correctly classifies to species level 98% of samples within the <italic>An. gambiae</italic> complex and 89% of samples outside the complex. We apply NNoVAE to over two thousand new samples from Burkina Faso and Gabon, identifying unexpected species in Gabon. NNoVAE presents an approach that may be of value to other targeted sequencing panels, and is a method that will be used to survey <italic>Anopheles</italic> species diversity and <italic>Plasmodium</italic> transmission patterns through space and time on a large scale, with plans to analyse half a million mosquitoes in the next five years.</p></abstract><kwd-group kwd-group-type="author-keywords"><kwd>species assignment</kwd><kwd>anopheles</kwd><kwd>k-mers</kwd><kwd>nearest neighbour</kwd><kwd>VAE</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research organism</title><kwd>Other</kwd></kwd-group><funding-group><award-group id="fund1"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100004440</institution-id><institution>Wellcome Trust</institution></institution-wrap></funding-source><award-id>206194/Z/17/Z</award-id><principal-award-recipient><name><surname>Lawniczak</surname><given-names>Mara KN</given-names></name></principal-award-recipient></award-group><award-group id="fund2"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100004440</institution-id><institution>Wellcome Trust</institution></institution-wrap></funding-source><award-id>RG92770</award-id><principal-award-recipient><name><surname>Boddé</surname><given-names>Marilou</given-names></name></principal-award-recipient></award-group><award-group id="fund3"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100004440</institution-id><institution>Wellcome Trust</institution></institution-wrap></funding-source><award-id>WT207492</award-id><principal-award-recipient><name><surname>Durbin</surname><given-names>Richard</given-names></name></principal-award-recipient></award-group><award-group id="fund4"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100001665</institution-id><institution>Agence Nationale de la Recherche</institution></institution-wrap></funding-source><award-id>ANR-18-CE35-0002-01 - WILDING).</award-id><principal-award-recipient><name><surname>Ayala</surname><given-names>Diego</given-names></name></principal-award-recipient></award-group><award-group id="fund5"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100012947</institution-id><institution>Institut de Recherche pour le Développement</institution></institution-wrap></funding-source><award-id>Bourse ARTS/IRD</award-id><principal-award-recipient><name><surname>Bouafou</surname><given-names>Lemonde</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication. For the purpose of Open Access, the authors have applied a CC BY public copyright license to any Author Accepted Manuscript version arising from this submission.</funding-statement></funding-group><custom-meta-group><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>Large-scale monitoring of <italic>Anopheles</italic> populations benefits from a robust and accurate species identification and plasmodium detection method that is applicable to the entire genus.</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>The <italic>Anopheles</italic> genus contains dozens of mosquito species that are the vectors for the <italic>Plasmodium</italic> parasites which cause human malaria, and are thus of global public health interest. The genus contains nearly 500 formally described species (<xref ref-type="bibr" rid="bib23">Harbach and Kitching, 2016</xref>), which span more than 100 million years of evolution (<xref ref-type="bibr" rid="bib34">Marinotti et al., 2013</xref>). Only a subset of these species has the ability to transmit human malaria; however this vectorial capacity is not limited to a specific part of the species tree, but found throughout the genus phylogeny. Many species are members of closely related species complexes or groups, which are morphologically indistinguishable and share large amounts of genetic variation due to their ability to hybridise in areas of sympatry (<xref ref-type="bibr" rid="bib3">Anopheles gambiae 1000 Genomes Consortium, 2017</xref>; <xref ref-type="bibr" rid="bib23">Harbach and Kitching, 2016</xref>). Accurate species identification of <italic>Anopheles</italic> mosquitoes is difficult yet of crucial importance. This is because even closely related species may differ in vectorial capacity, insecticide resistance status and behavioural traits, all of which can influence the efficacy of malaria control efforts (<xref ref-type="bibr" rid="bib55">White et al., 2011</xref>). Novel control efforts like gene drive are likely to be implemented this decade for <italic>An. gambiae,</italic> and the success of these efforts will need to be closely monitored. A thorough understanding of the geographic and temporal distribution of different <italic>Anopheles</italic> species and the potential extent of gene flow between species within the same complex is a necessary condition to implement gene drive technology as a malaria control tool.</p><p>Currently, the typical process of species identification for <italic>Anopheles</italic> mosquitoes starts by assigning them to species complexes or groups using morphological keys (<xref ref-type="bibr" rid="bib21">Gillies and Meillon, 1968</xref>; <xref ref-type="bibr" rid="bib22">Gillies and Coetzee, 1987</xref>; <xref ref-type="bibr" rid="bib42">Rattanarithikul and Panthusiri, 1994</xref>; <xref ref-type="bibr" rid="bib14">Coetzee, 2020</xref>; <xref ref-type="bibr" rid="bib26">Irish et al., 2020</xref>). These morphological keys are usually specific to geographical regions and hence require in-depth and up-to-date knowledge of the species ranges. Moreover, the keys are specific to certain life-stages and may require one to grow larvae to a later stage or even adulthood. Because the morphological features distinguishing one group of species from another can be very nuanced, the accuracy of morphological classification depends on the level of experience and expertise of the person carrying out the identification. Species inside species complexes can be morphologically indistinguishable from each other at the adult stage and hence molecular assays are required for precise species identification. The most commonly used method is a PCR-based species diagnostic assay, targeting the highly variable internal transcribed spacer (ITS2) or similarly variable genomic regions (<xref ref-type="bibr" rid="bib15">Cohuet et al., 2003</xref>; <xref ref-type="bibr" rid="bib45">Scott et al., 1993</xref>; <xref ref-type="bibr" rid="bib18">Fanello et al., 2002</xref>; <xref ref-type="bibr" rid="bib57">Wilkins et al., 2006</xref>), although other approaches exist, for example based on mass spectrometry (<xref ref-type="bibr" rid="bib38">Nabet et al., 2021</xref>). The PCR assays require the use of primers specific to the species complex or group, hence higher level morphological misclassification can lead to failure to generate PCR product or even erroneous species classification (<xref ref-type="bibr" rid="bib17">Erlank et al., 2018</xref>). Mutations in primer or restriction sites can also lead to PCR failures. Moreover, in the case of hybrids or cryptic species, species identification based on a single marker can result in overconfident assignment to a single species, lacking the nuance that is desirable in this case. There exist panels targeting multiple loci; however, these are also specifically designed to work on a single species complex (<xref ref-type="bibr" rid="bib43">Rongnoparut et al., 1996</xref>; <xref ref-type="bibr" rid="bib29">Lanzaro et al., 1995</xref>; <xref ref-type="bibr" rid="bib53">Wang-Sattler et al., 2007</xref>; <xref ref-type="bibr" rid="bib44">Santolamazza et al., 2008</xref>).</p><p>To help overcome these challenges, a multilocus amplicon panel called ANOSPP (for ‘<italic>ANO</italic>pheles <italic>SP</italic>ecies and <italic>P</italic>lasmodium’) was previously designed to amplify loci from any individual from any Anopheline species (<xref ref-type="bibr" rid="bib33">Makunin et al., 2022</xref>). In brief, the panel targets 62 loci in the generic <italic>Anopheles</italic> nuclear genome, spread over all chromosome arms, including exonic, intronic as well as intergenic regions. Additionally, it targets two conserved loci on the generic <italic>Plasmodium</italic> mitochondrial genome, to simultaneously evaluate <italic>Plasmodium</italic> presence and species for each individual mosquito. Sequence data from up to 62 nuclear loci targeted by the ANOSPP panel for each sequenced specimen increases the resolution to distinguish closely related species, and to flag potential hybrid or contaminated samples as well as cryptic species. Moreover, the multilocus approach opens the possibility of population genetic and structure analyses for single or closely related species.</p><p>The ANOSPP panel has been developed to improve accuracy and depth of information as well as to drive down costs and time required to carry out vector species surveillance (<xref ref-type="bibr" rid="bib33">Makunin et al., 2022</xref>). Accordingly, all that is required is to identify the individual mosquito as an Anopheline (as opposed to a Culicine), which requires minimal expertise as it is based on the length of the maxillary palps. Furthermore, the panel can use an extremely small aliquot of DNA (&lt;1% of whole mosquito extraction) extracted from each mosquito using a cheap, nondestructive, high-throughput workflow (<xref ref-type="bibr" rid="bib33">Makunin et al., 2022</xref>). Each mosquito is stored in the well of a 96well plate in ethanol, the non-destructive lysis buffer is added, incubated overnight, and then removed. Ethanol is then added again to the mosquito carcass to preserve the mosquito and enable morphological evaluation of any individual post-sequencing. A dilution of the lysate is made, which is then PCR amplified with a cocktail of 64 primer pairs in a single well through a two-step process (<xref ref-type="bibr" rid="bib33">Makunin et al., 2022</xref>). A single Illumina library is generated containing amplified and bar-coded material pooled from 768 samples, then sequenced on a single Illumina MiSeq lane.</p><p>The ANOSPP panel originally used a species assignment method based on alignment distances, using static sequence similarity thresholds fitted per target (<xref ref-type="bibr" rid="bib33">Makunin et al., 2022</xref>). Using this method, amplicons contain sufficient information to distinguish between the majority of the 56 species represented in the original dataset; only samples within some species complexes could not be accurately assigned. However, this method was only tested on a small dataset and the test set was also used as the training set to form the haplotype clusters. Additionally, some targets were extremely divergent between different groups of samples in the dataset and the distances for these targets appear to be sensitive to the choice of alignment algorithm. Here, we present a new species assignment method that we call NNoVAE, which is a <italic>k</italic>-mer-based method consisting of an initial step using Nearest Neighbours (NN) that identifies samples down to a species or, in some cases, a species complex, and a second step using a Variational Autoencoder (VAE) for species identification within a species complex. The VAE in the second step is specifically trained on the species complex to which test samples get assigned by the NN step. The complex-specific VAE is required because the similarity between closely related species is too close to detect with a general purpose method like the NN step. Both assignment steps in NNoVAE work on the same <italic>k-</italic>mer tables.</p><p>NCBI GenBank’s BLAST (<xref ref-type="bibr" rid="bib2">Altschul et al., 1997</xref>) can be used to assess the similarity of any sequence to those within any INSDC database such as NCBI GenBank (<xref ref-type="bibr" rid="bib7">Benson et al., 2018</xref>). BLAST works on a single query at a time, and does not assign species directly, but rather reports the best hits of the query sequence alongside p<italic>-</italic>values based on the alignment score corrected for the size of the database. Similarly, the standard search methods for BOLD (<xref ref-type="bibr" rid="bib41">Ratnasingham and Hebert, 2007</xref>) performs species assignment based on a threshold of percent identity between the test sample and the samples in the reference database. The threshold is informed by extensive knowledge of the divergence of the single marker cytochrome oxidase subunit I (COI) between different species. In addition, the BOLD analysis toolkit contains a NN method to explore the relationship between multiple species in the database. Like BLAST and the BOLD toolkit, the NN step of NNoVAE uses sequence-based distances between the haplotypes of test samples and samples in a reference database; however, this is performed across all amplicons and uses <italic>k-</italic>mer distances instead of alignments. By using <italic>k</italic>-mers, we avoid the issues associated with alignment of highly divergent sequences and moreover are able in a natural way to use short indels and small structural variants as well as SNPs. NNoVAE aims to assign species identity and simultaneously collect information about the relationship of the test sample to different species or species-groups in the database, which is particularly useful when the test sample is of a species not represented in the database. Moreover, NNoVAE combines the information from the 62 different target regions in ANOSPP to build confidence in the species assignments, or reflect uncertainty in the species assignments where appropriate.</p><p>NNoVAE resolves species identity within the <italic>An. gambiae</italic> complex using a variational autoencoder trained on samples from this complex. A VAE is a machine learning method that learns structure in high-dimensional data by encoding it into a low-dimensional space and subsequently generating simulated data from the low-dimensional encodings (<xref ref-type="bibr" rid="bib28">Kingma and Welling, 2013</xref>). VAEs have previously been used for species delineation in spiders (<xref ref-type="bibr" rid="bib16">Derkarabetian et al., 2019</xref>) and visualisation of population structure in <italic>Anopheles</italic> and humans (<xref ref-type="bibr" rid="bib6">Battey et al., 2021</xref>). Both these studies used sequence alignments containing much more genomic sequence than the amplicon panel provides. In contrast, NNoVAE is <italic>k</italic>-mer based, making it robust to alignment ambiguity and enabling it to efficiently make use of all the available sequencing data.</p><p>With the application of the NNoVAE method to data resulting from the ANOSPP panel, we aim to create a robust and efficient platform for molecular species identification within the entire <italic>Anopheles</italic> genus. We present a method that can assign individuals to any of the 62 species currently represented in the reference database as well as taxonomically place species not yet represented. We will include more samples from more species in the reference database as they are sequenced by the amplicon panel, so as to represent the full diversity of the <italic>Anopheles</italic> genus. NNoVAE also indicates the uncertainty of the assignment and provides information on other closely related species in the dataset, so in particular can flag potential hybrids. It can also be applied to whole genome shotgun (WGS) data by computationally extracting the amplicon target regions, allowing to integrate WGS reference panels with amplicon-sequenced field samples.</p></sec><sec id="s2" sec-type="results"><title>Results</title><sec id="s2-1"><title>Reference database construction</title><p>Species assignment methods commonly work by comparing a query sequence to a reference database (<xref ref-type="bibr" rid="bib41">Ratnasingham and Hebert, 2007</xref>; <xref ref-type="bibr" rid="bib7">Benson et al., 2018</xref>). The completeness and quality of the reference database heavily influence the accuracy of the assignment method. The reference database we constructed consists of well-curated samples sequenced with the panel, in silico extracted reference genomes, and in silico extracted whole genome short read data. As we expect that the reference database will expand to include additional species and populations over time, we assign a version number to the database. The reference database described here, which we call NNv1, contains 186 samples, representing 62 species spread over 4 subgenera. The dataset from <xref ref-type="bibr" rid="bib33">Makunin et al., 2022</xref> forms the backbone of the reference panel. In addition, six species in the <italic>An. gambiae</italic> complex have been included from publicly available whole genome data (<xref ref-type="bibr" rid="bib49">The Anopheles gambiae 1000 Genomes Consortium, 2021</xref>; <xref ref-type="bibr" rid="bib20">Fontaine et al., 2015</xref>) in order to increase the resolution in a group of hard to distinguish species. To maintain the advantages of multi-locus assignment, we required samples to have at least 10 targets amplified to be included in the reference database. Ideally, the database would contain several specimens per species to represent within species variation. This is particularly important for species with a wide geographical range.</p><p>The amplicon panel is designed to improve accuracy of species assignments over morphological or single-marker methods. However, the species labels supplied by our sample partners were in most cases obtained by the latter methods, hence it was necessary to reconfirm them. All label information for the reference database NNv1 is listed in <xref ref-type="supplementary-material" rid="supp1">Supplementary file 1</xref>, and the assignment of species labels is discussed in more detail in Appendix 1, but we present an outline of the principles we used here. For most samples sequenced by the amplicon panel, two molecular barcodes (COI and ITS2) were also sequenced and compared to the sequences available in BOLD (<xref ref-type="bibr" rid="bib41">Ratnasingham and Hebert, 2007</xref>) and NCBI (<xref ref-type="bibr" rid="bib7">Benson et al., 2018</xref>). Here, we used the barcode information as well as the pairwise <italic>k</italic>-mer distances between samples in the reference database NNv1 to generate a consensus species label for each sample. A few samples show inconsistencies between their partner labels, molecular barcodes and amplicon assignments; these samples were also removed or flagged as overly diverged in <xref ref-type="bibr" rid="bib33">Makunin et al., 2022</xref>. For these samples, the distances to samples of the same species label is much larger than the distance to some other samples in the database, suggesting they were mislabelled. In some cases, there is additional evidence from molecular barcodes and it was possible to relabel them to the species they match. Other samples are clearly different from samples with the same species label, but do not clearly belong to any other species in the database. These are labelled as the species-group they belong to appended by ‘_sp1’, ‘_sp2’, etc. Hopefully, by extending the reference database in the future, we can get a better understanding of which species such samples represent. For some closely related species, the different species labels were supported neither by the pairwise-distances nor by the barcodes. Samples from these species are assigned to a group of closely related species and their consensus labels end in ‘_c’ to notify that they are part of a complex of species that cannot be distinguished by the nearest neighbour method. None of the in silico extracted samples showed inconsistencies with pair-wise <italic>k</italic>-mer distances and hence all retained their published labels.</p></sec><sec id="s2-2"><title>Species-groups construction</title><p>The species-groups are defined based on the pairwise <italic>k</italic>-mer distances between samples in the reference database NNv1 and make use of the consensus species labels discussed above. The <italic>k-</italic>mer distance between two samples, s<sub>1</sub> and s<sub>2</sub>, is defined as <inline-formula><mml:math id="inf1"><mml:msub><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi> </mml:mi><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mfenced open="|" close="|" separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>∩</mml:mo><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>t</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>∩</mml:mo><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mrow/></mml:msubsup><mml:mrow/></mml:mrow><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow/></mml:msubsup><mml:mrow/></mml:mrow><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow/></mml:msubsup><mml:mrow/></mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mfenced open="|" close="|" separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mfenced open="|" close="|" separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:math></inline-formula>, where <italic>T<sub>i</sub></italic> is the set of targets amplified in sample <italic>i</italic> and <italic>Q<sub>i,t</sub></italic> is the set of unique haplotypes of sample <italic>i</italic> at target <italic>t</italic> and by |<italic>S</italic>| we mean the number of elements in set <italic>S</italic>. The <italic>k</italic>-mer distance <italic>d</italic><sub><italic>k</italic></sub> between two sequences is defined in the Methods section on <italic>k</italic>-mers. So in words, for a given target the <italic>k</italic>-mer distance between two samples is the mean <italic>k</italic>-mer distance between all pairs of haplotypes from the two samples; for example if sample s<sub>1</sub> is homozygous and s<sub>2</sub> heterozygous at target <italic>t</italic>, then the <italic>k</italic>-mer distance at target <italic>t</italic> between these samples is the mean of the <italic>k</italic>-mer distance of the haplotype from s<sub>1</sub> compared to the first haplotype from s<sub>2</sub> and the <italic>k</italic>-mer distance of the haplotype from s<sub>1</sub> compared to the second haplotype from s<sub>2</sub>. If a sample has more than two alleles at a single target, we take into account all haplotypes according to the above definition. The <italic>k-</italic>mer distance between two samples is defined as the average of the <italic>k-</italic>mer distance between these samples at all the targets that were amplified in both samples.</p><p><xref ref-type="fig" rid="fig1">Figure 1</xref> shows the pairwise <italic>k-</italic>mer distances between all samples in the reference database. The samples are ordered roughly by phylogeny (as in the tree in <xref ref-type="fig" rid="fig2">Figure 2</xref>) and this results in a visible structure in the distance plot. One can observe dark triangles below the diagonal, reflecting that samples of the same or closely related species have a smaller <italic>8</italic>-mer distance to each other than to other samples. This effect repeats itself on different scales, mirroring the multi-level structure in the phylogenetic tree.</p><fig-group><fig id="fig1" position="float"><label>Figure 1.</label><caption><title>Lower triangle: heatmap of 8-mer distances between pairs of samples in the reference database.</title><p>Samples are on the x- and y-axis, roughly ordered by phylogeny and labelled with their consensus species label. Dark colours correspond to small 8-mer distances and light colours to larger 8-mer distances. Upper triangle: species-groups at fine, intermediate and coarse levels (see main text for definitions of these).</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-78775-fig1-v2.tif"/></fig><fig id="fig1s1" position="float" specific-use="child-fig"><label>Figure 1—figure supplement 1.</label><caption><title>Thresholds used to define species-groups.</title><p>From top to bottom, the thresholds are 0.1, 0.3, and 0.51 and they are used to define the fine, intermediate, and coarse level species groups, respectively. The samples from the reference database are along the x- and y-axis in the same order as in <xref ref-type="fig" rid="fig1">Figure 1</xref>. The entries in the heatmap are coloured peach if the 8-mer distance between the corresponding samples is less than the threshold and black if it is greater or equal the threshold. The orange squares in all three panels correspond to fine level species-groups, the yellow squares in the middle and lower panel to intermediate level species-groups and the olive squares in the lower panel to coarse level species-groups.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-78775-fig1-figsupp1-v2.tif"/></fig></fig-group><fig id="fig2" position="float"><label>Figure 2.</label><caption><title><italic>Nearest neighbour assignment example</italic>.</title><p><bold>Left panel:</bold> The heatmap shows the nearest neighbours of sample Amou-2–3, an <italic>An. moucheti</italic> specimen, at its different targets. For clarity, not all samples in the reference database have been displayed, only those in the <italic>Myzomyia</italic> and <italic>Neocellia</italic> series (except Amou-2–3). The samples from the reference database are arranged along the x-axis and the targets along the y-axis. An entry is coloured pink if the corresponding sample from the reference database has a nearest neighbour sequence at the corresponding target. Peach entries indicate that the corresponding sample from the reference database does not carry a nearest neighbour sequence at the corresponding target. If either the test sample or the reference sample did not amplify at the corresponding target, the entry is white. The bars at the bottom show the overall assignment proportions for the displayed species-groups, only assignment proportions of at least 1% are shown. From top to bottom the assignment proportions are for the fine, intermediate,, and coarse level. For the three-letter code abbreviations of species-groups, see <xref ref-type="supplementary-material" rid="supp1">Supplementary file 1</xref>. The numeric abbreviations stand for 1: <italic>An. marshallii complex sp1</italic>, 2: <italic>Myzomyia sp1,</italic> 3: <italic>An. gabonensis,</italic> 4: <italic>An. culicifacies, 5: An. maculatus B</italic>; none of these species-groups represent more than 1% of the assignment. <bold>Right panel:</bold> The heatmap showing the nearest neighbours of sample Agam-35, an <italic>An. gambiae</italic> specimen. Not all samples in the reference database are displayed, only those in the <italic>Pyretophorus</italic> series (except Agam-35) as well as five samples from the <italic>Neocellia</italic> series. The numeric abbreviations stand for 6: <italic>An. gambiae complex sp1</italic> (0.06 assignment proportion), 7: <italic>An. christyi</italic> and MNs stands for <italic>Myzomyia_Neocellia_series</italic>.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-78775-fig2-v2.tif"/></fig><p>We identify clusters of samples in the reference database NNv1 and we will refer to those as species-groups. It is important to emphasise that the way we use the term ‘species-groups’ does not refer to a taxonomic classification, but to the clusters of samples defined by thresholds on the <italic>8</italic>-mer distances between samples. Ideally, a threshold would partition the samples in the reference database NNv1 into species-groups, such that the <italic>8</italic>-mer distance between each pair of samples within the group is smaller than the threshold and the <italic>8</italic>-mer distance from any sample within the group to any sample outside the group is larger than the threshold. The motivating assumption is that the samples in the same species-group share more recent ancestry with each other than with samples that are members of different species-groups. While several thresholds satisfy the partitioning condition, they are most useful for the purpose of species classification when they generate species-groups that (approximately) correspond to classification at an established taxonomic level. Not surprisingly, there are no thresholds that perfectly satisfy the partitioning condition and are completely concordant with current taxonomy, but several thresholds give groups that are close to taxonomic entities and given the paucity of molecular data for some of these species, it may be that the taxonomic entities are less phylogenetically accurate than the <italic>k</italic>-mer based groupings. In exploring different thresholds (<xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>), we selected three levels that best matched described taxonomic entities. The species-groups at each of the threshold levels we have selected are listed in <xref ref-type="supplementary-material" rid="supp1">Supplementary file 1</xref>.</p><p>For very low thresholds, each sample will form its own species-group, which is not informative. For a threshold of 0.1 on the sample <italic>8</italic>-mer distance, most species-groups satisfy or nearly satisfy the partitioning condition, and each species-group contains a single species or multiple species from a known species complex or group, for example <italic>An. gambiae</italic> and <italic>An. coluzzii</italic> are grouped together at the 0.1 threshold. We refer to the species-groups at the 0.1 level as the fine level species-groups and they are most useful for species assignment, because they provide the highest resolution. A threshold of 0.3 merges samples representing species from some well-known complexes, like the entire <italic>An. gambiae</italic> complex, into a single species-group. Similarly, many of the species for which we currently only have a single representative in the reference database NNv1, are merged into larger species-groups. We refer to this level of species-groups as the intermediate level, which provides insight into the degree of similarity between different fine level species-groups. Additionally, the intermediate level species-groups can be informative when we sequence a sample whose species is not represented in the database because the species assignment at the intermediate level places the sample within its most closely related species-group in the database. Thresholds higher than 0.3 tend to violate the partitioning condition to a greater extent, but it is desirable to include a coarse level classification to get an approximate taxonomic position of unrepresented species and of more diverged species. We selected 0.51 as a threshold for the coarse level classification because this gives reasonably clear species-groups that roughly correspond to taxonomic series. However, it is not perfect, as it groups together the <italic>Myzomyia</italic> and <italic>Neocellia</italic> series in the <italic>Cellia</italic> subgenus and it splits the <italic>Neomyzomyia</italic> series into three distinct species-groups. A similar effect was observed in <xref ref-type="bibr" rid="bib33">Makunin et al., 2022</xref>, where the <italic>Neomyzomyia</italic> series did not form a monophyletic clade.</p><p>At the fine level, most species-groups contain all samples from a single species, but there are some exceptions. For some species, for example <italic>An. nili</italic> and <italic>An. hyrcanus</italic>, the samples are split into multiple fine-level species-groups, because they appear much more distinct from each other than you would expect in a single species (see Appendix 1 and <xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref> for more detailed discussion). In our assignment, these will be treated as distinct species, highlighting to entomologists and taxonomists that further work to refine species in these groups is needed. Conversely, there are also species-groups that contain samples from multiple different species. These do not represent a single species, but instead they represent a complex of closely related species. Species inside species complexes often share a lot of genetic variation and the <italic>k-</italic>mer distance based method that we discuss here does not have sufficient resolution to reliably distinguish between them. The species-groups at the fine level that contain more than a single species are the <italic>An. marshallii</italic> group (contains <italic>An. hancocki, An. brohieri,</italic> and <italic>An. demeilloni</italic>), <italic>An. gambiae/coluzzii</italic>, the <italic>An. sundaicus</italic> complex (contains <italic>An. sundaicus</italic> and <italic>An. epiroticus</italic>) and the <italic>An. coustani</italic> group (contains <italic>An. coustani, An. ziemanni, An. tenebrosus,</italic> and <italic>An. paludis</italic>).</p></sec><sec id="s2-3"><title>Nearest neighbour assignment</title><p>The first step of the hierarchical assignment method performs nearest neighbour assignments to samples in the reference database at the three different levels of species-groups introduced above. The assignment is initially done independently at each target, for each sample, computing assignment proportions for the species-groups at the chosen level, normalised such that they sum up to one over all species-groups. The resulting per-target assignment proportions are then averaged over all targets, resulting in the overall sample assignment proportions at the chosen level. If the sample assignment proportion is at least 0.8 for one species-group, the sample is classified as a member of that group. If the classification threshold of 0.8 is not met at the chosen level, the sample remains unassigned at that level.</p><p>For example, to assign a sample <italic>s</italic> at the coarse level, we translate its target sequence corresponding to target 1 to an <italic>8</italic>-mer count table, denoted as <italic>q<sub>s,1</sub></italic>. Next, we compute its 8-mer distance, <inline-formula><mml:math id="inf2"><mml:msub><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:mn>8</mml:mn></mml:mrow></mml:msub><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math></inline-formula> , to every target sequence in the reference database corresponding to target 1, that is to every <inline-formula><mml:math id="inf3"><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> . The nearest neighbours of the test sequence <italic>q<sub>s,1</sub></italic> are those sequences in the database that minimise the 8-mer distance between themselves and <italic>q<sub>s,1</sub></italic>. In other words, the nearest neighbour sequences of <italic>q<sub>s,1</sub></italic> are the target 1 sequences in the database with the highest percentage of matching <italic>8</italic>-mers. The nearest neighbour sequence of <italic>q<sub>s,1</sub></italic> can be a sequence that occurs in a single sample in the reference database, or the nearest neighbour sequences can be the same sequence occurring in multiple samples in the database, or the nearest neighbour sequences can be distinct sequences that have the same distance to <italic>q<sub>s,1</sub></italic>.</p><p>Now we bring in the species-groups. For each species-group, we record the frequency of nearest neighbour sequences. This can be thought of as an ‘allele-frequency’ when we classify each target sequence as either a ‘nearest neighbour allele’ or not a ‘nearest neighbour allele’. But just like allele frequency, it takes into account the zygosity of the samples. The nearest neighbour frequencies are normalised, such that they are equal to one when summed over all species-groups. These quantities are the per-target assignment proportions.</p><p>This procedure is repeated for every amplified target in the test sample. Finally the per-target assignment proportions are averaged over all successfully amplified targets to give the overall assignment proportions for sample <italic>s</italic> at the coarse level. If there is a species-group with an assignment proportion of at least 0.8, the sample is classified as a member of this group, otherwise it remains unassigned at this level. Assignments to the intermediate and fine levels are made in the same fashion, starting from the same nearest neighbour assignments, but based on the relevant species-group memberships.</p><p>The per-target assignment proportions are based on the frequency of nearest neighbour sequences in the species-groups and not simply on the count of nearest neighbour sequences. The use of frequencies corrects for the different sizes of the species-groups. Suppose a nearest neighbour sequence occurs in 2 out of 10 samples of species-group A and in 1 out of 2 samples in species-group B (and assume all samples are homozygous). By using counts, we would attribute 2/ (2+1)=0.67 and 1/ (2+1)=0.33 assignment proportion to species-group A and B, respectively. But if we did this, species-group A would only have a higher assignment proportion because it contains more samples. What we are really interested in, is how similar the target sequence of the test sample is to the target sequences in the species-groups. So by using the nearest neighbour frequencies, the assignment proportions are (2/10)/(2/10+1/2)=0.29 and (1/2)/(2/10+1/2)=0.71 for species-group A and B, respectively.</p><p>The nearest neighbour frequencies observed for a given target of a given sample at a given assignment level are normalised to obtain the per-target assignment proportions. This normalisation ensures that every target is weighted equally. Without the normalisation, the weight of a target would be determined by a combination of the overall frequency of the nearest neighbour sequences and their distribution amongst the species-groups, whilst we are more interested in the distribution than the total frequency.</p><p>Targets that did not amplify in the sample are simply ignored. There are different reasons why a certain target does not get amplified in a sample. It might be that the primer binding sites for the target are too diverged or altogether absent in the test sample’s genome. Or the target might not be amplified due to technical reasons like poor DNA quality. In the former case, we are implicitly using the information contained in the missingness, because we restrict our attention to the targets that did amplify in the sample, which should be the same targets that amplified in the samples of the same species contained in the reference database. In the latter case, as long as the missingness is randomly affecting the targets, ignoring missing targets does not bias the assignment proportions.</p><p>So far, we have assumed that the test sample was homozygous at each target. To generalise to the heterozygous case, we compute the per-target assignment proportions separately for both target sequences and average them for the final per-target assignment proportions. It does occasionally happen that a sample has more than two different target sequences. This can be due to errors in the PCR amplification or sequencing, contamination by other samples, or a certain target region might be duplicated in the genome of some species. In the NNv1 reference database on average 1.2% of targets per sample have more than two different sequences; in the query datasets discussed later in this article this percentage ranged from 0.3% to 2.3%. We deemed this small enough to simply extend the per-target assignment proportion computation to include targets with more than two different sequences, by taking the average assignment proportions over different sequences as for the heterozygous case.</p><p><xref ref-type="fig" rid="fig2">Figure 2</xref> shows two examples of the nearest neighbour assignment of a test sample. The test samples are Amou-3–2 and Agam-35, an <italic>An. moucheti</italic> and <italic>An. gambiae</italic> individual, respectively. For Amou-3–2 we see that for most targets, the nearest neighbour sequence is found in all four <italic>An. moucheti</italic> samples in the reference database NNv1. For some targets, the nearest neighbour sequence is only carried by a subset of the <italic>An. moucheti</italic> samples in the database, whilst for other targets the nearest neighbour sequence is also carried by individuals of other species. For Agam-35 the heatmap shows that, for many targets, the nearest neighbour sequences are not only found in <italic>An_gambiae_coluzzii</italic> samples, but also in samples from other species in the <italic>An. gambiae</italic> complex. There are only two matches to samples outside the <italic>Pyretophorus</italic> series, not shown here. This results in a high-confidence assignment to the <italic>Pyretophorus</italic> series at the coarse level as well as a high-confidence assignment to the <italic>An. gambiae</italic> complex at the intermediate level. At the fine level, the largest assignment proportion is to the <italic>An_gambiae_coluzzii</italic> species-group, but it does not meet the 0.8 classification threshold because of the relatively high assignment proportions to other species-groups within the <italic>An. gambiae</italic> complex. So at the fine level, this sample cannot be classified with sufficient confidence to a single species. Later, we will present a method to resolve the species identities of samples within the <italic>An. gambiae</italic> complex.</p><p>The species-group assignment has been tested on the reference database itself, by dropping out one sample at a time. The majority of samples could be assigned to the correct species-group at the fine level when using a threshold of 0.8 assignment proportion, see <xref ref-type="fig" rid="fig3">Figure 3</xref>, <xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1</xref> and <xref ref-type="supplementary-material" rid="supp2 supp3 supp4">Supplementary files 2–4</xref>. To provide context, we have included a phylogenetic tree constructed from pairwise <italic>8</italic>-mer distances using FastME (<xref ref-type="bibr" rid="bib30">Lefort et al., 2015</xref>) and displayed using TreeViewer (<xref ref-type="bibr" rid="bib8">Bianchini, 2021</xref>). If we ignore the samples that form a species-group on their own, because we do not yet have sufficient representation for those species, 61.8% of samples are assigned correctly at the fine level, and 98.8% and 100% at the intermediate and coarse level respectively. In most cases, the fine level species-groups consist of a single species, although in some cases they comprise multiple species. The jump in assignment success from the fine to the intermediate level is mostly caused by the <italic>An. gambiae</italic> complex, which is well-represented in the reference database. Most samples within the complex can be assigned to the correct fine level species-group to some extent, but they only meet the assignment threshold at the intermediate level species-group assignment, where all samples in the <italic>An. gambiae</italic> complex are grouped together. This effect is seen in a few other groups as well, and motivates the VAE part of our assignment procedure (described below).</p><fig-group><fig id="fig3" position="float"><label>Figure 3.</label><caption><title>Species-group assignment accuracy on reference database NNv1.</title><p>Samples were dropped out of the database one at a time to test the assignment accuracy. Left: phylogenetic tree of the samples in the reference database NNv1 constructed from pairwise <italic>8</italic>-mer distances using fastme. Samples are labelled by their fine level species-group label. Dark-shaded clades are instances of species-groups that contain more than one species. <bold>Right:</bold> Samples are placed along the vertical axis, ordered by the species tree. The bars represent the assignment proportion to the correct species-group and the colours indicate the species-group level. As an example, the first sample is assigned to the correct species-group with a proportion of 0.88 at the fine level, with a proportion of 0.91 at the intermediate level and with a proportion of 0.99 at the coarse level. The thin horizontal lines indicate the different species-groups at the fine level and the thick horizontal lines at the coarse level. The separation of the species-groups at the intermediate level has not been displayed for clarity. The vertical line represents the assignment threshold of 0.8.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-78775-fig3-v2.tif"/></fig><fig id="fig3s1" position="float" specific-use="child-fig"><label>Figure 3—figure supplement 1.</label><caption><title>Species-group assignment proportions.</title><p>From top to bottom at the coarse, intermediate and fine level. Samples are ordered along the x-axis in the same order as the tree in <xref ref-type="fig" rid="fig3">Figure 3</xref>. For each sample, the overall assignment proportions are plotted as a bar, with colours indicating the species-groups. A sample has to have an assignment proportion of at least 0.8 for a certain species-group to be classified as a member of that species-group, else it remains unassigned. Vertical bars separate the different species-groups. The horizontal bar represents the 0.8 assignment threshold (but note that the assignment proportions are plotted in the same order for every sample, not from largest to smallest).</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-78775-fig3-figsupp1-v2.tif"/></fig></fig-group><p>For the same group of samples, the average correct assignment proportion per sample at the coarse level is 99.4%. This shows that for samples of species that are well-represented in the reference database, there is a near perfect assignment at the coarse level. And in fact, the average correct assignment proportion of 95.8% at the intermediate level shows that these assignments are also generally with high confidence. At the fine level the confidence starts to break down for some samples, in particular the <italic>An. gambiae</italic> complex, which is represented by many samples in the reference database. Then the average correct assignment per sample is 81.3%. This shows that an additional classification method for species complexes is desirable.</p><p>In NNv1, 21 species-groups at the fine level consist of a single sample. These cannot be assigned to the correct species-group in the drop-out assignment experiment. 12 of these samples are members of a larger species-group at the intermediate level and 11 of them can be assigned at the intermediate level, the other sample is not assigned at the intermediate, nor at the coarse level. The remaining nine samples only become a member of a larger species group at the coarse level. Six of them can be classified at this level, the other three remain unclassified.</p><p>The four unclassified samples are <italic>An. christyi</italic>, <italic>An. atroparvus, An. oryzalimnetes,</italic> and <italic>An. cruzii</italic>. All of these are quite diverged from everything else in the reference database and as such do not exhibit a strong matching to any of the coarse level species-groups. In particular, the <italic>Kerteszia</italic> and <italic>Nyssorhynchus</italic> subgenus are underrepresented, both in number of species and number of samples, but also the basal species in for instance the <italic>Pyretophorus</italic> series are not well represented and are too diverged from the other species in this series to exhibit strong similarity to the other samples from this series. In the case of <italic>An. cruzii</italic> in the <italic>Kerteszia</italic> subgenus it is actually impossible to assign it to its coarse level species group with the current threshold of 0.8, because of its 26 amplified targets, only 15 are also amplified in the single other sample in the reference database from the <italic>Kerteszia</italic> subgenus, which results in a theoretical maximum assignment to the correct species-group of 0.58. Note that this is the only species-group at the coarse level for which the theoretical maximum correct assignment for a sample in the reference database is smaller than the threshold. But it again underlines the necessity to extend the reference database, both in number of species and number of samples per species.</p><p>When a sample is of a species not represented in the reference database, three things can happen. If its species is much more closely related to a single species in the database than to all the others, it will likely be assigned to the species it is related to. Alternatively, if the database contains multiple closely related species, it will be assigned at a higher level to the group that contains all these closely related species. If the sample is highly diverged from all species represented in the database, its nearest neighbours will essentially be chosen at random, and the assignment threshold will not be met. This emphasises the importance of extending the reference database, both by increasing the number of species represented and by increasing the number of samples per species, with a particular focus on capturing the within-species diversity (e.g. representing the geographic species range, representing all karyotypes when polymorphic chromosomal inversions are present).</p><p>The species-groups with a single representative can be used to explore the three possible scenarios for when the test sample belongs to a species not present in the reference database: assignment to a closely related species, assignment to a group of species at the intermediate or coarse level, or no assignment.</p><p>The first scenario is represented by <italic>An.bellator</italic>. The only other representative of the <italic>Kerteszia</italic> subgenus in our reference dataset is a sample representing <italic>An. cruzii</italic>. At the fine level species-groups, the <italic>An. bellator</italic> sample is assigned for 0.875 to <italic>An. cruzii</italic> and hence meets the threshold to be classified at the fine level. So it can happen that a sample is classified to the wrong species, if this species is the only reasonably close species in the database. This scenario is more likely for diverged groups of species with little representation in the database, for example the <italic>Nyssorhynchus</italic> and <italic>Kerteszia</italic> subgenera.</p><p>An example of the second scenario is the sample Amar-3–1, in the <italic>Myzomyia</italic> series. At the fine level, it has an assignment proportion of 0.474 to the <italic>An_marshallii</italic>_<italic>complex</italic> and 0.378 to the <italic>An. theileri</italic> species-group. All other species-groups have an assignment proportion of less than 0.06. So this sample is more related to these two species-groups than to anything else in the reference database, but it does not belong to either of them. At the intermediate level, it has an assignment proportion of 0.850 to the <italic>An_marshallii_group</italic> species-group, which is the <italic>An_marshallii</italic>_<italic>complex</italic> and <italic>An. theileri</italic> species-group combined. Now it meets the threshold and it will be classified as a member of the <italic>An_marshallii_group</italic> species-group.</p><p><italic>An. christyi</italic> is an example of a sufficiently diverged sample that does not reach high assignment proportions for a single species-group at any level. At the coarse level, it is assigned to the <italic>Pyretophorus_series</italic> with 0.506 and the <italic>Myzomyia_Neocellia_series</italic> with 0.392 and other species-groups have much lower assignment proportions. Hence, it is not possible to classify this sample as a member of any species-group. Adding more samples from this and other underrepresented species to the database, would increase its power to classify samples from those species.</p></sec><sec id="s2-4"><title>Gambiae complex classifier datasets</title><p>The nearest neighbour approach is not able to confidently distinguish between closely related species that share a lot of genetic variation, but it does identify samples of those species as members of a species complex at the intermediate assignment level. To resolve the species identity inside these species complexes, we use a variational autoencoder approach specifically trained for the complex under consideration. We demonstrate this method for the <italic>An. gambiae</italic> complex, both because many of our samples fall within this complex and it is medically relevant to be able to distinguish them, and also more practically, because we have access to a large dataset of species-labelled samples. The classifier we present here contains 7 out of 8 formally named species in the complex (<xref ref-type="bibr" rid="bib13">Coetzee et al., 2013</xref>), as well as two putative cryptic species (<xref ref-type="bibr" rid="bib48">Tennessen et al., 2021</xref>; <xref ref-type="bibr" rid="bib5">Barrón et al., 2019</xref>). Compared to NNv1, three additional species are represented in this classifier to present as much of the diversity of the <italic>An. gambiae</italic> complex as possible. We expect that this method can be applied to other species complexes for which large species-labelled datasets are available.</p><p>The <italic>An. gambiae</italic> complex classifier has been constructed using a training set (GCref v1) and a validation set (GCval v1) of species-labelled samples. We included as many described species in the <italic>An. gambiae</italic> complex as we could find or generate sequence data for. For species with wide geographic ranges and a large amount of genomic data available, we also aimed to represent the diverse geography where possible.</p><p>Both GCref v1 and GCval v1 consist of amplicon sequences and in silico extracted published samples (<xref ref-type="bibr" rid="bib20">Fontaine et al., 2015</xref>; <xref ref-type="bibr" rid="bib39">Neafsey et al., 2015</xref>; <xref ref-type="bibr" rid="bib48">Tennessen et al., 2021</xref>; <xref ref-type="bibr" rid="bib49">The Anopheles gambiae 1000 Genomes Consortium, 2021</xref>). The samples from Nigeria and Madagascar were not species-labelled, but they were unambiguously classified by an earlier version of this classifier and we included these samples because Nigeria and Madagascar fill geographic gaps in our sampling dataset. The species represented in GCref v1 are <italic>An. gambiae (406), An. coluzzii (222), An. arabiensis (94), An. quadriannulatus (11), An. melas (3), An.merus (6), An. bwambae (3), An. tengrela (38</italic>), and <italic>An. fontenillei (4</italic>). These samples are generally high coverage: 97% of samples have at least 55 of 62 targets amplified. The average number of targets tends to be lower for the samples representing species other than <italic>An. gambiae, An. coluzzii,</italic> or <italic>An. arabiensis</italic>, which are also those species represented by fewer samples, but the geographic ranges of these other species are also much more restricted so the samples we do have are likely good representatives of the species. The species represented in GCval v1 are <italic>An. gambiae (80), An. coluzzii (15), An. arabiensis (30), An. melas (1), An. merus (5</italic>), and <italic>An. tengrela (12</italic>). The average number of amplicons for the species other than <italic>An. gambiae, An. coluzzii</italic> or <italic>An. arabiensis</italic> is lower than in GCref v1 set. Given that for those species, there is only a small number of samples available, we decided to use ones with at least 45 targets amplified in GCref v1 and the ones with at least 30 targets in GCval v1. Sample information for these datasets can be found in <xref ref-type="supplementary-material" rid="supp5 supp6">Supplementary files 5 and 6</xref>.</p><p>The input for the VAE is one <italic>8-</italic>mer count table per sample, summed over all targets. If a test sample is heterozygous at a given target, we translate each of its haplotypes to an <italic>8-</italic>mer count table and sum them to get the test sample’s <italic>8</italic>-mer count table for the corresponding target. If a test sample is homozygous at a given target, we translate its haplotype to an <italic>8</italic>-mer count table and double the counts to obtain its <italic>8</italic>-mer count table at the corresponding target. The counts are doubled in order to represent the target sequences as diploid sequences, and not introduce artificial differences in the total number of <italic>8-</italic>mers between homozygous and heterozygous target sites. If the test sample has more than two different haplotypes at a given target, two haplotypes are chosen at random and the sample is treated as a heterozygote. It happens on average in less than 1% of the amplified targets that there are more than two different sequences, so we expect that this inexact way of dealing with those cases does not have a major impact on the results. Because we model the <italic>8-</italic>mer counts as the observations of a Poisson distribution, the counts have to be integers, hence we cannot average over all observed alleles as in the nearest neighbour method. If a given target did not amplify in the test sample, the associated <italic>8-</italic>mer count table will just contain zeroes, equivalent to simply ignoring missing data. To obtain the VAE input, we sum the <italic>8-</italic>mer tables over all 62 targets. This results in a single table per sample, with 65,536(=4<sup>8</sup>) integer entries, roughly summing to twice the number of basepairs covered by the amplified targets, so a little under 20,000 for a sample in which all targets amplified.</p></sec><sec id="s2-5"><title>Variational autoencoder</title><p>The within-complex assignment is based around a variational autoencoder. We considered two other non-linear dimension reduction methods to perform the projection step: UMAP (<xref ref-type="bibr" rid="bib36">McInnes et al., 2018</xref>) and t-SNE (<xref ref-type="bibr" rid="bib50">van der Maaten and Hinton, 2008</xref>). t-SNE does not have the ability to embed new samples onto an already existing projection. This means that the distribution of the training set samples depends on the test set we are projecting, which is not desirable for a classification problem. UMAP can distinguish between most species in the <italic>An. gambiae</italic> complex. The projections have a distinctly different quality from the VAE: the clusters are much tighter and well separated, there are no ‘fuzzy’ boundaries as in the VAE. However, these tight and well separated clusters come at the cost of containing some hard misclassifications; that is samples of one species, which lie well inside the cluster of a different species, which makes it hard to attach any measure of uncertainty to the assignments. For a full description of the UMAP projections and their comparisons with the VAE projection, see Appendix 2. We also ran ADMIXTURE on our data, but it did not separate the species in GCref v1 by assigning them to a unique ancestral population, see Appendix 3.</p><p>The VAE consists of an encoder, a latent space projection and a decoder. The specific design we used was inspired by popVAE (<xref ref-type="bibr" rid="bib6">Battey et al., 2021</xref>). The encoder is a fully connected neural network that takes high-dimensional data as input and encodes that as a point in a latent space of much lower dimension. The decoder is also a fully connected neural network, and it takes as input a point in the latent space and outputs ‘simulated’ data of the same dimensions as the input data. The VAE learns a ‘good’ encoding by adjusting the weights in the encoder and decoder to obtain an output similar to the original input. To prevent overfitting, the input of the decoder is not the exact output of the encoder, but a nearby point in latent space. Furthermore, the loss function used to update the encoder and decoder weights contains a regularisation term on the latent space, in addition to the term measuring the similarity of the decoder output and the original input. Because of the introduced sampling noise and the regularisation constraint, the most efficient way to encode the data is to represent samples that are similar in the high-dimensional data by nearby points in the low-dimensional latent space. In summary, we expect that species identity shapes the structure in the <italic>8-</italic>mer count tables and that the VAE projects this structure to the low-dimensional latent space, resulting in clustering by species in the latent space.</p><p>In our case, the encoder input is the <italic>8-</italic>mer count table of the training set, so a table of dimension <italic>n</italic> x 65536 with non-negative integer entries, where <italic>n</italic> is the number of samples in the training set. The output of the encoder is a set of 2<italic>d</italic> parameters for each sample, where <italic>d</italic> is the dimension of the latent space. For each dimension, one parameter corresponds to the mean position in latent space and one parameter corresponds to the variance of the position in latent space. In our case, we use a three-dimensional latent space (<italic>d</italic>=3). The input of the decoder is a position in latent space for each sample, sampled from the distribution determined by the encoder output. The decoder output is an <italic>n</italic> x 65536 dimensional table of strictly positive entries, however, unlike the input table, the entries are not necessarily integers.</p><p>The loss function is the sum of two terms: one measuring the difference between the input and output data and one acting as a regulariser on the latent space. The relative weight of these terms can be adjusted. If we model the count tables as observations of independent Poisson variables, the difference between the input and output can be measured as the Kullback-Leibler divergence (KL divergence) of the Poisson distribution with the means given by the output from the Poisson distribution with the means given by the input. The KL divergence is the same up to a constant as the negative of the Poisson loglikelihood with the input as the observed counts and the output as the means. So minimising the KL divergence is equivalent to maximising the loglikelihood with respect to the output. The difference term of the loss function is obtained by summing over all unique <italic>8</italic>-mers. The theoretical minimum of the difference term of the loss function is zero, and this is attained if the output is exactly the same as the input. However, this theoretical minimum cannot be attained in practice, because the sparsity of the input implies that there will be entries equalling zero and the activation function of the decoder generating the output results in strictly positive entries.</p><p>The regularisation term of the loss function is based on the KL divergence of the normal distribution parameterised by the encoder output from a standard normal distribution, that is <inline-formula><mml:math id="inf4"><mml:mi>N</mml:mi><mml:mo>(</mml:mo><mml:mn>0,1</mml:mn><mml:mo>)</mml:mo><mml:mo>.</mml:mo></mml:math></inline-formula> The regulariser is computed for each latent space dimension separately. Again, the theoretical minimum equals zero and is attained when the mean outputted by the encoder is zero and the variance outputted by the encoder is one. The regularisation term of the loss function is defined as the KL divergence summed over the latent space dimensions. This effectively enforces the distribution specified by the encoder output to look like a multi-dimensional Gaussian distribution with mean zero, variance one and covariance zero. In layman’s terms, it pulls the projected positions of the samples in latent space towards the origin and establishes a natural scale for them. The regulariser prevents overfitting by making it expensive for the encoder to place samples far away from the origin. The loss function used to train the VAE is the weighted sum of the similarity term and the regularisation term described above, with a parameter <italic>w</italic> that controls the relative strength of the two terms.</p><p>We set most of the parameters involved in training the VAE by comparing the latent-space projections for different parameter values, using a subset of GCref v1 containing only samples from <italic>An. gambiae, An. coluzzii,</italic> and <italic>An. arabiensis</italic>. The criteria we used to pick parameter values were species classification accuracy of the reference set and the validation set, using assignments based on convex hulls (described below), visible within-species structure, and, as a secondary criterion, useful visualisation. Further detail on the choice of parameter values is provided in Appendix 4. The latent space projection is also affected by the training dataset. We observed that the presence or absence of most countries does not affect the classification, except for the Gambia and Guinea-Bissau. When these countries are removed, the accuracy to distinguish between <italic>An. gambiae</italic> and <italic>An. coluzzii</italic> considerably reduces. This is not surprising, since these samples lie on the boundary of the <italic>An. gambiae</italic> and <italic>An. coluzzii</italic> clusters and as such are crucial for assigning those species. The complete results can be found in Appendix 5.</p></sec><sec id="s2-6"><title>Within-complex species classification</title><p>We use the trained and tuned VAE to assign species as follows. We input the summed <italic>8</italic>-mer table of the test samples into the encoder of the VAE. The encoder outputs a position in latent space for each sample. Importantly, the VAE is agnostic to species labels; the species assignment happens based on the position in latent space of the test samples in relation to the latent space positions of the species-labelled reference dataset GCref v1.</p><p>The top two panels of <xref ref-type="fig" rid="fig4">Figure 4</xref> show the latent space projection of GCref v1. While most species form nicely isolated clusters, <italic>An. gambiae</italic> and <italic>An. coluzzii</italic> border each other closely. Interestingly, the boundary is formed by mosquitoes from The Gambia and Guinea-Bissau. These mosquitoes are labelled as <italic>An. gambiae</italic> by conventional molecular barcoding, but they cannot be confidently assigned to either <italic>An. gambiae</italic> or <italic>An. coluzzii</italic> using over 500 ancestry informative markers (AIMs) or whole genome PCA (<xref ref-type="bibr" rid="bib3">Anopheles gambiae 1000 Genomes Consortium, 2017</xref>; <xref ref-type="bibr" rid="bib12">Clarkson et al., 2020</xref>). The clusters containing <italic>An. bwambae</italic> and the putative new species <italic>An. fontenillei</italic> are placed very close to each other, and can also not be reliably distinguished. These species are closely related, but up until now they have only been discovered in Uganda and Gabon, respectively, and so, since they do not seem to have overlapping geographic species ranges (<xref ref-type="bibr" rid="bib5">Barrón et al., 2019</xref>), the species identity of samples falling into either of these two clusters can be resolved by their geographic origin.</p><fig id="fig4" position="float"><label>Figure 4.</label><caption><title>VAE projection of the <italic>gambiae</italic> complex reference dataset GCref v1.</title><p>Top panels: the samples are represented by dots at the inferred mean position in three-dimensional latent space and coloured by their species label. The left panel shows latent dimension 1 versus latent dimension 2 and the right panel shows latent dimension 1 versus latent dimension 3. Bottom panel: the same projection as above, but here the samples are coloured by the country of collection revealing structure related to geography.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-78775-fig4-v2.tif"/></fig><p>We perform species classification using the convex hulls of species clusters. A convex hull is the mathematical notion of the smallest convex set containing all points of interest. A nice metaphor is to imagine that you are wrapping all points corresponding to samples of a single species together in such a way that requires the minimal amount of wrapping paper. We constructed one convex hull for each species represented in the dataset, using latent space positions of the samples from GCref v1 as well as of 363 additional species-labelled samples that were not used in training the VAE, to account for possible effects caused by projecting the samples to the latent space (sample information to be found in <xref ref-type="supplementary-material" rid="supp7">Supplementary file 7</xref>). For our classification procedure, it is important that the convex hulls of different species do not overlap. When constructing convex hulls from the full sample set, only the convex hulls corresponding to <italic>An. gambiae</italic> and <italic>An. coluzzii</italic> overlap. We trimmed these hulls by iteratively removing samples from the set of points used to construct them until they did not overlap. In total, we removed 17 <italic>An. gambiae</italic> and 6 <italic>An. coluzzii</italic> samples. The samples from <italic>An. bwambae</italic> and <italic>An. fontenillei</italic> are combined in one convex hull because they are so close together in latent space.</p><p>The classification of new samples happens as follows. If the latent space position of the test sample falls inside a convex hull, the sample is classified as that species. If the latent space position of the test sample falls outside all convex hulls, there are two options. If the sample is much closer to one convex hull than to all others, it is classified as the species corresponding to the hull it is closest to. To be precise, this happens if the euclidean distance to the closest convex hull is at least 7 times smaller than the distance to all other convex hulls. This allows for ‘fuzzy’ boundaries of the convex hulls that are proportional to the separation between the different hulls. We fitted the parameter value 7 on the dataset from Gabon to reflect the assumption that <italic>An. tengrela</italic> is not believed to be found in Gabon. If the latent space position of the test sample falls outside all convex hulls and outside their fuzzy boundaries, the sample is assigned ‘uncertain’ followed by the labels of all the species whose convex hulls are within a radius of 7 times the distance to the closest convex hull, in order of proximity. This assignment reflects the uncertainty in our classification of samples that fall in an area in latent space where no species-labelled samples fall. At the same time, it gives information on our best guess or guesses for the species identity and leaves open the possibility to modify the assignments based on prior knowledge, for example species ranges or habitat restrictions.</p><p>There is one exception to the above assignment procedure: if the closest two convex hulls are from <italic>An. gambiae</italic> and <italic>An. coluzzii</italic> and the euclidean distance to both of these hulls is less than 14 then the test sample is classified as <italic>uncertain_gambiae_coluzzii</italic> or <italic>uncertain_coluzzii_gambiae</italic>, depending on which convex hull is closer, because we cannot reliably distinguish between these species in this part of the latent space.</p><p>In addition to structure driven by species, the latent space projection of GCref v1 also exhibits geographical structure. Within the <italic>An. gambiae</italic> species cluster, there is a distinct subcluster of samples from Madagascar. Similarly, there is a distinct subcluster of samples from Madagascar in the <italic>An. arabiensis</italic> species cluster. As mentioned before, the boundary between the <italic>An. gambiae</italic> and <italic>An. coluzzii</italic> species clusters is formed by samples from the far West of Africa. These samples also stand out as a separate group in a study on whole genome data (<xref ref-type="bibr" rid="bib10">Caputo et al., 2021</xref>; <xref ref-type="bibr" rid="bib12">Clarkson et al., 2020</xref>). There also appears to be a cluster of East African <italic>An. gambiae</italic> samples that are distinct from the main cluster of <italic>An. gambiae</italic> as well as the Madagascar samples. It is promising to see signatures of geographic structure within species from the amplicon panel data, because this suggests that the panel can also be useful to explore population structure within species.</p></sec><sec id="s2-7"><title>VAE classification accuracy</title><p>We applied the species assignment procedure to GCval v1 (<xref ref-type="fig" rid="fig5">Figure 5</xref>). 134 out of 142 samples (94.4%) samples are assigned to a single species and 132 of those (98.5%) are assigned to the species concordant with their species label. One sample labelled as <italic>An. coluzzii</italic> is classified as <italic>An. gambiae</italic> and one sample labelled as <italic>An. gambiae</italic> is classified as <italic>An. coluzzii</italic>. For all eight samples classified as uncertain, the reference species label is among the set of assigned labels. Seven of the samples classified as uncertain had fewer than 45 targets and we know that the proportion of missing targets affects the position in latent space of the projected samples. The other sample classified as uncertain falls in the space between <italic>An. gambiae</italic> and <italic>An. coluzzii</italic>. Further information can be found in <xref ref-type="supplementary-material" rid="supp6">Supplementary file 6</xref>.</p><fig id="fig5" position="float"><label>Figure 5.</label><caption><title>VAE projections of (<bold>A</bold>) validation set GCval v1 (<bold>B</bold>) diverged samples from Ag1000G (<bold>C</bold>) sample set from Burkina Faso (<bold>D</bold>) sample set from Gabon.</title><p>The samples from the reference set GCref v1 are displayed as half transparent circles, coloured by species as in <xref ref-type="fig" rid="fig4">Figure 4</xref>. The samples from each of the projected sample sets are coloured by their assigned labels. The numbers behind each label corresponds to the number of samples in that category. Samples with more than 3 species-labels are listed as ‘other’. The two samples from GCval v1 for which the species label does not match the assigned species are marked with a red cross.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-78775-fig5-v2.tif"/></fig></sec><sec id="s2-8"><title>Case studies</title><sec id="s2-8-1"><title>Ag1000G whole genome sequenced samples that are too diverged from the reference genome</title><p>The Ag1000G project removes samples from its analysis that appear not to be <italic>An. gambiae</italic>, <italic>An. coluzzii,</italic> or <italic>An. arabiensis</italic> based on their divergence from the PEST (<italic>An. gambiae</italic>) reference genome. We ran NNoVAE on all samples that fail the divergence filter from data releases v3 and v3.1 through v3.5. In these datasets, 212 of nearly 10,000 samples were filtered due to high divergence from the PEST reference genome; we assign 166 of those to <italic>An. funestus</italic> at the fine level and 17 to the <italic>An. gambiae</italic> complex at the intermediate level. Furthermore, we assign one sample to <italic>An. nili gp sp3</italic> and one to <italic>An. jebudensis</italic> at the fine level, and one to <italic>An. marshallii</italic> group at the intermediate level. There are 20 samples that get assigned only at the coarse level to the <italic>Myzomyia Neocellia</italic> series and six samples do not get assigned at any level. See <xref ref-type="supplementary-material" rid="supp8">Supplementary file 8</xref> for all sample and assignment information.</p><p>All 17 samples that are assigned to the <italic>An. gambiae</italic> complex had at least 50 targets. We assigned 5 samples to <italic>An. merus,</italic> 11 to <italic>An. melas</italic> and 1 to <italic>Uncertain_melas_quadriannulatus</italic> (<xref ref-type="fig" rid="fig5">Figure 5</xref>). The geographic origin of the samples assigned to <italic>An. merus</italic> and <italic>An. melas</italic> is compatible with the known ranges of these species (<xref ref-type="bibr" rid="bib56">Wiebe et al., 2017</xref>).</p><p>Two of the unassigned samples stand out by their assignments: one sample appears to be from the <italic>An. gambiae</italic> complex but contaminated by an <italic>An. funestus</italic> sample; the second appears to be a member of the <italic>Culex</italic> genus rather than the <italic>Anopheles</italic> genus, based on mitochondrial analysis (data not provided). For this sample, we extracted only 13 targets. The remaining unassigned samples and those only assigned at the coarse level have at least 42 targets. They can be split into four groups of samples that are similar to each other in assignment proportions and mitochondrially. Because of the high amplicon recovery rate and the similarity of assignment proportions, often found in different countries, we believe that these samples represent species that are not present in NNv1. We aim to confirm the species identity for these groups by morphology and genomic comparison to publicly available data and, assuming this is successful, to include them in the next update of the reference database.</p></sec><sec id="s2-8-2"><title>Burkina Faso</title><p>We collected 950 mosquitoes from three different locations in Burkina Faso. All individuals were morphologically assigned to the <italic>An. gambiae</italic> complex. For 905 individuals (95.3%) we obtained at least 10 amplified targets, the minimum number required for NN assignment. A total of 901 samples are indeed assigned to the <italic>An.gambiae complex</italic> at the intermediate level, 2 samples are assigned to <italic>An. nili group sp3</italic> at the fine level, 1 sample could only be assigned at the coarse level to the <italic>Myzomyia Neocellia</italic> series and 1 sample could not be assigned at any level. The latter two samples require more detailed morphological investigation, which is made possible by the non-destructive extraction approach we used on these mosquitoes.</p><p>For 770 of the samples assigned to the <italic>An. gambiae complex</italic> (85.5%) we obtain at least 50 amplified targets, the minimum number required for VAE assignment. We find three species in this dataset: <italic>An. gambiae, An. coluzzii,</italic> and <italic>An. arabiensis</italic> (<xref ref-type="fig" rid="fig5">Figure 5</xref>). Most samples (91.6%) could be assigned to a single species, but we also find some samples labelled as uncertain shared between <italic>An. gambiae</italic> and one other species. The two samples that fall in the space between the <italic>An. gambiae</italic> and <italic>An. arabiensis</italic> reference samples are remarkably far away from all other samples. We cannot exclude the possibility that contamination between samples plays a role here, especially because these samples were stored with 10 individuals in ethanol in a single 1.5 mL tube in the years before sequencing. All metadata and assignment information can be found in <xref ref-type="supplementary-material" rid="supp9">Supplementary file 9</xref>.</p></sec><sec id="s2-8-3"><title>Gabon</title><p>We collected 1,056 mosquitoes by human landing catch from different locations in Lopé village in Gabon. All individuals were morphologically identified as members of the <italic>An. gambiae</italic> complex. Eleven mosquitoes were identified as <italic>An. fontenillei</italic> by a species diagnostic PCR (<xref ref-type="bibr" rid="bib18">Fanello et al., 2002</xref>) and those clustered with the <italic>An. fontenillei</italic> and <italic>An. bwambae</italic> samples in the VAE projection as expected. Those samples were used to construct the convex hulls. For 1002 (95.9%) of the unidentified samples we obtain at least 10 targets and these are classified by the NN step of NNoVAE. The vast majority (993 samples; 99.1%) is assigned to the <italic>An. gambiae complex</italic>. The other species we find in this dataset are <italic>An. funestus</italic> (two individuals) and <italic>An. coustani complex</italic> (two individuals), plus five individuals that could not be assigned at any level. The five unassigned individuals had a high proportion of multi-allelic targets, suggesting contamination may have occurred at some point in the process.</p><p>Of the 993 mosquitoes assigned to the <italic>An. gambiae</italic> complex, 890 (89.6%) have sufficiently many targets to be run through the VAE (<xref ref-type="fig" rid="fig5">Figure 5</xref>). Most of these are assigned to a single species: 632 to <italic>An. coluzzii</italic>, 130 <italic>An. gambiae,</italic> and 1 <italic>An. fontenillei</italic> (the latter is actually assigned to the combined convex hull of <italic>An. fontenillei</italic> and <italic>An. bwambae</italic>, but are assumed to be <italic>An. fontenillei</italic> because of the non-overlapping species ranges). <italic>An. fontenillei</italic> was first discovered in the forest of La Lopé National Park, 10–15 km south of the sampling locations presented in this study (<xref ref-type="bibr" rid="bib5">Barrón et al., 2019</xref>). Although the species strongly prefers forested habitats, it is not surprising to find one of them in the village given the small distance. It is noticeable that a large number of samples fall in between the <italic>An. coluzzii</italic> and <italic>An. tengrela</italic> clusters. Judging from the projection, we suspect that the whole cluster is <italic>An. coluzzii</italic>, but it may be interesting to explore what drives the variation within this large cluster and why so many samples are projected to an area where none of our reference samples are. Four other samples are projected close to the <italic>An. arabiensis</italic> cluster, although they are assigned to a large set of species labels. Independent PCR species diagnostics confirmed these four samples as <italic>An. arabiensis</italic> (<xref ref-type="bibr" rid="bib18">Fanello et al., 2002</xref>). This was surprising because <italic>An. arabiensis</italic> has not been observed in Gabon before, despite extensive sampling efforts. The fact that we see only four such specimens in this set of more than 1,000 with sufficient data, demonstrates that whatever species these mosquitoes are, they are probably quite rare or less likely to be caught by human landing catches. We plan to generate whole genome sequencing data for these individuals to investigate their species and their relationship to <italic>An. arabiensis</italic> from other geographic locations and to other sympatric species. All sample information and assignment results are listed in <xref ref-type="supplementary-material" rid="supp10">Supplementary file 10</xref>.</p></sec></sec></sec><sec id="s3" sec-type="discussion"><title>Discussion</title><p>In this paper we presented NNoVAE, a method for robust species identification for the entire <italic>Anopheles</italic> genus from multilocus targeted amplicon sequencing data. This integrated approach removes the need for sorting the specimens into species groups or complexes based on morphology, which is labour intensive and error prone, particularly in the case of damaged mosquitoes, for instance when collected with CDC light traps. The NN step can distinguish between most species in our reference database. But equally importantly, it gives an indication of the uncertainty of the assignment, using the same thresholds for the entire genus, enabling us to quantify confidence in assignment in a meaningful way allowing for comparison between all species groups. For individuals from species not yet represented in the reference dataset, we can often assign to a species-group at the intermediate level (corresponding to taxonomic species groups or complexes) or at the coarse level (corresponding to taxonomic series or subgenera). A few samples did not meet the threshold to be assigned at the coarse level, but the assignment results do give an indication of the position of these samples in the phylogeny. Initial explorations of the mitochondrial sequences for those samples do not indicate a close match to publicly available mitochondrial data of any <italic>Anopheles</italic> species. We hope to resolve the species identity of these samples by extending our reference database and collaborating with morphological experts, but until then we retain the groups of unresolved species to compare future samples against them.</p><p>The NN step alone struggles to differentiate closely related species within species complexes. For the <italic>An. gambiae</italic> complex we developed a high resolution species identification method based on a variational autoencoder. This VAE step should be easily extendable to other species complexes for which a sufficient amount of species-labelled data is available, which we expect to be the case soon for <italic>An. funestus</italic> and <italic>An. coustani</italic>. The VAE can accurately distinguish between eight species in the <italic>An. gambiae</italic> complex; only <italic>An. bwambae</italic> and <italic>An. fontenillei</italic> are too close together in the projection to reliably separate them, but geographic origin helps with this. The species assignments for the VAE are currently quite conservative; only if the VAE projection of the test sample falls within the cloud of training samples from a single species, or much more close to it than to any other cluster, is it assigned to that species. Otherwise it gets assigned all the species labels of nearby clusters. This way, we flag potential outliers or unexpected species, as for the <italic>An. arabiensis</italic> in Gabon, but entomologists can still decide to exclude certain species labels if they are sure that they are not appropriate for their collection location and time, for instance the <italic>An. tengrela</italic> label in Gabon.</p><p>The VAE projection of the <italic>An. gambiae</italic> complex also shows some population structure within species clusters. Some of the structure reflects the geography of the collection locations, for example Madagascar stands out as a separate subcluster both for <italic>An. gambiae</italic> and <italic>An. arabiensis</italic>. However, the sample sets from Burkina Faso and Gabon show that samples from the same location can be projected to different positions in latent space and it would be interesting to investigate what is driving this observed diversity.</p><p>NNoVAE relies on a reference database and therefore the accuracy of the species assignments also depends on the quality and completeness of the reference database. We expect that version 2 of the reference database will contain approximately fifty additional species, as well as more individuals of species that are underrepresented in NNv1 and we are seeking further well-characterised samples.</p><p>Our goal over the next 2 years is to adapt the ANOSPP protocol, which currently uses high-throughput robotics equipment at Sanger, to run it in any basic molecular laboratory. We plan to build an accompanying website where sequence data will be automatically accessible and data analyses can be run interactively and openly (if desired). We hope that the combination of the complete end-to-end protocol from sample to sequence interpretation together with a one stop shop for data interpretation will help connect vector control initiatives across the globe.</p><p>We believe that this genomic species identification tool for the entire genus is extremely valuable to monitor <italic>Anopheles</italic> populations at large scale. We think that similar tools could benefit researchers studying other genera with morphologically similar species, in particular when knowing the species identity is of medical importance. We hope that the methods outlined in <xref ref-type="bibr" rid="bib33">Makunin et al., 2022</xref> and in this manuscript can be of help in developing a targeted amplicon panel for other important vector genera such as <italic>Aedes</italic> and <italic>Culex</italic> and that by extending NNoVAE as described here it will be straightforward to analyse data from such future panels.</p><p>NNoVAE can characterise vector populations in a uniform way across the <italic>Anopheles</italic> genus and as such contributes to our understanding of <italic>Anopheles</italic> species composition, population structure, species ranges, and transmission potential. We believe that large scale monitoring of <italic>Anopheles</italic> populations of all species is of pivotal importance for successful implementation of malaria control strategies. ANOSPP and NNoVAE enable us to catalogue species ranges and distributions and identify and record which species are found to carry <italic>Plasmodium</italic>. It has been shown that by successfully targeting a single vector species, a different species can become the main transmitter of malaria (<xref ref-type="bibr" rid="bib40">Okumu and Finda, 2021</xref>). <italic>An. stephensi</italic>, an efficient vector species originally found in South East Asia and the Arabian peninsula, has been reported to spread in the Horn of Africa and was implicated in malaria outbreaks in Djibouti (<xref ref-type="bibr" rid="bib19">Faulde et al., 2014</xref>; <xref ref-type="bibr" rid="bib46">Seyfarth et al., 2019</xref>; <xref ref-type="bibr" rid="bib1">Ahmed et al., 2021</xref>). These examples underscore the importance of monitoring species and their transmission potential agnostically. ANOSPP and NNoVAE also provide an opportunity to study changes in species composition, for instance by comparing catches before and after implementing a malaria control intervention, or by comparing catches collected in different seasons or in areas undergoing land use changes. Lastly, ANOSPP and NNoVAE provide a quick and cheap way to select interesting samples (e.g. unexpected species for the collection area or season, or simply balanced numbers of different species) for whole genome sequencing to study important genomic features, such as evidence of population bottlenecks or spread of strongly selected putative insecticide resistance alleles. In conclusion, the combination of ANOSPP and NNoVAE offers a cheaper, more robust, more informative, and more reliable way to carry out malaria vector surveillance that we hope will be embraced over the coming years by the medical entomology community and National Malaria Control Programs.</p></sec><sec id="s4" sec-type="methods"><title>Methods</title><sec id="s4-1"><title>Data processing</title><sec id="s4-1-1"><title>Panel sequences</title><p>The amplicon sequencing data are processed as described previously (<xref ref-type="bibr" rid="bib33">Makunin et al., 2022</xref>). In brief, the fastq files containing the reads are split into one file per target by cutadapt v2.5 (<xref ref-type="bibr" rid="bib35">Martin, 2011</xref>), which uses the primer sequences to do so. Cutadapt also filters for read pairs where both the forward and reverse read match the appropriate primer and trims the primers. Next, DADA2 v1.10 (<xref ref-type="bibr" rid="bib9">Callahan et al., 2016</xref>) is used to reconstruct sample haplotypes from these read pairs and they are filtered using a custom script to include only haplotypes supported by at least 10 read pairs and with at least 0.1 haplotype frequency per sample-amplicon pair.</p></sec><sec id="s4-1-2"><title>Reference genomes</title><p>In silico amplicon extraction from reference genomes is done as described previously (<xref ref-type="bibr" rid="bib33">Makunin et al., 2022</xref>). Targets are extracted by matching the primer sequences in the reference genome using SeekDeep v2.6 command ‘genTargetInfoFromGenomes’ (<xref ref-type="bibr" rid="bib24">Hathaway et al., 2018</xref>).</p></sec><sec id="s4-1-3"><title>Publicly available data</title><p>Where short read whole genome sequence data are publicly available for <italic>Anopheles</italic> mosquitoes, we use these data to pull out target haplotypes to add to our reference index. If the genomic coordinates of the primers are known (e.g. the reads are aligned to a publicly available reference genome), we extract the reads overlapping the primer or target sites for each amplicon separately from BAM files and convert these to fastq files, using samtools v1.9 (<xref ref-type="bibr" rid="bib31">Li et al., 2009</xref>). These are used as input for fermi-lite (<xref ref-type="bibr" rid="bib32">Li, 2015</xref>), which creates an assembly graph. The unitigs from the assembly graph are cleaned up by cutadapt v3.1 (<xref ref-type="bibr" rid="bib35">Martin, 2011</xref>): the sequences outside the primer sites are trimmed, while the sequences matching the primers are retained and the unitigs are oriented according to the primers. Next, the unitigs are merged using the information from the assembly graph with a custom python script, which relies on MAFFT v7.475 (<xref ref-type="bibr" rid="bib27">Katoh and Standley, 2013</xref>) for sequence alignment. In the final step, the primers are trimmed from the resulting haplotypes by cutadapt and any haplotypes that do not have primer sequences on both ends are removed, which helps to get rid of contamination. If the genomic coordinates of the primers are not known, we align the samples to the most appropriate reference genome, identify the genomic coordinates of the primer sites if not yet known and follow the steps above.This pipeline is implemented in Snakemake 5.30.2 (<xref ref-type="bibr" rid="bib37">Mölder et al., 2021</xref>). Snakefile and scripts are available on GitHub.</p></sec></sec><sec id="s4-2"><title>Data structure</title><p>The resulting haplotypes are stored in a table with columns recording the sample name, target, haplotype sequence, read count of supporting reads (for amplicon data only), fraction of supporting reads (for amplicon data only). So each row corresponds to a unique haplotype for a sample target combination, hence samples that are heterozygous at a certain target will have two rows for the same target.</p></sec><sec id="s4-3"><title>Implementation</title><p>Species labels are assessed and species-groups constructed using custom Python scripts implemented in python 3.8 (<xref ref-type="bibr" rid="bib51">Van Rossum and Drake, 2009</xref>). The VAE is implemented in keras 2.3 (<xref ref-type="bibr" rid="bib11">Chollet, 2015</xref>) using a custom python script. Convex hull construction and distance computations rely on scipy 1.6 (<xref ref-type="bibr" rid="bib52">Virtanen et al., 2020</xref>) and pygel3d 0.2 (<xref ref-type="bibr" rid="bib4">Baerentzen, 2018</xref>). Plots are created with matplotlib 3.3 (<xref ref-type="bibr" rid="bib25">Hunter, 2007</xref>) and seaborn 0.11 (<xref ref-type="bibr" rid="bib54">Waskom, 2021</xref>). All scripts and environments are available on GitHub.</p></sec><sec id="s4-4"><title><italic>K</italic>-mers</title><p>Alignments of amplicon target sequences from highly diverged species are often poor and it is difficult to define a ‘fair’ distance metric based on these alignments. Moreover, there is not a straightforward way to account for small indels and structural variants with alignment based distances. <italic>K</italic>-mer based distances naturally incorporate indels and structural variation and account for highly diverged sequences in an objective way and provide a solution to the problems arising from relying on alignments. Therefore, our species assignment method uses <italic>k</italic>-mers to support better comparisons between the sequences in the database and the sequences of the test sample.</p><p>There is a trade-off in the choice of <italic>k</italic>. For large <italic>k</italic> there is little tolerance for errors, while for small <italic>k</italic> there is a high chance that the same <italic>k</italic>-mer is found in multiple locations in the sequence. For example, in a 149 bp sequence, 5 evenly spread SNPs result in no 25-mers matching the reference. On the other hand, the chance that all 4-mers are unique in a sequence of the same length is incredibly small (&lt;10<sup>–22</sup>). Based on these trade-offs, we selected 8-mers as a reasonable length. The total sequence length of the amplicon panel targets for the current <italic>An. gambiae</italic> PEST reference genome sequence AgamP4 is 9928 bp, with a mean target length of 160 bp. There are 65536 unique 8-mers, so the chance that all 8-mers within a target are unique is 84% on average. Across the nearly 10 kb of amplified sequence, the chance that all 8-mers are unique is vanishingly small, but the expected number of unique 8-mers is approximately 8533 (sd 46) and the expected number of non-unique 8-mers is approximately 680 (sd 22).</p><p>The methods we present here work with <italic>k</italic>-mer tables created from each haplotype from each target. A <italic>k</italic>-mer table consists of 4<sup>k</sup> columns, each corresponding to a unique <italic>k</italic>-mer. To translate a sequence to a <italic>k</italic>-mer table, we record in each column how often the corresponding <italic>k-</italic>mer occurs in the sequence. This results in a sparse table (the sparsity of course depends on the choice of <italic>k</italic>) with non-negative integer entries. As an example, the <italic>2</italic>-mer table for the sequences <named-content content-type="sequence">AACTACTCT </named-content>(first row) and <named-content content-type="sequence">AGCTACTT </named-content>(second row) is shown below. Note that <italic>all</italic> possible <italic>k-</italic>mers are represented in the table, even when they do not appear in any sequence.</p><table-wrap id="inlinetable1" position="anchor"><table frame="hsides" rules="groups"><thead><tr><th align="left" valign="bottom">AA</th><th align="left" valign="bottom">AC</th><th align="left" valign="bottom">AG</th><th align="left" valign="bottom">AT</th><th align="left" valign="bottom">CA</th><th align="left" valign="bottom">CC</th><th align="left" valign="bottom">CG</th><th align="left" valign="bottom">CT</th><th align="left" valign="bottom">GA</th><th align="left" valign="bottom">GC</th><th align="left" valign="bottom">GG</th><th align="left" valign="bottom">GT</th><th align="left" valign="bottom">TA</th><th align="left" valign="bottom">TC</th><th align="left" valign="bottom">TG</th><th align="left" valign="bottom">TT</th></tr></thead><tbody><tr><td align="char" char="." valign="bottom">1</td><td align="char" char="." valign="bottom">2</td><td align="char" char="." valign="bottom">0</td><td align="char" char="." valign="bottom">0</td><td align="char" char="." valign="bottom">0</td><td align="char" char="." valign="bottom">0</td><td align="char" char="." valign="bottom">0</td><td align="char" char="." valign="bottom">3</td><td align="char" char="." valign="bottom">0</td><td align="char" char="." valign="bottom">0</td><td align="char" char="." valign="bottom">0</td><td align="char" char="." valign="bottom">0</td><td align="char" char="." valign="bottom">1</td><td align="char" char="." valign="bottom">1</td><td align="char" char="." valign="bottom">0</td><td align="char" char="." valign="bottom">0</td></tr><tr><td align="char" char="." valign="bottom">0</td><td align="char" char="." valign="bottom">1</td><td align="char" char="." valign="bottom">1</td><td align="char" char="." valign="bottom">0</td><td align="char" char="." valign="bottom">0</td><td align="char" char="." valign="bottom">0</td><td align="char" char="." valign="bottom">0</td><td align="char" char="." valign="bottom">2</td><td align="char" char="." valign="bottom">0</td><td align="char" char="." valign="bottom">1</td><td align="char" char="." valign="bottom">0</td><td align="char" char="." valign="bottom">0</td><td align="char" char="." valign="bottom">1</td><td align="char" char="." valign="bottom">0</td><td align="char" char="." valign="bottom">0</td><td align="char" char="." valign="bottom">1</td></tr></tbody></table></table-wrap><p>The <italic>k</italic>-mer distance between two sequences is defined as follows. Translate both sequences to <italic>k-</italic>mer tables as described above and call these q<sub>1</sub> and q<sub>2</sub>. Then the <italic>k</italic>-mer distance between them is given by <inline-formula><mml:math id="inf5"><mml:msub><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>Σ</mml:mi><mml:mfenced open="|" close="|" separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>Σ</mml:mi><mml:mfenced open="|" close="|" separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:mrow></mml:mfrac></mml:math></inline-formula> , that is the number of non-matching <italic>k-</italic>mers divided by the total number of <italic>k</italic>-mers in both sequences. The normalisation is required to correct for a bias attributing smaller distances to shorter sequences. In the nearest neighbour method we use this <italic>k</italic>-mer distance to compare one haplotype sequence of a test individual against one haplotype sequence from the reference database. Note that this definition relies on the <italic>k</italic>-mer counts, not simply on the presence or absence of each <italic>k-</italic>mer. Using this definition, the <italic>2</italic>-mer distance between <named-content content-type="sequence">AACTACTCT </named-content>and <named-content content-type="sequence">AGCTACTT </named-content>is 7/15.</p></sec><sec id="s4-5"><title>Data collection and availability</title><p>All mosquitoes collected as part of this work were done so under the local guidelines and with permission, which vary depending on the country of origin. ABS (Nagoya) compliance for receiving mosquitoes or their DNA in the UK was completed for all mosquitoes used in this research. Raw sequencing data will be made available on ENA (accession to be confirmed). Pipelines and analysis code, together with processed target haplotypes are available on GitHub: <ext-link ext-link-type="uri" xlink:href="https://github.com/mariloubodde/NNoVAE">https://github.com/mariloubodde/NNoVAE</ext-link>.</p></sec></sec></body><back><sec sec-type="additional-information" id="s5"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="COI-statement" id="conf1"><p>No competing interests declared</p></fn><fn fn-type="COI-statement" id="conf2"><p>No competing interests declared</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>Resources, Writing – review and editing, Conceptualization, Data curation, Formal analysis, Investigation, Visualization</p></fn><fn fn-type="con" id="con2"><p>Writing – review and editing, Methodology, Writing - original draft</p></fn><fn fn-type="con" id="con3"><p>Supervision, Funding acquisition, Writing - original draft</p></fn><fn fn-type="con" id="con4"><p>Supervision, Writing - original draft</p></fn><fn fn-type="con" id="con5"><p>Supervision, Funding acquisition</p></fn><fn fn-type="con" id="con6"><p>Supervision, Funding acquisition</p></fn><fn fn-type="con" id="con7"><p>Supervision, Writing - original draft</p></fn><fn fn-type="con" id="con8"><p>Supervision</p></fn><fn fn-type="con" id="con9"><p>Supervision, Writing - original draft</p></fn><fn fn-type="con" id="con10"><p>Supervision</p></fn><fn fn-type="con" id="con11"><p>Supervision</p></fn><fn fn-type="con" id="con12"><p>Supervision</p></fn><fn fn-type="con" id="con13"><p>Supervision, Funding acquisition, Writing - original draft</p></fn><fn fn-type="con" id="con14"><p>Resources, Methodology, Funding acquisition, Writing - original draft</p></fn><fn fn-type="con" id="con15"><p>Resources, Methodology, Funding acquisition, Writing - original draft</p></fn></fn-group></sec><sec sec-type="supplementary-material" id="s6"><title>Additional files</title><supplementary-material id="supp1"><label>Supplementary file 1.</label><caption><title>NNv1 metadata and species labelling information.</title></caption><media xlink:href="elife-78775-supp1-v2.tsv" mimetype="text" mime-subtype="tab-separated-values"/></supplementary-material><supplementary-material id="supp2"><label>Supplementary file 2.</label><caption><title>NNv1 coarse level assignment proportions.</title></caption><media xlink:href="elife-78775-supp2-v2.tsv" mimetype="text" mime-subtype="tab-separated-values"/></supplementary-material><supplementary-material id="supp3"><label>Supplementary file 3.</label><caption><title>NNv1 intermediate level assignment proportions.</title></caption><media xlink:href="elife-78775-supp3-v2.tsv" mimetype="text" mime-subtype="tab-separated-values"/></supplementary-material><supplementary-material id="supp4"><label>Supplementary file 4.</label><caption><title>NNv1 fine level assignment proportions.</title></caption><media xlink:href="elife-78775-supp4-v2.tsv" mimetype="text" mime-subtype="tab-separated-values"/></supplementary-material><supplementary-material id="supp5"><label>Supplementary file 5.</label><caption><title>GCref v1 metadata and VAE projection coordinates.</title></caption><media xlink:href="elife-78775-supp5-v2.tsv" mimetype="text" mime-subtype="tab-separated-values"/></supplementary-material><supplementary-material id="supp6"><label>Supplementary file 6.</label><caption><title>GCval v1 metadata and assignment results.</title></caption><media xlink:href="elife-78775-supp6-v2.tsv" mimetype="text" mime-subtype="tab-separated-values"/></supplementary-material><supplementary-material id="supp7"><label>Supplementary file 7.</label><caption><title>Additional samples for convex hull definitions, metadata and VAE projection coordinates.</title></caption><media xlink:href="elife-78775-supp7-v2.tsv" mimetype="text" mime-subtype="tab-separated-values"/></supplementary-material><supplementary-material id="supp8"><label>Supplementary file 8.</label><caption><title>Ag1000G diverged samples metadata and assignment results.</title></caption><media xlink:href="elife-78775-supp8-v2.tsv" mimetype="text" mime-subtype="tab-separated-values"/></supplementary-material><supplementary-material id="supp9"><label>Supplementary file 9.</label><caption><title>Burkina Faso metadata and assignment results.</title></caption><media xlink:href="elife-78775-supp9-v2.tsv" mimetype="text" mime-subtype="tab-separated-values"/></supplementary-material><supplementary-material id="supp10"><label>Supplementary file 10.</label><caption><title>Gabon metadata and assignment results.</title></caption><media xlink:href="elife-78775-supp10-v2.tsv" mimetype="text" mime-subtype="tab-separated-values"/></supplementary-material><supplementary-material id="mdar"><label>MDAR checklist</label><media xlink:href="elife-78775-mdarchecklist1-v2.pdf" mimetype="application" mime-subtype="pdf"/></supplementary-material></sec><sec sec-type="data-availability" id="s7"><title>Data availability</title><p>Pipelines and analysis code, together with processed target haplotypes are available on GitHub: <ext-link ext-link-type="uri" xlink:href="https://github.com/mariloubodde/NNoVAE">https://github.com/mariloubodde/NNoVAE</ext-link>, (copy archived at <ext-link ext-link-type="uri" xlink:href="https://archive.softwareheritage.org/swh:1:dir:09d2b2160c2691d1d397edbbc415a9fdb6231972;origin=https://github.com/mariloubodde/NNoVAE;visit=swh:1:snp:69fd867cd35eb5b2600a31b83d43713011f80f5c;anchor=swh:1:rev:560351c897476e4e869feafaa39a077fa5a7aa86">swh:1:rev:560351c897476e4e869feafaa39a077fa5a7aa86</ext-link>). Raw sequencing data has been made available on ENA; accesions can be found on GitHub.</p></sec><ack id="ack"><title>Acknowledgements</title><p>We thank Vickie Brooks for general logistic support for ANOSPP. We thank Petra Korlević for support in wet lab work, valuable discussions and conducting the mitochondrial analysis. For field sampling in Burkina Faso, we would like to thank Franck Adama Yao, Patric Stéphane Epopa Ngomé, Nouhoun Traoré, and the Target Malaria Team. We thank Samuel Anifowose, Akinkunle Adeniyi, Joshua Oduwu, Idris Otun, Juwon Adeniji, Wale Enisemo, Cynthia Umunnakwe and Adedotun Bayegun for sample collection and processing in Nigeria. In Gabon, we thank the ESV team at the CIRMF. We also thank the Institut Pasteur de Madagascar for sample collection in this country. We thank Sanger’s Scientific Operation Teams for carrying out all PCRs, library generation, and sequencing on data presented here and Catherine McCarthy for her support in ensuring all samples are compliant with Access and Benefit Sharing of sequence data as laid out by the Nagoya Protocol. The Wellcome Sanger Institute is funded by the Wellcome Trust (206194/Z/17/Z), which supports MKNL and the work contained here. MB was supported by Wellcome 4 year PhD studentship (RG92770), and RD by Wellcome award (WT207492). Gabon collections were supported by an ANR grant to DA (ANR-18-CE35-0002-01 – WILDING). LB was supported by an IRD student fellowship (Bourse ARTS/IRD).</p></ack><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ahmed</surname><given-names>A</given-names></name><name><surname>Khogali</surname><given-names>R</given-names></name><name><surname>Elnour</surname><given-names>MAB</given-names></name><name><surname>Nakao</surname><given-names>R</given-names></name><name><surname>Salim</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Emergence of the invasive malaria vector anopheles stephensi in Khartoum state, central Sudan</article-title><source>Parasites &amp; Vectors</source><volume>14</volume><elocation-id>511</elocation-id><pub-id pub-id-type="doi">10.1186/s13071-021-05026-4</pub-id><pub-id pub-id-type="pmid">34600584</pub-id></element-citation></ref><ref id="bib2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Altschul</surname><given-names>SF</given-names></name><name><surname>Madden</surname><given-names>TL</given-names></name><name><surname>Schäffer</surname><given-names>AA</given-names></name><name><surname>Zhang</surname><given-names>J</given-names></name><name><surname>Zhang</surname><given-names>Z</given-names></name><name><surname>Miller</surname><given-names>W</given-names></name><name><surname>Lipman</surname><given-names>DJ</given-names></name></person-group><year iso-8601-date="1997">1997</year><article-title>Gapped blast and PSI-BLAST: a new generation of protein database search programs</article-title><source>Nucleic Acids Research</source><volume>25</volume><fpage>3389</fpage><lpage>3402</lpage><pub-id pub-id-type="doi">10.1093/nar/25.17.3389</pub-id><pub-id pub-id-type="pmid">9254694</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="journal"><person-group person-group-type="author"><collab>Anopheles gambiae 1000 Genomes Consortium</collab></person-group><year iso-8601-date="2017">2017</year><article-title>Genetic diversity of the African malaria vector anopheles gambiae</article-title><source>Nature</source><volume>552</volume><fpage>96</fpage><lpage>100</lpage></element-citation></ref><ref id="bib4"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Baerentzen</surname><given-names>JA</given-names></name></person-group><year iso-8601-date="2018">2018</year><data-title>Introduction to pygel</data-title><source>PyGEL</source><ext-link ext-link-type="uri" xlink:href="http://www2.compute.dtu.dk/projects/GEL/PyGEL">http://www2.compute.dtu.dk/projects/GEL/PyGEL</ext-link></element-citation></ref><ref id="bib5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Barrón</surname><given-names>MG</given-names></name><name><surname>Paupy</surname><given-names>C</given-names></name><name><surname>Rahola</surname><given-names>N</given-names></name><name><surname>Akone-Ella</surname><given-names>O</given-names></name><name><surname>Ngangue</surname><given-names>MF</given-names></name><name><surname>Wilson-Bahun</surname><given-names>TA</given-names></name><name><surname>Pombi</surname><given-names>M</given-names></name><name><surname>Kengne</surname><given-names>P</given-names></name><name><surname>Costantini</surname><given-names>C</given-names></name><name><surname>Simard</surname><given-names>F</given-names></name><name><surname>González</surname><given-names>J</given-names></name><name><surname>Ayala</surname><given-names>D</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>A new species in the major malaria vector complex sheds light on reticulated species evolution</article-title><source>Scientific Reports</source><volume>9</volume><elocation-id>14753</elocation-id><pub-id pub-id-type="doi">10.1038/s41598-019-49065-5</pub-id></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Battey</surname><given-names>CJ</given-names></name><name><surname>Coffing</surname><given-names>GC</given-names></name><name><surname>Kern</surname><given-names>AD</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Visualizing population structure with variational autoencoders</article-title><source>G3</source><volume>11</volume><elocation-id>jkaa036</elocation-id><pub-id pub-id-type="doi">10.1093/g3journal/jkaa036</pub-id><pub-id pub-id-type="pmid">33561250</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Benson</surname><given-names>DA</given-names></name><name><surname>Cavanaugh</surname><given-names>M</given-names></name><name><surname>Clark</surname><given-names>K</given-names></name><name><surname>Karsch-Mizrachi</surname><given-names>I</given-names></name><name><surname>Ostell</surname><given-names>J</given-names></name><name><surname>Pruitt</surname><given-names>KD</given-names></name><name><surname>Sayers</surname><given-names>EW</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Genbank</article-title><source>Nucleic Acids Research</source><volume>46</volume><fpage>D41</fpage><lpage>D47</lpage><pub-id pub-id-type="doi">10.1093/nar/gkx1094</pub-id><pub-id pub-id-type="pmid">29140468</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Bianchini</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2021">2021</year><data-title>TreeViewer</data-title><source>Github</source><ext-link ext-link-type="uri" xlink:href="https://github.com/arklumpus/TreeViewer">https://github.com/arklumpus/TreeViewer</ext-link></element-citation></ref><ref id="bib9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Callahan</surname><given-names>BJ</given-names></name><name><surname>McMurdie</surname><given-names>PJ</given-names></name><name><surname>Rosen</surname><given-names>MJ</given-names></name><name><surname>Han</surname><given-names>AW</given-names></name><name><surname>Johnson</surname><given-names>AJA</given-names></name><name><surname>Holmes</surname><given-names>SP</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>DADA2: high-resolution sample inference from illumina amplicon data</article-title><source>Nature Methods</source><volume>13</volume><fpage>581</fpage><lpage>583</lpage><pub-id pub-id-type="doi">10.1038/nmeth.3869</pub-id><pub-id pub-id-type="pmid">27214047</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Caputo</surname><given-names>B</given-names></name><name><surname>Pichler</surname><given-names>V</given-names></name><name><surname>Bottà</surname><given-names>G</given-names></name><name><surname>De Marco</surname><given-names>C</given-names></name><name><surname>Hubbart</surname><given-names>C</given-names></name><name><surname>Perugini</surname><given-names>E</given-names></name><name><surname>Pinto</surname><given-names>J</given-names></name><name><surname>Rockett</surname><given-names>KA</given-names></name><name><surname>Miles</surname><given-names>A</given-names></name><name><surname>Della Torre</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Novel genotyping approaches to easily detect genomic admixture between the major Afrotropical malaria vector species, Anopheles coluzzii and an. gambiae</article-title><source>Molecular Ecology Resources</source><volume>21</volume><fpage>1504</fpage><lpage>1516</lpage><pub-id pub-id-type="doi">10.1111/1755-0998.13359</pub-id><pub-id pub-id-type="pmid">33590707</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Chollet</surname><given-names>F</given-names></name></person-group><year iso-8601-date="2015">2015</year><data-title>Keras: Deep learning for humans</data-title><source>GitHub</source><ext-link ext-link-type="uri" xlink:href="https://github.com/fchollet/keras">https://github.com/fchollet/keras</ext-link></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Clarkson</surname><given-names>CS</given-names></name><name><surname>Miles</surname><given-names>A</given-names></name><name><surname>Harding</surname><given-names>NJ</given-names></name><name><surname>Lucas</surname><given-names>ER</given-names></name><name><surname>Battey</surname><given-names>CJ</given-names></name><name><surname>Amaya-Romero</surname><given-names>JE</given-names></name><name><surname>Kern</surname><given-names>AD</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Genome variation and population structure among 1142 mosquitoes of the African malaria vector species Anopheles gambiae and Anopheles coluzzii</article-title><source>Genome Research</source><volume>30</volume><fpage>1533</fpage><lpage>1546</lpage><pub-id pub-id-type="doi">10.1101/gr.262790.120</pub-id><pub-id pub-id-type="pmid">32989001</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Coetzee</surname><given-names>M</given-names></name><name><surname>Hunt</surname><given-names>RH</given-names></name><name><surname>Wilkerson</surname><given-names>R</given-names></name><name><surname>Della Torre</surname><given-names>A</given-names></name><name><surname>Coulibaly</surname><given-names>MB</given-names></name><name><surname>Besansky</surname><given-names>NJ</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Anopheles coluzzii and Anopheles amharicus, new members of the Anopheles gambiae complex</article-title><source>Zootaxa</source><volume>3619</volume><fpage>246</fpage><lpage>274</lpage><pub-id pub-id-type="pmid">26131476</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Coetzee</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Key to the females of Afrotropical anopheles mosquitoes (diptera: culicidae)</article-title><source>Malaria Journal</source><volume>19</volume><elocation-id>70</elocation-id><pub-id pub-id-type="doi">10.1186/s12936-020-3144-9</pub-id><pub-id pub-id-type="pmid">32054502</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cohuet</surname><given-names>A</given-names></name><name><surname>Simard</surname><given-names>F</given-names></name><name><surname>Toto</surname><given-names>J-C</given-names></name><name><surname>Kengne</surname><given-names>P</given-names></name><name><surname>Coetzee</surname><given-names>M</given-names></name><name><surname>Fontenille</surname><given-names>D</given-names></name></person-group><year iso-8601-date="2003">2003</year><article-title>Species identification within the Anopheles funestus group of malaria vectors in Cameroon and evidence for a new species</article-title><source>The American Journal of Tropical Medicine and Hygiene</source><volume>69</volume><fpage>200</fpage><lpage>205</lpage><pub-id pub-id-type="pmid">13677376</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Derkarabetian</surname><given-names>S</given-names></name><name><surname>Castillo</surname><given-names>S</given-names></name><name><surname>Koo</surname><given-names>PK</given-names></name><name><surname>Ovchinnikov</surname><given-names>S</given-names></name><name><surname>Hedin</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>A demonstration of unsupervised machine learning in species delimitation</article-title><source>Molecular Phylogenetics and Evolution</source><volume>139</volume><elocation-id>106562</elocation-id><pub-id pub-id-type="doi">10.1016/j.ympev.2019.106562</pub-id><pub-id pub-id-type="pmid">31323334</pub-id></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Erlank</surname><given-names>E</given-names></name><name><surname>Koekemoer</surname><given-names>LL</given-names></name><name><surname>Coetzee</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>The importance of morphological identification of African anopheline mosquitoes (Diptera: Culicidae) for malaria control programmes</article-title><source>Malaria Journal</source><volume>17</volume><elocation-id>43</elocation-id><pub-id pub-id-type="doi">10.1186/s12936-018-2189-5</pub-id><pub-id pub-id-type="pmid">29357873</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fanello</surname><given-names>C</given-names></name><name><surname>Santolamazza</surname><given-names>F</given-names></name><name><surname>della Torre</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2002">2002</year><article-title>Simultaneous identification of species and molecular forms of the Anopheles gambiae complex by PCR-RFLP</article-title><source>Medical and Veterinary Entomology</source><volume>16</volume><fpage>461</fpage><lpage>464</lpage><pub-id pub-id-type="doi">10.1046/j.1365-2915.2002.00393.x</pub-id><pub-id pub-id-type="pmid">12510902</pub-id></element-citation></ref><ref id="bib19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Faulde</surname><given-names>MK</given-names></name><name><surname>Rueda</surname><given-names>LM</given-names></name><name><surname>Khaireh</surname><given-names>BA</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>First record of the Asian malaria vector Anopheles stephensi and its possible role in the resurgence of malaria in Djibouti, horn of Africa</article-title><source>Acta Tropica</source><volume>139</volume><fpage>39</fpage><lpage>43</lpage><pub-id pub-id-type="doi">10.1016/j.actatropica.2014.06.016</pub-id><pub-id pub-id-type="pmid">25004439</pub-id></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fontaine</surname><given-names>MC</given-names></name><name><surname>Pease</surname><given-names>JB</given-names></name><name><surname>Steele</surname><given-names>A</given-names></name><name><surname>Waterhouse</surname><given-names>RM</given-names></name><name><surname>Neafsey</surname><given-names>DE</given-names></name><name><surname>Sharakhov</surname><given-names>IV</given-names></name><name><surname>Jiang</surname><given-names>X</given-names></name><name><surname>Hall</surname><given-names>AB</given-names></name><name><surname>Catteruccia</surname><given-names>F</given-names></name><name><surname>Kakani</surname><given-names>E</given-names></name><name><surname>Mitchell</surname><given-names>SN</given-names></name><name><surname>Wu</surname><given-names>Y-C</given-names></name><name><surname>Smith</surname><given-names>HA</given-names></name><name><surname>Love</surname><given-names>RR</given-names></name><name><surname>Lawniczak</surname><given-names>MK</given-names></name><name><surname>Slotman</surname><given-names>MA</given-names></name><name><surname>Emrich</surname><given-names>SJ</given-names></name><name><surname>Hahn</surname><given-names>MW</given-names></name><name><surname>Besansky</surname><given-names>NJ</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Mosquito genomics. extensive introgression in a malaria vector species complex revealed by phylogenomics</article-title><source>Science</source><volume>347</volume><elocation-id>1258524</elocation-id><pub-id pub-id-type="doi">10.1126/science.1258524</pub-id><pub-id pub-id-type="pmid">25431491</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Gillies</surname><given-names>MT</given-names></name><name><surname>Meillon</surname><given-names>BD</given-names></name></person-group><year iso-8601-date="1968">1968</year><source>Anophelinae of Africa South of the Sahara</source><publisher-name>The South African Institute for Medical Research</publisher-name></element-citation></ref><ref id="bib22"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Gillies</surname><given-names>MT</given-names></name><name><surname>Coetzee</surname><given-names>M</given-names></name></person-group><year iso-8601-date="1987">1987</year><source>A Supplement to the Anophelinae of Africa South of the Sahara</source><publisher-name>The South African Institute for Medical Research</publisher-name></element-citation></ref><ref id="bib23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Harbach</surname><given-names>RE</given-names></name><name><surname>Kitching</surname><given-names>IJ</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>The phylogeny of anophelinae revisited: inferences about the origin and classification of Anopheles (Diptera: Culicidae)</article-title><source>Zoologica Scripta</source><volume>45</volume><fpage>34</fpage><lpage>47</lpage><pub-id pub-id-type="doi">10.1111/zsc.12137</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hathaway</surname><given-names>NJ</given-names></name><name><surname>Parobek</surname><given-names>CM</given-names></name><name><surname>Juliano</surname><given-names>JJ</given-names></name><name><surname>Bailey</surname><given-names>JA</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>SeekDeep: single-base resolution de novo clustering for amplicon deep sequencing</article-title><source>Nucleic Acids Research</source><volume>46</volume><elocation-id>e21</elocation-id><pub-id pub-id-type="doi">10.1093/nar/gkx1201</pub-id><pub-id pub-id-type="pmid">29202193</pub-id></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hunter</surname><given-names>JD</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Matplotlib: a 2D graphics environment</article-title><source>Computing in Science &amp; Engineering</source><volume>9</volume><fpage>90</fpage><lpage>95</lpage><pub-id pub-id-type="doi">10.1109/MCSE.2007.55</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Irish</surname><given-names>SR</given-names></name><name><surname>Kyalo</surname><given-names>D</given-names></name><name><surname>Snow</surname><given-names>RW</given-names></name><name><surname>Coetzee</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Updated list of Anopheles species (Diptera: Culicidae) by country in the Afrotropical region and associated islands</article-title><source>Zootaxa</source><volume>4747</volume><elocation-id>zootaxa.4747.3.1</elocation-id><pub-id pub-id-type="doi">10.11646/zootaxa.4747.3.1</pub-id><pub-id pub-id-type="pmid">32230095</pub-id></element-citation></ref><ref id="bib27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Katoh</surname><given-names>K</given-names></name><name><surname>Standley</surname><given-names>DM</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>MAFFT multiple sequence alignment software version 7: improvements in performance and usability</article-title><source>Molecular Biology and Evolution</source><volume>30</volume><fpage>772</fpage><lpage>780</lpage><pub-id pub-id-type="doi">10.1093/molbev/mst010</pub-id><pub-id pub-id-type="pmid">23329690</pub-id></element-citation></ref><ref id="bib28"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Kingma</surname><given-names>D</given-names></name><name><surname>Welling</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Auto-Encoding Variational Bayes</article-title><source>arXiv</source><ext-link ext-link-type="uri" xlink:href="http://arxiv.org/abs/1312.6114v10">http://arxiv.org/abs/1312.6114v10</ext-link></element-citation></ref><ref id="bib29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lanzaro</surname><given-names>GC</given-names></name><name><surname>Zheng</surname><given-names>L</given-names></name><name><surname>Toure</surname><given-names>YT</given-names></name><name><surname>Traore</surname><given-names>SF</given-names></name><name><surname>Kafatos</surname><given-names>FC</given-names></name><name><surname>Vernick</surname><given-names>KD</given-names></name></person-group><year iso-8601-date="1995">1995</year><article-title>Microsatellite DNA and isozyme variability in a West African population of Anopheles gambiae</article-title><source>Insect Molecular Biology</source><volume>4</volume><fpage>105</fpage><lpage>112</lpage><pub-id pub-id-type="doi">10.1111/j.1365-2583.1995.tb00014.x</pub-id><pub-id pub-id-type="pmid">7551192</pub-id></element-citation></ref><ref id="bib30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lefort</surname><given-names>V</given-names></name><name><surname>Desper</surname><given-names>R</given-names></name><name><surname>Gascuel</surname><given-names>O</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>FastME 2.0: a comprehensive, accurate, and fast distance-based phylogeny inference program</article-title><source>Molecular Biology and Evolution</source><volume>32</volume><fpage>2798</fpage><lpage>2800</lpage><pub-id pub-id-type="doi">10.1093/molbev/msv150</pub-id><pub-id pub-id-type="pmid">26130081</pub-id></element-citation></ref><ref id="bib31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>H</given-names></name><name><surname>Handsaker</surname><given-names>B</given-names></name><name><surname>Wysoker</surname><given-names>A</given-names></name><name><surname>Fennell</surname><given-names>T</given-names></name><name><surname>Ruan</surname><given-names>J</given-names></name><name><surname>Homer</surname><given-names>N</given-names></name><name><surname>Marth</surname><given-names>G</given-names></name><name><surname>Abecasis</surname><given-names>G</given-names></name><name><surname>Durbin</surname><given-names>R</given-names></name><collab>1000 Genome Project Data Processing Subgroup</collab></person-group><year iso-8601-date="2009">2009</year><article-title>The sequence alignment/map format and samtools</article-title><source>Bioinformatics</source><volume>25</volume><fpage>2078</fpage><lpage>2079</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btp352</pub-id><pub-id pub-id-type="pmid">19505943</pub-id></element-citation></ref><ref id="bib32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>H</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>FermiKit: assembly-based variant calling for illumina resequencing data</article-title><source>Bioinformatics</source><volume>31</volume><fpage>3694</fpage><lpage>3696</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btv440</pub-id><pub-id pub-id-type="pmid">26220959</pub-id></element-citation></ref><ref id="bib33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Makunin</surname><given-names>A</given-names></name><name><surname>Korlević</surname><given-names>P</given-names></name><name><surname>Park</surname><given-names>N</given-names></name><name><surname>Goodwin</surname><given-names>S</given-names></name><name><surname>Waterhouse</surname><given-names>RM</given-names></name><name><surname>von Wyschetzki</surname><given-names>K</given-names></name><name><surname>Jacob</surname><given-names>CG</given-names></name><name><surname>Davies</surname><given-names>R</given-names></name><name><surname>Kwiatkowski</surname><given-names>D</given-names></name><name><surname>St Laurent</surname><given-names>B</given-names></name><name><surname>Ayala</surname><given-names>D</given-names></name><name><surname>Lawniczak</surname><given-names>MKN</given-names></name></person-group><year iso-8601-date="2022">2022</year><article-title>A targeted amplicon sequencing panel to simultaneously identify mosquito species and Plasmodium presence across the entire Anopheles genus</article-title><source>Molecular Ecology Resources</source><volume>22</volume><fpage>28</fpage><lpage>44</lpage><pub-id pub-id-type="doi">10.1111/1755-0998.13436</pub-id><pub-id pub-id-type="pmid">34053186</pub-id></element-citation></ref><ref id="bib34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Marinotti</surname><given-names>O</given-names></name><name><surname>Cerqueira</surname><given-names>GC</given-names></name><name><surname>de Almeida</surname><given-names>LGP</given-names></name><name><surname>Ferro</surname><given-names>MIT</given-names></name><name><surname>Loreto</surname><given-names>EL</given-names></name><name><surname>Zaha</surname><given-names>A</given-names></name><name><surname>Teixeira</surname><given-names>SMR</given-names></name><name><surname>Wespiser</surname><given-names>AR</given-names></name><name><surname>Almeida E Silva</surname><given-names>A</given-names></name><name><surname>Schlindwein</surname><given-names>AD</given-names></name><name><surname>Pacheco</surname><given-names>ACL</given-names></name><name><surname>Silva</surname><given-names>AL</given-names></name><name><surname>Graveley</surname><given-names>BR</given-names></name><name><surname>Walenz</surname><given-names>BP</given-names></name><name><surname>Lima</surname><given-names>B</given-names></name><name><surname>Ribeiro</surname><given-names>CAG</given-names></name><name><surname>Nunes-Silva</surname><given-names>CG</given-names></name><name><surname>de Carvalho</surname><given-names>CR</given-names></name><name><surname>Soares</surname><given-names>CM</given-names></name><name><surname>de Menezes</surname><given-names>CBA</given-names></name><name><surname>Matiolli</surname><given-names>C</given-names></name><name><surname>Caffrey</surname><given-names>D</given-names></name><name><surname>Araújo</surname><given-names>DAM</given-names></name><name><surname>de Oliveira</surname><given-names>DM</given-names></name><name><surname>Golenbock</surname><given-names>D</given-names></name><name><surname>Grisard</surname><given-names>EC</given-names></name><name><surname>Fantinatti-Garboggini</surname><given-names>F</given-names></name><name><surname>de Carvalho</surname><given-names>FM</given-names></name><name><surname>Barcellos</surname><given-names>FG</given-names></name><name><surname>Prosdocimi</surname><given-names>F</given-names></name><name><surname>May</surname><given-names>G</given-names></name><name><surname>Azevedo Junior</surname><given-names>GM</given-names></name><name><surname>Guimarães</surname><given-names>GM</given-names></name><name><surname>Goldman</surname><given-names>GH</given-names></name><name><surname>Padilha</surname><given-names>IQM</given-names></name><name><surname>Batista</surname><given-names>J</given-names></name><name><surname>Ferro</surname><given-names>JA</given-names></name><name><surname>Ribeiro</surname><given-names>JMC</given-names></name><name><surname>Fietto</surname><given-names>JLR</given-names></name><name><surname>Dabbas</surname><given-names>KM</given-names></name><name><surname>Cerdeira</surname><given-names>L</given-names></name><name><surname>Agnez-Lima</surname><given-names>LF</given-names></name><name><surname>Brocchi</surname><given-names>M</given-names></name><name><surname>de Carvalho</surname><given-names>MO</given-names></name><name><surname>Teixeira</surname><given-names>M</given-names></name><name><surname>Diniz Maia</surname><given-names>M</given-names></name><name><surname>Goldman</surname><given-names>M</given-names></name><name><surname>Cruz Schneider</surname><given-names>MP</given-names></name><name><surname>Felipe</surname><given-names>MSS</given-names></name><name><surname>Hungria</surname><given-names>M</given-names></name><name><surname>Nicolás</surname><given-names>MF</given-names></name><name><surname>Pereira</surname><given-names>M</given-names></name><name><surname>Montes</surname><given-names>MA</given-names></name><name><surname>Cantão</surname><given-names>ME</given-names></name><name><surname>Vincentz</surname><given-names>M</given-names></name><name><surname>Rafael</surname><given-names>MS</given-names></name><name><surname>Silverman</surname><given-names>N</given-names></name><name><surname>Stoco</surname><given-names>PH</given-names></name><name><surname>Souza</surname><given-names>RC</given-names></name><name><surname>Vicentini</surname><given-names>R</given-names></name><name><surname>Gazzinelli</surname><given-names>RT</given-names></name><name><surname>Neves</surname><given-names>R</given-names></name><name><surname>Silva</surname><given-names>R</given-names></name><name><surname>Astolfi-Filho</surname><given-names>S</given-names></name><name><surname>Maciel</surname><given-names>TEF</given-names></name><name><surname>Urményi</surname><given-names>TP</given-names></name><name><surname>Tadei</surname><given-names>WP</given-names></name><name><surname>Camargo</surname><given-names>EP</given-names></name><name><surname>de Vasconcelos</surname><given-names>ATR</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>The genome of anopheles darlingi, the main neotropical malaria vector</article-title><source>Nucleic Acids Research</source><volume>41</volume><fpage>7387</fpage><lpage>7400</lpage><pub-id pub-id-type="doi">10.1093/nar/gkt484</pub-id><pub-id pub-id-type="pmid">23761445</pub-id></element-citation></ref><ref id="bib35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Martin</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Cutadapt removes adapter sequences from high-throughput sequencing reads</article-title><source>EMBnet.Journal</source><volume>17</volume><elocation-id>10</elocation-id><pub-id pub-id-type="doi">10.14806/ej.17.1.200</pub-id></element-citation></ref><ref id="bib36"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>McInnes</surname><given-names>L</given-names></name><name><surname>Healy</surname><given-names>J</given-names></name><name><surname>Melville</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>UMAP: Uniform Manifold Approximation and Projection for Dimension Reduction</article-title><source>arXiv</source><ext-link ext-link-type="uri" xlink:href="http://arxiv.org/abs/1802.03426">http://arxiv.org/abs/1802.03426</ext-link></element-citation></ref><ref id="bib37"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mölder</surname><given-names>F</given-names></name><name><surname>Jablonski</surname><given-names>KP</given-names></name><name><surname>Letcher</surname><given-names>B</given-names></name><name><surname>Hall</surname><given-names>MB</given-names></name><name><surname>Tomkins-Tinch</surname><given-names>CH</given-names></name><name><surname>Sochat</surname><given-names>V</given-names></name><name><surname>Forster</surname><given-names>J</given-names></name><name><surname>Lee</surname><given-names>S</given-names></name><name><surname>Twardziok</surname><given-names>SO</given-names></name><name><surname>Kanitz</surname><given-names>A</given-names></name><name><surname>Wilm</surname><given-names>A</given-names></name><name><surname>Holtgrewe</surname><given-names>M</given-names></name><name><surname>Rahmann</surname><given-names>S</given-names></name><name><surname>Nahnsen</surname><given-names>S</given-names></name><name><surname>Köster</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Sustainable data analysis with snakemake</article-title><source>F1000Research</source><volume>10</volume><elocation-id>33</elocation-id><pub-id pub-id-type="doi">10.12688/f1000research.29032.2</pub-id><pub-id pub-id-type="pmid">34035898</pub-id></element-citation></ref><ref id="bib38"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nabet</surname><given-names>C</given-names></name><name><surname>Kone</surname><given-names>AK</given-names></name><name><surname>Dia</surname><given-names>AK</given-names></name><name><surname>Sylla</surname><given-names>M</given-names></name><name><surname>Gautier</surname><given-names>M</given-names></name><name><surname>Yattara</surname><given-names>M</given-names></name><name><surname>Thera</surname><given-names>MA</given-names></name><name><surname>Faye</surname><given-names>O</given-names></name><name><surname>Braack</surname><given-names>L</given-names></name><name><surname>Manguin</surname><given-names>S</given-names></name><name><surname>Beavogui</surname><given-names>AH</given-names></name><name><surname>Doumbo</surname><given-names>O</given-names></name><name><surname>Gay</surname><given-names>F</given-names></name><name><surname>Piarroux</surname><given-names>R</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>New assessment of anopheles vector species identification using MALDI-TOF MS</article-title><source>Malaria Journal</source><volume>20</volume><elocation-id>33</elocation-id><pub-id pub-id-type="doi">10.1186/s12936-020-03557-2</pub-id><pub-id pub-id-type="pmid">33422056</pub-id></element-citation></ref><ref id="bib39"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Neafsey</surname><given-names>DE</given-names></name><name><surname>Waterhouse</surname><given-names>RM</given-names></name><name><surname>Abai</surname><given-names>MR</given-names></name><name><surname>Aganezov</surname><given-names>SS</given-names></name><name><surname>Alekseyev</surname><given-names>MA</given-names></name><name><surname>Allen</surname><given-names>JE</given-names></name><name><surname>Amon</surname><given-names>J</given-names></name><name><surname>Arcà</surname><given-names>B</given-names></name><name><surname>Arensburger</surname><given-names>P</given-names></name><name><surname>Artemov</surname><given-names>G</given-names></name><name><surname>Assour</surname><given-names>LA</given-names></name><name><surname>Basseri</surname><given-names>H</given-names></name><name><surname>Berlin</surname><given-names>A</given-names></name><name><surname>Birren</surname><given-names>BW</given-names></name><name><surname>Blandin</surname><given-names>SA</given-names></name><name><surname>Brockman</surname><given-names>AI</given-names></name><name><surname>Burkot</surname><given-names>TR</given-names></name><name><surname>Burt</surname><given-names>A</given-names></name><name><surname>Chan</surname><given-names>CS</given-names></name><name><surname>Chauve</surname><given-names>C</given-names></name><name><surname>Chiu</surname><given-names>JC</given-names></name><name><surname>Christensen</surname><given-names>M</given-names></name><name><surname>Costantini</surname><given-names>C</given-names></name><name><surname>Davidson</surname><given-names>VLM</given-names></name><name><surname>Deligianni</surname><given-names>E</given-names></name><name><surname>Dottorini</surname><given-names>T</given-names></name><name><surname>Dritsou</surname><given-names>V</given-names></name><name><surname>Gabriel</surname><given-names>SB</given-names></name><name><surname>Guelbeogo</surname><given-names>WM</given-names></name><name><surname>Hall</surname><given-names>AB</given-names></name><name><surname>Han</surname><given-names>MV</given-names></name><name><surname>Hlaing</surname><given-names>T</given-names></name><name><surname>Hughes</surname><given-names>DST</given-names></name><name><surname>Jenkins</surname><given-names>AM</given-names></name><name><surname>Jiang</surname><given-names>X</given-names></name><name><surname>Jungreis</surname><given-names>I</given-names></name><name><surname>Kakani</surname><given-names>EG</given-names></name><name><surname>Kamali</surname><given-names>M</given-names></name><name><surname>Kemppainen</surname><given-names>P</given-names></name><name><surname>Kennedy</surname><given-names>RC</given-names></name><name><surname>Kirmitzoglou</surname><given-names>IK</given-names></name><name><surname>Koekemoer</surname><given-names>LL</given-names></name><name><surname>Laban</surname><given-names>N</given-names></name><name><surname>Langridge</surname><given-names>N</given-names></name><name><surname>Lawniczak</surname><given-names>MKN</given-names></name><name><surname>Lirakis</surname><given-names>M</given-names></name><name><surname>Lobo</surname><given-names>NF</given-names></name><name><surname>Lowy</surname><given-names>E</given-names></name><name><surname>MacCallum</surname><given-names>RM</given-names></name><name><surname>Mao</surname><given-names>C</given-names></name><name><surname>Maslen</surname><given-names>G</given-names></name><name><surname>Mbogo</surname><given-names>C</given-names></name><name><surname>McCarthy</surname><given-names>J</given-names></name><name><surname>Michel</surname><given-names>K</given-names></name><name><surname>Mitchell</surname><given-names>SN</given-names></name><name><surname>Moore</surname><given-names>W</given-names></name><name><surname>Murphy</surname><given-names>KA</given-names></name><name><surname>Naumenko</surname><given-names>AN</given-names></name><name><surname>Nolan</surname><given-names>T</given-names></name><name><surname>Novoa</surname><given-names>EM</given-names></name><name><surname>O’Loughlin</surname><given-names>S</given-names></name><name><surname>Oringanje</surname><given-names>C</given-names></name><name><surname>Oshaghi</surname><given-names>MA</given-names></name><name><surname>Pakpour</surname><given-names>N</given-names></name><name><surname>Papathanos</surname><given-names>PA</given-names></name><name><surname>Peery</surname><given-names>AN</given-names></name><name><surname>Povelones</surname><given-names>M</given-names></name><name><surname>Prakash</surname><given-names>A</given-names></name><name><surname>Price</surname><given-names>DP</given-names></name><name><surname>Rajaraman</surname><given-names>A</given-names></name><name><surname>Reimer</surname><given-names>LJ</given-names></name><name><surname>Rinker</surname><given-names>DC</given-names></name><name><surname>Rokas</surname><given-names>A</given-names></name><name><surname>Russell</surname><given-names>TL</given-names></name><name><surname>Sagnon</surname><given-names>N</given-names></name><name><surname>Sharakhova</surname><given-names>MV</given-names></name><name><surname>Shea</surname><given-names>T</given-names></name><name><surname>Simão</surname><given-names>FA</given-names></name><name><surname>Simard</surname><given-names>F</given-names></name><name><surname>Slotman</surname><given-names>MA</given-names></name><name><surname>Somboon</surname><given-names>P</given-names></name><name><surname>Stegniy</surname><given-names>V</given-names></name><name><surname>Struchiner</surname><given-names>CJ</given-names></name><name><surname>Thomas</surname><given-names>GWC</given-names></name><name><surname>Tojo</surname><given-names>M</given-names></name><name><surname>Topalis</surname><given-names>P</given-names></name><name><surname>Tubio</surname><given-names>JMC</given-names></name><name><surname>Unger</surname><given-names>MF</given-names></name><name><surname>Vontas</surname><given-names>J</given-names></name><name><surname>Walton</surname><given-names>C</given-names></name><name><surname>Wilding</surname><given-names>CS</given-names></name><name><surname>Willis</surname><given-names>JH</given-names></name><name><surname>Wu</surname><given-names>Y-C</given-names></name><name><surname>Yan</surname><given-names>G</given-names></name><name><surname>Zdobnov</surname><given-names>EM</given-names></name><name><surname>Zhou</surname><given-names>X</given-names></name><name><surname>Catteruccia</surname><given-names>F</given-names></name><name><surname>Christophides</surname><given-names>GK</given-names></name><name><surname>Collins</surname><given-names>FH</given-names></name><name><surname>Cornman</surname><given-names>RS</given-names></name><name><surname>Crisanti</surname><given-names>A</given-names></name><name><surname>Donnelly</surname><given-names>MJ</given-names></name><name><surname>Emrich</surname><given-names>SJ</given-names></name><name><surname>Fontaine</surname><given-names>MC</given-names></name><name><surname>Gelbart</surname><given-names>W</given-names></name><name><surname>Hahn</surname><given-names>MW</given-names></name><name><surname>Hansen</surname><given-names>IA</given-names></name><name><surname>Howell</surname><given-names>PI</given-names></name><name><surname>Kafatos</surname><given-names>FC</given-names></name><name><surname>Kellis</surname><given-names>M</given-names></name><name><surname>Lawson</surname><given-names>D</given-names></name><name><surname>Louis</surname><given-names>C</given-names></name><name><surname>Luckhart</surname><given-names>S</given-names></name><name><surname>Muskavitch</surname><given-names>MAT</given-names></name><name><surname>Ribeiro</surname><given-names>JM</given-names></name><name><surname>Riehle</surname><given-names>MA</given-names></name><name><surname>Sharakhov</surname><given-names>IV</given-names></name><name><surname>Tu</surname><given-names>Z</given-names></name><name><surname>Zwiebel</surname><given-names>LJ</given-names></name><name><surname>Besansky</surname><given-names>NJ</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Mosquito genomics. highly evolvable malaria vectors: the genomes of 16 anopheles mosquitoes</article-title><source>Science</source><volume>347</volume><elocation-id>1258522</elocation-id><pub-id pub-id-type="doi">10.1126/science.1258522</pub-id><pub-id pub-id-type="pmid">25554792</pub-id></element-citation></ref><ref id="bib40"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Okumu</surname><given-names>F</given-names></name><name><surname>Finda</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Key characteristics of residual malaria transmission in two districts in south-eastern tanzania-implications for improved control</article-title><source>The Journal of Infectious Diseases</source><volume>223</volume><fpage>S143</fpage><lpage>S154</lpage><pub-id pub-id-type="doi">10.1093/infdis/jiaa653</pub-id><pub-id pub-id-type="pmid">33906218</pub-id></element-citation></ref><ref id="bib41"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ratnasingham</surname><given-names>S</given-names></name><name><surname>Hebert</surname><given-names>PDN</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Bold: the barcode of life data system</article-title><source>Molecular Ecology Notes</source><volume>7</volume><fpage>355</fpage><lpage>364</lpage><pub-id pub-id-type="doi">10.1111/j.1471-8286.2007.01678.x</pub-id><pub-id pub-id-type="pmid">18784790</pub-id></element-citation></ref><ref id="bib42"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rattanarithikul</surname><given-names>R</given-names></name><name><surname>Panthusiri</surname><given-names>P</given-names></name></person-group><year iso-8601-date="1994">1994</year><article-title>Illustrated keys to the medically important mosquitos of thailand</article-title><source>The Southeast Asian Journal of Tropical Medicine and Public Health</source><volume>25</volume><fpage>1</fpage><lpage>66</lpage><pub-id pub-id-type="pmid">7831585</pub-id></element-citation></ref><ref id="bib43"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rongnoparut</surname><given-names>P</given-names></name><name><surname>Yaicharoen</surname><given-names>S</given-names></name><name><surname>Sirichotpakorn</surname><given-names>N</given-names></name><name><surname>Rattanarithikul</surname><given-names>R</given-names></name><name><surname>Lanzaro</surname><given-names>GC</given-names></name><name><surname>Linthicum</surname><given-names>KJ</given-names></name></person-group><year iso-8601-date="1996">1996</year><article-title>Microsatellite polymorphism in Anopheles maculatus, a malaria vector in Thailand</article-title><source>The American Journal of Tropical Medicine and Hygiene</source><volume>55</volume><fpage>589</fpage><lpage>594</lpage><pub-id pub-id-type="doi">10.4269/ajtmh.1996.55.589</pub-id><pub-id pub-id-type="pmid">9025683</pub-id></element-citation></ref><ref id="bib44"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Santolamazza</surname><given-names>F</given-names></name><name><surname>Mancini</surname><given-names>E</given-names></name><name><surname>Simard</surname><given-names>F</given-names></name><name><surname>Qi</surname><given-names>Y</given-names></name><name><surname>Tu</surname><given-names>Z</given-names></name><name><surname>della Torre</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Insertion polymorphisms of SINE200 retrotransposons within speciation islands of Anopheles gambiae molecular forms</article-title><source>Malaria Journal</source><volume>7</volume><elocation-id>163</elocation-id><pub-id pub-id-type="doi">10.1186/1475-2875-7-163</pub-id><pub-id pub-id-type="pmid">18724871</pub-id></element-citation></ref><ref id="bib45"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Scott</surname><given-names>JA</given-names></name><name><surname>Brogdon</surname><given-names>WG</given-names></name><name><surname>Collins</surname><given-names>FH</given-names></name></person-group><year iso-8601-date="1993">1993</year><article-title>Identification of single specimens of the Anopheles gambiae complex by the polymerase chain reaction</article-title><source>The American Journal of Tropical Medicine and Hygiene</source><volume>49</volume><fpage>520</fpage><lpage>529</lpage><pub-id pub-id-type="doi">10.4269/ajtmh.1993.49.520</pub-id><pub-id pub-id-type="pmid">8214283</pub-id></element-citation></ref><ref id="bib46"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Seyfarth</surname><given-names>M</given-names></name><name><surname>Khaireh</surname><given-names>BA</given-names></name><name><surname>Abdi</surname><given-names>AA</given-names></name><name><surname>Bouh</surname><given-names>SM</given-names></name><name><surname>Faulde</surname><given-names>MK</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Five years following first detection of Anopheles stephensi (Diptera: Culicidae) in Djibouti, horn of Africa: populations established-malaria emerging</article-title><source>Parasitology Research</source><volume>118</volume><fpage>725</fpage><lpage>732</lpage><pub-id pub-id-type="doi">10.1007/s00436-019-06213-0</pub-id><pub-id pub-id-type="pmid">30671729</pub-id></element-citation></ref><ref id="bib47"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sharakhova</surname><given-names>MV</given-names></name><name><surname>Peery</surname><given-names>A</given-names></name><name><surname>Antonio-Nkondjio</surname><given-names>C</given-names></name><name><surname>Xia</surname><given-names>A</given-names></name><name><surname>Ndo</surname><given-names>C</given-names></name><name><surname>Awono-Ambene</surname><given-names>P</given-names></name><name><surname>Simard</surname><given-names>F</given-names></name><name><surname>Sharakhov</surname><given-names>IV</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Cytogenetic analysis of anopheles ovengensis revealed high structural divergence of chromosomes in the anopheles nili group</article-title><source>Infection, Genetics and Evolution</source><volume>16</volume><fpage>341</fpage><lpage>348</lpage><pub-id pub-id-type="doi">10.1016/j.meegid.2013.03.010</pub-id><pub-id pub-id-type="pmid">23523820</pub-id></element-citation></ref><ref id="bib48"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tennessen</surname><given-names>JA</given-names></name><name><surname>Ingham</surname><given-names>VA</given-names></name><name><surname>Toé</surname><given-names>KH</given-names></name><name><surname>Guelbéogo</surname><given-names>WM</given-names></name><name><surname>Sagnon</surname><given-names>N</given-names></name><name><surname>Kuzma</surname><given-names>R</given-names></name><name><surname>Ranson</surname><given-names>H</given-names></name><name><surname>Neafsey</surname><given-names>DE</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>A population genomic unveiling of a new cryptic mosquito taxon within the malaria-transmitting Anopheles gambiae complex</article-title><source>Molecular Ecology</source><volume>30</volume><fpage>775</fpage><lpage>790</lpage><pub-id pub-id-type="doi">10.1111/mec.15756</pub-id><pub-id pub-id-type="pmid">33253481</pub-id></element-citation></ref><ref id="bib49"><element-citation publication-type="software"><person-group person-group-type="author"><collab>The Anopheles gambiae 1000 Genomes Consortium</collab></person-group><year iso-8601-date="2021">2021</year><data-title>Ag1000G phase 3 SNP data release</data-title><source>MalariaGEN</source><ext-link ext-link-type="uri" xlink:href="https://www.malariagen.net/data/ag1000g-phase3-snp">https://www.malariagen.net/data/ag1000g-phase3-snp</ext-link></element-citation></ref><ref id="bib50"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>van der Maaten</surname><given-names>L</given-names></name><name><surname>Hinton</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2008">2008</year><data-title>Visualizing data using T-SNE</data-title><source>Journal of Machine Learning Research: JMLR</source><ext-link ext-link-type="uri" xlink:href="https://www.jmlr.org/papers/volume9/vandermaaten08a/vandermaaten08a.pdf?fbcl">https://www.jmlr.org/papers/volume9/vandermaaten08a/vandermaaten08a.pdf?fbcl</ext-link></element-citation></ref><ref id="bib51"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Van Rossum</surname><given-names>G</given-names></name><name><surname>Drake</surname><given-names>FL</given-names></name></person-group><year iso-8601-date="2009">2009</year><source>Python 3 Reference Manual Createspace</source><publisher-name>CreateSpace</publisher-name></element-citation></ref><ref id="bib52"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Virtanen</surname><given-names>P</given-names></name><name><surname>Gommers</surname><given-names>R</given-names></name><name><surname>Oliphant</surname><given-names>TE</given-names></name><name><surname>Haberland</surname><given-names>M</given-names></name><name><surname>Reddy</surname><given-names>T</given-names></name><name><surname>Cournapeau</surname><given-names>D</given-names></name><name><surname>Burovski</surname><given-names>E</given-names></name><name><surname>Peterson</surname><given-names>P</given-names></name><name><surname>Weckesser</surname><given-names>W</given-names></name><name><surname>Bright</surname><given-names>J</given-names></name><name><surname>van der Walt</surname><given-names>SJ</given-names></name><name><surname>Brett</surname><given-names>M</given-names></name><name><surname>Wilson</surname><given-names>J</given-names></name><name><surname>Millman</surname><given-names>KJ</given-names></name><name><surname>Mayorov</surname><given-names>N</given-names></name><name><surname>Nelson</surname><given-names>ARJ</given-names></name><name><surname>Jones</surname><given-names>E</given-names></name><name><surname>Kern</surname><given-names>R</given-names></name><name><surname>Larson</surname><given-names>E</given-names></name><name><surname>Carey</surname><given-names>CJ</given-names></name><name><surname>Polat</surname><given-names>İ</given-names></name><name><surname>Feng</surname><given-names>Y</given-names></name><name><surname>Moore</surname><given-names>EW</given-names></name><name><surname>VanderPlas</surname><given-names>J</given-names></name><name><surname>Laxalde</surname><given-names>D</given-names></name><name><surname>Perktold</surname><given-names>J</given-names></name><name><surname>Cimrman</surname><given-names>R</given-names></name><name><surname>Henriksen</surname><given-names>I</given-names></name><name><surname>Quintero</surname><given-names>EA</given-names></name><name><surname>Harris</surname><given-names>CR</given-names></name><name><surname>Archibald</surname><given-names>AM</given-names></name><name><surname>Ribeiro</surname><given-names>AH</given-names></name><name><surname>Pedregosa</surname><given-names>F</given-names></name><name><surname>van Mulbregt</surname><given-names>P</given-names></name><collab>SciPy 1.0 Contributors</collab></person-group><year iso-8601-date="2020">2020</year><article-title>SciPy 1.0: fundamental algorithms for scientific computing in python</article-title><source>Nature Methods</source><volume>17</volume><fpage>261</fpage><lpage>272</lpage><pub-id pub-id-type="doi">10.1038/s41592-019-0686-2</pub-id><pub-id pub-id-type="pmid">32015543</pub-id></element-citation></ref><ref id="bib53"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang-Sattler</surname><given-names>R</given-names></name><name><surname>Blandin</surname><given-names>S</given-names></name><name><surname>Ning</surname><given-names>Y</given-names></name><name><surname>Blass</surname><given-names>C</given-names></name><name><surname>Dolo</surname><given-names>G</given-names></name><name><surname>Touré</surname><given-names>YT</given-names></name><name><surname>delle Torre</surname><given-names>A</given-names></name><name><surname>Lanzaro</surname><given-names>GC</given-names></name><name><surname>Steinmetz</surname><given-names>LM</given-names></name><name><surname>Kafatos</surname><given-names>FC</given-names></name><name><surname>Zheng</surname><given-names>L</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Mosaic genome architecture of the Anopheles gambiae species complex</article-title><source>PLOS ONE</source><volume>2</volume><elocation-id>e1249</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0001249</pub-id><pub-id pub-id-type="pmid">18043756</pub-id></element-citation></ref><ref id="bib54"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Waskom</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Seaborn: statistical data visualization</article-title><source>Journal of Open Source Software</source><volume>6</volume><elocation-id>3021</elocation-id><pub-id pub-id-type="doi">10.21105/joss.03021</pub-id></element-citation></ref><ref id="bib55"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>White</surname><given-names>BJ</given-names></name><name><surname>Collins</surname><given-names>FH</given-names></name><name><surname>Besansky</surname><given-names>NJ</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Evolution of anopheles gambiae in relation to humans and malaria</article-title><source>Annual Review of Ecology, Evolution, and Systematics</source><volume>42</volume><fpage>111</fpage><lpage>132</lpage><pub-id pub-id-type="doi">10.1146/annurev-ecolsys-102710-145028</pub-id><pub-id pub-id-type="pmid">21494925</pub-id></element-citation></ref><ref id="bib56"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wiebe</surname><given-names>A</given-names></name><name><surname>Longbottom</surname><given-names>J</given-names></name><name><surname>Gleave</surname><given-names>K</given-names></name><name><surname>Shearer</surname><given-names>FM</given-names></name><name><surname>Sinka</surname><given-names>ME</given-names></name><name><surname>Massey</surname><given-names>NC</given-names></name><name><surname>Cameron</surname><given-names>E</given-names></name><name><surname>Bhatt</surname><given-names>S</given-names></name><name><surname>Gething</surname><given-names>PW</given-names></name><name><surname>Hemingway</surname><given-names>J</given-names></name><name><surname>Smith</surname><given-names>DL</given-names></name><name><surname>Coleman</surname><given-names>M</given-names></name><name><surname>Moyes</surname><given-names>CL</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Geographical distributions of African malaria vector sibling species and evidence for insecticide resistance</article-title><source>Malaria Journal</source><volume>16</volume><elocation-id>85</elocation-id><pub-id pub-id-type="doi">10.1186/s12936-017-1734-y</pub-id><pub-id pub-id-type="pmid">28219387</pub-id></element-citation></ref><ref id="bib57"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wilkins</surname><given-names>EE</given-names></name><name><surname>Howell</surname><given-names>PI</given-names></name><name><surname>Benedict</surname><given-names>MQ</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Imp PCR primers detect single nucleotide polymorphisms for Anopheles gambiae species identification, mopti and savanna rDNA types, and resistance to dieldrin in Anopheles arabiensis</article-title><source>Malaria Journal</source><volume>5</volume><elocation-id>125</elocation-id><pub-id pub-id-type="doi">10.1186/1475-2875-5-125</pub-id><pub-id pub-id-type="pmid">17177993</pub-id></element-citation></ref></ref-list><app-group><app id="appendix-1"><title>Appendix 1</title><sec sec-type="appendix" id="s8"><title>Species labels</title><p>The wild-caught mosquitoes in the reference database were labelled either morphologically or confirmed with species diagnostic PCR. Species identities were further determined by Sanger sequencing the molecular barcodes Cytochrome <italic>c</italic> oxidase I (COI) and Internal transcribed spacer 2 (ITS2). Both markers were compared to the NCBI database to assess species identity, and COI was also compared to the BOLD database. (See <xref ref-type="bibr" rid="bib33">Makunin et al., 2022</xref> for more information).</p><p>Some partner labels were revised when distances between the samples in the reference dataset suggested mislabelling. Preferably the relabelling was further supported by molecular barcodes. Relabelled samples are:</p><list list-type="bullet"><list-item><p>Amar-5: <italic>An. marshallii</italic> → <italic>An. gambiae</italic>. The average distance to samples in the <italic>An. marshallii</italic> complex is 0.54 (0.52–0.58), while the average distance to samples in <italic>An. gambiae/coluzzii</italic> is 0.09 (0.07–0.13). Additionally, both COI and ITS2 have <italic>An. gambiae</italic> as best hit.</p></list-item><list-item><p>Amar-42: <italic>An. marshallii</italic> → <italic>An. jebudensis</italic>. The average distance to samples in the <italic>An. marshallii</italic> complex is 0.38 (0.35–0.42), while the distance to <italic>An. jebudensis</italic> is 0.05. Unfortunately, neither <italic>An. marshallii</italic> nor <italic>An. jebudensis</italic> is present in the barcode databases.</p></list-item><list-item><p>Amar-3–1: <italic>An. marshallii → An_marshallii_cp_sp1</italic>. It has the lowest distances to samples of <italic>An. hancocki, An. brohieri, An. demeilloni, An. theileri</italic>, on average 0.26 (0.22–0.29), while the distances of <italic>An. hancocki, An. brohieri</italic> and <italic>An. demeilloni</italic> samples to each other is on average 0.03 (0.02–0.04) and the distances of the <italic>An. theileri</italic> samples is 0.07 (0.05–0.08). The average distance between the group containing <italic>An. hancocki, An. brohieri</italic> and <italic>An. demeilloni</italic> and the <italic>An. theileri</italic> is 0.29 (0.25–0.33). So it seems like <italic>Amar-3–1</italic> does not belong to either of these two groups, but it is as related to these groups as they are to each other. Unfortunately it does not have any informative matches on the molecular barcodes. Therefore this sample is labelled as an unnamed species in the <italic>An. marshallii</italic> complex.</p></list-item><list-item><p>Adem-15: <italic>An. demeilloni → Myzomyia_sp1</italic>. Its lowest distance to another sample in the database is 0.39, to an <italic>An. funestus</italic>. This is a much higher distance than a sample usually has to other samples of the same or of a closely related species. In particular, the distance of <italic>An. hancocki, An. brohieri</italic> and <italic>An. demeilloni</italic> samples to each other is 0.03 (0.02–0.04), while the average distance of Adem-15 to these samples is 0.41 (0.39–0.44). As it does not show similarity to any of the samples in the database, but it is closer to almost all samples in the <italic>Myzomyia</italic> series than to almost all samples outside the <italic>Myzomyia</italic> series, it is labelled as an unnamed species in the <italic>Myzomyia</italic> series.</p></list-item><list-item><p>Acol-645: <italic>An. coluzzii</italic> → <italic>An_gambiae_cp_sp1</italic>. This sample is different from other <italic>An. coluzzii</italic> and <italic>An. gambiae</italic>, this was found both in the sample-pair differences and in the subsequent VAE method which is tailored at the <italic>An. gambiae</italic> complex. The molecular barcodes also suggest that this sample is not <italic>An. coluzzii</italic> or <italic>An. gambiae</italic>, but that it is a member of the complex. Therefore, it is labelled as an unnamed species in the <italic>An. gambiae</italic> complex.</p></list-item><list-item><p>Apal-257: <italic>An. paludis</italic> → <italic>An_coustani_cp_cl3</italic>. Its smallest distances are to samples of <italic>An. tenebrosus, An. ziemanni, An. coustani</italic> and <italic>An. paludis</italic>, on average 0.29 (0.28–0.32). We found that the samples of these species split into two clades and the distance of Apal-257 to either of these clades was much higher than the distances between samples in the same clade. Additionally, the average distances between the two clades is 0.18 (0.14–0.21), so Apal-257 is also further away from the two clades than they are from each other. Yet, it is closer to these two clades than it is to <italic>An. sinensis</italic> and <italic>An. hyrcanus</italic>, which are the next closest species. Regarding the molecular barcodes, Apal-257 matches to <italic>An. coustani</italic> on COI, like most samples in the <italic>An. coustani</italic> complex. On ITS2 it matches to <italic>An. junlianensis</italic> and <italic>An. yatsushiroensis</italic>, species in the hyrcanus group. We therefore decided to relabel it to a third clade in the <italic>An. coustani</italic> group.</p></list-item><list-item><p><italic>An. nili</italic> samples. Anils-7: <italic>An. nili s.s</italic>. → <italic>An_nili_gp_sp1</italic>. Anil-237 &amp; Anil-239: <italic>An. nili → An_nili_gp_sp2</italic>. Anil-233, Anil-236 &amp; Anil-238: <italic>An. nili</italic> → <italic>An_nili_gp_sp3</italic>. Both the distances and alignment of the molecular barcodes support this split. It is possible that some of these samples represent different member species of the <italic>An. nili</italic> group, which have been shown from cytogenetic analysis to differ substantially (<xref ref-type="bibr" rid="bib47">Sharakhova et al., 2013</xref>), but molecular barcodes are not yet available in public databases for all member species.</p></list-item></list><table-wrap id="inlinetable2" position="anchor"><table frame="hsides" rules="groups"><thead><tr><th align="left" valign="top">dist</th><th align="left" valign="top"><italic>An_nili_gp_sp2</italic></th><th align="left" valign="top"><italic>An_nili_gp_sp3</italic></th></tr></thead><tbody><tr><td align="left" valign="top"><italic>An_nili_gp_sp1</italic></td><td align="char" char="." valign="top">0.19 (0.19–0.20)</td><td align="char" char="." valign="top">0.24 (0.23–0.26)</td></tr><tr><td align="left" valign="top"><italic>An_nili_gp_sp2</italic></td><td align="char" char="." valign="top">0.02</td><td align="char" char="." valign="top">0.24 (0.24–0.26)</td></tr><tr><td align="left" valign="top"><italic>An_nili_gp_sp3</italic></td><td align="left" valign="top"/><td align="char" char="." valign="top">0.04 (0.03–0.05)</td></tr></tbody></table></table-wrap><list list-type="bullet"><list-item><p><italic>An. hyrcanus</italic> samples. VBS00085 &amp; VBS00086: <italic>An. hyrcanus</italic> → <italic>An_hyrcanus_gp_sp1</italic>. VBS00082 &amp; VBS00083: <italic>An. hyrcanus</italic> → <italic>An_hyrcanus_gp_sp2</italic>. The distances within these pairs are 0.08 for both pairs. The distances between the pairs are 0.35 (0.34–0.36). The molecular barcode matches support the split. Even though hyrcanus is present in all databases, there are few matches to it. On COI in both BOLD and NCBI, the first pair matches to <italic>nitidus</italic> and the second pair to <italic>crawfordi</italic>; these species are in two distinct subgroups of the hyrcanus group. On ITS2 the first pair matches to <italic>hyrcanus</italic> and then <italic>nitidus</italic>, and the second pair matches to <italic>sinensis</italic> (<italic>sinensis</italic> is in the main <italic>hyrcanus</italic> group, not in either of the aforementioned subgroups). The alignments of COI and ITS2 sequences for these four samples also clearly support the split into pairs.</p></list-item><list-item><p>Samples in the <italic>An. coustani</italic> complex. This complex contains the species <italic>An. tenebrosus, An. ziemanni, An. coustani</italic> and <italic>An. paludis</italic>. The between sample distances indicate a split into two clades (disregarding sample Apal-257, discussed above); however, the split is not correlated with the species labels. The proposed clades are <italic>An_coustani_cp_cl1</italic> containing Aten-191, Aten-185, Azie-334, Acou-956, Acou-959, Acou-962 and <italic>An_coustani_cp_cl2</italic> containing Aten-333, Aten-79, Aten-954, Azie-1032, Azie-1055, Azie-70, Azie-77, Acou-71, Acou-80, Apal-81. The average distances between members of the same clade is 0.07 (0.05–0.09) and 0.07 (0.05–0.10) respectively, while the distance between members of different clades is 0.18 (0.14–0.21). The barcode matches are to <italic>An. coustani</italic> for the vast majority of the samples, even though COI sequences for <italic>An. ziemanni</italic> and <italic>An. tenebrosus</italic> are present in both BOLD and NCBI database. Alignment of the COI sequences shows extremely little variation. Alignment of ITS2 does support a split into the two proposed clades.</p></list-item></list><p>All labels and groupings are displayed in <xref ref-type="supplementary-material" rid="supp1">Supplementary file 1</xref>. In the majority of cases, the fine species-groups are supported by at least one molecular marker and not contradicted by different species labels. Some species are not present in one or both databases, so for these a match to a closely related species is allowed. The exceptions are:</p><list list-type="bullet"><list-item><p><italic>An. jebudensis</italic>: one sample was labelled as <italic>An. jebudensis</italic>, the other one originally as <italic>An. marshallii</italic>, but showed sufficient evidence for relabelling. Neither <italic>An. jebudensis</italic> nor <italic>An. marshallii</italic> is present in either database. On ITS2 they both match to <italic>An. moucheti</italic>, which is the closest species in the dataset, neither has a match in BOLD, and on COI in the NCBI database the best matches are to <italic>An. lindesayi</italic> and <italic>An. sawyeri</italic>, which are in the <italic>Anopheles</italic> and <italic>Nyssorhynchus</italic> subgenus respectively. However, it has to be noted that the NCBI database does not contain an <italic>An. moucheti</italic> COI sequence and the best hits are based on 81% and 91% identity respectively.</p></list-item><list-item><p><italic>An. rhodesiensis</italic>: All samples match to uninformative ‘Anopheles_sp’; even though a COI sequence is available in BOLD and NCBI. The best hit to a named species in the dataset is to <italic>An. funestus</italic> for COI and <italic>An. aconitus</italic> for ITS2.</p></list-item><list-item><p><italic>An. jamesii</italic>: Is predicted for BOLD and ITS2, but not for COI in the NCBI database, even though an <italic>An. jamesii</italic> COI sequence is present there.</p></list-item><list-item><p><italic>An. maculatus A</italic>: has a few matches to <italic>An. sawadwongporni</italic>, which is also a member of the maculatus group, even though sequence of <italic>An. maculatus A</italic> is present in all databases.</p></list-item><list-item><p><italic>An. rampae</italic>: the four different samples match to <italic>An. rampae(2 x), An. sawadwongporni(1 x</italic>) and <italic>An. maculatus(1 x</italic>) in the BOLD database; all these are in the same species group. In the NCBI database, all COI hits are for <italic>An. maculatus</italic> (<italic>An. rampae</italic> COI not present in database), and all ITS2 hits are <italic>An. rampae</italic> and the uninformative <italic>Anopheles_sp</italic>.</p></list-item><list-item><p><italic>An. balabacensis</italic>: matches to <italic>An. introlatus</italic> on COI in both databases, even though <italic>An. balabacensis</italic> sequence is present. The two species are in the same complex.</p></list-item><list-item><p><italic>An. carnevalei</italic>: all samples match to <italic>An. carnevalei</italic> on BOLD and ITS2. <italic>An. carnevalei</italic> sequence is not present in NCBI database for COI; four out of five samples match to <italic>An. nili,</italic> one to <italic>An. darlingi</italic>, which is in a different subgenus.</p></list-item><list-item><p><italic>An. dureni</italic>: sequence not present in either database; on ITS2 one sample matches to <italic>An. minimus</italic> and one to <italic>An. leesoni</italic>, which are both in different groups; but placement of <italic>An. dureni</italic> is not very clear on the species tree.</p></list-item><list-item><p><italic>An. vinckei</italic>: sequence not present in either database; on COI there are distant matches to <italic>An. gambiae</italic> and <italic>An. maculatus</italic>, which are both in different groups; but placement of <italic>An. vinckei</italic> is not very clear on the species tree (seems to be close to <italic>An. dureni</italic>).</p></list-item><list-item><p><italic>An. coustani</italic> group: we have samples of four species, <italic>An. coustani</italic> (present in all databases)<italic>, An. paludis</italic> (present in no databases)<italic>, An. ziemanni</italic> (COI present in both databases), and <italic>An. tenebrosus</italic> (COI present in both databases). In BOLD, all samples match to <italic>An. coustani</italic>. In the NCBI database, on COI most matches are to <italic>An. coustani</italic>, there is one match to <italic>An. ziemanni</italic>, and a few matches to <italic>Anopheles_cf</italic>. On ITS2 there are many matches to <italic>Anopheles_sp</italic>. and <italic>Anopheles_cf</italic>., and the remaining matches are to <italic>An. coustani</italic> and one sample to <italic>An. junlianensis</italic> and <italic>An. yatsushiroensis</italic> in the hyrcanus group (this is the <italic>An. paludis</italic> sample, that is further removed from all other samples in this complex). These samples also show a ‘checkerboard’ pattern, which splits them into two clades, which are not correlated with species labels.</p></list-item><list-item><p><italic>An. barbirostris</italic>: there are matches to <italic>An. barbirostris</italic> and to the closely related <italic>An. dissidens</italic>. However, the samples do not form two separate groups based on the distances.</p></list-item><list-item><p><italic>An. oryzalimnetes</italic>: no Sanger sequencing done.</p></list-item><list-item><p><italic>An. cruzii:</italic> no Sanger sequencing done.</p></list-item><list-item><p><italic>An. bellator</italic>: no Sanger sequencing done.</p></list-item></list><p>Lastly, there are samples which are further than 0.10 distance away from other samples in the reference database representing the same species. Above we have discussed some samples where there was good evidence to adjust the species label, but there are also some for which there is good reason to retain the partner label. Those are:</p><list list-type="bullet"><list-item><p>VBS00001: <italic>An. annularis</italic>. It is a bit more diverged from the other three <italic>An. annularis</italic> samples, which causes it to fall just above the threshold. However, the distances are not very different from the distance between the other <italic>An. annularis</italic>, the next closest sample in the reference set are much further away and the molecular barcodes support the partner label.</p></list-item><list-item><p>Agam-37: <italic>An. gambiae</italic>. It is a bit more diverged from the other <italic>An. gambiae</italic> that were sequenced by the panel, which causes it to fall just above the threshold. But is it closer to <italic>An. gambiae</italic> than to other samples in the reference dataset. The molecular barcodes also support the partner label.</p></list-item><list-item><p>VBS00149 and VBS00150: <italic>An. tessellatus</italic>. They are 0.11 distance from each other, but for both the molecular barcodes match to <italic>An. tessellatus</italic> and the next closest sample in the database is at 0.44 distance.</p></list-item><list-item><p>anopheles-sinensis-chinascaffoldsasinc2 &amp; anopheles-sinensis-sinensisscaffoldsasinc2: <italic>An. sinensis</italic>. They are 0.11 distance from each other and that is still clearly closer than the next best match in their sister species <italic>An. hyrcanus</italic> (namely <italic>An_hyrcanus_gp_sp2</italic>).</p></list-item></list></sec></app><app id="appendix-2"><title>Appendix 2</title><sec sec-type="appendix" id="s9"><title>Comparison UMAP and VAE</title><p>We projected the <italic>An. gambiae</italic> complex training set (GCref v1) with UMAP, using the same 8-mer count tables as for the VAE as input. Using the default UMAP parameters does a very poor job at distinguishing species (<xref ref-type="fig" rid="app2fig1">Appendix 2—figure 1</xref>). By experimenting with different parameter values and different metrics, the three best-performing projections (judging by eye after colouring samples by their species label, see <xref ref-type="fig" rid="app2fig1">Appendix 2—figure 1</xref>) are:</p><list list-type="bullet"><list-item><p>metric = hamming, n_neighbors = 3, min_dist = 0, n_components = 2</p></list-item><list-item><p>metric = canberra, n_neighbors = 3, min_dist = 0.1, n_components = 3</p></list-item><list-item><p>metric = braycurtis, n_neighbors = 3, min_dist = 0.99, n_components = 3</p></list-item></list><fig id="app2fig1" position="float"><label>Appendix 2—figure 1.</label><caption><title>UMAP run on <italic>8-</italic>mer count table of <italic>An</italic>.</title><p><italic>gambiae</italic> complex dataset GCref v1. Left top is using the default UMAP settings, for the other three projections, the settings are specified in the title. UMAP was run unsupervised; the samples are coloured by their species labels after projecting them.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-78775-app2-fig1-v2.tif"/></fig><p>We have two species that are only represented by three samples and by setting the parameter n_neighbours higher than 3, these species will not split out as separate clusters. Although most of the species form distinct clusters in these three projections, there is still significant overlap between <italic>An. gambiae</italic>, <italic>An. coluzzii</italic> and <italic>An. tengrela</italic>.</p><p>It is noticeable that UMAP tends to generate tighter clusters than the VAE (see <xref ref-type="fig" rid="fig4">Figure 4</xref> in the main text); there are less fuzzy boundaries, but it comes at the cost of some samples being placed in the wrong cluster. The convex hull assignment we used with the VAE projection is specifically aimed to deal with the fuzzy boundaries and it doesn’t cope well with outlier samples. Therefore, we use a different classification method, namely support vector machines, to perform species assignment using the UMAP projections. We trained an SVM with the default parameters on the reference dataset GCref v1. The accuracy results and comparison are shown in the table below.</p><table-wrap id="inlinetable3" position="anchor"><table frame="hsides" rules="groups"><thead><tr><th align="left" valign="bottom"/><th align="left" valign="bottom">UMAP hamming</th><th align="left" valign="bottom">UMAP canberra</th><th align="left" valign="bottom">UMAP braycurtis</th><th align="left" valign="bottom">VAE</th></tr></thead><tbody><tr><td align="left" valign="bottom">GCref v1 - correct</td><td align="char" char="." valign="bottom">93.3%</td><td align="char" char="." valign="bottom">94.6%</td><td align="char" char="." valign="bottom">96.3%</td><td align="char" char="." valign="bottom">98.5%</td></tr><tr><td align="left" valign="bottom">GCref v1 - uncertain</td><td align="char" char="." valign="bottom">0%</td><td align="char" char="." valign="bottom">0%</td><td align="char" char="." valign="bottom">0%</td><td align="char" char="." valign="bottom">2.4%<xref ref-type="table-fn" rid="table3fn1">*</xref></td></tr><tr><td align="left" valign="bottom">GCref v1 - incorrect</td><td align="char" char="." valign="bottom">6.7%</td><td align="char" char="." valign="bottom">5.4%</td><td align="char" char="." valign="bottom">3.7%</td><td align="char" char="." valign="bottom">0.0%</td></tr><tr><td align="left" valign="bottom">GCval v1 - correct</td><td align="char" char="." valign="bottom">97.9%</td><td align="char" char="." valign="bottom">97.9%</td><td align="char" char="." valign="bottom">97.9%</td><td align="char" char="." valign="bottom">93.0%</td></tr><tr><td align="left" valign="bottom">GCval v1 - uncertain</td><td align="char" char="." valign="bottom">0%</td><td align="char" char="." valign="bottom">0%</td><td align="char" char="." valign="bottom">0%</td><td align="char" char="." valign="bottom">5.6%</td></tr><tr><td align="left" valign="bottom">GCval v1 - incorrect</td><td align="char" char="." valign="bottom">2.1%</td><td align="char" char="." valign="bottom">2.1%</td><td align="char" char="." valign="bottom">2.1%</td><td align="char" char="." valign="bottom">1.4%</td></tr></tbody></table><table-wrap-foot><fn id="table3fn1"><label>*</label><p>this includes 0.9% of samples assigned to <italic>Anopheles_bwambae_fontenillei</italic>, which forms a combined assignment category in the VAE classification, and hence cannot be assigned to a single species.</p></fn></table-wrap-foot></table-wrap><p>We suspected we could improve the results by treating separate clusters of the same species as their own assignment category, for example relabel the samples in the separate <italic>An. arabiensis</italic> cluster as An_arabiensis-2. However, this did not improve the accuracy, neither for the reference set GCref v1 nor for the validation set GCval v1.</p><p>Overall the VAE has a lower misclassification score, although this comes at the cost of a larger percentage of samples assigned to multiple species. We have consciously decided for a more conservative classifier and we intend to resolve the samples which cannot be assigned to a single species on an ad hoc basis; either by more in depth analysis of specific amplicons (to be developed), by considering carefully documented species ranges where available (e.g. to distinguish between <italic>An. bwambae</italic> and <italic>An. fontenillei</italic>, both of which have very specific geographical areas where they occur) or by performing whole genome shotgun sequencing if the identity of the samples is of greater interest.</p><p>The UMAP projections can probably be tuned better to achieve similar assignment performance to the VAE, but UMAP does not outperform the VAE.</p></sec></app><app id="appendix-3"><title>Appendix 3</title><sec sec-type="appendix" id="s10"><title>ADMIXTURE in the <italic>An. gambiae</italic> complex</title><p>To assess the amount of population differentiation between the different species in the <italic>An. gambiae</italic> complex, we ran ADMIXTURE on the reference dataset GCref v1. We ran ADMIXTURE on the <italic>8-</italic>mer count tables; first we filtered for variable <italic>8</italic>-mers which take count values in {0,1,2} for all samples; there are 25,301 such <italic>8</italic>-mers. We treated these <italic>8</italic>-mers essentially as unlinked SNPs. We are aware that these input data do not exactly follow the assumptions behind the probabilistic model used by ADMIXTURE, but using only unlinked SNPs would allow for at most one SNP per amplicon, so 62 in total and it would be quite challenging to select one without bias to a certain species or group of species. Despite not following the model assumptions, we believe that ADMIXTURE used on k-mers should allow us to judge whether ADMIXTURE constitutes a useful approach to differentiate between species in the <italic>An. gambiae</italic> complex.</p><p>The inferred ADMIXTURE proportions for different values of K can be found in <xref ref-type="fig" rid="app3fig1">Appendix 3—figure 1</xref>. At K=3 and K=4, ADMIXTURE does a good job at distinguishing the well-represented species: <italic>An. gambiae, An. coluzzii</italic> and <italic>An. arabiensis</italic>. However, it struggles to differentiate between the species represented by a smaller number of samples, even though many of these species are much more diverged from each other than <italic>An. gambiae</italic> and <italic>An. coluzzii</italic> are (<xref ref-type="bibr" rid="bib20">Fontaine et al., 2015</xref>).</p><fig id="app3fig1" position="float"><label>Appendix 3—figure 1.</label><caption><title>Admixture fractions of the GCref v1 samples for K from 2 to 14.</title><p>The samples are ordered by species, from left to right <italic>An. gambiae</italic>, Agamp4 reference genome, <italic>An. coluzzii</italic>, <italic>An. tengrela</italic>, <italic>An. arabiensis</italic>, <italic>An. melas</italic>, <italic>An. merus</italic>, <italic>An. quadriannulatus</italic>, <italic>An. bwambae</italic> and <italic>An. fontenillei</italic>. The samples within a species are ordered by ancestry fraction and the within species ordering is not the same between rows.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-78775-app3-fig1-v2.tif"/></fig><p>For the higher values of K, ADMIXTURE reveals substructure and mixed ancestry in the <italic>An. gambiae</italic> and <italic>An. coluzzii</italic> samples. The first glimpse of substructure we see already at K=3, where the <italic>An. gambiae</italic> samples from Guinea-Bissau and the Gambia are modelled as a mixture of <italic>An. gambiae</italic> and <italic>An. coluzzii</italic>. This substructure is also found in the VAE projection.</p><p>While the <italic>An. arabiensis</italic> from Madagascar split out as a separate cluster in the VAE and in the three UMAP projections discussed in the next section, ADMIXTURE only identifies them as a separate group at K=11. So similarly as for the species represented by few samples, it seems like ADMIXTURE is hesitant to assign a unique ancestry to a small group of samples.</p><p>ADMIXTURE identifies some structure in the <italic>An. gambiae</italic> complex when treating variable <italic>8</italic>-mers as SNPs. It is particularly good at differentiating between groups represented by a larger number of samples and additionally finds some substructure within these groups. It is pronouncedly worse than the VAE at differentiating between species for which we have fewer samples. This is a shortcoming given that a major aim of applying ANOSPP widely to samples from across the globe is to identify novel species that may or may not be contributing to transmission.</p><p>To assess which values of K are most informative, we recorded the cross-validation error for these runs, see <xref ref-type="fig" rid="app3fig2">Appendix 3—figure 2</xref>. There are 9 species represented in the dataset GCref v1, so ideally we would find a minimal cross-validation error around K=9. The cross validation plot indicates that we need a minimum of about 9 populations, but it does not unambiguously indicate a suitable value of K. To properly assess the cross validation error, we’d have to run multiple replicates.</p><fig id="app3fig2" position="float"><label>Appendix 3—figure 2.</label><caption><title>Cross-validation error for different values of K.</title><p>Only one replicate shown.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-78775-app3-fig2-v2.tif"/></fig><p>Although ADMIXTURE does find structure in the <italic>An. gambiae</italic> complex, it is principally a method for assessing population differentiation, not for species assignment. It is possible to build an assignment method around it, but given that it performs worse than the VAE at differentiating between all species in the <italic>An. gambiae</italic> complex, we prefer using the VAE based method for assignments.</p></sec></app><app id="appendix-4"><title>Appendix 4</title><sec sec-type="appendix" id="s11"><title>Parameter choices for the VAE</title><p>Our VAE architecture is inspired by popVAE (<xref ref-type="bibr" rid="bib6">Battey et al., 2021</xref>). We used their default parameter choices for learning rate, training iterations and validation proportion as well as the ‘elu’ propagation between the layers of the neural network and the ‘linear’ activation function to transform the output from the encoder to the latent space variables. Because we model <italic>k</italic>-mer counts as independent Poisson variables, we use the ‘softplus’ activation function to transform the output from the last layer of the decoder.</p><p>To set the width and depth of the encoder and decoder, we ran a grid search over a combination of widths and depths. We kept the width and depth the same for the decoder and the encoder and we trained the VAE with three different seeds for each width-depth combination. For high width values (more than 500 nodes) the run time required to train the VAE was very long and the process would often crash when conducted on a desktop. For very small networks (width 32, depth 4) the resolution was poor, but in the middle range the visible structure was not severely affected by the choice of width and depth, so we went with width 128 and depth 6, which gave a good resolution and reasonable run time.</p><p>As mentioned in the main text, the loss function contains a parameter, <italic>w</italic>, that controls the relative importance of the data driven term and the regularisation term. We ran a grid search ranging over four orders of magnitude, training with three different seeds for each search point. For small values of <italic>w</italic>, which gives higher weight to regularisation term, the resulting latent space dimension shows a strong correlation between the latent space dimensions, suggesting that only highly differentiated samples can overpower the effect from the regularisation term. For high values of <italic>w</italic>, the training process of the VAE becomes more unstable: it crashes sometimes and the resulting latent space projections look less similar to those obtained with the same <italic>w</italic> value, but a different seed. We chose <italic>w</italic> equal to 1000, which resulted in reasonably stable projections, with good visible structure.</p><p>To assess the effect of using <italic>8-</italic>mers over <italic>k</italic>-mers of other length, we ran the VAE with <italic>6-</italic>mers and with <italic>10</italic>-mers as input, see <xref ref-type="fig" rid="app4fig1">Appendix 4—figure 1</xref>. The projections using <italic>6</italic>-mers, in both two and three dimensions, show less tight and more overlapping clusters by species compared to the <italic>8</italic>-mer projection. There are only 4,096 unique <italic>6</italic>-mers, compared to &gt;65,000 unique <italic>8-</italic>mers, and with almost 10 kB of sequence, there will be much fewer unique <italic>6-</italic>mers than unique <italic>8</italic>-mers. Although the VAE loss function is based on counts rather than presence/absence of <italic>k</italic>-mers, it probably is more sensitive to the difference between 0 and 1 than to the difference between 2 and 3. The VAE based on <italic>10-</italic>mers shows clusters quite similar to those found in the <italic>8</italic>-mer projection, although <italic>An. quadriannulatus</italic> is much closer to <italic>An. bwambae</italic> and <italic>An. fontenillei</italic>. It took much longer to train the <italic>10</italic>-mer projection (5.5 hr compared to 20 min for the <italic>8</italic>-mers), which is not a major drawback, because the training has to happen only once, but it does make it harder to tweak the parameters for the <italic>10-</italic>mer projection.</p><fig id="app4fig1" position="float"><label>Appendix 4—figure 1.</label><caption><title>VAE projection of GCref v1 in two dimensions (top) using <italic>6-</italic>mers (left) and <italic>10</italic>-mers (right) and in three dimensions using <italic>6-</italic>mers (bottom).</title></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-78775-app4-fig1-v2.tif"/></fig><p>To determine the number of latent space dimensions, we ran a grid search over 2, 3 and 4 latent space dimensions. In fact, the grid search for <italic>w</italic> and the number of latent space dimensions was run simultaneously, but there seemed to be little interaction between <italic>w</italic> and the number of latent space dimensions. For the training set containing only <italic>An. gambiae</italic>, <italic>An. coluzzii</italic> and <italic>An. arabiensis</italic>, adding a third or fourth dimension did not add to the visible structure, so in this case we opted for two latent space dimensions for visualisation purposes. However, for the full training set GCref v1, in the two-dimensional projection, several species clusters are very close to each other, making this hard to use for species assignment. Adding a third dimension resolves this problem, even though the second and third dimensions are strongly correlated (see <xref ref-type="fig" rid="fig4">Figure 4</xref>). The benefit of the strong correlation is that we can visualise the structure in two dimensions.</p></sec></app><app id="appendix-5"><title>Appendix 5</title><sec sec-type="appendix" id="s12"><title>Geographic stability</title><p>Here we test the robustness of our VAE projection by removing all samples collected in one geographic location from the training set and then projecting those samples and the validation set and comparing these results to those obtained using the VAE trained on the full training set. In particular, we will pay attention to the separation of the species clusters, the classification accuracy of the validation set and the visible structure within the species clusters.</p><p>For this analysis, we use a subset of the reference dataset GCref v1 and the validation set GCval v1, containing only the species <italic>An. coluzzii</italic>, <italic>An. gambiae</italic> and <italic>An. arabiensis</italic>, because for the other species in the <italic>An. gambiae</italic> complex we have very few samples, the samples in this dataset are collected at only one or two locations and the species have more limited geographic ranges than <italic>An. coluzzii</italic>, <italic>An. gambiae</italic> and <italic>An. arabiensis</italic>. With only these species, two latent space dimensions are sufficient to exhibit the relevant structure, so that is what we will use here. We have performed these drop-outs for a subset of the geographic locations, selecting for those we thought would be most likely to affect the structure of the projection.</p><p>Below, we discuss the drop-out experiments in more detail, but to summarise: overall, the separation of the species clusters remained intact and the ability to classify species of the samples in the training set and in the validation set was not significantly affected. Samples from The Gambia and Guinea-Bissau could be less accurately classified when no samples from this geographic region were included in training the VAE, but for all other locations we tested, the ability to classify species remained the same. The degree to which geographic structure is visible within the species clusters was somewhat affected for certain collection countries. However, the visible structure never completely disappeared, nor did we see a considerably different geographic structure, it was merely that the structure became a bit more blurred or more condensed than in the original projection.</p></sec><sec sec-type="appendix" id="s13"><title>Angola</title><p>We removed 10 <italic>An. coluzzii</italic> samples from the training set, see <xref ref-type="fig" rid="app5fig1">Appendix 5—figure 1</xref>. The separability of species clusters is similar compared to the projection of the VAE trained on the full dataset. The geographic structure within the <italic>An. gambiae</italic> and <italic>An. arabiensis</italic> clusters remains intact, but the <italic>An. coluzzii</italic> cluster loses some of its visible structure. Angola is on the edge of the geographical range of the <italic>An. coluzzii</italic> samples in this dataset and these samples are also on the very top of the VAE projection, suggesting that they are responsible for a considerable amount of the structure within <italic>An. coluzzii</italic>.</p><fig id="app5fig1" position="float"><label>Appendix 5—figure 1.</label><caption><title>VAE projections of <italic>An</italic>.</title><p><italic>arabiensis</italic>, <italic>An. coluzzii</italic> and <italic>An. gambiae</italic> from different geographic locations. <bold>Left:</bold> samples from Angola included in VAE training. <bold>Right:</bold> samples from Angola excluded from VAE training. Samples are coloured by country of collection. Squares are validation samples (not used in VAE training), triangles are <italic>An. coluzzii</italic> individuals, circles are <italic>An. gambiae</italic> individuals and crosses are <italic>An. arabiensis</italic> individuals. Samples from Angola are highlighted with a blue edge, all other validation samples have a black edge.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-78775-app5-fig1-v2.tif"/></fig></sec><sec sec-type="appendix" id="s14"><title>Cameroon</title><p>We removed 10 <italic>An. coluzzii</italic> and 66 <italic>An. gambiae</italic> from the training set, see <xref ref-type="fig" rid="app5fig2">Appendix 5—figure 2</xref>. The separability of the species clusters is similar compared to the projection of the VAE trained on the full dataset. The geographic structure within the <italic>An. coluzzii</italic> and <italic>An. arabiensis</italic> clusters remains intact, but the <italic>An. gambiae</italic> cluster loses some visible structure in its main subcluster, while the structure in the other four subclusters (formed by samples from The Gambia and Guinea-Bissau; by samples from Nigeria and Gabon; by samples from Madagascar and by samples from various East African countries respectively) remains largely intact. This is probably due to the fact that the samples from Cameroon form a large proportion of the samples in the main <italic>An. gambiae</italic> cluster.</p><fig id="app5fig2" position="float"><label>Appendix 5—figure 2.</label><caption><title>VAE projections of <italic>An</italic>.</title><p><italic>arabiensis</italic>, <italic>An. coluzzii</italic> and <italic>An. gambiae</italic> from different geographic locations. <bold>Left:</bold> samples from Cameroon included in VAE training. <bold>Right:</bold> samples from Cameroon excluded from VAE training. Samples are coloured by country of collection. Squares are validation samples (not used in VAE training), triangles are <italic>An. coluzzii</italic> individuals, circles are <italic>An. gambiae</italic> individuals and crosses are <italic>An. arabiensis</italic> individuals. Samples from Cameroon are highlighted with a blue edge, all other validation samples have a black edge.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-78775-app5-fig2-v2.tif"/></fig></sec><sec sec-type="appendix" id="s15"><title>The Gambia and Guinea-Bissau</title><p>We removed 33 <italic>An. coluzzii</italic> and 19 <italic>An. gambiae</italic> from The Gambia and 24 <italic>An. gambia</italic> from Guinea-Bissau from the training set, see <xref ref-type="fig" rid="app5fig3">Appendix 5—figure 3</xref>. Considering the training samples, the separability of the species clusters is very clear. However, the classification accuracy of the projected samples from The Gambia and Guinea-Bissau is only 70%. This is probably due to the fact that these samples form the border between the <italic>An. coluzzii</italic> and <italic>An. gambiae</italic> clusters in the projection of the VAE trained on the complete dataset. So by leaving those samples out, we miss the important label information necessary to classify the edge cases. The subclusters of the <italic>An. gambiae</italic> cluster are arguably more pronounced than in the original projection, but the structure within the subclusters of the <italic>An. gambiae</italic> cluster and in the entire <italic>An. coluzii</italic> cluster reduces.</p><fig id="app5fig3" position="float"><label>Appendix 5—figure 3.</label><caption><title>VAE projections of <italic>An</italic>.</title><p><italic>arabiensis</italic>, <italic>An. coluzzii</italic> and <italic>An. gambiae</italic> from different geographic locations. <bold>Left:</bold> samples from The Gambia and Guinea-Bissau included in VAE training. <bold>Right:</bold> samples from The Gambia and Guinea-Bissau excluded from VAE training. Samples are coloured by country of collection. Squares are validation samples (not used in VAE training), triangles are <italic>An. coluzzii</italic> individuals, circles are <italic>An. gambiae</italic> individuals and crosses are <italic>An. arabiensis</italic> individuals. Samples from The Gambia and Guinea-Bissau are highlighted with a blue edge, all other validation samples have a black edge.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-78775-app5-fig3-v2.tif"/></fig></sec><sec sec-type="appendix" id="s16"><title>Madagascar</title><p>We removed 20 <italic>An. arabiensis</italic> and 18 <italic>An. gambiae</italic> from the training set, see <xref ref-type="fig" rid="app5fig4">Appendix 5—figure 4</xref>. The separability of the species clusters is similar compared to the projection of the VAE trained on the full dataset and the geographic structure within the three species clusters remains largely intact. When the Madagascar samples are included in training the VAE, they form a tight subcluster, both for <italic>An. gambiae</italic> and <italic>An. arabiensis</italic>. When they are not included in training, these clusters stand out less, due to the fact that the VAE does not recognise the features that make them stand out.</p><fig id="app5fig4" position="float"><label>Appendix 5—figure 4.</label><caption><title>VAE projections of <italic>An</italic>. <italic>arabiensis</italic>, <italic>An. coluzzii</italic> and <italic>An. gambiae</italic> from different geographic locations.</title><p><bold>Left:</bold> samples from Madagascar included in VAE training. <bold>Right:</bold> samples from Madagascar excluded from VAE training. Samples are coloured by country of collection. Squares are validation samples (not used in VAE training), triangles are <italic>An. coluzzii</italic> individuals, circles are <italic>An. gambiae</italic> individuals and crosses are <italic>An. arabiensis</italic> individuals. Samples from Madagascar are highlighted with a blue edge, all other validation samples have a black edge.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-78775-app5-fig4-v2.tif"/></fig></sec><sec sec-type="appendix" id="s17"><title>Mali</title><p>We removed 57 <italic>An. coluzzii</italic> and 43 <italic>An. gambiae</italic> from the training set, see <xref ref-type="fig" rid="app5fig5">Appendix 5—figure 5</xref>. The separability of the species clusters is similar compared to the projection of the VAE trained on the full dataset. The visible geographic structure within the three species clusters reduces a bit. This could be because we removed such a large number of samples.</p><fig id="app5fig5" position="float"><label>Appendix 5—figure 5.</label><caption><title>VAE projections of <italic>An</italic>. <italic>arabiensis</italic>, <italic>An. coluzzii</italic> and <italic>An. gambiae</italic> from different geographic locations.</title><p><bold>Left:</bold> samples from Mali included in VAE training. <bold>Right:</bold> samples from Mali excluded from VAE training. Samples are coloured by country of collection. Squares are validation samples (not used in VAE training), triangles are <italic>An. coluzzii</italic> individuals, circles are <italic>An. gambiae</italic> individuals and crosses are <italic>An. arabiensis</italic> individuals. Samples from Mali are highlighted with a blue edge, all other validation samples have a black edge.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-78775-app5-fig5-v2.tif"/></fig></sec><sec sec-type="appendix" id="s18"><title>Nigeria</title><p>We removed 6 <italic>An. coluzzii</italic> and 20 <italic>An. gambiae</italic> from the training set, see <xref ref-type="fig" rid="app5fig6">Appendix 5—figure 6</xref>. The separability of the species clusters is similar compared to the projection of the VAE trained on the full dataset and the geographic structure within the three species clusters remains largely intact. When the Nigerian samples are included in training the VAE, the <italic>An. gambiae</italic> individuals are more separated from the main <italic>An. gambiae</italic> cluster than when they are projected using the VAE excluding them from training. This is because the VAE has not been trained to recognise the features that distinguish these Nigerian <italic>An. gambiae</italic> individuals from the other samples.</p><fig id="app5fig6" position="float"><label>Appendix 5—figure 6.</label><caption><title>VAE projections of <italic>An</italic>. <italic>arabiensis</italic>, <italic>An. coluzzii</italic> and <italic>An. gambiae</italic> from different geographic locations.</title><p><bold>Left:</bold> samples from Nigeria included in VAE training. <bold>Right:</bold> samples from Nigeria excluded from VAE training. Samples are coloured by country of collection. Squares are validation samples (not used in VAE training), triangles are <italic>An. coluzzii</italic> individuals, circles are <italic>An. gambiae</italic> individuals and crosses are <italic>An. arabiensis</italic> individuals. Samples from Nigeria are highlighted with a blue edge, all other validation samples have a black edge.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-78775-app5-fig6-v2.tif"/></fig></sec><sec sec-type="appendix" id="s19"><title>Tanzania</title><p>We removed 37 <italic>An. arabiensis</italic> and 20 <italic>An. gambiae</italic> from the training set, see <xref ref-type="fig" rid="app5fig7">Appendix 5—figure 7</xref>. The separability of the species clusters is similar compared to the projection of the VAE trained on the full dataset. The subclusters of <italic>An. gambiae</italic> and <italic>An. arabiensis</italic> remain well separated, but the visible geographic structure within the (sub)clusters reduces a bit.</p><fig id="app5fig7" position="float"><label>Appendix 5—figure 7.</label><caption><title>VAE projections of <italic>An</italic>. <italic>arabiensis</italic>, <italic>An. coluzzii</italic> and <italic>An. gambiae</italic> from different geographic locations.</title><p><bold>Left:</bold> samples from Tanzania included in VAE training. <bold>Right:</bold> samples from Tanzania excluded from VAE training. Samples are coloured by country of collection. Squares are validation samples (not used in VAE training), triangles are <italic>An. coluzzii</italic> individuals, circles are <italic>An. gambiae</italic> individuals and crosses are <italic>An. arabiensis</italic> individuals. Samples from Tanzania are highlighted with a blue edge, all other validation samples have a black edge.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-78775-app5-fig7-v2.tif"/></fig></sec></app></app-group></back><sub-article article-type="editor-report" id="sa0"><front-stub><article-id pub-id-type="doi">10.7554/eLife.78775.sa0</article-id><title-group><article-title>Editor's evaluation</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Matute</surname><given-names>Daniel R</given-names></name><role specific-use="editor">Reviewing Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/0130frc33</institution-id><institution>University of North Carolina, Chapel Hill</institution></institution-wrap><country>United States</country></aff></contrib></contrib-group><related-object id="sa0ro1" object-id-type="id" object-id="10.1101/2022.03.18.484650" link-type="continued-by" xlink:href="https://sciety.org/articles/activity/10.1101/2022.03.18.484650"/></front-stub><body><p>This piece presents a new method, ANOSPP, that uses cheap sequencing to infer genealogical relationships between Anopheles individuals, including the possibility of species-level identification. The method is versatile and will be useful to vector biology researchers. The proof-of-principle presented in the manuscript is convincing and will serve as a blueprint for future studies in Anopheles.</p></body></sub-article><sub-article article-type="decision-letter" id="sa1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.78775.sa1</article-id><title-group><article-title>Decision letter</article-title></title-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Matute</surname><given-names>Daniel R</given-names></name><role>Reviewing Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/0130frc33</institution-id><institution>University of North Carolina, Chapel Hill</institution></institution-wrap><country>United States</country></aff></contrib></contrib-group></front-stub><body><boxed-text id="sa2-box1"><p>Our editorial process produces two outputs: (i) <ext-link ext-link-type="uri" xlink:href="https://sciety.org/articles/activity/10.1101/2022.03.18.484650">public reviews</ext-link> designed to be posted alongside <ext-link ext-link-type="uri" xlink:href="https://www.biorxiv.org/content/10.1101/2022.03.18.484650v1">the preprint</ext-link> for the benefit of readers; (ii) feedback on the manuscript for the authors, including requests for revisions, shown below. We also include an acceptance summary that explains what the editors found interesting or important about the work.</p></boxed-text><p><bold>Decision letter after peer review:</bold></p><p>Thank you for submitting your article &quot;High resolution species assignment of <italic>Anopheles</italic> mosquitoes using <italic>k</italic>-mer distances on targeted sequences&quot; for consideration by <italic>eLife</italic>. Your article has been reviewed by 3 peer reviewers, one of whom is a member of our Board of Reviewing Editors, and the evaluation has been overseen by Dominique Soldati-Favre as the Senior Editor. The reviewers have opted to remain anonymous.</p><p>The reviewers have discussed their reviews with one another, and the Reviewing Editor has drafted this to help you prepare a revised submission. In general all reviewers saw merit in the submission but had some concerns regarding the scope of the work and the interest the findings can elicit in general audience not specialized in vectors. You will see that the reviewers had several comments that can make the manuscript a stronger piece. Collectively, all reviewers agreed on two improvements that would make the manuscript potentially suitable for <italic>eLife</italic>. I am looking forward to a resubmission of the piece.</p><p>Essential revisions:</p><p>1) All reviewers agree that the findings from this piece has the potential to benefit the vector community. The common comment from all reviewers was the need to more carefully delineate the scope and impact of the work. One way to do this is to be more straightforward on what instances this method can and should be used. This is of particular importance for the <italic>eLife</italic> audience which extends beyond anopheline researchers.</p><p>2) The main claim of the manuscript is that the method the authors are presenting is a major advance in species compared to the tools available in the field. This needs to be either further demonstrated by providing a comparison to other sequencing methods (MSG, RAD-Seq, etc), and computational tools (Structure, ADMIXTURE), or by tempering the claims.</p><p><italic>Reviewer #2 (Recommendations for the authors):</italic></p><p>First: this manuscript will be of interest to entomologists and vector biologists who do not have a background in machine learning. With that in mind, I commend the authors for their clear efforts in making the algorithmic and technical details of this manuscript understandable to a lay audience.</p><p>Three suggestions along those lines follow. First, the idea of a kmer table may not be immediately intuitive to someone who is not already familiar with them. I suggest making explicit (or more prominent, if I have missed this in the text) that the kmer table contains ALL possible kmers of that length. This is readily apparent in retrospect, but was not immediately clear.</p><p>Second, again, the authors have done a good job making what little math is present in this paper accessible to a wide audience, without resorting to jargon. However, considering this audience, it would be good to have the specific formal meaning of the vertical bars in both equations defined for those who are not familiar with set notation. At the first equation seems like a natural place for it.</p><p>Lastly on this topic, the kmer table contains the occurrence counts, and kmer distance is calculated based on the number of non-matching kmers. Is a matching kmer defined by shared presence, or an identical number of occurrences? Ie, if 8mer CCTGAAAT occurs twice in q1 and four times in q2, is this counted as a match for this entry in the table?</p><p>In addition, after reading the manuscript, I was curious about the potential effect of chromosomal inversions in the gambiae complex. The authors mention this as a type of variation that should be well-represented in the reference database. If the reference and validation sets naturally contain a reasonably polymorphic assortment of the inversions, it would appear that the method is robust to these, but this may be a strong assumption. Do the authors have any predictions about the potential consequences of inversions that could help researchers applying this method, or interpreting the resulting data, be wary of &quot;edge cases?&quot; Do a substantial proportion of amplicons overlap a common inversion in this complex?</p><p>Finally, in the discussion of An. nili and An. hyrcanus, as well as other relabeled specimens discussed in the supplement, the authors show how this tool can also generate phylogenetic questions. This is very interesting! However, given the known history of introgression in the gambiae and funestus complexes, and the probable history of such introgression elsewhere, it is also worth very briefly touching on the potential for this method to suggest patterns of relatedness between species that do not reflect the true phylogeny. This simply follows from interrogating markers genome-wide, and is not a drawback or criticism of the method; however, the clarification may be worthwhile for the sake of those interested in applying this method or re-using the resulting data.</p><p><italic>Reviewer #3 (Recommendations for the authors):</italic></p><p>My main concerns come from not being entirely certain what the proper scope is for such an investigation – I will elaborate a bit below, and I am totally happy to defer to the editor or other reviewers on what they feel is best here. But as a reader, I was particularly interested to get more detail on the advantages and disadvantages of different approaches (since the amplicon panel itself is already published elsewhere). Currently, it reads as a bit path dependent – the authors develop their nearest-neighbor scheme, show that it performs well at coarser scales but not finer scales, and then develop the VAE approach to assign within coarser groups.</p><p>In particular, I think it would be quite valuable to see what factors determine the best approach here. My understanding is that the regularization approach used by VAE leads to more continuous distributions in a space that tends towards the origin. For species assignment, this could be a good or a bad thing, I suppose – it might perform better for ambiguous samples but worse for well defined but subtly differentiated lineages? UMAP, in contrast, would be expected to yield more compact and spaced apart clusters, I believe – this might have different advantages and disadvantages. In Makunin 2022 UMAP doesn't seem to work particularly well – is the improvement here from the kmer approach or the VAE? It would be helpful to know what are the key advances that make things work so much better here.</p><p>I am sensitive to the desire to develop a practical tool here, so I am happy to hear if others disagree with this assessment. But if the goal is to more generally translate recent advances in clustering high-dimensional data to the species assignment context, I think a slightly broader scope in the presentation of results would help substantially. These recommendations are premised on potentially providing a broadened comparison of species assignment approaches for this specific context (i.e. large numbers of moderately divergent amplicons) – just suggestions of what I think would more helpfully contextualize this work, not preconditions for my recommendation to accept this manuscript.</p><p>I would be very curious to see something like a summary at the end with a more direct comparison of assignment accuracy with:</p><p>1. Read alignment with traditional nearest neighbor assignment – doesn't perform perfectly.</p><p>2. kmer tables with nearest neighbor performs incrementally better.</p><p>2a. Are 8mer tables actually the best tradeoff between robustness and sensitivity?</p><p>3. Machine learning approaches can improve on this.</p><p>3a. VAE</p><p>3b. UMAP or t-SNE?</p><p>This could provide more general guidelines that could be translated into other systems, increasing the utility of the work for the community.</p></body></sub-article><sub-article article-type="reply" id="sa2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.78775.sa2</article-id><title-group><article-title>Author response</article-title></title-group></front-stub><body><disp-quote content-type="editor-comment"><p>Essential revisions:</p><p>1) All reviewers agree that the findings from this piece has the potential to benefit the vector community. The common comment from all reviewers was the need to more carefully delineate the scope and impact of the work. One way to do this is to be more straightforward on what instances this method can and should be used. This is of particular importance for the eLife audience which extends beyond anopheline researchers.</p></disp-quote><p>We have more elaborately described potential use cases and why they are important in the conclusion.</p><disp-quote content-type="editor-comment"><p>2) The main claim of the manuscript is that the method the authors are presenting is a major advance in species compared to the tools available in the field. This needs to be either further demonstrated by providing a comparison to other sequencing methods (MSG, RAD-Seq, etc), and computational tools (Structure, ADMIXTURE), or by tempering the claims.</p></disp-quote><p>ANOSPP is designed to make species identification more accurate, more uniform across complexes, series and subgenera, while also being cheap and high throughput. So the panel really is an alternative for the current process of species identification, which includes morphological identification down to species complexes, followed by molecular typing (single locus sequencing or PCR/gel based diagnostics) to identify the species within the complex. Because ANOSPP works on the entire genus, it removes the need for morphological identification, the accuracy of which is dependent on the level of expertise of the taxonomist and the expected species diversity, and how well this is recorded, at the collection location. Within species complexes, our method is more reliable and nuanced than single locus barcoding approaches, because the information from 62 amplicon targets, spread over the genome, is combined. For a more elaborate discussion of our motivation to work with ANOSPP data over other sequencing approaches, see the reply to reviewer #1.</p><p>We compared the population structure within the <italic>Anopheles gambiae</italic> complex identified by the VAE to that identified by ADMIXTURE. ADMIXTURE identifies some structure in the <italic>An. gambiae</italic> complex when treating variable <italic>8</italic>-mers as SNPs. It is particularly good at differentiating between groups represented by a larger number of samples and additionally finds some substructure within these groups. However, it is pronouncedly worse than the VAE at differentiating between species for which we have fewer samples. For more elaborate discussion, see reply to reviewer #1, page 20 in the manuscript and newly added Appendix 3.</p><disp-quote content-type="editor-comment"><p>Reviewer #2 (Recommendations for the authors):</p><p>First: this manuscript will be of interest to entomologists and vector biologists who do not have a background in machine learning. With that in mind, I commend the authors for their clear efforts in making the algorithmic and technical details of this manuscript understandable to a lay audience.</p><p>Three suggestions along those lines follow. First, the idea of a kmer table may not be immediately intuitive to someone who is not already familiar with them. I suggest making explicit (or more prominent, if I have missed this in the text) that the kmer table contains ALL possible kmers of that length. This is readily apparent in retrospect, but was not immediately clear.</p></disp-quote><p>A toy 2-mer example is now included in the section on <italic>k</italic>-mers on page 7.</p><disp-quote content-type="editor-comment"><p>Second, again, the authors have done a good job making what little math is present in this paper accessible to a wide audience, without resorting to jargon. However, considering this audience, it would be good to have the specific formal meaning of the vertical bars in both equations defined for those who are not familiar with set notation. At the first equation seems like a natural place for it.</p></disp-quote><p>The notation for the size of a set has now been defined at its first occurrence.</p><disp-quote content-type="editor-comment"><p>Lastly on this topic, the kmer table contains the occurrence counts, and kmer distance is calculated based on the number of non-matching kmers. Is a matching kmer defined by shared presence, or an identical number of occurrences? Ie, if 8mer CCTGAAAT occurs twice in q1 and four times in q2, is this counted as a match for this entry in the table?</p></disp-quote><p>The definition for <italic>k</italic>-mer distance we use relies on the <italic>k-</italic>mer counts, so for two sequences to match exactly, the counts for each unique <italic>k-</italic>mer have to be equal. We have now highlighted this in the toy example and explicitly mentioned that the distance relies on counts and not mere presence/absence in the section on k-mers.</p><disp-quote content-type="editor-comment"><p>In addition, after reading the manuscript, I was curious about the potential effect of chromosomal inversions in the gambiae complex. The authors mention this as a type of variation that should be well-represented in the reference database. If the reference and validation sets naturally contain a reasonably polymorphic assortment of the inversions, it would appear that the method is robust to these, but this may be a strong assumption. Do the authors have any predictions about the potential consequences of inversions that could help researchers applying this method, or interpreting the resulting data, be wary of &quot;edge cases?&quot; Do a substantial proportion of amplicons overlap a common inversion in this complex?</p></disp-quote><p>We have looked into the 2La inversion in <italic>An. gambiae</italic> (this inversion is fixed in <italic>An. arabiensis</italic>). This is a reasonably large inversion (~20 Mb in the ~220 Mb genome) and four amplicons are located in the genomic region spanned by or closely neighbouring the inversion. We generated 2La karyotype predictions for the samples with whole genome data available using compkaryo (Love et al. <italic>G3</italic>, 2019) and found that two of these four amplicons contain variation that is correlated with the 2La karyotype. We used this variation to karyotype all the samples in the reference dataset GCref v1 and found that the karyotypes based on the amplicon data were in good agreement with the compkaryo results when both were available.</p><p>To explore whether the VAE contains any structure driven by the 2La inversion, we have to control for geographic population structure, because the 2La inversion frequencies vary along a latitudinal cline (e.g. Cheng et al. <italic>Genetics</italic>, 2010). So we looked at <italic>An. gambiae</italic> mosquitoes from two collection locations in Cameroon. These mosquitoes were collected in the exact same location, in the same month and year. As is shown in <xref ref-type="fig" rid="sa2fig1">Author response image 1</xref>, the VAE projection does show structure correlated with the 2La karyotype. Bear in mind that this VAE is simply trained on all amplicons, so we are confident that we can develop tools that are tailored to accurate type 2La inversions from amplicon data.</p><p>We have not included this work in this manuscript. We need to develop and refine approaches to use the ANOSPP data to study features like inversions and this is still a work in progress.</p><fig id="sa2fig1" position="float"><label>Author response image 1.</label><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-78775-sa2-fig1-v2.tif"/></fig><disp-quote content-type="editor-comment"><p>Finally, in the discussion of An. nili and An. hyrcanus, as well as other relabeled specimens discussed in the supplement, the authors show how this tool can also generate phylogenetic questions. This is very interesting! However, given the known history of introgression in the gambiae and funestus complexes, and the probable history of such introgression elsewhere, it is also worth very briefly touching on the potential for this method to suggest patterns of relatedness between species that do not reflect the true phylogeny. This simply follows from interrogating markers genome-wide, and is not a drawback or criticism of the method; however, the clarification may be worthwhile for the sake of those interested in applying this method or re-using the resulting data.</p></disp-quote><p>We agree with the reviewer that this method is not suitable to resolve phylogenetic questions. However, it can be used to flag samples that deviate from our expectations, e.g. samples which were morphologically identified as the same species but are more divergent than expected. To truly resolve phylogenetic questions, we need whole genome data and appropriate reference genomes.</p><disp-quote content-type="editor-comment"><p>Reviewer #3 (Recommendations for the authors):</p><p>My main concerns come from not being entirely certain what the proper scope is for such an investigation – I will elaborate a bit below, and I am totally happy to defer to the editor or other reviewers on what they feel is best here. But as a reader, I was particularly interested to get more detail on the advantages and disadvantages of different approaches (since the amplicon panel itself is already published elsewhere). Currently, it reads as a bit path dependent – the authors develop their nearest-neighbor scheme, show that it performs well at coarser scales but not finer scales, and then develop the VAE approach to assign within coarser groups.</p></disp-quote><p>This is a valid critique. However, our priority was to develop a functional method to perform species assignment with this amplicon panel. For a structured study to obtain the optimal assignment method, we’d have to investigate which encodings, projections and clustering methods work best for these data. This would be very interesting, but quite a tour de force. Below we have addressed the suggestions raised in this review and we have conducted the experiments which we consider to be within the scope of this manuscript.</p><disp-quote content-type="editor-comment"><p>In particular, I think it would be quite valuable to see what factors determine the best approach here. My understanding is that the regularization approach used by VAE leads to more continuous distributions in a space that tends towards the origin. For species assignment, this could be a good or a bad thing, I suppose – it might perform better for ambiguous samples but worse for well defined but subtly differentiated lineages? UMAP, in contrast, would be expected to yield more compact and spaced apart clusters, I believe – this might have different advantages and disadvantages. In Makunin 2022 UMAP doesn't seem to work particularly well – is the improvement here from the kmer approach or the VAE? It would be helpful to know what are the key advances that make things work so much better here.</p></disp-quote><p>To address this question we have generated projections for the <italic>An. gambiae</italic> complex with UMAP. As for the VAE, we used 8-mer count tables as input. The UMAP projections do indeed show tighter clusters which are more spaced apart, compared to the clusters found in the VAE latent space. This removes the need for an assignment method that deals with the ‘fuzzy boundaries’ between clusters, like the convex hull assignment method, but it comes at the cost of some hard misclassifications (i.e. the UMAP cluster label is different from the label assigned from whole genome data) for which is is impossible to attach to samples a measure of uncertainty in cluster membership based on their position in the projection. See page 20 in the manuscript and the new Appendix 2 for the full description of the experiment and the comparison to the VAE assignments.</p><disp-quote content-type="editor-comment"><p>I am sensitive to the desire to develop a practical tool here, so I am happy to hear if others disagree with this assessment. But if the goal is to more generally translate recent advances in clustering high-dimensional data to the species assignment context, I think a slightly broader scope in the presentation of results would help substantially. These recommendations are premised on potentially providing a broadened comparison of species assignment approaches for this specific context (i.e. large numbers of moderately divergent amplicons) – just suggestions of what I think would more helpfully contextualize this work, not preconditions for my recommendation to accept this manuscript.</p><p>I would be very curious to see something like a summary at the end with a more direct comparison of assignment accuracy with:</p><p>1. Read alignment with traditional nearest neighbor assignment – doesn't perform perfectly.</p></disp-quote><p>We have not generated alignments for all of our test and training samples, because this presents a whole set of its own challenges and many of the amplicons will have extremely poor alignments across the wide set of species used here. If the alignment algorithm introduces big blocks of insertions and deletions to deal with highly diverged sequences, it is unclear what is a fair way to call variants. If instead of using multiple sequence alignments, we aligned to a reference genome, we’d have to choose which reference genome to use and how to deal with reference bias, which would be substantial – we’d likely have to use many different reference genomes. Because of these issues, and because the assignment performs better than the method presented in Makunin et al. 2022, we prefer to use <italic>k-</italic>mer based methods.</p><disp-quote content-type="editor-comment"><p>2. kmer tables with nearest neighbor performs incrementally better.</p><p>2a. Are 8mer tables actually the best tradeoff between robustness and sensitivity?</p></disp-quote><p>Our motivation for using <italic>8-</italic>mers is outlined on page 6 of the manuscript. We have also added a comparison between <italic>6</italic>-mers, <italic>8-</italic>mers and <italic>10</italic>-mers as VAE input in Appendix 4.</p><p>In the manuscript we demonstrate that the nearest neighbour method on <italic>k-</italic>mers can confidently distinguish most sufficiently diverged species. However, it generally doesn’t meet the assignment threshold of 0.8 for the samples within a species complex; see figure 3. Machine learning methods can improve the species-level assignments, while also providing a measure of uncertainty; which is important given the possibility of hybridisation. However, most machine learning methods require a large dataset of labelled samples, which is not available for every species complex.</p><disp-quote content-type="editor-comment"><p>3. Machine learning approaches can improve on this.</p><p>3a. VAE</p><p>3b. UMAP or t-SNE?</p><p>This could provide more general guidelines that could be translated into other systems, increasing the utility of the work for the community.</p></disp-quote><p>We compared assignments using VAE against assignments using UMAP (see above, and manuscript page 20 and Appendix 2). We did not compare against t-SNE projections, because t-SNE cannot learn a projection function from a set of training samples and then use that to map new samples onto the same projection. This introduces a dependency of the projection on the test set and makes it much harder to understand and quantify the reliability of the assignments. We added a section on this to the main text on page 19.</p></body></sub-article></article>