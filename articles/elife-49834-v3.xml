<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.1 20151215//EN"  "JATS-archivearticle1.dtd"><article article-type="research-article" dtd-version="1.1" xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn pub-type="epub" publication-format="electronic">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">49834</article-id><article-id pub-id-type="doi">10.7554/eLife.49834</article-id><article-categories><subj-group subj-group-type="display-channel"><subject>Research Article</subject></subj-group><subj-group subj-group-type="heading"><subject>Neuroscience</subject></subj-group></article-categories><title-group><article-title>Reinforcement biases subsequent perceptual decisions when confidence is low, a widespread behavioral phenomenon</article-title></title-group><contrib-group><contrib contrib-type="author" corresp="yes" id="author-58253"><name><surname>Lak</surname><given-names>Armin</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-1926-5458</contrib-id><email>armin.lak@dpag.ox.ac.uk</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="other" rid="fund1"/><xref ref-type="other" rid="fund15"/><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-149446"><name><surname>Hueske</surname><given-names>Emily</given-names></name><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="aff" rid="aff5">5</xref><xref ref-type="other" rid="fund6"/><xref ref-type="other" rid="fund7"/><xref ref-type="other" rid="fund8"/><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-149447"><name><surname>Hirokawa</surname><given-names>Junya</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-1238-5713</contrib-id><xref ref-type="aff" rid="aff6">6</xref><xref ref-type="aff" rid="aff7">7</xref><xref ref-type="fn" rid="con3"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-149448"><name><surname>Masset</surname><given-names>Paul</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-2001-7515</contrib-id><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="aff" rid="aff6">6</xref><xref ref-type="aff" rid="aff8">8</xref><xref ref-type="fn" rid="con4"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-149449"><name><surname>Ott</surname><given-names>Torben</given-names></name><xref ref-type="aff" rid="aff6">6</xref><xref ref-type="aff" rid="aff9">9</xref><xref ref-type="fn" rid="con5"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-166435"><name><surname>Urai</surname><given-names>Anne E</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0001-5270-6513</contrib-id><xref ref-type="aff" rid="aff6">6</xref><xref ref-type="aff" rid="aff10">10</xref><xref ref-type="other" rid="fund9"/><xref ref-type="fn" rid="con6"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-74960"><name><surname>Donner</surname><given-names>Tobias H</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-7559-6019</contrib-id><xref ref-type="aff" rid="aff10">10</xref><xref ref-type="other" rid="fund5"/><xref ref-type="other" rid="fund14"/><xref ref-type="fn" rid="con7"/><xref ref-type="fn" rid="conf2"/></contrib><contrib contrib-type="author" id="author-13133"><name><surname>Carandini</surname><given-names>Matteo</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-4880-7682</contrib-id><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="other" rid="fund4"/><xref ref-type="fn" rid="con8"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-6862"><name><surname>Tonegawa</surname><given-names>Susumu</given-names></name><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="aff" rid="aff11">11</xref><xref ref-type="other" rid="fund6"/><xref ref-type="other" rid="fund7"/><xref ref-type="other" rid="fund8"/><xref ref-type="fn" rid="con9"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-10010"><name><surname>Uchida</surname><given-names>Naoshige</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-5755-9409</contrib-id><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="other" rid="fund2"/><xref ref-type="other" rid="fund16"/><xref ref-type="other" rid="fund13"/><xref ref-type="fn" rid="con10"/><xref ref-type="fn" rid="conf3"/></contrib><contrib contrib-type="author" corresp="yes" id="author-1230"><name><surname>Kepecs</surname><given-names>Adam</given-names></name><email>akepecs@wustl.edu</email><xref ref-type="aff" rid="aff6">6</xref><xref ref-type="aff" rid="aff9">9</xref><xref ref-type="other" rid="fund11"/><xref ref-type="fn" rid="con11"/><xref ref-type="fn" rid="conf1"/></contrib><aff id="aff1"><label>1</label><institution>Department of Physiology, Anatomy and Genetics, University of Oxford</institution><addr-line><named-content content-type="city">Oxford</named-content></addr-line><country>United Kingdom</country></aff><aff id="aff2"><label>2</label><institution>UCL Institute of Ophthalmology, University College London</institution><addr-line><named-content content-type="city">London</named-content></addr-line><country>United Kingdom</country></aff><aff id="aff3"><label>3</label><institution>Department of Molecular and Cellular Biology and Center for Brain Science, Harvard University</institution><addr-line><named-content content-type="city">Cambridge</named-content></addr-line><country>United States</country></aff><aff id="aff4"><label>4</label><institution>RIKEN-MIT Laboratory at the Picower Institute for Learning and Memory at Department of Biology and Department of Brain and Cognitive Science, Massachusetts Institute of Technology</institution><addr-line><named-content content-type="city">Cambridge</named-content></addr-line><country>United States</country></aff><aff id="aff5"><label>5</label><institution>McGovern Institute for Brain Research at Department of Brain and Cognitive Sciences, Massachusetts Institute of Technology</institution><addr-line><named-content content-type="city">Cambridge</named-content></addr-line><country>United States</country></aff><aff id="aff6"><label>6</label><institution>Cold Spring Harbor Laboratory</institution><addr-line><named-content content-type="city">Cold Spring Harbor</named-content></addr-line><country>United States</country></aff><aff id="aff7"><label>7</label><institution>Graduate School of Brain Science, Doshisha University, Kyotanabe</institution><addr-line><named-content content-type="city">Kyoto</named-content></addr-line><country>Japan</country></aff><aff id="aff8"><label>8</label><institution>Watson School of Biological Sciences</institution><addr-line><named-content content-type="city">Cold Spring Harbor</named-content></addr-line><country>United States</country></aff><aff id="aff9"><label>9</label><institution>Departments of Neuroscience and Psychiatry, Washington University School of Medicine</institution><addr-line><named-content content-type="city">St. Louis</named-content></addr-line><country>United States</country></aff><aff id="aff10"><label>10</label><institution>Department of Neurophysiology, University Medical Center, Hamburg-Eppendorf</institution><addr-line><named-content content-type="city">Hamburg</named-content></addr-line><country>Germany</country></aff><aff id="aff11"><label>11</label><institution>Howard Hughes Medical Institute at Massachusetts Institute of Technology</institution><addr-line><named-content content-type="city">Cambridge</named-content></addr-line><country>United States</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Salinas</surname><given-names>Emilio</given-names></name><role>Reviewing Editor</role><aff><institution>Wake Forest School of Medicine</institution><country>United States</country></aff></contrib><contrib contrib-type="senior_editor"><name><surname>Frank</surname><given-names>Michael J</given-names></name><role>Senior Editor</role><aff><institution>Brown University</institution><country>United States</country></aff></contrib></contrib-group><pub-date date-type="publication" publication-format="electronic"><day>15</day><month>04</month><year>2020</year></pub-date><pub-date pub-type="collection"><year>2020</year></pub-date><volume>9</volume><elocation-id>e49834</elocation-id><history><date date-type="received" iso-8601-date="2019-07-01"><day>01</day><month>07</month><year>2019</year></date><date date-type="accepted" iso-8601-date="2020-04-09"><day>09</day><month>04</month><year>2020</year></date></history><permissions><copyright-statement>© 2020, Lak et al</copyright-statement><copyright-year>2020</copyright-year><copyright-holder>Lak et al</copyright-holder><ali:free_to_read/><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><ali:license_ref>http://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-49834-v3.pdf"/><abstract><p>Learning from successes and failures often improves the quality of subsequent decisions. Past outcomes, however, should not influence purely perceptual decisions after task acquisition is complete since these are designed so that only sensory evidence determines the correct choice. Yet, numerous studies report that outcomes can bias perceptual decisions, causing spurious changes in choice behavior without improving accuracy. Here we show that the effects of reward on perceptual decisions are principled: past rewards bias future choices specifically when previous choice was difficult and hence decision confidence was low. We identified this phenomenon in six datasets from four laboratories, across mice, rats, and humans, and sensory modalities from olfaction and audition to vision. We show that this choice-updating strategy can be explained by reinforcement learning models incorporating statistical decision confidence into their teaching signals. Thus, reinforcement learning mechanisms are continually engaged to produce systematic adjustments of choices even in well-learned perceptual decisions in order to optimize behavior in an uncertain world.</p></abstract><kwd-group kwd-group-type="author-keywords"><kwd>reinforcement learning</kwd><kwd>uncertainty</kwd><kwd>reward</kwd><kwd>sensory decision</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research organism</title><kwd>Human</kwd><kwd>Mouse</kwd><kwd>Rat</kwd></kwd-group><funding-group><award-group id="fund1"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100004440</institution-id><institution>Wellcome</institution></institution-wrap></funding-source><award-id>106101</award-id><principal-award-recipient><name><surname>Lak</surname><given-names>Armin</given-names></name></principal-award-recipient></award-group><award-group id="fund2"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000002</institution-id><institution>National Institutes of Health</institution></institution-wrap></funding-source><award-id>R01MH110404</award-id><principal-award-recipient><name><surname>Uchida</surname><given-names>Naoshige</given-names></name></principal-award-recipient></award-group><award-group id="fund4"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100004440</institution-id><institution>Wellcome</institution></institution-wrap></funding-source><award-id>205093</award-id><principal-award-recipient><name><surname>Carandini</surname><given-names>Matteo</given-names></name></principal-award-recipient></award-group><award-group id="fund5"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100001659</institution-id><institution>Deutsche Forschungsgemeinschaft</institution></institution-wrap></funding-source><award-id>DO 1240/2-1</award-id><principal-award-recipient><name><surname>Donner</surname><given-names>Tobias H</given-names></name></principal-award-recipient></award-group><award-group id="fund6"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100006264</institution-id><institution>RIKEN</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Hueske</surname><given-names>Emily</given-names></name><name><surname>Tonegawa</surname><given-names>Susumu</given-names></name></principal-award-recipient></award-group><award-group id="fund7"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100007457</institution-id><institution>JPB Foundation</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Hueske</surname><given-names>Emily</given-names></name><name><surname>Tonegawa</surname><given-names>Susumu</given-names></name></principal-award-recipient></award-group><award-group id="fund8"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000011</institution-id><institution>Howard Hughes Medical Institute</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Hueske</surname><given-names>Emily</given-names></name><name><surname>Tonegawa</surname><given-names>Susumu</given-names></name></principal-award-recipient></award-group><award-group id="fund9"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100001655</institution-id><institution>German Academic Exchange Service</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Urai</surname><given-names>Anne E</given-names></name></principal-award-recipient></award-group><award-group id="fund11"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000002</institution-id><institution>National Institutes of Health</institution></institution-wrap></funding-source><award-id>R01DA038209</award-id><principal-award-recipient><name><surname>Kepecs</surname><given-names>Adam</given-names></name></principal-award-recipient></award-group><award-group id="fund13"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100007229</institution-id><institution>Harvard University</institution></institution-wrap></funding-source><award-id>Mind Brain Behavior (MBB) Faculty Award</award-id><principal-award-recipient><name><surname>Uchida</surname><given-names>Naoshige</given-names></name></principal-award-recipient></award-group><award-group id="fund14"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100001659</institution-id><institution>Deutsche Forschungsgemeinschaft</institution></institution-wrap></funding-source><award-id>DO 1240/3-1</award-id><principal-award-recipient><name><surname>Donner</surname><given-names>Tobias H</given-names></name></principal-award-recipient></award-group><award-group id="fund15"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100004440</institution-id><institution>Wellcome</institution></institution-wrap></funding-source><award-id>213465</award-id><principal-award-recipient><name><surname>Lak</surname><given-names>Armin</given-names></name></principal-award-recipient></award-group><award-group id="fund16"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000002</institution-id><institution>National Institutes of Health</institution></institution-wrap></funding-source><award-id>R01MH097061</award-id><principal-award-recipient><name><surname>Kepecs</surname><given-names>Adam</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>Confidence-dependent reinforcement learning is active and produces trial-to-trial choice updating even in well-learned perceptual decisions without explicit reward biases, across species and sensory modalities.</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>Learning from the outcomes of decisions can improve subsequent decisions and yield greater success. For instance, to find the best meal on a busy street where restaurants often change menus, one needs to frequently sample food and learn. Humans and other animals efficiently learn from past rewards and choose actions that have recently lead to the best rewards (<xref ref-type="bibr" rid="bib10">Daw et al., 2006</xref>; <xref ref-type="bibr" rid="bib29">Lee et al., 2012</xref>; <xref ref-type="bibr" rid="bib38">Samejima et al., 2005</xref>; <xref ref-type="bibr" rid="bib44">Tai et al., 2012</xref>). In addition to evaluating past rewards, decision making often require consideration of present perceptual signals; the restaurants’ signs along the busy street might be too far and faded to be trusted. Therefore, good decisions ought to take into account both current sensory evidence as well as the prior history of successes and failures.</p><p>Decisions guided by the history of rewards can be studied in a reinforcement learning framework (<xref ref-type="bibr" rid="bib43">Sutton and Barto, 1998</xref>). Perceptual decisions, on the other hand, have been classically conceptualized within a statistical, psychometric framework (<xref ref-type="bibr" rid="bib21">Green and Swets, 1966</xref>). Although statistical decision theory and reinforcement learning provide two largely distinct frameworks for studying decisions, we are often challenged by both limits in our perception as well as limits in learning from past rewards. For sensory decisions, classical psychometric analysis estimates three fundamental variables that determine the quality of choices: the bias, lapse rate and sensitivity (<xref ref-type="bibr" rid="bib21">Green and Swets, 1966</xref>; <xref ref-type="bibr" rid="bib48">Wichmann and Hill, 2001</xref>). When bias and lapse rates are negligible and sensitivity has reached its maximum over time, then fluctuations in decisions are solely attributed to the noise in the perceptual processing. Under these assumptions, incorrect decisions are caused by perceptual noise creating imperfect percepts. Here, we show a systematic deviation from the assumption of no learning during well-trained perceptual decisions: past rewards bias perceptual choices specifically when the previous stimulus was difficult to judge, and the confidence in obtaining the reward was low.</p><p>In laboratory perceptual decision-making paradigms, there is typically no overt learning after the task acquisition is complete. Nevertheless, several studies have shown that past rewards, actions, and stimuli can appreciably influence subsequent perceptual choices (<xref ref-type="bibr" rid="bib1">Abrahamyan et al., 2016</xref>; <xref ref-type="bibr" rid="bib2">Akaishi et al., 2014</xref>; <xref ref-type="bibr" rid="bib3">Akrami et al., 2018</xref>; <xref ref-type="bibr" rid="bib4">Braun et al., 2018</xref>; <xref ref-type="bibr" rid="bib8">Busse et al., 2011</xref>; <xref ref-type="bibr" rid="bib9">Cho et al., 2002</xref>; <xref ref-type="bibr" rid="bib15">Fan et al., 2018</xref>; <xref ref-type="bibr" rid="bib16">Fischer and Whitney, 2014</xref>; <xref ref-type="bibr" rid="bib17">Fritsche et al., 2017</xref>; <xref ref-type="bibr" rid="bib18">Fründ et al., 2014</xref>; <xref ref-type="bibr" rid="bib20">Gold et al., 2008</xref>; <xref ref-type="bibr" rid="bib25">Hwang et al., 2017</xref>; <xref ref-type="bibr" rid="bib30">Lueckmann et al., 2018</xref>; <xref ref-type="bibr" rid="bib31">Luu and Stocker, 2018</xref>; <xref ref-type="bibr" rid="bib33">Marcos et al., 2013</xref>; <xref ref-type="bibr" rid="bib45">Tsunada et al., 2019</xref>; <xref ref-type="bibr" rid="bib47">Urai et al., 2017</xref>). Some of these observations support the view that simple forms of reward-based learning are at work during asymptotic perceptual performance. For instance, subjects might repeat the previously rewarded choice or avoid it after an unsuccessful trial (<xref ref-type="bibr" rid="bib1">Abrahamyan et al., 2016</xref>; <xref ref-type="bibr" rid="bib8">Busse et al., 2011</xref>; <xref ref-type="bibr" rid="bib45">Tsunada et al., 2019</xref>; <xref ref-type="bibr" rid="bib47">Urai et al., 2017</xref>). However, these types of choices biases seem to be suboptimal and might reflect simple heuristics. Thus, the extent to which choice biases in perceptual decisions can be expected from normative considerations in reinforcement learning has been unclear. Perhaps, the most prominent prediction of reinforcement learning under perceptual uncertainty is that the strength of sensory evidence (i.e. confidence in the accuracy of a decision) should modulate how much to learn from the outcome of a decision (<xref ref-type="bibr" rid="bib27">Lak et al., 2017</xref>; <xref ref-type="bibr" rid="bib28">Lak et al., 2019</xref>). Outcomes of easy decisions are highly predictable, and thus there is little to be learned from such decisions. In contrast, outcomes of difficult, low confidence decisions, provide the most prominent opportunity to learn and adjust subsequent decisions (<xref ref-type="bibr" rid="bib27">Lak et al., 2017</xref>; <xref ref-type="bibr" rid="bib28">Lak et al., 2019</xref>). These considerations lead to the hypothesis that decision confidence regulates trial-by-trial biases in perceptual choices.</p><p>Here, we demonstrate that well-trained perceptual decisions can be systematically biased based on previous outcomes in addition to current sensory evidence. We show that these outcome-dependent biases depend on the strength of past sensory evidence, suggesting that they are consequences of confidence-guided updating of choice strategy. We demonstrate that this form of choice updating is a widespread behavioral phenomenon that can be observed across various perceptual decision-making paradigms in mice, rats and humans. This trial-to-trial choice bias was also present in different sensory modalities and transferred across modalities in an interleaved auditory/olfactory choice task. To explain these observations, we present a class of reinforcement learning models and Bayesian classifiers that adjust learning based on the statistical confidence in the accuracy of previous decisions.</p></sec><sec id="s2" sec-type="results"><title>Results</title><sec id="s2-1"><title>Perceptual decisions are systematically updated by past rewards and past sensory stimuli</title><p>To investigate how the history of rewards and stimuli influences subsequent perceptual decisions, we began with an olfactory decision task (<xref ref-type="fig" rid="fig1">Figure 1a</xref>). Rats were trained on a two-alternative choice olfactory decision task (<xref ref-type="bibr" rid="bib46">Uchida and Mainen, 2003</xref>). Two primary odors were associated with rewards at left and right choice ports and mixtures (morphs) of these odors were rewarded according to a categorical boundary (50:50 mixture; <xref ref-type="fig" rid="fig1">Figure 1a</xref>). To manipulate perceptual uncertainty, we varied the odor mixtures, that is the ratio of odor A and B in a trial-by-trial manner, testing mixtures 100:0, 80:20, 65:35, 55:45, 45:55, 35:65, 20:80 and 0:100. Rats showed near-perfect performance for easy mixtures and made errors more frequently for difficult mixtures (<xref ref-type="fig" rid="fig1">Figure 1a</xref>, bottom panel).</p><fig-group><fig id="fig1" position="float"><label>Figure 1.</label><caption><title>Rats update their trial-by-trial perceptual choice strategy in a stimulus-dependent manner.</title><p>(<bold>a</bold>) Top: Schematic of a 2AFC olfactory decision-making task for rats. Bottom) Average performance of an example rat. (<bold>b</bold>) Following learning, the psychometric curves showed minimal fluctuations across test sessions. Bias, sensitivity and lapse were measured for each test session. (<bold>c</bold>) After successful completion of a trial, rats tended to shift their choice toward the previously rewarded side. Left and right panels illustrate example animal and population average. (<bold>d</bold>) Schematic of analysis procedure for computing conditional psychometric curves and updating plots. Left: Black curve shows the overall psychometric curve and the green curve shows the curve only after trials with 48% odor A (i.e. conditional on the stimulus (48% A) in the previous trial). Middle: Each point in the heatmap indicates the vertical difference between data points of the conditional psychometric curve and the overall psychometric curve. Red and purple boxes indicate data points which are averaged to compute data points shown in the rightmost plot. Right: Updating averaged across current easy trials (in this case the easiest two stimulus levels) and current difficult trials. (<bold>e</bold>) Performance of the example rat (left) and population (right) computed separately based on the quality of olfactory stimulus (shown as colors mixtures from blue to green) in the previously rewarded trial. After successful completion of a trial, rats tended to shift their choices towards the previously rewarded side but only when the previous trial was difficult. (<bold>f</bold>) Choice updating, that is the size of shift of psychometric curve relative to the average psychometric curve, as a function of sensory evidence in the previously rewarded trial, and current trial. Positive numbers refer to a bias towards choice A and negative numbers refer to a bias toward the alternative choice. The left and right plots refer to the example rat and population, respectively. (<bold>g</bold>) Choice updating as a function of previous stimulus separated for current easy (square) and difficult (circle) trials. These plots are representing averages across graphs presented in f.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-49834-fig1-v3.tif"/></fig><fig id="fig1s1" position="float" specific-use="child-fig"><label>Figure 1—figure supplement 1.</label><caption><title>Left: Performance of population of rats (n=16) computed from trials in which the previous stimulus was difficult (45% odor A, 55% odor B), separated based on whether the previous choice was rewarded (correct) or unrewarded (error).</title><p>Right: Performance of population of rats (n=16) computed from trials in which the previous stimulus was easy (20% odor A, 80% odor B), separated based on whether the previous choice was rewarded (correct) or unrewarded (error).</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-49834-fig1-figsupp1-v3.tif"/></fig></fig-group><p>After task learning, rats showed stable behavior across testing sessions (<xref ref-type="fig" rid="fig1">Figure 1b</xref>). To quantify behavioral performance and stability across sessions, we fitted choice behavior with psychometric functions that included parameters for sensitivity (reflecting perceptual noise), bias (the tendency to take one specific action) and lapse rate (stimulus-independent occasional errors possibly reflecting attentional or learning deficits) (<xref ref-type="fig" rid="fig1">Figure 1a, b</xref>). We found that in well-trained rats, the bias was near zero (2±4.6 %Odor A (mean± S.D), p = 0.08, signed rank test). Likewise, lapse rates were low (3±4%), indicating that for easy stimuli rats’ performance was near perfect and not substantially degraded by attention or incomplete learning. Lapse rate, sensitivity and bias remained stable over sessions, indicating that rats reached asymptotic performance (<xref ref-type="fig" rid="fig1">Figure 1b</xref>, 14/16 rats, p &gt; 0.1, linear regression).</p><p>Despite the stable, asymptotic performance for easy decisions, previous trials had substantial effects on subsequent choices (<xref ref-type="fig" rid="fig1">Figure 1c</xref>). In order to assess the effects of reinforcement on perceptual decisions, we calculated conditional psychometric functions. We first considered the effect of previous choice (<xref ref-type="fig" rid="fig1">Figure 1c</xref>). Psychometric functions were systematically biased by previously rewarded choices: after correct leftward choices rats tended to make a left choice. Conversely, following correct rightward choices, animals made rightward choices more often (F = 29.8, p=0.001, 2-way ANOVA).</p><p>The effects of the previous decision on subsequent choices also depended on the difficulty of the previous choices (<xref ref-type="fig" rid="fig1">Figure 1d-g</xref>). We computed psychometric functions after correct (and hence rewarded) trials separately for different stimuli of the previous trial (<xref ref-type="fig" rid="fig1">Figure 1d</xref>). The resulting psychometric functions were systematically biased towards the recently rewarded side for difficult decisions (<xref ref-type="fig" rid="fig1">Figure 1e</xref>). Rats tended to repeat their previous choices particularly when they succeeded to correctly categorize a challenging odor mixture and earn reward (<xref ref-type="fig" rid="fig1">Figure 1e</xref>). We quantified the magnitude of this choice bias for each pair of current and previous stimuli (<xref ref-type="fig" rid="fig1">Figure 1d</xref>, see Materials and methods). To do so, we subtracted the average psychometric curve (computed from all trials) from each psychometric curve computed conditional on the specific previous correct stimulus, and plotted the size and sign of this difference (positive: bias to choose A; negative: bias to choose B) (<xref ref-type="fig" rid="fig1">Figure 1d,f</xref>). To summarize choice biases, we then averaged these differences across trials in which the current choice was easy or difficult (<xref ref-type="fig" rid="fig1">Figure 1d,g</xref>). The magnitude of this choice bias was proportional to the difficulty of the previous decision, in addition to the difficulty of the current decision (<xref ref-type="fig" rid="fig1">Figure 1f</xref>). Updating was minimal when the current stimulus was easy, regardless of the difficulty of the previous decision (<xref ref-type="fig" rid="fig1">Figure 1g</xref>, squares). This is because the data points are overlapping when the current stimulus is easy, and hence the distance between them is close to zero (<xref ref-type="fig" rid="fig1">Figure 1d,e</xref>). When the current stimulus was difficult, updating was also minimal after correct easy choices, whereas it was strong following correct difficult choices (<xref ref-type="fig" rid="fig1">Figure 1g</xref>, circles, p=0.0002, rank sum test). Thus, when the current sensory evidence was strong, it determined the choice, without detectable effects of the previous trial (<xref ref-type="fig" rid="fig1">Figure 1g</xref>, squares). However, when the sensory evidence in the current trial was weak, the previous reward influenced choices only if the reward was earned in a difficult trial (<xref ref-type="fig" rid="fig1">Figure 1g</xref>, circles). The difficulty of previous decision did not influence the slope (sensitivity) nor the lapse of psychometric curves in the next trial (p&gt;0.1 rank sum test). Additionally, plotting the psychometric curves conditional on the specific stimulus in the previous trial but separated according to the outcome of the previous trial (correct vs error) further illustrated that past outcome influence subsequent choice in particular when the previous choice was difficult (<xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>). Together, these observations indicate that the effects of past rewards on perceptual choices depend on the difficulty of the previous perceptual judgments.</p></sec><sec id="s2-2"><title>Choice updating is not due to slow drifts in choice side bias</title><p>The results so far demonstrate that previous rewards influence subsequent perceptual decisions especially when the previous decision was difficult. One possibility is that these behavioral effects arise as a byproduct of slow fluctuations of side bias causing correlations across consecutive trials and hence systematic shifts in choices. This scenario can be illustrated within a signal detection theory (SDT) framework. In SDT, the perceived stimulus is compared to a decision boundary and produces a correct choice when the stimulus falls on the appropriate side of the boundary (<xref ref-type="fig" rid="fig2">Figure 2a</xref>). When the decision boundary is fixed, there is no apparent updating, as expected (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1a, b</xref>). However, simulating a slowly drifting decision boundary reveals systematic effects of previous trials on next choices, because the drifting boundary induces correlations across trials, producing apparent choice updating based on the previous trials (<xref ref-type="fig" rid="fig2">Figure 2b</xref>; <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1c, d</xref>). For instance, if the decision boundary slowly drifts to the left side then rightward choices will be more frequent and occur in succession, producing a shift in the psychometric curve (<xref ref-type="fig" rid="fig2">Figure 2b</xref>). Importantly, this effect is independent of decision outcomes and is observed in a sequence of trials, both before and after a rewarded trial (<xref ref-type="fig" rid="fig2">Figure 2b</xref>). An alternative, more intriguing, scenario for explaining our results is an active learning process that produces trial-by-trial adjustment of the decision boundary. If the decision boundary is adjusted in a trial-by-trial manner according to the outcome of the previous trial, psychometric shifts will be observed in the next trial contingent on the past reward, but absent in the preceding trial (<xref ref-type="fig" rid="fig2">Figure 2c</xref>). It is thus critical to remove slow fluctuations of side bias, before concluding that psychometric shifts are signatures of an active learning process.</p><fig-group><fig id="fig2" position="float"><label>Figure 2.</label><caption><title>Choice updating is not due to slow and nonspecific drift in response bias.</title><p>(<bold>a</bold>) Signal detection theory-inspired schematic of task performance. The psychometric curve illustrates the average choice behavior. (<bold>b</bold>) Slow non-specific drift in choice bias, visualized here as drift in the decision boundary, could lead to shift in psychometric curves which persisted for several trials and was not specific to stimulus and outcome of the previous trial. This global bias effect is cancelled when subtracting the psychometric curve of trial<sub>t-1</sub> (orange) from trial<sub>t+1</sub> (brown). (<bold>c</bold>) Trial-by-trial updating of decision boundary shifts psychometric curves depending on the outcome and perceptual difficulty of the preceding trial. Subtracting psychometric curves does not cancel this effect. (<bold>d</bold>) Choice bias of the example rat following a rewarded trial. (<bold>e</bold>) Similar to d but for population. (<bold>f</bold>) Choice bias of the example rat in one trial prior to current trial, reflecting global nonspecific bias visualized in b. (<bold>g</bold>) Similar to f but for population. (<bold>h</bold>) Subtracting choice bias in trial<sub>t-1</sub> from trial<sub>t+1</sub> reveals the trial-by-trial choice updating in the example rat. (<bold>i</bold>) Similar to h but for the population. See <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref> for details of the normalization procedure.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-49834-fig2-v3.tif"/></fig><fig id="fig2s1" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 1.</label><caption><title>Isolation and correction of slowly drifting non-specific choice bias.</title><p>(<bold>a,b</bold>) A simple signal detection theory-based simulation with a fixed decision boundary. In this model, stimuli are drawn from a normal distribution and are compared to a fixed decision boundary (50%) for choice computation. This model generates psychometric curves that are not depending on the previous trial (left panel in a) and hence no updating is observed (middle and right panel in a). Our normalization (explained in e) does not influence updating in this model, as shown in b. (<bold>c,d</bold>) A signal detection theory-based simulation using a slowly drifting decision boundary. Psychometric curves appear to depend on the previous trial (left panel in c), resulting in apparent updating effect (middle and right panels in c). However, this effect is removed after applying our normalization as shown in d. (<bold>e</bold>) The normalization procedure for isolating trial-by-trial updating. Upper row middle panel shows the performance for two levels of stimuli (48 and 52%) which were both rewarded, hence the delta function. Upper row left panel shows the psychometric curves separately for trials followed by 48% or 52% stimuli. Any separation between these curves indicates a side bias which extend beyond a single trial. Upper right panel shows psychometric curves separately computed based on whether the stimulus in trial t was 48 or 52%. The full conditional psychometric curves in trial t-1 and t and in trial t and t+1 were used to compute heatmaps (middle row). The heatmap of t-1 was subtracted from the heatmap of t+1 to compute normalized trial-by-trial updating (lowest row).</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-49834-fig2-figsupp1-v3.tif"/></fig></fig-group><p>We next asked to what extent the trial history effects we observed reflect correlations across consecutive trials due to slowly fluctuating bias over trials. To do so, we devised a model-independent analysis to identify and remove slow fluctuations of side bias (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>). While it is possible to formulate model-based analyses to correct for slow biases, there are numerous possibilities that could produce similar fluctuations. Therefore, we sought a model-independent technique, reasoning that slow fluctuations are, by definition, slower than one trial, and hence should have largely similar impact across adjacent trials. Specifically, slow fluctuations will produce similar biases one trial before and after a given decision outcome. This assumption leads to a simple strategy to correct for possible slow drifts and isolate psychometric curve shifts due to active processes: subtracting the psychometric shifts between trial t and t-1 from that of trial t+1 and t removes the effect of slow response bias, that is slow boundary drift. Importantly, applying this normalization to the STD model with a drifting decision boundary removes the apparent but artefactual dependence of decisions on previous trials (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1d</xref>). This subtraction technique thus provides an estimate of how the current trial influences choices in the next trial. Another intuition for this analysis is that future rewards cannot influence past choices, and therefore any systematic dependence of psychometric curves on next trials cannot reflect causal mechanisms and need to be adjusted for. We thus define ‘choice updating’ as a trial-by-trial bias beyond slowly fluctuating and non-specific side biases.</p><p>We found that the difficulty of previous choices had a strong effect on subsequent choices in rat olfactory discriminations even after correcting for slow fluctuations in the choice bias (<xref ref-type="fig" rid="fig2">Figure 2d–i</xref>). We computed the psychometric curves conditional on stimuli and outcomes, for both the next trial (<xref ref-type="fig" rid="fig2">Figure 2d,e</xref>) and also the previous trial (<xref ref-type="fig" rid="fig2">Figure 2f,g</xref>). Choice biases tended to be larger when considering the next trial compared to the previous trial. The difference between these provides an estimate of choice updating that is due to the most recent reward and without slow and non-outcome specific fluctuations in side bias (<xref ref-type="fig" rid="fig2">Figure 2h,i</xref>). The choice updating effect remained statistically significant even after this correction (p=0.003, rank sum test). These results rule out the possibility that psychometric shifts are only due to slow drift in side bias and indicate that reward received in the past trial influences subsequent perceptual decisions specifically if the sensory evidence in the previous trial was uncertain and difficult to judge.</p></sec><sec id="s2-3"><title>Belief-based reinforcement learning models account for choice updating</title><p>We next considered what types of reinforcement learning processes could account for the observed choice updating effects. Reinforcement learning models have been long used to study how choices are influenced by past decisions and rewards (<xref ref-type="bibr" rid="bib11">Daw and Doya, 2006</xref>; <xref ref-type="bibr" rid="bib43">Sutton and Barto, 1998</xref>). A key distinction between RL model variants is whether and how they treat ambiguous signals for state inference and prediction error computation.</p><p>We show that a reinforcement learning model with a belief-state representing ambiguous perceptual stimuli accounts for choice updating (<xref ref-type="fig" rid="fig3">Figure 3a,b</xref>). A reinforcement model for our behavioral task has to consider the inherent perceptual ambiguity in sensory decisions in addition to tracking reward outcomes. The normative way to cope with such ambiguity about state representations is to introduce a partially observable Markov decision process (POMDP) framework for the temporal difference RL (TDRL) algorithm (<xref ref-type="bibr" rid="bib12">Dayan and Daw, 2008</xref>; <xref ref-type="bibr" rid="bib27">Lak et al., 2017</xref>; <xref ref-type="bibr" rid="bib28">Lak et al., 2019</xref>; <xref ref-type="bibr" rid="bib37">Rao, 2010</xref>). POMDPs capture the intuitive notion that when perception is ambiguous, the model needs to estimate current perceptual experience as a ‘belief state’, which expresses state uncertainty as a probability distribution over states.</p><fig-group><fig id="fig3" position="float"><label>Figure 3.</label><caption><title>Belief-based reinforcement learning model accounts for choice updating.</title><p>(<bold>a</bold>) Left: schematics of the temporal difference reinforcement learning (TDRL) model that includes belief state reflecting perceptual decision confidence. Right: predicted values and reward prediction errors of the model. After receiving a reward, reward prediction errors depend on the difficulty of the choice and are largest after a hard decision. Reward prediction errors of this model are sufficient to replicate our observed choice updating effect. (<bold>b</bold>) Choice updating of the model shown in a. This effect can be observed even after correcting for non-specific drifts in the choice bias (right panel). The model in all panels had <inline-formula><mml:math id="inf1"><mml:msup><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math></inline-formula>=0.2 and <inline-formula><mml:math id="inf2"><mml:mi>α</mml:mi></mml:math></inline-formula>=0.5. (<bold>c</bold>) A TDRL model which follows a Markov decision process (MDP) and that does not include decision confidence into prediction error computation produces choice updating that is largely independent of the difficulty of the previous decision. (<bold>d</bold>) A MDP TDRL model that includes slow non-specific drift in choice bias fails to produce true choice updating. The normalization removes the effect of drift in the choice bias, but leaves the difficulty-independent effect of past reward (<bold>e</bold>) A MDP TDRL model that includes win-stay-lose-switch strategy fails to produce true choice updating. For this simulation, win-stay-lose-switch strategy is applied to 10% of randomly-selected trials. See <xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1</xref> and the Materials and methods for further details of the models.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-49834-fig3-v3.tif"/></fig><fig id="fig3s1" position="float" specific-use="child-fig"><label>Figure 3—figure supplement 1.</label><caption><title>Further characteristics of the confidence-dependent TDRL model and the MDP TDRL model.</title><p>(<bold>a</bold>) Confidence-dependent TDRL model which uses a softmax for computing choice produces confidence-dependent updating similar to the model run that uses argmax for choice computation. (<bold>b</bold>) Confidence-dependent choice updating is stronger after two rewarded difficult trials (left), consistent with the model predictions (right). Left panel shows the absolute size of choice updating computed after one rewarded difficult choice (black) and after two rewarded difficult choices to the same choice side (light red) (n=16 rats). Right panel shows the size of updating after one reward and two rewarded difficult choices. (<bold>c</bold>) The stored values of actions converge to different quantities in the confidence-dependent model and the MDP TDRL model. The stored value of left actions averaged over 1000 model runs are shown (the results would be same for the right actions). In both models, the size of delivered reward in correct trials was 1. (<bold>d</bold>) The difference in the prediction errors of the confidence-dependent model and the MDP TDRL model. The prediction errors in the confidence-dependent model results in choice updating in the next trial.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-49834-fig3-figsupp1-v3.tif"/></fig></fig-group><p>Previously, we showed that such a model is analogous to a TDRL model that uses statistical decision confidence, the conditional probability of getting reward given the choice, to scale prediction errors (<xref ref-type="bibr" rid="bib27">Lak et al., 2017</xref>). We reasoned that this model could also account for how uncertainty of past perceptual decisions influences learning and updating of subsequent perceptual choice. In the model, the rewards received after difficult, low confidence, choices lead to large reward prediction errors and hence the strong updating of decision values in the next trial (<xref ref-type="fig" rid="fig3">Figure 3a, b</xref>). The belief state in the model reflects the subject’s internal representations of a stimulus, which in the case of our 2AFC task is the probability that the stimulus belongs to the left or right category (<inline-formula><mml:math id="inf3"><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf4"><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>). To estimate these probabilities, the model assumes that the internal estimate of the stimulus, <inline-formula><mml:math id="inf5"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mover><mml:mi>s</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, is normally distributed with constant variance around the true stimulus contrast: <inline-formula><mml:math id="inf6"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>s</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>s</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mo>;</mml:mo><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mi>σ</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, where <inline-formula><mml:math id="inf7"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mover><mml:mi>s</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> parameterizes a belief distribution over all possible values of <inline-formula><mml:math id="inf8"><mml:mi>s</mml:mi></mml:math></inline-formula> that are consistent with the sensory evidence, given by Bayes rule:<disp-formula id="equ1"><mml:math id="m1"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mover><mml:mi>s</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>s</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>s</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover><mml:mi>s</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>Assuming that the prior belief about <inline-formula><mml:math id="inf9"><mml:mi>s</mml:mi></mml:math></inline-formula> is uniform, then the optimal belief will also be Gaussian, with the same variance as the sensory noise distribution, and mean given by <inline-formula><mml:math id="inf10"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mover><mml:mi>s</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>: <inline-formula><mml:math id="inf11"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mover><mml:mi>s</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>;</mml:mo><mml:mrow><mml:mover><mml:mi>s</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mo>,</mml:mo><mml:msup><mml:mi>σ</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>.</p><p>From this, the agent computes a belief, that is the probability that the stimulus was on the right side of the monitor, <inline-formula><mml:math id="inf12"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:mover><mml:mi>s</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>), according to:<disp-formula id="equ2"><mml:math id="m2"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover><mml:mi>s</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msubsup><mml:mo>∫</mml:mo><mml:mrow><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi mathvariant="normal">∞</mml:mi></mml:mrow></mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mover><mml:mi>s</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>d</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:mstyle></mml:math></disp-formula>where <inline-formula><mml:math id="inf13"><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> represents the trial-by-trial probability of the stimulus being on the right side and <inline-formula><mml:math id="inf14"><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> similarly represents the probability of it being on the left. Multiplying these probabilities with the learned action values of left and right, <inline-formula><mml:math id="inf15"><mml:msub><mml:mrow><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf16"><mml:msub><mml:mrow><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>, provides the expected values of left and right choices: <inline-formula><mml:math id="inf17"><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf18"><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>. The higher of these two determines the choice <inline-formula><mml:math id="inf19"><mml:mi>C</mml:mi></mml:math></inline-formula> (either <inline-formula><mml:math id="inf20"><mml:mi>L</mml:mi></mml:math></inline-formula> or <inline-formula><mml:math id="inf21"><mml:mi>R</mml:mi></mml:math></inline-formula>), its associated confidence <inline-formula><mml:math id="inf22"><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>, and its predicted value <inline-formula><mml:math id="inf23"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>Q</mml:mi><mml:mi>c</mml:mi></mml:msub><mml:mspace width="thinmathspace"/><mml:mo>=</mml:mo><mml:mspace width="thinmathspace"/><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>V</mml:mi><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>. Note that although the choice computation is deterministic, the same stimulus can produce left or right choices caused by fluctuations in the percept due to randomized trial-to-trial variation around the stimulus identity (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1a</xref>). Following the choice outcome, the model learns by updating the value of the chosen action by <inline-formula><mml:math id="inf24"><mml:msub><mml:mrow><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub><mml:mo>←</mml:mo><mml:msub><mml:mrow><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>α</mml:mi><mml:mi>δ</mml:mi></mml:math></inline-formula>, where <inline-formula><mml:math id="inf25"><mml:mi>α</mml:mi></mml:math></inline-formula> is a learning rate, and <inline-formula><mml:math id="inf26"><mml:msub><mml:mrow><mml:mi>δ</mml:mi><mml:mo>=</mml:mo><mml:mi>r</mml:mi><mml:mo>-</mml:mo><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is the reward prediction error. Thus, in this model, prediction error computation has access to the belief state used for computing the choice, and hence reward prediction error is scaled by the confidence in obtaining the reward (<xref ref-type="bibr" rid="bib27">Lak et al., 2017</xref>; <xref ref-type="bibr" rid="bib28">Lak et al., 2019</xref>). The largest positive prediction error occurs when receiving a reward after a difficult, low confidence, choice while receiving a reward after an easy choice results in a small prediction error (<xref ref-type="fig" rid="fig3">Figure 3a</xref>, right). After training, the choices produced by this model exhibit confidence-guided updating (<xref ref-type="fig" rid="fig3">Figure 3b</xref>, left), similar to those we observed in choices of rats. Similar to the data, the choice updating in this model persisted after accounting for possible slow fluctuations in the choice bias (<xref ref-type="fig" rid="fig3">Figure 3b</xref>, right). Note that RL models can produce correlations in choices across trials due to the correlation of stored values across trials, and hence it is important to evaluate the size of the updating effect after the normalization. An additional prediction of our model is that updating effect should be slightly stronger when considering trials preceded by two (rather than one) rewarded difficult choices in the same direction (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1b</xref>), which we also observed in rats’ choices (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1b</xref>).</p><p>We next considered whether classical TDRL models that follow a Markov decision process (MDP), could also produce confidence-guided updating. Such a model is largely similar to the model described above with one fundamental difference: the computation of prediction error does not have access to the belief state. In other words, prediction errors are computed by comparing the outcome with the average value of chosen action, without consideration of the belief in the accuracy of that action. In the model variant with two states (L and R), after learning, <inline-formula><mml:math id="inf27"><mml:msub><mml:mrow><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf28"><mml:msub><mml:mrow><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> reflect the average reward expectations for each choice and prediction errors are computed by comparing the outcome with this average expectation. Decisions made by this model show substantial effects of past reward (<xref ref-type="fig" rid="fig3">Figure 3c</xref>): after receiving a reward, the model has a tendency to make the same decision. However, compared to the belief-based model, this bias shows little dependence on the difficulty of the previous choice, and this dependence is absent after applying our normalization (<xref ref-type="fig" rid="fig3">Figure 3c</xref>, left). An extended version of this model that represents stimuli across multiple states also cannot reproduce confidence-dependent updating (see Materials and methods). Thus, MDP TDRL models (i.e. TDRL without a stimulus belief state) do not exhibit confidence-guided choice updating. We also considered whether a MDP TDRL model with slowly fluctuating response side bias could show trial-by-trial choice updating (<xref ref-type="fig" rid="fig3">Figure 3d</xref>). A modified MDP TDRL model that includes a slowly drifting side bias term showed a substantial effect of past reward on choices, which was mildly dependent on the difficulty of the previous sensory judgement (<xref ref-type="fig" rid="fig3">Figure 3d</xref>, left). This dependence, however, vanished after normalizing the choices to account for slowly drifting side bias (<xref ref-type="fig" rid="fig3">Figure 3d</xref>, right). This reveals that slowly fluctuating side bias in TDRL models without a belief state does not result in confidence-guided choice updating, despite apparent trial to trial fluctuations. The results also further confirm the effectiveness of our normalization procedure (i.e. subtracting the bias in the previous trials from next trials) in isolating trial-by-trial confidence-guided choice updating. We also ruled out the possibility that choice updating reflected an elementary win-stay strategy (<xref ref-type="fig" rid="fig3">Figure 3e</xref>). The decisions of an MDP TDRL model that was modified to include win-stay strategy (to repeat the previously rewarded choice, with p=10% in this example) show strong dependence on past rewards. The normalization removes the dependence of updating size on choice difficulty that is due to a correlation across choices. However, it does not remove the signatures of win-stay / loose-switch behavior (<xref ref-type="fig" rid="fig3">Figure 3e</xref>). Thus, in this model variant the effect of past rewards is independent of the difficulty of the previous choice, differing from the rat data in which the size of the bias induced by previous reward is proportional to the difficulty of the previous decision.</p><p>The predictions of the confidence-dependent TDRL and MDP TDRL models differ in two principal ways. First, the learned values of actions (<inline-formula><mml:math id="inf29"><mml:msub><mml:mrow><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf30"><mml:msub><mml:mrow><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>) converge to different values over learning (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1c</xref>). In the confidence-dependent TDRL, <inline-formula><mml:math id="inf31"><mml:msub><mml:mrow><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf32"><mml:msub><mml:mrow><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> both converge to just below the true size of reward. However, in the MDP TDRL model they converge to the average choice accuracy (average reward harvest), which is lower than the true reward size (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1c</xref>). This difference emerges because in the belief-based model values are updated using prediction errors scaled by confidence. Confidence is relatively low in the error trials, leading to small adjustments (reductions) of values after those trials, and hence the convergence of values to just below the true reward size (i.e. reward value, when the reward is given). This difference is important for understanding updating in particular in the case of very easy correct trials. In the confidence-dependent model, large confidence associated with a correct easy choice together with higher values of stored values produce <italic>Q</italic> values similar to the true reward size, and hence near-zero prediction errors when receiving the reward. However, in the MDP model, <italic>Q</italic> values are compared with relatively low stored values (compared to the reward value), and hence reward prediction errors persist even for very easy correct choices. The second major difference between the two models is how choice difficulty determines reward prediction errors and hence updating. While in the confidence-dependent model prediction errors depend on the choice difficulty (<xref ref-type="fig" rid="fig3">Figure 3a</xref>; <xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1d</xref>), in the MDP TDRL the prediction errors do not reflect choice difficulty (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1d</xref>, see Materials and methods). The prediction errors of the belief-based model thus result in graded levels of updating in the subsequent trials depending on the difficulty of the previous choice.</p></sec><sec id="s2-4"><title>On-line learning in margin-based classifiers explains choice updating</title><p>We next considered whether another class of models based on classifiers could also explain choice updating. Perceptual decision-making processes produce discrete choices from ambiguous sensory evidence. This process can be modelled with classifiers that learn a boundary in the space of sensory evidence. For instance, in our olfactory decision task evidence is a two-dimensional space spanned by the odor components A and B (<xref ref-type="fig" rid="fig4">Figure 4a</xref>). The hyperplane separating choice options creates a decision boundary determining whether each odor mixture is classified as A or B, which can be learned over trials. To apply these ideas to our decision tasks, we examine a probabilistic interpretation of Support Vector Machine (SVM) classifiers, a powerful technique from machine learning (see Materials and methods). SVMs learn classification hyperplanes that produce decision boundaries that are maximally far away from any data sample. Applying this framework to our particular decision problem requires an on-line implementation of a probabilistic interpretation of SVMs (<xref ref-type="bibr" rid="bib42">Sollich, 2002</xref>). In the SVM terminology, the distance of a sample <italic>x</italic> from the category boundary or hyperplane is called the ‘margin’ of the data point (orange arrow in <xref ref-type="fig" rid="fig4">Figure 4a</xref>). The size of the margin for a stimulus is proportional to the likelihood of that data point belonging to a class given the current classifier. After appropriate normalization, this model yields an estimate of the classification success for a given decision. Indeed, the Bayesian posterior of classification success is a normative definition of confidence (<xref ref-type="bibr" rid="bib22">Hangya et al., 2016</xref>; <xref ref-type="bibr" rid="bib35">Pouget et al., 2016</xref>).</p><fig id="fig4" position="float"><label>Figure 4.</label><caption><title>An on-line statistical classifier accounts for choice updating.</title><p>(<bold>a</bold>) Schematic of a classifier using Support Vector Machine for learning to categorize odor samples. The dashed line shows one possible hyperplane for classification and shaded area around the dashed line indicates the margin. Orange arrow indicates the distance between one data point and the classification hyperplane, that is the margin for that data point, given the hyperplane. Each circle is one odor sample in one trial. (<bold>b</bold>) Average estimates of the margins of the classifier. (<bold>c</bold>) The size of shift in the classification as a function of previous and current stimulus. (<bold>d</bold>) Choice updating as a function previous odor separated for current easy and hard choices.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-49834-fig4-v3.tif"/></fig><p>Simulation of this on-line, Bayesian SVM produces choice updating similar to that from the RL model (<xref ref-type="fig" rid="fig4">Figure 4b, c</xref>). Thus, statistical classifiers, in which the decision boundary is continuously updated in proportion to the estimated classification success (i.e. decision confidence), provides another account of choice updating. The core computational feature common to reinforcement learning and classifier models is that statistical decision confidence contributes to the trial-by-trial adjustment of choice bias.</p><p>In the following sections, we examine whether confidence-guided choice updating is observed in sensory modalities other than olfaction, and in species other than rats.</p></sec><sec id="s2-5"><title>Confidence-guided choice updating in rat auditory decisions</title><p>We next investigated decisions of rats performing a two-alternative auditory decision task (<xref ref-type="fig" rid="fig5">Figure 5</xref>). Rats were trained to report which of two auditory click trains delivered binaurally had a greater number of clicks (<xref ref-type="bibr" rid="bib39">Sanders et al., 2016</xref>; <xref ref-type="bibr" rid="bib40">Sanders and Kepecs, 2012</xref>; <xref ref-type="bibr" rid="bib6">Brunton et al., 2013</xref>; <xref ref-type="fig" rid="fig5">Figure 5a</xref>). The click trains were presented for 250 ms and generated using a Poisson process with the sum of the two rates held constant across trials. To control decision difficulty, the ratio of click rates for each side was randomly varied from trial to trial. The strength of evidence on a given trial was computed based on the number of clicks, that is the difference in the number of clicks between left and right divided by the total number of clicks. Rats showed steep psychometric curves (slope: 0.37±0.03, mean± S.D) with minor overall bias (-1±4.9% sound A) and near-zero lapse for easy stimuli (0.05±0.09%). We found that, similar to the olfactory task, difficult choices were biased in proportion to the difficulty of previous choice (<xref ref-type="fig" rid="fig5">Figure 5b-d</xref>, p=0.007, rank sum test).</p><fig id="fig5" position="float"><label>Figure 5.</label><caption><title>Rats update their trial-by-trial auditory choices in a confidence-dependent fashion.</title><p>(<bold>a</bold>) Schematic of a 2AFC auditory decision-making task for rat. (<bold>b</bold>) Performance of an example rat computed separately based on the quality of auditory stimulus (shown as colors from blue to green) in the previously rewarded trial. (<bold>c</bold>) Choice updating as a function of sensory evidence in the previous and current trial in the population of rats (n = 5). (<bold>d</bold>) Choice updating as a function of previous stimulus separated for current easy (square) and difficult (circle) trials, averaged across rats.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-49834-fig5-v3.tif"/></fig></sec><sec id="s2-6"><title>Confidence-guided choice updating in mouse auditory decisions</title><p>We next considered decisions of mice performing an auditory decisions task (<xref ref-type="fig" rid="fig6">Figure 6</xref>). Mice were trained on a two-alternative auditory tone decision task. The auditory stimuli in different trials were presented as percentages of a high and low frequency complex tone, morph A and morph B (<xref ref-type="fig" rid="fig6">Figure 6a</xref>). To manipulate perceptual uncertainty, we varied the amplitude ratio of the two spectral peaks in a trial-by-trial manner. Mice showed steep psychometric curves (slope: 0.25±0.06, mean ± S.D) with minor overall bias (-1±6.9% sound A) and negligible lapse for easy stimuli (3±2%). The choices showed significant dependence on the difficulty of previous choice (<xref ref-type="fig" rid="fig6">Figure 6b-d</xref>, p=0.01, rank sum test).</p><fig id="fig6" position="float"><label>Figure 6.</label><caption><title>Mice update their trial-by-trial auditory choices in a confidence-dependent fashion.</title><p>(<bold>a</bold>) Schematic of a 2AFC auditory decision making task for mice. (<bold>b</bold>) Performance of an example mouse computed separately based on the quality of auditory stimulus (shown as colors from blue to green) in the previously rewarded trial. (<bold>c</bold>) Choice updating as a function of sensory evidence in the previous and current trial in the population of mice (n = 6). (<bold>d</bold>) Choice updating as a function of previous stimulus separated for current easy (square) and difficult (circle) trials, averaged across mice.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-49834-fig6-v3.tif"/></fig></sec><sec id="s2-7"><title>Confidence-guided choice updating in mouse visual decisions</title><p>We next considered mice trained to perform visual decisions (<xref ref-type="fig" rid="fig7">Figure 7</xref>; <xref ref-type="bibr" rid="bib7">Burgess et al., 2017</xref>). Head-fixed mice were trained to report the position of a grating on the monitor by turning a steering wheel placed under their front paws (<xref ref-type="fig" rid="fig7">Figure 7a</xref>). If the mouse turned the wheel such that the stimulus reached the center of the screen, the animal received water. If instead the mouse moved the stimulus by the same distance in the opposite direction, this incorrect decision was penalized with a timeout of 2 s (<xref ref-type="bibr" rid="bib7">Burgess et al., 2017</xref>). We varied task difficulty by varying the contrast of the stimulus in different trials. Mice showed steep psychometric curves (slope: 0.260±11, mean ± S.D) with minor overall bias (1±9.1% stimulus contrast) and negligible lapse for easy stimuli (5±4.9%). The decisions showed significant dependence on the difficulty of previous choice (<xref ref-type="fig" rid="fig7">Figure 7b-d</xref>, p=0.001, rank sum test), consistent with similar results in a different version of this task that also included manipulation of reward size (<xref ref-type="bibr" rid="bib28">Lak et al., 2019</xref>).</p><fig id="fig7" position="float"><label>Figure 7.</label><caption><title>Mice update their trial-by-trial visual choices in a confidence-dependent fashion.</title><p>(<bold>a</bold>) Schematic of a 2AFC visual decision making task for mice. (<bold>b</bold>) Performance of an example mouse computed separately based on the quality of visual stimulus (shown as colors from blue to green) in the previously rewarded trial. (<bold>c</bold>) Choice updating as a function of sensory evidence, that is the contrast of stimulus, in the previous and current trial in the population of mice (n = 12). (<bold>d</bold>) Choice updating as a function of previous stimulus separated for current easy (square) and difficult (circle) trials, averaged across mice.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-49834-fig7-v3.tif"/></fig></sec><sec id="s2-8"><title>Confidence-guided choice updating in human visual decisions</title><p>Next, we asked whether confidence-guided choice strategy was specific to rodents or could also be observed in humans (<xref ref-type="bibr" rid="bib47">Urai et al., 2017</xref>). Human observers performing a visual decision task updated their choices in a confidence-dependent manner (<xref ref-type="fig" rid="fig8">Figure 8</xref>). Observers performed a two-interval forced choice (2IFC) motion coherence discrimination task (<xref ref-type="fig" rid="fig8">Figure 8a</xref>). They judged the difference in motion coherence between two successively presented random dot kinematograms: a constant reference stimulus (70% motion coherence) and a test stimulus with varying motion coherence in different trials (<xref ref-type="bibr" rid="bib47">Urai et al., 2017</xref>). Observers performed the task well (slope: 0.2±0.01, bias: 0±3% stimulus coherence, lapse: 1±2%), and their choices showed significant dependence on the difficulty of previous choice (<xref ref-type="fig" rid="fig8">Figure 8b-d</xref>, P&lt;0.05, rank sum test).</p><fig id="fig8" position="float"><label>Figure 8.</label><caption><title>Humans update their trial-by-trial visual choices in a confidence-dependent fashion.</title><p>(<bold>a</bold>) Schematic of a 2IFC visual decision making task in human subjects. (<bold>b</bold>) Performance of an example subject computed separately based on the quality of visual stimulus (shown as colors from blue to green) in the previously rewarded trial. (<bold>c</bold>) Choice updating as a function of sensory evidence, that is the difference in coherence of moving dots between two intervals, in the previous and current trial, averaged across subjects (n = 23). (<bold>d</bold>) Choice updating as a function of previous stimulus strength, separated for current easy (square) and difficult (circle) trials, averaged across subjects.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-49834-fig8-v3.tif"/></fig></sec><sec id="s2-9"><title>Confidence-guided choice updating transfers across sensory modalities</title><p>We found that rats exhibit confidence-dependent choice updating even if the sensory modality of current decision differed from the modality of the previous decision (<xref ref-type="fig" rid="fig9">Figure 9</xref>). We trained rats in a dual sensory modality 2AFC task with randomly interleaved trials of auditory and olfactory decisions (<xref ref-type="fig" rid="fig9">Figure 9a-b</xref>). Rats performed the task well (slope: 0.35±0.03, bias: -2±6%, lapse: 1±0.4%) and their choices showed significant dependence on the difficulty of the past choice, and this dependence transferred across the sensory modalities. Rats updated their olfactory decisions after difficult auditory decisions (<xref ref-type="fig" rid="fig9">Figure 9c-e</xref> p=0.008, rank sum test), and similarly, they updated their auditory choices after difficult olfactory decisions (<xref ref-type="fig" rid="fig9">Figure 9f, h</xref>, p=0.01, rank sum test). The updating occurred also across trials in which the modality of the choice did not change (i.e. in consecutive auditory choices and consecutive olfactory choices). Choice updating appeared largest in two consecutive olfactory decisions, yet updating was present in consecutive auditory choices as well as in consecutive trials with a modality switch (<xref ref-type="fig" rid="fig9s1">Figure 9—figure supplement 1</xref>). These results show that the updating effect depends on the choice outcome, rather than the identity, that is modality, of the sensory stimulus. This observation further indicates that choice updating mainly occurs in the space of action values, similar to our RL model.</p><fig-group><fig id="fig9" position="float"><label>Figure 9.</label><caption><title>Confidence-dependent choice updating transfers across sensory modalities.</title><p>(<bold>a-b</bold>) Schematic of a 2AFC task in which rats performed either an olfactory (<bold>a</bold>) or auditory (<bold>b</bold>) decisions in randomly interleaved trials. (<bold>c</bold>) Performance of an example rat computed for olfactory trials separately based on the quality of auditory stimulus (shown as colors from blue to green) in the previously rewarded trial. (<bold>d</bold>) Choice updating as a function of sensory evidence (auditory stimulus) in the previous trial and odor mixture in the current trial, averaged across subjects (n = 6). (<bold>e</bold>) Choice updating as a function of previous auditory stimulus separated for current odor-guided easy (square) and difficult (circle) trials, averaged across subjects. (<bold>f-h</bold>) Similar to c-e but for trials in which the current stimulus has been auditory and the previous trial has been based on olfactory stimulus.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-49834-fig9-v3.tif"/></fig><fig id="fig9s1" position="float" specific-use="child-fig"><label>Figure 9—figure supplement 1.</label><caption><title>Choice-updating in rats performing a task in which the modality of sensory stimulus in different trials is either auditory or olfactory.</title><p>See <xref ref-type="fig" rid="fig10">Figure 10</xref> for the definition of Updating Index.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-49834-fig9-figsupp1-v3.tif"/></fig></fig-group></sec><sec id="s2-10"><title>Diversity of confidence-guided choice updating across individuals</title><p>Having observed confidence-guided choice updating across various data sets, we next quantified this behavioral effect in each individual, and observed a weak but negative correlation between the strength of choice updating and psychometric lapse rate (<xref ref-type="fig" rid="fig10">Figure 10</xref>). To quantify the choice updating effect for each individual, we performed linear regressions on the updating data (<xref ref-type="fig" rid="fig10">Figure 10a</xref> inset) and computed the updating index as the difference in the slope of the fits for current easy and current difficult trials. A large fraction of individuals in each data set showed substantial choice updating consistent with the predictions of the model (positive numbers in <xref ref-type="fig" rid="fig10">Figure 10a</xref>). Nevertheless, we also observed individuals with negligible updating, and even in rare instances a choice bias in the direction opposite to the model’s prediction (negative numbers in <xref ref-type="fig" rid="fig10">Figure 10a</xref>). Quantifying individual behavior enabled us to ask whether this observed diversity could be explained by variations in the quality of perceptual processing (psychometric slope and lapse rate; <xref ref-type="fig" rid="fig10">Figure 10b,c</xref>). The slope and updating did not exhibit a significant relationship (p=0.21), but the lapse rate and updating showed a weak significant negative correlation (p=0.03). In other words, choice updating was strongest among individuals with lower lapse rate (<xref ref-type="fig" rid="fig10">Figure 10c</xref>). The results suggest that choice updating of the form we observed, is strongest when subjects are well trained in the perceptual task, with stable psychometric slope and minimal lapse rate.</p><fig id="fig10" position="float"><label>Figure 10.</label><caption><title>Confidence-guided choice updating is strongest in individuals with well-defined psychometric behavior.</title><p>(<bold>a</bold>) The strength of choice updating among individuals. The vertical lines show the mean. Inset: schematics illustrates the calculation of updating index. The index is defined as the difference in the slope of lines fitted to the data. (<bold>b</bold>) Scatter plot of choice updating as a function of the slope of psychometric curve. Each circle is one individual. Dashed lines illustrate a linear fit on each data set, and the gray solid line shows a linear fit on all subjects. (<bold>c</bold>) Scatter plot of choice updating as a function of the lapse rate of the fitted psychometric curve.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-49834-fig10-v3.tif"/></fig></sec><sec id="s2-11"><title>Different strategies for choice updating after error trials due to different noise sources</title><p>Lastly, we asked whether subjects show choice updating following error trials. We observed substantial diversity in choice bias after error trials, both across individuals and data sets. For example, two rats that performed olfactory decisions with similar choice updating after correct choices (<xref ref-type="fig" rid="fig11">Figure 11a,b</xref> top panel), showed divergent patterns of updating after incorrect choices (<xref ref-type="fig" rid="fig11">Figure 11a,b</xref> bottom panel). Interestingly, reinforcement learning models with different parameter settings also produced diverse choice bias patterns after error trials, depending on the dominant source of noise, that is whether errors were produced by sensory noise (external) or due to value fluctuations (internal). When sensory noise is high and leads to errors, these errors cannot be systematically corrected hence there is little or no net updating effect (<xref ref-type="fig" rid="fig11">Figure 11c</xref>, bottom panel). On the other hand, when the internal noise is high, such as high learning rate producing over-correction, systematic post-error updating is observed (<xref ref-type="fig" rid="fig11">Figure 11d</xref>, bottom panel). Although we found individual subjects matching these specific patterns of post-error updating (<xref ref-type="fig" rid="fig11">Figure 11a,b</xref>), the diversity across individuals and populations, as well as the low number of error trials precludes a more in-depth analysis. Note that for post-correct updating our RL model makes qualitatively similar predictions about choice updating, independent of whether the dominant source of noise is external or internal (<xref ref-type="fig" rid="fig11">Figure 11c,d</xref> top panels).</p><fig id="fig11" position="float"><label>Figure 11.</label><caption><title>Diverse learning effects after error trials.</title><p>(<bold>a</bold>) Choice updating after correct trials (top) and after error trials (bottom) in one example rat. (<bold>b</bold>) Similar to a for another example rat. (<bold>c</bold>) Choice updating of the TDRL model ran with large sensory noise (<inline-formula><mml:math id="inf33"><mml:msup><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>=</mml:mo></mml:math></inline-formula> 0.5). This model exhibit choice updating qualitatively similar to the rat shown in a. (<bold>d</bold>) Choice updating in the TDRL model with large internal noise (<inline-formula><mml:math id="inf34"><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mn>0.8</mml:mn></mml:math></inline-formula>). This model run exhibits choice updating similar to the rat shown in b.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-49834-fig11-v3.tif"/></fig></sec></sec><sec id="s3" sec-type="discussion"><title>Discussion</title><p>Our central observation is that even well-trained and well-performed perceptual decisions can be informed by past sensory evidence and outcomes. When the sensory evidence is strong, it determines choices, as expected, and past outcomes have little influence. When sensory evidence is weak, however, choices are influenced by trial history. We show that this effect of past rewards can depend on the difficulty of past sensory decisions: subjects repeat the previously rewarded choice mainly when past sensory decision was difficult. This confidence-guided choice updating occurs in a trial-by-trial manner, and it is not due to slow drifts in choice strategy. We demonstrate that these history-dependent choice biases can be explained with reinforcement learning models that consider sensory ambiguity as a belief state computation, and hence produce confidence-scaled reward prediction error signals. We illustrate that this form of choice updating is a robust and widespread behavioral phenomenon observed across various perceptual decision-making paradigms in mice, rats and humans. Notably we found evidence for the same reinforcement learning process across data sets despite substantial variations in experimental setups and other conditions across the experiments examined.</p><p>The influence of past trials on perceptual decisions does not necessarily reflect active, trial-by-trial learning. In fact, our simulations illustrate that slow and non-specific drifts in the decision boundary result in correlations between consecutive choices, which can produce psychometric shifts similar to choice bias updating (<xref ref-type="fig" rid="fig2">Figures 2</xref> and <xref ref-type="fig" rid="fig3">3</xref>). To correct for this and isolate reinforcement learning-based choice updating, we used a simple procedure to compute choice updating with respect to slow fluctuations in the choice bias. We show the trial history effects persisting after this correction reflect confidence-guided reinforcement learning processes. These analyses also indicate that trial history effects and serial choice biases should be considered with care because correlations across choices at various time scales can produce apparent updating of perceptual choices. A similar confound has been previously reported in post-error slowing analysis, and similar normalization procedures were used to correct for it (<xref ref-type="bibr" rid="bib14">Dutilh et al., 2012</xref>; <xref ref-type="bibr" rid="bib36">Purcell and Kiani, 2016</xref>).</p><p>Confidence in the correctness of a choice determines the degree to which the reward can be expected. Hence, decision confidence informs how much the decision maker should learn from the decision outcome, as suggested by RL models that incorporate belief states representing confidence (<xref ref-type="bibr" rid="bib27">Lak et al., 2017</xref>; <xref ref-type="bibr" rid="bib28">Lak et al., 2019</xref>). Rewards received after decisions with high confidence are expected and hence there is not much to learn from them. In contrast, rewards received after decisions with lower confidence are relatively unexpected and could provide an opportunity to learn (<xref ref-type="fig" rid="fig3">Figure 3</xref>). Our results reveal that rodents and humans exhibit this form of learning (<xref ref-type="fig" rid="fig10">Figure 10</xref>). These results were robust across various datasets, enabling us to isolate an elementary cognitive computation driving choice biases.</p><p>Trial-by-trial transfer of choice updating across sensory modalities provides some evidence that this form of learning is driven by comparing the decision outcome with confidence-dependent expectation and performing updating in the space of action values. However, updating across trials with different modalities was relatively weaker compared to trials within the same sensory modality. This later observation might point to the fact that in trial-by-trial learning animals follow a mixture of two strategies: one which updates values in the space of actions, and one that keeps track of stimulus identity and statistics across trials for such learning. The trade-off between these model-free and model-based trial-by-trial learning during perceptual decisions remains to be explored in future studies.</p><p>What are the neuronal substrates of confidence-dependent choice updating? Several lines of evidence indicate that the dopaminergic system is centrally involved in this phenomenon. First, dopamine neuron responses during perceptual decisions quantitatively match confidence-dependent prediction errors in both monkeys and mice (<xref ref-type="bibr" rid="bib27">Lak et al., 2017</xref>; <xref ref-type="bibr" rid="bib28">Lak et al., 2019</xref>). Second, dopamine responses predict the magnitude of the psychometric choice bias in the subsequent trial (<xref ref-type="bibr" rid="bib28">Lak et al., 2019</xref>). Third, optogenetic manipulation of dopamine neurons biases psychometric curves in a trial-by-trial fashion (<xref ref-type="bibr" rid="bib28">Lak et al., 2019</xref>). In addition, different frontal cortical regions, medial prefrontal cortex (<xref ref-type="bibr" rid="bib28">Lak et al., 2019</xref>) and orbitofrontal cortex (<xref ref-type="bibr" rid="bib24">Hirokawa et al., 2019</xref>) are also likely to contribute to confidence-guided choice updating strategies.</p><sec id="s3-1"><title>Rewards induce choices bias in perceptual decisions</title><p>There is mounting evidence that in perceptual decision making tasks, even though reward is only contingent on accurate judgment about the current sensory stimulus, choices can be influenced by previous trials across species (<xref ref-type="bibr" rid="bib1">Abrahamyan et al., 2016</xref>; <xref ref-type="bibr" rid="bib2">Akaishi et al., 2014</xref>; <xref ref-type="bibr" rid="bib3">Akrami et al., 2018</xref>; <xref ref-type="bibr" rid="bib4">Braun et al., 2018</xref>; <xref ref-type="bibr" rid="bib8">Busse et al., 2011</xref>; <xref ref-type="bibr" rid="bib9">Cho et al., 2002</xref>; <xref ref-type="bibr" rid="bib15">Fan et al., 2018</xref>; <xref ref-type="bibr" rid="bib16">Fischer and Whitney, 2014</xref>; <xref ref-type="bibr" rid="bib17">Fritsche et al., 2017</xref>; <xref ref-type="bibr" rid="bib18">Fründ et al., 2014</xref>; <xref ref-type="bibr" rid="bib20">Gold et al., 2008</xref>; <xref ref-type="bibr" rid="bib25">Hwang et al., 2017</xref>; <xref ref-type="bibr" rid="bib30">Lueckmann et al., 2018</xref>; <xref ref-type="bibr" rid="bib31">Luu and Stocker, 2018</xref>; <xref ref-type="bibr" rid="bib33">Marcos et al., 2013</xref>; <xref ref-type="bibr" rid="bib45">Tsunada et al., 2019</xref>; <xref ref-type="bibr" rid="bib47">Urai et al., 2017</xref>). Several such studies have shown that subjects might repeat the previously rewarded choice or avoid it after an unsuccessful trial, suggesting that basic forms of reward-based learning are at work even at asymptotic, steady-state perceptual performance. Given that these trial-history effects diminish the overall reward return, and are hence suboptimal, the question is why they persist even after subjects are well trained in the task? Our results showed a similar phenomenon across various data sets and species that produced choice bias in perceptual decisions after rewarded decisions that were difficult, consistent with recent reports (<xref ref-type="bibr" rid="bib34">Mendonça et al., 2018</xref>; <xref ref-type="bibr" rid="bib28">Lak et al., 2019</xref>). We show that these behavioral effects are normatively expected from various models that consider the uncertainty of stimulus states inherent in perceptual decisions. It is worth noting that the confidence-gauged learning described here requires observing the trial feedback, and it might thus differ from sequential choice effects in the absence of trial feedback (<xref ref-type="bibr" rid="bib4">Braun et al., 2018</xref>; <xref ref-type="bibr" rid="bib19">Glaze et al., 2015</xref>). Moreover, confidence-dependent learning differs from trial history-effects for highly discriminable stimuli, that is “priming of popout“ effect (<xref ref-type="bibr" rid="bib32">Maljkovic and Nakayama, 1994</xref>). These observations suggest that there are various types of selection-history mechanism operating in the brain with distinct constraints and properties.</p></sec><sec id="s3-2"><title>Computational mechanisms of confidence-driven choices bias</title><p>What classes of models can account for our behavioral observations? It is clear that a purely sensory-based model or a purely reward-based model cannot account for our data. One approach is to start with a reinforcement learning model and add a belief state to account for stimulus-induced uncertainty (<xref ref-type="bibr" rid="bib27">Lak et al., 2017</xref>; <xref ref-type="bibr" rid="bib28">Lak et al., 2019</xref>). We show that this class of models provides teaching signal reflecting past confidence and accounts for the observed choice bias strategy. Alternatively, we also considered a statistical classifier model that on-line adjusts the decision boundary in proportion to estimated classification success (<xref ref-type="bibr" rid="bib42">Sollich, 2002</xref>). We show that this Bayesian on-line support vector machine also accounts for the observed choice bias strategy. Similarly, Bayesian learning in drift-diffusion models of decision making also makes similar predictions about confidence-dependent choice biases (<xref ref-type="bibr" rid="bib13">Drugowitsch et al., 2019</xref>). Thus, either a sensory-based classification model modified to produce statistically optimal adjustments based on on-line feedback, or a reward-based model modified to account for the ambiguity in stimulus states produce broadly similar confidence-dependent choice biases. These models share one main computation: they adjust the degree of learning based on the statistical confidence in the accuracy of previous decisions. Therefore, the key features of our data can be accounted for by either reinforcement learning mechanisms or on-line statistical classifiers.</p><p>These model classes can be distinguished chiefly on the basis of their respective decision variables: RL updates value, while classifiers update boundaries in sensory coordinates. Using a mixed sensory modality decision task it is possible to test whether updating is based on action values or stimulus variables. Actions value updating, predicted by RL models, leads to the transfer of choice bias across decisions with mixed sensory modalities. Category boundary updating in sensory coordinates, predicted by classifier models, leads to updating solely across the same sensory modality. We found that choice bias transferred across sensory modalities, suggesting that updating occurs in the space of action values. However, across-modality choice bias updating was weaker than within-modality updating, pointing to the possibility that animals update choices both based on stimulus statistics and action values.</p></sec><sec id="s3-3"><title>All correct trials are alike; each incorrect trial is incorrect in its own way</title><p>When learning from outcomes, it is natural to consider not only correct choices but also what happens after incorrect choices. Surprisingly, we found that post-error behavioral effects were highly variable across subjects and datasets, unlike the post-correct choice updating we observed.</p><p>To paraphrase Leo Tolstoy’s famous opening sentence of the novel Anna Karenina: all correct trials are alike; each incorrect trial is incorrect in its own way. Correct perceptual performance requires appropriate processing and evaluation of the stimulus. In contrast there are many processes that can lead to incorrect performance without consideration of the stimulus, from inattention to lack of motivation to exploration. Indeed, in our behavioral data, the post-error behavioral effects were diverse, usually even within the same dataset.</p><p>We examined the RL model to gain insights into the possible origins of this post-error diversity. Note that the model’s qualitative predictions about post-correct trials are largely independent of model parameters. In contrast, the predictions of the model for post-error trials depend on parameter settings, in part based on the balance in the sources of decision noise. When stimulus-noise was dominant there was little post-error updating. However, when the model’s internal noise was high (e.g. large learning rate), it exhibited post-error updating. We found that individual subjects match these specific patterns but in fact the diversity in the data was greater, as expected, since the modeling framework does not take into account many relevant sources of decision noise, such as attentional lapses, lack of motivation or exploration, a multitude of processes that can all lead to errors.</p><p>Identifying the origin of decision noise is critical for the appropriate interpretation of any psychometric decision task. In the signal detection theory-based psychometric framework, negligible lapse rates and asymptotic psychometric slopes point to the interpretation that fluctuations in decisions are solely due to noise in perceptual processing. However, the ongoing learning mechanisms described here contribute to apparent fluctuations in the decisions, indicating that the contribution of sensory processing to decision noise may be often lower than previously thought (<xref ref-type="bibr" rid="bib50">Zariwala et al., 2013</xref>). This ongoing learning might eventually go away after extended behavioral training yet we still observed signatures of this learning process in many subjects after 3–4 months of almost daily training.</p></sec><sec id="s3-4"><title>Consilience of perceptual and reward-guided decisions</title><p>Choice biases in perceptual decisions are typically considered maladaptive and suboptimal because in laboratory experiments trials are often designed to be independent from each other and isolate the perceptual process under study (<xref ref-type="bibr" rid="bib5">Britten et al., 1992</xref>; <xref ref-type="bibr" rid="bib23">Hernández et al., 1997</xref>). Indeed, perceptual choice biases that are entirely stimulus-independent are suboptimal. However, the confidence-guided choice bias we examined could point to an underlying optimal choice strategy from various perspectives. First, this strategy is optimal when considering that the world can change, and hence the precise decision category boundary may not be stable over trials. In this situation, the outcome of decisions closer to the category boundary provide the most informative feedback as to where the category boundary should be set. Second, confidence-guided choice updating is optimal when considering that in natural environments external events can be temporally correlated. In such environments, when the evidence in favor of choice options is limited and hence there is uncertainty in decisions, it is beneficial to consider prior beliefs and the temporal statistics of events and adjust choices accordingly (<xref ref-type="bibr" rid="bib49">Yu and Cohen, 2008</xref>). Thus, despite being suboptimal from the experimenter’s perspective, confidence-guided learning can be optimal in dynamic, real world situations, revealing that perceptual and reinforcement learning processes jointly contribute to many previously studied decision paradigms.</p></sec></sec><sec id="s4" sec-type="materials|methods"><title>Materials and methods</title><sec id="s4-1"><title>Data analysis and psychometric fitting</title><p>For the psychometric analysis, we calculated the percentage of choice as a function of sensory stimuli. We fitted these data with the psychometric function <inline-formula><mml:math id="inf35"><mml:mi>ψ</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mi>λ</mml:mi><mml:mo>+</mml:mo><mml:mfenced separators="|"><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mn>2</mml:mn><mml:mi>λ</mml:mi></mml:mrow></mml:mfenced><mml:mi>F</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mi>s</mml:mi><mml:mo>;</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>σ</mml:mi></mml:mrow></mml:mfenced></mml:math></inline-formula> where <inline-formula><mml:math id="inf36"><mml:mi>F</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:mfenced></mml:math></inline-formula> is a cumulative Gaussian. The parameter µ represents the mean of the Gaussian and define the side bias. The parameter <inline-formula><mml:math id="inf37"><mml:mi>σ</mml:mi></mml:math></inline-formula> determines the slope of the fitted curve. The parameter <inline-formula><mml:math id="inf38"><mml:mi>λ</mml:mi></mml:math></inline-formula> represents the lapse rate of the curve. We fitted this function via maximum likelihood estimation (<xref ref-type="bibr" rid="bib48">Wichmann and Hill, 2001</xref>).</p><p>We used the psychometric fits to evaluate whether the performance was substantially differed across days of testing in each subject. In addition, we computed conditional psychometric curves by computing the curves from a subset of trials, that is those that were preceded by specific stimulus level, action direction and outcome in the previous trial. We used the same procedure as above for fitting these conditional curves.</p><p>Subtracting the average performance (for each level of stimulus) from performance in the conditional curves for the same level of stimulus provided an estimate of choice updating, that is the level of side bias for each stimulus (<xref ref-type="fig" rid="fig2">Figure 2</xref>). The size of these side biases was plotted in the heatmaps for each dataset.</p><p>To isolate trial-by-trial updating independent of possible slow fluctuation in the choice bias, we estimated the slow side bias and subtracted it from the updating heatmaps (<xref ref-type="fig" rid="fig2">Figure 2</xref>, <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1e</xref>, <xref ref-type="fig" rid="fig3">Figure 3</xref>). This procedure involved computing conditional psychometric curves after a subset of trials (with specific stimulus, action and outcome) as well as computing the conditional curves prior to these trials, plotting heatmaps for both these sets of curves, and subtracting the later heatmap from the former heatmap (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1e</xref>, <xref ref-type="fig" rid="fig3">Figure 3</xref>).</p></sec><sec id="s4-2"><title>Behavioral models</title><sec id="s4-2-1"><title>TDRL model with stimulus belief state</title><p>In order to examine the nature of choice updating during perceptual decision making, we adopted a reinforcement learning model which accommodate trial-by-trial estimates of perceptual uncertainty (<xref ref-type="bibr" rid="bib27">Lak et al., 2017</xref>; <xref ref-type="bibr" rid="bib28">Lak et al., 2019</xref>). In all our tasks, the subject can select one of two responses (often left vs right) to indicates its judgement about the stimulus (i.e. whether it belongs to category A or B, or left or right for simplicity). Knowing the state of the trial (left or right) is only partially observable, and it depends on the quality of sensory evidence.</p><p>In keeping with the standard psychophysical treatments of sensory noise, the model assumes that the internal estimate of the stimulus, <inline-formula><mml:math id="inf39"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mover><mml:mi>s</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, is normally distributed with constant variance around the true stimulus contrast: <inline-formula><mml:math id="inf40"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>s</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>s</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mo>;</mml:mo><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mi>σ</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>. In the Bayesian view, the observer’s belief about the stimulus <inline-formula><mml:math id="inf41"><mml:mi>s</mml:mi></mml:math></inline-formula> is not limited to a single estimated value <inline-formula><mml:math id="inf42"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mover><mml:mi>s</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>. Instead, <inline-formula><mml:math id="inf43"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mover><mml:mi>s</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> parameterizes a belief distribution over all possible values of <inline-formula><mml:math id="inf44"><mml:mi>s</mml:mi></mml:math></inline-formula> that are consistent with the sensory evidence. The optimal form for this belief distribution is given by Bayes rule:<disp-formula id="equ3"><mml:math id="m3"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mover><mml:mi>s</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mover><mml:mi>s</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>s</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover><mml:mi>s</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>We assume that the prior belief about <inline-formula><mml:math id="inf45"><mml:mi>s</mml:mi></mml:math></inline-formula> is uniform, which implies that this optimal belief will also be Gaussian, with the same variance as the sensory noise distribution, and mean given by <inline-formula><mml:math id="inf46"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mover><mml:mi>s</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>: <inline-formula><mml:math id="inf47"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mover><mml:mi>s</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>;</mml:mo><mml:mrow><mml:mover><mml:mi>s</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mo>,</mml:mo><mml:msup><mml:mi>σ</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>. From this, the agent computes a belief, that is the probability that the stimulus was indeed on the right side of the monitor, <inline-formula><mml:math id="inf48"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:mover><mml:mi>s</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>), according to:<disp-formula id="equ4"><mml:math id="m4"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover><mml:mi>s</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msubsup><mml:mo>∫</mml:mo><mml:mrow><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi mathvariant="normal">∞</mml:mi></mml:mrow></mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mover><mml:mi>s</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>d</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:mstyle></mml:math></disp-formula>where <inline-formula><mml:math id="inf49"><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> represents the trial-by-trial probability of the stimulus being on the right side and <inline-formula><mml:math id="inf50"><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> similarly represents the probability of it being on the left.</p><p>The expected values of the two choices L and R are computed as <inline-formula><mml:math id="inf51"><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf52"><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>, where <inline-formula><mml:math id="inf53"><mml:msub><mml:mrow><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf54"><mml:msub><mml:mrow><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> represent the stored values of L and R actions. Over learning these values are converging to a quantity just below the true reward size available in correct choices (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1c</xref>). To choose between the two options, we used an argmax rule which selects the action with higher expected value deterministically. Using other decision functions such as softmax did not substantially change our results (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1a</xref>). The outcome of this is thus the choice <italic>c</italic> (L or R), its associated confidence <inline-formula><mml:math id="inf55"><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>, and its predicted value <inline-formula><mml:math id="inf56"><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>.<disp-formula id="equ5"><mml:math id="m5"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>Q</mml:mi><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mtable columnalign="left left" columnspacing="1em" displaystyle="false" rowspacing=".2em"><mml:mtr><mml:mtd><mml:msub><mml:mi>Q</mml:mi><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mspace width="thinmathspace"/><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>c</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>i</mml:mi><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mo>=</mml:mo><mml:mi>L</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mi>Q</mml:mi><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub><mml:mspace width="thinmathspace"/><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>c</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>i</mml:mi><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mo>=</mml:mo><mml:mi>R</mml:mi></mml:mtd></mml:mtr></mml:mtable><mml:mo fence="true" stretchy="true" symmetric="true"/></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>When the trial begins, the expected reward prior to any information about the stimulus is <inline-formula><mml:math id="inf57"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mtable columnspacing="1em" rowspacing="4pt"><mml:mtr><mml:mtd><mml:msub><mml:mi>V</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mi>i</mml:mi><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>V</mml:mi><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>V</mml:mi><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mstyle></mml:math></inline-formula>. Upon observing the stimulus and making a choice, the prediction error signal is: <inline-formula><mml:math id="inf58"><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mi>i</mml:mi><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>. After receiving the reward, <inline-formula><mml:math id="inf59"><mml:mi>r</mml:mi></mml:math></inline-formula>, the reward prediction error is <inline-formula><mml:math id="inf60"><mml:mi>δ</mml:mi><mml:mo>=</mml:mo><mml:mi>r</mml:mi><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>.</p><p>Given this prediction error, the value of the chosen action will be updated according to:</p><p><inline-formula><mml:math id="inf61"><mml:msub><mml:mrow><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub><mml:mo>←</mml:mo><mml:msub><mml:mrow><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>α</mml:mi><mml:mo>.</mml:mo><mml:mi>δ</mml:mi></mml:math></inline-formula> where <inline-formula><mml:math id="inf62"><mml:mi>α</mml:mi></mml:math></inline-formula> is the learning rate. For simplicity, the model does not include temporal discounting. Parameter values used in <xref ref-type="fig" rid="fig3">Figure 3</xref> are: <inline-formula><mml:math id="inf63"><mml:msup><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math></inline-formula>=0.2 and <inline-formula><mml:math id="inf64"><mml:mi>α</mml:mi></mml:math></inline-formula>=0.5. Each agent received 500 trials per stimulus level (randomly presented to the model), and plots reflect averages across 1000 agents.</p></sec><sec id="s4-2-2"><title>TDRL models without stimulus belief state</title><p>The TDRL model without the belief state was largely similar to the model described above with one fundamental difference; computation of prediction error did not have access to the belief state used for choice computation. In other words, prediction errors are computed by comparing the outcome with the average value of chosen action, without consideration of the belief in the accuracy of that action.</p><p>Similar to the model above, the expected values of the two choices L and R are computed as <inline-formula><mml:math id="inf65"><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf66"><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>, where <inline-formula><mml:math id="inf67"><mml:msub><mml:mrow><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf68"><mml:msub><mml:mrow><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> represent the stored values of L and R actions. Over learning these values are converging to the average value of reward received in the past trials, that is average performance in the task (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1c</xref>). To choose between the two options, we used an argmax rule which selects the action with higher expected value deterministically. The outcome of this is thus the choice (L or R), its associated confidence <inline-formula><mml:math id="inf69"><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>, and its predicted value <inline-formula><mml:math id="inf70"><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>.<disp-formula id="equ6"><mml:math id="m6"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>Q</mml:mi><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mtable columnalign="left left" columnspacing="1em" displaystyle="false" rowspacing=".2em"><mml:mtr><mml:mtd><mml:msub><mml:mi>Q</mml:mi><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mspace width="thinmathspace"/><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>c</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>i</mml:mi><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mo>=</mml:mo><mml:mi>L</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mi>Q</mml:mi><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub><mml:mspace width="thinmathspace"/><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>c</mml:mi><mml:mi>h</mml:mi><mml:mi>o</mml:mi><mml:mi>i</mml:mi><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mo>=</mml:mo><mml:mi>R</mml:mi></mml:mtd></mml:mtr></mml:mtable><mml:mo fence="true" stretchy="true" symmetric="true"/></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>After receiving the reward, <inline-formula><mml:math id="inf71"><mml:mi>r</mml:mi></mml:math></inline-formula>, the reward prediction error is <inline-formula><mml:math id="inf72"><mml:mi>δ</mml:mi><mml:mo>=</mml:mo><mml:mi>r</mml:mi><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>, where <italic>c</italic> is choice, as before. Given this prediction error, the value of the chosen action will be updated according to:<disp-formula id="equ7"><mml:math id="m7"><mml:msub><mml:mrow><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub><mml:mo>←</mml:mo><mml:msub><mml:mrow><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>α</mml:mi><mml:mo>.</mml:mo><mml:mi>δ</mml:mi></mml:math></disp-formula></p><p>Because <inline-formula><mml:math id="inf73"><mml:msub><mml:mrow><mml:mi>V</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> does not reflect decision confidence, the prediction errors only reflect the presence or absence of reward, but are not modulated by the decision confidence (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1d</xref>). Thus, they drive learning based on past outcome but not past decision confidence. Note that prior to normalization, there is an apparent small tendency for this model to exhibit updating that depends on the difficulty of the previous choice (<xref ref-type="fig" rid="fig3">Figure 3c</xref>, left). This reflect the correlation of stored values across trials and transient regimes in these stored values that make it more probable to achieve two consecutive correct same-side difficult choice. However, after the normalization, the updating does not show any effect of previous difficulty, and merely reflects the presence or absence of reward in the previous trial (<xref ref-type="fig" rid="fig3">Figure 3c</xref>, right).</p><p>An extended version of this model is the one that includes multiple states: that is one state for storing the average value of each stimulus level. In this model, reward prediction error can be computed in two ways: with or without access to the inferred state. The first scenario makes prediction errors independent of past difficulty. The second scenario has access to the inferred state and compares reward with the value of that state to produce confidence-dependent prediction errors. However, since the updates only impact the current state there is no learning expected for different (nearby) stimuli.</p></sec></sec><sec id="s4-3"><title>Modifications to include slowly drifting choice bias</title><p>We modified the TDRL model without the belief state to include slowly drifting side bias (Figure 3d). The bias over trials was defined as the moving average (across 50 trials) of <inline-formula><mml:math id="inf74"><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>A</mml:mi></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mi>B</mml:mi></mml:math></inline-formula>, where <italic>A</italic> is the temporal noise over trials (drawn from a normal distribution, <inline-formula><mml:math id="inf75"><mml:mi>N</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mn>0,1</mml:mn></mml:mrow></mml:mfenced></mml:math></inline-formula>), and <italic>B</italic> is the amplitude noise (drawn from a normal distribution, <inline-formula><mml:math id="inf76"><mml:mi>N</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mn>0,1</mml:mn></mml:mrow></mml:mfenced><mml:mo>.</mml:mo></mml:math></inline-formula> On each trial, the bias (a negative or positive number), was added to <inline-formula><mml:math id="inf77"><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>, and choice was made by comparing <inline-formula><mml:math id="inf78"><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf79"><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>, as described before. This induced drift causes a strong correlation across trials that influence choices. However, the normalization removes this correlation and the model shows an effect of past reward which is independent of the difficulty of the past stimulus.</p></sec><sec id="s4-4"><title>Modifications to include with win-stay-lose-switch strategy</title><p>We incorporated a simple probabilistic win-stay-lose-switch strategy into the TDRL model without the stimulus belief state. To do so, in 10% of randomly chosen trial, the choice was determined by the choice and outcome of the previous trial, rather than comparing <inline-formula><mml:math id="inf80"><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mi>L</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf81"><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>. In these trials, the previous choice was repeated when the previous trial was rewarded (win-stay), or the alternative choice was reported if the previous trial was not rewarded (lose-switch).</p></sec><sec id="s4-5"><title>On-line Bayesian support vector machine (SVM)</title><p>The SVM algorithm finds the decision hyperplane that maximizes the margin between the data points belonging to two classes. The margin refers to the space around the classification boundary in which there is no data point, that is the largest minimal distance from any of the data points (<xref ref-type="fig" rid="fig4">Figure 4a</xref>). The data points falling on the margin are referred to as support vectors.</p><p>Following the conventional form of a linear SVM, stimuli are represented as <inline-formula><mml:math id="inf82"><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> each representing the two odor components A and B, and <inline-formula><mml:math id="inf83"><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mfenced close="}" open="{" separators="|"><mml:mrow><mml:mo>-</mml:mo><mml:mn>1,1</mml:mn></mml:mrow></mml:mfenced></mml:math></inline-formula> corresponding to different class labels reflecting dominant odor A or B in the stimulus. The algorithm finds the hyperplane in this feature space that separate the stimuli. Assuming that the classification is determined by the following decision function <inline-formula><mml:math id="inf84"><mml:mi>f</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>n</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mi>w</mml:mi><mml:mi>T</mml:mi><mml:mo>.</mml:mo><mml:mi>ϕ</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mi>b</mml:mi></mml:mrow></mml:mfenced></mml:math></inline-formula>, the classification hyperplane would be <inline-formula><mml:math id="inf85"><mml:mi>w</mml:mi><mml:mo>.</mml:mo><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:math></inline-formula>, where <inline-formula><mml:math id="inf86"><mml:mi>w</mml:mi></mml:math></inline-formula> is a weight vector and <inline-formula><mml:math id="inf87"><mml:mi>b</mml:mi></mml:math></inline-formula> is an offset. Thus, data point <inline-formula><mml:math id="inf88"><mml:mi>x</mml:mi></mml:math></inline-formula> is assigned to the first class if <inline-formula><mml:math id="inf89"><mml:mi>f</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>n</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mi>w</mml:mi><mml:mi>T</mml:mi><mml:mo>.</mml:mo><mml:mi>ϕ</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:mi>b</mml:mi></mml:mrow></mml:mfenced></mml:math></inline-formula> equals +1 or to the second class if <inline-formula><mml:math id="inf90"><mml:mi>f</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:mfenced></mml:math></inline-formula> equals −1. In the simplest form (linear separability and hard margin), it is possible to select two parallel hyperplanes that separate the two classes of data, the distance between these hyperplanes is <inline-formula><mml:math id="inf91"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mn>2</mml:mn><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mrow><mml:mo symmetric="true">‖</mml:mo><mml:mi>w</mml:mi><mml:mo symmetric="true">‖</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, and hence to maximize this distance, <inline-formula><mml:math id="inf92"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mo symmetric="true">‖</mml:mo><mml:mi>w</mml:mi><mml:mo symmetric="true">‖</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> should be minimized. In a more general form, the weights <inline-formula><mml:math id="inf93"><mml:mi>w</mml:mi></mml:math></inline-formula> can be found by minimizing the following equation subject to the SVM constraints (i.e. no data point within the margin):<disp-formula id="equ8"><mml:math id="m8"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mi>λ</mml:mi><mml:mn>2</mml:mn></mml:mfrac><mml:msubsup><mml:mrow><mml:mo symmetric="true">‖</mml:mo><mml:mi>w</mml:mi><mml:mo symmetric="true">‖</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow/></mml:munderover><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mi>w</mml:mi><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></disp-formula>where <inline-formula><mml:math id="inf94"><mml:mi>λ</mml:mi></mml:math></inline-formula> is the optimization hyperparameter that determines the trade-off between increasing the margin size and ensuring that the <inline-formula><mml:math id="inf95"><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> lie on the correct side of the margin. The equation above thus ensures a tradeoff between classification errors and the level of separability.</p><p>In the online active form, weights can be iteratively adjusted. In this form, is updated iteratively according to<disp-formula id="equ9"><mml:math id="m9"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>w</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mtable columnalign="left left" columnspacing="1em" displaystyle="false" rowspacing=".2em"><mml:mtr><mml:mtd><mml:mspace width="thinmathspace"/><mml:mi>w</mml:mi><mml:mo>+</mml:mo><mml:mi>α</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mi>λ</mml:mi><mml:mi>w</mml:mi><mml:mo>+</mml:mo><mml:mi>y</mml:mi><mml:mi>x</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>y</mml:mi><mml:msup><mml:mi>w</mml:mi><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup><mml:mi>x</mml:mi><mml:mo>&lt;</mml:mo><mml:mn>1</mml:mn><mml:mspace width="thinmathspace"/></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>w</mml:mi><mml:mo>−</mml:mo><mml:mi>α</mml:mi><mml:mi>λ</mml:mi><mml:mi>w</mml:mi><mml:mtext> </mml:mtext><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>y</mml:mi><mml:msup><mml:mi>w</mml:mi><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup><mml:mi>x</mml:mi><mml:mo>&gt;=</mml:mo><mml:mn>1</mml:mn></mml:mtd></mml:mtr></mml:mtable><mml:mo fence="true" stretchy="true" symmetric="true"/></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula>where <inline-formula><mml:math id="inf96"><mml:mi>α</mml:mi></mml:math></inline-formula> is a learning rate. In Bayesian SVMs the size of the margin for one data point is proportional to the likelihood of that point belonging to a class given the classifier. Thus, the posterior class probabilities, <inline-formula><mml:math id="inf97"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>D</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, can be obtained by integrating over the posterior distribution of <inline-formula><mml:math id="inf98"><mml:mi>w</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf99"><mml:mi>b</mml:mi></mml:math></inline-formula> after appropriate normalization. This quantity is proportional to the statistical decision confidence, that is an estimate of confidence about which odor mixture component predominates (<xref ref-type="fig" rid="fig4">Figure 4b</xref>). In simulation presented in <xref ref-type="fig" rid="fig4">Figure 4</xref>, we used <inline-formula><mml:math id="inf100"><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mn>0.15</mml:mn></mml:math></inline-formula> as the learning rate for updating of weight vector and the <inline-formula><mml:math id="inf101"><mml:msup><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math></inline-formula>=0.25 for underlying noise level of stimuli to be classified. Each agent received 500 trials per stimulus level (randomly presented to the model), and plots reflect averages across 1000 agents.</p></sec><sec id="s4-6"><title>Behavioral experiments</title><p>The experimental procedures were approved by Institutional committees at Cold Spring Harbor Laboratory (for experiments on rats), MIT and Harvard University (for mice auditory experiments) and were in accordance with National Institute of Health standards (project ID: 18-14-11-08-1). Experiments on mice visual decisions were approved by the home Office of the United Kingdom (license 70/8021). Experiments in humans were approved by the ethics committee at the University of Amsterdam (project ID: 2014-BC-3376).</p></sec><sec id="s4-7"><title>Rat olfactory experiment</title><p>The apparatus and task have been described previously (<xref ref-type="bibr" rid="bib24">Hirokawa et al., 2019</xref>; <xref ref-type="bibr" rid="bib26">Kepecs et al., 2008</xref>; <xref ref-type="bibr" rid="bib46">Uchida and Mainen, 2003</xref>). The apparatus was controlled using PulsePal and Bpod (<xref ref-type="bibr" rid="bib41">Sanders and Kepecs, 2014</xref>) or with the BControl system (<ext-link ext-link-type="uri" xlink:href="https://brodylabwiki.princeton.edu/bcontrol/index.php?title=Main_Page">https://brodylabwiki.princeton.edu/bcontrol/index.php?title=Main_Page</ext-link>). Rats self-initiated each experimental trial by introducing their snout into the central port where odor was delivered. After a variable delay, drawn from a uniform random distribution of 0.2–0.5 s, a binary mixture of two pure odorants, S(+)−2-octanol and R()−2-octanol, was delivered at one of six concentration ratios (80:20, 65:35, 55:45, 45:55, 35:65, 20:80) in pseudorandom order within a session. In some animals we also used ratios of 100:0 and 0:100. After a variable odor sampling time up to 0.7 s, rats responded by withdrawing from the central port, and moved to the left or right choice port. Choices were rewarded with 0.025 ml of water delivered from stainless tube inside of the choice port according to the dominant component of the mixture, that is, at the left port for mixtures A/B &gt; 50/50 and at the right port for A/B &lt; 50/50. The task training for these data and other dataset presented here focused on achieving high accuracy and did not specifically promote the confidence-dependent choice bias we have observed.</p></sec><sec id="s4-8"><title>Rat auditory experiment</title><p>Rats self-initiated each trial by entering the central stimulus port. After a random delay of 0.2–0.4 s, auditory stimuli were presented. Rats had to determine the side with the higher number of clicks in binaural streams of clicks (<xref ref-type="bibr" rid="bib6">Brunton et al., 2013</xref>; <xref ref-type="bibr" rid="bib39">Sanders et al., 2016</xref>; <xref ref-type="bibr" rid="bib40">Sanders and Kepecs, 2012</xref>). Auditory stimuli were Poisson-distributed click trains played binaurally at the two speakers placed outside of the behavioral box for a fixed time of 0.25 s. For each rat, we chose a maximum click rate according to the performance of the animal, typically 50 clicks/s. This maximum click rate was fixed for each animal. For each trial, we randomly chose a delta click rate between left and right from a uniform distribution between 0 and maximum click rate. The sum of the left and right click rate was kept constant at maximum click rate. Rats indicated their choice by exiting the stimulus port and entering one of two choice ports (left or right) with a maximum response time of 3 s after leaving the stimulus port. Choices were rewarded according the higher number of clicks presented between the left and right click train. Exiting the stimulus port during the pre-stimulus delay or during the stimulus time (first 0.25 s) were followed by a white noise and a time out of 3–7 s.</p></sec><sec id="s4-9"><title>Rat randomly interleaved auditory-olfactory experiment</title><p>Rats self-initiated each trial by entering the central stimulus port. After a random delay of 0.2–0.4 s, either an olfactory or auditory stimulus was presented (randomly interleaved). For olfactory stimuli, rats had to determine the dominant odor of a mix of pure odorants +2-octanol and –2-octanol. Odor stimuli were delivered for at least 0.35 s or until the rat left the center port (max. 3 s). Odor mixtures were fixed at seven concentration ratios, which we adjusted to match the performance levels for each mixture ratio across animals, as described above in the rat olfactory experiment. One of the stimuli was a 50/50 ratio stimulus for which correct side is randomly assigned and those trials were removed from the analysis. After a variable odor sampling time, rats exited the stimulus port, which terminated odor delivery, and indicated their choice by entering one of two choice ports (left or right) with a maximum response time of 3 s after leaving the stimulus port. Choices were rewarded according to the dominant odor component in the mixture. For auditory stimuli, rats had to determine the side with the higher number of clicks in binaural streams of clicks. Auditory stimuli were random Poisson-distributed click trains played binaurally at the two speakers placed outside of the behavioral box for a fixed time of 0.25 s, as described above for the rat auditory experiment. Exiting the stimulus port during the pre-stimulus delay or during the stimulus time (first 0.35 s for olfactory trials) were followed by a white noise and a time out of 3–7 s. Choices were rewarded according the higher number of clicks presented between the left and right click train. Reward timing was sampled from a truncated exponential distribution: minimum reward delay was 0.6 s, maximum delay 8 s and decay tine constant of 1.5 s.</p></sec><sec id="s4-10"><title>Mouse auditory experiment</title><p>Mice were water restricted for a week (administered 1.2 ml of water in a single session per day), handled for 2 days and then gradually shaped for 5–7 sessions to the contingencies of a two-alternative choice paradigm and subsequently trained to discriminate two complex stimuli before introducing 6 morphs of those stimuli. Trials were self-initiated upon the breaking of an infrared beam by a nose poke into the center port of three adjacent ports. Once mice remain in the center port over 0.2 s, mice were presented with one of two complex tones, following a 0.2–0.5 s delay (uniformly distributed). Auditory cues were presented until the mouse exited the center port. If a mouse entered the correct side port within 4 s, a 4 µl water drop was delivered from gravity-fed reservoirs regulated by solenoid valves. Trials in which mice did not remain in the center port long enough to elicit a cue were not considered valid trials and are not represented in our analyses. During the training period only, error trials were followed by a progressively increasing 3–10 s timeout in order to prevent rapid guessing. During initial training of the task, two complex tones were used for training. These are comprised of three tones centered on 3 kHz and three tones centered on 7.5 kHz, all components share base frequency of 1.5 kHz. These two training tones are described as 0 and 100 (%A) stimuli, respectively. In the perceptual decision-making task, each of the 36 complex tones varied in the balance of 6 components of Tones A and B. To vary discrimination difficulty, we varied the amplitude ratio of the two spectral peaks (3 kHz and 7.5 kHz). Morph tones comprised six sets of auditory stimuli described here as percentages of a high- and low-frequency complex tone, morph A and morph B, respectively. Each of six sets is comprised of six similar stimuli with percentages in terms of morph A of 5–10, 25–30, 35–40, 60–65, 70–75, 90–95. We thereby challenged mice with a variety of 36 stimuli, and were able to pool members of each stimulus set for the analysis. Stimuli were delivered through generic electromagnetic dynamic speakers located on each side of the behavior chamber.</p></sec><sec id="s4-11"><title>Mouse visual experiment</title><p>Mice were trained in a 2-alternative forced choice visual detection task (<xref ref-type="bibr" rid="bib7">Burgess et al., 2017</xref>). After mouse kept the wheel still for at least 0.5 s, a sinusoidal grating stimulus of varying contrast appeared on either the left or right monitor, together with a brief tone (0.1 s, 12 kHz) indicating that the trial had started. The mouse could immediately report its decision by turning the wheel located underneath its forepaws. Wheel movements drove the stimulus on the monitor, and a reward was delivered if the stimulus reached the center of the middle monitor (a successful trial), but a 2 s white noise was played if the stimulus reached the center of the either left or right monitors (an error trial). The inter trial interval was set to 3 s. As previously reported, well-trained mice often reported their decisions using fast stereotypical wheel movements (<xref ref-type="bibr" rid="bib7">Burgess et al., 2017</xref>). After 2–3 weeks of training, the task typically included 6 or 7 levels of contrast (three on the left, three on the right) which were presented in a random order across trials with equal probability.</p></sec><sec id="s4-12"><title>Human visual experiment</title><p>The experiments are described in detail in <xref ref-type="bibr" rid="bib47">Urai et al. (2017)</xref>. Observers performed a two-interval forced choice motion coherence discrimination task at constant luminance. Specifically, observers judged the difference in motion coherence between two successively presented random dot kinematograms (RDKs): a constant reference stimulus (70% motion coherence) and a test stimulus (varying motion coherence levels specified below). A beep indicated the onset of each (test and reference) stimulus. The intervals before, in between, and after (until the inter-trial interval) these two task-relevant stimuli had variable duration and contained randomly moving dots. After offset of the test stimulus, observers had 3 s to report their judgment (button press with left or right index finger, counterbalanced across observers). After a variable interval (1.5–2.5 s), a feedback tone was played. Dot motion was stopped 2–2.5 s after feedback, with stationary dots indicating the inter-trial interval, during which observers were allowed to blink their eyes. Observers self-initiated the next trial by button press. The difference between motion coherence of test and reference was taken from three sets: easy (2.5, 5, 10, 20, 30), medium (1.25, 2.5, 5, 10, 30) and hard (0.625, 1.25, 2.5, 5, 20). All observers started with the easy set and were switched to the medium set when their psychophysical thresholds (70% accuracy) dropped below 15%, and to the hard set when thresholds dropped below 10%, in a given session. Motion coherence differences were randomly shuffled within each block.</p></sec></sec></body><back><ack id="ack"><title>Acknowledgements</title><p>This work was supported by the Wellcome Trust (grants 106101 and 213465 to AL). NU was funded by NIH R01 MH110404 and Mind Brain Behavior (MBB) Faculty Award. AK was funded by NIH R01MH097061 and R01DA038209. MC was funded by by the Wellcome Trust (205093). AEU was funded by a German Academic Exchange Service (DAAD) doctoral scholarship. THD was funded by German Research Foundation (DFG) grants: DO 1240/2–1 and DO 1240/3–1. ST and EH were supported by RIKEN-CBS, JPB Foundation, and HHMI.</p></ack><sec id="s5" sec-type="additional-information"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="COI-statement" id="conf3"><p>Reviewing editor, <italic>eLife</italic></p></fn><fn fn-type="COI-statement" id="conf2"><p>Reviewing editor, <italic>eLife</italic></p></fn><fn fn-type="COI-statement" id="conf1"><p>No competing interests declared</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>Conceptualization, Data curation, Software, Formal analysis, Resources, Funding acquisition, Investigation, Visualization, Methodology</p></fn><fn fn-type="con" id="con2"><p>Data curation, Investigation, Methodology</p></fn><fn fn-type="con" id="con3"><p>Data curation, Investigation, Methodology</p></fn><fn fn-type="con" id="con4"><p>Data curation, Investigation, Methodology</p></fn><fn fn-type="con" id="con5"><p>Data curation, Investigation, Methodology</p></fn><fn fn-type="con" id="con6"><p>Data curation, Investigation, Methodology</p></fn><fn fn-type="con" id="con7"><p>Resources, Supervision, Funding acquisition</p></fn><fn fn-type="con" id="con8"><p>Resources, Supervision, Funding acquisition</p></fn><fn fn-type="con" id="con9"><p>Resources, Supervision, Funding acquisition</p></fn><fn fn-type="con" id="con10"><p>Conceptualization, Resources, Supervision, Funding acquisition</p></fn><fn fn-type="con" id="con11"><p>Conceptualization, Resources, Formal analysis, Supervision, Funding acquisition</p></fn></fn-group><fn-group content-type="ethics-information"><title>Ethics</title><fn fn-type="other" id="fn1"><p>Human subjects: The ethics committee at the University of Amsterdam approved the study, and all observers gave their informed consent.project ID: 2014-BC-3376.</p></fn><fn fn-type="other" id="fn2"><p>Animal experimentation: The experimental procedures were approved by Institutional committees at Cold Spring Harbor Laboratory (for experiments on rats), MIT and Harvard University (for mice auditory experiments) and were in accordance with National Institute of Health standards (project ID: 18-14-11-08-1). Experiments on mice visual decisions were approved by the home Office of the United Kingdom (license 70/8021). Experiments in humans were approved by the ethics committee at the University of Amsterdam (project ID: 2014-BC-3376).</p></fn></fn-group></sec><sec id="s6" sec-type="supplementary-material"><title>Additional files</title><supplementary-material id="transrepform"><label>Transparent reporting form</label><media mime-subtype="docx" mimetype="application" xlink:href="elife-49834-transrepform-v3.docx"/></supplementary-material></sec><sec id="s7" sec-type="data-availability"><title>Data availability</title><p>The human dataset used in this study is available at <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.6084/m9.figshare.4300043">https://doi.org/10.6084/m9.figshare.4300043</ext-link>.</p><p>The following previously published dataset was used:</p><p><element-citation id="dataset1" publication-type="data" specific-use="references"><person-group person-group-type="author"><name><surname>Urai</surname><given-names>AE</given-names></name><name><surname>Braun</surname><given-names>A</given-names></name><name><surname>Donner</surname><given-names>THD</given-names></name></person-group><year iso-8601-date="2018">2018</year><data-title>Pupil-linked arousal is driven by decision uncertainty and alters serial choice bias</data-title><source>Figshare</source><pub-id assigning-authority="figshare" pub-id-type="doi">10.6084/m9.Figshare.4300043</pub-id></element-citation></p></sec><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Abrahamyan</surname> <given-names>A</given-names></name><name><surname>Silva</surname> <given-names>LL</given-names></name><name><surname>Dakin</surname> <given-names>SC</given-names></name><name><surname>Carandini</surname> <given-names>M</given-names></name><name><surname>Gardner</surname> <given-names>JL</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Adaptable history biases in human perceptual decisions</article-title><source>PNAS</source><volume>113</volume><fpage>E3548</fpage><lpage>E3557</lpage><pub-id pub-id-type="doi">10.1073/pnas.1518786113</pub-id><pub-id pub-id-type="pmid">27330086</pub-id></element-citation></ref><ref id="bib2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Akaishi</surname> <given-names>R</given-names></name><name><surname>Umeda</surname> <given-names>K</given-names></name><name><surname>Nagase</surname> <given-names>A</given-names></name><name><surname>Sakai</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Autonomous mechanism of internal choice estimate underlies decision inertia</article-title><source>Neuron</source><volume>81</volume><fpage>195</fpage><lpage>206</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2013.10.018</pub-id><pub-id pub-id-type="pmid">24333055</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Akrami</surname> <given-names>A</given-names></name><name><surname>Kopec</surname> <given-names>CD</given-names></name><name><surname>Diamond</surname> <given-names>ME</given-names></name><name><surname>Brody</surname> <given-names>CD</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Posterior parietal cortex represents sensory history and mediates its effects on behaviour</article-title><source>Nature</source><volume>554</volume><fpage>368</fpage><lpage>372</lpage><pub-id pub-id-type="doi">10.1038/nature25510</pub-id><pub-id pub-id-type="pmid">29414944</pub-id></element-citation></ref><ref id="bib4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Braun</surname> <given-names>A</given-names></name><name><surname>Urai</surname> <given-names>AE</given-names></name><name><surname>Donner</surname> <given-names>TH</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Adaptive history biases result from Confidence-Weighted accumulation of past choices</article-title><source>The Journal of Neuroscience</source><volume>38</volume><fpage>2418</fpage><lpage>2429</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.2189-17.2017</pub-id><pub-id pub-id-type="pmid">29371318</pub-id></element-citation></ref><ref id="bib5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Britten</surname> <given-names>KH</given-names></name><name><surname>Shadlen</surname> <given-names>MN</given-names></name><name><surname>Newsome</surname> <given-names>WT</given-names></name><name><surname>Movshon</surname> <given-names>JA</given-names></name></person-group><year iso-8601-date="1992">1992</year><article-title>The analysis of visual motion: a comparison of neuronal and psychophysical performance</article-title><source>The Journal of Neuroscience</source><volume>12</volume><fpage>4745</fpage><lpage>4765</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.12-12-04745.1992</pub-id></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Brunton</surname> <given-names>BW</given-names></name><name><surname>Botvinick</surname> <given-names>MM</given-names></name><name><surname>Brody</surname> <given-names>CD</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Rats and humans can optimally accumulate evidence for decision-making</article-title><source>Science</source><volume>340</volume><fpage>95</fpage><lpage>98</lpage><pub-id pub-id-type="doi">10.1126/science.1233912</pub-id><pub-id pub-id-type="pmid">23559254</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Burgess</surname> <given-names>CP</given-names></name><name><surname>Lak</surname> <given-names>A</given-names></name><name><surname>Steinmetz</surname> <given-names>NA</given-names></name><name><surname>Zatka-Haas</surname> <given-names>P</given-names></name><name><surname>Bai Reddy</surname> <given-names>C</given-names></name><name><surname>Jacobs</surname> <given-names>EAK</given-names></name><name><surname>Linden</surname> <given-names>JF</given-names></name><name><surname>Paton</surname> <given-names>JJ</given-names></name><name><surname>Ranson</surname> <given-names>A</given-names></name><name><surname>Schröder</surname> <given-names>S</given-names></name><name><surname>Soares</surname> <given-names>S</given-names></name><name><surname>Wells</surname> <given-names>MJ</given-names></name><name><surname>Wool</surname> <given-names>LE</given-names></name><name><surname>Harris</surname> <given-names>KD</given-names></name><name><surname>Carandini</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>High-Yield methods for accurate Two-Alternative visual psychophysics in Head-Fixed mice</article-title><source>Cell Reports</source><volume>20</volume><fpage>2513</fpage><lpage>2524</lpage><pub-id pub-id-type="doi">10.1016/j.celrep.2017.08.047</pub-id><pub-id pub-id-type="pmid">28877482</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Busse</surname> <given-names>L</given-names></name><name><surname>Ayaz</surname> <given-names>A</given-names></name><name><surname>Dhruv</surname> <given-names>NT</given-names></name><name><surname>Katzner</surname> <given-names>S</given-names></name><name><surname>Saleem</surname> <given-names>AB</given-names></name><name><surname>Schölvinck</surname> <given-names>ML</given-names></name><name><surname>Zaharia</surname> <given-names>AD</given-names></name><name><surname>Carandini</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>The detection of visual contrast in the behaving mouse</article-title><source>Journal of Neuroscience</source><volume>31</volume><fpage>11351</fpage><lpage>11361</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.6689-10.2011</pub-id><pub-id pub-id-type="pmid">21813694</pub-id></element-citation></ref><ref id="bib9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cho</surname> <given-names>RY</given-names></name><name><surname>Nystrom</surname> <given-names>LE</given-names></name><name><surname>Brown</surname> <given-names>ET</given-names></name><name><surname>Jones</surname> <given-names>AD</given-names></name><name><surname>Braver</surname> <given-names>TS</given-names></name><name><surname>Holmes</surname> <given-names>PJ</given-names></name><name><surname>Cohen</surname> <given-names>JD</given-names></name></person-group><year iso-8601-date="2002">2002</year><article-title>Mechanisms underlying dependencies of performance on stimulus history in a two-alternative forced-choice task</article-title><source>Cognitive, Affective, &amp; Behavioral Neuroscience</source><volume>2</volume><fpage>283</fpage><lpage>299</lpage><pub-id pub-id-type="doi">10.3758/CABN.2.4.283</pub-id><pub-id pub-id-type="pmid">12641174</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Daw</surname> <given-names>ND</given-names></name><name><surname>O'Doherty</surname> <given-names>JP</given-names></name><name><surname>Dayan</surname> <given-names>P</given-names></name><name><surname>Seymour</surname> <given-names>B</given-names></name><name><surname>Dolan</surname> <given-names>RJ</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Cortical substrates for exploratory decisions in humans</article-title><source>Nature</source><volume>441</volume><fpage>876</fpage><lpage>879</lpage><pub-id pub-id-type="doi">10.1038/nature04766</pub-id><pub-id pub-id-type="pmid">16778890</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Daw</surname> <given-names>ND</given-names></name><name><surname>Doya</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>The computational neurobiology of learning and reward</article-title><source>Current Opinion in Neurobiology</source><volume>16</volume><fpage>199</fpage><lpage>204</lpage><pub-id pub-id-type="doi">10.1016/j.conb.2006.03.006</pub-id><pub-id pub-id-type="pmid">16563737</pub-id></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dayan</surname> <given-names>P</given-names></name><name><surname>Daw</surname> <given-names>ND</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Decision theory, reinforcement learning, and the brain</article-title><source>Cognitive, Affective, &amp; Behavioral Neuroscience</source><volume>8</volume><fpage>429</fpage><lpage>453</lpage><pub-id pub-id-type="doi">10.3758/CABN.8.4.429</pub-id><pub-id pub-id-type="pmid">19033240</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Drugowitsch</surname> <given-names>J</given-names></name><name><surname>Mendonça</surname> <given-names>AG</given-names></name><name><surname>Mainen</surname> <given-names>ZF</given-names></name><name><surname>Pouget</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Learning optimal decisions with confidence</article-title><source>PNAS</source><volume>116</volume><fpage>24872</fpage><lpage>24880</lpage><pub-id pub-id-type="doi">10.1073/pnas.1906787116</pub-id><pub-id pub-id-type="pmid">31732671</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dutilh</surname> <given-names>G</given-names></name><name><surname>van Ravenzwaaij</surname> <given-names>D</given-names></name><name><surname>Nieuwenhuis</surname> <given-names>S</given-names></name><name><surname>van der Maas</surname> <given-names>HLJ</given-names></name><name><surname>Forstmann</surname> <given-names>BU</given-names></name><name><surname>Wagenmakers</surname> <given-names>E-J</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>How to measure post-error slowing: a confound and a simple solution</article-title><source>Journal of Mathematical Psychology</source><volume>56</volume><fpage>208</fpage><lpage>216</lpage><pub-id pub-id-type="doi">10.1016/j.jmp.2012.04.001</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fan</surname> <given-names>Y</given-names></name><name><surname>Gold</surname> <given-names>JI</given-names></name><name><surname>Ding</surname> <given-names>L</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Ongoing, rational calibration of reward-driven perceptual biases</article-title><source>eLife</source><volume>7</volume><elocation-id>e36018</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.36018</pub-id><pub-id pub-id-type="pmid">30303484</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fischer</surname> <given-names>J</given-names></name><name><surname>Whitney</surname> <given-names>D</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Serial dependence in visual perception</article-title><source>Nature Neuroscience</source><volume>17</volume><fpage>738</fpage><lpage>743</lpage><pub-id pub-id-type="doi">10.1038/nn.3689</pub-id><pub-id pub-id-type="pmid">24686785</pub-id></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fritsche</surname> <given-names>M</given-names></name><name><surname>Mostert</surname> <given-names>P</given-names></name><name><surname>de Lange</surname> <given-names>FP</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Opposite effects of recent history on perception and decision</article-title><source>Current Biology</source><volume>27</volume><fpage>590</fpage><lpage>595</lpage><pub-id pub-id-type="doi">10.1016/j.cub.2017.01.006</pub-id><pub-id pub-id-type="pmid">28162897</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fründ</surname> <given-names>I</given-names></name><name><surname>Wichmann</surname> <given-names>FA</given-names></name><name><surname>Macke</surname> <given-names>JH</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Quantifying the effect of intertrial dependence on perceptual decisions</article-title><source>Journal of Vision</source><volume>14</volume><elocation-id>9</elocation-id><pub-id pub-id-type="doi">10.1167/14.7.9</pub-id><pub-id pub-id-type="pmid">24944238</pub-id></element-citation></ref><ref id="bib19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Glaze</surname> <given-names>CM</given-names></name><name><surname>Kable</surname> <given-names>JW</given-names></name><name><surname>Gold</surname> <given-names>JI</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Normative evidence accumulation in unpredictable environments</article-title><source>eLife</source><volume>4</volume><elocation-id>e08825</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.08825</pub-id></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gold</surname> <given-names>JI</given-names></name><name><surname>Law</surname> <given-names>CT</given-names></name><name><surname>Connolly</surname> <given-names>P</given-names></name><name><surname>Bennur</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>The relative influences of priors and sensory evidence on an oculomotor decision variable during perceptual learning</article-title><source>Journal of Neurophysiology</source><volume>100</volume><fpage>2653</fpage><lpage>2668</lpage><pub-id pub-id-type="doi">10.1152/jn.90629.2008</pub-id><pub-id pub-id-type="pmid">18753326</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Green</surname> <given-names>DM</given-names></name><name><surname>Swets</surname> <given-names>JA</given-names></name></person-group><year iso-8601-date="1966">1966</year><source>Signal Detection Theory and Psychophysics</source><publisher-name>John Wiley and Sons</publisher-name></element-citation></ref><ref id="bib22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hangya</surname> <given-names>B</given-names></name><name><surname>Sanders</surname> <given-names>JI</given-names></name><name><surname>Kepecs</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>A mathematical framework for statistical decision confidence</article-title><source>Neural Computation</source><volume>28</volume><fpage>1840</fpage><lpage>1858</lpage><pub-id pub-id-type="doi">10.1162/NECO_a_00864</pub-id><pub-id pub-id-type="pmid">27391683</pub-id></element-citation></ref><ref id="bib23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hernández</surname> <given-names>A</given-names></name><name><surname>Salinas</surname> <given-names>E</given-names></name><name><surname>García</surname> <given-names>R</given-names></name><name><surname>Romo</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="1997">1997</year><article-title>Discrimination in the sense of flutter: new psychophysical measurements in monkeys</article-title><source>The Journal of Neuroscience</source><volume>17</volume><fpage>6391</fpage><lpage>6400</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.17-16-06391.1997</pub-id><pub-id pub-id-type="pmid">9236247</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hirokawa</surname> <given-names>J</given-names></name><name><surname>Vaughan</surname> <given-names>A</given-names></name><name><surname>Masset</surname> <given-names>P</given-names></name><name><surname>Ott</surname> <given-names>T</given-names></name><name><surname>Kepecs</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Frontal cortex neuron types categorically encode single decision variables</article-title><source>Nature</source><volume>576</volume><fpage>446</fpage><lpage>451</lpage><pub-id pub-id-type="doi">10.1038/s41586-019-1816-9</pub-id><pub-id pub-id-type="pmid">31801999</pub-id></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hwang</surname> <given-names>EJ</given-names></name><name><surname>Dahlen</surname> <given-names>JE</given-names></name><name><surname>Mukundan</surname> <given-names>M</given-names></name><name><surname>Komiyama</surname> <given-names>T</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>History-based action selection Bias in posterior parietal cortex</article-title><source>Nature Communications</source><volume>8</volume><elocation-id>1242</elocation-id><pub-id pub-id-type="doi">10.1038/s41467-017-01356-z</pub-id><pub-id pub-id-type="pmid">29089500</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kepecs</surname> <given-names>A</given-names></name><name><surname>Uchida</surname> <given-names>N</given-names></name><name><surname>Zariwala</surname> <given-names>HA</given-names></name><name><surname>Mainen</surname> <given-names>ZF</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Neural correlates, computation and behavioural impact of decision confidence</article-title><source>Nature</source><volume>455</volume><fpage>227</fpage><lpage>231</lpage><pub-id pub-id-type="doi">10.1038/nature07200</pub-id><pub-id pub-id-type="pmid">18690210</pub-id></element-citation></ref><ref id="bib27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lak</surname> <given-names>A</given-names></name><name><surname>Nomoto</surname> <given-names>K</given-names></name><name><surname>Keramati</surname> <given-names>M</given-names></name><name><surname>Sakagami</surname> <given-names>M</given-names></name><name><surname>Kepecs</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Midbrain dopamine neurons signal belief in choice accuracy during a perceptual decision</article-title><source>Current Biology</source><volume>27</volume><fpage>821</fpage><lpage>832</lpage><pub-id pub-id-type="doi">10.1016/j.cub.2017.02.026</pub-id><pub-id pub-id-type="pmid">28285994</pub-id></element-citation></ref><ref id="bib28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lak</surname> <given-names>A</given-names></name><name><surname>Okun</surname> <given-names>M</given-names></name><name><surname>Moss</surname> <given-names>MM</given-names></name><name><surname>Gurnani</surname> <given-names>H</given-names></name><name><surname>Farrell</surname> <given-names>K</given-names></name><name><surname>Wells</surname> <given-names>MJ</given-names></name><name><surname>Reddy</surname> <given-names>CB</given-names></name><name><surname>Kepecs</surname> <given-names>A</given-names></name><name><surname>Harris</surname> <given-names>KD</given-names></name><name><surname>Carandini</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Dopaminergic and prefrontal basis of learning from sensory confidence and reward value</article-title><source>Neuron</source><volume>105</volume><fpage>700</fpage><lpage>711</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2019.11.018</pub-id><pub-id pub-id-type="pmid">31859030</pub-id></element-citation></ref><ref id="bib29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lee</surname> <given-names>D</given-names></name><name><surname>Seo</surname> <given-names>H</given-names></name><name><surname>Jung</surname> <given-names>MW</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Neural basis of reinforcement learning and decision making</article-title><source>Annual Review of Neuroscience</source><volume>35</volume><fpage>287</fpage><lpage>308</lpage><pub-id pub-id-type="doi">10.1146/annurev-neuro-062111-150512</pub-id><pub-id pub-id-type="pmid">22462543</pub-id></element-citation></ref><ref id="bib30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lueckmann</surname> <given-names>JM</given-names></name><name><surname>Macke</surname> <given-names>JH</given-names></name><name><surname>Nienborg</surname> <given-names>H</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Can serial dependencies in choices and neural activity explain choice probabilities?</article-title><source>The Journal of Neuroscience</source><volume>38</volume><fpage>3495</fpage><lpage>3506</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.2225-17.2018</pub-id><pub-id pub-id-type="pmid">29440531</pub-id></element-citation></ref><ref id="bib31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Luu</surname> <given-names>L</given-names></name><name><surname>Stocker</surname> <given-names>AA</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Post-decision biases reveal a self-consistency principle in perceptual inference</article-title><source>eLife</source><volume>7</volume><elocation-id>e33334</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.33334</pub-id><pub-id pub-id-type="pmid">29785928</pub-id></element-citation></ref><ref id="bib32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Maljkovic</surname> <given-names>V</given-names></name><name><surname>Nakayama</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="1994">1994</year><article-title>Priming of pop-out: I. role of features</article-title><source>Memory &amp; Cognition</source><volume>22</volume><fpage>657</fpage><lpage>672</lpage><pub-id pub-id-type="doi">10.3758/BF03209251</pub-id></element-citation></ref><ref id="bib33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Marcos</surname> <given-names>E</given-names></name><name><surname>Pani</surname> <given-names>P</given-names></name><name><surname>Brunamonti</surname> <given-names>E</given-names></name><name><surname>Deco</surname> <given-names>G</given-names></name><name><surname>Ferraina</surname> <given-names>S</given-names></name><name><surname>Verschure</surname> <given-names>P</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Neural variability in premotor cortex is modulated by trial history and predicts behavioral performance</article-title><source>Neuron</source><volume>78</volume><fpage>249</fpage><lpage>255</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2013.02.006</pub-id><pub-id pub-id-type="pmid">23622062</pub-id></element-citation></ref><ref id="bib34"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Mendonça</surname> <given-names>AG</given-names></name><name><surname>Drugowitsch</surname> <given-names>J</given-names></name><name><surname>Vicente</surname> <given-names>MI</given-names></name><name><surname>DeWitt</surname> <given-names>E</given-names></name><name><surname>Pouget</surname> <given-names>A</given-names></name><name><surname>Mainen</surname> <given-names>ZF</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>The impact of learning on perceptual decisions and its implication for speed-accuracy tradeoffs</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/501858</pub-id></element-citation></ref><ref id="bib35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pouget</surname> <given-names>A</given-names></name><name><surname>Drugowitsch</surname> <given-names>J</given-names></name><name><surname>Kepecs</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Confidence and certainty: distinct probabilistic quantities for different goals</article-title><source>Nature Neuroscience</source><volume>19</volume><fpage>366</fpage><lpage>374</lpage><pub-id pub-id-type="doi">10.1038/nn.4240</pub-id><pub-id pub-id-type="pmid">26906503</pub-id></element-citation></ref><ref id="bib36"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Purcell</surname> <given-names>BA</given-names></name><name><surname>Kiani</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Neural mechanisms of Post-error adjustments of decision policy in parietal cortex</article-title><source>Neuron</source><volume>89</volume><fpage>658</fpage><lpage>671</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2015.12.027</pub-id><pub-id pub-id-type="pmid">26804992</pub-id></element-citation></ref><ref id="bib37"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rao</surname> <given-names>RP</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Decision making under uncertainty: a neural model based on partially observable markov decision processes</article-title><source>Frontiers in Computational Neuroscience</source><volume>4</volume><elocation-id>146</elocation-id><pub-id pub-id-type="doi">10.3389/fncom.2010.00146</pub-id><pub-id pub-id-type="pmid">21152255</pub-id></element-citation></ref><ref id="bib38"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Samejima</surname> <given-names>K</given-names></name><name><surname>Ueda</surname> <given-names>Y</given-names></name><name><surname>Doya</surname> <given-names>K</given-names></name><name><surname>Kimura</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Representation of action-specific reward values in the striatum</article-title><source>Science</source><volume>310</volume><fpage>1337</fpage><lpage>1340</lpage><pub-id pub-id-type="doi">10.1126/science.1115270</pub-id><pub-id pub-id-type="pmid">16311337</pub-id></element-citation></ref><ref id="bib39"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sanders</surname> <given-names>JI</given-names></name><name><surname>Hangya</surname> <given-names>B</given-names></name><name><surname>Kepecs</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Signatures of a statistical computation in the human sense of confidence</article-title><source>Neuron</source><volume>90</volume><fpage>499</fpage><lpage>506</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2016.03.025</pub-id><pub-id pub-id-type="pmid">27151640</pub-id></element-citation></ref><ref id="bib40"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sanders</surname> <given-names>JI</given-names></name><name><surname>Kepecs</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Choice ball: a response interface for two-choice psychometric discrimination in head-fixed mice</article-title><source>Journal of Neurophysiology</source><volume>108</volume><fpage>3416</fpage><lpage>3423</lpage><pub-id pub-id-type="doi">10.1152/jn.00669.2012</pub-id><pub-id pub-id-type="pmid">23019000</pub-id></element-citation></ref><ref id="bib41"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sanders</surname> <given-names>JI</given-names></name><name><surname>Kepecs</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>A low-cost programmable pulse generator for physiology and behavior</article-title><source>Frontiers in Neuroengineering</source><volume>7</volume><elocation-id>43</elocation-id><pub-id pub-id-type="doi">10.3389/fneng.2014.00043</pub-id><pub-id pub-id-type="pmid">25566051</pub-id></element-citation></ref><ref id="bib42"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sollich</surname> <given-names>P</given-names></name></person-group><year iso-8601-date="2002">2002</year><article-title>Bayesian methods for support vector machines: evidence and predictive class probabilities</article-title><source>Machine Learning</source><volume>46</volume><fpage>21</fpage><lpage>52</lpage><pub-id pub-id-type="doi">10.1023/A:1012489924661</pub-id></element-citation></ref><ref id="bib43"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Sutton</surname> <given-names>RS</given-names></name><name><surname>Barto</surname> <given-names>AG</given-names></name></person-group><year iso-8601-date="1998">1998</year><source>Reinforcement Learning: An Introduction</source><publisher-name>MIT press</publisher-name></element-citation></ref><ref id="bib44"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tai</surname> <given-names>LH</given-names></name><name><surname>Lee</surname> <given-names>AM</given-names></name><name><surname>Benavidez</surname> <given-names>N</given-names></name><name><surname>Bonci</surname> <given-names>A</given-names></name><name><surname>Wilbrecht</surname> <given-names>L</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Transient stimulation of distinct subpopulations of striatal neurons mimics changes in action value</article-title><source>Nature Neuroscience</source><volume>15</volume><fpage>1281</fpage><lpage>1289</lpage><pub-id pub-id-type="doi">10.1038/nn.3188</pub-id><pub-id pub-id-type="pmid">22902719</pub-id></element-citation></ref><ref id="bib45"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tsunada</surname> <given-names>J</given-names></name><name><surname>Cohen</surname> <given-names>Y</given-names></name><name><surname>Gold</surname> <given-names>JI</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Post-decision processing in primate prefrontal cortex influences subsequent choices on an auditory decision-making task</article-title><source>eLife</source><volume>8</volume><elocation-id>e46770</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.46770</pub-id><pub-id pub-id-type="pmid">31169495</pub-id></element-citation></ref><ref id="bib46"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Uchida</surname> <given-names>N</given-names></name><name><surname>Mainen</surname> <given-names>ZF</given-names></name></person-group><year iso-8601-date="2003">2003</year><article-title>Speed and accuracy of olfactory discrimination in the rat</article-title><source>Nature Neuroscience</source><volume>6</volume><fpage>1224</fpage><lpage>1229</lpage><pub-id pub-id-type="doi">10.1038/nn1142</pub-id><pub-id pub-id-type="pmid">14566341</pub-id></element-citation></ref><ref id="bib47"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Urai</surname> <given-names>AE</given-names></name><name><surname>Braun</surname> <given-names>A</given-names></name><name><surname>Donner</surname> <given-names>TH</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Pupil-linked arousal is driven by decision uncertainty and alters serial choice Bias</article-title><source>Nature Communications</source><volume>8</volume><elocation-id>e14637</elocation-id><pub-id pub-id-type="doi">10.1038/ncomms14637</pub-id></element-citation></ref><ref id="bib48"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wichmann</surname> <given-names>FA</given-names></name><name><surname>Hill</surname> <given-names>NJ</given-names></name></person-group><year iso-8601-date="2001">2001</year><article-title>The psychometric function: I. fitting, sampling, and goodness of fit</article-title><source>Perception &amp; Psychophysics</source><volume>63</volume><fpage>1293</fpage><lpage>1313</lpage><pub-id pub-id-type="doi">10.3758/BF03194544</pub-id><pub-id pub-id-type="pmid">11800458</pub-id></element-citation></ref><ref id="bib49"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Yu</surname> <given-names>AJ</given-names></name><name><surname>Cohen</surname> <given-names>JD</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Sequential effects: superstition or rational behavior?</article-title><conf-name>Advances in Neural Information Processing Systems</conf-name><fpage>1873</fpage><lpage>1880</lpage></element-citation></ref><ref id="bib50"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zariwala</surname> <given-names>HA</given-names></name><name><surname>Kepecs</surname> <given-names>A</given-names></name><name><surname>Uchida</surname> <given-names>N</given-names></name><name><surname>Hirokawa</surname> <given-names>J</given-names></name><name><surname>Mainen</surname> <given-names>ZF</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>The limits of deliberation in a perceptual decision task</article-title><source>Neuron</source><volume>78</volume><fpage>339</fpage><lpage>351</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2013.02.010</pub-id><pub-id pub-id-type="pmid">23541901</pub-id></element-citation></ref></ref-list></back><sub-article article-type="decision-letter" id="sa1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.49834.sa1</article-id><title-group><article-title>Decision letter</article-title></title-group><contrib-group><contrib contrib-type="editor"><name><surname>Salinas</surname><given-names>Emilio</given-names></name><role>Reviewing Editor</role><aff><institution>Wake Forest School of Medicine</institution><country>United States</country></aff></contrib></contrib-group><contrib-group><contrib contrib-type="reviewer"><name><surname>Salinas</surname><given-names>Emilio</given-names> </name><role>Reviewer</role><aff><institution>Wake Forest School of Medicine</institution><country>United States</country></aff></contrib><contrib contrib-type="reviewer"><name><surname>Brody</surname><given-names>Carlos D</given-names></name><role>Reviewer</role><aff><institution>Princeton University</institution><country>United States</country></aff></contrib><contrib contrib-type="reviewer"><name><surname>Ding</surname><given-names>Long</given-names> </name><role>Reviewer</role><aff><institution>University of Pennsylvania</institution><country>United States</country></aff></contrib></contrib-group></front-stub><body><boxed-text><p>In the interests of transparency, eLife publishes the most substantive revision requests and the accompanying author responses.</p></boxed-text><p><bold>Acceptance summary:</bold></p><p>This study investigates how past choice history influences decisions that, in principle, should be guided just by currently available sensory information. It combines two classic approaches, perceptual decision making and reinforcement learning, to show that the success of prior choices and the quality of the perceptual information guiding them are automatically tracked, and that both factors are used to bias upcoming choices that are difficult, i.e., those for which the quality of the sensory information is poor and the subject is largely guessing. The effect is robust across sensory modalities, species, task details, and labs. It explains an important source of variance in behavior.</p><p><bold>Decision letter after peer review:</bold></p><p>Thank you for sending your article entitled &quot;Confidence-guided updating of choice bias during perceptual decisions is a widespread behavioral phenomenon&quot; for peer review at <italic>eLife</italic>. Your article has been evaluated by three peer reviewers, one of whom is a member of our Board of Reviewing Editors, and the evaluation has been overseen by Michael Frank as the Senior Editor.</p><p>All reviewers found the work interesting and appealing. However, some potentially</p><p>serious issues were identified that could undermine the main conclusions. The full set of recommendations is below. Please focus your revisions on points 1, 2, and 4, which are most critical.</p><p>Essential revisions:</p><p>1) The first major concern is in regard to a claim made throughout the paper, namely that how easy or hard the <italic>current</italic> stimulus is affects the strength of the modulation. This is first presented in Figures 1F and 1G, and then repeated in almost all the figures. However, the measure presented in figures of the style of Figure 1F and summarized in Figure 1G is the% change in responses (given a particular current and previous stimulus, and relative to the overall average for that stimulus). This measure suffers from a large problem that, unfortunately, appears to not be addressed (apologies if it was missed on reading): there is a ceiling effect, in the sense that when a choice is easy (near 100%) it cannot increase further, even if there were strong underlying plasticity. The ceiling applies preferentially to easy stimuli, and therefore will manifest as a difference between easy and hard stimuli. It is currently impossible to tell whether the data shown in support of the claim of &quot;current stimulus strength modulates effect&quot; is merely an artifact resulting from this ceiling issue, or an actual finding. It is very important that the authors clarify this issue.</p><p>2a) Another key claim is that only the model with a belief state could account for the results. But the data are not convincing. Let's start with a TD model, without learning of actions, merely learning the values <italic>V<sub>R</sub></italic> and <italic>V<sub>L</sub></italic>, and let's suppose the value of V<sub>R</sub> is modified only after <italic>R</italic> choices (and similarly for <italic>V<sub>L</sub></italic> and <italic>L</italic> choices). Under these conditions (and assuming <italic>R-L</italic> symmetry) <italic>V<sub>R</sub></italic> and <italic>V<sub>L</sub></italic> will converge to the overall% correct. This will be more than 50%; for a typical smooth psychometric curve it might be 75% or 80%. Now move to a TDRL model that also learns actions: because there are more errors for hard stimuli, the error signal (<italic>V<sub>C</sub> – r</italic>) will, on average, be greater for hard stimuli than for easy stimuli. And therefore, in this situation, there will on average be greater plasticity after hard stimuli than after easy stimuli, entirely without a belief state. Could this not account for the authors' experimental data?</p><p>The situation and conclusion sketched here could be wrong. But readers are likely to think about it and wonder whether it undermines the authors' conclusions. Thus, explicitly addressing this argument, and whether it is qualitatively or quantitatively incorrect, would strengthen the manuscript.</p><p>2b) A related concern is that, if we understand correctly, the model produces only step-function psychometric curves: for a given stimulus <italic>s</italic>, the response is deterministic, and when <italic>V<sub>R</sub></italic> = <italic>V<sub>L</sub></italic>, the model would produce 100% correct behavior. This might seem unimportant, since the details of the shapes of psychometric curves are not the focus of the manuscript, and replacing the distribution-based model with one that uses noisy samples might seem a trivial change. However, distinguishing between hard and easy trials is central to the arguments in the manuscript, and the corresponding difference in error rates might easily become important (as in the situation sketched in point 2a above). So a model that produces smooth psychometric functions (as opposed to step-shaped) might be important after all (and at least cosmetically would be an obviously better match to the data).</p><p>2c) The authors posit that the subjects use an internal measure of decision confidence to update their decision policy. In support of this claim, they show that a qualitatively similar modulation can be produced by a temporal difference reinforcement learning (TDRL) model with prediction errors based on perceived stimulus strength. In this model, the prediction errors are used to update the stored value of each choice. We found this model design counterintuitive. It seems that an equivalent model could be constructed in which prior stimulus probabilities (<italic>p<sub>R</sub></italic> and <italic>p<sub>L</sub></italic>) are updated instead. This would be more consistent with the fact that the animal always receives the same amount of reward on rewarded trials, but may have uncertainty about exactly where to set the decision boundary leading to trial-to-trial updating. It would be helpful if the authors reformulated their model, or explained why reward values are being updated rather than reward probabilities.</p><p>2d) The Bayesian model that updates stimulus statistics seems to ignore which choice was made in the previous trial or whether it was correct. That is, there is a built-in handicap of no feedback, compared to the confidence-based models. How much does this &quot;handicap&quot; contribute to the poor match between model predictions and data in Figure 9A?</p><p>2e) Model predictions should be comparable to real data. In Figure 2, the plots for rats' average performance show three levels of previous stim (%A) for each direction, more or less evenly distributed. In Figure 3, however, previous stim (%A) are 20, 50 and another value very close to 50. Does the model performance depend on the stimulus strength used? The same stimulus strengths used in behavioral testing should be used for model predictions.</p><p>2f) Parameter values used to generate Figure 3 should be reported.</p><p>3) More detail and clarity are needed regarding the description of the basic phenomenon (e.g., sorting and analysis of the shown quantities). The Materials and methods section should include a brief section on how the psychophysical results were generated. That could include all the details of what was conditioned on what, as well as how the trials were divided into &quot;Hard&quot; and &quot;Easy&quot;.</p><p>Many of the key figures depict &quot;updating% &quot; and &quot;updating index.&quot; These terms should also be mathematically defined in the Materials and methods.</p><p>The equation used to fit the bias, lapse, sensitivity of psychometric curves should also be presented in the Materials and methods. These parameters are said to be &quot;stable.&quot; What is the criterion for determining stability?</p><p>Also, the trial nomenclature and labels used in Figure 2 (e.g., &quot;Next&quot; and &quot;Previous&quot;) were confusing.</p><p>Do subjects also show adjustments of sensitivity after correct trials? Would a change in sensitivity contribute to the observed confidence dependence (e.g., if the psychometric curves are shallower, the difference in choice might appear larger for difficult trials)?</p><p>4) What happens after errors? The results demonstrate an effect akin to a win-stay strategy but limited to &quot;guesses&quot; only. Is there also a trend toward the corresponding lose-switch strategy? That is, when the choice in trial n-1 is difficult and not rewarded, is the subject more likely to choose the <italic>alternative</italic> option in trial n (when such decision is also difficult)? There is no obvious reason to expect that confidence-guided choice updating would not also happen after errors, but in any case, error trials should not simply be put aside. The authors should present an analysis of error trials and if they do not see the effect predicted by the model, should propose an explanation for the inconsistency. Other work from the same first author (Lak et al., 2017), presented an alternative TDRL model without the &quot;belief state,&quot; which seemed to have qualitatively similar results for correct trials but divergent results for errors. It seems that error trials are needed again in order to rule out this other model.</p><p>5) Related to this: &quot;The choice updating remained statistically significant even after this correction.&quot; True, but the effect did seem to get a bit weaker. I imagine this is because the history effects are not limited to one trial in the past, but possibly more. If so, you would expect the effect to become stronger when the current difficult choice is preceded by two rewarded guesses made in the same direction. Whether the trend is weak or not, it could be compared to the model's prediction.</p><p>6) The transfer of choice updating across modalities is interesting. Comparing Figure 2, 4C, and 8D, it seems that the updating is larger on pure olfactory tasks and about the same for the pure auditory or mixed tasks (this is more obvious in Figure 10). I assume the rats have different sensitivity to olfactory and auditory stimuli. Then the difference seems to contradict the statement that &quot;updating is guided by outcome expectations, rather than stimulus statistics&quot;. How much updating was there for trials in the mixed modality task but without modality switches?</p><p>7) Figure 10B and C should show scatterplots separately for each task. The authors' hypothesis is that updating is independent of stimulus statistics. If this is true, it makes sense to pool data across tasks. However, if the alternative is true that updating depends on certain properties of sensory stimulus, i.e., there could be different relationships between updating and slope/lapse, which could be obscured by pooling across tasks. A more direct test would be to fit the model to one task and predict results for the other tasks.</p><p>8) In Introduction and Discussion, the authors seem to suggest that this phenomenon persists after training is completed or after the subjects performed the task for extended periods and thus may reflect some optimal strategy. Was the training specifically targeting the suboptimal bias? Or is it possible that the subjects just settled on a suboptimal strategy that satisfies the training requirements? It might be useful to clarify what criteria were used to deem these subjects &quot;well-learned&quot;.</p><p>[Editors' note: further revisions were suggested prior to acceptance, as described below.]</p><p>Thank you for resubmitting your article &quot;Confidence-guided updating of choice bias during perceptual decisions is a widespread behavioral phenomenon&quot; for consideration by <italic>eLife</italic>. Your revised article has been reviewed by three peer reviewers, including Emilio Salinas as the Reviewing Editor and Reviewer #1, and the evaluation has been overseen by Michael Frank as the Senior Editor. The following individuals involved in review of your submission have agreed to reveal their identity: Carlos D Brody (Reviewer #2); Long Ding (Reviewer #3).</p><p>The reviewers have discussed the reviews with one another and the Reviewing Editor has drafted this decision to help you prepare a revised submission.</p><p>Summary:</p><p>This manuscript presents interesting, important data characterizing how past choice history influences decisions that, in principle, should be guided just by currently available sensory information. The results show that the success of prior choices and the quality of the perceptual information guiding them are automatically tracked, and that this information is used to bias upcoming choices that are difficult, i.e., for which the quality of the sensory information is poor and the subject is largely guessing. The work is significant because the phenomenon seems robust across sensory modalities, species, task details, and labs, and because the modeling results provide insight into the underlying associative mechanisms responsible for the biasing effects.</p><p>Essential revisions:</p><p>The paper is significantly improved, and the reviewers are now convinced that it contains important work that should be published. Nevertheless, the presentation of the data is still confusing, and some further clarifications would substantially strengthen the manuscript.</p><p>1) Explaining more in detail the fundamental difference between the standard TDRL model and the belief model would be important. Specifically, the updating that they generate during easy trials, and how that updating depends on reward, could be the critical reason why the standard TDRL model fails.</p><p>2) The control analysis that corrects for potential slow drifts in the internal categorical boundary may also be implicitly addressing a separate issue (whether the shifts in the psychometric curve depend on the previous trial outcome, i.e., rewarded vs. not rewarded). Making this distinction explicit would be helpful.</p><p>3) The zig-zag patterns of the main data plots can be confusing because sometimes it is unclear what matters, the slope, the discontinuity, or both. Some suggestions for modifying the plots are provided below. That and/or additional text to guide the reader to the relevant features of the data would be helpful.</p><p>4) Figure 4 is a very nice addition to the manuscript. However, the results do differ somewhat from the data and from those of the belief model. Does this simply reflect a fundamental, qualitative difference between the classifier and the other models? It would be helpful to clarify whether the classifier has parameters that can be adjusted.</p><p>Details about each of these points are provided below.</p><p><italic>Reviewer #2:</italic></p><p>1) Figure 3 TDRL model: In the previous round of review, we (the reviewers) presented an argument as to why the TDRL model would lead to updating that depended on previous trial difficulty. The authors replied that this model results &quot;in updating which is independent of previous difficulty.&quot; I believe that response is simply not true: in Figure 3C left, one can clearly see a non-zero slope to the updating% on hard trials. (And Figure 3C right worries me no end: since in the TDRL model there are no slow side biases independent of outcome, I am unsettled by the correction for such biases changing the results of the model.) [Note that doing the zig-zag plots in the style suggested below for Figure 1G would focus the eye on that slope much better.] What am I supposed to focus on? That the slope is less than in the belief model? That the belief model reaches zero updating for the easiest previous trials?</p><p>I spent a lot of time trying to think this one through – if the TDRL model could indeed be described as accounting for the data, that would be a pretty bad hit at the heart of the manuscript – and eventually hit upon something that I think could help the authors. Assuming I'm not getting this wrong, perhaps the authors had already thought of this, but either way, the suggestion is that it might be clarifying to have it in the manuscript. Here's the idea: in the TDRL model, <italic>V<sub>L</sub></italic> and <italic>V<sub>R</sub></italic> converge onto the average reward given when the subject chooses those ports, where the average is over both correct and incorrect trials. In other words, <italic>V<sub>L</sub></italic> and <italic>V<sub>R</sub></italic> are the value of the port, averaged over all trials. But in the belief model, <italic>V<sub>L</sub></italic> and <italic>V<sub>R</sub></italic> converge onto the value of the reward <italic>when a reward is given</italic>. Not an average over all trials, but conditioned on the reward having been given. Thus if the reward <italic>r</italic> = 1, in the belief model, <italic>V<sub>L</sub></italic> and <italic>V<sub>R</sub></italic> will converge on 1. And that means that for very easy trials, the reward prediction error will be zero, and the updating will be zero. In contrast, in TDRL they will converge on something like 0.8; and thus even on very easy correct trials there will be a non-zero RPE and non-zero updating. I may have gotten this wrong, but if it is correct, there are two interesting things here: (a) the difference on what <italic>V<sub>L</sub></italic> and <italic>V<sub>R</sub></italic> converge to in the two cases, in the sense of one being reward averaged over errors and corrects, the other being average reward conditioned on trials being correct; (b) I believe the real difference between TDRL and belief is not that TDRL has a zero slope for updating versus previous stimulus (the non-zero slope is right there in Figure 3C). It is that TDRL will never have zero updating for the easiest stimuli, whereas the belief model will.</p><p>While on this topic: don't Figure 9E and 9H look more like TDRL in Figure 3 than like the belief model? Why are they being interpreted as supporting the belief model?</p><p>2) Subsection “Choice updating is not due to slow drift in choice side bias”: This confused me the second, the third, <italic>and</italic> the fourth time I read it. Eventually I realized that there may be two issues being treated simultaneously here. I think things would be a lot clearer if you separated them. Issue (a) is &quot;are shifts in the psychometric curve contingent on the previous trial's outcome?&quot; Issue (b) is &quot;are there slow drifts in the decision boundary that would induce correlations across trials that would make one trial appear to depend on the previous one&quot;? The thing that confused me is that to solve issue (a), the obvious and easiest thing is to compare two psychometric curves, both conditioned on a previous stimulus <italic>p</italic>, according to the previous trial's outcome, i.e., whether the previous trial was rewarded or not. That would be a really easy plot to make, understand, and interpret: if previous trial's outcome matters, it will be obvious. Why not add it to the paper?</p><p>Issue (b) is also interesting. The approach in Figure 2 addresses issue (b). If this section and figure were described as focused on issue (b), it would be a lot easier to understand.</p><p>3) Figure 3 model: the full model really needs to be fully explained, in the main text. Please use equations. In particular, while the sentences “Note that although the choice computation is deterministic, the same stimulus can produce left or right choices caused by fluctuations in the percept due to randomized trial-to-trial variation around the stimulus identity (Figure 3—figure supplement 1)” is a welcome addition, it is not enough. Please specify, in the main text, how <italic>p<sub>R</sub></italic> and <italic>p<sub>L</sub></italic> are computed. Note that the integral in subsection “TDRL model with stimulus belief state” needs to specify what you're integrating with respect to (it needs a &quot;ds&quot;), this would make it clear that <italic>p<sub>R</sub></italic> is a function of ŝ, which is itself a random variable drawn anew on each trial. I suggest that you make this explicit in the equation, by writing the left-hand-side as <italic>p<sub>R</sub>(ŝ)</italic>. (Note that I'm suggesting you bring this integral and some of the description into the main text.)</p><p>4) In the previous round, we requested substantial clarifications for panels of the type of Figure 1F and 1G. Even with the clarifications provided, I still find these panels hard to read.</p><p>– Figure 1F: this should be explained in a way that readers can understand without having to trawl through the Materials and methods. Here's my current understanding: (a) you plot the average psychometric curve; (b) you plot the psychometric curve conditioned on a particular previous trial stimulus <italic>p</italic>; (c) for each current stimulus <italic>c</italic>, you compute the vertical distance between those two curves, and that is what you call &quot;updating&quot;.</p><p>Why not show this graphically directly, to make it easy for readers to understand? That is, something along the lines of: add a panel to Figure 1 where you show the average curve and the curve conditioned on <italic>p</italic>, add arrows pointing to the vertical differences between those two curves, and add an arrow from there to Figure 1F to indicate that these two particular curves and the vertical shift between them are what become column <italic>p</italic>Figure 1F.</p><p>Among other things, this would make it obvious why, if the psychometric curves asymptote at 0% and 100%, updating is necessarily going to be small for easy current stimuli. Which is why I don't like the plot of Figure 1F so much: the eye gets drawn to the dominant pattern, which is that the top and bottom row are lighter than the middle rows. But that's the unimportant part, that's the &quot;expected&quot; part, as the authors now write. The important part is happening in the middle rows. Could the authors think of a display format that focuses the eye on that, on the middle rows, instead of the already-expected parts?</p><p>– Figure 1G: The zig-zag pattern confused me no end. What is it that I'm supposed to focus on here? The difference between easy and hard? The fact that the pattern is antisymmetrical? The slope on the hard stimuli?</p><p>It eventually dawned on me that the &quot;A&quot; response and &quot;B&quot; response are of course anti-symmetrical with each other. For a model which has no intrinsic side bias, this has to be true. And there appears to be no systematic, overall, side bias across the experimental rat data in the paper. So the zig and the zag are actually redundant with each other.</p><p>I would therefore suggest the following: collapse the two with each other (the zig and the zag), which gives you better statistics, and in addition focuses the eye on the important parts, not the antisymmetry. In other words, instead of plotting as a function of previous odor A% , plot (% updating towards correct side) as a function of |A% – 50|. By halving the x and y axes, that would also allow you to zoom in by 2x, so readers can see the data better. (An added suggestion would be to plot the easy trials in a light grey, to emphasize that it's in the hard trials that the action is.) And then you'd have a plot that, at a single glance, tells the reader &quot;there is bigger updating for harder stimuli&quot;.</p><p><italic>Reviewer #3:</italic></p><p>The authors addressed my earlier concerns. But their new data raised a new concern:</p><p>I think it is good of the authors to try another class of models to explain the data. However, the predictions of the statistical classifier in Figure 4D differ from experimental data in Figure 1G in three aspects: (1) there appears to be a strong dependence on previous stimul us strength for easy choices; (2) perhaps as a consequence, there is a large jump in Updating% going from green to blue at% A = 50; and (3) the range of updating% is only about half of the experimental data. It is hard to judge if these differences represent fundamental deficits of the model or just wrong parameterization. Because this model is not as intuitive as the RL model in Figure 3B, it would be helpful if the authors can expand this section (or add a supplemental figure) to give the readers a sense of how varying each model parameter changes the predictions.</p></body></sub-article><sub-article article-type="reply" id="sa2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.49834.sa2</article-id><title-group><article-title>Author response</article-title></title-group></front-stub><body><disp-quote content-type="editor-comment"><p>Essential revisions:</p><p>1) The first major concern is in regard to a claim made throughout the paper, namely that how easy or hard the current stimulus is affects the strength of the modulation. This is first presented in Figures 1F and 1G, and then repeated in almost all the figures. However, the measure presented in figures of the style of Figure 1F and summarized in Figure 1G is the% change in responses (given a particular current and previous stimulus, and relative to the overall average for that stimulus). This measure suffers from a large problem that, unfortunately, appears to not be addressed (apologies if it was missed on reading): there is a ceiling effect, in the sense that when a choice is easy (near 100%) it cannot increase further, even if there were strong underlying plasticity. The ceiling applies preferentially to easy stimuli, and therefore will manifest as a difference between easy and hard stimuli. It is currently impossible to tell whether the data shown in support of the claim of &quot;current stimulus strength modulates effect&quot; is merely an artifact resulting from this ceiling issue, or an actual finding. It is very important that the authors clarify this issue.</p></disp-quote><p>We agree with the reviewers that our core finding is the dependence of choices on the difficulty of previous trial. Indeed, this can be observed only when the “current” stimulus is difficult for the reason described by the reviewer. Psychometric curves have this property that bias appears as a shift of the curve with minimal effects for easy trials. In our revised manuscript we have made this point clear. We have clarified that when the current sensory evidence is strong it determines the choice independent of past trials. This is as expected and has been shown previously. However, when the current sensory evidence is weak, choices depend on the difficulty of previous stimuli (paragraph four in subsection “Perceptual decisions are systematically updated by past rewards and past sensory stimuli” and Discussion paragraph one).</p><p>Note that the absence of the effect of past trials when the “current” sensory evidence is strong is fully captured by our models. In the RL model choices are computed by comparing the expected vale of <italic>L</italic> and <italic>R</italic> actions (<italic>Q<sub>L</sub></italic> and <italic>Q<sub>R</sub></italic>). Because <italic>Q<sub>L</sub> = P<sub>L</sub>.V<sub>L</sub></italic> and <italic>Q<sub>R</sub></italic> = <italic>P<sub>R</sub>.V<sub>R</sub></italic> (the product of sensory confidence and learned reward), when current sensory evidence in favor of the choice is strong (large <italic>P</italic>), then choice is largely determined by <italic>P</italic> and the contribution of past trials (stored in <italic>V</italic>) is minimal, hence there is no bias from past trials when current sensory evidence is strong.</p><disp-quote content-type="editor-comment"><p>2a) Another key claim is that only the model with a belief state could account for the results. But the data are not convincing. Let's start with a TD model, without learning of actions, merely learning the values V<sub>R</sub> and V<sub>L</sub>, and let's suppose the value of V<sub>R</sub> is modified only after R choices (and similarly for V<sub>L</sub> and L choices). Under these conditions (and assuming R-L symmetry) V<sub>R</sub> and V<sub>L</sub> will converge to the overall% correct. This will be more than 50%; for a typical smooth psychometric curve it might be 75% or 80%. Now move to a TDRL model that also learns actions: because there are more errors for hard stimuli, the error signal (V<sub>C</sub> – r) will, on average, be greater for hard stimuli than for easy stimuli. And therefore, in this situation, there will on average be greater plasticity after hard stimuli than after easy stimuli, entirely without a belief state. Could this not account for the authors' experimental data?</p><p>The situation and conclusion sketched here could be wrong. But readers are likely to think about it and wonder whether it undermines the authors' conclusions. Thus, explicitly addressing this argument, and whether it is qualitatively or quantitatively incorrect, would strengthen the manuscript.</p></disp-quote><p>In our revision we attempted to clarify this issue. We explain why models of the type described by the reviewers cannot fully capture the behavioral effect.</p><p>Although intuitively we agree that this argument appears compelling, in fact the suggested model does not account for the effect that we observed. Figure 3C shows the model that the reviewers described; it shows a model that computes prediction error by comparing outcome and average expectation (i.e. <italic>V<sub>L</sub></italic> and <italic>V<sub>R</sub></italic> converged over trials). The prediction errors are independent of the difficulty of previous decision, resulting in updating which is independent of previous difficulty. In this model with two states (<italic>L</italic> and <italic>R</italic>), the value functions (<italic>V<sub>L</sub></italic> and <italic>V<sub>R</sub></italic>) indeed converge over trials to reflect average performance (say 80%): <italic>V<sub>L</sub></italic> = 80% and <italic>V<sub>R</sub></italic> = 80%. For choice computations one can take two approaches: (1) entirely based on the sensory evidence, i.e. by comparing <italic>P<sub>L</sub></italic> and <italic>P<sub>R</sub></italic>, which will result in choices that are independent of past trials and hence it will not account for our observations; (2) comparison of <italic>Q</italic> values, <italic>Q<sub>L</sub> = P<sub>L</sub> × V<sub>L</sub></italic> and <italic>Q<sub>R</sub> = P<sub>R</sub> × V<sub>R</sub></italic>, which allows past trials to have an influence on the current choice. After the choice, prediction error is the difference between reward <italic>r</italic> and average performance (converged over trials). Consider two different situations: when the previous trial was a leftward rewarded trial and it was either easy or difficult. In both cases, the prediction errors (<italic>r – V<sub>L</sub></italic>) are similar, and they hence update <italic>V<sub>L</sub></italic> in a similar level. This would thus cause a choice bias in the next trial to be largely independent of the past sensory difficulty (Figure 3C). The model with two state produces confidence-dependent learning only if it includes the belief that each state is occupied in the current trial (i.e. the main model shown in Figure 3A, B).</p><p>We can also consider alternative models that produce different average expectations for different stimuli by representing stimuli across multiple states (rather than the two state version considered above). Such model learns the average value for each stimulus, i.e. the state values are converging to reflect the average value of each level of sensory evidence. In this model, in each trial is based on the internal sensory stimulus the model infers and assigns a single state to the stimulus. Prediction error could be computed in two ways: either it does not have access to this inferred state or it has the access to the inferred state. The first scenario makes prediction errors independent of past difficulty. The second scenario has access to the inferred state and compares reward with the value of that state to produce confidence- dependent prediction errors. However, since the updates only impact the current state there is no bias expected for different (nearby) stimuli.</p><p>Note that one of our observations, the transfer of updating across sensory modalities, also constrains our models. Choice updating is transferred between modalities and hence models that include multiple states to store the value of each stimulus cannot account for this behavioral observation. Conversely, the model with two states stores past values into the left and right <italic>action</italic> value and can account for updating across modalities. Based on this observation we suggest that the reduced model with two states is more appropriate for our findings.</p><p>We apologize that our description was not sufficiently clear and did not clearly convey the model illustrated in Figure 3C and did not spell out the necessity of the belief state. In the revised manuscript we have substantially expand on this issue in the text (Subsections “Belief-based reinforcement learning models account for choice updating” and “TDRL models without stimulus belief state”).</p><disp-quote content-type="editor-comment"><p>2b) A related concern is that, if we understand correctly, the model produces only step-function psychometric curves: for a given stimulus s, the response is deterministic, and when V<sub>R</sub> = V<sub>L</sub>, the model would produce 100% correct behavior. This might seem unimportant, since the details of the shapes of psychometric curves are not the focus of the manuscript, and replacing the distribution-based model with one that uses noisy samples might seem a trivial change. However, distinguishing between hard and easy trials is central to the arguments in the manuscript, and the corresponding difference in error rates might easily become important (as in the situation sketched in point (2a) above). So a model that produces smooth psychometric functions (as opposed to step-shaped) might be important after all (and at least cosmetically would be an obviously better match to the data).</p></disp-quote><p>We have clarified that due to sensory noise even a deterministic choice rule will produce smooth psychometric curves (subsection “Belief-based reinforcement learning models account for choice updating” paragraph three). We have also clarified that using a softmax rule would not substantially change our results. To illustrate this point, we also added a supplemental figure (Figure 3—figure supplement 1).</p><p>The choice computation is entirely deterministic. However, since the percept is drawn from a normal distribution in each trial, the same stimulus can produce left or right choices across trials. For instance, an external stimulus (<italic>s</italic> = 55%) could result in an internal percept (<italic>ŝ</italic> = 40%) in one trial and 57% in the next trial leading to left and right choices respectively (assuming that 50% is the decision boundary). Thus, when averaging across trials, the psychometric curve will be graded and not step-like. We now show that using a non-deterministic, e.g. softmax, rule for choice computation does not influence our core findings (Figure 3—figure supplement 1).</p><disp-quote content-type="editor-comment"><p>2c) The authors posit that the subjects use an internal measure of decision confidence to update their decision policy. In support of this claim, they show that a qualitatively similar modulation can be produced by a temporal difference reinforcement learning (TDRL) model with prediction errors based on perceived stimulus strength. In this model, the prediction errors are used to update the stored value of each choice. We found this model design counterintuitive. It seems that an equivalent model could be constructed in which prior stimulus probabilities (p<sub>R</sub> and p<sub>L</sub>) are updated instead. This would be more consistent with the fact that the animal always receives the same amount of reward on rewarded trials, but may have uncertainty about exactly where to set the decision boundary leading to trial-to-trial updating. It would be helpful if the authors reformulated their model, or explained why reward values are being updated rather than reward probabilities.</p></disp-quote><p>The class of models which update the probabilities or the position of the decision boundary indeed accounts for our data. In fact, we considered including such models in our initial submission but decided to leave it out to avoid having too many models. We agree that it is valuable to reformulate our findings using such models, and we have added one such model, a statistical classifier, to the revised manuscript (new Figure 4 and accompanying text in subsection “On-line learning in margin-based classifiers explains choice updating”).</p><p>Note that we did not claim that the model presented is the only one that accounts for our observations. Instead we conclude that several classes of model could account for our data, as long as they adjust their choice strategy based on the confidence in receiving reward in the preceding trial. However, there is one observation that favors our RL model (which updates action value) over models that update sensory probabilities. We observed that learning transfers across trials even when the evidence comes from different sensory modalities.</p><p>This question taps into a fundamental and important issue: which classes of models can account for our behavioral observations? It is clear that a purely sensory-based model or a purely reward-based model cannot account for the data. Therefore, we can start with a sensory-based model and make modifications so that decision boundary is adjusted according to past trials (reviewers’ suggestion), or to start with a reward-based model and modify it so that it considers sensory uncertainty (i.e. the teaching signal reflects past confidence as in our RL model). While various classes of models account for our data, they share one main computation: they adjust the degree of <italic>learning based on the statistical confidence</italic> in the accuracy of previous decisions. Bayesian learning in drift-diffusion models of decision making also makes similar predictions about confidence-dependent choice biases (Drugowitsch et al., 2019).</p><p>In our revised manuscript we have added an on-line Bayesian support vector machine model as a main figure (Figure 4) to show another class of models that could account for our data. This class of model is analogous to the ones suggested by the reviewers: it updates the decision boundary. We would like to keep our RL model as the main model as it might be easier for readers to understand the nature of learning in this class of models, and it also accounts for cross-modality effect in a simple manner.</p><p>We have also included a paragraph in the Discussionto clarify that a large class of models could account for our observations, as long as they include a trial-by-trial adjustment of choice strategy which scales by the confidence in obtaining the reward (subsection “Rewards induce choices bias in perceptual decisions”).</p><disp-quote content-type="editor-comment"><p>2d) The Bayesian model that updates stimulus statistics seems to ignore which choice was made in the previous trial or whether it was correct. That is, there is a built-in handicap of no feedback, compared to the confidence-based models. How much does this &quot;handicap&quot; contribute to the poor match between model predictions and data in Figure 9A?</p></disp-quote><p>We agree that this specific model ignores trial choice and reward and only updates stimulus statistics. We have added a new Bayesian model which includes these and does account for the updating effect (Figure 4). As such, in our revised manuscript we no longer present the model that reviewers questioned, and have removed the corresponding figure from the manuscript.</p><disp-quote content-type="editor-comment"><p>2e) Model predictions should be comparable to real data. In Figure 2, the plots for rats' average performance show three levels of previous stim (%A) for each direction, more or less evenly distributed. In Figure 3, however, previous stim (%A) are 20, 50 and another value very close to 50. Does the model performance depend on the stimulus strength used? The same stimulus strengths used in behavioral testing should be used for model predictions.</p></disp-quote><p>Model predictions do not depend on the stimulus levels used in the simulation. In our revised manuscript, we have plotted model prediction using 10 evenly distributed levels of stimuli (Figure 3). In general, we note that the exact value of stimuli in the model or in the behavioral data do not matter as long as they produce psychometric curves with graded levels of choice accuracy.</p><disp-quote content-type="editor-comment"><p>2f) Parameter values used to generate Figure 3 should be reported.</p></disp-quote><p>Parameter values are now reported in the text as well as the caption to Figure 3 and Figure 11. Thank you.</p><disp-quote content-type="editor-comment"><p>3) More detail and clarity are needed regarding the description of the basic phenomenon (e.g., sorting and analysis of the shown quantities). The Materials and methods section should include a brief section on how the psychophysical results were generated. That could include all the details of what was conditioned on what, as well as how the trials were divided into &quot;Hard&quot; and &quot;Easy&quot;.</p><p>Many of the key figures depict &quot;updating% &quot; and &quot;updating index.&quot; These terms should also be mathematically defined in the Materials and methods.</p><p>The equation used to fit the bias, lapse, sensitivity of psychometric curves should also be presented in the Materials and methods. These parameters are said to be &quot;stable.&quot; What is the criterion for determining stability?</p><p>Also, the trial nomenclature and labels used in Figure 2 (e.g., &quot;Next&quot; and &quot;Previous&quot;) were confusing.</p></disp-quote><p>We have included this information as requested. We have devoted a subsection in the Materials and methodsto describe how psychometric plots are generated. We also defined the calculation of updating index and included equations for psychometric fitting. These are included in subsection “Data analysis and psychometric fitting”. We also included a new Figure (Figure 2—figure supplement 1) to visualize our psychometric measures and normalizations.</p><disp-quote content-type="editor-comment"><p>Do subjects also show adjustments of sensitivity after correct trials? Would a change in sensitivity contribute to the observed confidence dependence (e.g., if the psychometric curves are shallower, the difference in choice might appear larger for difficult trials)?</p></disp-quote><p>We have included an analysis on the effect of past sensory difficulty on the psychometric sensitivity (slope) in paragraph four of subsection “Perceptual decisions are systematically updated by past rewards and past sensory stimuli”. We did not observe any significant effect of past confidence on the psychometric slopes.</p><disp-quote content-type="editor-comment"><p>4) What happens after errors? The results demonstrate an effect akin to a win-stay strategy but limited to &quot;guesses&quot; only. Is there also a trend toward the corresponding lose-switch strategy? That is, when the choice in trial n-1 is difficult and not rewarded, is the subject more likely to choose the alternative option in trial n (when such decision is also difficult)? There is no obvious reason to expect that confidence-guided choice updating would not also happen after errors, but in any case, error trials should not simply be put aside. The authors should present an analysis of error trials and if they do not see the effect predicted by the model, should propose an explanation for the inconsistency. Other work from the same first author (Lak et al., 2017), presented an alternative TDRL model without the &quot;belief state,&quot; which seemed to have qualitatively similar results for correct trials but divergent results for errors. It seems that error trials are needed again in order to rule out this other model.</p></disp-quote><p>In the revised manuscript we dedicate a small section (“Different strategies for choice updating after error trials due to different noise sources”) and a new figure (Figure 11) to updating effect after error trials. Note that error trials are few, compared to correct trials, making it hard to make firm conclusions.</p><p>The challenge is the diversity of such post-error effects. To paraphrase Leo Tolstoy’s famous opening sentence of the novel Anna Karenina: all correct trials are alike; each incorrect trial is incorrect in its own way. Correct perceptual performance requires appropriate processing and evaluation of the stimulus. In contrast there are many processes that can lead to incorrect performance without consideration of the stimulus, from inattention to lack of motivation to exploration. Indeed, in our behavioral data, the post-error behavioral effects are diverse, usually even within the same data set.</p><p>Note that the model’s predictions about post-correct trials is largely independent of the model parameters (i.e. learning rate, sensory noise, possible memory/decision noise). In contrast, the predictions of the model for post-error trials depend on which parameters are the dominant source of noise, i.e. whether errors are related to perception, or they are internal and due to memory of values. Briefly, there are parameter settings such that choice noise is dominated by perception, these errors cannot be systematically corrected hence there is no net updating (Figure 11). Alternatively, when there is internal noise, such as high learning rate, systematic updating patterns are observed (Figure 11).</p><p>We find that some individual subjects match these specific patterns (Figure 11) but in fact the diversity of post-error updating goes beyond these two patterns as expected. We believe this is the consequence of the modeling framework that does not take many processes into account that could lead to errors, such as attentional lapses, lack of motivation or exploration. These are also briefly discussed in subsection “All correct trials are alike; each incorrect trial is incorrect in its own way”.</p><disp-quote content-type="editor-comment"><p>5) Related to this: &quot;The choice updating remained statistically significant even after this correction.&quot; True, but the effect did seem to get a bit weaker. I imagine this is because the history effects are not limited to one trial in the past, but possibly more. If so, you would expect the effect to become stronger when the current difficult choice is preceded by two rewarded guesses made in the same direction. Whether the trend is weak or not, it could be compared to the model's prediction.</p></disp-quote><p>We thank the reviewers for this suggestion. We have performed this analysis and compared with the model prediction. Figure 3—figure supplement 2 shows this analysis. As the reviewers guessed, the effect is slightly stronger after 2 rewarded low-confidence trials in the same direction, consistent with the model. This has been added to paragraph three of subsection “Belief-based reinforcement learning models account for choice updating”.</p><disp-quote content-type="editor-comment"><p>6) The transfer of choice updating across modalities is interesting. Comparing Figure 2, 4C, and 8D, it seems that the updating is larger on pure olfactory tasks and about the same for the pure auditory or mixed tasks (this is more obvious in Figure 10). I assume the rats have different sensitivity to olfactory and auditory stimuli. Then the difference seems to contradict the statement that &quot;updating is guided by outcome expectations, rather than stimulus statistics&quot;. How much updating was there for trials in the mixed modality task but without modality switches?</p></disp-quote><p>We thank the reviewer for this question; indeed, the data suggest that there is outcome-based updating in the space of action values but also that it is not the entire story. In our revision we have included the updating effect without modality switch in the task with mixed modalities (Figure 9—figure supplement 1). Updating appears largest in consecutive olfactory trials but it exists in both within and across modality switches.</p><p>We have added the following paragraph to the Discussionto discuss this point:</p><p>“Trial-by-trial transfer of choice updating across sensory modalities provides some evidence that this form of learning is driven by comparing the decision outcome with confidence – dependent expectation and performing updating in the space of action values. Updating across trials with different modalities appeared relatively smaller than trials without the switch in the sensory modality. This observation might point to the fact that in trial-by-trial learning animals follow a mixture of two strategies: one which updates values in the space of actions, and one that keeps track of stimulus identity and statistics across trials for such learning. The trade-off between these model-free and model-based trial-by-trial learning during perceptual decisions remains to be explored in future studies.”</p><disp-quote content-type="editor-comment"><p>7) Figure 10B and C should show scatterplots separately for each task. The authors' hypothesis is that updating is independent of stimulus statistics. If this is true, it makes sense to pool data across tasks. However, if the alternative is true that updating depends on certain properties of sensory stimulus, i.e., there could be different relationships between updating and slope/lapse, which could be obscured by pooling across tasks. A more direct test would be to fit the model to one task and predict results for the other tasks.</p></disp-quote><p>In our revised manuscript we have separately plotted the relationship between the size of confidence-dependent updating and psychometric slope/lapse for each dataset, as suggested by reviewers (new Figure 10).</p><p>We would like to clarify that our aim in this analysis is to test if the updating is stronger/weaker in individuals with better psychometric curves (i.e. higher slope and lower lapse). We find a mild inverse relationship between lapse rate and the degree of updating. This suggests that updating is not due to a lack of understanding of the task. The aim of this analysis was not to test the relation between stimulus statistics and updating.</p><disp-quote content-type="editor-comment"><p>8) In Introduction and Discussion, the authors seem to suggest that this phenomenon persists after training is completed or after the subjects performed the task for extended periods and thus may reflect some optimal strategy. Was the training specifically targeting the suboptimal bias? Or is it possible that the subjects just settled on a suboptimal strategy that satisfies the training requirements? It might be useful to clarify what criteria were used to deem these subjects &quot;well-learned&quot;.</p></disp-quote><p>The training did not target any specific bias: both animals and human observers were presented with random sequences of trials and were rewarded for correct choices. The goal of training in each dataset was to achieve high-quality and stable psychometric performance. We consider the subjects to be well-trained because the psychometric fitting parameters reported for each dataset show asymptotic and stable behavior (i.e. sharp psychometric slope, minimal overall bias and near zero lapse). These have been reported for each dataset tested. We have also clarified in the Materials and methodsthat the training did not target or promote confidence- dependent bias (subsection “Rat olfactory experiment”).</p><p>[Editors' note: further revisions were suggested prior to acceptance, as described below.]</p><disp-quote content-type="editor-comment"><p>Essential revisions:</p><p>The paper is significantly improved, and the reviewers are now convinced that it contains important work that should be published. Nevertheless, the presentation of the data is still confusing, and some further clarifications would substantially strengthen the manuscript.</p><p>1) Explaining more in detail the fundamental difference between the standard TDRL model and the belief model would be important. Specifically, the updating that they generate during easy trials, and how that updating depends on reward, could be the critical reason why the standard TDRL model fails.</p></disp-quote><p>We have expanded on this issue and clarified the differences between the models by adding new figures and text (see below for the detailed answer).</p><disp-quote content-type="editor-comment"><p>2) The control analysis that corrects for potential slow drifts in the internal categorical boundary may also be implicitly addressing a separate issue (whether the shifts in the psychometric curve depend on the previous trial outcome, i.e., rewarded vs. not rewarded). Making this distinction explicit would be helpful.</p></disp-quote><p>We have addressed this and followed the reviewer’s advice to clearly dissociate these two issues. We have added new analyses, figures and text (see below for the detailed answer).</p><disp-quote content-type="editor-comment"><p>3) The zig-zag patterns of the main data plots can be confusing because sometimes it is unclear what matters, the slope, the discontinuity, or both. Some suggestions for modifying the plots are provided below. That and/or additional text to guide the reader to the relevant features of the data would be helpful.</p></disp-quote><p>We appreciate the suggestions for modifying these plots. We have now added a new figure panel to explain the calculations underlying the plot, have changed the colors in the plots for clarification, and have included additional text to clarify the analyses (see below for the detailed answer).</p><disp-quote content-type="editor-comment"><p>4) Figure 4 is a very nice addition to the manuscript. However, the results do differ somewhat from the data and from those of the belief model. Does this simply reflect a fundamental, qualitative difference between the classifier and the other models? It would be helpful to clarify whether the classifier has parameters that can be adjusted.</p></disp-quote><p>The difference simply reflects model parameters. We have now corrected this and expanded on this section for further clarification (see below for the detailed answer).</p><disp-quote content-type="editor-comment"><p>Details about each of these points are provided below.</p><p>Reviewer #2:</p><p>1) Figure 3 TDRL model: In the previous round of review, we (the reviewers) presented an argument as to why the TDRL model would lead to updating that depended on previous trial difficulty. The authors replied that this model results &quot;in updating which is independent of previous difficulty.&quot; (Response to reviewers.) I believe that response is simply not true: in Figure 3C left, one can clearly see a non-zero slope to the updating% on hard trials. (And Figure 3C right worries me no end: since in the TDRL model there are no slow side biases independent of outcome, I am unsettled by the correction for such biases changing the results of the model.) [Note that doing the zig-zag plots in the style suggested below for Figure 1G would focus the eye on that slope much better.] What am I supposed to focus on? That the slope is less than in the belief model? That the belief model reaches zero updating for the easiest previous trials?</p><p>I spent a lot of time trying to think this one through, if the TDRL model could indeed be described as accounting for the data, that would be a pretty bad hit at the heart of the manuscript, and eventually hit upon something that I think could help the authors. Assuming I'm not getting this wrong, perhaps the authors had already thought of this, but either way, the suggestion is that it might be clarifying to have it in the manuscript. Here's the idea: in the TDRL model, V<sub>L</sub> and V<sub>R</sub> converge onto the average reward given when the subject chooses those ports, where the average is over both correct and incorrect trials. In other words, V<sub>L</sub> and V<sub>R</sub> are the value of the port, averaged over all trials. But in the belief model, V<sub>L</sub> and V<sub>R</sub> converge onto the value of the reward when a reward is given. Not an average over all trials, but conditioned on the reward having been given. Thus if the reward r = 1, in the belief model, V<sub>L</sub> and V<sub>R</sub> will converge on 1. And that means that for very easy trials, the reward prediction error will be zero, and the updating will be zero. In contrast, in TDRL they will converge on something like 0.8; and thus even on very easy correct trials there will be a non-zero RPE and non-zero updating. I may have gotten this wrong, but if it is correct, there are two interesting things here: (a) the difference on what V<sub>L</sub> and V<sub>R</sub> converge to in the two cases, in the sense of one being reward averaged over errors and corrects, the other being average reward conditioned on trials being correct; (b) I believe the real difference between TDRL and belief is not that TDRL has a zero slope for updating versus previous stimulus (the non-zero slope is right there in Figure 3C). It is that TDRL will never have zero updating for the easiest stimuli, whereas the belief model will.</p><p>While on this topic: don't Figure 9E and 9H look more like TDRL in Figure 3 than like the belief model? Why are they being interpreted as supporting the belief model?</p></disp-quote><p>We appreciate the reviewer’s suggestions and have followed the advice. In short, we agree with the reviewer’s insights. There are two differences between the belief-based model and the TDRL. First, the values converge through learning to two different quantities: in the belief- based model they converge to just below the true size of reward (i.e. reward value, given the reward given) and in the TDRL they converge to the average performance (average rewards over trials). This has implications for the size of prediction error for the easiest correct choices, as the reviewer described. The second difference among models is that in the belief-based model the size of prediction errors scales with the difficulty of previous choice while in the TDRL prediction errors shows little scaling with choice difficulty (see below for further details on this). As such, regardless of the magnitude of converged values, the teaching signals in the two models differ, and the teaching signals in the belief-based model causes different levels of learning in the next trial. We have expanded on this and spelled out these differences in the final paragraph of subsection “Belief-based reinforcement learning models account for choice updating”. We have also added new figure panels (Figure 3—figure supplement 1C,D) to further describe these differences.</p><p>The two effects, small to no updating for perfect accuracy (typically the easiest stimuli) and increasing updating for lower accuracy choices are both consequences of the model, so we are not trying to focus on one compared to the other. Note that zero updating would be only expected for maximum confidence choices with zero lapse rates in our model and the easiest stimuli differ across data sets, often producing less than 100% accuracy, hence non-zero updating is expected. On the other hand, we agree that zero updating for zero lapse rate trials is a central point that likely hid the role of reinforcement learning in perceptual decisions.</p><p>Regarding weak effect of previous trial difficulty for the TDRL model (Figure 3C) that the reviewer pointed out, our point is not only that this effect is weak compared to the main model. Rather, this effect vanishes after our normalization (Figure 3C left). Consequently, after applying the normalization, the only model that still shows updating like our subjects is the belief-based model (Figure 3B, left). Also note that in all TDRL models there is some correlation across trials due to the stored values that are by definition correlated across trials (similar to a drifting boundary in the signal detection model (see below). Hence it is important to evaluate models after the normalization (righthand panels of Figure 3). These issues have been clarified in subsection “Belief-based reinforcement learning models account for choice updating”.</p><p>How could a correlation across trials cause small difficulty-dependent effects on the updating in the TDRL model before applying the normalization (Figure 3C left)? Let us first consider the prediction errors in this model after a correct choice. They are largely independent of the choice difficulty. In fact, if anything, they are even marginally smaller when getting a reward after a difficult choice (Figure 3—figure supplement 1D), i.e. opposite to the belief-based model. This pattern in the prediction errors is due to correlation of values across trials, and how stored values and current sensory evidence interact in computing choice (<italic>Q = V*P</italic>). The model has a better chance of getting a difficult stimulus correct if it happens that it is transiently in the regime that the stored value of the correct side (i.e. stimulus side) is higher than the stored value of the other side (hence a difference in <italic>Q</italic> values). In this situation, at the time of reward prediction error computation, the reward is compared with relatively high stored value of the chosen side, resulting in marginally smaller positive prediction error (Figure 3—figure supplement 1D). Consequently, after this trial the value difference between <italic>L</italic> and <italic>R</italic> still persists. Let’s now consider a next trial that happens to be difficult and correct (with similar stimulus/choice side to the previous trial). The model comes to this trial with the persisting value difference described above, and again has a good chance of getting the choice correct. This bias appears as an apparent updating. These value difference-induced effects are more likely to occur for difficult stimuli (in the case of easy stimuli, choices are dominated by the sensory stimulus), resulting in slightly larger updating for difficult stimuli and hence the weak effect in Figure 3C, left. These, and other similar considerations highlight the fact that the models should compared and evaluated after normalizations to minimize correlations across trials. These have been briefly described in subsections “Belief-based reinforcement learning models account for choice updating” and “TDRL models without stimulus belief state”.</p><p>Finally, the reviewer is correct that in different datasets we are seeing various levels of choice updating and those in Figure 9 show weaker effects compared to some of the other datasets. The effect for each individual subject has been quantified in Figure 10 indicating the strength of the effect across subjects. Despite the diversity, many subjects show a substantial level of choice updating even in the data of Figure 9. In addition, the dataset presented in Figure 9 is particularly interesting, because we show that while there is some level of choice updating that is transferred across sensory modalities, the strength of choice updating within each modality is somewhat stronger (Figure 9—figure supplement 1). We speculate that this observation might point to the fact that in trial-by-trial learning animals follow a mixture of two strategies: one which updates values in the space of actions, and one that keeps track of stimulus identity and statistics across trials for such learning. This was mentioned in the text.</p><disp-quote content-type="editor-comment"><p>2) Subsection “Choice updating is not due to slow drift in choice side bias”: This confused me the second, the third, and the fourth time I read it. Eventually I realized that there may be two issues being treated simultaneously here. I think things would be a lot clearer if you separated them. Issue (a) is &quot;are shifts in the psychometric curve contingent on the previous trial's outcome?&quot; Issue (b) is &quot;are there slow drifts in the decision boundary that would induce correlations across trials that would make one trial appear to depend on the previous one&quot;? The thing that confused me is that to solve issue (a), the obvious and easiest thing is to compare two psychometric curves, both conditioned on a previous stimulus p, according to the previous trial's outcome, i.e., whether the previous trial was rewarded or not. That would be a really easy plot to make, understand, and interpret: if previous trial's outcome matters, it will be obvious. Why not add it to the paper?</p><p>Issue (b) is also interesting. The approach in Figure 2 addresses issue (b). If this section and figure were described as focused on issue (b), it would be a lot easier to understand.</p></disp-quote><p>We have followed the reviewer’s advice. Addressing issue (a), we have added an example figure that the reviewer has suggested (psychometric curve conditional on one previous stimulus separated based on previous outcome; Figure 1—figure supplement 1) and have added related text to the main text in subsection “Perceptual decisions are systematically updated by past rewards and past sensory stimuli”. This, together with extensive analyses we presented in Figure 1 (looking at post-correct trials only) demonstrate our main point, that is the effect of the previous reward on the next choice depends on the previous choice difficulty.</p><p>Addressing issue (b), we have extensively expanded the manuscript to explain the importance of considering correlation across trials. We agree that the normalization may not be entirely intuitive. Therefore, we include a new simulation to illustrate how slow boundary shift alone can produce apparent trial-to-trial updating that is captured by the normalization method Figure 2—figure supplement 1). We first show that a signal detection model simulation with a fixed boundary does not show any effect of previous trials, as expected (Figure 2—figure supplement 1A,B). We then show that if we use drifting boundary in the simulation it will result in an apparent updating in the data (Figure 2—figure supplement 1C). Lastly, we show that our normalization method can correct for this (Figure 2—figure supplement 1D). We hope that this clarifies how the normalization works. We have also added additional to text to explain this point (subsection “Choice updating is not due to slow drifts in choice side bias”).</p><disp-quote content-type="editor-comment"><p>3) Figure 3 model: the full model really needs to be fully explained, in the main text. Please use equations. In particular, while the sentence “Note that although the choice computation is deterministic, the same stimulus can produce left or right choices caused by fluctuations in the percept due to randomized trial-to-trial variation around the stimulus identity (Figure 3—figure supplement 1)” is a welcome addition, it is not enough. Please specify, in the main text, how p<sub>R</sub> and p<sub>L</sub> are computed. Note that the integral in subsection “TDRL model with stimulus belief state” needs to specify what you're integrating with respect to (it needs a &quot;ds&quot;), this would make it clear that p<sub>R</sub> is a function of ŝ, which is itself a random variable drawn anew on each trial. I suggest that you make this explicit in the equation, by writing the left-hand-side as p<sub>R</sub>(ŝ). (Note that I'm suggesting you bring this integral and some of the description into the main text.)</p></disp-quote><p>We have added more details, including equations about the main model in the text, as suggested, and have clarified the computation of <italic>p<sub>R</sub></italic> and <italic>p<sub>L</sub></italic> in the main text (see subsection “Belief-based reinforcement learning models account for choice updating”). We have also corrected the typo in the integral equation. Thank you.</p><disp-quote content-type="editor-comment"><p>4) In the previous round, we requested substantial clarifications for panels of the type of Figure 1F and 1G. Even with the clarifications provided, I still find these panels hard to read.</p><p>– Figure 1F: this should be explained in a way that readers can understand without having to trawl through the Materials and methods. Here's my current understanding: (a) you plot the average psychometric curve; (b) you plot the psychometric curve conditioned on a particular previous trial stimulus p; (c) for each current stimulus c, you compute the vertical distance between those two curves, and that is what you call &quot;updating&quot;.</p><p>Why not show this graphically directly, to make it easy for readers to understand? That is, something along the lines of: add a panel to Figure 1 where you show the average curve and the curve conditioned on p, add arrows pointing to the vertical differences between those two curves, and add an arrow from there to panel f to indicate that these two particular curves and the vertical shift between them are what become column p in the panel in Figure 1F.</p><p>Among other things, this would make it obvious why, if the psychometric curves asymptote at 0% and 100%, updating is necessarily going to be small for easy current stimuli. Which is why I don't like the plot of Figure 1F so much: the eye gets drawn to the dominant pattern, which is that the top and bottom row are lighter than the middle rows. But that's the unimportant part, that's the &quot;expected&quot; part, as the authors now write. The important part is happening in the middle rows. Could the authors think of a display format that focuses the eye on that, on the middle rows, instead of the already-expected parts?</p></disp-quote><p>The reviewer’s understanding about the underlying calculations is completely correct. We have followed reviewer’s advice and added a graphical description of these calculations (Figure 1D) and we have also included additional sentences in the main text for further clarification (subsection “Perceptual decisions are systematically updated by past rewards and past sensory stimuli”).</p><disp-quote content-type="editor-comment"><p>– Figure 1G: The zig-zag pattern confused me no end. What is it that I'm supposed to focus on here? The difference between easy and hard? The fact that the pattern is antisymmetrical? The slope on the hard stimuli?</p><p>It eventually dawned on me that the &quot;A&quot; response and &quot;B&quot; response are of course anti-symmetrical with each other. For a model which has no intrinsic side bias, this has to be true. And there appears to be no systematic, overall, side bias across the experimental rat data in the paper. So the zig and the zag are actually redundant with each other.</p><p>I would therefore suggest the following: collapse the two with each other (the zig and the zag), which gives you better statistics, and in addition focuses the eye on the important parts, not the antisymmetry. In other words, instead of plotting as a function of previous odor A% , plot (% updating towards correct side) as a function of |A% – 50|. By halving the x and y axes, that would also allow you to zoom in by 2x, so readers can see the data better. (An added suggestion would be to plot the easy trials in a light grey, to emphasize that it's in the hard trials that the action is.) And then you'd have a plot that, at a single glance, tells the reader &quot;there is bigger updating for harder stimuli&quot;. Right now the zig-zag makes me squint 40 times at it before I get it.</p></disp-quote><p>We appreciate reviewer’s suggestion to fold the zig-zag plots across the stimulus axis. However, we think that the unfolded zig-zag plot represents a more appropriate signature of the updating effect. As the reviewer pointed out, among other things, it reveals potential side bias in the data. Moreover, it shows the asymmetry of the effect, which is a strong tendency to repeat left action or right action for nearby stimuli (in the middle of the x-axis) that would be obscured after folding. We have, however, accommodated part of the reviewer’s suggestion and changed the color of easy trials to grey and difficult trials to black so that the attention can be focused on the difficult trials. Once again, we are most grateful for all the helpful advice. Also, please note that the subject-by-subject analyses we presented (Figure 10) is similar to the reviewer’s suggestion as in that figure we are folding the zig-zag plots and use those for statistics.</p><disp-quote content-type="editor-comment"><p>Reviewer #3:</p><p>The authors addressed my earlier concerns. But their new data raised a new concern:</p><p>I think it is good of the authors to try another class of models to explain the data. However, the predictions of the statistical classifier in Figure 4D differ from experimental data in Figure 1G in three aspects: (1) there appears to be a strong dependence on previous stimulus strength for easy choices; (2) perhaps as a consequence, there is a large jump in Updating% going from green to blue at% A = 50; and (3) the range of updating% is only about half of the experimental data. It is hard to judge if these differences represent fundamental deficits of the model or just wrong parameterization. Because this model is not as intuitive as the RL model in Figure 3B, it would be helpful if the authors can expand this section (or add a supplemental figure) to give the readers a sense of how varying each model parameter changes the predictions.</p></disp-quote><p>We thank the reviewer for pointing out this apparent inconsistency and apologize for our insufficient explanation. The differences arose from a few model parameters, i.e. the rate by which the weight vector is updated and the level of sensory noise in the stimuli. For these parameters, we previously used the quantities used in the main model. However, it is straightforward to achieve updating results much more similar to the behavioral data by adjusting these parameters. In our revised manuscript, we have corrected the figure to show the results of our latest simulation. We have included the value of parameters used and also expanded on the model description in the Materials and methods section.</p></body></sub-article></article>