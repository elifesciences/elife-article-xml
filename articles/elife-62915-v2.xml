<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.1 20151215//EN"  "JATS-archivearticle1.dtd"><article article-type="research-article" dtd-version="1.1" xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:xlink="http://www.w3.org/1999/xlink"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn pub-type="epub" publication-format="electronic">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">62915</article-id><article-id pub-id-type="doi">10.7554/eLife.62915</article-id><article-categories><subj-group subj-group-type="display-channel"><subject>Tools and Resources</subject></subj-group><subj-group subj-group-type="heading"><subject>Computational and Systems Biology</subject></subj-group><subj-group subj-group-type="heading"><subject>Immunology and Inflammation</subject></subj-group></article-categories><title-group><article-title><italic>ImmunoCluster</italic> provides a computational framework for the nonspecialist to profile high-dimensional cytometry data</article-title></title-group><contrib-group><contrib contrib-type="author" equal-contrib="yes" id="author-206976"><name><surname>Opzoomer</surname><given-names>James W</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0001-6842-756X</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="equal-contrib1">†</xref><xref ref-type="other" rid="fund4"/><xref ref-type="other" rid="fund5"/><xref ref-type="other" rid="fund6"/><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" equal-contrib="yes" id="author-206109"><name><surname>Timms</surname><given-names>Jessica A</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-3687-9312</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="equal-contrib1">†</xref><xref ref-type="other" rid="fund1"/><xref ref-type="other" rid="fund10"/><xref ref-type="other" rid="fund8"/><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" equal-contrib="yes" id="author-206977"><name><surname>Blighe</surname><given-names>Kevin</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="equal-contrib1">†</xref><xref ref-type="fn" rid="con3"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-206978"><name><surname>Mourikis</surname><given-names>Thanos P</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="con4"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-206979"><name><surname>Chapuis</surname><given-names>Nicolas</given-names></name><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="con5"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-206980"><name><surname>Bekoe</surname><given-names>Richard</given-names></name><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="fn" rid="con6"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-206990"><name><surname>Kareemaghay</surname><given-names>Sedigeh</given-names></name><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="other" rid="fund7"/><xref ref-type="fn" rid="con7"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-207452"><name><surname>Nocerino</surname><given-names>Paola</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="con8"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-207453"><name><surname>Apollonio</surname><given-names>Benedetta</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="con9"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-207468"><name><surname>Ramsay</surname><given-names>Alan G</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-0452-0420</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="con10"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-207469"><name><surname>Tavassoli</surname><given-names>Mahvash</given-names></name><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="other" rid="fund7"/><xref ref-type="fn" rid="con11"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-207470"><name><surname>Harrison</surname><given-names>Claire</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff5">5</xref><xref ref-type="fn" rid="con12"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-150521"><name><surname>Ciccarelli</surname><given-names>Francesca</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff6">6</xref><xref ref-type="fn" rid="con13"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-207471"><name><surname>Parker</surname><given-names>Peter</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff7">7</xref><xref ref-type="fn" rid="con14"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-207472"><name><surname>Fontenay</surname><given-names>Michaela</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-5492-6349</contrib-id><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="con15"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-98472"><name><surname>Barber</surname><given-names>Paul R</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-8595-1141</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="fn" rid="con16"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" corresp="yes" equal-contrib="yes" id="author-207473"><name><surname>Arnold</surname><given-names>James N</given-names></name><email>james.n.arnold@kcl.ac.uk</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="equal-contrib2">‡</xref><xref ref-type="other" rid="fund4"/><xref ref-type="fn" rid="con17"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" corresp="yes" equal-contrib="yes" id="author-206992"><name><surname>Kordasti</surname><given-names>Shahram</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-0347-4207</contrib-id><email>shahram.kordasti@kcl.ac.uk</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff5">5</xref><xref ref-type="fn" rid="equal-contrib2">‡</xref><xref ref-type="other" rid="fund1"/><xref ref-type="other" rid="fund2"/><xref ref-type="other" rid="fund10"/><xref ref-type="other" rid="fund8"/><xref ref-type="fn" rid="con18"/><xref ref-type="fn" rid="conf2"/></contrib><aff id="aff1"><label>1</label><institution>School of Cancer and Pharmaceutical Sciences, King’s College London, Faculty of Life Sciences and Medicine, Guy’s Hospital</institution><addr-line><named-content content-type="city">London</named-content></addr-line><country>United Kingdom</country></aff><aff id="aff2"><label>2</label><institution>Institut Cochin, Institut National de la Santé et de la Recherche Médicale U1016, Centre National de la Recherche Scientifique, Unité Mixte de Recherche 8104, Université Paris Descartes</institution><addr-line><named-content content-type="city">Paris</named-content></addr-line><country>France</country></aff><aff id="aff3"><label>3</label><institution>UCL Cancer Institute, Paul O'Gorman Building, University College London</institution><addr-line><named-content content-type="city">London</named-content></addr-line><country>United Kingdom</country></aff><aff id="aff4"><label>4</label><institution>Centre for Host Microbiome Interaction, FoDOCS, King’s College, Guy’s Hospital</institution><addr-line><named-content content-type="city">London</named-content></addr-line><country>United Kingdom</country></aff><aff id="aff5"><label>5</label><institution>Haematology Department, Guy’s Hospital</institution><addr-line><named-content content-type="city">London</named-content></addr-line><country>United Kingdom</country></aff><aff id="aff6"><label>6</label><institution>Cancer Systems Biology Laboratory, The Francis Crick Institute</institution><addr-line><named-content content-type="city">London</named-content></addr-line><country>United Kingdom</country></aff><aff id="aff7"><label>7</label><institution>Francis Crick Institute</institution><addr-line><named-content content-type="city">London</named-content></addr-line><country>United Kingdom</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Yona</surname><given-names>Simon</given-names></name><role>Reviewing Editor</role><aff><institution>The Hebrew University of Jerusalem</institution><country>Israel</country></aff></contrib><contrib contrib-type="senior_editor"><name><surname>Taniguchi</surname><given-names>Tadatsugu</given-names></name><role>Senior Editor</role><aff><institution>Institute of Industrial Science, The University of Tokyo</institution><country>Japan</country></aff></contrib></contrib-group><author-notes><fn fn-type="con" id="equal-contrib1"><label>†</label><p>These authors contributed equally to this work</p></fn><fn fn-type="con" id="equal-contrib2"><label>‡</label><p>These authors also contributed equally to this work</p></fn></author-notes><pub-date date-type="publication" publication-format="electronic"><day>30</day><month>04</month><year>2021</year></pub-date><pub-date pub-type="collection"><year>2021</year></pub-date><volume>10</volume><elocation-id>e62915</elocation-id><history><date date-type="received" iso-8601-date="2020-09-08"><day>08</day><month>09</month><year>2020</year></date><date date-type="accepted" iso-8601-date="2021-04-22"><day>22</day><month>04</month><year>2021</year></date></history><permissions><copyright-statement>© 2021, Opzoomer et al</copyright-statement><copyright-year>2021</copyright-year><copyright-holder>Opzoomer et al</copyright-holder><ali:free_to_read/><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><ali:license_ref>http://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-62915-v2.pdf"/><abstract><p>High-dimensional cytometry is an innovative tool for immune monitoring in health and disease, and it has provided novel insight into the underlying biology as well as biomarkers for a variety of diseases. However, the analysis of large multiparametric datasets usually requires specialist computational knowledge. Here, we describe <italic>ImmunoCluster</italic> (<ext-link ext-link-type="uri" xlink:href="https://github.com/kordastilab/ImmunoCluster">https://github.com/kordastilab/ImmunoCluster</ext-link>), an R package for immune profiling cellular heterogeneity in high-dimensional liquid and imaging mass cytometry, and flow cytometry data, designed to facilitate computational analysis by a nonspecialist. The analysis framework implemented within <italic>ImmunoCluster</italic> is readily scalable to millions of cells and provides a variety of visualization and analytical approaches, as well as a rich array of plotting tools that can be tailored to users’ needs. The protocol consists of three core computational stages: (1) data import and quality control; (2) dimensionality reduction and unsupervised clustering; and (3) annotation and differential testing, all contained within an R-based open-source framework.</p></abstract><kwd-group kwd-group-type="author-keywords"><kwd>ImmunoCluster</kwd><kwd>framework</kwd><kwd>immunology</kwd><kwd>computational biology</kwd><kwd>cytometry</kwd><kwd>immune monitoring</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research organism</title><kwd>Human</kwd></kwd-group><funding-group><award-group id="fund1"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000289</institution-id><institution>Cancer Research UK</institution></institution-wrap></funding-source><award-id>C604/A25135</award-id><principal-award-recipient><name><surname>Timms</surname><given-names>Jessica A</given-names></name><name><surname>Kordasti</surname><given-names>Shahram</given-names></name></principal-award-recipient></award-group><award-group id="fund2"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100002618</institution-id><institution>Aplastic Anemia and MDS International Foundation</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Kordasti</surname><given-names>Shahram</given-names></name></principal-award-recipient></award-group><award-group id="fund4"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100010663</institution-id><institution>H2020 European Research Council</institution></institution-wrap></funding-source><award-id>335326</award-id><principal-award-recipient><name><surname>Opzoomer</surname><given-names>James W</given-names></name><name><surname>Arnold</surname><given-names>James N</given-names></name></principal-award-recipient></award-group><award-group id="fund5"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000265</institution-id><institution>Medical Research Council</institution></institution-wrap></funding-source><award-id>MR/N013700/1</award-id><principal-award-recipient><name><surname>Opzoomer</surname><given-names>James W</given-names></name></principal-award-recipient></award-group><award-group id="fund6"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000265</institution-id><institution>Medical Research Council</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Opzoomer</surname><given-names>James W</given-names></name></principal-award-recipient></award-group><award-group id="fund7"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000833</institution-id><institution>Rosetrees Trust</institution></institution-wrap></funding-source><award-id>M117-F2</award-id><principal-award-recipient><name><surname>Kareemaghay</surname><given-names>Sedigeh</given-names></name><name><surname>Tavassoli</surname><given-names>Mahvash</given-names></name></principal-award-recipient></award-group><award-group id="fund8"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100004941</institution-id><institution>Guy's and St Thomas' NHS Foundation Trust</institution></institution-wrap></funding-source><award-id>G170701</award-id><principal-award-recipient><name><surname>Timms</surname><given-names>Jessica</given-names></name><name><surname>Kordasti</surname><given-names>Shahram</given-names></name></principal-award-recipient></award-group><award-group id="fund10"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100012357</institution-id><institution>LifeArc</institution></institution-wrap></funding-source><award-id>1118406</award-id><principal-award-recipient><name><surname>Timms</surname><given-names>Jessica</given-names></name><name><surname>Kordasti</surname><given-names>Shahram</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value><italic>ImmunoCluster</italic> permits nonspecialist users to interrogate liquid and imaging mass, and flow cytometry datasets, resolving novel layers of cellular heterogeneity and insight, as well as producing publishable outputs and figures.</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>Systems immunology approaches aim to explore and understand the complexity of the immune system. However, with 350 cluster of differentiation (CD) antigens, over 100 cytokines and chemokines, and many different cell subsets, this is a challenging task (<xref ref-type="bibr" rid="bib12">Davis et al., 2017</xref>). Liquid mass cytometry (LMC), imaging mass cytometry (IMC), and flow cytometry (FC) are powerful techniques applied to exploratory immunophenotyping and biomarker discovery. With the ability to profile over 40 markers on an individual cell, these techniques have rapidly expanded our understanding of the immune system and its perturbations throughout disease pathogenesis (<xref ref-type="bibr" rid="bib5">Bertolo et al., 2020</xref>; <xref ref-type="bibr" rid="bib39">Wang et al., 2020</xref>). However, such comprehensive analyses produce large amounts of data and increased dimensionality, resulting in a demanding computational task to analyze (<xref ref-type="bibr" rid="bib28">Newell and Cheng, 2016</xref>). Often, a limiting factor to these analyses is the requirement of an in-depth knowledge of computational biology. There is an unmet need for an easy-to-use flexible open-source computational framework to explore a variety of high-dimensional single-cell cytometry datasets such as LMC, IMC, and FC within a single framework for nonspecialists. A number of previous computational cytometry workflows have been proposed, including <italic>CyTOF workflow</italic> (<xref ref-type="bibr" rid="bib29">Nowicka, 2019</xref>), (<xref ref-type="bibr" rid="bib13">Diggins et al., 2015</xref>) and <italic>CapX</italic> (<xref ref-type="bibr" rid="bib2">Ashhurst, 2019</xref>). Subsequently, some of these workflows have been incorporated into graphical user interfaces (GUI) or code-based workflow packages such as <italic>CATALYST</italic> (<xref ref-type="bibr" rid="bib11">Crowell et al., 2020</xref>), <italic>Cytofkit</italic> (<xref ref-type="bibr" rid="bib8">Chen et al., 2016</xref>), <italic>diffcyt</italic> (<xref ref-type="bibr" rid="bib40">Weber et al., 2019</xref>), and <italic>Spectre</italic> (<xref ref-type="bibr" rid="bib3">Ashhurst, 2020</xref>). However, these approaches can be challenging to implement without significant computational knowledge. We have therefore developed <italic>ImmunoCluster,</italic> building on and extending the framework proposed in the <italic>CyTOF workflow</italic> (<xref ref-type="bibr" rid="bib29">Nowicka, 2019</xref>), to create modular, flexible, and easy-to-use implementations of cytometry analysis pipelines. The <italic>ImmunoCluster</italic> package is a framework that provides appropriate data structures and methods to increase the utility of these high-dimensional methods and make data analysis and interpretation accessible to all researchers to facilitate immune phenotyping projects, such as those associated with preclinical and clinical studies.</p><p>Here, we present <italic>ImmunoCluster,</italic> an open-source computational framework for the analysis of high-dimensional LMC, IMC, and FC datasets. <italic>ImmunoCluster</italic> is an R package and framework that focuses on the organization and visualization of data to help define biological identity of cells, construct a hierarchy of biologically meaningful cell populations, and detect significant changes between conditions, timepoints, and groups, including serial samples from a clinical trial setting. The framework uses state-of-the-art computational techniques in an easily amendable and flexible format. Users can manipulate figures and outputs to suit their specific needs. The computational approaches used to analyze high-dimensional data are rapidly evolving, and <italic>ImmunoCluster</italic> has the flexibility to incorporate these novel computational methods in dimensionality reduction, clustering, and trajectory analysis within its framework. The computational framework is designed for ease of use and broad applicability so that it is simple enough to be implemented by users with only a basic knowledge of R, as well as possessing the flexibility for more advanced users to incorporate additional new methodology and build on the framework. The framework relies on the SingleCellExperiment class (<xref ref-type="bibr" rid="bib26">Lun, 2017</xref>), which means that the flow cytometry standard (FCS) data is contained within a purpose-built object that stores all stages of analysis to permit multiple analysis paths to be performed in parallel. The framework incorporates methods for applying popular R packages (i.e., <italic>RPhenograph</italic> [<xref ref-type="bibr" rid="bib9">Chen and Chen, 2015</xref>], <italic>Rtsne</italic> [<xref ref-type="bibr" rid="bib23">Krijthe, 2018</xref>], and <italic>FlowSOM</italic> [<xref ref-type="bibr" rid="bib37">Van Gassen, 2015a</xref>]) along with convenient ‘wrapper functions’ allowing for the use these popular dimensionality reduction and clustering algorithms in an easy format for nonspecialists to rapidly produce interpretable data that are extendable to advanced experimental designs. <italic>ImmunoCluster</italic> also contains functionality for adaptive downsampling at the import and dimensionality reduction stages of the pipeline to overcome significant increases in runtime associated with large datasets in dimensionality reduction algorithms like UMAP and tSNE. The outputs from <italic>ImmunoCluster</italic> are created using the <italic>ggplot</italic> package, which generates ggplot graphical objects that are flexible, can be further modified and utilized directly into figures for reports and publications. The core of the visualization tool was developed using <italic>scDataviz</italic>, a Bioconductor package (<xref ref-type="bibr" rid="bib6">Blighe, 2020a</xref>) for visualizing single-cell data and influenced by the visual framework outlined in <italic>CyTOF workflow</italic> (<xref ref-type="bibr" rid="bib29">Nowicka, 2019</xref>). <italic>ImmunoCluster</italic> offers an alternative to the currently used frameworks such as <italic>CATALYST</italic> (<xref ref-type="bibr" rid="bib11">Crowell et al., 2020</xref>) and <italic>Cytofkit</italic> (<xref ref-type="bibr" rid="bib8">Chen et al., 2016</xref>), with a focus on ease of use for biologists, as well as offering additional novel aspects for its users compared with other published frameworks. Importantly, and unique to <italic>ImmunoCluster</italic>, the scope of functionality in this package also enables the analysis of IMC data. Users are able to run IMC data in line with FC and LMC data analyses. Due to the lower resolution of IMC data (compared with FC and LMC), we specifically designed the ‘ranked expression heatmap’ function to work with IMC data, which allows users to rank markers measured to help identify cell populations. IMC provides a means to analyze the spatial dimension of the cells in situ within tissues, which can provide important insight when ascribing functionality to cell populations. Methods for analyzing large cytometry datasets, particularly IMC datasets, in an open-source computational environment are currently limited. <italic>ImmunoCluster</italic> has been designed for use by a nonspecialist; however, it would be useful to a range of users from wet-lab nonspecialist experimentalists to experienced computational biologists with potential utility in day-to-day research through to large-scale studies involving multiple longitudinal serial biopsies where samples need to be analyzed and compared.</p><p>Clinical immune monitoring is an area of increasing utilization (<xref ref-type="bibr" rid="bib20">Hernandez et al., 2020</xref>). In the current work, we will present examples of <italic>ImmunoCluster’s</italic> ability to detect clinically relevant perturbations in immune cellular heterogeneity in LMC, IMC, and FC datasets in human patient and/or healthy samples. <italic>ImmunoCluster</italic> is easily extensible to several arbitrary experimental designs and can be utilized to aid both discovery of novel subpopulations of cells within heterogeneous samples or as a foundation for monitoring longitudinal changes or responses to treatment. As such, <italic>ImmunoCluster</italic> provides a resource that will permit unsupervised high-dimensional data analysis to be more widely adopted in immunobiology and many other disciplines.</p></sec><sec id="s2" sec-type="results"><title>Results</title><p>This section aims to convey the scope of <italic>ImmunoCluster</italic>, its versatility, and applicability to complex datasets across a range of high-dimensional approaches. We implemented the <italic>ImmunoCluster</italic> framework for three different types of high-dimensional single-cell data (LMC, IMC, and FC). <italic>ImmunoCluster</italic> also offers user-friendly flexibility throughout the framework, and researchers can easily adapt all figures and outputs to suit their specific needs, resulting in an abundance of tailored outputs for the user to assess and use in publications, reports, and presentations. An example detailing a variety of tailor-made figures produced by <italic>ImmunoCluster</italic> can be found in <xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>.</p><p>We first used previously published and publicly available LMC data (<xref ref-type="bibr" rid="bib19">Hartmann et al., 2019</xref>). This dataset was chosen as it is representative of an intricate immunophenotyping project and would test the ability of <italic>ImmunoCluster</italic> to reproduce published results. Secondly, we investigated two novel IMC datasets, from HNSCC and diffuse large B-cell lymphoma (DLBCL) patients with the aim of demonstrating the applicability of the <italic>ImmunoCluster</italic> tool for IMC data analysis and cell cluster identification and visualization. Finally, FC data from the BM of seven healthy donors (HDs) during hip surgery were used to show the ability of the framework to analyze conventional FC data and identify rare immune cell populations.</p><sec id="s2-1"><title>Liquid mass cytometry</title><p>The chosen dataset (<xref ref-type="bibr" rid="bib19">Hartmann et al., 2019</xref>) includes mass cytometry data from 15 patients with leukemia who all received bone marrow transplant (BMT), three of whom developed acute graft versus host disease (GvHD). Samples were taken at 30 and 90 days post-BMT. Thirty-three cell markers, both lineage and functional, were analyzed using mass cytometry (Helios CyTOF system). Prior to uploading into the <italic>ImmunoCluster</italic> framework, the FCS files were normalized and gated as described in the Materials and methods section. We observed that a typical pipeline run on the full 2.3 million cell LMC GvHD dataset (with UMAP downsampling to 500k cells) would take ~110 min on a 2.9 GHz Intel Core i7 MacBook pro with 16 GB RAM (<xref ref-type="fig" rid="fig1s2">Figure 1—figure supplement 2</xref>).</p><p>An initial visualization of the data was first carried out using multidimensional scaling (MDS) plots, which were overlaid with metadata to identify the similarity of patients by condition and day of measurement (<xref ref-type="fig" rid="fig1">Figure 1A, B</xref>). A heatmap was also created to give an overview of marker expression for each patient and annotated with the metadata provided (<xref ref-type="fig" rid="fig1">Figure 1C</xref>). The <italic>UMAP</italic> algorithm was used for dimensionality reduction of data. There was a difference in the distribution of cells from GvHD and ‘none’ across the cell islands between both timepoints, 30 and 90 days after BMT (<xref ref-type="fig" rid="fig2">Figure 2A</xref>).</p><fig-group><fig id="fig1" position="float"><label>Figure 1.</label><caption><title>Initial exploration of liquid mass cytometry data from patients with leukemia who received bone marrow transplants (BMTs).</title><p>(<bold>A, B</bold>) Multidimensional scaling of data; median marker expression data from each sample were used to create plots, annotated with condition (graft versus host disease or none) (<bold>A</bold>), and time after BMT treatment (<bold>B</bold>). (<bold>C</bold>) Heatmap showing the median marker expression for each patient.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-62915-fig1-v2.tif"/></fig><fig id="fig1s1" position="float" specific-use="child-fig"><label>Figure 1—figure supplement 1.</label><caption><title>Customizable figure outputs.</title><p>(<bold>A</bold>) Expression of four selected lineage markers projected onto UMAP plot. (<bold>B</bold>) <italic>UMAP</italic> annotated with FlowSOM clusters. (<bold>C</bold>) <italic>UMAP</italic> annotated with cell types. (<bold>D</bold>) UMAP plot colored by graft versus host disease (GvHD) and none. (<bold>E</bold>) UMAP plots colored by GvHD and none and split by timepoint (30 and 90 days after bone marrow transplant treatment). (<bold>F</bold>) UMAP plots colored and split by GvHD and none. (<bold>G</bold>) Visualize the density of cells within cell islands of dimensionality reduced data.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-62915-fig1-figsupp1-v2.tif"/></fig><fig id="fig1s2" position="float" specific-use="child-fig"><label>Figure 1—figure supplement 2.</label><caption><title><italic>ImmunoCluster</italic> typical pipeline runtime.</title><p>2.3 M cell liquid mass cytometry graft versus host disease dataset (with UMAP downsampling to 500k cells) on a 2.9 GHz Intel Core i7 MacBook pro with 16 GB RAM. QC: quality control.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-62915-fig1-figsupp2-v2.tif"/></fig></fig-group><fig-group><fig id="fig2" position="float"><label>Figure 2.</label><caption><title>Dimensionality reduced liquid mass cytometry CyTOF data and marker expression.</title><p>(<bold>A</bold>) <italic>UMAP</italic> plots colored by graft versus host disease and none and split by timepoint (30 and 90 days after bone marrow transplant treatment). (<bold>B</bold>) Expression of eight selected lineage markers projected onto <italic>UMAP</italic> plot. Identifying cell types and abundance of clusters. (<bold>C</bold>) Heatmap showing median marker expression across all identified cell types. (<bold>D</bold>) <italic>UMAP</italic> annotated with cell types. (<bold>E</bold>) Distribution of immune cell frequencies and abundance (%) of each cell type across all samples measured.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-62915-fig2-v2.tif"/></fig><fig id="fig2s1" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 1.</label><caption><title>Expression of all markers measured projected onto cell islands produced by <italic>UMAP</italic>.</title></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-62915-fig2-figsupp1-v2.tif"/></fig><fig id="fig2s2" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 2.</label><caption><title>Heatmap showing the marker expression of 56 <italic>FlowSOM</italic> clusters.</title><p>This heatmap was used to identify the cell type of each cluster.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-62915-fig2-figsupp2-v2.tif"/></fig><fig id="fig2s3" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 3.</label><caption><title>Heatmap showing higher-level cluster of cell types.</title></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-62915-fig2-figsupp3-v2.tif"/></fig></fig-group><p>The mass cytometry panel used in this experiment was specifically designed to identify all major human immune cell lineages (<xref ref-type="bibr" rid="bib19">Hartmann et al., 2019</xref>); the marker expression across cell islands was visualized and indicated cell types present within the cell islands (<xref ref-type="fig" rid="fig2">Figure 2B</xref>) (expression of all markers measured; <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>). To further distinguish the cell types that were present in the cell islands and visible from the dimensionality reduced <italic>UMAP</italic> plots (<xref ref-type="fig" rid="fig2">Figure 2B</xref>), the <italic>FlowSOM</italic> clustering algorithm with consensus clustering metaclustering was applied, which has been demonstrated to scale well to large cytometry datasets (<xref ref-type="bibr" rid="bib41">Weber and Robinson, 2016</xref>). The number of clusters input into the <italic>FlowSOM</italic> algorithm was slightly higher than the number of expected cell clusters (n = 56) (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2</xref>). The SingleCellExperiment object stored the data for each <italic>K meta-</italic>clustering (<italic>K1-K56</italic>); therefore, further downstream data exploration was carried out looking at different numbers of <italic>K</italic> clusters. A heatmap showing the expression of the 33 markers measured was used to identify cluster cell types (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2</xref>), and <italic>ImmunoCluster</italic> was successfully able to replicate the findings from <xref ref-type="bibr" rid="bib19">Hartmann et al., 2019</xref>, with 24 of the cell populations being identified (<xref ref-type="fig" rid="fig2">Figure 2C, D</xref>). Selecting the correct number of clusters to input into the clustering algorithm can be a challenging aspect of these analyses, but the framework provides the user with multiple parameters to aid this decision. We recommend that users should always overestimate the number of cell populations as data for each <italic>K</italic> number of clusters will be stored in the SingleCellExperiment object and can therefore be explored and refined later using the different visualization techniques available within the framework. Additionally, the elbow plot generated by the <italic>ConsensusClusterPlus</italic> package can be examined alongside the clustering algorithm output to guide the decision on the best number of clusters for downstream analysis (<xref ref-type="fig" rid="fig8s6">Figure 8—figure supplement 6</xref>). Over-clustering can allow for the identification of rare cell types within a dataset at the expense of often generating several clusters of highly prevalent cell types that likely represent the same biological cell type. <italic>ImmunoCluster</italic> provides the tools to manually and reproducibly merge clusters of the same biological cell identity into one group after over-clustering. These clusters can additionally be merged into each other to use a less granular, higher-level population annotation (see <xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3</xref> for an example of higher-level clustering).</p><p>The abundance of all cell types across all samples was measured, and CD14<sup>+</sup>CD16<sup>-</sup> monocytes were identified as the most abundant population, correlating with the Hartmann et al. data (<xref ref-type="bibr" rid="bib19">Hartmann et al., 2019</xref>; <xref ref-type="fig" rid="fig2">Figure 2E</xref>). Individually displaying patient’s cell-type abundance means that we could identify variation within a group of interest; for example, we observed that although there is variation within the GvHD and none, overall, they appear to follow the same trends in cell-type abundance (<xref ref-type="fig" rid="fig3">Figure 3A</xref>). Additionally, significant differences between memory B-cells (false discovery rate [FDR] p=4.38×10<sup>−3</sup>), naïve B-cells (FDR p=1.35×10<sup>−2</sup>), and naïve CD4<sup>+</sup> T-cells (FDR p=3.47×10<sup>−2</sup>) were identified between the GvHD and none (<xref ref-type="fig" rid="fig3">Figure 3B, C</xref>) using a t-test. A difference in number of naïve B-cells was previously reported by <xref ref-type="bibr" rid="bib19">Hartmann et al., 2019</xref> in this dataset and can be seen in <xref ref-type="fig" rid="fig2">Figure 2A</xref> (using <xref ref-type="fig" rid="fig2">Figure 2D</xref> for cell island identification), where there is a noticeable reduction of these cells in the GvHD patients. In addition, a reduction in naïve CD4<sup>+</sup> T-cells can also be seen, which was also previously reported, but to a lesser extent. A volcano plot can be used to highlight the differentially abundant cell clusters between GvHD and none (GvHD logFC+ve and none logFC-ve), where cell types with FDR p&lt;0.05 are shown in red (<xref ref-type="fig" rid="fig3">Figure 3D</xref>), which is also in line with the previously published data (<xref ref-type="bibr" rid="bib19">Hartmann et al., 2019</xref>). We compared <italic>ImmunoCluster’s</italic> differential abundance testing output (<italic>stat_test_clust</italic>), run in the t-test mode, with the Hartmann et al. data (<xref ref-type="bibr" rid="bib19">Hartmann et al., 2019</xref>) into the <italic>diffcyt</italic> computational framework (<xref ref-type="bibr" rid="bib40">Weber et al., 2019</xref>), which is a state-of-the-art tool for differential discovery analyses. <italic>Diffcyt</italic> identified the same three cell clusters (memory B-cells, naïve B-cells, and naïve CD4<sup>+</sup> T-cells) as differentially abundant (FDR p&lt;0.05) between the GvHD and none conditions. This demonstrates concordance with <italic>ImmunoCluster’s</italic> statistical output that identified naïve B-cells and naïve CD4<sup>+</sup> T-cells as one of the principal differentially abundant populations, which was also identified in the original analysis of the data (<xref ref-type="supplementary-material" rid="supp4">Supplementary file 4</xref>). Additionally, we explored the expression of checkpoint-related molecules, and their receptors, markers of proliferation, and invariant natural killer T (iNK T) cells in CD8<sup>+</sup> T-cells and compared the expression of these in the patients with GvHD and none (<xref ref-type="fig" rid="fig3">Figure 3E</xref>). These markers help assess the functional states of cells and the checkpoint-related molecules and proliferative activity markers such as PD-1, PD-L1, TIM3, Ki-67, and TCRVa24-Ja18; the expression of these antigens has been proposed previously as candidate biomarkers for immunotherapy (<xref ref-type="bibr" rid="bib19">Hartmann et al., 2019</xref>). Visually, GvHD patients had a higher expression of PD-1 and a noticeable difference in the Ki-67 proliferation marker as expected for these patients (<xref ref-type="fig" rid="fig3">Figure 3E</xref>).</p><fig-group><fig id="fig3" position="float"><label>Figure 3.</label><caption><title>Liquid mass cytometry (LMC) CyTOF data cluster and cell-type abundances.</title><p>(<bold>A</bold>) Percentage of each cell type shown for each patient numbered across the bottom of the plot. (<bold>B, C</bold>) Box plots portray interquartile range (IQR) with the horizontal line representing the median percentage of cell types in both graft versus host disease (GvHD) and none patients for B-cell and CD4<sup>+</sup> T-cell populations, respectively. (<bold>D</bold>) Differential abundance analysis; volcano plot showing the significantly differentially expressed cell abundances (false discovery rate p&lt;0.05) between GvHD and none (GvHD logFC+ve and none logFC-ve). (<bold>E</bold>) Comparison of checkpoint-related molecules (PD-1 and TIM3), receptors (PD-L1), proliferative (Ki-67), and iNK T-cells (TCRVa24-Ja18) marker expression between GvHD and none patients in the CD8<sup>+</sup> T-cell cluster.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-62915-fig3-v2.tif"/></fig><fig id="fig3s1" position="float" specific-use="child-fig"><label>Figure 3—figure supplement 1.</label><caption><title>Biaxial plots.</title><p>(<bold>A, B</bold>) Biaxial contour plots showing distribution of CD3<sup>+</sup> and CD19<sup>+</sup> cells in graft versus host disease (<bold>A</bold>) and none (<bold>B</bold>). (<bold>C</bold>) Biaxial dot plot showing distribution of CD4<sup>+</sup> and CD8α<sup>+</sup> cells in the identified CD8<sup>+</sup> T cell and CD4<sup>+</sup> T cell clusters.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-62915-fig3-figsupp1-v2.tif"/></fig></fig-group></sec><sec id="s2-2"><title>Imaging mass cytometry</title><p>We utilized two different IMC datasets to demonstrate how <italic>ImmunoCluster</italic> would handle IMC data from two different tumor microenvironments that possess (1) a biological image with clear boundaries, such as head and neck squamous cell carcinoma (HNSCC), where clear tumor and stroma regions were evident; (2) a biological image that was more heterogeneous and diffuse, such as the DLBCL lymph node section. <italic>ImmunoCluster</italic>’s ability to explore IMC data adds an important element to the framework and demonstrates the flexibility and applicability of the tool. Researchers can explore IMC data easily, and in line with LMC and FC data. After data preprocessing (see Materials and methods and <xref ref-type="fig" rid="fig8s2">Figure 8—figure supplement 2</xref>), the transformed gated FCS files were uploaded into the <italic>ImmunoCluster</italic> framework. Generally, the same workflow that was applied to the LMC and FC data was applied to the IMC data from a section of tissue from patients with HNSCC and DLBCL (lymph node) as a proof-of-principle application of the <italic>ImmunoCluster</italic> tool for IMC data analysis (<xref ref-type="fig" rid="fig4">Figures 4</xref> and <xref ref-type="fig" rid="fig5">5</xref>). The only difference with the IMC data was the use of a rank heatmap (<xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1</xref>); this ranks the order of each marker for each sample (1 – total number of samples). The reason for this was clarity and ease of cell identification across clusters as IMC produces lower resolution data compared to the data output of LMC or FC, which makes manual assignments of populations more difficult to interpret. Therefore, a rank of expression was used as an easy means to facilitate the assignment of cell identity through defining the highest and lowest expression of markers between clusters.</p></sec><sec id="s2-3"><title>Head and neck squamous cell carcinoma tissue section</title><p>Cell segmented regions are annotated in <xref ref-type="fig" rid="fig4">Figure 4A</xref>, where regions 1–3 were selected as tumor regions and 3–6 as stroma regions. The <italic>ImmunoCluster</italic> tool was able to distinguish between the stroma and tumor regions of the tissue section from the HNSCC tumor (<xref ref-type="fig" rid="fig4">Figure 4B</xref>), and with additional markers could provide a more in-depth analysis of the cell phenotypes in each respective region of the tumor. Dimensionality reduction of the data clearly separated the cell islands belonging to the stroma and tumor regions of the tissue (<xref ref-type="fig" rid="fig4">Figure 4C</xref>), suggesting different cell phenotypes between the regions. The <italic>FlowSOM</italic> algorithm was applied to cluster the cells and identify cell populations. The rank heatmap was used to show the ranked expression of each marker (ranked 1–10, with 10 being high) for each cluster (1–10) (<xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1</xref>), and the identified cell types were then used to annotate the heatmap (<xref ref-type="fig" rid="fig4">Figure 4D</xref>). High expression of E-cadherin can be used as a marker of cancerous tissue in HNSCC, and its expression correlates with the cancer regions selected for analysis (<xref ref-type="fig" rid="fig4">Figure 4D</xref>). We focused on CD8<sup>+</sup> T-cell, B-cell, and macrophage cell clusters (<xref ref-type="bibr" rid="bib21">Hladíková et al., 2019</xref>; <xref ref-type="bibr" rid="bib15">Evrard et al., 2019</xref>). Regions 2 and 3 of the tumor mostly consist of proliferating (Ki-67<sup>+</sup>) tumor cells and macrophages (tumor-associated and PD-L1<sup>+</sup>). Region 1 was a mix of immune cells, B-cells, and PD-L1<sup>+</sup> CD8<sup>+</sup> T-cells (<xref ref-type="fig" rid="fig4">Figure 4E</xref>). Stromal regions 5 and 6 are mostly PD-L1<sup>+</sup> macrophages and CD8<sup>+</sup> T-cells. Region 4 has a cluster of mixed immune cells, and from the IMC image (<xref ref-type="fig" rid="fig4">Figure 4A</xref>) we can see that this region looks like the tumor is encroaching into the stromal region. The stroma seems to be mostly nonproliferating cells (Ki-67<sup>- </sup>compared to the tumor region) and CD8<sup>+</sup> T-cells, including a CD20<sup>+</sup> CD8<sup>+</sup> cytotoxic subset (<xref ref-type="bibr" rid="bib17">Gingele et al., 2020</xref>).</p><fig-group><fig id="fig4" position="float"><label>Figure 4.</label><caption><title>HNSCC imaging mass cytometry (IMC) data.</title><p>Immunophenotyping the tumor microenvironment with IMC data using <italic>ImmunoCluster</italic>. (<bold>A</bold>) IMC image showing an example of five channels: PD-L1 (green), CD4 (yellow), E-cadherin (red), CD20 (magenta), and CD8α (blue). Images with the segmented cell borders are highlighted. The tumor and stroma areas are clear to the eye, and three regions were selected from each as shown (regions 1–6). (<bold>B</bold>) Multidimensional scaling plot of stroma and tumor regions. (<bold>C</bold>) Dimensionality reduced data (<italic>UMAP</italic> algorithm applied) annotated with <italic>FlowSOM</italic> clusters and split by region type. (<bold>D</bold>) Rank heatmap: ranked expression (1–8, where 8 is high) of seven markers (CD20, CD8α, E-cadherin, Ki-67, PD-L1, CD68, and PD-1) and identified cell type. (<bold>E</bold>) Proportion of cell types for each tissue region.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-62915-fig4-v2.tif"/></fig><fig id="fig4s1" position="float" specific-use="child-fig"><label>Figure 4—figure supplement 1.</label><caption><title>Rank heatmap for the head and neck squamous cell carcinoma patient imaging mass cytometry data.</title></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-62915-fig4-figsupp1-v2.tif"/></fig></fig-group></sec><sec id="s2-4"><title>Diffuse large B-cell lymphoma lymph node section</title><p>The IMC DLBCL lymph node section was split by high and low Ki-67 expression to identify the highly proliferative tumor cells (<xref ref-type="fig" rid="fig5">Figure 5A</xref>); Ki-67 is used as a prognostic marker in DLBCL (<xref ref-type="bibr" rid="bib34">Tang et al., 2017</xref>). The <italic>FlowSOM</italic> algorithm was applied to the data to split the IMC data into clusters; these clusters were projected onto the <italic>UMAP</italic> plot to visualize how these clusters were split between the Ki-67 high and low (<xref ref-type="fig" rid="fig5">Figure 5B</xref>). The marker expression ranking tool was applied to the clustered data and used to identify cell types (<xref ref-type="fig" rid="fig5">Figure 5C,</xref> <xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1</xref>). The majority of Ki-67 high population were proliferating tumor cells (84%), and the Ki-67 low population consisted of a heterogeneous collection of immune cell populations, such as CD4<sup>+</sup> T-cells, CD8<sup>+</sup> T-cells, B-cells, macrophages, and dendritic cells (DCs) that were successfully identified using the <italic>ImmunoCluster</italic> tool (<xref ref-type="fig" rid="fig5">Figure 5D</xref>).</p><fig-group><fig id="fig5" position="float"><label>Figure 5.</label><caption><title>Diffuse large B-cell lymphoma imaging mass cytometry (IMC) data.</title><p>Immunophenotyping the lymph node microenvironment with IMC data using <italic>ImmunoCluster</italic>. (<bold>A</bold>) IMC image showing an example of four channels: DNA (red), CD20 (green), CD8α (dark blue), and CD45RA (light blue). The image was split by high and low Ki-67 expression to identify highly proliferative cells (tumor). (<bold>B</bold>) Dimensionality reduced data (<italic>UMAP</italic> algorithm applied) annotated with <italic>FlowSOM</italic> clusters and split by Ki-67 high or low. (<bold>C</bold>) Rank heatmap: ranked expression (1–8, where 8 is high) of 12 markers (CD8, CD68, CD4, CD3, CD45, CD20, CD45RA, Ki-67, CD74, CD16, PD-L1, and CD11c) and identified cell type. (<bold>D</bold>) Proportion of cell types for Ki-67 high and Ki-67 low cell populations.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-62915-fig5-v2.tif"/></fig><fig id="fig5s1" position="float" specific-use="child-fig"><label>Figure 5—figure supplement 1.</label><caption><title>Rank heatmap for the diffuse large B-cell lymphoma patient imaging mass cytometry data.</title><p>Clusters 1 and 2 were not used for downstream analysis as they were deemed to represent minor populations of cells that were nonspecifically binding the antibodies as they ranked highly for all markers (including lineage markers) of interest.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-62915-fig5-figsupp1-v2.tif"/></fig></fig-group></sec><sec id="s2-5"><title>Flow cytometry</title><p>The HD BM taken during hip surgery was gated for the CD3<sup>+</sup>CD4<sup>+</sup> population before analysis within the <italic>ImmunoCluster</italic> framework, with the aim of testing <italic>ImmunoCluster’s</italic> ability to identify minor populations such as Tregs and their subpopulations (<xref ref-type="bibr" rid="bib22">Kordasti et al., 2016</xref>). The <italic>FlowSOM</italic> algorithm was applied to the data, resulting in 40 clusters (<xref ref-type="fig" rid="fig6s1">Figure 6—figure supplement 1</xref>), and a heatmap was created with median expression of markers to identify cell types (<xref ref-type="fig" rid="fig6">Figure 6B</xref>). Due to the markers used and the low prevalence of Tregs, the majority of cells were identified as CD4<sup>+</sup> T-cells. Additionally, three populations of Tregs were identified by the <italic>ImmunoCluster</italic> tool: Tregs (CD25<sup>+</sup>CD127<sup>low</sup>) (3.6%, 1.3–5.5), Treg A (CD25<sup>+</sup>CD127<sup>low</sup> CD45RA<sup>+</sup>) (0.7%, 0.1–2.0), and Treg B-cells (CD25<sup>+</sup>CD127<sup>low</sup>CCR4<sup>+</sup>CD95<sup>high</sup>) (0.9%, 0.2–2.4) (<xref ref-type="fig" rid="fig6">Figure 6C</xref>). The abundance of Treg A and B for all HDs is shown in <xref ref-type="fig" rid="fig6">Figure 6D</xref>, and their distribution was as expected (<xref ref-type="bibr" rid="bib22">Kordasti et al., 2016</xref>).</p><fig-group><fig id="fig6" position="float"><label>Figure 6.</label><caption><title>Healthy donor bone marrow flow cytometry data: identification of rare CD4<sup>+</sup> T-cell immune cell subsets.</title><p>(<bold>A</bold>) Multidimensional scaling plot of each healthy donor (1–7). (<bold>B</bold>) Heatmap showing marker expression across clusters of identified cell types. (<bold>C</bold>) Dimensionality reduced data (<italic>UMAP</italic> algorithm applied) annotated with cell type. (<bold>D</bold>) Proportion of Treg A and B from total cells from healthy donors.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-62915-fig6-v2.tif"/></fig><fig id="fig6s1" position="float" specific-use="child-fig"><label>Figure 6—figure supplement 1.</label><caption><title>Heatmap showing the marker expression of 40 <italic>FlowSOM</italic> clusters.</title><p>This heatmap was used to identify the cell type of each cluster.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-62915-fig6-figsupp1-v2.tif"/></fig></fig-group></sec></sec><sec id="s3" sec-type="discussion"><title>Discussion</title><p>Here, we provide an overview of the flexibility and scope for utilizing <italic>ImmunoCluster</italic>, an open-access easy-to-use framework for LMC, IMC, and FC dataset analyses. The <italic>ImmunoCluster</italic> package emphasizes ease of use in the generation of flexible and modular cytometry analysis pipelines for applications such as clinical immune monitoring studies. Explanations of the functions and workflow have been provided, and an in-depth step-by-step protocol and tutorial are available on the GitHub site (<ext-link ext-link-type="uri" xlink:href="https://github.com/kordastilab/ImmunoCluster">https://github.com/kordastilab/ImmunoCluster</ext-link>).</p><p>The purpose for creating the <italic>ImmunoCluster</italic> framework was to support nonspecialist researchers to carry out complex immunophenotyping experiments. The dawn of ‘cytometry big data’ and its ever-growing utilization has surpassed the number of experimental parameters that a researcher can feasibly analyze as a collective. The <italic>ImmunoCluster</italic> framework was designed in collaboration between wet lab and computational biologists, with the purpose of creating a tool that enables state-of-the-art analysis, yet easy to use in its application. We provide sufficient detail and explanation for the nonspecialist researcher to understand the need for each analysis step as well as how to confidently execute the process, with an aim of performing transparent and reproducible analyses.</p><p><italic>ImmunoCluster</italic> has been built with an emphasis on generalizability and scalability to facilitate a broad use and is an advance over other open-source tools as it provides an integrated framework to uniquely perform a complete computational pipeline on high-dimensional LMC, IMC, and FC data. The inclusion of IMC data analysis brings a unique element to the <italic>ImmunoCluster</italic> framework and differentiates it from other published protocols. <italic>ImmunoCluster</italic> was built to easily leverage many popular R packages for cytometry data (i.e., <italic>RPhenograph</italic> [<xref ref-type="bibr" rid="bib25">Levine et al., 2015</xref>], <italic>Rtsne</italic> [<xref ref-type="bibr" rid="bib36">van der Maaten and Hinton, 2008</xref>; <xref ref-type="bibr" rid="bib24">Laurens van der, 2014</xref>], and <italic>FlowSOM</italic> [<xref ref-type="bibr" rid="bib38">Van Gassen, 2015b</xref>]), selected because they are open-source and regularly maintained with extensive documentation. All methods prioritize customizable and attractive visualizations designed to be used by both dry- and wet-lab researchers/clinicians. The inclusion of adaptive downsampling of cells for the running of computationally intensive dimensionality reduction steps, using tools such as <italic>UMAP</italic> and <italic>tSNE</italic>, allows <italic>ImmunoCluster</italic> to generate cytometry analysis pipelines that are readily scalable to a dataset of millions of cells across several samples and a variety of experimental or phenotypic conditions. <italic>ImmunoCluster</italic> can also be run on a local desktop/laptop computer with standard configuration, depending on the number of cells, adaptive downsampling settings and selection of clustering algorithms can usually be run within a day end-to-end (<xref ref-type="fig" rid="fig1s2">Figure 1—figure supplement 2</xref>). Whilst the <italic>PhenoGraph</italic> clustering method does not readily scale, the <italic>FlowSOM</italic>-based clustering method can be implemented on much larger datasets.</p><p>The limitations of this computational framework are important to take into consideration when designing an experiment. Unsupervised clustering (stage 2) of samples is the most important stage of the framework, and its ability to accurately define populations across all samples is critical to all later stages of investigation. The number of <italic>k</italic> clusters to generate (cluster resolution) can significantly affect the ability to identify or determine a change in a biologically relevant population. Merging two subpopulations due to low resolution of clustering may mask an important experimental observation. Determining the precise number of clusters that are relevant for a given dataset is an important step. In our step-by-step guide, we provide complete documentation and clear user-friendly approaches to optimally define this.</p><p>Technical inter-sample marker signal variability due to batch effects may impact the ability of unsupervised analysis to reliably detect certain populations if significant batch effects are present. MDS plots created in stage 1 of the framework can be used to detect batch effects as well as other technical artifacts such as antibody staining anomalies. An approach commonly employed in mass cytometry to overcome this is to use sample barcoding, reducing the variability between each sample, allowing all samples to be exposed to the same antibody mixture (<xref ref-type="bibr" rid="bib32">Schulz and Mei, 2019</xref>). Another regularly employed approach is the inclusion of a shared control sample in each independent batch, for example, the same cell type as the experimental samples but all from the same HD. Statistical methods for batch correction may also be applied; in recent years, a class of methods called remove unwanted variation (RUV) have been developed, and <italic>CytofRUV</italic> (<xref ref-type="bibr" rid="bib35">Trussart et al., 2020</xref>) is a recently developed package specifically designed for CyTOF dataset batch correction. If there are significant differences in the total number of cells recovered between samples, samples with many more cells may bias the clustering. Samples with very few cells recovered may result in information loss and missing populations that are in fact present. The <italic>ImmunoCluster</italic> framework provides users with two opportunities (creating the SingeCellExperiment and running the dimensionality reduction) to downsample, which means the same number of samples will be used for each sample, rectifying the problem of varying cell numbers. If a particular sample has very few cells, they may need to be excluded from the analysis as they may not be a representative sample. Although channel spillover is diminished in mass cytometry, it still exists in fluorescence-based FC and should be considered when designing antibody panels to reduce the effects on introducing cell phenotype artifacts in downstream unsupervised analysis. As such, initial exploratory data analysis (e.g., MDS plots) is key to determining if any of these confounding factors might be present in the data. Additionally, users may want to introduce fluorescence‐minus‐one controls, where cells are stained with all fluorescently tagged antibodies except for the one of interest (<xref ref-type="bibr" rid="bib30">Roederer, 2001</xref>).</p><sec id="s3-1"><title>Summary</title><p>The <italic>ImmunoCluster</italic> package increases the accessibility of advanced computational methods for users tasked with generating high-quality analysis of high-dimensional LMC, IMC, and FC data. More advanced users can leverage <italic>ImmunoCluster</italic>’s data structures, methods, and suitability for scripted analysis to integrate our work with other R analysis tools and build on the package’s foundation. In our clinically relevant immune monitoring case study setting, the <italic>ImmunoCluster</italic> framework successfully identified 24 phenotypically distinct cell clusters, and their abundance across all samples, and highlighted differentially represented cells between GvHD and none patients, all of which were consistent with the Hartmann et al. data (<xref ref-type="bibr" rid="bib19">Hartmann et al., 2019</xref>). We also applied the framework to two sets of IMC data, showing the broad applicability of <italic>ImmunoCluster</italic> as well as the ease of being able to analyze the IMC data in line with LMC data, helping compare these types of data, which will be useful in future studies where multiple technologies are being applied within one study. Finally, we implemented FC data into <italic>ImmunoCluster</italic>, confirming that it was able to analyze conventional FC data and identify rare immune cell populations. Currently, the preprocessing of raw files is carried out prior to implementation into the <italic>ImmunoCluster</italic> framework, but due to the flexibility and design of the tool, future implementations may include IMC data preprocessing within the <italic>ImmunoCluster</italic> R package. This versatile framework provides an opportunity to include all researchers with varying knowledge and experience in computational biology to be involved in the experimental project from experimental design, wet lab/clinical trial, all the way through the data analysis process and visualization.</p></sec></sec><sec id="s4" sec-type="materials|methods"><title>Materials and methods</title><sec id="s4-1"><title>Data file preprocessing and preparation for implementation into the <italic>ImmunoCluster</italic> framework</title><sec id="s4-1-1"><title>LMC data</title><p>Here, we describe an example of the <italic>ImmunoCluster</italic> package analyzing previously published LMC data (CyTOF) from 15 patients with leukemia 30 and 90 days after BMT, previously published by <xref ref-type="bibr" rid="bib19">Hartmann et al., 2019</xref>. After BMT, three of these patients suffered acute GvHD and 12 had no evidence of GvHD (noted as ‘none’ herein). For systems-level biomarker discovery within this trial, a panel of 33 antibodies were incorporated into the immunophenotyping panel (<xref ref-type="supplementary-material" rid="supp1">Supplementary file 1</xref>). The panel was designed to cover all major immune cell lineages and several functional subsets including T-, B-, NK, and myeloid cells and granulocytes (detailed in <xref ref-type="bibr" rid="bib19">Hartmann et al., 2019</xref>). The marker panel also included a variety of immune-regulatory proteins, such as PD-1, PD-L1, and TIM3. The publicly available dataset from the Hartmann et al. study was extracted for the current study from the FlowRepository (<ext-link ext-link-type="uri" xlink:href="http://flowrepository.org/id/FR-FCM-Z244">http://flowrepository.org/id/FR-FCM-Z244</ext-link>) (<xref ref-type="bibr" rid="bib33">Spidlen et al., 2012</xref>). Raw FCS files for the LMC dataset that were collected on the Helios CyTOF system (Fluidigm, UK) machine were first normalized using the free CyTOF 6.7 system control software (files can also be concatenated using the same software if necessary). These files were gated using FlowJo (version 10.5.3) (Becton, Dickinson and Company, UK) to remove beads, doublets, dead cells, and non-CD45<sup>+</sup> cells as well as erythrocytes (CD235αβ/CD61<sup>+</sup>) and neutrophils (CD16<sup>+</sup>) (<xref ref-type="fig" rid="fig8s1">Figure 8—figure supplement 1</xref>), as described by <xref ref-type="bibr" rid="bib19">Hartmann et al., 2019</xref>, before implementation into the <italic>ImmunoCluster</italic> framework. There are various alternative open-access tools that can be used to gate these files, such as OpenCyto (<xref ref-type="bibr" rid="bib16">Finak et al., 2014</xref>), CytoExploreR (<xref ref-type="bibr" rid="bib18">Hammill, 2020</xref>), and Cytoverse (<ext-link ext-link-type="uri" xlink:href="https://cytoverse.org/">https://cytoverse.org/</ext-link>).</p></sec><sec id="s4-1-2"><title>IMC data</title><p>Two different examples of IMC datasets were implemented into the framework. One IMC dataset was from a human tissue section taken from a patient with HNSCC. Consent was attained by the Guy’s and St Thomas’ Research Biobank, within King’s Health Partners Integrated Cancer Centre. The second IMC dataset was from a lymph node section from a patient with DLBCL. Formalin-fixed paraffin-embedded (FFPE) DLBCL tumor tissue was obtained from King’s College Hospital, in accordance with the Declaration of Helsinki and approved by the UK National Research Ethics Committee (reference 13/NW/0040). A detailed protocol is available for both datasets as a Supplementary file (Appendix 1 and 2, respectively). The raw HNSCC IMC data from 12 channels (10 markers + 2 intercalator-Ir channels; <xref ref-type="supplementary-material" rid="supp2">Supplementary file 2</xref>) and the raw DLBCL IMC data from 20 channels (19 markers + nuclei channel; <xref ref-type="supplementary-material" rid="supp3">Supplementary file 3</xref>) were processed with Python scripts and <italic>CellProfiler</italic> pipelines according to <xref ref-type="bibr" rid="bib31">Schulz et al., 2018</xref> to segment the image data into individual cells (<xref ref-type="fig" rid="fig8s2">Figure 8—figure supplement 2</xref>). The mean marker intensity for each segmented cell was exported (comma-separated values [CSV] file) and either divided into six regions of equal area (HNSCC, three tumor and three stroma regions) or divided by Ki-67 expression (DLBCL, Ki-67 high or low). The mean marker intensity for each segmented cell was multiplied by 65,535 to recover the image intensities (Fluidigm IMC machine = 16 bit, the dynamic range of the measurements is 0 to (2<sup>16</sup>)−1) and asinh (co-factor 0.8) transformed in R Studio. These CSV files were converted into FCS files and gated in Cytobank (<xref ref-type="bibr" rid="bib10">Chen and Kotecha, 2014</xref>); functions are also available within the <italic>ImmunoCluster</italic> package to convert SCE or CSV data files into FCS format.</p></sec><sec id="s4-1-3"><title>FC data</title><p>FC data from the BM of seven HDs were used to demonstrate the ability of the framework to analyze conventional FC data and identify rare immune cell populations. BM samples from HDs were obtained by extraction of the bone marrow cells from the bone of the femoral head. This noninterventional study was approved by the ethical committee of Cochin-Port Royal Hospital (Paris, France) (CLEP Decision No.: AAA-2020-08039). Femoral heads were obtained after informed consent during hip replacement surgery. These were cut in half and collected in a conservation medium (Hanks balanced salt solution with NaHCO<sub>3</sub>, Eurobio), supplemented with heparin (7%) and then transported to the laboratory at room temperature (RT). These were scraped with a spatula, ground in a mortar, and washed with a PBS solution supplemented with 100 µg/ml DNAse (Sigma Aldrich). The FCS files were gated for singlets using a FSCint/FSCpeak dot plot, and dead cells were removed using a forward scatter (FSC) and side scatter (SSC) dot plot. Leukocytes were gated on a CD45/SSC dot plot. Finally, they were gated to identify the CD3<sup>+</sup>CD4<sup>+</sup> population of cells for analysis in the <italic>ImmunoCluster</italic> framework (gated in Cytobank; <xref ref-type="bibr" rid="bib10">Chen and Kotecha, 2014</xref>).</p></sec></sec><sec id="s4-2"><title>Workflow overview</title><p>The <italic>ImmunoCluster</italic> package is accessible via GitHub (<ext-link ext-link-type="uri" xlink:href="https://github.com/kordastilab/ImmunoCluster">https://github.com/kordastilab/ImmunoCluster</ext-link>), where a detailed step-by-step walkthrough of the tool and R Markdown files (RMD) for LMC/FC and IMC data analysis are available. The RMD files permit users to logically work through the framework in sections in a ‘click and play’ manner. Additionally, all scripts to replicate figures published here are available via GitHub. Users will need to have R downloaded to run the <italic>ImmunoCluster</italic> tool. The <italic>ImmunoCluster</italic> framework provides tools and support, allowing researchers to follow a workflow that guides them through experimental design, data analyses, interpretation, and statistical significance testing, to publishable graphics identifying differences in phenotype and abundance of cells between conditions analyzed (<xref ref-type="fig" rid="fig2">Figure 2</xref> and <xref ref-type="fig" rid="fig7">Figure 7</xref> and <xref ref-type="fig" rid="fig8">Figure 8</xref>). The framework comprises three core computational stages that are conducted by the <italic>ImmunoCluster</italic> tool:</p><fig id="fig7" position="float"><label>Figure 7.</label><caption><title><italic>ImmunoCluster</italic> workflow stages and SingleCellExperiment structure.</title><p>(<bold>A</bold>) Schematic outlining the typical cytometry workflow and its interactions with the SingleCellExperiement <italic>ImmunoCluster</italic> object. (<bold>B</bold>) SingleCellExperiment structure in <italic>ImmunoCluster</italic>. The SingleCellExperiment class is a data container, storing multiple layers of data to create the SingleCellExperiment object, which holds all relevant data for an experiment. Feature metadata: imported by the user in the form of a <italic>panel_metadata</italic> file, which is a table containing all markers measured, each annotated with either lineage or functional information for downstream analysis. Primary and transformed data: the imported expression data is stored in an assay; additionally, the scaled data (arcsinh transformed) is also stored in an assay, meaning both can be easily accessed. Cell metadata: the first metadata added to this element of the structure will be a <italic>sample_metadata</italic> file imported by the user, containing any relevant metadata for the experiment, that is, days after treatment and graft versus host disease or none. Throughout the <italic>ImmunoCluster</italic> tool, more layers of metadata are added to cell metadata, that is, cell cluster identification (<italic>FlowSOM</italic> and <italic>Phenograph</italic>). Dimension reductions: dimensionality reduction coordinates, such as <italic>UMAP</italic> and <italic>tSNE,</italic> are stored and can be easily accessed throughout the <italic>ImmunoCluster</italic> tool for downstream analyses.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-62915-fig7-v2.tif"/></fig></sec><sec id="s4-3"><title>Stage 1: Data import and quality control</title><list list-type="alpha-lower"><list-item><p>We provide tools designed primarily for computational preprocessing of FCS data files for downstream applications including parameter renaming and transformation. The generated high-dimensional data are imported into the computational framework as FCS file formats or summarized feature expression values in CSV tabular format.</p></list-item><list-item><p>Associated metadata files need to be completed by the researcher in the experimental design stage (<xref ref-type="fig" rid="fig7">Figure 7</xref>). This includes a <italic>sample_metadata</italic> file, in which all metadata relating to samples will need to be input, such as timepoints, response to treatments, and patient status (<xref ref-type="fig" rid="fig8s3">Figure 8—figure supplement 3A</xref>). For simplicity in executing this step, the <italic>panel_metadata</italic> file allows users to rename parameters, such as the markers used in the analysis as well as select the markers that are to be used for different analyses stages (all markers may not need to be included in the following steps) (<xref ref-type="fig" rid="fig8s3">Figure 8—figure supplement 3B</xref>).</p></list-item><list-item><p>All of the above-mentioned data is stored within a SingleCellExperiment object (<xref ref-type="bibr" rid="bib26">Lun, 2017</xref>). The SingleCellExperiment is an S4 class object that is implemented into the <italic>ImmunoCluster</italic> framework and is in essence a data container in which you can store and retrieve information such as metal-barcoding for sample multiplexing, metadata, dimensionality reduction coordinates, and more (outlined in <xref ref-type="fig" rid="fig7">Figure 7</xref>). FCS files can also be exported from the SingleCellExperiment using the <italic>write_sce_to_fcs</italic> function.</p></list-item><list-item><p>After the data and metadata files have been imported and stored in the SingleCellExperiment object, we provide several approaches for initial exploratory visualization of the data. One example of this is the MDS plots. The median marker expression data from each sample are used to create MDS plots, and therefore allow for an initial visualization of data points (labeled with metadata) and show the similarity and differences between samples in two-dimensions. Additionally, these plots can be used to detect batch effects and other technical artifacts such as antibody staining anomalies. Moreover, a heatmap of expression of markers measured for each patient can be created and metadata can be used to annotate the heatmap.</p></list-item></list></sec><sec id="s4-4"><title>Stage 2: Dimensionality reduction and unsupervised clustering</title><list list-type="alpha-lower"><list-item><p>Dimensionality reduction is a key component of high-dimensional single-cell data analyses and enables researchers to view high-dimensional data. For example, the 33 protein markers analyzed by <xref ref-type="bibr" rid="bib19">Hartmann et al., 2019</xref> can be reduced to lower dimensional embedded coordinates per cell. Nonlinear dimensionality reduction techniques can avoid overcrowding and represent data in distinct cell islands (<xref ref-type="fig" rid="fig8">Figure 8</xref>).</p></list-item><list-item><p>The framework offers users three nonlinear statistical methods for representing high-dimensional single-cell data in low-dimensional space (<xref ref-type="fig" rid="fig8s4">Figure 8—figure supplement 4</xref>). MDS (utilized in stage 1 for initial data exploration), uniform manifold approximation and projection (<italic>UMAP</italic>) (<xref ref-type="bibr" rid="bib4">Becht et al., 2019</xref>), and t-Distributed Stochastic Neighbor Embedding (<italic>tSNE</italic>) (<xref ref-type="bibr" rid="bib36">van der Maaten and Hinton, 2008</xref>) algorithms are available to generate a two-dimensional (2D) embedding of the data. However, the SingleCellExperiment object can store any other form of arbitrary dimensionality reduction, such as principal component analysis (<xref ref-type="bibr" rid="bib7">Blighe, 2020b</xref>) or DiffusionMaps (<xref ref-type="bibr" rid="bib1">Angerer et al., 2016</xref>), among others.</p></list-item><list-item><p>The density of cells within the distinct cell islands produced by the 2D embedding of multidimensional data can be viewed using the <italic>density_plot</italic> function (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>).</p></list-item><list-item><p>After the data has been visualized in dimensionality reduced space, clustering algorithms can be used to identify cell communities within the data, which allows the identification of phenotype and abundance of cell clusters within populations/groups being analyzed. A number of clustering algorithms are available within the framework to define cell populations of interest in an unbiased manner. First, an ensemble (use of multiple algorithms) clustering method of <italic>FlowSOM</italic> (<xref ref-type="bibr" rid="bib38">Van Gassen, 2015b</xref>) and Consensus clustering (<italic>ConsensusClusterPlus</italic> R package, <xref ref-type="bibr" rid="bib42">Wilkerson and Waltman, 2013</xref>), which tests the stability of the clusters, leading to better results than applying a basic hierarchical clustering algorithm (<xref ref-type="bibr" rid="bib41">Weber and Robinson, 2016</xref>). Additionally, the <italic>PhenoGraph</italic> clustering algorithm is available, which uses <italic>K</italic>-nearest neighbors and a Euclidean distance metric (<xref ref-type="bibr" rid="bib14">DiGiuseppe et al., 2018</xref>). Lastly, <italic>k-means clustering</italic>, which classifies cells into clusters with high intra-class similarity and low inter-class similarity, where each cluster is represented by its center (centroid) that corresponds to the mean of points (e.g., markers) assigned to the cluster. Either or all clustering algorithms can be applied at the users’ discretion.</p></list-item><list-item><p>The aim of the clustering algorithms is to assign all cells to <italic>K</italic> clusters (<italic>K<sub>1</sub></italic>, <italic>K<sub>2</sub></italic>, …), resulting in clusters corresponding to true cell types. Typically, a <italic>K</italic> larger than the number of expected cell types is chosen at this stage as the <italic>ImmunoCluster</italic> framework allows users to explore all <italic>K</italic> clusters (<xref ref-type="fig" rid="fig8s5">Figure 8—figure supplement 5</xref>), as well as collapsing clusters of the same cell type into one cluster if the user feels over-clustering has occurred. Over-clustering may enable the clustering identification of rare cell types, sometimes at the expense of creating several ‘artificial’ clusters of the more prevalent cell types. Additionally, the workflow allows the generation of an elbow plot that is created to help the user to select an appropriate number of clusters (<xref ref-type="fig" rid="fig8s6">Figure 8—figure supplement 6</xref>).</p></list-item></list><fig-group><fig id="fig8" position="float"><label>Figure 8.</label><caption><title><italic>ImmunoCluster</italic> workflow overview.</title><p>(<bold>0</bold>) Samples are stained/treated and measured, for imaging mass cytometry the tissue is segmented, and regions selected for further downstream analysis. After measurement, the raw data is normalized, concatenated, (combining flow cytometry standard files from the same samples, which may have been split due to large sample volume or technical issues) and gated, before importing into <italic>ImmunoCluster</italic>. (<bold>1</bold>) Quality control of data is carried out before analysis. (<bold>2</bold>) Data is reduced to two dimensions using either <italic>UMAP</italic> or <italic>tSNE</italic> algorithm, and data are clustered using the <italic>FlowSOM</italic> or <italic>Phenograph</italic> algorithms (these algorithms were selected as they are both high-performing unsupervised clustering algorithms; an in-depth comparison has previously been described by <xref ref-type="bibr" rid="bib41">Weber and Robinson, 2016</xref>). (<bold>3</bold>) Data is visualized, and metadata, clusters, and cell-type labels are used to explore differences between samples/conditions. *A detailed step-by-step guide for using the <italic>ImmunoCluster</italic> tool is available: <ext-link ext-link-type="uri" xlink:href="https://github.com/kordastilab/ImmunoCluster">https://github.com/kordastilab/ImmunoCluster</ext-link>.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-62915-fig8-v2.tif"/></fig><fig id="fig8s1" position="float" specific-use="child-fig"><label>Figure 8—figure supplement 1.</label><caption><title>Gating strategy for mass cytometry data in FlowJo.</title><p>Calibration beads, doublets, dead cells, non-CD45<sup>+</sup> cells, erythrocytes (CD235αβ/CD61<sup>+</sup>), and neutrophils (CD16<sup>+</sup>) were removed.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-62915-fig8-figsupp1-v2.tif"/></fig><fig id="fig8s2" position="float" specific-use="child-fig"><label>Figure 8—figure supplement 2.</label><caption><title>Imaging mass cytometry (IMC) data preprocessing workflow.</title><p>(<bold>1</bold>) The imctools <italic>Python</italic> package (<xref ref-type="bibr" rid="bib31">Schulz et al., 2018</xref>) was used to convert raw IMC files (.mcd, .txt) into intermediatory .tiff files, which were used as input files for the following tools. (<bold>2</bold>) .tiff files were imported into <italic>CellProfiler</italic> for regions of interest (ROI) selection for classifier training. (<bold>3</bold>) <italic>IIastik</italic> was used for pixel classification, pixels were identified as nuclear, cytoplasmic, or background, and these class probabilities were exported as RGB (red, green, blue) .tiff images. (<bold>4</bold>) The <italic>iIastik</italic> RGB probabilities and the original images were imported into <italic>CellProfiler</italic> for single-cell segmentation, mask generation, and marker quantification.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-62915-fig8-figsupp2-v2.tif"/></fig><fig id="fig8s3" position="float" specific-use="child-fig"><label>Figure 8—figure supplement 3.</label><caption><title>Metadata files created in the experimental design stage.</title><p>(<bold>A</bold>) Sample metadata file containing all metadata the researcher would like to explore throughout the data analysis stage. (<bold>B</bold>) Panel metadata file allows the researcher to rename parameters and select the markers that will be used for the dimensionality reduction of the data.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-62915-fig8-figsupp3-v2.tif"/></fig><fig id="fig8s4" position="float" specific-use="child-fig"><label>Figure 8—figure supplement 4.</label><caption><title>Dimensionality reduction.</title><p>Examples taken from the GitHub page (<ext-link ext-link-type="uri" xlink:href="https://github.com/kordastilab/ImmunoCluster">https://github.com/kordastilab/ImmunoCluster</ext-link>) highlighting the three different types of dimensionality reduction algorithms available for the users. Multidimensional scaling is part of the initial data exploration step followed by <italic>UMAP</italic> and <italic>tSNE</italic> dimensionality reduction in stage 2 of the <italic>ImmunoCluster</italic> framework.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-62915-fig8-figsupp4-v2.tif"/></fig><fig id="fig8s5" position="float" specific-use="child-fig"><label>Figure 8—figure supplement 5.</label><caption><title>Selecting <italic>K</italic> clusters for visualization and downstream analysis.</title><p>The <italic>ImmunoCluster</italic> tool saves all <italic>K</italic> clusters selected for the FlowSOM algorithm (e.g., 1–60 <italic>K</italic> clusters); therefore, researchers can view different numbers of <italic>K</italic> clusters for downstream analysis by changing the Flowsom_cc_K number (highlighted above).</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-62915-fig8-figsupp5-v2.tif"/></fig><fig id="fig8s6" position="float" specific-use="child-fig"><label>Figure 8—figure supplement 6.</label><caption><title>Elbow plot criterion to help determine optimal number of clusters for <italic>K</italic>-means clustering (<italic>FlowSOM</italic>).</title><p>The figure shows <italic>K</italic> clusters 2–60, for each value of <italic>K</italic> the sum of squared errors were plotted, and the aim was to detect the ‘elbow’, which is the point where the variance stops decreasing sharply and the line flattens on the plot, representing the optimal value of <italic>K</italic>.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-62915-fig8-figsupp6-v2.tif"/></fig></fig-group></sec><sec id="s4-5"><title>Stage 3: Annotation and differential testing</title><list list-type="alpha-lower"><list-item><p>After dimensionality reduction and clustering, the next step is to annotate each cluster based on marker expression. If over-clustering has occurred, multiple clusters of the same cell type can be present, and either a lower number of <italic>K</italic> clusters can be used; additionally, clusters of the same cell type can be collapsed into each other to create one cluster.</p></list-item><list-item><p>Clusters containing multiple cell types may also be identified; this could mean the user has under-clustered or occasionally a group of different cells are clustered together by the algorithms.</p></list-item><list-item><p>Expression of each marker analyzed can be projected onto the dimensionality reduced data by the researcher, aiding with the identification of cell types or phenotypically distinct clusters.</p></list-item><list-item><p>Outputs such as heatmaps showing the expression of all markers for each cluster can be used to identify the clusters of interest (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2</xref>). These can be used to annotate figures produced in stage 3.</p></list-item><list-item><p>Biaxial dot plots with contouring of the SCE data can be produced using the <italic>biaxial_plot</italic> function; the expression of markers can be explored in the entire dataset or a subset of the data, that is, a particular cell cluster. A clustering option within <italic>biaxial_plot</italic> allows users to see the spread of data across two selected markers for different conditions (any metadata from the <italic>sample_metadata</italic> file), as well as different clusters (e.g., K1-60) (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1</xref>).</p></list-item><list-item><p>Due to the type of data produced from IMC (lower resolution compared to LMC and FC), a novel function called <italic>imc_rank</italic> was specifically designed for the IMC data; this creates a heatmap in which the expression of each marker is ranked. This rank heatmap can be used to facilitate the identification of clusters that are ‘high’ or ‘low’ for particular markers to distinguish and logically assign cell populations manually.</p></list-item><list-item><p>These tools help define biological identity of cell clusters from stage 2 and construct a hierarchy of biologically meaningful cell populations based on marker expression and similarity.</p></list-item><list-item><p>The metadata added to the SingleCellExperiment can be used to annotate the dimensionality reduced (i.e., <italic>UMAP</italic>) and clustered (<italic>FlowSOM</italic>, <italic>Phenograph, or K-means</italic>) data, allowing for visualization of the distribution of cell islands between different condition/timepoints (<xref ref-type="fig" rid="fig8">Figure 8</xref>).</p></list-item><list-item><p>The above-mentioned metadata is also used to annotate all differential testing outputs, meaning the user can make many comparisons and explore multiple parameters all within the <italic>ImmunoCluster</italic> framework.</p></list-item><list-item><p>A variety of differential testing outputs can be created, such as median marker expression for each sample (using clustered data) can be used to produce a hierarchical clustered heatmap, and box plots of cell cluster abundance between different conditions at different timepoints (any metadata can be used to annotate these figures).</p></list-item><list-item><p>Statistically significant differences in the annotated populations between conditions are identified and displayed throughout the framework to the user for ongoing investigation and interpretation. Data from the <italic>ImmunoCluster-</italic>generated SingleCellExperiment object can be easily extracted for downstream analysis with differential analysis packages such as <italic>diffcyt</italic> (<xref ref-type="bibr" rid="bib40">Weber et al., 2019</xref>) and <italic>cydar</italic> (<xref ref-type="bibr" rid="bib27">Lun et al., 2017</xref>) for differential discovery, which is based on a combination of high-resolution clustering and empirical Bayes moderated tests. In addition, the <italic>ImmunoCluster</italic> framework offers the <italic>stat_test_clust</italic> and <italic>stat_test_expression</italic> functions that use the Wilcox rank-sum or Welch’s T-test to identify which cell clusters are significantly different between conditions (any two-way comparison can be made using metadata input by user), and which markers are significantly different within cell clusters between different conditions, respectively.</p></list-item></list></sec></sec></body><back><ack id="ack"><title>Acknowledgements</title><p>We would like to thank the following funding bodies for their support:</p><p>Guy's and St Thomas Hospital Charity: grant number: G170701, Jessica A Timms, Shahram Kordasti.</p><p>Cancer Research UK (CRUK), King's Health Partners Centre : Jessica A Timms, Shahram Kordasti C604/A25135.</p><p>Aplastic Anemia and MDS International Foundation (AAMDSIF): Shahram Kordasti.</p><p>Blood Cancer UK: Shahram Kordasti.</p><p>European Research Council (ERC): James N Arnold Start up grant 335326.</p><p>Medical Research Council (MRC): James W Opzoomer MR/N013700/1.</p><p>Medical Research Council (MRC): James W Opzoomer Doctoral Training Partnership in Biomedical Sciences.</p><p>Rosetrees Trust (Rosetrees): Sedigeh Kareemaghay, Mahvash Tavassoli M117-F2.</p><p>The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication. The research was supported by the Cancer Research UK King’s Health Partners Centre and Experimental Cancer Medicine Centre at King’s College London, and the National Institute for Health Research (NIHR) Biomedical Research Centre based at Guy's and St Thomas' NHS Foundation Trust and King’s College London. The views expressed are those of the authors and not necessarily those of the NHS, the NIHR, or the Department of Health.</p></ack><sec id="s5" sec-type="additional-information"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="COI-statement" id="conf1"><p>No competing interests declared</p></fn><fn fn-type="COI-statement" id="conf2"><p>Honoraria: Beckman Coulter, GWT-TUD, Alexion. Consulting or Advisory Role: Syneos Health. Research Funding: Celgene, Novartis pharmaceutical</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>Conceptualization, Resources, Data curation, Software, Formal analysis, Validation, Investigation, Visualization, Methodology, Writing - original draft, Project administration, Writing - review and editing</p></fn><fn fn-type="con" id="con2"><p>Conceptualization, Resources, Data curation, Software, Formal analysis, Validation, Investigation, Visualization, Methodology, Writing - original draft, Project administration, Writing - review and editing</p></fn><fn fn-type="con" id="con3"><p>Conceptualization, Resources, Data curation, Software, Formal analysis, Validation, Investigation, Methodology, Writing - original draft, Writing - review and editing</p></fn><fn fn-type="con" id="con4"><p>Software, Methodology, Writing - review and editing</p></fn><fn fn-type="con" id="con5"><p>Data curation, Writing - review and editing</p></fn><fn fn-type="con" id="con6"><p>Formal analysis</p></fn><fn fn-type="con" id="con7"><p>Investigation</p></fn><fn fn-type="con" id="con8"><p>Investigation</p></fn><fn fn-type="con" id="con9"><p>Investigation</p></fn><fn fn-type="con" id="con10"><p>Conceptualization, Resources, Supervision, Funding acquisition, Investigation, Methodology, Writing - original draft, Project administration, Writing - review and editing</p></fn><fn fn-type="con" id="con11"><p>Investigation</p></fn><fn fn-type="con" id="con12"><p>Funding acquisition, Investigation, Writing - review and editing</p></fn><fn fn-type="con" id="con13"><p>Funding acquisition, Writing - review and editing</p></fn><fn fn-type="con" id="con14"><p>Writing - review and editing</p></fn><fn fn-type="con" id="con15"><p>Investigation, Writing - review and editing</p></fn><fn fn-type="con" id="con16"><p>Resources, Software, Investigation, Writing - review and editing</p></fn><fn fn-type="con" id="con17"><p>Conceptualization, Resources, Software, Supervision, Funding acquisition, Investigation, Methodology, Writing - original draft, Project administration, Writing - review and editing</p></fn><fn fn-type="con" id="con18"><p>Conceptualization, Resources, Supervision, Funding acquisition, Methodology, Writing - original draft, Project administration, Writing - review and editing</p></fn></fn-group><fn-group content-type="ethics-information"><title>Ethics</title><fn fn-type="other" id="fn1"><p>Human subjects: Formalin-fixed paraffin-embedded (FFPE) DLBCL tumor tissue was obtained from King's College Hospital, in accordance with the Declaration of Helsinki and approved by the UK National Research Ethics Committee (reference 13/NW/0040). Head and neck squamous cell carcinoma (HNSCC) tissue was obtained from King's College Hospital, consent was attained by the King Guy's &amp; St Thomas' Research Biobank, within King's Health Partners Integrated Cancer Centre. The non-interventional study which collected bone marrow samples from elderly healthy donors was approved by the ethical committee of Cochin-Port Royal Hospital (Paris, France) (CLEP Decision N°: AAA-2020-08039).</p></fn></fn-group></sec><sec id="s6" sec-type="supplementary-material"><title>Additional files</title><supplementary-material id="supp1"><label>Supplementary file 1.</label><caption><title>Reference panel of anti-human antibodies for mass cytometry used by <xref ref-type="bibr" rid="bib19">Hartmann et al., 2019</xref>.</title></caption><media mime-subtype="docx" mimetype="application" xlink:href="elife-62915-supp1-v2.docx"/></supplementary-material><supplementary-material id="supp2"><label>Supplementary file 2.</label><caption><title>Reference panel of anti-human antibodies for the head and neck cancer (HNSCC) imaging mass cytometry experiment.</title></caption><media mime-subtype="docx" mimetype="application" xlink:href="elife-62915-supp2-v2.docx"/></supplementary-material><supplementary-material id="supp3"><label>Supplementary file 3.</label><caption><title>Reference panel of anti-human antibodies for the diffuse large B-cell lymphoma (DLBCL) imaging mass cytometry experiment.</title></caption><media mime-subtype="docx" mimetype="application" xlink:href="elife-62915-supp3-v2.docx"/></supplementary-material><supplementary-material id="supp4"><label>Supplementary file 4.</label><caption><title>Diffcyt computational framework output for differential discovery analysis for identified cell clusters in the <xref ref-type="bibr" rid="bib19">Hartmann et al., 2019</xref> in LMC data.</title></caption><media mime-subtype="docx" mimetype="application" xlink:href="elife-62915-supp4-v2.docx"/></supplementary-material><supplementary-material id="transrepform"><label>Transparent reporting form</label><media mime-subtype="docx" mimetype="application" xlink:href="elife-62915-transrepform-v2.docx"/></supplementary-material></sec><sec id="s7" sec-type="data-availability"><title>Data availability</title><p>The liquid mass cytometry dataset is available from FlowRepository (<ext-link ext-link-type="uri" xlink:href="http://flowrepository.org/id/FR-FCM-Z244">http://flowrepository.org/id/FR-FCM-Z244</ext-link>), the additional three datasets: 'Imaging mass cytometry data: Head and neck squamous cellcarcinoma tissue section', 'Flow cytometry data: healthy donor bone marrow taken during hip surgery', and 'Imaging mass cytometry data: Head and neck squamous cell carcinoma tissue section', are available from Dryad (<ext-link ext-link-type="uri" xlink:href="https://datadryad.org/stash">https://datadryad.org/stash</ext-link>).</p><p>The following datasets were generated:</p><p><element-citation id="dataset2" publication-type="data" specific-use="isSupplementedBy"><person-group person-group-type="author"><name><surname>Opzoomer</surname><given-names>JW</given-names></name><name><surname>Timms</surname><given-names>J</given-names></name><name><surname>Blighe</surname><given-names>K</given-names></name><name><surname>Mourikis</surname><given-names>TP</given-names></name><name><surname>Chapuis</surname><given-names>N</given-names></name><name><surname>Bekoe</surname><given-names>R</given-names></name><name><surname>Kareemaghay</surname><given-names>S</given-names></name><name><surname>Nocerino</surname><given-names>P</given-names></name><name><surname>Apollonio</surname><given-names>B</given-names></name><name><surname>Ramsay</surname><given-names>AG</given-names></name><name><surname>Tavassoli</surname><given-names>M</given-names></name><name><surname>Harrison</surname><given-names>C</given-names></name><name><surname>Ciccarelli</surname><given-names>F</given-names></name><name><surname>Parker</surname><given-names>P</given-names></name><name><surname>Fontenay</surname><given-names>M</given-names></name><name><surname>Barber</surname><given-names>PR</given-names></name><name><surname>Arnold</surname><given-names>JN</given-names></name><name><surname>Kordasti</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2021">2021</year><data-title>Imagingmass cytometry data: Head and neck squamous cell carcinoma tissuesection</data-title><source>Dryad</source><pub-id assigning-authority="Dryad" pub-id-type="doi">10.5061/dryad.gf1vhhmpr</pub-id></element-citation></p><p><element-citation id="dataset3" publication-type="data" specific-use="isSupplementedBy"><person-group person-group-type="author"><name><surname>Opzoomer</surname><given-names>JW</given-names></name><name><surname>Timms</surname><given-names>J</given-names></name><name><surname>Blighe</surname><given-names>K</given-names></name><name><surname>Mourikis</surname><given-names>TP</given-names></name><name><surname>Chapuis</surname><given-names>N</given-names></name><name><surname>Bekoe</surname><given-names>R</given-names></name><name><surname>Kareemaghay</surname><given-names>S</given-names></name><name><surname>Nocerino</surname><given-names>P</given-names></name><name><surname>Apollonio</surname><given-names>B</given-names></name><name><surname>Ramsay</surname><given-names>AG</given-names></name><name><surname>Tavassoli</surname><given-names>M</given-names></name><name><surname>Harrison</surname><given-names>C</given-names></name><name><surname>Ciccarelli</surname><given-names>F</given-names></name><name><surname>Parker</surname><given-names>P</given-names></name><name><surname>Fontenay</surname><given-names>M</given-names></name><name><surname>Barber</surname><given-names>PR</given-names></name><name><surname>Arnold</surname><given-names>JN</given-names></name><name><surname>Kordasti</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2021">2021</year><data-title>Flow cytometry data: healthy donor bone marrow taken during hipsurgery</data-title><source>Dryad</source><pub-id assigning-authority="Dryad" pub-id-type="doi">10.5061/dryad.4b8gthtcf</pub-id></element-citation></p><p><element-citation id="dataset4" publication-type="data" specific-use="isSupplementedBy"><person-group person-group-type="author"><name><surname>Opzoomer</surname><given-names>JW</given-names></name><name><surname>Timms</surname><given-names>J</given-names></name><name><surname>Blighe</surname><given-names>K</given-names></name><name><surname>Mourikis</surname><given-names>TP</given-names></name><name><surname>Chapuis</surname><given-names>N</given-names></name><name><surname>Bekoe</surname><given-names>R</given-names></name><name><surname>Kareemaghay</surname><given-names>S</given-names></name><name><surname>Nocerino</surname><given-names>P</given-names></name><name><surname>Apollonio</surname><given-names>B</given-names></name><name><surname>Ramsay</surname><given-names>AG</given-names></name><name><surname>Tavassoli</surname><given-names>M</given-names></name><name><surname>Harrison</surname><given-names>C</given-names></name><name><surname>Ciccarelli</surname><given-names>F</given-names></name><name><surname>Parker</surname><given-names>P</given-names></name><name><surname>Fontenay</surname><given-names>M</given-names></name><name><surname>Barber</surname><given-names>PR</given-names></name><name><surname>Arnold</surname><given-names>JN</given-names></name><name><surname>Kordasti</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2021">2021</year><data-title>Imaging mass cytometry data: Diffuse large B-cell lymphoma lymph node section</data-title><source>Dryad</source><pub-id assigning-authority="Dryad" pub-id-type="doi">10.5061/dryad.3n5tb2rhd</pub-id></element-citation></p><p>The following previously published dataset was used:</p><p><element-citation id="dataset1" publication-type="data" specific-use="references"><person-group person-group-type="author"><name><surname>Hartmann</surname><given-names>FJ</given-names></name><name><surname>Babdor</surname><given-names>J</given-names></name><name><surname>Gherardini</surname><given-names>PF</given-names></name><name><surname>Amir</surname><given-names>ED</given-names></name><name><surname>Jones</surname><given-names>K</given-names></name><name><surname>Sahaf</surname><given-names>B</given-names></name><name><surname>Marquez</surname><given-names>DM</given-names></name><name><surname>Krutzik</surname><given-names>P</given-names></name><name><surname>O'Donnell</surname><given-names>E</given-names></name><name><surname>Sigal</surname><given-names>N</given-names></name><name><surname>Maecker</surname><given-names>HT</given-names></name><name><surname>Meyer</surname><given-names>E</given-names></name><name><surname>Spitzer</surname><given-names>MH</given-names></name><name><surname>Bendall</surname><given-names>SC</given-names></name></person-group><year iso-8601-date="2019">2019</year><data-title>Identification of disease-associated immune signatures following bone marrow transplantation</data-title><source>Flow Repository</source><pub-id assigning-authority="other" pub-id-type="accession" xlink:href="http://flowrepository.org/id/FR-FCM-Z244">FR-FCM-Z244</pub-id></element-citation></p></sec><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Angerer</surname> <given-names>P</given-names></name><name><surname>Haghverdi</surname> <given-names>L</given-names></name><name><surname>Büttner</surname> <given-names>M</given-names></name><name><surname>Theis</surname> <given-names>FJ</given-names></name><name><surname>Marr</surname> <given-names>C</given-names></name><name><surname>Buettner</surname> <given-names>F</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Destiny: diffusion maps for large-scale single-cell data in R</article-title><source>Bioinformatics</source><volume>32</volume><fpage>1241</fpage><lpage>1243</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btv715</pub-id><pub-id pub-id-type="pmid">26668002</pub-id></element-citation></ref><ref id="bib2"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Ashhurst</surname> <given-names>TM</given-names></name></person-group><year iso-8601-date="2019">2019</year><chapter-title>Analysis of the Murine Bone Marrow Hematopoietic System Using Mass and Flow Cytometry</chapter-title><person-group person-group-type="editor"><name><surname>McGuire</surname> <given-names>H. M</given-names></name><name><surname>Ashhurst</surname> <given-names>T. M</given-names></name></person-group><source>Mass Cytometry: Methods and Protocols</source><publisher-name>Springer</publisher-name><fpage>159</fpage><lpage>192</lpage><pub-id pub-id-type="doi">10.1007/978-1-4939-9454-0</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ashhurst</surname> <given-names>TM</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Integration, exploration, and analysis of high-dimensional single-cell cytometry data using spectre</article-title><source>Cytometry. Part a : The Journal of the International Society for Analytical Cytology</source><volume>10</volume><elocation-id>e24350</elocation-id><pub-id pub-id-type="doi">10.1002/cyto.a.24350</pub-id></element-citation></ref><ref id="bib4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Becht</surname> <given-names>E</given-names></name><name><surname>McInnes</surname> <given-names>L</given-names></name><name><surname>Healy</surname> <given-names>J</given-names></name><name><surname>Dutertre</surname> <given-names>C-A</given-names></name><name><surname>Kwok</surname> <given-names>IWH</given-names></name><name><surname>Ng</surname> <given-names>LG</given-names></name><name><surname>Ginhoux</surname> <given-names>F</given-names></name><name><surname>Newell</surname> <given-names>EW</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Dimensionality reduction for visualizing single-cell data using UMAP</article-title><source>Nature Biotechnology</source><volume>37</volume><fpage>38</fpage><lpage>44</lpage><pub-id pub-id-type="doi">10.1038/nbt.4314</pub-id></element-citation></ref><ref id="bib5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bertolo</surname> <given-names>M</given-names></name><name><surname>Baumgart</surname> <given-names>S</given-names></name><name><surname>Durek</surname> <given-names>P</given-names></name><name><surname>Peddinghaus</surname> <given-names>A</given-names></name><name><surname>Mei</surname> <given-names>H</given-names></name><name><surname>Rose</surname> <given-names>T</given-names></name><name><surname>Enghard</surname> <given-names>P</given-names></name><name><surname>Grützkau</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Deep phenotyping of urinary leukocytes by mass cytometry reveals a leukocyte signature for early and Non-Invasive prediction of response to treatment in active lupus nephritis</article-title><source>Frontiers in Immunology</source><volume>11</volume><elocation-id>256</elocation-id><pub-id pub-id-type="doi">10.3389/fimmu.2020.00256</pub-id><pub-id pub-id-type="pmid">32265898</pub-id></element-citation></ref><ref id="bib6"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Blighe</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="2020">2020a</year><source>scDataviz: Single Cell Dataviz and Downstream Analyses</source><ext-link ext-link-type="uri" xlink:href="https://github.com/kevinblighe/scDataviz">https://github.com/kevinblighe/scDataviz</ext-link></element-citation></ref><ref id="bib7"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Blighe</surname> <given-names>AL</given-names></name></person-group><year iso-8601-date="2020">2020b</year><source>PCAtools: PCAtools: Everything Principal Components Analysis</source><ext-link ext-link-type="uri" xlink:href="https://github.com/kevinblighe/PCAtools">https://github.com/kevinblighe/PCAtools</ext-link></element-citation></ref><ref id="bib8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname> <given-names>H</given-names></name><name><surname>Lau</surname> <given-names>MC</given-names></name><name><surname>Wong</surname> <given-names>MT</given-names></name><name><surname>Newell</surname> <given-names>EW</given-names></name><name><surname>Poidinger</surname> <given-names>M</given-names></name><name><surname>Chen</surname> <given-names>J</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Cytofkit: a bioconductor package for an integrated mass cytometry data analysis pipeline</article-title><source>PLOS Computational Biology</source><volume>12</volume><elocation-id>e1005112</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1005112</pub-id><pub-id pub-id-type="pmid">27662185</pub-id></element-citation></ref><ref id="bib9"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Chen</surname> <given-names>J</given-names></name><name><surname>Chen</surname> <given-names>H</given-names></name></person-group><year iso-8601-date="2015">2015</year><source>Rphenograph</source><ext-link ext-link-type="uri" xlink:href="https://github.com/JinmiaoChenLab/Rphenograph">https://github.com/JinmiaoChenLab/Rphenograph</ext-link></element-citation></ref><ref id="bib10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname> <given-names>TJ</given-names></name><name><surname>Kotecha</surname> <given-names>N</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Cytobank: providing an analytics platform for community cytometry data analysis and collaboration</article-title><source>Current Topics in Microbiology and Immunology</source><volume>377</volume><fpage>127</fpage><lpage>157</lpage><pub-id pub-id-type="doi">10.1007/82_2014_364</pub-id><pub-id pub-id-type="pmid">24590675</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Crowell</surname> <given-names>H</given-names></name><name><surname>Chevrier</surname> <given-names>S</given-names></name><name><surname>Robinson</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2020">2020</year><source>CATALYST: Cytometry dATa anALYSis Tools</source><ext-link ext-link-type="uri" xlink:href="https://github.com/HelenaLC/CATALYST">https://github.com/HelenaLC/CATALYST</ext-link></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Davis</surname> <given-names>MM</given-names></name><name><surname>Tato</surname> <given-names>CM</given-names></name><name><surname>Furman</surname> <given-names>D</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Systems immunology: just getting started</article-title><source>Nature Immunology</source><volume>18</volume><fpage>725</fpage><lpage>732</lpage><pub-id pub-id-type="doi">10.1038/ni.3768</pub-id><pub-id pub-id-type="pmid">28632713</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Diggins</surname> <given-names>KE</given-names></name><name><surname>Ferrell</surname> <given-names>PB</given-names></name><name><surname>Irish</surname> <given-names>JM</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Methods for discovery and characterization of cell subsets in high dimensional mass cytometry data</article-title><source>Methods</source><volume>82</volume><fpage>55</fpage><lpage>63</lpage><pub-id pub-id-type="doi">10.1016/j.ymeth.2015.05.008</pub-id><pub-id pub-id-type="pmid">25979346</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>DiGiuseppe</surname> <given-names>JA</given-names></name><name><surname>Cardinali</surname> <given-names>JL</given-names></name><name><surname>Rezuke</surname> <given-names>WN</given-names></name><name><surname>Pe'er</surname> <given-names>D</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>PhenoGraph and viSNE facilitate the identification of abnormal T-cell populations in routine clinical flow cytometric data</article-title><source>Cytometry Part B: Clinical Cytometry</source><volume>94</volume><fpage>744</fpage><lpage>757</lpage><pub-id pub-id-type="doi">10.1002/cyto.b.21588</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Evrard</surname> <given-names>D</given-names></name><name><surname>Szturz</surname> <given-names>P</given-names></name><name><surname>Tijeras-Raballand</surname> <given-names>A</given-names></name><name><surname>Astorgues-Xerri</surname> <given-names>L</given-names></name><name><surname>Abitbol</surname> <given-names>C</given-names></name><name><surname>Paradis</surname> <given-names>V</given-names></name><name><surname>Raymond</surname> <given-names>E</given-names></name><name><surname>Albert</surname> <given-names>S</given-names></name><name><surname>Barry</surname> <given-names>B</given-names></name><name><surname>Faivre</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Macrophages in the microenvironment of head and neck Cancer: potential targets for Cancer therapy</article-title><source>Oral Oncology</source><volume>88</volume><fpage>29</fpage><lpage>38</lpage><pub-id pub-id-type="doi">10.1016/j.oraloncology.2018.10.040</pub-id><pub-id pub-id-type="pmid">30616794</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Finak</surname> <given-names>G</given-names></name><name><surname>Frelinger</surname> <given-names>J</given-names></name><name><surname>Jiang</surname> <given-names>W</given-names></name><name><surname>Newell</surname> <given-names>EW</given-names></name><name><surname>Ramey</surname> <given-names>J</given-names></name><name><surname>Davis</surname> <given-names>MM</given-names></name><name><surname>Kalams</surname> <given-names>SA</given-names></name><name><surname>De Rosa</surname> <given-names>SC</given-names></name><name><surname>Gottardo</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>OpenCyto: an open source infrastructure for scalable, robust, reproducible, and automated, end-to-end flow cytometry data analysis</article-title><source>PLOS Computational Biology</source><volume>10</volume><elocation-id>e1003806</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1003806</pub-id><pub-id pub-id-type="pmid">25167361</pub-id></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gingele</surname> <given-names>S</given-names></name><name><surname>Skripuletz</surname> <given-names>T</given-names></name><name><surname>Jacobs</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Role of CD20(+) T cells in multiple sclerosis: implications for treatment with ocrelizumab</article-title><source>Neural Regeneration Research</source><volume>15</volume><fpage>663</fpage><lpage>664</lpage><pub-id pub-id-type="doi">10.4103/1673-5374.266913</pub-id><pub-id pub-id-type="pmid">31638088</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Hammill</surname> <given-names>D</given-names></name></person-group><year iso-8601-date="2020">2020</year><source>CytoExploreR: Interactive Analysis of Cytometry Data</source></element-citation></ref><ref id="bib19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hartmann</surname> <given-names>FJ</given-names></name><name><surname>Babdor</surname> <given-names>J</given-names></name><name><surname>Gherardini</surname> <given-names>PF</given-names></name><name><surname>Amir</surname> <given-names>ED</given-names></name><name><surname>Jones</surname> <given-names>K</given-names></name><name><surname>Sahaf</surname> <given-names>B</given-names></name><name><surname>Marquez</surname> <given-names>DM</given-names></name><name><surname>Krutzik</surname> <given-names>P</given-names></name><name><surname>O'Donnell</surname> <given-names>E</given-names></name><name><surname>Sigal</surname> <given-names>N</given-names></name><name><surname>Maecker</surname> <given-names>HT</given-names></name><name><surname>Meyer</surname> <given-names>E</given-names></name><name><surname>Spitzer</surname> <given-names>MH</given-names></name><name><surname>Bendall</surname> <given-names>SC</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Comprehensive immune monitoring of clinical trials to advance human immunotherapy</article-title><source>Cell Reports</source><volume>28</volume><fpage>819</fpage><lpage>831</lpage><pub-id pub-id-type="doi">10.1016/j.celrep.2019.06.049</pub-id><pub-id pub-id-type="pmid">31315057</pub-id></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hernandez</surname> <given-names>C</given-names></name><name><surname>Arasanz</surname> <given-names>H</given-names></name><name><surname>Chocarro</surname> <given-names>L</given-names></name><name><surname>Bocanegra</surname> <given-names>A</given-names></name><name><surname>Zuazo</surname> <given-names>M</given-names></name><name><surname>Fernandez-Hinojal</surname> <given-names>G</given-names></name><name><surname>Blanco</surname> <given-names>E</given-names></name><name><surname>Vera</surname> <given-names>R</given-names></name><name><surname>Escors</surname> <given-names>D</given-names></name><name><surname>Kochan</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Systemic blood immune cell populations as biomarkers for the outcome of immune checkpoint inhibitor therapies</article-title><source>International Journal of Molecular Sciences</source><volume>21</volume><elocation-id>2411</elocation-id><pub-id pub-id-type="doi">10.3390/ijms21072411</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hladíková</surname> <given-names>K</given-names></name><name><surname>Koucký</surname> <given-names>V</given-names></name><name><surname>Bouček</surname> <given-names>J</given-names></name><name><surname>Laco</surname> <given-names>J</given-names></name><name><surname>Grega</surname> <given-names>M</given-names></name><name><surname>Hodek</surname> <given-names>M</given-names></name><name><surname>Zábrodský</surname> <given-names>M</given-names></name><name><surname>Vošmik</surname> <given-names>M</given-names></name><name><surname>Rozkošová</surname> <given-names>K</given-names></name><name><surname>Vošmiková</surname> <given-names>H</given-names></name><name><surname>Čelakovský</surname> <given-names>P</given-names></name><name><surname>Chrobok</surname> <given-names>V</given-names></name><name><surname>Ryška</surname> <given-names>A</given-names></name><name><surname>Špíšek</surname> <given-names>R</given-names></name><name><surname>Fialová</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Tumor-infiltrating B cells affect the progression of oropharyngeal squamous cell carcinoma via cell-to-cell interactions with CD8<sup>+</sup> T cells</article-title><source>Journal for ImmunoTherapy of Cancer</source><volume>7</volume><elocation-id>261</elocation-id><pub-id pub-id-type="doi">10.1186/s40425-019-0726-6</pub-id><pub-id pub-id-type="pmid">31623665</pub-id></element-citation></ref><ref id="bib22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kordasti</surname> <given-names>S</given-names></name><name><surname>Costantini</surname> <given-names>B</given-names></name><name><surname>Seidl</surname> <given-names>T</given-names></name><name><surname>Perez Abellan</surname> <given-names>P</given-names></name><name><surname>Martinez Llordella</surname> <given-names>M</given-names></name><name><surname>McLornan</surname> <given-names>D</given-names></name><name><surname>Diggins</surname> <given-names>KE</given-names></name><name><surname>Kulasekararaj</surname> <given-names>A</given-names></name><name><surname>Benfatto</surname> <given-names>C</given-names></name><name><surname>Feng</surname> <given-names>X</given-names></name><name><surname>Smith</surname> <given-names>A</given-names></name><name><surname>Mian</surname> <given-names>SA</given-names></name><name><surname>Melchiotti</surname> <given-names>R</given-names></name><name><surname>de Rinaldis</surname> <given-names>E</given-names></name><name><surname>Ellis</surname> <given-names>R</given-names></name><name><surname>Petrov</surname> <given-names>N</given-names></name><name><surname>Povoleri</surname> <given-names>GA</given-names></name><name><surname>Chung</surname> <given-names>SS</given-names></name><name><surname>Thomas</surname> <given-names>NS</given-names></name><name><surname>Farzaneh</surname> <given-names>F</given-names></name><name><surname>Irish</surname> <given-names>JM</given-names></name><name><surname>Heck</surname> <given-names>S</given-names></name><name><surname>Young</surname> <given-names>NS</given-names></name><name><surname>Marsh</surname> <given-names>JC</given-names></name><name><surname>Mufti</surname> <given-names>GJ</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Deep phenotyping of tregs identifies an immune signature for idiopathic aplastic Anemia and predicts response to treatment</article-title><source>Blood</source><volume>128</volume><fpage>1193</fpage><lpage>1205</lpage><pub-id pub-id-type="doi">10.1182/blood-2016-03-703702</pub-id><pub-id pub-id-type="pmid">27281795</pub-id></element-citation></ref><ref id="bib23"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Krijthe</surname> <given-names>J</given-names></name></person-group><year iso-8601-date="2018">2018</year><source>Rtsne</source><ext-link ext-link-type="uri" xlink:href="https://github.com/jkrijthe/Rtsne">https://github.com/jkrijthe/Rtsne</ext-link></element-citation></ref><ref id="bib24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Laurens van der</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Accelerating t-SNE using Tree-Based algorithms</article-title><source>Journal of Machine Learning Research</source><volume>15</volume><fpage>3221</fpage><lpage>3245</lpage></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Levine</surname> <given-names>JH</given-names></name><name><surname>Simonds</surname> <given-names>EF</given-names></name><name><surname>Bendall</surname> <given-names>SC</given-names></name><name><surname>Davis</surname> <given-names>KL</given-names></name><name><surname>Amir</surname> <given-names>AD</given-names></name><name><surname>Tadmor</surname> <given-names>MD</given-names></name><name><surname>Litvin</surname> <given-names>O</given-names></name><name><surname>Fienberg</surname> <given-names>HG</given-names></name><name><surname>Jager</surname> <given-names>A</given-names></name><name><surname>Zunder</surname> <given-names>ER</given-names></name><name><surname>Finck</surname> <given-names>R</given-names></name><name><surname>Gedman</surname> <given-names>AL</given-names></name><name><surname>Radtke</surname> <given-names>I</given-names></name><name><surname>Downing</surname> <given-names>JR</given-names></name><name><surname>Pe'er</surname> <given-names>D</given-names></name><name><surname>Nolan</surname> <given-names>GP</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Data-Driven phenotypic dissection of AML reveals Progenitor-like cells that correlate with prognosis</article-title><source>Cell</source><volume>162</volume><fpage>184</fpage><lpage>197</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2015.05.047</pub-id><pub-id pub-id-type="pmid">26095251</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Lun</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2017">2017</year><source>SingleCellExperiment: S4 Classes for Single Cell Data</source></element-citation></ref><ref id="bib27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lun</surname> <given-names>ATL</given-names></name><name><surname>Richard</surname> <given-names>AC</given-names></name><name><surname>Marioni</surname> <given-names>JC</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Testing for differential abundance in mass cytometry data</article-title><source>Nature Methods</source><volume>14</volume><fpage>707</fpage><lpage>709</lpage><pub-id pub-id-type="doi">10.1038/nmeth.4295</pub-id><pub-id pub-id-type="pmid">28504682</pub-id></element-citation></ref><ref id="bib28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Newell</surname> <given-names>EW</given-names></name><name><surname>Cheng</surname> <given-names>Y</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Mass cytometry: blessed with the curse of dimensionality</article-title><source>Nature Immunology</source><volume>17</volume><fpage>890</fpage><lpage>895</lpage><pub-id pub-id-type="doi">10.1038/ni.3485</pub-id><pub-id pub-id-type="pmid">27434000</pub-id></element-citation></ref><ref id="bib29"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Nowicka</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2019">2019</year><source>CyTOF Workflow: Differential Discovery in High-Throughput High-Dimensional Cytometry Datasets</source></element-citation></ref><ref id="bib30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Roederer</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2001">2001</year><article-title>Spectral compensation for flow cytometry: visualization artifacts, limitations, and caveats</article-title><source>Cytometry</source><volume>45</volume><fpage>194</fpage><lpage>205</lpage><pub-id pub-id-type="doi">10.1002/1097-0320(20011101)45:3&lt;194::AID-CYTO1163&gt;3.0.CO;2-C</pub-id><pub-id pub-id-type="pmid">11746088</pub-id></element-citation></ref><ref id="bib31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schulz</surname> <given-names>D</given-names></name><name><surname>Zanotelli</surname> <given-names>VRT</given-names></name><name><surname>Fischer</surname> <given-names>JR</given-names></name><name><surname>Schapiro</surname> <given-names>D</given-names></name><name><surname>Engler</surname> <given-names>S</given-names></name><name><surname>Lun</surname> <given-names>XK</given-names></name><name><surname>Jackson</surname> <given-names>HW</given-names></name><name><surname>Bodenmiller</surname> <given-names>B</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Simultaneous multiplexed imaging of mRNA and proteins with subcellular resolution in breast Cancer tissue samples by mass cytometry</article-title><source>Cell Systems</source><volume>6</volume><fpage>25</fpage><lpage>36</lpage><pub-id pub-id-type="doi">10.1016/j.cels.2017.12.001</pub-id><pub-id pub-id-type="pmid">29289569</pub-id></element-citation></ref><ref id="bib32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schulz</surname> <given-names>AR</given-names></name><name><surname>Mei</surname> <given-names>HE</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Surface barcoding of live PBMC for multiplexed mass cytometry</article-title><source>Methods in Molecular Biology</source><volume>1989</volume><fpage>93</fpage><lpage>108</lpage><pub-id pub-id-type="doi">10.1007/978-1-4939-9454-0_7</pub-id><pub-id pub-id-type="pmid">31077101</pub-id></element-citation></ref><ref id="bib33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Spidlen</surname> <given-names>J</given-names></name><name><surname>Breuer</surname> <given-names>K</given-names></name><name><surname>Rosenberg</surname> <given-names>C</given-names></name><name><surname>Kotecha</surname> <given-names>N</given-names></name><name><surname>Brinkman</surname> <given-names>RR</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>FlowRepository: a resource of annotated flow cytometry datasets associated with peer-reviewed publications</article-title><source>Cytometry Part A</source><volume>81A</volume><fpage>727</fpage><lpage>731</lpage><pub-id pub-id-type="doi">10.1002/cyto.a.22106</pub-id></element-citation></ref><ref id="bib34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tang</surname> <given-names>YL</given-names></name><name><surname>Zhou</surname> <given-names>Y</given-names></name><name><surname>Cheng</surname> <given-names>LL</given-names></name><name><surname>Su</surname> <given-names>YZ</given-names></name><name><surname>Wang</surname> <given-names>CB</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>BCL2/Ki-67 index predict survival in germinal center B-cell-like diffuse large B-cell lymphoma</article-title><source>Oncology Letters</source><volume>14</volume><fpage>3767</fpage><lpage>3773</lpage><pub-id pub-id-type="doi">10.3892/ol.2017.6577</pub-id><pub-id pub-id-type="pmid">28927145</pub-id></element-citation></ref><ref id="bib35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Trussart</surname> <given-names>M</given-names></name><name><surname>Teh</surname> <given-names>CE</given-names></name><name><surname>Tan</surname> <given-names>T</given-names></name><name><surname>Leong</surname> <given-names>L</given-names></name><name><surname>Gray</surname> <given-names>DH</given-names></name><name><surname>Speed</surname> <given-names>TP</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Removing unwanted variation with CytofRUV to integrate multiple CyTOF datasets</article-title><source>eLife</source><volume>9</volume><elocation-id>e59630</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.59630</pub-id><pub-id pub-id-type="pmid">32894218</pub-id></element-citation></ref><ref id="bib36"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>van der Maaten</surname> <given-names>L</given-names></name><name><surname>Hinton</surname> <given-names>GJ</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Visualizing data using t-SNE</article-title><source>Journal of Machine Learning Research</source><volume>9</volume><fpage>2579</fpage><lpage>2605</lpage></element-citation></ref><ref id="bib37"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Van Gassen</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2015">2015a</year><source>FlowSOM. Bioconductor Version: Release (3.12)</source><ext-link ext-link-type="uri" xlink:href="https://github.com/saeyslab/FlowSOM">https://github.com/saeyslab/FlowSOM</ext-link></element-citation></ref><ref id="bib38"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Van Gassen</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2015">2015b</year><article-title>FlowSOM: using self-organizing maps for visualization and interpretation of cytometry data</article-title><source>Cytometry Part A</source><volume>87</volume><fpage>636</fpage><lpage>645</lpage><pub-id pub-id-type="doi">10.1002/cyto.a.22625</pub-id></element-citation></ref><ref id="bib39"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname> <given-names>W</given-names></name><name><surname>Khoury</surname> <given-names>JD</given-names></name><name><surname>Miranda</surname> <given-names>RN</given-names></name><name><surname>Jorgensen</surname> <given-names>JL</given-names></name><name><surname>Xu</surname> <given-names>J</given-names></name><name><surname>Loghavi</surname> <given-names>S</given-names></name><name><surname>Li</surname> <given-names>S</given-names></name><name><surname>Pemmaraju</surname> <given-names>N</given-names></name><name><surname>Nguyen</surname> <given-names>T</given-names></name><name><surname>Medeiros</surname> <given-names>LJ</given-names></name><name><surname>Wang</surname> <given-names>SA</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Immunophenotypic characterization of reactive and neoplastic plasmacytoid dendritic cells permits establishment of a 10-color flow cytometric panel for initial workup and residual disease evaluation of blastic plasmacytoid dendritic cell neoplasm</article-title><source>Haematologica</source><volume>106</volume><fpage>1047</fpage><lpage>1055</lpage><pub-id pub-id-type="doi">10.3324/haematol.2020.247569</pub-id></element-citation></ref><ref id="bib40"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Weber</surname> <given-names>LM</given-names></name><name><surname>Nowicka</surname> <given-names>M</given-names></name><name><surname>Soneson</surname> <given-names>C</given-names></name><name><surname>Robinson</surname> <given-names>MD</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Diffcyt: differential discovery in high-dimensional cytometry via high-resolution clustering</article-title><source>Communications Biology</source><volume>2</volume><elocation-id>183</elocation-id><pub-id pub-id-type="doi">10.1038/s42003-019-0415-5</pub-id><pub-id pub-id-type="pmid">31098416</pub-id></element-citation></ref><ref id="bib41"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Weber</surname> <given-names>LM</given-names></name><name><surname>Robinson</surname> <given-names>MD</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Comparison of clustering methods for high-dimensional single-cell flow and mass cytometry data</article-title><source>Cytometry Part A</source><volume>89</volume><fpage>1084</fpage><lpage>1096</lpage><pub-id pub-id-type="doi">10.1002/cyto.a.23030</pub-id></element-citation></ref><ref id="bib42"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Wilkerson</surname> <given-names>M</given-names></name><name><surname>Waltman</surname> <given-names>P</given-names></name></person-group><year iso-8601-date="2013">2013</year><source>ConsensusClusterPlus: ConsensusClusterPlus</source></element-citation></ref></ref-list><app-group><app id="appendix-1"><title>Appendix 1</title><boxed-text><p>Staining protocol for a human tissue section taken from a patient with head and neck squamous cell carcinoma (HNSCC).</p><p><table-wrap id="inlinetable1" position="anchor"><table frame="hsides" rules="groups"><tbody><tr><td style="author-callout-style-b3" valign="top">Equipment</td><td style="author-callout-style-b4" valign="top">Consumables</td><td style="author-callout-style-b1" valign="top">Reagents</td><td style="author-callout-style-b1" valign="top">Reagent initial concentration</td><td style="author-callout-style-b1" valign="top">Reagent final <break/>Concentration</td></tr><tr><td style="author-callout-style-b3" valign="top">Humidified slide chamber (Sigma Aldrich, #H6644-1EA)*</td><td style="author-callout-style-b4" valign="top">Sterile 3 ml pastettes (Alpha Labs, #LW112)</td><td style="author-callout-style-b1" valign="top">DPBS, Ca, and Mg free (Gibco, #14190-094)</td><td style="author-callout-style-b1" valign="top"/><td style="author-callout-style-b1" valign="top"/></tr><tr><td style="author-callout-style-b3" valign="top">Dedicated glassware, coplin jars (Fisher, #10264732) **</td><td style="author-callout-style-b4" valign="top">Superfrost Plus slides (Fisher, #ES-325)</td><td style="author-callout-style-b1" valign="top">Tween-20 (Sigma Aldrich, #P7949-100 ml)*</td><td style="author-callout-style-b1" valign="top">100%</td><td style="author-callout-style-b1" valign="top">0.1%</td></tr><tr><td style="author-callout-style-b3" valign="top">Orbital shaker</td><td style="author-callout-style-b4" valign="top">Kimberly-Clark Precision Wipers (Fisher, #10623111)*</td><td style="author-callout-style-b1" valign="top">Antigen retrieval solution pH 9.0 <break/>(R&amp;D Systems, #CTS013)</td><td style="author-callout-style-b1" valign="top"/><td style="author-callout-style-b1" valign="top">1:10 in milli-Q water</td></tr><tr><td style="author-callout-style-b3" valign="top">Water bath</td><td style="author-callout-style-b4" valign="top">0.2 syringe filter (TripleRed, #FPE204030)</td><td style="author-callout-style-b1" valign="top">Superblock (Thermo Fisher, #37515)**</td><td style="author-callout-style-b1" valign="top"/><td style="author-callout-style-b1" valign="top"/></tr><tr><td style="author-callout-style-b3" valign="top">Fridge</td><td style="author-callout-style-b4" valign="top">50 ml syringes (Fisher, #10636531)</td><td style="author-callout-style-b1" valign="top">Iridium (Fluidigm, #201192B)***</td><td style="author-callout-style-b1" valign="top">500 µM</td><td style="author-callout-style-b1" valign="top">0.5 µM in DPBS</td></tr><tr><td style="author-callout-style-b3" valign="top">Milli-Q water purification system (18.2 MΩ.cm)</td><td style="author-callout-style-b4" valign="top">Filter pipette tips</td><td style="author-callout-style-b1" valign="top">Metal tagged antibodies (Fluidigm)</td><td style="author-callout-style-b1" valign="top"/><td style="author-callout-style-b1" valign="top">Require optimization for your tissue type</td></tr><tr><td style="author-callout-style-b3" valign="top">Hard slide box for storage in −80°C (VWR #631-1504)</td><td style="author-callout-style-b4" valign="top">PAP pen (Abcam, #ab2601)</td><td style="author-callout-style-b1" valign="top">FcR block (Trustain, Biolegend, # 422302)</td><td style="author-callout-style-b1" valign="top">100%</td><td style="author-callout-style-b1" valign="top">5%</td></tr><tr><td style="author-callout-style-b3" valign="top">Pipettes</td><td style="author-callout-style-b4" valign="top"/><td style="author-callout-style-b1" valign="top"><bold>Xylene</bold> (Acros, #180862500)</td><td style="author-callout-style-b1" valign="top"/><td style="author-callout-style-b1" valign="top"/></tr><tr><td style="author-callout-style-b3" valign="top">Plastic tweezers, to handle slides (Farlamedical, #400200)</td><td style="author-callout-style-b4" valign="top"/><td style="author-callout-style-b1" valign="top"><bold>Ethanol</bold> (Sigma Aldrich, #32221-2.5L)</td><td style="author-callout-style-b1" valign="top"/><td style="author-callout-style-b1" valign="top"/></tr><tr><td style="author-callout-style-b3" valign="top">Plastic coplin (Thermo Fisher, #E9611) <break/>****</td><td style="author-callout-style-b4" valign="top"/><td style="author-callout-style-b1" valign="top">BSA (Sigma Aldrich, #A9647)</td><td style="author-callout-style-b1" valign="top">20% <break/>To prepare on the same day freshly</td><td style="author-callout-style-b1" valign="top">10%</td></tr><tr><td style="author-callout-style-b3" valign="top"/><td style="author-callout-style-b4" valign="top"/><td style="author-callout-style-b1" valign="top">Kiovin Hu IgG <break/>Provide by Hospital’s pharmacy</td><td style="author-callout-style-b1" valign="top">10% <break/>100 mg/ml</td><td style="author-callout-style-b1" valign="top">5 mg/ml</td></tr><tr><td valign="top">* Alternatively, use a pipette tip box with moist towel at the bottom and piece of parafilm on the tray (this prevents evaporation and stops condensation gathering at the back of the slide, which can pool around edges and dilute antibodies). <break/>**Rinse in water, do not clean with detergent or in laboratory dishwasher (source of barium contamination). <break/>**** Plasticware is required for 96°C water bath, used when dedicated histological autoclave or decloaking chamber is not available; you can also use a 50 ml centrifuge tube, loosely capped (Falcon or Corning).</td><td valign="top">*Normal laboratory hand towels and blue roll are fine to tip excess buffer off slide surface or to place in the bottom of the humidified slide chamber. However, they should not be used to wipe the back of the slides or draw off excess buffer from front – as can transfer lint to the slides.</td><td valign="top">*Permeabilization can also be conducted with Triton X100 or saponin <break/>** Alternative blocking solutions include BSA, human albumin, human immunoglobulin (KIOVIG from Pharmacy), serum same species as antibodies (mouse serum, Sigma Aldrich, # M5905-10ML). <break/>*** DNA stain use alternative histone 3 <break/>antibody #3176023D.</td><td valign="top"/><td valign="top"/></tr></tbody></table></table-wrap></p><sec id="s8" sec-type="appendix"><title>STAINING PROTOCOL DAY 1: SECTION CUTTING</title><list list-type="simple"><list-item><p>Cut a 5 µm section from the block at and place in an incubation oven overnight (o/n) at 37°C.</p></list-item><list-item><p>Cut a 3 µm section for hematoxylin and eosin (H&amp;E) staining.</p></list-item></list></sec><sec id="s9" sec-type="appendix"><title>STAINING PROTOCOL DAY 2:</title><sec id="s9-1"><title>1. PREPARATION</title><list list-type="simple"><list-item><p>Prepare xylene and ethanol at 50:50 ratio ~ 50 ml of final volume.</p></list-item><list-item><p>Prepare the following ethanol dilutions, with milli-Q water: 96%, 90%, 80%, and 70% (~50 ml of final volume for each).</p></list-item><list-item><p>Dilute the 10X basic antigen retrieval buffer in milli-Q water in 50 ml falcon tube (leaving the cap loose) and heat to 96°C in a water bath.</p></list-item><list-item><p>*BSA (Sigma Aldrich, #A9647): prepare a 20% solution fresh using, 0.4 g BSA in a plastic tube. Add 1 ml of superblock solution and incubate in the water bath for 1 hr. Once it is fully dissolved, top up to 2 ml (final volume).</p></list-item><list-item><p>Prepare the wash buffer using Dulbecco’s phosphate buffered saline (DPBS) (calcium/magnesium free) and 0.1% Tween-20 (500 µl of Tween-20 [Sigma Aldrich, #P7949-100 ml] in the 500 ml DPBS bottle). Filter the wash buffer every time you use it with a 0.2 µm filter. Store at room temperature.</p></list-item></list></sec><sec id="s9-2"><title>1. Notes for wash steps</title><p>Always conduct washes in ~50 ml of buffer in coplin jars on an orbital mixer.</p><p>Never wash in laboratory dishwasher or with detergent as this can represent a source of barium contamination. Also, do not use metal slide holders or forceps.</p></sec><sec id="s9-3"><title>2. STAINING</title><list list-type="simple"><list-item><p>Heat the 1X antigen retrieval solution (1:10 dilute in milli-Q water) to 96°C in a water bath.</p></list-item><list-item><p>Heat a coplin jar and a bottle of wash buffer (0.1% Tween-20 in DPBS) to 37°C in a water bath.</p></list-item><list-item><p>Prepare the humidified slide chamber (box with a damp tissue in the bottom and lid or piece of parafilm to cover).</p></list-item><list-item><p>Prepare blocking and antibody incubation buffer fresh: 10% BSA, 0.1% Tween-20, 1/20 dilution of FcR block (Trustain, Biolegend, #422302) and 1/20 dilution of KIOVIG (Kiovin Hu IgG) in Superblock (Thermo Fisher, #37515) solution. Use Superblock to top up to final volume. Avoid mixing, filtering, or centrifugation of the Superblock buffer prior to pipetting, let solution settle at 4°C and pipette from top of the solution to avoid any aggregate material (that will have sunk to the bottom).</p></list-item></list><list list-type="simple"><list-item><p>Conduct xylene washes in a safety cabinet.</p></list-item><list-item><p>Use separate coplin jars.</p></list-item><list-item><p>The xylene should be changed regularly, especially the first coplin jar in the sequence, which will have the most wax dissolved in it (readily become cloudy and less efficient).</p></list-item></list></sec><sec id="s9-4"><title>1. CLEAR WAX FROM SLIDES (you sequentially remove the wax, with each wash in fresh xylene)</title><list list-type="simple"><list-item><p>Incubate slide 1 hr at 60°C.</p></list-item><list-item><p>Agitate slides (up and down motion) by hand, three washes at RT:</p></list-item><list-item><p>Xylene 100% for 5 min.</p></list-item><list-item><p>Xylene 100% for 5 min.</p></list-item><list-item><p>50:50 xylene:ethanol mix for 10 min.</p></list-item></list></sec><sec id="s9-5"><title>1. REHYDRATE TISSUE (outside hood, use plastic tweezers)</title><list list-type="simple"><list-item><p>Remove slides from xylene:ethanol mix in the hood, transfer to 100% ethanol for 5 min, and remove from cabinet.</p></list-item><list-item><p>Transfer slides to 90% ethanol – mix on orbital shaker for 5 min.</p></list-item><list-item><p>Transfer slides to 80% ethanol – mix on orbital shaker for 5 min.</p></list-item><list-item><p>Transfer slides to 70% ethanol – mix on orbital shaker for 5 min.</p></list-item><list-item><p>Remove slides and transfer to DPBS – mix orbital shaker for 10 min.</p></list-item><list-item><p>Slide can stay in DPBS until the antigen retrieval solution is ready.</p></list-item></list></sec><sec id="s9-6"><title>RETRIEVE ANTIGEN</title><p>Fluidigm have validated all their FFPE antibodies using 30 min antigen retrieval, with basic buffer, in a 96°C water bath.</p><list list-type="simple"><list-item><p>Heat 1X antigen retrieval solution to 96°C in the water bath (in plastic coplin jar or closed falcon 50 ml centrifuge tube).</p></list-item><list-item><p>When the slides are added, the temperature may drop – do not start the timer until the probe indicates the temperature in the tube has returned to 96°C.</p></list-item><list-item><p>Incubate slides in 1X antigen retrieval solution to 96°C in the water bath (in closed 50 ml falcon centrifuge tube) and incubate for 30 min.</p></list-item><list-item><p>Cool down closed 50 ml falcon tube to around RT under cold running water.</p></list-item><list-item><p>Transfer slides to DPBS and wash on orbital shaker for 5 min.</p></list-item><list-item><p>Dry slides with tissue wipers (Thermo Fisher) and leave to dry for 10 s.</p></list-item><list-item><p>Draw a wax ring around the tissue.</p></list-item><list-item><p>Wash twice with filtered wash buffer (0.1% Tween-20) in DPBS on the orbital shaker for 8 min. Filter it every time you use the wash buffer with 0.2 µm filter and store at RT.</p></list-item><list-item><p>Leave slides in the wash buffer until the block solution is ready.</p></list-item></list></sec><sec id="s9-7"><title>1. BLOCK</title><list list-type="simple"><list-item><p>While sections are in permeabilization buffer (0.1% Tween-20), prepare sufficient blocking buffer to cover the tissue, within the wax ring.</p></list-item><list-item><p>For a very small diameter wax ring, 50 µl will suffice; however, a large piece of tissue (&gt;1 cm diameter) will require ~250 µl.</p></list-item></list><p><table-wrap id="inlinetable2" position="anchor"><table frame="hsides" rules="groups"><thead><tr><th colspan="7" valign="top">Blocking buffer preparation</th></tr><tr><th valign="top">Solution</th><th valign="top">Dilute in</th><th valign="top">Initial concentration</th><th valign="top">Final <break/>concentration</th><th valign="top">Dilution <break/>factor</th><th valign="top">Per 100 µl</th><th valign="top">Per <break/>300 µl</th></tr></thead><tbody><tr><td valign="top"><bold>Tween-20</bold> (Sigma Aldrich, #P7949-100 ml)</td><td valign="top">Superblock solution</td><td valign="top">Prepared first at 10% <break/>Then at 1%</td><td valign="top">0.1%</td><td valign="top">10</td><td valign="top">10</td><td valign="top">30</td></tr><tr><td valign="top"><bold>Kiovin Hu IgG</bold></td><td valign="top">Superblock solution</td><td valign="top">10% <break/>100 mg/ml</td><td valign="top">5 mg/ml</td><td valign="top">20</td><td valign="top">5</td><td valign="top">15</td></tr><tr><td valign="top"><bold>FcR block</bold> (Trustain, Biolegend, # 422302)</td><td valign="top">Superblock solution</td><td valign="top">100%</td><td valign="top">5% (1/20)</td><td valign="top">20</td><td valign="top">5</td><td valign="top">15</td></tr><tr><td valign="top"><bold>BSA</bold> (Sigma Aldrich, #A9647)</td><td valign="top">Superblock solution</td><td valign="top">20% <break/>(10 g in 100 ml = 10%)</td><td valign="top">10%</td><td valign="top">2</td><td valign="top">50</td><td valign="top">150</td></tr><tr><td valign="top"><bold>Superblock</bold> (Thermo Fisher, #37515)</td><td colspan="3" valign="top">To top up <break/>Until your final volume</td><td valign="top"/><td valign="top">30</td><td valign="top">90</td></tr></tbody></table></table-wrap></p><p>When you add the buffer to the inside of the wax circle, it should be contained and fully cover the tissue.</p><list list-type="simple"><list-item><p>Remove slides from DPBS and remove excess buffer by tipping slide.</p></list-item><list-item><p>Use a lint-free tissue to dry the back of the slide thoroughly and to gently draw excess buffer away from the front, without touching the tissue or wax ring.</p></list-item><list-item><p>Transfer to humidified box, cover tissue with blocking buffer.</p></list-item><list-item><p>Incubate at RT for 90 min.</p></list-item></list></sec><sec id="s9-8"><title>1. PREPARE ANTIBODY MIX AND INCUBATE</title><p><table-wrap id="inlinetable3" position="anchor"><table frame="hsides" rules="groups"><thead><tr><th colspan="7" valign="top">Antibody mix</th></tr><tr><th valign="top">Cat#</th><th valign="top">Supplier</th><th valign="top">Tag</th><th valign="top">Target/ <break/>solution</th><th valign="top">Dil factor <break/>(1:X)</th><th valign="top">Initial concentration</th><th valign="top">Final concentration</th></tr></thead><tbody><tr><td valign="top">3170019D</td><td valign="top">Fluidigm</td><td valign="top">170</td><td valign="top">CD3 (polyclonal, C-terminal)</td><td valign="top">400</td><td valign="top"/><td valign="top"/></tr><tr><td valign="top">3156033D</td><td valign="top">Fluidigm</td><td valign="top">156</td><td valign="top">CD4</td><td valign="top">100</td><td valign="top"/><td valign="top"/></tr><tr><td valign="top">3152016D</td><td valign="top">Fluidigm</td><td valign="top">152</td><td valign="top">CD45</td><td valign="top">1000</td><td valign="top"/><td valign="top"/></tr><tr><td valign="top">3162035D</td><td valign="top">Fluidigm</td><td valign="top">162</td><td valign="top">CD8-alpha</td><td valign="top">800</td><td valign="top"/><td valign="top"/></tr><tr><td valign="top">3161029D</td><td valign="top">Fluidigm</td><td valign="top">161</td><td valign="top">CD20</td><td valign="top">250</td><td valign="top"/><td valign="top"/></tr><tr><td valign="top">MAB1561</td><td valign="top">R&amp;D Systems</td><td valign="top">150</td><td valign="top">PD-L1</td><td valign="top">50</td><td valign="top"/><td valign="top"/></tr><tr><td valign="top">3158029D</td><td valign="top">Fluidigm</td><td valign="top">158</td><td valign="top">E-cadherin</td><td valign="top">1000</td><td valign="top"/><td valign="top"/></tr><tr><td valign="top">3159035D</td><td valign="top">Fluidigm</td><td valign="top">159</td><td valign="top">CD68</td><td valign="top">400</td><td valign="top"/><td valign="top"/></tr><tr><td valign="top">3165039D</td><td valign="top">Fluidigm</td><td valign="top">165</td><td valign="top">PD-1</td><td valign="top">50</td><td valign="top"/><td valign="top"/></tr><tr><td valign="top">3168022D</td><td valign="top">Fluidigm</td><td valign="top">168</td><td valign="top">Ki-67</td><td valign="top">400</td><td valign="top"/><td valign="top"/></tr><tr><td valign="top">#A9647</td><td valign="top">Sigma Aldrich</td><td valign="top"/><td valign="top">BSA <break/>Prepare fresh</td><td valign="top">2</td><td valign="top">20%</td><td valign="top">10%</td></tr><tr><td valign="top">#422302</td><td valign="top">Biolegend</td><td valign="top"/><td valign="top">FCR</td><td valign="top">20</td><td valign="top">100%</td><td valign="top">5%</td></tr><tr><td valign="top"/><td valign="top">Provided by hospital’s pharmacy</td><td valign="top"/><td valign="top">IgG Hu Kiovig</td><td valign="top">20</td><td valign="top">100 mg/ml</td><td valign="top">5 mg/ml</td></tr><tr><td valign="top">#P7949</td><td valign="top">Sigma Aldrich</td><td valign="top"/><td valign="top">Tween-20</td><td valign="top">10</td><td valign="top">1%</td><td valign="top">0.1%</td></tr><tr><td valign="top">#37515</td><td valign="top">Thermo Fisher</td><td valign="top"/><td valign="top">Superblock</td><td colspan="3" valign="top">To top up to the required volume</td></tr></tbody></table></table-wrap></p><p>You will require the same volume of antibody mix used for blocking solution and tip off excess blocking buffer onto tissue paper.</p><p>Use a lint-free tissue to dry the back of the slide thoroughly and to gently draw excess buffer away from the front, without touching the tissue or wax ring.</p><p>Incubate slide o/n with antibody mix at 4°C in humidified chamber.</p></sec></sec><sec id="s10" sec-type="appendix"><title>STAINING PROTOCOL DAY 3</title><sec id="s10-1"><title>1. WASH IN PERMEABLIZATION BUFFER</title><list list-type="simple"><list-item><p>Tip off the antibody mix onto tissue paper.</p></list-item><list-item><p>Flush the slide surface gently but thoroughly with a pastette and permeabilization buffer (DPBS with added 0.1% Tween-20) at RT.</p></list-item><list-item><p>Wash in the same RT buffer ~50 ml in coplin jar on the mixer for 8 min.</p></list-item><list-item><p>Repeat wash step for another 8 min.</p></list-item></list></sec><sec id="s10-2"><title>1. WASH IN DPBS</title><list list-type="simple"><list-item><p>In the same jar, decant 0.1% Tween-20 DPBS wash buffer and add further wash buffer at RT and then place on the mixer for 8 min.</p></list-item><list-item><p>Repeat wash step for another 8 min.</p></list-item></list></sec><sec id="s10-3"><title>1. DNA STAIN</title><p>For initial testing, prepare iridium (Fluidigm) in DPBS at a final concentration of 0.5 µM (may require some optimization for your tissue type).</p><p>Dilute 125 µM iridium stock (Fluidigm 201192A) 1/250 with DPBS.</p><list list-type="simple"><list-item><p>Tip off excess DPBS onto tissue paper.</p></list-item><list-item><p>Use a lint-free tissue to dry the back of the slide thoroughly and to gently draw excess buffer away from the front, without touching the tissue or wax ring.</p></list-item><list-item><p>Place slide in humidified chamber and load iridium solution into the wax ring so that it covers the tissue.</p></list-item><list-item><p>Incubate at RT for 30 min.</p></list-item><list-item><p>Flush the slide surface thoroughly with RT DPBS gently using a pastette.</p></list-item><list-item><p>Wash in RT DPBS on the mixer for 5 min.</p></list-item><list-item><p>Wash in milli-Q water ~50 ml in a clean coplin jar on the mixer for 5 min.</p></list-item><list-item><p>Air dry.</p></list-item></list><p>Slides can be stored for several months at RT in a cool, dry, dust-free storage container.</p></sec></sec></boxed-text></app><app id="appendix-2"><title>Appendix 2</title><boxed-text><sec id="s11" sec-type="appendix"><title>Protocol for sectioning and staining of diffuse large B-cell lymphoma lymph node section</title><list list-type="order"><list-item><p>A 5 μm tissue section was deparaffinized with xylene and sequentially rehydrated in graded ethanol. Heat-induced antigen retrieval was performed in an automated pressure cooker (Menapath Antigen Access Unit, Menarini) at 125°C for 2 min in Antigen Retrieval Reagent-Basic (R&amp;D Systems).</p></list-item><list-item><p>The tissue was then permeabilized with DPBS, 0.1% Tween-20 for 15 min, and blocked with Superblock (Thermo Fisher Scientific), 0.1% Tween-20, Fc Receptor Blocking solution (1:20; Biolegend; blocking buffer) for 2 hr at RT.</p></list-item><list-item><p>Antibodies were diluted together according to <xref ref-type="supplementary-material" rid="supp3">Supplementary file 3</xref> in blocking buffer and applied to the tissue overnight at 4°C.</p></list-item><list-item><p>After washing, the slide was incubated with the DNA intercalator (Cell-ID Intercalator-Ir, Fluidigm) for 30 min at RT.</p></list-item><list-item><p>The slide was then briefly washed with milli-Q water and air dried.</p></list-item><list-item><p>Acquisition of 1 mm<sup>2</sup> tissue region was carried out using the Hyperion imaging system (Fluidigm) at 200 Hz, with a resolution of 1 μm/pixel.</p></list-item></list></sec></boxed-text></app></app-group></back><sub-article article-type="decision-letter" id="sa1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.62915.sa1</article-id><title-group><article-title>Decision letter</article-title></title-group><contrib-group><contrib contrib-type="editor"><name><surname>Yona</surname><given-names>Simon</given-names></name><role>Reviewing Editor</role><aff><institution>The Hebrew University of Jerusalem</institution><country>Israel</country></aff></contrib></contrib-group><contrib-group><contrib contrib-type="reviewer"><name><surname>Newell</surname><given-names>Evan W</given-names></name><role>Reviewer</role><aff><institution>Fred Hutchinson Cancer Research Center</institution><country>United States</country></aff></contrib></contrib-group></front-stub><body><boxed-text><p>In the interests of transparency, eLife publishes the most substantive revision requests and the accompanying author responses.</p></boxed-text><p><bold>Acceptance summary:</bold></p><p>The revised manuscript now has a clearer analysis workflow. <italic>ImmunoCluster</italic> is a user-friendly pipeline R package for the analysis of flow and mass cytometry experiments and for imaging mass cytometry. We hope this provides non-computational immunologists with an opportunity to use dimensionality reduction, unsupervised clustering and differential expression/abundance analyses.</p><p><bold>Decision letter after peer review:</bold></p><p>Thank you for submitting your article &quot;ImmunoCluster: A computational framework for the non-specialist to profile cellular heterogeneity in cytometry datasets&quot; for consideration by <italic>eLife</italic>. Your article has been reviewed by 2 peer reviewers, and the evaluation has been overseen by a Reviewing Editor and Tadatsugu Taniguchi as the Senior Editor. The following individual involved in the review of your submission has agreed to reveal their identity: Evan W Newell (Reviewer #3).</p><p>The reviewers have discussed the reviews with one another and the Reviewing Editor has drafted this decision to help you prepare a revised submission.</p><p>As the editors have judged that your manuscript is of interest, but as described below that additional experiments are required before it is published, we would like to draw your attention to changes in our revision policy that we have made in response to COVID-19 (https://elifesciences.org/articles/57162). First, because many researchers have temporarily lost access to the labs, we will give authors as much time as they need to submit revised manuscripts. We are also offering, if you choose, to post the manuscript to bioRxiv (if it is not already there) along with this decision letter and a formal designation that the manuscript is &quot;in revision at <italic>eLife</italic>&quot;. Please let us know if you would like to pursue this option. (If your work is more suitable for medRxiv, you will need to post the preprint yourself, as the mechanisms for us to do so are still in development.)</p><p>The authors propose ImmunoCluster, a user-friendly pipeline R package for the analysis of flow and mass cytometry experiments and for imaging mass cytometry. The claim is that this approach and package is easy to use for non-computational immunologists and facilitates dimensionality reduction, unsupervised clustering, and differential expression/abundance analyses.</p><p>While this software is useful, the examples provided are good, there is very little/no novelty in the approach provided. The reviewers main concern is that the paper in its current form does not propose any new methodology with regards to clustering, visualization, or differential analysis. It was felt that the paper in its current form combines existing methodology in a user-friendly way that could indeed be important for biologists. In addition, the paper should acknowledge similar packages that already exist (eg CytofKit https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1005112).</p><p>The combined reviewers' comments can be found below. For this manuscript to merit further consideration at <italic>eLife</italic>, clearer descriptions of ease of use of <italic>Immunocluster</italic> compared to other methods and other distinguishing features should be better highlighted and additional benchmarking comparisons.</p><p>Summary:</p><p>This tool enables advances but other tools already available that are sufficient and therefore the authors will need to convince a large portion of the researcher to use this tool, better comparisons should be provided to help in answering this question and then also better convince readers to use this software.</p><p>Essential revisions:</p><p>The authors note that several other similar packages influenced the development of <italic>ImmunoCluster</italic> (Refs 13-16) but it is unclear what makes this package novel. For instance, how does this workflow compare to other packages such as CATALYST (referenced by the authors) for quantifying cell cluster abundances and assessment of differential composition, which has been used in various ways in several publications (Crowell et al. F1000Res. 2020 [this one is new so not yet possible to have referenced], Weber et al., Communications Biology 2019, Nowicka et al., F1000Res. 2017, and related Fonseka et al. Sci. Trans. Med. 2018)? With regards to the differential abundance testing, there has been some excellent work in recent years, including DiffCyt (https://www.nature.com/articles/s42003-019-0415-5) and Cydar (https://pubmed.ncbi.nlm.nih.gov/28504682/). These methods among others seem to be the state-of-the-art in differential abundance analysis. How do your differential analysis results compare to these others, for example? Can you implement these methods in your pipeline?</p><p>The authors mention that the pipeline can accommodate millions of cells. Is this the case for all the clustering and visualization steps, or do you require downsampling? It would be helpful to see an analysis of run-time/details of the computer used to analyse the data. It appears the clustering methods implemented here (phenograph for example) might not work well if there are millions of cells across multiple samples.</p><p>In the MDS plots of samples (see Figure 3A), it is unclear what features are used to project the samples. Could you please elaborate on this point?</p><p>Does this current approach have any means for assessing or correcting for batch effects within the datasets? The authors only mention sample barcoding as an experimental plan to reduce batch effects, but fail to mention of any strategy to assess or correct for batch effects, which is a very important consideration that should be addressed.</p><p>Similarly, although channel spillover and differences in cell numbers were mentioned, no means were provided to assess or rectify these effects using the approach described.</p></body></sub-article><sub-article article-type="reply" id="sa2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.62915.sa2</article-id><title-group><article-title>Author response</article-title></title-group></front-stub><body><disp-quote content-type="editor-comment"><p>Essential revisions:</p><p>The authors note that several other similar packages influenced the development of ImmunoCluster (Refs 13-16) but it is unclear what makes this package novel. For instance, how does this workflow compare to other packages such as CATALYST (referenced by the authors) for quantifying cell cluster abundances and assessment of differential composition, which has been used in various ways in several publications (Crowell et al. F1000Res. 2020 [this one is new so not yet possible to have referenced], Weber et al., Communications Biology 2019, Nowicka et al., F1000Res. 2017, and related Fonseka et al. Sci. Trans. Med. 2018)? With regards to the differential abundance testing, there has been some excellent work in recent years, including DiffCyt (https://www.nature.com/articles/s42003-019-0415-5) and Cydar (https://pubmed.ncbi.nlm.nih.gov/28504682/). These methods among others seem to be the state-of-the-art in differential abundance analysis. How do your differential analysis results compare to these others, for example? Can you implement these methods in your pipeline?</p></disp-quote><p>We thank the reviewers for their comments. We have highlighted and discussed below where we have made revisions to address the comments raised. In response, we have added a new paragraph to the introduction that describes frameworks which influenced the development of <italic>ImmunoCluster</italic> and provide comparisons with other available frameworks, e.g. <italic><bold>CATALYST</bold></italic>. We use this discussion to highlight and more clearly emphasize the unique aspects provided by the <italic>ImmunoCluster</italic> framework, such as the easily interpreted imaging mass cytometry data analysis, customizable figure outputs, and adaptive down-sampling. Each discussed in detail in the manuscript and below. We hope that these comparisons now more clearly define <italic>ImmunoCluster</italic>’s niche in this area.</p><p><bold>Influential packages and comparison with other available frameworks</bold></p><p>Lines 47-54: “<bold>A number of previous computational cytometry workflows have been proposed, including <italic>CyTOF workflow</italic> [1], Diggins et al.[2] and <italic>CapX</italic>[3]. […] We have therefore developed <italic>ImmunoCluster,</italic> building on and extending the framework proposed in the <italic>CyTOF workflow</italic>[1] to create modular, flexible and easy-to-use implementations of cytometry analysis pipelines.”</bold></p><p>Lines 76-92: <bold>“<italic>ImmunoCluster</italic> also contains functionality foradaptive down-sampling at the import and dimensionality reduction stages of the pipeline to overcome significant increases in runtime associated with large datasets in dimensionality reduction algorithms like UMAP and tSNE.[…] M</bold>ethods for analyzing large cytometry datasets, in particular IMC datasets, in an open-source computational environment are currently limited.”</p><p><bold>Additional advantages</bold></p><p>We would also like to highlight below some of the key novel aspects of <italic>ImmunoCluster</italic> which are now emphasized within the manuscript.</p><p>Easily interpreted imaging mass cytometry data analysis: <italic>ImmunoCluster</italic> pipeline has the ability to carry out downstream imaging mass cytometry (IMC) data analysis. This allows users to run IMC data in line with flow cytometry (FC) and liquid mass cytometry (LMC) data analyses. Due to the lower resolution of IMC data (compared with FC and LMC) we specifically designed the ‘ranked expression heatmap’ function to work with IMC data, which allows users to rank markers measured to help identify cell populations. Presented in Figures 4 and 5.</p><p>lines 85-92: “<bold>Importantly, and unique to <italic>ImmunoCluster</italic>, the scope of functionality in this package also enables the analysis of IMC data. […] M</bold>ethods for analyzing large cytometry datasets, in particular IMC datasets, in an open-source computational environment are currently limited.”</p><p>Customizable figure outputs: In addition to the section mentioned above we have provided a new Supplementary Figure (Figure 1—figure supplement 1) to showcase our user-friendly ‘customizable figure outputs ’, detailing a variety of tailor-made figures produced by <italic>ImmunoCluster</italic>. We offer flexibility throughout the framework; researchers can easily adapt all figures and outputs to suit their specific needs. <bold>The outputs from <italic>ImmunoCluster</italic> are created using the <italic>ggplot</italic> package which generates <italic>ggplot</italic> graphical objects that are flexible and easily modified</bold>, resulting in an abundance of tailored outputs for the user to assess and use in reports, presentations, and publications. One example is the outputs a user can create from the dimensionality reduced data (e.g. UMAP algorithm). Users can project marker expression onto UMAP plots to help visually identify the cell types represented in the islands. The density of cells in each island can also be visualized using a density plot function. After clustering (e.g. FlowSOM), clusters can be projected onto the UMAP plot, the number of clusters can be easily changed so users can visually inspect different total number of clusters. Once users have assigned cell types, these can also be projected onto the UMAP plot and help users visually inspect their cluster assignments. Furthermore, researchers can use the metadata to colour and split the UMAP plots, allowing users to identify which cell islands are present in certain conditions or at particular time points (Figure 1—figure supplement 1).</p><p><bold>Lines 107-111: “<italic>ImmunoCluster</italic></bold> also offers user-friendly flexibility throughout the framework, researchers can easily adapt all figures and outputs to suit their specific needs resulting in an abundance of tailored outputs for the user to assess and use in publications, reports and presentations. An example detailing a variety of tailor-made figures produced by <italic>ImmunoCluster</italic> can be found in Figure 1—figure supplement 1.”</p><p>Adaptive down-sampling: <italic>ImmunoCluster</italic> also contains functionality for adaptive down-sampling at the import and dimensionality reduction stages of the pipeline to overcome significant increases in runtime associated with large datasets in dimensionality reduction algorithms like UMAP and tSNE.</p><p>Lines 76-78: “<bold><italic>ImmunoCluster</italic> also contains functionality for adaptive down-sampling at the import and dimensionality reduction stages of the pipeline to overcome significant increases in runtime associated with large datasets in dimensionality reduction algorithms like UMAP and tSNE.”</bold></p><p><bold>Differential abundance testing</bold></p><p>The <italic>ImmunoClusterstat_test_clust</italic> function allows users to carry out t-test and Wilcoxon rank sum test and export results tables which we feel enrich the utility of the pipeline for the basic research scientist, who will now be able to more easily analyze and interrogate statistically significant biological changes within the data.</p><p>In response to the reviewers’ comment regarding differential abundance testing, we carried out a concurrent test using the <italic>diffCyt</italic> framework with the Hartmann et al.[9] data to benchmark the output of the pipeline with currently available ‘gold standard’ tools. Additionally, we highlight that users can easily extract the data from the<italic>ImmunoCluster</italic> generated SingleCellExperiment object and carry out downstream analyses with other packages such as <italic>diffcyt.</italic> Text now reads:</p><p>Lines 172-179: “We compared <italic>ImmunoCluster’s</italic> differential abundance testing output (<italic>stat_test_clust</italic>), run in the t-test mode, with the Hartmann et al. data[9] into the<italic>diffcyt</italic> computational framework [6], which is a state-of-the-art tool fordifferential discovery analyses. <italic>Diffcyt</italic> identified the same three cell clusters (memory B-cells, naïve B-cells and naïve CD4<sup>+</sup> T-cells) as differentially abundant (FDR p&lt;0.05) between the GvHD and none conditions. This demonstrates concordance with <italic>ImmunoCluster’s</italic> statistical output that identified naïve B-cells and naïve CD4<sup>+</sup> T-cells as one of the principle differentially abundant populations, which was also identified in the original analysis of the data (Supplementary file 4).”</p><p>Lines 488-495: “Data from the <italic>ImmunoCluster</italic> generated SingleCellExperiment object can be easily extracted for downstream analysis with differential analysis packages such as <italic>diffcyt</italic> [6] and <italic>cydar</italic> [10] for differential discovery, which is based on a combination of high-resolution clustering and empirical Bayes moderated tests. In addition, the <italic>ImmunoCluster</italic> framework offers the <italic>stat_test_clust</italic> and <italic>stat_test_expression</italic> functions which use the Wilcox rank sum or Welch’s T-test to identify which cell clusters are significantly different between conditions (any two-way comparison can be made using metadata input by user), and which markers are significantly different within cell clusters between different conditions, respectively.”</p><disp-quote content-type="editor-comment"><p>The authors mention that the pipeline can accommodate millions of cells. Is this the case for all the clustering and visualization steps, or do you require downsampling? It would be helpful to see an analysis of run-time/details of the computer used to analyse the data. It appears the clustering methods implemented here (phenograph for example) might not work well if there are millions of cells across multiple samples.</p></disp-quote><p>The <italic>ImmunoCluster</italic> package contains functionality to adaptively down-sample cell number at both the data import and dimensionality reduction stage. For computationally intensive dimensionality steps such as <italic>UMAP</italic> and <italic>tSNE</italic> down-sampling is likely required for large datasets with &gt;1Million cells. Down-sampling is not required for clustering depending on the method selection, as suggested <italic>Phenograph</italic> will not scale effectively, but the <italic>FlowSOM</italic> method implemented will scale to large datasets. We do not require down-sampling for any of the additional visualization steps for the large 2.3 Million cell published LMC GvHD dataset analyzed. In response to the reviewer’s comment we have now provided a new Supplementary Figure with runtimes for a typical pipeline generated using <italic>ImmunoCluster</italic> and at different levels of down-sampling (Figure 1—figure supplement 2). We have also modified the text to read:</p><p>Lines 124-126: “We observed that a typical pipeline run on the full 2.3 million cell LMC GvHD dataset (with UMAP down-sampling to 500k cells) would take approximately 110 minutes on a 2.9 GHz Intel Core i7 Macbook pro with 16 GB RAM (Figure 1—figure supplement 2).”</p><p>Lines 504-514: “The inclusion of adaptive down-sampling of cells for the running of computationally intensive dimensionality reduction steps, using tools such as <italic>UMAP</italic> and <italic>tSNE</italic>, allows <italic>ImmunoCluster</italic> to generate cytometry analysis pipelines that readily scalable to a dataset of millions of cells across several samples and a variety of experimental or phenotypic conditions. <bold><italic>[…]</italic></bold> Whilst the <italic>PhenoGraph</italic> clustering method does not readily scale, the <italic>FlowSOM</italic>-based clustering method can be implemented on much larger datasets.”</p><disp-quote content-type="editor-comment"><p>In the MDS plots of samples (see Figure 3A), it is unclear what features are used to project the samples. Could you please elaborate on this point?</p></disp-quote><p>Many thanks for spotting this important point, our apologies this wasn’t clear. In response, the median marker expression data in each sample were used to create the MDS plot, we have added this clarification in both the text and figure legend.</p><p>Lines 408-412: “One example of this is the <bold>Multidimensional scaling (MDS) plots.The median marker expression data from each sample are used to create MDS plots, and therefore allow for an initial visualization of data points (labelled with metadata) and show the similarity and differences between samples in two-dimensions.”</bold></p><p>Lines 617-621: “Figure 1. Initial exploration of LMC data from patients with leukemia who received bone marrow transplants. (A-B) Multidimensional scaling (MDS) of data, median marker expression data from each sample were used to create plots, annotated with condition (GvHD or none) (A), and time after bone marrow transplant (BMT) treatment (B). C Heatmap showing <bold>the median marker expression for each patient.”</bold></p><disp-quote content-type="editor-comment"><p>Does this current approach have any means for assessing or correcting for batch effects within the datasets? The authors only mention sample barcoding as an experimental plan to reduce batch effects, but fail to mention of any strategy to assess or correct for batch effects, which is a very important consideration that should be addressed.</p></disp-quote><p>We agree with the reviewer’s comment that assessing and correcting for batch effects is very important, therefore in response we have now added a specific paragraph discussing strategies used for batch correction to the manuscript which will further guide and support the utilization of <italic>ImmunoCluster</italic>. Text now reads:</p><p>Lines 282-292: “Technical inter-sample marker signal variability due to batch effects may impact the ability of unsupervised analysis to reliably detect certain populations, if significant batch effects are present. <bold>[…]</bold> Statistical methods for batch correction may also be applied, in recent years a class of methods called Remove Unwanted Variation (RUV) have been developed, and <italic>CytofRUV</italic> [12] is a recently developed package specifically designed for CyTOF dataset batch correction.”</p><disp-quote content-type="editor-comment"><p>Similarly, although channel spillover and differences in cell numbers were mentioned, no means were provided to assess or rectify these effects using the approach described.</p></disp-quote><p>In response, we have also now expanded our description on how to rectify channel spillover within the text.</p><p>Lines 298-304: “Although channel spillover is diminished in mass cytometry, it still exists in fluorescence-based FC, and should be considered when designing antibody panels to reduce the effects on introducing cell phenotype artifacts in downstream unsupervised analysis. […] where cells are stained with all fluorescently-tagged antibodies except for the one of interest [13].”</p><p>Furthermore, we have also expanded our descriptions around the potential issues associated with cell number disparity between samples.</p><p>Lines 292-298: “If there are significant differences in the total number of cells recovered between samples, samples with many more cells may bias the clustering. […] If a particular sample has very few cells they may need to be excluded from the analysis as they may not be a representative sample.”</p><p><bold>References:</bold></p><p>https://github.com/HelenaLC/CATALYST</p><p>https://github.com/kevinblighe/scDataviz</p><p>1. Nowicka, M., et al., CyTOF workflow: differential discovery in high-throughput high-dimensional cytometry datasets [version 4; peer review: 2 approved]. 2019. 6(748).2. Diggins, K.E., P.B. Ferrell, Jr., and J.M. Irish, Methods for discovery and characterization of cell subsets in high dimensional mass cytometry data. Methods (San Diego, Calif.), 2015. 82: p. 55-63.3. Ashhurst, T.M., et al., Analysis of the Murine Bone Marrow Hematopoietic System Using Mass and Flow Cytometry, in Mass Cytometry: Methods and Protocols, H.M. McGuire and T.M. Ashhurst, Editors. 2019, Springer New York: New York, NY. p. 159-192.4. Crowell H, Z.V., Chevrier S, Robinson M, CATALYST: Cytometry dATa anALYSis Tools. R package version 1.12.2, . 2020.5. Chen, H., et al., Cytofkit: A Bioconductor Package for an Integrated Mass Cytometry Data Analysis Pipeline. PLOS Computational Biology, 2016. 12(9): p. e1005112.6. Weber, L.M., et al., diffcyt: Differential discovery in high-dimensional cytometry via high-resolution clustering. Communications Biology, 2019. 2(1): p. 183.7. Ashhurst, T.M., et al., Integration, exploration, and analysis of high-dimensional single-cell cytometry data using Spectre. bioRxiv, 2020: p. 2020.10.22.349563.8. Blighe, K., “scDataviz: single cell dataviz and downstream analyses.” . 2020.9. Hartmann, F.J., et al., Comprehensive Immune Monitoring of Clinical Trials to Advance Human Immunotherapy. Cell Rep, 2019. 28(3): p. 819-831.e4.10. Lun, A.T.L., A.C. Richard, and J.C. Marioni, Testing for differential abundance in mass cytometry data. Nature Methods, 2017. 14(7): p. 707-709.11. Schulz, A.R. and H.E. Mei, Surface Barcoding of Live PBMC for Multiplexed Mass Cytometry. Methods Mol Biol, 2019. 1989: p. 93-108.12. Trussart, M., et al., Removing unwanted variation with CytofRUV to integrate multiple CyTOF datasets. <italic>eLife</italic>, 2020. 9: p. e59630.13. Roederer, M., Spectral compensation for flow cytometry: Visualization artifacts, limitations, and caveats. 2001. 45(3): p. 194-205.</p></body></sub-article></article>