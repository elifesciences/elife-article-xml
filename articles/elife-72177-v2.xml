<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD with MathML3 v1.3 20210610//EN"  "JATS-archivearticle1-3-mathml3.dtd"><article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.3"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn publication-format="electronic" pub-type="epub">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">72177</article-id><article-id pub-id-type="doi">10.7554/eLife.72177</article-id><article-version article-version-type="publication-state">version of record</article-version><article-categories><subj-group subj-group-type="display-channel"><subject>Research Article</subject></subj-group><subj-group subj-group-type="heading"><subject>Evolutionary Biology</subject></subj-group></article-categories><title-group><article-title>Estimating dispersal rates and locating genetic ancestors with genome-wide genealogies</article-title></title-group><contrib-group><contrib contrib-type="author" corresp="yes"><name><surname>Osmond</surname><given-names>Matthew</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0001-6170-8182</contrib-id><email>mm.osmond@utoronto.ca</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="other" rid="fund2"/><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" corresp="yes"><name><surname>Coop</surname><given-names>Graham</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0001-8431-0302</contrib-id><email>gmcoop@ucdavis.edu</email><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="other" rid="fund4"/><xref ref-type="other" rid="fund5"/><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf2"/></contrib><aff id="aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/03dbr7087</institution-id><institution>Department of Ecology and Evolutionary Biology, University of Toronto</institution></institution-wrap><addr-line><named-content content-type="city">Toronto</named-content></addr-line><country>Canada</country></aff><aff id="aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/05rrcem69</institution-id><institution>Department of Evolution &amp; Ecology and Center for Population Biology, University of California, Davis</institution></institution-wrap><addr-line><named-content content-type="city">Davis</named-content></addr-line><country>United States</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Nordborg</surname><given-names>Magnus</given-names></name><role>Reviewing Editor</role><aff><institution>Gregor Mendel Institute</institution><country>Austria</country></aff></contrib><contrib contrib-type="senior_editor"><name><surname>Weigel</surname><given-names>Detlef</given-names></name><role>Senior Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/0243gzr89</institution-id><institution>Max Planck Institute for Biology Tübingen</institution></institution-wrap><country>Germany</country></aff></contrib></contrib-group><pub-date publication-format="electronic" date-type="publication"><day>26</day><month>11</month><year>2024</year></pub-date><volume>13</volume><elocation-id>e72177</elocation-id><history><date date-type="received" iso-8601-date="2021-07-14"><day>14</day><month>07</month><year>2021</year></date><date date-type="accepted" iso-8601-date="2024-11-24"><day>24</day><month>11</month><year>2024</year></date></history><pub-history><event><event-desc>This manuscript was published as a preprint at .</event-desc><date date-type="preprint" iso-8601-date="2021-07-14"><day>14</day><month>07</month><year>2021</year></date><self-uri content-type="preprint" xlink:href="https://doi.org/10.1101/2021.07.13.452277"/></event></pub-history><permissions><copyright-statement>© 2024, Osmond and Coop</copyright-statement><copyright-year>2024</copyright-year><copyright-holder>Osmond and Coop</copyright-holder><ali:free_to_read/><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><ali:license_ref>http://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-72177-v2.pdf"/><self-uri content-type="figures-pdf" xlink:href="elife-72177-figures-v2.pdf"/><abstract><p>Spatial patterns in genetic diversity are shaped by individuals dispersing from their parents and larger-scale population movements. It has long been appreciated that these patterns of movement shape the underlying genealogies along the genome leading to geographic patterns of isolation-by-distance in contemporary population genetic data. However, extracting the enormous amount of information contained in genealogies along recombining sequences has, until recently, not been computationally feasible. Here, we capitalize on important recent advances in genome-wide gene-genealogy reconstruction and develop methods to use thousands of trees to estimate per-generation dispersal rates and to locate the genetic ancestors of a sample back through time. We take a likelihood approach in continuous space using a simple approximate model (branching Brownian motion) as our prior distribution of spatial genealogies. After testing our method with simulations we apply it to <italic>Arabidopsis thaliana</italic>. We estimate a dispersal rate of roughly 60 km<sup>2</sup>/generation, slightly higher across latitude than across longitude, potentially reflecting a northward post-glacial expansion. Locating ancestors allows us to visualize major geographic movements, alternative geographic histories, and admixture. Our method highlights the huge amount of information about past dispersal events and population movements contained in genome-wide genealogies.</p></abstract><kwd-group kwd-group-type="author-keywords"><kwd>ancestral recombination graph</kwd><kwd>tree sequence</kwd><kwd>spatial inference</kwd><kwd>branching Brownian motion</kwd><kwd>population genetics</kwd><kwd>phylogeography</kwd><kwd>importance sampling</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research organism</title><kwd><italic>A. thaliana</italic></kwd></kwd-group><funding-group><award-group id="fund1"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000038</institution-id><institution>Natural Sciences and Engineering Research Council of Canada</institution></institution-wrap></funding-source><award-id>RGPIN-2021-03207</award-id><principal-award-recipient><name><surname>Osmond</surname><given-names>Matthew</given-names></name></principal-award-recipient></award-group><award-group id="fund2"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000038</institution-id><institution>Natural Sciences and Engineering Research Council of Canada</institution></institution-wrap></funding-source><award-id>DGECR-2021-00114</award-id><principal-award-recipient><name><surname>Osmond</surname><given-names>Matthew</given-names></name></principal-award-recipient></award-group><award-group id="fund3"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100010231</institution-id><institution>Banting Research Foundation</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Osmond</surname><given-names>Matthew</given-names></name></principal-award-recipient></award-group><award-group id="fund4"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000057</institution-id><institution>National Institute of General Medical Sciences</institution></institution-wrap></funding-source><award-id>R01 GM108779</award-id><principal-award-recipient><name><surname>Coop</surname><given-names>Graham</given-names></name></principal-award-recipient></award-group><award-group id="fund5"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000057</institution-id><institution>National Institute of General Medical Sciences</institution></institution-wrap></funding-source><award-id>R35 GM136290</award-id><principal-award-recipient><name><surname>Coop</surname><given-names>Graham</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection, and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>A new method to infer the spatial history of genetic ancestors from a sequence of trees along a recombining genome.</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>Patterns of genetic diversity are shaped by the movements of individuals, as individuals move their alleles around the landscape as they disperse. Patterns of individual movement reflect individual-level dispersal; children move away from their parents’ village and dandelion seeds blow in the wind. These patterns also reflect large-scale movements of populations. For example, in the past decade we have learnt about the large-scale movement of different peoples across the world from ancient DNA (<xref ref-type="bibr" rid="bib91">Slatkin and Racimo, 2016</xref>; <xref ref-type="bibr" rid="bib85">Reich, 2018</xref>). Such large-scale movements of individuals also occur in other species during biological invasions or with the retreat and expansion of populations in and out of glacial refugia, tracking the waxing and waning of the ice ages (<xref ref-type="bibr" rid="bib41">Hewitt, 2000</xref>).</p><p>An individual’s set of genealogical ancestors expands rapidly geographically back through time in sexually reproducing organisms (<xref ref-type="bibr" rid="bib51">Kelleher et al., 2016b</xref>; <xref ref-type="bibr" rid="bib17">Coop, 2017</xref>). Due to limited recombination each generation, more than a few tens of generations back an individual’s genetic ancestors represent only a tiny sample of their vast number of genealogical ancestors (<xref ref-type="bibr" rid="bib24">Donnelly, 1983</xref>; <xref ref-type="bibr" rid="bib16">Coop, 2013</xref>). Yet the geographic locations of genetic ancestors still represent an incredibly rich source of information on population history (<xref ref-type="bibr" rid="bib11">Bradburd and Ralph, 2019</xref>). We can hope to learn about the geography of genetic ancestors because individuals who are geographically close are often genetically more similar across their genomes; their ancestral lineages have only dispersed for a relatively short time and distance since they last shared a geographically close common ancestor. This pattern is termed isolation-by-distance. These ideas about the effects of geography and genealogy have underlain our understanding of spatial population genetics since its inception (<xref ref-type="bibr" rid="bib113">Wright, 1943</xref>; <xref ref-type="bibr" rid="bib68">Malécot, 1948</xref>). Under coalescent models, lineages move spatially, as a Brownian motion if dispersal is random and local, splitting to give rise to descendent lineages until we reach the present day. Such models underlie inferences based on increasing allele frequency differentiation (such as <inline-formula><mml:math id="inf1"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>F</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>S</mml:mi><mml:mi>T</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula>) with geographic distance (<xref ref-type="bibr" rid="bib87">Rousset, 1997</xref>) and the drop-off in the sharing of long blocks of genome shared identical by descent among pairs of individuals (<xref ref-type="bibr" rid="bib80">Ralph and Coop, 2013</xref>; <xref ref-type="bibr" rid="bib86">Ringbauer et al., 2017</xref>). These models also are the basis of methods that seek violations of isolation-by-distance (<xref ref-type="bibr" rid="bib103">Wang and Bradburd, 2014</xref>).</p><p>While spatial genealogies have proven incredibly useful for theoretical tools and intuition, with few exceptions they have not proven useful for inferences because we have not been able to construct these genealogies along recombining sequences. In non-recombining chromosomes (e.g., mtDNA and Y), constructed genealogies have successfully been used to understand patterns of dispersal and spatial spread (<xref ref-type="bibr" rid="bib4">Avise, 2009</xref>). However, these spatial genealogy inferences are necessarily limited as a single genealogy holds only limited information about the history of populations in a recombining species (<xref ref-type="bibr" rid="bib5">Barton and Wilson, 1995</xref>). Phylogenetic approaches to geography ‘phylogeography’; <xref ref-type="bibr" rid="bib56">Knowles, 2009</xref> have been more widely and successfully applied to pathogens to track the spatial spread of epidemics, such as SARS-CoV-2 (<xref ref-type="bibr" rid="bib69">Martin et al., 2021</xref>), but such approaches have yet to be applied to the thousands of genealogical trees that exist in sexual populations.</p><p>Here, we capitalize on the recent ability to infer a sequence of genealogies, with branch lengths, across recombining genomes (<xref ref-type="bibr" rid="bib84">Rasmussen et al., 2014</xref>; <xref ref-type="bibr" rid="bib93">Speidel et al., 2019</xref>; <xref ref-type="bibr" rid="bib110">Wohns et al., 2021</xref>; <xref ref-type="bibr" rid="bib89">Schaefer et al., 2021</xref>; <xref ref-type="bibr" rid="bib115">Zhang et al., 2023</xref>; <xref ref-type="bibr" rid="bib37">Gunnarsson et al., 2024</xref>; <xref ref-type="bibr" rid="bib22">Deng et al., 2024</xref>, reviewed in <xref ref-type="bibr" rid="bib111">Wong et al., 2024</xref>; <xref ref-type="bibr" rid="bib65">Lewanski et al., 2024</xref>; <xref ref-type="bibr" rid="bib72">Nielsen et al., 2024</xref>). Equipped with this information, we develop a method that uses a sequence of trees to estimate dispersal rates and locate genetic ancestors in continuous, two-dimensional space under the assumption of Brownian motion. Using thousands of approximately unlinked trees, we multiply likelihoods of the dispersal rate across trees to get a genome-wide estimate and use the sequence of trees to predict a cloud of ancestral locations as a way to visualize geographic ancestries. We first test our approach with simulations and then apply it to <italic>Arabidopsis thaliana</italic>, a species with a wide geographic distribution and a complex history (<xref ref-type="bibr" rid="bib30">Fulgione and Hancock, 2018</xref>).</p></sec><sec id="s2" sec-type="results"><title>Results</title><sec id="s2-1"><title>Overview of approach</title><p>We first give an overview of our approach, the major components of which are illustrated in <xref ref-type="fig" rid="fig1">Figure 1</xref>.</p><p>See Materials and methods for more details.</p><fig id="fig1" position="float"><label>Figure 1.</label><caption><title>Conceptual overview of the approach.</title><p>From a sequence of trees covering the full genome, we downsample to trees at approximately unlinked loci. To avoid the influence of strongly non-Brownian dynamics at deeper times (e.g., glacial refugia, boundaries), we ignore times deeper than <inline-formula><mml:math id="inf2"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>T</mml:mi></mml:mstyle></mml:math></inline-formula>, which divides each tree into multiple subtrees (here, blue and red subtrees at locus <inline-formula><mml:math id="inf3"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>i</mml:mi></mml:mstyle></mml:math></inline-formula>). From these subtrees, we extract the shared times of each pair of lineages back to the root. In practice (but not shown here), we use multiple samples of the tree at a given locus, for importance sampling, and also extract the coalescence times for importance sample weights. Under Brownian motion, the shared times describe the covariance we expect to see in the locations of our samples, and so using the times and locations we can find the maximum likelihood dispersal rate (a 2 × 2 covariance matrix). While we can estimate a dispersal rate at each locus, a strength of our approach is that we combine information across many loci, by multiplying likelihoods, to estimate a single genome-wide dispersal rate. Finally, we locate a genetic ancestor at a particular locus (a point on a tree, here <inline-formula><mml:math id="inf4"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>A</mml:mi></mml:mstyle></mml:math></inline-formula>) by first calculating the time this ancestor shares with each of the samples in its subtree, and then using the shared times and dispersal rate to calculate the probability distribution of the ancestor’s location conditioned on the sample locations. In practice (but not shown here), we calculate the location of the ancestor of a given sample at a given time across many loci, combining information across loci into a distribution of genome-wide ancestry across space.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-72177-fig1-v2.tif"/></fig><p>The rate of dispersal, which determines the average distance between parents and offspring, is a key parameter in ecology and evolution. To estimate this parameter we assume that in each generation the displacement of an offspring from its mother is normally distributed with a mean of 0 in each dimension and covariance matrix <inline-formula><mml:math id="inf5"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>. In two dimensions, the covariance matrix is determined by the standard deviations, <inline-formula><mml:math id="inf6"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>σ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf7"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>σ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula>, along the <inline-formula><mml:math id="inf8"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>x</mml:mi></mml:mstyle></mml:math></inline-formula> (longitudinal) and <inline-formula><mml:math id="inf9"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>y</mml:mi></mml:mstyle></mml:math></inline-formula> (latitudinal) axes, respectively, as well as the correlation, <inline-formula><mml:math id="inf10"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>ρ</mml:mi></mml:mstyle></mml:math></inline-formula>, in displacements between these two axes. The average distance between a mother and its offspring is then <inline-formula><mml:math id="inf11"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msqrt><mml:mn>2</mml:mn><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>/</mml:mo></mml:mrow><mml:mi>π</mml:mi></mml:msqrt><mml:msub><mml:mi>σ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> in each dimension.</p><p>Given this model, the path of a lineage from its ancestral location to the present day location is described by a Brownian motion with rate <inline-formula><mml:math id="inf12"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>. We therefore refer to <inline-formula><mml:math id="inf13"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> as the dispersal rate, which describes the rate of increase in the variance of a location along a single lineage. Lineages covary in their locations because of shared evolutionary histories – lineages with a more recent common ancestor covary more. Given a tree at a locus we can calculate the covariance matrix of shared evolutionary times (back to the root) and compute the likelihood of the dispersal rate, <inline-formula><mml:math id="inf14"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, which is normally distributed given this covariance matrix. At each locus we can estimate the likelihood of the dispersal rate given the tree at that locus allowing us to multiply likelihoods across loci to derive a genome-wide likelihood, and thus a genome-wide maximum likelihood dispersal rate. While the genome-wide dispersal estimate is not biased by correlations between the trees, we simply use every <inline-formula><mml:math id="inf15"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msup><mml:mi>n</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="normal">t</mml:mi><mml:mi mathvariant="normal">h</mml:mi></mml:mrow></mml:mrow></mml:msup></mml:mstyle></mml:math></inline-formula> locus across the genome to reduce the redundancy of information we estimate dispersal from.</p><p>Under this same model we can also estimate the locations of genetic ancestors at a locus. Any point along a tree at any locus is a genetic ancestor of one or more current day samples. This ancestor’s lineage has dispersed away from the location of the most recent common ancestor of the samples, and covaries with current day samples in their geographic location to the extent that it shares times in the tree with them. Under this model, the location of an ancestor is influenced by the locations of all samples in the same tree, including those that are not direct descendants (cf. <xref ref-type="bibr" rid="bib110">Wohns et al., 2021</xref>). For example, in <xref ref-type="fig" rid="fig1">Figure 1</xref> the ancestor’s location is not the midpoint of its two descendants (samples 4 and 5); the ancestor’s location is also pulled towards sample 3 since the ancestor and sample 3 both arose from a common ancestor. Conditioning on the sample locations, and given the shared times and previously inferred dispersal rate, we can compute the probability the ancestor was at any location, which again is a normal distribution. In contrast to dispersal, for ancestral locations we do not want to multiply likelihoods across loci since the ancestors at distant loci are likely distinct. Instead, we calculate the maximum likelihood location of the genetic ancestor at each sparsely sampled locus to get a cloud of likely ancestral locations genome-wide, and use these clouds to visualize the spatial spread of genetic ancestry backwards through time.</p><p>We estimate marginal trees along the genome using Relate (<xref ref-type="bibr" rid="bib93">Speidel et al., 2019</xref>). While we could in principle estimate trees independently at regions across the genome, a benefit of Relate and similar methods is that they estimate each tree using information from nearby regions. Relate infers a sequence of tree topologies and associated branch lengths, and can return a set of posterior draws of the branch lengths on a given tree (it was the only method that did so for a large number of samples when we began this work, but now see <xref ref-type="bibr" rid="bib110">Wohns et al., 2021</xref>; <xref ref-type="bibr" rid="bib22">Deng et al., 2024</xref>). This posterior distribution of branch lengths is useful to us as the shared times in the tree are key to the amount of time that individual lineages have had to disperse away from one another and we wish to include uncertainty in the times into our method. Relate gives us a posterior distribution of branch lengths that is estimated using a coalescent prior, which assumes a panmictic population of varying population size (the size changes are estimated as part of the method), where any two lineages are equally likely to coalesce. This panmictic prior results in a bias in the coalescent times under a spatial model, where geographically proximate samples are more likely to coalesce. To correct for this bias we make use of importance sampling to weight the samples of branch lengths at each locus. We then calculate the weighted average likelihood over our draws of our sample of trees at a locus (or loci), so that it is as if they were drawn from a prior of branching Brownian motion (<xref ref-type="bibr" rid="bib70">Meligkotsidou and Fearnhead, 2007</xref>).</p><p>In practice, we concentrate on the recent past history of our sample. For our estimates of dispersal rates in particular we do not want to assume that our model of Gaussian dispersal (and branching Brownian motion) holds deep into the past history of the sample. This is because the long-term movement of lineages is constrained by geographic barriers (e.g., oceans) and larger-scale population movements may erase geographic signals over deep time scales. On a theoretical level ignoring the deep past may also be justified because in a finite habitat the locations of coalescence events further back in time become independent of sampling locations as lineages have moved around sufficiently (<xref ref-type="bibr" rid="bib105">Wilkins and Wakeley, 2002</xref>). Thus we only use this geographic model to some time point in the past (<inline-formula><mml:math id="inf16"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>T</mml:mi></mml:mstyle></mml:math></inline-formula>), and at each locus we use the covariance of shared branch lengths based on the set of subtrees formed by cutting off the full tree <inline-formula><mml:math id="inf17"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>T</mml:mi></mml:mstyle></mml:math></inline-formula> generations back. There are many ways one could choose the cutoff time, for example, the time to cross the habitat, the time since glaciation, or the most recent time at which the average number of lineages remaining across trees is less than a threshold. Here, we estimate dispersal across a range of <inline-formula><mml:math id="inf18"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>T</mml:mi></mml:mstyle></mml:math></inline-formula>, which gives us a sense of how the effective dispersal rate changes over time. We then use the full trees (<inline-formula><mml:math id="inf19"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>T</mml:mi><mml:mo stretchy="false">→</mml:mo><mml:mi mathvariant="normal">∞</mml:mi></mml:mstyle></mml:math></inline-formula>) to locate ancestors, so that we use all the relatedness information. However, in our empirical application we only locate ancestors back to a time <inline-formula><mml:math id="inf20"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>T</mml:mi></mml:mstyle></mml:math></inline-formula> we feel is reasonable (to the most recent glaciation) and use the dispersal estimate from that <inline-formula><mml:math id="inf21"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>T</mml:mi></mml:mstyle></mml:math></inline-formula>.</p><p>Branching Brownian motion, also known as the Brownian–Yule process, is a simple model of spatial genealogies in a continuous population (<xref ref-type="bibr" rid="bib68">Malécot, 1948</xref>; <xref ref-type="bibr" rid="bib113">Wright, 1943</xref>). This simplicity comes at a cost: the lack of local density dependence generates non-uniform population density (<xref ref-type="bibr" rid="bib28">Felsenstein, 1975</xref>) and the assumption of unbounded space overestimates the distance between samples (<xref ref-type="bibr" rid="bib48">Kalkauskas et al., 2021</xref>). More complex models, such as the spatial Lambda Fleming–Viot process (<xref ref-type="bibr" rid="bib6">Barton et al., 2010</xref>), overcome these issues and more, but are computationally expensive for inference (<xref ref-type="bibr" rid="bib107">Wirtz and Guindon, 2024</xref>). Branching Brownian motion remains an analytically tractable model and a reasonable approximation over short-time scales (<xref ref-type="bibr" rid="bib26">Edwards, 1970</xref>; <xref ref-type="bibr" rid="bib83">Rannala and Yang, 1996</xref>; <xref ref-type="bibr" rid="bib70">Meligkotsidou and Fearnhead, 2007</xref>; <xref ref-type="bibr" rid="bib74">Novembre and Slatkin, 2009</xref>).</p></sec><sec id="s2-2"><title>Simulations</title><p>We first wanted to test the performance of our method in a situation where the true answers were known. To do this, we used a combination of spatially explicit forward-time simulations (<xref ref-type="bibr" rid="bib39">Haller and Messer, 2023</xref>), coalescent simulations (<xref ref-type="bibr" rid="bib50">Kelleher et al., 2016a</xref>), and tree-sequence tools (<xref ref-type="bibr" rid="bib38">Haller et al., 2019</xref>; <xref ref-type="bibr" rid="bib53">Kelleher et al., 2019</xref>; <xref ref-type="bibr" rid="bib93">Speidel et al., 2019</xref>) to compare our estimates of dispersal rates and ancestor locations with the truth (see Materials and methods). This was also an opportunity to compare our estimates using the true trees vs. the Relate-inferred trees, to examine the influence of uncertainty in tree inference.</p><sec id="s2-2-1"><title>Dispersal rates</title><p>Our method systematically underestimates simulated dispersal rates (<xref ref-type="fig" rid="fig2">Figure 2A</xref>), as expected given that our simple unbounded Brownian motion model allows the samples to be more broadly distributed than the finite habitat (e.g., <xref ref-type="bibr" rid="bib45">Ianni-Ravn et al., 2023</xref>; <xref ref-type="bibr" rid="bib48">Kalkauskas et al., 2021</xref>). Ignoring the distant past tends to reduce this underestimate (see <inline-formula><mml:math id="inf22"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>1000</mml:mn></mml:mstyle></mml:math></inline-formula> in <xref ref-type="fig" rid="fig2">Figure 2A</xref>), but ignoring too much of the past increases noise and can lead to even larger underestimates (see <inline-formula><mml:math id="inf23"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mn>100</mml:mn></mml:mstyle></mml:math></inline-formula> in <xref ref-type="fig" rid="fig2">Figure 2A</xref>). Despite the fact that we tend to underestimate the simulated dispersal rate, our estimates are highly correlated with the simulated values and we can interpret the dispersal rate inferred from the true trees as a true ‘effective’ dispersal rate given the habitat boundaries, local competition, etc.</p><fig-group><fig id="fig2" position="float"><label>Figure 2.</label><caption><title>Simulations.</title><p>(<bold>A</bold>) Accuracy of genome-wide dispersal rates. Maximum composite likelihood estimates of dispersal rate (in ‘<italic>x</italic>’ and ‘<italic>y</italic>’ dimensions) using the true trees vs. Relate-inferred trees for three different time cutoffs, <inline-formula><mml:math id="inf24"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>T</mml:mi></mml:mstyle></mml:math></inline-formula>. Colours indicate the simulated dispersal rates, which are given by the corresponding lines. (<bold>B</bold>) Locating genetic ancestors at a particular locus. 95% confidence ellipses for the locations of genetic ancestors for three samples at a single locus (using the true trees and the simulated dispersal rate). The ‘o’s are the sample locations and the ‘x’s are the true ancestral locations. (<bold>C</bold>) Accuracy of locating genetic ancestors at individual loci. Root mean squared errors between the true locations of ancestors and the mean location of the samples (red), the current locations of the samples (green), and the maximum likelihood estimates from the inferred (orange) and true (blue) trees. (<bold>D</bold>) Locating genetic ancestors at many loci. Contour plots of the most likely (using the true trees; blue) and the true (grey) locations of genetic ancestors at every 100th locus for a given sample. (<bold>E</bold>) Accuracy of mean genetic ancestor locations. Root mean squared errors between the true mean location of genetic ancestors and the mean location of the samples (red), the current locations of the samples (green), and the mean maximum likelihood estimates from the inferred (orange) and true (blue) trees. To reduce computation time we only attempt to locate the first 10 samples. In all panels, there are 10 replicate simulations for each combination of time cutoff and dispersal rate. We sample 50 diploid individuals at random and use every 100th locus, with 1000 importance samples at each. Panels B–E have no time cutoff, <inline-formula><mml:math id="inf25"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mi mathvariant="normal">∞</mml:mi></mml:mstyle></mml:math></inline-formula>, and were simulated with a dispersal rate given by green lines in panel A. In panels C and E, the inferred tree ancestor location estimates use the inferred tree dispersal estimates.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-72177-fig2-v2.tif"/></fig><fig id="fig2s1" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 1.</label><caption><title>The effect of importance sampling on dispersal estimates.</title><p>Importance sampling more trees, <inline-formula><mml:math id="inf26"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>M</mml:mi></mml:mstyle></mml:math></inline-formula>, at each locus brings the dispersal estimate from the inferred trees closer to the dispersal estimate from the true trees and lowers the variance in dispersal estimates across replicates. See <xref ref-type="fig" rid="fig2">Figure 2</xref> for more information, where <inline-formula><mml:math id="inf27"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mn>1000</mml:mn></mml:mstyle></mml:math></inline-formula> (top row).</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-72177-fig2-figsupp1-v2.tif"/></fig><fig id="fig2s2" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 2.</label><caption><title>The effect of sample size on dispersal estimates.</title><p>Using more samples, <inline-formula><mml:math id="inf28"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>k</mml:mi></mml:mstyle></mml:math></inline-formula>, tends to increase the dispersal estimate from both true and inferred trees and reduce the variation in estimates across replicates at smaller cutoff times. See <xref ref-type="fig" rid="fig2">Figure 2</xref> for more information, where <inline-formula><mml:math id="inf29"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>50</mml:mn></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf30"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mn>1000</mml:mn></mml:mstyle></mml:math></inline-formula> and we sample every 100th locus. To isolate the effect of larger trees (rather than more trees), here we use the first <inline-formula><mml:math id="inf31"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:mn>100</mml:mn></mml:mstyle></mml:math></inline-formula> sampled loci. To speed up calculations, here we use <inline-formula><mml:math id="inf32"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mn>100</mml:mn></mml:mstyle></mml:math></inline-formula> importance samples at each locus.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-72177-fig2-figsupp2-v2.tif"/></fig><fig id="fig2s3" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 3.</label><caption><title>Comparing maximum likelihood estimate (MLE) and best linear unbiased predictor (BLUP) ancestor locations.</title><p>The top row shows error in the MLE ancestor locations (orange), as in <xref ref-type="fig" rid="fig2">Figure 2</xref>, while the bottom row shows the error in the BLUP ancestor locations (orange). The methods are very comparable, though the BLUP method may do slightly worse at estimating the mean ancestor location at deep times.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-72177-fig2-figsupp3-v2.tif"/></fig><fig id="fig2s4" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 4.</label><caption><title>The effect of importance sampling on ancestor location estimates.</title><p>See <xref ref-type="fig" rid="fig2">Figure 2</xref> for more information, where <inline-formula><mml:math id="inf33"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mn>1000</mml:mn></mml:mstyle></mml:math></inline-formula> (top row).</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-72177-fig2-figsupp4-v2.tif"/></fig><fig id="fig2s5" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 5.</label><caption><title>The effect of sample size on ancestor location estimates.</title><p>See <xref ref-type="fig" rid="fig2">Figure 2</xref> for more information, where <inline-formula><mml:math id="inf34"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>50</mml:mn></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf35"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mn>1000</mml:mn></mml:mstyle></mml:math></inline-formula>, and we sample every 100th locus. To isolate the effect of larger trees (rather than more trees), here we use the first <inline-formula><mml:math id="inf36"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:mn>100</mml:mn></mml:mstyle></mml:math></inline-formula> sampled loci. To speed up calculations, here we use <inline-formula><mml:math id="inf37"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mn>100</mml:mn></mml:mstyle></mml:math></inline-formula> importance samples at each locus.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-72177-fig2-figsupp5-v2.tif"/></fig></fig-group><p>Encouragingly, the dispersal estimates from the inferred trees are highly correlated with those from the true trees, with a slight upward bias. This upward bias can be explained by isolation-by-distance and errors in inferred tree topologies, causing geographically more distant samples to be mistakenly inferred as closer relatives. The upward bias may also result from Relate tending to underestimate longer coalescence times (<xref ref-type="bibr" rid="bib114">Y C Brandt et al., 2022</xref>), which is consistent with the bias decreasing at smaller cutoff times. The bias increases as we use sample fewer trees at each locus (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>), showing that our spatial prior implemented via importance sampling improves our inference. Sampling more individuals reduces noise across replicates but can actually increase bias (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2</xref>), perhaps because of a greater chance of an error when inferring a larger tree. More work is needed to determine biases in ancestral recombination graphs inferred from spatial data more generally and to find additional ways to overcome this bias, for example, using only the most informative trees.</p></sec><sec id="s2-2-2"><title>Locating ancestors</title><p>We next wanted to test our ability to locate the genetic ancestor of a sampled genome at a given locus and a given time. With a single tree, our likelihood-based method gives both a point estimate (maximum likelihood estimate, MLE) and a 95% confidence ellipse (under the Brownian motion model), with only the latter relying on a genome-wide dispersal rate. With more than one tree we importance sample over likelihoods, numerically finding the maximum, which depends on the dispersal rate. We also have developed a best linear unbiased predictor (BLUP) of ancestral locations – importance sampling over analytically calculated MLE locations – that is faster to calculate, makes fewer assumptions, and is independent of the dispersal rate. Here, we focus on the full importance-sampled likelihood method for estimating ancestral locations, but the BLUP method is also implemented in our software and performs very similarly (<xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3</xref>).</p><p><xref ref-type="fig" rid="fig2">Figure 2B</xref> shows the 95% confidence ellipses for the locations of the ancestors of three samples at one particular locus at two different times in the past, using the true trees and the simulated dispersal rate. While the ellipses generally do a good job of capturing true ancestral locations (the ‘x’s), the size of an ellipse at any one locus grows relatively rapidly as we move back in time, meaning that at deeper times (or higher dispersal rates) any one locus contains little information about an ancestor’s location (as is the case for ancestral state reconstruction in phylogenetics; <xref ref-type="bibr" rid="bib90">Schluter et al., 1997</xref>).</p><p><xref ref-type="fig" rid="fig2">Figure 2C</xref> shows the resulting error in the MLE ancestor locations, using the true or inferred trees, and compares this to sensible straw-man estimates (the current location of each sample and the mean location across samples). While our method outperforms the straw-man estimates, the mean squared error in our inferred location of the ancestor at a locus grows relatively rapidly back in time, as expected under Brownian motion.</p><p>Given the large uncertainty of an ancestor’s location at any one locus, we combine information across loci and consider a cloud of MLE ancestor locations from loci across the genome for a particular sample at a particular time in the past (<xref ref-type="fig" rid="fig2">Figure 2D</xref>). The genome-wide mean of the MLE locations remains closer to the true mean location of genetic ancestors (<xref ref-type="fig" rid="fig2">Figure 2E</xref>) than at any one locus, even with the inferred trees, suggesting our method can successfully trace major trends in the geographic ancestry of a sample deeper into the past. In contrast to dispersal, the error in ancestral locations appears relatively robust to the number of trees sampled per locus (<xref ref-type="fig" rid="fig2s4">Figure 2—figure supplement 4</xref>) and the number of samples (<xref ref-type="fig" rid="fig2s5">Figure 2—figure supplement 5</xref>). Importance sampling is expected to have a smaller effect on locations than dispersal because the locations depend much less on branch lengths. As we increase the number of samples we increase the expected number of topological errors but we also sample more of an ancestor’s descendants and their close relatives, and so perhaps these two effects roughly cancel out.</p></sec></sec><sec id="s2-3"><title>Empirical application: <italic>A. thaliana</italic></title><p><italic>A. thaliana</italic> has a complex, and not yet fully resolved, spatial history (<xref ref-type="bibr" rid="bib30">Fulgione and Hancock, 2018</xref>; <xref ref-type="bibr" rid="bib42">Hsu et al., 2019</xref>), including range expansions, admixture between multiple glacial refugia, and long-distance colonization. To further examine this history, we originally applied our method to 1135 <italic>A. thaliana</italic> accessions from a wide geographic range (<xref ref-type="bibr" rid="bib1">1001 Genomes Consortium, 2016</xref>). Unfortunately, the dispersal rates we estimated from this data were unreasonably large, on the order of 10<sup>4</sup> km<sup>2</sup>/generation, even after removing pairs of near-identical samples and geographic outliers (for more details see our preprint, <xref ref-type="bibr" rid="bib76">Osmond and Coop, 2021</xref>). We next analysed an even larger dataset of roughly 1500 individuals from a broader geographic extent (<xref ref-type="bibr" rid="bib25">Durvasula et al., 2017</xref>), but estimated a similarly large dispersal rate (results not shown but full pipeline available at <ext-link ext-link-type="uri" xlink:href="https://github.com/mmosmond/spacetrees-ms">https://github.com/mmosmond/spacetrees-ms</ext-link>, copy archived at <xref ref-type="bibr" rid="bib77">Osmond, 2024a</xref>). The very high dispersal rate estimates from these datasets is an artefact of long runs of identity between pairs of geographically separated sequences (see Figure S6 of <xref ref-type="bibr" rid="bib76">Osmond and Coop, 2021</xref>). We believe that these stretches of identity result from the incorrect imputation of missing genotypes, a problem that could not be resolved through various data filters. Imputation is required to infer the genealogies as Relate does not allow sites with missing genotypes. However, imputation can obscure rare alleles, which artificially lowers the divergence between similar sequences. This lowers coalescence times and biases dispersal estimates upward. We resolved this issue by analysing a smaller dataset with 66 long-read genomes (<xref ref-type="bibr" rid="bib109">Wlodzimierz et al., 2023</xref>), where we could avoid imputing and capture more genetic variation (<xref ref-type="bibr" rid="bib46">Igolkina et al., 2024</xref>) and therefore be much more confident in the resulting genealogies.</p></sec><sec id="s2-4"><title><italic>A. thaliana</italic> genealogies</title><p>From 66 haploid genomes we used Relate (<xref ref-type="bibr" rid="bib93">Speidel et al., 2019</xref>) to infer the genome-wide genealogy (87,518 trees), estimate effective population sizes through time (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1</xref>), and resample branch lengths for importance sampling (see Materials and methods). The genealogies are publicly available at <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.11456353">https://doi.org/10.5281/zenodo.11456353</ext-link>, which we hope will facilitate additional analyses (e.g., inferring selection; <xref ref-type="bibr" rid="bib96">Stern et al., 2019</xref>; <xref ref-type="bibr" rid="bib97">Stern et al., 2021</xref>).</p><p><italic>A. thaliana</italic> is a selfer with a relatively low rate of outcrossing (<xref ref-type="bibr" rid="bib10">Bomblies et al., 2010</xref>; <xref ref-type="bibr" rid="bib79">Platt et al., 2010</xref>), thus it is worth taking a moment to consider the impact of selfing on our inferences. We chose <italic>A. thaliana</italic> because of its large sample size, broad geographic sampling, and intriguing spatial history. Furthermore, the availability of inbred accessions means that many samples have been well-studied and phasing is relatively straightforward. On the other hand, the high rate of selfing lowers the effective recombination rate and so is expected to increase the correlation in genealogies along the genome (<xref ref-type="bibr" rid="bib73">Nordborg, 2000</xref>). However, in practice, linkage disequilibrium breaks down relatively rapidly in <italic>A. thaliana</italic>, on the scales of tens of kilobases (<xref ref-type="bibr" rid="bib54">Kim et al., 2007</xref>), such that many trees along the genome should have relatively independent genealogies. A related issue is that the individuals with recent inbreeding (selfing) in their family tree will have fewer genealogical and genetic ancestors than outbred individuals. Thus in any recent time-slice there are a reduced number of independent genetic ancestors of a individual from a selfing population, but even with relatively low rates of outbreeding the number of ancestors still grows rapidly (<xref ref-type="bibr" rid="bib57">Lachance, 2009</xref>), meaning that many trees along the genome should have relatively independent spatial histories. Finally, while the effective recombination rate may vary through time along with rates of selfing, Relate uses a mutational clock to estimate branch lengths, and thus they should be well calibrated to a generational time scale.</p><p>In our analyses below, we use every 100th tree starting from the beginning of each autosome, for a total of 878 trees (hereafter, loci). At each locus we resample the branch lengths 1000 times, giving us 1000 importance samples (hereafter, trees) at each locus.</p><sec id="s2-4-1"><title>Estimating dispersal</title><p>We first used the trees at all sampled loci to estimate dispersal rate (<xref ref-type="fig" rid="fig3">Figure 3</xref>, inset). Using the full trees, back to the most recent common ancestor of each, we estimate a dispersal rate of about 30 km<sup>2</sup>/generation.</p><fig-group><fig id="fig3" position="float"><label>Figure 3.</label><caption><title>Dispersal rates (inset) and major trends in geographic ancestries.</title><p>Vectors start at sample locations (circles) and point to the mean location of ancestors across 878 loci 10<sup>4</sup> generations ago. Samples coloured by genomic principle component group (<xref ref-type="bibr" rid="bib109">Wlodzimierz et al., 2023</xref>).</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-72177-fig3-v2.tif"/></fig><fig id="fig3s1" position="float" specific-use="child-fig"><label>Figure 3—figure supplement 1.</label><caption><title>Relate-inferred effective population sizes and cross-coalescent rates.</title><p>Effective population sizes for each chromosome (top) and cross-coalescence rates for each pair of principle component groups (bottom) inferred with Relate. Compare with Figure 4a in <xref ref-type="bibr" rid="bib1">1001 Genomes Consortium, 2016</xref> and Figures 5 and 6 in <xref ref-type="bibr" rid="bib25">Durvasula et al., 2017</xref>.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-72177-fig3-figsupp1-v2.tif"/></fig></fig-group><p>To check that this dispersal estimate is well calibrated we can compare it to simpler estimates. To do this, we first calculated twice the average pairwise coalescent time over all loci (using just 1 tree per locus) for each pair of samples, <inline-formula><mml:math id="inf38"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>t</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> (multiplying <inline-formula><mml:math id="inf39"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>t</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> by the mutation rate then gives the expected pairwise nucleotide diversity; <xref ref-type="bibr" rid="bib81">Ralph et al., 2020</xref>). A simple estimate of the dispersal rate is then the slope of the regression of the squared pairwise geographic distances, <inline-formula><mml:math id="inf40"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msubsup><mml:mi>d</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mstyle></mml:math></inline-formula>, on the average coalescent times, <inline-formula><mml:math id="inf41"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>t</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula>. This gives a dispersal estimate of roughly 10 km<sup>2</sup>/generation, as does taking the average of <inline-formula><mml:math id="inf42"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msubsup><mml:mi>d</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>/</mml:mo></mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> over pairs (<xref ref-type="bibr" rid="bib45">Ianni-Ravn et al., 2023</xref>). Replacing the pairwise coalescent times, <inline-formula><mml:math id="inf43"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>t</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula>, with pairwise nucleotide diversity divided by the mutation rate (<inline-formula><mml:math id="inf44"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>π</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>/</mml:mo></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>7</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>−</mml:mo><mml:mn>9</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula>) gives a near-identical estimate that is independent of our inferred trees. Our tree-sequence estimate is expected to be larger than these simpler estimates because taking the arithmetic mean coalescent times over trees will lessen the amplifying effect of those trees with shorter coalescent times. Using instead the harmonic mean pairwise coalescent time over trees, we estimate a dispersal rate of roughly 40 km<sup>2</sup>/generation, similar to our estimate.</p><p>We next examined the effect of cutting off our inference deeper in time (<xref ref-type="fig" rid="fig3">Figure 3</xref>, inset). Cutting the trees off 10<sup>6</sup> generations ago has essentially no effect, as it removes few coalescent events. With cutoffs of 10<sup>5</sup> and 10<sup>4</sup>, the estimated dispersal rate increases to about 35 and 60 km<sup>2</sup>/generation, respectively, which we believe is because finite habitat boundaries lower the effective dispersal rate over longer time scales but also suggests faster rates of lineage movement post-glaciation, for example, due to a recent northward range expansion. More recent cutoffs leave very few coalescent events and hence little information. We cannot reliably apply the same cutoffs to the simpler pairwise dispersal estimates discussed above because there are few pairs of samples that have an average genetic distance below the cutoffs, highlighting the increased amount of information in our method.</p><p>These dispersal estimates are considerably higher than a recent estimate, using machine learning directly on genotype data, that was on the order of 1 km<sup>2</sup>/generation (<xref ref-type="bibr" rid="bib92">Smith et al., 2023</xref>). This previous study used a similar sample size but a much narrower geographic range of more closely related individuals. It is therefore likely that this lower estimate more strongly reflects shorter-term local dispersal, while we are striking a balance between these slower recent movements and faster movements that have occasionally occurred in deeper time. To get a sense of how large a dispersal rate we should expect, ‘non-relict’ lineages are proposed to have dispersed from the Black Sea to the Atlantic Ocean (about 2500 km) in the past 10<sup>4</sup> generations (<xref ref-type="bibr" rid="bib61">Lee et al., 2017</xref>; <xref ref-type="bibr" rid="bib42">Hsu et al., 2019</xref>). This suggests some lineages should have <inline-formula><mml:math id="inf45"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msubsup><mml:mi>d</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>/</mml:mo></mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> values of at least 300 km<sup>2</sup>/generation. We therefore think our effective dispersal rate is a reasonable one given the Brownian motion model and hypothesized movements in <italic>A. thaliana</italic>.</p><p>We estimate slightly faster dispersal along latitude than along longitude, especially in the past 10<sup>4</sup> generations. This was confirmed by estimating the dispersal rate separately along latitude and longitude, removing dependence on the sample locations (see methods). Faster dispersal along latitude in the past 10<sup>4</sup> generations is consistent with rapid post-glacial expansion. Previous studies have instead emphasized a rapid westward expansion of the non-relict lineages from an eastern glacial refugium, facilitated by relatively weak environmental gradients and, potentially, human movements and disturbance (<xref ref-type="bibr" rid="bib1">1001 Genomes Consortium, 2016</xref>; <xref ref-type="bibr" rid="bib61">Lee et al., 2017</xref>; <xref ref-type="bibr" rid="bib42">Hsu et al., 2019</xref>). It is possible that our longitudinal dispersal estimate would increase substantially if we included non-relict samples from further east.</p></sec><sec id="s2-4-2"><title>Visualizing major trends in geographic ancestries</title><p>We next used the trees at all sampled loci and our dispersal estimate to locate genetic ancestors. Our method provides an estimate of the location of the ancestor at every locus for every sample back through time, giving a rich resource for visualizing the geography of genetic ancestry. As a first step, we visualize the mean ancestral location for every sample at a given time, averaged over loci, to visualize major geographic trends and detect samples with unusual geographic ancestries (<xref ref-type="fig" rid="fig3">Figure 3</xref>). When locating ancestors we use the full trees, which relate every sample to every other, but use the dispersal estimate from a time cutoff of 10<sup>4</sup> generations and only locate ancestors back to that cutoff time.</p><p>Consistent with a rapid recent expansion of the non-relict ancestry (<xref ref-type="bibr" rid="bib61">Lee et al., 2017</xref>; <xref ref-type="bibr" rid="bib42">Hsu et al., 2019</xref>), lineages from the ‘Eurasian’ principle component group (hereafter, non-relicts) move relatively quickly towards each other when looking backwards in time, a visual display of their rapid coalescence over wide geographic distances. Looking forward through time (i.e., reversing the direction of the arrows), this rapid geographic expansion of non-relict ancestry is especially pronounced further north, as might be expected with retreating glaciers and more recent human disturbance (<xref ref-type="bibr" rid="bib61">Lee et al., 2017</xref>). The fact that the non-relict lineages are all pulled towards the bulk of non-relict samples, in southern France, highlights the limitations of sampling and methods based on contemporary data alone. The non-relicts likely spread from further east, with a refugium perhaps near the Black Sea (<xref ref-type="bibr" rid="bib61">Lee et al., 2017</xref>; <xref ref-type="bibr" rid="bib42">Hsu et al., 2019</xref>), but this dataset does not have enough samples in that area to infer this.</p><p>Meanwhile nearly all lineages from the ‘Iberian relict’ principle component group (hereafter, Iberian relicts) move relatively little, and towards themselves rather than towards the non-relict ancestors. This is a visual representation of the fact that much of the ancestry of these Iberian relicts has a very different geographic history than much of the non-relicts’ ancestry (<xref ref-type="bibr" rid="bib1">1001 Genomes Consortium, 2016</xref>; <xref ref-type="bibr" rid="bib30">Fulgione and Hancock, 2018</xref>). There are, however, two exceptions, with Iberian relicts Met-6 and Evs-12 having (overlapping) mean displacements that are much more typical of a non-relict. We explore these outliers more below.</p><p>Finally, we see that lineages from the ‘non-Iberian relict’ principle component group (hereafter, non-Iberian relicts) move towards the other samples, slightly more towards the Iberian relicts than the non-relicts. This movement is, however, relatively slow, emphasizing the known deep divergence of each of these samples with any other (<xref ref-type="bibr" rid="bib1">1001 Genomes Consortium, 2016</xref>; <xref ref-type="bibr" rid="bib31">Fulgione et al., 2018</xref>; <xref ref-type="bibr" rid="bib30">Fulgione and Hancock, 2018</xref>; <xref ref-type="bibr" rid="bib32">Fulgione et al., 2022</xref>).</p></sec><sec id="s2-4-3"><title>Visualizing the geographic sources of ancestry</title><p>We can also look at variation across loci in the geographic ancestry of a sample. We illustrate this while investigating the outliers above, the Iberian relicts with mean displacements more typical of a non-relict, Met-6 and Evs-12. In particular, we draw great circles connecting a sample’s location to that of each of its ancestors at a given time, and include a histogram of the direction to the ancestors (a ‘windrose’ plot).</p><p><xref ref-type="fig" rid="fig4">Figure 4</xref> compares four samples from Spain. The first is a typical non-relict (9883) whose ancestors are nearly all located to the northeast, as expected given the locations of the other non-relict samples and the proposed expansion from the east. The second is a typical Iberian relict (Hum-2) whose ancestors are mostly located just to the south of it, near the centre of the Iberian relict samples, as expected given the divergence between non-relicts and relicts and the longer history of relicts in the region. This sample also has a substantial fraction of ancestors to the northeast, likely illustrating some recent admixture from the non-relict ancestry. The third and fourth samples are the outlier Iberian relicts (Met-6 and Evs-12), who both have many ancestors that are located relatively far to the northeast, much like the non-relict. This likely reflects quite extensive admixture between Iberian relicts and non-relicts (<xref ref-type="bibr" rid="bib1">1001 Genomes Consortium, 2016</xref>; <xref ref-type="bibr" rid="bib30">Fulgione and Hancock, 2018</xref>), which can also be seen in the fact that the genealogical nearest neighbour proportions (<xref ref-type="bibr" rid="bib53">Kelleher et al., 2019</xref>) for these two samples are heavily weighted towards non-relicts (at roughly 75% and 83%, while the mean across all Iberian relicts is roughly 30%).</p><fig id="fig4" position="float"><label>Figure 4.</label><caption><title>Visualizing the geographic sources of ancestry.</title><p>Great circles connecting sample and ancestor locations at 878 loci 10<sup>4</sup> generations ago. Polar histograms (windroses) show the distribution of direction in ancestral locations from the sample. Non-relicts in blue, Iberian relicts in orange.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-72177-fig4-v2.tif"/></fig></sec><sec id="s2-4-4"><title>Visualizing the movement of geographic ancestries over time</title><p>We next looked at the entire distribution of genetic ancestor locations, over loci, for a given sample at a few given times (<xref ref-type="fig" rid="fig5">Figure 5</xref>). We see that the ancestors of the most northern sample (non-relict 9336) quickly move southwest towards the other non-relicts, illustrating a rapid northward expansion post-glaciation. In stark comparison, the ancestors of the most diverged sample (non-Iberian relict 22,005, in Madeira) move relatively little in the past 10<sup>4</sup> generations, consistent with estimates that <italic>A. thalaina</italic> colonized Madeira roughly 70,000 years ago (<xref ref-type="bibr" rid="bib30">Fulgione and Hancock, 2018</xref>).</p><fig id="fig5" position="float"><label>Figure 5.</label><caption><title>Visualizing the movement of geographic ancestries over time.</title><p>Ancestor locations at 878 loci (circles) and kernel density estimates (contours). Non-relicts in blue, non-Iberian relcits in green.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-72177-fig5-v2.tif"/></fig><p>There is a slight bimodality in the locations of the ancestors of the northern non-relict sample (9336) at later times. This bimodality also exists in the locations of the ancestors of the other sample from Sweden (non-relict 6137, not shown). It is tempting to wonder if this bimodality is a visualization of multiple pulses of northern expansions. In particular, based on the presence of abnormal amounts of relict ancestry in some northern samples, it has been hypothesized that relict lineages were present across much of Europe before being largely replaced, especially at midlatitudes, by a westward expansion of non-relict lineages (<xref ref-type="bibr" rid="bib61">Lee et al., 2017</xref>; <xref ref-type="bibr" rid="bib42">Hsu et al., 2019</xref>). These non-relict lineages are associated more with disturbed areas and so are expected to have arrived in the north more recently, and in lower numbers, explaining why some relict ancestry remains there. We therefore checked to see if the bimodality in ancestor locations of the Swedish samples could be explained by the placement of these focal samples in the corresponding trees. There was, however, no clear correlation between ancestor location and the proportion of genealogical nearest neighbours that were non-relict vs. Iberian relict. It of course remains possible there were multiple bouts of colonization, perhaps even from within a given principle component group, that could be visualized with other metrics.</p></sec><sec id="s2-4-5"><title>Visualizing the geographic ancestries of groups of samples</title><p>The dataset contains samples drawing ancestors from at least two hypothesized glacial refugia, including the non-relcits with ancestry predominately from a refuge near the Black Sea (<xref ref-type="bibr" rid="bib61">Lee et al., 2017</xref>; <xref ref-type="bibr" rid="bib42">Hsu et al., 2019</xref>) and the Iberian relict samples with substantial ancestry from a refuge in northern Africa (<xref ref-type="bibr" rid="bib1">1001 Genomes Consortium, 2016</xref>; <xref ref-type="bibr" rid="bib25">Durvasula et al., 2017</xref>; <xref ref-type="bibr" rid="bib30">Fulgione and Hancock, 2018</xref>). To visualize these alternative geographic ancestries we located the ancestors of all Iberian relicts and compared that distribution to the distribution of the locations of the ancestors of all non-relicts in mainland Spain (<xref ref-type="fig" rid="fig6">Figure 6</xref>). We see that the two ancestries are largely geographically overlapping in the past 10<sup>3</sup> generations but then begin to diverge due to the majority of non-relicts ancestors moving northeast. There is also considerable variation in the locations of both ancestries, emphasizing substantial admixture. Having a few samples from north Africa would likely pull many of the ancestors of the Iberian relict samples south, further emphasizing the divergent geographic histories.</p><fig id="fig6" position="float"><label>Figure 6.</label><caption><title>Visualizing the geographic ancestries of groups of samples.</title><p>Kernel density estimates (contours and marginal distributions) of the locations of ancestors at 878 loci for all Iberian relicts (orange) and all non-relicts in Spain (blue).</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-72177-fig6-v2.tif"/></fig></sec></sec></sec><sec id="s3" sec-type="discussion"><title>Discussion</title><sec id="s3-1"><title>Summary of main results</title><p>We have developed a method that uses a sequence of trees along a recombining genome – a genome-wide genealogy – to estimate individual-level dispersal rates and locate genetic ancestors (<xref ref-type="fig" rid="fig1">Figure 1</xref>). At the core of our method is a simple model of Brownian motion, allowing likelihoods to be quickly calculated from shared evolutionary times and sample locations. This also allows us to work in continuous space, negating the need to group individuals into discrete populations. On top of this we layer on importance sampling to correct for bias in inferred branch lengths and add a time cutoff to ignore strong violations of the model in the deep past. Simulation tests show that our method can estimate a meaningful effective dispersal rate and visualize major trends in geographic ancestries hundreds of generations into the past (<xref ref-type="fig" rid="fig2">Figure 2</xref>). Applying our method to <italic>A. thaliana</italic>, we estimate relatively rapid dispersal since the last glaciation, especially across latitude (<xref ref-type="fig" rid="fig3">Figure 3</xref>, inset), and show how locating genetic ancestors allows us to visualize (1) major trends in geographic ancestries (<xref ref-type="fig" rid="fig3">Figure 3</xref>), (2) the geographic sources of ancestry (<xref ref-type="fig" rid="fig4">Figure 4</xref>), (3) movements of individual geographic ancestries over time (<xref ref-type="fig" rid="fig5">Figure 5</xref>), and (4) the geographic ancestries of groups of samples (<xref ref-type="fig" rid="fig6">Figure 6</xref>).</p></sec><sec id="s3-2"><title>Comparison with previous methods</title><p>The idea of using trees to estimate continuous ancestral characters and their rate of change is an old one. This was originally applied to population-level characters, such as the frequency of genes in a population and their rate of genetic drift, in a phylogenetic context (<xref ref-type="bibr" rid="bib12">Cavalli-sforza et al., 1964</xref>; <xref ref-type="bibr" rid="bib13">Cavalli-Sforza and Edwards, 1967</xref>; <xref ref-type="bibr" rid="bib26">Edwards, 1970</xref>; <xref ref-type="bibr" rid="bib27">Felsenstein, 1973</xref>; <xref ref-type="bibr" rid="bib29">Felsenstein, 1985</xref>; <xref ref-type="bibr" rid="bib33">Grafen, 1989</xref>). DNA sequencing later allowed the inference of a single tree relating individual samples for a sufficiently long non-recombining sequence (as found on the human Y chromosome, in a mitochondrial genome, or in the nuclear genome of a predominately non-recombining species), which led to estimates of dispersal rates and ancestral locations under the banner of ‘phylogeography’ (<xref ref-type="bibr" rid="bib4">Avise, 2009</xref>; <xref ref-type="bibr" rid="bib56">Knowles, 2009</xref>). Phylogeography has proven incredibly useful, especially to infer the geographic origin and spread of viruses (<xref ref-type="bibr" rid="bib9">Biek et al., 2007</xref>; <xref ref-type="bibr" rid="bib62">Lemey et al., 2009</xref>; <xref ref-type="bibr" rid="bib63">Lemey et al., 2010</xref>; <xref ref-type="bibr" rid="bib8">Bedford et al., 2010</xref>; <xref ref-type="bibr" rid="bib101">Volz et al., 2013</xref>), such as SARS-CoV-2 (<xref ref-type="bibr" rid="bib112">Worobey et al., 2020</xref>; <xref ref-type="bibr" rid="bib64">Lemey et al., 2020</xref>; <xref ref-type="bibr" rid="bib20">Dellicour et al., 2021a</xref>; <xref ref-type="bibr" rid="bib21">Dellicour et al., 2021b</xref>; <xref ref-type="bibr" rid="bib69">Martin et al., 2021</xref>). Extending phylogeography to frequently recombining sequences is not straightforward as there are then many true trees that relate the samples. Only recently has it become feasible to infer the sequence of trees, and their branch lengths, along a recombining genome (<xref ref-type="bibr" rid="bib84">Rasmussen et al., 2014</xref>; <xref ref-type="bibr" rid="bib93">Speidel et al., 2019</xref>; <xref ref-type="bibr" rid="bib110">Wohns et al., 2021</xref>). Our method capitalizes on this advance to use some of the enormous amount of information contained in a tree sequence of a large sample in a recombining species.</p><p>A related method was demonstrated by <xref ref-type="bibr" rid="bib110">Wohns et al., 2021</xref>, who inferred the geographic location of coalescent nodes in a ‘succinct’ tree sequence (<xref ref-type="bibr" rid="bib52">Kelleher et al., 2018</xref>), where information about nodes and edges are shared between trees. Our approach differs from theirs in a number of ways. First, they utilize the sharing of information about nodes and edges across trees to very efficiently geographically locate every node exactly once, placing each ‘parent’ node at the midpoint between its two ‘child’ nodes locations and iterating up the entire tree sequence simultaneously (rather than up each local tree individually). In addition to being fast, this has the advantage of using information from all the trees in a tree sequence. In contrast, we locate ancestors independently at each local tree we consider. As some ancestors (represented as nodes and edges) are shared between nearby trees along the genome (though we do not know precisely for how long since we lose that information when converting the Relate-inferred genealogy into a tree sequence), we avoid locating the same ancestors multiple times by sparsely sampling the trees (e.g., here we used every 100th tree). (Note that while we choose trees that have low linkage disequilibrium with one another and are therefore essentially unlinked, in the very recent past they will share ancestors but will quickly become independent; <xref ref-type="bibr" rid="bib102">Wakeley et al., 2012</xref>.) Our approach therefore uses less of the information in the tree sequence, in this sense. On the other hand, when locating an ancestor we not only use information ‘below’ this ancestor (i.e., its descendants’ locations and relations) but also the information ‘above’ the ancestor, due to the ancestor’s lineage sharing time and a recent common ancestor with non-descendant lineages. Further advantages of our method include the ability to estimate dispersal rates and uncertainties in ancestor locations (as we have taken a parametric approach), as well as accounting for uncertainty in branch lengths using importance sampling (this could be extended to capture uncertainty in the topologies as well once they can be efficiently sampled).</p><p>Ideally, we would merge the two methods, to efficiently use information from all the (correlated) trees in the tree sequence and all the information above and below ancestors. Two recent approaches have developed in this direction. One approach (<xref ref-type="bibr" rid="bib36">Grundler et al., 2024</xref>) infers a dispersal rate and ancestral locations by placing each node at the location that minimizes a migration cost averaged over the trees in a succint tree sequence that the node appears in. A second approach (<xref ref-type="bibr" rid="bib23">Deraje et al., 2024</xref>) extends the branching Brownian motion model to the full ancestral recombination graph (as inferred using a program like ARGweaver; <xref ref-type="bibr" rid="bib84">Rasmussen et al., 2014</xref>), where the lineages meet each other forward-in-time at recombination nodes. Niether of these approaches yet account for uncertainty in tree inference.</p></sec><sec id="s3-3"><title>Future directions</title><p>We have chosen to use a very simple model of Brownian motion with a constant dispersal rate over time. Informally, we view this as a prior on the movement of the lineages, that can be overcome if the trees are informative about long-distance dispersal. However, there are a number of extensions that could readily be applied. For instance, we could allow dispersal rates to vary between branches (<xref ref-type="bibr" rid="bib75">O’Meara et al., 2006</xref>) and compare dispersal rates in different parts of a species’ range. Or we could model dispersal under a more complex model, like the early burst (<xref ref-type="bibr" rid="bib40">Harmon et al., 2010</xref>) or a Lévy process (<xref ref-type="bibr" rid="bib58">Landis et al., 2013</xref>), which may help identify periods of range expansion or sudden long-range dispersal. Alternatively, we could take a Bayesian approach, allowing much greater flexibility and the ability to incorporate many recent advances in phylogeography. For example, one could then model dispersal as a relaxed random walk (<xref ref-type="bibr" rid="bib63">Lemey et al., 2010</xref>), which may be more appropriate for sample locations that are very non-normal, and could incorporate habitat boundaries. Or, given that there is large variance in the inferred locations of distant ancestors at any one locus (<xref ref-type="bibr" rid="bib90">Schluter et al., 1997</xref>) but very many loci, we could take an ‘empirical Bayes’ approach and use the posteriors on ancestral locations over many loci to set a prior for a given locus. This might be especially helpful at deeper times, for example, tracing human ancestors back hundreds of thousands of years, where the noise in the ancestral location at any one locus is large, yet we can be relatively certain that the majority of lineages are in Africa. We might alternatively set priors to test hypotheses. For example, if we surmise there were multiple glacial refugia during the last glaciation we can set a prior on ancestral location with peaks at these hypothesized locations and infer what percent of a sample’s lineages descended from each. Models of ancestral locations based on past climatic- and ecological-niche models could provide a rich source of data for building such priors and, given the large amounts data available in recombining sequences, these models could be subject to rigorous model choice. Finally, it might also be interesting to use machine learning. For example, disperseNN (<xref ref-type="bibr" rid="bib92">Smith et al., 2023</xref>) and Locator (<xref ref-type="bibr" rid="bib7">Battey et al., 2020</xref>) use neural networks to estimate dispersal rates and infer the locations of extant individuals, respectively, from unphased genotype data. In essence, this means these methods simultaneously determine the relationships between samples and estimate spatial parameters. Separating these two steps by first inferring a tree sequence and then supplying the structure of this tree sequence to a machine learning method (<xref ref-type="bibr" rid="bib104">Whitehouse et al., 2024</xref>) may improve parameter estimates.</p><p>Our approach relies on the locations of the current day samples. While we have shown that we can learn much about the geographical history of a species with this approach, its accuracy is necessarily limited. For example, if historical parts of the range are undersampled in a particular dataset the method will struggle to locate ancestors in these regions, particularly further into the past, as we saw with the Iberian relicit samples with ancestry from a putative north African refugia. Similarly, if a species’ range has shifted such that few present day individuals exist in portions of the historic range, as is likely the case of <italic>A. thaliana</italic> in central Africa (<xref ref-type="bibr" rid="bib30">Fulgione and Hancock, 2018</xref>), we will often not infer ancestors to be in the currently sparsely occupied portions. Other large-scale movements, such as one ancestry replacing another (e.g., the non-relicts replacing the relicts in much of western Europe), may also partially obscure the geographic locations of ancestors. Over the past decade, we have learned about numerous large-scale movements in humans alongside the expansions of archaeological cultures, a fact fairly hidden from view by contemporary samples that only ancient DNA could bring to light (<xref ref-type="bibr" rid="bib91">Slatkin and Racimo, 2016</xref>; <xref ref-type="bibr" rid="bib85">Reich, 2018</xref>). One obvious way to improve our method then, is to include ancient samples. Given that it is now possible to include high-coverage ancient genomes in tree sequences (<xref ref-type="bibr" rid="bib94">Speidel et al., 2021</xref>; <xref ref-type="bibr" rid="bib110">Wohns et al., 2021</xref>), it is straightforward to include this information in our likelihoods (ancient samples are treated as any other, we calculate the shared times of these lineages with themselves and with all other sample lineages), influencing both our dispersal estimates and inferred ancestral locations. This should help, in particular, in locating ancestors that are closely related to the ancient samples and for detecting large-scale movements, such as range expansions, contractions, and replacements.</p></sec></sec><sec id="s4" sec-type="materials|methods"><title>Materials and methods</title><p>Here, we describe our methods to estimate dispersal rates and locate genetic ancestors and how we applied these to simulations and <italic>A. thaliana</italic>.</p><sec id="s4-1"><title>Dispersal rate</title><sec id="s4-1-1"><title>The probability distribution of the sample locations given a tree and the dispersal rate</title><p>Let <inline-formula><mml:math id="inf46"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">L</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> be the <inline-formula><mml:math id="inf47"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>d</mml:mi></mml:mstyle></mml:math></inline-formula> matrix of sample locations, with <inline-formula><mml:math id="inf48"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>n</mml:mi></mml:mstyle></mml:math></inline-formula> samples in <inline-formula><mml:math id="inf49"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>d</mml:mi></mml:mstyle></mml:math></inline-formula> dimensions. We first derive the probability distribution of <inline-formula><mml:math id="inf50"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">L</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> given a tree topology (a directed graph with <inline-formula><mml:math id="inf51"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mstyle></mml:math></inline-formula> nodes and <inline-formula><mml:math id="inf52"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mn>2</mml:mn><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mstyle></mml:math></inline-formula> edges), <inline-formula><mml:math id="inf53"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, and associated branch lengths (a vector of <inline-formula><mml:math id="inf54"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mn>2</mml:mn><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mstyle></mml:math></inline-formula> times), <inline-formula><mml:math id="inf55"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, which together describe the coalescent history of the sample, and the dispersal rate (<inline-formula><mml:math id="inf56"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>d</mml:mi><mml:mo>×</mml:mo><mml:mi>d</mml:mi></mml:mstyle></mml:math></inline-formula> covariance matrix), <inline-formula><mml:math id="inf57"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>. We derive this probability distribution, <inline-formula><mml:math id="inf58"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">L</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula>, by compounding the normally distributed dispersal events each generation to give Brownian motion down the tree in a similar manner to phylogenetic least squares regression (<xref ref-type="bibr" rid="bib33">Grafen, 1989</xref>; <xref ref-type="bibr" rid="bib18">Cornwell and Nakagawa, 2017</xref>).</p><p>Let <inline-formula><mml:math id="inf59"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">S</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> be the <inline-formula><mml:math id="inf60"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mstyle></mml:math></inline-formula> matrix of shared times (in generations) between each pair of sample lineages back to the root in the tree defined by <inline-formula><mml:math id="inf61"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf62"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>. Then, assuming per generation dispersal is multivariate normal with mean displacement 0 and covariance matrix <inline-formula><mml:math id="inf63"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, the probability distribution of the locations depends only on the shared times in the tree, <inline-formula><mml:math id="inf64"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">L</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">L</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">S</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula>. In fact, the locations are normally distributed around the MLE for the location of the most recent common ancestor, <inline-formula><mml:math id="inf65"><mml:mrow><mml:mover accent="true"><mml:msub><mml:mi mathvariant="bold">ℓ</mml:mi><mml:mi>A</mml:mi></mml:msub><mml:mo>^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msup><mml:mn>𝟏</mml:mn><mml:mo>⊺</mml:mo></mml:msup><mml:mo>⁢</mml:mo><mml:msubsup><mml:mi mathvariant="bold">𝐒</mml:mi><mml:mrow><mml:mi class="ltx_font_mathcaligraphic">𝒢</mml:mi><mml:mo>,</mml:mo><mml:mi class="ltx_font_mathcaligraphic">𝒯</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mn>𝟏</mml:mn></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msup><mml:mn>𝟏</mml:mn><mml:mo>⊺</mml:mo></mml:msup><mml:mo>⁢</mml:mo><mml:msubsup><mml:mi mathvariant="bold">𝐒</mml:mi><mml:mrow><mml:mi class="ltx_font_mathcaligraphic">𝒢</mml:mi><mml:mo>,</mml:mo><mml:mi class="ltx_font_mathcaligraphic">𝒯</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>⁢</mml:mo><mml:mi mathvariant="bold">𝐋</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> with a covariance that is the (Kronecker) product of the shared times and the dispersal rate, <inline-formula><mml:math id="inf66"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">S</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo>⊗</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> . Here, <bold>1</bold> is a column vector of <inline-formula><mml:math id="inf67"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>n</mml:mi></mml:mstyle></mml:math></inline-formula> ones.</p></sec><sec id="s4-1-2"><title>Mean centring</title><p>We can remove any dependence on the (unknown) location of the most recent common ancestor, <inline-formula><mml:math id="inf68"><mml:msub><mml:mi mathvariant="bold">ℓ</mml:mi><mml:mi>A</mml:mi></mml:msub></mml:math></inline-formula>, by mean centring the data (e.g., <xref ref-type="bibr" rid="bib60">Lee and Coop, 2017</xref>). In particular, we subtract the mean sample location from each sample location and drop one of the samples (as we lose a degree of freedom by centring). The mean-centred locations can be computed with <inline-formula><mml:math id="inf69"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">M</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">L</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, where <inline-formula><mml:math id="inf70"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">M</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> is an <inline-formula><mml:math id="inf71"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>×</mml:mo><mml:mi>n</mml:mi></mml:mstyle></mml:math></inline-formula> matrix with <inline-formula><mml:math id="inf72"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>/</mml:mo></mml:mrow><mml:mi>n</mml:mi></mml:mstyle></mml:math></inline-formula> on the diagonal and <inline-formula><mml:math id="inf73"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>/</mml:mo></mml:mrow><mml:mi>n</mml:mi></mml:mstyle></mml:math></inline-formula> elsewhere. The mean-centred shared times are <inline-formula><mml:math id="inf74"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">V</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">M</mml:mi></mml:mrow><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">S</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:msup><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">M</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>⊺</mml:mo></mml:mrow></mml:msup></mml:mstyle></mml:math></inline-formula>.</p><p>Similar to above, the probability distribution of the mean-centred locations only depends on the shared times, <inline-formula><mml:math id="inf75"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">V</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula>. These mean-centred locations are normally distributed around 0 with covariance <inline-formula><mml:math id="inf76"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">V</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo>⊗</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>.</p></sec><sec id="s4-1-3"><title>Chopping the tree</title><p>We will usually want to only consider lineages more recently than some cutoff time, <inline-formula><mml:math id="inf77"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>T</mml:mi></mml:mstyle></mml:math></inline-formula>, since deeper genealogical history may contain little geographic information (<xref ref-type="bibr" rid="bib106">Wilkins, 2004</xref>). When this is the case we cut the full tree of at <inline-formula><mml:math id="inf78"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>T</mml:mi></mml:mstyle></mml:math></inline-formula>, leaving us with <inline-formula><mml:math id="inf79"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>n</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>T</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">]</mml:mo></mml:mstyle></mml:math></inline-formula> subtrees, where all coalescent times are <inline-formula><mml:math id="inf80"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>≤</mml:mo><mml:mi>T</mml:mi></mml:mstyle></mml:math></inline-formula>. Treating each subtree independently, the probability distribution of the sample locations is the product of the probability distributions for the sample locations in each subtree,<disp-formula id="equ1"><mml:math id="m1"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munderover><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munderover><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">V</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf81"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> is the topology, <inline-formula><mml:math id="inf82"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> is the branch lengths, <inline-formula><mml:math id="inf83"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">V</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> is the (mean-centred) shared times, and <inline-formula><mml:math id="inf84"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> is the (mean-centred) sample locations for subtree <inline-formula><mml:math id="inf85"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>i</mml:mi></mml:mstyle></mml:math></inline-formula>. The (mean-centred) locations in subtree <inline-formula><mml:math id="inf86"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>i</mml:mi></mml:mstyle></mml:math></inline-formula> are normally distributed around 0 with covariance <inline-formula><mml:math id="inf87"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">V</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>⊗</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>.</p><p>Note that to mean centre we need at least two samples in a subtree. Given that we do not know the root location, when there is only one sample we do not have enough information to infer a dispersal rate from this subtree. We therefore ignore subtrees with only one sample.</p></sec><sec id="s4-1-4"><title>Importance sampling</title><p>The calculations above, which give the likelihood of the dispersal rate given the sample locations, are all predicated on knowing the tree with certainty, which will not be the case when inferring trees from genetic data. Furthermore, inferring a tree may involve assumptions (such as panmixia) that are inconsistent with the model we are using. To deal with uncertainty and sampling bias, we calculate the likelihood of our parameters given the data using importance sampling, a likelihood ratio, and Monte Carlo approximation. Importance sampling corrects the expectation of the likelihood by reweighting draws from an ‘incorrect’ (proposal) distribution to match the ‘correct’ (target) distribution. These importance weights downweight draws from the proposal distribution that are likely under the proposal distribution but unlikely under the target distribution and upweight draws that are likely in the target distribution and unlikely under the proposal distribution. Importance sampling has been applied to genealogies in a number of population genetic settings as coalescent models provide convenient priors on trees and it is often challenging to sample genealogies consistent with data (<xref ref-type="bibr" rid="bib35">Griffiths and Tavare, 1997</xref>; <xref ref-type="bibr" rid="bib95">Stephens and Donnelly, 2000</xref>; <xref ref-type="bibr" rid="bib70">Meligkotsidou and Fearnhead, 2007</xref>). See <xref ref-type="bibr" rid="bib96">Stern et al., 2019</xref><xref ref-type="bibr" rid="bib97">Stern et al., 2021</xref>; <xref ref-type="bibr" rid="bib96">Stern et al., 2019</xref> for recent applications of these ideas to marginal trees inferred along a recombining sequence, whose general approach we follow below.</p><p>The data we have are the locations of the samples, <inline-formula><mml:math id="inf88"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">L</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, and their haplotypes, <inline-formula><mml:math id="inf89"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">H</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> (a matrix with genomes as rows and sites as columns). From this data we want to infer two unknowns: a tree topology, <inline-formula><mml:math id="inf90"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, and the associated branch lengths, <inline-formula><mml:math id="inf91"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>. We then want to use these unknowns to estimate the likelihood of the dispersal rate, <inline-formula><mml:math id="inf92"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>. Put another way, we want to estimate <inline-formula><mml:math id="inf93"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">L</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">H</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>]</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula>, which is the likelihood of our parameters given the data, integrated over the unknowns.</p><p>Current methods to infer tree topologies and branch lengths along a recombining sequence (<xref ref-type="bibr" rid="bib84">Rasmussen et al., 2014</xref>; <xref ref-type="bibr" rid="bib93">Speidel et al., 2019</xref>; <xref ref-type="bibr" rid="bib53">Kelleher et al., 2019</xref>; <xref ref-type="bibr" rid="bib110">Wohns et al., 2021</xref>) assume panmictic, well-mixed populations. This implies we cannot sample topologies and branch lengths, <inline-formula><mml:math id="inf94"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf95"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, under our spatial model, creating bias. We correct this bias with importance sampling, weighting each likelihood by the probability of the topology and branch lengths under our spatial model, <inline-formula><mml:math id="inf96"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula>, relative to their probability under the panmictic model we are sampling from, <inline-formula><mml:math id="inf97"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">H</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula>. This allows us to integrate over topology and branch lengths from the panmictic model, giving a dispersal rate likelihood<disp-formula id="equ2"><label>(1)</label><mml:math id="m2"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mtable columnalign="right left right left right left right left right left right left" rowspacing="3pt" columnspacing="0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em" displaystyle="true"><mml:mtr><mml:mtd><mml:mrow><mml:mi mathvariant="normal">L</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mtd><mml:mtd><mml:mi/><mml:mo>:=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">L</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">H</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mstyle></mml:mtd></mml:mtr><mml:mtr><mml:mtd/><mml:mtd><mml:mi/><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="bold">H</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">L</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">H</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="bold">H</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>]</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mstyle></mml:mtd></mml:mtr></mml:mtable></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>The probabilities containing the genetic data, <inline-formula><mml:math id="inf98"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">H</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, are complicated to calculate. To simplify we divide by the likelihood of panmixia given the data, <inline-formula><mml:math id="inf99"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="normal">L</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">H</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula>, to work with the likelihood ratio<disp-formula id="equ3"><label>(2)</label><mml:math id="m3"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mtable columnalign="right left right left right left right left right left right left" rowspacing="3pt" columnspacing="0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em" displaystyle="true"><mml:mtr><mml:mtd><mml:mrow><mml:mi mathvariant="normal">L</mml:mi><mml:mi mathvariant="normal">R</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mtd><mml:mtd><mml:mi/><mml:mo>:=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mfrac><mml:mrow><mml:mrow><mml:mi mathvariant="normal">L</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="normal">L</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac></mml:mstyle></mml:mtd></mml:mtr><mml:mtr><mml:mtd/><mml:mtd><mml:mi/><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="bold">H</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">L</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">H</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="bold">H</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">H</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>]</mml:mo></mml:mrow></mml:mstyle></mml:mtd></mml:mtr><mml:mtr><mml:mtd/><mml:mtd><mml:mi/><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="bold">H</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">L</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">H</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">H</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>]</mml:mo></mml:mrow></mml:mstyle></mml:mtd></mml:mtr><mml:mtr><mml:mtd/><mml:mtd><mml:mi/><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="bold">H</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">H</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">L</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">H</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>]</mml:mo></mml:mrow></mml:mstyle></mml:mtd></mml:mtr><mml:mtr><mml:mtd/><mml:mtd><mml:mi/><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="bold">H</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">L</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>]</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mstyle></mml:mtd></mml:mtr></mml:mtable></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>The third step assumes the genetic data (<inline-formula><mml:math id="inf100"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">H</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>) is conditionally independent of the spatial parameters (<inline-formula><mml:math id="inf101"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> or panmixia) and locations (<inline-formula><mml:math id="inf102"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">L</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>) given the tree (<inline-formula><mml:math id="inf103"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf104"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>). We can approximate this expectation using Monte Carlo sampling,<disp-formula id="equ4"><label>(3)</label><mml:math id="m4"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mover><mml:mrow><mml:mrow><mml:mi mathvariant="normal">L</mml:mi><mml:mi mathvariant="normal">R</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>M</mml:mi></mml:mfrac><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:munderover><mml:mfrac><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">L</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>where the genealogies and branch lengths, <inline-formula><mml:math id="inf105"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf106"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula>, are sampled from the panmictic model, <inline-formula><mml:math id="inf107"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">H</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula>, using Markov chain Monte Carlo.</p><p>We make two final simplifications. First, we will use a model of branching Brownian motion for <inline-formula><mml:math id="inf108"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula> and the standard neutral coalescent for <inline-formula><mml:math id="inf109"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula>. Under both of these models the probability of the topology is equivalent (and uniform), <inline-formula><mml:math id="inf110"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula>. Second, we will use Relate (<xref ref-type="bibr" rid="bib93">Speidel et al., 2019</xref>) to infer topologies and branch lengths. Relate returns a single topology and allows resampling over branch lengths conditional on this topology. We therefore take the topology as given and integrate only over branch lengths. Putting these two simplifications together, the likelihood ratio becomes<disp-formula id="equ5"><label>(4)</label><mml:math id="m5"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mtable columnalign="right left right left right left right left right left right left" rowspacing="3pt" columnspacing="0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em" displaystyle="true"><mml:mtr><mml:mtd><mml:mrow><mml:mover><mml:mrow><mml:mrow><mml:mi mathvariant="normal">L</mml:mi><mml:mi mathvariant="normal">R</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:mtd><mml:mtd><mml:mi/><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mfrac><mml:mn>1</mml:mn><mml:mi>M</mml:mi></mml:mfrac><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:munderover><mml:mfrac><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">L</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac></mml:mstyle></mml:mtd></mml:mtr><mml:mtr><mml:mtd/><mml:mtd><mml:mi/><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mfrac><mml:mn>1</mml:mn><mml:mi>M</mml:mi></mml:mfrac><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:munderover><mml:mfrac><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">L</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac></mml:mstyle></mml:mtd></mml:mtr><mml:mtr><mml:mtd/><mml:mtd><mml:mi/><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mfrac><mml:mn>1</mml:mn><mml:mi>M</mml:mi></mml:mfrac><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:munderover><mml:mfrac><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">L</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac></mml:mstyle></mml:mtd></mml:mtr><mml:mtr><mml:mtd/><mml:mtd><mml:mi/><mml:mo>≈</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mfrac><mml:mn>1</mml:mn><mml:mi>M</mml:mi></mml:mfrac><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:munderover><mml:mfrac><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">L</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mstyle></mml:mtd></mml:mtr></mml:mtable></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>where the branch lengths, <inline-formula><mml:math id="inf111"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula>, are sampled from <inline-formula><mml:math id="inf112"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">H</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula> using Markov chain Monte Carlo. Note that because the probability of a topology is the same in the two models, and therefore cancels out, our method can immediately be extended to integrate over both topologies and branch lengths. Future work could integrate over both topologies and branch lengths with other software (<xref ref-type="bibr" rid="bib84">Rasmussen et al., 2014</xref>; <xref ref-type="bibr" rid="bib110">Wohns et al., 2021</xref>) or by running Relate on subsamples of the genomes and integrating over subsamples.</p><p>We next show how we derive the probability distributions of the branch lengths in the tree that we use as the weights in the importance sampler, <inline-formula><mml:math id="inf113"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf114"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula>.</p></sec><sec id="s4-1-5"><title>The probability distribution of the branch lengths given a tree topology and panmixia</title><p>Relate and other tree construction methods infer the branch lengths in the trees under a model of panmixia with variable population size through time (with this demographic history inferred from the same haplotypes as part of the method). The probability distribution of these branch lengths given the tree topology and panmixia, <inline-formula><mml:math id="inf115"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula>, can be derived from the standard neutral coalescent allowing for (stepwise) changing effective population size (<xref ref-type="bibr" rid="bib34">Griffiths and Tavaré, 1994</xref>; <xref ref-type="bibr" rid="bib70">Meligkotsidou and Fearnhead, 2007</xref>).</p><p>Let the number of samples be <inline-formula><mml:math id="inf116"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>n</mml:mi></mml:mstyle></mml:math></inline-formula> and let <inline-formula><mml:math id="inf117"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>u</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> be the <inline-formula><mml:math id="inf118"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msup><mml:mi>i</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="normal">t</mml:mi><mml:mi mathvariant="normal">h</mml:mi></mml:mrow></mml:mrow></mml:msup></mml:mstyle></mml:math></inline-formula> most recent coalescence time (as determined by the branch lengths). The coalescence times are produced by a Markov process, where the probability of the <inline-formula><mml:math id="inf119"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msup><mml:mi>i</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>t</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:msup></mml:mstyle></mml:math></inline-formula> coalescence being at time <inline-formula><mml:math id="inf120"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>u</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> is independent of the other coalescence times once conditioned on the time of the previous coalescence, <inline-formula><mml:math id="inf121"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>u</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula>. The probability distribution of the branch lengths can therefore be written<disp-formula id="equ6"><label>(5)</label><mml:math id="m6"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>U</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>u</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>u</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>Between time <inline-formula><mml:math id="inf122"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>u</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf123"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>u</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> we have <inline-formula><mml:math id="inf124"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula> lineages. The coalescence time <inline-formula><mml:math id="inf125"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>u</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> is then approximately distributed as a time-inhomogeneous exponential random variable with instantaneous rate <inline-formula><mml:math id="inf126"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>λ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>u</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:mo maxsize="2.047em" minsize="2.047em">(</mml:mo></mml:mrow><mml:mfrac linethickness="0pt"><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:mfrac><mml:mrow><mml:mo maxsize="2.047em" minsize="2.047em">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mn>2</mml:mn><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>u</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula>, where <inline-formula><mml:math id="inf127"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula> is the effective population size at time <inline-formula><mml:math id="inf128"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>t</mml:mi></mml:mstyle></mml:math></inline-formula> in the past, giving<disp-formula id="equ7"><label>(6)</label><mml:math id="m7"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mtable columnalign="right left right left right left right left right left right left" rowspacing="3pt" columnspacing="0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em" displaystyle="true"><mml:mtr><mml:mtd><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>U</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mtd><mml:mtd><mml:mi/><mml:mo>=</mml:mo><mml:msub><mml:mi>u</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>u</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd/><mml:mtd><mml:mi/><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mo maxsize="2.047em" minsize="2.047em">(</mml:mo></mml:mrow><mml:mfrac linethickness="0pt"><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:mfrac><mml:mrow><mml:mo maxsize="2.047em" minsize="2.047em">)</mml:mo></mml:mrow></mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>2</mml:mn><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>u</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mrow><mml:mo maxsize="2.047em" minsize="2.047em">(</mml:mo></mml:mrow><mml:mfrac linethickness="0pt"><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:mfrac><mml:mrow><mml:mo maxsize="2.047em" minsize="2.047em">)</mml:mo></mml:mrow></mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mi mathvariant="normal">Λ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>u</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mi mathvariant="normal">Λ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>u</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mstyle></mml:mtd></mml:mtr></mml:mtable></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>with<disp-formula id="equ8"><label>(7)</label><mml:math id="m8"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi mathvariant="normal">Λ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>u</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msubsup><mml:mo>∫</mml:mo><mml:mn>0</mml:mn><mml:mi>u</mml:mi></mml:msubsup><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>2</mml:mn><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mrow><mml:mi mathvariant="normal">d</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>the cumulative coalescence rate up to time <inline-formula><mml:math id="inf129"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>u</mml:mi></mml:mstyle></mml:math></inline-formula>.</p><p>When the effective population size is piecewise constant, split into <inline-formula><mml:math id="inf130"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>K</mml:mi></mml:mstyle></mml:math></inline-formula> epochs with effective population size <inline-formula><mml:math id="inf131"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>N</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> between time <inline-formula><mml:math id="inf132"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>τ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf133"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>τ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula>, then the cumulative coalescence rate is (see Appendix A of <xref ref-type="bibr" rid="bib97">Stern et al., 2021</xref>)<disp-formula id="equ9"><label>(8)</label><mml:math id="m9"><mml:mi mathvariant="normal">Λ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>u</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>b</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>u</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:munderover><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>2</mml:mn><mml:msub><mml:mi>N</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>τ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>τ</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>]</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>2</mml:mn><mml:msub><mml:mi>N</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>b</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>u</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo stretchy="false">(</mml:mo><mml:mi>u</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>τ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>b</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>u</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf134"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>b</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>u</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">x</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>k</mml:mi><mml:mo>∈</mml:mo><mml:mo fence="false" stretchy="false">{</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mo>,</mml:mo><mml:mi>K</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo fence="false" stretchy="false">}</mml:mo><mml:mo>:</mml:mo><mml:mi>u</mml:mi><mml:mo>&gt;</mml:mo><mml:msub><mml:mi>τ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula> is the last epoch to end before time <inline-formula><mml:math id="inf135"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>u</mml:mi></mml:mstyle></mml:math></inline-formula>.</p><p>If we only want the probability density of coalescence times back as far as time <inline-formula><mml:math id="inf136"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>T</mml:mi></mml:mstyle></mml:math></inline-formula>, we consider only these <inline-formula><mml:math id="inf137"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>m</mml:mi><mml:mo>≤</mml:mo><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mstyle></mml:math></inline-formula> coalescence times and then multiply the probability density of these times by the probability of no coalescence between time <inline-formula><mml:math id="inf138"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>u</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf139"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>T</mml:mi></mml:mstyle></mml:math></inline-formula>,<disp-formula id="equ10"><label>(9)</label><mml:math id="m10"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mtable columnalign="left left" rowspacing="4pt" columnspacing="1em"><mml:mtr><mml:mtd/><mml:mtd><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd/><mml:mtd><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mrow><mml:mo maxsize="2.047em" minsize="2.047em">(</mml:mo></mml:mrow><mml:mfrac linethickness="0pt"><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mi>m</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:mfrac><mml:mrow><mml:mo maxsize="2.047em" minsize="2.047em">)</mml:mo></mml:mrow></mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mi mathvariant="normal">Λ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mi mathvariant="normal">Λ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>u</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:munderover><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>U</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>u</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>u</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mstyle></mml:mtd></mml:mtr></mml:mtable></mml:mstyle></mml:mrow></mml:math></disp-formula></p></sec><sec id="s4-1-6"><title>The probability distribution of the branch lengths given a tree topology and our spatial model</title><p>A number of spatial models of the coalescent have been developed. However, for our purposes many are computational challenging to work with and so we pursue a simpler, analytically tractable approximation called branching Brownian motion, or the Brownian–Yule process. Such approximations have been used previously to approximate genealogies on short time scales (<xref ref-type="bibr" rid="bib26">Edwards, 1970</xref>; <xref ref-type="bibr" rid="bib83">Rannala and Yang, 1996</xref>; <xref ref-type="bibr" rid="bib70">Meligkotsidou and Fearnhead, 2007</xref>). We view the rate of branching (<inline-formula><mml:math id="inf140"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>λ</mml:mi></mml:mstyle></mml:math></inline-formula>) in the branching Brownian motion process as a nuisance parameter, but informally it is proportional to the inverse of the local population density and so it might be a useful parameter to explore in future work (for a recent application see <xref ref-type="bibr" rid="bib86">Ringbauer et al., 2017</xref>).</p><p>Let <inline-formula><mml:math id="inf141"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>T</mml:mi></mml:mstyle></mml:math></inline-formula> be the time in the past we wish to start the process (which in practice will be no greater than the time to the most recent common ancestor in the tree). Let <inline-formula><mml:math id="inf142"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>n</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> be the number of ancestral lineages at this time. Taking a forward in time perspective, let <inline-formula><mml:math id="inf143"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msubsup><mml:mi>u</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-variant" mathvariant="normal">′</mml:mi></mml:mrow></mml:msubsup></mml:mstyle></mml:math></inline-formula> be the time at which we go from <inline-formula><mml:math id="inf144"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>i</mml:mi></mml:mstyle></mml:math></inline-formula> to <inline-formula><mml:math id="inf145"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mstyle></mml:math></inline-formula> lineages (<inline-formula><mml:math id="inf146"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msubsup><mml:mi>u</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-variant" mathvariant="normal">′</mml:mi></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mi>T</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>u</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula>). Then under a pure birth (Yule) process with per capita birth rate <inline-formula><mml:math id="inf147"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>λ</mml:mi></mml:mstyle></mml:math></inline-formula> the joint probability density of the <inline-formula><mml:math id="inf148"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> birth times and ending up with <inline-formula><mml:math id="inf149"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>n</mml:mi></mml:mstyle></mml:math></inline-formula> samples (i.e., no birth once <inline-formula><mml:math id="inf150"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>n</mml:mi></mml:mstyle></mml:math></inline-formula> lineages existed) is<disp-formula id="equ11"><label>(10)</label><mml:math id="m11"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mtable columnalign="right left right left right left right left right left right left" rowspacing="3pt" columnspacing="0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em" displaystyle="true"><mml:mtr><mml:mtd><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">u</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:mo>,</mml:mo><mml:mi>n</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>λ</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mtd><mml:mtd><mml:mi/><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:mi>λ</mml:mi><mml:mi>i</mml:mi><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mo>−</mml:mo><mml:mi>λ</mml:mi><mml:mi>i</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>u</mml:mi><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msubsup><mml:mo>−</mml:mo><mml:msubsup><mml:mi>u</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>′</mml:mo></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mo>−</mml:mo><mml:mi>λ</mml:mi><mml:mi>n</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>T</mml:mi><mml:mo>−</mml:mo><mml:msubsup><mml:mi>u</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>′</mml:mo></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo></mml:mstyle></mml:mtd></mml:mtr><mml:mtr><mml:mtd/><mml:mtd><mml:mi/><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msup><mml:mi>λ</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:msup><mml:mfrac><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>!</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>!</mml:mo></mml:mrow></mml:mfrac><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mi>λ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:mi>T</mml:mi><mml:mo>+</mml:mo><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msubsup><mml:mi>u</mml:mi><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mstyle></mml:mtd></mml:mtr></mml:mtable></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>where we have defined the starting time of the process <inline-formula><mml:math id="inf151"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msubsup><mml:mi>u</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:msub><mml:mi>n</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-variant" mathvariant="normal">′</mml:mi></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mstyle></mml:math></inline-formula>.</p><p>The probability that <inline-formula><mml:math id="inf152"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>n</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> lineages produce exactly <inline-formula><mml:math id="inf153"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>n</mml:mi></mml:mstyle></mml:math></inline-formula> lineages in time <inline-formula><mml:math id="inf154"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>T</mml:mi></mml:mstyle></mml:math></inline-formula> under a pure birth process is given by a negative binomial with <inline-formula><mml:math id="inf155"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> successes, <inline-formula><mml:math id="inf156"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>n</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> failures, and success probability <inline-formula><mml:math id="inf157"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mi>λ</mml:mi><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula>,<disp-formula id="equ12"><label>(11)</label><mml:math id="m12"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>λ</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:mo maxsize="2.047em" minsize="2.047em">(</mml:mo></mml:mrow><mml:mfrac linethickness="0pt"><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:mfrac><mml:mrow><mml:mo maxsize="2.047em" minsize="2.047em">)</mml:mo></mml:mrow></mml:mrow><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mi>λ</mml:mi><mml:mi>T</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mi>λ</mml:mi><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msup><mml:mo stretchy="false">]</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:msup><mml:mo>.</mml:mo></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>The probability distribution of the branch lengths under the Yule process, which we take to be the probability of the branch lengths given the topology and the spatial model, is therefore proportional to the ratio of <xref ref-type="disp-formula" rid="equ11 equ12">Equations 10 and 11</xref>,<disp-formula id="equ13"><label>(12)</label><mml:math id="m13"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mtable columnalign="right left right left right left right left right left right left" rowspacing="3pt" columnspacing="0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em" displaystyle="true"><mml:mtr><mml:mtd><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>T</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>G</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mtd><mml:mtd><mml:mi/><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msup><mml:mi mathvariant="bold">u</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>λ</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi>T</mml:mi><mml:mo>,</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd/><mml:mtd><mml:mi/><mml:mo>∝</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mfrac><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">u</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msup><mml:mo>,</mml:mo><mml:mi>n</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>λ</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>λ</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>,</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:mrow></mml:mfrac></mml:mstyle></mml:mtd></mml:mtr><mml:mtr><mml:mtd/><mml:mtd><mml:mi/><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>!</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mfrac><mml:mrow><mml:mi>λ</mml:mi><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mi>λ</mml:mi><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mi>λ</mml:mi><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:msup><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mi>λ</mml:mi><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:munderover><mml:msubsup><mml:mi>u</mml:mi><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>Note that the branching times are independent of the dispersal rate given the topology, <inline-formula><mml:math id="inf158"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>T</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>G</mml:mi><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>T</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>G</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula>, under this relatively simple spatial model. See <xref ref-type="bibr" rid="bib26">Edwards, 1970</xref>; <xref ref-type="bibr" rid="bib83">Rannala and Yang, 1996</xref>; <xref ref-type="bibr" rid="bib70">Meligkotsidou and Fearnhead, 2007</xref> for more on the Yule process.</p></sec><sec id="s4-1-7"><title>Conditioning on sampling locations</title><p>As many studies choose sampling locations before choosing samples, we would like to condition on sampling locations in our inferences of dispersal rate, i.e., use the conditional likelihood <inline-formula><mml:math id="inf159"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">L</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>/</mml:mo></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">L</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula>. The denominator, <inline-formula><mml:math id="inf160"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">L</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula>, is the probability distribution of the locations of the descendent tips of a branching Brownian motion given the dispersal rate. This is the numerator, <inline-formula><mml:math id="inf161"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">L</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula>, after the genealogy and branch times have been integrated out. Calculating the integrals over genealogies and branch times could be achieved by Monte Carlo simulation, but would be computationally intensive. However, as shown by <xref ref-type="bibr" rid="bib70">Meligkotsidou and Fearnhead, 2007</xref>, in one dimension (say <inline-formula><mml:math id="inf162"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>x</mml:mi></mml:mstyle></mml:math></inline-formula>) the probability distribution of the locations, <inline-formula><mml:math id="inf163"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">L</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>x</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula>, is independent of dispersal, <inline-formula><mml:math id="inf164"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>σ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula>, if a scale invariant prior is placed on the branching rate. Intuitively, this follows from the fact that if we do not a priori know the scale of the coalescence rate then we do not know a priori how long the branch lengths are, and so we do not know how fast lineages need to disperse to get to where they are today. Therefore, in that case, conditioning on the locations does not change the likelihood surface of <inline-formula><mml:math id="inf165"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>σ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> and so can be ignored in the inference of dispersal. This result also holds in two dimensions if we constrain <inline-formula><mml:math id="inf166"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>σ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>x</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>σ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula>. Sadly, it does not hold in general for an arbitrary dispersal matrix <inline-formula><mml:math id="inf167"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>. For example, if our samples (the end points of a branching Brownian motion) were distributed widely along the <inline-formula><mml:math id="inf168"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>x</mml:mi></mml:mstyle></mml:math></inline-formula> axis but varied little in displacement along the <inline-formula><mml:math id="inf169"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>y</mml:mi></mml:mstyle></mml:math></inline-formula> axis, this would be more likely if <inline-formula><mml:math id="inf170"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>σ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>/</mml:mo></mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>x</mml:mi></mml:mrow></mml:msub><mml:mo>≪</mml:mo><mml:mn>1</mml:mn></mml:mstyle></mml:math></inline-formula>. Thus, while the overall magnitude of dispersal is not affected by conditioning on the sampling locations, the anisotropy of dispersal may be.</p></sec><sec id="s4-1-8"><title>Composite likelihood over loci</title><p>To use information from multiple loci, for eaxmple, to estimate a genome-wide dispersal rate, we can multiply the likelihood ratios together to give a composite likelihood ratio. This is not the full likelihood because it ignores correlations in the genealogical and spatial processes between loci (<xref ref-type="bibr" rid="bib43">Hudson, 2001</xref>; <xref ref-type="bibr" rid="bib59">Larribe and Fearnhead, 2011</xref>; <xref ref-type="bibr" rid="bib99">Varin, 2011</xref>). The maximum likelihood of genome-wide parameters from composite likelihood are known to be statistically consistent in the presence of such correlations (<xref ref-type="bibr" rid="bib108">Wiuf, 2006</xref>), but the likelihood surface is overly peaked due to ignoring the correlations in the data. However, in practice we try to take loci that are far enough apart that their trees are only weakly correlated more than a few tens of generations back.</p></sec><sec id="s4-1-9"><title>Maximum likelihood estimates</title><p>The likelihood of the dispersal rate given the shared times and sample locations in a tree is <inline-formula><mml:math id="inf171"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">L</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">S</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula>. This implies the MLE of the dispersal rate is<disp-formula id="equ14"><label>(13)</label><mml:math id="m14"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">L</mml:mi></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mn mathvariant="bold">1</mml:mn></mml:mrow><mml:mrow><mml:mover><mml:msub><mml:mi mathvariant="bold-italic">ℓ</mml:mi><mml:mi>A</mml:mi></mml:msub><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mo>⊺</mml:mo></mml:msup><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">S</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">L</mml:mi></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mn mathvariant="bold">1</mml:mn></mml:mrow><mml:mrow><mml:mover><mml:msub><mml:mi mathvariant="bold-italic">ℓ</mml:mi><mml:mi>A</mml:mi></mml:msub><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mi>n</mml:mi></mml:mfrac><mml:mo>.</mml:mo></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>This estimate is, however, biased because it relies on the unknown location of the root of the tree. Using the mean-centred likelihood, <inline-formula><mml:math id="inf172"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">V</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula>, the restricted MLE of the dispersal rate given for subtree <inline-formula><mml:math id="inf173"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>j</mml:mi></mml:mstyle></mml:math></inline-formula> is<disp-formula id="equ15"><label>(14)</label><mml:math id="m15"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msup><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mo>∗</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mo>⊺</mml:mo></mml:msup><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">V</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>which is unbiased and equivalent to <inline-formula><mml:math id="inf174"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>n</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mover><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>/</mml:mo></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula>.</p><p>When we chop a tree into subtrees and multiply the (mean-centred) likelihoods over subtrees, the (restricted) maximum likelihood dispersal rate becomes a weighted average of the (restricted) maximum likelihood dispersal rates from each subtree,<disp-formula id="equ16"><label>(15)</label><mml:math id="m16"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msup><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mo>∗</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:munder><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mi>j</mml:mi><mml:mo>∗</mml:mo></mml:msubsup></mml:mrow><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:munder><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf175"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msubsup><mml:mrow class="MJX-TeXAtom-ORD"><mml:mover><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>j</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>∗</mml:mo></mml:mrow></mml:msubsup></mml:mstyle></mml:math></inline-formula> is the (restricted) maximum likelihood dispersal rate from subtree <inline-formula><mml:math id="inf176"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>j</mml:mi></mml:mstyle></mml:math></inline-formula> (calculated as above) and <inline-formula><mml:math id="inf177"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>n</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> is the number of samples in subtree <inline-formula><mml:math id="inf178"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>j</mml:mi></mml:mstyle></mml:math></inline-formula>.</p><p>Similarly, when we then also multiply (mean-centred) likelihoods across loci the (restricted) maximum likelihood dispersal rate is a weighted average of the (restricted) estimates over the subtrees at all loci,<disp-formula id="equ17"><label>(16)</label><mml:math id="m17"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msup><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mo>∗</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:munder><mml:munder><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:munder><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mo>∗</mml:mo></mml:msubsup></mml:mrow><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:munder><mml:munder><mml:mo>∑</mml:mo><mml:mi>j</mml:mi></mml:munder><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf179"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msubsup><mml:mrow class="MJX-TeXAtom-ORD"><mml:mover><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>∗</mml:mo></mml:mrow></mml:msubsup></mml:mstyle></mml:math></inline-formula> is the restricted maximum likelihood dispersal rate from subtree <inline-formula><mml:math id="inf180"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>j</mml:mi></mml:mstyle></mml:math></inline-formula> at locus <inline-formula><mml:math id="inf181"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>i</mml:mi></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf182"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>n</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> is the number of samples in subtree <inline-formula><mml:math id="inf183"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>j</mml:mi></mml:mstyle></mml:math></inline-formula> at locus <inline-formula><mml:math id="inf184"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>i</mml:mi></mml:mstyle></mml:math></inline-formula>.</p><p>Unfortunately, there is no analytical expression for the maximum likelihood dispersal rate with importance sampling, and so we instead numerically search for the dispersal rate (and branching rate, <inline-formula><mml:math id="inf185"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>λ</mml:mi></mml:mstyle></mml:math></inline-formula>) which minimizes the negative log composite likelihood ratio (the negative log of the product of <xref ref-type="disp-formula" rid="equ5">Equation 4</xref> over loci). We perform this search in Python with scipy’s optimize.minimize function (<xref ref-type="bibr" rid="bib100">Virtanen et al., 2020</xref>) using the L-BFGS-B method, which allows us to implement bounds (the standard deviations must be non-negative and the correlation must be between −1 and 1). We initialize the search with the BLUP of the dispersal rate (below). To initialize the branching rate we first solve <inline-formula><mml:math id="inf186"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>n</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>λ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula> for <inline-formula><mml:math id="inf187"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>λ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula>, giving <inline-formula><mml:math id="inf188"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>λ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>ln</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>/</mml:mo></mml:mrow><mml:mi>n</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>/</mml:mo></mml:mrow><mml:mi>t</mml:mi></mml:mstyle></mml:math></inline-formula>, where <inline-formula><mml:math id="inf189"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>n</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula> is the number of samples, <inline-formula><mml:math id="inf190"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>n</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula> is the initial number of lineages in a tree, and <inline-formula><mml:math id="inf191"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>t</mml:mi></mml:mstyle></mml:math></inline-formula> is the length of the tree. We then average <inline-formula><mml:math id="inf192"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>λ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> over all trees and loci.</p></sec><sec id="s4-1-10"><title>Best linear unbiased predictor</title><p>There is an analytical approximation to the maximum likelihood dispersal rate when we sample multiple trees per locus but ignore the importance weights (we need to ignore the importance weights because we do not know the branching rate, <inline-formula><mml:math id="inf193"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>λ</mml:mi></mml:mstyle></mml:math></inline-formula>, without doing a numerical search). Let <inline-formula><mml:math id="inf194"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msubsup><mml:mrow class="MJX-TeXAtom-ORD"><mml:mover><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>∗</mml:mo></mml:mrow></mml:msubsup></mml:mstyle></mml:math></inline-formula> be the (restricted) maximum likelihood dispersal rate from tree <inline-formula><mml:math id="inf195"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>j</mml:mi></mml:mstyle></mml:math></inline-formula> at locus <inline-formula><mml:math id="inf196"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>i</mml:mi></mml:mstyle></mml:math></inline-formula> (as calculated from <xref ref-type="disp-formula" rid="equ1">Equation 15</xref>). Averaging this over all trees and loci then gives a BLUP of the (restricted) maximum likelihood dispersal rate. In the main text we numerically search for the (restricted) maximum likelihood dispersal rate, which allows us to include importance weights and more accurately infers simulated dispersal rates, but we implement the BLUP method in our software as it can be a useful way to quickly get a rough estimate of dispersal while still accounting for tree uncertainty. For both simulations and <italic>Arabidopsis</italic>, the BLUP dispersal rate tended to be roughly twice that of the MLE dispersal rate.</p></sec></sec><sec id="s4-2"><title>Ancestor locations</title><sec id="s4-2-1"><title>The probability distribution of an ancestor locations given a tree and the dispersal rate</title><p>A point on a tree represents a genetic ancestor. Choosing one such point, if the ancestor’s lineage shares <inline-formula><mml:math id="inf197"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">s</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>a</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> time with each of the sample lineages and <inline-formula><mml:math id="inf198"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>s</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>a</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> time with itself, then, by the properties of the conditional normal distribution, the probability that the ancestor was at location <inline-formula><mml:math id="inf199"><mml:msub><mml:mi mathvariant="bold">ℓ</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:math></inline-formula> is normally distributed around<disp-formula id="equ18"><label>(17)</label><mml:math id="m18"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mover><mml:msub><mml:mi mathvariant="bold-italic">ℓ</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mover><mml:msub><mml:mi mathvariant="bold-italic">ℓ</mml:mi><mml:mi>A</mml:mi></mml:msub><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">s</mml:mi></mml:mrow><mml:mi>a</mml:mi><mml:mo>⊺</mml:mo></mml:msubsup><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">S</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">L</mml:mi></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mn mathvariant="bold">1</mml:mn></mml:mrow><mml:mrow><mml:mover><mml:msub><mml:mi mathvariant="bold-italic">ℓ</mml:mi><mml:mi>A</mml:mi></mml:msub><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>with covariance<disp-formula id="equ19"><label>(18)</label><mml:math id="m19"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold">S</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">s</mml:mi></mml:mrow><mml:mi>a</mml:mi><mml:mo>⊺</mml:mo></mml:msubsup><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">S</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi mathvariant="bold">s</mml:mi></mml:mrow><mml:mi>a</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo>.</mml:mo></mml:mstyle></mml:mrow></mml:math></disp-formula></p></sec><sec id="s4-2-2"><title>Mean centring</title><p>This approach gives the correct mean (<xref ref-type="disp-formula" rid="equ1">Equation 17</xref>) but the uncertainty (<xref ref-type="disp-formula" rid="equ19">Equation 18</xref>) is incorrect because the approach implicitly assumes we know with certainty where the most recent common ancestor was.</p><p>The correct uncertainty is derived by mean centring. The mean-centred sample locations, <inline-formula><mml:math id="inf200"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">X</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, and shared times among the samples, <inline-formula><mml:math id="inf201"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">V</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula>, are described above. The mean-centred vector of shared times between the ancestor and the samples is found by calculating the covariances between their mean-centred locations, giving <inline-formula><mml:math id="inf202"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">v</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">M</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">s</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mover><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">s</mml:mi></mml:mrow><mml:mo accent="false">¯</mml:mo></mml:mover><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula>, where <inline-formula><mml:math id="inf203"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>M</mml:mi></mml:mstyle></mml:math></inline-formula> is the mean-centring matrix (defined above) and <inline-formula><mml:math id="inf204"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mover><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">s</mml:mi></mml:mrow><mml:mo accent="false">¯</mml:mo></mml:mover><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> is the mean shared time of each sample over all others. The mean-centred shared time of the ancestor with itself is found by calculating the variance in its mean-centred location, giving <inline-formula><mml:math id="inf205"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>v</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:msub><mml:mover><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">s</mml:mi></mml:mrow><mml:mo accent="false">¯</mml:mo></mml:mover><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mover><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">s</mml:mi></mml:mrow><mml:mo accent="false">¯</mml:mo></mml:mover></mml:mstyle></mml:math></inline-formula>, where <inline-formula><mml:math id="inf206"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mover><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">s</mml:mi></mml:mrow><mml:mo accent="false">¯</mml:mo></mml:mover><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>a</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> is the mean shared time of the ancestor over all samples and <inline-formula><mml:math id="inf207"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mover><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">s</mml:mi></mml:mrow><mml:mo accent="false">¯</mml:mo></mml:mover></mml:mstyle></mml:math></inline-formula> is the average over all elements of <inline-formula><mml:math id="inf208"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">S</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula>.</p><p>The probability the ancestor was at location <inline-formula><mml:math id="inf209"><mml:msub><mml:mi mathvariant="bold">ℓ</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:math></inline-formula> is then normally distributed with mean as above but now written<disp-formula id="equ20"><label>(19)</label><mml:math id="m20"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mover><mml:msub><mml:mi mathvariant="bold-italic">ℓ</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mo>=</mml:mo><mml:mover><mml:mrow><mml:mi mathvariant="bold">L</mml:mi></mml:mrow><mml:mo accent="false">¯</mml:mo></mml:mover><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">v</mml:mi></mml:mrow><mml:mi>a</mml:mi><mml:mo>⊺</mml:mo></mml:msubsup><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">V</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>and covariance<disp-formula id="equ21"><label>(20)</label><mml:math id="m21"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msup><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold">S</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mo>∗</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>v</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">v</mml:mi></mml:mrow><mml:mi>a</mml:mi><mml:mo>⊺</mml:mo></mml:msubsup><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">V</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi mathvariant="bold">v</mml:mi></mml:mrow><mml:mi>a</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo>,</mml:mo></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf210"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mover><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">L</mml:mi></mml:mrow><mml:mo accent="false">¯</mml:mo></mml:mover></mml:mstyle></mml:math></inline-formula> is the mean location of the samples.</p><p>This covariance gives the correct uncertainty. For example, it produces a linear increase in the variance of the location as we move up from a sample when there is only a single sample, that is, this is simple Brownian motion. When there are two samples with a recent common ancestor at time <inline-formula><mml:math id="inf211"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>t</mml:mi></mml:mstyle></mml:math></inline-formula>, the variance in ancestor location along this tree back to the most recent common ancestor is maximized at the most recent common ancestor, <inline-formula><mml:math id="inf212"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>t</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>/</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:mstyle></mml:math></inline-formula>, that is, this is a Brownian bridge. And so on.</p></sec><sec id="s4-2-3"><title>Chopping the tree</title><p>As with the dispersal likelihood, to reduce dependencies on distant times we can chop the tree at some time <inline-formula><mml:math id="inf213"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>T</mml:mi></mml:mstyle></mml:math></inline-formula> and use only the subtree containing the ancestor of interest. Often the most recent common ancestor of the resulting subtree occurs more recently than <inline-formula><mml:math id="inf214"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>T</mml:mi></mml:mstyle></mml:math></inline-formula> but we want to infer the location all the way back to <inline-formula><mml:math id="inf215"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>T</mml:mi></mml:mstyle></mml:math></inline-formula>, and so we need to infer the location of the common ancestral lineage past the most recent common ancestor. Fortunately, this method extends naturally to times beyond the most recent common ancestor, implicitly modelling simple Brownian motion (a fixed mean and linearly increasing variance) up the stem of the tree. Similarly, the ancestor need not have descendants in the sample – our method implicitly adds simple Brownian motion down the branch leading to a ‘hanging’ ancestor (which is useful when we want to ignore the location of a sample and locate it or its ancestors using the remaining sample locations and the trees). When there is only a single sample in a subtree we cannot mean centre and instead model simple Brownian motion up from the sample.</p></sec><sec id="s4-2-4"><title>Importance sampling</title><p>Finally, to integrate over tree uncertainty and reduce bias from the way in which we sample trees we importance sample. We do this by replacing the dispersal likelihood, <inline-formula><mml:math id="inf216"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">L</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula>, in <xref ref-type="disp-formula" rid="equ5">Equation 4</xref> with the probability distribution for the ancestor’s location, <inline-formula><mml:math id="inf217"><mml:mrow><mml:mi>ℙ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold">ℓ</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo lspace="2.5pt" rspace="2.5pt" stretchy="false">|</mml:mo><mml:mrow><mml:mi mathvariant="bold">𝐗</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi mathvariant="bold">𝐕</mml:mi><mml:mrow><mml:mi class="ltx_font_mathcaligraphic">𝒢</mml:mi><mml:mo>,</mml:mo><mml:mi class="ltx_font_mathcaligraphic">𝒯</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="bold">𝚺</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi mathvariant="bold">𝐯</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>,<disp-formula id="equ22"><label>(21)</label><mml:math id="m22"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mover><mml:mrow><mml:mrow><mml:mi mathvariant="normal">L</mml:mi><mml:mi mathvariant="normal">R</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi mathvariant="bold-italic">ℓ</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>M</mml:mi></mml:mfrac><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:munderover><mml:mfrac><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi mathvariant="bold-italic">ℓ</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="bold">X</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">V</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">v</mml:mi></mml:mrow><mml:mi>a</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>We compute this using the maximum composite likelihood ratio estimates of <inline-formula><mml:math id="inf218"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf219"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>λ</mml:mi></mml:mstyle></mml:math></inline-formula>.</p></sec><sec id="s4-2-5"><title>Best linear unbiased predictor</title><p>As with dispersal, the above approach requires a numerical search for the most likely ancestor location because a sum of normal distributions (<xref ref-type="disp-formula" rid="equ22">Equation 21</xref>) does not, in general, follow a tractable distribution. An alternative approach, however, is to calculate the most likely ancestor location for each sampled tree (<xref ref-type="disp-formula" rid="equ20">Equation 19</xref>) and importance sample over these estimates. Writing the most likely ancestor location given a sampled tree (<xref ref-type="disp-formula" rid="equ20">Equation 19</xref>) as <inline-formula><mml:math id="inf220"><mml:mrow><mml:mover accent="true"><mml:msub><mml:mi mathvariant="bold">ℓ</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>^</mml:mo></mml:mover><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi class="ltx_font_mathcaligraphic">𝒯</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi class="ltx_font_mathcaligraphic">𝒢</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, we then have another estimate of the ancestor’s location,<disp-formula id="equ23"><label>(22)</label><mml:math id="m23"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mover><mml:msub><mml:mi mathvariant="bold-italic">ℓ</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo stretchy="false">~</mml:mo></mml:mover></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>M</mml:mi></mml:mfrac><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:munderover><mml:mfrac><mml:mrow><mml:mrow><mml:mover><mml:msub><mml:mi mathvariant="bold-italic">ℓ</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi class="mathcal" mathvariant="script">T</mml:mi></mml:mrow><mml:mi>m</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi class="mathcal" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p><xref ref-type="disp-formula" rid="equ23">Equation 22</xref> is a BLUP averaged over the importance weights. We can calculate this directly and it is therefore, in principle, faster to compute than the search over <xref ref-type="disp-formula" rid="equ22">Equation 21</xref>. It is also independent of the dispersal rate since <inline-formula><mml:math id="inf221"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="bold">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi mathvariant="double-struck">P</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">T</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi class="MJX-tex-caligraphic" mathvariant="script">G</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula> under our spatial model. In practice we find that the two estimators are very correlated, and the more correct numerical search over <xref ref-type="disp-formula" rid="equ22">Equation 21</xref> is reasonably quick. Throughout the paper we use the numerical search over <xref ref-type="disp-formula" rid="equ22">Equation 21</xref> but the BLUP method is also implemented in our software. Our software also allows one to importance sample over ancestor location uncertainty, replacing <inline-formula><mml:math id="inf222"><mml:mrow><mml:mover accent="true"><mml:msub><mml:mi mathvariant="bold">ℓ</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>^</mml:mo></mml:mover><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi class="ltx_font_mathcaligraphic">𝒯</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi class="ltx_font_mathcaligraphic">𝒢</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> with the variance in <inline-formula><mml:math id="inf223"><mml:mrow><mml:msub><mml:mi mathvariant="bold">ℓ</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi class="ltx_font_mathcaligraphic">𝒯</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi class="ltx_font_mathcaligraphic">𝒢</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> in <xref ref-type="disp-formula" rid="equ23">Equation 22</xref>.</p></sec></sec><sec id="s4-3"><title>Simulations</title><p>Our full pipeline is described in detail in a Snakemake (<xref ref-type="bibr" rid="bib71">Mölder et al., 2021</xref>) file at <ext-link ext-link-type="uri" xlink:href="https://github.com/mmosmond/spacetrees-ms">https://github.com/mmosmond/spacetrees-ms</ext-link>, copy archived at <xref ref-type="bibr" rid="bib77">Osmond, 2024a</xref>.</p><sec id="s4-3-1"><title>Spatially explicit forward-time simulations</title><p>We performed simulations in SLiM v4.0.1 (<xref ref-type="bibr" rid="bib39">Haller and Messer, 2023</xref>) with tree-sequence recording (<xref ref-type="bibr" rid="bib38">Haller et al., 2019</xref>). The SLiM code was adapted from the pyslim spatial vignette (<ext-link ext-link-type="uri" xlink:href="https://tskit.dev/pyslim/docs/stable/vignette_space">https://tskit.dev/pyslim/docs/stable/vignette_space</ext-link>) to model non-overlapping generations.</p><p>Individuals are diploid for a single chromosome with <inline-formula><mml:math id="inf224"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow class="MJX-TeXAtom-ORD"><mml:mn>8</mml:mn></mml:mrow></mml:msup></mml:mstyle></mml:math></inline-formula> basepairs and per basepair recombination rate <inline-formula><mml:math id="inf225"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>r</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>−</mml:mo><mml:mn>8</mml:mn></mml:mrow></mml:msup></mml:mstyle></mml:math></inline-formula>. Individuals exist in a two-dimensional habitat, a square of width <inline-formula><mml:math id="inf226"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>W</mml:mi><mml:mo>=</mml:mo><mml:mn>100</mml:mn></mml:mstyle></mml:math></inline-formula> with reflecting boundaries.</p><p>Each generation begins with reproduction. Each individual acts once as a ‘mother’ and chooses a ‘father’ at random (individuals are hermaphrodites), weighted by their mating weights. The mating weight of an individual distance <inline-formula><mml:math id="inf227"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>d</mml:mi></mml:mstyle></mml:math></inline-formula> from a mother follows a two-dimensional normal distribution centred on the mother with variance <inline-formula><mml:math id="inf228"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>m</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>/</mml:mo></mml:mrow><mml:mn>4</mml:mn></mml:mstyle></mml:math></inline-formula> in both directions and no covariance. Individuals further apart than <inline-formula><mml:math id="inf229"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mn>3</mml:mn><mml:msub><mml:mi>σ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> are ignored for efficiency.</p><p>Local density dependence is modelled through competitive effects on fecundity. The strength of competitive interaction between two individuals distance <inline-formula><mml:math id="inf230"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>d</mml:mi></mml:mstyle></mml:math></inline-formula> distance apart follows a two-dimensional normal distribution centred on one of the individuals with variance <inline-formula><mml:math id="inf231"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>c</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mstyle></mml:math></inline-formula> in both directions and no covariance. We again ignore individuals more distant than <inline-formula><mml:math id="inf232"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mn>3</mml:mn><mml:msub><mml:mi>σ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula>. The number of offspring produced by a mother is Poisson, with mean <inline-formula><mml:math id="inf233"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>R</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>/</mml:mo></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mi>C</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>/</mml:mo></mml:mrow><mml:mi>K</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula>, where <inline-formula><mml:math id="inf234"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>C</mml:mi></mml:mstyle></mml:math></inline-formula> is the sum of interaction strengths the mother experiences, <inline-formula><mml:math id="inf235"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>R</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn></mml:mstyle></mml:math></inline-formula> is the mean number of offspring in the absence of competition, and <inline-formula><mml:math id="inf236"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>K</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mstyle></mml:math></inline-formula> is the local carrying capacity. Each offspring disperses from its mother by a random two-dimensional normal deviate with variance <inline-formula><mml:math id="inf237"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>d</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mstyle></mml:math></inline-formula> in each dimension and no covariance.</p><p>Note that, given a lineage has an equal chance of descending from its mother or its father each generation, the true simulated dispersal rate is <inline-formula><mml:math id="inf238"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msup><mml:mi>σ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>d</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>/</mml:mo></mml:mrow><mml:mn>2</mml:mn><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>d</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>m</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>/</mml:mo></mml:mrow><mml:mn>2</mml:mn><mml:mo>=</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>d</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mi>m</mml:mi></mml:mrow><mml:mrow class="MJX-TeXAtom-ORD"><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>/</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:mstyle></mml:math></inline-formula> (<xref ref-type="bibr" rid="bib92">Smith et al., 2023</xref>) in each dimension.</p><p>After reproduction all adults die and all offspring become adults in the next generation. We begin the population with <inline-formula><mml:math id="inf239"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>N</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mi>W</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mi>K</mml:mi></mml:mstyle></mml:math></inline-formula> individuals distributed uniformly at random across space. We end the simulation, and output the tree sequence, after <inline-formula><mml:math id="inf240"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mn>4</mml:mn><mml:msub><mml:mi>N</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula> generations.</p></sec><sec id="s4-3-2"><title>True tree sequence of the sample</title><p>Using tskit v0.5.6 (<xref ref-type="bibr" rid="bib52">Kelleher et al., 2018</xref>), we load the tree sequence into Python v3.11.5, sample <inline-formula><mml:math id="inf241"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>k</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>/</mml:mo></mml:mrow><mml:mn>2</mml:mn><mml:mo>=</mml:mo><mml:mn>50</mml:mn></mml:mstyle></mml:math></inline-formula> present day diploid individuals (<inline-formula><mml:math id="inf242"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>100</mml:mn></mml:mstyle></mml:math></inline-formula> genomes) at random, and simplify the tree sequence to lineages ancestral to the sample. We then use pyslim v0.6 (<ext-link ext-link-type="uri" xlink:href="https://github.com/tskit-dev/pyslim">https://github.com/tskit-dev/pyslim</ext-link>) (copy archived at <xref ref-type="bibr" rid="bib82">Ralph et al., 2024</xref>) to ‘recapitate’ the tree sequence under the coalescent with recombination (<xref ref-type="bibr" rid="bib44">Hudson, 2002</xref>) with effective population size <inline-formula><mml:math id="inf243"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>N</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mstyle></mml:math></inline-formula>, ensuring all sampled lineages have coalesced. This tree sequence represents the true genealogical history of the sample.</p></sec><sec id="s4-3-3"><title>Inferred tree sequence of the sample</title><p>Because we will not know the true tree sequence of any natural sample, we next use msprime v1.3.1 (<xref ref-type="bibr" rid="bib50">Kelleher et al., 2016a</xref>) to layer neutral mutations on the tree sequence with per basepair per generation mutation rate <inline-formula><mml:math id="inf244"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>U</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>−</mml:mo><mml:mn>8</mml:mn></mml:mrow></mml:msup></mml:mstyle></mml:math></inline-formula>. We then write the genotypic data out as a VCF and use Relate v1.2.1 (<xref ref-type="bibr" rid="bib93">Speidel et al., 2019</xref>) to infer the tree sequence. We give Relate the true uniform recombination map and mutation rate and an initial effective population size of <inline-formula><mml:math id="inf245"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>θ</mml:mi><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>/</mml:mo></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>4</mml:mn><mml:mi>U</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:math></inline-formula>, where <inline-formula><mml:math id="inf246"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>θ</mml:mi></mml:mstyle></mml:math></inline-formula> is the observed mean genetic diversity calculated from the tree sequence with tskit (<xref ref-type="bibr" rid="bib81">Ralph et al., 2020</xref>). We then feed the resulting output to Relate’s ‘EstimatePopulationSize’ function to iteratively estimate a piecewise-constant effective population size and branch lengths, using five MCMC iterations (the default) and dropping 50% of the trees (the default).</p></sec><sec id="s4-3-4"><title>Processing the tree sequence</title><p>At every 100th tree we use Relate’s ‘SampleBranchLengths’ function to sample branch lengths from the posterior <inline-formula><mml:math id="inf247"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mn>1000</mml:mn></mml:mstyle></mml:math></inline-formula> times, using the true mutation rate and saving the output in Newick format. We next load the Newick trees into Python as one-tree tskit tree sequences with tsconvert (<ext-link ext-link-type="uri" xlink:href="https://github.com/tskit-dev/tsconvert">https://github.com/tskit-dev/tsconvert</ext-link>) (copy archived at <xref ref-type="bibr" rid="bib47">Jefferyn et al., 2024</xref>) and calculate the shared times and coalescent times. We then chop these times at a cutoff <inline-formula><mml:math id="inf248"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>T</mml:mi></mml:mstyle></mml:math></inline-formula> and calculate various quantities that are used for inference: the shared time matrix of each subtree, the inverted mean-centred shared time matrix of each subtree, the log of the determinant of the mean-centred shared time matrix of each subtree, the coalescence times, and the log probability of the coalescence times. This pre-processing speeds up the numerical search for maximum likelihood parameters.</p></sec><sec id="s4-3-5"><title>Dispersal estimates</title><p>We approximate the maximum composite likelihood estimate of the dispersal rate by numerically searching for the dispersal rate (and branching rate, <inline-formula><mml:math id="inf249"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>λ</mml:mi></mml:mstyle></mml:math></inline-formula>) that minmizes the negative log of the product of likelihood ratios (<xref ref-type="disp-formula" rid="equ5">Equation 4</xref>) over sampled loci. We use the L-BFGS-B method of SciPy v1.11.2 (<xref ref-type="bibr" rid="bib100">Virtanen et al., 2020</xref>) to numerically find the maximum, which allows us to impose bounds on the parameters. We search for the maximum in terms of the standard deviation of dispersal in <inline-formula><mml:math id="inf250"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>x</mml:mi></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf251"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>y</mml:mi></mml:mstyle></mml:math></inline-formula> (with a lower bound of <inline-formula><mml:math id="inf252"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msup><mml:mn>10</mml:mn><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>−</mml:mo><mml:mn>6</mml:mn></mml:mrow></mml:msup></mml:mstyle></mml:math></inline-formula> to prevent negative values) and the correlation between these two axes (with bounds of −0.99 and 0.99 to prevent estimates with absolute value greater than 1). We also place a lower bound of <inline-formula><mml:math id="inf253"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msup><mml:mn>10</mml:mn><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>−</mml:mo><mml:mn>6</mml:mn></mml:mrow></mml:msup></mml:mstyle></mml:math></inline-formula> on <inline-formula><mml:math id="inf254"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>λ</mml:mi></mml:mstyle></mml:math></inline-formula> to prevent negative branching rates.</p></sec><sec id="s4-3-6"><title>Locating genetic ancestors</title><p>To locate a genetic ancestor at a particular locus and time we numerically search for the location that maximizes the likelihood ratio (<xref ref-type="disp-formula" rid="equ22">Equation 21</xref>), following the same approach as above but with the SLSQP method without bounds.</p></sec></sec><sec id="s4-4"><title><italic>A. thaliana</italic> data</title><p>Our full pipeline is described in detail in a Snakemake (<xref ref-type="bibr" rid="bib71">Mölder et al., 2021</xref>) file at <ext-link ext-link-type="uri" xlink:href="https://github.com/mmosmond/spacetrees-ms">https://github.com/mmosmond/spacetrees-ms</ext-link> (copy archived at <xref ref-type="bibr" rid="bib77">Osmond, 2024a</xref>).</p><sec id="s4-4-1"><title>Inferring the tree sequence</title><p>We first downloaded 63 fastq sequences from <ext-link ext-link-type="uri" xlink:href="https://www.ebi.ac.uk/ena/browser/view/PRJEB55632">https://www.ebi.ac.uk/ena/browser/view/PRJEB55632</ext-link> and <ext-link ext-link-type="uri" xlink:href="https://www.ebi.ac.uk/ena/browser/view/PRJEB55353">https://www.ebi.ac.uk/ena/browser/view/PRJEB55353</ext-link> (<xref ref-type="bibr" rid="bib109">Wlodzimierz et al., 2023</xref>) and 3 genome assemblies: Col-0 and Ey15-2 from <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/bioproject/PRJEB50694">https://www.ncbi.nlm.nih.gov/bioproject/PRJEB50694</ext-link> and Kew-1 from <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/bioproject/PRJEB51511">https://www.ncbi.nlm.nih.gov/bioproject/PRJEB51511</ext-link>. We also downloaded a hard-masked TAIR10 reference genome from <ext-link ext-link-type="uri" xlink:href="https://zenodo.org/records/7326462">https://zenodo.org/records/7326462</ext-link>.</p><p>To extract the sample haplotypes from this data we roughly followed the methods of <xref ref-type="bibr" rid="bib109">Wlodzimierz et al., 2023</xref>. We first used hifiasm v0.19.5 (<xref ref-type="bibr" rid="bib14">Cheng et al., 2021</xref>; <xref ref-type="bibr" rid="bib15">Cheng et al., 2022</xref>) to assemble each of the 63 fastqs into contigs and convert the outputs to fasta. We then used ragtag v2.1.0 (<xref ref-type="bibr" rid="bib3">Alonge et al., 2022</xref>), with the minimap2 v2.26 (<xref ref-type="bibr" rid="bib66">Li, 2018</xref>; <xref ref-type="bibr" rid="bib67">Li, 2021</xref>) aligner and the TAIR10 reference, to scaffold each of the 63 assemblies. We next extracted the 5 autosomes from each of the 66 assemblies, aligned these to the TAIR10 reference with minimap2 and converted to sam/bam format with samtools v1.13 (<xref ref-type="bibr" rid="bib19">Danecek et al., 2021</xref>). We then used bcftools v1.13 (<xref ref-type="bibr" rid="bib19">Danecek et al., 2021</xref>) and the TAIR10 reference to create a VCF for each chromosome. We also used bcftools to filter out sites with missing or heterozygote genotypes and filter to just biallelic single-nucleotide polymorphisms (SNPs). To get the haplotypes of each sample we used bcftools to convert the VCFs to hap/sample format and from this kept just one haplotype of each (now explicitly haploid) sample.</p><p>To polarize the SNPs we used a multispecies alignment for <italic>A. thaliana</italic>, <italic>Boechera stricta</italic>, <italic>Arabidopsis lyrata</italic>, and <italic>Malcomia maritima</italic> (available at <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.11456353">https://doi.org/10.5281/zenodo.11456353</ext-link>). We used bx-python v0.8.9 (<ext-link ext-link-type="uri" xlink:href="https://github.com/bxlab/bx-python">https://github.com/bxlab/bx-python</ext-link>; <xref ref-type="bibr" rid="bib98">Taylor et al., 2020</xref>) to create a fasta file containing the three outgroups from this alignment and, combined with the hap files described above, created the input files required by est-sfs (<xref ref-type="bibr" rid="bib49">Keightley and Jackson, 2018</xref>). We then ran est-sfs v2.04, separately for each chromosome, using the Kimura 2-parameter model (<xref ref-type="bibr" rid="bib55">Kimura, 1980</xref>) to get the probability that each major allele is ancestral. This method includes information about polymorphism within the ingroup when assigning ancestral states. Wherever the reference allele has a less than 1/2 probability of being ancestral we ‘flip’ the alleles at that locus, so that 0 and 1 refer to ancestral and derived alleles, respectively, in our hap files.</p><p>To remove difficult to sequence regions of the genome we downloaded the hard-masked TAIR10 reference from <ext-link ext-link-type="uri" xlink:href="https://ftp.ensemblgenomes.ebi.ac.uk/pub/plants/release-56/fasta/arabidopsis_thaliana/dna/">https://ftp.ensemblgenomes.ebi.ac.uk/pub/plants/release-56/fasta/arabidopsis_thaliana/dna/</ext-link> and use Relate to mask the hap files. We also downloaded a recombination map from <ext-link ext-link-type="uri" xlink:href="https://popsim-consortium.github.io/stdpopsim-docs/stable/catalog.html#sec_catalog_aratha_genetic_maps_salomeaveraged_tair10">https://popsim-consortium.github.io/stdpopsim-docs/stable/catalog.html#sec_catalog_aratha_genetic_maps_salomeaveraged_tair10</ext-link> (<xref ref-type="bibr" rid="bib2">Adrion et al., 2020</xref>; <xref ref-type="bibr" rid="bib88">Salomé et al., 2012</xref>) and converted it into the form required by Relate.</p><p>We ran Relate v1.1.9 with the polarized, masked, haploid hap files and the recombination map to infer the genome-wide genealogies, with initial effective population size 10<sup>5</sup> and mutation rate <inline-formula><mml:math id="inf255"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mn>7</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow class="MJX-TeXAtom-ORD"><mml:mo>−</mml:mo><mml:mn>9</mml:mn></mml:mrow></mml:msup></mml:mstyle></mml:math></inline-formula>(<xref ref-type="bibr" rid="bib2">Adrion et al., 2020</xref>). We then used Relate to infer a piecewise-constant effective population size and re-estimate branch lengths accordingly, using 10 MCMC iterations (the default is 5) and 50% of the trees (default). The final anc/mut output is converted into a tskit tree sequence with Relate for additional analyses. We also use Relate to sample branch lengths 1000 times at every 100th tree on each chromosome (for a total of 878 trees).</p><p>To extract the information we need from the Newick files output by Relate we used tsconvert v0.1 (<ext-link ext-link-type="uri" xlink:href="https://github.com/tskit-dev/tsconvert">https://github.com/tskit-dev/tsconvert</ext-link>) (copy archived at <xref ref-type="bibr" rid="bib47">Jefferyn et al., 2024</xref>) to convert them into (one-tree) tskit tree sequences and tskit v0.5.2 to extract the shared times and coalescent times from each. We then applied the time cutoffs, and for each subtree pre-computed the inverse and determinant of the mean-centred shared time matrix. We also pre-calculated the probability of the coalescence times given the piecewise-constant effective population size inferred by Relate. With these quantities in hand we estimate dispersal rates and locate genetic ancestors.</p></sec><sec id="s4-4-2"><title>Dispersal estimates</title><p>We estimated dispersal rates as described above for simulations. We converted our estimates of dispersal rate from degrees squared to kilometres squared by multiplying the latitudinal estimates by 111<sup>2</sup> and by multiplying the longitudinal estimates by <inline-formula><mml:math id="inf256"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>111</mml:mn><mml:mi>cos</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mover><mml:mi>y</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:mrow><mml:mi>π</mml:mi><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mn>180</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mstyle></mml:math></inline-formula>, where <inline-formula><mml:math id="inf257"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow class="MJX-TeXAtom-ORD"><mml:mover><mml:mi>y</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:mrow></mml:mstyle></mml:math></inline-formula> is the mean latitude across samples.</p><p>As one of our results is that rates of dispersal are higher along latitude than along longitude, we wanted to make sure that the lack of conditioning on sampling location did not drive this result. To do this, we ran our method looking at only longitudinal dispersal, ignoring the sample latitudes, and then again looking at only latitudinal dispersal, ignoring the sample longitudes. This reduces the problem back to one dimension where the conditioning does not matter (as discussed above and in <xref ref-type="bibr" rid="bib70">Meligkotsidou and Fearnhead, 2007</xref>). Doing this we find essentially identical dispersal rates as before, justifying our result of a larger latitudinal dispersal rate despite not conditioning on the sample locations.</p></sec><sec id="s4-4-3"><title>Locating genetic ancestors</title><p>We locate ancestors as described above for simulations, but without imposing any bounds.</p></sec></sec></sec></body><back><sec sec-type="additional-information" id="s5"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="COI-statement" id="conf1"><p>No competing interests declared</p></fn><fn fn-type="COI-statement" id="conf2"><p>Reviewing editor, eLife</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>Conceptualization, Resources, Data curation, Software, Formal analysis, Funding acquisition, Validation, Investigation, Visualization, Methodology, Writing – original draft, Writing – review and editing</p></fn><fn fn-type="con" id="con2"><p>Conceptualization, Formal analysis, Supervision, Funding acquisition, Methodology, Writing – original draft, Writing – review and editing</p></fn></fn-group></sec><sec sec-type="supplementary-material" id="s6"><title>Additional files</title><supplementary-material id="mdar"><label>MDAR checklist</label><media xlink:href="elife-72177-mdarchecklist1-v2.pdf" mimetype="application" mime-subtype="pdf"/></supplementary-material></sec><sec sec-type="data-availability" id="s7"><title>Data availability</title><p>All code used to perform the analyses in this study can be found at <ext-link ext-link-type="uri" xlink:href="https://github.com/mmosmond/spacetrees-ms">https://github.com/mmosmond/spacetrees-ms</ext-link> (copy archived at <xref ref-type="bibr" rid="bib77">Osmond, 2024a</xref>). More information on how to run our method, spacetrees, is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/osmond-lab/spacetrees">https://github.com/osmond-lab/spacetrees</ext-link> (copy archived at <xref ref-type="bibr" rid="bib78">Osmond, 2024b</xref>).</p><p>The following dataset was generated:</p><p><element-citation publication-type="data" specific-use="isSupplementedBy" id="dataset1"><person-group person-group-type="author"><name><surname>Osmond</surname><given-names>MM</given-names></name><name><surname>Coop</surname><given-names>GC</given-names></name></person-group><year iso-8601-date="2024">2024</year><data-title>Relate-inferred genealogies for 66 longread <italic>Arabidopsis thaliana</italic> genomes</data-title><source>Zenodo</source><pub-id pub-id-type="doi">10.5281/zenodo.5099656</pub-id></element-citation></p></sec><ack id="ack"><title>Acknowledgements</title><p>We thank Tyler Kent, Adrian Platts, and the Brassicales Map Alignment Project (DOE-JGI, <ext-link ext-link-type="uri" xlink:href="http://bmap.jgi.doe.gov/">http://bmap.jgi.doe.gov/</ext-link>) for the multispecies genome alignments, Yan Wong, Ben Haller, and Peter Ralph for the retainCoalescentOnly and permanent updates to SLiM/pyslim, Leo Speidel for help with Relate, Vince Buffalo for an introduction to Snakemake, Fabrizio Menardo for pointing out an error in our lat/long to km conversion, Puneeth Deraje and James Kitchens for helpful discussions, and Nick Barton for healthy skepticism about per-locus estimates of ancestor locations at deep times. Funding provided by Banting (Canada), the Center for Population Biology (UC Davis), the Natural Sciences and Engineering Research Council of Canada (RGPIN-2021-03207, awarded to MO), and the National Institute of General Medical Sciences of the National Institutes of Health (NIH R01 GM108779 and R35 GM136290, awarded to GC). Computations were performed on the Niagara supercomputer at the SciNet HPC Consortium. SciNet is funded by: the Canada Foundation for Innovation; the Government of Ontario; Ontario Research Fund – Research Excellence; and the University of Toronto.</p></ack><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="journal"><person-group person-group-type="author"><collab>1001 Genomes Consortium</collab></person-group><year iso-8601-date="2016">2016</year><article-title>Genomes reveal the global pattern of polymorphism in <italic>Arabidopsis thaliana</italic></article-title><source>Cell</source><volume>166</volume><fpage>481</fpage><lpage>491</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2016.05.063</pub-id><pub-id pub-id-type="pmid">27293186</pub-id></element-citation></ref><ref id="bib2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Adrion</surname><given-names>JR</given-names></name><name><surname>Cole</surname><given-names>CB</given-names></name><name><surname>Dukler</surname><given-names>N</given-names></name><name><surname>Galloway</surname><given-names>JG</given-names></name><name><surname>Gladstein</surname><given-names>AL</given-names></name><name><surname>Gower</surname><given-names>G</given-names></name><name><surname>Kyriazis</surname><given-names>CC</given-names></name><name><surname>Ragsdale</surname><given-names>AP</given-names></name><name><surname>Tsambos</surname><given-names>G</given-names></name><name><surname>Baumdicker</surname><given-names>F</given-names></name><name><surname>Carlson</surname><given-names>J</given-names></name><name><surname>Cartwright</surname><given-names>RA</given-names></name><name><surname>Durvasula</surname><given-names>A</given-names></name><name><surname>Gronau</surname><given-names>I</given-names></name><name><surname>Kim</surname><given-names>BY</given-names></name><name><surname>McKenzie</surname><given-names>P</given-names></name><name><surname>Messer</surname><given-names>PW</given-names></name><name><surname>Noskova</surname><given-names>E</given-names></name><name><surname>Ortega-Del Vecchyo</surname><given-names>D</given-names></name><name><surname>Racimo</surname><given-names>F</given-names></name><name><surname>Struck</surname><given-names>TJ</given-names></name><name><surname>Gravel</surname><given-names>S</given-names></name><name><surname>Gutenkunst</surname><given-names>RN</given-names></name><name><surname>Lohmueller</surname><given-names>KE</given-names></name><name><surname>Ralph</surname><given-names>PL</given-names></name><name><surname>Schrider</surname><given-names>DR</given-names></name><name><surname>Siepel</surname><given-names>A</given-names></name><name><surname>Kelleher</surname><given-names>J</given-names></name><name><surname>Kern</surname><given-names>AD</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>A community-maintained standard library of population genetic models</article-title><source>eLife</source><volume>9</volume><elocation-id>e54967</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.54967</pub-id><pub-id pub-id-type="pmid">32573438</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Alonge</surname><given-names>M</given-names></name><name><surname>Lebeigle</surname><given-names>L</given-names></name><name><surname>Kirsche</surname><given-names>M</given-names></name><name><surname>Jenike</surname><given-names>K</given-names></name><name><surname>Ou</surname><given-names>S</given-names></name><name><surname>Aganezov</surname><given-names>S</given-names></name><name><surname>Wang</surname><given-names>X</given-names></name><name><surname>Lippman</surname><given-names>ZB</given-names></name><name><surname>Schatz</surname><given-names>MC</given-names></name><name><surname>Soyk</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2022">2022</year><article-title>Automated assembly scaffolding using RagTag elevates a new tomato system for high-throughput genome editing</article-title><source>Genome Biology</source><volume>23</volume><elocation-id>258</elocation-id><pub-id pub-id-type="doi">10.1186/s13059-022-02823-7</pub-id><pub-id pub-id-type="pmid">36522651</pub-id></element-citation></ref><ref id="bib4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Avise</surname><given-names>JC</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Phylogeography: retrospect and prospect</article-title><source>Journal of Biogeography</source><volume>36</volume><fpage>3</fpage><lpage>15</lpage><pub-id pub-id-type="doi">10.1111/j.1365-2699.2008.02032.x</pub-id></element-citation></ref><ref id="bib5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Barton</surname><given-names>NH</given-names></name><name><surname>Wilson</surname><given-names>I</given-names></name></person-group><year iso-8601-date="1995">1995</year><article-title>Genealogies and geography</article-title><source>Philosophical Transactions of the Royal Society of London. Series B</source><volume>349</volume><fpage>49</fpage><lpage>59</lpage><pub-id pub-id-type="doi">10.1098/rstb.1995.0090</pub-id></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Barton</surname><given-names>N</given-names></name><name><surname>Etheridge</surname><given-names>A</given-names></name><name><surname>Véber</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>A new model for evolution in a spatial continuum</article-title><source>Electronic Journal of Probability</source><volume>15</volume><fpage>162</fpage><lpage>216</lpage><pub-id pub-id-type="doi">10.1214/EJP.v15-741</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Battey</surname><given-names>CJ</given-names></name><name><surname>Ralph</surname><given-names>PL</given-names></name><name><surname>Kern</surname><given-names>AD</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Predicting geographic location from genetic variation with deep neural networks</article-title><source>eLife</source><volume>9</volume><elocation-id>e54507</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.54507</pub-id><pub-id pub-id-type="pmid">32511092</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bedford</surname><given-names>T</given-names></name><name><surname>Cobey</surname><given-names>S</given-names></name><name><surname>Beerli</surname><given-names>P</given-names></name><name><surname>Pascual</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Global migration dynamics underlie evolution and persistence of human influenza A (H3N2)</article-title><source>PLOS Pathogens</source><volume>6</volume><elocation-id>e1000918</elocation-id><pub-id pub-id-type="doi">10.1371/journal.ppat.1000918</pub-id><pub-id pub-id-type="pmid">20523898</pub-id></element-citation></ref><ref id="bib9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Biek</surname><given-names>R</given-names></name><name><surname>Henderson</surname><given-names>JC</given-names></name><name><surname>Waller</surname><given-names>LA</given-names></name><name><surname>Rupprecht</surname><given-names>CE</given-names></name><name><surname>Real</surname><given-names>LA</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>A high-resolution genetic signature of demographic and spatial expansion in epizootic rabies virus</article-title><source>PNAS</source><volume>104</volume><fpage>7993</fpage><lpage>7998</lpage><pub-id pub-id-type="doi">10.1073/pnas.0700741104</pub-id><pub-id pub-id-type="pmid">17470818</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bomblies</surname><given-names>K</given-names></name><name><surname>Yant</surname><given-names>L</given-names></name><name><surname>Laitinen</surname><given-names>RA</given-names></name><name><surname>Kim</surname><given-names>S-T</given-names></name><name><surname>Hollister</surname><given-names>JD</given-names></name><name><surname>Warthmann</surname><given-names>N</given-names></name><name><surname>Fitz</surname><given-names>J</given-names></name><name><surname>Weigel</surname><given-names>D</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Local-scale patterns of genetic variability, outcrossing, and spatial structure in natural stands of <italic>Arabidopsis thaliana</italic></article-title><source>PLOS Genetics</source><volume>6</volume><elocation-id>e1000890</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pgen.1000890</pub-id><pub-id pub-id-type="pmid">20361058</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bradburd</surname><given-names>GS</given-names></name><name><surname>Ralph</surname><given-names>PL</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Spatial population genetics: it’s about time</article-title><source>Annual Review of Ecology, Evolution, and Systematics</source><volume>50</volume><fpage>427</fpage><lpage>449</lpage><pub-id pub-id-type="doi">10.1146/annurev-ecolsys-110316-022659</pub-id></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cavalli-sforza</surname><given-names>LL</given-names></name><name><surname>Barrai</surname><given-names>I</given-names></name><name><surname>Edwards</surname><given-names>AW</given-names></name></person-group><year iso-8601-date="1964">1964</year><article-title>Analysis of human evolution under random genetic drift</article-title><source>Cold Spring Harbor Symposia on Quantitative Biology</source><volume>29</volume><fpage>9</fpage><lpage>20</lpage><pub-id pub-id-type="doi">10.1101/sqb.1964.029.01.006</pub-id><pub-id pub-id-type="pmid">14278497</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cavalli-Sforza</surname><given-names>LL</given-names></name><name><surname>Edwards</surname><given-names>AW</given-names></name></person-group><year iso-8601-date="1967">1967</year><article-title>Phylogenetic analysis: models and estimation procedures</article-title><source>American Journal of Human Genetics</source><volume>19</volume><fpage>233</fpage><lpage>257</lpage><pub-id pub-id-type="pmid">6026583</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cheng</surname><given-names>H</given-names></name><name><surname>Concepcion</surname><given-names>GT</given-names></name><name><surname>Feng</surname><given-names>X</given-names></name><name><surname>Zhang</surname><given-names>H</given-names></name><name><surname>Li</surname><given-names>H</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Haplotype-resolved de novo assembly using phased assembly graphs with hifiasm</article-title><source>Nature Methods</source><volume>18</volume><fpage>170</fpage><lpage>175</lpage><pub-id pub-id-type="doi">10.1038/s41592-020-01056-5</pub-id><pub-id pub-id-type="pmid">33526886</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cheng</surname><given-names>H</given-names></name><name><surname>Jarvis</surname><given-names>ED</given-names></name><name><surname>Fedrigo</surname><given-names>O</given-names></name><name><surname>Koepfli</surname><given-names>K-P</given-names></name><name><surname>Urban</surname><given-names>L</given-names></name><name><surname>Gemmell</surname><given-names>NJ</given-names></name><name><surname>Li</surname><given-names>H</given-names></name></person-group><year iso-8601-date="2022">2022</year><article-title>Haplotype-resolved assembly of diploid genomes without parental data</article-title><source>Nature Biotechnology</source><volume>40</volume><fpage>1332</fpage><lpage>1335</lpage><pub-id pub-id-type="doi">10.1038/s41587-022-01261-x</pub-id><pub-id pub-id-type="pmid">35332338</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="web"><person-group person-group-type="author"><name><surname>Coop</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>How many genetic ancestors do I have?</article-title><ext-link ext-link-type="uri" xlink:href="https://gcbias.org/2013/11/11/how-does-your-number-of-genetic-ancestors-grow-back-over-time/">https://gcbias.org/2013/11/11/how-does-your-number-of-genetic-ancestors-grow-back-over-time/</ext-link><date-in-citation iso-8601-date="2021-07-01">July 1, 2021</date-in-citation></element-citation></ref><ref id="bib17"><element-citation publication-type="web"><person-group person-group-type="author"><name><surname>Coop</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Where did your genetic ancestors come from?</article-title><ext-link ext-link-type="uri" xlink:href="https://gcbias.org/2017/12/19/1628">https://gcbias.org/2017/12/19/1628</ext-link><date-in-citation iso-8601-date="2021-07-01">July 1, 2021</date-in-citation></element-citation></ref><ref id="bib18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cornwell</surname><given-names>W</given-names></name><name><surname>Nakagawa</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Phylogenetic comparative methods</article-title><source>Current Biology</source><volume>27</volume><fpage>R333</fpage><lpage>R336</lpage><pub-id pub-id-type="doi">10.1016/j.cub.2017.03.049</pub-id></element-citation></ref><ref id="bib19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Danecek</surname><given-names>P</given-names></name><name><surname>Bonfield</surname><given-names>JK</given-names></name><name><surname>Liddle</surname><given-names>J</given-names></name><name><surname>Marshall</surname><given-names>J</given-names></name><name><surname>Ohan</surname><given-names>V</given-names></name><name><surname>Pollard</surname><given-names>MO</given-names></name><name><surname>Whitwham</surname><given-names>A</given-names></name><name><surname>Keane</surname><given-names>T</given-names></name><name><surname>McCarthy</surname><given-names>SA</given-names></name><name><surname>Davies</surname><given-names>RM</given-names></name><name><surname>Li</surname><given-names>H</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Twelve years of SAMtools and BCFtools</article-title><source>GigaScience</source><volume>10</volume><elocation-id>giab008</elocation-id><pub-id pub-id-type="doi">10.1093/gigascience/giab008</pub-id><pub-id pub-id-type="pmid">33590861</pub-id></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dellicour</surname><given-names>S</given-names></name><name><surname>Durkin</surname><given-names>K</given-names></name><name><surname>Hong</surname><given-names>SL</given-names></name><name><surname>Vanmechelen</surname><given-names>B</given-names></name><name><surname>Martí-Carreras</surname><given-names>J</given-names></name><name><surname>Gill</surname><given-names>MS</given-names></name><name><surname>Meex</surname><given-names>C</given-names></name><name><surname>Bontems</surname><given-names>S</given-names></name><name><surname>André</surname><given-names>E</given-names></name><name><surname>Gilbert</surname><given-names>M</given-names></name><name><surname>Walker</surname><given-names>C</given-names></name><name><surname>Maio</surname><given-names>ND</given-names></name><name><surname>Faria</surname><given-names>NR</given-names></name><name><surname>Hadfield</surname><given-names>J</given-names></name><name><surname>Hayette</surname><given-names>M-P</given-names></name><name><surname>Bours</surname><given-names>V</given-names></name><name><surname>Wawina-Bokalanga</surname><given-names>T</given-names></name><name><surname>Artesi</surname><given-names>M</given-names></name><name><surname>Baele</surname><given-names>G</given-names></name><name><surname>Maes</surname><given-names>P</given-names></name></person-group><year iso-8601-date="2021">2021a</year><article-title>A phylodynamic workflow to rapidly gain insights into the dispersal history and dynamics of SARS-CoV-2 Lineages</article-title><source>Molecular Biology and Evolution</source><volume>38</volume><fpage>1608</fpage><lpage>1613</lpage><pub-id pub-id-type="doi">10.1093/molbev/msaa284</pub-id><pub-id pub-id-type="pmid">33316043</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dellicour</surname><given-names>S</given-names></name><name><surname>Hong</surname><given-names>SL</given-names></name><name><surname>Vrancken</surname><given-names>B</given-names></name><name><surname>Chaillon</surname><given-names>A</given-names></name><name><surname>Gill</surname><given-names>MS</given-names></name><name><surname>Maurano</surname><given-names>MT</given-names></name><name><surname>Ramaswami</surname><given-names>S</given-names></name><name><surname>Zappile</surname><given-names>P</given-names></name><name><surname>Marier</surname><given-names>C</given-names></name><name><surname>Harkins</surname><given-names>GW</given-names></name><name><surname>Baele</surname><given-names>G</given-names></name><name><surname>Duerr</surname><given-names>R</given-names></name><name><surname>Heguy</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2021">2021b</year><article-title>Dispersal dynamics of SARS-CoV-2 lineages during the first epidemic wave in New York City</article-title><source>PLOS Pathogens</source><volume>17</volume><elocation-id>e1009571</elocation-id><pub-id pub-id-type="doi">10.1371/journal.ppat.1009571</pub-id></element-citation></ref><ref id="bib22"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Deng</surname><given-names>Y</given-names></name><name><surname>Nielsen</surname><given-names>R</given-names></name><name><surname>Song</surname><given-names>YS</given-names></name></person-group><year iso-8601-date="2024">2024</year><article-title>Robust and accurate Bayesian inference of genome-wide genealogies for large samples</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/2024.03.16.585351</pub-id></element-citation></ref><ref id="bib23"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Deraje</surname><given-names>P</given-names></name><name><surname>Kitchens</surname><given-names>J</given-names></name><name><surname>Coop</surname><given-names>G</given-names></name><name><surname>Osmond</surname><given-names>MM</given-names></name></person-group><year iso-8601-date="2024">2024</year><article-title>Inferring the geographic history of recombinant lineages using the full ancestral recombination graph</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/2024.04.10.588900</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Donnelly</surname><given-names>KP</given-names></name></person-group><year iso-8601-date="1983">1983</year><article-title>The probability that related individuals share some section of genome identical by descent</article-title><source>Theoretical Population Biology</source><volume>23</volume><fpage>34</fpage><lpage>63</lpage><pub-id pub-id-type="doi">10.1016/0040-5809(83)90004-7</pub-id><pub-id pub-id-type="pmid">6857549</pub-id></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Durvasula</surname><given-names>A</given-names></name><name><surname>Fulgione</surname><given-names>A</given-names></name><name><surname>Gutaker</surname><given-names>RM</given-names></name><name><surname>Alacakaptan</surname><given-names>SI</given-names></name><name><surname>Flood</surname><given-names>PJ</given-names></name><name><surname>Neto</surname><given-names>C</given-names></name><name><surname>Tsuchimatsu</surname><given-names>T</given-names></name><name><surname>Burbano</surname><given-names>HA</given-names></name><name><surname>Picó</surname><given-names>FX</given-names></name><name><surname>Alonso-Blanco</surname><given-names>C</given-names></name><name><surname>Hancock</surname><given-names>AM</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>African genomes illuminate the early history and transition to selfing in <italic>Arabidopsis thaliana</italic></article-title><source>PNAS</source><volume>114</volume><fpage>5213</fpage><lpage>5218</lpage><pub-id pub-id-type="doi">10.1073/pnas.1616736114</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Edwards</surname><given-names>AWF</given-names></name></person-group><year iso-8601-date="1970">1970</year><article-title>Estimation of the branch points of a branching diffusion process</article-title><source>Journal of the Royal Statistical Society Series B</source><volume>32</volume><fpage>155</fpage><lpage>164</lpage><pub-id pub-id-type="doi">10.1111/j.2517-6161.1970.tb00828.x</pub-id></element-citation></ref><ref id="bib27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Felsenstein</surname><given-names>J</given-names></name></person-group><year iso-8601-date="1973">1973</year><article-title>Maximum-likelihood estimation of evolutionary trees from continuous characters</article-title><source>American Journal of Human Genetics</source><volume>25</volume><fpage>471</fpage><lpage>492</lpage><pub-id pub-id-type="pmid">4741844</pub-id></element-citation></ref><ref id="bib28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Felsenstein</surname><given-names>J</given-names></name></person-group><year iso-8601-date="1975">1975</year><article-title>A pain in the torus: some difficulties with models of isolation by distance</article-title><source>The American Naturalist</source><volume>109</volume><fpage>359</fpage><lpage>368</lpage><pub-id pub-id-type="doi">10.1086/283003</pub-id></element-citation></ref><ref id="bib29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Felsenstein</surname><given-names>J</given-names></name></person-group><year iso-8601-date="1985">1985</year><article-title>Phylogenies and the comparative method</article-title><source>The American Naturalist</source><volume>125</volume><fpage>1</fpage><lpage>15</lpage><pub-id pub-id-type="doi">10.1086/284325</pub-id></element-citation></ref><ref id="bib30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fulgione</surname><given-names>A</given-names></name><name><surname>Hancock</surname><given-names>AM</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Archaic lineages broaden our view on the history of <italic>Arabidopsis thaliana</italic></article-title><source>The New Phytologist</source><volume>219</volume><fpage>1194</fpage><lpage>1198</lpage><pub-id pub-id-type="doi">10.1111/nph.15244</pub-id><pub-id pub-id-type="pmid">29862511</pub-id></element-citation></ref><ref id="bib31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fulgione</surname><given-names>A</given-names></name><name><surname>Koornneef</surname><given-names>M</given-names></name><name><surname>Roux</surname><given-names>F</given-names></name><name><surname>Hermisson</surname><given-names>J</given-names></name><name><surname>Hancock</surname><given-names>AM</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Madeiran <italic>Arabidopsis thaliana</italic> reveals ancient long-range colonization and clarifies demography in eurasia</article-title><source>Molecular Biology and Evolution</source><volume>35</volume><fpage>564</fpage><lpage>574</lpage><pub-id pub-id-type="doi">10.1093/molbev/msx300</pub-id><pub-id pub-id-type="pmid">29216397</pub-id></element-citation></ref><ref id="bib32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fulgione</surname><given-names>A</given-names></name><name><surname>Neto</surname><given-names>C</given-names></name><name><surname>Elfarargi</surname><given-names>AF</given-names></name><name><surname>Tergemina</surname><given-names>E</given-names></name><name><surname>Ansari</surname><given-names>S</given-names></name><name><surname>Göktay</surname><given-names>M</given-names></name><name><surname>Dinis</surname><given-names>H</given-names></name><name><surname>Döring</surname><given-names>N</given-names></name><name><surname>Flood</surname><given-names>PJ</given-names></name><name><surname>Rodriguez-Pacheco</surname><given-names>S</given-names></name><name><surname>Walden</surname><given-names>N</given-names></name><name><surname>Koch</surname><given-names>MA</given-names></name><name><surname>Roux</surname><given-names>F</given-names></name><name><surname>Hermisson</surname><given-names>J</given-names></name><name><surname>Hancock</surname><given-names>AM</given-names></name></person-group><year iso-8601-date="2022">2022</year><article-title>Parallel reduction in flowering time from de novo mutations enable evolutionary rescue in colonizing lineages</article-title><source>Nature Communications</source><volume>13</volume><elocation-id>1461</elocation-id><pub-id pub-id-type="doi">10.1038/s41467-022-28800-z</pub-id><pub-id pub-id-type="pmid">35304466</pub-id></element-citation></ref><ref id="bib33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Grafen</surname><given-names>A</given-names></name></person-group><year iso-8601-date="1989">1989</year><article-title>The phylogenetic regression</article-title><source>Philosophical Transactions of the Royal Society of London. Series B, Biological Sciences</source><volume>326</volume><fpage>119</fpage><lpage>157</lpage><pub-id pub-id-type="doi">10.1098/rstb.1989.0106</pub-id><pub-id pub-id-type="pmid">2575770</pub-id></element-citation></ref><ref id="bib34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Griffiths</surname><given-names>RC</given-names></name><name><surname>Tavaré</surname><given-names>S</given-names></name></person-group><year iso-8601-date="1994">1994</year><article-title>Sampling theory for neutral alleles in a varying environment</article-title><source>Philosophical Transactions of the Royal Society of London. Series B, Biological Sciences</source><volume>344</volume><fpage>403</fpage><lpage>410</lpage><pub-id pub-id-type="doi">10.1098/rstb.1994.0079</pub-id><pub-id pub-id-type="pmid">7800710</pub-id></element-citation></ref><ref id="bib35"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Griffiths</surname><given-names>RC</given-names></name><name><surname>Tavare</surname><given-names>S</given-names></name></person-group><year iso-8601-date="1997">1997</year><chapter-title>Computational methods for the coalescent</chapter-title><person-group person-group-type="editor"><name><surname>Spirn</surname><given-names>D</given-names></name></person-group><source>IMA Volumes in Mathematics and Its Applications</source><publisher-name>CoLab</publisher-name><fpage>165</fpage><lpage>182</lpage><pub-id pub-id-type="doi">10.1007/978-1-4757-2609-1_10</pub-id></element-citation></ref><ref id="bib36"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Grundler</surname><given-names>MC</given-names></name><name><surname>Terhorst</surname><given-names>J</given-names></name><name><surname>Bradburd</surname><given-names>GS</given-names></name></person-group><year iso-8601-date="2024">2024</year><article-title>A geographic history of human genetic ancestry</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/2024.03.27.586858</pub-id></element-citation></ref><ref id="bib37"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Gunnarsson</surname><given-names>ÁF</given-names></name><name><surname>Zhu</surname><given-names>J</given-names></name><name><surname>Zhang</surname><given-names>BC</given-names></name><name><surname>Tsangalidou</surname><given-names>Z</given-names></name><name><surname>Allmont</surname><given-names>A</given-names></name><name><surname>Palamara</surname><given-names>PF</given-names></name></person-group><year iso-8601-date="2024">2024</year><article-title>A scalable approach for genome-wide inference of ancestral recombination graphs</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/2024.08.31.610248</pub-id></element-citation></ref><ref id="bib38"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Haller</surname><given-names>BC</given-names></name><name><surname>Galloway</surname><given-names>J</given-names></name><name><surname>Kelleher</surname><given-names>J</given-names></name><name><surname>Messer</surname><given-names>PW</given-names></name><name><surname>Ralph</surname><given-names>PL</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Tree-sequence recording in SLiM opens new horizons for forward-time simulation of whole genomes</article-title><source>Molecular Ecology Resources</source><volume>19</volume><fpage>552</fpage><lpage>566</lpage><pub-id pub-id-type="doi">10.1111/1755-0998.12968</pub-id><pub-id pub-id-type="pmid">30565882</pub-id></element-citation></ref><ref id="bib39"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Haller</surname><given-names>BC</given-names></name><name><surname>Messer</surname><given-names>PW</given-names></name></person-group><year iso-8601-date="2023">2023</year><article-title>SLiM 4: multispecies eco-evolutionary modeling</article-title><source>The American Naturalist</source><volume>201</volume><fpage>E127</fpage><lpage>E139</lpage><pub-id pub-id-type="doi">10.1086/723601</pub-id><pub-id pub-id-type="pmid">37130229</pub-id></element-citation></ref><ref id="bib40"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Harmon</surname><given-names>LJ</given-names></name><name><surname>Losos</surname><given-names>JB</given-names></name><name><surname>Jonathan Davies</surname><given-names>T</given-names></name><name><surname>Gillespie</surname><given-names>RG</given-names></name><name><surname>Gittleman</surname><given-names>JL</given-names></name><name><surname>Bryan Jennings</surname><given-names>W</given-names></name><name><surname>Kozak</surname><given-names>KH</given-names></name><name><surname>McPeek</surname><given-names>MA</given-names></name><name><surname>Moreno-Roark</surname><given-names>F</given-names></name><name><surname>Near</surname><given-names>TJ</given-names></name><name><surname>Purvis</surname><given-names>A</given-names></name><name><surname>Ricklefs</surname><given-names>RE</given-names></name><name><surname>Schluter</surname><given-names>D</given-names></name><name><surname>Schulte Ii</surname><given-names>JA</given-names></name><name><surname>Seehausen</surname><given-names>O</given-names></name><name><surname>Sidlauskas</surname><given-names>BL</given-names></name><name><surname>Torres-Carvajal</surname><given-names>O</given-names></name><name><surname>Weir</surname><given-names>JT</given-names></name><name><surname>Mooers</surname><given-names>AØ</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Early bursts of body size and shape evolution are rare in comparative data</article-title><source>Evolution</source><volume>64</volume><fpage>2385</fpage><lpage>2396</lpage><pub-id pub-id-type="doi">10.1111/j.1558-5646.2010.01025.x</pub-id><pub-id pub-id-type="pmid">20455932</pub-id></element-citation></ref><ref id="bib41"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hewitt</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2000">2000</year><article-title>The genetic legacy of the Quaternary ice ages</article-title><source>Nature</source><volume>405</volume><fpage>907</fpage><lpage>913</lpage><pub-id pub-id-type="doi">10.1038/35016000</pub-id></element-citation></ref><ref id="bib42"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hsu</surname><given-names>C-W</given-names></name><name><surname>Lo</surname><given-names>C-Y</given-names></name><name><surname>Lee</surname><given-names>C-R</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>On the postglacial spread of human commensal <italic>Arabidopsis thaliana</italic>: journey to the East</article-title><source>The New Phytologist</source><volume>222</volume><fpage>1447</fpage><lpage>1457</lpage><pub-id pub-id-type="doi">10.1111/nph.15682</pub-id><pub-id pub-id-type="pmid">30636325</pub-id></element-citation></ref><ref id="bib43"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hudson</surname><given-names>RR</given-names></name></person-group><year iso-8601-date="2001">2001</year><article-title>Two-locus sampling distributions and their application</article-title><source>Genetics</source><volume>159</volume><fpage>1805</fpage><lpage>1817</lpage><pub-id pub-id-type="doi">10.1093/genetics/159.4.1805</pub-id><pub-id pub-id-type="pmid">11779816</pub-id></element-citation></ref><ref id="bib44"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hudson</surname><given-names>RR</given-names></name></person-group><year iso-8601-date="2002">2002</year><article-title>Generating samples under a Wright-Fisher neutral model of genetic variation</article-title><source>Bioinformatics</source><volume>18</volume><fpage>337</fpage><lpage>338</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/18.2.337</pub-id><pub-id pub-id-type="pmid">11847089</pub-id></element-citation></ref><ref id="bib45"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Ianni-Ravn</surname><given-names>MK</given-names></name><name><surname>Petr</surname><given-names>M</given-names></name><name><surname>Racimo</surname><given-names>F</given-names></name></person-group><year iso-8601-date="2023">2023</year><article-title>Exploring the effects of ecological parameters on the spatial structure of genealogies</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/2023.03.27.534388</pub-id></element-citation></ref><ref id="bib46"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Igolkina</surname><given-names>AA</given-names></name><name><surname>Vorbrugg</surname><given-names>S</given-names></name><name><surname>Rabanal</surname><given-names>FA</given-names></name><name><surname>Liu</surname><given-names>HJ</given-names></name><name><surname>Ashkenazy</surname><given-names>H</given-names></name><name><surname>Kornienko</surname><given-names>AE</given-names></name><name><surname>Fitz</surname><given-names>J</given-names></name><name><surname>Collenberg</surname><given-names>M</given-names></name><name><surname>Kubica</surname><given-names>C</given-names></name><name><surname>Morales</surname><given-names>AM</given-names></name><name><surname>Jaegle</surname><given-names>B</given-names></name><name><surname>Wrightsman</surname><given-names>T</given-names></name><name><surname>Voloshin</surname><given-names>V</given-names></name><name><surname>Llaca</surname><given-names>V</given-names></name><name><surname>Nizhynska</surname><given-names>V</given-names></name><name><surname>Reichardt</surname><given-names>I</given-names></name><name><surname>Lanz</surname><given-names>C</given-names></name><name><surname>Bemm</surname><given-names>F</given-names></name><name><surname>Flood</surname><given-names>PJ</given-names></name><name><surname>Nemomissa</surname><given-names>S</given-names></name><name><surname>Hancock</surname><given-names>A</given-names></name><name><surname>Guo</surname><given-names>YL</given-names></name><name><surname>Kersey</surname><given-names>P</given-names></name><name><surname>Weigel</surname><given-names>D</given-names></name><name><surname>Nordborg</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2024">2024</year><article-title>Towards an unbiased characterization of genetic polymorphism</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/2024.05.30.596703</pub-id></element-citation></ref><ref id="bib47"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Jefferyn</surname><given-names>B</given-names></name><name><surname>Kelleher</surname><given-names>J</given-names></name><name><surname>Wong</surname><given-names>Y</given-names></name></person-group><year iso-8601-date="2024">2024</year><data-title>Tskit-dev/tsconvert</data-title><version designator="swh:1:rev:057435c9d16ae08176d9129c27856424f296e6b4">swh:1:rev:057435c9d16ae08176d9129c27856424f296e6b4</version><source>Software Heritage</source><ext-link ext-link-type="uri" xlink:href="https://archive.softwareheritage.org/swh:1:dir:ab2aa292f501633950ad41d84ce78a22fe500bcf;origin=https://github.com/tskit-dev/tsconvert;visit=swh:1:snp:d70a8e9ba9a5954629870906feca469b51fcc34e;anchor=swh:1:rev:057435c9d16ae08176d9129c27856424f296e6b4">https://archive.softwareheritage.org/swh:1:dir:ab2aa292f501633950ad41d84ce78a22fe500bcf;origin=https://github.com/tskit-dev/tsconvert;visit=swh:1:snp:d70a8e9ba9a5954629870906feca469b51fcc34e;anchor=swh:1:rev:057435c9d16ae08176d9129c27856424f296e6b4</ext-link></element-citation></ref><ref id="bib48"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kalkauskas</surname><given-names>A</given-names></name><name><surname>Perron</surname><given-names>U</given-names></name><name><surname>Sun</surname><given-names>Y</given-names></name><name><surname>Goldman</surname><given-names>N</given-names></name><name><surname>Baele</surname><given-names>G</given-names></name><name><surname>Guindon</surname><given-names>S</given-names></name><name><surname>De Maio</surname><given-names>N</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Sampling bias and model choice in continuous phylogeography: Getting lost on a random walk</article-title><source>PLOS Computational Biology</source><volume>17</volume><elocation-id>e1008561</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1008561</pub-id><pub-id pub-id-type="pmid">33406072</pub-id></element-citation></ref><ref id="bib49"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Keightley</surname><given-names>PD</given-names></name><name><surname>Jackson</surname><given-names>BC</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Inferring the probability of the derived vs the ancestral allelic asate at a polymorphic site</article-title><source>Genetics</source><volume>209</volume><fpage>897</fpage><lpage>906</lpage><pub-id pub-id-type="doi">10.1534/genetics.118.301120</pub-id><pub-id pub-id-type="pmid">29769282</pub-id></element-citation></ref><ref id="bib50"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kelleher</surname><given-names>J</given-names></name><name><surname>Etheridge</surname><given-names>AM</given-names></name><name><surname>McVean</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2016">2016a</year><article-title>Efficient coalescent simulation and genealogical analysis for large sample sizes</article-title><source>PLOS Computational Biology</source><volume>12</volume><elocation-id>e1004842</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1004842</pub-id><pub-id pub-id-type="pmid">27145223</pub-id></element-citation></ref><ref id="bib51"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kelleher</surname><given-names>J</given-names></name><name><surname>Etheridge</surname><given-names>AM</given-names></name><name><surname>Véber</surname><given-names>A</given-names></name><name><surname>Barton</surname><given-names>NH</given-names></name></person-group><year iso-8601-date="2016">2016b</year><article-title>Spread of pedigree versus genetic ancestry in spatially distributed populations</article-title><source>Theoretical Population Biology</source><volume>108</volume><fpage>1</fpage><lpage>12</lpage><pub-id pub-id-type="doi">10.1016/j.tpb.2015.10.008</pub-id></element-citation></ref><ref id="bib52"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kelleher</surname><given-names>J</given-names></name><name><surname>Thornton</surname><given-names>KR</given-names></name><name><surname>Ashander</surname><given-names>J</given-names></name><name><surname>Ralph</surname><given-names>PL</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Efficient pedigree recording for fast population genetics simulation</article-title><source>PLOS Computational Biology</source><volume>14</volume><elocation-id>e1006581</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1006581</pub-id><pub-id pub-id-type="pmid">30383757</pub-id></element-citation></ref><ref id="bib53"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kelleher</surname><given-names>J</given-names></name><name><surname>Wong</surname><given-names>Y</given-names></name><name><surname>Wohns</surname><given-names>AW</given-names></name><name><surname>Fadil</surname><given-names>C</given-names></name><name><surname>Albers</surname><given-names>PK</given-names></name><name><surname>McVean</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Inferring whole-genome histories in large population datasets</article-title><source>Nature Genetics</source><volume>51</volume><fpage>1330</fpage><lpage>1338</lpage><pub-id pub-id-type="doi">10.1038/s41588-019-0483-y</pub-id><pub-id pub-id-type="pmid">31477934</pub-id></element-citation></ref><ref id="bib54"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kim</surname><given-names>S</given-names></name><name><surname>Plagnol</surname><given-names>V</given-names></name><name><surname>Hu</surname><given-names>TT</given-names></name><name><surname>Toomajian</surname><given-names>C</given-names></name><name><surname>Clark</surname><given-names>RM</given-names></name><name><surname>Ossowski</surname><given-names>S</given-names></name><name><surname>Ecker</surname><given-names>JR</given-names></name><name><surname>Weigel</surname><given-names>D</given-names></name><name><surname>Nordborg</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Recombination and linkage disequilibrium in <italic>Arabidopsis thaliana</italic></article-title><source>Nature Genetics</source><volume>39</volume><fpage>1151</fpage><lpage>1155</lpage><pub-id pub-id-type="doi">10.1038/ng2115</pub-id></element-citation></ref><ref id="bib55"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kimura</surname><given-names>M</given-names></name></person-group><year iso-8601-date="1980">1980</year><article-title>A simple method for estimating evolutionary rates of base substitutions through comparative studies of nucleotide sequences</article-title><source>Journal of Molecular Evolution</source><volume>16</volume><fpage>111</fpage><lpage>120</lpage><pub-id pub-id-type="doi">10.1007/BF01731581</pub-id></element-citation></ref><ref id="bib56"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Knowles</surname><given-names>LL</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Statistical phylogeography</article-title><source>Annual Review of Ecology, Evolution, and Systematics</source><volume>40</volume><fpage>593</fpage><lpage>612</lpage><pub-id pub-id-type="doi">10.1146/annurev.ecolsys.38.091206.095702</pub-id></element-citation></ref><ref id="bib57"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lachance</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Inbreeding, pedigree size, and the most recent common ancestor of humanity</article-title><source>Journal of Theoretical Biology</source><volume>261</volume><fpage>238</fpage><lpage>247</lpage><pub-id pub-id-type="doi">10.1016/j.jtbi.2009.08.006</pub-id><pub-id pub-id-type="pmid">19679139</pub-id></element-citation></ref><ref id="bib58"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Landis</surname><given-names>MJ</given-names></name><name><surname>Schraiber</surname><given-names>JG</given-names></name><name><surname>Liang</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Phylogenetic analysis using Lévy processes: finding jumps in the evolution of continuous traits</article-title><source>Systematic Biology</source><volume>62</volume><fpage>193</fpage><lpage>204</lpage><pub-id pub-id-type="doi">10.1093/sysbio/sys086</pub-id><pub-id pub-id-type="pmid">23034385</pub-id></element-citation></ref><ref id="bib59"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Larribe</surname><given-names>F</given-names></name><name><surname>Fearnhead</surname><given-names>P</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>On composite likelihoods in statistical genetics</article-title><source>Statistica Sinica</source><volume>21</volume><fpage>43</fpage><lpage>69</lpage></element-citation></ref><ref id="bib60"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lee</surname><given-names>KM</given-names></name><name><surname>Coop</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Distinguishing among modes of convergent adaptation using population genomic data</article-title><source>Genetics</source><volume>207</volume><fpage>1591</fpage><lpage>1619</lpage><pub-id pub-id-type="doi">10.1534/genetics.117.300417</pub-id><pub-id pub-id-type="pmid">29046403</pub-id></element-citation></ref><ref id="bib61"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lee</surname><given-names>CR</given-names></name><name><surname>Svardal</surname><given-names>H</given-names></name><name><surname>Farlow</surname><given-names>A</given-names></name><name><surname>Exposito-Alonso</surname><given-names>M</given-names></name><name><surname>Ding</surname><given-names>W</given-names></name><name><surname>Novikova</surname><given-names>P</given-names></name><name><surname>Alonso-Blanco</surname><given-names>C</given-names></name><name><surname>Weigel</surname><given-names>D</given-names></name><name><surname>Nordborg</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>On the post-glacial spread of human commensal <italic>Arabidopsis thaliana</italic></article-title><source>Nature Communications</source><volume>8</volume><elocation-id>14458</elocation-id><pub-id pub-id-type="doi">10.1038/ncomms14458</pub-id><pub-id pub-id-type="pmid">28181519</pub-id></element-citation></ref><ref id="bib62"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lemey</surname><given-names>P</given-names></name><name><surname>Rambaut</surname><given-names>A</given-names></name><name><surname>Drummond</surname><given-names>AJ</given-names></name><name><surname>Suchard</surname><given-names>MA</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Bayesian phylogeography finds its roots</article-title><source>PLOS Computational Biology</source><volume>5</volume><elocation-id>e1000520</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1000520</pub-id><pub-id pub-id-type="pmid">19779555</pub-id></element-citation></ref><ref id="bib63"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lemey</surname><given-names>P</given-names></name><name><surname>Rambaut</surname><given-names>A</given-names></name><name><surname>Welch</surname><given-names>JJ</given-names></name><name><surname>Suchard</surname><given-names>MA</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Phylogeography takes a relaxed random walk in continuous space and time</article-title><source>Molecular Biology and Evolution</source><volume>27</volume><fpage>1877</fpage><lpage>1885</lpage><pub-id pub-id-type="doi">10.1093/molbev/msq067</pub-id><pub-id pub-id-type="pmid">20203288</pub-id></element-citation></ref><ref id="bib64"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lemey</surname><given-names>P</given-names></name><name><surname>Hong</surname><given-names>SL</given-names></name><name><surname>Hill</surname><given-names>V</given-names></name><name><surname>Baele</surname><given-names>G</given-names></name><name><surname>Poletto</surname><given-names>C</given-names></name><name><surname>Colizza</surname><given-names>V</given-names></name><name><surname>O’Toole</surname><given-names>Á</given-names></name><name><surname>McCrone</surname><given-names>JT</given-names></name><name><surname>Andersen</surname><given-names>KG</given-names></name><name><surname>Worobey</surname><given-names>M</given-names></name><name><surname>Nelson</surname><given-names>MI</given-names></name><name><surname>Rambaut</surname><given-names>A</given-names></name><name><surname>Suchard</surname><given-names>MA</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Accommodating individual travel history and unsampled diversity in Bayesian phylogeographic inference of SARS-CoV-2</article-title><source>Nature Communications</source><volume>11</volume><elocation-id>5110</elocation-id><pub-id pub-id-type="doi">10.1038/s41467-020-18877-9</pub-id><pub-id pub-id-type="pmid">33037213</pub-id></element-citation></ref><ref id="bib65"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lewanski</surname><given-names>AL</given-names></name><name><surname>Grundler</surname><given-names>MC</given-names></name><name><surname>Bradburd</surname><given-names>GS</given-names></name></person-group><year iso-8601-date="2024">2024</year><article-title>The era of the ARG: An introduction to ancestral recombination graphs and their significance in empirical evolutionary genomics</article-title><source>PLOS Genetics</source><volume>20</volume><elocation-id>e1011110</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pgen.1011110</pub-id><pub-id pub-id-type="pmid">38236805</pub-id></element-citation></ref><ref id="bib66"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>H</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Minimap2: pairwise alignment for nucleotide sequences</article-title><source>Bioinformatics</source><volume>34</volume><fpage>3094</fpage><lpage>3100</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/bty191</pub-id><pub-id pub-id-type="pmid">29750242</pub-id></element-citation></ref><ref id="bib67"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>H</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>New strategies to improve minimap2 alignment accuracy</article-title><source>Bioinformatics</source><volume>37</volume><fpage>4572</fpage><lpage>4574</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btab705</pub-id><pub-id pub-id-type="pmid">34623391</pub-id></element-citation></ref><ref id="bib68"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Malécot</surname><given-names>G</given-names></name></person-group><year iso-8601-date="1948">1948</year><source>The Mathematics of Heredity</source><publisher-name>W. H. Freeman</publisher-name></element-citation></ref><ref id="bib69"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Martin</surname><given-names>MA</given-names></name><name><surname>VanInsberghe</surname><given-names>D</given-names></name><name><surname>Koelle</surname><given-names>K</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Insights from SARS-CoV-2 sequences</article-title><source>Science</source><volume>371</volume><fpage>466</fpage><lpage>467</lpage><pub-id pub-id-type="doi">10.1126/science.abf3995</pub-id></element-citation></ref><ref id="bib70"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Meligkotsidou</surname><given-names>L</given-names></name><name><surname>Fearnhead</surname><given-names>P</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Postprocessing of genealogical trees</article-title><source>Genetics</source><volume>177</volume><fpage>347</fpage><lpage>358</lpage><pub-id pub-id-type="doi">10.1534/genetics.107.071910</pub-id><pub-id pub-id-type="pmid">17565950</pub-id></element-citation></ref><ref id="bib71"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mölder</surname><given-names>F</given-names></name><name><surname>Jablonski</surname><given-names>KP</given-names></name><name><surname>Letcher</surname><given-names>B</given-names></name><name><surname>Hall</surname><given-names>MB</given-names></name><name><surname>Tomkins-Tinch</surname><given-names>CH</given-names></name><name><surname>Sochat</surname><given-names>V</given-names></name><name><surname>Forster</surname><given-names>J</given-names></name><name><surname>Lee</surname><given-names>S</given-names></name><name><surname>Twardziok</surname><given-names>SO</given-names></name><name><surname>Kanitz</surname><given-names>A</given-names></name><name><surname>Wilm</surname><given-names>A</given-names></name><name><surname>Holtgrewe</surname><given-names>M</given-names></name><name><surname>Rahmann</surname><given-names>S</given-names></name><name><surname>Nahnsen</surname><given-names>S</given-names></name><name><surname>Köster</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Sustainable data analysis with Snakemake</article-title><source>F1000Research</source><volume>10</volume><elocation-id>33</elocation-id><pub-id pub-id-type="doi">10.12688/f1000research.29032.2</pub-id><pub-id pub-id-type="pmid">34035898</pub-id></element-citation></ref><ref id="bib72"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nielsen</surname><given-names>R</given-names></name><name><surname>Vaughn</surname><given-names>AH</given-names></name><name><surname>Deng</surname><given-names>Y</given-names></name></person-group><year iso-8601-date="2024">2024</year><article-title>Inference and applications of ancestral recombination graphs</article-title><source>Nature Reviews Genetics</source><volume>1</volume><fpage>1</fpage><lpage>12</lpage><pub-id pub-id-type="doi">10.1038/s41576-024-00772-4</pub-id></element-citation></ref><ref id="bib73"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nordborg</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2000">2000</year><article-title>Linkage disequilibrium, gene trees and selfing: an ancestral recombination graph with partial self-fertilization</article-title><source>Genetics</source><volume>154</volume><fpage>923</fpage><lpage>929</lpage><pub-id pub-id-type="doi">10.1093/genetics/154.2.923</pub-id><pub-id pub-id-type="pmid">10655241</pub-id></element-citation></ref><ref id="bib74"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Novembre</surname><given-names>J</given-names></name><name><surname>Slatkin</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Likelihood-based inference in isolation-by-distance models using the spatial distribution of low-frequency alleles</article-title><source>Evolution; International Journal of Organic Evolution</source><volume>63</volume><fpage>2914</fpage><lpage>2925</lpage><pub-id pub-id-type="doi">10.1111/j.1558-5646.2009.00775.x</pub-id><pub-id pub-id-type="pmid">19624728</pub-id></element-citation></ref><ref id="bib75"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>O’Meara</surname><given-names>BC</given-names></name><name><surname>Ané</surname><given-names>C</given-names></name><name><surname>Sanderson</surname><given-names>MJ</given-names></name><name><surname>Wainwright</surname><given-names>PC</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Testing for different rates of continuous trait evolution using likelihood</article-title><source>Evolution; International Journal of Organic Evolution</source><volume>60</volume><fpage>922</fpage><lpage>933</lpage><pub-id pub-id-type="doi">10.1111/j.0014-3820.2006.tb01171.x</pub-id><pub-id pub-id-type="pmid">16817533</pub-id></element-citation></ref><ref id="bib76"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Osmond</surname><given-names>MM</given-names></name><name><surname>Coop</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Estimating dispersal rates and locating genetic ancestors with genome-wide genealogies</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/2021.07.13.452277</pub-id></element-citation></ref><ref id="bib77"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Osmond</surname><given-names>MM</given-names></name></person-group><year iso-8601-date="2024">2024a</year><data-title>Spacetrees-ms</data-title><version designator="swh:1:rev:ee019496347ae1dae89fad4ee8b7b9492a73be0d">swh:1:rev:ee019496347ae1dae89fad4ee8b7b9492a73be0d</version><source>Software Heritage</source><ext-link ext-link-type="uri" xlink:href="https://archive.softwareheritage.org/swh:1:dir:feaa82f3bdf43723a9a940942215c73b19bda25f;origin=https://github.com/mmosmond/spacetrees-ms;visit=swh:1:snp:58acb57de7efe6152d8ef4973470d1737d94fb56;anchor=swh:1:rev:ee019496347ae1dae89fad4ee8b7b9492a73be0d">https://archive.softwareheritage.org/swh:1:dir:feaa82f3bdf43723a9a940942215c73b19bda25f;origin=https://github.com/mmosmond/spacetrees-ms;visit=swh:1:snp:58acb57de7efe6152d8ef4973470d1737d94fb56;anchor=swh:1:rev:ee019496347ae1dae89fad4ee8b7b9492a73be0d</ext-link></element-citation></ref><ref id="bib78"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Osmond</surname><given-names>MM</given-names></name></person-group><year iso-8601-date="2024">2024b</year><data-title>Spacetrees</data-title><version designator="swh:1:rev:a1c874cb8a9afeb83754d6e7d97e031505b80519">swh:1:rev:a1c874cb8a9afeb83754d6e7d97e031505b80519</version><source>Software Heritage</source><ext-link ext-link-type="uri" xlink:href="https://archive.softwareheritage.org/swh:1:dir:f6798ddff6e88ae3b8c4e3b62a437b06bcc75b3f;origin=https://github.com/osmond-lab/spacetrees;visit=swh:1:snp:ebc08585273d7e6578f2f782d565110c4d3cf0e1;anchor=swh:1:rev:a1c874cb8a9afeb83754d6e7d97e031505b80519">https://archive.softwareheritage.org/swh:1:dir:f6798ddff6e88ae3b8c4e3b62a437b06bcc75b3f;origin=https://github.com/osmond-lab/spacetrees;visit=swh:1:snp:ebc08585273d7e6578f2f782d565110c4d3cf0e1;anchor=swh:1:rev:a1c874cb8a9afeb83754d6e7d97e031505b80519</ext-link></element-citation></ref><ref id="bib79"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Platt</surname><given-names>A</given-names></name><name><surname>Horton</surname><given-names>M</given-names></name><name><surname>Huang</surname><given-names>YS</given-names></name><name><surname>Li</surname><given-names>Y</given-names></name><name><surname>Anastasio</surname><given-names>AE</given-names></name><name><surname>Mulyati</surname><given-names>NW</given-names></name><name><surname>Agren</surname><given-names>J</given-names></name><name><surname>Bossdorf</surname><given-names>O</given-names></name><name><surname>Byers</surname><given-names>D</given-names></name><name><surname>Donohue</surname><given-names>K</given-names></name><name><surname>Dunning</surname><given-names>M</given-names></name><name><surname>Holub</surname><given-names>EB</given-names></name><name><surname>Hudson</surname><given-names>A</given-names></name><name><surname>Le Corre</surname><given-names>V</given-names></name><name><surname>Loudet</surname><given-names>O</given-names></name><name><surname>Roux</surname><given-names>F</given-names></name><name><surname>Warthmann</surname><given-names>N</given-names></name><name><surname>Weigel</surname><given-names>D</given-names></name><name><surname>Rivero</surname><given-names>L</given-names></name><name><surname>Scholl</surname><given-names>R</given-names></name><name><surname>Nordborg</surname><given-names>M</given-names></name><name><surname>Bergelson</surname><given-names>J</given-names></name><name><surname>Borevitz</surname><given-names>JO</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>The scale of population structure in <italic>Arabidopsis thaliana</italic></article-title><source>PLOS Genetics</source><volume>6</volume><elocation-id>e1000843</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pgen.1000843</pub-id><pub-id pub-id-type="pmid">20169178</pub-id></element-citation></ref><ref id="bib80"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ralph</surname><given-names>P</given-names></name><name><surname>Coop</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>The geography of recent genetic ancestry across Europe</article-title><source>PLOS Biology</source><volume>11</volume><elocation-id>e1001555</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pbio.1001555</pub-id><pub-id pub-id-type="pmid">23667324</pub-id></element-citation></ref><ref id="bib81"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ralph</surname><given-names>P</given-names></name><name><surname>Thornton</surname><given-names>K</given-names></name><name><surname>Kelleher</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Efficiently summarizing relationships in large samples: a general duality between statistics of genealogies and genomes</article-title><source>Genetics</source><volume>215</volume><fpage>779</fpage><lpage>797</lpage><pub-id pub-id-type="doi">10.1534/genetics.120.303253</pub-id><pub-id pub-id-type="pmid">32357960</pub-id></element-citation></ref><ref id="bib82"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Ralph</surname><given-names>P</given-names></name><name><surname>Jefferyn</surname><given-names>B</given-names></name><name><surname>Wong</surname><given-names>Y</given-names></name></person-group><year iso-8601-date="2024">2024</year><data-title>Tskit-dev/pyslim</data-title><version designator="swh:1:rev:4cb44e23608c33ed0086509674970adeb182cf7c">swh:1:rev:4cb44e23608c33ed0086509674970adeb182cf7c</version><source>Software Heritage</source><ext-link ext-link-type="uri" xlink:href="https://archive.softwareheritage.org/swh:1:dir:b0d2a4ac3c4f49a9a089aad203298352a66d0c12;origin=https://github.com/tskit-dev/pyslim;visit=swh:1:snp:c367f50c372a36fc48009be36cd7db29047d8358;anchor=swh:1:rev:4cb44e23608c33ed0086509674970adeb182cf7c">https://archive.softwareheritage.org/swh:1:dir:b0d2a4ac3c4f49a9a089aad203298352a66d0c12;origin=https://github.com/tskit-dev/pyslim;visit=swh:1:snp:c367f50c372a36fc48009be36cd7db29047d8358;anchor=swh:1:rev:4cb44e23608c33ed0086509674970adeb182cf7c</ext-link></element-citation></ref><ref id="bib83"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rannala</surname><given-names>B</given-names></name><name><surname>Yang</surname><given-names>Z</given-names></name></person-group><year iso-8601-date="1996">1996</year><article-title>Probability distribution of molecular evolutionary trees: a new method of phylogenetic inference</article-title><source>Journal of Molecular Evolution</source><volume>43</volume><fpage>304</fpage><lpage>311</lpage><pub-id pub-id-type="doi">10.1007/PL00006090</pub-id></element-citation></ref><ref id="bib84"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rasmussen</surname><given-names>MD</given-names></name><name><surname>Hubisz</surname><given-names>MJ</given-names></name><name><surname>Gronau</surname><given-names>I</given-names></name><name><surname>Siepel</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Genome-wide inference of ancestral recombination graphs</article-title><source>PLOS Genetics</source><volume>10</volume><elocation-id>e1004342</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pgen.1004342</pub-id><pub-id pub-id-type="pmid">24831947</pub-id></element-citation></ref><ref id="bib85"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Reich</surname><given-names>D</given-names></name></person-group><year iso-8601-date="2018">2018</year><source>Who We Are and How We Got Here: Ancient DNA and the New Science of the Human Past</source><publisher-name>Oxford University Press</publisher-name></element-citation></ref><ref id="bib86"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ringbauer</surname><given-names>H</given-names></name><name><surname>Coop</surname><given-names>G</given-names></name><name><surname>Barton</surname><given-names>NH</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Inferring recent demography from isolation by distance of long shared sequence blocks</article-title><source>Genetics</source><volume>205</volume><fpage>1335</fpage><lpage>1351</lpage><pub-id pub-id-type="doi">10.1534/genetics.116.196220</pub-id><pub-id pub-id-type="pmid">28108588</pub-id></element-citation></ref><ref id="bib87"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rousset</surname><given-names>F</given-names></name></person-group><year iso-8601-date="1997">1997</year><article-title>Genetic differentiation and estimation of gene flow from F-statistics under isolation by distance</article-title><source>Genetics</source><volume>145</volume><fpage>1219</fpage><lpage>1228</lpage><pub-id pub-id-type="doi">10.1093/genetics/145.4.1219</pub-id><pub-id pub-id-type="pmid">9093870</pub-id></element-citation></ref><ref id="bib88"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Salomé</surname><given-names>PA</given-names></name><name><surname>Bomblies</surname><given-names>K</given-names></name><name><surname>Fitz</surname><given-names>J</given-names></name><name><surname>Laitinen</surname><given-names>RAE</given-names></name><name><surname>Warthmann</surname><given-names>N</given-names></name><name><surname>Yant</surname><given-names>L</given-names></name><name><surname>Weigel</surname><given-names>D</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>The recombination landscape in <italic>Arabidopsis thaliana</italic> F2 populations</article-title><source>Heredity</source><volume>108</volume><fpage>447</fpage><lpage>455</lpage><pub-id pub-id-type="doi">10.1038/hdy.2011.95</pub-id><pub-id pub-id-type="pmid">22072068</pub-id></element-citation></ref><ref id="bib89"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schaefer</surname><given-names>NK</given-names></name><name><surname>Shapiro</surname><given-names>B</given-names></name><name><surname>Green</surname><given-names>RE</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>An ancestral recombination graph of human, Neanderthal, and Denisovan genomes</article-title><source>Science Advances</source><volume>7</volume><elocation-id>eabc0776</elocation-id><pub-id pub-id-type="doi">10.1126/sciadv.abc0776</pub-id><pub-id pub-id-type="pmid">34272242</pub-id></element-citation></ref><ref id="bib90"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schluter</surname><given-names>D</given-names></name><name><surname>Price</surname><given-names>T</given-names></name><name><surname>Mooers</surname><given-names>AØ</given-names></name><name><surname>Ludwig</surname><given-names>D</given-names></name></person-group><year iso-8601-date="1997">1997</year><article-title>Likelihood of ancestor states in adaptive radiation</article-title><source>Evolution; International Journal of Organic Evolution</source><volume>51</volume><fpage>1699</fpage><lpage>1711</lpage><pub-id pub-id-type="doi">10.1111/j.1558-5646.1997.tb05095.x</pub-id><pub-id pub-id-type="pmid">28565128</pub-id></element-citation></ref><ref id="bib91"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Slatkin</surname><given-names>M</given-names></name><name><surname>Racimo</surname><given-names>F</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Ancient DNA and human history</article-title><source>PNAS</source><volume>113</volume><fpage>6380</fpage><lpage>6387</lpage><pub-id pub-id-type="doi">10.1073/pnas.1524306113</pub-id><pub-id pub-id-type="pmid">27274045</pub-id></element-citation></ref><ref id="bib92"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Smith</surname><given-names>CCR</given-names></name><name><surname>Tittes</surname><given-names>S</given-names></name><name><surname>Ralph</surname><given-names>PL</given-names></name><name><surname>Kern</surname><given-names>AD</given-names></name></person-group><year iso-8601-date="2023">2023</year><article-title>Dispersal inference from population genetic variation using a convolutional neural network</article-title><source>Genetics</source><volume>224</volume><elocation-id>iyad068</elocation-id><pub-id pub-id-type="doi">10.1093/genetics/iyad068</pub-id><pub-id pub-id-type="pmid">37052957</pub-id></element-citation></ref><ref id="bib93"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Speidel</surname><given-names>L</given-names></name><name><surname>Forest</surname><given-names>M</given-names></name><name><surname>Shi</surname><given-names>S</given-names></name><name><surname>Myers</surname><given-names>SR</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>A method for genome-wide genealogy estimation for thousands of samples</article-title><source>Nature Genetics</source><volume>51</volume><fpage>1321</fpage><lpage>1329</lpage><pub-id pub-id-type="doi">10.1038/s41588-019-0484-x</pub-id><pub-id pub-id-type="pmid">31477933</pub-id></element-citation></ref><ref id="bib94"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Speidel</surname><given-names>L</given-names></name><name><surname>Cassidy</surname><given-names>L</given-names></name><name><surname>Davies</surname><given-names>RW</given-names></name><name><surname>Hellenthal</surname><given-names>G</given-names></name><name><surname>Skoglund</surname><given-names>P</given-names></name><name><surname>Myers</surname><given-names>SR</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Inferring population histories for ancient genomes using genome-wide genealogies</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/2021.02.17.431573</pub-id></element-citation></ref><ref id="bib95"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stephens</surname><given-names>M</given-names></name><name><surname>Donnelly</surname><given-names>P</given-names></name></person-group><year iso-8601-date="2000">2000</year><article-title>Inference in molecular population genetics</article-title><source>Journal of the Royal Statistical Society Series B</source><volume>62</volume><fpage>605</fpage><lpage>635</lpage><pub-id pub-id-type="doi">10.1111/1467-9868.00254</pub-id></element-citation></ref><ref id="bib96"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stern</surname><given-names>AJ</given-names></name><name><surname>Wilton</surname><given-names>PR</given-names></name><name><surname>Nielsen</surname><given-names>R</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>An approximate full-likelihood method for inferring selection and allele frequency trajectories from DNA sequence data</article-title><source>PLOS Genetics</source><volume>15</volume><elocation-id>e1008384</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pgen.1008384</pub-id><pub-id pub-id-type="pmid">31518343</pub-id></element-citation></ref><ref id="bib97"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stern</surname><given-names>AJ</given-names></name><name><surname>Speidel</surname><given-names>L</given-names></name><name><surname>Zaitlen</surname><given-names>NA</given-names></name><name><surname>Nielsen</surname><given-names>R</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Disentangling selection on genetically correlated polygenic traits via whole-genome genealogies</article-title><source>American Journal of Human Genetics</source><volume>108</volume><fpage>219</fpage><lpage>239</lpage><pub-id pub-id-type="doi">10.1016/j.ajhg.2020.12.005</pub-id><pub-id pub-id-type="pmid">33440170</pub-id></element-citation></ref><ref id="bib98"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Taylor</surname><given-names>J</given-names></name><name><surname>Harris</surname><given-names>B</given-names></name><name><surname>Soranzo</surname><given-names>N</given-names></name></person-group><year iso-8601-date="2020">2020</year><data-title>bx-python</data-title><version designator="0.8.9">0.8.9</version><source>GitHub</source><ext-link ext-link-type="uri" xlink:href="https://github.com/bxlab/bx-python">https://github.com/bxlab/bx-python</ext-link></element-citation></ref><ref id="bib99"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Varin</surname><given-names>C</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>An overview of composite likelihood methods</article-title><source>Statistica Sinica</source><volume>21</volume><fpage>5</fpage><lpage>42</lpage></element-citation></ref><ref id="bib100"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Virtanen</surname><given-names>P</given-names></name><name><surname>Gommers</surname><given-names>R</given-names></name><name><surname>Oliphant</surname><given-names>TE</given-names></name><name><surname>Haberland</surname><given-names>M</given-names></name><name><surname>Reddy</surname><given-names>T</given-names></name><name><surname>Cournapeau</surname><given-names>D</given-names></name><name><surname>Burovski</surname><given-names>E</given-names></name><name><surname>Peterson</surname><given-names>P</given-names></name><name><surname>Weckesser</surname><given-names>W</given-names></name><name><surname>Bright</surname><given-names>J</given-names></name><name><surname>van der Walt</surname><given-names>SJ</given-names></name><name><surname>Brett</surname><given-names>M</given-names></name><name><surname>Wilson</surname><given-names>J</given-names></name><name><surname>Millman</surname><given-names>KJ</given-names></name><name><surname>Mayorov</surname><given-names>N</given-names></name><name><surname>Nelson</surname><given-names>ARJ</given-names></name><name><surname>Jones</surname><given-names>E</given-names></name><name><surname>Kern</surname><given-names>R</given-names></name><name><surname>Larson</surname><given-names>E</given-names></name><name><surname>Carey</surname><given-names>CJ</given-names></name><name><surname>Polat</surname><given-names>İ</given-names></name><name><surname>Feng</surname><given-names>Y</given-names></name><name><surname>Moore</surname><given-names>EW</given-names></name><name><surname>VanderPlas</surname><given-names>J</given-names></name><name><surname>Laxalde</surname><given-names>D</given-names></name><name><surname>Perktold</surname><given-names>J</given-names></name><name><surname>Cimrman</surname><given-names>R</given-names></name><name><surname>Henriksen</surname><given-names>I</given-names></name><name><surname>Quintero</surname><given-names>EA</given-names></name><name><surname>Harris</surname><given-names>CR</given-names></name><name><surname>Archibald</surname><given-names>AM</given-names></name><name><surname>Ribeiro</surname><given-names>AH</given-names></name><name><surname>Pedregosa</surname><given-names>F</given-names></name><name><surname>van Mulbregt</surname><given-names>P</given-names></name><collab>SciPy 1.0 Contributors</collab></person-group><year iso-8601-date="2020">2020</year><article-title>SciPy 1.0: fundamental algorithms for scientific computing in Python</article-title><source>Nature Methods</source><volume>17</volume><fpage>261</fpage><lpage>272</lpage><pub-id pub-id-type="doi">10.1038/s41592-019-0686-2</pub-id><pub-id pub-id-type="pmid">32015543</pub-id></element-citation></ref><ref id="bib101"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Volz</surname><given-names>EM</given-names></name><name><surname>Koelle</surname><given-names>K</given-names></name><name><surname>Bedford</surname><given-names>T</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Viral phylodynamics</article-title><source>PLOS Computational Biology</source><volume>9</volume><elocation-id>e1002947</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1002947</pub-id><pub-id pub-id-type="pmid">23555203</pub-id></element-citation></ref><ref id="bib102"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wakeley</surname><given-names>J</given-names></name><name><surname>King</surname><given-names>L</given-names></name><name><surname>Low</surname><given-names>BS</given-names></name><name><surname>Ramachandran</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Gene genealogies within a fixed pedigree, and the robustness of Kingman’s coalescent</article-title><source>Genetics</source><volume>190</volume><fpage>1433</fpage><lpage>1445</lpage><pub-id pub-id-type="doi">10.1534/genetics.111.135574</pub-id><pub-id pub-id-type="pmid">22234858</pub-id></element-citation></ref><ref id="bib103"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname><given-names>IJ</given-names></name><name><surname>Bradburd</surname><given-names>GS</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Isolation by environment</article-title><source>Molecular Ecology</source><volume>23</volume><fpage>5649</fpage><lpage>5662</lpage><pub-id pub-id-type="doi">10.1111/mec.12938</pub-id><pub-id pub-id-type="pmid">25256562</pub-id></element-citation></ref><ref id="bib104"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Whitehouse</surname><given-names>LS</given-names></name><name><surname>Ray</surname><given-names>D</given-names></name><name><surname>Schrider</surname><given-names>DR</given-names></name></person-group><year iso-8601-date="2024">2024</year><article-title>Tree sequences as a general-purpose tool for population genetic inference</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/2024.02.20.581288</pub-id></element-citation></ref><ref id="bib105"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wilkins</surname><given-names>JF</given-names></name><name><surname>Wakeley</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2002">2002</year><article-title>The coalescent in a continuous, finite, linear population</article-title><source>Genetics</source><volume>161</volume><fpage>873</fpage><lpage>888</lpage><pub-id pub-id-type="doi">10.1093/genetics/161.2.873</pub-id><pub-id pub-id-type="pmid">12072481</pub-id></element-citation></ref><ref id="bib106"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wilkins</surname><given-names>JF</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>A separation-of-timescales approach to the coalescent in A continuous population</article-title><source>Genetics</source><volume>168</volume><fpage>2227</fpage><lpage>2244</lpage><pub-id pub-id-type="doi">10.1534/genetics.103.022830</pub-id><pub-id pub-id-type="pmid">15611188</pub-id></element-citation></ref><ref id="bib107"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wirtz</surname><given-names>J</given-names></name><name><surname>Guindon</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2024">2024</year><article-title>On the connections between the spatial Lambda–Fleming–Viot model and other processes for analysing geo-referenced genetic data</article-title><source>Theoretical Population Biology</source><volume>158</volume><fpage>139</fpage><lpage>149</lpage><pub-id pub-id-type="doi">10.1016/j.tpb.2024.06.002</pub-id></element-citation></ref><ref id="bib108"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wiuf</surname><given-names>C</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Consistency of estimators of population scaled parameters using composite likelihood</article-title><source>Journal of Mathematical Biology</source><volume>53</volume><fpage>821</fpage><lpage>841</lpage><pub-id pub-id-type="doi">10.1007/s00285-006-0031-0</pub-id></element-citation></ref><ref id="bib109"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wlodzimierz</surname><given-names>P</given-names></name><name><surname>Rabanal</surname><given-names>FA</given-names></name><name><surname>Burns</surname><given-names>R</given-names></name><name><surname>Naish</surname><given-names>M</given-names></name><name><surname>Primetis</surname><given-names>E</given-names></name><name><surname>Scott</surname><given-names>A</given-names></name><name><surname>Mandáková</surname><given-names>T</given-names></name><name><surname>Gorringe</surname><given-names>N</given-names></name><name><surname>Tock</surname><given-names>AJ</given-names></name><name><surname>Holland</surname><given-names>D</given-names></name><name><surname>Fritschi</surname><given-names>K</given-names></name><name><surname>Habring</surname><given-names>A</given-names></name><name><surname>Lanz</surname><given-names>C</given-names></name><name><surname>Patel</surname><given-names>C</given-names></name><name><surname>Schlegel</surname><given-names>T</given-names></name><name><surname>Collenberg</surname><given-names>M</given-names></name><name><surname>Mielke</surname><given-names>M</given-names></name><name><surname>Nordborg</surname><given-names>M</given-names></name><name><surname>Roux</surname><given-names>F</given-names></name><name><surname>Shirsekar</surname><given-names>G</given-names></name><name><surname>Alonso-Blanco</surname><given-names>C</given-names></name><name><surname>Lysak</surname><given-names>MA</given-names></name><name><surname>Novikova</surname><given-names>PY</given-names></name><name><surname>Bousios</surname><given-names>A</given-names></name><name><surname>Weigel</surname><given-names>D</given-names></name><name><surname>Henderson</surname><given-names>IR</given-names></name></person-group><year iso-8601-date="2023">2023</year><article-title>Cycles of satellite and transposon evolution in Arabidopsis centromeres</article-title><source>Nature</source><volume>618</volume><fpage>557</fpage><lpage>565</lpage><pub-id pub-id-type="doi">10.1038/s41586-023-06062-z</pub-id><pub-id pub-id-type="pmid">37198485</pub-id></element-citation></ref><ref id="bib110"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Wohns</surname><given-names>AW</given-names></name><name><surname>Wong</surname><given-names>Y</given-names></name><name><surname>Jeffery</surname><given-names>B</given-names></name><name><surname>Akbari</surname><given-names>A</given-names></name><name><surname>Mallick</surname><given-names>S</given-names></name><name><surname>Pinhasi</surname><given-names>R</given-names></name><name><surname>Patterson</surname><given-names>N</given-names></name><name><surname>Reich</surname><given-names>D</given-names></name><name><surname>Kelleher</surname><given-names>J</given-names></name><name><surname>McVean</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>A unified genealogy of modern and ancient genomes</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/2021.02.16.431497</pub-id></element-citation></ref><ref id="bib111"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wong</surname><given-names>Y</given-names></name><name><surname>Ignatieva</surname><given-names>A</given-names></name><name><surname>Koskela</surname><given-names>J</given-names></name><name><surname>Gorjanc</surname><given-names>G</given-names></name><name><surname>Wohns</surname><given-names>AW</given-names></name><name><surname>Kelleher</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2024">2024</year><article-title>A general and efficient representation of ancestral recombination graphs</article-title><source>Genetics</source><volume>228</volume><elocation-id>iyae100</elocation-id><pub-id pub-id-type="doi">10.1093/genetics/iyae100</pub-id><pub-id pub-id-type="pmid">39013109</pub-id></element-citation></ref><ref id="bib112"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Worobey</surname><given-names>M</given-names></name><name><surname>Pekar</surname><given-names>J</given-names></name><name><surname>Larsen</surname><given-names>BB</given-names></name><name><surname>Nelson</surname><given-names>MI</given-names></name><name><surname>Hill</surname><given-names>V</given-names></name><name><surname>Joy</surname><given-names>JB</given-names></name><name><surname>Rambaut</surname><given-names>A</given-names></name><name><surname>Suchard</surname><given-names>MA</given-names></name><name><surname>Wertheim</surname><given-names>JO</given-names></name><name><surname>Lemey</surname><given-names>P</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>The emergence of SARS-CoV-2 in europe and north america</article-title><source>Science</source><volume>370</volume><fpage>564</fpage><lpage>570</lpage><pub-id pub-id-type="doi">10.1126/science.abc8169</pub-id><pub-id pub-id-type="pmid">32912998</pub-id></element-citation></ref><ref id="bib113"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wright</surname><given-names>S</given-names></name></person-group><year iso-8601-date="1943">1943</year><article-title>Isolation by distance</article-title><source>Genetics</source><volume>28</volume><fpage>114</fpage><lpage>138</lpage><pub-id pub-id-type="doi">10.1093/genetics/28.2.114</pub-id><pub-id pub-id-type="pmid">17247074</pub-id></element-citation></ref><ref id="bib114"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Y C Brandt</surname><given-names>D</given-names></name><name><surname>Wei</surname><given-names>X</given-names></name><name><surname>Deng</surname><given-names>Y</given-names></name><name><surname>Vaughn</surname><given-names>AH</given-names></name><name><surname>Nielsen</surname><given-names>R</given-names></name></person-group><year iso-8601-date="2022">2022</year><article-title>Evaluation of methods for estimating coalescence times using ancestral recombination graphs</article-title><source>Genetics</source><volume>221</volume><elocation-id>iyac044</elocation-id><pub-id pub-id-type="doi">10.1093/genetics/iyac044</pub-id><pub-id pub-id-type="pmid">35333304</pub-id></element-citation></ref><ref id="bib115"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhang</surname><given-names>BC</given-names></name><name><surname>Biddanda</surname><given-names>A</given-names></name><name><surname>Gunnarsson</surname><given-names>ÁF</given-names></name><name><surname>Cooper</surname><given-names>F</given-names></name><name><surname>Palamara</surname><given-names>PF</given-names></name></person-group><year iso-8601-date="2023">2023</year><article-title>Biobank-scale inference of ancestral recombination graphs enables genealogical analysis of complex traits</article-title><source>Nature Genetics</source><volume>55</volume><fpage>768</fpage><lpage>776</lpage><pub-id pub-id-type="doi">10.1038/s41588-023-01379-x</pub-id><pub-id pub-id-type="pmid">37127670</pub-id></element-citation></ref></ref-list></back><sub-article article-type="editor-report" id="sa0"><front-stub><article-id pub-id-type="doi">10.7554/eLife.72177.sa0</article-id><title-group><article-title>Editor's evaluation</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Nordborg</surname><given-names>Magnus</given-names></name><role specific-use="editor">Reviewing Editor</role><aff><institution>Gregor Mendel Institute</institution><country>Austria</country></aff></contrib></contrib-group><related-object id="sa0ro1" object-id-type="id" object-id="10.1101/2021.07.13.452277" link-type="continued-by" xlink:href="https://sciety.org/articles/activity/10.1101/2021.07.13.452277"/></front-stub><body><p>This fundamental and pioneering paper demonstrates the power of using the Ancestral Recombination Graph in estimating historical dispersal rates and illustrates the importance of using good data. The methodology is compelling and well beyond the state-of-the-art. The paper should be of interest to anyone working with population genetic inference.</p></body></sub-article><sub-article article-type="decision-letter" id="sa1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.72177.sa1</article-id><title-group><article-title>Decision letter</article-title></title-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Nordborg</surname><given-names>Magnus</given-names></name><role>Reviewing Editor</role><aff><institution>Gregor Mendel Institute</institution><country>Austria</country></aff></contrib></contrib-group><contrib-group><contrib contrib-type="reviewer"><name><surname>Nordborg</surname><given-names>Magnus</given-names></name><role>Reviewer</role><aff><institution>Gregor Mendel Institute</institution><country>Austria</country></aff></contrib><contrib contrib-type="reviewer"><name><surname>Speidel</surname><given-names>Leo</given-names></name><role>Reviewer</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/02jx3x895</institution-id><institution>University College London</institution></institution-wrap><country>United Kingdom</country></aff></contrib><contrib contrib-type="reviewer"><name><surname>Kelleher</surname><given-names>Jerome</given-names></name><role>Reviewer</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/052gg0110</institution-id><institution>University of Oxford</institution></institution-wrap><country>United Kingdom</country></aff></contrib></contrib-group></front-stub><body><boxed-text id="sa2-box1"><p>Our editorial process produces two outputs: (i) <ext-link ext-link-type="uri" xlink:href="https://sciety.org/articles/activity/10.1101/2021.07.13.452277">public reviews</ext-link> designed to be posted alongside <ext-link ext-link-type="uri" xlink:href="https://www.biorxiv.org/content/10.1101/2021.07.13.452277v1">the preprint</ext-link> for the benefit of readers; (ii) feedback on the manuscript for the authors, including requests for revisions, shown below. We also include an acceptance summary that explains what the editors found interesting or important about the work.</p></boxed-text><p><bold>Decision letter after peer review:</bold></p><p>Thank you for submitting your article &quot;Estimating dispersal rates and locating genetic ancestors with genome-wide genealogies&quot; for consideration by <italic>eLife</italic>. Your article has been reviewed by 3 peer reviewers including Magnus Nordborg as the Reviewing Editor and Reviewer #1, and the evaluation has been overseen by Detlef Weigel as the Senior Editor. The following individuals involved in review of your submission have agreed to reveal their identity: Leo Speidel (Reviewer #2); Jerome Kelleher (Reviewer #3).</p><p>The reviewers have discussed their reviews with one another at length, and the Reviewing Editor has drafted this to help you prepare a revised submission.</p><p>Essential revisions (for the authors):</p><p>Apologies for the delayed decision, which is almost entirely due to the Reviewing Editor being overcommitted. All reviewers agreed that this is a technically excellent paper that should be of general interest to anyone working with polymorphism data. Contrary to standard <italic>eLife</italic> practice, the individual reviews are included below, as they are all clear and contain numerous small fixes you will want to implement.</p><p>We have only one serious concern, which is that the time estimates from the Arabidopsis data may be seriously biased, and by serious, we mean an order of magnitude or two. Rapid recent migration (hundreds of kilometer in tens of generations) is exceedingly hard to reconcile with what is known about Arabidopsis biology, and probably also with standard population genetics models of gene flow and drift.</p><p>After extensive discussions (Magnus Nordborg also wishes to acknowledge lab members, in particular Anna Igolkina), we suspect the 5% allele frequency cut-off may be to blame. If the age of an allele is roughy proportional to its frequency, a 5% cut-off in Arabidopsis could pretty much erase all post-glacial history. Which would work: your estimates would be plausible if you were talking of thousands rather than tens of generations.</p><p>Other possible biases include the use of imputed and heavily filtered data (see comments by Reviewer #1), but this is probably less important.</p><p>We would strongly encourage you to examine so of the inferred trees manually, doing some back-of-the-envelope calculations using the full data. Nordborg and Weigel would also happily share data from unpublished de novo PacBio assemblies, which would let you look at the full polymorphism spectrum on local trees.</p><p>As this is a method that is likely to set a new standard for population genetic data analysis, we feel that it is very important to get the application to real data right.</p><p><italic>Reviewer #1 (Recommendations for the authors):</italic></p><p>Unless I'm very much mistaken, something is going wrong, and I hope we can figure out what it is.</p><p>Others are better suited to comment on the algorithm than I, but here are a few concerns about the data:</p><p>First, you used the imputed SNP data. I wouldn't. We should have made this clearer in the paper, but imputation was only done because various silly GWAS software couldn't handle missing data. Imputation was never the right thing to do, because the data missing data are not missing because we didn't look, but because we couldn't interpret what we saw. There was adequate coverage, and no reactions failed. SNP calling failed because alignment failed. In other words, most &quot;missing data&quot; probably represents hyper-variable regions and structural variants (TEs, in particular). When these sites are imputed, they are forced to look like more conserved haplotypes, and I think I don't need to explain what this likely does to your analysis…</p><p>When doing GWAS, this is not a problem. You simply get a large stretch of identical p-values, which we interpret as &quot;Uh-oh, better go look at the raw data to figure out wtf is going on in this region!&quot;. Alternatively, we look at the PacBio genomes (we have over 100 already).</p><p>Second, I'm under the impression that the tree-reconstruction algorithm (Speidel et al., 2019) relies on polarized SNPs, and that you get those data from Tyler Kent. Fine, but be aware that this results in a huge bias, because a large fraction of SNPs cannot be polarized. A. lyrata is &gt; 12% divergent, most of the non-coding genome cannot be aligned. Again you are biasing yourself toward conserved regions.</p><p>I seriously think you need to do some basic modeling to check whether your results are consistent with other observations. I don't think they are. I'm referring to the time estimates here. I would bet you are off by at least an order of magnitude.</p><p>To be discussed, I hope.</p><p><italic>Reviewer #2 (Recommendations for the authors):</italic></p><p>The method:</p><p>- The method is described well and the mathematical foundations and technical details are sound. I have no concerns about the way Relate trees are used, e.g., in the importance sampler.</p><p>- While overall accuracy of the method is very good, an interesting phenomenon in simulated data is the overestimation of dispersal rates using Relate trees (as compared to true trees). To disentangle causes of this bias, would it be possible to – (A) Infer branch lengths given true tree topologies (by converting *trees files into Relate format, sampling branch lengths, then converting back to *trees format)? If bias comes from errors in tree topologies, there should be no bias when using true tree topologies (and this could also be used to illustrate the usefulness of the importance sampler to correct for the potential bias introduced by the panmixia assumption in the branch length estimator).</p><p>- (B) Measure accuracy of inferred tree topologies and filter out inaccurate trees (or simulate data with lower recombination rates where tree topologies should be more accurate)</p><p>- In practise, I think it could be worth filtering out trees in recombination hotspots, if this hasn't been done already. E.g., one could think of a strategy of picking a tree every x bases and then filtering out unreliable trees according to some criteria, such as recombination rate. It would be very interesting to see if this makes a difference!</p><p>- I couldn't find a mentioning of the sample size used for the simulations in Figure 2. How does the method scale with data size and how does the above bias change?</p><p>- Do you think it is possible to partially integrate over topologies by e.g., inferring trees for subsamples and multiplying the likelihoods across these, with the potential downside of loosing some power? While trees won't be independent, the MLE's are I think still unbiased in a composite likelihood.</p><p>- I particularly like the idea of &quot;chopping&quot; the trees at a certain height to avoid having to rely on inferred locations at deep times, which I agree are most likely highly unreliable. However, I didn't understand whether the mean centering of locations applied to each subtree separately (I think it does). I was wondering if it is technically possible to improve on this slightly if one was able to predict the average ancestor location with given descendant set and time of the TMRCA (which is less than cutoff T) in the past using genome-wide data.</p><p>- In Figure 1, it looks like the ancestor &quot;A&quot;, for which we want to infer the geographic location is placed on a local genealogy. However, when sampling branch lengths, the age of this ancestor will vary, so I wasn't sure if this diagram is accurate. Do you instead look at the ancestor of e.g., sample 4 at time x? So this could fall below or above the coalescence with sample 5?</p><p>- In Figure 2 E and G, I didn't understand what the solid points represent.</p><p>- On page 9, the authors mention that they implemented a BLUP for inferring ancestral locations which performs similarly to their first appraoch. Is there a figure or correlation (or similar) that the authors could cite which confirms this claim? The phrasing is slightly ambiguous about which method the authors then continue to use (they are both technically &quot;MLE-based&quot; right?), but I am guessing it is the former.</p><p>Application to <italic>A. thaliana</italic>:</p><p>- I had no previous background knowledge on the history of these <italic>A. thaliana</italic> but overall had the impression that the method convincingly demonstrates recent migration patterns as claimed by the authors. A few concerns and questions are listed below:</p><p>- On p. 11, the authors state that &quot;from our perspective remove the complications of obtaining phased haplotypes&quot;. It wasn't clear to me what this meant specifically – does it mean that most of the genome is homozygous, making phasing trivial and/or that then only one haploid sequence is obtained for each individual? I think it would be good to clarify!</p><p>- The idea of locating ancestors of American samples is very interesting. You make the claim that these American samples came perhaps predominantly from southern Germany. In a clean split model, where American <italic>A. thaliana</italic> have a separate history in the last 400 years, is my understanding correct that we have no information about more recent geographic location? Why is it then that they are more closely related to French samples today, also indicated in the continued drift towards France &lt;400 years ago? Is this evidence of continued migration into the Americas?</p><p>- Figure 7 is very nice!</p><p>- I liked the idea of Figure 9 but found the lines a bit difficult to distinguish. In the text you seem to focus primarily on two samples, so would it be possible to just show those two? Or have a separate map for each sample?</p><p>- On p.41, the authors state that they filtered out variants of &lt;5% MAF. This seems potentially problematic as it means no mutations are mapped to the bottom of the trees (and presumably all singletons are excluded), meaning the bottom of these trees are artificially shortened. I think this could potentially explain (in part) the signal of recent increase in dispersion. I would strongly recommend not applying this filter, unless there is a fundamental reason as to why it is necessary.</p><p>- On p. 41, l927, it is mentioned that the EstimatePopulationSize script needed customising to allow for haploid samples. I think it should work as is – but I would be interested in knowing what the problem was that you encountered!</p><p><italic>Reviewer #3 (Recommendations for the authors):</italic></p><p>I have only one substantive point, which I think can be easily addressed withsome updates to the text. I feel that the manuscript currently glosses over thedifficulties of population genetic models in a 2D continuum, which I worry willlead to others extending the methods in poorly advised directions. I am surethat the BBM model is a good approximation, especially in the limitedtime-slices in which it's being applied, but it's not clear to me how thisrelates to the classical Wright-Malecot models, or the more recentEtheridge-Barton approach. I think a reasonable approach would be tomention the difficulties like the pain in the torus, cite some of theliterature on solving that problem, and provide a simple argument for why theBBM model is a good approximation in this setting.</p></body></sub-article><sub-article article-type="reply" id="sa2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.72177.sa2</article-id><title-group><article-title>Author response</article-title></title-group></front-stub><body><disp-quote content-type="editor-comment"><p>Essential revisions (for the authors):</p><p>Apologies for the delayed decision, which is almost entirely due to the Reviewing Editor being overcommitted. All reviewers agreed that this is a technically excellent paper that should be of general interest to anyone working with polymorphism data. Contrary to standard eLife practice, the individual reviews are included below, as they are all clear and contain numerous small fixes you will want to implement.</p></disp-quote><p>Thank-you very much for the kind words and helpful reviews.</p><disp-quote content-type="editor-comment"><p>We have only one serious concern, which is that the time estimates from the Arabidopsis data may be seriously biased, and by serious, we mean an order of magnitude or two. Rapid recent migration (hundreds of kilometer in tens of generations) is exceedingly hard to reconcile with what is known about Arabidopsis biology, and probably also with standard population genetics models of gene flow and drift.</p><p>After extensive discussions (Magnus Nordborg also wishes to acknowledge lab members, in particular Anna Igolkina), we suspect the 5% allele frequency cut-off may be to blame. If the age of an allele is roughy proportional to its frequency, a 5% cut-off in Arabidopsis could pretty much erase all post-glacial history. Which would work: your estimates would be plausible if you were talking of thousands rather than tens of generations.</p><p>Other possible biases include the use of imputed and heavily filtered data (see comments by Reviewer #1), but this is probably less important.</p><p>We would strongly encourage you to examine so of the inferred trees manually, doing some back-of-the-envelope calculations using the full data. Nordborg and Weigel would also happily share data from unpublished de novo PacBio assemblies, which would let you look at the full polymorphism spectrum on local trees.</p><p>As this is a method that is likely to set a new standard for population genetic data analysis, we feel that it is very important to get the application to real data right.</p></disp-quote><p>Thank you very much for your careful thoughts here, we agree that it is very important to get the application to real data right. This was the major focus of our revisions and we are now much more confident in the inferred trees, and therefore in our estimates of dispersal and the locations of genetic ancestors.</p><p>Instead of just dropping the 5% MAF cutoff and running the same pipeline with the imputed haploid genomes, we first decided to improve our analysis by starting with the underlying SNP data, which allowed us to (1) include both genomes of each individual, (2) add ~400 individuals, including new geographic (Africa) and temporal (herbaria) variation, and (3) do the imputing and filtering ourselves. With this bigger dataset we first removed samples with especially low coverage, filtered to biallelic SNPs, imputed and phased, polarized, masked, adjusted the recombination map to account for inbreeding, and inferred the trees. Unfortunately, after all this we estimated similarly large dispersal rates, even from small spatial clusters of individuals.</p><p>It may still be possible to more accurately infer the tree sequence, and hence the dispersal rate via our method, from this large short-read dataset, e.g., using a high quality reference panel to do the imputing. However, we found another way around this issue – inferring the trees from long-read sequences, as you suggest. After seeing the Wlodzimierz et al. 2023 paper, we chose to try out our method on these 66 long-read genomes. While this long-read dataset is much smaller, the samples are well-chosen for our purposes, with relatively broad sampling across geography and ancestry. With this long-read dataset we can avoid imputing altogether. The result is, we think, a more reliable tree sequence, which gives a much more reasonable dispersal estimate. Our new dispersal estimates are roughly 2 orders of magnitude smaller (as you guessed), align with simpler pairwise-distance estimates (some of which rely only on pairwise nucleotide diversity, and so are independent of the inferred trees), and are within reasonable back-of-the-envelope bounds given hypothesized movements in <italic>Arabidopsis thaliana</italic>. Fortunately, we can also visualize many of the ancestral movements that we looked at last time with this smaller dataset. We are very happy to now present this more reliable application of our method, and thank you for pushing us in this direction.</p><disp-quote content-type="editor-comment"><p>Reviewer #1 (Recommendations for the authors):</p><p>Others are better suited to comment on the algorithm than I, but here are a few concerns about the data:</p><p>First, you used the imputed SNP data. I wouldn't. We should have made this clearer in the paper, but imputation was only done because various silly GWAS software couldn't handle missing data. Imputation was never the right thing to do, because the data missing data are not missing because we didn't look, but because we couldn't interpret what we saw. There was adequate coverage, and no reactions failed. SNP calling failed because alignment failed. In other words, most &quot;missing data&quot; probably represents hyper-variable regions and structural variants (TEs, in particular). When these sites are imputed, they are forced to look like more conserved haplotypes, and I think I don't need to explain what this likely does to your analysis…</p><p>When doing GWAS, this is not a problem. You simply get a large stretch of identical p-values, which we interpret as &quot;Uh-oh, better go look at the raw data to figure out wtf is going on in this region!&quot;. Alternatively, we look at the PacBio genomes (we have over 100 already).</p></disp-quote><p>In our first attempt at re-analysis, with a larger short-read dataset, we started with the un-imputed genotypes. We first tried to avoid imputing with these genotypes, but after removing sites with missing genotypes (Relate does not allow missing data) there were too few sites to infer a tree sequence. We next tried imputing ourselves, and accounted for the fact that some regions of the genome are hard to sequence by masking (based on TAIR10), which removed roughly 50% of sites. Unfortunately the trees inferred from this data still gave unrealistically large dispersal rates. We then turned to the smaller long-read dataset (as you suggest), where we could avoid imputing altogether.</p><disp-quote content-type="editor-comment"><p>Second, I'm under the impression that the tree-reconstruction algorithm (Speidel et al., 2019) relies on polarized SNPs, and that you get those data from Tyler Kent. Fine, but be aware that this results in a huge bias, because a large fraction of SNPs cannot be polarized. A. lyrata is &gt; 12% divergent, most of the non-coding genome cannot be aligned. Again you are biasing yourself toward conserved regions.</p></disp-quote><p>Yes, Relate does rely on polarized SNPs and we use <italic>A. lyrata</italic> as one of our outgroups (along with the less related <italic>Boechera stricta</italic> and <italic>Malcolmia maritima</italic>) to polarize. However, we use est-sfs (Keightley and Jackson 2018) to polarize, which uses both outgroup information as well within-population allele frequencies. This means that we can still polarize SNPs where the outgroups do not align, albeit potentially less accurately, based on allele frequencies within our sample of <italic>thaliana</italic>. We now mention that est-sfs uses ingroup polymorphism info (lines 851-852).</p><disp-quote content-type="editor-comment"><p>I seriously think you need to do some basic modeling to check whether your results are consistent with other observations. I don't think they are. I'm referring to the time estimates here. I would bet you are off by at least an order of magnitude.</p></disp-quote><p>We totally agree. We think our original dispersal estimates were way too high (meaning many branch lengths were way too short). As discussed above (and in the main text), our new dispersal rates are more than 2 orders of magnitude smaller and align with simpler, tree-free estimates and back-of-the-envelope calculations (lines 256-268, 278-288).</p><disp-quote content-type="editor-comment"><p>To be discussed, I hope.</p></disp-quote><p>Indeed!</p><disp-quote content-type="editor-comment"><p>Reviewer #2 (Recommendations for the authors):</p><p>The method:</p><p>- The method is described well and the mathematical foundations and technical details are sound. I have no concerns about the way Relate trees are used, e.g., in the importance sampler.</p><p>- While overall accuracy of the method is very good, an interesting phenomenon in simulated data is the overestimation of dispersal rates using Relate trees (as compared to true trees). To disentangle causes of this bias, would it be possible to – (A) Infer branch lengths given true tree topologies (by converting *trees files into Relate format, sampling branch lengths, then converting back to *trees format)? If bias comes from errors in tree topologies, there should be no bias when using true tree topologies (and this could also be used to illustrate the usefulness of the importance sampler to correct for the potential bias introduced by the panmixia assumption in the branch length estimator).</p><p>- (B) Measure accuracy of inferred tree topologies and filter out inaccurate trees (or simulate data with lower recombination rates where tree topologies should be more accurate)</p></disp-quote><p>While these are great suggestions to pinpoint the issue, we have decided to leave this work for another paper, as we think a useful future study would be to look at the accuracy of ARGs inferred from spatial simulations more generally. Here, we simply mention that the upward bias is consistent with both error in topologies and documented underestimates of branch lengths (lines 162-173).</p><disp-quote content-type="editor-comment"><p>- In practise, I think it could be worth filtering out trees in recombination hotspots, if this hasn't been done already. E.g., one could think of a strategy of picking a tree every x bases and then filtering out unreliable trees according to some criteria, such as recombination rate. It would be very interesting to see if this makes a difference!</p></disp-quote><p>Trying to choose the most informative independent trees is a good idea, e.g., weighting by tree span. We do not attempt it here but mention the idea in the main text to inform future work (lines 171-173).</p><disp-quote content-type="editor-comment"><p>- I couldn't find a mentioning of the sample size used for the simulations in Figure 2. How does the method scale with data size and how does the above bias change?</p></disp-quote><p>Apologies. We mentioned the sample size in the methods but not in the main text. We’ve now added the sample size to the caption of figure 2 (50 diploid individuals = 100 haploid genomes). We’ve also performed analyses with fewer (25 diploids) and more (100 diploids) samples to see how sample size affects our estimates. These analyses are provided as supplementary figures in figure 2 and mentioned in the main text (lines 167-169, lines 202-204).</p><disp-quote content-type="editor-comment"><p>- Do you think it is possible to partially integrate over topologies by e.g., inferring trees for subsamples and multiplying the likelihoods across these, with the potential downside of loosing some power? While trees won't be independent, the MLE's are I think still unbiased in a composite likelihood.</p></disp-quote><p>This is an interesting idea, applicable to many methods that use Relate. We do not attempt it but mention it to inform future work (lines 582-584).</p><disp-quote content-type="editor-comment"><p>- I particularly like the idea of &quot;chopping&quot; the trees at a certain height to avoid having to rely on inferred locations at deep times, which I agree are most likely highly unreliable. However, I didn't understand whether the mean centering of locations applied to each subtree separately (I think it does). I was wondering if it is technically possible to improve on this slightly if one was able to predict the average ancestor location with given descendant set and time of the TMRCA (which is less than cutoff T) in the past using genome-wide data.</p></disp-quote><p>Yes, the mean-centering is applied to each subtree separately, which we’ve now made clearer in the methods (lines 528-534). This implies the locations of the MRCAs of each subtree are independent unknowns. It is not clear to us exactly what the suggested improvement is.</p><disp-quote content-type="editor-comment"><p>- In Figure 1, it looks like the ancestor &quot;A&quot;, for which we want to infer the geographic location is placed on a local genealogy. However, when sampling branch lengths, the age of this ancestor will vary, so I wasn't sure if this diagram is accurate. Do you instead look at the ancestor of e.g., sample 4 at time x? So this could fall below or above the coalescence with sample 5?</p></disp-quote><p>It is the latter: we ask where the ancestor of sample i is at time x, which could fall on different branches depending on the branch lengths. We now make this clearer in the caption of figure 1.</p><disp-quote content-type="editor-comment"><p>- In Figure 2 E and G, I didn't understand what the solid points represent.</p></disp-quote><p>The solid points in Figure 2 E and G are the locations of the samples that we used to infer ancestral locations, which we now mention in the caption.</p><disp-quote content-type="editor-comment"><p>- On page 9, the authors mention that they implemented a BLUP for inferring ancestral locations which performs similarly to their first appraoch. Is there a figure or correlation (or similar) that the authors could cite which confirms this claim? The phrasing is slightly ambiguous about which method the authors then continue to use (they are both technically &quot;MLE-based&quot; right?), but I am guessing it is the former.</p></disp-quote><p>We now include a supplementary figure showing that the BLUP locations have similar accuracy as the MLE locations where we mention this in the main text (lines 182-184).</p><p>We now clarify that we continue to use the ‘likelihood’-based method, rather than the ‘BLUP’ method, both of which are defined in the text (lines 180-184).</p><disp-quote content-type="editor-comment"><p>Application to <italic>A. thaliana</italic>:</p><p>- I had no previous background knowledge on the history of these <italic>A. thaliana</italic> but overall had the impression that the method convincingly demonstrates recent migration patterns as claimed by the authors. A few concerns and questions are listed below:</p><p>- On p. 11, the authors state that &quot;from our perspective remove the complications of obtaining phased haplotypes&quot;. It wasn't clear to me what this meant specifically – does it mean that most of the genome is homozygous, making phasing trivial and/or that then only one haploid sequence is obtained for each individual? I think it would be good to clarify!</p></disp-quote><p>Yes, most of the genome is homozygous, making phasing easier, which we’ve reworded (lines 235-236). And yes, we use only one haploid sequence per individual, which we now explicitly state in the main text (line 227).</p><disp-quote content-type="editor-comment"><p>- The idea of locating ancestors of American samples is very interesting. You make the claim that these American samples came perhaps predominantly from southern Germany. In a clean split model, where American <italic>A. thaliana</italic> have a separate history in the last 400 years, is my understanding correct that we have no information about more recent geographic location? Why is it then that they are more closely related to French samples today, also indicated in the continued drift towards France &lt;400 years ago? Is this evidence of continued migration into the Americas?</p></disp-quote><p>Our argument here was that, while most of the samples in America are most closely related to the samples in France today (relative to the other samples outside of America), we infer the ancestors of these American samples to be in southern Germany 400 years ago. This could be the result of dispersal/gene flow from Germany to France in the last 400 years combined with the replacement of these German ancestors or gene flow from elsewhere into Germany in the last 400 years. The new dataset does not contain any samples in the Americas and so we do not discuss this in the main text.</p><disp-quote content-type="editor-comment"><p>- Figure 7 is very nice!</p><p>- I liked the idea of Figure 9 but found the lines a bit difficult to distinguish. In the text you seem to focus primarily on two samples, so would it be possible to just show those two? Or have a separate map for each sample?</p></disp-quote><p>Our new `windrose’ figure (now Figure 4) has just one sample per map, for clarity.</p><disp-quote content-type="editor-comment"><p>- On p.41, the authors state that they filtered out variants of &lt;5% MAF. This seems potentially problematic as it means no mutations are mapped to the bottom of the trees (and presumably all singletons are excluded), meaning the bottom of these trees are artificially shortened. I think this could potentially explain (in part) the signal of recent increase in dispersion. I would strongly recommend not applying this filter, unless there is a fundamental reason as to why it is necessary.</p></disp-quote><p>Thank you very much for catching this error. When we analyzed the larger short-read dataset we did not apply this filter but found similarly high dispersal rates, suggesting this was not the source of the problem, but rather bad imputation. In our new analysis we do not filter out sites with rare alleles or impute.</p><disp-quote content-type="editor-comment"><p>- On p. 41, l927, it is mentioned that the EstimatePopulationSize script needed customising to allow for haploid samples. I think it should work as is – but I would be interested in knowing what the problem was that you encountered!</p></disp-quote><p>In our re-analysis we did not edit any Relate files (except to avoid printing with R). We unfortunately do not recall (and can’t find) what lines we commented out in EstimatePopulationSize.sh in our original analysis (near the end if memory serves, Relate v1.1.4).</p><disp-quote content-type="editor-comment"><p>Reviewer #3 (Recommendations for the authors):</p><p>I have only one substantive point, which I think can be easily addressed withsome updates to the text. I feel that the manuscript currently glosses over thedifficulties of population genetic models in a 2D continuum, which I worry willlead to others extending the methods in poorly advised directions. I am surethat the BBM model is a good approximation, especially in the limitedtime-slices in which it's being applied, but it's not clear to me how thisrelates to the classical Wright-Malecot models, or the more recentEtheridge-Barton approach. I think a reasonable approach would be tomention the difficulties like the pain in the torus, cite some of theliterature on solving that problem, and provide a simple argument for why theBBM model is a good approximation in this setting.</p></disp-quote><p>We have done just this at the end of our methods overview (lines 136-144).</p></body></sub-article></article>