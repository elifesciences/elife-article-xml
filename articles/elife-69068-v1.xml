<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN"  "JATS-archivearticle1.dtd"><article article-type="research-article" dtd-version="1.2" xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn pub-type="epub" publication-format="electronic">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">69068</article-id><article-id pub-id-type="doi">10.7554/eLife.69068</article-id><article-categories><subj-group subj-group-type="display-channel"><subject>Research Article</subject></subj-group><subj-group subj-group-type="heading"><subject>Neuroscience</subject></subj-group></article-categories><title-group><article-title>Reconciling functional differences in populations of neurons recorded with two-photon imaging and electrophysiology</article-title></title-group><contrib-group><contrib contrib-type="author" equal-contrib="yes" id="author-227922"><name><surname>Siegle</surname><given-names>Joshua H</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-7736-4844</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="equal-contrib1">†</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" equal-contrib="yes" id="author-159460"><name><surname>Ledochowitsch</surname><given-names>Peter</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-0835-3444</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="equal-contrib1">†</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-116806"><name><surname>Jia</surname><given-names>Xiaoxuan</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con3"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-171186"><name><surname>Millman</surname><given-names>Daniel J</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-6255-6085</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con4"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-233326"><name><surname>Ocker</surname><given-names>Gabriel K</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0001-9627-9576</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con5"/><xref ref-type="fn" rid="conf1"/><xref ref-type="fn" rid="pa1">‡</xref></contrib><contrib contrib-type="author" id="author-85295"><name><surname>Caldejon</surname><given-names>Shiella</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con6"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-152187"><name><surname>Casal</surname><given-names>Linzy</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con7"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-201823"><name><surname>Cho</surname><given-names>Andy</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con8"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-169219"><name><surname>Denman</surname><given-names>Daniel J</given-names></name><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con9"/><xref ref-type="fn" rid="conf1"/><xref ref-type="fn" rid="pa2">§</xref></contrib><contrib contrib-type="author" id="author-164738"><name><surname>Durand</surname><given-names>Séverine</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con10"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-152184"><name><surname>Groblewski</surname><given-names>Peter A</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-8415-1118</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con11"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-201824"><name><surname>Heller</surname><given-names>Gregg</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con12"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-171497"><name><surname>Kato</surname><given-names>India</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con13"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-201825"><name><surname>Kivikas</surname><given-names>Sara</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con14"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-121413"><name><surname>Lecoq</surname><given-names>Jérôme</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con15"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-171500"><name><surname>Nayan</surname><given-names>Chelsea</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con16"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-201826"><name><surname>Ngo</surname><given-names>Kiet</given-names></name><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con17"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-201827"><name><surname>Nicovich</surname><given-names>Philip R</given-names></name><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con18"/><xref ref-type="fn" rid="conf1"/><xref ref-type="fn" rid="pa3">#</xref></contrib><contrib contrib-type="author" id="author-171502"><name><surname>North</surname><given-names>Kat</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con19"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-201828"><name><surname>Ramirez</surname><given-names>Tamina K</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con20"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-201829"><name><surname>Swapp</surname><given-names>Jackie</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con21"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-201830"><name><surname>Waughman</surname><given-names>Xana</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con22"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-152189"><name><surname>Williford</surname><given-names>Ali</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con23"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-73112"><name><surname>Olsen</surname><given-names>Shawn R</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-9568-7057</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con24"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-116411"><name><surname>Koch</surname><given-names>Christof</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con25"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-95966"><name><surname>Buice</surname><given-names>Michael A</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-2196-1498</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="other" rid="fund2"/><xref ref-type="fn" rid="con26"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" corresp="yes" id="author-159461"><name><surname>de Vries</surname><given-names>Saskia EJ</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-3704-3499</contrib-id><email>saskiad@alleninstitute.org</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con27"/><xref ref-type="fn" rid="conf1"/></contrib><aff id="aff1"><label>1</label><institution>MindScope Program, Allen Institute</institution><addr-line><named-content content-type="city">Seattle</named-content></addr-line><country>United States</country></aff><aff id="aff2"><label>2</label><institution>Allen Institute for Brain Science, Allen Institute</institution><addr-line><named-content content-type="city">Seattle</named-content></addr-line><country>United States</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Calabrese</surname><given-names>Ronald L</given-names></name><role>Reviewing Editor</role><aff><institution>Emory University</institution><country>United States</country></aff></contrib><contrib contrib-type="senior_editor"><name><surname>Calabrese</surname><given-names>Ronald L</given-names></name><role>Senior Editor</role><aff><institution>Emory University</institution><country>United States</country></aff></contrib></contrib-group><author-notes><fn fn-type="present-address" id="pa1"><label>‡</label><p>Boston University, Boston, United States</p></fn><fn fn-type="present-address" id="pa2"><label>§</label><p>University of Colorado Denver Anschutz Medical Campus, Aurora, United States</p></fn><fn fn-type="present-address" id="pa3"><label>#</label><p>Cajal Neuroscience, Seattle, United States</p></fn><fn fn-type="con" id="equal-contrib1"><label>†</label><p>These authors contributed equally to this work</p></fn></author-notes><pub-date date-type="publication" publication-format="electronic"><day>16</day><month>07</month><year>2021</year></pub-date><pub-date pub-type="collection"><year>2021</year></pub-date><volume>10</volume><elocation-id>e69068</elocation-id><history><date date-type="received" iso-8601-date="2021-04-02"><day>02</day><month>04</month><year>2021</year></date><date date-type="accepted" iso-8601-date="2021-07-02"><day>02</day><month>07</month><year>2021</year></date></history><permissions><copyright-statement>© 2021, Siegle et al</copyright-statement><copyright-year>2021</copyright-year><copyright-holder>Siegle et al</copyright-holder><ali:free_to_read/><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><ali:license_ref>http://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-69068-v1.pdf"/><abstract><p>Extracellular electrophysiology and two-photon calcium imaging are widely used methods for measuring physiological activity with single-cell resolution across large populations of cortical neurons. While each of these two modalities has distinct advantages and disadvantages, neither provides complete, unbiased information about the underlying neural population. Here, we compare evoked responses in visual cortex recorded in awake mice under highly standardized conditions using either imaging of genetically expressed GCaMP6f or electrophysiology with silicon probes. Across all stimulus conditions tested, we observe a larger fraction of responsive neurons in electrophysiology and higher stimulus selectivity in calcium imaging, which was partially reconciled by applying a spikes-to-calcium forward model to the electrophysiology data. However, the forward model could only reconcile differences in responsiveness when restricted to neurons with low contamination and an event rate above a minimum threshold. This work established how the biases of these two modalities impact functional metrics that are fundamental for characterizing sensory-evoked responses.</p></abstract><kwd-group kwd-group-type="author-keywords"><kwd>extracellular electrophysiology</kwd><kwd>calcium imaging</kwd><kwd>in vivo physiology</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research organism</title><kwd>Mouse</kwd></kwd-group><funding-group><award-group id="fund1"><funding-source><institution-wrap><institution>Allen Institute</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Siegle</surname><given-names>Joshua H</given-names></name><name><surname>Ledochowitsch</surname><given-names>Peter</given-names></name><name><surname>Jia</surname><given-names>Xiaoxuan</given-names></name><name><surname>Millman</surname><given-names>Daniel J</given-names></name><name><surname>Ocker</surname><given-names>Gabriel K</given-names></name><name><surname>Caldejon</surname><given-names>Shiella</given-names></name><name><surname>Casal</surname><given-names>Linzy</given-names></name><name><surname>Cho</surname><given-names>Andy</given-names></name><name><surname>Denman</surname><given-names>Daniel J</given-names></name><name><surname>Durand</surname><given-names>Séverine</given-names></name><name><surname>Groblewski</surname><given-names>Peter A</given-names></name><name><surname>Heller</surname><given-names>Gregg</given-names></name><name><surname>Kato</surname><given-names>India</given-names></name><name><surname>Kivikas</surname><given-names>Sara</given-names></name><name><surname>Lecoq</surname><given-names>Jérôme</given-names></name><name><surname>Nayan</surname><given-names>Chelsea</given-names></name><name><surname>Ngo</surname><given-names>Kiet</given-names></name><name><surname>Nicovich</surname><given-names>Philip R</given-names></name><name><surname>North</surname><given-names>Kat</given-names></name><name><surname>Ramirez</surname><given-names>Tamina K</given-names></name><name><surname>Swapp</surname><given-names>Jackie</given-names></name><name><surname>Waughman</surname><given-names>Xana</given-names></name><name><surname>Williford</surname><given-names>Ali</given-names></name><name><surname>Olsen</surname><given-names>Shawn R</given-names></name><name><surname>Koch</surname><given-names>Christof</given-names></name><name><surname>Buice</surname><given-names>Michael A</given-names></name><name><surname>de Vries</surname><given-names>Saskia EJ</given-names></name></principal-award-recipient></award-group><award-group id="fund2"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000002</institution-id><institution>NIH</institution></institution-wrap></funding-source><award-id>1R01EB026908-01</award-id><principal-award-recipient><name><surname>Buice</surname><given-names>Michael A</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>Discrepancies between functional responses measured with electrophysiology and calcium imaging can be largely reconciled by considering the spike-to-calcium transfer function, neuronal sampling bias, and cluster merging artifacts during spike sorting.</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>Systems neuroscience aims to explain how complex adaptive behaviors can arise from the interactions of many individual neurons. As a result, population recordings—which capture the activity of multiple neurons simultaneously—have become the foundational method for progress in this domain. Extracellular electrophysiology and calcium-dependent two-photon optical physiology are by far the most prevalent population recording techniques, due to their single-neuron resolution, ease of use, and scalability. Recent advances have made it possible to record simultaneously from thousands of neurons with electrophysiology (<xref ref-type="bibr" rid="bib29">Jun et al., 2017</xref>; <xref ref-type="bibr" rid="bib61">Siegle et al., 2021</xref>; <xref ref-type="bibr" rid="bib66">Stringer et al., 2019a</xref>) or tens of thousands of neurons with calcium imaging (<xref ref-type="bibr" rid="bib64">Sofroniew et al., 2016</xref>; <xref ref-type="bibr" rid="bib67">Stringer et al., 2019b</xref>; <xref ref-type="bibr" rid="bib77">Weisenburger et al., 2019</xref>). While insights gained from both methods have been invaluable to the field, it is clear that neither technique provides a completely faithful picture of the underlying neural activity. In this study, our goal is to better understand the inherent biases of each recording modality, and specifically how to appropriately compare results obtained with one method to those obtained with the other.</p><p>Head-to-head comparisons of electrophysiology and imaging data are rare in the literature, but are critically important as the practical aspects of each method affect their suitability for different experimental questions. Since the expression of calcium indicators can be restricted to genetically defined cell types, imaging can easily target recordings to specific sub-populations (<xref ref-type="bibr" rid="bib36">Madisen et al., 2015</xref>). Similarly, the use of retro- or anterograde viral transfections to drive indicator expression allows imaging to target sub-populations defined by their projection patterns (<xref ref-type="bibr" rid="bib17">Glickfeld et al., 2013</xref>; <xref ref-type="bibr" rid="bib18">Gradinaru et al., 2010</xref>). The ability to identify genetically or projection-defined cell populations in electrophysiology experiments is far more limited (<xref ref-type="bibr" rid="bib10">Economo et al., 2018</xref>; <xref ref-type="bibr" rid="bib28">Jia et al., 2019</xref>; <xref ref-type="bibr" rid="bib34">Lima et al., 2009</xref>). Both techniques have been adapted for chronic recordings, but imaging offers the ability to reliably return to the same neurons over many days without the need to implant bulky hardware (<xref ref-type="bibr" rid="bib52">Peters et al., 2014</xref>). Furthermore, because imaging captures structural, in addition to functional, data, individual neurons can be precisely registered to tissue volumes from electron microscopy (<xref ref-type="bibr" rid="bib2">Bock et al., 2011</xref>; <xref ref-type="bibr" rid="bib33">Lee et al., 2016</xref>), in vitro brain slices (<xref ref-type="bibr" rid="bib31">Ko et al., 2011</xref>), and potentially other ex vivo techniques such as in situ RNA profiling (<xref ref-type="bibr" rid="bib5">Chen et al., 2015</xref>). In contrast, the sources of extracellular spike waveforms are very difficult to localize with sufficient precision to enable direct cross-modal registration.</p><p>Inherent differences in the spatial sampling properties of electrophysiology and imaging are widely recognized, and influence what information can be gained from each method (<xref ref-type="fig" rid="fig1">Figure 1A</xref>). Multi-photon imaging typically yields data in a single plane tangential to the cortical surface, and is limited to depths of &lt;1 mm due to a combination of light scattering and absorption in tissue. While multi-plane (<xref ref-type="bibr" rid="bib80">Yang et al., 2016</xref>) and deep structure (<xref ref-type="bibr" rid="bib43">Ouzounov et al., 2017</xref>) imaging are both areas of active research, imaging of most subcortical structures requires physical destruction of more superficial tissues (<xref ref-type="bibr" rid="bib9">Dombeck et al., 2010</xref>; <xref ref-type="bibr" rid="bib14">Feinberg and Meister, 2015</xref>; <xref ref-type="bibr" rid="bib63">Skocek et al., 2018</xref>). Extracellular electrophysiology, on the other hand, utilizes microelectrodes embedded in the tissue, and thus dense recordings are easiest to perform along a straight line, normal to the cortical surface, in order to minimize per-channel tissue displacement. Linear probes provide simultaneous access to neurons in both cortex and subcortical structures, but make it difficult to sample many neurons from the same cortical layer.</p><fig id="fig1" position="float"><label>Figure 1.</label><caption><title>Overview of the ephys and imaging datasets.</title><p>(<bold>A</bold>) Illustration of the orthogonal spatial sampling profiles of the two modalities. Black and white area represents a typical imaging plane (at approximately 250 µm below the brain surface), while tan circles represent the inferred locations of cortical neurons recorded with a Neuropixels probe (area is proportional to overall amplitude). (<bold>B</bold>) Comparison of temporal dynamics between the modalities. <italic>Top:</italic> a heatmap of ΔF/F values for 100 neurons simultaneously imaged in V1 during the presentation of a 30 s movie clip. <italic>Bottom:</italic> raster plot for 100 neurons simultaneously recorded with a Neuropixels probe in V1 in a different mouse viewing the same movie. <italic>Inset:</italic> Close-up of one sample of the imaging heatmap, plotted on the same timescale as 990 samples from 15 electrodes recorded during the equivalent interval from the ephys experiment. (<bold>C</bold>) Steps in the two data generation pipelines. Following habituation, mice proceed to either two-photon imaging or Neuropixels electrophysiology. (<bold>D</bold>) Side-by-side comparison of the rigs used for ephys (left) and imaging (right). (<bold>E</bold>) Schematic of the stimulus set used for both modalities. The ephys stimuli are shown continuously for a single session, while the imaging stimuli are shown over the course of three separate sessions. (<bold>F</bold>) Histogram of neurons recorded in each area and layer, grouped by mouse genotype.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-69068-fig1-v1.tif"/></fig><p>The temporal resolutions of these two methodologies also differ in critical ways (<xref ref-type="fig" rid="fig1">Figure 1B</xref>). Imaging is limited by the dwell time required to capture enough photons to distinguish physiological changes in fluorescence from noise (<xref ref-type="bibr" rid="bib68">Svoboda and Yasuda, 2006</xref>), and the kinetics of calcium-dependent indicators additionally constrain the ability to temporally localize neural activity (<xref ref-type="bibr" rid="bib4">Chen et al., 2013</xref>). While kilohertz-scale imaging has been achieved (<xref ref-type="bibr" rid="bib30">Kazemipour et al., 2019</xref>; <xref ref-type="bibr" rid="bib81">Zhang et al., 2019</xref>), most studies are based on data sampled at frame rates between 1 and 30 Hz. In contrast, extracellular electrophysiology requires sampling rates of 20 kHz or higher, in order to capture the action potential waveform shape that is essential for accurate spike sorting. High sampling rates allow extracellular electrophysiology to pin-point neural activity in time with sub-millisecond resolution, enabling analyses of fine-timescale synchronization across simultaneously recorded neural populations. The fact that electrophysiology can measure action potentials—what we believe to be the fundamental currency of neuronal communication and causation—bestows upon it a more basic ontological status than on calcium imaging, which captures an indirect measure of a neuron’s spike train.</p><p>To date, there has been no comprehensive attempt to characterize how the choice of recording modality affects the inferred functional properties of neurons in sensory cortex. Our limited understanding of how scientific conclusions may be skewed by the recording modality represents the weakest link in the chain of information integration across the techniques available to neurophysiologists today. To address this, we took advantage of two recently collected large-scale datasets that sampled neural activity in mouse visual cortex using either two-photon calcium imaging (<xref ref-type="bibr" rid="bib7">de Vries et al., 2020</xref>) or dense extracellular electrophysiology (<xref ref-type="bibr" rid="bib61">Siegle et al., 2021</xref>). These datasets were collected using standardized pipelines, such that the surgical methods, experimental steps, and physical geometry of the recording rigs were matched as closely as possible (<xref ref-type="fig" rid="fig1">Figure 1C,D</xref>). The overall similarity of these Allen Brain Observatory pipelines eliminates many of the potential confounding factors that arise when comparing results from imaging and electrophysiology experiments. We note that this is not an attempt at calibration against ground truth data, but rather an attempt to reconcile results across two uniquely comprehensive datasets collected under highly standardized conditions.</p><p>Our comparison focused on metrics that capture three fundamental features of neural responses to environmental stimuli: (1) responsiveness, (2) preference (i.e. the stimulus condition that maximizes the peak response), and (3) selectivity (i.e. sharpness of tuning). Responsiveness metrics characterize whether or not a particular stimulus type (e.g. drifting gratings) reproducibly elicits increased activity. For responsive neurons, preference metrics (e.g. preferred temporal frequency) determine which stimulus condition (out of a finite set) elicits the <italic>largest</italic> response, and serve as an indicator of a neuron’s functional specialization—for example, whether it responds preferentially to slow- or fast-moving stimuli. Lastly, selectivity metrics (e.g. orientation selectivity, lifetime sparseness) characterize a neuron’s ability to distinguish between particular exemplars within a stimulus class. All three of these features must be measured accurately in order to understand how stimuli are represented by individual neurons.</p><p>We find that preference metrics are largely invariant across modalities. However, in this dataset, electrophysiology suggests that neurons show a higher degree of responsiveness, while imaging suggests that responsive neurons show a higher degree of selectivity. In the absence of steps taken to mitigate these differences, the two modalities will yield mutually incompatible conclusions about basic neural response properties. These differences could be reduced by lowering the amplitude threshold for valid ΔF/F events, applying a spikes-to-calcium forward model to the electrophysiology data (<xref ref-type="bibr" rid="bib8">Deneux et al., 2016</xref>), or sub-selection of neurons based either on event rate or by contamination level (the likelihood that signal from other neurons is misattributed to the neurons under consideration). This reconciliation reveals the respective biases of these two recording modalities, namely that extracellular electrophysiology predominantly captures the activity of highly active units while missing or merging low-firing-rate units, while calcium-indicator binding dynamics sparsify neural responses and supralinearly amplify spike bursts.</p></sec><sec id="s2" sec-type="results"><title>Results</title><p>We compared the visual responses measured in the Allen Brain Observatory Visual Coding (‘imaging’) and Allen Brain Observatory Neuropixels (‘ephys’) datasets, publicly available through <ext-link ext-link-type="uri" xlink:href="http://brain-map.org/">brain-map.org</ext-link> and the AllenSDK Python package. These datasets consist of recordings from neurons in six cortical visual areas (as well as subcortical areas in the Neuropixels dataset) in the awake, head-fixed mouse in response to a battery of passively viewed visual stimuli. For both datasets, the same drifting gratings, static gratings, natural scenes, and natural movie stimuli were shown (<xref ref-type="fig" rid="fig1">Figure 1E</xref>). These stimuli were presented in a single 3 hr recording session for the ephys dataset. For the imaging dataset, these stimuli were divided across three separate 1 hr imaging sessions from the same group of neurons. In both ephys and imaging experiments, mice were free to run on a rotating disc, the motion of which was continuously recorded.</p><p>The imaging dataset was collected using genetically encoded GCaMP6f (<xref ref-type="bibr" rid="bib4">Chen et al., 2013</xref>) under the control of specific Cre driver lines. These Cre drivers limit the calcium indicator expression to specific neuronal populations, including different excitatory and inhibitory populations found in specific cortical layers (see <xref ref-type="bibr" rid="bib7">de Vries et al., 2020</xref> for details). The ephys dataset also made use of transgenic mice in addition to wild-type mice. These transgenic mice expressed either channelrhodopsin in specific inhibitory populations for identification using optotagging (see <xref ref-type="bibr" rid="bib61">Siegle et al., 2021</xref> for details), or GCaMP6f in specific excitatory or inhibitory populations (see Materials and methods). Unlike in the imaging dataset, however, these transgenic tools did not determine which neurons could be recorded.</p><p>We limited our comparative analysis to putative excitatory neurons from five cortical visual areas (V1, LM, AL, PM, and AM). In the case of the imaging data, we only included data from 10 excitatory Cre lines, while for ephys we limited our analysis to regular-spiking units by setting a threshold on the waveform duration (&gt;0.4 ms). After this filtering step, we were left with 41,578 neurons from 170 mice in imaging, and 11,030 neurons from 52 mice in ephys. The total number of cells for each genotype, layer, and area is shown in <xref ref-type="fig" rid="fig1">Figure 1F</xref>.</p><sec id="s2-1"><title>Calculating response magnitudes for both modalities</title><p>In order to directly compare results from ephys and imaging, we first calculated the magnitude of each neuron’s response to individual trials, which were defined as the interval over which a stimulus was present on the screen. We computed a variety of metrics based on these response magnitudes, and compared the overall distributions of those metrics for all the neurons in each visual area. The methods for measuring these responses necessarily differ between modalities, as explained below.</p><p>For the ephys dataset, stimulus-evoked responses were computed using the spike times identified by Kilosort2 (<xref ref-type="bibr" rid="bib44">Pachitariu et al., 2016a</xref>; <xref ref-type="bibr" rid="bib66">Stringer et al., 2019a</xref>). Kilosort2 uses information in the extracellularly recorded voltage traces to find templates that fit the spike waveform shapes of all the units in the dataset, and assigns a template to each spike. The process of ‘spike sorting’—regardless of the underlying algorithm—does not perfectly recover the true underlying spike times, and has the potential to miss spikes (false negatives) or assign spikes (or noise waveforms) to the wrong unit (false positives). The magnitude of the response for a given trial was determined by counting the total number of spikes (including false positives and excluding false negatives) that occured during the stimulation interval. This spike-rate–based analysis is the de facto standard for analyzing electrophysiology data, but it washes out information about bursting or other within-trial dynamics. For example, a trial that includes a four-spike burst will have the same apparent magnitude as a trial with four isolated spikes (<xref ref-type="fig" rid="fig2">Figure 2A</xref>).</p><fig-group><fig id="fig2" position="float"><label>Figure 2.</label><caption><title>Baseline metric comparison.</title><p>(<bold>A</bold>) Steps involved in computing response magnitudes for units in the ephys dataset. (<bold>B</bold>) Same as A, but for the imaging dataset. (<bold>C</bold>) Drifting gratings spike rasters for an example ephys neuron. Each raster represents 2 s of spikes in response to 15 presentations of a drifting grating at one orientation and temporal frequency. Inset: spike raster for the neuron’s preferred condition, with each trial’s response magnitude shown on the right, and compared to the 95th percentile of the spontaneous distribution. Responsiveness (purple), preference (red), and selectivity (brown) metrics are indicated. (<bold>D</bold>) Same as C, but for an example imaged neuron. (<bold>E</bold>) Fraction of neurons deemed responsive to each of four stimulus types, using the same responsiveness metric for both ephys (gray) and imaging (green). Numbers above each pair of bars represent the Jensen–Shannon distance between the full distribution of response reliabilities for each stimulus/area combination. (<bold>F</bold>) Distribution of preferred temporal frequencies for all neurons in five different areas. The value <italic>D</italic> represents the Jensen–Shannon distance between the ephys and imaging distributions. (<bold>G</bold>) Distributions of lifetime sparseness in response to a drifting grating stimulus for all neurons in five different areas. The value <italic>D</italic> represents the Jensen–Shannon distance between the ephys and imaging distributions.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-69068-fig2-v1.tif"/></fig><fig id="fig2s1" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 1.</label><caption><title>Baseline comparisons for additional preference and selectivity metrics.</title><p>(<bold>A</bold>) Distribution of preferred directions across five areas. (<bold>B</bold>) Distribution of preferred orientations across five areas. (<bold>C</bold>) Distribution of preferred spatial frequency across five areas. (<bold>D</bold>) Distribution of global orientation selectivity index across five areas. (<bold>E</bold>) Distribution of global direction selectivity index across five areas. In all plots, ephys = gray and imaging = green.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-69068-fig2-figsupp1-v1.tif"/></fig><fig id="fig2s2" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 2.</label><caption><title>Matching laminar distribution patterns across modalities.</title><p>(<bold>A</bold>) Original layer distributions, prior to resampling, for imaging (green) and ephys (gray). (<bold>B</bold>) Layer distributions following the resampling procedure, for imaging (light green) and ephys (light gray). (<bold>C</bold>) Cumulative histograms of significant trial fractions for imaging and ephys, before and after resampling. (<bold>D</bold>) Cumulative histograms of preferred temporal frequency for imaging and ephys, before and after resampling. (<bold>E</bold>) Cumulative histograms of preferred temporal frequency for imaging and ephys, before and after resampling. The value <italic>D</italic> represents the Jensen–Shannon distance between the before/after distributions. In panels (<bold>C–E</bold>), lighter dashed lines represent the values after resampling.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-69068-fig2-figsupp2-v1.tif"/></fig><fig id="fig2s3" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 3.</label><caption><title>Characterizing the impact of running behavior on response metrics.</title><p>(<bold>A</bold>) Average speed and running fraction for individual mice from imaging and ephys experiments, grouped by genotype. Shaded areas represent the mean ± standard deviation for each genotype. Colors are the same as in <xref ref-type="fig" rid="fig1">Figure 1F</xref>. p Values are from the Mann–Whiteny <italic>U</italic> test between all imaging and all ephys values for each stimulus/metric combination. (<bold>B</bold>) Fraction of neurons responding to three stimulus types during stationary and running intervals. Neurons were included only if the mouse was stationary or running on at least 20% of trials. (<bold>C</bold>) Change in lifetime sparseness during running intervals for all neurons from imaging and ephys experiments. Black line represents the median change for each modality/stimulus type.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-69068-fig2-figsupp3-v1.tif"/></fig><fig id="fig2s4" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 4.</label><caption><title>Matching running behavior across modalities.</title><p>(<bold>A</bold>) Cumulative histogram of drifting gratings running fractions for the ephys dataset, and for the imaging dataset before and after performing the behavioral matching procedure. (<bold>B</bold>) Fraction of neurons deemed responsive to each of three stimulus types, before and after sub-sampling the imaging experiments to match ephys running behavior. Numbers above each pair of bars represent the Jensen–Shannon distance between the full distribution of responsive trial fractions for each stimulus/area combination. (<bold>C</bold>) Distribution of preferred temporal frequencies for all neurons in five different areas. The Jensen–Shannon distance between the original imaging and resampled imaging distributions is shown for each plot. (<bold>D</bold>) Distributions of lifetime sparseness in response to a drifting grating stimulus for all neurons in five different areas. The Jensen–Shannon distance between the original imaging and resampled imaging distributions is shown for each plot.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-69068-fig2-figsupp4-v1.tif"/></fig></fig-group><p>Methods for determining response magnitudes for neurons in imaging datasets are less standardized, and deserve careful consideration. The most commonly used approach involves averaging the continuous, baseline-normalized fluorescence signal over the trial interval. This method relies on information that is closer to the raw data. However, it suffers the severe drawback that, due to the long decay time of calcium indicators, activity from one trial can contaminate the fluorescence trace during the next trial, especially when relatively short (&lt;1 s) inter-stimulus intervals are used. To surmount this problem, one can attempt to determine the onset of abrupt changes in fluorescence and analyze these extracted ‘events,’ rather than the continuous trace. There are a variety of algorithms available for this purpose, including non-negative deconvolution (<xref ref-type="bibr" rid="bib74">Vogelstein et al., 2010</xref>; <xref ref-type="bibr" rid="bib15">Friedrich et al., 2017</xref>), approaches that model calcium binding kinetics (<xref ref-type="bibr" rid="bib8">Deneux et al., 2016</xref>; <xref ref-type="bibr" rid="bib19">Greenberg et al., 2018</xref>), and methods based on machine learning (<xref ref-type="bibr" rid="bib69">Theis et al., 2016</xref>; <xref ref-type="bibr" rid="bib1">Berens et al., 2018</xref>; <xref ref-type="bibr" rid="bib55">Rupprecht et al., 2021</xref>). For our initial comparison, we extracted events using the same method we applied to our previous analysis of the large-scale imaging dataset (<xref ref-type="bibr" rid="bib7">de Vries et al., 2020</xref>). This algorithm finds event times by reframing <italic>ℓ</italic><sub>0</sub>-regularized deconvolution as a change point detection problem that has a mathematically guaranteed, globally optimal ‘exact’ solution (hereafter, ‘exact <italic>ℓ</italic><sub>0</sub>’; <xref ref-type="bibr" rid="bib27">Jewell and Witten, 2018</xref>; <xref ref-type="bibr" rid="bib26">Jewell et al., 2018</xref>). The algorithm includes a sparsity constraint (λ) that is calibrated to each neuron’s overall noise level.</p><p>For the most part, the events that are detected from the 2P imaging data do not represent individual spikes, but rather are heavily biased towards indicating short bouts of high firing rate, for example bursting (<xref ref-type="bibr" rid="bib24">Huang et al., 2021</xref>). There is, however, rich information contained in the amplitudes of these events, which have a non-linear—albeit on average monotonic—relationship with the underlying number of true spikes within a window. Therefore, in our population imaging dataset, we calculated the trial response magnitude by summing the amplitudes of events that occurred during the stimulation interval (<xref ref-type="fig" rid="fig2">Figure 2B</xref>). In example trials for the same hypothetical neuron recorded with both modalities (<xref ref-type="fig" rid="fig2">Figure 2A,B</xref>), the response magnitudes are equivalent from the perspective of electrophysiology. However, from the perspective of imaging, the trial that includes a spike burst (which results in a large influx of calcium) may have an order-of-magnitude larger response than a trial that only includes isolated spikes.</p></sec><sec id="s2-2"><title>Baseline metric comparison</title><p>A comparison between individual neurons highlights the effect of differences in response magnitude calculation on visual physiology. A spike raster from a neuron in V1 recorded with electrophysiology (<xref ref-type="fig" rid="fig2">Figure 2C</xref>) appears much denser than the corresponding event raster for a separate neuron that was imaged in the same area (<xref ref-type="fig" rid="fig2">Figure 2D</xref>). For each neuron, we computed responsiveness, preference, and selectivity metrics. We consider both neurons to be responsive to the drifting gratings stimulus class because they have a significant response (p &lt; 0.05, compared to a distribution of activity taken during the epoch of spontaneous activity) on at least 25% of the trials of the preferred condition (the grating direction and temporal frequency that elicited the largest mean response) (<xref ref-type="bibr" rid="bib7">de Vries et al., 2020</xref>). Since these neurons were deemed responsive according to this criterion, their function was further characterized in terms of their preferred stimulus condition and their selectivity (a measure of tuning curve sharpness). We use lifetime sparseness (<xref ref-type="bibr" rid="bib73">Vinje and Gallant, 2000</xref>) as our primary selectivity metric, because it is a general metric that is applicable to every stimulus type. It reflects the distribution of responses of a neuron across some stimulus space (e.g. natural scenes or drifting gratings), equaling 0 if the neuron responds equivalently to all stimulus conditions, and one if the neuron only responds to a single condition. Across all areas and mouse lines, lifetime sparseness is highly correlated with more traditional selectivity metrics, such as drifting gratings orientation selectivity (<italic>R</italic> = 0.8 for ephys, 0.79 for imaging; Pearson correlation), static gratings orientation selectivity (<italic>R</italic> = 0.79 for ephys, 0.69 for imaging), and natural scenes image selectivity (<italic>R</italic> = 0.85 for ephys, 0.95 for imaging).</p><p>For our initial analysis, we sought to compare the results from ephys and imaging <italic>as they are typically analyzed in the literature</italic>, prior to any attempt at reconciliation. We will refer to these comparisons as ‘baseline comparisons’ in order to distinguish them from subsequent comparisons made after applying one or more transformations to the imaging and/or ephys datasets. We pooled responsiveness, preference, and selectivity metrics for all of the neurons in a given visual area across experiments, and quantified the disparity between the imaging and ephys distributions using Jensen–Shannon distance. This is the square root of the Jensen–Shannon divergence, which is a method of measuring the disparity between two probability distributions that is symmetric and always has a finite value (<xref ref-type="bibr" rid="bib35">Lin, 1991</xref>). Jensen–Shannon distance is equal to 0 for perfectly overlapping distributions, and one for completely non-overlapping distributions, and falls in between these values for partially overlapping distributions.</p><p>Across all areas and stimuli, the fraction of responsive neurons was higher in the ephys dataset than the imaging dataset (<xref ref-type="fig" rid="fig2">Figure 2E</xref>). To quantify the difference between modalities, we computed the Jensen–Shannon distance for the distributions of response reliabilities, rather than the fraction of responsive neurons at the 25% threshold level. This is done to ensure that our results are not too sensitive to the specific responsiveness threshold we have chosen. We found tuning preferences to be consistent between the two modalities, including preferred temporal frequency (<xref ref-type="fig" rid="fig2">Figure 2F</xref>), preferred direction (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1A</xref>), preferred orientation (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1B</xref>), and preferred spatial frequency (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1C</xref>). This was based on the qualitative similarity of their overall distributions, as well as their low values of Jensen–Shannon distance. Selectivity metrics, such as lifetime sparseness (<xref ref-type="fig" rid="fig2">Figure 2G</xref>), orientation selectivity (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1D</xref>), and direction selectivity (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1E</xref>), were consistently higher in imaging than ephys.</p></sec><sec id="s2-3"><title>Controlling for laminar sampling bias and running behavior</title><p>To control for potential high-level variations across the imaging and ephys experimental preparations, we first examined the effect of laminar sampling bias. For example, the ephys dataset contained more neurons in layer 5, due to the presence of large, highly active cells in this layer. The imaging dataset, on the other hand, had more neurons in layer 4 due to the preponderance of layer 4 Cre lines included in the dataset (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2A</xref>). After resampling each dataset to match layer distributions (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2B</xref>, see Materials and methods for details), we saw very little change in the overall distributions of responsiveness, preference, and selectivity metrics (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2C–E</xref>), indicating that laminar sampling biases are likely not a key cause of the differences we observed between the modalities.</p><p>We next sought to quantify the influence of behavioral differences on our comparison. As running and other motor behavior can influence visually evoked responses (<xref ref-type="bibr" rid="bib41">Niell and Stryker, 2010</xref>; <xref ref-type="bibr" rid="bib66">Stringer et al., 2019a</xref>; <xref ref-type="bibr" rid="bib72">Vinck et al., 2015</xref>; <xref ref-type="bibr" rid="bib7">de Vries et al., 2020</xref>), could modality-specific behavioral differences contribute to the discrepancies in the response metrics? In our datasets, mice tend to spend a larger fraction of time running in the ephys experiments, perhaps because of the longer experiment duration, which may be further confounded by genotype-specific differences in running behavior (<xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3A</xref>). Within each modality, running had a similar impact on visual response metrics. On average, units in ephys and neurons in imaging have slightly lower responsiveness during periods of running versus non-running (<xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3B</xref>), but slightly higher selectivity (<xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3C</xref>). To control for the effect of running, we sub-sampled our imaging experiments in order to match the overall distribution of running fraction to the ephys data (<xref ref-type="fig" rid="fig2s4">Figure 2—figure supplement 4A</xref>). This transformation had a negligible impact on responsiveness, selectivity, and preference metrics (<xref ref-type="fig" rid="fig2s4">Figure 2—figure supplement 4B–D</xref>). From this analysis we conclude that, at least for the datasets examined here, behavioral differences do not account for the differences in functional properties inferred from imaging and ephys.</p></sec><sec id="s2-4"><title>Impact of event detection on functional metrics</title><p>We sought to determine whether our approach to extracting events from the 2P data could explain between-modality differences in responsiveness and selectivity. Prior work has shown that scientific conclusions can depend on both the method of event extraction and the chosen parameters (<xref ref-type="bibr" rid="bib13">Evans et al., 2019</xref>). However, the impact of different algorithms on functional metrics has yet to be assessed in a systematic way. To address this shortcoming, we first compared two event detection algorithms, exact <italic>ℓ</italic><sub>0</sub> and unpenalized non-negative deconvolution (NND), another event extraction method that performs well on a ground truth dataset of simultaneous two-photon imaging and loose patch recordings from primary visual cortex (<xref ref-type="bibr" rid="bib24">Huang et al., 2021</xref>). Care was taken to ensure that the characteristics of the ground truth imaging data matched those of our large-scale population recordings in terms of their imaging resolution, frame rate, and noise levels, which implicitly accounted for differences in laser power across experiments.</p><p>The correlation between the ground truth firing rate and the overall event amplitude within a given time bin is a common way of assessing event extraction performance (<xref ref-type="bibr" rid="bib69">Theis et al., 2016</xref>; <xref ref-type="bibr" rid="bib1">Berens et al., 2018</xref>; <xref ref-type="bibr" rid="bib55">Rupprecht et al., 2021</xref>). Both algorithms performed equally well in terms of their ability to predict the instantaneous firing rate (for 100 ms bins, exact <italic>ℓ</italic><sub>0</sub> <italic>r</italic> = 0.48 ± 0.23; NND <italic>r</italic> = 0.50 ± 0.24; p = 0.1, Wilcoxon signed-rank test). However, this metric does not capture all of the relevant features of the event time series. In particular, it ignores the rate of false positive events that are detected in the absence of a true underlying spike (<xref ref-type="fig" rid="fig3">Figure 3A</xref>). We found that the exact <italic>ℓ</italic><sub>0</sub> method, which includes a built-in sparsity constraint, had a low rate of false positives (8 ± 2% in 100 ms bins, <italic>N</italic> = 32 ground truth recordings), whereas NND had a much higher rate (21 ± 4%; <italic>p</italic> = 8e-7, Wilcoxon signed-rank test). Small-amplitude false positive events have very little impact on the overall correlation between the ground truth spike rate and the extracted events, so parameter optimization does not typically penalize such events. However, we reasoned that the summation of many false positive events could have a noticeable impact on response magnitudes averaged over trials. Because these events always have a positive sign, they cannot be canceled out by low-amplitude negative deflections of similar magnitude, as would occur when analyzing ΔF/F directly.</p><fig id="fig3" position="float"><label>Figure 3.</label><caption><title>Impact of calcium event detection on functional metrics.</title><p>(<bold>A</bold>) GCaMP6f fluorescence trace, spike times, and detected events for one example neuron with simultaneous imaging and electrophysiology. Events are either detected via exact <italic>ℓ</italic><sub>0</sub>-regularized deconvolution (<xref ref-type="bibr" rid="bib27">Jewell and Witten, 2018</xref>) or unpenalized non-negative deconvolution (<xref ref-type="bibr" rid="bib15">Friedrich et al., 2017</xref>). Each 250 ms bin is classified as a ‘hit,’ ‘miss,’ ‘false positive,’ or ‘true positive’ by comparing the presence/absence of detected events with the true underlying spike times. (<bold>B</bold>) Correlation between binned event amplitude and ground truth firing rate after filtering NND events at different threshold levels relative to each neuron’s noise level (σ). The average across neurons is shown as colored dots. (<bold>C</bold>) Same as B, but for the average response amplitude within a 100 ms interval (relative to the amplitude with no thresholding applied). (<bold>D</bold>) Same as B, but for the probability of detecting a false positive event in a 100 ms interval. (<bold>E</bold>) Event times in response to 600 drifting gratings presentations for one example neuron, sorted by grating direction (ignoring differences in temporal frequency). Dots representing individual events are scaled by the amplitude of the associated event. Each column represents the results of a different event detection method. The resulting tuning curves and measured global orientation selectivity index (gOSI) are shown to the right of each plot. (<bold>F</bold>) Lifetime sparseness distributions for Scl17a7+ V1 neurons, after filtering out events at varying threshold levels relative to each neuron’s baseline noise level. The overall V1 distributions from ephys (gray) and exact <italic>ℓ</italic><sub>0</sub> (green) are overlaid on the most similar distribution. (<bold>G</bold>) Fraction of Slc17a7+ V1 neurons responding to three different stimulus types, after filtering out events at varying threshold levels relative to each neuron’s baseline noise level.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-69068-fig3-v1.tif"/></fig><p>We tested the impact of applying a minimum-amplitude threshold to the event time series obtained via NND. If the cumulative event amplitude within a given time bin (100 ms) did not exceed a threshold (set to a multiple of each neuron’s estimated noise level), the events in that window were removed. As expected, this procedure resulted in almost no change in the correlation between event amplitude and the ground truth firing rate (<xref ref-type="fig" rid="fig3">Figure 3B</xref>). However, it had a noticeable impact on both the average response magnitude within a given time window (<xref ref-type="fig" rid="fig3">Figure 3C</xref>), as well as the false positive rate (<xref ref-type="fig" rid="fig3">Figure 3D</xref>).</p><p>Applying the same thresholding procedure to an example neuron from our population imaging dataset demonstrates how low-amplitude events can impact a cell’s apparent selectivity level. The prevalence of such events differs between the two compared approaches to event extraction, the exact <italic>ℓ</italic><sub>0</sub> method used in <xref ref-type="fig" rid="fig2">Figure 2</xref> and NND with no regularization (<xref ref-type="fig" rid="fig3">Figure 3E</xref>). When summing event amplitudes over many drifting gratings presentations, the difference in background rate has a big impact on the measured value of global orientation selectivity (gOSI), starting from 0.91 when using the exact <italic>ℓ</italic><sub>0</sub> and dropping to 0.45 when using NND. However, these differences could be reconciled simply by setting a threshold to filter out low-amplitude events.</p><p>Extracting events from a population dataset (<italic>N</italic> = 3095 Slc17a7+ neurons from V1) using NND resulted in much lower measured overall selectivity levels, even lower than for electrophysiology (<xref ref-type="fig" rid="fig3">Figure 3F</xref>). Thresholding out events at multiples of each neuron’s noise level (σ) raised selectivity levels; a threshold between 3 and 4σ brought the selectivity distribution closest to the ephys distribution, while a threshold between 4 and 5σ resulted in selectivity that roughly matched that obtained with exact <italic>ℓ</italic><sub>0</sub> (<xref ref-type="fig" rid="fig2">Figure 2G</xref>). The rate of low-amplitude events also affected responsiveness metrics (<xref ref-type="fig" rid="fig3">Figure 3G</xref>). Responsiveness was highest when all detected events were included, matching or slightly exceeding the levels measured with ephys. Again, applying an amplitude threshold between 4 and 5σ brought responsiveness to the level originally measured with exact <italic>ℓ</italic><sub>0</sub>. By imposing the same noise-based threshold on the minimum event size that we originally computed to determine optimal regularization strength (essentially performing a post-hoc regularization), we are able to reconcile the results obtained with NND with those obtained via exact <italic>ℓ</italic><sub>0</sub>.</p><p>This analysis demonstrates that altering the 2P event extraction methodology represents one possible avenue for reconciling results from imaging and ephys. However, as different parameters were needed to reconcile either selectivity or responsiveness, and the optimal parameters further depend on the presented stimulus class, this cannot be the whole story. Furthermore, relying only on 2P event extraction parameters to reconcile results across modalities implies that the ephys data is itself unbiased, and all we need to do is adjust our imaging analysis pipeline until our metrics match. Because we know this is not the case, we explored the potential impacts of additional factors on the discrepancies between our ephys and imaging datasets.</p></sec><sec id="s2-5"><title>Controlling for transgene expression</title><p>Given that imaging (but not ephys) approaches fundamentally require the expression of exogenous proteins (e.g. Cre, tTA, and GCaMP6f in the case of our transgenic mice) in specific populations of neurons, we sought to determine whether such foreign transgenes, expressed at relatively high levels, could alter the underlying physiology of the neural population. All three proteins have been shown to have neurotoxic effects under certain conditions (<xref ref-type="bibr" rid="bib20">Han et al., 2012</xref>; <xref ref-type="bibr" rid="bib56">Schmidt-Supprian and Rajewsky, 2007</xref>; <xref ref-type="bibr" rid="bib65">Steinmetz et al., 2017</xref>), and calcium indicators, which by design bind intracellular calcium, can additionally interfere with cellular signaling pathways. To examine whether the expression of these genes could explain the differences in functional properties inferred from imaging and ephys experiments, we performed electrophysiology in mice that expressed GCaMP6f under the control of specific Cre drivers. We collected data from mice with GCaMP6f expressed in dense excitatory lines (Cux2 and Slc17a7) or in sparse inhibitory lines (Vip and Sst), and compared the results to those obtained from wild-type mice (<xref ref-type="fig" rid="fig4">Figure 4A</xref>). On average, we recorded 45.9 ± 7.5 neurons per area in 17 wild-type mice, and 55.8 ± 15.6 neurons per area in 19 GCaMP6f transgenic mice (<xref ref-type="fig" rid="fig4">Figure 4B</xref>). The distribution of firing rates of recorded neurons in mice from all Cre lines was similar to the distribution for units in wild-type mice (<xref ref-type="fig" rid="fig4">Figure 4C</xref>).</p><fig id="fig4" position="float"><label>Figure 4.</label><caption><title>Comparing responses across GCaMP-expressing mouse lines.</title><p>(<bold>A</bold>) GCaMP expression patterns for the four lines used for ephys experiments, based on two-photon serial tomography (TissueCyte) sections from mice used in the imaging pipeline. (<bold>B</bold>) Unit yield (following QC filtering) for five areas and five genotypes. Error bars represent standard deviation across experiments; each dot represents a data point from one experiment. (<bold>C</bold>) Distribution of firing rates for neurons from each mouse line, aggregated across experiments. (<bold>D</bold>) Distribution of burst fraction (fraction of all spikes that participate in bursts) for neurons from each mouse line, aggregated across experiments. Dots represent the median of each distribution, shown in relation to a reference value of 0.3. (<bold>E</bold>) Fraction of neurons deemed responsive to drifting gratings, grouped by genotype. (<bold>F</bold>) Distribution of lifetime sparseness in response to a drifting grating stimulus, grouped by genotype. In panels (<bold>C–F</bold>), colored numbers indicate the Jensen–Shannon distance between the wild-type distribution and the distributions of the four GCaMP-expressing mouse lines. Area PM does not include data from Cux2 mice, as it was only successfully targeted in one session for this mouse line.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-69068-fig4-v1.tif"/></fig><p>Because some GCaMP mouse lines have been known to exhibit aberrant seizure-like activity (<xref ref-type="bibr" rid="bib65">Steinmetz et al., 2017</xref>), we wanted to check whether spike bursts were more prevalent in these mice. We detected bursting activity using the LogISI method, which identifies bursts in a spike train based on an adaptive inter-spike interval threshold (<xref ref-type="bibr" rid="bib48">Pasquale et al., 2010</xref>). The dense excitatory Cre lines showed a slight increase in burst fraction (the fraction of all spikes that participate in bursts) compared to wild-type mice (<xref ref-type="fig" rid="fig4">Figure 4D</xref>). This minor increase in burstiness, however, was not associated with changes in responsiveness or selectivity metrics that could account for the baseline differences between the ephys and imaging datasets. The fraction of responsive neurons was not lower in the GCaMP6f mice, as it was for the imaging dataset—in fact, in some visual areas there was an increase in responsiveness in the GCaMP6f mice compared to wild-type (<xref ref-type="fig" rid="fig4">Figure 4E</xref>). In addition, the distribution of selectivities was largely unchanged between wild-type and GCaMP6f mice (<xref ref-type="fig" rid="fig4">Figure 4F</xref>). Thus, while there may be subtle differences in the underlying physiology of GCaMP6f mice, particularly in the dense excitatory lines, those differences cannot explain the large discrepancies in visual response metrics derived from ephys or imaging.</p></sec><sec id="s2-6"><title>Forward-modeling synthetic imaging data from experimental ephys data</title><p>Given the substantial differences between the properties of extracellularly recorded spikes and events extracted from fluorescence traces (<xref ref-type="fig" rid="fig2">Figure 2A–C</xref>), and the potential impact of event extraction parameters on derived functional metrics (<xref ref-type="fig" rid="fig3">Figure 3</xref>), we hypothesized that transforming spike trains into simulated calcium events could reconcile some of the baseline differences in response metrics we have observed. The inverse transformation—converting fluorescence events into synthetic spike times—is highly under-specified, due to the reduced temporal resolution of calcium imaging (<xref ref-type="fig" rid="fig1">Figure 1B</xref>).</p><p>To implement the spikes-to-calcium transformation, we used MLSpike, a biophysically inspired forward model (<xref ref-type="bibr" rid="bib8">Deneux et al., 2016</xref>). MLSpike explicitly considers the cooperative binding between GCaMP and calcium to generate synthetic ΔF/F fluorescence traces using the spike trains for each unit recorded with ephys as input. We extracted events from these traces using the same exact <italic>ℓ</italic><sub>0</sub>-regularized detection algorithm applied to our experimental imaging data, and used these events as inputs to our functional metrics calculations (<xref ref-type="fig" rid="fig5">Figure 5A</xref>).</p><fig-group><fig id="fig5" position="float"><label>Figure 5.</label><caption><title>Effects of the spikes-to-calcium forward model.</title><p>(<bold>A</bold>) Example of the forward model transformation. A series of spike times (top) is converted to a simulated ΔF/F trace (middle), from which <italic>ℓ</italic><sub>0</sub>-regularized events are extracted using the same method as for the experimental imaging data (bottom). (<bold>B</bold>) Overview of the three forward model parameters that were fit to data from the Allen Brain Observatory two-photon imaging experiments. (<bold>C</bold>) Raster plot for one example neuron, before and after applying the forward model. Trials are grouped by drifting grating direction and ordered by response magnitude from the original ephys data. The magnitudes of each trial (based on ephys spike counts or summed imaging event amplitudes) are shown to the right of each plot. (<bold>D</bold>) Count of neurons responding (green) or not responding (red) to drifting gratings before or after applying the forward model. (<bold>E</bold>) Fraction of neurons deemed responsive to each of three stimulus types, for both synthetic fluorescence traces (yellow) and true imaging data (green). Numbers above each pair of bars represent the Jensen–Shannon distance between the full distribution of responsive trial fractions for each stimulus/area combination. (<bold>F</bold>) 2D histogram of neurons’ preferred temporal frequency before and after applying the forward model. (<bold>G</bold>) Distribution of preferred temporal frequencies for all neurons in five different areas. The Jensen–Shannon distance between the synthetic imaging and true imaging distributions is shown for each plot. (<bold>H</bold>) Comparison between measured lifetime sparseness in response to drifting grating stimulus before and after applying the forward model. (<bold>I</bold>) Distributions of lifetime sparseness in response to a drifting grating stimulus for all neurons in five different areas. The Jensen–Shannon distance between the synthetic imaging and true imaging distributions is shown for each plot.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-69068-fig5-v1.tif"/></fig><fig id="fig5s1" position="float" specific-use="child-fig"><label>Figure 5—figure supplement 1.</label><caption><title>Sampling the entire space of forward model parameters.</title><p>(<bold>A</bold>) Schematic of three different ‘slices’ through forward model parameter space, sampling all values of unitary amplitude (<bold>A</bold>), decay time (<italic>τ</italic>), or noise level (<italic>σ</italic>). (<bold>B</bold>) Fraction of neurons responding to drifting gratings for all parameter combinations. (<bold>C</bold>) Median lifetime sparseness in response to a drifting grating stimulus for all parameter combinations. The median value for the experimental imaging data determines the maximum value of the color scale. (<bold>D</bold>) Jensen–Shannon distance between the distributions of drifting gratings lifetime sparseness for all parameter combinations. In panels (B–D), the combination used in <xref ref-type="fig" rid="fig5">Figure 5</xref> is highlighted in white.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-69068-fig5-figsupp1-v1.tif"/></fig><fig id="fig5s2" position="float" specific-use="child-fig"><label>Figure 5—figure supplement 2.</label><caption><title>Relationship between forward model parameters, genotype, and functional metrics.</title><p>(<bold>A</bold>) Distribution of noise level (<italic>σ</italic>), decay time (<italic>τ</italic>), and amplitude (<bold>A</bold>) parameters for the 10 different Cre lines used in this study. (<bold>B</bold>) Effect of sub-selecting neurons based on drifting gratings response reliability. Each line represents the parameter distribution for quantiles of increasing reliability (from dark to light). (<bold>C</bold>) Relationship between forward model parameters and response reliability. (<bold>D</bold>) Effect of sub-selecting neurons based on selectivity. Each line represents the parameter distribution for quantiles of increasing selectivity (from dark to light). (<bold>E</bold>) Relationship between forward model parameters and drifting gratings lifetime sparseness.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-69068-fig5-figsupp2-v1.tif"/></fig></fig-group><p>A subset of the free parameters in the MLSpike model (e.g. ΔF/F rise time, Hill parameter, saturation parameter, and normalized resting calcium concentration) were fit to simultaneously acquired loose patch and two-photon-imaging recordings from layer 2/3 of mouse visual cortex (<xref ref-type="bibr" rid="bib24">Huang et al., 2021</xref>). Additionally, three parameters were calibrated on the fluorescence traces from the imaging dataset to capture the neuron-to-neuron variance of these parameters: the average amplitude of a fluorescence transient in response to a spike burst (<italic>A</italic>), the decay time of the fluorescence transients (<italic>τ</italic>), and the level of Gaussian noise in the signal (<italic>σ</italic>) (<xref ref-type="fig" rid="fig5">Figure 5B</xref>). For our initial characterization, we selected parameter values based on the mode of the overall distribution from the imaging dataset.</p><p>The primary consequence of the forward model was to ‘sparsify’ each neuron’s response by washing out single spikes while non-linearly boosting the amplitude of ‘bursty’ spike sequences with short inter-spike intervals. When responses were calculated on the ephys spike train, a trial containing a 4-spike burst within a 250 ms window would have the same magnitude as a trial with four isolated spikes across the 2 s trial. After the forward model, however, the burst would be transformed into an event with a magnitude many times greater than the events associated with isolated spikes, due to the nonlinear relationship between spike counts and the resulting calcium-dependent fluorescence. This effect can be seen in stimulus-locked raster plots for the same neuron before and after applying the forward model (<xref ref-type="fig" rid="fig5">Figure 5C</xref>).</p><p>What effects does this transformation have on neurons’ inferred functional properties? Applying the forward model plus event extraction to the ephys data did not systematically alter the fraction of responsive units in the dataset. While 8% of neurons switched from being responsive to drifting gratings to unresponsive, or vice versa, they did so in approximately equal numbers (<xref ref-type="fig" rid="fig5">Figure 5D</xref>). The forward model did not improve the match between the distributions of response reliabilities (our responsiveness metric) for any stimulus type (<xref ref-type="fig" rid="fig5">Figure 5E</xref>). The forward model similarly had a negligible impact on preference metrics; for example, only 14% of neurons changed their preferred temporal frequency after applying the forward model (<xref ref-type="fig" rid="fig5">Figure 5F</xref>), and the overall distribution of preferred temporal frequencies still matched that from the imaging experiments (<xref ref-type="fig" rid="fig5">Figure 5G</xref>). In contrast, nearly all neurons increased their selectivity after applying the forward model (<xref ref-type="fig" rid="fig5">Figure 5H</xref>). Overall, the distribution of lifetime sparseness to drifting gratings became more similar to—but still did not completely match—the imaging distribution across all areas (<xref ref-type="fig" rid="fig5">Figure 5I</xref>). The average Jensen–Shannon distance between the ephys and imaging distributions was 0.41 before applying the forward model, compared to 0.14 afterward (mean bootstrapped distance between the sub-samples of the imaging distribution = 0.064; p &lt; 0.001 for all areas, since 1000 bootstrap samples never exceeded the true Jensen–Shannon distance; see Materials and methods for details). These results imply that the primary effects of the forward model—providing a supralinear boost to the ‘amplitude’ of spike bursts, and thresholding out single spike events—can account for baseline differences in selectivity, but not responsiveness, between ephys and imaging.</p><p>To assess whether the discrepancies between the imaging and ephys distributions of responsiveness and selectivity metrics could be further reduced by using a different set of forward model parameters, we brute-force sampled 1000 different parameter combinations for one ephys session, using 10 values each for amplitude, decay time, and noise level (<xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1A</xref>), spanning the entire range of parameters calibrated on the experimental imaging data. The fraction of responsive neurons did not change as a function of forward model parameters, except for the lowest values of amplitude and noise level, where it decreased substantially (<xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1B</xref>). This parameter combination (A ≤ 0.0015, sigma ≤ 0.03) was observed in less than 1% of actual neurons recorded with two-photon imaging, so it cannot account for differences in responsiveness between the two modalities. Both the difference between the median lifetime sparseness for imaging and ephys, as well as the Jensen–Shannon distance between the full ephys and imaging lifetime sparseness distributions, were near the global minimum for the parameter values we initially used (<xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1C,D</xref>).</p><p>It is conceivable that the inability of the forward model to fully reconcile differences in responsiveness and selectivity was due to the fact that we applied the same parameters across all neurons of the ephys dataset, without considering their genetically defined cell type. To test for cell-type-specific differences in forward model parameters, we examined the distributions of amplitude, decay time, and noise level for individual excitatory Cre lines used in the imaging dataset. The distributions of parameter values across genotypes were largely overlapping, with the exception of increasing noise levels for some of the deeper populations (e.g. Tlx3-Cre in layer 5, and Ntsr1-Cre_GN220 in layer 6) and an abundance of low-amplitude neurons in the Fezf2-CreER population (<xref ref-type="fig" rid="fig5s2">Figure 5—figure supplement 2A</xref>). Given that higher noise levels and lower amplitudes did not improve the correspondence between the ephys and imaging metric distributions, we concluded that selecting parameter values for individual neurons based on their most likely cell type would not change our results. Furthermore, we saw no correlation between responsiveness or selectivity metrics in imaged neurons and their calibrated amplitude, decay time, or noise level (<xref ref-type="fig" rid="fig5s2">Figure 5—figure supplement 2B–E</xref>).</p></sec><sec id="s2-7"><title>Effect of ephys selection bias</title><p>We next sought to determine whether electrophysiology’s well-known selection bias in favor of more active neurons could account for the differences between modalities. Whereas calcium imaging can detect the presence of all neurons in the field of view that express a fluorescent indicator, ephys cannot detect neurons unless they fire action potentials. This bias is exacerbated by the spike sorting process, which requires a sufficient number of spikes in order to generate an accurate template of each neuron’s waveform. Spike sorting algorithms can also mistakenly merge spikes from nearby neurons into a single ‘unit’ or allow background activity to contaminate a spike train, especially when spike waveforms generated by one neuron vary over time, for example due to the adaptation that occurs during a burst. These issues all result in an apparent activity level increase in ephys recordings. In addition, assuming a 50-μm ‘listening radius’ for the probes (radius of half-cylinder around the probe where the neurons’ spike amplitude is sufficiently above noise to trigger detection) (<xref ref-type="bibr" rid="bib3">Buzsáki, 2004</xref>; <xref ref-type="bibr" rid="bib21">Harris et al., 2016</xref>; <xref ref-type="bibr" rid="bib59">Shoham et al., 2006</xref>), the average yield of 116 regular-spiking units/probe (prior to QC filtering) would imply a density of 42,000 neurons/mm<sup>3</sup>, much lower than the known density of ~90,000 neurons/mm<sup>3</sup> for excitatory cells in mouse visual cortex (<xref ref-type="bibr" rid="bib12">Erö et al., 2018</xref>).</p><p>If the ephys dataset is biased toward recording neurons with higher firing rates, it may be more appropriate to compare it with only the most active neurons in the imaging dataset. To test this, we systematically <italic>increased</italic> the event rate threshold for the imaged neurons, so the remaining neurons used for comparison were always in the upper quantile of mean event rate. Applying this filter increased the overall fraction of responsive neurons in the imaging dataset, such that the experimental imaging and synthetic imaging distributions had the highest similarity when between 7 and 39% of the most active imaged neurons were included (V1: 39%, LM: 34%, AL: 25%, PM: 7%, AM: 14%) (<xref ref-type="fig" rid="fig6">Figure 6A</xref>). This indicates that more active neurons tend to be more responsive to our visual stimuli, which could conceivably account for the discrepancy in overall responsiveness between the two modalities. However, applying this event rate threshold actually increased the differences between the selectivity distributions, as the most active imaged neurons were also more selective (<xref ref-type="fig" rid="fig6">Figure 6B</xref>). Thus, sub-selection of imaged neurons based on event rate was not sufficient to fully reconcile the differences between ephys and imaging. Performing the same analysis using sub-selection based on the coefficient of variation, an alternative measure of response reliability, yielded qualitatively similar results (<xref ref-type="fig" rid="fig6s1">Figure 6—figure supplement 1</xref>).</p><fig-group><fig id="fig6" position="float"><label>Figure 6.</label><caption><title>Sub-sampling based on event rate or ISI violations.</title><p>(<bold>A</bold>) <italic>Top:</italic> Change in fraction of neurons responding to drifting gratings for each area in the imaging dataset, as function of the percent of imaged neurons included in the comparison. <italic>Middle:</italic> Jensen–Shannon distance between the synthetic imaging and true imaging response reliability distributions. <italic>Bottom:</italic> Overall event rate distribution in the imaging dataset. As the percentage of included neurons decreases (from left to right), more and more neurons with low activity rates are excluded. (<bold>B</bold>) Same as A, but for drifting gratings lifetime sparseness (selectivity) metrics. (<bold>C</bold>) Top: Change in fraction of neurons responding to the drifting gratings stimulus for each area in the ephys dataset, as function of the percent of ephys neurons included in the comparison. Middle: Jensen–Shannon distance between the synthetic imaging and true imaging response reliability distributions. Bottom: Overall ISI violations score distribution in the ephys dataset. As the percent of included neurons decreases (from right to left), more and more neurons with high contamination levels are excluded. Yellow shaded area indicates the region where the minimum measurable contamination level (ISI violations score = 0) is reached. (<bold>D</bold>) Same as C, but for drifting gratings lifetime sparseness (selectivity) metrics.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-69068-fig6-v1.tif"/></fig><fig id="fig6s1" position="float" specific-use="child-fig"><label>Figure 6—figure supplement 1.</label><caption><title>An alternative metric of response robustness.</title><p>(<bold>A</bold>) Relationship between response reliability (fraction of preferred-condition trials with responses larger than 95% of baseline intervals) and coefficient of variation (ratio between standard deviation and mean of responses for preferred condition trials), for three different stimulus types. (<bold>B</bold>) Mean and standard deviation of the preferred condition response, for all neurons in the imaging dataset. Response reliability is indicated by color. (<bold>C</bold>) Same as <xref ref-type="fig" rid="fig6">Figure 6A</xref>, but with imaged neurons filtered by coefficient of variation, rather than by event rate. (<bold>D</bold>) Same as <xref ref-type="fig" rid="fig6">Figure 6B</xref>, but with imaged neurons filtered by coefficient of variation, rather than event rate.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-69068-fig6-figsupp1-v1.tif"/></fig></fig-group><p>If the ephys dataset includes spike trains that are contaminated with spurious spikes from one or more nearby neurons then it may help to compare our imaging results only to the least contaminated neurons from the ephys dataset. Our initial QC process excluded units with an inter-spike interval (ISI) violations score (<xref ref-type="bibr" rid="bib22">Hill et al., 2011</xref>, see Materials and methods for definition) above 0.5, to remove highly contaminated units, but while the presence of refractory period violations implies contamination, the absence of such violations does not imply error-free clustering, so some contamination may remain. We systematically <italic>decreased</italic> our tolerance for ISI-violating ephys neurons, so the remaining neurons used for comparison were always in the lower quantile of contamination level. For the most restrictive thresholds, where there was zero detectable contamination in the original spike trains (ISI violations score = 0), the match between the synthetic imaging and experimental imaging selectivity and responsiveness distributions was maximized (<xref ref-type="fig" rid="fig6">Figure 6C,D</xref>). This indicates that, unsurprisingly, contamination by neighboring neurons (as measured by ISI violations score) reduces selectivity and increases responsiveness. Therefore, the inferred functional properties are most congruent across modalities when the ephys analysis includes a stringent threshold on the maximum allowable contamination level.</p></sec><sec id="s2-8"><title>Results across stimulus types</title><p>The previous results have primarily focused on the drifting gratings stimulus, but we observe similar effects for all of the stimulus types shared between the imaging and ephys datasets. <xref ref-type="fig" rid="fig7">Figure 7</xref> summarizes the impact of each transformation we performed, either before or after applying the forward model, for drifting gratings, static gratings, natural scenes, and natural movies.</p><fig id="fig7" position="float"><label>Figure 7.</label><caption><title>Summary of results for all stimulus types.</title><p>(<bold>A</bold>) Jensen–Shannon distance between the ephys and imaging distributions for three metrics and four stimulus classes. Individual dots represent visual areas, and horizontal lines represent the mean across areas. Each column represents a different post-processing step, with comparison performed on either the original ephys data (gray), or the synthetic fluorescence data obtained by passing experimental ephys data through a spikes-to-calcium forward model (yellow). (<bold>B</bold>) Full distributions of lifetime sparseness in response to static gratings for experimental imaging (green) and synthetic imaging (yellow). (<bold>C</bold>) same as B, but for natural scenes. (<bold>D</bold>), same as B and C, but for natural movies. The distribution for drifting gratings is shown in <xref ref-type="fig" rid="fig5">Figure 5I</xref>.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-69068-fig7-v1.tif"/></fig><p>Across all stimulus types, the forward model had very little impact on responsiveness. Instead, sub-selecting the most active neurons from our imaging experiments using an event-rate filter rendered the shape of the distributions the most similar. For the stimulus types for which we could measure preference across small number of categories (temporal frequency of drifting gratings and spatial frequency of static gratings), no data transformations were able to improve the overall match between the ephys and imaging distributions, as they were already very similar in the baseline comparison. For selectivity metrics (lifetime sparseness), applying the forward model played the biggest role in improving cross-modal similarity, although there was a greater discrepancy between the resulting distributions for static gratings, natural scenes, and natural movies than there was for drifting gratings. Filtering ephys neurons based on ISI violations further reduced the Jensen–Shannon distance, but it still remained well above zero. This indicates that the transformations we employed could not fully reconcile observed differences in selectivity distributions between ephys and imaging.</p></sec><sec id="s2-9"><title>Lessons for future comparisons</title><p>Our study shows that population-level functional metrics computed from imaging and electrophysiology experiments can display systematic biases. What are the most important takeaways that should be considered for those performing similar comparisons?</p></sec><sec id="s2-10"><title>Preference metrics are similar across modalities</title><p>At least for the cell population we considered (putative excitatory neurons from all layers of visual cortex), preference metrics (such as preferred temporal frequency, preferred spatial frequency, and preferred direction) were largely similar between imaging and electrophysiology (<xref ref-type="fig" rid="fig2">Figure 2F</xref>, <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1A–C</xref>). Because these are categorical metrics defined as the individual condition (out of a finite set) that evokes the strongest mean response, they are robust to the choice of calcium event extraction method and also remain largely invariant to the application of a spikes-to-calcium forward model to electrophysiology data. One caveat to keep in mind is that when imaging from more specific populations (e.g. using a transgenic line that limits imaging to a specific subtype of neuron in a specific layer), electrophysiology experiments may yield conflicting preference metrics unless the sample is carefully matched across modalities (e.g. by genetically tagging electrically recorded neurons with a light-sensitive opsin).</p></sec><sec id="s2-11"><title>Differences in responsiveness metrics largely stem from ephys selection bias</title><p>In our original comparison, a larger fraction of ephys units were found to be responsive to every stimulus type (<xref ref-type="fig" rid="fig2">Figure 2E</xref>); this did not change after applying a spikes-to-calcium forward model (<xref ref-type="fig" rid="fig5">Figure 5D,E</xref>). We believe this is primarily due to two factors:</p><list list-type="order"><list-item><p>Extracellular electrophysiology cannot detect neurons if they fire few or no action potentials within the sampling period. Unresponsive neurons with low backround firing rates fall into this category, and are therefore not counted in the ‘yield’ of an ephys experiment.</p></list-item><list-item><p>Most or all ephys ‘units’ include some fraction of contaminating spikes from nearby neurons with similar waveform shapes. Contamination is more likely to occur during periods of high waveform variability, for example during burst-dependent spike amplitude adaptation. Because bursts are prevalent when a neuron responds to a stimulus, stimulus-evoked spikes are the ones that are most likely to contaminate the spike train of an unresponsive cell.</p></list-item></list><p>How should these biases be accounted for? Most importantly, when comparing responsiveness, or analyses that build on responsiveness, between ephys and imaging experiments, only the cleanest, least contaminated ephys units should be included (based on their ISI violations or another purity metric). In addition, one can reduce differences in responsiveness by filtering out the least active neurons from imaging experiments, or simply by using a higher responsiveness threshold for ephys than for imaging. For example, one could use a sliding threshold to find the point where the overall rate of responsive neurons is matched between the two modalities, and perform subsequent comparisons using this threshold. It should also be noted that the method of calcium event detection can also affect responsiveness metrics; with a more permissive event detection threshold, for instance, the population appears more responsive (<xref ref-type="fig" rid="fig3">Figure 3G</xref>). However, it is clear that a lower threshold leads to a higher fraction of false-positive events, as is shown using ground truth data (<xref ref-type="fig" rid="fig3">Figure 3D</xref>), and this increases the probability that noise in the underlying fluorescence will contaminate the results. As background fluorescnece is most variable when nearby neurons or processes respond to their respective preferred stimulus condition, additionally detected events are likely to be an overfitting of stimulus-correlated noise .</p></sec><sec id="s2-12"><title>Selectivity metrics are highly sensitive to the parameters used for calcium event extraction</title><p>Differences in selectivity (or tuning curve sharpness) are the most difficult to compare across modalities. This is because most commonly used selectivity metrics take into account the ratio between the peak and baseline response, and the relative size of these responses is highly influenced by the rate and size of ‘background’ events. When counting spikes in electrophysiology, the largest and smallest responses typically fall within the same order of magnitude; with imaging, however, calcium event amplitudes can easily vary over several orders of magnitude. In addition, the specific method used for calcium event detection can have a big impact on background event rate. Because these events always have a positive amplitude, events detected around the noise floor cannot be cancelled out by equivalently sized negative events. In principle, one could try to match selectivity across modalities by tuning the parameters of the event extraction algorithm. However, this is not recommended, because it obfuscates real biases in the data (such as the sparsifying effect of calcium indicators) and can lead to inconsistencies (e.g. it fails to consistently match both selectivity and responsiveness across stimulus classes). Instead, as a more principled way to compare selectivity between imaging and ephys experiments, we recommend the use of a spikes-to-calcium forward model, with the same event extraction algorithm applied to both the real and the synthetic calcium traces (<xref ref-type="fig" rid="fig5">Figure 5I</xref>, <xref ref-type="fig" rid="fig7">Figure 7B–D</xref>).</p></sec><sec id="s2-13"><title>Inter-modal differences in running speed, laminar sampling patterns, and transgenic mouse lines do not substantially bias functional metrics</title><p>Our ephys recordings included a higher fraction of neurons from layer 5 than our imaging experiments (<xref ref-type="fig" rid="fig1">Figure 1F</xref>), while mice from imaging experiments were less active runners (<xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3A</xref>). Furthermore, typical ephys experiments do not use transgenic mice that express calcium indicators, while this is common for imaging. Correcting these biases did not appreciably change the population-level functional metrics. However, it must be noted that we used nearly identical behavioral apparatuses, habituation protocols, and stimulus sets between modalities. When comparing across studies with methods that were not as carefully matched, behavioral differences may have a larger influence on the results.</p></sec><sec id="s2-14"><title>Interpreting higher order analyses in light of our findings</title><p>The differences in responsiveness and selectivity metrics computed from the ephys and imaging datasets suggest that functional properties of neurons in the mouse visual cortex can appear to be dependent on the choice of recording modality. These effects extend beyond responsiveness and selectivity, as higher order analyses often build on these more fundamental metrics. Here, we focus on a representative example, a functional classification scheme based on responses to four stimulus types (drifting gratings, static gratings, natural scenes, and natural movies), which, in our previous work, revealed distinct response classes in the imaging dataset (<xref ref-type="bibr" rid="bib7">de Vries et al., 2020</xref>). We aim to illustrate, using this recent example, that the effect of recording modality on responsiveness goes far beyond merely impacting how many neurons might be included in an analysis but may also propagate to conclusions we draw about the functional properties of neuronal (sub)populations. Our original study, based on imaging data alone, revealed that only ~10% of the neurons in the imaging dataset responded reliably to all four stimuli, while the largest class of neurons contained those that did not respond reliably to any of the stimuli. This classification result suggested that many neurons in the mouse visual cortex are not well described by classical models and may respond to more intricate visual or non-visual features. Here, we perform an analogous analysis on the ephys dataset to show how this classification is impacted by modality specific biases.</p><p>As in our original study, we performed unsupervised clustering on the 4 x <italic>N</italic> matrix of response reliabilities for each unit’s preferred condition for each stimulus class, where <italic>N</italic> represents the number of units (<xref ref-type="fig" rid="fig8">Figure 8A</xref>). The resulting clusters were assigned class labels based on whether their mean response reliability was above an initial threshold of 25% (to match the percentage we used in our previous analysis of the imaging dataset). After labeling each cluster, we calculated the fraction of units belonging to each functional class. We averaged over 100 different clustering initializations to obtain the average class membership of units across runs (<xref ref-type="fig" rid="fig8">Figure 8B</xref>).</p><fig id="fig8" position="float"><label>Figure 8.</label><caption><title>Identifying functional classes based on response reliability.</title><p>(<bold>A</bold>) Example clustering run for all neurons in the ephys dataset. First, unsupervised clustering is performed on the matrix of response reliabilities to four stimulus types. Colors on the t-SNE plot (used for visualization purposes only) represent different cluster labels, with one cluster highlighted in brown. Next, the neurons in each cluster are used to compute the mean reliability for each stimulus type. The mean reliabilities for all 27 clusters are shown in the heatmap, with the 25% responsiveness threshold indicated by the transition from blue to red. Each cluster is assigned to a class based on the stimulus types for which its mean reliability is above threshold. (<bold>B</bold>) Strip plots representing the fraction of neurons belonging to each class, averaged over 100 repeats of the Gaussian mixture model for ephys (<italic>N</italic> = 11,030 neurons), at a 25% threshold level. (<bold>C</bold>) Jensen–Shannon distance between the ephys and imaging class membership distributions, as a function of the ephys responsiveness threshold. The points plotted in panels B and E are circled. Heat maps show the mean reliabilities relative to threshold for all 27 clusters shown in panel A. (<bold>D</bold>) Strip plots representing the fraction of neurons belonging to each class, averaged over 100 repeats of the Gaussian mixture model for imaging (<italic>N</italic> = 20,611 neurons), at a 25% threshold level. (<bold>E</bold>) Same as B, but for the 40% threshold level that minimizes the difference between the imaging and ephys distributions.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-69068-fig8-v1.tif"/></fig><p>Running this analysis on the ephys dataset ‘naively’, seemed to reveal a very different landscape of functional classes. In stark contrast to the published imaging results, for ephys, the largest class (~40% of the units) contained units that responded reliably to all four classes of stimuli, while the class that did not respond reliably to any of the stimuli was empty. This is consistent with the observation that responsiveness is higher in the ephys dataset for each stimulus type (<xref ref-type="fig" rid="fig2">Figure 2F</xref>). To account for this bias, we systematically raised the responsiveness threshold used to group clusters into functional classes for the ephys dataset and found that the distribution of classes became more similar to the distribution of classes for the imaging dataset (<xref ref-type="fig" rid="fig8">Figure 8C</xref>). A threshold of 40% response reliability for the ephys dataset minimized the Jensen–Shannon distance between the distributions, rendering the class assignments in ephys remarkably similar to those for the imaging dataset (<xref ref-type="fig" rid="fig8">Figure 8E</xref>). The class labels for each neuron reflect the pattern of cross-stimulus response reliability, and as such provide an indication of its ‘meta-preference’ for different stimulus types. Thus, once we account for the generally higher levels of responsiveness seen in the ephys dataset, we observe similar meta-preferences and thus functional organization as for the imaging dataset. This example highlights how recording-modality-specific biases can affect higher-order conclusions about functional properties, and how a fundamental understanding of such biases can be leveraged to explain and resolve apparent contradictions.</p></sec></sec><sec id="s3" sec-type="discussion"><title>Discussion</title><p>In this study, we have compared response metrics derived from mouse visual cortex excitatory populations collected under highly standardized conditions, but using two different recording modalities. Overall, we observe similar stimulus preferences across the two datasets (e.g. preferred temporal frequencies within each visual area), but we see systematic differences in responsiveness and selectivity. Prior to any attempt at reconciliation, electrophysiological recordings showed a higher fraction of units with stimulus-driven activity, while calcium imaging showed higher selectivity (sharper tuning) among responsive neurons.</p><p>Our comparison of 2P event detection methods showed that the rate of small-amplitude events can influence inferred functional metrics. While the prevalence of false positives in ground truth data has been analyzed previously (<xref ref-type="bibr" rid="bib69">Theis et al., 2016</xref>; <xref ref-type="bibr" rid="bib55">Rupprecht et al., 2021</xref>), this metric is not typically used to optimize event detection parameters. Instead, correlation with ground truth rate is preferred (<xref ref-type="bibr" rid="bib1">Berens et al., 2018</xref>; <xref ref-type="bibr" rid="bib46">Pachitariu et al., 2018</xref>). However, this measure does not account for changes in background rate associated with the prevalence of small-amplitude events. These events always have a positive magnitude, are often triggered by noise, and can dramatically affect measured selectivity levels. In fact, most neurons have selectivity levels near zero when all events detected by non-negative deconvolution are included in the analysis (<xref ref-type="fig" rid="fig3">Figure 3F</xref>). Measured responsiveness, on the other hand, was highest when all events were included (<xref ref-type="fig" rid="fig3">Figure 3G</xref>). While this could indicate a greater sensitivity to true underlying spikes, it could also result from contamination by fluctuations in background fluorescence during the visual stimulation interval. Because of confounds such as these, we found it more informative to carry out our comparison on ephys data that has been transformed by the forward model and processed using the same event extraction method as the experimental imaging data.</p><p>Notably, the forward model boosted selectivity of the ephys data due to the sparsifying effect of calcium dynamics and the exact <italic>ℓ</italic><sub>0</sub> event extraction step. As large, burst-dependent calcium transients can have amplitudes several orders of magnitude above the median amplitude (<xref ref-type="fig" rid="fig2">Figure 2B</xref>), this causes the response to the preferred stimulus condition to be weighted more heavily in selectivity calculations than non-preferred conditions. Similarly, isolated spikes during non-preferred conditions can be virtually indistinguishable from noise when viewed through the lens of the forward model. When the same trials are viewed through the lens of electrophysiology, however, spike counts increase more or less linearly, leading to the appearance of lower selectivity.</p><p>Unexpectedly, the forward model did not change responsiveness metrics. We initially hypothesized that the lower responsiveness in the imaging dataset was due to the fact that single-spike events are often not translated into detectable calcium transients; in ground truth recordings, around 75% of 100 ms bins with actual spikes do not result in any events detected by the exact <italic>ℓ</italic><sub>0</sub> method with the default sparsity constraint (<xref ref-type="bibr" rid="bib24">Huang et al., 2021</xref>). Instead, our observation of unchanged responsiveness following the forward model suggests that differences between modalities are more likely due to electrophysiological sampling bias—that is extracellular recordings missing small or low-firing rate neurons, or merging spike trains from nearby cells. In order to reconcile some of these differences, we could either apply a very strict threshold on ISI violations score to the ephys dataset, or remove between 61 and 93% of the least active neurons from the imaging dataset (<xref ref-type="fig" rid="fig6">Figure 6</xref>). This should serve as a cautionary tale for anyone estimating the fraction of neurons in an area that appear to increase their firing rate in response to environmental or behavioral events. Without careful controls, contamination from other neurons in the vicinity can make this fraction appear artificially high. While it may be possible to minimize these impurities with improved spike-sorting algorithms, there will always be neurons that even the best algorithms will not be able to distinguish in the face of background noise.</p><p>Differences in laminar sampling and running behavior between the two modalities had almost no effect in our comparisons. The transgenic expression of GCaMP6f in specific neural populations also did not impact the distributions of functional metrics. Finally, the initial parameters chosen for the forward model produced metric distributions that were close to the optimum match over the realistic parameter space. Therefore, we conclude that the primary contribution to differences in the considered ephys and imaging metrics comes from (1) the intrinsic nature of the spikes-to-calcium transfer function (2) the selection bias of extracellular electrophysiology recordings.</p><p>Even after accounting for these known factors to the best of our ability, the overall population from our imaging experiments still displayed higher selectivity than its ephys counterpart (<xref ref-type="fig" rid="fig5">Figure 5I</xref>, <xref ref-type="fig" rid="fig8">Figure 8B–D</xref>). What could account for these remaining differences? One possibility is that there may be residual undetected contamination in our ephys recordings. An ISI violations score of 0 does not guarantee that there is no contamination, just that we are not able to measure it using this metric. Sampling the tissue more densely (i.e. increasing the spatial resolution of spike waveforms) or improving spike sorting methods could reduce this issue. Another possibility is that ‘missed’ spikes—especially those at the end of a burst—could result in reduced amplitudes for the simulated calcium transients. In addition, if the in vivo spikes-to-calcium transfer function is non-stationary, there could be stimulus-dependent changes in calcium concentration that are not captured by a forward model that takes a spike train as its only input. Simultaneous cell-attached electrophysiology and two-photon imaging experiments have demonstrated the existence of ‘prolonged depolarization events’ (PDEs) in some neurons that result in very large increases in calcium concentration, but that are indistinguishable from similar burst events in extracellular recordings (<xref ref-type="bibr" rid="bib32">Ledochowitsch et al., 2019</xref>).</p><p>One potential limitation of our approach is that we have only imaged the activity of transgenically expressed calcium indicators, rather than indicators expressed using a viral approach. In addition, the vast majority of our imaging data comes from mice expressing GCaMP6f, with only a small number of GCaMP6s neurons recorded. While we would ideally want to perform the same experiments with viral expression and GCaMP6s, this would require an expensive multi-year effort of similar magnitude to the one that produced our existing imaging dataset. Instead, we have chosen to simulate the effects of these alternative conditions. In our analysis of the forward model parameter sweep, functional metrics remain relatively constant for a wide range of amplitude and decay time parameters (<xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1</xref>). The full range of this sweep includes decay times that are consistent with GCaMP6s, and event amplitudes that are consistent with viral expression.</p><p>The forward models currently available in the literature (<xref ref-type="bibr" rid="bib8">Deneux et al., 2016</xref>; <xref ref-type="bibr" rid="bib76">Wei et al., 2019</xref>) are of comparable power, in that their most complex instantiations allow for non-instantaneous fluorescence rise as well as for a non-linear relationship between calcium concentration and fluorescence. To the best of our knowledge, none of these forward models explicitly model nonstationarities in the spike-to-calcium transfer function. Moreover, all currently available models suffer from the drawback that fits to simultaneously recorded ground truth data yield significant variance in model parameters across neurons (<xref ref-type="bibr" rid="bib32">Ledochowitsch et al., 2019</xref>; <xref ref-type="bibr" rid="bib76">Wei et al., 2019</xref>). We strove to mitigate this shortcoming by showing that brute-force exploration of MLSpike model parameter space could not significantly improve the match between real and synthetic imaging data.</p><p>Another potential confound is elevated activity around an implanted probe, which was characterized in a recent study (<xref ref-type="bibr" rid="bib11">Eles et al., 2018</xref>). By performing calcium imaging around a silicon probe that was recently introduced into the brain, the authors found increased intracellular calcium lasting for at least 30 min after implantation. If this is true in our Neuropixels recordings, it could at least partially account for the higher overall firing rates and responsiveness in electrophysiology compared to imaging. Careful simultaneous measurements will be required in order to account for this relative activity increase.</p><p>While results obtained from ephys and imaging are sometimes treated as if they were interchangeable from a scientific standpoint, in actuality they each provide related but fundamentally different perspectives on the underlying neural activity. Extracellular electrophysiology tells us—with sub-millisecond temporal resolution—about a neuron’s spiking output. Calcium imaging doesn't measure the outgoing action potentials directly, but rather the impact of input and output signals on a neuron’s internal state, in terms of increases in calcium concentration that drive various downstream pathways (<xref ref-type="bibr" rid="bib79">West et al., 2001</xref>). While voltage-dependent fluorescent indicators may offer the best of both worlds, there are substantial technical hurdles to employing them on comparably large scales (<xref ref-type="bibr" rid="bib51">Peterka et al., 2011</xref>). Thus, in order to correctly interpret existing and forthcoming datasets, we must account for the inherent biases of these two recording modalities.</p><p>A recent study comparing matched populations recorded with electrophysiology or imaging emphasized differences in the temporal profiles of spike trains and calcium-dependent fluorescence responses (<xref ref-type="bibr" rid="bib76">Wei et al., 2019</xref>). The authors found that event-extraction algorithms that convert continuous ΔF/F traces to putative spike times could not recapitulate the temporal profiles measured with electrophysiology; on the other hand, a forward model that transformed spike times to synthetic ΔF/F traces could make their electrophysiology results appear more like those from the imaging experiments. Their conclusions were primarily based on metrics derived from the evolution of firing rates or ΔF/F ratios over the course of a behavioral trial. However, there are other types of functional metrics that are not explicitly dependent on temporal factors, such as responsiveness, which cannot be reconciled using a forward model alone.</p><p>It is worth emphasizing that we are not suggesting that researchers use the methods we describe here to attempt to make all of their imaging data more similar to electrophysiological data, or vice versa. Since no one single method is intrinsically superior to the other, doing so would merely introduce additional biases. Instead, we recommend that readers examine how sensitive their chosen functional metrics, and, by extension, their derived scientific conclusions are to (1) signal contamination during spike detection and sorting (for electrophysiology data), (2) application of a spike-to-calcium forward model (for electrophysiology data), (3) filtering by event rate (for imaging data), and (4) false positives introduced during event detection (for imaging data). If the chosen functional metrics are found to be largely insensitive to the above transformations, then results can be compared directly across studies that employ different recording modalities. Otherwise, the sensitivity analysis can be used as a means of establishing bounds on the magnitude and direction of expected modality-related discrepancies.</p><p>More work is needed to understand the detailed physiological underpinning of the modality-specific differences we have observed. One approach, currently underway at the Allen Institute and elsewhere, is to carry out recordings with extremely high-density silicon probes (Neuropixels Ultra), over 10x denser (in terms of the number of electrodes per unit of area) than the Neuropixels 1.0 probes used in this study. Such probes can capture each spike waveform with 100 or more electrodes, making it easier to disambiguate waveforms from nearby neurons, and making it less likely that neurons with small somata would evade detection or that their waveforms would be mistaken for those of other units. These experiments should make it easier to quantify the selection bias of extracellular electrophysiology, as well as the degree to which missed neurons and contaminated spike trains have influenced the results of the current study. In addition, experiments in which silicon probes are combined with two-photon imaging—either through interleaved sampling, spike-triggered image acquisition, or improved artifact removal techniques—could provide more direct ground-truth information about the relationship between extracellular electrophysiology and calcium imaging.</p><p>Overall, our comparison highlights the value of large-scale, standardized datasets. The fact that functional metrics are sensitive not only to experimental procedures but also to data processing steps and cell inclusion criteria (<xref ref-type="bibr" rid="bib39">Mesa et al., 2021</xref>), makes it difficult to directly compare results across studies. Having access to ephys and imaging datasets collected under largely identical conditions allowed us to rule out a number of potential confounds, such as laminar sampling bias and inter-modality behavioral differences. And due to the technical difficulties of scaling simultaneous ephys/imaging experiments, these will, for the foreseeable future, continue to complement and validate large-scale unimodal datasets, rather than replace them.</p><p>Ultimately, the goal of this work is not to establish the superiority of any one recording modality in absolute terms, since their complementary strengths ensure they will each remain essential to scientific progress for many years to come. Instead, we want to establish guidelines for properly interpreting the massive amounts of data that have been or will be collected using either modality. From this study, we have learned that extracellular electrophysiology likely overestimates the fraction of neurons that elevate their activity in response to visual stimuli, in a manner that is consistent with the effects of selection bias and contamination. The apparent differences in selectivity underscore the fact that one must carefully consider the impact of data processing steps (such as event extraction from fluorescence time series), as well as what each modality is actually measuring. Selectivity metrics based on spike counts (the neuron’s outputs) will almost always be lower than selectivity metrics based on calcium concentrations (the neuron’s internal state). Even with this in mind, however, we cannot fully reproduce the observed levels of calcium-dependent selectivity using spike times alone—suggesting that a neuron’s internal state may contain stimulus-specific information that is not necessarily reflected in its outputs.</p><p>In summary, we have shown that reconciling results across modalities is not straightforward, due to biases that are introduced at the level of the data processing steps, the spatial characteristics of the recording hardware, and the physical signals being measured. We have attempted to account for these biases by (1) altering 2P event detection parameters, (2) applying sub-selection to account for built-in spatial biases, and (3) simulating calcium signals via a forward model. We have shown that functional metrics are sensitive to all of these biases, which makes it difficult to determine which ones are most impactful. For example, to what degree does the bias of ephys for higher-firing-rate units stem from the recording hardware versus the spike sorting procedure? It is possible that more spatially precise sampling, or modifications to the spike sorting algorithm, will reduce this bias in the future. Similarly, how much of the 2P imaging bias stems from the calcium indicator versus the event extraction algorithm? New indicators (such as GCaMP8) may ameliorate some of these problems, as could further optimization of the event extraction step. In the end, these two modalities provide two imperfect yet complementary lenses on the underlying neural activity, and their respective strengths and limitations must be understood when interpreting the recorded activities across experiments.</p></sec><sec id="s4" sec-type="materials|methods"><title>Materials and methods</title><sec id="s4-1"><title>Previously released data</title><p>We used two-photon calcium imaging recordings from the Allen Brain Observatory Visual Coding dataset (<xref ref-type="bibr" rid="bib7">de Vries et al., 2020</xref>; 2016 Allen Institute for Brain Science, available from <ext-link ext-link-type="uri" xlink:href="https://observatory.brain-map.org/visualcoding/">observatory.</ext-link><ext-link ext-link-type="uri" xlink:href="https://portal.brain-map.org/">brain-map.org</ext-link>). This dataset consists of calcium fluorescence time series from 63,521 neurons in six different cortical areas across 14 different transgenic lines. Neurons were imaged for three separate sessions (A, B, and C), each of which used a different visual stimulus set (<xref ref-type="fig" rid="fig1">Figure 1E</xref>). Our analysis was limited to neurons in five areas (V1, LM, AL, PM, and AM) and 10 lines expressing GCaMP6f in excitatory neurons, and which were present in either session A, session B, or both (total of 41,578 neurons).</p><p>We used extracellular electrophysiological recordings from the Allen Brain Observatory Neuropixels dataset (<xref ref-type="bibr" rid="bib61">Siegle et al., 2021</xref>; 2019 Allen Institute for Brain Science, available from <ext-link ext-link-type="uri" xlink:href="http://portal.brain-map.org/explore/circuits/visual-coding-neuropixels">portal.brain-map.org/explore/circuits/visual-coding-neuropixels</ext-link>). This dataset consists of spike trains from 99,180 ‘units’ (putative neurons with varying degrees of completeness and contamination) from 58 mice in a variety of cortical and subcortical structures. We limited our analysis to 31 sessions that used the ‘Brain Observatory 1.1’ stimulus set (<xref ref-type="fig" rid="fig1">Figure 1E</xref>) and units (hereafter, ‘neurons’) from five visual cortical areas (V1, LM, AL, PM, and AM) that displayed ‘regular spiking’ action potential waveforms (peak-to-trough interval &gt; 0.4 ms). Only neurons that passed the following quality control thresholds were included: presence ratio &gt; 0.9 (fraction of the recording session during which spikes are detected), amplitude cutoff &lt; 0.1 (estimate of the fraction of missed spikes), and ISI violations score &lt; 0.5 (<xref ref-type="bibr" rid="bib22">Hill et al., 2011</xref>) (estimate of the relative rate of contaminating spikes). After these filtering steps, there were 5917 neurons for analysis.</p></sec><sec id="s4-2"><title>Neuropixels recordings in GCaMP6f mice</title><p>We collected a novel electrophysiology dataset from transgenic mice expressing GCaMP6f, as well as additional wild-type mice. Experiments were conducted in accordance with PHS Policy on Humane Care and Use of Laboratory Animals and approved by the Allen Institute’s Institutional Animal Care and Use Committee under protocols 1409 (‘A scalable data generation pipeline for creation of a mouse Cortical Activity Map’), 1706 (‘Brain Observatory: Optical Physiology’), and 1805 (‘Protocol for in vivo electrophysiology of mouse brain’). The procedures closely followed those described in <xref ref-type="bibr" rid="bib61">Siegle et al., 2021</xref> and are summarized below.</p><p>Mice were maintained in the Allen Institute animal facility and used in accordance with protocols approved by the Allen Institute’s Institutional Animal Care and Use Committee. Five genotypes were used: wild-type C57BL/6J mice purchased from Jackson Laboratories (<italic>n</italic> = 2) or Vip-IRES-Cre;Ai148 (<italic>n</italic> = 3), Sst-IRES-Cre;Ai148 (<italic>n</italic> = 6), Slc17a7-IRES2-Cre;Camk2a-tTA;Ai93 (<italic>n</italic> = 3), and Cux2-CreERT2;Camk2a-tTA;Ai93 (<italic>n</italic> = 3) mice bred in-house. Following surgery, mice were single-housed and maintained on a reverse 12 hr light cycle. All experiments were performed during the dark cycle.</p><p>At around age P80, mice were implanted with a titanium headframe. In the same procedure, a 5 mm diameter piece of skull was removed over visual cortex, followed by a durotomy. The skull was replaced with a circular glass coverslip coated with a layer of silicone to reduce adhesion to the brain surface.</p><p>On the day of recording (at least four weeks after the initial surgery), the glass coverslip was removed and replaced with a plastic insertion window containing holes aligned to six cortical visual areas, identified via intrinsic signal imaging (<xref ref-type="bibr" rid="bib16">Garrett et al., 2014</xref>). An agarose mixture was injected underneath the window and allowed to solidify. This mixture was optimized to be firm enough to stabilize the brain with minimal probe drift, but pliable enough to allow the probes to pass through without bending. At the end of this procedure, mice were returned to their home cages for 1–2 hr prior to the recording session.</p><p>All recordings were carried out in head-fixed mice using Neuropixels 1.0 probes (<xref ref-type="bibr" rid="bib29">Jun et al., 2017</xref>; available from <ext-link ext-link-type="uri" xlink:href="http://europixels.org/">neuropixels.org</ext-link>) mounted on 3-axis stages from New Scale Technologies (Victor, NY). These probes have 383 recording sites oriented in a checkerboard pattern on a 70 μm wide x 10 mm long shank, with 20 µm vertical spacing. Data streams from each electrode were acquired at 30 kHz (spike band) and 2.5 kHz (LFP band) using the Open Ephys GUI (<xref ref-type="bibr" rid="bib60">Siegle et al., 2017</xref>). Gain settings of 500x and 250x were used for the spike band and LFP band, respectively. Recordings were referenced to a large, low-impedance electrode at the tip of each probe.</p><p>Pre-processing, spike sorting, and quality control methods were identical to those used for the previously released dataset (code available at <ext-link ext-link-type="uri" xlink:href="https://github.com/alleninstitute/ecephys_spike_sorting">https://github.com/alleninstitute/ecephys_spike_sorting</ext-link> (copy archived at <xref ref-type="bibr" rid="bib62">Siegle, 2021</xref>; <ext-link ext-link-type="uri" xlink:href="https://archive.softwareheritage.org/swh:1:dir:0a622ac41d878c751d74ba9deccc37691b7380a0;origin=https://github.com/AllenInstitute/ecephys_spike_sorting;visit=swh:1:snp:dd5be4e7aeea9666292804748f8ed8b6c3537c8d;anchor=swh:1:rev:995842e4ec67e9db1b7869d885b97317012337db">swh:1:rev:995842e4ec67e9db1b7869d885b97317012337db</ext-link>) and <ext-link ext-link-type="uri" xlink:href="https://github.com/MouseLand/Kilosort">https://github.com/MouseLand/Kilosort</ext-link> (copy archived at <xref ref-type="bibr" rid="bib47">Pachitariu, 2021</xref> ; <ext-link ext-link-type="uri" xlink:href="https://archive.softwareheritage.org/swh:1:dir:f24b1f096a0f44b907337a5db613116e58f9ea47;origin=https://github.com/MouseLand/Kilosort;visit=swh:1:snp:a45f1825481650ddb3f287b8afeb71886738d762;anchor=swh:1:rev:db3a3353d9a374ea2f71674bbe443be21986c82c">swh:1:rev:db3a3353d9a374ea2f71674bbe443be21986c82c</ext-link>)). Filtering by brain region (V1, LM, AL, PM, and AM), waveform width (&gt;0.4 ms), and QC metrics (presence ratio &gt; 0.9, amplitude cutoff &lt; 0.1, ISI violations score &lt; 0.5) yielded 5113 neurons for analysis. For all analyses except for those in <xref ref-type="fig" rid="fig3">Figure 3</xref>, neurons from this novel dataset were grouped with those from the previously released dataset, for a total of 11,030 neurons.</p><p>Neurons were registered to 3D brain volumes obtained with an open-source optical projection tomography system (<ext-link ext-link-type="uri" xlink:href="https://github.com/alleninstitute/AIBSOPT">https://github.com/alleninstitute/AIBSOPT</ext-link>, copy archived at <xref ref-type="bibr" rid="bib40">Nicovich, 2021</xref>; <ext-link ext-link-type="uri" xlink:href="https://archive.softwareheritage.org/swh:1:dir:8954e35a23b97f4ce14f9028e50f4bc5f073e44e;origin=https://github.com/AllenInstitute/AIBSOPT;visit=swh:1:snp:6b3d8870456826b0097613e88c8a513d46e6de1d;anchor=swh:1:rev:e38af7e25651fe7517dcf7ca3d38676e3c9c211e">swh:1:rev:e38af7e25651fe7517dcf7ca3d38676e3c9c211e</ext-link>). Brains were first cleared using a variant of the iDISCO method (<xref ref-type="bibr" rid="bib53">Renier et al., 2014</xref>), then imaged with white light (for internal structure) or green light (to visualize probe tracks labeled with fluorescent dye). Reconstructed volumes were mapped to the Mouse Common Coordinate Framework (CCFv3) (<xref ref-type="bibr" rid="bib75">Wang et al., 2020</xref>) by matching key points in the original brain to corresponding points in a template volume. Finally, probe tracks were manually traced and warped into the CCFv3 space, and electrodes were aligned to structural boundaries based on physiological landmarks (<xref ref-type="bibr" rid="bib61">Siegle et al., 2021</xref>).</p></sec><sec id="s4-3"><title>Visual stimuli</title><p>Analysis was limited to epochs of drifting gratings, static gratings, natural scenes, or natural movie stimuli, which were shown with identical parameters across the two-photon imaging and electrophysiology experiments. Visual stimuli were generated using custom scripts based on PsychoPy (<xref ref-type="bibr" rid="bib50">Peirce, 2007</xref>) and were displayed using an ASUS PA248Q LCD monitor, 1920 x 1200 pixels in size (21.93’ wide, 60 Hz refresh rate). Stimuli were presented monocularly, and the monitor was positioned 15 cm from the mouse’s right eye and spanned 120° x 95° of visual space prior to stimulus warping. Each monitor was gamma corrected and had a mean luminance of 50 cd/m<sup>2</sup>. To account for the close viewing angle of the mouse, a spherical warping was applied to all stimuli to ensure that the apparent size, speed, and spatial frequency were constant across the monitor as seen from the mouse’s perspective.</p><p>The drifting gratings stimulus consisted of a full-field sinusoidal grating at 80% contrast presented for 2 s, followed by a 1 s mean luminance gray period. Five temporal frequencies (1, 2, 4, 8, 15 Hz), eight different directions (separated by 45°), and one spatial frequency (0.04 cycles per degree) were used. Each grating condition was presented 15 times in random order.</p><p>The static gratings stimulus consisted of a full field sinusoidal grating at 80% contrast that was flashed for 250 ms, with no intervening gray period. Five spatial frequencies (0.02, 0.04, 0.08, 0.16, 0.32 cycles per degree), four phases (0, 0.25, 0.5, 0.75), and six orientations (separated by 30°) were used. Each grating condition was presented approximately 50 times in random order.</p><p>The natural scenes stimulus consisted of 118 natural images taken from the Berkeley Segmentation Dataset (<xref ref-type="bibr" rid="bib37">Martin et al., 2001</xref>), the van Hateren Natural Image Dataset (<xref ref-type="bibr" rid="bib71">van Hateren and van der Schaaf, 1998</xref>), and the McGill Calibrated Colour Image Database (<xref ref-type="bibr" rid="bib42">Olmos and Kingdom, 2004</xref>). The images were presented in grayscale and were contrast normalized and resized to 1174 x 918 pixels. The images were presented in a random order for 0.25 s each, with no intervening gray period.</p><p>Two natural movie clips were taken from the opening scene of the movie Touch of Evil (<xref ref-type="bibr" rid="bib78">Welles, 1958</xref>). Natural Movie One was a 30 s clips repeated 20 or 30 times (2 or 3 blocks of 10), while Natural Movie Three was a 120 s clip repeated 10 times (2 blocks of 5). All clips were contrast normalized and were presented in grayscale at 30 fps.</p></sec><sec id="s4-4"><title>Spikes-to-calcium forward model</title><p>All synthetic fluorescence traces were computed using MLSpike (<xref ref-type="bibr" rid="bib8">Deneux et al., 2016</xref>) using the <italic>third</italic> model described in that paper. This version models the supra-linear behavior of the calcium fluorescence response function in the most physiological manner (out of the three models compared) by (1) explicitly accounting for cooperative binding between calcium and the indicator via the Hill equation and (2) including an explicit rise time, <italic>τ</italic><sub>ON</sub>.</p><p>The model had seven free parameters: decay time (<italic>τ</italic>), unitary response amplitude (<italic>A</italic>), noise level (<italic>σ</italic>), Hill exponent (<italic>n</italic>), ΔF/F rise time (<italic>τ</italic><sub>ON</sub>), saturation (<italic>γ</italic>), and baseline calcium concentration (<italic>c</italic><sub>0</sub>). The last four parameters were fit on a ground truth dataset comprising 14 Emx1-Ai93 (from nine individual neurons across two mice) and 17 Cux2-Ai93 recordings (from 11 individual neurons across two mice), each between 120 s and 310 s in duration, with simultaneous cell-attached electrophysiology and two-photon imaging (noise-matched to the imaging dataset) (<xref ref-type="bibr" rid="bib32">Ledochowitsch et al., 2019</xref>): <italic>n</italic> = 2.42, <italic>τ</italic><sub>ON</sub> = 0.0034, <italic>γ</italic> = 0.0021, and <italic>c</italic><sub>0</sub> = 0.46. Reasonable values for the first three parameters were established by applying the MLSpike autocalibration function to all neurons recorded in the imaging dataset, computing a histogram for each parameter, and choosing the value corresponding to the peak of the histogram, which yielded <italic>τ</italic> = 0.359, <italic>A</italic> = 0.021, and <italic>σ</italic> = 0.047.</p><p>To convert spike times to synthetic fluorescence traces, MATLAB code publicly released by Deneux et al. (<ext-link ext-link-type="uri" xlink:href="https://github.com/MLspike">https://github.com/MLspike</ext-link>) was wrapped into a Python (v3.6.7) module via the MATLAB Library Compiler SDK, and run in parallel on a high-performance compute cluster.</p></sec><sec id="s4-5"><title><italic>ℓ</italic><sub>0</sub>-regularized event extraction</title><p>Prior to computing response metrics, the normalized fluorescence traces for both the experimental and synthetic imaging data were passed through an <italic>ℓ</italic><sub>0</sub> event detection algorithm that identified the onset time and magnitude of transients (<xref ref-type="bibr" rid="bib27">Jewell and Witten, 2018</xref>; <xref ref-type="bibr" rid="bib26">Jewell et al., 2018</xref>; <xref ref-type="bibr" rid="bib7">de Vries et al., 2020</xref>), using a revised version of this algorithm available at <ext-link ext-link-type="uri" xlink:href="http://github.com/jewellsean/FastLZeroSpikeInference">github.com/jewellsean/FastLZeroSpikeInference</ext-link>. The half-time of the transient decay was assumed to be fixed at 315 ms. To avoid overfitting small-amplitude false-positive events to noise in the fluorescence trace, the <italic>ℓ</italic><sub>0</sub>-regularization was adjusted for each neuron such that the smallest detected events were at least 200% of the respective noise floor (computed as the robust standard deviation of the noise via the <monospace>noise_std()</monospace> Python function from the allensdk.brain_observatory.dff module) using an iterative algorithm. All subsequent analyses were performed on these events, rather than continuous fluorescence time series.</p></sec><sec id="s4-6"><title>Non-nonegative deconvolution (NND)</title><p>For the comparisons shown in <xref ref-type="fig" rid="fig3">Figure 3</xref>, we also extracted events via non-negative deconvolution (NND), using the Python implementation included in Suite2p (<xref ref-type="bibr" rid="bib45">Pachitariu et al., 2016b</xref>). Prior to extracting events with NND, we upsampled the 30 Hz ΔF/F traces to 150 Hz using scipy.signal.resample_poly because in our hands NND performed substantially better on upsampled data (<xref ref-type="bibr" rid="bib24">Huang et al., 2021</xref>). In another benchmarking paper (<xref ref-type="bibr" rid="bib1">Berens et al., 2018</xref>), data were also upsampled to 100 Hz ‘for ease of comparison’.</p><p>To filter out low-amplitude events, we first scaled the NND event amplitudes by the maximum value of the original ΔF/F trace for that neuron, which allowed us to define an event magnitude threshold as a function of the noise level detected in the ΔF/F trace. We then binned events in 100 ms intervals by defining the bin’s magnitude as the sum over the magnitudes of all events that fell in that bin. We set the value of a bin to zero if its overall event magnitude was below a threshold value that was an integer multiple (0 ≤ n ≤ 10) of each neuron’s robust standard deviation of the noise (σ).</p></sec><sec id="s4-7"><title>Visual response metrics</title><p>All response metrics were calculated from data stored in NWB 2.0 files (<xref ref-type="bibr" rid="bib54">Ruebel et al., 2019</xref>) using Python code in a custom branch of the AllenSDK (<ext-link ext-link-type="uri" xlink:href="http://github.com/jsiegle/AllenSDK/tree/ophys-ephys">github.com/jsiegle/AllenSDK/tree/ophys-ephys</ext-link>), which relies heavily on NumPy (<xref ref-type="bibr" rid="bib70">van der Walt et al., 2011</xref>), SciPy (SciPy 1.0 <xref ref-type="bibr" rid="bib58">SciPy 1.0 Contributors et al., 2020</xref>), Matplotlib (<xref ref-type="bibr" rid="bib25">Hunter, 2007</xref>), Pandas (<xref ref-type="bibr" rid="bib38">McKinney, 2010</xref>), xarray (<xref ref-type="bibr" rid="bib23">Hoyer and Hamman, 2017</xref>), and scikit-learn (<xref ref-type="bibr" rid="bib49">Pedregosa et al., 2012</xref>) open-source libraries. For a given <italic>imaging</italic> stimulus presentation, the response magnitude for one neuron was defined as the summed amplitude of all of the events occurring between the beginning and end of the presentation. For a given <italic>ephys</italic> stimulus presentation, the response magnitude for one neuron was defined as the number of spikes occurring between the beginning and end of the presentation. Otherwise, the analysis code used for the two modalities was identical.</p><sec id="s4-7-1"><title>Responsiveness</title><p>To determine whether a neuron was responsive to a given stimulus type, the neuron’s response to its preferred condition was compared to a distribution of its activity during the nearest epoch of mean-luminance gray screen (the ‘spontaneous’ interval). This distribution was assembled by randomly selecting 1000 intervals with the same duration of each presentation for that stimulus type (drifting gratings = 2 s, static gratings = 0.25 s, natural scenes = 0.25 s, natural movies = 1/30 s). The preferred condition is the stimulus condition (e.g. a drifting grating with a particular direction and temporal frequency) that elicited the largest mean response. The <italic>response reliability</italic> was defined as the percentage of preferred condition trials with a response magnitude larger than 95% of spontaneous intervals. A neuron was deemed <italic>responsive</italic> to a particular stimulus type if its response reliability was greater than 25%. Selectivity and preference metrics were only analyzed for responsive neurons.</p></sec><sec id="s4-7-2"><title>Selectivity</title><p>The selectivity of a neuron’s responses within a stimulus type was measured using a <italic>lifetime sparseness</italic> metric (<xref ref-type="bibr" rid="bib73">Vinje and Gallant, 2000</xref>). Lifetime sparseness is defined as:<disp-formula id="equ1"><mml:math id="m1"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>n</mml:mi></mml:mfrac><mml:mo>⋅</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>⋅</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover></mml:mrow><mml:mrow><mml:msubsup><mml:mi>r</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>n</mml:mi></mml:mfrac></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:math></disp-formula>where <italic>n</italic> is the total number of conditions, and <italic>r<sub>i</sub></italic> represents the response magnitude for condition <italic>i</italic>. If a neuron has a non-zero response to only one condition (maximally selective response), its lifetime sparseness will be 1. If a neuron responds equally to all conditions (no selectivity), its lifetime sparseness will be 0. Importantly, lifetime sparseness is a nonparametric statistic that considers a neuron’s selectivity across all possible stimulus conditions within a stimulus type, rather than conditions that vary only one parameter (e.g. orientation selectivity). For that reason, it is applicable to any stimulus type.</p></sec><sec id="s4-7-3"><title>Preference</title><p>For all stimulus types, the preferred condition was defined as the condition (or frame, in the case of natural movies) that elicited the largest mean response across all presentations. For drifting gratings, the preferred temporal frequency was defined as the temporal frequency that elicited the largest mean response (averaged across directions). For static gratings, the preferred spatial frequency was defined as the spatial frequency that elicited the largest mean response (averaged across orientations and phases).</p></sec></sec><sec id="s4-8"><title>Matching layer distributions</title><p>Neurons in the imaging dataset were assigned to layers based on the depth of the imaging plane (&lt;200 µm = L2/3, 200–325 µm = L4, 325–500 µm = L5, &gt;500 µm = L6), or the mouse Cre line (Nr5a1-Cre and Scnn1a-Tg3-Cre neurons were always considered to be L4). Neurons in the ephys dataset were assigned to layers after mapping their position to the Common Coordinate Framework version 3 (<xref ref-type="bibr" rid="bib75">Wang et al., 2020</xref>). CCFv3 coordinates were used as indices into the template volume in order to extract layer labels for each cortical unit (see <xref ref-type="bibr" rid="bib61">Siegle et al., 2021</xref> for details of the mapping procedure).</p><p>To test for an effect of laminar sampling bias, L6 neurons were first removed from both datasets. Next, since the ephys dataset always had the highest fraction of neurons L5, neurons from L2/3 and L4 of the imaging dataset were randomly sub-sampled to match the relative fraction of ephys neurons from those layers. The final resampled layer distributions are shown in <xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2B</xref>.</p></sec><sec id="s4-9"><title>Burst metrics</title><p>Bursts were detected using the <italic>LogISI</italic> method (<xref ref-type="bibr" rid="bib48">Pasquale et al., 2010</xref>). Peaks in the histogram of the log-adjusted inter-spike intervals (ISI) were identified, and the largest peak corresponding to an ISI of less than 50 ms was set as the intra-burst peak. In the absence of such a peak, no bursts were found. Minima between intra-burst peak and subsequent peaks were found, and a void parameter, representing peak separability, was calculated for each minimum. The ISI value for the ﬁrst minimum where the void parameter exceeds a default threshold of 0.7 was used as the <italic>maxISI</italic>-cutoff for burst detection. Bursts were then defined as a series of &gt;three spikes with ISIs less than maxISI. If no cutoff was found, or if <italic>maxISI</italic> &gt; 50 ms, burst cores were found with &lt;50-ms ISI, and any spikes within <italic>maxISI</italic> of burst edges were included.</p><p>R code provided with a comparative review of bursting methods (<xref ref-type="bibr" rid="bib6">Cotterill et al., 2016</xref>; <ext-link ext-link-type="uri" xlink:href="https://github.com/ellesec/burstanalysis">https://github.com/ellesec/burstanalysis</ext-link>) was wrapped into Python (v.3.6.7) using the rpy2 interface (<ext-link ext-link-type="uri" xlink:href="https://rpy2.github.io">https://rpy2.github.io</ext-link>), and run in parallel on a high-performance compute cluster.</p></sec><sec id="s4-10"><title>Statistical comparisons</title><p>Jensen–Shannon distance was used to quantify the disparity between the distributions of metrics from imaging and ephys. This is the square root of the Jensen–Shannon divergence, also known as the total divergence to the mean, which, while derived from the Kullback–Leibler divergence, has the advantage of being symmetric and always has a finite value. The Jensen–Shannon distance constitutes a true mathematical metric that satisfies the triangle inequality. (<xref ref-type="bibr" rid="bib35">Lin, 1991</xref>). We used the implementation from the SciPy library (SciPy 1.0 <xref ref-type="bibr" rid="bib58">SciPy 1.0 Contributors et al., 2020</xref>; scipy.spatial.jensenshannon). For selectivity and responsiveness metrics, Jensen–Shannon distance was calculated between histograms with 10 equal-sized bins between 0 and 1. For preference metrics, Jensen–Shannon distance was calculated between the preferred condition histograms, with unit spacing between the conditions.</p><p>To compute p values for Jensen–Shannon distances, we used a bootstrap procedure that randomly sub-sampled metric values from one modality, and calculated the distance between these intra-modal distributions. We repeated this procedure 1000 times, in order to calculate the probability that the true inter-modality distance would be less than the distance between the distributions of two non-overlapping intra-modality samples.</p><p>The Pearson correlation coefficient (scipy.stats.pearsonr) was used to quantify the correlation between two variables. The Mann–Whitney <italic>U</italic> test (scipy.stats.ranksums) was used to test for differences in running speed or running fraction between the imaging and ephys datasets.</p></sec><sec id="s4-11"><title>Clustering of response reliabilities</title><p>We performed a clustering analysis using the response reliabilities by stimulus for each neuron (defined as the percentage of significant trials to the neuron’s preferred stimulus condition), across drifting gratings, static gratings, natural scenes, and natural movies. We combined the reliabilities for natural movies by taking the maximum reliability over Natural Movie One and Natural Movie Three. This resulted in a set of four reliabilities for each neuron (for drifting gratings, static gratings, natural movies, and natural scenes).</p><p>We performed a Gaussian Mixture Model clustering on these reliabilities for cluster numbers from 1 to 50, using the average Bayesian Information Criterion (<xref ref-type="bibr" rid="bib57">Schwarz, 1978</xref>) on held-out data with four-fold cross validation to select the optimal number of clusters. Once the optimal model was selected, we labeled each cluster according to its profile of responsiveness (i.e. the average reliability across all neurons in the cluster to drifting gratings, static gratings, etc.), defining these profiles as ‘classes’. For each neuron, we predicted its cluster membership using the optimal model, and then the class membership using a predefined responsiveness threshold. We repeated this process 100 times to estimate the robustness of the clustering and derive uncertainties for the number of cells belonging to each class.</p></sec></sec></body><back><ack id="ack"><title>Acknowledgements</title><p>We thank the Allen Institute founder, Paul G Allen, for his vision, encouragement, and support. We thank the MindScope Scientific Advisory Council for providing feedback on our initial results. We thank the TissueCyte team, including Nadezhda Dotson, Mike Taormina, and Anh Ho, for histology and imaging associated with <xref ref-type="fig" rid="fig3">Figure 3A</xref>. We thank Adam Charles, Jeff Gauthier, and David Tank for helpful discussions on data processing methods. We thank Nicholas Cain for developing the computational infrastructure that made this project feasible, as well as for his enthusiastic analysis of pilot data in the early stages of this project. We thank Corbett Bennett and Jun Zhuang for their feedback on the manuscript. MAB received funding from NIH award 1R01EB026908-01.</p></ack><sec id="s5" sec-type="additional-information"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="COI-statement" id="conf1"><p>No competing interests declared</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>Conceptualization, Formal analysis, Writing - original draft, Writing - review and editing</p></fn><fn fn-type="con" id="con2"><p>Conceptualization, Formal analysis, Writing - original draft, Writing - review and editing</p></fn><fn fn-type="con" id="con3"><p>Conceptualization, Writing - review and editing</p></fn><fn fn-type="con" id="con4"><p>Conceptualization, Writing - review and editing</p></fn><fn fn-type="con" id="con5"><p>Conceptualization, Writing - review and editing</p></fn><fn fn-type="con" id="con6"><p>Investigation</p></fn><fn fn-type="con" id="con7"><p>Project administration</p></fn><fn fn-type="con" id="con8"><p>Investigation</p></fn><fn fn-type="con" id="con9"><p>Conceptualization, Writing - review and editing</p></fn><fn fn-type="con" id="con10"><p>Supervision, Investigation</p></fn><fn fn-type="con" id="con11"><p>Supervision</p></fn><fn fn-type="con" id="con12"><p>Investigation</p></fn><fn fn-type="con" id="con13"><p>Investigation</p></fn><fn fn-type="con" id="con14"><p>Investigation</p></fn><fn fn-type="con" id="con15"><p>Supervision</p></fn><fn fn-type="con" id="con16"><p>Investigation</p></fn><fn fn-type="con" id="con17"><p>Investigation</p></fn><fn fn-type="con" id="con18"><p>Supervision</p></fn><fn fn-type="con" id="con19"><p>Investigation</p></fn><fn fn-type="con" id="con20"><p>Investigation</p></fn><fn fn-type="con" id="con21"><p>Investigation</p></fn><fn fn-type="con" id="con22"><p>Investigation</p></fn><fn fn-type="con" id="con23"><p>Supervision</p></fn><fn fn-type="con" id="con24"><p>Supervision, Writing - review and editing</p></fn><fn fn-type="con" id="con25"><p>Conceptualization, Writing - review and editing</p></fn><fn fn-type="con" id="con26"><p>Conceptualization, Formal analysis, Supervision, Writing - review and editing</p></fn><fn fn-type="con" id="con27"><p>Conceptualization, Formal analysis, Supervision, Writing - original draft, Writing - review and editing</p></fn></fn-group><fn-group content-type="ethics-information"><title>Ethics</title><fn fn-type="other"><p>Animal experimentation: All animal procedures were approved by the Institutional Animal Care and Use Committee (IACUC) at the Allen Institute in compliance with NIH guidelines.</p></fn></fn-group></sec><sec id="s6" sec-type="supplementary-material"><title>Additional files</title><supplementary-material id="transrepform"><label>Transparent reporting form</label><media mime-subtype="docx" mimetype="application" xlink:href="elife-69068-transrepform-v1.docx"/></supplementary-material></sec><sec id="s7" sec-type="data-availability"><title>Data availability</title><p>Code and intermediate data files required to generate all manuscript figures are available through GitHub (<ext-link ext-link-type="uri" xlink:href="https://github.com/AllenInstitute/ophys_ephys_comparison_paper">https://github.com/AllenInstitute/ophys_ephys_comparison_paper</ext-link>). NWB files for the imaging and ephys sessions (excluding the ephys experiments in GCaMP6 mice) are available via the AllenSDK (<ext-link ext-link-type="uri" xlink:href="https://github.com/AllenInstitute/AllenSDK">https://github.com/AllenInstitute/AllenSDK</ext-link>, copy archived at <ext-link ext-link-type="uri" xlink:href="https://archive.softwareheritage.org/swh:1:rev:b29058f4c136f906123b3f93cd184edb9158b4e4">https://archive.softwareheritage.org/swh:1:rev:b29058f4c136f906123b3f93cd184edb9158b4e4</ext-link>), and also as an AmazonWeb Services Public Data Set (<ext-link ext-link-type="uri" xlink:href="https://registry.opendata.aws/allen-brain-observatory/">https://registry.opendata.aws/allen-brain-observatory/</ext-link>). NWB files for the ephys experiments in GCaMP6 mice are available through Zenodo (<ext-link ext-link-type="uri" xlink:href="https://https://zenodo.org/record/5090747">https://https://zenodo.org/record/5090747</ext-link>).</p><p>The following dataset was generated:</p><p><element-citation id="dataset3" publication-type="data" specific-use="isSupplementedBy"><person-group person-group-type="author"><name><surname>Siegle</surname><given-names>JH</given-names></name><name><surname>Ledochowitsch</surname><given-names>P</given-names></name><name><surname>Jia</surname><given-names>X</given-names></name><name><surname>Millman</surname><given-names>DJ</given-names></name><name><surname>Ocker</surname><given-names>GK</given-names></name><name><surname>Caldejon</surname><given-names>S</given-names></name><name><surname>Casal</surname><given-names>L</given-names></name><name><surname>Cho</surname><given-names>A</given-names></name><name><surname>Denman</surname><given-names>DJ</given-names></name><name><surname>Durand</surname><given-names>S</given-names></name><name><surname>Groblewski</surname><given-names>PA</given-names></name><name><surname>Heller</surname><given-names>G</given-names></name><name><surname>Kato</surname><given-names>I</given-names></name><name><surname>Kivikas</surname><given-names>S</given-names></name><name><surname>Lecoq</surname><given-names>J</given-names></name><name><surname>Nayan</surname><given-names>C</given-names></name><name><surname>Ngo</surname><given-names>K</given-names></name><name><surname>Nicovich</surname><given-names>PR</given-names></name><name><surname>North</surname><given-names>K</given-names></name><name><surname>Ramirez</surname><given-names>TK</given-names></name><name><surname>Swapp</surname><given-names>J</given-names></name><name><surname>Waughman</surname><given-names>X</given-names></name><name><surname>Williford</surname><given-names>A</given-names></name><name><surname>Olsen</surname><given-names>SR</given-names></name><name><surname>Koch</surname><given-names>C</given-names></name><name><surname>Buice</surname><given-names>MA</given-names></name><name><surname>de</surname><given-names>Vries SE</given-names></name></person-group><year iso-8601-date="2021">2021</year><data-title>Neuropixels recordings from GCaMP6f+ mice</data-title><source>Zenodo</source><pub-id assigning-authority="Zenodo" pub-id-type="doi">10.5281/zenodo.5090747</pub-id></element-citation></p><p>The following previously published datasets were used:</p><p><element-citation id="dataset1" publication-type="data" specific-use="references"><person-group person-group-type="author"><collab>Allen Institute for Brain Science</collab></person-group><year iso-8601-date="2016">2016</year><data-title>Allen Brain Observatory Visual Coding</data-title><source>Allen Brain Atlas</source><pub-id assigning-authority="other" pub-id-type="accession" xlink:href="http://observatory.brain-map.org/visualcoding/">observatory.brain-map.org/visualcoding/</pub-id></element-citation></p><p><element-citation id="dataset2" publication-type="data" specific-use="references"><person-group person-group-type="author"><collab>Allen Institute for Brain Science</collab></person-group><year iso-8601-date="2019">2019</year><data-title>Allen Brain Observatory Neuropixels</data-title><source>Allen Brain Map</source><pub-id assigning-authority="other" pub-id-type="accession" xlink:href="https://portal.brain-map.org/explore/circuits/visual-coding-neuropixels">portal.brain-map.org/explore/circuits/visual-coding-neuropixels</pub-id></element-citation></p></sec><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Berens</surname> <given-names>P</given-names></name><name><surname>Freeman</surname> <given-names>J</given-names></name><name><surname>Deneux</surname> <given-names>T</given-names></name><name><surname>Chenkov</surname> <given-names>N</given-names></name><name><surname>McColgan</surname> <given-names>T</given-names></name><name><surname>Speiser</surname> <given-names>A</given-names></name><name><surname>Macke</surname> <given-names>JH</given-names></name><name><surname>Turaga</surname> <given-names>SC</given-names></name><name><surname>Mineault</surname> <given-names>P</given-names></name><name><surname>Rupprecht</surname> <given-names>P</given-names></name><name><surname>Gerhard</surname> <given-names>S</given-names></name><name><surname>Friedrich</surname> <given-names>RW</given-names></name><name><surname>Friedrich</surname> <given-names>J</given-names></name><name><surname>Paninski</surname> <given-names>L</given-names></name><name><surname>Pachitariu</surname> <given-names>M</given-names></name><name><surname>Harris</surname> <given-names>KD</given-names></name><name><surname>Bolte</surname> <given-names>B</given-names></name><name><surname>Machado</surname> <given-names>TA</given-names></name><name><surname>Ringach</surname> <given-names>D</given-names></name><name><surname>Stone</surname> <given-names>J</given-names></name><name><surname>Rogerson</surname> <given-names>LE</given-names></name><name><surname>Sofroniew</surname> <given-names>NJ</given-names></name><name><surname>Reimer</surname> <given-names>J</given-names></name><name><surname>Froudarakis</surname> <given-names>E</given-names></name><name><surname>Euler</surname> <given-names>T</given-names></name><name><surname>Román Rosón</surname> <given-names>M</given-names></name><name><surname>Theis</surname> <given-names>L</given-names></name><name><surname>Tolias</surname> <given-names>AS</given-names></name><name><surname>Bethge</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Community-based benchmarking improves spike rate inference from two-photon calcium imaging data</article-title><source>PLOS Computational Biology</source><volume>14</volume><elocation-id>e1006157</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1006157</pub-id><pub-id pub-id-type="pmid">29782491</pub-id></element-citation></ref><ref id="bib2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bock</surname> <given-names>DD</given-names></name><name><surname>Lee</surname> <given-names>WC</given-names></name><name><surname>Kerlin</surname> <given-names>AM</given-names></name><name><surname>Andermann</surname> <given-names>ML</given-names></name><name><surname>Hood</surname> <given-names>G</given-names></name><name><surname>Wetzel</surname> <given-names>AW</given-names></name><name><surname>Yurgenson</surname> <given-names>S</given-names></name><name><surname>Soucy</surname> <given-names>ER</given-names></name><name><surname>Kim</surname> <given-names>HS</given-names></name><name><surname>Reid</surname> <given-names>RC</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Network anatomy and in vivo physiology of visual cortical neurons</article-title><source>Nature</source><volume>471</volume><fpage>177</fpage><lpage>182</lpage><pub-id pub-id-type="doi">10.1038/nature09802</pub-id><pub-id pub-id-type="pmid">21390124</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Buzsáki</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Large-scale recording of neuronal ensembles</article-title><source>Nature Neuroscience</source><volume>7</volume><fpage>446</fpage><lpage>451</lpage><pub-id pub-id-type="doi">10.1038/nn1233</pub-id><pub-id pub-id-type="pmid">15114356</pub-id></element-citation></ref><ref id="bib4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname> <given-names>TW</given-names></name><name><surname>Wardill</surname> <given-names>TJ</given-names></name><name><surname>Sun</surname> <given-names>Y</given-names></name><name><surname>Pulver</surname> <given-names>SR</given-names></name><name><surname>Renninger</surname> <given-names>SL</given-names></name><name><surname>Baohan</surname> <given-names>A</given-names></name><name><surname>Schreiter</surname> <given-names>ER</given-names></name><name><surname>Kerr</surname> <given-names>RA</given-names></name><name><surname>Orger</surname> <given-names>MB</given-names></name><name><surname>Jayaraman</surname> <given-names>V</given-names></name><name><surname>Looger</surname> <given-names>LL</given-names></name><name><surname>Svoboda</surname> <given-names>K</given-names></name><name><surname>Kim</surname> <given-names>DS</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Ultrasensitive fluorescent proteins for imaging neuronal activity</article-title><source>Nature</source><volume>499</volume><fpage>295</fpage><lpage>300</lpage><pub-id pub-id-type="doi">10.1038/nature12354</pub-id><pub-id pub-id-type="pmid">23868258</pub-id></element-citation></ref><ref id="bib5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname> <given-names>KH</given-names></name><name><surname>Boettiger</surname> <given-names>AN</given-names></name><name><surname>Moffitt</surname> <given-names>JR</given-names></name><name><surname>Wang</surname> <given-names>S</given-names></name><name><surname>Zhuang</surname> <given-names>X</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>RNA imaging. spatially resolved, highly multiplexed RNA profiling in single cells</article-title><source>Science</source><volume>348</volume><elocation-id>aaa6090</elocation-id><pub-id pub-id-type="doi">10.1126/science.aaa6090</pub-id><pub-id pub-id-type="pmid">25858977</pub-id></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cotterill</surname> <given-names>E</given-names></name><name><surname>Charlesworth</surname> <given-names>P</given-names></name><name><surname>Thomas</surname> <given-names>CW</given-names></name><name><surname>Paulsen</surname> <given-names>O</given-names></name><name><surname>Eglen</surname> <given-names>SJ</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>A comparison of computational methods for detecting bursts in neuronal spike trains and their application to human stem cell-derived neuronal networks</article-title><source>Journal of Neurophysiology</source><volume>116</volume><fpage>306</fpage><lpage>321</lpage><pub-id pub-id-type="doi">10.1152/jn.00093.2016</pub-id><pub-id pub-id-type="pmid">27098024</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>de Vries</surname> <given-names>SEJ</given-names></name><name><surname>Lecoq</surname> <given-names>JA</given-names></name><name><surname>Buice</surname> <given-names>MA</given-names></name><name><surname>Groblewski</surname> <given-names>PA</given-names></name><name><surname>Ocker</surname> <given-names>GK</given-names></name><name><surname>Oliver</surname> <given-names>M</given-names></name><name><surname>Feng</surname> <given-names>D</given-names></name><name><surname>Cain</surname> <given-names>N</given-names></name><name><surname>Ledochowitsch</surname> <given-names>P</given-names></name><name><surname>Millman</surname> <given-names>D</given-names></name><name><surname>Roll</surname> <given-names>K</given-names></name><name><surname>Garrett</surname> <given-names>M</given-names></name><name><surname>Keenan</surname> <given-names>T</given-names></name><name><surname>Kuan</surname> <given-names>L</given-names></name><name><surname>Mihalas</surname> <given-names>S</given-names></name><name><surname>Olsen</surname> <given-names>S</given-names></name><name><surname>Thompson</surname> <given-names>C</given-names></name><name><surname>Wakeman</surname> <given-names>W</given-names></name><name><surname>Waters</surname> <given-names>J</given-names></name><name><surname>Williams</surname> <given-names>D</given-names></name><name><surname>Barber</surname> <given-names>C</given-names></name><name><surname>Berbesque</surname> <given-names>N</given-names></name><name><surname>Blanchard</surname> <given-names>B</given-names></name><name><surname>Bowles</surname> <given-names>N</given-names></name><name><surname>Caldejon</surname> <given-names>SD</given-names></name><name><surname>Casal</surname> <given-names>L</given-names></name><name><surname>Cho</surname> <given-names>A</given-names></name><name><surname>Cross</surname> <given-names>S</given-names></name><name><surname>Dang</surname> <given-names>C</given-names></name><name><surname>Dolbeare</surname> <given-names>T</given-names></name><name><surname>Edwards</surname> <given-names>M</given-names></name><name><surname>Galbraith</surname> <given-names>J</given-names></name><name><surname>Gaudreault</surname> <given-names>N</given-names></name><name><surname>Gilbert</surname> <given-names>TL</given-names></name><name><surname>Griffin</surname> <given-names>F</given-names></name><name><surname>Hargrave</surname> <given-names>P</given-names></name><name><surname>Howard</surname> <given-names>R</given-names></name><name><surname>Huang</surname> <given-names>L</given-names></name><name><surname>Jewell</surname> <given-names>S</given-names></name><name><surname>Keller</surname> <given-names>N</given-names></name><name><surname>Knoblich</surname> <given-names>U</given-names></name><name><surname>Larkin</surname> <given-names>JD</given-names></name><name><surname>Larsen</surname> <given-names>R</given-names></name><name><surname>Lau</surname> <given-names>C</given-names></name><name><surname>Lee</surname> <given-names>E</given-names></name><name><surname>Lee</surname> <given-names>F</given-names></name><name><surname>Leon</surname> <given-names>A</given-names></name><name><surname>Li</surname> <given-names>L</given-names></name><name><surname>Long</surname> <given-names>F</given-names></name><name><surname>Luviano</surname> <given-names>J</given-names></name><name><surname>Mace</surname> <given-names>K</given-names></name><name><surname>Nguyen</surname> <given-names>T</given-names></name><name><surname>Perkins</surname> <given-names>J</given-names></name><name><surname>Robertson</surname> <given-names>M</given-names></name><name><surname>Seid</surname> <given-names>S</given-names></name><name><surname>Shea-Brown</surname> <given-names>E</given-names></name><name><surname>Shi</surname> <given-names>J</given-names></name><name><surname>Sjoquist</surname> <given-names>N</given-names></name><name><surname>Slaughterbeck</surname> <given-names>C</given-names></name><name><surname>Sullivan</surname> <given-names>D</given-names></name><name><surname>Valenza</surname> <given-names>R</given-names></name><name><surname>White</surname> <given-names>C</given-names></name><name><surname>Williford</surname> <given-names>A</given-names></name><name><surname>Witten</surname> <given-names>DM</given-names></name><name><surname>Zhuang</surname> <given-names>J</given-names></name><name><surname>Zeng</surname> <given-names>H</given-names></name><name><surname>Farrell</surname> <given-names>C</given-names></name><name><surname>Ng</surname> <given-names>L</given-names></name><name><surname>Bernard</surname> <given-names>A</given-names></name><name><surname>Phillips</surname> <given-names>JW</given-names></name><name><surname>Reid</surname> <given-names>RC</given-names></name><name><surname>Koch</surname> <given-names>C</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>A large-scale standardized physiological survey reveals functional organization of the mouse visual cortex</article-title><source>Nature Neuroscience</source><volume>23</volume><fpage>138</fpage><lpage>151</lpage><pub-id pub-id-type="doi">10.1038/s41593-019-0550-9</pub-id><pub-id pub-id-type="pmid">31844315</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Deneux</surname> <given-names>T</given-names></name><name><surname>Kaszas</surname> <given-names>A</given-names></name><name><surname>Szalay</surname> <given-names>G</given-names></name><name><surname>Katona</surname> <given-names>G</given-names></name><name><surname>Lakner</surname> <given-names>T</given-names></name><name><surname>Grinvald</surname> <given-names>A</given-names></name><name><surname>Rózsa</surname> <given-names>B</given-names></name><name><surname>Vanzetta</surname> <given-names>I</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Accurate spike estimation from noisy calcium signals for ultrafast three-dimensional imaging of large neuronal populations in vivo</article-title><source>Nature Communications</source><volume>7</volume><elocation-id>12190</elocation-id><pub-id pub-id-type="doi">10.1038/ncomms12190</pub-id><pub-id pub-id-type="pmid">27432255</pub-id></element-citation></ref><ref id="bib9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dombeck</surname> <given-names>DA</given-names></name><name><surname>Harvey</surname> <given-names>CD</given-names></name><name><surname>Tian</surname> <given-names>L</given-names></name><name><surname>Looger</surname> <given-names>LL</given-names></name><name><surname>Tank</surname> <given-names>DW</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Functional imaging of hippocampal place cells at cellular resolution during virtual navigation</article-title><source>Nature Neuroscience</source><volume>13</volume><fpage>1433</fpage><lpage>1440</lpage><pub-id pub-id-type="doi">10.1038/nn.2648</pub-id><pub-id pub-id-type="pmid">20890294</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Economo</surname> <given-names>MN</given-names></name><name><surname>Viswanathan</surname> <given-names>S</given-names></name><name><surname>Tasic</surname> <given-names>B</given-names></name><name><surname>Bas</surname> <given-names>E</given-names></name><name><surname>Winnubst</surname> <given-names>J</given-names></name><name><surname>Menon</surname> <given-names>V</given-names></name><name><surname>Graybuck</surname> <given-names>LT</given-names></name><name><surname>Nguyen</surname> <given-names>TN</given-names></name><name><surname>Smith</surname> <given-names>KA</given-names></name><name><surname>Yao</surname> <given-names>Z</given-names></name><name><surname>Wang</surname> <given-names>L</given-names></name><name><surname>Gerfen</surname> <given-names>CR</given-names></name><name><surname>Chandrashekar</surname> <given-names>J</given-names></name><name><surname>Zeng</surname> <given-names>H</given-names></name><name><surname>Looger</surname> <given-names>LL</given-names></name><name><surname>Svoboda</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Distinct descending motor cortex pathways and their roles in movement</article-title><source>Nature</source><volume>563</volume><fpage>79</fpage><lpage>84</lpage><pub-id pub-id-type="doi">10.1038/s41586-018-0642-9</pub-id><pub-id pub-id-type="pmid">30382200</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Eles</surname> <given-names>JR</given-names></name><name><surname>Vazquez</surname> <given-names>AL</given-names></name><name><surname>Kozai</surname> <given-names>TDY</given-names></name><name><surname>Cui</surname> <given-names>XT</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>In vivo imaging of neuronal calcium during electrode implantation: spatial and temporal mapping of damage and recovery</article-title><source>Biomaterials</source><volume>174</volume><fpage>79</fpage><lpage>94</lpage><pub-id pub-id-type="doi">10.1016/j.biomaterials.2018.04.043</pub-id><pub-id pub-id-type="pmid">29783119</pub-id></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Erö</surname> <given-names>C</given-names></name><name><surname>Gewaltig</surname> <given-names>MO</given-names></name><name><surname>Keller</surname> <given-names>D</given-names></name><name><surname>Markram</surname> <given-names>H</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>A cell atlas for the mouse brain</article-title><source>Frontiers in Neuroinformatics</source><volume>12</volume><elocation-id>84</elocation-id><pub-id pub-id-type="doi">10.3389/fninf.2018.00084</pub-id><pub-id pub-id-type="pmid">30546301</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Evans</surname> <given-names>MH</given-names></name><name><surname>Petersen</surname> <given-names>RS</given-names></name><name><surname>Humphries</surname> <given-names>MD</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>On the use of calcium deconvolution algorithms in practical contexts</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/871137</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Feinberg</surname> <given-names>EH</given-names></name><name><surname>Meister</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Orientation columns in the mouse superior colliculus</article-title><source>Nature</source><volume>519</volume><fpage>229</fpage><lpage>232</lpage><pub-id pub-id-type="doi">10.1038/nature14103</pub-id><pub-id pub-id-type="pmid">25517100</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Friedrich</surname> <given-names>J</given-names></name><name><surname>Zhou</surname> <given-names>P</given-names></name><name><surname>Paninski</surname> <given-names>L</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Fast online deconvolution of calcium imaging data</article-title><source>PLOS Computational Biology</source><volume>13</volume><elocation-id>e1005423</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1005423</pub-id><pub-id pub-id-type="pmid">28291787</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Garrett</surname> <given-names>ME</given-names></name><name><surname>Nauhaus</surname> <given-names>I</given-names></name><name><surname>Marshel</surname> <given-names>JH</given-names></name><name><surname>Callaway</surname> <given-names>EM</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Topography and areal organization of mouse visual cortex</article-title><source>Journal of Neuroscience</source><volume>34</volume><fpage>12587</fpage><lpage>12600</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.1124-14.2014</pub-id><pub-id pub-id-type="pmid">25209296</pub-id></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Glickfeld</surname> <given-names>LL</given-names></name><name><surname>Andermann</surname> <given-names>ML</given-names></name><name><surname>Bonin</surname> <given-names>V</given-names></name><name><surname>Reid</surname> <given-names>RC</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Cortico-cortical projections in mouse visual cortex are functionally target specific</article-title><source>Nature Neuroscience</source><volume>16</volume><fpage>219</fpage><lpage>226</lpage><pub-id pub-id-type="doi">10.1038/nn.3300</pub-id><pub-id pub-id-type="pmid">23292681</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gradinaru</surname> <given-names>V</given-names></name><name><surname>Zhang</surname> <given-names>F</given-names></name><name><surname>Ramakrishnan</surname> <given-names>C</given-names></name><name><surname>Mattis</surname> <given-names>J</given-names></name><name><surname>Prakash</surname> <given-names>R</given-names></name><name><surname>Diester</surname> <given-names>I</given-names></name><name><surname>Goshen</surname> <given-names>I</given-names></name><name><surname>Thompson</surname> <given-names>KR</given-names></name><name><surname>Deisseroth</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Molecular and cellular approaches for diversifying and extending optogenetics</article-title><source>Cell</source><volume>141</volume><fpage>154</fpage><lpage>165</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2010.02.037</pub-id><pub-id pub-id-type="pmid">20303157</pub-id></element-citation></ref><ref id="bib19"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Greenberg</surname> <given-names>DS</given-names></name><name><surname>Wallace</surname> <given-names>DJ</given-names></name><name><surname>Voit</surname> <given-names>K-M</given-names></name><name><surname>Wuertenberger</surname> <given-names>S</given-names></name><name><surname>Czubayko</surname> <given-names>U</given-names></name><name><surname>Monsees</surname> <given-names>A</given-names></name><name><surname>Handa</surname> <given-names>T</given-names></name><name><surname>Vogelstein</surname> <given-names>JT</given-names></name><name><surname>Seifert</surname> <given-names>R</given-names></name><name><surname>Groemping</surname> <given-names>Y</given-names></name><name><surname>Kerr</surname> <given-names>JND</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Accurate action potential inference from a calcium sensor protein through biophysical modeling</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/479055</pub-id></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Han</surname> <given-names>HJ</given-names></name><name><surname>Allen</surname> <given-names>CC</given-names></name><name><surname>Buchovecky</surname> <given-names>CM</given-names></name><name><surname>Yetman</surname> <given-names>MJ</given-names></name><name><surname>Born</surname> <given-names>HA</given-names></name><name><surname>Marin</surname> <given-names>MA</given-names></name><name><surname>Rodgers</surname> <given-names>SP</given-names></name><name><surname>Song</surname> <given-names>BJ</given-names></name><name><surname>Lu</surname> <given-names>HC</given-names></name><name><surname>Justice</surname> <given-names>MJ</given-names></name><name><surname>Probst</surname> <given-names>FJ</given-names></name><name><surname>Jankowsky</surname> <given-names>JL</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Strain background influences neurotoxicity and behavioral abnormalities in mice expressing the tetracycline transactivator</article-title><source>Journal of Neuroscience</source><volume>32</volume><fpage>10574</fpage><lpage>10586</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.0893-12.2012</pub-id><pub-id pub-id-type="pmid">22855807</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Harris</surname> <given-names>KD</given-names></name><name><surname>Quiroga</surname> <given-names>RQ</given-names></name><name><surname>Freeman</surname> <given-names>J</given-names></name><name><surname>Smith</surname> <given-names>SL</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Improving data quality in neuronal population recordings</article-title><source>Nature Neuroscience</source><volume>19</volume><fpage>1165</fpage><lpage>1174</lpage><pub-id pub-id-type="doi">10.1038/nn.4365</pub-id><pub-id pub-id-type="pmid">27571195</pub-id></element-citation></ref><ref id="bib22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hill</surname> <given-names>DN</given-names></name><name><surname>Mehta</surname> <given-names>SB</given-names></name><name><surname>Kleinfeld</surname> <given-names>D</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Quality metrics to accompany spike sorting of extracellular signals</article-title><source>Journal of Neuroscience</source><volume>31</volume><fpage>8699</fpage><lpage>8705</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.0971-11.2011</pub-id><pub-id pub-id-type="pmid">21677152</pub-id></element-citation></ref><ref id="bib23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hoyer</surname> <given-names>S</given-names></name><name><surname>Hamman</surname> <given-names>JJ</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Xarray: n-d labeled arrays and datasets in Python</article-title><source>Journal of Open Research Software</source><volume>5</volume><elocation-id>10</elocation-id><pub-id pub-id-type="doi">10.5334/jors.148</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Huang</surname> <given-names>L</given-names></name><name><surname>Ledochowitsch</surname> <given-names>P</given-names></name><name><surname>Knoblich</surname> <given-names>U</given-names></name><name><surname>Lecoq</surname> <given-names>J</given-names></name><name><surname>Murphy</surname> <given-names>GJ</given-names></name><name><surname>Reid</surname> <given-names>RC</given-names></name><name><surname>de Vries</surname> <given-names>SE</given-names></name><name><surname>Koch</surname> <given-names>C</given-names></name><name><surname>Zeng</surname> <given-names>H</given-names></name><name><surname>Buice</surname> <given-names>MA</given-names></name><name><surname>Waters</surname> <given-names>J</given-names></name><name><surname>Li</surname> <given-names>L</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Relationship between simultaneously recorded spiking activity and fluorescence signal in GCaMP6 transgenic mice</article-title><source>eLife</source><volume>10</volume><elocation-id>e51675</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.51675</pub-id><pub-id pub-id-type="pmid">33683198</pub-id></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hunter</surname> <given-names>JD</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Matplotlib: a 2D graphics environment</article-title><source>Computing in Science &amp; Engineering</source><volume>9</volume><fpage>90</fpage><lpage>95</lpage><pub-id pub-id-type="doi">10.1109/MCSE.2007.55</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Jewell</surname> <given-names>S</given-names></name><name><surname>Hocking</surname> <given-names>TD</given-names></name><name><surname>Fearnhead</surname> <given-names>P</given-names></name><name><surname>Witten</surname> <given-names>D</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Fast nonconvex deconvolution of calcium imaging data</article-title><source>arXiv</source><ext-link ext-link-type="uri" xlink:href="https://arxiv.org/pdf/1802.07380.pdf">https://arxiv.org/pdf/1802.07380.pdf</ext-link></element-citation></ref><ref id="bib27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jewell</surname> <given-names>S</given-names></name><name><surname>Witten</surname> <given-names>D</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Exact spike train inference via <italic>ℓ</italic><sub>0</sub>optimization</article-title><source>The Annals of Applied Statistics</source><volume>12</volume><fpage>2457</fpage><lpage>2482</lpage><pub-id pub-id-type="doi">10.1214/18-AOAS1162</pub-id><pub-id pub-id-type="pmid">30627301</pub-id></element-citation></ref><ref id="bib28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jia</surname> <given-names>X</given-names></name><name><surname>Siegle</surname> <given-names>JH</given-names></name><name><surname>Bennett</surname> <given-names>C</given-names></name><name><surname>Gale</surname> <given-names>SD</given-names></name><name><surname>Denman</surname> <given-names>DJ</given-names></name><name><surname>Koch</surname> <given-names>C</given-names></name><name><surname>Olsen</surname> <given-names>SR</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>High-density extracellular probes reveal dendritic backpropagation and facilitate neuron classification</article-title><source>Journal of Neurophysiology</source><volume>121</volume><fpage>1831</fpage><lpage>1847</lpage><pub-id pub-id-type="doi">10.1152/jn.00680.2018</pub-id><pub-id pub-id-type="pmid">30840526</pub-id></element-citation></ref><ref id="bib29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jun</surname> <given-names>JJ</given-names></name><name><surname>Steinmetz</surname> <given-names>NA</given-names></name><name><surname>Siegle</surname> <given-names>JH</given-names></name><name><surname>Denman</surname> <given-names>DJ</given-names></name><name><surname>Bauza</surname> <given-names>M</given-names></name><name><surname>Barbarits</surname> <given-names>B</given-names></name><name><surname>Lee</surname> <given-names>AK</given-names></name><name><surname>Anastassiou</surname> <given-names>CA</given-names></name><name><surname>Andrei</surname> <given-names>A</given-names></name><name><surname>Aydın</surname> <given-names>Ç</given-names></name><name><surname>Barbic</surname> <given-names>M</given-names></name><name><surname>Blanche</surname> <given-names>TJ</given-names></name><name><surname>Bonin</surname> <given-names>V</given-names></name><name><surname>Couto</surname> <given-names>J</given-names></name><name><surname>Dutta</surname> <given-names>B</given-names></name><name><surname>Gratiy</surname> <given-names>SL</given-names></name><name><surname>Gutnisky</surname> <given-names>DA</given-names></name><name><surname>Häusser</surname> <given-names>M</given-names></name><name><surname>Karsh</surname> <given-names>B</given-names></name><name><surname>Ledochowitsch</surname> <given-names>P</given-names></name><name><surname>Lopez</surname> <given-names>CM</given-names></name><name><surname>Mitelut</surname> <given-names>C</given-names></name><name><surname>Musa</surname> <given-names>S</given-names></name><name><surname>Okun</surname> <given-names>M</given-names></name><name><surname>Pachitariu</surname> <given-names>M</given-names></name><name><surname>Putzeys</surname> <given-names>J</given-names></name><name><surname>Rich</surname> <given-names>PD</given-names></name><name><surname>Rossant</surname> <given-names>C</given-names></name><name><surname>Sun</surname> <given-names>WL</given-names></name><name><surname>Svoboda</surname> <given-names>K</given-names></name><name><surname>Carandini</surname> <given-names>M</given-names></name><name><surname>Harris</surname> <given-names>KD</given-names></name><name><surname>Koch</surname> <given-names>C</given-names></name><name><surname>O'Keefe</surname> <given-names>J</given-names></name><name><surname>Harris</surname> <given-names>TD</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Fully integrated silicon probes for high-density recording of neural activity</article-title><source>Nature</source><volume>551</volume><fpage>232</fpage><lpage>236</lpage><pub-id pub-id-type="doi">10.1038/nature24636</pub-id><pub-id pub-id-type="pmid">29120427</pub-id></element-citation></ref><ref id="bib30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kazemipour</surname> <given-names>A</given-names></name><name><surname>Novak</surname> <given-names>O</given-names></name><name><surname>Flickinger</surname> <given-names>D</given-names></name><name><surname>Marvin</surname> <given-names>JS</given-names></name><name><surname>Abdelfattah</surname> <given-names>AS</given-names></name><name><surname>King</surname> <given-names>J</given-names></name><name><surname>Borden</surname> <given-names>PM</given-names></name><name><surname>Kim</surname> <given-names>JJ</given-names></name><name><surname>Al-Abdullatif</surname> <given-names>SH</given-names></name><name><surname>Deal</surname> <given-names>PE</given-names></name><name><surname>Miller</surname> <given-names>EW</given-names></name><name><surname>Schreiter</surname> <given-names>ER</given-names></name><name><surname>Druckmann</surname> <given-names>S</given-names></name><name><surname>Svoboda</surname> <given-names>K</given-names></name><name><surname>Looger</surname> <given-names>LL</given-names></name><name><surname>Podgorski</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Kilohertz frame-rate two-photon tomography</article-title><source>Nature Methods</source><volume>16</volume><fpage>778</fpage><lpage>786</lpage><pub-id pub-id-type="doi">10.1038/s41592-019-0493-9</pub-id><pub-id pub-id-type="pmid">31363222</pub-id></element-citation></ref><ref id="bib31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ko</surname> <given-names>H</given-names></name><name><surname>Hofer</surname> <given-names>SB</given-names></name><name><surname>Pichler</surname> <given-names>B</given-names></name><name><surname>Buchanan</surname> <given-names>KA</given-names></name><name><surname>Sjöström</surname> <given-names>PJ</given-names></name><name><surname>Mrsic-Flogel</surname> <given-names>TD</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Functional specificity of local synaptic connections in neocortical networks</article-title><source>Nature</source><volume>473</volume><fpage>87</fpage><lpage>91</lpage><pub-id pub-id-type="doi">10.1038/nature09880</pub-id><pub-id pub-id-type="pmid">21478872</pub-id></element-citation></ref><ref id="bib32"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Ledochowitsch</surname> <given-names>P</given-names></name><name><surname>Huang</surname> <given-names>L</given-names></name><name><surname>Knoblich</surname> <given-names>U</given-names></name><name><surname>Oliver</surname> <given-names>M</given-names></name><name><surname>Lecoq</surname> <given-names>J</given-names></name><name><surname>Reid</surname> <given-names>C</given-names></name><name><surname>Li</surname> <given-names>L</given-names></name><name><surname>Zeng</surname> <given-names>H</given-names></name><name><surname>Koch</surname> <given-names>C</given-names></name><name><surname>Waters</surname> <given-names>J</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>On the correspondence of electrical and optical physiology in in vivo population-scale two-photon calcium imaging</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/800102</pub-id></element-citation></ref><ref id="bib33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lee</surname> <given-names>WC</given-names></name><name><surname>Bonin</surname> <given-names>V</given-names></name><name><surname>Reed</surname> <given-names>M</given-names></name><name><surname>Graham</surname> <given-names>BJ</given-names></name><name><surname>Hood</surname> <given-names>G</given-names></name><name><surname>Glattfelder</surname> <given-names>K</given-names></name><name><surname>Reid</surname> <given-names>RC</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Anatomy and function of an excitatory network in the visual cortex</article-title><source>Nature</source><volume>532</volume><fpage>370</fpage><lpage>374</lpage><pub-id pub-id-type="doi">10.1038/nature17192</pub-id><pub-id pub-id-type="pmid">27018655</pub-id></element-citation></ref><ref id="bib34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lima</surname> <given-names>SQ</given-names></name><name><surname>Hromádka</surname> <given-names>T</given-names></name><name><surname>Znamenskiy</surname> <given-names>P</given-names></name><name><surname>Zador</surname> <given-names>AM</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>PINP: a new method of tagging neuronal populations for identification during in vivo electrophysiological recording</article-title><source>PLOS ONE</source><volume>4</volume><elocation-id>e6099</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0006099</pub-id><pub-id pub-id-type="pmid">19584920</pub-id></element-citation></ref><ref id="bib35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lin</surname> <given-names>J</given-names></name></person-group><year iso-8601-date="1991">1991</year><article-title>Divergence measures based on the shannon entropy</article-title><source>IEEE Transactions on Information Theory</source><volume>37</volume><fpage>145</fpage><lpage>151</lpage><pub-id pub-id-type="doi">10.1109/18.61115</pub-id></element-citation></ref><ref id="bib36"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Madisen</surname> <given-names>L</given-names></name><name><surname>Garner</surname> <given-names>AR</given-names></name><name><surname>Shimaoka</surname> <given-names>D</given-names></name><name><surname>Chuong</surname> <given-names>AS</given-names></name><name><surname>Klapoetke</surname> <given-names>NC</given-names></name><name><surname>Li</surname> <given-names>L</given-names></name><name><surname>van der Bourg</surname> <given-names>A</given-names></name><name><surname>Niino</surname> <given-names>Y</given-names></name><name><surname>Egolf</surname> <given-names>L</given-names></name><name><surname>Monetti</surname> <given-names>C</given-names></name><name><surname>Gu</surname> <given-names>H</given-names></name><name><surname>Mills</surname> <given-names>M</given-names></name><name><surname>Cheng</surname> <given-names>A</given-names></name><name><surname>Tasic</surname> <given-names>B</given-names></name><name><surname>Nguyen</surname> <given-names>TN</given-names></name><name><surname>Sunkin</surname> <given-names>SM</given-names></name><name><surname>Benucci</surname> <given-names>A</given-names></name><name><surname>Nagy</surname> <given-names>A</given-names></name><name><surname>Miyawaki</surname> <given-names>A</given-names></name><name><surname>Helmchen</surname> <given-names>F</given-names></name><name><surname>Empson</surname> <given-names>RM</given-names></name><name><surname>Knöpfel</surname> <given-names>T</given-names></name><name><surname>Boyden</surname> <given-names>ES</given-names></name><name><surname>Reid</surname> <given-names>RC</given-names></name><name><surname>Carandini</surname> <given-names>M</given-names></name><name><surname>Zeng</surname> <given-names>H</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Transgenic mice for intersectional targeting of neural sensors and effectors with high specificity and performance</article-title><source>Neuron</source><volume>85</volume><fpage>942</fpage><lpage>958</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2015.02.022</pub-id></element-citation></ref><ref id="bib37"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Martin</surname> <given-names>D</given-names></name><name><surname>Fowlkes</surname> <given-names>C</given-names></name><name><surname>Tal</surname> <given-names>D</given-names></name><name><surname>Malik</surname> <given-names>J</given-names></name></person-group><year iso-8601-date="2001">2001</year><article-title>A database of human segmented natural images and its application to evaluating segmentation algorithms and measuring ecological statistics</article-title><conf-name>Proceedings of the Eighth IEEE International Conference on Computational Vision</conf-name><fpage>416</fpage><lpage>423</lpage><pub-id pub-id-type="doi">10.1109/ICCV.2001.937655</pub-id></element-citation></ref><ref id="bib38"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>McKinney</surname> <given-names>W</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Data structures for statistical computing in Python</article-title><conf-name>Proceedings of the 9th Python in Science Conference</conf-name><fpage>51</fpage><lpage>56</lpage><pub-id pub-id-type="doi">10.25080/MAJORA-92BF1922-00A</pub-id></element-citation></ref><ref id="bib39"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mesa</surname> <given-names>N</given-names></name><name><surname>Waters</surname> <given-names>J</given-names></name><name><surname>de Vries</surname> <given-names>SEJ</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>The effect of inclusion criteria on the functional properties reported in mouse visual cortex</article-title><source>Eneuro</source><volume>8</volume><elocation-id>ENEURO.0188-20.2021</elocation-id><pub-id pub-id-type="doi">10.1523/ENEURO.0188-20.2021</pub-id><pub-id pub-id-type="pmid">33509948</pub-id></element-citation></ref><ref id="bib40"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Nicovich</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="2021">2021</year><data-title>AllenInstitute/AIBSOPT</data-title><source>Software Heritage</source><version designator="swh:1:rev:e38af7e25651fe7517dcf7ca3d38676e3c9c211e">swh:1:rev:e38af7e25651fe7517dcf7ca3d38676e3c9c211e</version><ext-link ext-link-type="uri" xlink:href="https://archive.softwareheritage.org/swh:1:dir:8954e35a23b97f4ce14f9028e50f4bc5f073e44e;origin=https://github.com/AllenInstitute/AIBSOPT;visit=swh:1:snp:6b3d8870456826b0097613e88c8a513d46e6de1d;anchor=swh:1:rev:e38af7e25651fe7517dcf7ca3d38676e3c9c211e">https://archive.softwareheritage.org/swh:1:dir:8954e35a23b97f4ce14f9028e50f4bc5f073e44e;origin=https://github.com/AllenInstitute/AIBSOPT;visit=swh:1:snp:6b3d8870456826b0097613e88c8a513d46e6de1d;anchor=swh:1:rev:e38af7e25651fe7517dcf7ca3d38676e3c9c211e</ext-link></element-citation></ref><ref id="bib41"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Niell</surname> <given-names>CM</given-names></name><name><surname>Stryker</surname> <given-names>MP</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Modulation of visual responses by behavioral state in mouse visual cortex</article-title><source>Neuron</source><volume>65</volume><fpage>472</fpage><lpage>479</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2010.01.033</pub-id><pub-id pub-id-type="pmid">20188652</pub-id></element-citation></ref><ref id="bib42"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Olmos</surname> <given-names>A</given-names></name><name><surname>Kingdom</surname> <given-names>FA</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>A biologically inspired algorithm for the recovery of shading and reflectance images</article-title><source>Perception</source><volume>33</volume><fpage>1463</fpage><lpage>1473</lpage><pub-id pub-id-type="doi">10.1068/p5321</pub-id><pub-id pub-id-type="pmid">15729913</pub-id></element-citation></ref><ref id="bib43"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ouzounov</surname> <given-names>DG</given-names></name><name><surname>Wang</surname> <given-names>T</given-names></name><name><surname>Wang</surname> <given-names>M</given-names></name><name><surname>Feng</surname> <given-names>DD</given-names></name><name><surname>Horton</surname> <given-names>NG</given-names></name><name><surname>Cruz-Hernández</surname> <given-names>JC</given-names></name><name><surname>Cheng</surname> <given-names>YT</given-names></name><name><surname>Reimer</surname> <given-names>J</given-names></name><name><surname>Tolias</surname> <given-names>AS</given-names></name><name><surname>Nishimura</surname> <given-names>N</given-names></name><name><surname>Xu</surname> <given-names>C</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>In vivo three-photon imaging of activity of GCaMP6-labeled neurons deep in intact mouse brain</article-title><source>Nature Methods</source><volume>14</volume><fpage>388</fpage><lpage>390</lpage><pub-id pub-id-type="doi">10.1038/nmeth.4183</pub-id><pub-id pub-id-type="pmid">28218900</pub-id></element-citation></ref><ref id="bib44"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Pachitariu</surname> <given-names>M</given-names></name><name><surname>Steinmetz</surname> <given-names>NA</given-names></name><name><surname>Kadir</surname> <given-names>SN</given-names></name><name><surname>Carandini</surname> <given-names>M</given-names></name><name><surname>Harris</surname> <given-names>KD</given-names></name></person-group><year iso-8601-date="2016">2016a</year><article-title>Fast and accurate spike sorting of high-channel count probes with KiloSort</article-title><conf-name>Advances in Neural Information Processing Systems</conf-name></element-citation></ref><ref id="bib45"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Pachitariu</surname> <given-names>M</given-names></name><name><surname>Stringer</surname> <given-names>C</given-names></name><name><surname>Dipoppa</surname> <given-names>M</given-names></name><name><surname>Schröder</surname> <given-names>S</given-names></name><name><surname>Rossi</surname> <given-names>LF</given-names></name><name><surname>Dalgleish</surname> <given-names>H</given-names></name><name><surname>Carandini</surname> <given-names>M</given-names></name><name><surname>Harris</surname> <given-names>KD</given-names></name></person-group><year iso-8601-date="2016">2016b</year><article-title>Suite2p: beyond 10,000 neurons with standard two-photon microscopy</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/061507</pub-id></element-citation></ref><ref id="bib46"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pachitariu</surname> <given-names>M</given-names></name><name><surname>Stringer</surname> <given-names>C</given-names></name><name><surname>Harris</surname> <given-names>KD</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Robustness of spike deconvolution for neuronal calcium imaging</article-title><source>The Journal of Neuroscience</source><volume>38</volume><fpage>7976</fpage><lpage>7985</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.3339-17.2018</pub-id><pub-id pub-id-type="pmid">30082416</pub-id></element-citation></ref><ref id="bib47"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Pachitariu</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2021">2021</year><data-title>MouseLand/Kilosort</data-title><source>Software Heritage</source><version designator="swh:1:rev:db3a3353d9a374ea2f71674bbe443be21986c82c">swh:1:rev:db3a3353d9a374ea2f71674bbe443be21986c82c</version><ext-link ext-link-type="uri" xlink:href="https://archive.softwareheritage.org/swh:1:dir:f24b1f096a0f44b907337a5db613116e58f9ea47;origin=https://github.com/MouseLand/Kilosort;visit=swh:1:snp:a45f1825481650ddb3f287b8afeb71886738d762;anchor=swh:1:rev:db3a3353d9a374ea2f71674bbe443be21986c82c">https://archive.softwareheritage.org/swh:1:dir:f24b1f096a0f44b907337a5db613116e58f9ea47;origin=https://github.com/MouseLand/Kilosort;visit=swh:1:snp:a45f1825481650ddb3f287b8afeb71886738d762;anchor=swh:1:rev:db3a3353d9a374ea2f71674bbe443be21986c82c</ext-link></element-citation></ref><ref id="bib48"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pasquale</surname> <given-names>V</given-names></name><name><surname>Martinoia</surname> <given-names>S</given-names></name><name><surname>Chiappalone</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>A self-adapting approach for the detection of bursts and network bursts in neuronal cultures</article-title><source>Journal of Computational Neuroscience</source><volume>29</volume><fpage>213</fpage><lpage>229</lpage><pub-id pub-id-type="doi">10.1007/s10827-009-0175-1</pub-id><pub-id pub-id-type="pmid">19669401</pub-id></element-citation></ref><ref id="bib49"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Pedregosa</surname> <given-names>F</given-names></name><name><surname>Varoquaux</surname> <given-names>G</given-names></name><name><surname>Gramfort</surname> <given-names>A</given-names></name><name><surname>Michel</surname> <given-names>V</given-names></name><name><surname>Thirion</surname> <given-names>B</given-names></name><name><surname>Grisel</surname> <given-names>O</given-names></name><name><surname>Blondel</surname> <given-names>M</given-names></name><name><surname>Müller</surname> <given-names>A</given-names></name><name><surname>Nothman</surname> <given-names>J</given-names></name><name><surname>Louppe</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Scikit-learn: machine learning in Python</article-title><source>arXiv</source><ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/1201.0490">https://arxiv.org/abs/1201.0490</ext-link></element-citation></ref><ref id="bib50"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Peirce</surname> <given-names>JW</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>PsychoPy--psychophysics software in python</article-title><source>Journal of Neuroscience Methods</source><volume>162</volume><fpage>8</fpage><lpage>13</lpage><pub-id pub-id-type="doi">10.1016/j.jneumeth.2006.11.017</pub-id><pub-id pub-id-type="pmid">17254636</pub-id></element-citation></ref><ref id="bib51"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Peterka</surname> <given-names>DS</given-names></name><name><surname>Takahashi</surname> <given-names>H</given-names></name><name><surname>Yuste</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Imaging voltage in neurons</article-title><source>Neuron</source><volume>69</volume><fpage>9</fpage><lpage>21</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2010.12.010</pub-id><pub-id pub-id-type="pmid">21220095</pub-id></element-citation></ref><ref id="bib52"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Peters</surname> <given-names>AJ</given-names></name><name><surname>Chen</surname> <given-names>SX</given-names></name><name><surname>Komiyama</surname> <given-names>T</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Emergence of reproducible spatiotemporal activity during motor learning</article-title><source>Nature</source><volume>510</volume><fpage>263</fpage><lpage>267</lpage><pub-id pub-id-type="doi">10.1038/nature13235</pub-id><pub-id pub-id-type="pmid">24805237</pub-id></element-citation></ref><ref id="bib53"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Renier</surname> <given-names>N</given-names></name><name><surname>Wu</surname> <given-names>Z</given-names></name><name><surname>Simon</surname> <given-names>DJ</given-names></name><name><surname>Yang</surname> <given-names>J</given-names></name><name><surname>Ariel</surname> <given-names>P</given-names></name><name><surname>Tessier-Lavigne</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>iDISCO: a simple, rapid method to immunolabel large tissue samples for volume imaging</article-title><source>Cell</source><volume>159</volume><fpage>896</fpage><lpage>910</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2014.10.010</pub-id><pub-id pub-id-type="pmid">25417164</pub-id></element-citation></ref><ref id="bib54"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Ruebel</surname> <given-names>O</given-names></name><name><surname>Tritt</surname> <given-names>A</given-names></name><name><surname>Dichter</surname> <given-names>B</given-names></name><name><surname>Braun</surname> <given-names>T</given-names></name><name><surname>Cain</surname> <given-names>N</given-names></name><name><surname>Clack</surname> <given-names>N</given-names></name><name><surname>Davidson</surname> <given-names>TJ</given-names></name><name><surname>Dougherty</surname> <given-names>M</given-names></name><name><surname>Fillion-Robin</surname> <given-names>J-C</given-names></name><name><surname>Graddis</surname> <given-names>N</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>NWB:n 2.0: an accessible data standard for neurophysiology</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/523035</pub-id></element-citation></ref><ref id="bib55"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Rupprecht</surname> <given-names>P</given-names></name><name><surname>Carta</surname> <given-names>S</given-names></name><name><surname>Hoffmann</surname> <given-names>A</given-names></name><name><surname>Echizen</surname> <given-names>M</given-names></name><name><surname>Blot</surname> <given-names>A</given-names></name><name><surname>Kwan</surname> <given-names>AC</given-names></name><name><surname>Dan</surname> <given-names>Y</given-names></name><name><surname>Hofer</surname> <given-names>SB</given-names></name><name><surname>Kitamura</surname> <given-names>K</given-names></name><name><surname>Helmchen</surname> <given-names>F</given-names></name><name><surname>Friedrich</surname> <given-names>RW</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Database and deep learning toolbox for noise-optimized generalized spike inference from calcium imaging</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/2020.08.31.272450</pub-id></element-citation></ref><ref id="bib56"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schmidt-Supprian</surname> <given-names>M</given-names></name><name><surname>Rajewsky</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Vagaries of conditional gene targeting</article-title><source>Nature Immunology</source><volume>8</volume><fpage>665</fpage><lpage>668</lpage><pub-id pub-id-type="doi">10.1038/ni0707-665</pub-id><pub-id pub-id-type="pmid">17579640</pub-id></element-citation></ref><ref id="bib57"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schwarz</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="1978">1978</year><article-title>Estimating the dimension of a model</article-title><source>The Annals of Statistics</source><volume>6</volume><fpage>461</fpage><lpage>464</lpage><pub-id pub-id-type="doi">10.1214/aos/1176344136</pub-id></element-citation></ref><ref id="bib58"><element-citation publication-type="journal"><person-group person-group-type="author"><collab>SciPy 1.0 Contributors</collab><name><surname>Virtanen</surname> <given-names>P</given-names></name><name><surname>Gommers</surname> <given-names>R</given-names></name><name><surname>Oliphant</surname> <given-names>TE</given-names></name><name><surname>Haberland</surname> <given-names>M</given-names></name><name><surname>Reddy</surname> <given-names>T</given-names></name><name><surname>Cournapeau</surname> <given-names>D</given-names></name><name><surname>Burovski</surname> <given-names>E</given-names></name><name><surname>Peterson</surname> <given-names>P</given-names></name><name><surname>Weckesser</surname> <given-names>W</given-names></name><name><surname>Bright</surname> <given-names>J</given-names></name><name><surname>van der Walt</surname> <given-names>SJ</given-names></name><name><surname>Brett</surname> <given-names>M</given-names></name><name><surname>Wilson</surname> <given-names>J</given-names></name><name><surname>Millman</surname> <given-names>KJ</given-names></name><name><surname>Mayorov</surname> <given-names>N</given-names></name><name><surname>Nelson</surname> <given-names>ARJ</given-names></name><name><surname>Jones</surname> <given-names>E</given-names></name><name><surname>Kern</surname> <given-names>R</given-names></name><name><surname>Larson</surname> <given-names>E</given-names></name><name><surname>Carey</surname> <given-names>CJ</given-names></name><name><surname>Polat</surname> <given-names>İ</given-names></name><name><surname>Feng</surname> <given-names>Y</given-names></name><name><surname>Moore</surname> <given-names>EW</given-names></name><name><surname>VanderPlas</surname> <given-names>J</given-names></name><name><surname>Laxalde</surname> <given-names>D</given-names></name><name><surname>Perktold</surname> <given-names>J</given-names></name><name><surname>Cimrman</surname> <given-names>R</given-names></name><name><surname>Henriksen</surname> <given-names>I</given-names></name><name><surname>Quintero</surname> <given-names>EA</given-names></name><name><surname>Harris</surname> <given-names>CR</given-names></name><name><surname>Archibald</surname> <given-names>AM</given-names></name><name><surname>Ribeiro</surname> <given-names>AH</given-names></name><name><surname>Pedregosa</surname> <given-names>F</given-names></name><name><surname>van Mulbregt</surname> <given-names>P</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>SciPy 1.0: fundamental algorithms for scientific computing in Python</article-title><source>Nature Methods</source><volume>17</volume><fpage>261</fpage><lpage>272</lpage><pub-id pub-id-type="doi">10.1038/s41592-019-0686-2</pub-id><pub-id pub-id-type="pmid">32015543</pub-id></element-citation></ref><ref id="bib59"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shoham</surname> <given-names>S</given-names></name><name><surname>O’Connor</surname> <given-names>DH</given-names></name><name><surname>Segev</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>How silent is the brain: is there a “dark matter” problem in neuroscience?</article-title><source>Journal of Comparative Physiology A</source><volume>192</volume><fpage>777</fpage><lpage>784</lpage><pub-id pub-id-type="doi">10.1007/s00359-006-0117-6</pub-id></element-citation></ref><ref id="bib60"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Siegle</surname> <given-names>JH</given-names></name><name><surname>López</surname> <given-names>AC</given-names></name><name><surname>Patel</surname> <given-names>YA</given-names></name><name><surname>Abramov</surname> <given-names>K</given-names></name><name><surname>Ohayon</surname> <given-names>S</given-names></name><name><surname>Voigts</surname> <given-names>J</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Open ephys: an open-source, plugin-based platform for multichannel electrophysiology</article-title><source>Journal of Neural Engineering</source><volume>14</volume><elocation-id>045003</elocation-id><pub-id pub-id-type="doi">10.1088/1741-2552/aa5eea</pub-id><pub-id pub-id-type="pmid">28169219</pub-id></element-citation></ref><ref id="bib61"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Siegle</surname> <given-names>JH</given-names></name><name><surname>Jia</surname> <given-names>X</given-names></name><name><surname>Durand</surname> <given-names>S</given-names></name><name><surname>Gale</surname> <given-names>S</given-names></name><name><surname>Bennett</surname> <given-names>C</given-names></name><name><surname>Graddis</surname> <given-names>N</given-names></name><name><surname>Heller</surname> <given-names>G</given-names></name><name><surname>Ramirez</surname> <given-names>TK</given-names></name><name><surname>Choi</surname> <given-names>H</given-names></name><name><surname>Luviano</surname> <given-names>JA</given-names></name><name><surname>Groblewski</surname> <given-names>PA</given-names></name><name><surname>Ahmed</surname> <given-names>R</given-names></name><name><surname>Arkhipov</surname> <given-names>A</given-names></name><name><surname>Bernard</surname> <given-names>A</given-names></name><name><surname>Billeh</surname> <given-names>YN</given-names></name><name><surname>Brown</surname> <given-names>D</given-names></name><name><surname>Buice</surname> <given-names>MA</given-names></name><name><surname>Cain</surname> <given-names>N</given-names></name><name><surname>Caldejon</surname> <given-names>S</given-names></name><name><surname>Casal</surname> <given-names>L</given-names></name><name><surname>Cho</surname> <given-names>A</given-names></name><name><surname>Chvilicek</surname> <given-names>M</given-names></name><name><surname>Cox</surname> <given-names>TC</given-names></name><name><surname>Dai</surname> <given-names>K</given-names></name><name><surname>Denman</surname> <given-names>DJ</given-names></name><name><surname>de Vries</surname> <given-names>SEJ</given-names></name><name><surname>Dietzman</surname> <given-names>R</given-names></name><name><surname>Esposito</surname> <given-names>L</given-names></name><name><surname>Farrell</surname> <given-names>C</given-names></name><name><surname>Feng</surname> <given-names>D</given-names></name><name><surname>Galbraith</surname> <given-names>J</given-names></name><name><surname>Garrett</surname> <given-names>M</given-names></name><name><surname>Gelfand</surname> <given-names>EC</given-names></name><name><surname>Hancock</surname> <given-names>N</given-names></name><name><surname>Harris</surname> <given-names>JA</given-names></name><name><surname>Howard</surname> <given-names>R</given-names></name><name><surname>Hu</surname> <given-names>B</given-names></name><name><surname>Hytnen</surname> <given-names>R</given-names></name><name><surname>Iyer</surname> <given-names>R</given-names></name><name><surname>Jessett</surname> <given-names>E</given-names></name><name><surname>Johnson</surname> <given-names>K</given-names></name><name><surname>Kato</surname> <given-names>I</given-names></name><name><surname>Kiggins</surname> <given-names>J</given-names></name><name><surname>Lambert</surname> <given-names>S</given-names></name><name><surname>Lecoq</surname> <given-names>J</given-names></name><name><surname>Ledochowitsch</surname> <given-names>P</given-names></name><name><surname>Lee</surname> <given-names>JH</given-names></name><name><surname>Leon</surname> <given-names>A</given-names></name><name><surname>Li</surname> <given-names>Y</given-names></name><name><surname>Liang</surname> <given-names>E</given-names></name><name><surname>Long</surname> <given-names>F</given-names></name><name><surname>Mace</surname> <given-names>K</given-names></name><name><surname>Melchior</surname> <given-names>J</given-names></name><name><surname>Millman</surname> <given-names>D</given-names></name><name><surname>Mollenkopf</surname> <given-names>T</given-names></name><name><surname>Nayan</surname> <given-names>C</given-names></name><name><surname>Ng</surname> <given-names>L</given-names></name><name><surname>Ngo</surname> <given-names>K</given-names></name><name><surname>Nguyen</surname> <given-names>T</given-names></name><name><surname>Nicovich</surname> <given-names>PR</given-names></name><name><surname>North</surname> <given-names>K</given-names></name><name><surname>Ocker</surname> <given-names>GK</given-names></name><name><surname>Ollerenshaw</surname> <given-names>D</given-names></name><name><surname>Oliver</surname> <given-names>M</given-names></name><name><surname>Pachitariu</surname> <given-names>M</given-names></name><name><surname>Perkins</surname> <given-names>J</given-names></name><name><surname>Reding</surname> <given-names>M</given-names></name><name><surname>Reid</surname> <given-names>D</given-names></name><name><surname>Robertson</surname> <given-names>M</given-names></name><name><surname>Ronellenfitch</surname> <given-names>K</given-names></name><name><surname>Seid</surname> <given-names>S</given-names></name><name><surname>Slaughterbeck</surname> <given-names>C</given-names></name><name><surname>Stoecklin</surname> <given-names>M</given-names></name><name><surname>Sullivan</surname> <given-names>D</given-names></name><name><surname>Sutton</surname> <given-names>B</given-names></name><name><surname>Swapp</surname> <given-names>J</given-names></name><name><surname>Thompson</surname> <given-names>C</given-names></name><name><surname>Turner</surname> <given-names>K</given-names></name><name><surname>Wakeman</surname> <given-names>W</given-names></name><name><surname>Whitesell</surname> <given-names>JD</given-names></name><name><surname>Williams</surname> <given-names>D</given-names></name><name><surname>Williford</surname> <given-names>A</given-names></name><name><surname>Young</surname> <given-names>R</given-names></name><name><surname>Zeng</surname> <given-names>H</given-names></name><name><surname>Naylor</surname> <given-names>S</given-names></name><name><surname>Phillips</surname> <given-names>JW</given-names></name><name><surname>Reid</surname> <given-names>RC</given-names></name><name><surname>Mihalas</surname> <given-names>S</given-names></name><name><surname>Olsen</surname> <given-names>SR</given-names></name><name><surname>Koch</surname> <given-names>C</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Survey of spiking in the mouse visual system reveals functional hierarchy</article-title><source>Nature</source><volume>592</volume><fpage>86</fpage><lpage>92</lpage><pub-id pub-id-type="doi">10.1038/s41586-020-03171-x</pub-id><pub-id pub-id-type="pmid">33473216</pub-id></element-citation></ref><ref id="bib62"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Siegle</surname> <given-names>J</given-names></name></person-group><year iso-8601-date="2021">2021</year><data-title>ecephys_spike_sorting</data-title><source>Software Heritage</source><version designator="swh:1:rev:995842e4ec67e9db1b7869d885b97317012337db">swh:1:rev:995842e4ec67e9db1b7869d885b97317012337db</version><ext-link ext-link-type="uri" xlink:href="https://archive.softwareheritage.org/swh:1:dir:0a622ac41d878c751d74ba9deccc37691b7380a0;origin=https://github.com/AllenInstitute/ecephys_spike_sorting;visit=swh:1:snp:dd5be4e7aeea9666292804748f8ed8b6c3537c8d;anchor=swh:1:rev:995842e4ec67e9db1b7869d885b97317012337db">https://archive.softwareheritage.org/swh:1:dir:0a622ac41d878c751d74ba9deccc37691b7380a0;origin=https://github.com/AllenInstitute/ecephys_spike_sorting;visit=swh:1:snp:dd5be4e7aeea9666292804748f8ed8b6c3537c8d;anchor=swh:1:rev:995842e4ec67e9db1b7869d885b97317012337db</ext-link></element-citation></ref><ref id="bib63"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Skocek</surname> <given-names>O</given-names></name><name><surname>Nöbauer</surname> <given-names>T</given-names></name><name><surname>Weilguny</surname> <given-names>L</given-names></name><name><surname>Martínez Traub</surname> <given-names>F</given-names></name><name><surname>Xia</surname> <given-names>CN</given-names></name><name><surname>Molodtsov</surname> <given-names>MI</given-names></name><name><surname>Grama</surname> <given-names>A</given-names></name><name><surname>Yamagata</surname> <given-names>M</given-names></name><name><surname>Aharoni</surname> <given-names>D</given-names></name><name><surname>Cox</surname> <given-names>DD</given-names></name><name><surname>Golshani</surname> <given-names>P</given-names></name><name><surname>Vaziri</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>High-speed volumetric imaging of neuronal activity in freely moving rodents</article-title><source>Nature Methods</source><volume>15</volume><fpage>429</fpage><lpage>432</lpage><pub-id pub-id-type="doi">10.1038/s41592-018-0008-0</pub-id><pub-id pub-id-type="pmid">29736000</pub-id></element-citation></ref><ref id="bib64"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sofroniew</surname> <given-names>NJ</given-names></name><name><surname>Flickinger</surname> <given-names>D</given-names></name><name><surname>King</surname> <given-names>J</given-names></name><name><surname>Svoboda</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>A large field of view two-photon mesoscope with subcellular resolution for in vivo imaging</article-title><source>eLife</source><volume>5</volume><elocation-id>e14472</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.14472</pub-id><pub-id pub-id-type="pmid">27300105</pub-id></element-citation></ref><ref id="bib65"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Steinmetz</surname> <given-names>NA</given-names></name><name><surname>Buetfering</surname> <given-names>C</given-names></name><name><surname>Lecoq</surname> <given-names>J</given-names></name><name><surname>Lee</surname> <given-names>CR</given-names></name><name><surname>Peters</surname> <given-names>AJ</given-names></name><name><surname>Jacobs</surname> <given-names>EAK</given-names></name><name><surname>Coen</surname> <given-names>P</given-names></name><name><surname>Ollerenshaw</surname> <given-names>DR</given-names></name><name><surname>Valley</surname> <given-names>MT</given-names></name><name><surname>de Vries</surname> <given-names>SEJ</given-names></name><name><surname>Garrett</surname> <given-names>M</given-names></name><name><surname>Zhuang</surname> <given-names>J</given-names></name><name><surname>Groblewski</surname> <given-names>PA</given-names></name><name><surname>Manavi</surname> <given-names>S</given-names></name><name><surname>Miles</surname> <given-names>J</given-names></name><name><surname>White</surname> <given-names>C</given-names></name><name><surname>Lee</surname> <given-names>E</given-names></name><name><surname>Griffin</surname> <given-names>F</given-names></name><name><surname>Larkin</surname> <given-names>JD</given-names></name><name><surname>Roll</surname> <given-names>K</given-names></name><name><surname>Cross</surname> <given-names>S</given-names></name><name><surname>Nguyen</surname> <given-names>TV</given-names></name><name><surname>Larsen</surname> <given-names>R</given-names></name><name><surname>Pendergraft</surname> <given-names>J</given-names></name><name><surname>Daigle</surname> <given-names>T</given-names></name><name><surname>Tasic</surname> <given-names>B</given-names></name><name><surname>Thompson</surname> <given-names>CL</given-names></name><name><surname>Waters</surname> <given-names>J</given-names></name><name><surname>Olsen</surname> <given-names>S</given-names></name><name><surname>Margolis</surname> <given-names>DJ</given-names></name><name><surname>Zeng</surname> <given-names>H</given-names></name><name><surname>Hausser</surname> <given-names>M</given-names></name><name><surname>Carandini</surname> <given-names>M</given-names></name><name><surname>Harris</surname> <given-names>KD</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Aberrant cortical activity in multiple GCaMP6-Expressing transgenic mouse lines</article-title><source>Eneuro</source><volume>4</volume><elocation-id>ENEURO.0207-17.2017</elocation-id><pub-id pub-id-type="doi">10.1523/ENEURO.0207-17.2017</pub-id><pub-id pub-id-type="pmid">28932809</pub-id></element-citation></ref><ref id="bib66"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stringer</surname> <given-names>C</given-names></name><name><surname>Pachitariu</surname> <given-names>M</given-names></name><name><surname>Steinmetz</surname> <given-names>N</given-names></name><name><surname>Reddy</surname> <given-names>CB</given-names></name><name><surname>Carandini</surname> <given-names>M</given-names></name><name><surname>Harris</surname> <given-names>KD</given-names></name></person-group><year iso-8601-date="2019">2019a</year><article-title>Spontaneous behaviors drive multidimensional, brainwide activity</article-title><source>Science</source><volume>364</volume><elocation-id>eaav7893</elocation-id><pub-id pub-id-type="doi">10.1126/science.aav7893</pub-id></element-citation></ref><ref id="bib67"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stringer</surname> <given-names>C</given-names></name><name><surname>Pachitariu</surname> <given-names>M</given-names></name><name><surname>Steinmetz</surname> <given-names>N</given-names></name><name><surname>Carandini</surname> <given-names>M</given-names></name><name><surname>Harris</surname> <given-names>KD</given-names></name></person-group><year iso-8601-date="2019">2019b</year><article-title>High-dimensional geometry of population responses in visual cortex</article-title><source>Nature</source><volume>571</volume><fpage>361</fpage><lpage>365</lpage><pub-id pub-id-type="doi">10.1038/s41586-019-1346-5</pub-id><pub-id pub-id-type="pmid">31243367</pub-id></element-citation></ref><ref id="bib68"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Svoboda</surname> <given-names>K</given-names></name><name><surname>Yasuda</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Principles of two-photon excitation microscopy and its applications to neuroscience</article-title><source>Neuron</source><volume>50</volume><fpage>823</fpage><lpage>839</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2006.05.019</pub-id><pub-id pub-id-type="pmid">16772166</pub-id></element-citation></ref><ref id="bib69"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Theis</surname> <given-names>L</given-names></name><name><surname>Berens</surname> <given-names>P</given-names></name><name><surname>Froudarakis</surname> <given-names>E</given-names></name><name><surname>Reimer</surname> <given-names>J</given-names></name><name><surname>Román Rosón</surname> <given-names>M</given-names></name><name><surname>Baden</surname> <given-names>T</given-names></name><name><surname>Euler</surname> <given-names>T</given-names></name><name><surname>Tolias</surname> <given-names>AS</given-names></name><name><surname>Bethge</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Benchmarking spike rate inference in population calcium imaging</article-title><source>Neuron</source><volume>90</volume><fpage>471</fpage><lpage>482</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2016.04.014</pub-id><pub-id pub-id-type="pmid">27151639</pub-id></element-citation></ref><ref id="bib70"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>van der Walt</surname> <given-names>S</given-names></name><name><surname>Colbert</surname> <given-names>SC</given-names></name><name><surname>Varoquaux</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>The NumPy array: a structure for efficient numerical computation</article-title><source>Computing in Science &amp; Engineering</source><volume>13</volume><fpage>22</fpage><lpage>30</lpage><pub-id pub-id-type="doi">10.1109/MCSE.2011.37</pub-id></element-citation></ref><ref id="bib71"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>van Hateren</surname> <given-names>JH</given-names></name><name><surname>van der Schaaf</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="1998">1998</year><article-title>Independent component filters of natural images compared with simple cells in primary visual cortex</article-title><source>Proceedings of the Royal Society of London. Series B: Biological Sciences</source><volume>265</volume><fpage>359</fpage><lpage>366</lpage><pub-id pub-id-type="doi">10.1098/rspb.1998.0303</pub-id></element-citation></ref><ref id="bib72"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vinck</surname> <given-names>M</given-names></name><name><surname>Batista-Brito</surname> <given-names>R</given-names></name><name><surname>Knoblich</surname> <given-names>U</given-names></name><name><surname>Cardin</surname> <given-names>JA</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Arousal and locomotion make distinct contributions to cortical activity patterns and visual encoding</article-title><source>Neuron</source><volume>86</volume><fpage>740</fpage><lpage>754</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2015.03.028</pub-id><pub-id pub-id-type="pmid">25892300</pub-id></element-citation></ref><ref id="bib73"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vinje</surname> <given-names>WE</given-names></name><name><surname>Gallant</surname> <given-names>JL</given-names></name></person-group><year iso-8601-date="2000">2000</year><article-title>Sparse coding and decorrelation in primary visual cortex during natural vision</article-title><source>Science</source><volume>287</volume><fpage>1273</fpage><lpage>1276</lpage><pub-id pub-id-type="doi">10.1126/science.287.5456.1273</pub-id><pub-id pub-id-type="pmid">10678835</pub-id></element-citation></ref><ref id="bib74"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vogelstein</surname> <given-names>JT</given-names></name><name><surname>Packer</surname> <given-names>AM</given-names></name><name><surname>Machado</surname> <given-names>TA</given-names></name><name><surname>Sippy</surname> <given-names>T</given-names></name><name><surname>Babadi</surname> <given-names>B</given-names></name><name><surname>Yuste</surname> <given-names>R</given-names></name><name><surname>Paninski</surname> <given-names>L</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Fast nonnegative deconvolution for spike train inference from population calcium imaging</article-title><source>Journal of Neurophysiology</source><volume>104</volume><fpage>3691</fpage><lpage>3704</lpage><pub-id pub-id-type="doi">10.1152/jn.01073.2009</pub-id><pub-id pub-id-type="pmid">20554834</pub-id></element-citation></ref><ref id="bib75"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname> <given-names>Q</given-names></name><name><surname>Ding</surname> <given-names>S-L</given-names></name><name><surname>Li</surname> <given-names>Y</given-names></name><name><surname>Royall</surname> <given-names>J</given-names></name><name><surname>Feng</surname> <given-names>D</given-names></name><name><surname>Lesnar</surname> <given-names>P</given-names></name><name><surname>Graddis</surname> <given-names>N</given-names></name><name><surname>Naeemi</surname> <given-names>M</given-names></name><name><surname>Facer</surname> <given-names>B</given-names></name><name><surname>Ho</surname> <given-names>A</given-names></name><name><surname>Dolbeare</surname> <given-names>T</given-names></name><name><surname>Blanchard</surname> <given-names>B</given-names></name><name><surname>Dee</surname> <given-names>N</given-names></name><name><surname>Wakeman</surname> <given-names>W</given-names></name><name><surname>Hirokawa</surname> <given-names>KE</given-names></name><name><surname>Szafer</surname> <given-names>A</given-names></name><name><surname>Sunkin</surname> <given-names>SM</given-names></name><name><surname>Oh</surname> <given-names>SW</given-names></name><name><surname>Bernard</surname> <given-names>A</given-names></name><name><surname>Phillips</surname> <given-names>JW</given-names></name><name><surname>Hawrylycz</surname> <given-names>M</given-names></name><name><surname>Koch</surname> <given-names>C</given-names></name><name><surname>Zeng</surname> <given-names>H</given-names></name><name><surname>Harris</surname> <given-names>JA</given-names></name><name><surname>Ng</surname> <given-names>L</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>The allen mouse brain common coordinate framework: a 3D reference atlas</article-title><source>Cell</source><volume>181</volume><fpage>936</fpage><lpage>953</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2020.04.007</pub-id></element-citation></ref><ref id="bib76"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wei</surname> <given-names>Z</given-names></name><name><surname>Lin</surname> <given-names>B-J</given-names></name><name><surname>Chen</surname> <given-names>T-W</given-names></name><name><surname>Daie</surname> <given-names>K</given-names></name><name><surname>Svoboda</surname> <given-names>K</given-names></name><name><surname>Druckmann</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>A comparison of neuronal population dynamics measured with calcium imaging and electrophysiology</article-title><source>Neuroscience</source><volume>16</volume><elocation-id>e1008198</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1008198</pub-id></element-citation></ref><ref id="bib77"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Weisenburger</surname> <given-names>S</given-names></name><name><surname>Tejera</surname> <given-names>F</given-names></name><name><surname>Demas</surname> <given-names>J</given-names></name><name><surname>Chen</surname> <given-names>B</given-names></name><name><surname>Manley</surname> <given-names>J</given-names></name><name><surname>Sparks</surname> <given-names>FT</given-names></name><name><surname>Martínez Traub</surname> <given-names>F</given-names></name><name><surname>Daigle</surname> <given-names>T</given-names></name><name><surname>Zeng</surname> <given-names>H</given-names></name><name><surname>Losonczy</surname> <given-names>A</given-names></name><name><surname>Vaziri</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Volumetric Ca<sup>2+</sup> imaging in the mouse brain using hybrid multiplexed sculpted light microscopy</article-title><source>Cell</source><volume>177</volume><fpage>1050</fpage><lpage>1066</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2019.03.011</pub-id><pub-id pub-id-type="pmid">30982596</pub-id></element-citation></ref><ref id="bib78"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Welles</surname> <given-names>O</given-names></name></person-group><year iso-8601-date="1958">1958</year><source>Touch of Evil</source><publisher-name>Universal - International</publisher-name></element-citation></ref><ref id="bib79"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>West</surname> <given-names>AE</given-names></name><name><surname>Chen</surname> <given-names>WG</given-names></name><name><surname>Dalva</surname> <given-names>MB</given-names></name><name><surname>Dolmetsch</surname> <given-names>RE</given-names></name><name><surname>Kornhauser</surname> <given-names>JM</given-names></name><name><surname>Shaywitz</surname> <given-names>AJ</given-names></name><name><surname>Takasu</surname> <given-names>MA</given-names></name><name><surname>Tao</surname> <given-names>X</given-names></name><name><surname>Greenberg</surname> <given-names>ME</given-names></name></person-group><year iso-8601-date="2001">2001</year><article-title>Calcium regulation of neuronal gene expression</article-title><source>PNAS</source><volume>98</volume><fpage>11024</fpage><lpage>11031</lpage><pub-id pub-id-type="doi">10.1073/pnas.191352298</pub-id></element-citation></ref><ref id="bib80"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yang</surname> <given-names>W</given-names></name><name><surname>Miller</surname> <given-names>JE</given-names></name><name><surname>Carrillo-Reid</surname> <given-names>L</given-names></name><name><surname>Pnevmatikakis</surname> <given-names>E</given-names></name><name><surname>Paninski</surname> <given-names>L</given-names></name><name><surname>Yuste</surname> <given-names>R</given-names></name><name><surname>Peterka</surname> <given-names>DS</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Simultaneous Multi-plane imaging of neural circuits</article-title><source>Neuron</source><volume>89</volume><fpage>269</fpage><lpage>284</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2015.12.012</pub-id><pub-id pub-id-type="pmid">26774159</pub-id></element-citation></ref><ref id="bib81"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhang</surname> <given-names>T</given-names></name><name><surname>Hernandez</surname> <given-names>O</given-names></name><name><surname>Chrapkiewicz</surname> <given-names>R</given-names></name><name><surname>Shai</surname> <given-names>A</given-names></name><name><surname>Wagner</surname> <given-names>MJ</given-names></name><name><surname>Zhang</surname> <given-names>Y</given-names></name><name><surname>Wu</surname> <given-names>CH</given-names></name><name><surname>Li</surname> <given-names>JZ</given-names></name><name><surname>Inoue</surname> <given-names>M</given-names></name><name><surname>Gong</surname> <given-names>Y</given-names></name><name><surname>Ahanonu</surname> <given-names>B</given-names></name><name><surname>Zeng</surname> <given-names>H</given-names></name><name><surname>Bito</surname> <given-names>H</given-names></name><name><surname>Schnitzer</surname> <given-names>MJ</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Kilohertz two-photon brain imaging in awake mice</article-title><source>Nature Methods</source><volume>16</volume><fpage>1119</fpage><lpage>1122</lpage><pub-id pub-id-type="doi">10.1038/s41592-019-0597-2</pub-id><pub-id pub-id-type="pmid">31659327</pub-id></element-citation></ref></ref-list></back><sub-article article-type="decision-letter" id="sa1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.69068.sa1</article-id><title-group><article-title>Decision letter</article-title></title-group><contrib-group><contrib contrib-type="editor"><name><surname>Calabrese</surname><given-names>Ronald L</given-names></name><role>Reviewing Editor</role><aff><institution>Emory University</institution><country>United States</country></aff></contrib></contrib-group><contrib-group><contrib contrib-type="reviewer"><name><surname>Pachitariu</surname><given-names>Marius</given-names> </name><role>Reviewer</role><aff><institution>Janelia Research Campus</institution><country>United States</country></aff></contrib></contrib-group></front-stub><body><boxed-text><p>In the interests of transparency, eLife publishes the most substantive revision requests and the accompanying author responses.</p></boxed-text><p><bold>Acceptance summary:</bold></p><p>This paper addresses the important topic of comparing the data obtained from standard electrophysiology recordings to calcium imaging in a controlled experimental set up [it does ephys and 2p in different mice, perhaps not ideal but very useful for real comparisons of different datasets]. Previously, most comparisons have been performed at the level of single cells with simultaneous ephys and imaging, and these comparisons have not addressed the topics discussed here, which are highly relevant to the field. The discussion and analysis of pros and cons to each method are fair and valuable, in particular as the shortcomings of electrophysiology are sometimes not discussed in the literature.</p><p><bold>Decision letter after peer review:</bold></p><p>[Editors’ note: the authors submitted for reconsideration following the decision after peer review. What follows is the decision letter after the first round of review.]</p><p>Thank you for submitting your work entitled &quot;Reconciling functional differences in populations of neurons recorded with two-photon imaging and electrophysiology&quot; for consideration by <italic>eLife</italic>. Your article has been reviewed by 3 peer reviewers, and the evaluation has been overseen by a Reviewing/Senior Editor. The reviewers have opted to remain anonymous.</p><p>Our decision has been reached after consultation between the reviewers. Based on these discussions and the individual reviews below, we regret to inform you that your work will not be considered further for publication in <italic>eLife</italic>.</p><p>While all the reviewers saw great merit in the approach, there are several flaws large and small that require a thorough reworking of the paper and significant new analyses that could substantially change the main conclusions. Such a thoroughly reworked paper taking into account all the reviewer comments could be submitted as a new submission to <italic>eLife</italic>.</p><p><italic>Reviewer #1:</italic></p><p>In this manuscript, Siegle, Ledochowitsch et al. compare two large datasets of neurons recorded by electrophysiology and two-photon calcium imaging respectively. They start by showing that there are substantial differences in the responsiveness and selectivity of the neurons, but those differences mostly go away after taking into account the details of these methods. This work is very useful information for anyone using ephys or ophys to record neurons from brains, which includes a <italic>lot</italic> of labs. It can become a priceless reference for everyone worried about what their data actually represents, and there is a lot of concern going around these days, especially as the recording methods are being scaled up very rapidly.</p><p>The paper and the analysis are very well written and convey all the information we need. I have almost no minor or major comments, but I do have one very serious concern. The paper is not really comparing ephys to ophys, but comparing ephys to L0-deconvolution of calcium imaging data. While I believe deconvoluton is absolutely crucial for interpreting 2p data correctly, the method chosen by the authors – L0 deconvolution – is problematic because it <italic>will</italic> result in exactly the kind of selectivity and responsiveness effects reported here. This is not merely a possibility, but a guaranteed consequence of L0-deconvolution because this method by design returns a very large fraction of zeros, effectively only picking up the &quot;top of the iceberg&quot; from the calcium traces.</p><p>The solution to this problem is clear: adjust the regularization constant in the L0 deconvolution all the way down to 0 and see how your results change. The Jewell et al. method will probably stop working correctly before you get to 0, in which case please use un-penalized OASIS, which is deconvolution with no regularization. Suite2p provides wrappers to do this with everything turned off (no parameter estimation and no regularization), and there are papers out there showing that the optimal value of the regularization constant is actually 0 for some ground truth data.</p><p>I would be extremely surprised if the results don't change substantially, and I am very curious to know exactly how they change.</p><p><italic>Reviewer #2:</italic></p><p>This paper addresses the important topic of comparing the data obtained from standard electrophysiology recordings to calcium imaging in a controlled experimental set up. Previously, most comparisons have been performed at the level of single cells with simultaneous ephys and imaging, and these comparisons have not addressed the topics discussed here, which are highly relevant to the field. Overall the paper and results are well presented. The conclusions and interpretations follow from the data presented. The discussion and analysis of pros and cons to each method are fair and valuable, in particular as the shortcomings of electrophysiology are sometimes not discussed in the literature. I therefore think this paper will be a valuable addition to the field. However, there are some shortcomings that need to be noted clearly and some potential extensions that could further enhance the impact of the work.</p><p>1. The major shortcoming of the paper is that it is focused on only a single labeling strategy for calcium imaging, namely using transgenic mice with the GCaMP6f indicator. The labeling strategy and indicator likely have very major impacts on the data obtained from calcium imaging. Specifically, expression levels can vary depending on the labeling approach, such as between viral methods and transgenic methods, which can affect the signal-to-noise ratio and the ability to detect single action potentials. Also, different indicators will have different detection thresholds. Here GCaMP6f was used, which is relatively insensitive, whereas a choice of GCaMP6s would have resulted in more detection of single action potentials. It is well known among experimenters in the field that viral labeling generally gives substantially higher signal-to-noise ratio compared to transgenic methods, including the transgenic methods used in this paper. This can be seen in some of the single-spike detection rates shown in the original GCaMP6 paper compared to subsequent efforts from the Allen Institute and others using transgenic mice. The same is true for GCaMP6s vs. GCaMP6f as was shown clearly in the original GCaMP6 paper. It is therefore the case that the differences between ephys and imaging could be different if viral methods were used and if GCaMP6s or GCaMP7 variants were used for the experiments. This is really important and currently the paper does not put emphasis on this point. The danger is that readers will think these results generalize to all calcium imaging studies, which I think is unlikely to be true, at least in the details, but perhaps in the general findings too. Obviously it is too much work to repeat all the experiments with a different indicator and/or labeling strategy. But, this is a critical point that must be addressed and presented very clearly. The authors must mention in the abstract that they used GCaMP6f and transgenic mice because these details are critical to the specifics of their findings. Furthermore, they should provide a detailed section in the discussion that points out that the results could vary substantially if different labeling methods and/or indicators are used. These issues raise another level of details regarding comparing studies, and it is critical that the authors discuss them thoroughly.</p><p>2. I very much liked the forward model to transform spikes to calcium events. I think it would also be useful to try deconvolution to transform calcium to spikes as well. I agree with the authors that this is an under-constrained problem without an ideal solution. However, there are common methods in the field that are frequently applied in calcium imaging papers. I suggest the authors use a common deconvolution approach and compare how this impacts the comparison between ephys and calcium imaging. I suggest this because most calcium imaging studies now analyze deconvolved data instead of the calcium events.</p><p>3. One of the very important findings is that the distribution of tuning preferences look to be similar between methods, for example for temporal frequency in Figure 2G. I think this point should be emphasized even more to point out the things that are similar between methods. I would also like to see these same distributions for other tuning parameters, such as spatial frequency, orientation, direction, and so on. It was not clear why the authors only showed temporal frequency.</p><p>4. It would be helpful to see additional metrics for selectivity beyond lifetime sparseness. I like the lifetime sparseness metric, but there are others that are more commonly used in the field and might help the reader to see. As one possibility, it might be helpful to see an orientation selectivity index as a comparison between ephys and calcium imaging data. I understand that this is not a general metric, but it is common in the field and thus potentially helpful.</p><p>5. The responsiveness measure seems reasonable, but it is based on a seemingly arbitrary threshold of 25% of trials with responses above 95% of the baseline period. What happens if this 25% threshold is varied? In addition, other measures of response reliability might be helpful. For example, trial-to-trial variability might be an interesting and important parameter to quantify, such as using the coefficient of variation or other metrics.</p><p>6. My understanding is that the calcium imaging data were segmented into cells using morphology based methods. This is not the current standard in the field. Most papers now use correlations in the fluorescence timeseries to help with segmentation. Is the segmentation obtained by the authors consistent with the segmentation obtained with more standard methods in the field, such as the cells obtained with Suite2P or CNMF? It might also be helpful for the authors to discuss how cell segmentation with calcium imaging, including neuropil contamination/subtraction, could impact the metrics they studied. The analysis of potential spike sorting artifacts or biases was informative, and something analogous could be, at the least, discussed for calcium imaging segmentation.</p><p>7. I do not like the introduction of the term 'ophys'. To me, this just adds another term to the field and likely results in more confusion rather than sticking with normal nomenclature in the field. I do not see what it adds over referring to the data as calcium imaging or two photon calcium imaging. If anything 'ophys' seems less precise because it could include voltage imaging too.</p><p><italic>Reviewer #3:</italic></p><p>This paper makes a step towards addressing a need in the community: understanding if measurements made with electrophysiology (ephys) and 2-photon imaging (2p) give the same result, and if not, in which way they differ and why. The best way to compare the two would be to do ephys and 2p at the same time (e.g. Wei,.… Druckmann, bioRxiv 2019). Next best would be to do them at different times but in the same neurons (which could be done here, because many of the ephys mice express GCaMP6f). This paper uses the third best approach: it does ephys and 2p in different mice. Not ideal but a useful exercise given the remarkably vast datasets.</p><p>The paper however contains some flawed analyses and meanders away from the main focus. It could be refocused e.g. by keeping the top half of Figure 1; a revised Figure 2; Figure 4; the top half of Figure 5, and a panel similar to Figure 4E, showing that once biases in cell selection are taken care of, the fraction of responsive neurons to different stimuli becomes the same. The current Figures 2 and 7 show analyses that are simply not ok, as explained below.</p><p>(1) The paper starts by making a flawed comparison between 2p and ephys data (Figure 2). One can't directly compare the output of ephys, i.e. spike trains that are sequences of 1s and 0s, with the deconvolved output of 2p, i.e. firing rates that range over 4 orders of magnitude. To compare those two measures of activity they must have the same units: either compute firing rates with common bin size (by binning the spike trains and resampling the deconvolved firing rates) or convolve the spike trains with a filter to match the GCaMP timecourse (as in Figure 4).</p><p>(2) Based on Figure 2, the paper finds two discrepancies: the 2p dataset has neurons with higher stimulus selectivity (Figure 2H) but a lower fraction of responsive neurons (Figure 2F). The first discrepancy disappears once the spikes measured with ephys are convolved with a reasonable filter that models the impulse response of GCaMP (Figure 4I). The second discrepancy remains (Figure 4E) but it disappears (does it? this is not fully shown) if one considers that the ephys data is biased towards neurons that fire more.</p><p>(3) The analysis of cell selection bias takes 3 long figures (Figure 5,6, and 7) without delivering the desired result: we need to see a figure with the same format as Figure 1F and Figure 4I, showing a match between the two techniques -- if such a match can be obtained.</p><p>(4) To address sampling bias introduced by the 2p processing pipeline, the paper explores the effect of setting a threshold at a given firing rate (p 13). However, the sampling bias may be more closely related to the procedures used to identify neurons in the 2p images. It seems that ROIs here are based on morphological properties without further manual curation (de Vries et al., 2020). This wide net will increase the total number of neurons, and thus likely decrease the fraction of responsive neurons, as pointed out by the same group (Mesa et al., bioRxiv). Subsampling using event rate reduces rather than increases overall selectivity, but in the Mesa et al. preprint, subsampling using a higher threshold for coefficient of variation (CV) increases selectivity with fewer neurons. So, at the very least, consider subsampling using CV to see whether this increases similarity between recording methods.</p><p>(5) Another reason for high sparseness/selectivity in the 2p data could be the deconvolution algorithm. Indeed L0 deconvolution, and L0 regularization in general, are intended to sparsify (e.g. as described in Pachitariu et al., 2018 J Neurosci). This could be dealt with by re-analyzing the dataset with different deconvolution algorithms, or vary the parameter λ governing the L0/L1 trade-off. Or perhaps better, one could make synthetic 2p data by convolving the ephys data and then deconvolve it to estimate firing rates. If they become sparser, there is a problem.</p><p>(6) The statistical test of Jensen-Shannon distance seems to find significant differences also where there barely are any. In some analyses (e.g. Figure 4I) the distributions look highly similar, yet are still judged to be statistically distinct. Is there an instance (e.g. within the same modality) where the Jensen-Shannon distance would ever be small enough to fail to reject the null? For example, by taking two sets of ephys data obtained from the same population in two different days.</p><p>(7) Figure 7 shows an unconvincing attempt at clustering neurons. It rests on a clustering process that seems dubious (t-SNE is geared to show data as clusters) and would require a whole paper to be convincing. It hinges on the existence and robustness of clusters of cells based on responses to a variety of stimuli. If there are clusters of that kind, that's a major discovery and it should get its own paper. But showing it convincingly would likely require long recordings (e.g. across days). It is not the kind of thing one shows at the end of a paper on a different topic. What we want at the end of this paper is to know whether the correction for selection bias explains the discrepancy shown in the simple analysis of Figure 4.</p><p>(8) The separate analysis of different visual areas adds complexity without delivering benefits. There is little reason to think that the relationship between spikes and calcium is different in neighboring cortical areas. If it is, then it's an interesting finding, but one that will require substantial burden of proof (as in simultaneous recordings). Otherwise it seems more logical to pool the neurons, greatly simplifying the paper. (This said, it does seem somewhat useful to separate the visual areas in Figure 4G, as they do have some differences in selectivity).</p><p>(9) The paper would be much stronger if it included an analysis of GCaMP6s data in addition to GCaMP6f. Are the same findings made with those mice?</p><p>(10) Are there consistent differences in reliability of the responses (repeatability across trials of same stimuli) in the two measures, and if so, does the convolution and selection biases explain these differences.</p><p>[Editors’ note: further revisions were suggested prior to acceptance, as described below.]</p><p>Thank you for resubmitting your work entitled &quot;Reconciling functional differences in populations of neurons recorded with two-photon imaging and electrophysiology&quot; for further consideration by <italic>eLife</italic>. Your revised article has been evaluated by Ronald Calabrese as the Senior and Reviewing Editor.</p><p>The manuscript has been improved but there are some remaining issues that need to be addressed, as outlined below:</p><p>The reviewers found the paper much improved but there is still some concern that the message is somewhat muddled and that readers are not being given the guidance they need to treat their data appropriately. In particular, please make sure readers come away with guidance on what to do with their data; please discuss this more and clarify this issue throughout the text. Recommendations for the Authors of Reviewer #1 will be helpful.</p><p><italic>Reviewer #1:</italic></p><p>My earlier review had suggested ways to make this paper briefer and more incisive so that it would have a clearer message. To summarize my opinion, the message would have been clearer if the paper started by listing the differences between the two methods (using an apples-to-apples comparison from the get-go) and then introduced the forward model and step by step indicated what one needs to do to make the differences go away. I would not introduce in the last figure a new result/analysis (the clusters of cell types) and use that one to illustrate the success of the forward model. I would drop that figure because it's a dubious (potentially interesting) result that would need its own paper to be convincing. By the time we arrive at that figure we should have established how we will judge a model's capabilities, rather than throw more data at the reader. This said, there are certainly many ways to write a paper, and it should be ok to ignore one reviewer's opinion on how to arrange an argument.</p><p>My main suggestion is to give the paper another look and try to convey a clearer message. For instance, take this sentence in abstract: &quot;However, the forward model could not reconcile differences in responsiveness without sub-selecting neurons based on event rate or level of signal contamination.&quot; If one took out the double negative (not/without) one would end up with a positive result: the forward model can indeed reconcile those differences, provided that one focuses on neurons with low contamination and sets a threshold for event rate. Writing things this way would actually honor the goal stated in the title: &quot;Reconciling functional differences…&quot;. Overall, it would be good if readers could come out with a clearer understanding of what they should do to their 2p data to make it more similar to ephys data, and what aspects they can trust and what aspects they cannot.</p><p><italic>Reviewer #2:</italic></p><p>Looks great to me, thanks for doing the extra analyses from Figure 3!</p><p><italic>Reviewer #3:</italic></p><p>I support publication of this paper and think it will be a nice addition to the field and of interest to a large number of readers. The paper is clearly written and presented. The addition of Figure 3 and new discussion points is helpful. I do not have remaining concerns or comments.</p></body></sub-article><sub-article article-type="reply" id="sa2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.69068.sa2</article-id><title-group><article-title>Author response</article-title></title-group></front-stub><body><disp-quote content-type="editor-comment"><p>Reviewer #1:</p><p>In this manuscript, Siegle, Ledochowitsch et al. compare two large datasets of neurons recorded by electrophysiology and two-photon calcium imaging respectively. They start by showing that there are substantial differences in the responsiveness and selectivity of the neurons, but those differences mostly go away after taking into account the details of these methods. This work is very useful information for anyone using ephys or ophys to record neurons from brains, which includes a lot of labs. It can become a priceless reference for everyone worried about what their data actually represents, and there is a lot of concern going around these days, especially as the recording methods are being scaled up very rapidly.</p><p>The paper and the analysis are very well written and convey all the information we need. I have almost no minor or major comments, but I do have one very serious concern. The paper is not really comparing ephys to ophys, but comparing ephys to L0-deconvolution of calcium imaging data. While I believe deconvoluton is absolutely crucial for interpreting 2p data correctly, the method chosen by the authors – L0 deconvolution --- is problematic because it will result in exactly the kind of selectivity and responsiveness effects reported here. This is not merely a possibility, but a guaranteed consequence of L0-deconvolution because this method by design returns a very large fraction of zeros, effectively only picking up the &quot;top of the iceberg&quot; from the calcium traces.</p><p>The solution to this problem is clear: adjust the regularization constant in the L0 deconvolution all the way down to 0 and see how your results change. The Jewell et al. method will probably stop working correctly before you get to 0, in which case please use un-penalized OASIS, which is deconvolution with no regularization. Suite2p provides wrappers to do this with everything turned off (no parameter estimation and no regularization), and there are papers out there showing that the optimal value of the regularization constant is actually 0 for some ground truth data.</p><p>I would be extremely surprised if the results don't change substantially, and I am very curious to know exactly how they change.</p></disp-quote><p>The reviewer brings up a crucial point: the approach to extracting dF/F events <italic>can</italic> have an impact on functional metrics. Following the reviewer’s advice, we have carried out a novel comparison of event detection methods that adds a valuable new dimension to the manuscript. Our overall conclusion – that selectivity and responsiveness can be biased by the presence/absence of low-amplitude events – represents an important contribution to the literature, which to our knowledge has not been considered in detail elsewhere.</p><p>We had previously selected the Jewell and Witten “exact L<sub>0</sub>” deconvolution method after extensive characterization of its performance on our ground truth dataset. We found that it performs almost as well as a more complex method, MLSpike, and is virtually indistinguishable from non-negative deconvolution in terms of its ability to predict ground truth firing rates. The main difference between exact L0 and NND – as pointed out by the reviewer – is that exact L0 returns far fewer events, due to the imposed sparsity constraint. Both methods reliably convert large changes in dF/F to events, but unpenalized NND additionally detects a larger number of small-amplitude events. Because these have a negligible impact on the correlation between the event time series and ground truth firing rate (since a tiny event is still a good estimate of 0 Hz spiking), we did not originally consider the impact these events could have on functional metrics. However, we have now demonstrated that they do change the apparent responsiveness and selectivity, to the point where it would be impossible to accurately compare results across imaging studies without taking the event detection methods into consideration. This point was made to some degree in the bioRxiv manuscript of Evans et al. (2019), which compared the scientific conclusions that resulted from applying various event detection algorithms to calcium responses measured in somatosensory cortex. We now explore these impacts in a more systematic way, and link them to a particular feature of deconvolution, the background rate of low-amplitude events.</p><p>We present these results in a new figure in the main text, Figure 3. When using unpenalized NND to extract events, we find that population selectivity levels are <italic>lower</italic> than we found with exact L0 (Figure 3F), while the responsive fraction of neurons is <italic>higher</italic> (Figure 3G). While at first glance this suggests a better match to the original ephys data, we find that these results are especially sensitive to the presence of low-amplitude events, which are quite prevalent in unpenalized NND. As we say in the manuscript, “By imposing the same noise-based threshold on the minimum event size that we originally computed to determine optimal regularization strength (essentially performing a post-hoc regularization), we are able to reconcile the results obtained with NND with those obtained via exact L0” (p. 10). We show that removing these events results in no change in the correlation with ground truth firing rate (3B), but a substantial reduction in “background” response magnitude (3C) as well as the rate of false positives (3D). These latter two factors have a big impact on selectivity and responsiveness – since events always have a positive magnitude, those detected near the noise floor cannot be canceled out by an equal fraction of negative-going events, as would occur when analyzing the DF/F trace directly.</p><p>Prior work validating event extraction methods has focused almost exclusively on maximizing the correlation between ground truth firing rate and total event amplitude within some time bin (but see Pachitariu et al., 2018 <italic>J Neurosci</italic> for a counterexample where response reliability was optimized instead). Here, we show that using correlation alone (which only quantifies a method’s ability to predict instantaneous firing rate) does not capture features of event extraction algorithms that have a clear impact on functional metrics (which average over many trials, and are thus quite sensitive to changes in background rate).</p><p>By modifying event extraction parameters in a way that affects the false positive rate of event detection, we can indeed increase the similarity between some metrics distributions across recording modalities. However, we caution against using this approach for the purposes of reconciliation across modalities because there is no unique parameter set that jointly reconciles responsiveness and selectivity, suggesting that this cannot be the whole story. We hesitate to treat the ephys data as ground truth in either case, since we know that spike trains can suffer from significant contamination.</p><p>We are grateful for the reviewer’s comments that inspired us to think more deeply about the effect of event extraction on the metrics we consider, culminating in the inclusion of the new analysis presented in Figure 3. It provides an essential complement to the revised manuscript’s Figure 5, in which we apply the same event extraction method on the real and simulated calcium traces, allowing us to account for the sparsifying effects of this analysis step.</p><disp-quote content-type="editor-comment"><p>Reviewer #2:</p><p>This paper addresses the important topic of comparing the data obtained from standard electrophysiology recordings to calcium imaging in a controlled experimental set up. Previously, most comparisons have been performed at the level of single cells with simultaneous ephys and imaging, and these comparisons have not addressed the topics discussed here, which are highly relevant to the field. Overall the paper and results are well presented. The conclusions and interpretations follow from the data presented. The discussion and analysis of pros and cons to each method are fair and valuable, in particular as the shortcomings of electrophysiology are sometimes not discussed in the literature. I therefore think this paper will be a valuable addition to the field. However, there are some shortcomings that need to be noted clearly and some potential extensions that could further enhance the impact of the work.</p><p>1. The major shortcoming of the paper is that it is focused on only a single labeling strategy for calcium imaging, namely using transgenic mice with the GCaMP6f indicator. The labeling strategy and indicator likely have very major impacts on the data obtained from calcium imaging. Specifically, expression levels can vary depending on the labeling approach, such as between viral methods and transgenic methods, which can affect the signal-to-noise ratio and the ability to detect single action potentials. Also, different indicators will have different detection thresholds. Here GCaMP6f was used, which is relatively insensitive, whereas a choice of GCaMP6s would have resulted in more detection of single action potentials. It is well known among experimenters in the field that viral labeling generally gives substantially higher signal-to-noise ratio compared to transgenic methods, including the transgenic methods used in this paper. This can be seen in some of the single-spike detection rates shown in the original GCaMP6 paper compared to subsequent efforts from the Allen Institute and others using transgenic mice. The same is true for GCaMP6s vs. GCaMP6f as was shown clearly in the original GCaMP6 paper. It is therefore the case that the differences between ephys and imaging could be different if viral methods were used and if GCaMP6s or GCaMP7 variants were used for the experiments. This is really important and currently the paper does not put emphasis on this point. The danger is that readers will think these results generalize to all calcium imaging studies, which I think is unlikely to be true, at least in the details, but perhaps in the general findings too. Obviously it is too much work to repeat all the experiments with a different indicator and/or labeling strategy. But, this is a critical point that must be addressed and presented very clearly. The authors must mention in the abstract that they used GCaMP6f and transgenic mice because these details are critical to the specifics of their findings. Furthermore, they should provide a detailed section in the discussion that points out that the results could vary substantially if different labeling methods and/or indicators are used. These issues raise another level of details regarding comparing studies, and it is critical that the authors discuss them thoroughly.</p></disp-quote><p>Following the reviewer’s suggestion, we have updated the abstract to emphasize that we are using transgenic mice: “Here, we compare evoked responses in visual cortex recorded in awake mice under highly standardized conditions using either imaging of genetically expressed GCaMP6f or electrophysiology with implanted silicon probes.”</p><p>While more experimental data is needed to verify that our results generalize to other calcium indicators or expression methods, we have reason to believe that they will. In our analysis of the forward model parameter sweep (which now appears in Figure S5), we see very little effect of fluorescence decay time on functional metrics for the same cells. This indicates that, for the same underlying physiology, we do not see differences when a GCaMP6s-like forward model is used. We have added a paragraph to the discussion that considers this point in more detail (p. 23), which is reproduced here:</p><p>“One potential limitation of our approach is that we have only imaged the activity of transgenically expressed calcium indicators, rather than indicators expressed using a viral approach. […] The full range of this sweep includes decay times that are consistent with GCaMP6s, and event amplitudes that are consistent with viral expression.”</p><disp-quote content-type="editor-comment"><p>2. I very much liked the forward model to transform spikes to calcium events. I think it would also be useful to try deconvolution to transform calcium to spikes as well. I agree with the authors that this is an under-constrained problem without an ideal solution. However, there are common methods in the field that are frequently applied in calcium imaging papers. I suggest the authors use a common deconvolution approach and compare how this impacts the comparison between ephys and calcium imaging. I suggest this because most calcium imaging studies now analyze deconvolved data instead of the calcium events.</p></disp-quote><p>Our approach to extracting events from the calcium fluorescence time series performs a similar function as other commonly used deconvolution methods: it transforms a continuous DF/F trace into a series of events with a time and an amplitude. We do not believe these events can be assumed to correspond to spikes, and are often only weakly correlated with the true underlying spike rate. Our own work (Huang, Ledochowitsch et al., 2021) and that of others (see e.g., Rupprecht et al., 2021) has shown that reliably detecting single action potentials in population recordings that use GCaMP6 is effectively impossible.</p><p>In order to address this point, Figure 2 now includes a detailed illustration of how response magnitudes are calculated for both ephys and imaging. We have also added a new main text figure that compares our original approach to event extraction, with one based on non-negative deconvolution (Figure 3). We find that the rate of low-amplitude (often false-positive) events has a big impact on functional metrics, an important new finding that, to the best of our knowledge, has not been previously addressed in the literature.</p><disp-quote content-type="editor-comment"><p>3. One of the very important findings is that the distribution of tuning preferences look to be similar between methods, for example for temporal frequency in Figure 2G. I think this point should be emphasized even more to point out the things that are similar between methods. I would also like to see these same distributions for other tuning parameters, such as spatial frequency, orientation, direction, and so on. It was not clear why the authors only showed temporal frequency.</p></disp-quote><p>We now include a new Supplementary Figure 1 comparing tuning preferences for the metrics listed by the reviewer. In general, there is good correspondence between the two modalities. Minor discrepancies include bias toward 0º drifting gratings in ophys, and bias toward lower spatial frequencies in imaging.</p><disp-quote content-type="editor-comment"><p>4. It would be helpful to see additional metrics for selectivity beyond lifetime sparseness. I like the lifetime sparseness metric, but there are others that are more commonly used in the field and might help the reader to see. As one possibility, it might be helpful to see an orientation selectivity index as a comparison between ephys and calcium imaging data. I understand that this is not a general metric, but it is common in the field and thus potentially helpful.</p></disp-quote><p>We now show the distributions of orientation selectivity and direction selectivity in panels D and E of Supplementary Figure 1, which show the same trend as lifetime sparseness. In general, we prefer to use lifetime sparseness for our primary analysis, because this metric can be applied to all stimulus types. However, it is also helpful to present the results for orientation selectivity and direction selectivity because they are more commonly used in the literature, as the reviewer has noted.</p><disp-quote content-type="editor-comment"><p>5. The responsiveness measure seems reasonable, but it is based on a seemingly arbitrary threshold of 25% of trials with responses above 95% of the baseline period. What happens if this 25% threshold is varied? In addition, other measures of response reliability might be helpful. For example, trial-to-trial variability might be an interesting and important parameter to quantify, such as using the coefficient of variation or other metrics.</p></disp-quote><p>The 25% threshold was chosen based on extensive visual inspection of neural responses. We sought to choose the lowest threshold that reliably detected what appeared to be “true” stimulus-evoked responses, while rejecting likely false positives. The key point for this analysis is that the same threshold is applied to both modalities. Further, we now note in the manuscript that our calculation of J–S distance takes into account the full distribution of reliability, not just the cells above the 25% threshold.</p><p>To address the reviewer’s point about trial-to-trial variability, we have included a new Supplementary Figure 7 showing that the coefficient of variation is very closely related to our original response reliability metric.</p><disp-quote content-type="editor-comment"><p>6. My understanding is that the calcium imaging data were segmented into cells using morphology based methods. This is not the current standard in the field. Most papers now use correlations in the fluorescence timeseries to help with segmentation. Is the segmentation obtained by the authors consistent with the segmentation obtained with more standard methods in the field, such as the cells obtained with Suite2P or CNMF? It might also be helpful for the authors to discuss how cell segmentation with calcium imaging, including neuropil contamination/subtraction, could impact the metrics they studied. The analysis of potential spike sorting artifacts or biases was informative, and something analogous could be, at the least, discussed for calcium imaging segmentation.</p></disp-quote><p>The segmentation method we have used is predominantly, though not exclusively, based on morphology. This allows us to identify neurons that are present but only rarely active. It is easy to see how exclusive reliance on activity correlations for cell detection may create a bias towards higher firing rates, similar to the bias present in ephys where units are completely invisible unless they are active. If Suite2P / CNMF suffer from such bias, then using those methods in our comparison would act similar to sub-selecting 2P imaged units by firing rate, which as we have seen, helps to reconcile responsiveness distributions. However, we would be missing out on fully appreciating the extent of bias that would be present in both compared modalities, and actually learn less about the true nature of the biological system in the process.</p><p>Moreover, to the best of our knowledge, there is not yet consensus in the field regarding the best segmentation method. Suite2P and CNMF are indeed widely used, but they are by no means the de facto standard. In our own testing, we have found that these two methods produce conflicting segmentation results on most of our experiments, about as different from one another as each would be from our own segmentation results. Additionally, the hyperparameter space for these segmentation methods is fairly high-dimensional and impractical to search exhaustively. Further, all segmentation methods require an annotation step, either manually or through training a classifier, to identify valid ROIs and exclude debris and other artifacts. This annotation step is likely to have further impacts on biases in the population. Overall, we feel that a full and comprehensive sensitivity analysis of how different segmentation methods might affect our results might uncover additional biases but would be beyond the scope of this manuscript.</p><disp-quote content-type="editor-comment"><p>7. I do not like the introduction of the term 'ophys'. To me, this just adds another term to the field and likely results in more confusion rather than sticking with normal nomenclature in the field. I do not see what it adds over referring to the data as calcium imaging or two photon calcium imaging. If anything 'ophys' seems less precise because it could include voltage imaging too.</p></disp-quote><p>We previously used ‘ophys’ as a convenient short-hand to denote our specific dataset as collected via two-photon calcium imaging. To avoid introducing a somewhat arbitrary new term into the literature, we have replaced this with “imaging” throughout the manuscript.</p><disp-quote content-type="editor-comment"><p>Reviewer #3:</p><p>This paper makes a step towards addressing a need in the community: understanding if measurements made with electrophysiology (ephys) and 2-photon imaging (2p) give the same result, and if not, in which way they differ and why. The best way to compare the two would be to do ephys and 2p at the same time (e.g. Wei,.… Druckmann, bioRxiv 2019). Next best would be to do them at different times but in the same neurons (which could be done here, because many of the ephys mice express GCaMP6f). This paper uses the third best approach: it does ephys and 2p in different mice. Not ideal but a useful exercise given the remarkably vast datasets.</p></disp-quote><p>We agree that characterizing functional metrics in simultaneous 2P and ephys recordings, or serial recordings from the same set of neurons, would alleviate some of the confounds of recording from distinct populations for each modality. However, we would like to point out that such experiments are extremely difficult and low-yield and have not, in fact, been attempted in any publication that we are aware of (including the one by Wei et al.). If one has recorded from a population of cells using twophoton imaging, it would require a heroic effort to sample the exact same set cells using electrophysiology, especially considering the relatively orthogonal geometry of these two modalities. Given current technology, the only practical way to obtain comparable data from large populations of cells is to record each modality separately.</p><p>The Wei et al. work (now published in <italic>PLoS Computational Biology</italic>) takes an approach similar to our own: the ephys and 2P recordings they use to compute functional metrics all take place in separate mice. Their simultaneous 2P and ephys recordings are only used to calibrate the spikes-to-calcium forward model. These recordings are typically very short (on the order of a few minutes), and are often performed under anesthetized conditions. We have previously collected a similar set of simultaneous recordings (Ledochowitsch et al., 2019; Huang et al. 2019), which we use for the same purpose. We now include new analysis of this data in Figure 3, in order to demonstrate the impact of event extraction parameters on selectivity and responsiveness metrics.</p><disp-quote content-type="editor-comment"><p>The paper however contains some flawed analyses and meanders away from the main focus. It could be refocused e.g. by keeping the top half of Figure 1; a revised Figure 2; Figure 4; the top half of Figure 5, and a panel similar to Figure 4E, showing that once biases in cell selection are taken care of, the fraction of responsive neurons to different stimuli becomes the same. The current Figures 2 and 7 show analyses that are simply not ok, as explained below.</p></disp-quote><p>We thank the reviewer for these suggestions. Hopefully after reading our responses below, the justification for including all of the original figures will become clear.</p><disp-quote content-type="editor-comment"><p>(1) The paper starts by making a flawed comparison between 2p and ephys data (Figure 2). One can't directly compare the output of ephys, i.e. spike trains that are sequences of 1s and 0s, with the deconvolved output of 2p, i.e. firing rates that range over 4 orders of magnitude. To compare those two measures of activity they must have the same units: either compute firing rates with common bin size (by binning the spike trains and resampling the deconvolved firing rates) or convolve the spike trains with a filter to match the GCaMP timecourse (as in Figure 4).</p></disp-quote><p>The reviewer raises a critical point, which is that an apples-to-apples comparison of 2P and ephys data is tricky, given the fundamental differences between these two modalities. In order to address this shortcoming, we have taken the approach that the reviewer suggests: all the analyses in (original) Figure 4, 5, and 6 are carried out after applying a spikes-to-calcium forward model to the ephys data.</p><p>The purpose of Figure 2 is to highlight the differences between 2P and ephys as they are typically analyzed in the literature, prior to any attempt at reconciliation. Besides the Wei et al. paper, such a direct comparison has not been undertaken previously. We therefore feel it is essential to present these “baseline” results before we show the effects of applying the spikes-to-calcium forward model. Even though the underlying signals have different units, we can still derive the same functional metrics for both datasets (e.g., selectivity, responsiveness, and preference). We have chosen to compare these derived metrics, rather than comparing spike trains and 2P events directly. Furthermore, in all cases, we calculate the responses for both modalities using a common bin size (2 s for drifting gratings, 250 ms for static gratings and natural scenes, and 33 ms for natural videos).</p><p>We have now updated Figure 2 to include a comparison of the steps involved in extracting response magnitudes from the ephys and imaging data. We have also added a new Figure 3, which shows how the parameters of the DF/F event extraction can bias the functional metrics. We believe it is essential to present this baseline analysis prior to diving into the results obtained after applying the forward model to the ephys data.</p><disp-quote content-type="editor-comment"><p>(2) Based on Figure 2, the paper finds two discrepancies: the 2p dataset has neurons with higher stimulus selectivity (Figure 2H) but a lower fraction of responsive neurons (Figure 2F). The first discrepancy disappears once the spikes measured with ephys are convolved with a reasonable filter that models the impulse response of GCaMP (Figure 4I). The second discrepancy remains (Figure 4E) but it disappears (does it? this is not fully shown) if one considers that the ephys data is biased towards neurons that fire more.</p></disp-quote><p>The reviewer is correct that the two main discrepancies in the baseline analysis (Figure 2) are the apparent higher selectivity in the 2P data, and the apparent higher fraction of responsive neurons in the ephys data. The difference in selectivity can be mostly – but not completely – reconciled by applying the forward model (this is more than just a convolution, as it is highly nonlinear). This is shown in (original) Figure 4I, 6B, 6C, and 6D, and is summarized in Figure 6A. The difference in responsiveness can be mostly</p><p>– but not completely – reconciled by filtering out low-event-rate cells from the 2P data (original Figure 5A) or filtering out contaminated cells from the ephys data (Figure 5C). This point was also summarized in the original Figure 6A.</p><p>We have stated these conclusions explicitly in the following sentences in the discussion:</p><p>“Even after accounting for these known factors to the best of our ability, the overall population from our imaging experiments still displayed higher selectivity than its ephys counterpart.” (p. 23)</p><p>“In order to reconcile some of these differences [in responsiveness], we could either apply a very strict threshold on ISI violations score to the ephys dataset, or remove between 61-93% of the least active neurons from the imaging dataset.” (p. 23)</p><disp-quote content-type="editor-comment"><p>(3) The analysis of cell selection bias takes 3 long figures (Figure 5,6, and 7) without delivering the desired result: we need to see a figure with the same format as Figure 1F and Figure 4I, showing a match between the two techniques – if such a match can be obtained.</p></disp-quote><p>We would like to clarify some points for the reviewer:</p><p>Only (original) Figure 5 is about cell selection bias. It shows the impact of sub-selecting cells based on their event rate (2P) or contamination level (ephys). Because the curves do not reach 0 (perfectly overlapping distributions), we conclude that sub-selection is not sufficient to fully reconcile the results of both modalities.</p><p>Our original Figure 6 summarizes the impact of all of the transformations we have carried out, including layer matching, behavioral state matching, and the spikes-to-calcium forward model, in addition to sub-selecting cells, for all of the stimuli used. We believe that Figure 6A may already contain the information the reviewer was expecting to see. The panels on the right-hand side show the cumulative effects of applying the forward model (yellow shaded region) and the cell selection procedures (“Events” and “ISI” columns). In order to save space, instead of showing the full distribution of selectivities for all areas (as in the original Figure 4I), we just show the J–S distances for each area.</p><p>Our original Figure 7 shows how we can apply our knowledge of inter-modal differences to achieve a useful scientific result. The justification for including this figure is explained below.</p><disp-quote content-type="editor-comment"><p>(4) To address sampling bias introduced by the 2p processing pipeline, the paper explores the effect of setting a threshold at a given firing rate (p 13). However, the sampling bias may be more closely related to the procedures used to identify neurons in the 2p images. It seems that ROIs here are based on morphological properties without further manual curation (de Vries et al., 2020). This wide net will increase the total number of neurons, and thus likely decrease the fraction of responsive neurons, as pointed out by the same group (Mesa et al., bioRxiv). Subsampling using event rate reduces rather than increases overall selectivity, but in the Mesa et al. preprint, subsampling using a higher threshold for coefficient of variation (CV) increases selectivity with fewer neurons. So, at the very least, consider subsampling using CV to see whether this increases similarity between recording methods.</p></disp-quote><p>We think it is important to clarify several points here. First, we explored the effect of selecting imaging cells on their event rate in order to examine the sampling bias of electrophysiology, not of the 2P processing pipeline. Second, ROIs do in fact undergo curation using an automated classifier trained on manually annotated data, in order to remove cell fragments or processes from further analysis, as described in de Vries et al. (2020). Third, Mesa et al. (now published in eNeuro) does not claim that simply by recording more neurons one would expect a lower fraction of responsive neurons. Rather, that paper examined the impact of different definitions of “responsiveness” on the resulting population metrics. The authors examined the effects of sub-sampling neurons by <italic>lowering</italic> the coefficient of variation threshold (so only more robustly responding cells are included). When analyzing fewer, more robust neurons, they found that direction selectivity went down, but that orientation selectivity increased slightly for only the <italic>very</italic> most robust neurons. Event rate is (roughly) one axis of CV, but as it doesn’t include any information about variability, it is possible that these could have different effects on the measured metrics. Following the reviewer’s suggestion, we tried sub-sampling the cells in the imaging data based on their coefficient of variation (Supplementary Figure 7). The results appear very similar to the effects of filtering by event rate; cells with lower CV (more robustness) tend to be more responsive, and also have slightly higher selectivity (as measured by lifetime sparseness). But again, this is only for the most robust neurons with the lowest CV. We also include a panel in the same figure showing that CV is strongly negatively correlated with our original metric for response reliability, the fraction of preferred condition trials with event magnitudes higher than 95% of baseline intervals. Based on this, we believe that the responsiveness criterion we used, as a threshold on this response reliability, is effective at identifying robust responses.</p><disp-quote content-type="editor-comment"><p>(5) Another reason for high sparseness/selectivity in the 2p data could be the deconvolution algorithm. Indeed L0 deconvolution, and L0 regularization in general, are intended to sparsify (e.g. as described in Pachitariu et al., 2018 J Neurosci). This could be dealt with by re-analyzing the dataset with different deconvolution algorithms, or vary the parameter λ governing the L0/L1 trade-off. Or perhaps better, one could make synthetic 2p data by convolving the ephys data and then deconvolve it to estimate firing rates. If they become sparser, there is a problem.</p></disp-quote><p>This is a very similar to the main point raised by Reviewer #1, and we believe it is an important one. The choice of λ does have an impact on functional metrics, specifically because it has a very strong impact on the overall sparseness of the deconvolved data (in terms of event rate). As the effect of regularization is lessened, more events are extracted from the 2P data, most of which are false positives that are detected in the absence of a true underlying spike. We originally chose the exact L0 method (and the corresponding λ values) based on its ability to predict firing rates in the ground truth data. But we now realize that there are other features of the event detection step that can affect responsiveness and selectivity metrics.</p><p>We have taken several steps to address this issue in the revised manuscript:</p><p>1. We have added a new section and main text figure that demonstrate how the approach to deconvolution impacts our results, with an explicit comparison between exact L0 (our original method) and non-negative deconvolution, a method that has been shown to out-perform more complex algorithms on ground truth datasets (p. 8-11)</p><p>2. We have added new figure panels 3B-D showing that low-amplitude events can be removed from the data (essentially, performing a post-hoc regularization step) without affecting correlation with ground truth firing rate.</p><p>3. We have added figure panels 3E-G showing that we can achieve nearly arbitrary levels of responsiveness and selectivity in the 2P dataset by varying the post-hoc event amplitude threshold. We show that changing the parameters of this thresholding step can reconcile the results from ephys and imaging—however, responsiveness and selectivity are matched at different threshold levels, suggesting that this cannot be the whole store.</p><p>We would also like to point out that we do not view the apparent sparsification seen in both real and simulated 2P data as a “problem,” but rather an inherent property of the methodology itself. We know from the ground truth experiments that a significant fraction of spikes do not produce detectable calcium transients (Ledochowitsch et al., 2019). Furthermore, the nonlinear relationship between spike rate and event amplitude (i.e., a few spikes can produce very large events if they occur as part of a burst but smaller events if they are separated in time), leads to further sparsification. The overall goal of our manuscript is to accurately characterize the effect of this sparsification on derived functional metrics, rather than to try to eliminate it.</p><disp-quote content-type="editor-comment"><p>(6) The statistical test of Jensen-Shannon distance seems to find significant differences also where there barely are any. In some analyses (e.g. Figure 4I) the distributions look highly similar, yet are still judged to be statistically distinct. Is there an instance (e.g. within the same modality) where the Jensen-Shannon distance would ever be small enough to fail to reject the null? For example, by taking two sets of ephys data obtained from the same population in two different days.</p></disp-quote><p>Jensen–Shannon distance by itself is not a statistical test. Instead, we apply a bootstrap procedure to determine the distribution of distances that can be expected by sub-sampling the same set of within modality data. For the selectivity differences in Figure 4I, we find that 100% of these bootstrapped values fall under 0.14, the average distance between the inter-modality distributions. Therefore, the distance between the two distributions—although relatively small—is still larger than what would be expected to occur by chance. The details of, and justification for, this procedure are now described more thoroughly in our methods section (p. 31).</p><disp-quote content-type="editor-comment"><p>(7) Figure 7 shows an unconvincing attempt at clustering neurons. It rests on a clustering process that seems dubious (t-SNE is geared to show data as clusters) and would require a whole paper to be convincing. It hinges on the existence and robustness of clusters of cells based on responses to a variety of stimuli. If there are clusters of that kind, that's a major discovery and it should get its own paper. But showing it convincingly would likely require long recordings (e.g. across days). It is not the kind of thing one shows at the end of a paper on a different topic. What we want at the end of this paper is to know whether the correction for selection bias explains the discrepancy shown in the simple analysis of Figure 4.</p></disp-quote><p>The t-SNE plot in (original) Figure 7 is used for visualization purposes only, which we now state in figure caption for (new) Figure 8. The clusters are derived via the Gaussian mixture model approach used in de Vries et al. (2020). The functional clusters we observe are consistent across many repeats of the same procedure with randomization of initial conditions, so we believe they are sufficiently robust to subject to further analysis.</p><p>The purpose of including Figure 7 was not to show the distribution of function clusters per se, but rather to highlight how our understanding of baseline differences between 2P and ephys can be applied to a scientific question that goes beyond single-cell functional metrics. We find that a naive application of the same method to the ephys data yields qualitatively different results (Figure 7B). However, once we account for the higher baseline responsiveness in ephys, the distribution of functional clusters is well matched (Figure 7E). We consider Figure 7 to be a satisfying illustration of how the conclusions of the present manuscript can guide future analysis efforts.</p><p>If the reviewer still thinks this is too far off topic to include, we would consider instead concluding with Figure 6, which summarizes how well various corrections can reduce discrepancies between the two modalities.</p><disp-quote content-type="editor-comment"><p>(8) The separate analysis of different visual areas adds complexity without delivering benefits. There is little reason to think that the relationship between spikes and calcium is different in neighboring cortical areas. If it is, then it's an interesting finding, but one that will require substantial burden of proof (as in simultaneous recordings). Otherwise it seems more logical to pool the neurons, greatly simplifying the paper. (This said, it does seem somewhat useful to separate the visual areas in Figure 4G, as they do have some differences in selectivity).</p></disp-quote><p>There are a number of reasons why we decided to analyze each area separately:</p><p>1. Our ephys and imaging datasets include different relative numbers of cells from each area. For example, the imaging dataset has many more cells from V1. If we aggregated cells across all areas, it would have been necessary to perform sub-selection in order to match the area distributions, which would have decreased the overall sample size. Prior literature has established clear functional differences between mouse visual areas, in terms of their preferred spatial/temporal frequencies (e.g., Andermann et al., 2011; Marshel et al., 2011), and we did not want these underlying functional differences to impact our results.</p><p>2. The bursting properties of individual areas differ somewhat (Figure 3D), and we originally thought this could have an impact on the detectability of calcium transients (and hence our ability to detect responsive neurons). We know that overall responsiveness decreases along the visual hierarchy (from V1 to AM; Figure 2F), and this corresponds with a decrease in burstiness (Figure 3D). However, we found that these intrinsic properties did not have an appreciable impact on responsiveness, based on our forward model (Figure 4E). Such conclusions could not be reached without analyzing each area individually.</p><p>3. By treating each area as an independent sample (even though some of the cells come from the same mouse), it increases the power of our overall conclusions.</p><disp-quote content-type="editor-comment"><p>(9) The paper would be much stronger if it included an analysis of GCaMP6s data in addition to GCaMP6f. Are the same findings made with those mice?</p></disp-quote><p>At present, we do not have enough data from GCaMP6s mice to say whether or not the results generalize to other types of indicators. However, in our analysis of the forward model parameter sweep (which now appears in Supplementary Figure 6), we see very little effect of fluorescence decay time on functional metrics for the same cells. This indicates that, for the same underlying physiology, we do not see differences when a GCaMP6s-like forward model is used. We have added a paragraph to the discussion that considers this point in more detail (p. 23), which is reproduced here:</p><p>“One potential limitation of our approach is that we have only imaged the activity of transgenically expressed calcium indicators, rather than indicators expressed using a viral approach. […] The full range of this sweep includes decay times that are consistent with GCaMP6s, and event amplitudes that are consistent with viral expression.”</p><disp-quote content-type="editor-comment"><p>(10) Are there consistent differences in reliability of the responses (repeatability across trials of same stimuli) in the two measures, and if so, does the convolution and selection biases explain these differences.</p></disp-quote><p>The response reliability is consistently higher in ephys than in imaging, both before and after applying the forward model. In <xref ref-type="fig" rid="sa2fig1">Author response image 1</xref>, there is a higher fraction of ephys cells included for every reliability threshold, except at the very lowest levels (the 0.25 threshold we use throughout the manuscript is indicated with a dotted line).</p><fig id="sa2fig1"><label>Author response image 1.</label><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-69068-resp-fig1-v1.tif"/></fig><p>As we show in (original) Figure 4D, the forward model does not change the overall reliability of cells from the ephys dataset. This is because responses to preferred stimuli in ephys often include spike bursts, which are translated into large-amplitude calcium events by the forward model. Therefore, we believe the most likely explanation for the higher reliability seen in ephys is either:<italic>1.</italic> Selection bias for more active cells in ephys – we show in Figure 5A that selecting the most active cells from the imaging dataset can make the response reliability distributions appear more similar.</p><p><italic>2.</italic> Spike train contamination in the ephys data – we show in Figure 5C that selecting the least contaminated cells from the ephys dataset can make the response reliability distributions appear more similar.</p><p>[Editors’ note: what follows is the authors’ response to the second round of review.]</p><disp-quote content-type="editor-comment"><p>Reviewer #1:</p><p>My earlier review had suggested ways to make this paper briefer and more incisive so that it would have a clearer message. To summarize my opinion, the message would have been clearer if the paper started by listing the differences between the two methods (using an apples-to-apples comparison from the get-go) and then introduced the forward model and step by step indicated what one needs to do to make the differences go away. I would not introduce in the last figure a new result/analysis (the clusters of cell types) and use that one to illustrate the success of the forward model. I would drop that figure because it's a dubious (potentially interesting) result that would need its own paper to be convincing. By the time we arrive at that figure we should have established how we will judge a model's capabilities, rather than throw more data at the reader. This said, there are certainly many ways to write a paper, and it should be ok to ignore one reviewer's opinion on how to arrange an argument.</p></disp-quote><p>We thank the reviewer for this constructive feedback. As suggested, we have added an extended new section that explicitly outlines the specific scenarios where inter-modality reconciliation is likely needed, and what steps should be taken to account for apparent discrepancies (“Lessons for future comparison”). As we state in the manuscript, the ultimate goal is not to completely eliminate differences, but to probe the extend to which differences are consistent with known biases inherent to each modality. We aim to call attention to the fact that these biases exist (something that is often overlooked in the literature), and to provide a clearer understanding of their origins. We hope this new section will provide readers with a set of actionable takeaways that they can apply to their own results, as this reviewer suggested.</p><p>Second, we shortened, streamlined, and re-framed our presentation of the last figure (Figure 8) in a new section titled “Interpreting higher-order analyses in light of our findings.” We agree with the reviewer that, previously, the purpose of this figure was not sufficiently clear. In this revision, we articulate more clearly and explicitly that this was not meant to be a novel result about neuronal functional classification. Rather, we were revisiting one of our recent published results in order to illustrate a scenario in which applying the same analysis to imaging and ephys data would yield seemingly conflicting conclusions. We show that after accounting for a specific bias (higher responsiveness in the ephys data), our originally published classification result (based on imaging) still remains true. This particular example also provides additional value because it demonstrates that biases affecting responsiveness can have more insidious and non-obvious effects on analysis outcome than merely acting as a filter for neuronal inclusion/exclusion.</p><disp-quote content-type="editor-comment"><p>My main suggestion is to give the paper another look and try to convey a clearer message. For instance, take this sentence in abstract: &quot;However, the forward model could not reconcile differences in responsiveness without sub-selecting neurons based on event rate or level of signal contamination.&quot; If one took out the double negative (not/without) one would end up with a positive result: the forward model can indeed reconcile those differences, provided that one focuses on neurons with low contamination and sets a threshold for event rate. Writing things this way would actually honor the goal stated in the title: &quot;Reconciling functional differences…&quot;. Overall, it would be good if readers could come out with a clearer understanding of what they should do to their 2p data to make it more similar to ephys data, and what aspects they can trust and what aspects they cannot.</p></disp-quote><p>We fully agree that the manuscript was previously missing an easily digestible summary of our findings. As mentioned above, we have added a new section titled, “Lessons for future comparisons,” addressing this concern.</p><p>We also updated the relevant sentence in the abstract, which now reads, “However, the forward model could only reconcile differences in responsiveness when restricted to neurons with low contamination and a threshold for event rate.”</p></body></sub-article></article>