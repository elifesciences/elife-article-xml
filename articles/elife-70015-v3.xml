<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD with MathML3 v1.2 20190208//EN"  "JATS-archivearticle1-mathml3.dtd"><article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.2"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn publication-format="electronic" pub-type="epub">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">70015</article-id><article-id pub-id-type="doi">10.7554/eLife.70015</article-id><article-categories><subj-group subj-group-type="display-channel"><subject>Research Article</subject></subj-group><subj-group subj-group-type="heading"><subject>Computational and Systems Biology</subject></subj-group><subj-group subj-group-type="heading"><subject>Neuroscience</subject></subj-group></article-categories><title-group><article-title>High-throughput automated methods for classical and operant conditioning of <italic>Drosophila</italic> larvae</article-title></title-group><contrib-group><contrib contrib-type="author" equal-contrib="yes" id="author-241399"><name><surname>Croteau-Chonka</surname><given-names>Elise C</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0001-5116-3772</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="equal-contrib1">†</xref><xref ref-type="other" rid="fund4"/><xref ref-type="other" rid="fund7"/><xref ref-type="other" rid="fund2"/><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" equal-contrib="yes" id="author-288377"><name><surname>Clayton</surname><given-names>Michael S</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-1152-9199</contrib-id><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="fn" rid="equal-contrib1">†</xref><xref ref-type="other" rid="fund8"/><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-288378"><name><surname>Venkatasubramanian</surname><given-names>Lalanti</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-9280-8335</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund9"/><xref ref-type="other" rid="fund7"/><xref ref-type="fn" rid="con3"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-288379"><name><surname>Harris</surname><given-names>Samuel N</given-names></name><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="other" rid="fund8"/><xref ref-type="fn" rid="con4"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-288380"><name><surname>Jones</surname><given-names>Benjamin MW</given-names></name><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="other" rid="fund8"/><xref ref-type="fn" rid="con5"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-241396"><name><surname>Narayan</surname><given-names>Lakshmi</given-names></name><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="con6"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-209263"><name><surname>Winding</surname><given-names>Michael</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="other" rid="fund7"/><xref ref-type="other" rid="fund5"/><xref ref-type="fn" rid="con7"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-172133"><name><surname>Masson</surname><given-names>Jean-Baptiste</given-names></name><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="other" rid="fund3"/><xref ref-type="fn" rid="con8"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" corresp="yes" equal-contrib="yes" id="author-208808"><name><surname>Zlatic</surname><given-names>Marta</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-3149-2250</contrib-id><email>mzlatic@mrc-lmb.cam.ac.uk</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="fn" rid="equal-contrib2">‡</xref><xref ref-type="other" rid="fund6"/><xref ref-type="other" rid="fund3"/><xref ref-type="fn" rid="con9"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" corresp="yes" equal-contrib="yes" id="author-241398"><name><surname>Klein</surname><given-names>Kristina T</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-8772-3628</contrib-id><email>kristina.t.klein@gmail.com</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="equal-contrib2">‡</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con10"/><xref ref-type="fn" rid="conf1"/></contrib><aff id="aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/013meh722</institution-id><institution>Department of Zoology, University of Cambridge</institution></institution-wrap><addr-line><named-content content-type="city">Cambridge</named-content></addr-line><country>United Kingdom</country></aff><aff id="aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/006w34k90</institution-id><institution>Janelia Research Campus, Howard Hughes Medical Institute</institution></institution-wrap><addr-line><named-content content-type="city">Ashburn</named-content></addr-line><country>United States</country></aff><aff id="aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/00tw3jy02</institution-id><institution>MRC Laboratory of Molecular Biology</institution></institution-wrap><addr-line><named-content content-type="city">Cambridge</named-content></addr-line><country>United Kingdom</country></aff><aff id="aff4"><label>4</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/0495fxg12</institution-id><institution>Decision and Bayesian Computation, Neuroscience Department &amp; Computational Biology Department, Institut Pasteur</institution></institution-wrap><addr-line><named-content content-type="city">Paris</named-content></addr-line><country>France</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Samuel</surname><given-names>Aravinthan DT</given-names></name><role>Reviewing Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/03vek6s52</institution-id><institution>Harvard University</institution></institution-wrap><country>United States</country></aff></contrib><contrib contrib-type="senior_editor"><name><surname>VijayRaghavan</surname><given-names>K</given-names></name><role>Senior Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/03gf8rp76</institution-id><institution>National Centre for Biological Sciences, Tata Institute of Fundamental Research</institution></institution-wrap><country>India</country></aff></contrib></contrib-group><author-notes><fn fn-type="con" id="equal-contrib1"><label>†</label><p>These authors contributed equally to this work</p></fn><fn fn-type="con" id="equal-contrib2"><label>‡</label><p>These authors also contributed equally to this work</p></fn></author-notes><pub-date publication-format="electronic" date-type="publication"><day>28</day><month>10</month><year>2022</year></pub-date><pub-date pub-type="collection"><year>2022</year></pub-date><volume>11</volume><elocation-id>e70015</elocation-id><history><date date-type="received" iso-8601-date="2021-05-04"><day>04</day><month>05</month><year>2021</year></date><date date-type="accepted" iso-8601-date="2022-10-26"><day>26</day><month>10</month><year>2022</year></date></history><pub-history><event><event-desc>This manuscript was published as a preprint at .</event-desc><date date-type="preprint" iso-8601-date="2021-06-14"><day>14</day><month>06</month><year>2021</year></date><self-uri content-type="preprint" xlink:href="https://doi.org/10.1101/2021.06.14.448341"/></event></pub-history><permissions><copyright-statement>© 2022, Croteau-Chonka, Clayton et al</copyright-statement><copyright-year>2022</copyright-year><copyright-holder>Croteau-Chonka, Clayton et al</copyright-holder><ali:free_to_read/><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><ali:license_ref>http://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-70015-v3.pdf"/><self-uri content-type="figures-pdf" xlink:href="elife-70015-figures-v3.pdf"/><abstract><p>Learning which stimuli (classical conditioning) or which actions (operant conditioning) predict rewards or punishments can improve chances of survival. However, the circuit mechanisms that underlie distinct types of associative learning are still not fully understood. Automated, high-throughput paradigms for studying different types of associative learning, combined with manipulation of specific neurons in freely behaving animals, can help advance this field. The <italic>Drosophila melanogaster</italic> larva is a tractable model system for studying the circuit basis of behaviour, but many forms of associative learning have not yet been demonstrated in this animal. Here, we developed a high-throughput (i.e. multi-larva) training system that combines real-time behaviour detection of freely moving larvae with targeted opto- and thermogenetic stimulation of tracked animals. Both stimuli are controlled in either open- or closed-loop, and delivered with high temporal and spatial precision. Using this tracker, we show for the first time that <italic>Drosophila</italic> larvae can perform classical conditioning with no overlap between sensory stimuli (i.e. trace conditioning). We also demonstrate that larvae are capable of operant conditioning by inducing a bend direction preference through optogenetic activation of reward-encoding serotonergic neurons. Our results extend the known associative learning capacities of <italic>Drosophila</italic> larvae. Our automated training rig will facilitate the study of many different forms of associative learning and the identification of the neural circuits that underpin them.</p></abstract><kwd-group kwd-group-type="author-keywords"><kwd>operant conditioning</kwd><kwd>trace conditioning</kwd><kwd>closed-loop tracking</kwd><kwd>computer vision</kwd><kwd>behavior detection</kwd><kwd><italic>Drosophila melanogaster</italic> larva</kwd><kwd>stimulation</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research organism</title><kwd><italic>D. melanogaster</italic></kwd></kwd-group><funding-group><award-group id="fund1"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100005370</institution-id><institution>Gates Cambridge Trust</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Klein</surname><given-names>Kristina T</given-names></name></principal-award-recipient></award-group><award-group id="fund2"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100003343</institution-id><institution>Cambridge Commonwealth, European &amp; International Trust</institution></institution-wrap></funding-source><award-id>C T Taylor Cambridge International Scholarship</award-id><principal-award-recipient><name><surname>Croteau-Chonka</surname><given-names>Elise C</given-names></name></principal-award-recipient></award-group><award-group id="fund3"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000011</institution-id><institution>Howard Hughes Medical Institute Janelia Research Campus Visitor Scientist Program</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Zlatic</surname><given-names>Marta</given-names></name><name><surname>Masson</surname><given-names>Jean-Baptiste</given-names></name></principal-award-recipient></award-group><award-group id="fund4"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000727</institution-id><institution>Trinity College, University of Cambridge</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Croteau-Chonka</surname><given-names>Elise C</given-names></name></principal-award-recipient></award-group><award-group id="fund5"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000011</institution-id><institution>Howard Hughes Medical Institute Janelia Research Campus</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Zlatic</surname><given-names>Marta</given-names></name><name><surname>Winding</surname><given-names>Michael</given-names></name></principal-award-recipient></award-group><award-group id="fund6"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000781</institution-id><institution>European Research Council</institution></institution-wrap></funding-source><award-id>LeaRNN - 819650</award-id><principal-award-recipient><name><surname>Zlatic</surname><given-names>Marta</given-names></name></principal-award-recipient></award-group><award-group id="fund7"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100004440</institution-id><institution>Wellcome Trust</institution></institution-wrap></funding-source><award-id>205050/B/16/Z</award-id><principal-award-recipient><name><surname>Zlatic</surname><given-names>Marta</given-names></name><name><surname>Venkatasubramanian</surname><given-names>Lalanti</given-names></name><name><surname>Croteau-Chonka</surname><given-names>Elise C</given-names></name><name><surname>Winding</surname><given-names>Michael</given-names></name></principal-award-recipient></award-group><award-group id="fund8"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000265</institution-id><institution>Medical Research Council</institution></institution-wrap></funding-source><award-id>MC_UP_1201/20</award-id><principal-award-recipient><name><surname>Zlatic</surname><given-names>Marta</given-names></name><name><surname>Clayton</surname><given-names>Michael S</given-names></name><name><surname>Jones</surname><given-names>Benjamin MW</given-names></name><name><surname>Harris</surname><given-names>Samuel N</given-names></name></principal-award-recipient></award-group><award-group id="fund9"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100004412</institution-id><institution>Human Frontier Science Program</institution></institution-wrap></funding-source><award-id>LT00600/2020-L</award-id><principal-award-recipient><name><surname>Venkatasubramanian</surname><given-names>Lalanti</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication. For the purpose of Open Access, the authors have applied a CC BY public copyright license to any Author Accepted Manuscript version arising from this submission.</funding-statement></funding-group><custom-meta-group><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>A novel high-throughput FPGA-based multi-animal tracking and training system was used to demonstrate trace and operant conditioning in <italic>Drosophila</italic> larvae.</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>Animals must rapidly alter their behaviour in response to environmental changes. An important adaptation strategy is associative learning (<xref ref-type="bibr" rid="bib33">Dickinson, 1981</xref>; <xref ref-type="bibr" rid="bib125">Rescorla, 1988</xref>), in which an animal learns to predict an unconditioned stimulus (US) by the occurrence of a conditioned stimulus (CS). The US is often a punishing or rewarding event such as pain or the discovery of a new food source (<xref ref-type="bibr" rid="bib117">Pavlov, 1927</xref>). The circuit mechanisms that underlie associative learning are still incompletely understood. Furthermore, there are different forms of associative learning and the extent to which distinct circuits underlie distinct types of associative learning is unclear.</p><p>The nature of the CS distinguishes two major associative learning types. In classical conditioning (<xref ref-type="bibr" rid="bib117">Pavlov, 1927</xref>), the CS is a stimulus such as an odour. In operant conditioning the CS is the animal’s own action (<xref ref-type="bibr" rid="bib143">Skinner, 1938</xref>; <xref ref-type="bibr" rid="bib152">Thorndike, 1911</xref>). Distinct forms of classical conditioning can further be distinguished, for example, based on the timing of CS and US: in delay conditioning they overlap in time, whereas in trace conditioning there is a gap between them (<xref ref-type="bibr" rid="bib34">Dylla et al., 2013</xref>). Systematic identification and comparison of neurons and circuits involved in distinct types of learning paradigms would be greatly facilitated by automated high-throughput training systems combined with optogenetic and thermogenetic manipulation of neurons in freely behaving animals.</p><p>We therefore developed an automated training system for classical and operant learning in the tractable genetic model system, the <italic>Drosophila melanogaster</italic> larva. The <italic>Drosophila</italic> larva is particularly well-suited for studying the neural basis of behaviour. Powerful genetic tools have advanced the study of how larval behaviours (<xref ref-type="fig" rid="fig1">Figure 1A</xref>) are affected by activity at the cellular level. In <italic>Drosophila</italic>, individual neurons are uniquely identifiable, with morphology and function preserved across animals (<xref ref-type="bibr" rid="bib142">Skeath and Thor, 2003</xref>; <xref ref-type="bibr" rid="bib167">Wong et al., 2002</xref>; <xref ref-type="bibr" rid="bib99">Marin et al., 2002</xref>; <xref ref-type="bibr" rid="bib70">Jefferis et al., 2007</xref>). Together with tissue-localised protein expression afforded by binary expression systems like Gal4/UAS and LexA/LexAop (<xref ref-type="bibr" rid="bib41">Fischer et al., 1988</xref>; <xref ref-type="bibr" rid="bib12">Brand and Perrimon, 1993</xref>), this knowledge has yielded neuron-specific drivers (<xref ref-type="bibr" rid="bib71">Jenett et al., 2012</xref>; <xref ref-type="bibr" rid="bib96">Luan et al., 2006</xref>; <xref ref-type="bibr" rid="bib120">Pfeiffer et al., 2010</xref>) that reproducibly target the same groups of cells in each individual. Adding fluorescent markers helps to pinpoint a neuron’s location and reveal its anatomical features (<xref ref-type="bibr" rid="bib88">Lee and Luo, 1999</xref>), while expressing light-sensitive channelrhodopsins and temperature-sensitive ion channels enables optogenetic (<xref ref-type="bibr" rid="bib170">Zemelman et al., 2002</xref>; <xref ref-type="bibr" rid="bib92">Lima and Miesenböck, 2005</xref>) or thermogenetic (<xref ref-type="bibr" rid="bib56">Hamada et al., 2008</xref>; <xref ref-type="bibr" rid="bib81">Kitamoto, 2001</xref>) modulation of neuronal activity. Furthermore, the larva’s compact central nervous system (CNS) has made it feasible to reconstruct neurons and their synaptic partners from a larval electron microscopy (EM) volume (<xref ref-type="bibr" rid="bib10">Berck et al., 2016</xref>; <xref ref-type="bibr" rid="bib35">Eichler et al., 2017</xref>; <xref ref-type="bibr" rid="bib43">Fushiki et al., 2016</xref>; <xref ref-type="bibr" rid="bib113">Ohyama et al., 2015</xref>; <xref ref-type="bibr" rid="bib132">Schlegel et al., 2016</xref>; <xref ref-type="bibr" rid="bib87">Larderet et al., 2017</xref>; <xref ref-type="bibr" rid="bib74">Jovanic et al., 2016</xref>; <xref ref-type="bibr" rid="bib75">Jovanic et al., 2019</xref>). These reconstructions have given rise to a full wiring diagram of the larval mushroom body (MB) (<xref ref-type="bibr" rid="bib35">Eichler et al., 2017</xref>; <xref ref-type="bibr" rid="bib38">Eschbach et al., 2021</xref>; <xref ref-type="bibr" rid="bib37">Eschbach et al., 2020</xref>) - a region known to play a key role in associative learning (<xref ref-type="bibr" rid="bib7">Aso et al., 2014</xref>; <xref ref-type="bibr" rid="bib64">Honegger et al., 2011</xref>; <xref ref-type="bibr" rid="bib10">Berck et al., 2016</xref>; <xref ref-type="bibr" rid="bib93">Lin et al., 2014</xref>; <xref ref-type="bibr" rid="bib115">Owald and Waddell, 2015</xref>; <xref ref-type="bibr" rid="bib18">Campbell et al., 2013</xref>; <xref ref-type="bibr" rid="bib155">Turner et al., 2008</xref>; <xref ref-type="bibr" rid="bib35">Eichler et al., 2017</xref>).</p><fig-group><fig id="fig1" position="float"><label>Figure 1.</label><caption><title>Multi-larva tracker combines real-time behaviour detection with either open- or closed-loop stimulation.</title><p>(<bold>a</bold>) Behavioural repertoire of <italic>Drosophila</italic> larvae. Schematics show the four most prominent actions displayed by <italic>Drosophila</italic> larvae (crawl, left and right bend, back-up, and roll). The larval contour is displayed as a black outline with a green dot marking the head. (<bold>b</bold>) Multi-larva tracker schematic showing the relative positions of the camera, digital micromirror devices (DMDs), galvanometers, agarose plate, and backlight. The heat camera is not shown (for visual simplicity), but is mounted directly beneath the background DMD. See multi-larva-tracker-cad.zip for technical drawings. (<bold>c</bold>) Block diagram of hardware components. AO: analogue output, FPGA: field-programmable gate array. d. Data flow between software elements.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-70015-fig1-v3.tif"/></fig><fig id="fig1s1" position="float" specific-use="child-fig"><label>Figure 1—figure supplement 1.</label><caption><title>Contour calculation on eld-programmable gate array (FPGA).</title><p>A simplied example is shown using a 10 x 10 pixel box containing a small object. (<bold>a</bold>) The object (black) was detected against the background (white) using binary thresholding. Edge pixels were detected by combining the results of vertical and horizontal image convolution with a 2 x 1 XOR kernel using an OR operator. (<bold>b</bold>) The contour points were reconstructed in an iterative process, starting with the edge pixel closest to the centre of the box. The next contour point was defined as the first neighbouring pixel that was found to be an edge pixel. Neighbouring pixels were assessed clockwise from the pixel directly above the contour point. The process ended when no eligible edge pixels could be found.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-70015-fig1-figsupp1-v3.tif"/></fig><fig id="fig1s2" position="float" specific-use="child-fig"><label>Figure 1—figure supplement 2.</label><caption><title>Detecting head and tail.</title><p>The larval contour (black outline) and head and tail (green) are shown. (<bold>a</bold>) Initial detection of head and tail. The head was the contour point with the sharpest curvature. The tail was the contour point with the next-sharpest curvature which did not lie in close proximity to the head. (<bold>b</bold>) The initial detection of head and tail was incorrect in some cases. False detection could be corrected by swapping head and tail, thereby minimising the distances from head and tail in the current frame (solid contour) to head and tail in the previous frame (transparent contour). (<bold>c</bold>) The correction described in <bold>b</bold> failed if larvae curled up such that the contour appeared circular (‘ball’). To eliminate this source of false head and tail detection, these events were detected using a ball classier.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-70015-fig1-figsupp2-v3.tif"/></fig><fig id="fig1s3" position="float" specific-use="child-fig"><label>Figure 1—figure supplement 3.</label><caption><title>Calculating a smooth spine and landmark points.</title><p>The larval contour is shown (black outline). The spine S was comprised of 11 points (black), including head and tail (green). (<bold>a</bold>) The raw spine points were obtained by finding the centres between equally spaced contour points on either half of the contour as defined by head and tail. The first spine point was the head, the last spine point was the tail. (<bold>b</bold>) The smooth spine was obtained by exponentially smoothing the raw spine. (<bold>c</bold>) Four additional landmark points, neck_top, neck, and neck_down (blue), and the contour centroid (grey), were calculated.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-70015-fig1-figsupp3-v3.tif"/></fig><fig id="fig1s4" position="float" specific-use="child-fig"><label>Figure 1—figure supplement 4.</label><caption><title>Calculating direction vectors.</title><p>Three direction vectors were calculated based on head, tail, and the landmark points. (<bold>a</bold>) direction_vector was the normalised vector from neck_down to neck. (<bold>b</bold>) direction_head_vector was the normalised vector from neck_top to head. (<bold>c</bold>) direction_tail_vector was the normalised vector from tail to neck_down.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-70015-fig1-figsupp4-v3.tif"/></fig><fig id="fig1s5" position="float" specific-use="child-fig"><label>Figure 1—figure supplement 5.</label><caption><title>Features describing body shape.</title><p>(<bold>a</bold>) Outline of a larva with contour C (black) and its convex hull H (blue). (<bold>b</bold>) Shown here are the eigenvectors (blue) of the larval contour (black) structure tensor with respect to neck and their corresponding eigenvalues λ<sub>1</sub> and λ<sub>2</sub>. (<bold>c</bold>) θ<sub>i</sub> was defined as the angle between direction_vector (blue) and the vector <inline-formula><mml:math id="inf1"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>a</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> that passed through spine points Si and Si+1 (black). (<bold>d</bold>) θ<sub>head</sub> was defined as the angle between direction_vector and direction_head_vector. Head and tail are shown in green.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-70015-fig1-figsupp5-v3.tif"/></fig><fig id="fig1s6" position="float" specific-use="child-fig"><label>Figure 1—figure supplement 6.</label><caption><title>Velocity features.</title><p>The larval contour is shown in black while head and tail are shown in green. (<bold>a</bold>) crab_speed (blue) was defined as the component of neck_speed (grey) that was orthogonal to direction_vector_filtered (black). (<bold>b</bold>) parallel_speed (blue) was defined as the component of neck_speed_filtered (grey) that was parallel to direction_vector_ filtered (black). (<bold>c</bold>) parallel_speed_tail_raw (blue) was defined as the component of tail_speed_filtered (grey) that was parallel to direction_tail_vector_filtered (black). (<bold>d</bold>) θ<sub>tail</sub> was defined as the angle between tail_speed_filtered (grey) and direction_tail_vector_filtered (black).</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-70015-fig1-figsupp6-v3.tif"/></fig><fig id="fig1s7" position="float" specific-use="child-fig"><label>Figure 1—figure supplement 7.</label><caption><title>Temporal smoothing of features.</title><p>(<bold>a-b</bold>) Example graphs of raw (dark blue) and filtered (mid blue) asymmetry (<bold>a</bold>) and eig_reduced (<bold>b</bold>) values over time. (<bold>c–d</bold>) Example graphs of raw (dark blue), filtered (mid blue), and long-time filtered (light blue) v_norm values over a short (<bold>c</bold>) and a long (<bold>d</bold>) period of time.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-70015-fig1-figsupp7-v3.tif"/></fig><fig id="fig1s8" position="float" specific-use="child-fig"><label>Figure 1—figure supplement 8.</label><caption><title>Differentiation by convolution.</title><p>Example graphs of raw (dark blue) and convolved squared (green) asymmetry (<bold>a</bold>), eig_reduced (<bold>b</bold>), and v_norm (<bold>c</bold>) values over time.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-70015-fig1-figsupp8-v3.tif"/></fig></fig-group><p>As with many vertebrates (<xref ref-type="bibr" rid="bib4">Andreatta and Pauli, 2015</xref>; <xref ref-type="bibr" rid="bib17">Brown et al., 1951</xref>; <xref ref-type="bibr" rid="bib73">Jones et al., 2005</xref>; <xref ref-type="bibr" rid="bib13">Braubach et al., 2009</xref>) and invertebrates (<xref ref-type="bibr" rid="bib151">Takeda, 1961</xref>; <xref ref-type="bibr" rid="bib159">Vinauger et al., 2014</xref>; <xref ref-type="bibr" rid="bib3">Alexander et al., 1984</xref>; <xref ref-type="bibr" rid="bib164">Wen et al., 1997</xref>; <xref ref-type="bibr" rid="bib131">Scherer et al., 2003</xref>; <xref ref-type="bibr" rid="bib31">Davis, 2005</xref>; <xref ref-type="bibr" rid="bib23">Cognigni et al., 2018</xref>; <xref ref-type="bibr" rid="bib161">Vogt et al., 2014</xref>), there is overwhelming evidence that <italic>Drosophila</italic> larvae are capable of classical conditioning. They can be trained to approach an odour paired with a gustatory reward (<xref ref-type="bibr" rid="bib133">Schleyer et al., 2011</xref>; <xref ref-type="bibr" rid="bib62">Hendel et al., 2005</xref>; <xref ref-type="bibr" rid="bib85">Kudow et al., 2017</xref>; <xref ref-type="bibr" rid="bib109">Niewalda et al., 2008</xref>), or avoid an odour paired with light (<xref ref-type="bibr" rid="bib162">von Essen et al., 2011</xref>), electric shock (<xref ref-type="bibr" rid="bib2">Aceves-Piña and Quinn, 1979</xref>; <xref ref-type="bibr" rid="bib154">Tully et al., 1994</xref>), heat (<xref ref-type="bibr" rid="bib80">Khurana et al., 2012</xref>), vibration (<xref ref-type="bibr" rid="bib36">Eschbach et al., 2011</xref>), or the bitter compound quinine (<xref ref-type="bibr" rid="bib47">Gerber and Hendel, 2006</xref>; <xref ref-type="bibr" rid="bib5">Apostolopoulou et al., 2014</xref>). A larva’s innate avoidance of light and preference for darkness (<xref ref-type="bibr" rid="bib130">Sawin-McCormack et al., 1995</xref>) can also be modulated when paired with reward or punishment (<xref ref-type="bibr" rid="bib46">Gerber et al., 2004</xref>; <xref ref-type="bibr" rid="bib162">von Essen et al., 2011</xref>).</p><p>Adult <italic>Drosophila</italic> have also been shown to perform trace conditioning when stimuli do not overlap in time (<xref ref-type="bibr" rid="bib44">Galili et al., 2011</xref>). However, to the best of our knowledge, trace conditioning has never been shown in <italic>Drosophila</italic> larvae, perhaps reflecting genuine learning limitations in this developmental stage. However, the absence of evidence might also reflect the limitations of current methods for studying larval learning. Such methods often deliver a US using optogenetic stimulation, and deliver an olfactory stimulus via natural odour (<xref ref-type="bibr" rid="bib38">Eschbach et al., 2021</xref>). Temporal precision is difficult with these approaches, precluding thorough investigation of larval learning and relative timing of stimuli. In addressing these methodological challenges, prior work has combined optogenetics with thermogenetics to independently stimulate larval neurons of differing sensory modalities (<xref ref-type="bibr" rid="bib63">Honda et al., 2014</xref>). The methods used to heat larvae in these experiments (e.g. hot plates) remain, however, slow relative to optogenetic stimulation. An experimental system equipped with temporally precise opto- and thermogenetic stimulus delivery would be invaluable for executing automated larval trace conditioning tasks.</p><p>Despite countless demonstrations of operant conditioning across vertebrates (<xref ref-type="bibr" rid="bib110">Nottebohm, 1991</xref>; <xref ref-type="bibr" rid="bib114">Olds and Milner, 1954</xref>; <xref ref-type="bibr" rid="bib72">Jin and Costa, 2010</xref>; <xref ref-type="bibr" rid="bib95">Lovell et al., 2015</xref>) and invertebrates (<xref ref-type="bibr" rid="bib14">Brembs, 2003</xref>; <xref ref-type="bibr" rid="bib67">Hoyle, 1979</xref>; <xref ref-type="bibr" rid="bib1">Abramson et al., 2016</xref>; <xref ref-type="bibr" rid="bib111">Nuwal et al., 2012</xref>; <xref ref-type="bibr" rid="bib11">Booker and Quinn, 1981</xref>), it is also unknown whether <italic>Drosophila</italic> larvae can associate their own actions with distinct sensory outcomes. For an animal to learn such a relationship, behavioural information must converge with circuits encoding the outcome’s valence. Although vertebrate basal ganglia-like structures exemplify this (<xref ref-type="bibr" rid="bib39">Fee and Goldberg, 2011</xref>; <xref ref-type="bibr" rid="bib124">Redgrave et al., 2011</xref>; <xref ref-type="bibr" rid="bib8">Balleine et al., 2009</xref>), some learned action–outcome associations do not require the brain (<xref ref-type="bibr" rid="bib11">Booker and Quinn, 1981</xref>; <xref ref-type="bibr" rid="bib66">Horridge, 1962</xref>; <xref ref-type="bibr" rid="bib52">Grau et al., 1998</xref>). Investigating operant conditioning in <italic>Drosophila</italic> larvae may further elucidate whether such learning can form in more than one area of the CNS. However, designing an automated operant conditioning task for larvae requires consideration of their short life cycle and physical characteristics. Traditional approaches require either extensive training to interact with an object (<xref ref-type="bibr" rid="bib72">Jin and Costa, 2010</xref>; <xref ref-type="bibr" rid="bib40">Fernando et al., 2015</xref>; <xref ref-type="bibr" rid="bib27">Corbett and Wise, 1980</xref>; <xref ref-type="bibr" rid="bib58">He et al., 2015</xref>) or, as with adult <italic>Drosophila</italic>, partial immobilisation and usage of remaining motion to control a virtual environment (<xref ref-type="bibr" rid="bib111">Nuwal et al., 2012</xref>; <xref ref-type="bibr" rid="bib165">Wolf and Heisenberg, 1991</xref>; <xref ref-type="bibr" rid="bib166">Wolf et al., 1998</xref>; <xref ref-type="bibr" rid="bib16">Brembs, 2011</xref>). A more viable and less restrictive system for larvae would not only allow free animal movement but also rapidly deliver a rewarding or punishing US in accordance with a given behaviour.</p><p>Temporally precise action reinforcement requires real-time identification of larval behaviours. Numerous algorithms already exist for real-time tracking of freely moving animals (<xref ref-type="bibr" rid="bib146">Stowers et al., 2017</xref>; <xref ref-type="bibr" rid="bib84">Krynitsky et al., 2020</xref>; <xref ref-type="bibr" rid="bib106">Mischiati et al., 2015</xref>; <xref ref-type="bibr" rid="bib42">Fry et al., 2008</xref>; <xref ref-type="bibr" rid="bib147">Straw et al., 2011</xref>; <xref ref-type="bibr" rid="bib149">Swierczek et al., 2011</xref>) and subsequent offline behaviour analysis (<xref ref-type="bibr" rid="bib102">Mathis et al., 2018</xref>; <xref ref-type="bibr" rid="bib157">Veeraraghavan et al., 2008</xref>; <xref ref-type="bibr" rid="bib29">Dankert et al., 2009</xref>; <xref ref-type="bibr" rid="bib127">Robie et al., 2017</xref>; <xref ref-type="bibr" rid="bib105">Mirat et al., 2013</xref>; <xref ref-type="bibr" rid="bib123">Reddy et al., 2020</xref>; <xref ref-type="bibr" rid="bib145">Stephens et al., 2008</xref>; <xref ref-type="bibr" rid="bib54">Gupta and Gomez-Marin, 2019</xref>). The <italic>Drosophila</italic> larva has been of notable analytic interest due its deformable body and limited set of distinguishing physical features. Algorithmic advances have enabled extensive investigation of larval behaviour in response to open-loop stimuli (<xref ref-type="bibr" rid="bib98">Luo et al., 2010</xref>; <xref ref-type="bibr" rid="bib48">Gershow et al., 2012</xref>; <xref ref-type="bibr" rid="bib32">Denisov et al., 2013</xref>; <xref ref-type="bibr" rid="bib160">Vogelstein et al., 2014</xref>; <xref ref-type="bibr" rid="bib112">Ohyama et al., 2013</xref>; <xref ref-type="bibr" rid="bib113">Ohyama et al., 2015</xref>; <xref ref-type="bibr" rid="bib75">Jovanic et al., 2019</xref>). Most of these approaches are nonetheless not ideal for running in real-time, or require mixing past and future information to perform reliably (<xref ref-type="bibr" rid="bib50">Gomez-Marin et al., 2011</xref>; <xref ref-type="bibr" rid="bib101">Masson et al., 2020</xref>). Existing closed-loop trackers that overcame these challenges to achieve real-time behaviour detection and stimulus presentation are themselves limited to investigating one animal at a time (<xref ref-type="bibr" rid="bib136">Schulze et al., 2015</xref>; <xref ref-type="bibr" rid="bib150">Tadres and Louis, 2020</xref>).</p><p>Here, we introduce a new tracker we built to address some methodological limitations of prior <italic>Drosophila</italic> larval learning studies. Our system performs real-time tracking and behaviour analysis of up to 16 larvae simultaneously. It also achieves independent opto- and thermogenetic stimulation through rapid illumination and heating of individual larvae. This stimulation is delivered automatically with high temporal precision and is controlled in either open- or closed-loop. Using this system, we demonstrate that <italic>Drosophila</italic> larvae are capable of both trace conditioning and operant conditioning.</p></sec><sec id="s2" sec-type="results"><title>Results</title><sec id="s2-1"><title>Design of an FPGA-based, multi-larva, real-time behaviour-detection and stimulation system for high-throughput, automated training</title><p>We built a high-throughput (i.e. multi-larva) tracker combining live behaviour detection with rapid delivery of light and heat stimuli. All hardware resides within an optically opaque enclosure to ensure experiments are performed without environmental light. Larvae move freely on an agarose plate, backlit from below by an infrared (IR) LED and observed from above through a high-resolution camera (<xref ref-type="fig" rid="fig1">Figure 1B</xref>). While real-time behaviour detection has been developed for a single animal (<xref ref-type="bibr" rid="bib136">Schulze et al., 2015</xref>), our multi-larva system simultaneously tracks up to 16 larvae, using LabVIEW for the user interface and algorithm implementation (<xref ref-type="fig" rid="fig1">Figure 1D</xref>). Instrumental to this software architecture is the fast image processing speed afforded by field-programmable gate array (FPGA)-based parallelisation (<xref ref-type="bibr" rid="bib144">Soares dos Santos and Ferreira, 2014</xref>; <xref ref-type="bibr" rid="bib90">Li et al., 2011</xref>; <xref ref-type="bibr" rid="bib171">Zhang et al., 2017</xref>). Neuroscientists have adapted FPGA’s real-time analysis capabilities (<xref ref-type="bibr" rid="bib79">Kehtarnavaz et al., 2009</xref>; <xref ref-type="bibr" rid="bib156">Uzun et al., 2005</xref>; <xref ref-type="bibr" rid="bib20">Chiuchisan, 2013</xref>; <xref ref-type="bibr" rid="bib169">Yasukawa et al., 2016</xref>) to track rats (<xref ref-type="bibr" rid="bib19">Chen et al., 2005</xref>), zebrafish larvae (<xref ref-type="bibr" rid="bib26">Cong et al., 2017</xref>), and fluorescently labelled neurons in freely behaving <italic>Drosophila</italic> larvae (<xref ref-type="bibr" rid="bib78">Karagyozov et al., 2018</xref>). In our system, the high-performance FPGA and host computer work together (<xref ref-type="fig" rid="fig1">Figure 1C</xref>) to read raw camera images, detect eligible objects, and extract and process object features (i.e. contour, head and tail position, and body axis) (<xref ref-type="fig" rid="fig1">Figure 1D</xref>, see Materials and methods for details). Measuring larval body shape, velocity, and direction of motion facilitates robust behaviour detection via machine learning. We detected bends (left and right), rolls, forward and backward peristaltic waves with high precision and recall (see Materials and methods for all values).</p><p>The FPGA and host computer also calculate the timing and intensity of light and heat stimuli. Both stimuli can be controlled in either an open-loop or closed-loop configuration. Light stimulation is achieved by directing visible red light through two digital micromirror devices (DMDs), each programmed to project small 1 cm<sup>2</sup> squares at the location of individual larvae. The DMDs are positioned to project over the entire plate area and operate simultaneously (<xref ref-type="fig" rid="fig1">Figure 1B</xref>; see also Materials and methods). Targeted heat stimulation of individual larvae can be achieved by directing an 1400–1500 nm IR laser beam through a two-axis scanning galvanometer mirror positioning system, a technique previously used to stimulate single adult flies (<xref ref-type="bibr" rid="bib9">Bath et al., 2014</xref>; <xref ref-type="bibr" rid="bib168">Wu et al., 2014</xref>). The galvanometer’s high scanning velocity enables rapid cycling of the IR beam between multiple larvae (<xref ref-type="fig" rid="fig1">Figure 1B</xref>; see also Materials and methods). To verify the efficiency and speed with which this method heated up individual animals we also installed a heat camera on the setup. Using the camera we demonstrated that larvae are heated to the desired 30℃ within 4 s. The heat camera performed closed-loop adjustments of laser intensity to maintain the desired 30℃ temperature at each larval location (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>).</p></sec><sec id="s2-2"><title>Proof-of-principle experiments verify multi-larva training rig’s stimulation efficiency</title><p>We conducted open-loop proof-of-principle experiments to ensure that our tracker could successfully perform optogenetic stimulation of tracked larvae (<xref ref-type="fig" rid="fig2">Figure 2C</xref>). We tested whether 69F06&gt;CsChrimson and 72F11&gt;CsChrimson larvae rolled upon exposure to red light (<xref ref-type="fig" rid="fig2">Figure 2C</xref>; see also LABEL:sec:materials_and_methods). Rolling is a lateral movement characterised by the larva curling into a C-shape and quickly turning around its own body axis (<xref ref-type="bibr" rid="bib126">Robertson et al., 2013</xref>; <xref ref-type="bibr" rid="bib69">Hwang et al., 2007</xref>; <xref ref-type="bibr" rid="bib112">Ohyama et al., 2013</xref>; <xref ref-type="fig" rid="fig1">Figure 1A</xref>). This is the fastest larval escape behaviour and is observed in nature only after exposure to a strong noxious stimulus, such as heat or a predator attack (<xref ref-type="bibr" rid="bib113">Ohyama et al., 2015</xref>; <xref ref-type="bibr" rid="bib126">Robertson et al., 2013</xref>; <xref ref-type="bibr" rid="bib153">Tracey et al., 2003</xref>). Both experimental driver lines drive expression of the red-shifted channelrhodopsin CsChrimson (<xref ref-type="bibr" rid="bib82">Klapoetke et al., 2014</xref>) in neurons whose activation triggers strong rolling behaviour (<xref ref-type="bibr" rid="bib113">Ohyama et al., 2015</xref>): 69F06 drives expression in Goro command neurons for rolling, whereas 72F11 drives expression in the Basin neurons, which integrate mechanosensory and nociceptive stimuli. During the 5 s stimulus presentation within each of three stimulation rounds, we observed above-threshold rolls in over 50% of 69F06&gt;CsChrimson larvae and over 90% of 72F11&gt;CsChrimson larvae. Both experimental groups’ rolling behaviour significantly contrasted that of attP2&gt;CsChrimson control larvae during each 5 s stimulus presentation which exhibited virtually no rolling. This significant contrast to the control was also evident for either one or both experimental groups during the first 5 s of break within each stimulation round (<xref ref-type="fig" rid="fig2">Figure 2D</xref>). These results suggest that the combined red light emitted by the two tracker DMDs (see Materials and methods) is sufficient to activate targeted neurons of interest.</p><fig-group><fig id="fig2" position="float"><label>Figure 2.</label><caption><title>Optogenetic and thermogenetic stimulation efficiency verified by behavioural readout.</title><p>(<bold>a</bold>) Light stimulation hardware schematic. Only one digital micromirror device (DMD) is shown for simplicity. (<bold>b</bold>) Heat stimulation hardware schematic. Only one two-axis galvanometer is shown for simplicity. IR: infrared. (<bold>c</bold>) Proof-of-principle experiment protocol for either optogenetic (light bulb) or thermogenetic (thermometer) stimulation. <bold>d</bold>, <bold>e</bold>. Fraction of larvae for which the optogenetic (<bold>d</bold>) or thermogenetic (<bold>e</bold>) stimulus protocol triggered at least one detected roll (top pair of plots), bend (middle pair of plots), or forward crawl (bottom pair of plots). For each behaviour, the fraction of larvae is computed within 0.5 s (line plots) or 5 s (scatter plots) time bins across the 60 s experiment. All data shown with 95% Clopper-Pearson interval. Fisher’s exact test with Bonferroni correction was performed within each 5 s time bin between each experiment group (69F06 and 72F11) and the control group (attP2). Sample sizes for each genotype within each 5 s time bin are shown at the bottom of (<bold>d</bold>) and (<bold>e</bold>). ns p ≥ .05/24 (not significant), * p &lt; .05/24, ** p &lt; .01/24, *** p &lt; .001/24. See <xref ref-type="supplementary-material" rid="fig2sdata1">Figure 2—source data 1</xref>, <xref ref-type="supplementary-material" rid="fig2sdata2">Figure 2—source data 2</xref>, <xref ref-type="supplementary-material" rid="fig2sdata3">Figure 2—source data 3</xref>.</p><p><supplementary-material id="fig2sdata1"><label>Figure 2—source data 1.</label><caption><title>Rolling, bending, and crawling behaviour for each larva over time (separated by genotype) - for data in top row of <xref ref-type="fig" rid="fig2">Figure 2d, e</xref>.</title></caption><media mimetype="application" mime-subtype="xlsx" xlink:href="elife-70015-fig2-data1-v3.xlsx"/></supplementary-material></p><p><supplementary-material id="fig2sdata2"><label>Figure 2—source data 2.</label><caption><title>Rolling, bending, and crawling behaviour for each larva over time (separated by genotype) - for data in middle row of <xref ref-type="fig" rid="fig2">Figure 2d, e</xref>.</title></caption><media mimetype="application" mime-subtype="xlsx" xlink:href="elife-70015-fig2-data2-v3.xlsx"/></supplementary-material></p><p><supplementary-material id="fig2sdata3"><label>Figure 2—source data 3.</label><caption><title>Rolling, bending, and crawling behaviour for each larva over time (separated by genotype) - for data in bottom row of <xref ref-type="fig" rid="fig2">Figure 2d, e</xref>.</title></caption><media mimetype="application" mime-subtype="xlsx" xlink:href="elife-70015-fig2-data3-v3.xlsx"/></supplementary-material></p><p><supplementary-material id="fig2sdata4"><label>Figure 2—source data 4.</label><caption><title>Recorded temperatures during larval IR heating.</title></caption><media mimetype="application" mime-subtype="octet-stream" xlink:href="elife-70015-fig2-data4-v3.csv"/></supplementary-material></p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-70015-fig2-v3.tif"/></fig><fig id="fig2s1" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 1.</label><caption><title>Temporal dynamics of larval heating via IR stimulation.</title><p>Larval temperature recorded before, during, and after delivery of 1470nm IR laser stimulation. Open-loop experiments began with a 30 s initialisation period during which no stimulus was given. Over a subsequent 20 s stimulation period (beginning at 0 s; grey vertical dashed line), a heat camera performed closed-loop adjustments of laser intensity to maintain the desired 30°C temperature (grey horizontal dashed line) at each larval location. The laser was then turned off to observe the time required for larvae to return to baseline temperature. Temperature readings were stopped 50 s after initial stimulus onset. Inset (grey solid rectangle) shows zoomed in temporal window for ease of visualisation. Temperature data were averaged across larvae (n = 36; data shown as mean ± 95% confidence interval). See <xref ref-type="supplementary-material" rid="fig2sdata4">Figure 2—source data 4</xref>.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-70015-fig2-figsupp1-v3.tif"/></fig></fig-group><p>When exploring an environment, a larva alternates between crawling via forward peristalsis (<xref ref-type="bibr" rid="bib59">Heckscher et al., 2012</xref>) and bending its head once or more to the left or right (<xref ref-type="bibr" rid="bib50">Gomez-Marin et al., 2011</xref>; <xref ref-type="bibr" rid="bib98">Luo et al., 2010</xref>; <xref ref-type="bibr" rid="bib77">Kane et al., 2013</xref>; <xref ref-type="fig" rid="fig1">Figure 1A</xref>). A common avoidance behaviour exhibited by larvae is bending of the head away from undesirable conditions, including extreme temperature (<xref ref-type="bibr" rid="bib98">Luo et al., 2010</xref>; <xref ref-type="bibr" rid="bib86">Lahiri et al., 2011</xref>), light (<xref ref-type="bibr" rid="bib77">Kane et al., 2013</xref>), or wind (<xref ref-type="bibr" rid="bib75">Jovanic et al., 2019</xref>; <xref ref-type="fig" rid="fig1">Figure 1A</xref>). Prior investigation in our laboratory has shown that Basin activation can evoke bending in addition to rolling, and Goro activation can evoke C-shape bending. We therefore asked whether the fraction of larvae bending during optogenetic stimulation was also significantly different between the experimental groups and control. The fraction of 69F06&gt;CsChrimson and 72F11&gt;CsChrimson larvae that were bending during the 5 s stimulus presentation within each of the three stimulation rounds was significantly higher than that of attP2&gt;CsChrimson control larvae (<xref ref-type="fig" rid="fig2">Figure 2D</xref>). The low levels of bending evoked by red light alone in control animals suggest the red light used for optogenetic activation is not very aversive to the animals.</p><p>The third larval behaviour we monitored across the duration of these optogenetic efficiency experiments was forward crawling. The fraction of larvae crawling was not statistically different between experimental and control groups at any time during the experiment. The fraction of attP2&gt;CsChrimson control larvae crawling during each 5 s stimulus presentation was, however, consistently elevated compared to that of both experimental groups (<xref ref-type="fig" rid="fig2">Figure 2D</xref>). The reduction in experimental larvae crawling matched our expectations, given the high frequency of both rolling and bending behaviour during stimulus presentation.</p><p>We also verified the efficacy of our tracker’s galvanometer setup for thermogenetic stimulation (<xref ref-type="fig" rid="fig2">Figure 2B</xref>). We tested whether 69F06&gt;dTrpA1 and 72F11&gt;dTrpA1 larvae rolled upon exposure to a 1490 nm IR laser (<xref ref-type="fig" rid="fig2">Figure 2C</xref>; see also Materials and methods). Because wavelengths between 1400 and 1500 nm are well-absorbed by water (<xref ref-type="bibr" rid="bib28">Curcio and Petty, 1951</xref>), we anticipated that heating larvae with this IR beam would activate the ectopically-expressed thermosensitive cation channels (i.e. dTrpA1). During the 5 s stimulus presentation within each of three stimulation rounds, we observed above-threshold rolls in over 60% of 69F06&gt;dTrpA1 larvae and at least 40% of 72F11&gt;dTrpA1 larvae. In stimulation rounds 1 and 2, values in both experiment groups significantly contrasted those of attP2&gt;dTrpA1 control larvae, for which the fraction of larvae rolling was near zero (<xref ref-type="fig" rid="fig2">Figure 2E</xref>). The quantitative difference in these rolling responses compared to optogenetic activation of the same Gal4 drivers (<xref ref-type="fig" rid="fig2">Figure 2D</xref>) is not surprising. These effects are likely mediated by differing biophysical properties of CsChrimson and dTrpA1 channels including single channel conductance and open state lifetime (<xref ref-type="bibr" rid="bib122">Pulver et al., 2009</xref>; <xref ref-type="bibr" rid="bib158">Vierock et al., 2017</xref>). In further contrast to the proof-of-principle optogenetic experiments, the slower kinetics of tissue heating caused a ca. 4–5 s second temporal delay between stimulus onset and behaviour onset (<xref ref-type="fig" rid="fig2">Figure 2E</xref>). We concluded from these results that our chosen heating conditions, although slower than optogenetic stimulation, were effective for targeted dTrpA1 channel activation with a predictable temporal delay of 4 s.</p><p>Outfitting our tracker with an IR laser enables targeted neuronal activation without risking the spectral cross-talk commonly associated with channelrhodopsins of overlapping activation wavelengths. Further exploration of the proof-of-principle thermogenetic data did, however, reveal an important caveat of our IR-induced stimulation approach. The fraction of attP2&gt;dTrpA1 control larvae that were bending was statistically indistinguishable from that of 69F06 and 72F11 larvae throughout the experiment (<xref ref-type="fig" rid="fig2">Figure 2E</xref>). Bending together with rolling accounted for much of larval behaviour across all three groups during each 5 s stimulus presentation; evidenced, in part, by the near-zero fraction of larvae crawling at these times (<xref ref-type="fig" rid="fig2">Figure 2E</xref>). The high bending frequency of attP2&gt;dTrpA1 control larvae during IR-induced stimulation is likely indicative of mild heat aversion.</p></sec><sec id="s2-3"><title>Aversion to fictive Or42b develops after forward-paired trace conditioning</title><p>Having verified the efficacy of optogenetic and thermogenetic stimulation in our system, we first studied whether these methods could be used to train larvae in a previously unexplored classical conditioning task that requires precise temporal control of both CS and US. In particular, we focused on trace conditioning, which has not been demonstrated previously in larvae. To provide the CS in these experiments, all larvae expressed CsChrimson in Or42b neurons. <italic>Drosophila</italic> larvae display innate attraction during Or42b activation. When these neurons are stimulated artificially, larvae reduce their bending frequency immediately after stimulation onset and rapidly increase bending frequency following stimulation offset (<xref ref-type="bibr" rid="bib45">Gepner et al., 2015</xref>). To provide the US in these experiments, experimental larvae also expressed dTrpA1 in Basin neurons. Pairing an odour with Basin activation has previously been shown to evoke aversive odour memory (when the CS and US overlap in time <xref ref-type="bibr" rid="bib37">Eschbach et al., 2020</xref>). Importantly, control larvae did not express dTrpA1 in Basin neurons (see Materials and methods for more details).</p><p><xref ref-type="fig" rid="fig3">Figure 3A</xref> schematises the classical conditioning protocol. Each forward-paired training round comprised 20 s of optogenetic Or42b activation followed by 20 s of IR heating (activating Basin neurons in experimental larvae), with 5s from light offset to triggering IR stimulation. We note that, while we triggered IR light 5 s after the offset of red light for optogenetic stimulation, it took a further 4 s for larvae to reach the appropriate 30℃ temperature for thermogenetic activation of Basins. The gap between CS offset and US onset is, therefore, ca. 9 s. 60 s without stimulation followed US offset. Backward-paired training followed the same protocol structure except IR heating preceded Or42b activation. Eight replicate training rounds comprised the training period, after which an additional 60 s without stimulation was allocated before the testing period. The testing period included three, 20 s blocks of Or42b activation, each separated by 45 s without stimulation (see Materials and methods for more details). To assess learning, we analysed the behavioural responses of larvae to Or42b activation in the testing period. We calculated the difference in the percentage of larvae bending during versus after Or42b activation (i. e. ON-OFF; see Materials and methods for more details). A large, negative ‘percentage bending difference’ indicates significant attraction to Or42b activation, with less bending during versus after stimulation. In contrast, a difference value closer to zero indicates less attraction and a value greater than zero indicates aversion.</p><fig id="fig3" position="float"><label>Figure 3.</label><caption><title>The effects of forward- versus backward-paired aversive training on larval attraction to Or42b.</title><p>(<bold>a</bold>) Schematic of classical conditioning protocol. After an initialisation period of 30 s, the first training round began. Here, Or42b was activated through red light illumination and was followed (forward-paired) or preceded (backward-paired) by the activation of Basin (72F11) neurons through heating. These stimuli were each delivered for 20 s, with a 5 s gap between them (i.e. inter-stimulus interval; ISI). A break of 60 s was allowed before the start of the next training round. In total, larvae completed eight training rounds (i.e. one training period). Larvae then completed a 60 s pre-test period without stimulation before the start of the testing period. The testing period comprised three testing rounds. During a single testing round, only Or42b was activated through red light illumination for 20 s, followed by a 45 s break. (<bold>b</bold>) Time-course of the percentage of experimental larvae bending during the testing period, averaged across all three testing rounds. Data were down-sampled from 20 Hz to 1 Hz to aid visualisation. Grey shading indicates the period of Or42b stimulation. Error shading shows the mean ± 95% confidence intervals (<bold>c</bold>) The average percentage of experimental larvae bending during the PRE (10–0 s before light onset), ON (0–20 s after light onset), and OFF (0–20 s after light offset) testing windows. Bars show medians, as well as upper and lower quartiles of data. (<bold>d, e</bold>) Data presented as in b and c, but for control larvae. (<bold>f</bold>) Percentage bending difference (ON-OFF) values after forward- and backward-paired training for both experimental and control larvae. Bars show medians, as well as upper and lower quartiles of data. Statistics calculated with a two-sided Mann-Whitney <italic>U</italic> test; * p &lt; .01, *** p &lt; .0001. See <xref ref-type="supplementary-material" rid="fig3sdata1">Figure 3—source data 1</xref>.</p><p><supplementary-material id="fig3sdata1"><label>Figure 3—source data 1.</label><caption><title>Behavioural data recorded during the testing period of associative conditioning experiments.</title></caption><media mimetype="application" mime-subtype="zip" xlink:href="elife-70015-fig3-data1-v3.zip"/></supplementary-material></p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-70015-fig3-v3.tif"/></fig><p>Experimental larvae showed attraction to Or42b activation after backward-paired training, bending less to fictive odour onset and more to odour offset in the testing period. However, after forward-paired training, experimental larvae showed reduced attraction to Or42b (<xref ref-type="fig" rid="fig3">Figure 3B</xref>). This effect can also be seen in the averaged percentage of larvae bending for each of the three testing windows (<xref ref-type="fig" rid="fig3">Figure 3C</xref>). We statistically confirmed this qualitative difference between training conditions for experimental larvae. Percentage bending differences were significantly smaller after forward-paired training (mean = −5.22%, sd = 18.23%, n = 71) compared to backward-paired training (mean = −29.65%, sd = 14.10%, n = 70) (p&lt;0.0001, common language effect size (CLES)=0.852; <xref ref-type="fig" rid="fig3">Figure 3F</xref>). This result matched our expectation, given existing knowledge that Basin activation alone produces an aversive response and that larvae avoid odours paired with Basin activation (<xref ref-type="bibr" rid="bib37">Eschbach et al., 2020</xref>).</p><p>The responses of control larvae to Or42b activation were more similar between training conditions (<xref ref-type="fig" rid="fig3">Figure 3D</xref>, <xref ref-type="fig" rid="fig3">Figure 3E</xref>). However, as with experimental larvae, percentage bending differences were also significantly smaller after forward-paired training (mean = −21.76%, sd = 15.63%, n = 49) compared to backward-paired training (mean = −30.22%, sd = 14.83%, n = 55), although with a substantially reduced effect size (p=0.009, CLES = 0.648; <xref ref-type="fig" rid="fig3">Figure 3F</xref>). This difference between training conditions in control larvae suggests that the delivery of mild heat after Or42b stimulation was sufficient to weaken larval attraction to this fictive odour. This result is consistent with prior work showing larval classical conditioning using mild heat as reinforcement (<xref ref-type="bibr" rid="bib80">Khurana et al., 2012</xref>). Importantly, however, forward-paired training yielded significantly smaller percentage bending differences in experimental larvae compared to control larvae (i. e. mean = −5.22% vs –21.76%) (p&lt;0.0001, CLES = 0.752; <xref ref-type="fig" rid="fig3">Figure 3F</xref>). This result shows that activating Basin neurons after Or42b caused significantly greater aversion to this fictive odour, as opposed to delivering mild heat alone. Bending differences following backward-paired training did not differ significantly between genotypes (p&gt;0.5).</p><p>These results show that our tracker can be used to perform automated, high-throughput classical conditioning in <italic>Drosophila</italic> larvae. To the best of our knowledge, these results also provide the first evidence that larvae can perform classical conditioning with significant offset-to-onset gaps (9 s) between stimuli (i.e. trace conditioning).</p></sec><sec id="s2-4"><title>Operant conditioning of larval bend direction</title><p>Our system’s closed-loop stimulation capabilities allowed us to investigate whether <italic>Drosophila</italic> larvae are capable of operant learning. We chose fictive activation of candidate reward circuits as a US (<xref ref-type="fig" rid="fig4">Figure 4A</xref>), but were challenged to determine which neurons could convey a reinforcement signal for operant learning. Across the animal kingdom, biogenic amine neurotransmitters including dopamine, octopamine, and serotonin can provide reinforcement signals (<xref ref-type="bibr" rid="bib49">Giurfa, 2006</xref>; <xref ref-type="bibr" rid="bib57">Hawkins and Byrne, 2015</xref>; <xref ref-type="bibr" rid="bib104">Meneses and Liy-Salmeron, 2012</xref>; <xref ref-type="bibr" rid="bib39">Fee and Goldberg, 2011</xref>). With this knowledge, we aimed to induce larval operant conditioning by stimulating both dopaminergic and serotonergic neurons across the <italic>Drosophila</italic> CNS. The Ddc-Gal4 driver is ideally suited for this purpose, covering a broad set of neurons containing these biogenic amines (<xref ref-type="bibr" rid="bib89">Li et al., 2000</xref>; <xref ref-type="bibr" rid="bib141">Sitaraman et al., 2008</xref>; <xref ref-type="bibr" rid="bib97">Lundell and Hirsh, 1994</xref>), including the MB-innervating protocerebral anterior medial (PAM) cluster dopaminergic neurons (<xref ref-type="bibr" rid="bib94">Liu et al., 2012</xref>; <xref ref-type="bibr" rid="bib6">Aso et al., 2012</xref>). Although the function of most Ddc neurons is unknown, PAM cluster activation serves as both a necessary and sufficient reward signal in classical conditioning (<xref ref-type="bibr" rid="bib128">Rohwedder et al., 2016</xref>; <xref ref-type="bibr" rid="bib94">Liu et al., 2012</xref>; <xref ref-type="bibr" rid="bib161">Vogt et al., 2014</xref>; <xref ref-type="bibr" rid="bib23">Cognigni et al., 2018</xref>; <xref ref-type="bibr" rid="bib163">Waddell, 2013</xref>), and collective activation of Ddc neurons can substitute for an olfactory conditioning reward in adult flies (<xref ref-type="bibr" rid="bib94">Liu et al., 2012</xref>; <xref ref-type="bibr" rid="bib139">Shyu et al., 2017</xref>; <xref ref-type="bibr" rid="bib6">Aso et al., 2012</xref>). If either dopamine or serotonin mediates valence signalling in larval operant conditioning, paired activation of Ddc neurons with behaviour may be sufficient to induce such learning.</p><fig-group><fig id="fig4" position="float"><label>Figure 4.</label><caption><title>Operant conditioning of bend direction in <italic>Drosophila</italic> larvae requires the ventral nerve cord.</title><p>(<bold>a</bold>) The goal of our automated operant conditioning paradigm is to reinforce an action of interest by coupling real-time behaviour detection with optogenetic activation of reward circuits. (<bold>b</bold>) High-throughput experiment protocol. During training, each larva (black contour with green head) received optogenetic stimulus (red light bulb) when bent to one predefined side (depicted as left), and no stimulus otherwise (grey light bulb). (<bold>c–h</bold>) Gal4 expression is depicted as color-coded CNS (see legend). UAS-CsChrimson effector abbreviated as CsChr for visual clarity. Bars show medians, as well as upper and lower quartiles of data. Outliers (filled diamonds) are randomly jittered horizontally to aid visualisation. (<bold>c–f</bold>) top row. Larval bend rate shown as number of bends per minute, grouped by bends to stimulated side (dark red) or unstimulated side (grey). For larvae that received random, uncorrelated stimulation during 50% of bends (<bold>d</bold>), left and right bend rate are shown in light red. Statistical comparisons calculated using a paired, two-sided Wilcoxon signed-rank test. (<bold>c–f</bold>) bottom row. Difference in bend rate (black) shown between the stimulated and unstimulated sides or, in the case of the uncorrelated training group (panel <bold>d</bold>), between left and right sides. Statistical comparisons calculated using a two-sided Wilcoxon signed-rank test. (<bold>c–f</bold>). Data shown from the test periods before training round 1 (Before) and after training round 4 (After). n is the number of larvae in each time bin. Exact p-values written above corresponding data. ns p ≥ .05 (not significant), * p &lt; .05, ** p &lt; .01, *** p &lt; .001. (<bold>g</bold>). Bend rate data after training round 4 (same data as in (<bold>c</bold>) and (<bold>d</bold>) top row), with bend rate for uncorrelated training group calculated without stratification by bend direction. Statistics calculated with a two-sided Mann-Whitney <italic>U</italic> test, with Bonferroni correction; ns p ≥ .05/2 (not significant), ** p &lt; .01/2. (<bold>e</bold>) Difference in bend rate after training round 4 (same data as in <bold>c–f</bold> bottom row). Statistical comparisons against Ddc &gt; CsChr calculated with a two-sided Mann-Whitney <italic>U</italic> test, with Bonferroni correction; * p &lt; .05/3, ** p &lt; .01/3. See <xref ref-type="supplementary-material" rid="fig4sdata1">Figure 4—source data 1</xref>.</p><p><supplementary-material id="fig4sdata1"><label>Figure 4—source data 1.</label><caption><title>Source data showing that operant conditioning of bend direction in <italic>Drosophila</italic> larvae requires the ventral nerve cord.</title></caption><media mimetype="application" mime-subtype="xlsx" xlink:href="elife-70015-fig4-data1-v3.xlsx"/></supplementary-material></p><p><supplementary-material id="fig4sdata2"><label>Figure 4—source data 2.</label><caption><title>Source data showing that <italic>Drosophila</italic> larvae exhibit bend direction preference during operant paradigm training.</title></caption><media mimetype="application" mime-subtype="xlsx" xlink:href="elife-70015-fig4-data2-v3.xlsx"/></supplementary-material></p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-70015-fig4-v3.tif"/></fig><fig id="fig4s1" position="float" specific-use="child-fig"><label>Figure 4—figure supplement 1.</label><caption><title>Ddc-Gal4 expression pattern without and with tsh-Gal80 restriction.</title><p>Maximum intensity projections of confocal images obtained after immunohistochemical staining. Plan-Apochromat 20x objective, resolution: 592 x 800 pixels, scale bar: 100 μm. Images courtesy of the HHMI Janelia FlyLight team. (<bold>a, e</bold>) (green in <bold>d</bold> and <bold>h</bold>). Targeting a green fluorescent protein (GFP) antibody to the mVenus tag of CsChrimson. (<bold>b, f</bold>) (red in <bold>d</bold> and <bold>h</bold>). Staining against BP104. (<bold>c, g</bold>) (blue in <bold>d</bold> and <bold>h</bold>) Staining against N-cadherin. (<bold>a–d</bold>) Ddc&gt;CsChrimson larvae. Manually counting the cell bodies in the image stacks revealed more than 200 GFP-positive neurons located in the brain, subesophageal zone (SEZ), and ventral nerve cord (VNC), including the PAM cluster dopaminergic neurons innervating the mushroom body (n = 2). This confirmed that Ddc- Gal4 drives broad expression across the central nervous system (CNS) ( <xref ref-type="bibr" rid="bib89">Li et al., 2000</xref>; <xref ref-type="bibr" rid="bib97">Lundell and Hirsh, 1994</xref>). (<bold>e–h</bold>) Ddc&gt;CsChrimson, tsh&gt;Gal80 larvae. As expected, no GFP-positive neurons were found in the VNC (n = 6). Ddc brain and SEZ expression remained largely unaffected by Gal80, as the GFP-positive neurons in both areas that could be consistently identified in Ddc&gt;CsChrimson larvae (n = 3) were also present in Ddc&gt;CsChrimson, tsh&gt;Gal80 larvae (n = 3).</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-70015-fig4-figsupp1-v3.tif"/></fig><fig id="fig4s2" position="float" specific-use="child-fig"><label>Figure 4—figure supplement 2.</label><caption><title><italic>Drosophila</italic> larvae show bend direction preference during operant paradigm training.</title><p>High-throughput experiments followed the protocol depicted in <xref ref-type="fig" rid="fig4">Figure 4B</xref>. Gal4 expression depicted as color-coded CNS (see legend). UAS-CsChrimson effector abbreviated as CsChr for visual clarity. Data shown in 1 min time bins (separated by vertical dashed lines) across the entire experiment, beginning with the test period before training round 1 and ending with the test period after training round 4. Larval bend rate shown as number of bends per minute, grouped by bends to stimulated side (dark red) or unstimulated side (dark grey). For larvae that received random, uncorrelated stimulation during 50% of bends (panel <bold>b</bold>), left and right bend rate are shown in light red. Bars show medians, as well as upper and lower quartiles of data. Outliers (open diamonds) are randomly jittered horizontally to aid visualisation. Number of larvae in each time bin is written just below the x-axis. Exact p-values written above corresponding data. Statistical comparisons calculated using a paired, two-sided Wilcoxon signed-rank test. ns p ≥ .05 (not significant), * p &lt; .05, ** p &lt; .01, *** p &lt; .001. See <xref ref-type="supplementary-material" rid="fig4sdata1">Figure 4—source data 1</xref>.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-70015-fig4-figsupp2-v3.tif"/></fig><fig id="fig4s3" position="float" specific-use="child-fig"><label>Figure 4—figure supplement 3.</label><caption><title>Operant conditioning of bend direction in <italic>Drosophila</italic> larvae with single-larva tracker.</title><p>(<bold>a</bold>) Software framework of single-larva tracker. Still images from the graphical user interface show aerial views of a single <italic>Drosophila</italic> larva in the behaviour arena (blue outline: contour; head: green dot; tail: red dot; green words: detected behaviours). (<bold>b</bold>) Hardware schematic for optogenetic stimulation. System hardware was nearly identical to that described in <xref ref-type="bibr" rid="bib136">Schulze et al., 2015</xref>. A camera and an IR backlight, both mounted on motorised linear slides, tracked the real-time behaviours of a single larva moving along a stationary agarose plate. When a chosen behaviour was detected, the red LED turned on, stimulating the larva. (<bold>c</bold>) Experiment protocol using the single-larva closed-loop tracker. Behaviours are depicted as larval contours (black) with head (green dot). During training, the larva received optogenetic stimulus (red light bulb) when bent to one predefined side (depicted as left), and no stimulus otherwise (grey light bulb). (<bold>d, e, f</bold>) Gal4 expression depicted as color-coded CNS (see legend). UAS-CsChrimson effector abbreviated as CsChr for visual clarity. Bars show medians, as well as upper and lower quartiles of data. Outliers (filled diamonds) are randomly jittered horizontally to aid visualisation. d, e top row. Larval bend rate shown as number of bends per minute, grouped by bends to stimulated side (dark red) or unstimulated side (grey). Statistical comparisons calculated using a paired, twosided Wilcoxon signed-rank test. (<bold>d, e</bold>) bottom row. Difference in bend rate (black) between the stimulated and unstimulated sides. Statistical comparisons calculated using a two-sided Wilcoxon signed-rank test. (<bold>d–e</bold>) Data shown from the test periods before training round 1 (Before) and after training round 2 (After). n is the number of larvae in each time bin. Exact p-values written above corresponding data. ns p ≥ 0.05 (not significant), * p &lt; 0.05, ** p &lt; 0.01. f. Difference in bend rate after training round 2 (same data as in d and e bottom row). Statistical comparison between genotypes calculated using a two-sided Mann-Whitney U test. * p &lt; 0.05. See <xref ref-type="supplementary-material" rid="fig4sdata2">Figure 4—source data 2</xref>.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-70015-fig4-figsupp3-v3.tif"/></fig></fig-group><p>The CS in our automated operant conditioning paradigm was larval bending (<xref ref-type="fig" rid="fig4">Figure 4B</xref>). We expressed UAS-CsChrimson under the control of the Ddc-Gal4 driver, with the intention of activating corresponding neurons via optogenetic stimulation during bends to a predefined side. Our goal was to establish a learned direction preference, conditioning Ddc&gt;CsChrimson larvae to bend more often to one side than the other. The methodological choice of optogenetics was informed, in part, by a deeper investigation of larval heating dynamics as they relate to average bend duration. We determined that our IR stimulation hardware takes approximately 4 s to heat larval tissue to the nearly 30℃ required for dTrpA1 channel activation (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>; see also LABEL:sec:materials_and_methods). Knowing that the average duration of a larval bend is only a third of that time (mean = 1.35 s, sd = 1.67 s, n = 4622 bends), we concluded that closed-loop heat stimulation would activate neurons of interest only after a noticeable delay relative to behaviour detection, with possibly other behaviours occurring during the delay period. Such a task in which different behaviours are occurring prior to reinforcement could be very difficult to learn. Quicker heating was achievable with increased laser intensity, but such an approach risked overshooting the desired temperature and damaging larval tissue (data not shown). Any safe thermogenetic approach would therefore be too slow to temporally align the US induced via larval heating with a specific larval action. A second important methodological consideration was the risk of establishing conflicting valence signals. We wanted to avoid mixing punishment (via IR-induced tissue heating) with reward (via IR-induced activation of Ddc neurons) during training. With mild heat more aversive to larvae than visible red light (compare bending in control larvae in <xref ref-type="fig" rid="fig2">Figure 2D, E</xref>, ), we favoured optogenetics over thermogenetics for our operant conditioning paradigm.</p><p>Although the direction of bending that triggered optogenetic stimulation was randomised across operant conditioning trials, we summarise the experiment procedure for which this predefined side was the larva’s left (<xref ref-type="fig" rid="fig4">Figure 4B</xref>). Each experiment began with a 1 min test period without red light presentation. Four training rounds followed (each 3 min long) in which larvae received optogenetic stimulation for the full duration of every left bend. The time between the tracker detecting a left bend and light onset was no longer than 50 ms. Between training rounds, larvae experienced 3 min without stimulation. This time was used to brush larvae back to the centre of the agarose plate. We performed this recentring to mitigate the experimental side effects of larvae reaching the plate’s edge (see Materials and methods for more details). Following the fourth training round was a 1 min test period without stimulation (<xref ref-type="fig" rid="fig4">Figure 4B</xref>). For each larva, bend rate, measured as the number of bends per minute performed towards a given side, served as a read-out for bend direction preference. The difference in bend rate between the stimulated and unstimulated side was also calculated for each larva. This equates to the number of bends per minute to the stimulated side minus the number of bends per minute to the unstimulated side. Within a given time bin (see Materials and methods for more details), the statistical test comparing the difference in bend rate to zero is mathematically equivalent to comparing bend rates against one another. However, computing the difference in bend rate facilitated comparison between genotypes that themselves may differ in basal bend rate.</p><p>In the 1 min test before the first training round, we observed no significant difference in bend rate to either side for Ddc&gt;CsChrimson larvae (p&gt;0.5; <xref ref-type="fig" rid="fig4">Figure 4C</xref>). Larval bend rate to the stimulated side was significantly greater than that of the unstimulated side throughout the majority of training, with this difference tending to widen over the course of each round (<xref ref-type="fig" rid="fig4s2">Figure 4—figure supplement 2</xref>). These findings suggest that Ddc activation can function as a rewarding stimulus that larvae increasingly seek with time. In the 1 min test after the fourth training round, larvae showed a significantly greater bend rate towards the side paired with red light stimulation during training (mean = 4.84, sd = 2.40, n = 143) compared to the previously unstimulated side (mean = 4.10, sd = 2.23, n = 143) (p=0.0007, CLES = 0.59; <xref ref-type="fig" rid="fig4">Figure 4C</xref>) indicating operant conditioning of bend direction.</p><p>We also used a previously developed, low-throughput, single-larva, closed-loop tracking system to test the reproducibility of this result on a different system (see Materials and methods for more details) (<xref ref-type="bibr" rid="bib136">Schulze et al., 2015</xref>). Fictive Ddc activation with this system also yielded a significant bend direction preference to the previously stimulated (mean = 5.77, sd = 2.71, n = 109) versus previously unstimulated (mean = 4.73, sd = 2.73, n = 109) side (p=0.0043, CLES = 0.63), after training. These results contrast those of effector control larvae that had the UAS-CsChrimson transgene but not the Ddc-GAL4. The control larvae show no difference in bend rate to either side after training. Based on these control larvae, we concluded that potential leaky expression of CsChrimson in neurons outside of the Ddc expression pattern is not causing operant learning (<xref ref-type="fig" rid="fig4s3">Figure 4—figure supplement 3</xref>).</p><p>To confirm that the observed bend direction preference was attributable to pairing Ddc activation with bends solely in one direction, we conducted another control experiment in our high-throughput multi-larva training rig, in which larvae received random, uncorrelated stimulation during 50% of all bends. Before, during and after training, these larvae showed no difference in absolute left and right bend rates (p&gt;0.5), with the exception of the first minute of training round 4 (<xref ref-type="fig" rid="fig4">Figure 4D</xref>, <xref ref-type="fig" rid="fig4s2">Figure 4—figure supplement 2</xref>). These larvae also showed a significantly lower difference between left and right bend rates after training (mean = -0.28, sd = 2.73, n = 160) compared to pair-trained larvae (mean = 0.74, sd = 2.62, n = 143) (p=0.0020, CLES = 0.60; <xref ref-type="fig" rid="fig4">Figure 4H</xref>). Further dissection of bend rates to each side showed that, after training, bend rates averaged together for larvae that received uncorrelated training (mean = 4.80, sd = 2.39, n = 160) were indistinguishable from the rate of pair-trained larvae bending to the previously stimulated side (mean = 4.84, sd = 2.40, n = 143) (p&gt;0.5; <xref ref-type="fig" rid="fig4">Figure 4G</xref>). However, larvae that received uncorrelated training showed a significantly higher bend rate (mean = 4.80, sd = 2.39, n = 160) compared to pair-trained larvae bending to the previously unstimulated side (mean = 4.10, sd = 2.23, n = 143) (p=0.0037, CLES = 0.58; <xref ref-type="fig" rid="fig4">Figure 4G</xref>). This suggests that the pair-trained Ddc&gt;CsChrimson larvae have learnt to avoid the unstimulated side. There is growing evidence from classical conditioning that larvae can learn that an unpaired stimulus predicts the absence of reinforcement (<xref ref-type="bibr" rid="bib134">Schleyer et al., 2018</xref>; <xref ref-type="bibr" rid="bib37">Eschbach et al., 2020</xref>). Perhaps larvae are also forming memories of opposite valence in our operant conditioning paradigm, bending less to the unstimulated side because bending to that side predicts the absence of appetitive Ddc activation.</p></sec><sec id="s2-5"><title>The mushroom body is not sufficient to mediate operant conditioning in larvae</title><p>Our experiments showed that fictive activation of Ddc neurons is a sufficient US for operant conditioning. While we did not identify which individual neurons mediate the observed effect, we hypothesised that not all Ddc neurons are involved. Some prior work in adult flies suggests that the MB is involved in operant conditioning (<xref ref-type="bibr" rid="bib148">Sun et al., 2020</xref>), while other studies in the adult suggest that operant conditioning does not require the MB (<xref ref-type="bibr" rid="bib11">Booker and Quinn, 1981</xref>; <xref ref-type="bibr" rid="bib166">Wolf et al., 1998</xref>; <xref ref-type="bibr" rid="bib24">Colomb and Brembs, 2010</xref>; <xref ref-type="bibr" rid="bib25">Colomb and Brembs, 2016</xref>) and may instead involve motor neuron plasticity (<xref ref-type="bibr" rid="bib25">Colomb and Brembs, 2016</xref>). In classical conditioning of both adult and larval <italic>Drosophila</italic>, the MB has been identified as a convergence site for the external CS and the rewarding or punishing US (<xref ref-type="bibr" rid="bib23">Cognigni et al., 2018</xref>; <xref ref-type="bibr" rid="bib60">Heisenberg et al., 1985</xref>; <xref ref-type="bibr" rid="bib61">Heisenberg, 2003</xref>; <xref ref-type="bibr" rid="bib128">Rohwedder et al., 2016</xref>; <xref ref-type="bibr" rid="bib161">Vogt et al., 2014</xref>; <xref ref-type="bibr" rid="bib129">Saumweber et al., 2018</xref>; <xref ref-type="bibr" rid="bib115">Owald and Waddell, 2015</xref>). In each larval brain hemisphere, the MB comprises approximately 110 CS-encoding Kenyon cells (KCs) (<xref ref-type="bibr" rid="bib7">Aso et al., 2014</xref>; <xref ref-type="bibr" rid="bib64">Honegger et al., 2011</xref>; <xref ref-type="bibr" rid="bib10">Berck et al., 2016</xref>; <xref ref-type="bibr" rid="bib93">Lin et al., 2014</xref>; <xref ref-type="bibr" rid="bib115">Owald and Waddell, 2015</xref>; <xref ref-type="bibr" rid="bib18">Campbell et al., 2013</xref>; <xref ref-type="bibr" rid="bib155">Turner et al., 2008</xref>; <xref ref-type="bibr" rid="bib35">Eichler et al., 2017</xref>) that synapse onto 24 MB output neurons (MBONs) driving approach or avoidance (<xref ref-type="bibr" rid="bib7">Aso et al., 2014</xref>; <xref ref-type="bibr" rid="bib115">Owald and Waddell, 2015</xref>; <xref ref-type="bibr" rid="bib118">Perisse et al., 2016</xref>; <xref ref-type="bibr" rid="bib138">Séjourné et al., 2011</xref>; <xref ref-type="bibr" rid="bib129">Saumweber et al., 2018</xref>; <xref ref-type="bibr" rid="bib139">Shyu et al., 2017</xref>; <xref ref-type="bibr" rid="bib121">Plaçais et al., 2013</xref>; <xref ref-type="bibr" rid="bib35">Eichler et al., 2017</xref>). Dopaminergic and octopaminergic neurons that represent the rewarding or punishing US modulate KC to MBON connection strength (<xref ref-type="bibr" rid="bib137">Schwaerzel et al., 2003</xref>; <xref ref-type="bibr" rid="bib135">Schroll et al., 2006</xref>; <xref ref-type="bibr" rid="bib65">Honjo and Furukubo-Tokunaga, 2009</xref>; <xref ref-type="bibr" rid="bib161">Vogt et al., 2014</xref>; <xref ref-type="bibr" rid="bib129">Saumweber et al., 2018</xref>; <xref ref-type="bibr" rid="bib163">Waddell, 2013</xref>; <xref ref-type="bibr" rid="bib38">Eschbach et al., 2021</xref>). The extent to which the MB is dispensable in larval operant conditioning is, by contrast, unknown.</p><p>We investigated whether subsets of Ddc neurons in the brain and SEZ could support memory formation in our bend direction paradigm. Gal80 under control of the tsh promoter suppresses expression in the VNC, but not in the brain or SEZ (<xref ref-type="bibr" rid="bib22">Clyne and Miesenböck, 2008</xref>; <xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1</xref>). We took an intersectional approach by targeting these transgenes with the LexA/LexAop binary system (<xref ref-type="bibr" rid="bib140">Simpson, 2016</xref>) and expressing CsChrimson in Ddc neurons using Gal4/UAS. Prior to training with our operant conditioning protocol (<xref ref-type="fig" rid="fig4">Figure 4B</xref>), Ddc&gt;CsChrimson, tsh &gt;Gal80 larvae showed no directional bias in bend rate (p&gt;0.5; <xref ref-type="fig" rid="fig4">Figure 4E</xref>). Observations of larval bend rates during training revealed a persistent, and in some cases statistically significant, direction preference to the unstimulated side (<xref ref-type="fig" rid="fig4s2">Figure 4—figure supplement 2</xref>). In vertebrates, dopamine release is crucial for not only learning but also action selection (<xref ref-type="bibr" rid="bib53">Grillner et al., 2013</xref>). We wondered whether our targeted activation of only brain and SEZ dopaminergic neurons affected the larval motor program in a functionally analogous manner, causing the observed decrease in bends to the stimulated side. Following training, these larvae were equally likely to bend towards the side where they had previously received the optogenetic stimulus (mean = 3.55, sd = 2.33, n = 175) as they were to bend towards the previously unstimulated side (mean = 3.53, sd = 2.36, n = 175) (p&gt;0.5; <xref ref-type="fig" rid="fig4">Figure 4E</xref>). The after training difference in bend rate for these larvae (mean = 0.029, sd = 2.41, n = 175) was significantly lower than that of Ddc&gt;CsChrimson larvae (mean = 0.74, sd = 2.62, n = 143) (p=0.012, CLES = 0.58; <xref ref-type="fig" rid="fig4">Figure 4H</xref>). Based on these results, the dopaminergic and serotonergic neurons in the brain are not sufficient for operant conditioning. In contrast, the dopaminergic and serotonergic neurons in the VNC appear critical to the bend direction preference formed following paired optogenetic activation of all Ddc neurons.</p><p>We also tested whether exclusively activating the PAM cluster dopaminergic neurons innervating the MB could induce operant conditioning. 58E02-Gal4 drives expression in the majority of these neurons (<xref ref-type="bibr" rid="bib128">Rohwedder et al., 2016</xref>). In the test period before training, 58E02&gt;CsChrimson larvae did not exhibit a bend direction preference (p&gt;0.5; <xref ref-type="fig" rid="fig4">Figure 4F</xref>). During training, however, these larvae showed a significant bend direction preference to the unstimulated side (<xref ref-type="fig" rid="fig4s2">Figure 4—figure supplement 2</xref>). Future work is necessary to assess whether these preference results are partly a consequence of these neurons’ role in motor control. 58E02 neurons have synaptic connections to aversive MBONs (<xref ref-type="bibr" rid="bib35">Eichler et al., 2017</xref>), though the absence of functional testing in larvae leads to uncertainty about whether these connections are excitatory, inhibitory, or modulatory. Following training, 58E02&gt;CsChrimson larvae did not exhibit a learned direction preference for bends to either the previously stimulated (mean = 4.41, sd = 2.16, n = 145) or unstimulated (mean = 4.55, sd = 2.10, n = 145) side (p&gt;0.5; <xref ref-type="fig" rid="fig4">Figure 4F</xref>). Because 58E02 comprises a small subset of Ddc neurons (for which fictive activation yielded an operant learning effect), these negative results also help confirm the absence of leaky UAS-CsChrimson expression. Indeed, these larvae exhibited a significantly lower difference in bend rate after training (mean = -0.14, sd = 2.71, n = 145) compared to Ddc&gt;CsChrimson larvae (mean = 0.74, sd = 2.62, n = 143) (p=0.015, CLES = 0.58; <xref ref-type="fig" rid="fig4">Figure 4H</xref>). It remains to be seen whether these PAM cluster neurons contribute to memory formation by interacting with other Ddc neurons, especially those in the VNC. These results do, however, further support the idea that operant conditioning in <italic>Drosophila</italic> may not be mediated by the MB.</p></sec><sec id="s2-6"><title>Serotonergic VNC neurons may play role in operant conditioning of bend direction</title><p>Pairing an action with activation of numerous dopaminergic and serotonergic neurons across the CNS was sufficient to induce operant conditioning of bend direction. Furthermore, our results indicated that the VNC subset of these neurons was critical to memory formation in the paradigm. It was an open question, however, whether this learning was mediated by dopamine, serotonin, or both. We expressed CsChrimson under the control of two sparse dopaminergic and serotonergic driver lines to investigate whether either neurotransmitter could exclusively induce operant conditioning of bend direction.</p><p>TH-Gal4 covers most dopaminergic neurons except the PAM cluster (<xref ref-type="bibr" rid="bib128">Rohwedder et al., 2016</xref>). Under our high-throughput training protocol (<xref ref-type="fig" rid="fig4">Figure 4B</xref>), TH&gt;CsChrimson larvae showed no difference in bend rate between the previously stimulated and unstimulated sides in the 1 min test periods either before (mean = 5.29, sd = 2.03 stimulated versus mean = 5.77, sd = 2.60 unstimulated; n = 75) or after (mean = 4.39, sd = 2.28 stimulated versus mean = 3.98, sd = 1.93 unstimulated; n = 122) training (p&gt;0.5; <xref ref-type="fig" rid="fig5">Figure 5A</xref>). Tph-Gal4 targets the majority of serotonergic neurons and no dopaminergic neurons across the CNS of third-instar larvae (<xref ref-type="bibr" rid="bib68">Huser et al., 2012</xref>). Before training, Tph&gt;CsChrimson larvae showed no difference in bend rate between sides (mean = 5.27, sd = 3.53 stimulated versus mean = 4.86, sd = 2.83 unstimulated; n = 77) (p&gt;0.5; <xref ref-type="fig" rid="fig5">Figure 5B</xref>). Paired activation of Tph neurons during bends to one side resulted in a significantly higher bend rate to the stimulated side (mean = 3.62, sd = 2.15, n = 126) relative to the unstimulated side (mean = 3.29, sd = 2.46, n = 126) after training (p=0.019, CLES = 0.58; <xref ref-type="fig" rid="fig5">Figure 5B</xref>). Notably, no statistically significant difference was observed when directly comparing the difference in bend rate between TH&gt;CsChrimson (mean = 0.41, sd = 2.42, n = 122) and Tph&gt;CsChrimson (mean = 0.33, sd = 2.51, n = 126) larvae after training (p&gt;0.5; <xref ref-type="fig" rid="fig5">Figure 5D</xref>). Together, these results suggest a cautious interpretation. Although activation of Tph serotonergic neurons on their own appears sufficient to form a learned direction preference in our paradigm, we cannot exclude the possibility that TH dopamine neurons also contribute to operant learning, even though they were not sufficient to induce learning.</p><fig-group><fig id="fig5" position="float"><label>Figure 5.</label><caption><title>Serotonergic neurons may mediate operant conditioning.</title><p>High-throughput experiments followed the protocol depicted in <xref ref-type="fig" rid="fig4">Figure 4B</xref>. Gal4 expression is depicted as color-coded CNS (see legend). UAS-CsChrimson effector abbreviated as CsChr for visual clarity. Bars show medians, as well as upper and lower quartiles of data. Outliers (filled diamonds) are randomly jittered horizontally to aid visualisation. (<bold>a–c</bold>) top row. Larval bend rate shown as number of bends per minute, grouped by bends to stimulated side (dark red) or unstimulated side (grey). Statistical comparisons calculated using a paired, two-sided Wilcoxon signed-rank test. (<bold>a–c</bold>) bottom row. Difference in bend rate (black) shown between the stimulated and unstimulated sides. Statistical comparisons calculated using a two-sided Wilcoxon signed-rank test. (<bold>a–c</bold>). Data shown from the test periods before training round 1 (Before) and after training round 4 (After). n is the number of larvae in each time bin. Exact p-values written above corresponding data. ns p ≥ .05 (not significant), * p &lt; .05. (<bold>d</bold>) Difference in bend rate after training round 4 (same data as in <bold>a–c</bold> bottom row). Statistical comparisons against Tph &gt; CsChr calculated with a two-sided Mann-Whitney <italic>U</italic> test, with Bonferroni correction; ns p ≥ .05/2 (not significant), * p &lt; .05/2. See <xref ref-type="supplementary-material" rid="fig5sdata1">Figure 5—source data 1</xref>.</p><p><supplementary-material id="fig5sdata1"><label>Figure 5—source data 1.</label><caption><title>Source data showing that serotonergic neurons may mediate operant conditioning.</title></caption><media mimetype="application" mime-subtype="xlsx" xlink:href="elife-70015-fig5-data1-v3.xlsx"/></supplementary-material></p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-70015-fig5-v3.tif"/></fig><fig id="fig5s1" position="float" specific-use="child-fig"><label>Figure 5—figure supplement 1.</label><caption><title>Tph-Gal4 expression pattern without and with tsh-Gal80 restriction.</title><p>Maximum intensity projections of confocal images obtained after immunohistochemical staining. Plan-Apochromat 20x objective, resolution: 592 x 800 pixels, scale bar: 100 μm. Images courtesy of the HHMI Janelia FlyLight team. (<bold>a–d</bold>) Tph&gt;CsChrimson larvae, (<bold>e–h</bold>) Tph&gt;CsChrimson, tsh&gt;Gal80 larvae. (<bold>a, e</bold>) (green in <bold>d</bold> and <bold>h</bold>). Staining against green fluorescent protein (GFP) antibody targeting the mVenus tag of CsChrimson. (<bold>b, f</bold>) (red in <bold>d </bold>and <bold>h</bold>). Staining against BP104. (<bold>c, g</bold>) (blue in <bold>d</bold> and <bold>h</bold>). Staining against N-cadherin.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-70015-fig5-figsupp1-v3.tif"/></fig></fig-group><p>Based on our finding that operant conditioning failed following restriction of Ddc &gt;CsChrimson expression to the brain and SEZ, we wondered whether serotonergic neurons in the VNC were also critical for operant memory formation in this paradigm. We used tsh-Gal80 to restrict the Tph-Gal4 expression pattern to the brain and SEZ. Tph&gt;CsChrimson, tsh&gt;Gal80 larvae showed no significant direction preference prior to training (mean = 3.46, sd = 2.52 stimulated versus mean = 3.99, sd = 2.97 unstimulated; n = 76) (p&gt;0.5; <xref ref-type="fig" rid="fig5">Figure 5C</xref>). Paired optogenetic activation of brain and SEZ Tph neurons with larval bends to one side did not induce a learned direction preference (mean = 1.86, sd = 1.70 stimulated versus mean = 1.98, sd = 1.74 unstimulated; n = 111) (p&gt;0.05; <xref ref-type="fig" rid="fig5">Figure 5C</xref>). The difference in bend rate after training for Tph&gt;CsChrimson, tsh&gt;Gal80 larvae (mean = -0.12, sd = 1.83, n = 111) was significantly lower than that of Tph&gt;CsChrimson larvae (mean = 0.33, sd = 2.51, n = 126) (p=0.025, CLES = 0.58; <xref ref-type="fig" rid="fig5">Figure 5D</xref>). The Tph-Gal4 expression pattern contains two neurons per VNC hemisegment (with the exception of a single neuron in each A8 abdominal hemisegment) (<xref ref-type="bibr" rid="bib68">Huser et al., 2012</xref>). Future experiments exclusively targeting a single serotonergic neuron per VNC hemisegment could be valuable in determining whether they are sufficient for operant learning.</p></sec></sec><sec id="s3" sec-type="discussion"><title>Discussion</title><sec id="s3-1"><title>Automated trace conditioning of <italic>Drosophila</italic> larvae</title><p>Our classical conditioning experiments showed that <italic>Drosophila</italic> larvae significantly reduce their attraction to Or42b after this fictive odour is repeatedly paired with Basin activation. This reduction in attraction was significantly greater than that observed when Or42b stimulation was repeatedly paired with heating alone. Such results build upon prior work using similar training methods (e.g. <xref ref-type="bibr" rid="bib63">Honda et al., 2014</xref>), in particular by increasing the temporal precision of larval heating. These results demonstrate the efficacy of our larval tracking system for high-throughput automated classical conditioning, and show that larvae can form associations between purely fictive stimuli (i.e. delivered through independent opto- and thermogenetic stimulation). Most notably, we demonstrate for the first time that <italic>Drosophila</italic> larvae can perform classical conditioning in the absence of temporal overlap between CS and US (i.e. with more than a 5 s gap from CS offset to US onset). These observations extend the known limits of larval learning, and were made possible only by using a tracker with temporally precise opto- and thermogenetic stimulation.</p><p>Future studies may wish to focus on the known ability of <italic>Drosophila</italic> larvae to perform time-dependent valence reversal learning. In this paradigm, the learned valence of a CS reverses when it is delivered before vs. after the US (<xref ref-type="bibr" rid="bib129">Saumweber et al., 2018</xref>). While we observed reduced larval attraction to Or42b after forward-paired training, we did not observe increased attraction after backward-paired training. One explanation could be the slow temporal dynamics of larval cooling (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>). It is possible that residual larval body heat after IR stimulation caused Basin neurons to remain partially active during the subsequent Or42b stimulation. Future studies could address this limitation by using a backward-paired training protocol with optogenetic activation of Basin neurons and thermogenetic activation of Or42b. Following our novel observation of trace conditioning in larvae, future work could also investigate the maximum temporal gap between sensory stimuli over which larvae can still be conditioned. It will also be important to determine whether conditioning with a fictive odour stimulus changes larval responses to natural odours. For example, larvae showing reduced attraction to Or42b activation may show reduced attraction to natural odours that activate Or42b neurons (e.g. ethyl acetate).</p></sec><sec id="s3-2"><title>Automated operant conditioning of <italic>Drosophila</italic> larvae</title><p>We have also shown that <italic>Drosophila</italic> larvae are capable of operant conditioning via optogenetic activation of Ddc neurons. A significant increase in bending towards the previously stimulated side relative to the unstimulated side was only observed after coincident, positive reinforcement of this behaviour during training; a hallmark of operant conditioning. Because Ddc-Gal4 drives expression in dopaminergic and serotonergic neurons (<xref ref-type="bibr" rid="bib89">Li et al., 2000</xref>; <xref ref-type="bibr" rid="bib141">Sitaraman et al., 2008</xref>), we investigated which of these neurotransmitters support operant learning in our behavioural paradigm. Fictive activation of dopaminergic TH neurons paired with bends to one side did not yield a significant learned direction preference. In contrast, activation of serotonergic Tph neurons was sufficient to bias more bends towards the previously stimulated side. However, a direct comparison of differences in bend rate between the Tph and TH groups was itself not significant, raising the possibility that TH could weakly contribute to operant learning, even though it was not sufficient to induce significant learning in these experiments.</p><p>Of significant contrast to the Tph result was impaired operant conditioning after restricting Tph expression to only the brain and SEZ. These results suggest a novel role of VNC serotonergic neurons in conveying a reward signal for operant conditioning in <italic>Drosophila</italic> larvae.</p><p>It is noteworthy that <xref ref-type="bibr" rid="bib111">Nuwal et al., 2012</xref> used optogenetic activation of sugar-sensing neurons to establish a walking direction preference in adult <italic>Drosophila</italic>. Although we were unsuccessful in using a similar US to condition larval bend direction (data not shown), our Ddc and Tph results suggest that other sensory rewards may mediate operant conditioning if the information retrieval occurs within the VNC itself. Investigating <italic>FoxP</italic> and protein kinase C (PKC) expression in larval neurons may aid in identifying candidate neuronal populations, given both genes’ involvement in operant self-learning in adult <italic>Drosophila</italic> (<xref ref-type="bibr" rid="bib103">Mendoza et al., 2014</xref>; <xref ref-type="bibr" rid="bib15">Brembs and Plendl, 2008</xref>; <xref ref-type="bibr" rid="bib25">Colomb and Brembs, 2016</xref>). Furthermore, developing sparser lines that target single serotonergic and dopaminergic neuron types will enable the identification of the smallest subsets of neurons that are sufficient for providing the operant learning signal. Behavioural experiments with these genetic lines may have the added benefit of mitigating conflicting or non-specific reinforcement signalling.</p><p>There are limitations to interpreting behaviour following fictive neuronal activation. It will therefore be important to replicate the new paradigms developed with this rig using lower-throughput methods with natural stimuli. For example, one might modify our multi-larva tracker to accommodate closed-loop presentation of real, innately appetitive gustatory stimuli by using closed-loop control of microfluidic devices. One could also try conditioning behaviours or behavioural sequences for which operant self-learning may be more ethologically relevant (e. g. individual or cooperative digging). Importantly, however, the frequency of such behaviour in naïve, freely behaving larvae may affect the amount of US received during paired training, making observable memory formation more difficult. Our multi-larva tracker could potentially address this challenge with probabilistic, thermogenetic activation of associated command neurons and optogenetic reward when performing the desired action.</p></sec><sec id="s3-3"><title>Multi-larva tracker is a tool with wide applicability</title><p>Due to available genetic tools and the emerging connectome, the <italic>Drosophila</italic> larva is a uniquely advantageous model organism for neuroscience. Knowing this, we built a system that combines FPGA-based real-time tracking of multiple, freely-behaving larvae with independent control of larval illumination and heating. Delivering these external stimuli to larvae expressing opto- and thermosensitive proteins in their CNS allows precise activation of genetically-targeted neuronal populations. We also developed robust online behaviour detection, enabling modulated stimulus presentation as a function of individual larval action. This approach significantly broadens the range of sensory information that can be delivered in laboratory experiments, unconstrained by the need to deliver real odours, tastants, or mechanosensory experiences. A notable limitation of the existing software architecture is an inability to maintain object identity following larval collisions with each other or the plate’s edge. This could be addressed in future software modifications.</p><p>In summary, the work we presented here demonstrates the utility of our FPGA-based high-throughput, tracking and training system for developing novel classical and operant conditioning paradigms in <italic>Drosophila</italic> larvae. This system will enable rapid screening for neurons and circuits that underpin different forms of learning and also has the potential to drive future research in larval taxis (<xref ref-type="bibr" rid="bib98">Luo et al., 2010</xref>; <xref ref-type="bibr" rid="bib50">Gomez-Marin et al., 2011</xref>; <xref ref-type="bibr" rid="bib77">Kane et al., 2013</xref>; <xref ref-type="bibr" rid="bib75">Jovanic et al., 2019</xref>), decision-making (<xref ref-type="bibr" rid="bib38">Eschbach et al., 2021</xref>; <xref ref-type="bibr" rid="bib83">Krajbich, 2019</xref>; <xref ref-type="bibr" rid="bib30">DasGupta et al., 2014</xref>), and spatial navigation and memory (<xref ref-type="bibr" rid="bib108">Neuser et al., 2008</xref>; <xref ref-type="bibr" rid="bib55">Haberkern et al., 2019</xref>).</p></sec></sec><sec id="s4" sec-type="materials|methods"><title>Materials and methods</title><table-wrap id="keyresource" position="anchor"><label>Key resources table</label><table frame="hsides" rules="groups"><thead><tr><th align="left" valign="bottom">Reagent type (species) or resource</th><th align="left" valign="bottom">Designation</th><th align="left" valign="bottom">Source or reference</th><th align="left" valign="bottom">Identifiers</th><th align="left" valign="bottom">Additional information</th></tr></thead><tbody><tr><td align="left" valign="bottom">Genetic reagent (<italic>D. melanogaster</italic>)</td><td align="left" valign="bottom">w[1118]; P{y[+t7.7] w[+mC]=<break/>GMR72 F11-Gal4}attP2 (72F11-Gal4)</td><td align="left" valign="bottom">Bloomington Stock Center</td><td align="left" valign="bottom">RRID:<ext-link ext-link-type="uri" xlink:href="https://identifiers.org/RRID/RRID:BDSC_39786">BDSC_39786</ext-link></td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Genetic reagent (<italic>D. melanogaster</italic>)</td><td align="left" valign="bottom">w[1118]; P{y[+t7.7] w[+mC]=<break/>GMR69 F06-GAL4}attP2 (69F06-Gal4)</td><td align="left" valign="bottom">Bloomington Stock Center</td><td align="left" valign="bottom">RRID:<ext-link ext-link-type="uri" xlink:href="https://identifiers.org/RRID/RRID:BDSC_39497">BDSC_39497</ext-link></td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Genetic reagent (<italic>D. melanogaster</italic>)</td><td align="left" valign="bottom">w[1118];; attP2</td><td align="left" valign="bottom"><xref ref-type="bibr" rid="bib119">Pfeiffer et al., 2008</xref></td><td align="left" valign="bottom"/><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Genetic reagent (<italic>D. melanogaster</italic>)</td><td align="left" valign="bottom">w[1118] P{y[+t7.7] w[+mC]=<break/>20XUAS-IVS-CsChrimson.<break/>mVenus}attP18 (UAS-CsChrimson)</td><td align="left" valign="bottom">Bloomington Stock Center</td><td align="left" valign="bottom">RRID:<ext-link ext-link-type="uri" xlink:href="https://identifiers.org/RRID/RRID:BDSC_55134">BDSC_55134</ext-link></td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Genetic reagent (<italic>D. melanogaster</italic>)</td><td align="left" valign="bottom">UAS-dTrpA1</td><td align="left" valign="bottom">Dr Paul Garrity</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Genetic reagent (<italic>D. melanogaster</italic>)</td><td align="left" valign="bottom">13XLexAop2-CsChrimson-tdTomato <break/>in attP18; Or42b-LexAp65 in <break/>JK22C; + (Or42b&gt;CsChrimson)</td><td align="left" valign="bottom">Janelia Research Campus</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Genetic reagent (<italic>D. melanogaster</italic>)</td><td align="left" valign="bottom">w; UAS-dTRPA1, 13XLexAop2-<break/>GCAMP6s 50.641 in Su(Hw)attP5 <break/>(/Cyo); 72F11-GAL4 in attP2 (72F11&gt;dTrpA1)</td><td align="left" valign="bottom">Bloomington Stock Center</td><td align="left" valign="bottom">RRID:<ext-link ext-link-type="uri" xlink:href="https://identifiers.org/RRID/RRID:BDSC_44590">BDSC_44590</ext-link></td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Genetic reagent (<italic>D. melanogaster</italic>)</td><td align="left" valign="bottom">w[1118];; Ddc-Gal4-HL8-3D (Ddc-Gal4)</td><td align="left" valign="bottom"><xref ref-type="bibr" rid="bib89">Li et al., 2000</xref></td><td align="left" valign="bottom"/><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Genetic reagent (<italic>D. melanogaster</italic>)</td><td align="left" valign="bottom">w[1118]; P{y[+t7.7] w[+mC]=<break/>GMR58E02-GAL4}attP2 (58E02-Gal4)</td><td align="left" valign="bottom">Bloomington Stock Center</td><td align="left" valign="bottom">RRID:<ext-link ext-link-type="uri" xlink:href="https://identifiers.org/RRID/RRID:BDSC_41347">BDSC_41347</ext-link></td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Genetic reagent (<italic>D. melanogaster</italic>)</td><td align="left" valign="bottom">TH-Gal4</td><td align="left" valign="bottom">Bloomington Stock Center</td><td align="left" valign="bottom">RRID:<ext-link ext-link-type="uri" xlink:href="https://identifiers.org/RRID/RRID:BDSC_8848">BDSC_8848</ext-link></td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Genetic reagent (<italic>D. melanogaster</italic>)</td><td align="left" valign="bottom">+; Tph-Gal4; +</td><td align="left" valign="bottom"><xref ref-type="bibr" rid="bib116">Park et al., 2006</xref></td><td align="left" valign="bottom"/><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Genetic reagent (<italic>D. melanogaster</italic>)</td><td align="left" valign="bottom">20xUAS-CsChrimson-mVenus@attP18; <break/>tsh-LexA, pJFRC20-8xLexAop2-IVS-<break/>Gal80-WPRE (su(Hw)attP5)/CyO, <break/>2xTB- RFP; + (UAS-CsChrimson; <break/>tsh-LexA, LexAop-Gal80)</td><td align="left" valign="bottom">Dr Stefan Pulver, Dr Yoshinori Aso</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Genetic reagent (<italic>D. melanogaster</italic>)</td><td align="left" valign="bottom">10XUAS-IVS-myr::smGFP-HA@attP18, <break/>13XLexAop2-IVS-myr::smGFP-<break/>V5@su(Hw)attP8 (UAS-GFP)</td><td align="left" valign="bottom"><xref ref-type="bibr" rid="bib107">Nern et al., 2015</xref></td><td align="left" valign="bottom"/><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Software, algorithm</td><td align="left" valign="bottom">Custom scripts to run closed-loop <break/>multi-larva tracking and <break/>opto-/thermo-genetic stimulation</td><td align="left" valign="bottom"><ext-link ext-link-type="uri" xlink:href="https://github.com/ZlaticLab/multi-larva-tracker-scripts-public">https://github.com/ZlaticLab/multi-larva-tracker-scripts-public</ext-link>; <break/><xref ref-type="bibr" rid="bib21">Clayton et al., 2022</xref></td><td align="left" valign="bottom"/><td align="left" valign="bottom"/></tr></tbody></table></table-wrap><sec id="s4-1"><title>Multi-larva tracker</title><sec id="s4-1-1"><title>Hardware setup</title><p>A high-resolution camera (3072x3,200 pixels) (#TEL-G3-CM10-M5105, Teledyne DALSA, Ontario, Canada) positioned above a 23 cm x 23 cm 4% agarose plate captured 8-bit greyscale images at 20 Hz. The agarose plate was illuminated from below by a 30 cm x 30 cm 850 nm LED backlight (#SOBL-300x300–850, Smart Vision Lights, Norton Shores, Michigan) equipped with intensity control (#IVP-C1, Smart Vision Lights, Norton Shores, Michigan). An 800 nm longpass filter (#LP800-40.5, Midwest Optical Systems, Palatine, Illinois) mounted on the camera blocked all visible wavelengths, including those used for optogenetics. When the agarose plate comprised most of the camera image, each pixel corresponded to either 72.92 µm (for proof-of-principle and operant conditioning experiments) or 75.84 µm (for temporal dynamics of larval heating and classical conditioning experiments) (<xref ref-type="fig" rid="fig1">Figure 1</xref>).</p><p>Each camera image was processed in parallel on both the host computer (#T7920, running Windows 10, Dell Technologies Inc, Round Rock, Texas) and an FPGA device (#PCIe-1473R-LX110, National Instruments, Austin, Texas). LabVIEW 2017 (National Instruments, Austin, Texas) software extracted larval contours and interfaced with C++software that performed real-time behaviour detection. The LabVIEW software controlled closed-loop optogenetic and thermogenetic stimulation in response to these detected behaviours (<xref ref-type="fig" rid="fig1">Figure 1</xref>). All relevant experiment parameters and time-series data were output for offline analysis through a custom MATLAB framework (see LABEL:sec:materials_and_methods).</p></sec><sec id="s4-1-2"><title>Multi-animal detection and tracking</title><p>Raw camera images were read by the FPGA at 20 Hz and then sent to the host computer. The LabVIEW process on the host computer then filtered out non-larval objects by combining background subtraction and binary thresholding. The remaining objects were each enclosed in a rectangular box of minimal size, with edges parallel to the camera image axes (<xref ref-type="fig" rid="fig1">Figure 1D</xref>). We defined the following criteria to detect third-instar larvae within these boxes:</p><list list-type="bullet"><list-item><p>Pixel intensity range (default 25–170): the minimum and maximum brightness values for pixels selected by binary thresholding (between 0 and 255 for an 8-bit image).</p></list-item><list-item><p>Box side length (pixels) (default 6–100): the range of eligible values for width and height of each box.</p></list-item><list-item><p>Box width +height (pixels) (default 12–200): the range of eligible values for the sum of each box’s width and height.</p></list-item><list-item><p>Box area (pixels) (default 300–900): the range of eligible values for the area of each box.</p></list-item></list><p>To track larvae over time, the host computer assigned a numerical identifier to each eligible object. We used distance-based tracking with a hard threshold of 40 pixels to maintain larval ID based on centroid position. Although identity was lost when larvae touched or reached the plate’s edge, new IDs were generated when larvae matched detection criteria. For each of the largest 16 objects, the host computer sent a binary pixel pattern and location (defined as the centre of the box) to the FPGA. Since the host computer required more than 50ms of run time for object detection, this process was not executed in every frame. On average, the FPGA received updated objects and their locations every three frames.</p><p>The FPGA extracted object contours in three steps. Within a 2 cm<sup>2</sup> region of interest around the object’s centre, the FPGA first applied a user-defined binary threshold, then applied both vertical and a horizontal convolution with a 2x1XOR kernel, and finally generated edge pixels by combining the results of the two convolutions using an OR operation. Contours were extracted from edge images using the Moore boundary tracing algorithm (<xref ref-type="bibr" rid="bib51">Gonzalez and Woods, 2018</xref>) with three added error capture procedures. First, if the algorithm yielded a contour that ended prematurely or contained small loops, the construction process could be reversed by up to 16 contour points to find an alternative contour. Second, 10,000 FPGA clock cycles (≈ 100 us) was the maximum allotted execution time, with each pixel comparison occurring within one clock cycle. In the rare event that this window was exceeded, the algorithm returned the already constructed contour points. Third, a contour containing fewer than 63 points was rejected and the FPGA returned the last valid contour detected for a given larva ID. The algorithm stopped when none of the remaining neighbours were edge pixels (<xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>).</p></sec><sec id="s4-1-3"><title>Contour processing and landmark detection</title><p>An undesired result of the FPGA contouring algorithm was the variable number of contour points across larvae and frames. We aimed to detect behaviour based on a smooth contour with a fixed number of 100 contour points. This contour regularization was achieved inside the Behaviour Programme using Fourier decomposition and reconstruction as in <xref ref-type="bibr" rid="bib101">Masson et al., 2020</xref>.</p><p>The initial detection of head and tail was implemented on FPGA. The larva’s head and tail were defined as the contour points with the sharpest and second-sharpest curvature, respectively (<xref ref-type="fig" rid="fig1s2">Figure 1—figure supplement 2</xref>). While correct in most cases, this calculation sometimes led to flipped detection of the two body ends. The Behaviour Programme flagged and corrected these false detection events at run time by calculating the distance head and tail traveled between frames and tracking the number of correct versus flipped detection events. The vote system correction commonly failed when the larva made large angle bends. The resulting contour was nearly-circular and exhibited similar curvature across all points. The solution required resetting the vote tallies when detecting these ball events (<xref ref-type="fig" rid="fig1s2">Figure 1—figure supplement 2</xref>).</p><p>We defined the larval spine as 11 points running along the central body axis from head to tail (<xref ref-type="fig" rid="fig1s3">Figure 1—figure supplement 3</xref>; <xref ref-type="bibr" rid="bib149">Swierczek et al., 2011</xref>). In addition to head and tail, the Behaviour Programme calculated three equally distributed landmark points along the spine (neck_top, neck, and neck_down). A fourth landmark, the centroid, defined the larva’s location. The six landmarks were collectively used to extract features for training behaviour classifiers (<xref ref-type="fig" rid="fig1s3">Figure 1—figure supplement 3</xref>).</p><p>The Behaviour Programme transformed the raw contour and spine from camera coordinates (in pixels) to world coordinates (in mm). If stable larval detection criteria were met, all spine points were temporally smoothed using exponential smoothing (<xref ref-type="fig" rid="fig1s3">Figure 1—figure supplement 3</xref>).</p></sec><sec id="s4-1-4"><title>Feature extraction</title><p>We developed a machine learning approach to address the high deformability of the larva shape, ensure live execution, reduce overfitting, and limit the volume of data tagging. What follows is a brief summary of larval features describing motion direction, body shape, and velocity that were calculated from the contour and spine data inside the Behaviour Programme. Features were designed as in <xref ref-type="bibr" rid="bib101">Masson et al., 2020</xref>, with notable modifications required to run the inference live:</p><list list-type="order"><list-item><p>Motion Direction (<xref ref-type="fig" rid="fig1s4">Figure 1—figure supplement 4</xref>)</p><list list-type="simple"><list-item><p><monospace>direction_vector</monospace>: normalised vector describing the main body axis</p></list-item><list-item><p><monospace>direction_head_vector</monospace>: normalised vector describing the head axis</p></list-item><list-item><p><monospace>direction_tail_vector</monospace>: normalised vector describing the tail axis</p></list-item></list></list-item><list-item><p>Body Shape (<xref ref-type="fig" rid="fig1s5">Figure 1—figure supplement 5</xref>)</p><list list-type="simple"><list-item><p><monospace>skeleton_length</monospace>: summed distances between consecutive spine points</p></list-item><list-item><p><monospace>perimeter</monospace>: summed distances between neighbouring contour points</p></list-item><list-item><p><monospace>larva_arc_ratio</monospace>: ratio of contour perimeter to convex hull perimeter (<inline-formula><mml:math id="inf2"><mml:mrow><mml:mtext mathvariant="monospace">larva_arc_ratio</mml:mtext><mml:mo>≥</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> and was close to 1 when larva was in either straight or ball-like shape)</p></list-item><list-item><p><monospace>larva_area_ratio</monospace>: ratio of the areas enclosed by the contour and its convex hull (<inline-formula><mml:math id="inf3"><mml:mrow><mml:mn>0</mml:mn><mml:mo>≤</mml:mo><mml:mtext mathvariant="monospace">larva_area_ratio</mml:mtext><mml:mo>≤</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> and was close to 1 when the larva was in either straight, heavily curved, or ball-like shape)</p></list-item><list-item><p><monospace>eig_reduced</monospace>: <inline-formula><mml:math id="inf4"><mml:mrow><mml:mtext mathvariant="monospace">eig_reduced</mml:mtext><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mo fence="true" stretchy="false">|</mml:mo><mml:mrow><mml:msub><mml:mi>λ</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mi>λ</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo fence="true" stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>λ</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>λ</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></inline-formula> where <inline-formula><mml:math id="inf5"><mml:mrow><mml:msub><mml:mi>λ</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>λ</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> were the eigenvalues of the structure tensor of the larval contour with respect to the neck (<inline-formula><mml:math id="inf6"><mml:mrow><mml:mn>0</mml:mn><mml:mo>≤</mml:mo><mml:mtext mathvariant="monospace">eig_reduced</mml:mtext><mml:mo>≤</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> and eig_reduced decreased as the bend amplitude of the larva increased)</p></list-item><list-item><p><monospace>s</monospace>: normalised angle along the body (<inline-formula><mml:math id="inf7"><mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>0.5</mml:mn></mml:mrow><mml:mo>≤</mml:mo><mml:mtext>s</mml:mtext><mml:mo>≤</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>, was close to 1 when larva was straight, and decreased with increasing bend amplitude)</p></list-item><list-item><p><monospace>asymmetry</monospace>: sine of the angle between direction_vector and direction_head_vector (<inline-formula><mml:math id="inf8"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mtext mathvariant="monospace">asymmetry</mml:mtext></mml:mrow><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> when larva bent left and <inline-formula><mml:math id="inf9"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mtext mathvariant="monospace">asymmetry</mml:mtext></mml:mrow><mml:mo>&lt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> when larva bent right)</p></list-item><list-item><p><monospace>angle_upper_lower</monospace>: absolute angle between direction_vector and direction_head_vector (despite similarity to asymmetry, this develops different dynamics following temporal smoothing, which are valuable for stable left and right bend detection)</p></list-item></list></list-item><list-item><p>Velocity (<xref ref-type="fig" rid="fig1s6">Figure 1—figure supplement 6</xref>)</p><list list-type="simple"><list-item><p>Velocity of all six landmark points (head_speed, neck_top_speed, neck_speed, neck_down_speed, tail_speed, and v_centroid) in mm/s over interval <inline-formula><mml:math id="inf10"><mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mpadded width="+1.7pt"><mml:mn>0.2</mml:mn></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> (four frames)</p></list-item><list-item><p><monospace>v_norm</monospace>: arithmetic mean of neck_top_speed, neck_speed, and neck_down_speed, passed through a hyperbolic tangent activation function to suppress excessively large values</p></list-item><list-item><p><monospace>speed_reduced</monospace>: relative contribution of neck_top_speed to v_norm, passed through a hyperbolic tangent activation function to suppress excessively large values (speed_reduced increased when the anterior larval body moved quickly compared to the posterior, e. g. when a bend was initiated)</p></list-item><list-item><p><monospace>damped_distance</monospace>: distance (mm) travelled by neck, giving greater weight to recent over past events</p></list-item><list-item><p><monospace>crab_speed</monospace>: lateral velocity (mm/s), defined as the component of neck_speed orthogonal to direction_vector_filtered</p></list-item><list-item><p><monospace>parallel_speed</monospace>: forward velocity (mm/s), defined as the component of neck_speed_filtered parallel to direction_vector_filtered</p></list-item><list-item><p><monospace>parallel_speed_tail_raw</monospace>: tail’s forward velocity (mm/s), defined as the component of tail_speed_filtered parallel to direction_tail_vector_filtered</p></list-item><list-item><p><monospace>parallel_speed_tail</monospace>: similar to parallel_speed_tail_raw, with the difference that tail_speed_filtered was normalised prior to calculating the dot product (i. e. a measure of tail movement direction which took values between –1 (backward) and+1 (forward))</p></list-item></list></list-item></list><p>To extract features in real time and address various sources of noise, we implemented exponential smoothing defined as follows for a given feature f (<xref ref-type="fig" rid="fig1s7">Figure 1—figure supplement 7</xref>).<disp-formula id="equ1"><mml:math id="m1"><mml:mrow><mml:msub><mml:mrow><mml:mtext mathvariant="monospace">f\_filtered</mml:mtext></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>α</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>⋅</mml:mo><mml:msub><mml:mrow><mml:mtext mathvariant="monospace">f\_filtered</mml:mtext></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>α</mml:mi><mml:mo>⋅</mml:mo><mml:msub><mml:mrow><mml:mtext mathvariant="monospace">f</mml:mtext></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></disp-formula></p><p>where t is unitless, but derived from the experiment time in seconds, <inline-formula><mml:math id="inf11"><mml:mrow><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow><mml:mi>τ</mml:mi></mml:mfrac></mml:mrow></mml:math></inline-formula> with <inline-formula><mml:math id="inf12"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mpadded width="+1.7pt"><mml:mn>0.05</mml:mn></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf13"><mml:mrow><mml:mi>τ</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mpadded width="+1.7pt"><mml:mn>0.25</mml:mn></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>. Features that had the potential to exhibit large value deviations (e. g. v_norm) were instead bounded using a hyperbolic tangent function. Additionally, some features were exponentially smoothed over a longer time window (where <inline-formula><mml:math id="inf14"><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mo>⁢</mml:mo><mml:mi>o</mml:mi><mml:mo>⁢</mml:mo><mml:mi>n</mml:mi><mml:mo>⁢</mml:mo><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow><mml:msub><mml:mi>τ</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mo>⁢</mml:mo><mml:mi>o</mml:mi><mml:mo>⁢</mml:mo><mml:mi>n</mml:mi><mml:mo>⁢</mml:mo><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mfrac></mml:mrow></mml:math></inline-formula> with <inline-formula><mml:math id="inf15"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>t</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mpadded width="+1.7pt"><mml:mn>0.05</mml:mn></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf16"><mml:mrow><mml:msub><mml:mi>τ</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mo>⁢</mml:mo><mml:mi>o</mml:mi><mml:mo>⁢</mml:mo><mml:mi>n</mml:mi><mml:mo>⁢</mml:mo><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mpadded width="+1.7pt"><mml:mn>5</mml:mn></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>) (<xref ref-type="fig" rid="fig1s7">Figure 1—figure supplement 7</xref>).</p><p>Convolution was used to approximate a smoothed squared derivative for each feature (<xref ref-type="fig" rid="fig1s8">Figure 1—figure supplement 8</xref>); useful for integrating information over time without needing to further expand the feature space. The underlying mathematical concepts were motivated by <xref ref-type="bibr" rid="bib100">Masson et al., 2012</xref>. For a given feature f at time <inline-formula><mml:math id="inf17"><mml:mi>t</mml:mi></mml:math></inline-formula>, f_convolved_squared was calculated as follows:<disp-formula id="equ2"><mml:math id="m2"><mml:mrow><mml:mi>f</mml:mi><mml:msub><mml:mn>1</mml:mn><mml:mi>t</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>λ</mml:mi><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo><mml:mi>f</mml:mi><mml:msub><mml:mn>1</mml:mn><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>t</mml:mi><mml:mo>.</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mspace linebreak="newline"/><mml:mi>f</mml:mi><mml:msub><mml:mn>2</mml:mn><mml:mi>t</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>λ</mml:mi><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>t</mml:mi><mml:mo>.</mml:mo><mml:mi>f</mml:mi><mml:msub><mml:mn>1</mml:mn><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>λ</mml:mi><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo><mml:mi>f</mml:mi><mml:msub><mml:mn>2</mml:mn><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mi>n</mml:mi><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mspace linebreak="newline"/><mml:msub><mml:mrow><mml:mrow><mml:mtext mathvariant="monospace">f \_convolved \_squared</mml:mtext></mml:mrow></mml:mrow><mml:mi>t</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mtext> </mml:mtext><mml:mi>k</mml:mi><mml:mo>.</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:msub><mml:mn>1</mml:mn><mml:mi>t</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mi>f</mml:mi><mml:msub><mml:mn>2</mml:mn><mml:mi>t</mml:mi></mml:msub><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mn>2</mml:mn></mml:msup><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf18"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0.05</mml:mn><mml:mi>s</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf19"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>λ</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>τ</mml:mi></mml:mfrac></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf20"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>τ</mml:mi><mml:mo>=</mml:mo><mml:mn>0.25</mml:mn><mml:mi>s</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, and n=5s, k values were empirically chosen for each feature.</p></sec><sec id="s4-1-5"><title>Behaviour classifiers</title><p>Behaviour classifiers were developed using a user interface similar to JAABA (<xref ref-type="bibr" rid="bib76">Kabra et al., 2013</xref>). The underlying algorithms combined trained neural networks and empirically-determined linear thresholds. We developed a MATLAB (MathWorks, Natick, Massachusetts) user interface with functions for data visualisation, manual annotation, and machine learning using the Neural Network Toolbox, the Deep Learning Toolbox, and the Statistics and Machine Learning Toolbox. Here, we briefly describe the behaviour classifiers and provide performance results based on manual validation (<xref ref-type="table" rid="table1">Table 1</xref>).</p><table-wrap id="table1" position="float"><label>Table 1.</label><caption><title>Manual quantification of behaviour detection performance.</title></caption><table frame="hsides" rules="groups"><tbody><tr><td align="left" valign="bottom" colspan="2">back (268 events from 24 larvae in 60min of video data)</td></tr><tr><td align="left" valign="bottom"> Precision</td><td align="char" char="." valign="bottom">86.5%</td></tr><tr><td align="left" valign="bottom"> Recall</td><td align="char" char="." valign="bottom">88.4%</td></tr><tr><td align="left" valign="bottom" colspan="2">bend (714 events from 24 larvae in 60 min of video data)</td></tr><tr><td align="left" valign="bottom"> Precision</td><td align="char" char="." valign="bottom">95.6%</td></tr><tr><td align="left" valign="bottom"> Recall</td><td align="char" char="." valign="bottom">96.4%</td></tr><tr><td align="left" valign="bottom"> Accuracy of left and right detection (true-positive bends)</td><td align="char" char="." valign="bottom">97.3%</td></tr><tr><td align="left" valign="bottom" colspan="2"> forward (425 events from 24 larvae in 60 min of video data)</td></tr><tr><td align="left" valign="bottom"> Precision</td><td align="char" char="." valign="bottom">97.8%</td></tr><tr><td align="left" valign="bottom"> Recall</td><td align="char" char="." valign="bottom">94.1%</td></tr><tr><td align="left" valign="bottom" colspan="2">forward_peristaltic (2954 events from 24 larvae in 60 min of video data)</td></tr><tr><td align="left" valign="bottom"> Precision</td><td align="char" char="." valign="bottom">99.5%</td></tr><tr><td align="left" valign="bottom"> Recall</td><td align="char" char="." valign="bottom">93.6%</td></tr><tr><td align="left" valign="bottom"> Events which are falsely combined with another event</td><td align="char" char="." valign="bottom">10.7%</td></tr><tr><td align="left" valign="bottom"> Events which are detected as more than one event</td><td align="char" char="." valign="bottom">1.2%</td></tr><tr><td align="left" valign="bottom" colspan="2">roll (240 events from 24 larvae in 60 min of video data)</td></tr><tr><td align="left" valign="bottom"> Precision (rolls and roll-like events)</td><td align="char" char="." valign="bottom">96.6%</td></tr><tr><td align="left" valign="bottom"> Recall (rolls)</td><td align="char" char="." valign="bottom">86.7%</td></tr><tr><td align="left" valign="bottom"> Recall (roll-like events)</td><td align="char" char="." valign="bottom">25.8%</td></tr></tbody></table></table-wrap><p>The bend classifier was based on predefined thresholds for temporally smoothed body shape features and was itself exponentially smoothed over time. Independent left and right classifiers were used to initially detect bend direction. To detect left and right bends, these classifiers were combined with the smoothed bend classifier using an AND conjunction.</p><p>To improve left and right detection performance, we developed a classifier for circular larval contours. This ball classifier used a feed-forward neural network with a single fully connected hidden layer whose inputs were normalised values of <monospace>eig_reduced, larva_arc_ratio, and larva_area_ratio</monospace>. The hidden layer consisted of five neurons with a hyperbolic tangent activation function. The output layer contained a single neuron and used a sigmoid activation function. The neural network was trained in MATLAB on a manually annotated data set for 500 epochs using a cross-entropy loss function and scaled conjugate gradient backpropagation. If a ball was detected within the previous 1.5 s, left and right classifiers were overwritten to match the last detected bend direction prior to the beginning of the ball.</p><p>The back classifier detected individual backward peristaltic waves based on thresholds for smoothed tail velocity features combined with no ball detection within the previous 1.5s.</p><p>Two different classifiers were used to detect crawling. forward detected longer forward crawl periods based on thresholds for smoothed tail velocity features combined with no ball detection within the previous 1.5 s. <monospace>forward_peristaltic</monospace> detected individual forward peristaltic waves based on the forward classifier and a threshold on forward tail velocity.</p><p>The roll classifier was based on thresholds for body shape and velocity combined with no ball detection and was exponentially smoothed over time. If a roll was detected within the previous 1.5 s, forward, <monospace>forward_peristaltic</monospace>, and back classifier values were reset to reduce false-positive detection for these classifiers. Unusual behaviour patterns such as rapid bending or twitching could be observed in addition to true larval rolling. These behaviours were considered ‘roll-like’ events during manual validation of the roll classifier’s performance.</p></sec><sec id="s4-1-6"><title>Optogenetic stimulation</title><p>Optogenetic stimulation was achieved using two digital micromirror devices DMDs to project light patterns onto larvae on the agarose plate (<xref ref-type="fig" rid="fig2">Figure 2C</xref>). Both DMDs operated like a monochrome red light projector (1920x1080 pixel in classical conditioning experiments, 768x1024 pixel in proof-of-principle and operant conditioning experiments) with numerous rotatable micromirrors used to modulate the intensity of individual pixels. Because each DMD on its own was insufficient for optogenetic stimulation of larvae, we installed both devices on the system with their projections each covering the entire agarose plate (<xref ref-type="fig" rid="fig1">Figure 1B</xref>). In this way, the summed light intensities of the two DMDs could be achieved at all locations. For the proof-of-principle and operant conditioning experiments, one DMD contained an integrated 613 nm LED (#CEL-5500-LED, Digital Light Innovations, Austin, Texas) and the other (#CEL-5500-FIBER, Digital Light Innovations, Austin, Texas) received input from an external 625 nm LED (#BLS-GCS-0625–38A0710, Mightex Systems, Ontario, Canada) controlled by a BioLED light source control module (#BLS-13000–1, Mightex Systems, Ontario, Canada) and fed through an optic fibre (#LLG-05-59-420-2000-1, Mightex Systems, Ontario, Canada) (<xref ref-type="fig" rid="fig1">Figure 1C</xref>). For the classical conditioning experiments, both DMDs (#DLP4710EVM-LC, Texas Instruments) each received input from an external 625 nm LED source (#LE A P1W-RSSP-23, Osram, Germany).</p><p>Accurately aiming light at crawling larvae required spatial calibration of each DMD. Calibration was performed by projecting square spots at fixed DMD pixel locations and linearly fitting the corresponding camera coordinates. We also determined that DMD illumination using the default light output was not uniform at plate level, which could have resulted in variable optogenetic stimulation depending on larval location. We therefore normalised the pixel intensity of the DMD image to the highest intensity uniformly achievable at all plate locations. A look-up table containing the normalisation factor for each DMD pixel was then calculated using bi-linear interpolation with approximately 100 light intensity values measured across the plate. To accommodate for possible differences in non-uniformity between the two DMDs, this intensity calibration was performed for both DMDs simultaneously following spatial calibration.</p><p>A user-defined Behaviour Programme protocol operated on the behaviour detection output and sent 8-bit optogenetic stimulation instructions to the LabVIEW application. Because the LabVIEW application updated DMD projections at 20 Hz, the delay between behaviour detection and closed-loop optogenetic stimulation of individual larvae did not exceed 50ms (<xref ref-type="fig" rid="fig1">Figure 1D</xref>). Furthermore, if two or more larvae were close enough such that their corresponding stimulation areas overlapped, the light intensity in the overlapping region was set to the smallest of those values to avoid undesired stimulation.</p></sec><sec id="s4-1-7"><title>Thermogenetic stimulation</title><p>Thermogenetic stimulation for proof-of-principle experiments was achieved by heating up larvae with a custom-built 1490 nm IR laser setup (#2CM-101, SemiNex, Peabody, Massachusetts). An out-of-the-box 1470 nm IR laser was used for temporal dynamics of larval heating and in our classical conditioning experiments (#LRD-1470-PFI-15000–05, Laserglow Technologies, Ontario, Canada). Each laser’s light guide was fed into a two-axis galvanometer system (#GVSM002, Thorlabs, Newton, New Jersey; <xref ref-type="fig" rid="fig2">Figure 2B</xref>). Both the laser and its corresponding galvanometer were controlled by an analogue output device (#PCIe-6738, National Instruments, Austin, Texas; <xref ref-type="fig" rid="fig1">Figure 1C</xref>). Two mirrors inside the galvanometer were rotated around orthogonal axes to target the laser beam spot to any user-defined location on the agarose plate. Mirror positions were controlled by two integrated motors receiving location-specific voltage inputs. The beam spots for the 1470 nm and 1490 nm lasers measured approximately 2.3 cm and 5 mm in diameter, respectively, depending on each beam’s angle of incidence to the plate.</p><p>Spatially calibrating the galvanometer was necessary to obtain a map between larval locations in world coordinates and the mirror motor input voltages. A visible aiming beam was scanned across the agarose plate using a fixed set of voltage pair inputs to the galvanometer. With the optical filter removed from the camera, the aiming beam’s location in camera coordinates was automatically extracted from the image using binary thresholding. Two voltage-to-camera look-up tables were generated through bi-linear interpolation of these measured coordinates. For accurately targeted thermogenetic stimulation, the location of the larval centroid was first converted to camera coordinates using the existing world-to-camera transform and was then mapped to a pair of galvanometer input voltages using the look-up tables.</p><p>When designing our tracker’s thermogenetic stimulation system, we were careful to ensure that all larvae received the same stimulation regardless of their position on the agarose plate. A larva’s location changed the laser beam’s angle of incidence, causing the illuminated spot at plate level to take an elliptical shape with variable size. If we were to keep laser beam power constant, the changing spot area would generate inconsistencies in the intensity of IR light projected over each larva. For proof-of-principle experiments, laser intensity calibration was used to normalise the 1490 nm laser intensity to achieve constant power per unit area. Prior to any experimentation, the laser’s visible aiming beam was scanned across the plate and the camera image was used to measure the beam’s spot size at various locations. Bi-linear interpolation was then used to generate a pixel-wise look-up table containing the laser power scaling factors. We also accounted for a nonlinear relationship between the 1490 nm laser source input voltage and the total power output by generating a voltage-to-power map from manual measurements. With these transformations, the system could calculate the laser source input voltage necessary to produce uniform stimulation at any location. For temporal dynamics of larval heating and classical conditioning experiments, we upgraded our tracker with a heat camera (Teledyne FLIR AX8) for real-time measurement and maintenance of larval body temperature. The heat camera captured thermal images of the agarose plate at 10 Hz and sent them to the host computer. The host computer used this information together with behaviour camera data to extract temperature readings at each larval location (<xref ref-type="fig" rid="fig1">Figure 1D</xref>). A custom closed-loop software system (LabVIEW and Python) then iteratively updated the 1470 nm IR laser intensity <italic>I</italic> at each larval location using the following sigmoid function:<disp-formula id="equ3"><mml:math id="m3"><mml:mrow><mml:mi>I</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mn>100</mml:mn><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mfrac><mml:mi>x</mml:mi><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula></p><p>in which I is a percentage of the maximum laser output (15 W) and x is the current recorded temperature minus the target temperature in ℃.</p><p>A user-defined Behaviour Programme protocol operated on the 20 Hz behaviour detection output and sent thermogenetic stimulation instructions to the LabVIEW application which controlled the galvanometer and laser (<xref ref-type="fig" rid="fig1">Figure 1D</xref>). Larval centroid locations were specified on every frame, enabling a single galvanometer to cycle the laser beam between all individual larvae at 20 Hz. All larvae were stimulated within the available 50ms time window (i. e. 11ms per larva with four larvae on the plate, but 5.5ms per larva with eight larvae on the plate). Switching off the laser input for 1.5ms between larvae accounted for small time fluctuations surrounding each new galvanometer position update and helped to avoid undesired stimulation of other plate areas (<xref ref-type="fig" rid="fig2">Figure 2B</xref>). If fewer objects were detected in a given frame than expected, the remaining galvanometer target locations were set to the plate’s centre and the corresponding laser intensity was set to zero. This temporal pattern of galvanometer position updates yielded no more than 100ms delay between behaviour detection and closed-loop thermogenetic stimulation.</p></sec></sec><sec id="s4-2"><title>Single-larva tracker</title><sec id="s4-2-1"><title>Hardware setup and software framework</title><p>The single-larva tracker (<xref ref-type="fig" rid="fig4s3">Figure 4—figure supplement 3</xref>) electronics and hardware were nearly identical to the tracker described in <xref ref-type="bibr" rid="bib136">Schulze et al., 2015</xref>, with notable exceptions to the camera and backlight which are detailed here. The behaviour arena comprised a layer of 1% agarose sitting atop a fixed glass plate, prepared daily to maintain moisture. Above and below the arena sat two motorised linear slides (#T-LSR450B, Zaber Technologies), arranged perpendicular to one another so that mounted components could move to any (x,y) location within the 34 cm x 38 cm coverage area. The host computer sent 4 Hz (x,y) position updates to the linear slides. Mounted to the slides above the behaviour arena was a high-resolution camera (2048x2048 pixels) (Grasshopper3 #GS3-U3-41C6NIR-C, Point Grey Research) that captured 20 Hz images and sent them to the host computer for real-time display on a graphical user interface. A long-distance microscope (Model KC/S VideoMax with IF2 objective, Edmund Optics) was c-mounted to the camera. Also mounted to the slides above the behaviour arena was a 617 nm LED (#PLS-0617–030S, Mightex Systems), with a 10 Hz update rate controlled by a universal driver (#SLC-xx04-US, Mightex Systems). The centre of the LED projection on the agarose was aligned with the centre of the camera image to facilitate targeted optogenetic excitation. To maintain the integrity of behaviour detection, stimulus presentation, and optogenetic experimentation, all hardware was housed inside a light-tight enclosure. The agarose plate was illuminated from below by a 2 in x 2 in 880 nm LED backlight (#BL0202-880IC, Advanced Illumination) mounted to the linear slides. The hardware communication and operation software was written under a Robot Operating System (ROS) framework.</p></sec><sec id="s4-2-2"><title>Contour processing, behaviour detection, and optogenetic stimulation</title><p>The host computer software extracted the larval contour by applying inverse binary thresholding to each raw camera image. As with the multi-larva tracker, contour regularization was achieved using Fourier decomposition and reconstruction. Also the same as the multi-larva tracker, the single-larva tracker software detected the larva’s head and tail using the contour’s sharpest and second-sharpest internal angles, respectively, and corrected errors in real time using proximity measurements and a vote system (for algorithm details, see section above on multi-larva tracker contour processing and also <xref ref-type="fig" rid="fig4s2">Figure 4—figure supplement 2</xref>). The software calculated three other landmarks at equally distributed points along the larval spine. The neck landmark defined the larva’s location and was used to update the linear slide positions, keeping the larva centred in the camera’s field of view (<xref ref-type="fig" rid="fig4s3">Figure 4—figure supplement 3</xref>). As in the multi-larva tracker software, larval features describing motion direction, body shape, and velocity were calculated frame-by-frame from the contour and spine data and processed to remove high-frequency noise.</p><p>The left and right bend classifier consisted of a neural network with a single fully connected hidden layer whose inputs were the body shape features s and <monospace>eig_reduced</monospace>, along with their exponentially smoothed versions. The network’s hidden layer consisted of five neurons with a hyperbolic tangent activation function. The output layer contained a single neuron and used a sigmoid activation function. The bend classifier also consisted of a linear threshold on the <monospace>asymmetry</monospace> feature. The classifier itself was exponentially smoothed over time, as described in the section above on multi-larva tracker feature extraction. Manual quantification of the single-larva tracker’s bend classifier performance was based on 741 events from 10 larvae in 60 min of video data. This classifier has 97.6% precision and 100% recall, with 99.2% accuracy of left and right detection during true-positive bends. The single-larva tracker also employed a ball classifier like that defined for the multi-larva tracker.</p><p>A user-defined Python software protocol operated on the behaviour detection output and specified closed-loop stimulus delivery instructions within the ROS framework. On this system, there existed a delay of up to 100ms between behaviour detection and closed-loop optogenetic stimulation.</p></sec></sec><sec id="s4-3"><title>Larval rearing and handling</title><p>Fly stocks were maintained in vials filled with standard molasses food. In preparation for experiments and immunohistochemistry, adults (crosses listed in <xref ref-type="table" rid="table2">Table 2</xref>) were placed in collection cages with petri dishes containing molasses food and additional dry yeast to increase egg laying. For proof-of-principle and operant conditioning experiments, flies were allowed to lay eggs overnight for approximately 12–18 hr at 25℃. Larvae were reared at 25℃ and experiments were performed 72–96 hr after egg laying. For temporal dynamics of larval heating and classical conditioning experiments, flies were allowed to lay eggs during daytime for approximately 7 hr at 25℃. Larvae were reared at 18℃ and experiments were performed approximately seven days after egg laying. For immunohistochemistry, eggs were collected during daytime for approximately 4 hr. Dissections were performed 118–122 hr after egg laying. During all larval rearing, humidity was provided by placing wet paper towels placed beside the food plates. Specifically for optogenetics experiments, larvae were reared in the dark on molasses food supplemented with all-<italic>trans</italic>-retinal.</p><table-wrap id="table2" position="float"><label>Table 2.</label><caption><title>Fly crosses for larval experiments.</title><p>For strain information, see Key resources table.</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" valign="bottom">Figure</th><th align="left" valign="bottom">Designation</th><th align="left" valign="bottom">Female parent</th><th align="left" valign="bottom">Male parent</th></tr></thead><tbody><tr><td align="char" char="." valign="bottom">2</td><td align="left" valign="bottom">72F11&gt;CsChrimson</td><td align="left" valign="bottom">UAS-CsChrimson</td><td align="char" char="hyphen" valign="bottom">72F11-Gal4</td></tr><tr><td align="char" char="." valign="bottom">2</td><td align="left" valign="bottom">69F06&gt;CsChrimson</td><td align="left" valign="bottom">UAS-CsChrimson</td><td align="char" char="hyphen" valign="bottom">69F06-Gal4</td></tr><tr><td align="char" char="." valign="bottom">2</td><td align="left" valign="bottom">attP2 &gt;CsChrimson</td><td align="left" valign="bottom">UAS-CsChrimson</td><td align="left" valign="bottom">attP2</td></tr><tr><td align="char" char="." valign="bottom">2</td><td align="char" char="." valign="bottom">72F11&gt;dTrpA1</td><td align="left" valign="bottom">UAS-dTrpA1</td><td align="char" char="hyphen" valign="bottom">72F11-Gal4</td></tr><tr><td align="char" char="." valign="bottom">2</td><td align="char" char="." valign="bottom">69F06&gt;dTrpA1</td><td align="left" valign="bottom">UAS-dTrpA1</td><td align="char" char="hyphen" valign="bottom">69F06-Gal4</td></tr><tr><td align="char" char="." valign="bottom">2</td><td align="left" valign="bottom">attP2 &gt;dTrpA1</td><td align="left" valign="bottom">UAS-dTrpA1</td><td align="left" valign="bottom">attP2</td></tr><tr><td align="char" char="." valign="bottom">2 sf1</td><td align="left" valign="bottom">assorted genotypes</td><td align="left" valign="bottom">–</td><td align="left" valign="bottom">–</td></tr><tr><td align="char" char="." valign="bottom">3</td><td align="left" valign="bottom">Or42b&gt;CsChrimson, 72F11&gt;dTrpA1</td><td align="left" valign="bottom">Or42b&gt;CsChrimson</td><td align="char" char="." valign="bottom">72F11&gt;dTrpA1</td></tr><tr><td align="char" char="." valign="bottom">3</td><td align="left" valign="bottom">Or42b&gt;CsChrimson, dTrpA1</td><td align="left" valign="bottom">Or42b&gt;CsChrimson</td><td align="left" valign="bottom">dTrpA1</td></tr><tr><td align="char" char="." valign="bottom">4</td><td align="left" valign="bottom">Ddc&gt;CsChrimson</td><td align="left" valign="bottom">UAS-CsChrimson</td><td align="left" valign="bottom">Ddc-Gal4</td></tr><tr><td align="char" char="." valign="bottom">4</td><td align="left" valign="bottom">Ddc &gt;CsChrimson, tsh &gt;Gal80</td><td align="left" valign="bottom">UAS-CsChrimson; tsh-LexA, LexAop-Gal80</td><td align="left" valign="bottom">Ddc-Gal4</td></tr><tr><td align="char" char="." valign="bottom">4</td><td align="left" valign="bottom">58E02&gt;CsChrimson</td><td align="left" valign="bottom">UAS-CsChrimson</td><td align="char" char="hyphen" valign="bottom">58E02-Gal4</td></tr><tr><td align="char" char="." valign="bottom">4 sf3</td><td align="left" valign="bottom">Ddc &gt;CsChrimson</td><td align="left" valign="bottom">UAS-CsChrimson</td><td align="left" valign="bottom">Ddc-Gal4</td></tr><tr><td align="char" char="." valign="bottom">4 sf3</td><td align="left" valign="bottom">CsChrimson control</td><td align="left" valign="bottom">UAS-CsChrimson</td><td align="left" valign="bottom">GMR-GAl4-attP2</td></tr><tr><td align="char" char="." valign="bottom">5</td><td align="left" valign="bottom">TH &gt;CsChrimson</td><td align="left" valign="bottom">UAS-CsChrimson</td><td align="left" valign="bottom">TH-Gal4</td></tr><tr><td align="char" char="." valign="bottom">5</td><td align="left" valign="bottom">Tph &gt;CsChrimson</td><td align="left" valign="bottom">UAS-CsChrimson</td><td align="left" valign="bottom">Tph-Gal4</td></tr><tr><td align="char" char="." valign="bottom">5</td><td align="left" valign="bottom">Tph &gt;CsChrimson, tsh &gt;Gal80</td><td align="left" valign="bottom">UAS-CsChrimson; tsh-LexA, LexAop-Gal80</td><td align="left" valign="bottom">Tph-Gal4</td></tr></tbody></table></table-wrap><p>All larval handling and experiments were performed in the dark to avoid unintended optogenetic stimulation. For each experiment run performed on the high-throughput tracker, we extracted larvae from their food plate and washed them in water. Using a brush, we placed multiple larvae in the centre of the agarose plate. We then placed the agarose plate inside the tracker on top of the backlight and shut the tracker door tightly. For experiments on the low-throughput, single-larva tracker, we extracted larvae from their food plate using a 15% sucrose solution. For a given larva, time outside the food plate did not exceed 30 min prior to the experiment starting. We used a brush to extract a single larva from the sucrose solution and rinse it in water to remove residual sucrose. We then placed the single larva in the centre of the agarose plate and shut the tracker door tightly. Prior to starting all experiment runs, we gave larvae a short period of time to acclimate to their new environment and, in the case of high-throughput experiments, disperse so they were not touching each other.</p></sec><sec id="s4-4"><title>Verification of optogenetic and thermogenetic stimulation efficiency</title><sec id="s4-4-1"><title>Experiment procedures</title><p>We assessed the multi-larva tracker’s optogenetic and thermogenetic stimulation efficiency through open-loop proof-of-principle experiments. The 1 min experiment protocol began with a 15 s initialisation period in which larvae acclimated to the agarose plate and behaviour classifiers stabilised. In three subsequent 15 s stimulation rounds, larvae received 5 s of open-loop stimulation followed by 10 s without stimulation (<xref ref-type="fig" rid="fig2">Figure 2C</xref>). Optogenetics were performed with a combined red light intensity of 285 µW/cm<sup>2</sup> from two DMDs as described above. Thermogenetics were performed with the 1490 nm laser at 40% of its maximum available 5.26 W intensity.</p></sec><sec id="s4-4-2"><title>Data analysis</title><p>Analysis of these open-loop optogenetic and thermogenetic experiment data (<xref ref-type="fig" rid="fig2">Figure 2D</xref>, <xref ref-type="fig" rid="fig2">Figure 2E</xref>) was conducted using custom MATLAB software. After equally splitting each 60 s experiment into either 0.5 s or 5 s time bins, we retained objects for analysis that fulfilled strict criteria: (i) for all bins following the 15 s initialisation period, the object’s initial detection must have occurred at least 15s prior to the start of the bin; (ii) the object must have been detected in every frame of the bin (i. e. it retained its identity and did not collide with another object); and (iii) the mean of the smoothed centroid velocity across the object’s detection period in the bin was at least 0.5 mm/s. For each larva, the criterion for rolling, crawling, or bending was detection of the corresponding behaviour at least once during a given bin, irrespective of the behaviour’s duration. The number of larvae performing each behaviour in a given bin was then divided by the total number of larvae in the bin to give the fractions displayed in <xref ref-type="fig" rid="fig2">Figure 2D</xref> and <xref ref-type="fig" rid="fig2">Figure 2E</xref>.</p></sec></sec><sec id="s4-5"><title>Temporal dynamics of larval heating</title><sec id="s4-5-1"><title>Experiment procedures and data analysis</title><p>To quantify the time course of larval heating with our setup (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>), we performed additional open-loop stimulation experiments with the 1470 nm laser. The experiment protocol began with a 30 s initialisation period without heat stimulation. Then the IR laser was turned on at 50% intensity for 20 s. During this stimulation period, the heat camera was used to maintain an intended temperature of 30℃at each larval location, as described above. Ten runs of this experiment were performed, with four larvae placed on the agarose plate per run. To analyse these data, recorded temperatures at each larval location for every point in time were collected.</p></sec></sec><sec id="s4-6"><title>High-throughput classical conditioning</title><sec id="s4-6-1"><title>Experiment procedures</title><p>Eight larvae were trained during each run of the classical conditioning experiment, with 18 runs for experimental larvae and 14 runs for control larvae. Training began after an initial 30 s initialisation period. Forward-paired training consisted of eight replicate training rounds, yielding a total training period lasting 840 s. Each round began with 20 s of red light illumination (via two 613nm DMDs with combined intensity of 550 µW/cm<sup>2</sup>, as described above), followed by 5 s without stimulation and then 20 s of IR illumination (via 1470 nm laser). This IR illumination caused larval heating up to 27.5℃, which was maintained using the closed-loop temperature control system described above. Each round ended with 60 s without stimulation. Backward-paired training was identical to forward-paired with the exception that IR illumination occurred first, followed by red light illumination. 60 s without stimulation followed the training period. In the subsequent testing period, larvae were illuminated for 20 s with the same wavelength and intensity of red light as during training. The testing period involve three rounds of this illumination, with 45 s of no stimulation between each replicate (<xref ref-type="fig" rid="fig3">Figure 3A</xref>).</p></sec><sec id="s4-6-2"><title>Data analysis</title><p>For this analysis, we divided each testing round into three time windows: PRE (10–0 s before light onset), ON (0–20 s after light onset), and OFF (0–20 s after light offset). Only larvae that were tracked for all three ON and OFF windows during the testing period were analysed. To account for violated normality and sphericity assumptions, we calculated the difference in percentage bending values between the ON and OFF windows (i. e. ON-OFF) for each individual larva. These percentage bending differences were then compared between training protocols and genotypes to study the effects of training on larval bending behavior during the testing period. Because percentage bending differences were not normally distributed, we used two-sided Mann–Whitney <italic>U</italic> tests to assess how bending behaviour differed between training protocols and genotypes.</p></sec></sec><sec id="s4-7"><title>High-throughput operant conditioning</title><sec id="s4-7-1"><title>Experiment procedures</title><p>Each run of the operant conditioning experiment protocol (<xref ref-type="fig" rid="fig4">Figure 4B</xref>) consisted of 10–12 larvae on the plate. The protocol began and ended with a 1 min test period without optogenetic stimulation. Between these test periods were four, 3 min training rounds during which larvae received red light stimulation of 285 µW/cm<sup>2</sup> (combined from two DMDs as described above) for the entire duration of the detected bend. Which side received stimulation was randomised across trials such that approximately 50% of larvae were trained to develop a right bend preference and 50%a left bend preference. No stimulus was triggered when the larva was bending right or when its body was straight. The test periods were each separated by 3 min periods without stimulation. After the first minute of this period, a brush was used to gently move all larvae back to the centre of the plate and larvae were given time to recover before the beginning of the next training round. This recentring addresses problems encountered when performing prolonged experiments with freely behaving larvae on a small agarose plate. The longer larvae are left undisturbed, the more likely they are to touch the plate’s edge, causing tracking disruption and temporary loss of valid objects. This shrinks sample size and reduces training efficiency by decreasing the proportion of animals receiving the stimulus.</p><p>Control experiments were designed so that valid objects received optogenetic stimulation uncorrelated with behaviour. These control experiments were split into 60 s time bins, during which each valid object was randomly assigned a stimulus train from this same time bin, pulled from a prior experiment where stimulation correlated with behaviour.</p></sec><sec id="s4-7-2"><title>Data analysis</title><p>Data analysis was conducted using custom MATLAB software. After equally splitting each experiment into 60 s time bins, we retained objects for analysis that fulfilled strict criteria: (i) the object must have been detected in every frame of the bin (i.e. it retained its identity and did not collide with another object); (ii) the object’s initial detection must have occurred at least 20 s prior to the start of the bin; (iii) at no point during the bin did the smoothed velocity of the larval centroid exceed 1.5 mm/s; and (iv) the mean of the smoothed centroid velocity across the object’s detection period in the bin was at least 0.5 mm/s.</p><p>To analyse operant conditioning of bend direction preference, it was necessary to further smooth the raw time series of left and right bends post-acquisition: two bends to the same side separated by less than 200ms were combined into a single long bend, and short bends of less than 200ms were removed from analysis. We then counted, for each larva, the numbers of left and right bends initiated within each 60 s time bin. This was defined as the bend rate towards the respective direction. Within each bin, the difference in bend rate was defined, for each larva, as the number of bends towards the side paired with the optogenetic stimulus minus the number of bends towards the unstimulated side. We pooled together all larval data within each bin because bends to the left and right were each paired with the optogenetic stimulus for approximately half of the larvae. For the control condition in which larvae received random stimulation during 50% of bends regardless of direction, bend rates were calculated to the left and right and the difference in bend rate was calculated between left and right. Bend rates to either side were compared to each other using a two-sided Wilcoxon signed-rank test. This statistical choice was driven by the known pairing of these spatial observations for individual larvae and the non-normality exhibited across distributions of differences between these paired bend rates. Similar reasoning guided the usage of a two-sided Wilcoxon signed-rank test to compare the difference in bend rate to 0. The behaviour characteristics of experimental animals were compared to each control group using a two-sided Mann-Whitney <italic>U</italic> test.</p></sec></sec><sec id="s4-8"><title>Low-throughput operant conditioning</title><sec id="s4-8-1"><title>Experiment procedures</title><p>Each run of the operant conditioning experiment protocol (<xref ref-type="fig" rid="fig4s3">Figure 4—figure supplement 3</xref>) consisted of one larva on the plate. The protocol began and ended with a 1 min test period without optogenetic stimulation. Between these test periods were two, 3 min training rounds during which larvae received red light stimulation of 385 µW/cm<sup>2</sup> for the entire duration of the detected bend. Which side received stimulation was randomised across trials such that approximately 50% of larvae were trained to develop a right bend preference and 50%a left bend preference. No stimulus was triggered when the larva was bending right or when its body was straight. The two test periods were separated by a 3-min period without stimulation.</p></sec><sec id="s4-8-2"><title>Data analysis</title><p>Data analysis was conducted using custom MATLAB software. Each experiment was equally split into 60 s time bins. We then counted, for each larva, the numbers of left and right bends initiated within each 60 s bin. This was defined as the bend rate towards the respective direction. Within each bin, the difference in bend rate was defined, for each larva, as the number of bends towards the side paired with the optogenetic stimulus minus the number of bends towards the unstimulated side. We pooled together all larval data within each bin because bends to the left and right were each paired with the optogenetic stimulus for approximately half of the larvae.</p></sec></sec><sec id="s4-9"><title>Immunohistochemistry and confocal imaging</title><p>All dissections, immunohistochemical stainings, and confocal imaging were done using a procedure adapted from <xref ref-type="bibr" rid="bib71">Jenett et al., 2012</xref> and <xref ref-type="bibr" rid="bib91">Li et al., 2014</xref>. Larval CNSs were dissected in cold 1x phosphate buffer saline (PBS, Corning Cellgro, #21–040) and transferred to tubes filled with cold 4% paraformaldehyde (Electron Microscopy Sciences, #15,713S) in 1x PBS. Tubes were incubated for 1 hr at room temperature. The tissue was then washed four times in 1x PBS with 1% Triton X-100 (#X100, Sigma Aldrich St. Louis, Missouri) (PBT) and incubated in 1:20 donkey serum (#017-000-121, Jackson Immuno Research, West Grove, Pennsylvania) in PBT for 2 hr at room temperature.</p><p>The tissue was then incubated in the primary antibody solution, first for 4 hr at room temperature and then for two nights at 4℃. This solution contained mouse anti-Neuroglian (1:50, #BP104 anti-Neuroglian, Developmental Studies Hybridoma Bank, Iowa City, Iowa), rabbit anti-GFP (1:500, #A11122, Life Technologies, Waltham, Massachusetts) and rat anti-N-Cadherin (1:50, #DN-Ex #8, Developmental Studies Hybridoma Bank, Iowa City, Iowa) in PBT. This solution was then removed and the tissue washed four times in PBT. The tissue was then incubated in the secondary antibody solution, first for 4 hr at room temperature and then for two nights at 4℃. This solution contained Alexa Fluor 568 donkey anti-mouse (1:500, #A10037, Invitrogen, Waltham, Massachusetts), FITC donkey anti-rabbit (1:500, #711-095-152, Jackson Immuno Research West Grove, Pennsylvania) and Alexa Fluor 647 donkey anti-rat (1:500, #712-605-153, Jackson Immuno Research West Grove, Pennsylvania) in PBT. After removal of the secondary solution, the tissue was washed in PBT four times and mounted on a coverslip coated with poly-L-lysine (#P1524-25MG, Sigma Aldrich, St. Louis, Missouri).</p><p>The coverslip with the CNSs was dehydrated by moving it through a series of jars containing ethanol at increasing concentrations (30%, 50%, 75%, 95%, 100%, 100%, 100%) for 10 min each. The tissue was then cleared by soaking the coverslip with xylene (#X5-500, Fisher Scientific, Waltham, Massachusetts) three times for 5 min each. Finally, the coverslips were mounted in dibutyl phthalate in xylene (DPX, #13512, Electron Microscopy Sciences, Hatfield, Pennsylvania) with the tissue facing down on a microscope slide with spacers. The DPX was allowed to dry for at least two nights prior to confocal imaging with an LSM 710 microscope (Zeiss).</p><p>Details on the confocal imaging settings are provided in the respective figure captions. Confocal images were analysed using Fiji (ImageJ). Neurons were counted by specifying regions of interest around the cell bodies using raw image stacks.</p></sec></sec></body><back><sec sec-type="additional-information" id="s5"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="COI-statement" id="conf1"><p>No competing interests declared</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>Data curation, Software, Formal analysis, Validation, Investigation, Visualization, Methodology, Writing – original draft, Writing – review and editing</p></fn><fn fn-type="con" id="con2"><p>Conceptualization, Resources, Data curation, Software, Formal analysis, Supervision, Validation, Investigation, Visualization, Methodology, Writing – original draft, Project administration, Writing – review and editing</p></fn><fn fn-type="con" id="con3"><p>Conceptualization, Resources, Supervision, Validation, Investigation, Methodology, Project administration</p></fn><fn fn-type="con" id="con4"><p>Conceptualization, Methodology</p></fn><fn fn-type="con" id="con5"><p>Conceptualization, Investigation</p></fn><fn fn-type="con" id="con6"><p>Resources, Software, Methodology, Writing – review and editing</p></fn><fn fn-type="con" id="con7"><p>Resources, Software, Methodology, Writing – review and editing</p></fn><fn fn-type="con" id="con8"><p>Resources, Software, Methodology, Writing – review and editing</p></fn><fn fn-type="con" id="con9"><p>Conceptualization, Supervision, Funding acquisition, Project administration, Writing – review and editing</p></fn><fn fn-type="con" id="con10"><p>Conceptualization, Data curation, Software, Formal analysis, Validation, Investigation, Visualization, Methodology, Writing – original draft, Writing – review and editing</p></fn></fn-group></sec><sec sec-type="supplementary-material" id="s6"><title>Additional files</title><supplementary-material id="transrepform"><label>Transparent reporting form</label><media xlink:href="elife-70015-transrepform1-v3.pdf" mimetype="application" mime-subtype="pdf"/></supplementary-material></sec><sec sec-type="data-availability" id="s7"><title>Data availability</title><p>All data used to generate figures 2-5, as well as all figure supplements, are now submitted as source data files. We also now submit CAD drawings for the multi-larva tracker.</p></sec><ack id="ack"><title>Acknowledgements</title><p>We thank Dr. Chris McRaven for design and technical assistance with the custom-built 1490nm thermogenetic laser light source; Dr. Peter Polidoro for writing the ROS software framework on the single-larva tracker; Howard Hughes Medical Institute (HHMI) Janelia FlyCore and FlyLight teams for assistance with fly crosses, fly food, and confocal imaging; Gates Cambridge Trust, Cambridge Trust, HHMI Janelia Visiting Scientist Program, University of Cambridge Trinity College, HHMI Janelia, European Research Council, Wellcome Trust, and Medical Research Council for funding.</p></ack><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Abramson</surname><given-names>CI</given-names></name><name><surname>Dinges</surname><given-names>CW</given-names></name><name><surname>Wells</surname><given-names>H</given-names></name><name><surname>Nieh</surname><given-names>JC</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Operant conditioning in honey bees (Apis mellifera L.): the cap pushing response</article-title><source>PLOS ONE</source><volume>11</volume><elocation-id>e0162347</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0162347</pub-id></element-citation></ref><ref id="bib2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Aceves-Piña</surname><given-names>EO</given-names></name><name><surname>Quinn</surname><given-names>WG</given-names></name></person-group><year iso-8601-date="1979">1979</year><article-title>Learning in normal and mutant <italic>Drosophila</italic> larvae</article-title><source>Science</source><volume>206</volume><fpage>93</fpage><lpage>96</lpage><pub-id pub-id-type="doi">10.1126/science.206.4414.93</pub-id><pub-id pub-id-type="pmid">17812455</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Alexander</surname><given-names>J</given-names></name><name><surname>Audesirk</surname><given-names>TE</given-names></name><name><surname>Audesirk</surname><given-names>GJ</given-names></name></person-group><year iso-8601-date="1984">1984</year><article-title>One-trial reward learning in the snail lymnea stagnalis</article-title><source>Journal of Neurobiology</source><volume>15</volume><fpage>67</fpage><lpage>72</lpage><pub-id pub-id-type="doi">10.1002/neu.480150107</pub-id><pub-id pub-id-type="pmid">6699634</pub-id></element-citation></ref><ref id="bib4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Andreatta</surname><given-names>M</given-names></name><name><surname>Pauli</surname><given-names>P</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Appetitive vs. aversive conditioning in humans</article-title><source>Frontiers in Behavioral Neuroscience</source><volume>9</volume><elocation-id>128</elocation-id><pub-id pub-id-type="doi">10.3389/fnbeh.2015.00128</pub-id><pub-id pub-id-type="pmid">26042011</pub-id></element-citation></ref><ref id="bib5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Apostolopoulou</surname><given-names>AA</given-names></name><name><surname>Mazija</surname><given-names>L</given-names></name><name><surname>Wüst</surname><given-names>A</given-names></name><name><surname>Thum</surname><given-names>AS</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>The neuronal and molecular basis of quinine-dependent bitter taste signaling in <italic>Drosophila</italic> larvae</article-title><source>Frontiers in Behavioral Neuroscience</source><volume>8</volume><elocation-id>6</elocation-id><pub-id pub-id-type="doi">10.3389/fnbeh.2014.00006</pub-id><pub-id pub-id-type="pmid">24478653</pub-id></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Aso</surname><given-names>Y</given-names></name><name><surname>Herb</surname><given-names>A</given-names></name><name><surname>Ogueta</surname><given-names>M</given-names></name><name><surname>Siwanowicz</surname><given-names>I</given-names></name><name><surname>Templier</surname><given-names>T</given-names></name><name><surname>Friedrich</surname><given-names>AB</given-names></name><name><surname>Ito</surname><given-names>K</given-names></name><name><surname>Scholz</surname><given-names>H</given-names></name><name><surname>Tanimoto</surname><given-names>H</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Three dopamine pathways induce aversive odor memories with different stability</article-title><source>PLOS Genetics</source><volume>8</volume><elocation-id>e1002768</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pgen.1002768</pub-id><pub-id pub-id-type="pmid">22807684</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Aso</surname><given-names>Y</given-names></name><name><surname>Sitaraman</surname><given-names>D</given-names></name><name><surname>Ichinose</surname><given-names>T</given-names></name><name><surname>Kaun</surname><given-names>KR</given-names></name><name><surname>Vogt</surname><given-names>K</given-names></name><name><surname>Belliart-Guérin</surname><given-names>G</given-names></name><name><surname>Plaçais</surname><given-names>PY</given-names></name><name><surname>Robie</surname><given-names>AA</given-names></name><name><surname>Yamagata</surname><given-names>N</given-names></name><name><surname>Schnaitmann</surname><given-names>C</given-names></name><name><surname>Rowell</surname><given-names>WJ</given-names></name><name><surname>Johnston</surname><given-names>RM</given-names></name><name><surname>Ngo</surname><given-names>TTB</given-names></name><name><surname>Chen</surname><given-names>N</given-names></name><name><surname>Korff</surname><given-names>W</given-names></name><name><surname>Nitabach</surname><given-names>MN</given-names></name><name><surname>Heberlein</surname><given-names>U</given-names></name><name><surname>Preat</surname><given-names>T</given-names></name><name><surname>Branson</surname><given-names>KM</given-names></name><name><surname>Tanimoto</surname><given-names>H</given-names></name><name><surname>Rubin</surname><given-names>GM</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Mushroom body output neurons encode valence and guide memory-based action selection in <italic>Drosophila</italic></article-title><source>eLife</source><volume>3</volume><elocation-id>e80</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.04580</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Balleine</surname><given-names>BW</given-names></name><name><surname>Liljeholm</surname><given-names>M</given-names></name><name><surname>Ostlund</surname><given-names>SB</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>The integrative function of the basal ganglia in instrumental conditioning</article-title><source>Behavioural Brain Research</source><volume>199</volume><fpage>43</fpage><lpage>52</lpage><pub-id pub-id-type="doi">10.1016/j.bbr.2008.10.034</pub-id><pub-id pub-id-type="pmid">19027797</pub-id></element-citation></ref><ref id="bib9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bath</surname><given-names>DE</given-names></name><name><surname>Stowers</surname><given-names>JR</given-names></name><name><surname>Hörmann</surname><given-names>D</given-names></name><name><surname>Poehlmann</surname><given-names>A</given-names></name><name><surname>Dickson</surname><given-names>BJ</given-names></name><name><surname>Straw</surname><given-names>AD</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>FlyMAD: rapid thermogenetic control of neuronal activity in freely walking <italic>Drosophila</italic></article-title><source>Nature Methods</source><volume>11</volume><fpage>756</fpage><lpage>762</lpage><pub-id pub-id-type="doi">10.1038/nmeth.2973</pub-id><pub-id pub-id-type="pmid">24859752</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Berck</surname><given-names>ME</given-names></name><name><surname>Khandelwal</surname><given-names>A</given-names></name><name><surname>Claus</surname><given-names>L</given-names></name><name><surname>Hernandez-Nunez</surname><given-names>L</given-names></name><name><surname>Si</surname><given-names>G</given-names></name><name><surname>Tabone</surname><given-names>CJ</given-names></name><name><surname>Li</surname><given-names>F</given-names></name><name><surname>Truman</surname><given-names>JW</given-names></name><name><surname>Fetter</surname><given-names>RD</given-names></name><name><surname>Louis</surname><given-names>M</given-names></name><name><surname>Samuel</surname><given-names>ADT</given-names></name><name><surname>Cardona</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>The wiring diagram of a glomerular olfactory system</article-title><source>eLife</source><volume>5</volume><elocation-id>e59</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.14859</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Booker</surname><given-names>R</given-names></name><name><surname>Quinn</surname><given-names>WG</given-names></name></person-group><year iso-8601-date="1981">1981</year><article-title>Conditioning of leg position in normal and mutant <italic>Drosophila</italic></article-title><source>PNAS</source><volume>78</volume><fpage>3940</fpage><lpage>3944</lpage><pub-id pub-id-type="doi">10.1073/pnas.78.6.3940</pub-id><pub-id pub-id-type="pmid">6791166</pub-id></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Brand</surname><given-names>AH</given-names></name><name><surname>Perrimon</surname><given-names>N</given-names></name></person-group><year iso-8601-date="1993">1993</year><article-title>Targeted gene expression as a means of altering cell fates and generating dominant phenotypes</article-title><source>Development</source><volume>118</volume><fpage>401</fpage><lpage>415</lpage><pub-id pub-id-type="doi">10.1242/dev.118.2.401</pub-id><pub-id pub-id-type="pmid">8223268</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Braubach</surname><given-names>OR</given-names></name><name><surname>Wood</surname><given-names>HD</given-names></name><name><surname>Gadbois</surname><given-names>S</given-names></name><name><surname>Fine</surname><given-names>A</given-names></name><name><surname>Croll</surname><given-names>RP</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Olfactory conditioning in the zebrafish (<italic>Danio rerio</italic>)</article-title><source>Behavioural Brain Research</source><volume>198</volume><fpage>190</fpage><lpage>198</lpage><pub-id pub-id-type="doi">10.1016/j.bbr.2008.10.044</pub-id><pub-id pub-id-type="pmid">19056431</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Brembs</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2003">2003</year><article-title>Operant conditioning in invertebrates</article-title><source>Current Opinion in Neurobiology</source><volume>13</volume><fpage>710</fpage><lpage>717</lpage><pub-id pub-id-type="doi">10.1016/j.conb.2003.10.002</pub-id><pub-id pub-id-type="pmid">14662373</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Brembs</surname><given-names>B</given-names></name><name><surname>Plendl</surname><given-names>W</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Double dissociation of PKC and AC manipulations on operant and classical learning in <italic>Drosophila</italic></article-title><source>Current Biology</source><volume>18</volume><fpage>1168</fpage><lpage>1171</lpage><pub-id pub-id-type="doi">10.1016/j.cub.2008.07.041</pub-id><pub-id pub-id-type="pmid">18674907</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Brembs</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Spontaneous decisions and operant conditioning in fruit flies</article-title><source>Behavioural Processes</source><volume>87</volume><fpage>157</fpage><lpage>164</lpage><pub-id pub-id-type="doi">10.1016/j.beproc.2011.02.005</pub-id><pub-id pub-id-type="pmid">21392558</pub-id></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Brown</surname><given-names>JS</given-names></name><name><surname>Kalish</surname><given-names>HI</given-names></name><name><surname>Farber</surname><given-names>IE</given-names></name></person-group><year iso-8601-date="1951">1951</year><article-title>Conditioned fear as revealed by magnitude of startle response to an auditory stimulus</article-title><source>Journal of Experimental Psychology</source><volume>41</volume><fpage>317</fpage><lpage>328</lpage><pub-id pub-id-type="doi">10.1037/h0060166</pub-id><pub-id pub-id-type="pmid">14861383</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Campbell</surname><given-names>RAA</given-names></name><name><surname>Honegger</surname><given-names>KS</given-names></name><name><surname>Qin</surname><given-names>H</given-names></name><name><surname>Li</surname><given-names>W</given-names></name><name><surname>Demir</surname><given-names>E</given-names></name><name><surname>Turner</surname><given-names>GC</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Imaging a population code for odor identity in the <italic>Drosophila</italic> mushroom body</article-title><source>The Journal of Neuroscience</source><volume>33</volume><fpage>10568</fpage><lpage>10581</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.0682-12.2013</pub-id><pub-id pub-id-type="pmid">23785169</pub-id></element-citation></ref><ref id="bib19"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Chen</surname><given-names>YJ</given-names></name><name><surname>Li</surname><given-names>YC</given-names></name><name><surname>Huang</surname><given-names>KN</given-names></name><name><surname>Young</surname><given-names>MS</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>IEEE</article-title><conf-name>The Implementation of a Stand-Alone Video Tracking and Analysis System for Animal Behavior Measurement in Morris Water Maze</conf-name><fpage>1766</fpage><lpage>1769</lpage></element-citation></ref><ref id="bib20"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Chiuchisan</surname><given-names>I</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>IEEEIASI</article-title><conf-name>E-Health and Bioengineering Conference (EHB</conf-name><conf-loc>Romania</conf-loc><pub-id pub-id-type="doi">10.1109/EHB.2013.6707301</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Clayton</surname><given-names>MS</given-names></name><name><surname>Croteau-Chonka</surname><given-names>E</given-names></name><collab>ZlaticLab</collab></person-group><year iso-8601-date="2022">2022</year><data-title>Multi-larva-tracker-scripts-public</data-title><version designator="f4170fd">f4170fd</version><source>GitHub</source><ext-link ext-link-type="uri" xlink:href="https://github.com/ZlaticLab/multi-larva-tracker-scripts-public">https://github.com/ZlaticLab/multi-larva-tracker-scripts-public</ext-link></element-citation></ref><ref id="bib22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Clyne</surname><given-names>JD</given-names></name><name><surname>Miesenböck</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Sex-Specific control and tuning of the pattern generator for courtship song in <italic>Drosophila</italic></article-title><source>Cell</source><volume>133</volume><fpage>354</fpage><lpage>363</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2008.01.050</pub-id><pub-id pub-id-type="pmid">18423205</pub-id></element-citation></ref><ref id="bib23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cognigni</surname><given-names>P</given-names></name><name><surname>Felsenberg</surname><given-names>J</given-names></name><name><surname>Waddell</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Do the right thing: neural network mechanisms of memory formation, expression and update in <italic>Drosophila</italic></article-title><source>Current Opinion in Neurobiology</source><volume>49</volume><fpage>51</fpage><lpage>58</lpage><pub-id pub-id-type="doi">10.1016/j.conb.2017.12.002</pub-id><pub-id pub-id-type="pmid">29258011</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Colomb</surname><given-names>J</given-names></name><name><surname>Brembs</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>The biology of psychology</article-title><source>Communicative &amp; Integrative Biology</source><volume>3</volume><fpage>142</fpage><lpage>145</lpage><pub-id pub-id-type="doi">10.4161/cib.3.2.10334</pub-id></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Colomb</surname><given-names>J</given-names></name><name><surname>Brembs</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Pkc in motorneurons underlies self-learning, a form of motor learning in <italic>Drosophila</italic></article-title><source>PeerJ</source><volume>4</volume><elocation-id>e1971</elocation-id><pub-id pub-id-type="doi">10.7717/peerj.1971</pub-id><pub-id pub-id-type="pmid">27168980</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cong</surname><given-names>L</given-names></name><name><surname>Wang</surname><given-names>Z</given-names></name><name><surname>Chai</surname><given-names>Y</given-names></name><name><surname>Hang</surname><given-names>W</given-names></name><name><surname>Shang</surname><given-names>C</given-names></name><name><surname>Yang</surname><given-names>W</given-names></name><name><surname>Bai</surname><given-names>L</given-names></name><name><surname>Du</surname><given-names>J</given-names></name><name><surname>Wang</surname><given-names>K</given-names></name><name><surname>Wen</surname><given-names>Q</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Rapid whole brain imaging of neural activity in freely behaving larval zebrafish (<italic>Danio rerio</italic>)</article-title><source>eLife</source><volume>6</volume><elocation-id>e28158</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.28158</pub-id><pub-id pub-id-type="pmid">28930070</pub-id></element-citation></ref><ref id="bib27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Corbett</surname><given-names>D</given-names></name><name><surname>Wise</surname><given-names>RA</given-names></name></person-group><year iso-8601-date="1980">1980</year><article-title>Intracranial self-stimulation in relation to the ascending dopaminergic systems of the midbrain: A moveable electrode mapping study</article-title><source>Brain Research</source><volume>185</volume><fpage>1</fpage><lpage>15</lpage><pub-id pub-id-type="doi">10.1016/0006-8993(80)90666-6</pub-id><pub-id pub-id-type="pmid">7353169</pub-id></element-citation></ref><ref id="bib28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Curcio</surname><given-names>JA</given-names></name><name><surname>Petty</surname><given-names>CC</given-names></name></person-group><year iso-8601-date="1951">1951</year><article-title>The near infrared absorption spectrum of liquid water</article-title><source>Journal of the Optical Society of America</source><volume>41</volume><elocation-id>302</elocation-id><pub-id pub-id-type="doi">10.1364/JOSA.41.000302</pub-id></element-citation></ref><ref id="bib29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dankert</surname><given-names>H</given-names></name><name><surname>Wang</surname><given-names>L</given-names></name><name><surname>Hoopfer</surname><given-names>ED</given-names></name><name><surname>Anderson</surname><given-names>DJ</given-names></name><name><surname>Perona</surname><given-names>P</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Automated monitoring and analysis of social behavior in <italic>Drosophila</italic></article-title><source>Nature Methods</source><volume>6</volume><fpage>297</fpage><lpage>303</lpage><pub-id pub-id-type="doi">10.1038/nmeth.1310</pub-id><pub-id pub-id-type="pmid">19270697</pub-id></element-citation></ref><ref id="bib30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>DasGupta</surname><given-names>S</given-names></name><name><surname>Ferreira</surname><given-names>CH</given-names></name><name><surname>Miesenböck</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>FoxP influences the speed and accuracy of a perceptual decision in <italic>Drosophila</italic></article-title><source>Science</source><volume>344</volume><fpage>901</fpage><lpage>904</lpage><pub-id pub-id-type="doi">10.1126/science.1252114</pub-id><pub-id pub-id-type="pmid">24855268</pub-id></element-citation></ref><ref id="bib31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Davis</surname><given-names>RL</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Olfactory memory formation in <italic>Drosophila</italic>: from molecular to systems neuroscience</article-title><source>Annual Review of Neuroscience</source><volume>28</volume><fpage>275</fpage><lpage>302</lpage><pub-id pub-id-type="doi">10.1146/annurev.neuro.28.061604.135651</pub-id><pub-id pub-id-type="pmid">16022597</pub-id></element-citation></ref><ref id="bib32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Denisov</surname><given-names>G</given-names></name><name><surname>Ohyama</surname><given-names>T</given-names></name><name><surname>Jovanic</surname><given-names>T</given-names></name><name><surname>Zlatic</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Model-based detection and analysis of animal behaviors using signals extracted by automated tracking</article-title><source>eLife</source><volume>11</volume><elocation-id>314</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.74314</pub-id></element-citation></ref><ref id="bib33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dickinson</surname><given-names>A</given-names></name></person-group><year iso-8601-date="1981">1981</year><article-title>Conditioning and associative learning</article-title><source>British Medical Bulletin</source><volume>37</volume><fpage>165</fpage><lpage>168</lpage><pub-id pub-id-type="doi">10.1093/oxfordjournals.bmb.a071695</pub-id><pub-id pub-id-type="pmid">7032649</pub-id></element-citation></ref><ref id="bib34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dylla</surname><given-names>KV</given-names></name><name><surname>Galili</surname><given-names>DS</given-names></name><name><surname>Szyszka</surname><given-names>P</given-names></name><name><surname>Lüdke</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Trace conditioning in insects-keep the trace!</article-title><source>Frontiers in Physiology</source><volume>4</volume><elocation-id>67</elocation-id><pub-id pub-id-type="doi">10.3389/fphys.2013.00067</pub-id><pub-id pub-id-type="pmid">23986710</pub-id></element-citation></ref><ref id="bib35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Eichler</surname><given-names>K</given-names></name><name><surname>Li</surname><given-names>F</given-names></name><name><surname>Litwin-Kumar</surname><given-names>A</given-names></name><name><surname>Park</surname><given-names>Y</given-names></name><name><surname>Andrade</surname><given-names>I</given-names></name><name><surname>Schneider-Mizell</surname><given-names>CM</given-names></name><name><surname>Saumweber</surname><given-names>T</given-names></name><name><surname>Huser</surname><given-names>A</given-names></name><name><surname>Eschbach</surname><given-names>C</given-names></name><name><surname>Gerber</surname><given-names>B</given-names></name><name><surname>Fetter</surname><given-names>RD</given-names></name><name><surname>Truman</surname><given-names>JW</given-names></name><name><surname>Priebe</surname><given-names>CE</given-names></name><name><surname>Abbott</surname><given-names>LF</given-names></name><name><surname>Thum</surname><given-names>AS</given-names></name><name><surname>Zlatic</surname><given-names>M</given-names></name><name><surname>Cardona</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>The complete connectome of a learning and memory centre in an insect brain</article-title><source>Nature</source><volume>548</volume><fpage>175</fpage><lpage>182</lpage><pub-id pub-id-type="doi">10.1038/nature23455</pub-id><pub-id pub-id-type="pmid">28796202</pub-id></element-citation></ref><ref id="bib36"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Eschbach</surname><given-names>C</given-names></name><name><surname>Cano</surname><given-names>C</given-names></name><name><surname>Haberkern</surname><given-names>H</given-names></name><name><surname>Schraut</surname><given-names>K</given-names></name><name><surname>Guan</surname><given-names>C</given-names></name><name><surname>Triphan</surname><given-names>T</given-names></name><name><surname>Gerber</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Associative learning between odorants and mechanosensory punishment in larval <italic>Drosophila</italic></article-title><source>The Journal of Experimental Biology</source><volume>214</volume><fpage>3897</fpage><lpage>3905</lpage><pub-id pub-id-type="doi">10.1242/jeb.060533</pub-id><pub-id pub-id-type="pmid">22071180</pub-id></element-citation></ref><ref id="bib37"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Eschbach</surname><given-names>C</given-names></name><name><surname>Fushiki</surname><given-names>A</given-names></name><name><surname>Winding</surname><given-names>M</given-names></name><name><surname>Schneider-Mizell</surname><given-names>CM</given-names></name><name><surname>Shao</surname><given-names>M</given-names></name><name><surname>Arruda</surname><given-names>R</given-names></name><name><surname>Eichler</surname><given-names>K</given-names></name><name><surname>Valdes-Aleman</surname><given-names>J</given-names></name><name><surname>Ohyama</surname><given-names>T</given-names></name><name><surname>Thum</surname><given-names>AS</given-names></name><name><surname>Gerber</surname><given-names>B</given-names></name><name><surname>Fetter</surname><given-names>RD</given-names></name><name><surname>Truman</surname><given-names>JW</given-names></name><name><surname>Litwin-Kumar</surname><given-names>A</given-names></name><name><surname>Cardona</surname><given-names>A</given-names></name><name><surname>Zlatic</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Recurrent architecture for adaptive regulation of learning in the insect brain</article-title><source>Nature Neuroscience</source><volume>23</volume><fpage>544</fpage><lpage>555</lpage><pub-id pub-id-type="doi">10.1038/s41593-020-0607-9</pub-id><pub-id pub-id-type="pmid">32203499</pub-id></element-citation></ref><ref id="bib38"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Eschbach</surname><given-names>C</given-names></name><name><surname>Fushiki</surname><given-names>A</given-names></name><name><surname>Winding</surname><given-names>M</given-names></name><name><surname>Afonso</surname><given-names>B</given-names></name><name><surname>Andrade</surname><given-names>IV</given-names></name><name><surname>Cocanougher</surname><given-names>BT</given-names></name><name><surname>Eichler</surname><given-names>K</given-names></name><name><surname>Gepner</surname><given-names>R</given-names></name><name><surname>Si</surname><given-names>G</given-names></name><name><surname>Valdes-Aleman</surname><given-names>J</given-names></name><name><surname>Fetter</surname><given-names>RD</given-names></name><name><surname>Gershow</surname><given-names>M</given-names></name><name><surname>Jefferis</surname><given-names>GSXE</given-names></name><name><surname>Samuel</surname><given-names>ADT</given-names></name><name><surname>Truman</surname><given-names>JW</given-names></name><name><surname>Cardona</surname><given-names>A</given-names></name><name><surname>Zlatic</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Circuits for integrating learned and innate valences in the insect brain</article-title><source>eLife</source><volume>10</volume><elocation-id>e62567</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.62567</pub-id><pub-id pub-id-type="pmid">34755599</pub-id></element-citation></ref><ref id="bib39"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fee</surname><given-names>MS</given-names></name><name><surname>Goldberg</surname><given-names>JH</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>A hypothesis for basal ganglia-dependent reinforcement learning in the songbird</article-title><source>Neuroscience</source><volume>198</volume><fpage>152</fpage><lpage>170</lpage><pub-id pub-id-type="doi">10.1016/j.neuroscience.2011.09.069</pub-id><pub-id pub-id-type="pmid">22015923</pub-id></element-citation></ref><ref id="bib40"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fernando</surname><given-names>ABP</given-names></name><name><surname>Mar</surname><given-names>AC</given-names></name><name><surname>Urcelay</surname><given-names>GP</given-names></name><name><surname>Dickinson</surname><given-names>A</given-names></name><name><surname>Robbins</surname><given-names>TW</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Avoidance behavior: a free-operant lever-press avoidance task for the assessment of the effects of safety signals</article-title><source>Current Protocols in Neuroscience</source><volume>70</volume><elocation-id>8</elocation-id><pub-id pub-id-type="doi">10.1002/0471142301.ns0832s70</pub-id><pub-id pub-id-type="pmid">25559006</pub-id></element-citation></ref><ref id="bib41"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fischer</surname><given-names>JA</given-names></name><name><surname>Giniger</surname><given-names>E</given-names></name><name><surname>Maniatis</surname><given-names>T</given-names></name><name><surname>Ptashne</surname><given-names>M</given-names></name></person-group><year iso-8601-date="1988">1988</year><article-title>GAL4 activates transcription in <italic>Drosophila</italic></article-title><source>Nature</source><volume>332</volume><fpage>853</fpage><lpage>856</lpage><pub-id pub-id-type="doi">10.1038/332853a0</pub-id><pub-id pub-id-type="pmid">3128741</pub-id></element-citation></ref><ref id="bib42"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fry</surname><given-names>SN</given-names></name><name><surname>Rohrseitz</surname><given-names>N</given-names></name><name><surname>Straw</surname><given-names>AD</given-names></name><name><surname>Dickinson</surname><given-names>MH</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>TrackFly: virtual reality for a behavioral system analysis in free-flying fruit flies</article-title><source>Journal of Neuroscience Methods</source><volume>171</volume><fpage>110</fpage><lpage>117</lpage><pub-id pub-id-type="doi">10.1016/j.jneumeth.2008.02.016</pub-id><pub-id pub-id-type="pmid">18405978</pub-id></element-citation></ref><ref id="bib43"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fushiki</surname><given-names>A</given-names></name><name><surname>Zwart</surname><given-names>MF</given-names></name><name><surname>Kohsaka</surname><given-names>H</given-names></name><name><surname>Fetter</surname><given-names>RD</given-names></name><name><surname>Cardona</surname><given-names>A</given-names></name><name><surname>Nose</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>A circuit mechanism for the propagation of waves of muscle contraction in <italic>Drosophila</italic></article-title><source>eLife</source><volume>5</volume><elocation-id>e13253</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.13253</pub-id><pub-id pub-id-type="pmid">26880545</pub-id></element-citation></ref><ref id="bib44"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Galili</surname><given-names>DS</given-names></name><name><surname>Lüdke</surname><given-names>A</given-names></name><name><surname>Galizia</surname><given-names>CG</given-names></name><name><surname>Szyszka</surname><given-names>P</given-names></name><name><surname>Tanimoto</surname><given-names>H</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Olfactory trace conditioning in <italic>Drosophila</italic></article-title><source>The Journal of Neuroscience</source><volume>31</volume><fpage>7240</fpage><lpage>7248</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.6667-10.2011</pub-id><pub-id pub-id-type="pmid">21593308</pub-id></element-citation></ref><ref id="bib45"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gepner</surname><given-names>R</given-names></name><name><surname>Skanata</surname><given-names>MM</given-names></name><name><surname>Bernat</surname><given-names>NM</given-names></name><name><surname>Kaplow</surname><given-names>M</given-names></name><name><surname>Gershow</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Computations underlying <italic>Drosophila</italic> photo-taxis, odor-taxis, and multi-sensory integration</article-title><source>eLife</source><volume>4</volume><elocation-id>e06229</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.06229</pub-id></element-citation></ref><ref id="bib46"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gerber</surname><given-names>B</given-names></name><name><surname>Scherer</surname><given-names>S</given-names></name><name><surname>Neuser</surname><given-names>K</given-names></name><name><surname>Michels</surname><given-names>B</given-names></name><name><surname>Hendel</surname><given-names>T</given-names></name><name><surname>Stocker</surname><given-names>RF</given-names></name><name><surname>Heisenberg</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Visual learning in individually assayed <italic>Drosophila</italic> larvae</article-title><source>The Journal of Experimental Biology</source><volume>207</volume><fpage>179</fpage><lpage>188</lpage><pub-id pub-id-type="doi">10.1242/jeb.00718</pub-id><pub-id pub-id-type="pmid">14638844</pub-id></element-citation></ref><ref id="bib47"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gerber</surname><given-names>B</given-names></name><name><surname>Hendel</surname><given-names>T</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Outcome expectations drive learned behaviour in larval <italic>Drosophila</italic></article-title><source>Proceedings. Biological Sciences</source><volume>273</volume><fpage>2965</fpage><lpage>2968</lpage><pub-id pub-id-type="doi">10.1098/rspb.2006.3673</pub-id><pub-id pub-id-type="pmid">17015355</pub-id></element-citation></ref><ref id="bib48"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gershow</surname><given-names>M</given-names></name><name><surname>Berck</surname><given-names>M</given-names></name><name><surname>Mathew</surname><given-names>D</given-names></name><name><surname>Luo</surname><given-names>L</given-names></name><name><surname>Kane</surname><given-names>EA</given-names></name><name><surname>Carlson</surname><given-names>JR</given-names></name><name><surname>Samuel</surname><given-names>ADT</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Controlling airborne cues to study small animal navigation</article-title><source>Nature Methods</source><volume>9</volume><fpage>290</fpage><lpage>296</lpage><pub-id pub-id-type="doi">10.1038/nmeth.1853</pub-id><pub-id pub-id-type="pmid">22245808</pub-id></element-citation></ref><ref id="bib49"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Giurfa</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Associative learning: the instructive function of biogenic amines</article-title><source>Current Biology</source><volume>16</volume><fpage>R892</fpage><lpage>R895</lpage><pub-id pub-id-type="doi">10.1016/j.cub.2006.09.021</pub-id><pub-id pub-id-type="pmid">17055975</pub-id></element-citation></ref><ref id="bib50"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gomez-Marin</surname><given-names>A</given-names></name><name><surname>Stephens</surname><given-names>GJ</given-names></name><name><surname>Louis</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Active sampling and decision making in <italic>Drosophila</italic> chemotaxis</article-title><source>Nature Communications</source><volume>2</volume><elocation-id>441</elocation-id><pub-id pub-id-type="doi">10.1038/ncomms1455</pub-id><pub-id pub-id-type="pmid">21863008</pub-id></element-citation></ref><ref id="bib51"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Gonzalez</surname><given-names>RC</given-names></name><name><surname>Woods</surname><given-names>RE</given-names></name></person-group><year iso-8601-date="2018">2018</year><source>Digital Image Processing, Ebook</source><edition>fourth</edition><publisher-name>Pearson Education, Limited</publisher-name></element-citation></ref><ref id="bib52"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Grau</surname><given-names>JW</given-names></name><name><surname>Barstow</surname><given-names>DG</given-names></name><name><surname>Joynes</surname><given-names>RL</given-names></name></person-group><year iso-8601-date="1998">1998</year><article-title>Instrumental learning within the spinal cord: I. behavioral properties</article-title><source>Behavioral Neuroscience</source><volume>112</volume><fpage>1366</fpage><lpage>1386</lpage><pub-id pub-id-type="doi">10.1037//0735-7044.112.6.1366</pub-id><pub-id pub-id-type="pmid">9926819</pub-id></element-citation></ref><ref id="bib53"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Grillner</surname><given-names>S</given-names></name><name><surname>Robertson</surname><given-names>B</given-names></name><name><surname>Stephenson-Jones</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>The evolutionary origin of the vertebrate basal ganglia and its role in action selection</article-title><source>The Journal of Physiology</source><volume>591</volume><fpage>5425</fpage><lpage>5431</lpage><pub-id pub-id-type="doi">10.1113/jphysiol.2012.246660</pub-id><pub-id pub-id-type="pmid">23318875</pub-id></element-citation></ref><ref id="bib54"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Gupta</surname><given-names>S</given-names></name><name><surname>Gomez-Marin</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>A Context-Free Grammar for <italic>Caenorhabditis elegans</italic> Behavior</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/708891</pub-id></element-citation></ref><ref id="bib55"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Haberkern</surname><given-names>H</given-names></name><name><surname>Basnak</surname><given-names>MA</given-names></name><name><surname>Ahanonu</surname><given-names>B</given-names></name><name><surname>Schauder</surname><given-names>D</given-names></name><name><surname>Cohen</surname><given-names>JD</given-names></name><name><surname>Bolstad</surname><given-names>M</given-names></name><name><surname>Bruns</surname><given-names>C</given-names></name><name><surname>Jayaraman</surname><given-names>V</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Visually guided behavior and optogenetically induced learning in head-fixed flies exploring a virtual landscape</article-title><source>Current Biology</source><volume>29</volume><fpage>1647</fpage><lpage>1659</lpage><pub-id pub-id-type="doi">10.1016/j.cub.2019.04.033</pub-id><pub-id pub-id-type="pmid">31056392</pub-id></element-citation></ref><ref id="bib56"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hamada</surname><given-names>FN</given-names></name><name><surname>Rosenzweig</surname><given-names>M</given-names></name><name><surname>Kang</surname><given-names>K</given-names></name><name><surname>Pulver</surname><given-names>SR</given-names></name><name><surname>Ghezzi</surname><given-names>A</given-names></name><name><surname>Jegla</surname><given-names>TJ</given-names></name><name><surname>Garrity</surname><given-names>PA</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>An internal thermal sensor controlling temperature preference in <italic>Drosophila</italic></article-title><source>Nature</source><volume>454</volume><fpage>217</fpage><lpage>220</lpage><pub-id pub-id-type="doi">10.1038/nature07001</pub-id><pub-id pub-id-type="pmid">18548007</pub-id></element-citation></ref><ref id="bib57"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hawkins</surname><given-names>RD</given-names></name><name><surname>Byrne</surname><given-names>JH</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Associative learning in invertebrates</article-title><source>Cold Spring Harbor Perspectives in Biology</source><volume>7</volume><elocation-id>a021709</elocation-id><pub-id pub-id-type="doi">10.1101/cshperspect.a021709</pub-id><pub-id pub-id-type="pmid">25877219</pub-id></element-citation></ref><ref id="bib58"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>He</surname><given-names>J</given-names></name><name><surname>Wei</surname><given-names>J</given-names></name><name><surname>Rizak</surname><given-names>JD</given-names></name><name><surname>Chen</surname><given-names>Y</given-names></name><name><surname>Wang</surname><given-names>J</given-names></name><name><surname>Hu</surname><given-names>X</given-names></name><name><surname>Ma</surname><given-names>Y</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>An odor detection system based on automatically trained mice by relative go no-go olfactory operant conditioning</article-title><source>Scientific Reports</source><volume>5</volume><elocation-id>10019</elocation-id><pub-id pub-id-type="doi">10.1038/srep10019</pub-id><pub-id pub-id-type="pmid">25944031</pub-id></element-citation></ref><ref id="bib59"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Heckscher</surname><given-names>ES</given-names></name><name><surname>Lockery</surname><given-names>SR</given-names></name><name><surname>Doe</surname><given-names>CQ</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Characterization of <italic>Drosophila</italic> larval crawling at the level of organism, segment, and somatic body wall musculature</article-title><source>The Journal of Neuroscience</source><volume>32</volume><fpage>12460</fpage><lpage>12471</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.0222-12.2012</pub-id><pub-id pub-id-type="pmid">22956837</pub-id></element-citation></ref><ref id="bib60"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Heisenberg</surname><given-names>M</given-names></name><name><surname>Borst</surname><given-names>A</given-names></name><name><surname>Wagner</surname><given-names>S</given-names></name><name><surname>Byers</surname><given-names>D</given-names></name></person-group><year iso-8601-date="1985">1985</year><article-title><italic>Drosophila</italic> mushroom body mutants are deficient in olfactory learning</article-title><source>Journal of Neurogenetics</source><volume>2</volume><fpage>1</fpage><lpage>30</lpage><pub-id pub-id-type="doi">10.3109/01677068509100140</pub-id><pub-id pub-id-type="pmid">4020527</pub-id></element-citation></ref><ref id="bib61"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Heisenberg</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2003">2003</year><article-title>Mushroom body memoir: from maps to models</article-title><source>Nature Reviews. Neuroscience</source><volume>4</volume><fpage>266</fpage><lpage>275</lpage><pub-id pub-id-type="doi">10.1038/nrn1074</pub-id><pub-id pub-id-type="pmid">12671643</pub-id></element-citation></ref><ref id="bib62"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hendel</surname><given-names>T</given-names></name><name><surname>Michels</surname><given-names>B</given-names></name><name><surname>Neuser</surname><given-names>K</given-names></name><name><surname>Schipanski</surname><given-names>A</given-names></name><name><surname>Kaun</surname><given-names>K</given-names></name><name><surname>Sokolowski</surname><given-names>MB</given-names></name><name><surname>Marohn</surname><given-names>F</given-names></name><name><surname>Michel</surname><given-names>R</given-names></name><name><surname>Heisenberg</surname><given-names>M</given-names></name><name><surname>Gerber</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>The carrot, not the stick: appetitive rather than aversive gustatory stimuli support associative olfactory learning in individually assayed <italic>Drosophila</italic> larvae</article-title><source>Journal of Comparative Physiology. A, Neuroethology, Sensory, Neural, and Behavioral Physiology</source><volume>191</volume><fpage>265</fpage><lpage>279</lpage><pub-id pub-id-type="doi">10.1007/s00359-004-0574-8</pub-id><pub-id pub-id-type="pmid">15657743</pub-id></element-citation></ref><ref id="bib63"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Honda</surname><given-names>T</given-names></name><name><surname>Lee</surname><given-names>CY</given-names></name><name><surname>Yoshida-Kasikawa</surname><given-names>M</given-names></name><name><surname>Honjo</surname><given-names>K</given-names></name><name><surname>Furukubo-Tokunaga</surname><given-names>K</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Induction of associative olfactory memory by targeted activation of single olfactory neurons in <italic>Drosophila</italic> larvae</article-title><source>Scientific Reports</source><volume>4</volume><elocation-id>4798</elocation-id><pub-id pub-id-type="doi">10.1038/srep04798</pub-id><pub-id pub-id-type="pmid">24762789</pub-id></element-citation></ref><ref id="bib64"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Honegger</surname><given-names>KS</given-names></name><name><surname>Campbell</surname><given-names>RAA</given-names></name><name><surname>Turner</surname><given-names>GC</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Cellular-resolution population imaging reveals robust sparse coding in the <italic>Drosophila</italic> mushroom body</article-title><source>The Journal of Neuroscience</source><volume>31</volume><fpage>11772</fpage><lpage>11785</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.1099-11.2011</pub-id><pub-id pub-id-type="pmid">21849538</pub-id></element-citation></ref><ref id="bib65"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Honjo</surname><given-names>K</given-names></name><name><surname>Furukubo-Tokunaga</surname><given-names>K</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Distinctive neuronal networks and biochemical pathways for appetitive and aversive memory in <italic>Drosophila</italic> larvae</article-title><source>The Journal of Neuroscience</source><volume>29</volume><fpage>852</fpage><lpage>862</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.1315-08.2009</pub-id><pub-id pub-id-type="pmid">19158309</pub-id></element-citation></ref><ref id="bib66"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Horridge</surname><given-names>GA</given-names></name></person-group><year iso-8601-date="1962">1962</year><article-title>Learning of leg position by the ventral nerve cord in headless insects</article-title><source>Proceedings of the Royal Society of London. Series B. Biological Sciences</source><volume>157</volume><fpage>33</fpage><lpage>52</lpage><pub-id pub-id-type="doi">10.1098/rspb.1962.0061</pub-id></element-citation></ref><ref id="bib67"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hoyle</surname><given-names>G</given-names></name></person-group><year iso-8601-date="1979">1979</year><article-title>Mechanisms of simple motor learning</article-title><source>Trends in Neurosciences</source><volume>2</volume><fpage>153</fpage><lpage>155</lpage><pub-id pub-id-type="doi">10.1016/0166-2236(79)90060-2</pub-id></element-citation></ref><ref id="bib68"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Huser</surname><given-names>A</given-names></name><name><surname>Rohwedder</surname><given-names>A</given-names></name><name><surname>Apostolopoulou</surname><given-names>AA</given-names></name><name><surname>Widmann</surname><given-names>A</given-names></name><name><surname>Pfitzenmaier</surname><given-names>JE</given-names></name><name><surname>Maiolo</surname><given-names>EM</given-names></name><name><surname>Selcho</surname><given-names>M</given-names></name><name><surname>Pauls</surname><given-names>D</given-names></name><name><surname>von Essen</surname><given-names>A</given-names></name><name><surname>Gupta</surname><given-names>T</given-names></name><name><surname>Sprecher</surname><given-names>SG</given-names></name><name><surname>Birman</surname><given-names>S</given-names></name><name><surname>Riemensperger</surname><given-names>T</given-names></name><name><surname>Stocker</surname><given-names>RF</given-names></name><name><surname>Thum</surname><given-names>AS</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>The serotonergic central nervous system of the <italic>Drosophila</italic> larva: anatomy and behavioral function</article-title><source>PLOS ONE</source><volume>7</volume><elocation-id>e47518</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0047518</pub-id><pub-id pub-id-type="pmid">23082175</pub-id></element-citation></ref><ref id="bib69"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hwang</surname><given-names>RY</given-names></name><name><surname>Zhong</surname><given-names>L</given-names></name><name><surname>Xu</surname><given-names>Y</given-names></name><name><surname>Johnson</surname><given-names>T</given-names></name><name><surname>Zhang</surname><given-names>F</given-names></name><name><surname>Deisseroth</surname><given-names>K</given-names></name><name><surname>Tracey</surname><given-names>WD</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Nociceptive neurons protect <italic>Drosophila</italic> larvae from parasitoid wasps</article-title><source>Current Biology</source><volume>17</volume><fpage>2105</fpage><lpage>2116</lpage><pub-id pub-id-type="doi">10.1016/j.cub.2007.11.029</pub-id><pub-id pub-id-type="pmid">18060782</pub-id></element-citation></ref><ref id="bib70"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jefferis</surname><given-names>GSXE</given-names></name><name><surname>Potter</surname><given-names>CJ</given-names></name><name><surname>Chan</surname><given-names>AM</given-names></name><name><surname>Marin</surname><given-names>EC</given-names></name><name><surname>Rohlfing</surname><given-names>T</given-names></name><name><surname>Maurer</surname><given-names>CR</given-names></name><name><surname>Luo</surname><given-names>L</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Comprehensive maps of <italic>Drosophila</italic> higher olfactory centers: spatially segregated fruit and pheromone representation</article-title><source>Cell</source><volume>128</volume><fpage>1187</fpage><lpage>1203</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2007.01.040</pub-id><pub-id pub-id-type="pmid">17382886</pub-id></element-citation></ref><ref id="bib71"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jenett</surname><given-names>A</given-names></name><name><surname>Rubin</surname><given-names>GM</given-names></name><name><surname>Ngo</surname><given-names>T-TB</given-names></name><name><surname>Shepherd</surname><given-names>D</given-names></name><name><surname>Murphy</surname><given-names>C</given-names></name><name><surname>Dionne</surname><given-names>H</given-names></name><name><surname>Pfeiffer</surname><given-names>BD</given-names></name><name><surname>Cavallaro</surname><given-names>A</given-names></name><name><surname>Hall</surname><given-names>D</given-names></name><name><surname>Jeter</surname><given-names>J</given-names></name><name><surname>Iyer</surname><given-names>N</given-names></name><name><surname>Fetter</surname><given-names>D</given-names></name><name><surname>Hausenfluck</surname><given-names>JH</given-names></name><name><surname>Peng</surname><given-names>H</given-names></name><name><surname>Trautman</surname><given-names>ET</given-names></name><name><surname>Svirskas</surname><given-names>RR</given-names></name><name><surname>Myers</surname><given-names>EW</given-names></name><name><surname>Iwinski</surname><given-names>ZR</given-names></name><name><surname>Aso</surname><given-names>Y</given-names></name><name><surname>DePasquale</surname><given-names>GM</given-names></name><name><surname>Enos</surname><given-names>A</given-names></name><name><surname>Hulamm</surname><given-names>P</given-names></name><name><surname>Lam</surname><given-names>SCB</given-names></name><name><surname>Li</surname><given-names>H-H</given-names></name><name><surname>Laverty</surname><given-names>TR</given-names></name><name><surname>Long</surname><given-names>F</given-names></name><name><surname>Qu</surname><given-names>L</given-names></name><name><surname>Murphy</surname><given-names>SD</given-names></name><name><surname>Rokicki</surname><given-names>K</given-names></name><name><surname>Safford</surname><given-names>T</given-names></name><name><surname>Shaw</surname><given-names>K</given-names></name><name><surname>Simpson</surname><given-names>JH</given-names></name><name><surname>Sowell</surname><given-names>A</given-names></name><name><surname>Tae</surname><given-names>S</given-names></name><name><surname>Yu</surname><given-names>Y</given-names></name><name><surname>Zugates</surname><given-names>CT</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>A gal4-driver line resource for <italic>Drosophila</italic> neurobiology</article-title><source>Cell Reports</source><volume>2</volume><fpage>991</fpage><lpage>1001</lpage><pub-id pub-id-type="doi">10.1016/j.celrep.2012.09.011</pub-id><pub-id pub-id-type="pmid">23063364</pub-id></element-citation></ref><ref id="bib72"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jin</surname><given-names>X</given-names></name><name><surname>Costa</surname><given-names>RM</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Start/stop signals emerge in nigrostriatal circuits during sequence learning</article-title><source>Nature</source><volume>466</volume><fpage>457</fpage><lpage>462</lpage><pub-id pub-id-type="doi">10.1038/nature09263</pub-id><pub-id pub-id-type="pmid">20651684</pub-id></element-citation></ref><ref id="bib73"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jones</surname><given-names>SV</given-names></name><name><surname>Heldt</surname><given-names>SA</given-names></name><name><surname>Davis</surname><given-names>M</given-names></name><name><surname>Ressler</surname><given-names>KJ</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Olfactory-mediated fear conditioning in mice: simultaneous measurements of fear-potentiated startle and freezing</article-title><source>Behavioral Neuroscience</source><volume>119</volume><fpage>329</fpage><lpage>335</lpage><pub-id pub-id-type="doi">10.1037/0735-7044.119.1.329</pub-id><pub-id pub-id-type="pmid">15727538</pub-id></element-citation></ref><ref id="bib74"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jovanic</surname><given-names>T</given-names></name><name><surname>Schneider-Mizell</surname><given-names>CM</given-names></name><name><surname>Shao</surname><given-names>M</given-names></name><name><surname>Masson</surname><given-names>JB</given-names></name><name><surname>Denisov</surname><given-names>G</given-names></name><name><surname>Fetter</surname><given-names>RD</given-names></name><name><surname>Mensh</surname><given-names>BD</given-names></name><name><surname>Truman</surname><given-names>JW</given-names></name><name><surname>Cardona</surname><given-names>A</given-names></name><name><surname>Zlatic</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Competitive disinhibition mediates behavioral choice and sequences in <italic>Drosophila</italic></article-title><source>Cell</source><volume>167</volume><fpage>858</fpage><lpage>870</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2016.09.009</pub-id><pub-id pub-id-type="pmid">27720450</pub-id></element-citation></ref><ref id="bib75"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jovanic</surname><given-names>T</given-names></name><name><surname>Winding</surname><given-names>M</given-names></name><name><surname>Cardona</surname><given-names>A</given-names></name><name><surname>Truman</surname><given-names>JW</given-names></name><name><surname>Gershow</surname><given-names>M</given-names></name><name><surname>Zlatic</surname><given-names>M</given-names></name><name><surname>Jovanic</surname><given-names>T</given-names></name><name><surname>Winding</surname><given-names>M</given-names></name><name><surname>Cardona</surname><given-names>A</given-names></name><name><surname>Truman</surname><given-names>JW</given-names></name><name><surname>Gershow</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Neural substrates of <italic>Drosophila</italic> larval anemotaxis article</article-title><source>Current Biology</source><volume>29</volume><fpage>554</fpage><lpage>566</lpage><pub-id pub-id-type="doi">10.1016/j.cub.2019.01.009</pub-id></element-citation></ref><ref id="bib76"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kabra</surname><given-names>M</given-names></name><name><surname>Robie</surname><given-names>AA</given-names></name><name><surname>Rivera-Alba</surname><given-names>M</given-names></name><name><surname>Branson</surname><given-names>S</given-names></name><name><surname>Branson</surname><given-names>K</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>JAABA: interactive machine learning for automatic annotation of animal behavior</article-title><source>Nature Methods</source><volume>10</volume><fpage>64</fpage><lpage>67</lpage><pub-id pub-id-type="doi">10.1038/nmeth.2281</pub-id><pub-id pub-id-type="pmid">23202433</pub-id></element-citation></ref><ref id="bib77"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kane</surname><given-names>EA</given-names></name><name><surname>Gershow</surname><given-names>M</given-names></name><name><surname>Afonso</surname><given-names>B</given-names></name><name><surname>Larderet</surname><given-names>I</given-names></name><name><surname>Klein</surname><given-names>M</given-names></name><name><surname>Carter</surname><given-names>AR</given-names></name><name><surname>de Bivort</surname><given-names>BL</given-names></name><name><surname>Sprecher</surname><given-names>SG</given-names></name><name><surname>Samuel</surname><given-names>ADT</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Sensorimotor structure of <italic>Drosophila</italic> larva phototaxis</article-title><source>PNAS</source><volume>110</volume><fpage>E3868</fpage><lpage>E3877</lpage><pub-id pub-id-type="doi">10.1073/pnas.1215295110</pub-id><pub-id pub-id-type="pmid">24043822</pub-id></element-citation></ref><ref id="bib78"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Karagyozov</surname><given-names>D</given-names></name><name><surname>Mihovilovic Skanata</surname><given-names>M</given-names></name><name><surname>Lesar</surname><given-names>A</given-names></name><name><surname>Gershow</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Recording neural activity in unrestrained animals with three-dimensional tracking two-photon microscopy</article-title><source>Cell Reports</source><volume>25</volume><fpage>1371</fpage><lpage>1383</lpage><pub-id pub-id-type="doi">10.1016/j.celrep.2018.10.013</pub-id><pub-id pub-id-type="pmid">30380425</pub-id></element-citation></ref><ref id="bib79"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Kehtarnavaz</surname><given-names>N</given-names></name><name><surname>Shirvaikar</surname><given-names>M</given-names></name><name><surname>Bushnaq</surname><given-names>T</given-names></name><name><surname>Carlsohn</surname><given-names>MF</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>A comparison between DSP and FPGA platforms for real-time imaging applications</article-title><conf-name>IS&amp;T/SPIE Electronic Imaging</conf-name><conf-loc>San Jose, CA</conf-loc><pub-id pub-id-type="doi">10.1117/12.806099</pub-id></element-citation></ref><ref id="bib80"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Khurana</surname><given-names>S</given-names></name><name><surname>Robinson</surname><given-names>BG</given-names></name><name><surname>Wang</surname><given-names>Z</given-names></name><name><surname>Shropshire</surname><given-names>WC</given-names></name><name><surname>Zhong</surname><given-names>AC</given-names></name><name><surname>Garcia</surname><given-names>LE</given-names></name><name><surname>Corpuz</surname><given-names>J</given-names></name><name><surname>Chow</surname><given-names>J</given-names></name><name><surname>Hatch</surname><given-names>MM</given-names></name><name><surname>Precise</surname><given-names>EF</given-names></name><name><surname>Cady</surname><given-names>A</given-names></name><name><surname>Godinez</surname><given-names>RM</given-names></name><name><surname>Pulpanyawong</surname><given-names>T</given-names></name><name><surname>Nguyen</surname><given-names>AT</given-names></name><name><surname>Li</surname><given-names>W-K</given-names></name><name><surname>Seiter</surname><given-names>M</given-names></name><name><surname>Jahanian</surname><given-names>K</given-names></name><name><surname>Sun</surname><given-names>JC</given-names></name><name><surname>Shah</surname><given-names>R</given-names></name><name><surname>Rajani</surname><given-names>S</given-names></name><name><surname>Chen</surname><given-names>WY</given-names></name><name><surname>Ray</surname><given-names>S</given-names></name><name><surname>Ryazanova</surname><given-names>NV</given-names></name><name><surname>Wakou</surname><given-names>D</given-names></name><name><surname>Prabhu</surname><given-names>RK</given-names></name><name><surname>Atkinson</surname><given-names>NS</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Olfactory conditioning in the third instar larvae of <italic>Drosophila melanogaster</italic> using heat shock reinforcement</article-title><source>Behavior Genetics</source><volume>42</volume><fpage>151</fpage><lpage>161</lpage><pub-id pub-id-type="doi">10.1007/s10519-011-9487-9</pub-id><pub-id pub-id-type="pmid">21833772</pub-id></element-citation></ref><ref id="bib81"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kitamoto</surname><given-names>T</given-names></name></person-group><year iso-8601-date="2001">2001</year><article-title>Conditional modification of behavior in <italic>Drosophila</italic> by targeted expression of a temperature-sensitive shibire allele in defined neurons</article-title><source>Journal of Neurobiology</source><volume>47</volume><fpage>81</fpage><lpage>92</lpage><pub-id pub-id-type="doi">10.1002/neu.1018</pub-id><pub-id pub-id-type="pmid">11291099</pub-id></element-citation></ref><ref id="bib82"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Klapoetke</surname><given-names>NC</given-names></name><name><surname>Murata</surname><given-names>Y</given-names></name><name><surname>Kim</surname><given-names>SS</given-names></name><name><surname>Pulver</surname><given-names>SR</given-names></name><name><surname>Birdsey-Benson</surname><given-names>A</given-names></name><name><surname>Cho</surname><given-names>YK</given-names></name><name><surname>Morimoto</surname><given-names>TK</given-names></name><name><surname>Chuong</surname><given-names>AS</given-names></name><name><surname>Carpenter</surname><given-names>EJ</given-names></name><name><surname>Tian</surname><given-names>Z</given-names></name><name><surname>Wang</surname><given-names>J</given-names></name><name><surname>Xie</surname><given-names>Y</given-names></name><name><surname>Yan</surname><given-names>Z</given-names></name><name><surname>Zhang</surname><given-names>Y</given-names></name><name><surname>Chow</surname><given-names>BY</given-names></name><name><surname>Surek</surname><given-names>B</given-names></name><name><surname>Melkonian</surname><given-names>M</given-names></name><name><surname>Jayaraman</surname><given-names>V</given-names></name><name><surname>Constantine-Paton</surname><given-names>M</given-names></name><name><surname>Wong</surname><given-names>GKS</given-names></name><name><surname>Boyden</surname><given-names>ES</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Independent optical excitation of distinct neural populations</article-title><source>Nature Methods</source><volume>11</volume><fpage>338</fpage><lpage>346</lpage><pub-id pub-id-type="doi">10.1038/nmeth.2836</pub-id><pub-id pub-id-type="pmid">24509633</pub-id></element-citation></ref><ref id="bib83"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Krajbich</surname><given-names>I</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Accounting for attention in sequential sampling models of decision making</article-title><source>Current Opinion in Psychology</source><volume>29</volume><fpage>6</fpage><lpage>11</lpage><pub-id pub-id-type="doi">10.1016/j.copsyc.2018.10.008</pub-id><pub-id pub-id-type="pmid">30368108</pub-id></element-citation></ref><ref id="bib84"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Krynitsky</surname><given-names>J</given-names></name><name><surname>Legaria</surname><given-names>AA</given-names></name><name><surname>Pai</surname><given-names>JJ</given-names></name><name><surname>Garmendia-Cedillos</surname><given-names>M</given-names></name><name><surname>Salem</surname><given-names>G</given-names></name><name><surname>Pohida</surname><given-names>T</given-names></name><name><surname>Kravitz</surname><given-names>AV</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Rodent arena tracker (rat): a machine vision rodent tracking camera and closed loop control system</article-title><source>Eneuro</source><volume>7</volume><elocation-id>ENEURO</elocation-id><pub-id pub-id-type="doi">10.1523/ENEURO.0485-19.2020</pub-id></element-citation></ref><ref id="bib85"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kudow</surname><given-names>N</given-names></name><name><surname>Miura</surname><given-names>D</given-names></name><name><surname>Schleyer</surname><given-names>M</given-names></name><name><surname>Toshima</surname><given-names>N</given-names></name><name><surname>Gerber</surname><given-names>B</given-names></name><name><surname>Tanimura</surname><given-names>T</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Preference for and learning of amino acids in larval <italic>Drosophila</italic></article-title><source>Biology Open</source><volume>6</volume><fpage>365</fpage><lpage>369</lpage><pub-id pub-id-type="doi">10.1242/bio.020412</pub-id><pub-id pub-id-type="pmid">28193602</pub-id></element-citation></ref><ref id="bib86"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lahiri</surname><given-names>S</given-names></name><name><surname>Shen</surname><given-names>K</given-names></name><name><surname>Klein</surname><given-names>M</given-names></name><name><surname>Tang</surname><given-names>A</given-names></name><name><surname>Kane</surname><given-names>E</given-names></name><name><surname>Gershow</surname><given-names>M</given-names></name><name><surname>Garrity</surname><given-names>P</given-names></name><name><surname>Samuel</surname><given-names>ADT</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Two alternating motor programs drive navigation in <italic>Drosophila</italic> larva</article-title><source>PLOS ONE</source><volume>6</volume><elocation-id>e23180</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0023180</pub-id><pub-id pub-id-type="pmid">21858019</pub-id></element-citation></ref><ref id="bib87"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Larderet</surname><given-names>I</given-names></name><name><surname>Fritsch</surname><given-names>PMJ</given-names></name><name><surname>Gendre</surname><given-names>N</given-names></name><name><surname>Neagu-Maier</surname><given-names>GL</given-names></name><name><surname>Fetter</surname><given-names>RD</given-names></name><name><surname>Schneider-Mizell</surname><given-names>CM</given-names></name><name><surname>Truman</surname><given-names>JW</given-names></name><name><surname>Zlatic</surname><given-names>M</given-names></name><name><surname>Cardona</surname><given-names>A</given-names></name><name><surname>Sprecher</surname><given-names>SG</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Organization of the <italic>Drosophila</italic> larval visual circuit</article-title><source>eLife</source><volume>6</volume><elocation-id>e28387</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.28387</pub-id><pub-id pub-id-type="pmid">30726702</pub-id></element-citation></ref><ref id="bib88"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lee</surname><given-names>T</given-names></name><name><surname>Luo</surname><given-names>L</given-names></name></person-group><year iso-8601-date="1999">1999</year><article-title>Mosaic analysis with a repressible cell marker for studies of gene function in neuronal morphogenesis</article-title><source>Neuron</source><volume>22</volume><fpage>451</fpage><lpage>461</lpage><pub-id pub-id-type="doi">10.1016/s0896-6273(00)80701-1</pub-id><pub-id pub-id-type="pmid">10197526</pub-id></element-citation></ref><ref id="bib89"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>H</given-names></name><name><surname>Chaney</surname><given-names>S</given-names></name><name><surname>Roberts</surname><given-names>IJ</given-names></name><name><surname>Forte</surname><given-names>M</given-names></name><name><surname>Hirsh</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2000">2000</year><article-title>Ectopic G-protein expression in dopamine and serotonin neurons blocks cocaine sensitization in <italic>Drosophila melanogaster</italic></article-title><source>Current Biology</source><volume>10</volume><fpage>211</fpage><lpage>214</lpage><pub-id pub-id-type="doi">10.1016/s0960-9822(00)00340-7</pub-id><pub-id pub-id-type="pmid">10704417</pub-id></element-citation></ref><ref id="bib90"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Li</surname><given-names>Y</given-names></name><name><surname>Yao</surname><given-names>Q</given-names></name><name><surname>Tian</surname><given-names>B</given-names></name><name><surname>Xu</surname><given-names>W</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>2011 IEEE International Conference on Vehicular Electronics and Safety (ICVES 2011)</article-title><conf-name>IEEE</conf-name><conf-loc>Beijing, China</conf-loc><pub-id pub-id-type="doi">10.1109/ICVES.2011.5983754</pub-id></element-citation></ref><ref id="bib91"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>HH</given-names></name><name><surname>Kroll</surname><given-names>JR</given-names></name><name><surname>Lennox</surname><given-names>SM</given-names></name><name><surname>Ogundeyi</surname><given-names>O</given-names></name><name><surname>Jeter</surname><given-names>J</given-names></name><name><surname>Depasquale</surname><given-names>G</given-names></name><name><surname>Truman</surname><given-names>JW</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>A GAL4 driver resource for developmental and behavioral studies on the larval CNS of <italic>Drosophila</italic></article-title><source>Cell Reports</source><volume>8</volume><fpage>897</fpage><lpage>908</lpage><pub-id pub-id-type="doi">10.1016/j.celrep.2014.06.065</pub-id><pub-id pub-id-type="pmid">25088417</pub-id></element-citation></ref><ref id="bib92"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lima</surname><given-names>SQ</given-names></name><name><surname>Miesenböck</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Remote control of behavior through genetically targeted photostimulation of neurons</article-title><source>Cell</source><volume>121</volume><fpage>141</fpage><lpage>152</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2005.02.004</pub-id><pub-id pub-id-type="pmid">15820685</pub-id></element-citation></ref><ref id="bib93"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lin</surname><given-names>S</given-names></name><name><surname>Owald</surname><given-names>D</given-names></name><name><surname>Chandra</surname><given-names>V</given-names></name><name><surname>Talbot</surname><given-names>C</given-names></name><name><surname>Huetteroth</surname><given-names>W</given-names></name><name><surname>Waddell</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Neural correlates of water reward in thirsty <italic>Drosophila</italic></article-title><source>Nature Neuroscience</source><volume>17</volume><fpage>1536</fpage><lpage>1542</lpage><pub-id pub-id-type="doi">10.1038/nn.3827</pub-id><pub-id pub-id-type="pmid">25262493</pub-id></element-citation></ref><ref id="bib94"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liu</surname><given-names>C</given-names></name><name><surname>Plaçais</surname><given-names>PY</given-names></name><name><surname>Yamagata</surname><given-names>N</given-names></name><name><surname>Pfeiffer</surname><given-names>BD</given-names></name><name><surname>Aso</surname><given-names>Y</given-names></name><name><surname>Friedrich</surname><given-names>AB</given-names></name><name><surname>Siwanowicz</surname><given-names>I</given-names></name><name><surname>Rubin</surname><given-names>GM</given-names></name><name><surname>Preat</surname><given-names>T</given-names></name><name><surname>Tanimoto</surname><given-names>H</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>A subset of dopamine neurons signals reward for odour memory in <italic>Drosophila</italic></article-title><source>Nature</source><volume>488</volume><fpage>512</fpage><lpage>516</lpage><pub-id pub-id-type="doi">10.1038/nature11304</pub-id><pub-id pub-id-type="pmid">22810589</pub-id></element-citation></ref><ref id="bib95"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lovell</surname><given-names>JM</given-names></name><name><surname>Mylius</surname><given-names>J</given-names></name><name><surname>Scheich</surname><given-names>H</given-names></name><name><surname>Brosch</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Stimulation of the dopaminergic midbrain as a behavioral reward in instrumentally conditioned monkeys</article-title><source>Brain Stimulation</source><volume>8</volume><fpage>868</fpage><lpage>874</lpage><pub-id pub-id-type="doi">10.1016/j.brs.2015.04.007</pub-id><pub-id pub-id-type="pmid">26070295</pub-id></element-citation></ref><ref id="bib96"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Luan</surname><given-names>H</given-names></name><name><surname>Peabody</surname><given-names>NC</given-names></name><name><surname>Vinson</surname><given-names>CR</given-names></name><name><surname>White</surname><given-names>BH</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Refined spatial manipulation of neuronal function by combinatorial restriction of transgene expression</article-title><source>Neuron</source><volume>52</volume><fpage>425</fpage><lpage>436</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2006.08.028</pub-id><pub-id pub-id-type="pmid">17088209</pub-id></element-citation></ref><ref id="bib97"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lundell</surname><given-names>MJ</given-names></name><name><surname>Hirsh</surname><given-names>J</given-names></name></person-group><year iso-8601-date="1994">1994</year><article-title>Temporal and spatial development of serotonin and dopamine neurons in the <italic>Drosophila</italic> CNS</article-title><source>Developmental Biology</source><volume>165</volume><fpage>385</fpage><lpage>396</lpage><pub-id pub-id-type="doi">10.1006/dbio.1994.1261</pub-id><pub-id pub-id-type="pmid">7958407</pub-id></element-citation></ref><ref id="bib98"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Luo</surname><given-names>L</given-names></name><name><surname>Gershow</surname><given-names>M</given-names></name><name><surname>Rosenzweig</surname><given-names>M</given-names></name><name><surname>Kang</surname><given-names>K</given-names></name><name><surname>Fang-Yen</surname><given-names>C</given-names></name><name><surname>Garrity</surname><given-names>PA</given-names></name><name><surname>Samuel</surname><given-names>ADT</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Navigational decision making in <italic>Drosophila</italic> thermotaxis</article-title><source>Journal of Neuroscience</source><volume>30</volume><fpage>4261</fpage><lpage>4272</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.4090-09.2010</pub-id><pub-id pub-id-type="pmid">20335462</pub-id></element-citation></ref><ref id="bib99"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Marin</surname><given-names>EC</given-names></name><name><surname>Jefferis</surname><given-names>GSXE</given-names></name><name><surname>Komiyama</surname><given-names>T</given-names></name><name><surname>Zhu</surname><given-names>H</given-names></name><name><surname>Luo</surname><given-names>L</given-names></name></person-group><year iso-8601-date="2002">2002</year><article-title>Representation of the glomerular olfactory map in the <italic>Drosophila</italic> brain</article-title><source>Cell</source><volume>109</volume><fpage>243</fpage><lpage>255</lpage><pub-id pub-id-type="doi">10.1016/s0092-8674(02)00700-6</pub-id><pub-id pub-id-type="pmid">12007410</pub-id></element-citation></ref><ref id="bib100"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Masson</surname><given-names>JB</given-names></name><name><surname>Voisinne</surname><given-names>G</given-names></name><name><surname>Wong-Ng</surname><given-names>J</given-names></name><name><surname>Celani</surname><given-names>A</given-names></name><name><surname>Vergassola</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Noninvasive inference of the molecular chemotactic response using bacterial trajectories</article-title><source>PNAS</source><volume>109</volume><fpage>1802</fpage><lpage>1807</lpage><pub-id pub-id-type="doi">10.1073/pnas.1116772109</pub-id><pub-id pub-id-type="pmid">22307649</pub-id></element-citation></ref><ref id="bib101"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Masson</surname><given-names>J-B</given-names></name><name><surname>Laurent</surname><given-names>F</given-names></name><name><surname>Cardona</surname><given-names>A</given-names></name><name><surname>Barré</surname><given-names>C</given-names></name><name><surname>Skatchkovsky</surname><given-names>N</given-names></name><name><surname>Zlatic</surname><given-names>M</given-names></name><name><surname>Jovanic</surname><given-names>T</given-names></name><name><surname>Samuel</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Identifying neural substrates of competitive interactions and sequence transitions during mechanosensory responses in <italic>Drosophila</italic></article-title><source>PLOS Genetics</source><volume>16</volume><elocation-id>e1008589</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pgen.1008589</pub-id><pub-id pub-id-type="pmid">32059010</pub-id></element-citation></ref><ref id="bib102"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mathis</surname><given-names>A</given-names></name><name><surname>Mamidanna</surname><given-names>P</given-names></name><name><surname>Cury</surname><given-names>KM</given-names></name><name><surname>Abe</surname><given-names>T</given-names></name><name><surname>Murthy</surname><given-names>VN</given-names></name><name><surname>Mathis</surname><given-names>MW</given-names></name><name><surname>Bethge</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>DeepLabCut: markerless pose estimation of user-defined body parts with deep learning</article-title><source>Nature Neuroscience</source><volume>21</volume><fpage>1281</fpage><lpage>1289</lpage><pub-id pub-id-type="doi">10.1038/s41593-018-0209-y</pub-id><pub-id pub-id-type="pmid">30127430</pub-id></element-citation></ref><ref id="bib103"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mendoza</surname><given-names>E</given-names></name><name><surname>Colomb</surname><given-names>J</given-names></name><name><surname>Rybak</surname><given-names>J</given-names></name><name><surname>Pflüger</surname><given-names>HJ</given-names></name><name><surname>Zars</surname><given-names>T</given-names></name><name><surname>Scharff</surname><given-names>C</given-names></name><name><surname>Brembs</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title><italic>Drosophila</italic> FOXP mutants are deficient in operant self-learning</article-title><source>PLOS ONE</source><volume>9</volume><elocation-id>e100648</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0100648</pub-id><pub-id pub-id-type="pmid">24964149</pub-id></element-citation></ref><ref id="bib104"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Meneses</surname><given-names>A</given-names></name><name><surname>Liy-Salmeron</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Serotonin and emotion, learning and memory</article-title><source>Reviews in the Neurosciences</source><volume>23</volume><fpage>543</fpage><lpage>553</lpage><pub-id pub-id-type="doi">10.1515/revneuro-2012-0060</pub-id><pub-id pub-id-type="pmid">23104855</pub-id></element-citation></ref><ref id="bib105"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mirat</surname><given-names>O</given-names></name><name><surname>Sternberg</surname><given-names>JR</given-names></name><name><surname>Severi</surname><given-names>KE</given-names></name><name><surname>Wyart</surname><given-names>C</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>ZebraZoom: an automated program for high-throughput behavioral analysis and categorization</article-title><source>Frontiers in Neural Circuits</source><volume>7</volume><elocation-id>107</elocation-id><pub-id pub-id-type="doi">10.3389/fncir.2013.00107</pub-id><pub-id pub-id-type="pmid">23781175</pub-id></element-citation></ref><ref id="bib106"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mischiati</surname><given-names>M</given-names></name><name><surname>Lin</surname><given-names>HT</given-names></name><name><surname>Herold</surname><given-names>P</given-names></name><name><surname>Imler</surname><given-names>E</given-names></name><name><surname>Olberg</surname><given-names>R</given-names></name><name><surname>Leonardo</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Internal models direct dragonfly interception steering</article-title><source>Nature</source><volume>517</volume><fpage>333</fpage><lpage>338</lpage><pub-id pub-id-type="doi">10.1038/nature14045</pub-id><pub-id pub-id-type="pmid">25487153</pub-id></element-citation></ref><ref id="bib107"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nern</surname><given-names>A</given-names></name><name><surname>Pfeiffer</surname><given-names>BD</given-names></name><name><surname>Rubin</surname><given-names>GM</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Optimized tools for multicolor stochastic labeling reveal diverse stereotyped cell arrangements in the fly visual system</article-title><source>PNAS</source><volume>112</volume><fpage>E2967</fpage><lpage>E2976</lpage><pub-id pub-id-type="doi">10.1073/pnas.1506763112</pub-id><pub-id pub-id-type="pmid">25964354</pub-id></element-citation></ref><ref id="bib108"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Neuser</surname><given-names>K</given-names></name><name><surname>Triphan</surname><given-names>T</given-names></name><name><surname>Mronz</surname><given-names>M</given-names></name><name><surname>Poeck</surname><given-names>B</given-names></name><name><surname>Strauss</surname><given-names>R</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Analysis of a spatial orientation memory in <italic>Drosophila</italic></article-title><source>Nature</source><volume>453</volume><fpage>1244</fpage><lpage>1247</lpage><pub-id pub-id-type="doi">10.1038/nature07003</pub-id><pub-id pub-id-type="pmid">18509336</pub-id></element-citation></ref><ref id="bib109"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Niewalda</surname><given-names>T</given-names></name><name><surname>Singhal</surname><given-names>N</given-names></name><name><surname>Fiala</surname><given-names>A</given-names></name><name><surname>Saumweber</surname><given-names>T</given-names></name><name><surname>Wegener</surname><given-names>S</given-names></name><name><surname>Gerber</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Salt processing in larval <italic>Drosophila</italic>: choice, feeding, and learning shift from appetitive to aversive in a concentration-dependent way</article-title><source>Chemical Senses</source><volume>33</volume><fpage>685</fpage><lpage>692</lpage><pub-id pub-id-type="doi">10.1093/chemse/bjn037</pub-id><pub-id pub-id-type="pmid">18640967</pub-id></element-citation></ref><ref id="bib110"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nottebohm</surname><given-names>F</given-names></name></person-group><year iso-8601-date="1991">1991</year><article-title>Reassessing the mechanisms and origins of vocal learning in birds</article-title><source>Trends in Neurosciences</source><volume>14</volume><fpage>206</fpage><lpage>211</lpage><pub-id pub-id-type="doi">10.1016/0166-2236(91)90107-6</pub-id><pub-id pub-id-type="pmid">1713723</pub-id></element-citation></ref><ref id="bib111"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nuwal</surname><given-names>N</given-names></name><name><surname>Stock</surname><given-names>P</given-names></name><name><surname>Hiemeyer</surname><given-names>J</given-names></name><name><surname>Schmid</surname><given-names>B</given-names></name><name><surname>Fiala</surname><given-names>A</given-names></name><name><surname>Buchner</surname><given-names>E</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Avoidance of heat and attraction to optogenetically induced sugar sensation as operant behavior in adult <italic>Drosophila</italic></article-title><source>Journal of Neurogenetics</source><volume>26</volume><fpage>298</fpage><lpage>305</lpage><pub-id pub-id-type="doi">10.3109/01677063.2012.700266</pub-id><pub-id pub-id-type="pmid">22834571</pub-id></element-citation></ref><ref id="bib112"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ohyama</surname><given-names>T</given-names></name><name><surname>Jovanic</surname><given-names>T</given-names></name><name><surname>Denisov</surname><given-names>G</given-names></name><name><surname>Dang</surname><given-names>TC</given-names></name><name><surname>Hoffmann</surname><given-names>D</given-names></name><name><surname>Kerr</surname><given-names>RA</given-names></name><name><surname>Zlatic</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>High-Throughput analysis of stimulus-evoked behaviors in <italic>Drosophila</italic> larva reveals multiple modality-specific escape strategies</article-title><source>PLOS ONE</source><volume>8</volume><elocation-id>e71706</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0071706</pub-id><pub-id pub-id-type="pmid">23977118</pub-id></element-citation></ref><ref id="bib113"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ohyama</surname><given-names>T</given-names></name><name><surname>Schneider-Mizell</surname><given-names>CM</given-names></name><name><surname>Fetter</surname><given-names>RD</given-names></name><name><surname>Aleman</surname><given-names>JV</given-names></name><name><surname>Franconville</surname><given-names>R</given-names></name><name><surname>Rivera-Alba</surname><given-names>M</given-names></name><name><surname>Mensh</surname><given-names>BD</given-names></name><name><surname>Branson</surname><given-names>KM</given-names></name><name><surname>Simpson</surname><given-names>JH</given-names></name><name><surname>Truman</surname><given-names>JW</given-names></name><name><surname>Cardona</surname><given-names>A</given-names></name><name><surname>Zlatic</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>A multilevel multimodal circuit enhances action selection in <italic>Drosophila</italic></article-title><source>Nature</source><volume>520</volume><fpage>633</fpage><lpage>639</lpage><pub-id pub-id-type="doi">10.1038/nature14297</pub-id><pub-id pub-id-type="pmid">25896325</pub-id></element-citation></ref><ref id="bib114"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Olds</surname><given-names>J</given-names></name><name><surname>Milner</surname><given-names>P</given-names></name></person-group><year iso-8601-date="1954">1954</year><article-title>Positive reinforcement produced by electrical stimulation of septal area and other regions of rat brain</article-title><source>Journal of Comparative and Physiological Psychology</source><volume>47</volume><fpage>419</fpage><lpage>427</lpage><pub-id pub-id-type="doi">10.1037/h0058775</pub-id><pub-id pub-id-type="pmid">13233369</pub-id></element-citation></ref><ref id="bib115"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Owald</surname><given-names>D</given-names></name><name><surname>Waddell</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Olfactory learning skews mushroom body output pathways to steer behavioral choice in <italic>Drosophila</italic></article-title><source>Current Opinion in Neurobiology</source><volume>35</volume><fpage>178</fpage><lpage>184</lpage><pub-id pub-id-type="doi">10.1016/j.conb.2015.10.002</pub-id><pub-id pub-id-type="pmid">26496148</pub-id></element-citation></ref><ref id="bib116"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Park</surname><given-names>J</given-names></name><name><surname>Lee</surname><given-names>SB</given-names></name><name><surname>Lee</surname><given-names>S</given-names></name><name><surname>Kim</surname><given-names>Y</given-names></name><name><surname>Song</surname><given-names>S</given-names></name><name><surname>Kim</surname><given-names>S</given-names></name><name><surname>Bae</surname><given-names>E</given-names></name><name><surname>Kim</surname><given-names>J</given-names></name><name><surname>Shong</surname><given-names>M</given-names></name><name><surname>Kim</surname><given-names>JM</given-names></name><name><surname>Chung</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Mitochondrial dysfunction in <italic>Drosophila</italic> PINK1 mutants is complemented by parkin</article-title><source>Nature</source><volume>441</volume><fpage>1157</fpage><lpage>1161</lpage><pub-id pub-id-type="doi">10.1038/nature04788</pub-id><pub-id pub-id-type="pmid">16672980</pub-id></element-citation></ref><ref id="bib117"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Pavlov</surname><given-names>IP</given-names></name></person-group><year iso-8601-date="1927">1927</year><source>Conditioned Reflexes: An Investigation of the Physiological Activity of the Cerebral Cortex</source><publisher-name>Oxford University Press</publisher-name></element-citation></ref><ref id="bib118"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Perisse</surname><given-names>E</given-names></name><name><surname>Owald</surname><given-names>D</given-names></name><name><surname>Barnstedt</surname><given-names>O</given-names></name><name><surname>Talbot</surname><given-names>CB</given-names></name><name><surname>Huetteroth</surname><given-names>W</given-names></name><name><surname>Waddell</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Aversive learning and appetitive motivation toggle feed-forward inhibition in the <italic>Drosophila</italic> mushroom body</article-title><source>Neuron</source><volume>90</volume><fpage>1086</fpage><lpage>1099</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2016.04.034</pub-id><pub-id pub-id-type="pmid">27210550</pub-id></element-citation></ref><ref id="bib119"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pfeiffer</surname><given-names>BD</given-names></name><name><surname>Jenett</surname><given-names>A</given-names></name><name><surname>Hammonds</surname><given-names>AS</given-names></name><name><surname>Ngo</surname><given-names>TTB</given-names></name><name><surname>Misra</surname><given-names>S</given-names></name><name><surname>Murphy</surname><given-names>C</given-names></name><name><surname>Scully</surname><given-names>A</given-names></name><name><surname>Carlson</surname><given-names>JW</given-names></name><name><surname>Wan</surname><given-names>KH</given-names></name><name><surname>Laverty</surname><given-names>TR</given-names></name><name><surname>Mungall</surname><given-names>C</given-names></name><name><surname>Svirskas</surname><given-names>R</given-names></name><name><surname>Kadonaga</surname><given-names>JT</given-names></name><name><surname>Doe</surname><given-names>CQ</given-names></name><name><surname>Eisen</surname><given-names>MB</given-names></name><name><surname>Celniker</surname><given-names>SE</given-names></name><name><surname>Rubin</surname><given-names>GM</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Tools for neuroanatomy and neurogenetics in <italic>Drosophila</italic></article-title><source>PNAS</source><volume>105</volume><fpage>9715</fpage><lpage>9720</lpage><pub-id pub-id-type="doi">10.1073/pnas.0803697105</pub-id><pub-id pub-id-type="pmid">18621688</pub-id></element-citation></ref><ref id="bib120"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pfeiffer</surname><given-names>BD</given-names></name><name><surname>Ngo</surname><given-names>TTB</given-names></name><name><surname>Hibbard</surname><given-names>KL</given-names></name><name><surname>Murphy</surname><given-names>C</given-names></name><name><surname>Jenett</surname><given-names>A</given-names></name><name><surname>Truman</surname><given-names>JW</given-names></name><name><surname>Rubin</surname><given-names>GM</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Refinement of tools for targeted gene expression in <italic>Drosophila</italic></article-title><source>Genetics</source><volume>186</volume><fpage>735</fpage><lpage>755</lpage><pub-id pub-id-type="doi">10.1534/genetics.110.119917</pub-id><pub-id pub-id-type="pmid">20697123</pub-id></element-citation></ref><ref id="bib121"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Plaçais</surname><given-names>PY</given-names></name><name><surname>Trannoy</surname><given-names>S</given-names></name><name><surname>Friedrich</surname><given-names>AB</given-names></name><name><surname>Tanimoto</surname><given-names>H</given-names></name><name><surname>Preat</surname><given-names>T</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Two pairs of mushroom body efferent neurons are required for appetitive long-term memory retrieval in <italic>Drosophila</italic></article-title><source>Cell Reports</source><volume>5</volume><fpage>769</fpage><lpage>780</lpage><pub-id pub-id-type="doi">10.1016/j.celrep.2013.09.032</pub-id><pub-id pub-id-type="pmid">24209748</pub-id></element-citation></ref><ref id="bib122"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pulver</surname><given-names>SR</given-names></name><name><surname>Pashkovski</surname><given-names>SL</given-names></name><name><surname>Hornstein</surname><given-names>NJ</given-names></name><name><surname>Garrity</surname><given-names>PA</given-names></name><name><surname>Griffith</surname><given-names>LC</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Temporal dynamics of neuronal activation by channelrhodopsin-2 and TRPA1 determine behavioral output in <italic>Drosophila</italic> larvae</article-title><source>Journal of Neurophysiology</source><volume>101</volume><fpage>3075</fpage><lpage>3088</lpage><pub-id pub-id-type="doi">10.1152/jn.00071.2009</pub-id><pub-id pub-id-type="pmid">19339465</pub-id></element-citation></ref><ref id="bib123"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Reddy</surname><given-names>G</given-names></name><name><surname>Desban</surname><given-names>L</given-names></name><name><surname>Tanaka</surname><given-names>H</given-names></name><name><surname>Roussel</surname><given-names>J</given-names></name><name><surname>Mirat</surname><given-names>O</given-names></name><name><surname>Wyart</surname><given-names>C</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>A lexical approach for identifying behavioral action sequences: animal behavior and cognition</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/2020.08.27.270694</pub-id></element-citation></ref><ref id="bib124"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Redgrave</surname><given-names>P</given-names></name><name><surname>Vautrelle</surname><given-names>N</given-names></name><name><surname>Reynolds</surname><given-names>JNJ</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Functional properties of the basal ganglia’s re-entrant loop architecture: selection and reinforcement</article-title><source>Neuroscience</source><volume>198</volume><fpage>138</fpage><lpage>151</lpage><pub-id pub-id-type="doi">10.1016/j.neuroscience.2011.07.060</pub-id><pub-id pub-id-type="pmid">21821101</pub-id></element-citation></ref><ref id="bib125"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rescorla</surname><given-names>RA</given-names></name></person-group><year iso-8601-date="1988">1988</year><article-title>Behavioral studies of pavlovian conditioning</article-title><source>Annual Review of Neuroscience</source><volume>11</volume><fpage>329</fpage><lpage>352</lpage><pub-id pub-id-type="doi">10.1146/annurev.ne.11.030188.001553</pub-id><pub-id pub-id-type="pmid">3284445</pub-id></element-citation></ref><ref id="bib126"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Robertson</surname><given-names>JL</given-names></name><name><surname>Tsubouchi</surname><given-names>A</given-names></name><name><surname>Tracey</surname><given-names>WD</given-names></name><name><surname>Skoulakis</surname><given-names>EMC</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Larval defense against attack from parasitoid wasps requires nociceptive neurons</article-title><source>PLOS ONE</source><volume>8</volume><elocation-id>e78704</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0078704</pub-id><pub-id pub-id-type="pmid">24205297</pub-id></element-citation></ref><ref id="bib127"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Robie</surname><given-names>AA</given-names></name><name><surname>Hirokawa</surname><given-names>J</given-names></name><name><surname>Edwards</surname><given-names>AW</given-names></name><name><surname>Umayam</surname><given-names>LA</given-names></name><name><surname>Lee</surname><given-names>A</given-names></name><name><surname>Phillips</surname><given-names>ML</given-names></name><name><surname>Card</surname><given-names>GM</given-names></name><name><surname>Korff</surname><given-names>W</given-names></name><name><surname>Rubin</surname><given-names>GM</given-names></name><name><surname>Simpson</surname><given-names>JH</given-names></name><name><surname>Reiser</surname><given-names>MB</given-names></name><name><surname>Branson</surname><given-names>K</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Mapping the neural substrates of behavior</article-title><source>Cell</source><volume>170</volume><fpage>393</fpage><lpage>406</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2017.06.032</pub-id><pub-id pub-id-type="pmid">28709004</pub-id></element-citation></ref><ref id="bib128"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rohwedder</surname><given-names>A</given-names></name><name><surname>Wenz</surname><given-names>NL</given-names></name><name><surname>Stehle</surname><given-names>B</given-names></name><name><surname>Huser</surname><given-names>A</given-names></name><name><surname>Yamagata</surname><given-names>N</given-names></name><name><surname>Zlatic</surname><given-names>M</given-names></name><name><surname>Truman</surname><given-names>JW</given-names></name><name><surname>Tanimoto</surname><given-names>H</given-names></name><name><surname>Saumweber</surname><given-names>T</given-names></name><name><surname>Gerber</surname><given-names>B</given-names></name><name><surname>Thum</surname><given-names>AS</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Four individually identified paired dopamine neurons signal reward in larval <italic>Drosophila</italic></article-title><source>Current Biology</source><volume>26</volume><fpage>661</fpage><lpage>669</lpage><pub-id pub-id-type="doi">10.1016/j.cub.2016.01.012</pub-id><pub-id pub-id-type="pmid">26877086</pub-id></element-citation></ref><ref id="bib129"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Saumweber</surname><given-names>T</given-names></name><name><surname>Rohwedder</surname><given-names>A</given-names></name><name><surname>Schleyer</surname><given-names>M</given-names></name><name><surname>Eichler</surname><given-names>K</given-names></name><name><surname>Chen</surname><given-names>Y-C</given-names></name><name><surname>Aso</surname><given-names>Y</given-names></name><name><surname>Cardona</surname><given-names>A</given-names></name><name><surname>Eschbach</surname><given-names>C</given-names></name><name><surname>Kobler</surname><given-names>O</given-names></name><name><surname>Voigt</surname><given-names>A</given-names></name><name><surname>Durairaja</surname><given-names>A</given-names></name><name><surname>Mancini</surname><given-names>N</given-names></name><name><surname>Zlatic</surname><given-names>M</given-names></name><name><surname>Truman</surname><given-names>JW</given-names></name><name><surname>Thum</surname><given-names>AS</given-names></name><name><surname>Gerber</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Functional architecture of reward learning in mushroom body extrinsic neurons of larval <italic>Drosophila</italic></article-title><source>Nature Communications</source><volume>9</volume><elocation-id>1104</elocation-id><pub-id pub-id-type="doi">10.1038/s41467-018-03130-1</pub-id><pub-id pub-id-type="pmid">29549237</pub-id></element-citation></ref><ref id="bib130"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sawin-McCormack</surname><given-names>EP</given-names></name><name><surname>Sokolowski</surname><given-names>MB</given-names></name><name><surname>Campos</surname><given-names>AR</given-names></name></person-group><year iso-8601-date="1995">1995</year><article-title>Characterization and genetic analysis of <italic>Drosophila melanogaster</italic> photobehavior during larval development</article-title><source>Journal of Neurogenetics</source><volume>10</volume><fpage>119</fpage><lpage>135</lpage><pub-id pub-id-type="doi">10.3109/01677069509083459</pub-id><pub-id pub-id-type="pmid">8592272</pub-id></element-citation></ref><ref id="bib131"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Scherer</surname><given-names>S</given-names></name><name><surname>Stocker</surname><given-names>RF</given-names></name><name><surname>Gerber</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2003">2003</year><article-title>Olfactory learning in individually assayed <italic>Drosophila</italic> larvae</article-title><source>Learning &amp; Memory</source><volume>10</volume><fpage>217</fpage><lpage>225</lpage><pub-id pub-id-type="doi">10.1101/lm.57903</pub-id></element-citation></ref><ref id="bib132"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schlegel</surname><given-names>P</given-names></name><name><surname>Texada</surname><given-names>MJ</given-names></name><name><surname>Miroschnikow</surname><given-names>A</given-names></name><name><surname>Schoofs</surname><given-names>A</given-names></name><name><surname>Hückesfeld</surname><given-names>S</given-names></name><name><surname>Peters</surname><given-names>M</given-names></name><name><surname>Schneider-Mizell</surname><given-names>CM</given-names></name><name><surname>Lacin</surname><given-names>H</given-names></name><name><surname>Li</surname><given-names>F</given-names></name><name><surname>Fetter</surname><given-names>RD</given-names></name><name><surname>Truman</surname><given-names>JW</given-names></name><name><surname>Cardona</surname><given-names>A</given-names></name><name><surname>Pankratz</surname><given-names>MJ</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Synaptic transmission parallels neuromodulation in a central food-intake circuit</article-title><source>eLife</source><volume>5</volume><elocation-id>e16799</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.16799</pub-id><pub-id pub-id-type="pmid">27845623</pub-id></element-citation></ref><ref id="bib133"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schleyer</surname><given-names>M</given-names></name><name><surname>Saumweber</surname><given-names>T</given-names></name><name><surname>Nahrendorf</surname><given-names>W</given-names></name><name><surname>Fischer</surname><given-names>B</given-names></name><name><surname>von Alpen</surname><given-names>D</given-names></name><name><surname>Pauls</surname><given-names>D</given-names></name><name><surname>Thum</surname><given-names>A</given-names></name><name><surname>Gerber</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>A behavior-based circuit model of how outcome expectations organize learned behavior in larval <italic>Drosophila</italic></article-title><source>Learning &amp; Memory</source><volume>18</volume><fpage>639</fpage><lpage>653</lpage><pub-id pub-id-type="doi">10.1101/lm.2163411</pub-id><pub-id pub-id-type="pmid">21946956</pub-id></element-citation></ref><ref id="bib134"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schleyer</surname><given-names>M.</given-names></name><name><surname>Fendt</surname><given-names>M</given-names></name><name><surname>Schuller</surname><given-names>S</given-names></name><name><surname>Gerber</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Associative learning of stimuli paired and unpaired with reinforcement: evaluating evidence from maggots, flies, bees, and rats</article-title><source>Frontiers in Psychology</source><volume>9</volume><elocation-id>1494</elocation-id><pub-id pub-id-type="doi">10.3389/fpsyg.2018.01494</pub-id><pub-id pub-id-type="pmid">30197613</pub-id></element-citation></ref><ref id="bib135"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schroll</surname><given-names>C</given-names></name><name><surname>Riemensperger</surname><given-names>T</given-names></name><name><surname>Bucher</surname><given-names>D</given-names></name><name><surname>Ehmer</surname><given-names>J</given-names></name><name><surname>Völler</surname><given-names>T</given-names></name><name><surname>Erbguth</surname><given-names>K</given-names></name><name><surname>Gerber</surname><given-names>B</given-names></name><name><surname>Hendel</surname><given-names>T</given-names></name><name><surname>Nagel</surname><given-names>G</given-names></name><name><surname>Buchner</surname><given-names>E</given-names></name><name><surname>Fiala</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Light-Induced activation of distinct modulatory neurons triggers appetitive or aversive learning in <italic>Drosophila</italic> larvae</article-title><source>Current Biology</source><volume>16</volume><fpage>1741</fpage><lpage>1747</lpage><pub-id pub-id-type="doi">10.1016/j.cub.2006.07.023</pub-id><pub-id pub-id-type="pmid">16950113</pub-id></element-citation></ref><ref id="bib136"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schulze</surname><given-names>A</given-names></name><name><surname>Gomez-Marin</surname><given-names>A</given-names></name><name><surname>Rajendran</surname><given-names>VG</given-names></name><name><surname>Lott</surname><given-names>G</given-names></name><name><surname>Musy</surname><given-names>M</given-names></name><name><surname>Ahammad</surname><given-names>P</given-names></name><name><surname>Deogade</surname><given-names>A</given-names></name><name><surname>Sharpe</surname><given-names>J</given-names></name><name><surname>Riedl</surname><given-names>J</given-names></name><name><surname>Jarriault</surname><given-names>D</given-names></name><name><surname>Trautman</surname><given-names>ET</given-names></name><name><surname>Werner</surname><given-names>C</given-names></name><name><surname>Venkadesan</surname><given-names>M</given-names></name><name><surname>Druckmann</surname><given-names>S</given-names></name><name><surname>Jayaraman</surname><given-names>V</given-names></name><name><surname>Louis</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Dynamical feature extraction at the sensory periphery guides chemotaxis</article-title><source>eLife</source><volume>4</volume><elocation-id>e694</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.06694</pub-id></element-citation></ref><ref id="bib137"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schwaerzel</surname><given-names>M</given-names></name><name><surname>Monastirioti</surname><given-names>M</given-names></name><name><surname>Scholz</surname><given-names>H</given-names></name><name><surname>Friggi-Grelin</surname><given-names>F</given-names></name><name><surname>Birman</surname><given-names>S</given-names></name><name><surname>Heisenberg</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2003">2003</year><article-title>Dopamine and octopamine differentiate between aversive and appetitive olfactory memories in <italic>Drosophila</italic></article-title><source>The Journal of Neuroscience</source><volume>23</volume><fpage>10495</fpage><lpage>10502</lpage><pub-id pub-id-type="pmid">14627633</pub-id></element-citation></ref><ref id="bib138"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Séjourné</surname><given-names>J</given-names></name><name><surname>Plaçais</surname><given-names>PY</given-names></name><name><surname>Aso</surname><given-names>Y</given-names></name><name><surname>Siwanowicz</surname><given-names>I</given-names></name><name><surname>Trannoy</surname><given-names>S</given-names></name><name><surname>Thoma</surname><given-names>V</given-names></name><name><surname>Tedjakumala</surname><given-names>SR</given-names></name><name><surname>Rubin</surname><given-names>GM</given-names></name><name><surname>Tchénio</surname><given-names>P</given-names></name><name><surname>Ito</surname><given-names>K</given-names></name><name><surname>Isabel</surname><given-names>G</given-names></name><name><surname>Tanimoto</surname><given-names>H</given-names></name><name><surname>Preat</surname><given-names>T</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Mushroom body efferent neurons responsible for aversive olfactory memory retrieval in <italic>Drosophila</italic></article-title><source>Nature Neuroscience</source><volume>14</volume><fpage>903</fpage><lpage>910</lpage><pub-id pub-id-type="doi">10.1038/nn.2846</pub-id><pub-id pub-id-type="pmid">21685917</pub-id></element-citation></ref><ref id="bib139"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shyu</surname><given-names>WH</given-names></name><name><surname>Chiu</surname><given-names>TH</given-names></name><name><surname>Chiang</surname><given-names>MH</given-names></name><name><surname>Cheng</surname><given-names>YC</given-names></name><name><surname>Tsai</surname><given-names>YL</given-names></name><name><surname>Fu</surname><given-names>TF</given-names></name><name><surname>Wu</surname><given-names>T</given-names></name><name><surname>Wu</surname><given-names>CL</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Neural circuits for long-term water-reward memory processing in thirsty <italic>Drosophila</italic></article-title><source>Nature Communications</source><volume>8</volume><elocation-id>15230</elocation-id><pub-id pub-id-type="doi">10.1038/ncomms15230</pub-id><pub-id pub-id-type="pmid">28504254</pub-id></element-citation></ref><ref id="bib140"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Simpson</surname><given-names>JH</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Rationally subdividing the fly nervous system with versatile expression reagents</article-title><source>Journal of Neurogenetics</source><volume>30</volume><fpage>185</fpage><lpage>194</lpage><pub-id pub-id-type="doi">10.1080/01677063.2016.1248761</pub-id><pub-id pub-id-type="pmid">27846759</pub-id></element-citation></ref><ref id="bib141"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sitaraman</surname><given-names>D</given-names></name><name><surname>Zars</surname><given-names>M</given-names></name><name><surname>Laferriere</surname><given-names>H</given-names></name><name><surname>Chen</surname><given-names>YC</given-names></name><name><surname>Sable-Smith</surname><given-names>A</given-names></name><name><surname>Kitamoto</surname><given-names>T</given-names></name><name><surname>Rottinghaus</surname><given-names>GE</given-names></name><name><surname>Zars</surname><given-names>T</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Serotonin is necessary for place memory in <italic>Drosophila</italic></article-title><source>PNAS</source><volume>105</volume><fpage>5579</fpage><lpage>5584</lpage><pub-id pub-id-type="doi">10.1073/pnas.0710168105</pub-id><pub-id pub-id-type="pmid">18385379</pub-id></element-citation></ref><ref id="bib142"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Skeath</surname><given-names>JB</given-names></name><name><surname>Thor</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2003">2003</year><article-title>Genetic control of <italic>Drosophila</italic> nerve cord development</article-title><source>Current Opinion in Neurobiology</source><volume>13</volume><fpage>8</fpage><lpage>15</lpage><pub-id pub-id-type="doi">10.1016/s0959-4388(03)00007-2</pub-id><pub-id pub-id-type="pmid">12593977</pub-id></element-citation></ref><ref id="bib143"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Skinner</surname><given-names>BF</given-names></name></person-group><year iso-8601-date="1938">1938</year><source>The Behavior of Organisms: An Experimental Analysis</source><publisher-loc>NY</publisher-loc><publisher-name>Appleton-Century-Crofts</publisher-name></element-citation></ref><ref id="bib144"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Soares dos Santos</surname><given-names>MP</given-names></name><name><surname>Ferreira</surname><given-names>JAF</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Novel intelligent real-time position tracking system using fpga and fuzzy logic</article-title><source>ISA Transactions</source><volume>53</volume><fpage>402</fpage><lpage>414</lpage><pub-id pub-id-type="doi">10.1016/j.isatra.2013.09.003</pub-id><pub-id pub-id-type="pmid">24112645</pub-id></element-citation></ref><ref id="bib145"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stephens</surname><given-names>GJ</given-names></name><name><surname>Johnson-Kerner</surname><given-names>B</given-names></name><name><surname>Bialek</surname><given-names>W</given-names></name><name><surname>Ryu</surname><given-names>WS</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Dimensionality and dynamics in the behavior of <italic>C. elegans</italic></article-title><source>PLOS Computational Biology</source><volume>4</volume><elocation-id>e1000028</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1000028</pub-id><pub-id pub-id-type="pmid">18389066</pub-id></element-citation></ref><ref id="bib146"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stowers</surname><given-names>JR</given-names></name><name><surname>Hofbauer</surname><given-names>M</given-names></name><name><surname>Bastien</surname><given-names>R</given-names></name><name><surname>Griessner</surname><given-names>J</given-names></name><name><surname>Higgins</surname><given-names>P</given-names></name><name><surname>Farooqui</surname><given-names>S</given-names></name><name><surname>Fischer</surname><given-names>RM</given-names></name><name><surname>Nowikovsky</surname><given-names>K</given-names></name><name><surname>Haubensak</surname><given-names>W</given-names></name><name><surname>Couzin</surname><given-names>ID</given-names></name><name><surname>Tessmar-Raible</surname><given-names>K</given-names></name><name><surname>Straw</surname><given-names>AD</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Virtual reality for freely moving animals</article-title><source>Nature Methods</source><volume>14</volume><fpage>995</fpage><lpage>1002</lpage><pub-id pub-id-type="doi">10.1038/nmeth.4399</pub-id><pub-id pub-id-type="pmid">28825703</pub-id></element-citation></ref><ref id="bib147"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Straw</surname><given-names>AD</given-names></name><name><surname>Branson</surname><given-names>K</given-names></name><name><surname>Neumann</surname><given-names>TR</given-names></name><name><surname>Dickinson</surname><given-names>MH</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Dimensional tracking of multiple flying animals</article-title><source>Journal of the Royal Society Interface</source><volume>8</volume><fpage>395</fpage><lpage>409</lpage><pub-id pub-id-type="doi">10.1098/rsif.2010.0230</pub-id></element-citation></ref><ref id="bib148"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sun</surname><given-names>R</given-names></name><name><surname>Delly</surname><given-names>J</given-names></name><name><surname>Sereno</surname><given-names>E</given-names></name><name><surname>Wong</surname><given-names>S</given-names></name><name><surname>Chen</surname><given-names>X</given-names></name><name><surname>Wang</surname><given-names>Y</given-names></name><name><surname>Huang</surname><given-names>Y</given-names></name><name><surname>Greenspan</surname><given-names>RJ</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Anti-instinctive learning behavior revealed by locomotion-triggered mild heat stress in <italic>Drosophila</italic></article-title><source>Frontiers in Behavioral Neuroscience</source><volume>14</volume><elocation-id>41</elocation-id><pub-id pub-id-type="doi">10.3389/fnbeh.2020.00041</pub-id><pub-id pub-id-type="pmid">32372923</pub-id></element-citation></ref><ref id="bib149"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Swierczek</surname><given-names>NA</given-names></name><name><surname>Giles</surname><given-names>AC</given-names></name><name><surname>Rankin</surname><given-names>CH</given-names></name><name><surname>Kerr</surname><given-names>RA</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>High-throughput behavioral analysis in <italic>C. elegans</italic></article-title><source>Nature Methods</source><volume>8</volume><fpage>592</fpage><lpage>598</lpage><pub-id pub-id-type="doi">10.1038/nmeth.1625</pub-id><pub-id pub-id-type="pmid">21642964</pub-id></element-citation></ref><ref id="bib150"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tadres</surname><given-names>D</given-names></name><name><surname>Louis</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>PiVR: an affordable and versatile closed-loop platform to study unrestrained sensorimotor behavior</article-title><source>PLOS Biology</source><volume>18</volume><elocation-id>e3000712</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pbio.3000712</pub-id><pub-id pub-id-type="pmid">32663220</pub-id></element-citation></ref><ref id="bib151"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Takeda</surname><given-names>K</given-names></name></person-group><year iso-8601-date="1961">1961</year><article-title>Classical conditioned response in the honey bee</article-title><source>Journal of Insect Physiology</source><volume>6</volume><fpage>168</fpage><lpage>179</lpage><pub-id pub-id-type="doi">10.1016/0022-1910(61)90060-9</pub-id></element-citation></ref><ref id="bib152"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Thorndike</surname><given-names>EL</given-names></name></person-group><year iso-8601-date="1911">1911</year><source>Animal Intelligence; Experimental Studies</source><publisher-loc>New York</publisher-loc><publisher-name>The Macmillan company</publisher-name><pub-id pub-id-type="doi">10.5962/bhl.title.55072</pub-id></element-citation></ref><ref id="bib153"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tracey</surname><given-names>WD</given-names></name><name><surname>Wilson</surname><given-names>RI</given-names></name><name><surname>Laurent</surname><given-names>G</given-names></name><name><surname>Benzer</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2003">2003</year><article-title>Painless, a <italic>Drosophila</italic> gene essential for nociception</article-title><source>Cell</source><volume>113</volume><fpage>261</fpage><lpage>273</lpage><pub-id pub-id-type="doi">10.1016/s0092-8674(03)00272-1</pub-id><pub-id pub-id-type="pmid">12705873</pub-id></element-citation></ref><ref id="bib154"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tully</surname><given-names>T</given-names></name><name><surname>Cambiazo</surname><given-names>V</given-names></name><name><surname>Kruse</surname><given-names>L</given-names></name></person-group><year iso-8601-date="1994">1994</year><article-title>Memory through metamorphosis</article-title><source>Journal of Neuroscience</source><volume>14</volume><fpage>68</fpage><lpage>74</lpage></element-citation></ref><ref id="bib155"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Turner</surname><given-names>GC</given-names></name><name><surname>Bazhenov</surname><given-names>M</given-names></name><name><surname>Laurent</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Olfactory representations by <italic>Drosophila</italic> mushroom body neurons</article-title><source>Journal of Neurophysiology</source><volume>99</volume><fpage>734</fpage><lpage>746</lpage><pub-id pub-id-type="doi">10.1152/jn.01283.2007</pub-id><pub-id pub-id-type="pmid">18094099</pub-id></element-citation></ref><ref id="bib156"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Uzun</surname><given-names>IS</given-names></name><name><surname>Amira</surname><given-names>A</given-names></name><name><surname>Bouridane</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>FPGA implementations of fast fourier transforms for real-time signal and image processing</article-title><conf-name>IEE Proceedings - Vision, Image, and Signal Processing</conf-name><fpage>283</fpage><lpage>288</lpage><pub-id pub-id-type="doi">10.1049/ip-vis:20041114</pub-id></element-citation></ref><ref id="bib157"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Veeraraghavan</surname><given-names>A</given-names></name><name><surname>Chellappa</surname><given-names>R</given-names></name><name><surname>Srinivasan</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Shape-and-behavior encoded tracking of bee dances</article-title><source>IEEE Transactions on Pattern Analysis and Machine Intelligence</source><volume>30</volume><fpage>463</fpage><lpage>476</lpage><pub-id pub-id-type="doi">10.1109/TPAMI.2007.70707</pub-id><pub-id pub-id-type="pmid">18195440</pub-id></element-citation></ref><ref id="bib158"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vierock</surname><given-names>J</given-names></name><name><surname>Grimm</surname><given-names>C</given-names></name><name><surname>Nitzan</surname><given-names>N</given-names></name><name><surname>Hegemann</surname><given-names>P</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Molecular determinants of proton selectivity and gating in the red-light activated channelrhodopsin chrimson</article-title><source>Scientific Reports</source><volume>7</volume><elocation-id>9928</elocation-id><pub-id pub-id-type="doi">10.1038/s41598-017-09600-8</pub-id><pub-id pub-id-type="pmid">28855540</pub-id></element-citation></ref><ref id="bib159"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vinauger</surname><given-names>C</given-names></name><name><surname>Lutz</surname><given-names>EK</given-names></name><name><surname>Riffell</surname><given-names>JA</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Olfactory learning and memory in the disease vector mosquito Aedes aegypti</article-title><source>The Journal of Experimental Biology</source><volume>217</volume><fpage>2321</fpage><lpage>2330</lpage><pub-id pub-id-type="doi">10.1242/jeb.101279</pub-id><pub-id pub-id-type="pmid">24737761</pub-id></element-citation></ref><ref id="bib160"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vogelstein</surname><given-names>JT</given-names></name><name><surname>Park</surname><given-names>Y</given-names></name><name><surname>Ohyama</surname><given-names>T</given-names></name><name><surname>Kerr</surname><given-names>RA</given-names></name><name><surname>Truman</surname><given-names>JW</given-names></name><name><surname>Priebe</surname><given-names>CE</given-names></name><name><surname>Zlatic</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Discovery of brainwide neural-behavioral maps via multiscale unsupervised structure learning</article-title><source>Science</source><volume>344</volume><fpage>386</fpage><lpage>392</lpage><pub-id pub-id-type="doi">10.1126/science.1250298</pub-id><pub-id pub-id-type="pmid">24674869</pub-id></element-citation></ref><ref id="bib161"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vogt</surname><given-names>K</given-names></name><name><surname>Schnaitmann</surname><given-names>C</given-names></name><name><surname>Dylla</surname><given-names>KV</given-names></name><name><surname>Knapek</surname><given-names>S</given-names></name><name><surname>Aso</surname><given-names>Y</given-names></name><name><surname>Rubin</surname><given-names>GM</given-names></name><name><surname>Tanimoto</surname><given-names>H</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Shared mushroom body circuits underlie visual and olfactory memories in <italic>Drosophila</italic></article-title><source>eLife</source><volume>3</volume><elocation-id>e02395</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.02395</pub-id><pub-id pub-id-type="pmid">25139953</pub-id></element-citation></ref><ref id="bib162"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>von Essen</surname><given-names>AMHJ</given-names></name><name><surname>Pauls</surname><given-names>D</given-names></name><name><surname>Thum</surname><given-names>AS</given-names></name><name><surname>Sprecher</surname><given-names>SG</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Capacity of visual classical conditioning in <italic>Drosophila</italic> larvae</article-title><source>Behavioral Neuroscience</source><volume>125</volume><fpage>921</fpage><lpage>929</lpage><pub-id pub-id-type="doi">10.1037/a0025758</pub-id><pub-id pub-id-type="pmid">21967373</pub-id></element-citation></ref><ref id="bib163"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Waddell</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Reinforcement signalling in <italic>Drosophila</italic>; dopamine does it all after all</article-title><source>Current Opinion in Neurobiology</source><volume>23</volume><fpage>324</fpage><lpage>329</lpage><pub-id pub-id-type="doi">10.1016/j.conb.2013.01.005</pub-id><pub-id pub-id-type="pmid">23391527</pub-id></element-citation></ref><ref id="bib164"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wen</surname><given-names>JYM</given-names></name><name><surname>Kumar</surname><given-names>N</given-names></name><name><surname>Morrison</surname><given-names>G</given-names></name><name><surname>Rambaldini</surname><given-names>G</given-names></name><name><surname>Runciman</surname><given-names>S</given-names></name><name><surname>Rousseau</surname><given-names>J</given-names></name><name><surname>van der Kooy</surname><given-names>D</given-names></name></person-group><year iso-8601-date="1997">1997</year><article-title>Mutations that prevent associative learning in <italic>C. elegans</italic></article-title><source>Behavioral Neuroscience</source><volume>111</volume><fpage>354</fpage><lpage>368</lpage><pub-id pub-id-type="doi">10.1037/0735-7044.111.2.354</pub-id></element-citation></ref><ref id="bib165"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wolf</surname><given-names>R</given-names></name><name><surname>Heisenberg</surname><given-names>M</given-names></name></person-group><year iso-8601-date="1991">1991</year><article-title>Basic organization of operant behavior as revealed in <italic>Drosophila</italic> flight orientation</article-title><source>Journal of Comparative Physiology A</source><volume>169</volume><fpage>699</fpage><lpage>705</lpage><pub-id pub-id-type="doi">10.1007/BF00194898</pub-id><pub-id pub-id-type="pmid">1795235</pub-id></element-citation></ref><ref id="bib166"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wolf</surname><given-names>R</given-names></name><name><surname>Wittig</surname><given-names>T</given-names></name><name><surname>Liu</surname><given-names>L</given-names></name><name><surname>Wustmann</surname><given-names>G</given-names></name><name><surname>Eyding</surname><given-names>D</given-names></name><name><surname>Heisenberg</surname><given-names>M</given-names></name></person-group><year iso-8601-date="1998">1998</year><article-title><italic>Drosophila</italic> mushroom bodies are dispensable for visual, tactile, and motor learning</article-title><source>Learning &amp; Memory</source><volume>5</volume><fpage>166</fpage><lpage>178</lpage><pub-id pub-id-type="doi">10.1101/lm.5.1.166</pub-id><pub-id pub-id-type="pmid">10454381</pub-id></element-citation></ref><ref id="bib167"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wong</surname><given-names>AM</given-names></name><name><surname>Wang</surname><given-names>JW</given-names></name><name><surname>Axel</surname><given-names>R</given-names></name></person-group><year iso-8601-date="2002">2002</year><article-title>Spatial representation of the glomerular map in the <italic>Drosophila</italic> protocerebrum</article-title><source>Cell</source><volume>109</volume><fpage>229</fpage><lpage>241</lpage><pub-id pub-id-type="doi">10.1016/s0092-8674(02)00707-9</pub-id><pub-id pub-id-type="pmid">12007409</pub-id></element-citation></ref><ref id="bib168"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wu</surname><given-names>MC</given-names></name><name><surname>Chu</surname><given-names>LA</given-names></name><name><surname>Hsiao</surname><given-names>PY</given-names></name><name><surname>Lin</surname><given-names>YY</given-names></name><name><surname>Chi</surname><given-names>CC</given-names></name><name><surname>Liu</surname><given-names>TH</given-names></name><name><surname>Fu</surname><given-names>CC</given-names></name><name><surname>Chiang</surname><given-names>AS</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Optogenetic control of selective neural activity in multiple freely moving <italic>Drosophila</italic> adults</article-title><source>PNAS</source><volume>111</volume><fpage>5367</fpage><lpage>5372</lpage><pub-id pub-id-type="doi">10.1073/pnas.1400997111</pub-id></element-citation></ref><ref id="bib169"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yasukawa</surname><given-names>S</given-names></name><name><surname>Okuno</surname><given-names>H</given-names></name><name><surname>Ishii</surname><given-names>K</given-names></name><name><surname>Yagi</surname><given-names>T</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Real-Time object tracking based on scale-invariant features employing bio-inspired hardware</article-title><source>Neural Networks</source><volume>81</volume><fpage>29</fpage><lpage>38</lpage><pub-id pub-id-type="doi">10.1016/j.neunet.2016.05.002</pub-id><pub-id pub-id-type="pmid">27268260</pub-id></element-citation></ref><ref id="bib170"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zemelman</surname><given-names>BV</given-names></name><name><surname>Lee</surname><given-names>GA</given-names></name><name><surname>Ng</surname><given-names>M</given-names></name><name><surname>Miesenböck</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2002">2002</year><article-title>Selective photostimulation of genetically charged neurons</article-title><source>Neuron</source><volume>33</volume><fpage>15</fpage><lpage>22</lpage><pub-id pub-id-type="doi">10.1016/s0896-6273(01)00574-8</pub-id><pub-id pub-id-type="pmid">11779476</pub-id></element-citation></ref><ref id="bib171"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhang</surname><given-names>C</given-names></name><name><surname>Liang</surname><given-names>T</given-names></name><name><surname>Mok</surname><given-names>PKT</given-names></name><name><surname>Yu</surname><given-names>W</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>FPGA implementation of the coupled filtering method and the affine warping method</article-title><source>IEEE Transactions on Nanobioscience</source><volume>16</volume><fpage>314</fpage><lpage>325</lpage><pub-id pub-id-type="doi">10.1109/TNB.2017.2705104</pub-id><pub-id pub-id-type="pmid">28534779</pub-id></element-citation></ref></ref-list></back><sub-article article-type="editor-report" id="sa0"><front-stub><article-id pub-id-type="doi">10.7554/eLife.70015.sa0</article-id><title-group><article-title>Editor's evaluation</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Samuel</surname><given-names>Aravinthan DT</given-names></name><role specific-use="editor">Reviewing Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/03vek6s52</institution-id><institution>Harvard University</institution></institution-wrap><country>United States</country></aff></contrib></contrib-group><related-object id="sa0ro1" object-id-type="id" object-id="10.1101/2021.06.14.448341" link-type="continued-by" xlink:href="https://sciety.org/articles/activity/10.1101/2021.06.14.448341"/></front-stub><body><p>Since classic studies by Pavlov and Skinner about learning and memory in laboratory settings, the field has sought solid ways to use observable behaviors to illuminate how positive and negative reinforcement modulates stimulus-evoked behaviors. This valuable study by Croteau-Chonka et al., represents the latest modernization of such technology, judiciously targeting the highly quantifiable, real-time motor behaviors of the <italic>Drosophila</italic> larva to create a rigorous new paradigm for classical and operant conditioning. The small nervous system of the larva has few parallels for tractability in dissecting various neural mechanisms. What has been lacking, until now, is the technology needed to tackle the neural mechanisms of learning and memory in the maggot with rigorous, high-throughput, and real-time behavioral observations.</p></body></sub-article><sub-article article-type="decision-letter" id="sa1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.70015.sa1</article-id><title-group><article-title>Decision letter</article-title></title-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Samuel</surname><given-names>Aravinthan DT</given-names></name><role>Reviewing Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/03vek6s52</institution-id><institution>Harvard University</institution></institution-wrap><country>United States</country></aff></contrib></contrib-group></front-stub><body><boxed-text id="sa2-box1"><p>Our editorial process produces two outputs: (i) <ext-link ext-link-type="uri" xlink:href="https://sciety.org/articles/activity/10.1101/2021.06.14.448341">public reviews</ext-link> designed to be posted alongside <ext-link ext-link-type="uri" xlink:href="https://www.biorxiv.org/content/10.1101/2021.06.14.448341v1">the preprint</ext-link> for the benefit of readers; (ii) feedback on the manuscript for the authors, including requests for revisions, shown below. We also include an acceptance summary that explains what the editors found interesting or important about the work.</p></boxed-text><p><bold>Decision letter after peer review:</bold></p><p>Thank you for submitting your article &quot;Serotonergic neurons mediate operant conditioning in <italic>Drosophila</italic> larvae&quot; for consideration by <italic>eLife</italic>. Your article has been reviewed by 3 peer reviewers, and the evaluation has been overseen by a Reviewing Editor and K VijayRaghavan as the Senior Editor. The reviewers have opted to remain anonymous.</p><p>The reviewers have discussed their reviews with one another, and the Reviewing Editor has drafted this to help you prepare a revised submission.</p><p>Essential revisions:</p><p>1) Because the optogenetically induced operant learning has a modest effect, the Reviewers would like to see replication of operant conditioning using the thermogenetic paradigm (shown to be effective in Figure 2).</p><p>2) More rigorous analyses of the phenotype (e.g., showing pre and postbending behaviors, see Reviewer #1… additional statistical tests, see Reviewer #2… additional controls, see Reviewer #3).</p><p>3) All reviewers were concerned about the artificial nature of the US. If operant conditioning can be evoked with nociceptive pain, that would be great. If not, a more careful discussion of the limitations of using artificial stimuli in the interpretation and discussion would suffice.</p><p><italic>Reviewer #1 (Recommendations for the authors):</italic></p><p>Below I will list the criticism summarized in the previous section</p><p>1) To validate the set up the authors induce rolling behavior by thermo- or optogenetically activating two sets of previously described neurons in individual larva. Both approaches show convincing induction of the behavior per se. However, there seems to be an interaction of the different tools used (thermo and opto-genetic) and the targeted neurons: the authors observe different dynamics of the behavior across the three stimulation cycles depending on stimulation method and labeled neurons. These findings make it difficult to understand why the authors choose only the optogenetic activation to investigate operant conditioning. Thus, the authors should repeat key experiments using thermogenetic tools (see below).</p><p>2) The strength of the setup is that individual animals can be targeted. Though the presented data show that behavior can be reliably induced in stimulated animals, it lacks the information about the behavior of non-targeted larva during the stimulation. Thus, it would strengthen the work if the authors could show the behavior of the non-targeted larva during the time when targeted larva receive light or heat.</p><p>3) The origin of the relative difference between left and right bending in the paired group is not entirely clear. Thus, it will be important to strengthen the work by additional experiments investigating temporal relationship between the CS and US. Ideally the experiments should focus on understanding why the training results in a reduction of the unreinforced behavior.</p><p>4) The authors should consider that given the small effects, it has to be ensured that the observed differences originate from training and are not mere pre-training biases. Though they show the pretraining results for one of the experiments (Figure 3b, the trained group), the pretraining bending is very relevant for each of the operant learning experiments. In fact, training induced effects should not only be measured by looking at the left vs right bending in the final test but as a change between pre versus post or between a trained and a mock control group. This is done for one group (Ddc-GAL4) in Figure 3b but will be mandatory for all operant learning experiments.</p><p>5) It would improve the accessibility of the learning induced change of behavior if the authors could show the pre vs post training results for each run (10-12 larva in a plate). Further, they should plot the numbers of reinforced behaviors in each of the training protocols and relate it to the test performance.</p><p>6) The presented data clearly suggests a decrease of the unstimulated bending rather than a change in the reinforced behavior. Though the authors mention it, they do not explain or discuss it. It will be very important for the logic of the manuscript that the authors explain this phenomenon and how it relates to operant conditioning (see point 3).</p><p>7) Though the manuscript discusses most of the data carefully, in my view the authors miss an important issue: it remains to be shown if fly larva are capable of operant learning using external reward or punishment. The presented evidence is based on artificial activation of neurons, which arguably is a hint but not a prove that operant conditioning is withing the repertoire of a fly larva, an issue the authors should mention and discuss.</p><p><italic>Reviewer #2 (Recommendations for the authors):</italic></p><p>In addition to the points raised in the public review:</p><p>– In figure 2, I was surprised to see that the responses elicited by the same Gal4 are so different when stimulated optogenetically or thermogenetically for both lines. Can the authors try to give an explanation?</p><p>– I am intrigued by what would be the US under natural conditions. In the discussion the authors say that they did not manage to condition the larvae using sugar sensing neurons, could it be that in <italic>Drosophila</italic> larvae operant conditioning only works for sensory signals imputing directly to the VNC? Have they tried conditioning the larvae by associating one side bending with optogenetic activation of noxious stimuli (without eliciting rolling)? It might be good to expand in the discussion on the expected sensory nature of US enabling operant conditioning.</p><p><italic>Reviewer #3 (Recommendations for the authors):</italic></p><p>The introduction is an excellent description of the central question – can <italic>Drosophila</italic> larvae undergo operant conditioning and if so, what neural circuits enable it? The background for the types of learning, the known and possible circuit mechanisms, and the advantages of the model system, are beautifully described (easily Review-caliber) allowing diverse readers to engage with the paper.</p><p>To conduct operant learning experiments, new hardware and software were required. Tracking multiple larva, identifying their behaviors, and applying rewarding or punishing stimuli through optogenetic activation of neurons – all in real-time – is a tour de force. Again, the descriptions of the key hardware innovation (the field-programable gate arrays) and the advances in machine learning enabling rapid behavior detection are very nicely done.</p><p>Line 210: Good control showing that the IR laser activates Trp but not pain-induced rolling. (The thermogenetic activation isn't really key to the later experiments, though…)</p><p>Recommended Revisions:</p><p>The experiments are solid and rigorously done. Most of the issues can be resolved with text clarification or additional discussion.</p><p>The best interpretation of the behaviors induced by expression in many dopaminergic and serotoninergic neurons is unclear: different neurons can have local functions – sometimes conflicting ones – so I am surprised that a very broad driver like DDC doesn't set up conflicting or non-specific reinforcement. I am also amazed that the timing works – a reward right after the bend could generate a different association than a potential punishment right before it. The interval between bends and the timing of the optogenetic reinforcement (assumed to be positive) relative to those bends should be discussed.</p><p>How many behavioral actions do you miss applying reward or punishment to? There are multiple larvae on the plate, and the bends must be detected and then the larva targeted – when you look at the videos later, what fraction of the bends that occur during the training periods were successfully reinforced?</p><p>How was the training regimen selected? What about a longer, continuous period – or shorter breaks? Was there a minimum number of reinforced bends that had to occur to include a larva in the subsequent evaluation? Was the possibility that the un-reinforced epochs in the training regime result in forgetting (or learning that action does not reliably produce reward) considered?</p><p>Important missing control: There have been reports that the UAS-Chrimson can have some basal/leak expression. What does the attP2&gt;Chrimson + retinal control look like in the biasing for bend direction experiments (Figure 3B)? Even a low level of expression could serve as a reward and so this control should be tested. (The uncorrelated light control is also good, but does not rule out contribution from activation of non-serotonergic neurons.)</p><p>line 289 (and line 395): The use of necessity and sufficiency is a little confusing here. These are all ectopic manipulations. Optogenetic activation of all dopaminergic and serotoneric neurons (expressing DDC-GAL4, UAS-Chrimson) is capable of inducing increased bending. Activation of dopaminergic and serotonergic neurons in the brain alone (DDC-GAL4, UAS-Chrimson, tsh-LexA, LexOp-GAL80) does not. We don't know much about how these neurons contribute to normal operant conditioning, just that the ones in the VNC seem to be the critical ones for the optogenetic effect. It could be said that activation of serotonergic VNC neurons is sufficient to induce the optogenetic effect – but I would avoid any speculation of actual necessity. (line 375 described operant conditioning as &quot;impaired&quot; which is also confusing. The artificial operant conditions failed when VNC serotonergic neurons were not included. That is not the same thing.) line 413: optogenetic activation CAN serve, not DOES serve…. This all may be a difference of word use conventions among research studying learned vs. innate behaviors, but given the discussion about value of these terms (Gomez-Marin 2017, Yoshihara and Yoshihara 2018), it might be good to maximize clarity here.</p><p>Operant conditioning is measured as an increase in number of bends per minute or in the probability of bending toward the rewarded side. These are not directly comparable metrics to the performance index used in classical conditioning, but the operant effects, while statistically significant, seem very small (eg. Figure 4b vs. d). Is this an accurate observation and is there a useful contrast proposed?</p><p>I found the shifts between dopaminergic and serotonergic neurons, and between classical and operant conditioning experiments, a little challenging to follow. Please consider clarifying how the classical conditioning experiments contribute to the focus of this research that is suggested by the title – serotonergic neurons capable of operant conditioning. (Since it is clear early on that operant and classical conditioning are achieved by different neurons, it is not logical that the classical conditioning screen for subsets of dopaminergic or serotonergic neurons would turn up any useful candidates for dissecting operant circuits.)</p><p>The Tsh-LexA, lexOp-GAL80 combination should reference Simpson 2016 J Neurogenetics; only the Tsh-GAL80 was published in Clyne and Miesenbock. The Tsh-LexA, lexOp-flp, UAS&gt;stop&gt;Chrimson combination, the otd-Flp (Asahina et al., 2014), or the Trh-DBD+Tsh-AD (Albin et al., 2015) present possible options for positive intersection with serotonergic neurons in the VNC or the brain.</p><p>Suggestions for future experiments (not required):</p><p>Line 256: These larvae don't show innate bend direction preference. Out of curiosity, would it be possible to try this on DeBivort's turn preference-prone (handed) animals? Is it easier to train toward an existing bias or totally distinct? would this help identify shared/distinct circuit contributions?</p><p>What happens to the larval bend rates and direction preference if you silence serotonergic neurons? Are they learning anything by their normal crawling actions? Is there a paradigm where operant learning might occur in a more natural or beneficial context? The experiments described here show that larvae are capable of it in a highly artificial setting – which is certainly cool – but provide no clues about what larva might be using this capacity for in their normal lives…</p><p>What about removing or silencing the MBs altogether and seeing if you can still optogenetically induce operant conditioning? That would be a pretty nice way to show that not all roads lead to MBs!</p></body></sub-article><sub-article article-type="reply" id="sa2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.70015.sa2</article-id><title-group><article-title>Author response</article-title></title-group></front-stub><body><disp-quote content-type="editor-comment"><p>Essential revisions:</p><p>1) Because the optogenetically induced operant learning has a modest effect, the Reviewers would like to see replication of operant conditioning using the thermogenetic paradigm (shown to be effective in Figure 2).</p></disp-quote><p>In order to address this comment, we first characterised in more detail the temporal profile of heating with the IR laser beam. To verify the speed with which the IR beam heated up individual animals we installed a heat camera on the setup. Using the heat camera, we found that the time to heat up the animal to the desired 30<sup>o</sup>C is 4s. The heat camera performed closed-loop adjustments of laser intensity to maintain the desired temperature at each larval location.</p><p>While larvae were heated to the right temperature relatively quickly and with predictable timing relative to IR light trigger (within 4s), the delay between trigger and thermogenetic stimulation was much slower than for optogenetic stimulation (which is virtually instantaneous). Since the average duration of a larval bend is only a third of that time (mean=1.35s, sd=1.67s, n=4622 bends), thermogenetic activation is too slow to be used in closed-loop during operant conditioning. By the time the fictive reward would be activated, the animal could be performing a completely different action, which could interfere with the formation of an association with the preceding action.</p><p>A second important methodological consideration was the risk of establishing conflicting valence signals. We wanted to avoid mixing punishment (via IR-induced tissue heating) with reward (via IR-induced activation of Ddc neurons) during training. With mild heat more aversive (induces more bending in control animals) to larvae than visible red light (compare bending in <italic>attp2</italic> control larvae in Figure 2D and 2E), we favoured optogenetics over thermogenetics for the operant conditioning paradigm.</p><p>We therefore decided against trying to replicate the operant conditioning experiments using thermogenetic stimulation.</p><p>We have added new Figure 2 —figure supplement 1 and the following new sections in the Results explaining these points:</p><p>“The methodological choice of optogenetics was informed, in part, by a deeper investigation of larval heating dynamics as they relate to average bend duration. We determined that our IR stimulation hardware takes approximately 4s to heat larval tissue to the nearly 30<sup>o</sup>C required for dTrpA1 channel activation (Figure 2 —figure supplement 1; see also Materials and methods). Knowing that the average duration of a larval bend is only a third of that time (mean=1.35s, sd=1.67s, n=4622 bends), we concluded that closed-loop heat stimulation would activate neurons of interest only after a noticeable delay relative to behaviour detection, with possibly other behaviours occurring during the delay period. Such a task in which different behaviours are occurring prior to reinforcement could be very difficult to learn. Quicker heating was achievable with increased laser intensity, but such an approach risked overshooting the desired temperature and damaging larval tissue. Any safe thermogenetic approach would therefore be too slow to temporally align the US induced via larval heating with a specific larval action. A second important methodological consideration was the risk of establishing conflicting valence signals. We wanted to avoid mixing punishment (via IR-induced tissue heating) with reward (via IR-induced activation of Ddc neurons) during training. With mild heat more aversive to larvae than visible red light (compare bedning in control larvae in Figure 2D and 2E), we favoured optogenetics over thermogenetics for our operant conditioning paradigm.”</p><p>However, we do agree that replicating the operant learning experiments in a different way is important.</p><p>To address this point and the point about needing the effector control (from Reviewer 3), we therefore reproduced the operant learning experiment using optogenetic activation, but on a different, low-throughput, single-animal tracker (Schulze et al., 2015).</p><p>As before, we found that pairing optogenetic activation of dopaminergic and serotonergic neurons (Ddc-GAL&gt;UAS-CsChrimson larvae) with a specific bend direction resulted in a significant increase in bends/min towards the stimulated side relative to the unstimulated side, after training, but not before. This indicates operant learning has occurred (Figure 4—figure supplement 3d).</p><p>In contrast, there was no significant increase in bends/min towards the stimulated side relative to the unstimulated side, neither after, nor before training in the UAS-CsChrimson effector control larvae (Figure 4—figure supplement 3e). These results show that putative leaky CsChrimson expression in some unknown neurons is not sufficient to induce operant learning.</p><p>Furthermore, after training, there was a significant difference in Δ bend/min between Ddc-GAL4&gt;UAS-CsChrimson and the UAS-CsChrimson larvae (Figure 4—figure supplement 3f). This confirms that optogenetic activation of Ddc serotonergic and dopaminergic neurons can induce operant learning.</p><p>We have added new Figure 4 —figure supplement 3 with these results and a new section in the Results:</p><p>“We also used a previously developed low-throughput single-larva closed-loop tracking system to test the reproducibility of this result on a different system (see Materials and methods for more details, Schulze et al., 2015). Fictive Ddc activation with this low-throughput system also yielded a significant bend direction preference to the previously stimulated (mean=5.77, sd=2.71, n=109) versus previously unstimulated (mean=4.73, sd=2.73, n=109) side (p=.0043), after training. These results contrast those of effector control larvae that had the UAS-CsChrimson transgene but not the Ddc-GAL4. The control larvae show no difference in bend rate to either side after training. Based on these control larvae, we concluded that potential basal expression of CsChrimson in neurons outside of the Ddc expression pattern is not causing operant learning (Figure 4 —figure supplement 3).”</p><p>Finally, we note that, while thermogenetic activation is not fast enough for closed-loop operant conditioning, it is well suited for open-loop experiments and for combining thermogenetic with optigenetic activation. Since the timing between triggering and heating is constant and predictable (4s) it is possible to design classical conditioning experiments with desired CS-US timing intervals.</p><p>Our prior version of the manuscript did not demonstrate the usefulness of our new IR thermogenetic stimulation module for classical conditioning paradigms. We wanted to address this point by combining both fictive thermogenetic and optogenetic activation to demonstrate a previously unknown form of classical conditioning in larvae.</p><p>Trace conditioning has been demonstrated in adult <italic>Drosophila</italic> (Galili et al., 2011) but whether or not larvae can associate a CS with a US when there is a significant temporal gap between CS offset and US onset was previously unknown. We therefore trained larvae using a trace conditioning paradigm in which we combined fictive odour (optogenetic activation of Or42b) with fictive noxious stimulus (thermogenetic activation of the nociceptive and mechanosensory Basin neurons) with a 9s gap between CS offset and US onset. In these experiments, we triggered IR light 5s after the offset of red light for optogenetic stimulation and it took a further 4s to reach the appropriate 30<sup>o</sup>C for thermogenetic activation of Basins.</p><p>In this way, we demonstrate for the first time that larvae are capable of trace conditioning (i.e. associating a CS with a US after a 9s temporal gap between the CS offset and US onset).</p><p>We have added a new Figure 3 and a new section entitled “Aversion to fictive Or42b develops after forward-paired trace conditioning” that demonstrate trace-conditioning using optogenetic odour and thermogenetic noxious stimulation.</p><p>“Having verified the efficacy of optogenetic and thermogenetic stimulation in our system, we first studied whether these methods could be used to train larvae in a previously unexplored classical conditioning task that requires precise temporal control of both CS and US. […] These results show that our tracker can be used to perform automated, high-throughput classical conditioning in <italic>Drosophila</italic> larvae. To the best of our knowledge, these results also provide the first evidence that larvae can perform classical conditioning with significant (9s) offset-to-onset gaps between stimuli (i.e. trace conditioning).”</p><disp-quote content-type="editor-comment"><p>2) More rigorous analyses of the phenotype (e.g., showing pre and postbending behaviors, see Reviewer #1… additional statistical tests, see Reviewer #2… additional controls, see Reviewer #3).</p></disp-quote><p>We have expanded Figures 4c-f and 5a-c to show bend/min towards the stimulated and unstimulated side and compute the difference between them and test whether this difference is significant (using two-sided Wilcoxon signed-rank test), both before and after training, for all genotypes and all conditions. We also compare (using a two-sided Mann-Whitney U test, with Bonferroni correction) the difference in bends/min towards the stimulated and unstimulated side (Δ bends/min), after training, between experimental and control groups (Figures 4h and 5d), as suggested by the Reviewers.</p><p>Pairing optogenetic activation of dopaminergic and serotonergic (Ddc-GAL&gt;UAS-CsChrimson larvae, Figures 4c) or just serotonergic neurons (Tph-GAL4&gt;UAS-CsChrimson, Figure 5a) with a specific bend direction, resulted in a significant increase in bends/min towards the stimulated side relative to the unstimulated side, after training, but not before. These results suggest that pairing a specific bend direction with the activation of serotonergic and dopaminergic neurons together, or serotonergic neurons alone, induces operant learning.</p><p>For all other genotypes there was no significant difference in bends/min to the stimulated, compared to the unstimulated side, neither before, nor after training. Thus, pairing the activation of only brain dopaminergic and sertotonergic (Ddc-GAL4&gt;UAS-CsChrimson, teashirt-GAL80, Figure 4e), only MB dopaminergic neurons (58E02-GAL4&gt;UAS-CsChrimson, Figures 4f), only dopaminergic neurons (TH-GAL4&gt;CsChrimson, Figure 5b), or only brain serotonergic neurons (Tph-GAL4&gt;UAS-CsChrimson, teashirt-GAL80, Figure 5c) with a specific bend direction did not result in a significant difference in bend direction between the stimulated and the unstimulated side, neither before, nor after training. These results indicate that none of these neuronal subsets alone were sufficient to induce operant learning. Since all of these genotypes contained the UAS-CsChrimson transgene, these results further suggest that any putative leaky basal CsChrimson expression in some unknown neurons is not sufficient to induce operant learning.</p><p>Similarly, the yoked control larvae (Ddc-GAL4&gt;UAS-CsChrimson, Figure 4d) in which optogenetic activation of dopaminergic and serotonergic neurons was not paired with a specific bend direction did not result in a significant difference in bend direction between the stimulated and the unstimulated side, neither before, nor after training. This shows that simply optogenetic activation of dopaminergic and serotonergic neurons unpaired with bend does not bias bend direction.</p><p>We also compared Δ bends/min after training between the experimental and control genotypes conditions and found they were significantly different.</p><p>Thus, after training, there was a significant difference in Δ bend/min between</p><p>– the Ddc-GAL4&gt;UAS-CsChrimson and the Ddc-GAL4&gt;UAS-CsChrimson, teashirt-GAL80 (Figure4h).</p><p>– the Ddc-GAL4&gt;UAS-CsChrimson and the 58E02-GAL4&gt;UAS-CsChrimson (Figure 4h).</p><p>– the Ddc-GAL4&gt;UAS-CsChrimson paired larvae and the yoked controls (Figure 4h).</p><p>– the Tph-GAL4&gt;UAS-CsChrimson and the Tph-GAL4&gt;UAS-CsChrimson, teashirt-GAL80 (Figure 5d).</p><p>These results are consistent with the idea that only the complete set of serotonergic neurons is sufficient to induce operant learning. In the absence of activation of, either all serotonergic, or just nerve cord serotonergic neurons, we did not observe operant learning.</p><p>Finally, we also added the additional control, together with demonstrating the reproducibility of operant learning on a different, low-throughput, single-larva tracker (Schulze et al., 2015). We have paired a specific bend direction with red light, either in the Ddc-GAL4&gt;UAS-CsChrimson larvae, or in larvae in which UAS-CsChrimson was present, but Ddc-GAL4 was absent (Figure 4–figure supplement 3).</p><p>As before, we found that pairing optogenetic activation of dopaminergic and serotonergic neurons (Ddc-GAL&gt;UAS-CsChrimson larvae) with a specific bend direction resulted in a significant increase in bends/min towards the stimulated, relative to the unstimulated side, after training, but not before, indicating operant learning has occurred (Figure 4–figure supplement 3d).</p><p>In contrast, there was no significant increase in bends/min towards the stimulated, relative to the unstimulated side, neither after, nor before training in the UAS-CsChrimson control larvae (Figure 4–figure supplement 3e). These results further support the idea that any putative leaky basal CsChrimson expression in some unknown neurons, is not sufficient to induce operant learning.</p><p>Furthermore, after training, there was a significant difference in Δ bend/min between Ddc-GAL4&gt;UAS-CsChrimson and the UAS-CsChrimson larvae (Figure 4–figure supplement 3f). This confirms that optogenetic activation of Ddc serotonergic and dopaminergic neurons can induce operant learning.</p><p>These results and quantifications are shown in the new Figure 4–figure supplement 3.</p><disp-quote content-type="editor-comment"><p>3) All reviewers were concerned about the artificial nature of the US. If operant conditioning can be evoked with nociceptive pain, that would be great. If not, a more careful discussion of the limitations of using artificial stimuli in the interpretation and discussion would suffice.</p></disp-quote><p>To address this point, we attempted preliminary experiments, either with noxious heat (data not shown) or with optoegentic activation of MD class IV neurons (targeted by the ppk-Gal4 driver, preliminary data not shown ) during bends to one side to see whether these neurons could evoke aversive operant learning. We were unable to elicit an operant learning effect in these pilot experiments, as evidenced by no significant difference in bend rate between the previously stimulated and unstimulated sides, after training (preliminary data not shown ). We cannot exclude that trying a range of different stimulation and training conditions with nociceptive heat or with optogenetic activation of MD class IV neurons could give operant aversive learning in the future, but it was beyond the scope of this study to explore this.</p><p>We have therefore added new sentences in the Discussion stating the limitations of artificial stimuli:“It will also be important to determine whether conditioning with a fictive odour stimulus changes larval responses to natural odours. For example, larvae showing reduced attraction to Or42b activation may show reduced attraction to natural odours that activate Or42b neurons (e. g. ethyl acetate)”</p><p>“There are limitations to interpreting behaviour following fictive neuronal activation. It will therefore be important to replicate the new paradigms developed with this rig using lower-throughput methods with natural stimuli. For example, one might modify our multi-larva tracker to accommodate closed-loop presentation of real, innately appetitive gustatory stimuli by using closed-loop control of microfluidic devices”</p><disp-quote content-type="editor-comment"><p>Reviewer #1 (Recommendations for the authors):</p><p>Below I will list the criticism summarized in the previous section</p><p>1) To validate the set up the authors induce rolling behavior by thermo- or optogenetically activating two sets of previously described neurons in individual larva. Both approaches show convincing induction of the behavior per se. However, there seems to be an interaction of the different tools used (thermo and opto-genetic) and the targeted neurons: the authors observe different dynamics of the behavior across the three stimulation cycles depending on stimulation method and labeled neurons. These findings make it difficult to understand why the authors choose only the optogenetic activation to investigate operant conditioning. Thus, the authors should repeat key experiments using thermogenetic tools (see below).</p></disp-quote><p>In order to address this comment, we first characterised in more detail the temporal profile of heating with the IR laser beam. To verify the speed with which the IR beam heated up individual animals, we installed a heat camera on the setup. Using the camera, we found that the time to heat the animal to the desired 30<sup>o</sup>C is 4s. The heat camera performed closed-loop adjustments of laser intensity to maintain the desired temperature at each larva.</p><p>While larvae were heated to 30<sup>o</sup>C relatively quickly and with predictable timing relative to IR trigger (within 4s), the delay between trigger and thermogenetic stimulation (which occurs once 30<sup>o</sup>C is reached) was greater than for optogenetic stimulation (which is virtually instantaneous). Since the average duration of a larval bend is only a third of that time (mean=1.35s, sd=1.67s, n=4622 bends), thermogenetic activation is too slow to be used in closed-loop during operant conditioning. By the time the reward neurons would be activated, the animal could be performing a completely different action, which could interfere with the formation of an association with the preceding action.</p><p>A second important methodological consideration was the risk of establishing conflicting valence signals. We wanted to avoid mixing punishment (via IR-induced tissue heating) with reward (via IR-induced activation of Ddc neurons) during training. With mild heat more aversive (induces more bending) to larvae than visible red light (compare bending in <italic>attp2</italic> control larvae in Figure 2D and 2E), we favoured optogenetics over thermogenetics for appetitive operant conditioning.</p><p>We therefore decided not to replicate the operant conditioning experiments using thermogenetics.</p><p>We have added new Figure 2 —figure supplement 1 and the following new sections in the Results explaining these points:</p><p>“The methodological choice of optogenetics was informed, in part, by a deeper investigation of larval heating dynamics as they relate to average bend duration. […] With mild heat more aversive to larvae than visible red light (compare bedning in control larvae in Figure 2D and 2E), we favoured optogenetics over thermogenetics for our operant conditioning paradigm.”</p><p>However, we agree that replicating the operant learning experiments in a different way is important. To address this point, we reproduced the operant learning experiment using optogenetic activation on a different, low-throughput, single-animal tracker (Schulze et al., 2015). Using this system we paired specific bend direction with red light, either in <italic>Ddc-GAL4, UAS-CsChrimson</italic> larvae, or in the effector control larvae that had the <italic>UAS-CsChrimson</italic> transgene but not the <italic>Ddc-GAL4</italic>. Pairing of Ddc activation with a specific bend direction on this low-throughput system also yielded a significant bend direction preference to the previously stimulated relative to the previously unstimulated side (p=.0043), after training. The effector control larvae showed no difference in bend rate to either side, after training. Based on these control larvae, we concluded that any putative basal expression of CsChrimson in neurons outside of the Ddc expression pattern cannot induce operant learning.</p><p>We have added new Figure 4 —figure supplement 3 with these results and a new paragraph in the Results section entitled “Operant conditioning of larval bend direction”:</p><p>“We also used a previously developed, low-throughput, single-larva, closed-loop tracking system to test the reproducibility of this result on a different system (see Materials and methods for more details, Schulze et al., 2015). Fictive Ddc activation with this system also yielded a significant bend direction preference to the previously stimulated (mean=5.77, sd=2.71, n=109) versus previously unstimulated (mean=4.73, sd=2.73, n=109) side (p=.0043), after training. These results contrast those of effector control larvae that had the UAS-CsChrimson transgene but not the Ddc-GAL4. The control larvae showed no difference in bend rate to either side after training. Based on these control larvae, we concluded that any potential leaky expression of CsChrimson in neurons outside of the Ddc expression pattern is not causing operant learning (Figure 4 —figure supplement 3).”</p><p>Finally, we note that, while thermogenetic activation is not fast enough for closed-loop operant conditioning, it is well suited for open-loop applications in combination with optigenetic activation. Since the timing between triggering and heating is predictable (4s), it is possible to design classical conditioning experiments with desired CS-US timing intervals.</p><p>Our prior version of the manuscript did not demonstrate the usefulness of our new IR thermogenetic stimulation module for classical conditioning paradigms. We, therefore, wanted to address this point by combining both fictive thermogenetic and optogenetic activation to demonstrate a previously unknown form of classical conditioning in larvae.</p><p>Trace conditioning has been demonstrated in adult <italic>Drosophila</italic> (Galili et al., 2011), but whether or not larvae can associate a CS with a US when there is a significant temporal gap between CS offset and US onset, was previously unknown. We therefore trained larvae using a trace conditioning paradigm in which we combined fictive odour (optogenetic activation of Or42b) with a fictive noxious stimulus (thermogenetic activation of the nociceptive and mechanosensory Basin neurons) with a 9s gap between CS offset and US onset. In these experiments, we triggered IR light 5s after the offset of red light for optogenetic stimulation and it took a further 4s to reach the appropriate 30<sup>o</sup>C for thermogenetic activation of Basins.</p><p>We found that larvae were capable of trace conditioning (associating a CS with a US after a 9s temporal gap between CS offset and US onset).</p><p>We have added the new Figure 3 and the new section entitled “Aversion to fictive Or42b develops after forward-paired trace conditioning” that demonstrate trace-conditioning using optogenetic odour and thermogenetic noxious stimulation.</p><p>“Having verified the efficacy of optogenetic and thermogenetic stimulation in our system, we first studied whether these methods could be used to train larvae in a previously unexplored classical conditioning task that requires precise temporal control of both CS and US. […] These results show that our tracker can be used to perform automated, high-throughput classical conditioning in <italic>Drosophila</italic> larvae. To the best of our knowledge, these results also provide the first evidence that larvae can perform classical conditioning with significant (9s) offset-to-onset gaps between stimuli (i.e. trace conditioning).”</p><disp-quote content-type="editor-comment"><p>2) The strength of the setup is that individual animals can be targeted. Though the presented data show that behavior can be reliably induced in stimulated animals, it lacks the information about the behavior of non-targeted larva during the stimulation. Thus, it would strengthen the work if the authors could show the behavior of the non-targeted larva during the time when targeted larva receive light or heat.</p></disp-quote><p>In the proof-of-principle experiments, all larvae receive light or heat during the 5 sec of open-loop stimulation. In other words, there do not exist non-targeted larvae at the same time as targeted larvae. However, we have expanded the time frame for which we show data in the Figure 2 to include times when the stimulus is <italic>off</italic>. This highlights baseline larval behaviour in the absence of fictive stimuli. We now show rolling, bending, and crawling before, during and after stimulation.</p><disp-quote content-type="editor-comment"><p>3) The origin of the relative difference between left and right bending in the paired group is not entirely clear. Thus, it will be important to strengthen the work by additional experiments investigating temporal relationship between the CS and US. Ideally the experiments should focus on understanding why the training results in a reduction of the unreinforced behavior.</p></disp-quote><p>It is difficult to perform operant conditioning with a range of temporal gaps between CS and US because many different behaviours can happen during the gap. We think these experiments are beyond the scope of this already large study. However, in classical conditioning it is well established that a significant learning score can result, either from a change in preference for the paired odour, or for the unpaired odour, or both (see e.g. Eschbach et al., Nature neuroscience. 2020, Extended Data Figure 2).</p><disp-quote content-type="editor-comment"><p>4) The authors should consider that given the small effects, it has to be ensured that the observed differences originate from training and are not mere pre-training biases. Though they show the pretraining results for one of the experiments (Figure 3b, the trained group), the pretraining bending is very relevant for each of the operant learning experiments. In fact, training induced effects should not only be measured by looking at the left vs right bending in the final test but as a change between pre versus post or between a trained and a mock control group. This is done for one group (Ddc-GAL4) in Figure 3b but will be mandatory for all operant learning experiments.</p></disp-quote><p>We have expanded Figures 4c-f and 5a-c to show bend/min towards the stimulated and unstimulated side and compute the difference between them and test whether this difference is significant (using two-sided Wilcoxon signed-rank test), both before and after training, for all genotypes and all conditions. We also compare (using a two-sided Mann-Whitney U test, with Bonferroni correction) the difference in bends/min towards the stimulated and unstimulated side (Δ bends/min), after training, between experimental and control groups (Figures 4h and 5d), as suggested by the Reviewer.</p><p>Pairing optogenetic activation of dopaminergic and serotonergic (Ddc-GAL&gt;UAS-CsChrimson larvae, Figures 4c) or just serotonergic neurons (Tph-GAL4&gt;UAS-CsChrimson, Figure 5a) with a specific bend direction, resulted in a significant increase in bends/min towards the stimulated side relative to the unstimulated side, after training, but not before. These results suggest that pairing a specific bend direction with the activation of serotonergic and dopaminergic neurons together, or serotonergic neurons alone, induces operant learning.</p><p>For all other genotypes there was no significant difference in bends/min to the stimulated, compared to the unstimulated side, neither before, nor after training. Thus, pairing the activation of only brain dopaminergic and sertotonergic (Ddc-GAL4&gt;UAS-CsChrimson, teashirt-GAL80, Figure 4e), only MB dopaminergic neurons (58E02-GAL4&gt;UAS-CsChrimson, Figures 4f), only dopaminergic neurons(TH-GAL4&gt;CsChrimson, Figure 5b), or only brain serotonergic neurons (Tph-GAL4&gt;UAS-CsChrimson, teashirt-GAL80, Figure 5c) with a specific bend direction did not result in a significant difference in bend direction between the stimulated and the unstimulated side, neither before, nor after training. These results indicate that none of these neuronal subsets alone were sufficient to induce operant learning.</p><p>Since all of these genotypes contained the UAS-CsChrimson transgene, these results further suggest that any putative leaky basal CsChrimson expression in some unknown neurons is not sufficient to induce operant learning.</p><p>Similarly, the yoked control larvae (Ddc-GAL4&gt;UAS-CsChrimson, Figure 4d) in which optogenetic activation of dopaminergic and serotonergic neurons was not paired with a specific bend direction did not result in a significant difference in bend direction between the stimulated and the unstimulated side, neither before, nor after training. This shows that simply optogenetic activation of dopaminergic and serotonergic neurons unpaired with bend does not bias bend direction.</p><p>We also compared Δ bends/min after training between the experimental and control genotypes and conditions and found that they were significantly different.</p><p>Thus, after training, there was a significant difference in Δ bend/min between</p><p>– the Ddc-GAL4&gt;UAS-CsChrimson and the Ddc-GAL4&gt;UAS-CsChrimson, teashirt-GAL80 (Figure 4h).</p><p>– the Ddc-GAL4&gt;UAS-CsChrimson and the 58E02-GAL4&gt;UAS-CsChrimson (Figure 4h).</p><p>– the Ddc-GAL4&gt;UAS-CsChrimson paired larvae and the yoked controls (Figure 4h).</p><p>– the Tph-GAL4&gt;UAS-CsChrimson and the Tph-GAL4&gt;UAS-CsChrimson, teashirt-GAL80 (Figure 5d).</p><p>These results are consistent with the idea that only the complete set of serotonergic neurons is sufficient to induce operant learning. In the absence of activation of, either all serotonergic neurons, or just nerve cord serotonergic neurons, we did not observe operant learning.</p><p>Finally, to demonstrate the reproducibility of operant learning, we also repeated the learning experiments on a different, low-throughput, single-larva tracker (Schulze et al., 2015) by pairing a specific bend direction with red light, either in the Ddc-GAL4&gt;UAS-CsChrimson larvae, or in larvae in which UAS-CsChrimson was present but Ddc-GAL4 was absent (Figure 4–figure supplement 3).</p><p>As before, we found that pairing optogenetic activation of dopaminergic and serotonergic neurons (Ddc-GAL&gt;UAS-CsChrimson larvae) with a specific bend direction, resulted in a significant increase in bends/min towards the stimulated side relative to the unstimulated side, after training, but not before, indicating operant learning has occurred (Figure 4–figure supplement 3d).</p><p>In contrast, there was no significant increase in bends/min towards the stimulated side relative to the unstimulated side, neither after, nor before training in the UAS-CsChrimson effector control larvae (Figure 4–figure supplement 3e). These results further support the idea that any putative leaky basal CsChrimson expression in some unknown neurons is not sufficient to induce operant learning.</p><p>Furthermore, after training, there was a significant difference in Δ bend/min between Ddc-GAL4&gt;UAS-CsChrimson and the UAS-CsChrimson control larvae (Figure 4–figure supplement 3f). This confirms that optogenetic activation of Ddc serotonergic and dopaminergic neurons can induce operant learning.</p><p>These results and quantifications are shown in the new Figure 4–figure supplement 3.</p><disp-quote content-type="editor-comment"><p>5) It would improve the accessibility of the learning induced change of behavior if the authors could show the pre vs post training results for each run (10-12 larva in a plate). Further, they should plot the numbers of reinforced behaviors in each of the training protocols and relate it to the test performance.</p></disp-quote><p>We performed a per-run analysis on the multi-larva Ddc data. Average sample size, per run was 5 animals, so we can’t run statistics on this basis. To address the suggestion of plotting the number of reinforced behaviours in each training protocol and relate it to test performance, we have included the new Figure 4 – Supplement 2 that shows the full experiment data for each genotype in Figure 4. This full data includes all training windows in between the tests.</p><disp-quote content-type="editor-comment"><p>6) The presented data clearly suggests a decrease of the unstimulated bending rather than a change in the reinforced behavior. Though the authors mention it, they do not explain or discuss it. It will be very important for the logic of the manuscript that the authors explain this phenomenon and how it relates to operant conditioning (see point 3).</p></disp-quote><p>In the last paragraph of the Results section titled “Fictive reward can facilitate operant conditioning of larval bend direction”, we further discuss the observed result in the context of existing evidence for absence learning in larval classical conditioning.</p><p>“Further dissection of bend rates to each side showed that, after training, bend rates averaged together for larvae that received uncorrelated training (mean=4.80, sd=2.39, n=160) were indistinguishable from the rate of pair-trained larvae bending to the previously stimulated side (mean=4.84, sd=2.40, n=143) (p&gt;.5; Figure 4G). However, larvae that received uncorrelated training showed a significantly higher bend rate (mean=4.80, sd=2.39, n=160) compared to pair-trained larvae bending to the previously unstimulated side (mean=4.10, sd=2.23, n=143) (p=.0037, CLES=.58; Figure 4G). This suggests that the pair-trained Ddc&gt;CsChrimson larvae have learnt to avoid the unstimulated side. There is growing evidence from classical conditioning that larvae can learn that an unpaired CSpredicts the absence of reinforcement (Schleyer et al., 2018; Eschbach et al., 2020). Perhaps larvae are also forming memories of opposite valence in our operant conditioning paradigm, bending less to the unstimulated side because bending to that predicts the absence of appetitive Ddc activation.”</p><disp-quote content-type="editor-comment"><p>7) Though the manuscript discusses most of the data carefully, in my view the authors miss an important issue: it remains to be shown if fly larva are capable of operant learning using external reward or punishment. The presented evidence is based on artificial activation of neurons, which arguably is a hint but not a prove that operant conditioning is withing the repertoire of a fly larva, an issue the authors should mention and discuss.</p></disp-quote><p>We have added new sentences in the Discussion stating the limitations of artificial stimuli:</p><p>“It will also be important to determine whether conditioning with a fictive odour stimulus changes larval responses to natural odours. For example, larvae showing reduced attraction to Or42b activation may show reduced attraction to natural odours that activate Or42b neurons (e. g. ethyl acetate)”</p><p>“There are limitations to interpreting behaviour following fictive neuronal activation. It will therefore be important to replicate the new paradigms developed with this rig using lower-throughput methods with natural stimuli. For example, one might modify our multi-larva tracker to accommodate closed-loop presentation of real, innately appetitive gustatory stimuli by using closed-loop control of microfluidic devices”</p><disp-quote content-type="editor-comment"><p>Reviewer #2 (Recommendations for the authors):</p><p>In addition to the points raised in the public review:</p><p>– In figure 2, I was surprised to see that the responses elicited by the same Gal4 are so different when stimulated optogenetically or thermogenetically for both lines. Can the authors try to give an explanation?</p></disp-quote><p>The finding that different activators have different effects on the levels and dynamics of behaviour evoked could, in part, be explained by the different biophysical properties of these channels. The amount of current that enters, saturation kinetics and the duration of channel opening are all likely different. This could influence the probability and duration of each action.</p><p>By fitting a heating camera onto our system, we also show that thermogenetic activation is slower than optogenetic and different rates of activation could also influence the behavioural response.</p><p>Additionally, the sensory modality used to activate the neurons (light or mild heat) could interact with the pathways that are being activated linearly or non-linearly, resulting in distinct probability and dynamics of behaviour. For example, the increased bending in control animals (attp2&gt;CsChrimson), in response to IR stimulation compared to red light stimulation, suggests that mild heat is more aversive.</p><p>We have added a paragraph in the Results section entitled “Proof-of-principle experiments verify multi-larva training rig's stimulation efficiency” discussing some of these possibilities:</p><p>“The quantitative difference in these rolling responses compared to optogenetic activation of the same Gal4 drivers (Figure 2D) is not surprising. These effects are likely mediated by differing biophysical properties of CsChrimson and dTrpA1 channels including single channel conductance and open state lifetime (Pulver et al., 2009, Vierock et al., 2017). In further contrast to the proof-of-principle optogenetic experiments, the slower kinetics of tissue heating caused a ca. 4-5s second temporal delay between stimulus onset and behaviour onset (Figure 2E).”</p><p>And</p><p>“The high bending frequency of attP2&gt;dTrpA1 control larvae during IR-induced stimulation is likely indicative of mild heat aversion.”</p><disp-quote content-type="editor-comment"><p>– I am intrigued by what would be the US under natural conditions. In the discussion the authors say that they did not manage to condition the larvae using sugar sensing neurons, could it be that in <italic>Drosophila</italic> larvae operant conditioning only works for sensory signals imputing directly to the VNC? Have they tried conditioning the larvae by associating one side bending with optogenetic activation of noxious stimuli (without eliciting rolling)? It might be good to expand in the discussion on the expected sensory nature of US enabling operant conditioning.</p></disp-quote><p>This is a very interesting idea, but the identity of teste-sensing neurons that may project to the VNC (maybe a subset of external sensory neurons) is not known. In order to look for sensory modalities that mediate reward signals in both operant and classical conditioning in <italic>Drosophila</italic> larvae, further systematic functional characterisation of individual peripheral sensory neurons is required, as well as the development of appropriate GAL4 lines for specific subsets.</p><p>We have elaborated on this point in the Discussion section entitled “Automated operant conditioning of <italic>Drosophila</italic> larvae” and suggested mechanisms by which it can be explored in the future:</p><p>“It is noteworthy that Nuwal et al., 2012 used optogenetic activation of sugar-sensing neurons to establish a walking direction preference in adult <italic>Drosophila</italic>. Although we were unsuccessful in using a similar US to condition larval bend direction (data not shown), our Ddc and Tph results suggest that other sensory rewards may mediate operant conditioning if the information retrieval occurs within the VNC itself. Investigating <italic>FoxP</italic> and <italic>pkc</italic> expression in larval neurons may aid in identifying candidate neuronal populations, given both genes' involvement in operant self-learning in adult <italic>Drosophila</italic> (Mendoza et al., 2014, Brembs and Plnendl 2008, Colomb and Brembs 2016).”</p><p>Finally, we had also performed preliminary experiments in which nociceptive MD class IV neurons targeted by the ppk-Gal4 driver were optogenetically activated during bends to one side to see whether these neurons could evoke aversive operant learning. We were unable to elicit an operant learning effect in these pilot experiments, as evidenced by no significant difference in bend rate between the previously stimulated and unstimulated sides after training (preliminary data not shown ). We cannot exclude that trying a range of different stimulation and training conditions with MD class IV neurons could give a positive result in the future, but it was beyond the scope of this study to explore this.</p><disp-quote content-type="editor-comment"><p>Reviewer #3 (Recommendations for the authors):</p><p>Recommended Revisions:</p><p>The experiments are solid and rigorously done. Most of the issues can be resolved with text clarification or additional discussion.</p><p>The best interpretation of the behaviors induced by expression in many dopaminergic and serotoninergic neurons is unclear: different neurons can have local functions – sometimes conflicting ones – so I am surprised that a very broad driver like DDC doesn't set up conflicting or non-specific reinforcement. I am also amazed that the timing works – a reward right after the bend could generate a different association than a potential punishment right before it. The interval between bends and the timing of the optogenetic reinforcement (assumed to be positive) relative to those bends should be discussed.</p></disp-quote><p>Within the Materials and methods section under “High-throughput closed-loop tracker &gt; Optogenetic stimulation”, we had written “Because the LabVIEW application updated DMD projections at 20 Hz, the delay between behaviour detection and closed-loop optogenetic stimulation of individual larvae did not exceed 50 ms<italic>.</italic>” There was no additional delay added into the protocol. We have now added an additional sentence, below, to clarify this point within the Results section entitled “<italic>Operant conditioning of larval bend direction</italic>”:</p><p>“The time between the tracker detecting a left bend and light onset was no longer than 50ms.”</p><disp-quote content-type="editor-comment"><p>How many behavioral actions do you miss applying reward or punishment to? There are multiple larvae on the plate, and the bends must be detected and then the larva targeted – when you look at the videos later, what fraction of the bends that occur during the training periods were successfully reinforced?</p></disp-quote><p>As part of system development, we manually validated behaviour classifier performance. Within Table 1 (see Materials and methods), we show recall and precision values for several behaviours including bending. Bending recall with our software is 96.4%. We can therefore expect that 96.4% of all bends were detected and 3.6% were false negatives. The precision is 95.6%, i.e. 4.4% of detected bends were false positives. When correct bends were detected (i.e. true positives), the accuracy of left vs. right bending detection was 97.3%. In other words, only 2.7% of correctly identified bends were classified with the incorrect bending direction.</p><disp-quote content-type="editor-comment"><p>How was the training regimen selected? What about a longer, continuous period – or shorter breaks? Was there a minimum number of reinforced bends that had to occur to include a larva in the subsequent evaluation? Was the possibility that the un-reinforced epochs in the training regime result in forgetting (or learning that action does not reliably produce reward) considered?</p></disp-quote><p>This is a very interesting point and worth exploring in the future. We tried very few training regimens and since we obtained promising results, we continued to use the same protocol. We chose 4x3 min training rounds as we expected to get ca. 20 reinforced bends in that time period. There is a lot of scope for trying many different training regimens in the future. In particular, increasing the number of reinforced bends could yield better learning.</p><p>We do agree larvae could be extinguishing the memory in between training rounds. We introduced these breaks because we wanted to re-center the larvae that crawled to the edges. If some other method were used to prevent larvae from crawling to the edge, then these breaks could be omitted.</p><p>In this study, we did not select larvae for analysis based on a minimum number of reinforced bends during training, although this could be a good idea for future studies.</p><disp-quote content-type="editor-comment"><p>Important missing control: There have been reports that the UAS-Chrimson can have some basal/leak expression. What does the attP2&gt;Chrimson + retinal control look like in the biasing for bend direction experiments (Figure 3B)? Even a low level of expression could serve as a reward and so this control should be tested. (The uncorrelated light control is also good, but does not rule out contribution from activation of non-serotonergic neurons.)</p></disp-quote><p>To address this point and the point about the need to reproduce our results in a different way, we reproduced the operant learning experiment using optogenetic activation on a different, low-throughput, single-animal tracker (Schulze et al., 2015). Using this system we paired specific bend direction with red light, either in <italic>Ddc-GAL4, UAS-CsChrimson</italic> larvae, or in the effector control larvae that had the <italic>UAS-CsChrimson</italic> transgene but not the <italic>Ddc-GAL4</italic> (Figure 4—figure supplement 3).</p><p>As before, we found that pairing optogenetic activation of dopaminergic and serotonergic neurons (Ddc-GAL&gt;UAS-CsChrimson larvae) with a specific bend direction resulted in a significant increase in bends/min towards the stimulated side relative to the unstimulated side, after training, but not before, indicating operant learning has occurred (Figure 4–figure supplement 3d).</p><p>In contrast, there was no significant increase in bends/min towards the stimulated side relative to the unstimulated side, neither after, nor before training in the UAS-CsChrimson effector control larvae (Figure 4–figure supplement 3e). These results support the idea that any putative leaky CsChrimson expression in some unknown neurons is not sufficient to induce operant learning.</p><p>Furthermore, after training, there was a significant difference in Δ bend/min between Ddc-GAL4&gt;UAS-CsChrimson and the UAS-CsChrimson larvae (Figure 4–figure supplement 3f). This confirms our finding that optogenetic activation of Ddc serotonergic and dopaminergic neurons can induce operant learning.</p><p>We have added new Figure 4 – figure supplement 3 with these results and a new section in the Results:</p><p>“We also used a previously developed, low-throughput, single-larva, closed-loop tracking system to test the reproducibility of this result on a different system (see Materials and methods for more details, Schulze et al., 2015). Fictive Ddc activation with this system also yielded a significant bend direction preference to the previously stimulated (mean=5.77, sd=2.71, n=109) versus previously unstimulated (mean=4.73, sd=2.73, n=109) side (p=.0043), after training. These results contrast those of control larvae that had the UAS-CsChrimson transgene but not the Ddc-GAL4. The effector control larvae show no bend prefference to either side after training. Based on these control larvae, we concluded that potential basal expression of CsChrimson in neurons outside of the Ddc expression pattern is not causing operant learning (Figure 4 —figure supplement 3).”</p><p>Finally, we also note that, only pairing of optogenetic activation of dopaminergic and serotonergic (Ddc-GAL&gt;UAS-CsChrimson larvae, Figure 4c and Figure 4 —figure supplement 3d) or just serotonergic neurons (Tph-GAL4&gt;UAS-CsChrimson, Figure 5a) with a specific bend direction, resulted in a significant increase in bends/min towards the stimulated side relative to the unstimulated side, after training, but not before.</p><p>For all other genotypes there was no significant difference in bends/min to the stimulated, compared to the unstimulated side, neither before, nor after training. Thus, pairing the activation of only brain dopaminergic and sertotonergic (Ddc-GAL4&gt;UAS-CsChrimson, teashirt-GAL80, Figure 4e), only MB dopaminergic neurons (58E02-GAL4&gt;UAS-CsChrimson, Figures 4f), only dopaminergic neurons (TH-GAL4&gt;CsChrimson, Figure 5b), or only brain serotonergic neurons (Tph-GAL4&gt;UAS-CsChrimson, teashirt-GAL80, Figure 5c) with a specific bend direction did not result in a significant difference in bend direction between the stimulated and the unstimulated side, neither before, nor after training. These results indicate that none of these neuronal subsets alone were sufficient to induce operant learning. Since all of these genotypes contained the UAS-CsChrimson transgene, these results further suggest that any putative leaky CsChrimson expression in some unknown neurons is not sufficient to induce operant learning.</p><p>We also compared Δ bends/min after training between the experimental and control genotypes conditions and found they were significantly different.</p><p>Thus, after training, there was a significant difference in Δ bend/min between</p><p>– the Ddc-GAL4&gt;UAS-CsChrimson and the Ddc-GAL4&gt;UAS-CsChrimson, teashirt-GAL80 (Figure 4h).</p><p>– the Ddc-GAL4&gt;UAS-CsChrimson and the 58E02-GAL4&gt;UAS-CsChrimson (Figure 4h).</p><p>– the Ddc-GAL4&gt;UAS-CsChrimson paired larvae and the yoked controls (Figure 4h).</p><p>– the Tph-GAL4&gt;UAS-CsChrimson and the Tph-GAL4&gt;UAS-CsChrimson, teashirt-GAL80 (Figure 5d).</p><p>These results are consistent with the idea that only the complete set of serotonergic neurons is sufficient to induce operant learning. In the absence of activation of either all serotonergic neurons, or just nerve cord serotonergic neurons, we did not observe operant learning.</p><disp-quote content-type="editor-comment"><p>line 289 (and line 395): The use of necessity and sufficiency is a little confusing here. These are all ectopic manipulations. Optogenetic activation of all dopaminergic and serotoneric neurons (expressing DDC-GAL4, UAS-Chrimson) is capable of inducing increased bending. Activation of dopaminergic and serotonergic neurons in the brain alone (DDC-GAL4, UAS-Chrimson, tsh-LexA, LexOp-GAL80) does not. We don't know much about how these neurons contribute to normal operant conditioning, just that the ones in the VNC seem to be the critical ones for the optogenetic effect. It could be said that activation of serotonergic VNC neurons is sufficient to induce the optogenetic effect – but I would avoid any speculation of actual necessity. (line 375 described operant conditioning as &quot;impaired&quot; which is also confusing. The artificial operant conditions failed when VNC serotonergic neurons were not included. That is not the same thing.) line 413: optogenetic activation CAN serve, not DOES serve…. This all may be a difference of word use conventions among research studying learned vs. innate behaviors, but given the discussion about value of these terms (Gomez-Marin 2017, Yoshihara and Yoshihara 2018), it might be good to maximize clarity here.</p></disp-quote><p>We agree with these suggestions and have rephrased the relevant sections of the paper accordingly.</p><p>In response to the comment, we no longer state that our results “highlighted the necessity of dopaminergic or serotonergic neurons in the VNC for the formation of a bend direction preference”.</p><p>Instead, we now say that “dopaminergic and serotonergic neurons in the VNC appear critical to the bend direction preference formed following paired optogenetic activation of all Ddc neurons”. This new text can be found on line 425-426 of the new submission.</p><p>We have also changed the focus of our discussion of serotonergic neurons in the VNC and operant conditioning. We no longer state that “activation of the brain and SEZ is sufficient for classical conditioning, whereas the VNC is necessary for operant conditioning”.</p><p>Instead, we say that “Future experiments exclusively targeting a single serotonerig neuron per VNC hemisegment could be valuable in determining whether they are sufficient for operant learning.” This new text can be found on line 484-485 of the new submission.</p><disp-quote content-type="editor-comment"><p>Operant conditioning is measured as an increase in number of bends per minute or in the probability of bending toward the rewarded side. These are not directly comparable metrics to the performance index used in classical conditioning, but the operant effects, while statistically significant, seem very small (eg. Figure 4b vs. d). Is this an accurate observation and is there a useful contrast proposed?</p></disp-quote><p>We do agree that operant learning seems weaker in this case than classical conditioning. This could be a true limitation of the operant learning circuits compared to classical conditioning ones in the larva. Alternatively, it could be due the vast accumulated experience in the field about the best stimulation protocols and conditions for classical conditioning. It is likely that by exploring many different operant protocols in the future, far stronger learning could be induced.</p><disp-quote content-type="editor-comment"><p>I found the shifts between dopaminergic and serotonergic neurons, and between classical and operant conditioning experiments, a little challenging to follow. Please consider clarifying how the classical conditioning experiments contribute to the focus of this research that is suggested by the title – serotonergic neurons capable of operant conditioning. (Since it is clear early on that operant and classical conditioning are achieved by different neurons, it is not logical that the classical conditioning screen for subsets of dopaminergic or serotonergic neurons would turn up any useful candidates for dissecting operant circuits.)</p></disp-quote><p>We agree with this point. To address it, we have removed the manual classical conditioning screen experiments from the paper to reduce confusion. Instead, we have replaced them with a demonstration of a novel form of classical conditioning using our automated tracking system. This also addresses the flaw in the prior version that no real use was demonstrated for the combination of thermogenetic and optogenetic stimulation modules in learning.</p><p>We have adjusted the focus of the manuscript to highlight the advantages of our novel high-throughput multi-larva training system in demonstrating two new subtypes of associative learning in larvae: trace conditioning and operant learning.</p><p>We have added the new Figure 3 and the new section entitled: “Aversion to fictive Or42b develops after forward-paired trace conditioning”.</p><p>“Having verified the efficacy of optogenetic and thermogenetic stimulation in our system, we first studied whether these methods could be used to train larvae in a previously unexplored classical conditioning task that requires precise temporal control of both CS and US. […] These results show that our tracker can be used to perform automated, high-throughput classical conditioning in <italic>Drosophila</italic> larvae. To the best of our knowledge, these results also provide the first evidence that larvae can perform classical conditioning with significant (9s) offset-to-onset gaps between stimuli (i.e. trace conditioning).”</p><disp-quote content-type="editor-comment"><p>The Tsh-LexA, lexOp-GAL80 combination should reference Simpson 2016 J Neurogenetics; only the Tsh-GAL80 was published in Clyne and Miesenbock.</p></disp-quote><p>The Simpson 2016 J Neurogenetics reference has now been included in the text. Specifically, we now say that “[we] took an intersectional approach by targeting these transgenes with the LexA/LexAop binary system (Simpson, 2016) and expressing CsChrimson in Ddc neurons using Gal4/UAS”. This text can be found on line 409 of the new submission..</p></body></sub-article></article>