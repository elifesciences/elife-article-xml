<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.1 20151215//EN"  "JATS-archivearticle1.dtd"><article article-type="research-article" dtd-version="1.1" xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn pub-type="epub" publication-format="electronic">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">59630</article-id><article-id pub-id-type="doi">10.7554/eLife.59630</article-id><article-categories><subj-group subj-group-type="display-channel"><subject>Research Article</subject></subj-group><subj-group subj-group-type="heading"><subject>Computational and Systems Biology</subject></subj-group></article-categories><title-group><article-title>Removing unwanted variation with CytofRUV to integrate multiple CyTOF datasets</article-title></title-group><contrib-group><contrib contrib-type="author" corresp="yes" id="author-191097"><name><surname>Trussart</surname><given-names>Marie</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-7258-7272</contrib-id><email>trussart.m@wehi.edu.au</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-191099"><name><surname>Teh</surname><given-names>Charis E</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-9745-2876</contrib-id><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="other" rid="fund4"/><xref ref-type="other" rid="fund5"/><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-191100"><name><surname>Tan</surname><given-names>Tania</given-names></name><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="other" rid="fund3"/><xref ref-type="fn" rid="con3"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-191101"><name><surname>Leong</surname><given-names>Lawrence</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="other" rid="fund6"/><xref ref-type="fn" rid="con4"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-191102"><name><surname>Gray</surname><given-names>Daniel HD</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-8457-8242</contrib-id><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="other" rid="fund2"/><xref ref-type="other" rid="fund3"/><xref ref-type="fn" rid="con5"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-69563"><name><surname>Speed</surname><given-names>Terence P</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-5403-7998</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con6"/><xref ref-type="fn" rid="conf1"/></contrib><aff id="aff1"><label>1</label><institution>Bioinformatics Division, Walter and Eliza Hall Institute of Medical Research</institution><addr-line><named-content content-type="city">Parkville</named-content></addr-line><country>Australia</country></aff><aff id="aff2"><label>2</label><institution>School of Mathematics and Statistics, The University of Melbourne</institution><addr-line><named-content content-type="city">Melbourne</named-content></addr-line><country>Australia</country></aff><aff id="aff3"><label>3</label><institution>The Walter and Eliza Hall Institute of Medical Research</institution><addr-line><named-content content-type="city">Parkville</named-content></addr-line><country>Australia</country></aff><aff id="aff4"><label>4</label><institution>Department of Medical Biology, The University of Melbourne</institution><addr-line><named-content content-type="city">Parkville</named-content></addr-line><country>Australia</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="senior_editor"><name><surname>Weigel</surname><given-names>Detlef</given-names></name><role>Senior Editor</role><aff><institution>Max Planck Institute for Developmental Biology</institution><country>Germany</country></aff></contrib><contrib contrib-type="editor"><name><surname>Finak</surname><given-names>Greg</given-names></name><role>Reviewing Editor</role><aff><institution>Fred Hutchinson Cancer Research Center</institution><country>United States</country></aff></contrib></contrib-group><pub-date date-type="publication" publication-format="electronic"><day>07</day><month>09</month><year>2020</year></pub-date><pub-date pub-type="collection"><year>2020</year></pub-date><volume>9</volume><elocation-id>e59630</elocation-id><history><date date-type="received" iso-8601-date="2020-06-03"><day>03</day><month>06</month><year>2020</year></date><date date-type="accepted" iso-8601-date="2020-09-05"><day>05</day><month>09</month><year>2020</year></date></history><permissions><copyright-statement>© 2020, Trussart et al</copyright-statement><copyright-year>2020</copyright-year><copyright-holder>Trussart et al</copyright-holder><ali:free_to_read/><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><ali:license_ref>http://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-59630-v2.pdf"/><abstract><p>Mass cytometry (CyTOF) is a technology that has revolutionised single-cell biology. By detecting over 40 proteins on millions of single cells, CyTOF allows the characterisation of cell subpopulations in unprecedented detail. However, most CyTOF studies require the integration of data from multiple CyTOF batches usually acquired on different days and possibly at different sites. To date, the integration of CyTOF datasets remains a challenge due to technical differences arising in multiple batches. To overcome this limitation, we developed an approach called CytofRUV for analysing multiple CyTOF batches, which includes an R-Shiny application with diagnostic plots. CytofRUV can correct for batch effects and integrate data from large numbers of patients and conditions across batches, to confidently compare cellular changes and correlate these with clinically relevant outcomes.</p></abstract><kwd-group kwd-group-type="author-keywords"><kwd>peripheral blood mononuclear cell</kwd><kwd>chronic lymphocytic leukaemia patients</kwd><kwd>proteins</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research organism</title><kwd>Human</kwd></kwd-group><funding-group><award-group id="fund1"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000925</institution-id><institution>National Health and Medical Research Council</institution></institution-wrap></funding-source><award-id>1054618</award-id><principal-award-recipient><name><surname>Trussart</surname><given-names>Marie</given-names></name><name><surname>Speed</surname><given-names>Terence P</given-names></name></principal-award-recipient></award-group><award-group id="fund2"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000925</institution-id><institution>National Health and Medical Research Council</institution></institution-wrap></funding-source><award-id>1158024</award-id><principal-award-recipient><name><surname>Gray</surname><given-names>Daniel HD</given-names></name></principal-award-recipient></award-group><award-group id="fund3"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000951</institution-id><institution>Cancer Council Victoria</institution></institution-wrap></funding-source><award-id>1146518</award-id><principal-award-recipient><name><surname>Tan</surname><given-names>Tania</given-names></name><name><surname>Gray</surname><given-names>Daniel HD</given-names></name></principal-award-recipient></award-group><award-group id="fund4"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000925</institution-id><institution>National Health and Medical Research Council</institution></institution-wrap></funding-source><award-id>1089072</award-id><principal-award-recipient><name><surname>Teh</surname><given-names>Charis E</given-names></name></principal-award-recipient></award-group><award-group id="fund5"><funding-source><institution-wrap><institution>Perpetual Impact Philanthropy</institution></institution-wrap></funding-source><award-id>IPAP2019/1437</award-id><principal-award-recipient><name><surname>Teh</surname><given-names>Charis E</given-names></name></principal-award-recipient></award-group><award-group id="fund6"><funding-source><institution-wrap><institution>UROP Fellowship</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Leong</surname><given-names>Lawrence</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>CytofRUV is a computational algorithm that effectively enables batch effect reduction in multiple CyTOF batches with an adaptable normalisation method and an R-Shiny application with diagnostics plots.</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>Mass cytometry or Cytometry by Time-Of-Flight (CyTOF) (<xref ref-type="bibr" rid="bib2">Bandura et al., 2009</xref>) is a high-throughput technology that permits the simultaneous measurement of the expression level of more than 40 proteins in millions of single cells. It uses antibodies, which are labelled with heavy metal ion tags to target the proteins of interest, and are in turn detected by time-of-flight mass spectrometry. CyTOF has been a powerful tool for delineating cell subsets in heterogeneous tissues such as blood and tumour, and for correlating single-cell differences with biologically relevant outcomes (<xref ref-type="bibr" rid="bib10">Levine et al., 2015</xref>; <xref ref-type="bibr" rid="bib16">Qiu et al., 2011</xref>). This capability has been useful in understanding the mechanisms of resistance that develop in certain blood cancers to a new class of anti-cancer drugs, termed BH3 mimetics, in early stage clinical trials of several blood cancers (<xref ref-type="bibr" rid="bib1">Agarwal et al., 2019</xref>; <xref ref-type="bibr" rid="bib3">Blombery et al., 2019</xref>). Yet, a major challenge in the field is the high variation in the performance observed in the CyTOF instrument, caused by both differences in instrument calibration and fluctuations in signal strength.</p><p>To overcome this challenge, a normalisation method was created to improve the comparability between measurements (<xref ref-type="bibr" rid="bib7">Finck et al., 2013</xref>). Briefly, the method involves the addition of five types of control beads mixed in with cells, each type tagged with a different heavy metal element, the collection of the control beads throughout the run, and the application of a multiplicative correction at the end of the run. For the multiplicative correction, the algorithm calculates smoothed intensities from each control bead element, estimates a coefficient at each control bead acquisition time-point, and corrects the instrument sensitivity at that specific time-point by computing a unique slope for all the control bead elements, assuming that they vary at similar rates. To extend from control bead events to all cells, the value of the coefficient is linearly interpolated over all time-points of the experiment by assuming that all cells (non-control bead events) have similar slopes to the closest bead time-point. The final normalisation step involves applying the interpolated correction coefficient to all the protein measurements. The use of this normalisation to account for intra-instrument time-drift variation has become common practice, but novel correction procedures are still needed to address all other types of variation between samples between research centres, see for example (<xref ref-type="bibr" rid="bib9">Leipold et al., 2018</xref>) and within laboratories run on different days (see below).</p><p>In this study, a single CyTOF dataset, barcoded sample set, or run is referred to as a CyTOF batch. We call the batch effects we seek to remove ‘unwanted variation’, and their causes include: differential antibody staining across samples within a batch, different batches of reagents, different machines or the inevitable lab differences found in multicentre studies. The ability to accurately distinguish true biological changes from technical artefacts like those just mentioned is critical, and has already been done to an extent for flow cytometry assays (<xref ref-type="bibr" rid="bib6">Finak et al., 2016</xref>; <xref ref-type="bibr" rid="bib12">Maecker et al., 2012</xref>).</p><p>Two methods have recently been published that aim to achieve consistency between samples across batches which make use of shared reference samples across batches. BatchAdjust (<xref ref-type="bibr" rid="bib18">Schuyler et al., 2019</xref>) offers methods analogous to the control bead normalisation described above, which include scaling all measurements by ratios of means or medians. With the scaling methods, a factor is computed for each protein and each batch to adjust the measurements on the reference samples replicated across batches. Similar adjustments are then applied to the samples within a batch to achieve consistency with their reference samples. However, technical variation can impact specific cell types differently (<xref ref-type="bibr" rid="bib22">Van Gassen et al., 2019</xref>). To address this, CytoNorm (<xref ref-type="bibr" rid="bib22">Van Gassen et al., 2019</xref>) uses the clustering algorithm FlowSOM (<xref ref-type="bibr" rid="bib21">Van Gassen et al., 2015</xref>) to identify clusters prior to normalisation, and defines a cluster-specific goal distribution for the values of each protein measurement using the means of quantiles. Their approach then uses splines to transform the original protein values into new values, which have the goal distribution. This method relies on the strong assumption that batch effects do not affect the clusters, and this is examined using coefficients of variation. Both methods were shown to be effective in removing batch-to-batch variation in the datasets analysed. The observation that batch differences can affect clusters differently (<xref ref-type="bibr" rid="bib22">Van Gassen et al., 2019</xref>) suggests that it will not be sufficient to apply a single batch adjustment to the measurements on all cells, as it is being done in BatchAdjust (<xref ref-type="bibr" rid="bib18">Schuyler et al., 2019</xref>). However, a comparison of the two methods assessing the performance and limitations of each method has not been performed. Additionally, there are no tools or metrics to assess whether the post normalised CyTOF data are more or less consistent across batches, not only at the protein expression level but also at the cluster level.</p><p>In recent years, a class of methods called Remove Unwanted Variation (RUV) has been developed to remove unwanted variation such as batch effects, from high-dimensional genetic and genomic data. They have been applied to microarray (<xref ref-type="bibr" rid="bib8">Gagnon-Bartsch and Speed, 2012</xref>), RNA-seq (<xref ref-type="bibr" rid="bib17">Risso et al., 2014</xref>), Nanostring nCounter gene expression (<xref ref-type="bibr" rid="bib14">Molania et al., 2019</xref>) and single-cell RNA-seq data (<xref ref-type="bibr" rid="bib11">Lin et al., 2019</xref>). Here, for the first time, we adopt the approach and develop a computational algorithm which permits the integration of data across CyTOF batches. Our method is based on the RUV-III method (<xref ref-type="bibr" rid="bib14">Molania et al., 2019</xref>), which uses technical replicates and negative control genes to estimate unwanted variation. We applied RUV-III to CyTOF data by exploiting pseudo-replicates to estimate the unwanted variation and remove it. It is implemented in the R package ‘CytofRUV’, which is available at the following link: <ext-link ext-link-type="uri" xlink:href="http://www.github.com/mtrussart/CytofRUV">www.github.com/mtrussart/CytofRUV</ext-link>. We begin by examining the batch effects found when comparing CyTOF data from samples replicated across batches. To do so, we built an R-Shiny application that exhibits any batch effects present in such samples using four different diagnostic plots and their associated numerical metrics based on protein expression distributions and clustering results. Then, we compare the unadjusted data with the normalised data using either CytofRUV, BatchAdjust or CytoNorm, all on three different datasets. Our results suggest that not only does CytofRUV do better at removing unwanted variation from measured protein expression, it also makes the distributions of these quantities more uniform across batches, and enhances the detection of biologically important changes embodied in the data across batches.</p></sec><sec id="s2" sec-type="results"><title>Results</title><sec id="s2-1"><title>Batch effects include protein expression differences</title><p>A known source of unwanted variation in CyTOF datasets is the time-drift in signal intensity (<xref ref-type="bibr" rid="bib7">Finck et al., 2013</xref>). However, there can also be variation due to differences across batches in antibody conjugates or other reagents, as well as operators, machines and laboratories. To exhibit some of the batch effects that can arise with CyTOF within one lab, we conducted an experiment using samples replicated across batches. Replicated samples allow us to assess intra-site reproducibility and systematic differences due to technical variation.</p><p>We created a dataset based on 24 samples in total, consisting of peripheral blood mononuclear cell (PBMC) samples from three patients with chronic lymphocytic leukaemia (CLL) and PBMC from nine healthy controls (HC), each replicated across two batches of 12 samples (<xref ref-type="table" rid="table1">Table 1</xref>). All samples were stained with a 31-antibody panel targeting 19 lineage (<xref ref-type="table" rid="table2">Table 2</xref>) and 12 functional proteins (<xref ref-type="table" rid="table3">Table 3</xref>) that were previously validated (<xref ref-type="bibr" rid="bib19">Teh et al., 2020</xref>). After processing the data (Methods), we applied an arcsinh-transformation defined as <italic>arcsinh (intensity/5)</italic> in all that follows.</p><table-wrap id="table1" position="float"><label>Table 1.</label><caption><title>Samples descriptions.</title><p>The first column indicates the sample id, the second the patient condition, either healthy controls (HC) or chronic lymphocytic leukaemia (CLL), the third column indicates the patient id and the last indicates the batch number, 1 or 2.</p></caption><table frame="hsides" rules="groups"><thead><tr><th valign="top">Sample Id</th><th valign="top">Condition</th><th valign="top">Patient Id</th><th valign="top">Batch</th></tr></thead><tbody><tr><td valign="top">HC1_B1</td><td valign="top">HC</td><td valign="top">VBDR996</td><td valign="top">1</td></tr><tr><td valign="top">HC2_B1</td><td valign="top">HC</td><td valign="top">VBDR1089</td><td valign="top">1</td></tr><tr><td valign="top">HC3_B1</td><td valign="top">HC</td><td valign="top">VBDR1090</td><td valign="top">1</td></tr><tr><td valign="top">HC4_B1</td><td valign="top">HC</td><td valign="top">VDBR1098</td><td valign="top">1</td></tr><tr><td valign="top">HC5_B1</td><td valign="top">HC</td><td valign="top">VDBR1108</td><td valign="top">1</td></tr><tr><td valign="top">HC6_B1</td><td valign="top">HC</td><td valign="top">VDBR1103</td><td valign="top">1</td></tr><tr><td valign="top">HC7_B1</td><td valign="top">HC</td><td valign="top">VDBR1105</td><td valign="top">1</td></tr><tr><td valign="top">HC8_B1</td><td valign="top">HC</td><td valign="top">VDBR1107</td><td valign="top">1</td></tr><tr><td valign="top">HC9_B1</td><td valign="top">HC</td><td valign="top">VBDR1111</td><td valign="top">1</td></tr><tr><td valign="top">CLL1_B1</td><td valign="top">CLL</td><td valign="top">DG33-01</td><td valign="top">1</td></tr><tr><td valign="top">CLL2_B1</td><td valign="top">CLL</td><td valign="top">DG23-01</td><td valign="top">1</td></tr><tr><td valign="top">CLL3_B1</td><td valign="top">CLL</td><td valign="top">DG27-01</td><td valign="top">1</td></tr><tr><td valign="top">HC1_B2</td><td valign="top">HC</td><td valign="top">VBDR996</td><td valign="top">2</td></tr><tr><td valign="top">HC2_B2</td><td valign="top">HC</td><td valign="top">VBDR1089</td><td valign="top">2</td></tr><tr><td valign="top">HC3_B2</td><td valign="top">HC</td><td valign="top">VBDR1090</td><td valign="top">2</td></tr><tr><td valign="top">HC4_B2</td><td valign="top">HC</td><td valign="top">VDBR1098</td><td valign="top">2</td></tr><tr><td valign="top">HC5_B2</td><td valign="top">HC</td><td valign="top">VDBR1108</td><td valign="top">2</td></tr><tr><td valign="top">HC6_B2</td><td valign="top">HC</td><td valign="top">VDBR1103</td><td valign="top">2</td></tr><tr><td valign="top">HC7_B2</td><td valign="top">HC</td><td valign="top">VDBR1105</td><td valign="top">2</td></tr><tr><td valign="top">HC8_B2</td><td valign="top">HC</td><td valign="top">VDBR1107</td><td valign="top">2</td></tr><tr><td valign="top">HC9_B2</td><td valign="top">HC</td><td valign="top">VBDR1111</td><td valign="top">2</td></tr><tr><td valign="top">CLL1_B2</td><td valign="top">CLL</td><td valign="top">DG33-01</td><td valign="top">2</td></tr><tr><td valign="top">CLL2_B2</td><td valign="top">CLL</td><td valign="top">DG23-01</td><td valign="top">2</td></tr><tr><td valign="top">CLL3_B2</td><td valign="top">CLL</td><td valign="top">DG27-01</td><td valign="top">2</td></tr></tbody></table></table-wrap><table-wrap id="table2" position="float"><label>Table 2.</label><caption><title>Lineage surface proteins selected.</title><p>The first column indicates the transition element isotope (mass number, element name), the second column indicates the antigen selected, and the last two columns indicate the clone name and vendor.</p></caption><table frame="hsides" rules="groups"><thead><tr><th valign="top"/><th valign="top">Metal</th><th valign="top">Lineage (surface) protein antibody</th><th valign="top">Clone</th><th valign="top">Vendor</th></tr></thead><tbody><tr><td valign="top">1</td><td valign="top">89 Y</td><td valign="top">CD45</td><td valign="top">HI30</td><td valign="top">BioLegend</td></tr><tr><td valign="top">2</td><td valign="top">115 In</td><td valign="top">HLA-DR</td><td valign="top">L243</td><td valign="top">BioLegend</td></tr><tr><td valign="top">3</td><td valign="top">140 Ce</td><td valign="top">CD27</td><td valign="top">M-T271</td><td valign="top">BioLegend</td></tr><tr><td valign="top">4</td><td valign="top">141 Pr</td><td valign="top">CD235a/b</td><td valign="top">HIR2</td><td valign="top">BioLegend</td></tr><tr><td valign="top">5</td><td valign="top">142 Nd</td><td valign="top">CD19</td><td valign="top">HIB19</td><td valign="top">BioLegend</td></tr><tr><td valign="top">6</td><td valign="top">143 Nd</td><td valign="top">CD5</td><td valign="top">UCHT2</td><td valign="top">BioLegend</td></tr><tr><td valign="top">7</td><td valign="top">144 Nd</td><td valign="top">CD38</td><td valign="top">HIT2</td><td valign="top">BioLegend</td></tr><tr><td valign="top">8</td><td valign="top">145 Nd</td><td valign="top">CD4</td><td valign="top">RPA-T4</td><td valign="top">BioLegend</td></tr><tr><td valign="top">9</td><td valign="top">146 Nd</td><td valign="top">CD8</td><td valign="top">RPA-T8</td><td valign="top">BioLegend</td></tr><tr><td valign="top">10</td><td valign="top">147 Sm</td><td valign="top">CD20</td><td valign="top">H1</td><td valign="top">BD</td></tr><tr><td valign="top">11</td><td valign="top">148 Nd</td><td valign="top">CD16</td><td valign="top">3G8</td><td valign="top">BioLegend</td></tr><tr><td valign="top">12</td><td valign="top">151 Eu</td><td valign="top">CD123</td><td valign="top">6H6</td><td valign="top">BioLegend</td></tr><tr><td valign="top">13</td><td valign="top">155 Gd</td><td valign="top">CD56</td><td valign="top">B159</td><td valign="top">BioLegend</td></tr><tr><td valign="top">14</td><td valign="top">156 Gd</td><td valign="top">CD14</td><td valign="top">HCD56</td><td valign="top">BioLegend</td></tr><tr><td valign="top">15</td><td valign="top">159 Tb</td><td valign="top">CD11c</td><td valign="top">Bu15</td><td valign="top">BioLegend</td></tr><tr><td valign="top">16</td><td valign="top">169 Tm</td><td valign="top">CD45RA</td><td valign="top">HI100</td><td valign="top">BioLegend</td></tr><tr><td valign="top">17</td><td valign="top">170 Er</td><td valign="top">CD3</td><td valign="top">UCHT1</td><td valign="top">BioLegend</td></tr><tr><td valign="top">18</td><td valign="top">171 Yb</td><td valign="top">CD66</td><td valign="top">CD66a-B1.1</td><td valign="top">DVS</td></tr><tr><td valign="top">19</td><td valign="top">209 Bi</td><td valign="top">CD61</td><td valign="top">VI-PL2</td><td valign="top">DVS</td></tr></tbody></table></table-wrap><table-wrap id="table3" position="float"><label>Table 3.</label><caption><title>Set of intracellular functional proteins selected.</title><p>The first column transition element isotope (mass number, element name), the second column indicates the antigen selected, and the last two columns indicate the clone name and vendor.</p></caption><table frame="hsides" rules="groups"><thead><tr><th valign="top"/><th valign="top">Metal</th><th valign="top">Functional (intracellular) protein antibody</th><th valign="top">Clone</th><th valign="top">Vendor</th></tr></thead><tbody><tr><td valign="top">1</td><td valign="top">140 Ce</td><td valign="top">BAK</td><td valign="top">7D10</td><td valign="top">WEHI</td></tr><tr><td valign="top">2</td><td valign="top">153 Eu</td><td valign="top">Bcl-xL</td><td valign="top">E18</td><td valign="top">Abcam</td></tr><tr><td valign="top">3</td><td valign="top">154 Sm</td><td valign="top">Bax</td><td valign="top">1B4</td><td valign="top">WEHI</td></tr><tr><td valign="top">4</td><td valign="top">157 Gd</td><td valign="top">Bcl-2</td><td valign="top">100</td><td valign="top">WEHI</td></tr><tr><td valign="top">5</td><td valign="top">160 Gd</td><td valign="top">Mcl-1</td><td valign="top">Y37</td><td valign="top">Abcam</td></tr><tr><td valign="top">6</td><td valign="top">161 Dy</td><td valign="top">cMyc</td><td valign="top">D84C12</td><td valign="top">CST</td></tr><tr><td valign="top">7</td><td valign="top">163 Dy</td><td valign="top">BFL-1</td><td valign="top">SP435</td><td valign="top">Abcam</td></tr><tr><td valign="top">8</td><td valign="top">165 Ho</td><td valign="top">Bim</td><td valign="top">3C5</td><td valign="top">WEHI</td></tr><tr><td valign="top">9</td><td valign="top">166 Er</td><td valign="top">pRb [S807/811]</td><td valign="top">J112-906</td><td valign="top">BD</td></tr><tr><td valign="top">10</td><td valign="top">172 Yb</td><td valign="top">BCLW</td><td valign="top">16H12</td><td valign="top">WEHI</td></tr><tr><td valign="top">11</td><td valign="top">173 Yb</td><td valign="top">cCaspase3</td><td valign="top">C92-605</td><td valign="top">BD</td></tr><tr><td valign="top">12</td><td valign="top">174 Yb</td><td valign="top">p53</td><td valign="top">7F5</td><td valign="top">CST</td></tr></tbody></table></table-wrap><p>The first class of diagnostic plots we use is based on median protein expression. The multi-dimensional scaling (MDS) plot (<xref ref-type="fig" rid="fig1">Figure 1A</xref>) computed using median protein expression from all cells in each sample as described in <xref ref-type="bibr" rid="bib5">Crowell HL et al., 2017</xref> and <xref ref-type="bibr" rid="bib15">Nowicka et al., 2017</xref>, shows the dissimilarities between samples. The first dimension (MDS1) separates the CLL from the HC samples well. The second dimension (MDS2) shows the batch differences, with samples that originate from batch one placed at the bottom of the plot and samples from batch two at the top of the plot. This distinction clearly reveals that the protein expression measured in the samples is affected by batch. We also carried out hierarchical clustering on the median expression across all cells in the samples of the 19 lineage proteins and 12 functional proteins detected, to highlight the proteins driving the observed clustering of samples (columns) and proteins (rows) in the heatmap (<xref ref-type="fig" rid="fig1">Figure 1B</xref>). As with the MDS plot, a grouping of samples by condition and by batch is observed.</p><fig id="fig1" position="float"><label>Figure 1.</label><caption><title>Visualisation of batch effects on the median protein expression across batches .</title><p>(<bold>A</bold>) Multi-dimensional scaling plot of the 24 samples computed using median protein expression. (<bold>B</bold>) Heatmap of the median protein expression of 19 lineage proteins and 12 functional proteins across all cells measured for each sample in the dataset.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-59630-fig1-v2.tif"/></fig><p>We next examined the magnitude of the batch-to-batch differences in the distributions of the protein expression across replicates, as our second class of diagnostic plots. We observed that batch effects not only affect each protein differently (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>) but also each sample differently (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>). To assess the importance of the variation found between samples replicated across batches, we compared them to expected, biologically relevant differences within a single batch. To do this, we used another dataset of a replicated sample from one index patient with CLL, and samples from six other patients with CLL. The one sample from the index patient with CLL was replicated across eight different CyTOF batches, resulting in eight replicated CLL datasets. We compared the variation in these datasets with that from six other patients with CLL processed in a single CyTOF batch. We focussed on expression of BCL-2, an archetypal pro-survival protein that is greatly upregulated in CLL cells compared to their normal B cell counterparts, yet still exhibits variation in CLL cells among patients (<xref ref-type="bibr" rid="bib13">Majid et al., 2008</xref>). We found that the variation in the distributions of the BCL-2 expression from a single sample across batches (<xref ref-type="fig" rid="fig2">Figure 2A</xref>) is comparable to that observed in the BCL-2 expression for the six patients at screening from a single CyTOF batch (<xref ref-type="fig" rid="fig2">Figure 2B</xref>). We conclude that batch effects due to unwanted variation can occur over a range comparable to that due to actual biological changes among patients (<xref ref-type="fig" rid="fig2">Figure 2A–B</xref>). An important repercussion in this example is that the impacts of treatments on distinct CLL cellular phenotypes would not be confidently detected without correcting for batch effects.</p><fig-group><fig id="fig2" position="float"><label>Figure 2.</label><caption><title>Distribution of BCL-2 expression.</title><p>(<bold>A</bold>) Distributions of BCL-2 expression in one sample from one treated CLL cancer patient, replicated across 8 CyTOF batches, coloured by batch. (<bold>B</bold>) Distributions of BCL-2 expression in one sample from each of 6 different CLL cancer patients at screening, processed in a single CyTOF batch, coloured by patient.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-59630-fig2-v2.tif"/></fig><fig id="fig2s1" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 1.</label><caption><title>Protein distributions before normalisation for the samples CLL2 and HC1 across batch 1 and batch 2.</title><p>(<bold>A</bold>) Lineage protein expression distributions for the sample CLL2 across batches, before normalisation. (<bold>B</bold>) Same as (A) with functional proteins. (<bold>C</bold>) Lineage protein expression distributions for the sample HC1 across batches, before normalisation. (<bold>D</bold>) Same as (<bold>C</bold>) with functional proteins.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-59630-fig2-figsupp1-v2.tif"/></fig><fig id="fig2s2" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 2.</label><caption><title>Protein distributions after CytofRUV normalisation with k = 5 for the samples CLL2 and HC1 across batch 1 and batch 2.</title><p>(<bold>A</bold>) Lineage protein expression distributions for the CLL2 sample across batches, after CytofRUV normalisation. (<bold>B</bold>) Same as (<bold>A</bold>) with functional proteins. (<bold>C</bold>) Lineage protein expression distributions for the sample HC1 across batches, after CytofRUV normalisation. (<bold>D</bold>) Same as (<bold>C</bold>) with functional proteins.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-59630-fig2-figsupp2-v2.tif"/></fig></fig-group></sec><sec id="s2-2"><title>Batch effects affect cell subpopulations differently</title><p>To assess how batch effects affect cell subpopulations, we used our first dataset of samples from 3 patients with CLL and 9 PBMC healthy controls (HC). We partitioned the entire collection of cells into clusters using FlowSOM as described in <xref ref-type="bibr" rid="bib15">Nowicka et al., 2017</xref>, which appeared among the fastest and best performing clustering approaches for CyTOF data (<xref ref-type="bibr" rid="bib24">Weber and Robinson, 2016</xref>). In all 24 samples, we carried out this clustering using the 19 lineage proteins to identify 20 cell clusters (<xref ref-type="fig" rid="fig3">Figure 3A</xref> and <xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1</xref>). We performed the clustering using different numbers of clusters, and the choice of 20 clusters was determined based on the biological interpretation of the cell subpopulations found. Here we refer to clusters as cell subpopulations, although in some cases the clustering method might produce clusters that do not necessarily correspond to homogeneous cell subpopulations. The third class of diagnostic plots we display are based on the clustering results. We used t-Distributed Stochastic Neighbor Embedding (t-SNE) as described in <xref ref-type="bibr" rid="bib5">Crowell HL et al., 2017</xref> and <xref ref-type="bibr" rid="bib15">Nowicka et al., 2017</xref> to give a 2D representation of the single-cell data, with the positions of cells reflecting their proximity in high-dimensional space. It was then possible to visualise the impact of batch differences on cell subtypes identification in the datasets by examining the t-SNE plot coloured by cluster (<xref ref-type="fig" rid="fig3">Figure 3A</xref>), which assumed different distributions across the replicate CyTOF runs. Additionally, we highlighted the batch effect by overlaying the predominant CLL cell subpopulation (cluster 9) coloured by batch (<xref ref-type="fig" rid="fig3">Figure 3B</xref>). The distinct positions of these clusters on the second dimension (t-SNE2) suggested that substantial unwanted variation was altering cell population measures across the two batches.</p><fig-group><fig id="fig3" position="float"><label>Figure 3.</label><caption><title>Cell clustering plots show batch effects in cells from the same cancer patient CLL1 sample replicated across 2 CyTOF runs.</title><p>(<bold>A</bold>) Cell clustering identification. t-SNE plot based on the arcsinh-transformed expression of the 19 lineage proteins in the cells. For display purposes, 2000 cells were randomly selected from each of the samples. Cells are coloured according to the 20 clusters obtained using FlowSOM clustering stratified by batch 1 (left) or 2 (right) of the corresponding replicated sample. (<bold>B</bold>) Same as in (A) selecting only cluster 9 cells but coloured by the batch 1 or 2 of the corresponding replicated sample. (<bold>C</bold>) Same as in (A) but after CytofRUV normalisation with k = 5. (<bold>D</bold>) Same as in (B) but after CytofRUV normalisation with k = 5. (<bold>E</bold>) Linear discriminant analysis applied to data on two cell types from the same sample replicated across two batches, with shape indicating cell type and colour indicating batch. (<bold>F</bold>) Cluster proportions. Barplot of the relative abundance (percentage) of the cells in clusters 2, 6 and 7 by batch.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-59630-fig3-v2.tif"/></fig><fig id="fig3s1" position="float" specific-use="child-fig"><label>Figure 3—figure supplement 1.</label><caption><title>Heatmap of the median lineage protein expression across clusters with the associated cluster percentages measured for all cells and all samples in the first dataset of samples from 3 patients with CLL and 9 HC.</title></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-59630-fig3-figsupp1-v2.tif"/></fig><fig id="fig3s2" position="float" specific-use="child-fig"><label>Figure 3—figure supplement 2.</label><caption><title>BCL-2 median expression in the main CLL cluster from the 3 CLL samples replicated across 2 CyTOF runs.</title><p>(<bold>A</bold>) Before and (<bold>B</bold>) After CytofRUV normalisation with k = 5.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-59630-fig3-figsupp2-v2.tif"/></fig><fig id="fig3s3" position="float" specific-use="child-fig"><label>Figure 3—figure supplement 3.</label><caption><title>Linear discriminant analysis plot to show batch effects in cells from the same cancer patient CLL1 sample replicated across batches after CytofRUV normalisation with k = 5.</title></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-59630-fig3-figsupp3-v2.tif"/></fig><fig id="fig3s4" position="float" specific-use="child-fig"><label>Figure 3—figure supplement 4.</label><caption><title>Boxplot of the differences of median protein expression differences across batches before and after CytofRUV normalisation (ΔΔ, see Materials and methods) with k=5 within the main prominent cell subpopulation.</title><p>(<bold>A</bold>) ΔΔ differences were computed on the 3 replicated CLL samples within the main CLL cluster. (<bold>B</bold>) ΔΔ differences were computed on the 9 replicated HC samples within the main HC cluster.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-59630-fig3-figsupp4-v2.tif"/></fig></fig-group><p>To optimise the dimensionality reduction and visualise the extent to which discrete subsets of cells are separated from each other in the 31-dimensional space, we performed a linear discriminant analysis (LDA) on four subsets of cells: the predominant CLL cell subpopulation (cluster 9) and CD8 killer cell subpopulation (cluster 2) identified in the study from batches 1 and batch 2. The first dimension (LD1) separates the cell types well, while the second dimension (LD2) embodies batch differences: cells that originate from batch one are located at the top of the plot while cells from batch two are at the bottom of the plot (<xref ref-type="fig" rid="fig3">Figure 3E</xref>).</p><p>CyTOF has the unique ability to provide a deeper understanding of the molecular changes induced by targeted therapies at the single-cell level and how their efficacy is influenced by cancer heterogeneity. However, the assessment of patient heterogeneity and its correlation with the clinical outcome necessitates a reliable detection of changes in protein expression across patients. As such, we compared the median expression of BCL-2 for the 3 patients with CCL in the main CLL cluster nine and found that the variation from a single sample across batches is higher than that observed in the BCL-2 median expression across patients (<xref ref-type="fig" rid="fig3s2">Figure 3—figure supplement 2A</xref>). To overcome this limitation, the assessment of heterogeneity of patients with CLL requires a correction for batch effects that would remove this unwanted variation.</p></sec><sec id="s2-3"><title>Batch effects can induce differences in cell subpopulation abundances</title><p>In CyTOF studies, the analysis of cell subpopulation abundances as well as that of protein expression can be used to identify sets of proteins that are associated with response to a treatment. Comparing the proportions of inferred cell types across different drug treatments highlights the subpopulations that change across experimental conditions. To assess whether batch differences affect cell subpopulation abundances, we compared the cluster frequencies across replicates. We detected a noticeable difference in the proportions of CLL cancer cells (cluster 2, cluster 6 and cluster 7) among cells that originate from the batch one compared to those from batch 2 (<xref ref-type="fig" rid="fig3">Figure 3F</xref>). Our R-Shiny application can also be used to visualise the cluster proportions across samples, and is our fourth class of diagnostic plots (<xref ref-type="fig" rid="fig4">Figure 4</xref>). Such variation in cell subpopulation abundance is important when batches have markedly different proportions. We need to be able to identify changes in subpopulation abundance which are due to biology and not to unwanted variation between samples.</p><fig id="fig4" position="float"><label>Figure 4.</label><caption><title>CytofRUV’s R-Shiny application for the identification of batch effects in cluster proportions across batches.</title><p>All diagnostic plots can be obtained by the user selecting an option at the top left corner by from: Median Protein Expression, Protein Expression Distributions, Clustering Results and Cluster Proportions. The selected option displays barplots of cluster proportions across samples before normalisation and by conditions CLL or HC on a subsample of the whole dataset. Vertical black boxes contain the same replicated sample across batches one and batch2.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-59630-fig4-v2.tif"/></fig><p>In summary, we examined the reproducibility of samples replicated across batches. To facilitate the identification of batch effects across replicates, we developed an R-Shiny application that produces the four diagnostic plots previously mentioned: Median Protein Expression, Protein Expression Distributions, Clustering Results and Cluster Proportions. We found that batch differences affect not only the protein expression levels, but also the cluster proportions. Such differences are problematic in large-scale studies with multiple patients, cell types and treatments, as they compromise the detection of biologically important changes. The integration of datasets from multiple CyTOF batches is therefore an important challenge to be addressed.</p></sec><sec id="s2-4"><title>Using CytofRUV to remove batch effects in CyTOF data</title><p>To integrate data from multiple CyTOF batches, we have developed a normalisation method that removes batch effects in CyTOF data. In order to estimate and adjust for such unwanted variation, CytofRUV exploits the concept of pseudo-replicates (here cells) in the RUV-III method that has been successfully applied to the Nanostring nCounter gene expression platform (<xref ref-type="bibr" rid="bib14">Molania et al., 2019</xref>) and to single-cell RNA-seq data (<xref ref-type="bibr" rid="bib11">Lin et al., 2019</xref>). We cluster using FlowSOM, and we assume that at least one cluster in the replicated samples is shared across the batches. We then consider the cells of clusters shared across the batches to be pseudo-replicates (see Methods). To adjust for batch effects, CytofRUV begins by averaging protein values across pseudo-replicates, and then forms residuals. This leads to an estimate of one aspect of the unwanted variation (α) on each protein, which in turn is used to estimate the other aspect (W) of the unwanted variation on each cell. Finally, those estimates are combined into an estimate of the unwanted variation (Wα), and that is subtracted from the data. The dimension (k) of the unwanted variation also needs to be determined. To find a good value for k, we repeat the analysis with different values of k and then evaluate the quality of each result using our diagnostic plots and the corresponding summary statistics.</p><p>We first used CytofRUV on data from the 12 samples replicated across two batches, using two samples as our known replicated reference samples. Specifically, we used HC1 for the HC samples and CLL2 for the CLL samples, defining all cells from those samples in any given cluster to be pseudo-replicates. Assuming that all 20 clusters have cells from HC1 and CLL2 in both batches, any differences in protein expression between cells within the cluster but in different batches will represent unwanted variation. We summarized the performance of our CytofRUV normalisation method on all the CLL samples using three metrics and compare them with the corresponding ones for BatchAdjust (<xref ref-type="bibr" rid="bib18">Schuyler et al., 2019</xref>) and CytoNorm (<xref ref-type="bibr" rid="bib22">Van Gassen et al., 2019</xref>).</p></sec><sec id="s2-5"><title>CytofRUV reduces batch effects from protein expression</title><p>To assess the quality of the our CytofRUV normalisation, we first compared the distributions of proteins across the two batches for the designated replicated reference samples. We found that, for all the proteins, these distributions become more similar across batches (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>, <xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2</xref>). Also, we observed that the variation in the median expression of BCL-2 for the 3 patients with CLL in the main CLL cluster is reduced compared to that observed in the BCL-2 median expression across patients (<xref ref-type="fig" rid="fig3s2">Figure 3—figure supplement 2B</xref>). We also observed a decrease in the batch effects both on the t-SNE plots (<xref ref-type="fig" rid="fig3">Figure 3C and D</xref>) and in the linear discriminant analysis (<xref ref-type="fig" rid="fig3s3">Figure 3—figure supplement 3</xref>). To quantify the batch differences between these pairs of distributions, we computed the Earth Movers Distance (EMD) as described in <xref ref-type="bibr" rid="bib22">Van Gassen et al., 2019</xref> for all the proteins and all CLL and HC samples for both the original dataset and the normalised datasets (<xref ref-type="fig" rid="fig5">Figure 5A and D</xref>). For only the CytofRUV normalisation, we also computed the EMD by cluster for all proteins to assess the reduction in batch differences within cluster compared to the raw data, where batch effects are affecting protein distributions within cluster differently (<xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1</xref>). For all CLL samples, CytofRUV gave the lowest EMD for all values of k = 5,10 and 15, not only compared to the raw data but also compared to both BatchAdjust and CytoNorm (<xref ref-type="fig" rid="fig5">Figure 5A</xref>). Similarly, CytofRUV also gave the lowest EMD for 7 out of 9 HC samples compared to both BatchAdjust and CytoNorm (<xref ref-type="fig" rid="fig5">Figure 5D</xref>).</p><fig-group><fig id="fig5" position="float"><label>Figure 5.</label><caption><title>Metrics to assess the effectiveness of the normalisation methods.</title><p>In all panels, the colour indicates either the raw data or the method used for normalisation. (<bold>A</bold>) Boxplots of the Earth Movers Distances (EMD) between paired protein expression distributions across batches for each CLL sample. (<bold>B</bold>) Hellinger distances between paired cluster proportions across batches for each CLL sample. (<bold>C</bold>) Mean Silhouette scores computed for all CLL samples on the cluster types (bio) on the x-axis and on batch (batch) on the y-axis. (<bold>D</bold>) Same as (A) for the HC samples. (<bold>E</bold>) Same as (B) for the HC samples. (<bold>F</bold>) Silhouette scores computed for all HC samples on the cluster types (bio) on the x-axis and on batch (batch) on the y-axis.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-59630-fig5-v2.tif"/></fig><fig id="fig5s1" position="float" specific-use="child-fig"><label>Figure 5—figure supplement 1.</label><caption><title>EMD for all the proteins by cluster, before and after CytofRUV normalisation of the CLL2 sample, k = <italic>5</italic>.</title><p>(<bold>A</bold>) EMD for lineage proteins by cluster before (black) and after (blue) CytofRUV normalisation (blue). (<bold>B</bold>) Same as (<bold>A</bold>), with functional proteins.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-59630-fig5-figsupp1-v2.tif"/></fig></fig-group><p>Altogether EMD revealed that CytofRUV is the method with the optimal reduction in batch differences from protein expression for 11 out of 12 samples. CytoNorm gave the lower EMD when compared with BatchAdjust for 7 out of 12 samples (<xref ref-type="fig" rid="fig5">Figure 5A and D</xref>).</p></sec><sec id="s2-6"><title>CytofRUV makes the cell subpopulation proportions more consistent across batches</title><p>The proportions of the different cell subpopulations in replicates in different batches should be consistent. This consistency among the replicates ensures that a differential analysis of their abundances will confidently detect robust cellular changes across experimental conditions. To assess how well CytofRUV corrects for differences in cluster proportions across batches, we computed the Hellinger distance (see Methods) between the paired cluster proportions of all replicated samples. For the HC samples, CytofNorm gave the lowest Hellinger distances for 4 samples out of 9 compared to both CytofRUV and BatchAdjust. Two remaining samples are the ones where CytofRUV is able to make those proportions more consistent across replicates (<xref ref-type="fig" rid="fig5">Figure 5E</xref>). For all the CLL samples, the lowest Hellinger distances are found for the normalisation with CytofRUV methods (<xref ref-type="fig" rid="fig5">Figure 5B</xref>). Overall CytofRUV is able to adjust the cluster proportions and make them consistent across replicates to a greater extent than is achieved by the two others methods. CytoNorm also performs well in adjusting those proportions, while BatchAjust generally leads to Hellinger distances similar to those in the raw data (<xref ref-type="fig" rid="fig5">Figure 5B and E</xref>).</p></sec><sec id="s2-7"><title>Effective removal of unwanted variation leads to a better separation of cell subpopulations</title><p>To evaluate whether CytofRUV not only removes batch effects but preserves biology, we compare the cell-to-cell variation within clusters in relation to between clusters. We do this by computing <italic>Silhouette</italic> scores (see Methods), which are a combined measure of the degree of separation of cells within clusters and that between clusters. We compute two Silhouette scores s<sub>biology</sub> and s<sub>batch</sub>, based on the cell subpopulations defined by the clusters, and batch grouping, respectively. A normalisation method that successfully removes batch effects should lead to adjusted data with a small s<sub>batch</sub> score, while one which preserves or enhances the biology should have high value of s<sub>biology</sub>, at least as high as that before adjustment. To assess this aspect of the performance of normalisation methods, we combine the s<sub>biology</sub> for clusters with s<sub>batch</sub> for the batches in a single plot (<xref ref-type="fig" rid="fig5">Figure 5C and F</xref>). When the raw data are found at the bottom left corner of the plot and a normalisation method is found at the top right corner of the plot, this indicates that the method has successfully removed batch effects and preserved or enhanced the biology. According to the mean Silhouette scores of the CLL samples (<xref ref-type="fig" rid="fig5">Figure 5C</xref>), CytofRUV with k = 5 gives the best results, not only enhancing the biology i.e. cell sub-type definition across replicates (also on t-SNE plots <xref ref-type="fig" rid="fig3">Figure 3C and D</xref>), but also removing the batch effects. For most of the HC samples, s<sub>batch</sub> is similar for all methods and in a few samples s<sub>batch</sub> is higher than in the raw data for all methods (<xref ref-type="fig" rid="fig5">Figure 5F</xref>). Using CytofRUV with k = 5 for the HC samples, we also obtained a higher s<sub>biology</sub> for 8 out of the 9 HC samples (<xref ref-type="fig" rid="fig5">Figure 5F</xref>) compared to the two other methods.</p></sec><sec id="s2-8"><title>CytofRUV removes batch effects across multiple batches in two other datasets</title><p>To expand our analysis, we also tested all methods on two other datasets containing replicate reference samples across multiple batches, taken from those used in <xref ref-type="bibr" rid="bib18">Schuyler et al., 2019</xref> and in CytoNorm (<xref ref-type="bibr" rid="bib22">Van Gassen et al., 2019</xref>).</p><p>The first dataset (<xref ref-type="bibr" rid="bib18">Schuyler et al., 2019</xref>) is from peripheral whole blood samples from a single healthy donor, processed at one time to include unstimulated and stimulated conditions (Lipopolysaccharide LPS+ and Resiquimod R848-), and aliquoted into 12 batches. We carried out the normalisation of all samples using BatchAdjust as explained in <xref ref-type="bibr" rid="bib18">Schuyler et al., 2019</xref>. For CytofRUV and CytoNorm, we used all the stimulated samples as replicated reference samples and identified 20 clusters with FlowSOM. CytofRUV used all clusters to define pseudo-replicates.</p><p>Our R-Shiny application can also be used to assess the ability of a normalisation method to correct for batch effects. Using our fourth diagnostic plot, we can visualise the ability of CytofRUV with k = 10 to remove batch effects in cluster proportions across 12 batches (<xref ref-type="fig" rid="fig6">Figure 6C</xref>) compared to that in the raw data (<xref ref-type="fig" rid="fig6">Figure 6A</xref>). We also summarized the performance of all three methods using the same three metrics (<xref ref-type="fig" rid="fig6s1">Figure 6—figure supplement 1</xref>). Again, we observed the ability of CytoNorm to correct for differences in cluster proportions in stimulated samples where the lowest Hellinger distances are found (<xref ref-type="fig" rid="fig6s1">Figure 6—figure supplement 1B</xref>), and in unstimulated samples (<xref ref-type="fig" rid="fig6s1">Figure 6—figure supplement 1E</xref>), followed by CytofRUV with overall lower distances than BatchAdjust. Likewise, we confirmed that, overall, CytofRUV gave lower EMD for both the stimulated (<xref ref-type="fig" rid="fig6s1">Figure 6—figure supplement 1A</xref>) and unstimulated samples (<xref ref-type="fig" rid="fig6s1">Figure 6—figure supplement 1D</xref>) compared to the two other methods, which in some cases have some cases higher EMD than those of the raw data. Again we observed improved Silhouette scores for CytofRUV compared with BatchAdjust and CytoNorm, which have higher s<sub>batch</sub> (<xref ref-type="fig" rid="fig6s1">Figure 6—figure supplement 1C</xref>).</p><fig-group><fig id="fig6" position="float"><label>Figure 6.</label><caption><title>CytofRUV performance on two other datasets with multiple batches.</title><p>(<bold>A</bold>) Barplot of proportions of clusters across 28 samples from the BatchAdjust dataset (<xref ref-type="bibr" rid="bib18">Schuyler et al., 2019</xref>) before normalisation, by samples and coloured by cluster. Vertical black boxes contain the same sample (Stimulated or Unstimulated) replicated across 14 batches. (<bold>B</bold>) Protein expression distribution from the CytoNorm dataset (<xref ref-type="bibr" rid="bib22">Van Gassen et al., 2019</xref>) before normalisation of all cells from the stimulated samples across 10 batches and coloured by batch. (<bold>C</bold>) Same as (A) but after CytofRUV normalisation with k = 10. (<bold>D</bold>) Same as (B) but after CytofRUV normalisation with k = 5.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-59630-fig6-v2.tif"/></fig><fig id="fig6s1" position="float" specific-use="child-fig"><label>Figure 6—figure supplement 1.</label><caption><title>Metrics to assess the effectiveness of the normalisation methods on the BatchAdjust dataset.</title><p>In all panels, the colour indicates either the raw data or the method used for normalisation. (<bold>A</bold>) Boxplots of the Earth Movers Distance (EMD) between paired protein expression distributions for each batch’s stimulated sample compared to that in the first batch. (<bold>B</bold>) Hellinger distances between paired cell subpopulation proportions for each batch’s stimulated sample compared to that in the first batch. (<bold>C</bold>) Mean Silhouette scores computed for all stimulated and unstimulated samples with those for cell subpopulations (bio) on the x-axis and for batch (batch) on the y-axis. (<bold>D</bold>) Same as (A) for the unstimulated samples. (<bold>E</bold>) Same as (B) for the unstimulated samples.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-59630-fig6-figsupp1-v2.tif"/></fig><fig id="fig6s2" position="float" specific-use="child-fig"><label>Figure 6—figure supplement 2.</label><caption><title>Metrics to assess the effectiveness of the normalisation methods on samples two from the CytoNorm dataset using stimulated samples two as replicated reference samples.</title><p>In all panels, the colour indicates either the raw data or the method used for normalisation. (<bold>A</bold>) Boxplots of the Earth Movers Distance (EMD) between paired protein expression distributions for each batch’s stimulated sample across compared to that in the first batch. (<bold>B</bold>) Hellinger distances between paired cell subpopulation proportions for each batch’s stimulated sample compared to that in the first batch. (<bold>C</bold>) Mean Silhouette scores computed for all stimulated and unstimulated samples with those for cell subpopulations (bio) on the x-axis and for batch (batch) on the y-axis. (<bold>D</bold>) Same as (A) for the unstimulated samples. (<bold>E</bold>) Same as (B) for the unstimulated samples.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-59630-fig6-figsupp2-v2.tif"/></fig><fig id="fig6s3" position="float" specific-use="child-fig"><label>Figure 6—figure supplement 3.</label><caption><title>Metrics to assess the effectiveness of the normalisation methods on samples two from the CytoNorm dataset using both the stimulated and unstimulated samples one as replicated reference samples.</title><p>In all panels, the colour indicates either the raw data or the method used for normalisation. (<bold>A</bold>) Boxplots of the Earth Movers Distance (EMD) between paired protein expression distributions for each batch’s stimulated sample across compared to that in the first batch. (<bold>B</bold>) Hellinger distances between paired cell subpopulation proportions for each batch’s stimulated sample compared to that in the first batch. (<bold>C</bold>) Mean Silhouette scores computed for all stimulated and unstimulated samples with those for cell subpopulations (bio) on the x-axis and for batch (batch) on the y-axis. (<bold>D</bold>) Same as (A) for the unstimulated samples. (<bold>E</bold>) Same as (B) for the unstimulated samples.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-59630-fig6-figsupp3-v2.tif"/></fig></fig-group><p>The second dataset (<xref ref-type="bibr" rid="bib22">Van Gassen et al., 2019</xref>) comes from the FlowRepository FR-FCM-Z247 which is the validation cohort of an immunoprofiling study of women during pregnancy used in CytoNorm (<xref ref-type="bibr" rid="bib22">Van Gassen et al., 2019</xref>). The samples we analyse come from the blood of one healthy donor which was replicated across 10 separately barcoded plates (i.e. batches). Each batch contained unstimulated cells and cells stimulated with both Interferon α and LPS. Each stimulated and unstimulated sample was duplicated (referred to as sample 1 and sample 2), giving four samples per plate. To assess the limitations of the three normalisation methods, we carried out two analyses. The first normalisation was only carried out on samples two using the stimulated samples two as replicate reference samples, while the second normalisation was done on samples 1 and 2 using both the stimulated and unstimulated samples one as reference samples. We performed CytoNorm as explained in <xref ref-type="bibr" rid="bib22">Van Gassen et al., 2019</xref> and identified 25 clusters with FlowSOM and we used all clusters to define pseudo-replicates for CytofRUV.</p><p>For the first normalisation using only the stimulated samples as replicate reference samples, CytofRUV gives lower EMD for all samples, followed by CytoNorm which overall gives lower EMD when compared with BatchAdjust (<xref ref-type="fig" rid="fig6s2">Figure 6—figure supplement 2A</xref>, <xref ref-type="fig" rid="fig6s2">Figure 6—figure supplement 2C</xref>). CytoNorm corrects some differences in cluster proportions only in stimulated samples compared to the two other methods that give EMD generally similar to those in the raw data (<xref ref-type="fig" rid="fig6s2">Figure 6—figure supplement 2B</xref>). However, according to the Hellinger distance and Silhouette scores with s<sub>batch</sub> higher to that in the raw data, the unstimulated samples still have batch effects after normalisation by all three methods (<xref ref-type="fig" rid="fig6s2">Figure 6—figure supplement 2C</xref>, <xref ref-type="fig" rid="fig6s2">Figure 6—figure supplement 2E</xref>). Similarly, the Silhouette scores of the stimulated samples indicate that none of the normalisation methods is able to successfully remove batch effects (<xref ref-type="fig" rid="fig6s2">Figure 6—figure supplement 2C</xref>).</p><p>In our second normalisation, when using both stimulated and unstimulated samples one as reference samples, lower Hellinger distances are found on both unstimulated and stimulated samples two for CytofRUV compared to BatchAdjust and CytoNorm, which have higher distances than those in the raw data for most samples. Better Silhouette scores are found for both samples for CytoNorm (<xref ref-type="fig" rid="fig6s3">Figure 6—figure supplement 3B</xref>, <xref ref-type="fig" rid="fig6s3">Figure 6—figure supplement 3E</xref>, <xref ref-type="fig" rid="fig6s3">Figure 6—figure supplement 3C</xref>) compared with the two other methods. Using our second class of diagnostic plots, we observe that CytofRUV with k = 5 effectively eliminates batch differences from protein expression across the 10 batches (<xref ref-type="fig" rid="fig6">Figure 6B</xref>) compared to that in the raw data (<xref ref-type="fig" rid="fig6">Figure 6D</xref>). It also gives the lowest EMD compared to both CytoNorm and BatchAdjust (<xref ref-type="fig" rid="fig6s3">Figure 6—figure supplement 3A</xref>, <xref ref-type="fig" rid="fig6s3">Figure 6—figure supplement 3D</xref>).</p></sec></sec><sec id="s3" sec-type="discussion"><title>Discussion</title><p>We have developed a new computational approach for analysing multiple CyTOF batches implemented in the CytofRUV R package. We showed how CytofRUV can reduce batch effects in three different datasets across multiple batches. Our method allows pooling of data from a large number of patients and conditions run across multiple batches, thereby enabling the integration of multiple CyTOF datasets.</p><p>Our approach adapts the RUV-III procedure to CyTOF by exploiting pseudo-replicates. We began by examining the batch effects found in CyTOF by comparing data from samples replicated across batches. To do this, we build an R-Shiny interface that highlights the presence of any batch effects in replicated samples using four different diagnostic plots: Median Protein Expression, Protein Expression Distributions, Clustering Results and Cluster Proportions. Finally, we compare CytofRUV with the two recently developed methods, BatchAdjust and CytoNorm, using three different datasets. Our results suggest that not only does CytofRUV frequently do better at removing unwanted variation in measured protein expression, making the distributions of these quantities more uniform across batches, but it also enhances the detection of biologically important differences embodied in the data across batches.</p><p>Using replicated samples to assess intra-site reproducibility and differences due to technical variation, we first showed how batch differences in protein expression in CyTOF datasets consisting of several CyTOF batches are comparable to biologically relevant differences within a single batch. In that context, confidently detecting of the impact of diverse treatments on distinct CLL cellular phenotypes would not be possible without correcting for such batch effects.</p><p>We developed an interactive R-Shiny application that exhibits batch effects in CyTOF studies. Different diagnostic plots can be selected by the user to display any batch effects on CyTOF data before and after normalisation.</p><p>We showed that not only are batch effects found in individual protein expression values which was also found in <xref ref-type="bibr" rid="bib18">Schuyler et al., 2019</xref>, but also that batch differences affect samples differently. We observed the impact of batch differences on cell subtypes identification and how protein distributions are affected differently within cluster, something that was also found by <xref ref-type="bibr" rid="bib22">Van Gassen et al., 2019</xref>. This suggests that it will not be sufficient to apply a single batch adjustment to the measurements on all cells, as is performed in BatchAdjust (<xref ref-type="bibr" rid="bib18">Schuyler et al., 2019</xref>). We also noticed changes in the cluster abundances across batches.</p><p>RUV-III has been successfully applied to the Nanostring nCounter gene expression platform (<xref ref-type="bibr" rid="bib14">Molania et al., 2019</xref>) and to single-cell RNA-seq data (<xref ref-type="bibr" rid="bib11">Lin et al., 2019</xref>). Here, we adapted RUV-III to CyTOF data using as pseudo-replicates the cells of clusters in the different batches, and taking the collection of all protein expression values as ‘negative controls’. We refer to the section ‘Selection of negative control genes’ (<xref ref-type="bibr" rid="bib14">Molania et al., 2019</xref>) for this last point. Here, as there and in other contexts, before/after normalisation comparisons indicate that this can be effective. Our method is adaptable and flexible in that it allows the user to select different normalisations: it can be implemented for one or several replicated reference samples, it can also normalise specific clusters or all clusters, and the dimension (k) of the unwanted variation can vary. In all cases, the user can visualise the diagnostic plots to assess the effectiveness of their normalisation. An important step of our method is the identification of biological subpopulations prior to normalisation, as this guides the selection of some or all clusters to define pseudo-replicates across batches.</p><p>To assess the abilities of CytofRUV, BatchAdjust and CytoNorm to remove batch effects, we computed three statistical metrics. We first compared the distributions of proteins across batches for replicated samples using EMD. Second, to assess how well each method corrects for differences in cluster proportions across batches, we computed the Hellinger distance between the paired cluster proportions of all replicated samples. Finally, to assess whether each method not only removes batch effects but preserves the biology, we computed Silhouette scores that quantify the cell-to-cell variation within cluster in relation to that between clusters.</p><p>Overall, CytofRUV had the best capability to make protein expression distributions more similar across batches. When compared with BatchAdjust and CytoNorm on different datasets it has the lowest EMD for all proteins for most samples in all three datasets and all four analyses performed, followed by CytoNorm. We further saw that batch differences are reduced within clusters by computing EMD by cluster for all proteins. We also saw CytoNorm’s ability to correct for differences in cluster proportions as well as CytofRUV, both having the lowest Hellinger distances in two of the four analyses performed. Silhouette scores also indicate that in most of our analyses (two out of the three datasets) CytofRUV not only removes the batch effects but also improves biological accuracy of the clusters compared to the two other methods. Likewise, CytoNorm is performing well according to Silhouette scores in the second analysis of the third dataset. We also conclude that BatchAdjust has the least ability to remove batch effects in the three datasets we have explored here, according to those metrics. This conclusion might be a result the single batch adjustment performed by BatchAdjust to the measurements on all cells, whereas CytoNorm and CytofRUV both take into account the impact of batch differences at the cluster level.</p><p>We envisage that in some cases removing batch effects might lead to removal of clusters or to the identification of new biologically relevant clusters. Some clusters could be artefacts of the batch effects. We use s<sub>biology</sub> to determine the tightness and separation of the clustering, as it provides an evaluation of the clustering validity.</p><p>We observed that the B cell cluster (<xref ref-type="fig" rid="fig3">Figure 3A</xref>, cluster 16) is only present in the batch 1 of the CLL1 sample, and CytofRUV normalisation leads to the presence of this cluster (<xref ref-type="fig" rid="fig3">Figure 3C</xref>, cluster 2) in both batches. In practise, the user should examine and identify any new clusters post-normalisation, as some clusters might not be conserved after normalisation, and relate those to the clusters that were selected as pseudo-replicates. We also recommend the exploration of different clustering resolutions and how they change as the number of clusters increases, using clustering tree visualisation (<xref ref-type="bibr" rid="bib25">Zappia and Oshlack, 2018</xref>) to relate the clusters pre and post-normalisation.</p><p>To further quantify the extend of batch effects in CyTOF datasets, it might be interesting to perform differential analyses of replicates across batches. Recent methods like diffcyt (<xref ref-type="bibr" rid="bib23">Weber et al., 2019</xref>) have been developed that also uses FlowSOM for clustering to define cell populations, and empirical Bayes moderated tests adapted from transcriptomics for differential analysis. This method could be adapted to test for differential abundances of cell subpopulations and differential expression of proteins in the replicated samples across batches. In our first dataset containing two batches, differential analysis of protein expression is not suitable as we have too few replicates to permit a useful statistical test. However, we computed the differences in median expression for all proteins across batches before compared to that after CytofRUV normalisation for the CLL samples (ΔΔ, <xref ref-type="fig" rid="fig3s4">Figure 3—figure supplement 4</xref>.A) and the HC samples (ΔΔ, <xref ref-type="fig" rid="fig3s4">Figure 3—figure supplement 4.B</xref>). We observed that ΔΔ &gt; 0 for most proteins especially for the CLL samples indicating reduction in batch differences. We did perform a differential analysis of the cluster abundances across batches using diffcyt and compare the results before and after normalisation. We also observed a decrease in the number of clusters that were found to have a significant difference in abundance across batches before normalisation (13 out of the 20 clusters) compared to that in the data after CytofNorm (7 out of 20 clusters).</p><p>One limitation of our method is that CytofRUV does rely on the assumption that at least one cell subpopulation is shared across the batches that would be used as our pseudo-replicates.</p><p>In experiments where large batch effects occur and no cell subpopulation is shared between batches, our method would not be applicable.</p><p>In this study, we considered three different datasets containing up to 24 samples and up to 12 batches. RUV methods have already been applied to hundreds and thousands of samples with Nanostring technology (<xref ref-type="bibr" rid="bib14">Molania et al., 2019</xref>) and hundreds of samples with RNAseq. CytofRUV can also handle larger studies, and no memory limitation has been reached so far on other datasets containing hundreds of samples across several batches with up to 43 milllion cells. We ran the current analysis on a rstudio-server version 1.3.959–1 Professional for CentOS 6, taking about an hour per dataset, and we also tested it on other rstudio versions. Future work will involve collecting data from larger studies with more than dozens of batches to conduct further testing of memory limitations.</p><p>A requirement of the current CytofRUV method is the availability of enough material to have replicated reference samples in each batch. As previously mentioned for CytoNorm, and as we also observed for CytofRUV, in order to remove batch effects from all samples, it might be necessary to include more than one set of replicated references samples in the batch, in particular including samples that are similar to each of the main types of samples. In future work, we plan to explore estimating the unwanted variation using different replicated reference samples, each present in only some of the batches, to avoid the need for replicated reference samples in every batch. For example, the use of a carefully designed ‘bridging’ set of replicated reference samples analogous to long term reference samples in metabolomics (<xref ref-type="bibr" rid="bib4">Broadhurst et al., 2018</xref>) should lead to the normalisation of large studies that is just as effective as that achieved using the same replicated reference samples throughout.</p><p>In summary, we proposed here a computational algorithm called CytofRUV that effectively enables batch effect reduction in mass cytometry with an adaptable normalisation method that detects heterogeneity of cellular responses across large-scale studies with multiple patients, cell types and conditions (e.g. treatment).</p></sec><sec id="s4" sec-type="materials|methods"><title>Materials and methods</title><sec id="s4-1"><title>CytofRUV</title><p>To remove the unwanted variation across multiple datasets and batches, we used fastRUV-III as previously described (<xref ref-type="bibr" rid="bib11">Lin et al., 2019</xref>; <xref ref-type="bibr" rid="bib14">Molania et al., 2019</xref>). Briefly, the data are first standardised before being fitted to the RUV-III model underlying all RUV analyses:<disp-formula id="equ1"><mml:math id="m1"><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>β</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo> <mml:mi/><mml:msub><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></disp-formula></p><p>Here, <inline-formula><mml:math id="inf1"><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is the standardised expression value (arcsinh(intensity/5)) for protein <italic>j</italic> in a cell <italic>i</italic> with <inline-formula><mml:math id="inf2"><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo> <mml:mi/><mml:mi>m</mml:mi> <mml:mi/><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">d</mml:mi> <mml:mi/><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo> <mml:mi/><mml:mi>n</mml:mi></mml:math></inline-formula>, of <italic>m</italic> cells and <italic>n</italic> proteins. The standardisation is to have zero mean and unit standard deviation across all cells for all protein measurements.</p><p><inline-formula><mml:math id="inf3"><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> represents the factors of interest for the sample giving cell <italic>i</italic>. <inline-formula><mml:math id="inf4"><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> represents the unwanted factors for that cell. The dimension of the unwanted factors is being denoted by <italic>k</italic><inline-formula><mml:math id="inf5"><mml:mo>,</mml:mo> <mml:mi/><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> represents the coefficient of <inline-formula><mml:math id="inf6"><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> for protein <italic>j</italic> in a cell <italic>i</italic> and <inline-formula><mml:math id="inf7"><mml:msub><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub> <mml:mi/></mml:math></inline-formula> is noise, typically <inline-formula><mml:math id="inf8"><mml:msub><mml:mrow><mml:mi>ε</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi> <mml:mi/></mml:mrow></mml:msub><mml:mo>~</mml:mo> <mml:mi/></mml:math></inline-formula><italic>N</italic>(<italic>0, σ<sub>j</sub><sup>2</sup></italic>).</p><p>The data are normalised in six steps. First, all the data are clustered, typically using FlowSOM, although other clustering methods can be used. Second, group of cells are defined to be pseudo-replicates if they belong to the same subpopulation (i.e. cluster) but are in different batches, which can be done either on specific clusters or on all clusters. Third, cell-level residuals are computed by averaging all the protein measurements across those pseudo-replicates, and subtracting these averages from each measurement on each cell. In essence, differences of measurements on pseudo-replicates are considered as unwanted variation. The quantities <inline-formula><mml:math id="inf9"><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> are then estimated from the singular value decomposition (SVD) of the <italic>m x n</italic> matrix of these residuals. Next the <italic>k</italic>-vectors of <inline-formula><mml:math id="inf10"><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> for the cells are then estimated using <italic>all</italic> proteins as 'negative controls'. Finally, the estimates of <inline-formula><mml:math id="inf11"><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf12"><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub> <mml:mi/></mml:math></inline-formula> are multiplied to get an estimate of <inline-formula><mml:math id="inf13"><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>α</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo> <mml:mi/></mml:math></inline-formula> which is then subtracted from the <inline-formula><mml:math id="inf14"><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> to get the final adjusted data. Full details and a discussion of key issues can be found in <xref ref-type="bibr" rid="bib11">Lin et al., 2019</xref> and <xref ref-type="bibr" rid="bib14">Molania et al., 2019</xref>.</p></sec><sec id="s4-2"><title>BatchAdjust</title><p>For all the datasets, BatchAdjust was performed using the R code and usage instructions as described in <xref ref-type="bibr" rid="bib18">Schuyler et al., 2019</xref>. We used the option of scaling the 95th percentiles with no transformation applied to the data before adjustment.</p></sec><sec id="s4-3"><title>CytoNorm</title><p>CytoNorm was performed as described in <xref ref-type="bibr" rid="bib22">Van Gassen et al., 2019</xref> following the two steps provided in the R library CytoNorm to normalise the data.</p></sec><sec id="s4-4"><title>Earth Movers Distance</title><p>To quantify the similarity of protein expression distributions across batches, we computed the Earth Movers Distance, also called the Wasserstein metric, as described in <xref ref-type="bibr" rid="bib22">Van Gassen et al., 2019</xref>. Briefly, the data are binned and we computed the pairwise EMDs across batches for the distribution of every protein over all cells as well as over the cells in each cluster. This was done for both the original dataset and the normalised datasets.</p></sec><sec id="s4-5"><title>Hellinger distance</title><p>To quantify the differences between cluster proportions across batches, we computed the Hellinger distances between the proportions found in samples replicated across different batches. This distance is defined for two probability <inline-formula><mml:math id="inf15"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf16"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>q</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> by <inline-formula><mml:math id="inf17"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>H</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>q</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>, where <inline-formula><mml:math id="inf18"> <mml:mi/><mml:msup><mml:mrow><mml:mi>H</mml:mi><mml:mo>(</mml:mo><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>q</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mrow><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msqrt><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:msqrt><mml:mo>-</mml:mo> <mml:mi/><mml:msqrt><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:msqrt><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mrow><mml:mo>.</mml:mo></mml:math></inline-formula></p><p>We computed these distances for both the original and the normalised datasets.</p></sec><sec id="s4-6"><title>Silhouette scores</title><p>To assess the extent to which the data are grouped based on the batch effects as opposed to biological signals, we computed batch and biology Silhouette scores. Given a partitioning of all cells into groups, if <inline-formula><mml:math id="inf19"><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub> <mml:mi/></mml:math></inline-formula> denote the average Euclidean distance of the protein expression between the cell <italic>i</italic> and all other cells in the group to which cell <italic>i</italic> is assigned, and <inline-formula><mml:math id="inf20"><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is the minimum of the average distance between the cell <italic>i</italic> and any cells in other groups not containing cell <italic>i</italic>, then the silhouette coefficient of cell <italic>i</italic> is calculated as<disp-formula id="equ2"><mml:math id="m2"><mml:mi mathvariant="normal">s</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="normal">max</mml:mi></mml:mrow><mml:mo>⁡</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mfrac></mml:math></disp-formula></p><p>The average of the silhouette values across cells using a particular grouping is called the silhouette score for that grouping. Silhouette score ranges from −1 to +one where positive values (<italic>b<sub>i</sub></italic> is high and <italic>a<sub>i</sub></italic> is low) indicate that cells are well matched to their own group. In this way, we computed the silhouette score s<sub>batch</sub> based on the batches as groups and the silhouette score s<sub>biology</sub> based on the grouping of the cells by subpopulation (i.e. clusters).</p><p>s<sub>biology</sub> is used to quantify the cell-to-cell variation within cell subpopulations compared to other subpopulations. Negative values mean that the data might be mis-clustered as it is more similar to a neighbouring cluster. For example, if two different biological relevant clusters would be merged into a single cluster, s<sub>biology</sub> will reflect this merging with a lower s<sub>biology</sub> value.</p></sec><sec id="s4-7"><title>Differential analysis</title><p>To perform a differential analysis of the cluster abundances across batches, we used diffcyt with the default method 'diffcyt-DA-edgeR' and default parameters with batch as the factor of interest for the differential tests. We performed this analysis both on the data before and after normalisation and calculated the number of significant detected clusters at 10% false discovery rate as described in the diffcyt workflow.</p><p>As the differential expression of proteins could not be performed with too few replicates, as with a t-test, we computed the medians M<italic><sub>m,b</sub></italic> for each marker <italic>m</italic> and each batch <italic>b</italic> across the 12 paired samples in a given cluster. We then computed the difference of medians between batches <inline-formula><mml:math id="inf21"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>,</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mtext> </mml:mtext><mml:mo>−</mml:mo><mml:mtext> </mml:mtext><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> across the 12 paired samples. We computed those differences <inline-formula><mml:math id="inf22"><mml:mo>∆</mml:mo><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>w</mml:mi></mml:math></inline-formula> on the data before and <inline-formula><mml:math id="inf23"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>n</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> after normalisation and then plotted the difference of those values, that is <inline-formula><mml:math id="inf24"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi mathvariant="normal">Δ</mml:mi><mml:mo>=</mml:mo><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>w</mml:mi><mml:mo>−</mml:mo><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>n</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> in <xref ref-type="fig" rid="fig3s4">Figure 3—figure supplement 4</xref>.</p></sec><sec id="s4-8"><title>R package CytofRUV</title><p>Our algorithm is implemented in the R package ‘CytofRUV’ and is available at:(<ext-link ext-link-type="uri" xlink:href="http://www.github.com/mtrussart/CytofRUV">www.github.com/mtrussart/CytofRUV</ext-link>) (<xref ref-type="bibr" rid="bib20">Trussart, 2020</xref>). Installation and R code usage instructions for both the R package and the R-Shiny application can be found on the GitHub page. Users are required to provide: the FCS files from all samples in the study, a metadata file containing the details of each sample and a panel file containing the details of all proteins used in the study. The R-Shiny application allows the user to explore the data and identify batch effects across replicates using the diagnostic plots previously mentioned: Median Protein Expression, Protein Expression Distributions, Clustering Results and Cluster Proportions using samples replicated across batches. It can be explored on all the data or on a subsample of the data. The normalize_data function allow the user to adjust for batch effects with parameter settings for the CytofRUV algorithm, such as which replicated samples to use and the value of k. The pipeline and scripts used to generate the results described in this manuscript is also available in the supplementary data.</p></sec><sec id="s4-9"><title>PBMC samples from patient and healthy donor</title><p>Blood was obtained from healthy donors (via the Victorian Donor Blood Registry) and patients with CLL (via the Royal Melbourne Hospital, Australia). All patients consented under Melbourne Health HREC 2016.305 and samples were analysed under HREC 2016.066. PBMCs were isolated using standard Ficoll-based methods and cryopreserved.</p></sec><sec id="s4-10"><title>Mass cytometry</title><p>Cells were thawed and stained for viability with cisplatin. Cells were then fixed with paraformaldehyde (PFA: Electron Microscopy Sciences, Hatfield, PA, USA) to a final concentration of 1.6% for 10 min at room temperature. Cells were pelleted and washed once with cell staining medium (CSM, PBS with 0.5% BSA and 0.02% sodium azide) to remove residual PFA and stored at −80°C.</p><p>Cells were barcoded using 20-plex palladium barcoding according to manufacturer’s instructions (Fluidigm, South San Francisco, CA, USA). Following barcoding, cells were pelleted and washed once with cell staining medium (PBS with 0.5% BSA and 0.02% sodium azide) to remove residual PFA. Cells were stained with CD16/CD32 for 10 min and surface antibodies (<xref ref-type="table" rid="table2">Table 2</xref>) for 30 min at room temperature. Cells were permeabilized with 4°C methanol for 10 min. Cells were washed three times with CSM and stained with intracellular antibodies (<xref ref-type="table" rid="table2">Table 2</xref>) for 30 min at room temperature. Cells were washed with CSM, then stained with 125 nm <sup>191</sup>Ir/<sup>193</sup>Ir DNA intercalator (Fluidigm, South San Francisco, CA, USA) in PBS with 1.6% PFA at 4°C overnight. Cells were washed once with CSM, washed three times with double-distilled water and filtered to remove aggregates and resuspended with EQ normalisation beads immediately before analysis using a Helios mass cytometer (Fluidigm, South San Francisco, CA, USA). Throughout the analysis, cells were maintained at 4°C and introduced at a constant rate of ~300 cells/sec.</p></sec><sec id="s4-11"><title>Processing data for mass cytometry</title><p>Data concatenation, normalisation and debarcoding are done using the R Catalyst package merging the two batches (RUV_1B and RUV3B) when applying the Finck normalisation. The R script used to generate this preprocessing (CytofRUV_preprocessing_dataset.R) is also available in the supplementary data.</p></sec><sec id="s4-12"><title>Flow repository</title><p>The FCS files from this study are available at flow repository ID FR-FCM-Z2L2.</p></sec></sec></body><back><ack id="ack"><title>Acknowledgements</title><p>MT and TPS were supported by NHMRC Program Grant 1054618. DHDG is supported by a NHMRC Senior Research Fellowship (1158024), a Cancer Council of Victoria Grant-in-aid (1146518) and support from the Victorian Comprehensive Cancer Centre. CET is supported by an Australian NHMRC Early Career Fellowship (1089072).</p><p>We are grateful to Dr MaryAnn Anderson and Prof Andrew Roberts for the provision of patient material.</p><p>This work was made possible through Victorian State Government Operational Infrastructure Support and Australian Government NHMRC IRIISS. The authors thank Dr Andrew Mitchell (University of Melbourne) for assistance with mass cytometry maintenance/operation. This work was performed in part at the Materials Characterisation and Fabrication Platform (MCFP) at the University of Melbourne and the Victorian Node of the Australian National Fabrication Facility (ANFF).</p><p>We thank Prof. Damien Hicks, Dr Chris Woodruff and Dr Ramyar Molina for their suggestions during this study. We thank Dr Anna Quaglieri for her suggestions concerning the CytofRUV R package. We also thank Prof. Ronald P Schuyler, Prof. Debashis Ghosh, Prof. Elena Hsieh, Ms Helena Crowell, Prof. Jean Yang, Yingxin Lin and Dr Greg Finak as well as the reviewers for their helpful comments on the manuscript.</p></ack><sec id="s5" sec-type="additional-information"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="COI-statement" id="conf1"><p>No competing interests declared</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>Conceptualization, Data curation, Software, Formal analysis, Supervision, Validation, Visualization, Methodology, Writing - original draft, Writing - review and editing</p></fn><fn fn-type="con" id="con2"><p>Conceptualization, Resources, Formal analysis, Supervision, Funding acquisition, Validation, Investigation, Methodology, Project administration, Writing - review and editing</p></fn><fn fn-type="con" id="con3"><p>Investigation</p></fn><fn fn-type="con" id="con4"><p>Data curation, Software</p></fn><fn fn-type="con" id="con5"><p>Conceptualization, Resources, Supervision, Funding acquisition, Methodology, Project administration, Writing - review and editing</p></fn><fn fn-type="con" id="con6"><p>Conceptualization, Resources, Supervision, Funding acquisition, Validation, Methodology, Project administration, Writing - review and editing</p></fn></fn-group><fn-group content-type="ethics-information"><title>Ethics</title><fn fn-type="other" id="fn1"><p>Human subjects: All patients provided written informed consent and the study was approved by Human Research Ethics Committees/Institutional Review Boards: RMH (2005.008, 2012.244, 2016.305,2016.066) and the Walter and Eliza Hall Institute (G15/05).</p></fn></fn-group></sec><sec id="s6" sec-type="supplementary-material"><title>Additional files</title><supplementary-material id="transrepform"><label>Transparent reporting form</label><media mime-subtype="docx" mimetype="application" xlink:href="elife-59630-transrepform-v2.docx"/></supplementary-material></sec><sec id="s7" sec-type="data-availability"><title>Data availability</title><p>The fcs files from this study are available at Flow Repository, ID FR-FCM-Z2L2.</p><p>The following dataset was generated:</p><p><element-citation id="dataset1" publication-type="data" specific-use="isSupplementedBy"><person-group person-group-type="author"><name><surname>Trussart</surname><given-names>M</given-names></name><name><surname>Teh</surname><given-names>CE</given-names></name><name><surname>Tan</surname><given-names>T</given-names></name><name><surname>Leong</surname><given-names>L</given-names></name><name><surname>Gray</surname><given-names>DHD</given-names></name><name><surname>Speed</surname><given-names>TP</given-names></name></person-group><year iso-8601-date="2020">2020</year><data-title>CytofRUV dataset</data-title><source>FlowRepository</source><pub-id assigning-authority="other" pub-id-type="accession" xlink:href="http://flowrepository.org/id/FR-FCM-Z2L2">FR-FCM-Z2L2</pub-id></element-citation></p><p>The following previously published dataset was used:</p><p><element-citation id="dataset2" publication-type="data" specific-use="references"><person-group person-group-type="author"><name><surname>Gassen</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2019">2019</year><data-title>Immune Clock of Pregnancy Validation - Controls</data-title><source>FlowRepository</source><pub-id assigning-authority="other" pub-id-type="accession" xlink:href="http://flowrepository.org/id/FR-FCM-Z247">FR-FCM-Z247</pub-id></element-citation></p></sec><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Agarwal</surname> <given-names>R</given-names></name><name><surname>Chan</surname> <given-names>Y-C</given-names></name><name><surname>Tam</surname> <given-names>CS</given-names></name><name><surname>Hunter</surname> <given-names>T</given-names></name><name><surname>Vassiliadis</surname> <given-names>D</given-names></name><name><surname>Teh</surname> <given-names>CE</given-names></name><name><surname>Thijssen</surname> <given-names>R</given-names></name><name><surname>Yeh</surname> <given-names>P</given-names></name><name><surname>Wong</surname> <given-names>SQ</given-names></name><name><surname>Ftouni</surname> <given-names>S</given-names></name><name><surname>Lam</surname> <given-names>EYN</given-names></name><name><surname>Anderson</surname> <given-names>MA</given-names></name><name><surname>Pott</surname> <given-names>C</given-names></name><name><surname>Gilan</surname> <given-names>O</given-names></name><name><surname>Bell</surname> <given-names>CC</given-names></name><name><surname>Knezevic</surname> <given-names>K</given-names></name><name><surname>Blombery</surname> <given-names>P</given-names></name><name><surname>Rayeroux</surname> <given-names>K</given-names></name><name><surname>Zordan</surname> <given-names>A</given-names></name><name><surname>Li</surname> <given-names>J</given-names></name><name><surname>Huang</surname> <given-names>DCS</given-names></name><name><surname>Wall</surname> <given-names>M</given-names></name><name><surname>Seymour</surname> <given-names>JF</given-names></name><name><surname>Gray</surname> <given-names>DHD</given-names></name><name><surname>Roberts</surname> <given-names>AW</given-names></name><name><surname>Dawson</surname> <given-names>MA</given-names></name><name><surname>Dawson</surname> <given-names>S-J</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Dynamic molecular monitoring reveals that SWI–SNF mutations mediate resistance to ibrutinib plus venetoclax in mantle cell lymphoma</article-title><source>Nature Medicine</source><volume>25</volume><fpage>119</fpage><lpage>129</lpage><pub-id pub-id-type="doi">10.1038/s41591-018-0243-z</pub-id></element-citation></ref><ref id="bib2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bandura</surname> <given-names>DR</given-names></name><name><surname>Baranov</surname> <given-names>VI</given-names></name><name><surname>Ornatsky</surname> <given-names>OI</given-names></name><name><surname>Antonov</surname> <given-names>A</given-names></name><name><surname>Kinach</surname> <given-names>R</given-names></name><name><surname>Lou</surname> <given-names>X</given-names></name><name><surname>Pavlov</surname> <given-names>S</given-names></name><name><surname>Vorobiev</surname> <given-names>S</given-names></name><name><surname>Dick</surname> <given-names>JE</given-names></name><name><surname>Tanner</surname> <given-names>SD</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Mass cytometry: technique for real time single cell multitarget immunoassay based on inductively coupled plasma time-of-flight mass spectrometry</article-title><source>Analytical Chemistry</source><volume>81</volume><fpage>6813</fpage><lpage>6822</lpage><pub-id pub-id-type="doi">10.1021/ac901049w</pub-id><pub-id pub-id-type="pmid">19601617</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Blombery</surname> <given-names>P</given-names></name><name><surname>Anderson</surname> <given-names>MA</given-names></name><name><surname>Gong</surname> <given-names>JN</given-names></name><name><surname>Thijssen</surname> <given-names>R</given-names></name><name><surname>Birkinshaw</surname> <given-names>RW</given-names></name><name><surname>Thompson</surname> <given-names>ER</given-names></name><name><surname>Teh</surname> <given-names>CE</given-names></name><name><surname>Nguyen</surname> <given-names>T</given-names></name><name><surname>Xu</surname> <given-names>Z</given-names></name><name><surname>Flensburg</surname> <given-names>C</given-names></name><name><surname>Lew</surname> <given-names>TE</given-names></name><name><surname>Majewski</surname> <given-names>IJ</given-names></name><name><surname>Gray</surname> <given-names>DHD</given-names></name><name><surname>Westerman</surname> <given-names>DA</given-names></name><name><surname>Tam</surname> <given-names>CS</given-names></name><name><surname>Seymour</surname> <given-names>JF</given-names></name><name><surname>Czabotar</surname> <given-names>PE</given-names></name><name><surname>Huang</surname> <given-names>DCS</given-names></name><name><surname>Roberts</surname> <given-names>AW</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Acquisition of the recurrent Gly101Val mutation in BCL2 confers resistance to venetoclax in patients with progressive chronic lymphocytic leukemia</article-title><source>Cancer Discovery</source><volume>9</volume><fpage>342</fpage><lpage>353</lpage><pub-id pub-id-type="doi">10.1158/2159-8290.CD-18-1119</pub-id><pub-id pub-id-type="pmid">30514704</pub-id></element-citation></ref><ref id="bib4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Broadhurst</surname> <given-names>D</given-names></name><name><surname>Goodacre</surname> <given-names>R</given-names></name><name><surname>Reinke</surname> <given-names>SN</given-names></name><name><surname>Kuligowski</surname> <given-names>J</given-names></name><name><surname>Wilson</surname> <given-names>ID</given-names></name><name><surname>Lewis</surname> <given-names>MR</given-names></name><name><surname>Dunn</surname> <given-names>WB</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Guidelines and considerations for the use of system suitability and quality control samples in mass spectrometry assays applied in untargeted clinical metabolomic studies</article-title><source>Metabolomics</source><volume>14</volume><elocation-id>72</elocation-id><pub-id pub-id-type="doi">10.1007/s11306-018-1367-3</pub-id><pub-id pub-id-type="pmid">29805336</pub-id></element-citation></ref><ref id="bib5"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Crowell HL</surname> <given-names>RM</given-names></name><name><surname>Zanotelli</surname> <given-names>VR</given-names></name><name><surname>Chevrier</surname> <given-names>S</given-names></name><name><surname>Bodenmiller</surname> <given-names>B</given-names></name></person-group><year iso-8601-date="2017">2017</year><data-title>CATALYST: Cytometry dATa anALYSis Tools</data-title><version designator="1.12.2">1.12.2</version><publisher-name>R package</publisher-name><ext-link ext-link-type="uri" xlink:href="https://github.com/HelenaLC/CATALYST">https://github.com/HelenaLC/CATALYST</ext-link></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Finak</surname> <given-names>G</given-names></name><name><surname>Langweiler</surname> <given-names>M</given-names></name><name><surname>Jaimes</surname> <given-names>M</given-names></name><name><surname>Malek</surname> <given-names>M</given-names></name><name><surname>Taghiyar</surname> <given-names>J</given-names></name><name><surname>Korin</surname> <given-names>Y</given-names></name><name><surname>Raddassi</surname> <given-names>K</given-names></name><name><surname>Devine</surname> <given-names>L</given-names></name><name><surname>Obermoser</surname> <given-names>G</given-names></name><name><surname>Pekalski</surname> <given-names>ML</given-names></name><name><surname>Pontikos</surname> <given-names>N</given-names></name><name><surname>Diaz</surname> <given-names>A</given-names></name><name><surname>Heck</surname> <given-names>S</given-names></name><name><surname>Villanova</surname> <given-names>F</given-names></name><name><surname>Terrazzini</surname> <given-names>N</given-names></name><name><surname>Kern</surname> <given-names>F</given-names></name><name><surname>Qian</surname> <given-names>Y</given-names></name><name><surname>Stanton</surname> <given-names>R</given-names></name><name><surname>Wang</surname> <given-names>K</given-names></name><name><surname>Brandes</surname> <given-names>A</given-names></name><name><surname>Ramey</surname> <given-names>J</given-names></name><name><surname>Aghaeepour</surname> <given-names>N</given-names></name><name><surname>Mosmann</surname> <given-names>T</given-names></name><name><surname>Scheuermann</surname> <given-names>RH</given-names></name><name><surname>Reed</surname> <given-names>E</given-names></name><name><surname>Palucka</surname> <given-names>K</given-names></name><name><surname>Pascual</surname> <given-names>V</given-names></name><name><surname>Blomberg</surname> <given-names>BB</given-names></name><name><surname>Nestle</surname> <given-names>F</given-names></name><name><surname>Nussenblatt</surname> <given-names>RB</given-names></name><name><surname>Brinkman</surname> <given-names>RR</given-names></name><name><surname>Gottardo</surname> <given-names>R</given-names></name><name><surname>Maecker</surname> <given-names>H</given-names></name><name><surname>McCoy</surname> <given-names>JP</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Standardizing flow cytometry immunophenotyping analysis from the human ImmunoPhenotyping consortium</article-title><source>Scientific Reports</source><volume>6</volume><elocation-id>20686</elocation-id><pub-id pub-id-type="doi">10.1038/srep20686</pub-id><pub-id pub-id-type="pmid">26861911</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Finck</surname> <given-names>R</given-names></name><name><surname>Simonds</surname> <given-names>EF</given-names></name><name><surname>Jager</surname> <given-names>A</given-names></name><name><surname>Krishnaswamy</surname> <given-names>S</given-names></name><name><surname>Sachs</surname> <given-names>K</given-names></name><name><surname>Fantl</surname> <given-names>W</given-names></name><name><surname>Pe'er</surname> <given-names>D</given-names></name><name><surname>Nolan</surname> <given-names>GP</given-names></name><name><surname>Bendall</surname> <given-names>SC</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Normalization of mass cytometry data with bead standards</article-title><source>Cytometry Part A</source><volume>83A</volume><fpage>483</fpage><lpage>494</lpage><pub-id pub-id-type="doi">10.1002/cyto.a.22271</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gagnon-Bartsch</surname> <given-names>JA</given-names></name><name><surname>Speed</surname> <given-names>TP</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Using control genes to correct for unwanted variation in microarray data</article-title><source>Biostatistics</source><volume>13</volume><fpage>539</fpage><lpage>552</lpage><pub-id pub-id-type="doi">10.1093/biostatistics/kxr034</pub-id><pub-id pub-id-type="pmid">22101192</pub-id></element-citation></ref><ref id="bib9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Leipold</surname> <given-names>MD</given-names></name><name><surname>Obermoser</surname> <given-names>G</given-names></name><name><surname>Fenwick</surname> <given-names>C</given-names></name><name><surname>Kleinstuber</surname> <given-names>K</given-names></name><name><surname>Rashidi</surname> <given-names>N</given-names></name><name><surname>McNevin</surname> <given-names>JP</given-names></name><name><surname>Nau</surname> <given-names>AN</given-names></name><name><surname>Wagar</surname> <given-names>LE</given-names></name><name><surname>Rozot</surname> <given-names>V</given-names></name><name><surname>Davis</surname> <given-names>MM</given-names></name><name><surname>DeRosa</surname> <given-names>S</given-names></name><name><surname>Pantaleo</surname> <given-names>G</given-names></name><name><surname>Scriba</surname> <given-names>TJ</given-names></name><name><surname>Walker</surname> <given-names>BD</given-names></name><name><surname>Olsen</surname> <given-names>LR</given-names></name><name><surname>Maecker</surname> <given-names>HT</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Comparison of CyTOF assays across sites: results of a six-center pilot study</article-title><source>Journal of Immunological Methods</source><volume>453</volume><fpage>37</fpage><lpage>43</lpage><pub-id pub-id-type="doi">10.1016/j.jim.2017.11.008</pub-id><pub-id pub-id-type="pmid">29174717</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Levine</surname> <given-names>JH</given-names></name><name><surname>Simonds</surname> <given-names>EF</given-names></name><name><surname>Bendall</surname> <given-names>SC</given-names></name><name><surname>Davis</surname> <given-names>KL</given-names></name><name><surname>Amir</surname> <given-names>AD</given-names></name><name><surname>Tadmor</surname> <given-names>MD</given-names></name><name><surname>Litvin</surname> <given-names>O</given-names></name><name><surname>Fienberg</surname> <given-names>HG</given-names></name><name><surname>Jager</surname> <given-names>A</given-names></name><name><surname>Zunder</surname> <given-names>ER</given-names></name><name><surname>Finck</surname> <given-names>R</given-names></name><name><surname>Gedman</surname> <given-names>AL</given-names></name><name><surname>Radtke</surname> <given-names>I</given-names></name><name><surname>Downing</surname> <given-names>JR</given-names></name><name><surname>Pe'er</surname> <given-names>D</given-names></name><name><surname>Nolan</surname> <given-names>GP</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Data-Driven phenotypic dissection of AML reveals Progenitor-like cells that correlate with prognosis</article-title><source>Cell</source><volume>162</volume><fpage>184</fpage><lpage>197</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2015.05.047</pub-id><pub-id pub-id-type="pmid">26095251</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lin</surname> <given-names>Y</given-names></name><name><surname>Ghazanfar</surname> <given-names>S</given-names></name><name><surname>Wang</surname> <given-names>KYX</given-names></name><name><surname>Gagnon-Bartsch</surname> <given-names>JA</given-names></name><name><surname>Lo</surname> <given-names>KK</given-names></name><name><surname>Su</surname> <given-names>X</given-names></name><name><surname>Han</surname> <given-names>ZG</given-names></name><name><surname>Ormerod</surname> <given-names>JT</given-names></name><name><surname>Speed</surname> <given-names>TP</given-names></name><name><surname>Yang</surname> <given-names>P</given-names></name><name><surname>Yang</surname> <given-names>JYH</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>scMerge leverages factor analysis, stable expression, and pseudoreplication to merge multiple single-cell RNA-seq datasets</article-title><source>PNAS</source><volume>116</volume><fpage>9775</fpage><lpage>9784</lpage><pub-id pub-id-type="doi">10.1073/pnas.1820006116</pub-id><pub-id pub-id-type="pmid">31028141</pub-id></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Maecker</surname> <given-names>HT</given-names></name><name><surname>McCoy</surname> <given-names>JP</given-names></name><name><surname>Nussenblatt</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Standardizing immunophenotyping for the human immunology project</article-title><source>Nature Reviews Immunology</source><volume>12</volume><fpage>191</fpage><lpage>200</lpage><pub-id pub-id-type="doi">10.1038/nri3158</pub-id><pub-id pub-id-type="pmid">22343568</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Majid</surname> <given-names>A</given-names></name><name><surname>Tsoulakis</surname> <given-names>O</given-names></name><name><surname>Walewska</surname> <given-names>R</given-names></name><name><surname>Gesk</surname> <given-names>S</given-names></name><name><surname>Siebert</surname> <given-names>R</given-names></name><name><surname>Kennedy</surname> <given-names>DB</given-names></name><name><surname>Dyer</surname> <given-names>MJ</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>BCL2 expression in chronic lymphocytic leukemia: lack of association with the BCL2 938A&gt;C promoter single nucleotide polymorphism</article-title><source>Blood</source><volume>111</volume><fpage>874</fpage><lpage>877</lpage><pub-id pub-id-type="doi">10.1182/blood-2007-07-098681</pub-id><pub-id pub-id-type="pmid">17959858</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Molania</surname> <given-names>R</given-names></name><name><surname>Gagnon-Bartsch</surname> <given-names>JA</given-names></name><name><surname>Dobrovic</surname> <given-names>A</given-names></name><name><surname>Speed</surname> <given-names>TP</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>A new normalization for nanostring nCounter gene expression data</article-title><source>Nucleic Acids Research</source><volume>47</volume><fpage>6073</fpage><lpage>6083</lpage><pub-id pub-id-type="doi">10.1093/nar/gkz433</pub-id><pub-id pub-id-type="pmid">31114909</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nowicka</surname> <given-names>M</given-names></name><name><surname>Krieg</surname> <given-names>C</given-names></name><name><surname>Crowell</surname> <given-names>HL</given-names></name><name><surname>Weber</surname> <given-names>LM</given-names></name><name><surname>Hartmann</surname> <given-names>FJ</given-names></name><name><surname>Guglietta</surname> <given-names>S</given-names></name><name><surname>Becher</surname> <given-names>B</given-names></name><name><surname>Levesque</surname> <given-names>MP</given-names></name><name><surname>Robinson</surname> <given-names>MD</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>CyTOF workflow: differential discovery in high-throughput high-dimensional cytometry datasets</article-title><source>F1000Research</source><volume>6</volume><elocation-id>748</elocation-id><pub-id pub-id-type="doi">10.12688/f1000research.11622.1</pub-id><pub-id pub-id-type="pmid">28663787</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Qiu</surname> <given-names>P</given-names></name><name><surname>Simonds</surname> <given-names>EF</given-names></name><name><surname>Bendall</surname> <given-names>SC</given-names></name><name><surname>Gibbs</surname> <given-names>KD</given-names></name><name><surname>Bruggner</surname> <given-names>RV</given-names></name><name><surname>Linderman</surname> <given-names>MD</given-names></name><name><surname>Sachs</surname> <given-names>K</given-names></name><name><surname>Nolan</surname> <given-names>GP</given-names></name><name><surname>Plevritis</surname> <given-names>SK</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Extracting a cellular hierarchy from high-dimensional cytometry data with SPADE</article-title><source>Nature Biotechnology</source><volume>29</volume><fpage>886</fpage><lpage>891</lpage><pub-id pub-id-type="doi">10.1038/nbt.1991</pub-id><pub-id pub-id-type="pmid">21964415</pub-id></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Risso</surname> <given-names>D</given-names></name><name><surname>Ngai</surname> <given-names>J</given-names></name><name><surname>Speed</surname> <given-names>TP</given-names></name><name><surname>Dudoit</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Normalization of RNA-seq data using factor analysis of control genes or samples</article-title><source>Nature Biotechnology</source><volume>32</volume><fpage>896</fpage><lpage>902</lpage><pub-id pub-id-type="doi">10.1038/nbt.2931</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schuyler</surname> <given-names>RP</given-names></name><name><surname>Jackson</surname> <given-names>C</given-names></name><name><surname>Garcia-Perez</surname> <given-names>JE</given-names></name><name><surname>Baxter</surname> <given-names>RM</given-names></name><name><surname>Ogolla</surname> <given-names>S</given-names></name><name><surname>Rochford</surname> <given-names>R</given-names></name><name><surname>Ghosh</surname> <given-names>D</given-names></name><name><surname>Rudra</surname> <given-names>P</given-names></name><name><surname>Hsieh</surname> <given-names>EWY</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Minimizing batch effects in mass cytometry data</article-title><source>Frontiers in Immunology</source><volume>10</volume><elocation-id>2367</elocation-id><pub-id pub-id-type="doi">10.3389/fimmu.2019.02367</pub-id><pub-id pub-id-type="pmid">31681275</pub-id></element-citation></ref><ref id="bib19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Teh</surname> <given-names>CE</given-names></name><name><surname>Gong</surname> <given-names>JN</given-names></name><name><surname>Segal</surname> <given-names>D</given-names></name><name><surname>Tan</surname> <given-names>T</given-names></name><name><surname>Vandenberg</surname> <given-names>CJ</given-names></name><name><surname>Fedele</surname> <given-names>PL</given-names></name><name><surname>Low</surname> <given-names>MSY</given-names></name><name><surname>Grigoriadis</surname> <given-names>G</given-names></name><name><surname>Harrison</surname> <given-names>SJ</given-names></name><name><surname>Strasser</surname> <given-names>A</given-names></name><name><surname>Roberts</surname> <given-names>AW</given-names></name><name><surname>Huang</surname> <given-names>DCS</given-names></name><name><surname>Nolan</surname> <given-names>GP</given-names></name><name><surname>Gray</surname> <given-names>DHD</given-names></name><name><surname>Ko</surname> <given-names>ME</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Deep profiling of apoptotic pathways with mass cytometry identifies a synergistic drug combination for killing myeloma cells</article-title><source>Cell Death &amp; Differentiation</source><volume>27</volume><fpage>2217</fpage><lpage>2233</lpage><pub-id pub-id-type="doi">10.1038/s41418-020-0498-z</pub-id><pub-id pub-id-type="pmid">31988495</pub-id></element-citation></ref><ref id="bib20"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Trussart</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2020">2020</year><data-title>CytofRUV: CytofRUV for analysing multiple CyTOF batches</data-title><version designator="0.1">0.1</version><publisher-name>R package</publisher-name><ext-link ext-link-type="uri" xlink:href="https://github.com/mtrussart/CytofRUV/">https://github.com/mtrussart/CytofRUV/</ext-link></element-citation></ref><ref id="bib21"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Van Gassen</surname> <given-names>S</given-names></name><name><surname>Callebaut</surname> <given-names>B</given-names></name><name><surname>Van Helden</surname> <given-names>MJ</given-names></name><name><surname>Lambrecht</surname> <given-names>BN</given-names></name><name><surname>Demeester</surname> <given-names>P</given-names></name><name><surname>Dhaene</surname> <given-names>T</given-names></name><name><surname>Saeys</surname> <given-names>Y</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>FlowSOM: using self-organizing maps for visualization and interpretation of cytometry data</article-title><source>Cytometry Part A</source><volume>87</volume><fpage>636</fpage><lpage>645</lpage><pub-id pub-id-type="doi">10.1002/cyto.a.22625</pub-id></element-citation></ref><ref id="bib22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Van Gassen</surname> <given-names>S</given-names></name><name><surname>Gaudilliere</surname> <given-names>B</given-names></name><name><surname>Angst</surname> <given-names>MS</given-names></name><name><surname>Saeys</surname> <given-names>Y</given-names></name><name><surname>Aghaeepour</surname> <given-names>N</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>CytoNorm: a normalization algorithm for cytometry data</article-title><source>Cytometry. A</source><volume>97</volume><elocation-id>23904</elocation-id><pub-id pub-id-type="doi">10.1002/cyto.a.23904</pub-id></element-citation></ref><ref id="bib23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Weber</surname> <given-names>LM</given-names></name><name><surname>Nowicka</surname> <given-names>M</given-names></name><name><surname>Soneson</surname> <given-names>C</given-names></name><name><surname>Robinson</surname> <given-names>MD</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Diffcyt: differential discovery in high-dimensional cytometry via high-resolution clustering</article-title><source>Communications Biology</source><volume>2</volume><elocation-id>183</elocation-id><pub-id pub-id-type="doi">10.1038/s42003-019-0415-5</pub-id><pub-id pub-id-type="pmid">31098416</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Weber</surname> <given-names>LM</given-names></name><name><surname>Robinson</surname> <given-names>MD</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Comparison of clustering methods for high-dimensional single-cell flow and mass cytometry data</article-title><source>Cytometry Part A</source><volume>89</volume><fpage>1084</fpage><lpage>1096</lpage><pub-id pub-id-type="doi">10.1002/cyto.a.23030</pub-id></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zappia</surname> <given-names>L</given-names></name><name><surname>Oshlack</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Clustering trees: a visualization for evaluating clusterings at multiple resolutions</article-title><source>GigaScience</source><volume>7</volume><elocation-id>giy083</elocation-id><pub-id pub-id-type="doi">10.1093/gigascience/giy083</pub-id></element-citation></ref></ref-list></back><sub-article article-type="decision-letter" id="sa1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.59630.sa1</article-id><title-group><article-title>Decision letter</article-title></title-group><contrib-group><contrib contrib-type="editor"><name><surname>Finak</surname><given-names>Greg</given-names></name><role>Reviewing Editor</role><aff><institution>Fred Hutchinson Cancer Research Center</institution><country>United States</country></aff></contrib></contrib-group><contrib-group><contrib contrib-type="reviewer"><name><surname>Aghaeepour</surname><given-names>Nima</given-names> </name><role>Reviewer</role></contrib><contrib contrib-type="reviewer"><name><surname>Belkina</surname><given-names>Anna</given-names> </name><role>Reviewer</role><aff><institution>Boston University School of Medicine</institution><country>United States</country></aff></contrib><contrib contrib-type="reviewer"><name><surname>Van Gassen</surname><given-names>Sofie</given-names> </name><role>Reviewer</role><aff><institution>Ugent Center for Inflammation Research</institution><country>Belgium</country></aff></contrib></contrib-group></front-stub><body><boxed-text><p>In the interests of transparency, eLife publishes the most substantive revision requests and the accompanying author responses.</p></boxed-text><p><bold>Acceptance summary:</bold></p><p>The work is an important contribution to the field of cytometry. It provides an objective and well thought out normalization procedure for mass cytometry and potentially even fluorescence flow cytometry.</p><p><bold>Decision letter after peer review:</bold></p><p>Thank you for submitting your article &quot;CytofRUV: Removing unwanted variation to integrate multiple CyTOF datasets&quot; for consideration by <italic>eLife</italic>. Your article has been reviewed by four peer reviewers, one of whom is a member of our Board of Reviewing Editors, and the evaluation has been overseen by Detlef Weigel as the Senior Editor. The following individuals involved in review of your submission have agreed to reveal their identity: Nima Aghaeepour (Reviewer #1); Anna Belkina (Reviewer #3); Sofie Van Gassen (Reviewer #4).</p><p>The reviewers have discussed the reviews with one another and the Reviewing Editor has drafted this decision to help you prepare a revised submission.</p><p>We would like to draw your attention to changes in our revision policy that we have made in response to COVID-19 (https://elifesciences.org/articles/57162). Specifically, we are asking editors to accept without delay manuscripts, like yours, that they judge can stand as <italic>eLife</italic> papers without additional data, even if they feel that they would make the manuscript stronger. Thus the revisions requested below only address clarity and presentation.</p><p>Summary:</p><p>The authors present a new Cytof normalization approach based on RUV III that has proven useful for other technologies including RNASeq, single-cell RNAseq and nanostring. The reviewers all agreed that this was a strong manuscript that makes an important contribution to an area of the field that remains under-served, and they unanimously recommended publication.</p><p>Essential revisions:</p><p>Several concerns arose during review that the authors should address to strengthen the results and improve the presentation.</p><p>1) Given the size of typical cytometry data sets (millions of cells and hundreds of samples), how does this approach scale? What are the limitations? The Discussion mentions large-scale studies, but how large in practice?</p><p>2) Most importantly, reviewers raised questions around the evaluation of the normalization procedures. Specifically, since the data are re-clustered after normalization, and performance of normalization was assessed against the re-clustered data (and while the reviewers agreed this made sense), they were concerned about how a negative impact of normalization could be assessed. Specifically, if normalization failed, leading to fusion of biologically relevant clusters post-normalization, how could that be detected? It was not clear that this would be captured by S<sub>biology</sub> (as pre- and post-normalization S<sub>biology</sub> measures are not compared), nor how and if the proposed figures and evaluation measures could be interpreted to detect this situation. The reviewers felt this aspect needed further exploration and discussion.</p><p>3) Finally the reviewers were looking for more guidance from the presentation around the relative ranking of the different methods. The authors should more clearly present their conclusions about the relative performance of the methods and state which methods are performing well or poorly and why, and if the results are not conclusive, this should be stated and explained.</p></body></sub-article><sub-article article-type="reply" id="sa2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.59630.sa2</article-id><title-group><article-title>Author response</article-title></title-group></front-stub><body><disp-quote content-type="editor-comment"><p>Essential revisions:</p><p>Several concerns arose during review that the authors should address to strengthen the results and improve the presentation.</p><p>1) Given the size of typical cytometry data sets (millions of cells and hundreds of samples), how does this approach scale? What are the limitations? The Discussion mentions large-scale studies, but how large in practice?</p></disp-quote><p>We thank the reviewers for their question and we updated the Discussion of the manuscript with more details regarding large-scale studies and their limitations in the revised manuscript.</p><p>“In this study we considered three different datasets containing up to 24 samples and up to 12 batches. […] For example, the use of a carefully designed “bridging” set of replicated reference samples analogous to long term reference samples in metabolomics (Broadhurst et al., 2018) should lead to the normalization of large studies that is just as effective as that achieved using the same replicated reference samples throughout.”</p><disp-quote content-type="editor-comment"><p>2) Most importantly, reviewers raised questions around the evaluation of the normalization procedures. Specifically, since the data are re-clustered after normalization, and performance of normalization was assessed against the re-clustered data (and while the reviewers agreed this made sense), they were concerned about how a negative impact of normalization could be assessed. Specifically, if normalization failed, leading to fusion of biologically relevant clusters post-normalization, how could that be detected? It was not clear that this would be captured by S<sub>biology</sub> (as pre- and post-normalization S<sub>biology</sub> measures are not compared), nor how and if the proposed figures and evaluation measures could be interpreted to detect this situation. The reviewers felt this aspect needed further exploration and discussion.</p></disp-quote><p>The reviewers are raising an important aspect to take into account in the evaluation of the normalization. We acknowledge that in some cases there might be loss of clusters or the identification of new biologically relevant clusters. An important aspect to take into account in this discussion is that the same number of clusters is conserved before and after normalization. To assess the performance of the normalization, we clarify out use of S<sub>biology</sub> and provide an example of how users can validate their clusters. We expanded the exploration and discussions of the questions raised here in the Discussion in the revised manuscript.</p><disp-quote content-type="editor-comment"><p>3) Finally the reviewers were looking for more guidance from the presentation around the relative ranking of the different methods. The authors should more clearly present their conclusions about the relative performance of the methods and state which methods are performing well or poorly and why, and if the results are not conclusive, this should be stated and explained.</p></disp-quote><p>We added more descriptions in the relative performance of each method for all three datasets (Results) and clearly stated the conclusions from those analysis in the Discussion in the revised manuscript.</p></body></sub-article></article>