<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD with MathML3 v1.3 20210610//EN"  "JATS-archivearticle1-3-mathml3.dtd"><article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.3"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn publication-format="electronic" pub-type="epub">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">106557</article-id><article-id pub-id-type="doi">10.7554/eLife.106557</article-id><article-id pub-id-type="doi" specific-use="version">10.7554/eLife.106557.3</article-id><article-version article-version-type="publication-state">version of record</article-version><article-categories><subj-group subj-group-type="display-channel"><subject>Tools and Resources</subject></subj-group><subj-group subj-group-type="heading"><subject>Computational and Systems Biology</subject></subj-group></article-categories><title-group><article-title>Unsupervised pipeline for the identification of cortical excitatory and inhibitory neurons in high-density multielectrode arrays with ground-truth validation</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Giraud</surname><given-names>Eloise</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund6"/><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author"><name><surname>Lynn</surname><given-names>Michael</given-names></name><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author"><name><surname>Vincent-Lamarre</surname><given-names>Philippe</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="con3"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author"><name><surname>Beique</surname><given-names>Jean-Claude</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0001-7278-4906</contrib-id><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="other" rid="fund2"/><xref ref-type="other" rid="fund3"/><xref ref-type="other" rid="fund4"/><xref ref-type="other" rid="fund7"/><xref ref-type="fn" rid="con4"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" corresp="yes"><name><surname>Thivierge</surname><given-names>Jean-Philippe</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-2457-7173</contrib-id><email>jthivier@uottawa.ca</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="other" rid="fund1"/><xref ref-type="other" rid="fund7"/><xref ref-type="fn" rid="con5"/><xref ref-type="fn" rid="conf1"/></contrib><aff id="aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/03c4mmv16</institution-id><institution>School of Psychology, University of Ottawa</institution></institution-wrap><addr-line><named-content content-type="city">Ottawa</named-content></addr-line><country>Canada</country></aff><aff id="aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/036s2ns10</institution-id><institution>uOttawa Brain and Mind Research Institute Center for Neural Dynamics, University of Ottawa</institution></institution-wrap><addr-line><named-content content-type="city">Ottawa</named-content></addr-line><country>Canada</country></aff><aff id="aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/03c4mmv16</institution-id><institution>Department of Cellular and Molecular Medicine, Faculty of Medicine, University of Ottawa</institution></institution-wrap><addr-line><named-content content-type="city">Ottawa</named-content></addr-line><country>Canada</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Scimemi</surname><given-names>Annalisa</given-names></name><role>Reviewing Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/012zs8222</institution-id><institution>University at Albany, State University of New York</institution></institution-wrap><country>United States</country></aff></contrib><contrib contrib-type="senior_editor"><name><surname>Poirazi</surname><given-names>Panayiota</given-names></name><role>Senior Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/01gzszr18</institution-id><institution>FORTH Institute of Molecular Biology and Biotechnology</institution></institution-wrap><country>Greece</country></aff></contrib></contrib-group><pub-date publication-format="electronic" date-type="publication"><day>28</day><month>08</month><year>2025</year></pub-date><volume>14</volume><elocation-id>RP106557</elocation-id><history><date date-type="sent-for-review" iso-8601-date="2025-03-15"><day>15</day><month>03</month><year>2025</year></date></history><pub-history><event><event-desc>This manuscript was published as a preprint.</event-desc><date date-type="preprint" iso-8601-date="2025-03-15"><day>15</day><month>03</month><year>2025</year></date><self-uri content-type="preprint" xlink:href="https://doi.org/10.1101/2025.03.14.643403"/></event><event><event-desc>This manuscript was published as a reviewed preprint.</event-desc><date date-type="reviewed-preprint" iso-8601-date="2025-06-17"><day>17</day><month>06</month><year>2025</year></date><self-uri content-type="reviewed-preprint" xlink:href="https://doi.org/10.7554/eLife.106557.1"/></event><event><event-desc>The reviewed preprint was revised.</event-desc><date date-type="reviewed-preprint" iso-8601-date="2025-08-13"><day>13</day><month>08</month><year>2025</year></date><self-uri content-type="reviewed-preprint" xlink:href="https://doi.org/10.7554/eLife.106557.2"/></event></pub-history><permissions><copyright-statement>© 2025, Giraud et al</copyright-statement><copyright-year>2025</copyright-year><copyright-holder>Giraud et al</copyright-holder><ali:free_to_read/><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><ali:license_ref>http://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-106557-v1.pdf"/><abstract><p>Large-scale extracellular recording techniques have advanced the study of neuronal circuits but lack methods to reliably identify cell types while scaling to thousands of neurons. We introduce spikeMAP, a pipeline for analyzing large-scale in vitro cortical recordings that combines spike sorting with cell-type identification using viral and optogenetic validation. SpikeMAP integrates data analysis with optogenetic, viral, and pharmacological protocols to dynamically probe distinct cell types while recording from large populations. The pipeline fits spike waveforms using spline interpolation to measure half-amplitude and peak-to-peak durations, applies principal component analysis and k-means clustering to isolate single-neuron signals, and uses linear discriminant analysis to optimize cluster separability. Channel source locations are determined through spatiotemporal spike waveform characteristics. Applied to mouse prefrontal cortex slices recorded on a 4096-channel array, spikeMAP effectively distinguishes regular-spiking excitatory neurons from fast-spiking inhibitory interneurons via action potential waveform, Fano factor, and spatial cross-correlations. This validated toolbox enables comprehensive characterization of neuronal activity across cell types in high-density recordings, offering a scalable approach to study microcircuit interactions in the brain.</p></abstract><kwd-group kwd-group-type="author-keywords"><kwd>spike sorting</kwd><kwd>optogenetics</kwd><kwd>multielectrodes</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research organism</title><kwd>Mouse</kwd></kwd-group><funding-group><award-group id="fund1"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000038</institution-id><institution>Natural Sciences and Engineering Research Council of Canada</institution></institution-wrap></funding-source><award-id>210977</award-id><principal-award-recipient><name><surname>Thivierge</surname><given-names>Jean-Philippe</given-names></name></principal-award-recipient></award-group><award-group id="fund2"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000038</institution-id><institution>Natural Sciences and Engineering Research Council of Canada</institution></institution-wrap></funding-source><award-id>210989</award-id><principal-award-recipient><name><surname>Beique</surname><given-names>Jean-Claude</given-names></name></principal-award-recipient></award-group><award-group id="fund3"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000038</institution-id><institution>Natural Sciences and Engineering Research Council of Canada</institution></institution-wrap></funding-source><award-id>2020-06901</award-id><principal-award-recipient><name><surname>Beique</surname><given-names>Jean-Claude</given-names></name></principal-award-recipient></award-group><award-group id="fund4"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000024</institution-id><institution>Canadian Institutes of Health Research</institution></institution-wrap></funding-source><award-id>175325</award-id><principal-award-recipient><name><surname>Beique</surname><given-names>Jean-Claude</given-names></name></principal-award-recipient></award-group><award-group id="fund5"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100003151</institution-id><institution>Fonds de recherche du Québec – Nature et technologies</institution></institution-wrap></funding-source><award-id>Doctoral scholarship</award-id><principal-award-recipient><name><surname>Giraud</surname><given-names>Eloise</given-names></name></principal-award-recipient></award-group><award-group id="fund6"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000038</institution-id><institution>Natural Sciences and Engineering Research Council of Canada</institution></institution-wrap></funding-source><award-id>CGS M scholarship</award-id><principal-award-recipient><name><surname>Giraud</surname><given-names>Eloise</given-names></name></principal-award-recipient></award-group><award-group id="fund7"><funding-source><institution-wrap><institution>University of Ottawa Brain and Mind Institute</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Beique</surname><given-names>Jean-Claude</given-names></name><name><surname>Thivierge</surname><given-names>Jean-Philippe</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>A novel software tool and ground-truth optogenetic validation is provided to automatically detect putative excitatory and inhibitory cells in neuronal recordings performed with large-scale multielectrode arrays.</meta-value></custom-meta><custom-meta specific-use="meta-only"><meta-name>publishing-route</meta-name><meta-value>prc</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>The advent of high-density, large-scale multielectrode array recordings has advanced our understanding of how populations of neurons represent and process information, offering crucial insights into complex network dynamics (<xref ref-type="bibr" rid="bib65">Riquelme et al., 2023</xref>; <xref ref-type="bibr" rid="bib25">Hemberger et al., 2019</xref>; <xref ref-type="bibr" rid="bib68">Shein-Idelson et al., 2017</xref>; <xref ref-type="bibr" rid="bib74">Thivierge et al., 2022</xref>). Furthermore, the use of silicon recording probes such as Neuropixels probes in vivo has helped uncover foundational principles of neural circuits in awake behaving mice (<xref ref-type="bibr" rid="bib37">Lak et al., 2020</xref>; <xref ref-type="bibr" rid="bib57">Peters et al., 2021</xref>). However, it remains a challenge to distinguish neuronal cell types based on their physiological properties alone, despite a growing appreciation for the importance of heterogeneous cell types in circuit-level computations (<xref ref-type="bibr" rid="bib72">Sylwestrak et al., 2022</xref>; <xref ref-type="bibr" rid="bib44">Liu et al., 2021</xref>; <xref ref-type="bibr" rid="bib8">Bugeon et al., 2022</xref>). The scalability of large-scale electrophysiological recording techniques depends not only on the detection and isolation of spikes produced by single neurons (spike sorting) but also on the reliable distinction between those triggered by different cell types.</p><p>The recording of extracellular potentials is a popular method to investigate neural activity, offering a high spatiotemporal resolution while allowing for the monitoring of action potentials from thousands of cells simultaneously (<xref ref-type="bibr" rid="bib46">Magland et al., 2020</xref>; <xref ref-type="bibr" rid="bib10">Buzsáki, 2004</xref>). Cell-type sorting based on extracellular action potential waveforms has been extensively explored. It has been proposed that excitatory (E) and inhibitory (I) neurons can be distinguished based on action potential waveforms (<xref ref-type="bibr" rid="bib23">Hafizi et al., 2022</xref>; <xref ref-type="bibr" rid="bib63">Ren et al., 2020</xref>; <xref ref-type="bibr" rid="bib2">Barthó et al., 2004</xref>). These methods typically extract features of action potentials such as peak-to-peak time difference and full-width-half amplitude maximum and match these features to reported values for each cell type to distinguish them. The rationale for using these features as a proxy for cell-type identity stems from intracellular recording studies, which report that inhibitory cells, such as parvalbumin-expressing GABAergic interneurons, have short-duration action potentials (<xref ref-type="bibr" rid="bib54">Nowak et al., 2003</xref>; <xref ref-type="bibr" rid="bib60">Peyrache and Destexhe, 2019</xref>; <xref ref-type="bibr" rid="bib34">Kawaguchi and Kubota, 1993</xref>; <xref ref-type="bibr" rid="bib17">Connors and Gutnick, 1990</xref>), whereas excitatory pyramidal neurons have longer-duration action potentials (<xref ref-type="bibr" rid="bib49">McCormick et al., 1985</xref>). Narrow and broad action potentials have been distinguished from one another in several neocortical areas, including prefrontal cortex (<xref ref-type="bibr" rid="bib51">Mitchell et al., 2007</xref>; <xref ref-type="bibr" rid="bib76">Wilson et al., 1994</xref>; <xref ref-type="bibr" rid="bib18">Constantinidis and Goldman-Rakic, 2002</xref>; <xref ref-type="bibr" rid="bib22">González-Burgos et al., 2005</xref>; <xref ref-type="bibr" rid="bib24">Hasenstaub et al., 2005</xref>; <xref ref-type="bibr" rid="bib2">Barthó et al., 2004</xref>; <xref ref-type="bibr" rid="bib73">Tamura et al., 2004</xref>). These differences have been hypothesized to result from the fact that repolarization of the membrane potential following a spike is slower among broad-spiking pyramidal neurons (<xref ref-type="bibr" rid="bib49">McCormick et al., 1985</xref>; <xref ref-type="bibr" rid="bib54">Nowak et al., 2003</xref>; <xref ref-type="bibr" rid="bib24">Hasenstaub et al., 2005</xref>). In the extracellular signal, which resembles the negative derivative of the intracellular membrane potential, this gives both a broader and shallower peak following the initial trough (<xref ref-type="bibr" rid="bib26">Henze et al., 2000</xref>).</p><p>Modern extracellular recording techniques allow researchers to monitor the simultaneous activity of large, intact networks of neurons. However, in dense preparations, the activity of a single cell may be captured by several electrodes, and each electrode may report the activity of several nearby cells. Thus, to segregate the activity of single cells, effective spike-sorting techniques must be employed. Spike sorting typically includes filtering the raw extracellular activity, detecting action potentials using threshold crossings, extracting spike features, and clustering to distinguish amongst neurons (<xref ref-type="bibr" rid="bib64">Rey et al., 2015</xref>).</p><p>Several methods have been developed, each with specialized features, including Kilosort4 (<xref ref-type="bibr" rid="bib56">Pachitariu et al., 2023</xref>), SpyKING CIRCUS (<xref ref-type="bibr" rid="bib79">Yger et al., 2018</xref>), MountainSort (<xref ref-type="bibr" rid="bib15">Chung et al., 2017</xref>), Herding Spikes (<xref ref-type="bibr" rid="bib27">Hilgen et al., 2017</xref>), YASS (<xref ref-type="bibr" rid="bib39">Lee et al., 2017a</xref>), and JRCLUST (<xref ref-type="bibr" rid="bib33">Jun et al., 2017</xref>). A detailed comparison of these methods is presented in <xref ref-type="table" rid="table1">Table 1</xref>. A common lacking feature in these methods is the ability to identify cell types in a biologically validated fashion. Despite evidence showing differences in action potential kinetics for distinct cell types as well as the use of optogenetics (<xref ref-type="bibr" rid="bib27">Hilgen et al., 2017</xref>), there exist no large-scale validation efforts, to our knowledge, showing that extracellular waveforms can be used to reliably distinguish cell types. Methods leveraging genetic differences between cell types offer statistical measures predictive of cell types, such as Fano Factor (<xref ref-type="bibr" rid="bib3">Becchetti et al., 2012</xref>). These methods have provided researchers with the ability to infer, in a post-hoc fashion, the most probable cell types that were sampled. Yet, a fully integrated suite offering an open-source data analysis pipeline paired with a validated experimental protocol allowing for high-density cell-type-specific activation during recordings is needed. Such a method will enable the investigation of dense and intricate circuits in a flexible, scalable, and generalizable manner.</p><table-wrap id="table1" position="float"><label>Table 1.</label><caption><title><bold>lang</bold>.: Programming language<bold>, # elect</bold>.</title><p>: Maximum number of electrodes tested on, <bold>data preproc</bold>.: Data preprocessing (formatting, filtering, artefact removal) included, <bold>event/channel loc</bold>.: Localization of single events, <bold>waveform extrac</bold>.: Spike features (such as peak-to-peak distance and full-width half max) are extracted from waveforms, <bold>e/i sorting</bold>: excitatory and inhibitory cell sorting, <bold>validation</bold>: validation of cell-type sorting (<italic>+)=ground truth validation via intracellular recordings, but not e/i validation</italic>, <bold>experim. prot</bold>.: integrates an experimental protocol to allow for network manipulation, <bold>unsuper</bold>.: unsupervised, requiring no manual user intervention, <bold>source code available</bold>: entire code is open-source and available.</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" valign="top"/><th align="left" valign="top">lang.</th><th align="left" valign="top"># elect.</th><th align="left" valign="top">data preproc.</th><th align="left" valign="top">event/ channel loc.</th><th align="left" valign="top">waveform extrac.</th><th align="left" valign="top">e/i sorting</th><th align="left" valign="top">validation</th><th align="left" valign="top">experim. prot.</th><th align="left" valign="top">unsuper.</th><th align="left" valign="top">source code available</th></tr></thead><tbody><tr><td align="left" valign="top"><italic>spikeMAP</italic></td><td align="left" valign="top">Python and<break/>Matlab</td><td align="left" valign="top">4096</td><td align="left" valign="top">+</td><td align="left" valign="top">+</td><td align="left" valign="top">+</td><td align="left" valign="top">+</td><td align="left" valign="top">+</td><td align="left" valign="top">+</td><td align="left" valign="top">+</td><td align="left" valign="top">+</td></tr><tr><td align="left" valign="top">Kilosort4 (<xref ref-type="bibr" rid="bib56">Pachitariu et al., 2023</xref>)</td><td align="left" valign="top">Python</td><td align="left" valign="top"/><td align="left" valign="top">+</td><td align="left" valign="top">+</td><td align="left" valign="top">-</td><td align="left" valign="top">-</td><td align="left" valign="top">-</td><td align="left" valign="top">-</td><td align="left" valign="top">-</td><td align="left" valign="top">+</td></tr><tr><td align="left" valign="top">SpyKING CIRCUS (<xref ref-type="bibr" rid="bib79">Yger et al., 2018</xref>; <xref ref-type="bibr" rid="bib80">Yger et al., 2023</xref>)</td><td align="left" valign="top">Python</td><td align="left" valign="top">4225</td><td align="left" valign="top">-</td><td align="left" valign="top">+</td><td align="left" valign="top">+</td><td align="left" valign="top">-</td><td align="left" valign="top">(+)</td><td align="left" valign="top">-</td><td align="left" valign="top">+</td><td align="left" valign="top">+</td></tr><tr><td align="left" valign="top">MountainSort (<xref ref-type="bibr" rid="bib15">Chung et al., 2017</xref>)</td><td align="left" valign="top">Matlab and C++</td><td align="left" valign="top">16</td><td align="left" valign="top">+</td><td align="left" valign="top">+</td><td align="left" valign="top">-</td><td align="left" valign="top">-</td><td align="left" valign="top">-</td><td align="left" valign="top">-</td><td align="left" valign="top">+</td><td align="left" valign="top">+</td></tr><tr><td align="left" valign="top">Herding Spikes (<xref ref-type="bibr" rid="bib27">Hilgen et al., 2017</xref>)</td><td align="left" valign="top">Python</td><td align="left" valign="top">4096</td><td align="left" valign="top">+</td><td align="left" valign="top">+</td><td align="left" valign="top">+</td><td align="left" valign="top">-</td><td align="left" valign="top">(+)</td><td align="left" valign="top">+</td><td align="left" valign="top">+</td><td align="left" valign="top">+</td></tr><tr><td align="left" valign="top">YASS (<xref ref-type="bibr" rid="bib39">Lee et al., 2017a</xref>; <xref ref-type="bibr" rid="bib40">Lee et al., 2017b</xref>)</td><td align="left" valign="top">Python</td><td align="left" valign="top">512</td><td align="left" valign="top">-</td><td align="left" valign="top">+</td><td align="left" valign="top">-</td><td align="left" valign="top">-</td><td align="left" valign="top">-</td><td align="left" valign="top">-</td><td align="left" valign="top">+</td><td align="left" valign="top">+</td></tr><tr><td align="left" valign="top">JRCLUST (<xref ref-type="bibr" rid="bib32">Jun, 2017</xref>, <xref ref-type="bibr" rid="bib32">Jun, 2017</xref>)</td><td align="left" valign="top">Matlab and CUDA</td><td align="left" valign="top">120<break/>(1000)</td><td align="left" valign="top">+</td><td align="left" valign="top">+</td><td align="left" valign="top">-</td><td align="left" valign="top">-</td><td align="left" valign="top">(+)</td><td align="left" valign="top">-</td><td align="left" valign="top">-</td><td align="left" valign="top">+</td></tr></tbody></table></table-wrap><p>Here, we introduce spikeMAP, an open-source, unsupervised and scalable spike sorting analysis pipeline which performs cell-type classification as validated on high-density MEAs. Crucially, we tightly integrate our analysis with an experimental protocol utilizing a stabilized step function opsin to dynamically probe distinct populations and validate sorting while avoiding the light-induced artefacts common on CMOS-based chip designs (<xref ref-type="bibr" rid="bib20">Fiscella et al., 2012</xref>). Our analysis pipeline, taking advantage of dense sampling, estimates cell-body location for each detected spike, yielding well-separated clusters associated with single neurons. Spike waveform features were extracted utilizing signal interpolation to estimate half-amplitude and peak-to-peak durations. These values were then entered in a principal component analysis with k-means clustering to identify uncorrelated signals from single channels on the array. Optimal separability of clusters was assessed by linear discriminant analysis. Each channel’s source location was identified using spatiotemporal characteristics of spike waveforms across the array. We further classified cells as putative excitatory or inhibitory based on their waveform properties. As a final validation, we introduced a method taking advantage of long timescale optogenetics (step function opsins) to perform cell-type-specific stimulation in acute prefrontal cortex slices from mice, providing a biological verification to our statistical methods. Together, spikeMAP provides a comprehensive toolkit for experimenters to flexibly interrogate cell-type-specific computations in a variety of neural circuits throughout the brain.</p></sec><sec id="s2" sec-type="results"><title>Results</title><sec id="s2-1"><title>Spike sorting</title><p>Our spike sorting pipeline (<xref ref-type="fig" rid="fig1">Figure 1</xref>) performs three main tasks: (i) the detection of voltage deflections associated with putative somatic spikes, (ii) the identification of individual putative neurons using spike clustering, and (iii) the spatial localization of single cells in high-density recordings. We demonstrate the use of this pipeline through targeted high-density recording from medial prefrontal cortex of mouse (<xref ref-type="fig" rid="fig2">Figure 2A</xref>; see Materials and methods). First, putative spike times were detected as threshold crossings (<xref ref-type="fig" rid="fig2">Figure 2Bi</xref>; <xref ref-type="bibr" rid="bib42">Lewicki, 1998</xref>), identifying negative signal peaks from the mean of the filtered signal (see Materials and methods). Optimal threshold choice is key in discriminating spikes from noise, as the number of spikes detected per electrode is highly dependent on the threshold used (<xref ref-type="fig" rid="fig2">Figure 2C</xref>). Here, the optimal threshold for detection was selected by fitting the voltage histogram of each channel with a Gaussian distribution to separate spiking activity from normally distributed noise (<xref ref-type="fig" rid="fig2">Figure 2D</xref>). At a threshold of –3σ, the signal could be largely accounted for by Gaussian noise, while a separation between signal and noise began around a threshold of –4σ. To avoid multiple detections of the same event, an absolute refractory period was imposed to discard successive events within &lt;2ms. Although filtering is crucial in event detection, it can introduce signal distortion (<xref ref-type="bibr" rid="bib78">Yael and Bar-Gad, 2017</xref>). To resolve this issue, the unfiltered voltage around the time of each spike was extracted (<xref ref-type="fig" rid="fig2">Figure 2Bii</xref>), yielding a series of high-frequency (18 kHz) waveforms for each channel.</p><fig id="fig1" position="float"><label>Figure 1.</label><caption><title>Workflow diagram of the proposed method.</title><p>(<bold>A</bold>) Filtering of the data is achieved through bandpass filtering (300–5000 Hz). Spike detection is done on filtered voltages; however, raw voltages around each spike are used to avoid signal distortion. (<bold>B</bold>) Spike sorting on each electrode. (<bold>Bi</bold>) Events are detected using a threshold method (6 SD from the mean of the filtered signal). (<bold>Bii</bold>) PCA and k-means on individual waveforms (k=2). (<bold>C</bold>) Precise soma location on the array. (<bold>D</bold>) Excitatory and inhibitory sorting. (<bold>Di</bold>) Spike time constant kinetics are extracted at the full width at half maximum and peak to peak distances. (<bold>Dii</bold>) Interpolated voltage for increased resolution. (<bold>Diii</bold>) k-means to distinguish cell type based on their waveform kinetics.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-106557-fig1-v1.tif"/></fig><fig id="fig2" position="float"><label>Figure 2.</label><caption><title>Isolation of single-cell action potential for each electrode.</title><p>(<bold>A</bold>) Multielectrode array recording set up. (<bold>B</bold>) Extracellular voltage on a single electrode. (<bold>Bi</bold>) Spike detection on filtered voltage. (<bold>Bii</bold>) Raw voltage extraction around detected spike. (<bold>C</bold>) Firing rate per electrode depends on threshold selection. The inset shows firing rate values at the selected threshold (4 SD). (<bold>D</bold>) Threshold selection to part cellular activity from normally distributed noise. (<bold>E</bold>) Spike sorting on a single electrode. (<bold>F</bold>) Current sink signal from single neuron spans multiple electrodes (four different neurons are shown in different colors), (<bold>G</bold>) Histogram distribution of tenfold cross-validation with chance performance indicated in red for all electrodes in a single recording. (<bold>H</bold>) Voltage amplitude as a function of distance from highest electrode peak, inset shows the directions measured from the center electrode. (<bold>I</bold>) Center of mass location of all spikes for a single soma, mean is indicated in red.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-106557-fig2-v1.tif"/></fig><p>In high-density preparations, a single electrode can report the activity of multiple cells. To address this issue, we employed a principal component analysis on the identified spike waveforms from individual channels (<xref ref-type="bibr" rid="bib66">Rossant et al., 2016</xref>), which revealed distinct clusters putatively corresponding to individual cells (<xref ref-type="fig" rid="fig2">Figure 2E</xref>), indicating that more than one neuron likely contributes to the voltage recorded on some channels. The SpikeMAP suite also offers a routine to select a radius around individual channels in order to enter groups of adjacent channels in PCA. Next, we employed a k-means cluster analysis to extract clusters amongst the principal components. To determine how well the data was separated by this approach, we applied a linear discriminant analysis (LDA) to the labeled principal components (<xref ref-type="bibr" rid="bib28">Hill et al., 2011</xref>), allowing our method to remain completely unsupervised. In SpikeMAP, the optimal number of k-means clusters can be chosen by a Calinski-Harabasz criterion (<xref ref-type="bibr" rid="bib12">Calinski and Harabasz, 1974</xref>) or pre-selected by the user.</p><p>To ensure the activity of each single cell was only reported once, we set a radius of 250 µm around the electrode where a given cell was detected. This radius corresponds to the approximate spread of extracellular electrical field around the soma of individual neurons (<xref ref-type="bibr" rid="bib31">Jia et al., 2019</xref>). Within this radius, the channel with the largest negative deflection in mean waveform was identified. Previous work observed that the largest negative amplitude of extracellular signal originates from the axon initial segment (AIS; <xref ref-type="bibr" rid="bib1">Bakkum et al., 2019</xref>; <xref ref-type="bibr" rid="bib55">Obien et al., 2014</xref>). Utilizing spatial localization of the AIS, the channel showing the greatest negative deflection was likely the closest to the putative soma of a given cell (<xref ref-type="bibr" rid="bib31">Jia et al., 2019</xref>). Activity at this channel was consistent with the somatic activity, showing a decay in peak voltage as we moved away from the putative soma (<xref ref-type="fig" rid="fig2">Figure 2H</xref>; <xref ref-type="bibr" rid="bib19">Delgado Ruz and Schultz, 2014</xref>; <xref ref-type="bibr" rid="bib58">Pettersen and Einevoll, 2008</xref>; <xref ref-type="bibr" rid="bib43">Lindén et al., 2011</xref>; <xref ref-type="bibr" rid="bib50">Mechler et al., 2011</xref>; <xref ref-type="fig" rid="fig3">Figure 3</xref>). Visualization of adjacent electrodes revealed a complex structure of voltage activity, possibly due to activity propagation within the compartments of single neuron (<xref ref-type="fig" rid="fig2">Figure 2F</xref>; <xref ref-type="bibr" rid="bib68">Shein-Idelson et al., 2017</xref>; <xref ref-type="bibr" rid="bib55">Obien et al., 2014</xref>). As an additional verification step, SpikeMAP allows the computation of spike-count correlations between putative neurons located within a user-defined radius. Signals that exceed a defined threshold of correlation can be rejected as they likely reflect the same underlying cell. To further verify that single cells located near the same electrode could be distinguished, we estimated the precise soma locations between adjacent recording electrodes using a center-of-mass analysis (see Materials and methods). This revealed subtle changes in position, reflected by distinct weights on each nearby electrode (<xref ref-type="fig" rid="fig2">Figure 2I</xref>). Despite these subtle changes, the soma location could still be assigned to the same electrode since changes in localization across spikes were far less than the inter-electrode distance.</p><fig id="fig3" position="float"><label>Figure 3.</label><caption><title>Decrease in voltage relative to the distance from putative soma.</title><p>(<bold>A</bold>) Voltage amplitude as a function of distance from highest electrode peak. Putative somas with an increase in voltage away from electrode peak were excluded from this analysis. (<bold>B–C</bold>) Distribution of slopes and intercepts across all putative somas obtained from one recording (N=1950).</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-106557-fig3-v1.tif"/></fig><p>In sum, SpikeMAP provides an end-to-end pipeline to perform spike-sorting on high-density multielectrode arrays. Some elements of this pipeline are similar to related approaches (<xref ref-type="table" rid="table1">Table 1</xref>), including the use of voltage filtering, PCA, and k-means clustering. Other elements are novel, including the use of spline interpolation, LDA, and the ability to identify putative excitatory and inhibitory cells. At different steps in the process, conditions for rejecting spikes can be tailored by applying: (1) a stringent threshold to filtered voltages; (2) a minimal cut-off on the signal-to-noise ratio of voltages (<xref ref-type="fig" rid="fig4">Figure 4</xref>); (3) an LDA for cluster separability; (4) a minimal spike rate to putative neurons; (5) a Hartigan statistical dip test to detect spike bursting; (6) a decrease in voltage away from putative somas; and (7) a maximum spike-count correlation for nearby channels. Together, these criteria allow SpikeMAP users the ability to precisely control parameters relevant to automated spike sorting.</p><fig id="fig4" position="float"><label>Figure 4.</label><caption><title>Analysis of signal-to-noise ratio for single channels.</title><p>(<bold>A</bold>) Distribution of signal-to-noise ratio (SNR) over all spike-sorted clusters of a single recording (N=8059). (<bold>B</bold>) Examples of mean voltages (black lines) and individual voltages (gray lines) around individual spikes.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-106557-fig4-v1.tif"/></fig></sec><sec id="s2-2"><title>Cell type classification based on action potential waveform kinetics</title><p>Despite technological advances, the ability to identify distinct cell types based solely on extracellular voltage has remained challenging. Current data processing methods often rely on waveform kinetics (<xref ref-type="bibr" rid="bib2">Barthó et al., 2004</xref>) to return a classification of contributing excitatory and inhibitory units. As technological progress continuously allows for denser arrays, waveform spike analyses are increasingly sensitive to noise generated by the signal of proximal units. Here, we first implemented a classification method using current knowledge about cell-type-specific waveform kinetics and spline interpolation to distinguish putative excitatory and inhibitory neurons in dense networks. We then validated this classification using a combination of viral strategies, optogenetics, and pharmacology while simultaneously recording from stimulated mouse prefrontal cortex networks.</p><p>To provide a more precise description of the shape of each spike, we first fitted each waveform using piecewise cubic spline interpolation, a method allowing for the statistical inference of points within the boundaries of a set of known points. While several interpolation bases are possible, cubic splines allow for smooth interpolation between known data points and a high accuracy in terms of curve fitting (<xref ref-type="bibr" rid="bib62">Ramsay and Silverman, 1997</xref>). Using query points at 90 kHz, we computed the mean fitted waveform (<xref ref-type="bibr" rid="bib6">Blanche and Swindale, 2006</xref>) for each putative cell (see Materials and methods). While we found that a resolution of 90 kHZ provided a reasonable estimate of spike waveforms, this value can be adjusted as a parameter in SpikeMAP.</p><p>Next, we identified putative excitatory and inhibitory neurons using two time constants obtained from mean spike waveforms at somatic locations: (1) the full width (FW) of spikes at half-maximum amplitude and (2) the peak-to-peak (PP) duration (<xref ref-type="fig" rid="fig5">Figure 5A</xref>). (<xref ref-type="bibr" rid="bib69">Sirota et al., 2008</xref>; <xref ref-type="bibr" rid="bib67">Sakata and Harris, 2009</xref>; <xref ref-type="bibr" rid="bib2">Barthó et al., 2004</xref>; <xref ref-type="bibr" rid="bib30">Insel and Barnes, 2015</xref>). Although some work has cast doubt on the accuracy of spike-width-based classification (<xref ref-type="bibr" rid="bib52">Moore and Wehr, 2013</xref>), many studies have shown good classification accuracy (<xref ref-type="bibr" rid="bib54">Nowak et al., 2003</xref>; <xref ref-type="bibr" rid="bib35">Kawaguchi and Kubota, 1997</xref>; <xref ref-type="bibr" rid="bib2">Barthó et al., 2004</xref>; <xref ref-type="bibr" rid="bib45">Madisen et al., 2012</xref>; <xref ref-type="bibr" rid="bib70">Stark et al., 2013</xref>; <xref ref-type="bibr" rid="bib13">Cardin et al., 2009</xref>; <xref ref-type="bibr" rid="bib16">Cohen and Mizrahi, 2015</xref>). K-means clustering was performed on values of FW and PP obtained across all simultaneously recorded somatic electrodes, where the optimal number of clusters was chosen with a Calinski-Harabasz criterion (<xref ref-type="bibr" rid="bib12">Calinski and Harabasz, 1974</xref>; <xref ref-type="bibr" rid="bib75">Vendramin et al., 2009</xref>). For validation purposes, strict criteria were applied at each step of the pipeline, resulting in the low number of neurons reported here. Clusters corresponding to putative excitatory (E) and inhibitory (I) neurons were identified based on FW and PP values (<xref ref-type="fig" rid="fig5">Figure 5A</xref>). I cells were identified as a single cluster with rapid time constants for both FW and PP (<xref ref-type="bibr" rid="bib2">Barthó et al., 2004</xref>). We extracted the putative soma locations of excitatory and inhibitory neurons on the MEA (<xref ref-type="fig" rid="fig5">Figure 5B</xref>) and visualized firing activity in a raster plot (<xref ref-type="fig" rid="fig5">Figure 5C</xref>) (see <xref ref-type="fig" rid="fig6">Figure 6</xref> for firing rate distributions). It is possible that the spatial location of putative I cells reflects the site of injection of the opsin in medial prefrontal cortex. Other properties of putative I cells were consistent with past work, including a higher Fano factor (<xref ref-type="fig" rid="fig5">Figure 5D</xref>; <xref ref-type="bibr" rid="bib3">Becchetti et al., 2012</xref>) and a rapid spatial decay of pairwise correlation (<xref ref-type="fig" rid="fig5">Figure 5E</xref>; <xref ref-type="bibr" rid="bib59">Peyrache et al., 2012</xref>). Further, SpikeMAP contains a routine to perform a Hartigan statistical dip test on the inter-spike distribution of individual cells to detect putative bursting neurons. These results extend previous findings to large-scale recordings, yet a ground-truth validation of cell type is still required to assess the extent to which this approach offers a reasonable proxy of biological identity, as examined next.</p><fig id="fig5" position="float"><label>Figure 5.</label><caption><title>Identification of putative excitatory and inhibitory units.</title><p>(<bold>A</bold>) Distinct waveform kinetics for E and I cells (<bold>B</bold>) Respective cell location (<bold>C</bold>) Raster plot of E and I activity. (<bold>D</bold>) Fano factor for putative E and I cells. The shaded area represents the SEM. The x-axis shows <bold>t</bold>emporal bins of increasing durations employed to compute the Fano factor (<bold>E</bold>) Mean cross-correlation as a function of spatial distance between pairs of electrodes. Non-overlapping bins of 100ms were employed to compute correlations. The resulting values were averaged by spatial distance between all pairs of neurons.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-106557-fig5-v1.tif"/></fig><fig id="fig6" position="float"><label>Figure 6.</label><caption><title>Distribution of mean firing rates across a population of putative excitatory (<bold>A</bold>) (N=570) and inhibitory (<bold>B</bold>) (N=54) neurons.</title><p>(<bold>C</bold>) Mean firing rate across neurons. Vertical bars: SEM.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-106557-fig6-v1.tif"/></fig></sec><sec id="s2-3"><title>A step-function opsin validation approach for cell classification</title><p>While multielectrode arrays have allowed the simultaneous recording from thousands of electrodes, the reliance on light-sensitive complementary metal-oxide-semiconductor (CMOS) circuits has limited the ability of researchers to use them in conjunction with optogenetics. As the ability to rapidly perturb distinct populations in large networks provides valuable insight as to how local circuits represent information (<xref ref-type="bibr" rid="bib41">Lemon et al., 2021</xref>; <xref ref-type="bibr" rid="bib11">Buzsáki, 2010</xref>), it is of broad interest to validate methodologies that allow for optogenetic manipulation of defined cell populations in multielectrode arrays.</p><p>We validated an experimental protocol using a stabilized step-function opsin (Bi-stable neural state switches; <xref ref-type="bibr" rid="bib5">Berndt et al., 2009</xref>), which is activated in a step-like fashion for prolonged periods (minutes) by brief photostimulation with blue light and inactivated by green-yellow light. This viral and optogenetic strategy, used in conjunction with CMOS-based multielectrode arrays, allows for the monitoring of induced spiking beyond the initial light-generated artefacts (<xref ref-type="fig" rid="fig7">Figure 7</xref>). We demonstrated this by inducing spiking selectively in targeted PV inhibitory neurons, as more than 90% of them have been reported to be fast-spiking (<xref ref-type="bibr" rid="bib71">Stringer et al., 2016</xref>), to verify whether cells previously identified as putative inhibitory interneurons indeed correspond to light-activated cells.</p><fig id="fig7" position="float"><label>Figure 7.</label><caption><title>Light artefact in a recording from mouse prefrontal cortex showing that the application of a brief (1ms) pulse of light leads to saturation lasting about 5ms post-stimulation.</title></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-106557-fig7-v1.tif"/></fig><p>As an obligate validation step, we injected a viral vector expressing the step function opsin, pAAV-Ef1a-DIO hChR2 (C128S/D156A)-EYFP, in medial prefrontal cortex of mice, and after waiting 2–3 weeks for transfection, performed whole-cell recordings from pyramidal neurons located near identified PV interneurons using in vitro slice preparations (<xref ref-type="fig" rid="fig8">Figure 8A</xref>; see Materials and methods). Photostimulation with blue light was sufficient to activate PV interneurons, as monitored by the robust, rapid, and consistent appearance of light-induced inhibitory synaptic postsynaptic currents (IPSCs) recorded from pyramidal neurons (note the absence of direct photocurrent from these cells; <xref ref-type="fig" rid="fig8">Figure 8B</xref>). The subsequent delivery of short pulses of yellow light reduced the frequency of IPSCs onto recorded pyramidal neurons, indicating that the step-function opsin could be reliably activated and inactivated in a step-like manner by phasic delivery of light (<xref ref-type="fig" rid="fig8">Figure 8B</xref>). Upon PV photoactivation, recorded pyramidal neurons reliably received high-frequency barrages of 10–30 pA IPSCs, followed by a gradual reduction in amplitude and elevated rates of inhibitory input that persisted until deactivation with green-yellow light, reflecting some desensitization of the step-function opsin (<xref ref-type="fig" rid="fig8">Figure 8B</xref>).</p><fig id="fig8" position="float"><label>Figure 8.</label><caption><title>Validation of step-function opsin by whole-cell recordings.</title><p>(<bold>A</bold>) Visually identified PV neuron (<bold>B</bold>) Nearby pyramidal neuron receiving inhibitory currents following PV opto activation (<bold>C</bold>) IPSCs onto pyramidal cell with 20 s rest between trial (<bold>D</bold>) IPSCs onto pyramidal cell with 60 s rest between trial (<bold>E</bold>) IPSCs onto pyramidal cell with 120 s rest between trial.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-106557-fig8-v1.tif"/></fig><p>To characterize the refractory period of the step-function opsin, we delivered repeated photostimulation at various inter-trial intervals and measured steady-state activation (<xref ref-type="fig" rid="fig8">Figure 8C</xref> to E). Longer inter-trial intervals (≥120 s; <xref ref-type="fig" rid="fig8">Figure 8E</xref>) allowed expressing cells to recover and prevented the reduction in steady-state activation observed with 20 s and 60 s inter-trial intervals (<xref ref-type="fig" rid="fig8">Figure 8C and D</xref>). Specifically, the mean IPSCs/s for 20 s, 60 s, and 120 s intervals were 12.64±0.27, 17.32±0.15, and 26.29±0.31, respectively. Statistical comparisons, performed using the Wilcoxon rank sum test for non-parametric data on the PSTH, revealed significant differences between the 20 s and 120 s conditions (p=1.29 × 10⁻⁶, n=4500 and 3000 trials, respectively) as well as between the 60 s and 120 s conditions (p=0.032, n=3000 trials per condition). The number of trials conducted for each condition was 5 for 20 s, 6 for 60 s, and 6 for 120 s.</p><p>Furthermore, the reduction in firing rate upon opsin deactivation was more prominent for longer interval trials (<xref ref-type="fig" rid="fig8">Figure 8E</xref>). These results provided key insights to inform multielectrode array recording protocols, allowing us to selectively activate and inactivate PV interneurons in a temporally precise fashion using tools compatible with multielectrode array technology.</p></sec><sec id="s2-4"><title>Optogenetic validation of E/I classification on multielectrode arrays</title><p>To validate our prior waveform-based cell-type classification in mouse prefrontal cortex slices, we selectively activated transfected PV interneurons with the step-function opsin construct while performing multielectrode recordings (<xref ref-type="table" rid="table2">Table 2</xref>). To prevent the propagation of optogenetic activation throughout the network, we first recorded in the presence of 10 μM cyanquixaline (CNQX) and 100 μM picrotoxin (PTX) to block AMPA receptors and GABA<sub>A</sub> receptors, respectively (leading to a reduction in FR of 0.0937 Hz, p&lt;0.001 from baseline). We photostimulated with brief 100 ms pulses of blue light and examined post-stimulation responses of all identified neurons recorded (n=8189, 3 slices, from 3 mice; <xref ref-type="fig" rid="fig9">Figure 9A</xref>). In the presence of synaptic blockers, optogenetic activation of targeted PV interneurons led to a significant increase in mean firing rate for the population of cells that had been classified as inhibitory based on their waveform properties (I neurons; <xref ref-type="fig" rid="fig9">Figure 9B</xref>, n=430, p&lt;0.003). Neurons classified as excitatory neurons based on their waveform kinetics, on the other hand, showed only a subtle decrease in mean firing rate (<xref ref-type="fig" rid="fig9">Figure 9B</xref>, n=7759, p&lt;0.001). A clustering analysis on the spike waveform properties of putative excitatory and inhibitory neurons provides further evidence of classification (<xref ref-type="fig" rid="fig10">Figure 10</xref>). The overall firing rates in slice recordings were relatively low and thus were not permissive to the use of cross-correlations in validating putative excitatory and inhibitory neurons. While our pharmacological manipulations attempted to largely eliminate network effects, the slight reduction in firing rate of putative excitatory neurons may reflect the involvement of GABA<sub>B</sub> receptor-mediated inhibition (<xref ref-type="bibr" rid="bib36">Kohl and Paulsen, 2010</xref>).</p><fig id="fig9" position="float"><label>Figure 9.</label><caption><title>Optogenetic targeting of inhibitory cells for spike sorting (<bold>A</bold>) Average firing rate for putative excitatory and inhibitory neurons.</title><p>The shaded area represents the SEM. (<bold>B</bold>) Quantification of change in firing rate following optogenetic stimulation. Average firing rates are taken over four recordings obtained from three mice. (<bold>C</bold>) Delta change in firing rate (on – drugs) (<bold>D</bold>) Opto-evoked change in firing rate.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-106557-fig9-v1.tif"/></fig><fig id="fig10" position="float"><label>Figure 10.</label><caption><title>Waveform kinetics for E and I cells obtained during the baseline window of the optogenetic protocol.</title><p>Insets show cartoons of individual spikes with broader (<bold>E</bold>) and narrower (<bold>I</bold>) waveforms.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-106557-fig10-v1.tif"/></fig><table-wrap id="table2" position="float"><label>Table 2.</label><caption><title>Summary of SpikeMAP open-source data.</title><p>Datasets were obtained from four mice. The optogenetic stimulation protocol (see Materials and methods) was run once per dataset. Data is available from: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.6084/m9.figshare.29416472">https://doi.org/10.6084/m9.figshare.29416472</ext-link>.</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" valign="top">File name</th><th align="left" valign="top">Animal #</th><th align="left" valign="top">Protocol #</th><th align="left" valign="top"># of E cells identified</th><th align="left" valign="top"># of I cells identified</th><th align="left" valign="top">Total recording time (min)</th></tr></thead><tbody><tr><td align="left" valign="top">R20211221_Slice1_Vars3.mat</td><td align="left" valign="top">1</td><td align="left" valign="top">1</td><td align="left" valign="top">3687</td><td align="left" valign="top">47</td><td align="left" valign="top">8</td></tr><tr><td align="left" valign="top">R20211213_Slice2_Vars3.mat</td><td align="left" valign="top">2</td><td align="left" valign="top">1</td><td align="left" valign="top">2943</td><td align="left" valign="top">350</td><td align="left" valign="top">8</td></tr><tr><td align="left" valign="top">R20211209_Slice3_Vars3.mat</td><td align="left" valign="top">3</td><td align="left" valign="top">1</td><td align="left" valign="top">1994</td><td align="left" valign="top">712</td><td align="left" valign="top">8</td></tr><tr><td align="left" valign="top">R20211219_Slice3_Vars3.mat</td><td align="left" valign="top">4</td><td align="left" valign="top">2</td><td align="left" valign="top">1138</td><td align="left" valign="top">32</td><td align="left" valign="top">8</td></tr></tbody></table></table-wrap><p>Next, we examined in further detail the response profiles of individual neurons to photostimulation in order to validate our algorithm at the single cell level. In the absence of synaptic blockers, individual neurons displayed a diverse range of responses to light stimulation, including neurons showing no significant change in firing rate (ΔFR ~0), neurons showing an increase in firing rate (ΔFR &gt;0), and neurons showing a decrease in firing rate (ΔFR &lt;0; <xref ref-type="fig" rid="fig9">Figure 9C</xref>). We applied a strict criterion to separate neurons showing a statistically robust increase in firing rate (see Materials and methods). We found that 56% of neurons that had been classified as I displayed a light-induced increase in firing rate. Conversely, we found that only 8% of neurons that had been classified as E showed an increase in firing rate after photostimulation. The percentage of I cells responsive to light may be influenced by our viral strategy, which targets only a subset of PV-expressing interneurons largely located in the infralimbic and prelimbic cortical subregions. Additionally, non-PV inhibitory interneurons and some excitatory neurons could have been initially classified as inhibitory based on their waveform properties. These experiments, however, unambiguously identified a subset of genetically identified PV neurons: those that showed a transient photostimulation-induced increase in firing rate. Through a comparison with FWHM and PTP features, these results demonstrate that a step-function opsin approach is a viable and scalable method for validating spike waveform classification on multielectrode arrays.</p><p>Together, this provides evidence for cell classification of excitatory and inhibitory neurons based on their extracted waveform properties using spikeMAP, showing that cells identified as inhibitory displayed optogenetic-specific change in responses.</p></sec></sec><sec id="s3" sec-type="discussion"><title>Discussion</title><p>Extracellular electrophysiological recordings have allowed monitoring the spiking of thousands of neurons simultaneously. To meaningfully interpret these dynamics, spike sorting is a crucial step in the analysis of those recordings. The analysis of network dynamics can be severely impacted by improper interpretation of the underlying neural activity (<xref ref-type="bibr" rid="bib64">Rey et al., 2015</xref>; <xref ref-type="bibr" rid="bib14">Carlson and Carin, 2019</xref>), highlighting the need for optimal methods. With technological progress constantly allowing for denser arrays, assigning spikes to single cells and determining cell-type identity requires an automated solution given that the size of the data prevents manual curation. Most spike sorting methods are at least somewhat supervised (<xref ref-type="bibr" rid="bib48">Marre et al., 2012</xref>; <xref ref-type="bibr" rid="bib61">Prentice et al., 2011</xref>), which is not feasible on large-scale arrays. Here, we described an open-source, unsupervised, and scalable suite of computational tools that perform spike sorting and cell type classification on large-scale, high-density recordings. We integrated our analysis pipeline with an experimental protocol, allowing for the validation of our statistical method and for the optogenetic manipulation of distinct cell types in dense networks.</p><p>Previous work has detailed cell-type classification based on waveform analysis, but experimental validation has been lacking. To address this and provide biological evidence that this classification indeed correlates with cell type, we selectively activated PV interneurons using a combination of viral strategies and optogenetics while simultaneously recording from the whole network. Analysis of optogenetically stimulated trials revealed that cells that had been classified as inhibitory were more likely to display a change in firing rate during optogenetic stimulation.</p><p>We found that clustering in two dimensions, representing the full width of spikes at half-maximum amplitude and the peak-to-peak, achieved a high level of success in classifying cell types. By sampling electrodes from PV-positive transfected cells, we distinguished their action potentials from other cell types. Our work provides evidence that extracellular recordings can offer insights on the distinct neuronal populations that make up complex networks. Our pipeline encourages the integration of viral strategies, optogenetics, and electrophysiological recordings to manipulate complex networks to better understand the contribution of each cell type.</p><p>While SpikeMAP is the only known method to enable the identification of putative excitatory and inhibitory neurons on high-density multielectrode arrays (<xref ref-type="table" rid="table1">Table 1</xref>), several aspects of SpikeMAP included in the spike sorting pipeline (<xref ref-type="fig" rid="fig1">Figure 1</xref>) overlap with existing methods, as these constitute required steps prior to performing E/I identification. To enable users the ability to integrate SpikeMAP with existing toolboxes, we provide a modularized suite of protocols so that E/I identification can be performed separately from preliminary spike sorting steps. In this way, a user could carry out spike sorting through Kilosort or another package before importing their data to SpikeMAP for E/I identification.</p><p>Cortical inhibitory neurons are heterogeneous, and the fact that fast-spiking PV interneurons represent the largest population exhibiting landmark features of narrow-spike made them an attractive candidate to validate our classification. However, future work could include different inhibitory interneurons such as somatostatin (SOM) and vasoactive intestinal polypeptide (VIP) neurons to improve the classification of inhibitory cell types. Another avenue could involve applying SpikeMAP on artificially generated spike data (<xref ref-type="bibr" rid="bib7">Buccino and Einevoll, 2021</xref>; <xref ref-type="bibr" rid="bib38">Laquitaine et al., 2024</xref>). Nevertheless, it is possible that distinguishing all inhibitory cell types based on extracellular waveforms alone may not be achievable. Despite this limitation, incremental advancements such as those presented here are crucial for refining our understanding and improving analytical approaches. Given that spike sorting features in vitro can differ from properties exhibited in vivo (<xref ref-type="bibr" rid="bib26">Henze et al., 2000</xref>; <xref ref-type="bibr" rid="bib54">Nowak et al., 2003</xref>; <xref ref-type="bibr" rid="bib22">González-Burgos et al., 2005</xref>), future work should address if these classification/waveform properties can be generalized to behaving organisms, for example with tetrodes, optrodes, or implanted electrode arrays.</p><p>In sum, our work described a fully integrated method with an open-source, unsupervised, and scalable spike sorting analysis pipeline performing cell-type classification, integrated with an experimental protocol utilizing a stabilized step function opsin to validate sorting on large-scale MEAs. These tools collectively provide a framework for investigating large-scale neural dynamics of genetically defined neural populations.</p></sec><sec id="s4" sec-type="materials|methods"><title>Materials and methods</title><sec id="s4-1"><title>Animals</title><p>PV-CRE mice (<italic>Pvalb<sup>Cre</sup></italic> gene designation, 008069) were acquired from Jackson Laboratory (Bar Harbor, ME, USA). All mouse lines were homozygous and in C57BL/6x129S4 background. Mice were kept on a 12:12 hr light/dark cycle, with access to food and water ad libitum. All experiments and procedures were performed in accordance with approved procedures and guidelines set forth by the University of Ottawa Animal Care and Veterinary Services (protocol # 3471).</p></sec><sec id="s4-2"><title>Stereotaxic injections</title><p>For stereotaxic injections, P21 mice were injected with 0.05 mg/kg buprenorphine and anesthetized by inhalation of isoflurane. Injections were performed using a 10 μL Hamilton syringe with a 33-gauge needle, and 1 μL was injected per coordinate. Stereotaxic coordinates are as follows, from the bregma landmark: mPFC [anterior–posterior (AP), +2.4 —&gt; +2.6; medial–lateral (ML), ±0.42; dorsal–ventral (DV), –1.5 —&gt;–1.8]. The DV coordinate was calculated from the surface of the pia. For ChR2 expression, 400 nL of pAAV-Ef1a-DIO hChR2 (C128S/D156A)-EYFP was injected, per site, (bilaterally) and animals were left to recover for 2–3 weeks before ex vivo electrophysiological recordings.</p></sec><sec id="s4-3"><title>Slices</title><p>mPFC slices were prepared from 35- to 42-day-old PV-CRE mice, 2–3 weeks post-stereotaxic injections. For slice preparation, mice were anesthetized by inhalation of isoflurane (Baxter Corporation) and killed by decapitation. The brain was removed, and coronal brain slices were sectioned while immersed in an ice-cold choline chloride-based cutting solution of the following composition: 119 mM choline-Cl, 2.5 mM KCl, 1 mM CaCl2, 4.3 mM MgSO4-7H2O, 1 mM NaH2PO4, 1.3 mM sodium L-ascorbate, 26.2 mM NaHCO3, and 11 mM glucose, and equilibrated with 95% O<sub>2</sub> and 5% CO<sub>2</sub>. Slices were recovered in a chamber containing standard artificial cerebrospinal fluid solution (aCSF) of the following composition: 119 mM NaCl, 2.5 mM CaCl2, 1.3 mM MgSO4- 7H2O, 1 mM NaH2PO4, 26.2 mM NaHCO3, and 11 mM glucose, at a temperature of 37 °C, continuously bubbled with a mixture of 95% O2 and 5% CO2. Slices were recovered for 1 hr in the recovery chamber and equilibrated to a temperature of ∼25 °C before the recordings were performed. The tissue was continuously perfused with fresh aCSF. The recordings shown in this paper were 24 min long and were as follows: baseline (2 min), opto-on (2 min), opto-off (2 min), CNQX wash-on (5 min), CNQX +opto on (2 min), CNQX +opto off (2 min), PTX wash-on (5 min), CNQX and PTX +opto on (2 min), CNQX and PTX +opto off (2 min). MEA-chip baseline (no slice) was recorded (30 s) as control prior to adding each slice. Slices were imaged on the multi-electrode array and preserved for immunohistochemistry verification of virus expression site.</p></sec><sec id="s4-4"><title>Whole-cell electrophysiology</title><p>Neurons were visualized for whole-cell recordings using an upright microscope: BX61WU upright microscope (60 X, 1.0 NA objective; Olympus, Melville, NY). PV neurons were visually identified by EYFP expression. Whole-cell recordings were performed using borosilicate glass patch electrodes (3–6 MΩ; World Precision Instruments) pulled on a Narishige PC-10 pipette puller. Electrical signals were recorded using an Axon Multiclamp 700B amplifier, filtered at 2 kHz, and digitized at 10 kHz with an Axon Digidata 1440 A digitizer. All experiments were performed at room temperature in Ringer’s solution containing (in mM) 119 NaCl, 2.5 CaCl2, 1.3 MgSO4-7H20, 1 NaH2PO4, and 26.2 NaHCO3, and 11 glucose saturated with 95% O2 and 5% CO2 (pH 7.3, 295–310 mOsm/L). Electrodes were filled with an intracellular solution of the following compositions (in mM): 115 K-gluconate, 20 KCl, 10 HEPES, 4 ATP-Mg, 0.5 GTP, 10 Na-phosphocreatine (pH = 7.2–7.3; 270–290 mOsm/L).</p></sec><sec id="s4-5"><title>Multielectrode array recordings</title><p>Extracellular voltage was recorded using High-Density Multi Electrode Arrays (HD-MEAs) from 3 Brain, Switzerland (<ext-link ext-link-type="uri" xlink:href="https://www.3brain.com/">https://www.3brain.com/</ext-link>). A detailed description of the technology behind this system can be found in <xref ref-type="bibr" rid="bib29">Imfeld et al., 2008</xref> and in <xref ref-type="bibr" rid="bib4">Berdondini et al., 2009</xref>. High-density recordings from the mouse’s prefrontal cortex were performed in vitro using the BioCAM X platform with HD-MEA Arena chips (3Brain GmbH, Switzerland). This system records using 4096 square microelectrodes (pitch = 42 μm) positioned in a 64x64 layout (2.67mm x 2.67 mm area) with a sampling rate <italic>f</italic>s of 18 kHz when recording from the entire 64x64 array. Activity was recorded at 12 bits resolution per channel. The data was visualized and acquired with the BrainWaveX software provided by 3Brain.</p></sec><sec id="s4-6"><title>Spike sorting</title><p>A code library for SpikeMAP in Python and Matlab is available as open source software from <ext-link ext-link-type="uri" xlink:href="https://figshare.com/articles/software/_b_SpikeMAP_An_unsupervised_spike_sorting_pipeline_for_cortical_excitatory_and_inhibitory_neurons_in_high-density_multielectrode_arrays_b_/28458749">figshare</ext-link>, as well as from <ext-link ext-link-type="uri" xlink:href="https://github.com/evgiraud/BRWExtract">GitHub</ext-link> (copy archived at <xref ref-type="bibr" rid="bib21">Giraud, 2020</xref>).</p></sec><sec id="s4-7"><title>Filtering</title><p>The extracellular voltages recorded by multielectrode arrays typically reflect the dynamics of multiple cells in proximity to a given electrode (<xref ref-type="bibr" rid="bib64">Rey et al., 2015</xref>), raising the problem of how to isolate individual units. The unfiltered voltage at individual channels was characterized by sharp deflections (<xref ref-type="fig" rid="fig2">Figure 2Bi</xref>) that are typical of in vitro extracellular activity in spontaneously active cortical circuits (<xref ref-type="bibr" rid="bib25">Hemberger et al., 2019</xref>). As a necessary first step to isolate individual units, we filtered the extracellular voltage using a second-order Butterworth bandpass filter (300–5000 Hz; <xref ref-type="fig" rid="fig2">Figure 2Bii</xref>) to remove slowly changing field potentials and high-frequency noise (<xref ref-type="bibr" rid="bib9">Bullmann et al., 2019</xref>). Recording artefacts (voltage deflection &gt; ± 500 µV) were removed and set to the mean voltage.</p></sec><sec id="s4-8"><title>Spike detection</title><p>Putative spike times were detected using a voltage-threshold method (<xref ref-type="bibr" rid="bib42">Lewicki, 1998</xref>), identifying negative signal peaks below a threshold of <inline-formula><alternatives><mml:math id="inf1"><mml:mi>x</mml:mi></mml:math><tex-math id="inft1">\begin{document}$x$\end{document}</tex-math></alternatives></inline-formula> standard deviation (SD) from the mean of the filtered signal. Here, <inline-formula><alternatives><mml:math id="inf2"><mml:mi>x</mml:mi></mml:math><tex-math id="inft2">\begin{document}$x$\end{document}</tex-math></alternatives></inline-formula> is calculated for each recording, by plotting the filtered voltage histogram for each channel and fitting it with a Gaussian curve to determine the SD value at which non-normal, putative spike-related activity is found. An absolute refractory period was applied, and successive events within &lt;2ms were discarded. Next, the unfiltered voltage around the time of each spike (from –5 to +5ms) was extracted (<xref ref-type="fig" rid="fig2">Figure 2Bii</xref>), yielding a series of high-frequency (18 kHz) waveforms for each channel. For the data shown here, all three recordings used had <inline-formula><alternatives><mml:math id="inf3"><mml:mi>x</mml:mi><mml:mo>=</mml:mo><mml:mn>4.5</mml:mn></mml:math><tex-math id="inft3">\begin{document}$x=4.5$\end{document}</tex-math></alternatives></inline-formula> SD.</p></sec><sec id="s4-9"><title>Isolation of single units</title><p>To isolate single-cell activity, we employed a principal component analysis on individual channels, which revealed distinct clusters putatively corresponding to individual cells (<xref ref-type="fig" rid="fig2">Figure 2E</xref>). Next, clusters amongst the principal components of rrSVD were extracted using a k-means cluster analysis (k=2; <xref ref-type="bibr" rid="bib77">Xu and Wunsch, 2005</xref>). A linear discriminant analysis (LDA) was then applied to the labeled principal components (<xref ref-type="bibr" rid="bib28">Hill et al., 2011</xref>) to determine how well the data were separated by this approach. LDA provides an estimate of linear classification error between the two clusters assuming equal class covariance. Tenfold cross-validation was employed, where chance corresponds to an error estimate of 0.5 (<xref ref-type="fig" rid="fig2">Figure 2G</xref>). Clusters with error lower than chance were merged by applying the same label to all waveforms. Each cluster was considered a putative neuron.</p></sec><sec id="s4-10"><title>Center-of-mass triangulation</title><p>In order to precisely estimate soma locations between each recording electrode, we used a center-of-mass analysis (<xref ref-type="bibr" rid="bib53">Muthmann et al., 2015</xref>; <xref ref-type="bibr" rid="bib27">Hilgen et al., 2017</xref>). For each putative soma identified previously, a 3-by-3 matrix with elements <inline-formula><alternatives><mml:math id="inf4"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">a</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math><tex-math id="inft4">\begin{document}$\boldsymbol{a}_{ij}$\end{document}</tex-math></alternatives></inline-formula> was constructed by extracting the waveforms on adjacent electrodes. Location (2,2) of this matrix was the amplitude of the negative peak in mean waveform of the somatic electrode. Surrounding locations were populated with the amplitude of the negative peaks of all electrodes immediately adjacent to the somatic electrode. The row of the center-of-mass is given by<disp-formula id="equ1"><alternatives><mml:math id="m1"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>r</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:munder><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>⋅</mml:mo><mml:msub><mml:mi mathvariant="bold-italic">a</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi mathvariant="bold-italic">a</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mstyle></mml:mrow></mml:mstyle></mml:math><tex-math id="t1">\begin{document}$$\displaystyle  r=\frac{\sum _{i}\sum _{j}\left (i\cdot \boldsymbol{a}_{ij}\right)}{\sum _{ij}\boldsymbol{a}_{ij}}$$\end{document}</tex-math></alternatives></disp-formula></p><p>and the column is<disp-formula id="equ2"><alternatives><mml:math id="m2"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>c</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:munder><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>⋅</mml:mo><mml:msub><mml:mi mathvariant="bold-italic">a</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi mathvariant="bold-italic">a</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mstyle></mml:mrow></mml:mstyle></mml:math><tex-math id="t2">\begin{document}$$\displaystyle  c=\frac{\sum _{i}\sum _{j}\left (j\cdot \boldsymbol{a}_{ij}\right)}{\sum _{ij}\boldsymbol{a}_{ij}}.$$\end{document}</tex-math></alternatives></disp-formula></p><p>In addition to center-of-mass triangulation, SpikeMAP includes protocols to perform monopolar triangulation and grid-based convolution, offering additional options to estimate putative soma locations based on waveform amplitudes.</p></sec><sec id="s4-11"><title>Spline interpolation</title><p>The mean waveform for each single cell was resampled at a higher rate using a piecewise cubic spline interpolation (Matlab R2015b), constructing new points within the boundaries of a set of known points using query points at 90 kHz.</p></sec><sec id="s4-12"><title>E/I classification</title><p>We used a combination of cell-type-specific viral strategies and optogenetics to address cell-type distinction. We injected PV-CRE mice (B6.Cg-Pvalb&lt;tm1.1(cre)Aibs&gt;/J) with a stabilized step-function opsin (pAAV-Ef1a-DIO hChR2 (C128S/D156A)-EYFP) bilaterally in the medial prefrontal cortex (mPFC; <xref ref-type="bibr" rid="bib5">Berndt et al., 2009</xref>). This allows for selective, prolonged activation of parvalbumin (PV) interneurons with a 100ms pulse of 465 nm blue light and deactivation with a 10 s pulse of 545–580 nm green-yellow light. Next, we computed a z-score for each neuron corresponding to photostimulation-evoked change in firing rate, expressed in units of SD from the baseline mean (<xref ref-type="fig" rid="fig5">Figure 5D</xref>). We isolated cells showing a robust increase in firing rate (z score &gt;3). A total of (n=8189, 3 slices, from 3 mice) was classified in this fashion. Overall, 7759 (94.75 %) were reliably classified as excitatory and 430 (5.25 %) were reliably identified as inhibitory. This number is close to the expected percentage of PV interneurons in cortex (4–6%; <xref ref-type="bibr" rid="bib47">Markram et al., 2004</xref>).</p></sec><sec id="s4-13"><title>LED photostimulation</title><p>LED photostimulation was delivered using a PlexBright LED module and controller (465 nm; Plexon). Light was delivered through a 200 μm patch fiber cable with a bare fiber tip with ∼1 cm of glass exposed. Photodeactivation was delivered using a yellow activation wideband 545–580 nm filter (BP545-580; Olympus).</p></sec><sec id="s4-14"><title>Immunohistochemistry</title><p>Brain slices used for immunohistochemistry were prepared from 35- to 42-day-old mice with 1×PBS used as the solvent for all solutions. Mice were anesthetized by inhalation of isoflurane. They were then intracardially perfused with 5 mL of PBS pH = 7.4 followed by 10 mL of 4% paraformaldehyde/ 0.1 M PBS, pH 7.4 for 10 min. Postfixation in 4% PFA was carried out for 2 hr before sequential cryoprotection steps in 15% and 30% sucrose over the course of 2 d. Brains were frozen in −30 °C isopentane, mounted in cryomatrix, and cut to 40 μm slices on a cryostat (CM 3050 S; Leica). Free-floating sections were blocked in 0.5% PBS-Triton-X-100 (TX-100) for 45 min and incubated in primary antibody against GFP (GFP-1020; 1:1000, AvesLabs) in blocking solution at 20 °C. On the following morning, slices were washed three times, for 5 min each time, with 0.5% PBS-Triton-X-100 before incubation in the secondary antibody goat anti-chicken–conjugated AlexaFluor 488 (Jackson Labs, 703-546-155) for 3 hr at room temperature. Slices were washed with 0.1% Tx-100 three times, for 5 min each time, before mounting onto slides with Vectashield (Vector Labs). Additionally, all slices used for recordings were saved, kept immersed in Formalin 10% in PBS pH = 7.4, for immunohistochemistry to verify viral expression. The protocol is the same as above.</p></sec></sec></body><back><sec sec-type="additional-information" id="s5"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="COI-statement" id="conf1"><p>No competing interests declared</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>Conceptualization, Resources, Data curation, Software, Formal analysis, Validation, Investigation, Visualization, Methodology, Writing – original draft, Writing – review and editing</p></fn><fn fn-type="con" id="con2"><p>Software, Formal analysis, Methodology, Writing – review and editing</p></fn><fn fn-type="con" id="con3"><p>Data curation, Software, Formal analysis, Validation, Methodology, Writing – review and editing</p></fn><fn fn-type="con" id="con4"><p>Resources, Supervision, Funding acquisition, Project administration, Writing – review and editing</p></fn><fn fn-type="con" id="con5"><p>Conceptualization, Resources, Data curation, Software, Formal analysis, Supervision, Funding acquisition, Validation, Investigation, Visualization, Methodology, Writing – original draft, Project administration, Writing – review and editing</p></fn></fn-group><fn-group content-type="ethics-information"><title>Ethics</title><fn fn-type="other"><p>All experiments and procedures were performed in accordance with approved procedures and guidelines set forth by the University of Ottawa Animal Care and Veterinary Services (protocol # 3471).</p></fn></fn-group></sec><sec sec-type="supplementary-material" id="s6"><title>Additional files</title><supplementary-material id="mdar"><label>MDAR checklist</label><media xlink:href="elife-106557-mdarchecklist1-v1.docx" mimetype="application" mime-subtype="docx"/></supplementary-material></sec><sec sec-type="data-availability" id="s7"><title>Data availability</title><p>All data generated or analysed during this study are included in the manuscript, supporting files, and supplementary data available online.</p><p>The following datasets were generated:</p><p><element-citation publication-type="data" specific-use="isSupplementedBy" id="dataset1"><person-group person-group-type="author"><name><surname>Thivierge</surname><given-names>JP</given-names></name></person-group><year iso-8601-date="2025">2025</year><data-title>SpikeMAP: An unsupervised spike sorting pipeline for cortical excitatory and inhibitory neurons in high-density multielectrode arrays</data-title><source>figshare</source><pub-id pub-id-type="doi">10.6084/m9.figshare.28458749.v1</pub-id></element-citation></p><p><element-citation publication-type="data" specific-use="isSupplementedBy" id="dataset2"><person-group person-group-type="author"><name><surname>Thivierge</surname><given-names>JP</given-names></name></person-group><year iso-8601-date="2025">2025</year><data-title>Datasets of high-density multielectrode recordings obtained from four mice</data-title><source>figshare</source><pub-id pub-id-type="doi">10.6084/m9.figshare.29416472</pub-id></element-citation></p></sec><ack id="ack"><title>Acknowledgements</title><p>This work was supported by a discovery grant from the Natural Sciences and Engineering Council of Canada (NSERC grants 210977; 210989; 2020–06901), the Canadian Institute for Health Research (175325) by the Fonds de recherche du Québec in Nature and technologie (doctoral scholarship), by the Natural Sciences and Engineering Council of Canada (NSERC CGS M scholarship) and the University of Ottawa Brain and Mind Institute.</p></ack><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bakkum</surname><given-names>DJ</given-names></name><name><surname>Obien</surname><given-names>MEJ</given-names></name><name><surname>Radivojevic</surname><given-names>M</given-names></name><name><surname>Jäckel</surname><given-names>D</given-names></name><name><surname>Frey</surname><given-names>U</given-names></name><name><surname>Takahashi</surname><given-names>H</given-names></name><name><surname>Hierlemann</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>The axon initial segment is the dominant contributor to the neuron’s extracellular electrical potential landscape</article-title><source>Advanced Biosystems</source><volume>3</volume><elocation-id>e1800308</elocation-id><pub-id pub-id-type="doi">10.1002/adbi.201800308</pub-id><pub-id pub-id-type="pmid">30882024</pub-id></element-citation></ref><ref id="bib2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Barthó</surname><given-names>P</given-names></name><name><surname>Hirase</surname><given-names>H</given-names></name><name><surname>Monconduit</surname><given-names>L</given-names></name><name><surname>Zugaro</surname><given-names>M</given-names></name><name><surname>Harris</surname><given-names>KD</given-names></name><name><surname>Buzsáki</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Characterization of neocortical principal cells and interneurons by network interactions and extracellular features</article-title><source>Journal of Neurophysiology</source><volume>92</volume><fpage>600</fpage><lpage>608</lpage><pub-id pub-id-type="doi">10.1152/jn.01170.2003</pub-id><pub-id pub-id-type="pmid">15056678</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Becchetti</surname><given-names>A</given-names></name><name><surname>Gullo</surname><given-names>F</given-names></name><name><surname>Bruno</surname><given-names>G</given-names></name><name><surname>Dossi</surname><given-names>E</given-names></name><name><surname>Lecchi</surname><given-names>M</given-names></name><name><surname>Wanke</surname><given-names>E</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Exact distinction of excitatory and inhibitory neurons in neural networks: a study with GFP-GAD67 neurons optically and electrophysiologically recognized on multielectrode arrays</article-title><source>Frontiers in Neural Circuits</source><volume>6</volume><elocation-id>63</elocation-id><pub-id pub-id-type="doi">10.3389/fncir.2012.00063</pub-id><pub-id pub-id-type="pmid">22973197</pub-id></element-citation></ref><ref id="bib4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Berdondini</surname><given-names>L</given-names></name><name><surname>Imfeld</surname><given-names>K</given-names></name><name><surname>Maccione</surname><given-names>A</given-names></name><name><surname>Tedesco</surname><given-names>M</given-names></name><name><surname>Neukom</surname><given-names>S</given-names></name><name><surname>Koudelka-Hep</surname><given-names>M</given-names></name><name><surname>Martinoia</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Active pixel sensor array for high spatio-temporal resolution electrophysiological recordings from single cell to large scale neuronal networks</article-title><source>Lab on a Chip</source><volume>9</volume><fpage>2644</fpage><lpage>2651</lpage><pub-id pub-id-type="doi">10.1039/b907394a</pub-id><pub-id pub-id-type="pmid">19704979</pub-id></element-citation></ref><ref id="bib5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Berndt</surname><given-names>A</given-names></name><name><surname>Yizhar</surname><given-names>O</given-names></name><name><surname>Gunaydin</surname><given-names>LA</given-names></name><name><surname>Hegemann</surname><given-names>P</given-names></name><name><surname>Deisseroth</surname><given-names>K</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Bi-stable neural state switches</article-title><source>Nature Neuroscience</source><volume>12</volume><fpage>229</fpage><lpage>234</lpage><pub-id pub-id-type="doi">10.1038/nn.2247</pub-id><pub-id pub-id-type="pmid">19079251</pub-id></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Blanche</surname><given-names>TJ</given-names></name><name><surname>Swindale</surname><given-names>NV</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Nyquist interpolation improves neuron yield in multiunit recordings</article-title><source>Journal of Neuroscience Methods</source><volume>155</volume><fpage>81</fpage><lpage>91</lpage><pub-id pub-id-type="doi">10.1016/j.jneumeth.2005.12.031</pub-id><pub-id pub-id-type="pmid">16481043</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Buccino</surname><given-names>AP</given-names></name><name><surname>Einevoll</surname><given-names>GT</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>MEArec: a fast and customizable testbench simulator for ground-truth extracellular spiking activity</article-title><source>Neuroinformatics</source><volume>19</volume><fpage>185</fpage><lpage>204</lpage><pub-id pub-id-type="doi">10.1007/s12021-020-09467-7</pub-id><pub-id pub-id-type="pmid">32648042</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bugeon</surname><given-names>S</given-names></name><name><surname>Duffield</surname><given-names>J</given-names></name><name><surname>Dipoppa</surname><given-names>M</given-names></name><name><surname>Ritoux</surname><given-names>A</given-names></name><name><surname>Prankerd</surname><given-names>I</given-names></name><name><surname>Nicoloutsopoulos</surname><given-names>D</given-names></name><name><surname>Orme</surname><given-names>D</given-names></name><name><surname>Shinn</surname><given-names>M</given-names></name><name><surname>Peng</surname><given-names>H</given-names></name><name><surname>Forrest</surname><given-names>H</given-names></name><name><surname>Viduolyte</surname><given-names>A</given-names></name><name><surname>Reddy</surname><given-names>CB</given-names></name><name><surname>Isogai</surname><given-names>Y</given-names></name><name><surname>Carandini</surname><given-names>M</given-names></name><name><surname>Harris</surname><given-names>KD</given-names></name></person-group><year iso-8601-date="2022">2022</year><article-title>A transcriptomic axis predicts state modulation of cortical interneurons</article-title><source>Nature</source><volume>607</volume><fpage>330</fpage><lpage>338</lpage><pub-id pub-id-type="doi">10.1038/s41586-022-04915-7</pub-id><pub-id pub-id-type="pmid">35794483</pub-id></element-citation></ref><ref id="bib9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bullmann</surname><given-names>T</given-names></name><name><surname>Radivojevic</surname><given-names>M</given-names></name><name><surname>Huber</surname><given-names>ST</given-names></name><name><surname>Deligkaris</surname><given-names>K</given-names></name><name><surname>Hierlemann</surname><given-names>A</given-names></name><name><surname>Frey</surname><given-names>U</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Large-scale mapping of axonal arbors using high-density microelectrode arrays</article-title><source>Frontiers in Cellular Neuroscience</source><volume>13</volume><elocation-id>404</elocation-id><pub-id pub-id-type="doi">10.3389/fncel.2019.00404</pub-id><pub-id pub-id-type="pmid">31555099</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Buzsáki</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Large-scale recording of neuronal ensembles</article-title><source>Nature Neuroscience</source><volume>7</volume><fpage>446</fpage><lpage>451</lpage><pub-id pub-id-type="doi">10.1038/nn1233</pub-id><pub-id pub-id-type="pmid">15114356</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Buzsáki</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Neural syntax: cell assemblies, synapsembles, and readers</article-title><source>Neuron</source><volume>68</volume><fpage>362</fpage><lpage>385</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2010.09.023</pub-id><pub-id pub-id-type="pmid">21040841</pub-id></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Calinski</surname><given-names>T</given-names></name><name><surname>Harabasz</surname><given-names>J</given-names></name></person-group><year iso-8601-date="1974">1974</year><article-title>A dendrite method for cluster analysis</article-title><source>Communications in Statistics - Theory and Methods</source><volume>3</volume><fpage>1</fpage><lpage>27</lpage><pub-id pub-id-type="doi">10.1080/03610927408827101</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cardin</surname><given-names>JA</given-names></name><name><surname>Carlén</surname><given-names>M</given-names></name><name><surname>Meletis</surname><given-names>K</given-names></name><name><surname>Knoblich</surname><given-names>U</given-names></name><name><surname>Zhang</surname><given-names>F</given-names></name><name><surname>Deisseroth</surname><given-names>K</given-names></name><name><surname>Tsai</surname><given-names>LH</given-names></name><name><surname>Moore</surname><given-names>CI</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Driving fast-spiking cells induces gamma rhythm and controls sensory responses</article-title><source>Nature</source><volume>459</volume><fpage>663</fpage><lpage>667</lpage><pub-id pub-id-type="doi">10.1038/nature08002</pub-id><pub-id pub-id-type="pmid">19396156</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Carlson</surname><given-names>D</given-names></name><name><surname>Carin</surname><given-names>L</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Continuing progress of spike sorting in the era of big data</article-title><source>Current Opinion in Neurobiology</source><volume>55</volume><fpage>90</fpage><lpage>96</lpage><pub-id pub-id-type="doi">10.1016/j.conb.2019.02.007</pub-id><pub-id pub-id-type="pmid">30856552</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Chung</surname><given-names>JE</given-names></name><name><surname>Magland</surname><given-names>JF</given-names></name><name><surname>Barnett</surname><given-names>AH</given-names></name><name><surname>Tolosa</surname><given-names>VM</given-names></name><name><surname>Tooker</surname><given-names>AC</given-names></name><name><surname>Lee</surname><given-names>KY</given-names></name><name><surname>Shah</surname><given-names>KG</given-names></name><name><surname>Felix</surname><given-names>SH</given-names></name><name><surname>Frank</surname><given-names>LM</given-names></name><name><surname>Greengard</surname><given-names>LF</given-names></name></person-group><year iso-8601-date="2017">2017</year><data-title>A fully automated approach to spike sorting</data-title><version designator="e07ac49">e07ac49</version><source>GitHub</source><ext-link ext-link-type="uri" xlink:href="https://github.com/flatironinstitute/mountainsort">https://github.com/flatironinstitute/mountainsort</ext-link></element-citation></ref><ref id="bib16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cohen</surname><given-names>L</given-names></name><name><surname>Mizrahi</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Plasticity during motherhood: changes in excitatory and inhibitory layer 2/3 neurons in auditory cortex</article-title><source>The Journal of Neuroscience</source><volume>35</volume><fpage>1806</fpage><lpage>1815</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.1786-14.2015</pub-id><pub-id pub-id-type="pmid">25632153</pub-id></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Connors</surname><given-names>BW</given-names></name><name><surname>Gutnick</surname><given-names>MJ</given-names></name></person-group><year iso-8601-date="1990">1990</year><article-title>Intrinsic firing patterns of diverse neocortical neurons</article-title><source>Trends in Neurosciences</source><volume>13</volume><fpage>99</fpage><lpage>104</lpage><pub-id pub-id-type="doi">10.1016/0166-2236(90)90185-d</pub-id><pub-id pub-id-type="pmid">1691879</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Constantinidis</surname><given-names>C</given-names></name><name><surname>Goldman-Rakic</surname><given-names>PS</given-names></name></person-group><year iso-8601-date="2002">2002</year><article-title>Correlated discharges among putative pyramidal neurons and interneurons in the primate prefrontal cortex</article-title><source>Journal of Neurophysiology</source><volume>88</volume><fpage>3487</fpage><lpage>3497</lpage><pub-id pub-id-type="doi">10.1152/jn.00188.2002</pub-id><pub-id pub-id-type="pmid">12466463</pub-id></element-citation></ref><ref id="bib19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Delgado Ruz</surname><given-names>I</given-names></name><name><surname>Schultz</surname><given-names>SR</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Localising and classifying neurons from high density MEA recordings</article-title><source>Journal of Neuroscience Methods</source><volume>233</volume><fpage>115</fpage><lpage>128</lpage><pub-id pub-id-type="doi">10.1016/j.jneumeth.2014.05.037</pub-id><pub-id pub-id-type="pmid">24954540</pub-id></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fiscella</surname><given-names>M</given-names></name><name><surname>Farrow</surname><given-names>K</given-names></name><name><surname>Jones</surname><given-names>IL</given-names></name><name><surname>Jäckel</surname><given-names>D</given-names></name><name><surname>Müller</surname><given-names>J</given-names></name><name><surname>Frey</surname><given-names>U</given-names></name><name><surname>Bakkum</surname><given-names>DJ</given-names></name><name><surname>Hantz</surname><given-names>P</given-names></name><name><surname>Roska</surname><given-names>B</given-names></name><name><surname>Hierlemann</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Recording from defined populations of retinal ganglion cells using a high-density CMOS-integrated microelectrode array with real-time switchable electrode selection</article-title><source>Journal of Neuroscience Methods</source><volume>211</volume><fpage>103</fpage><lpage>113</lpage><pub-id pub-id-type="doi">10.1016/j.jneumeth.2012.08.017</pub-id><pub-id pub-id-type="pmid">22939921</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Giraud</surname><given-names>E</given-names></name></person-group><year iso-8601-date="2020">2020</year><data-title>BRWExtract</data-title><version designator="swh:1:rev:c8610c979368bbe52b871b0175f814d4030a75ba">swh:1:rev:c8610c979368bbe52b871b0175f814d4030a75ba</version><source>Software Heritage</source><ext-link ext-link-type="uri" xlink:href="https://archive.softwareheritage.org/swh:1:dir:b951d5ffe9d07cff91f2ddf631b40a8121ba211d;origin=https://github.com/evgiraud/BRWExtract;visit=swh:1:snp:b6ea2c549be6339a1e08a06af6b384d1bfb91bcd;anchor=swh:1:rev:c8610c979368bbe52b871b0175f814d4030a75ba">https://archive.softwareheritage.org/swh:1:dir:b951d5ffe9d07cff91f2ddf631b40a8121ba211d;origin=https://github.com/evgiraud/BRWExtract;visit=swh:1:snp:b6ea2c549be6339a1e08a06af6b384d1bfb91bcd;anchor=swh:1:rev:c8610c979368bbe52b871b0175f814d4030a75ba</ext-link></element-citation></ref><ref id="bib22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>González-Burgos</surname><given-names>G</given-names></name><name><surname>Krimer</surname><given-names>LS</given-names></name><name><surname>Povysheva</surname><given-names>NV</given-names></name><name><surname>Barrionuevo</surname><given-names>G</given-names></name><name><surname>Lewis</surname><given-names>DA</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Functional properties of fast spiking interneurons and their synaptic connections with pyramidal cells in primate dorsolateral prefrontal cortex</article-title><source>Journal of Neurophysiology</source><volume>93</volume><fpage>942</fpage><lpage>953</lpage><pub-id pub-id-type="doi">10.1152/jn.00787.2004</pub-id><pub-id pub-id-type="pmid">15385591</pub-id></element-citation></ref><ref id="bib23"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Hafizi</surname><given-names>H</given-names></name><name><surname>Nigam</surname><given-names>S</given-names></name><name><surname>Barnathan</surname><given-names>J</given-names></name><name><surname>Ren</surname><given-names>N</given-names></name><name><surname>Stevenson</surname><given-names>IH</given-names></name><name><surname>Masmanidis</surname><given-names>SC</given-names></name><name><surname>Newman</surname><given-names>EL</given-names></name><name><surname>Sporns</surname><given-names>O</given-names></name><name><surname>Beggs</surname><given-names>JM</given-names></name></person-group><year iso-8601-date="2022">2022</year><article-title>Inhibition-dominated rich-club shapes dynamics in cortical microcircuits</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/2021.05.07.443074</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hasenstaub</surname><given-names>A</given-names></name><name><surname>Shu</surname><given-names>Y</given-names></name><name><surname>Haider</surname><given-names>B</given-names></name><name><surname>Kraushaar</surname><given-names>U</given-names></name><name><surname>Duque</surname><given-names>A</given-names></name><name><surname>McCormick</surname><given-names>DA</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Inhibitory postsynaptic potentials carry synchronized frequency information in active cortical networks</article-title><source>Neuron</source><volume>47</volume><fpage>423</fpage><lpage>435</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2005.06.016</pub-id><pub-id pub-id-type="pmid">16055065</pub-id></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hemberger</surname><given-names>M</given-names></name><name><surname>Shein-Idelson</surname><given-names>M</given-names></name><name><surname>Pammer</surname><given-names>L</given-names></name><name><surname>Laurent</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Reliable Sequential activation of neural assemblies by single pyramidal cells in a three-layered cortex</article-title><source>Neuron</source><volume>104</volume><fpage>353</fpage><lpage>369</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2019.07.017</pub-id><pub-id pub-id-type="pmid">31439429</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Henze</surname><given-names>DA</given-names></name><name><surname>Borhegyi</surname><given-names>Z</given-names></name><name><surname>Csicsvari</surname><given-names>J</given-names></name><name><surname>Mamiya</surname><given-names>A</given-names></name><name><surname>Harris</surname><given-names>KD</given-names></name><name><surname>Buzsáki</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2000">2000</year><article-title>Intracellular features predicted by extracellular recordings in the hippocampus in vivo</article-title><source>Journal of Neurophysiology</source><volume>84</volume><fpage>390</fpage><lpage>400</lpage><pub-id pub-id-type="doi">10.1152/jn.2000.84.1.390</pub-id><pub-id pub-id-type="pmid">10899213</pub-id></element-citation></ref><ref id="bib27"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Hilgen</surname><given-names>G</given-names></name><name><surname>Sorbaro</surname><given-names>M</given-names></name><name><surname>Pirmoradian</surname><given-names>S</given-names></name><name><surname>Muthmann</surname><given-names>JO</given-names></name><name><surname>Kepiro</surname><given-names>IE</given-names></name><name><surname>Ullo</surname><given-names>S</given-names></name><name><surname>Ramirez</surname><given-names>CJ</given-names></name><name><surname>Puente Encinas</surname><given-names>A</given-names></name><name><surname>Maccione</surname><given-names>A</given-names></name><name><surname>Berdondini</surname><given-names>L</given-names></name><name><surname>Murino</surname><given-names>V</given-names></name><name><surname>Sona</surname><given-names>D</given-names></name><name><surname>Cella Zanacchi</surname><given-names>F</given-names></name><name><surname>Sernagor</surname><given-names>E</given-names></name><name><surname>Hennig</surname><given-names>MH</given-names></name></person-group><year iso-8601-date="2017">2017</year><data-title>Unsupervised spike sorting for large-scale, high-density multielectrode arrays</data-title><version designator="6763ddd">6763ddd</version><source>Github</source><ext-link ext-link-type="uri" xlink:href="https://github.com/mhhennig/HS2">https://github.com/mhhennig/HS2</ext-link></element-citation></ref><ref id="bib28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hill</surname><given-names>DN</given-names></name><name><surname>Mehta</surname><given-names>SB</given-names></name><name><surname>Kleinfeld</surname><given-names>D</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Quality metrics to accompany spike sorting of extracellular signals</article-title><source>The Journal of Neuroscience</source><volume>31</volume><fpage>8699</fpage><lpage>8705</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.0971-11.2011</pub-id><pub-id pub-id-type="pmid">21677152</pub-id></element-citation></ref><ref id="bib29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Imfeld</surname><given-names>K</given-names></name><name><surname>Neukom</surname><given-names>S</given-names></name><name><surname>Maccione</surname><given-names>A</given-names></name><name><surname>Bornat</surname><given-names>Y</given-names></name><name><surname>Martinoia</surname><given-names>S</given-names></name><name><surname>Farine</surname><given-names>PA</given-names></name><name><surname>Koudelka-Hep</surname><given-names>M</given-names></name><name><surname>Berdondini</surname><given-names>L</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Large-scale, high-resolution data acquisition system for extracellular recording of electrophysiological activity</article-title><source>IEEE Transactions on Bio-Medical Engineering</source><volume>55</volume><fpage>2064</fpage><lpage>2073</lpage><pub-id pub-id-type="doi">10.1109/TBME.2008.919139</pub-id><pub-id pub-id-type="pmid">18632369</pub-id></element-citation></ref><ref id="bib30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Insel</surname><given-names>N</given-names></name><name><surname>Barnes</surname><given-names>CA</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Differential activation of fast-spiking and regular-firing neuron populations during movement and reward in the dorsal medial frontal cortex</article-title><source>Cerebral Cortex</source><volume>25</volume><fpage>2631</fpage><lpage>2647</lpage><pub-id pub-id-type="doi">10.1093/cercor/bhu062</pub-id><pub-id pub-id-type="pmid">24700585</pub-id></element-citation></ref><ref id="bib31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jia</surname><given-names>X</given-names></name><name><surname>Siegle</surname><given-names>JH</given-names></name><name><surname>Bennett</surname><given-names>C</given-names></name><name><surname>Gale</surname><given-names>SD</given-names></name><name><surname>Denman</surname><given-names>DJ</given-names></name><name><surname>Koch</surname><given-names>C</given-names></name><name><surname>Olsen</surname><given-names>SR</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>High-density extracellular probes reveal dendritic backpropagation and facilitate neuron classification</article-title><source>Journal of Neurophysiology</source><volume>121</volume><fpage>1831</fpage><lpage>1847</lpage><pub-id pub-id-type="doi">10.1152/jn.00680.2018</pub-id><pub-id pub-id-type="pmid">30840526</pub-id></element-citation></ref><ref id="bib32"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Jun</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2017">2017</year><data-title>JRCLUST</data-title><source>GitHub</source><ext-link ext-link-type="uri" xlink:href="https://github.com/JaneliaSciComp/JRCLUST">https://github.com/JaneliaSciComp/JRCLUST</ext-link></element-citation></ref><ref id="bib33"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Jun</surname><given-names>JJ</given-names></name><name><surname>Mitelut</surname><given-names>C</given-names></name><name><surname>Lai</surname><given-names>C</given-names></name><name><surname>Gratiy</surname><given-names>SL</given-names></name><name><surname>Anastassiou</surname><given-names>CA</given-names></name><name><surname>Harris</surname><given-names>TD</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Real-time spike sorting platform for high-density extracellular probes with ground-truth validation and drift correction</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/101030</pub-id></element-citation></ref><ref id="bib34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kawaguchi</surname><given-names>Y</given-names></name><name><surname>Kubota</surname><given-names>Y</given-names></name></person-group><year iso-8601-date="1993">1993</year><article-title>Correlation of physiological subgroupings of nonpyramidal cells with parvalbumin- and calbindinD28k-immunoreactive neurons in layer V of rat frontal cortex</article-title><source>Journal of Neurophysiology</source><volume>70</volume><fpage>387</fpage><lpage>396</lpage><pub-id pub-id-type="doi">10.1152/jn.1993.70.1.387</pub-id><pub-id pub-id-type="pmid">8395585</pub-id></element-citation></ref><ref id="bib35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kawaguchi</surname><given-names>Y</given-names></name><name><surname>Kubota</surname><given-names>Y</given-names></name></person-group><year iso-8601-date="1997">1997</year><article-title>GABAergic subtypes and their synaptic connections in rat frontal cortex</article-title><source>Cerebral Cortex</source><volume>7</volume><fpage>476</fpage><lpage>486</lpage><pub-id pub-id-type="doi">10.1093/cercor/7.6.476</pub-id></element-citation></ref><ref id="bib36"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kohl</surname><given-names>MM</given-names></name><name><surname>Paulsen</surname><given-names>O</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>The roles of GABAB receptors in cortical network activity</article-title><source>Advances in Pharmacology</source><volume>58</volume><fpage>205</fpage><lpage>229</lpage><pub-id pub-id-type="doi">10.1016/S1054-3589(10)58009-8</pub-id><pub-id pub-id-type="pmid">20655484</pub-id></element-citation></ref><ref id="bib37"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lak</surname><given-names>A</given-names></name><name><surname>Okun</surname><given-names>M</given-names></name><name><surname>Moss</surname><given-names>MM</given-names></name><name><surname>Gurnani</surname><given-names>H</given-names></name><name><surname>Farrell</surname><given-names>K</given-names></name><name><surname>Wells</surname><given-names>MJ</given-names></name><name><surname>Reddy</surname><given-names>CB</given-names></name><name><surname>Kepecs</surname><given-names>A</given-names></name><name><surname>Harris</surname><given-names>KD</given-names></name><name><surname>Carandini</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Dopaminergic and prefrontal basis of learning from sensory confidence and reward value</article-title><source>Neuron</source><volume>105</volume><fpage>700</fpage><lpage>711</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2019.11.018</pub-id><pub-id pub-id-type="pmid">31859030</pub-id></element-citation></ref><ref id="bib38"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Laquitaine</surname><given-names>S</given-names></name><name><surname>Imbeni</surname><given-names>M</given-names></name><name><surname>Tharayil</surname><given-names>J</given-names></name><name><surname>Isbister</surname><given-names>JB</given-names></name><name><surname>Reimann</surname><given-names>MW</given-names></name></person-group><year iso-8601-date="2024">2024</year><article-title>Spike sorting biases and information loss in a detailed cortical model</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/2024.12.04.626805</pub-id></element-citation></ref><ref id="bib39"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Lee</surname><given-names>J</given-names></name><name><surname>Carlson</surname><given-names>D</given-names></name><name><surname>Shokri</surname><given-names>H</given-names></name><name><surname>Yao</surname><given-names>W</given-names></name><name><surname>Goetz</surname><given-names>G</given-names></name><name><surname>Hagen</surname><given-names>E</given-names></name><name><surname>Batty</surname><given-names>E</given-names></name><name><surname>Chichilnisky</surname><given-names>E</given-names></name><name><surname>Einevoll</surname><given-names>G</given-names></name><name><surname>Paninski</surname><given-names>L</given-names></name></person-group><year iso-8601-date="2017">2017a</year><article-title>YASS: Yet Another Spike Sorter</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/151928</pub-id></element-citation></ref><ref id="bib40"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Lee</surname><given-names>JH</given-names></name><name><surname>Carlson</surname><given-names>D</given-names></name><name><surname>Shokri</surname><given-names>H</given-names></name><name><surname>Yao</surname><given-names>W</given-names></name><name><surname>Goetz</surname><given-names>G</given-names></name><name><surname>Hagen</surname><given-names>E</given-names></name><name><surname>Batty</surname><given-names>E</given-names></name><name><surname>Chichilnisky</surname><given-names>EJ</given-names></name><name><surname>Einevoll</surname><given-names>G</given-names></name><name><surname>Paninski</surname><given-names>L</given-names></name></person-group><year iso-8601-date="2017">2017b</year><data-title>YASS: yet another spike sorter</data-title><source>GitHub</source><ext-link ext-link-type="uri" xlink:href="https://github.com/paninski-lab/yass">https://github.com/paninski-lab/yass</ext-link></element-citation></ref><ref id="bib41"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lemon</surname><given-names>RN</given-names></name><name><surname>Baker</surname><given-names>SN</given-names></name><name><surname>Kraskov</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Classification of cortical neurons by spike shape and the identification of pyramidal neurons</article-title><source>Cerebral Cortex</source><volume>31</volume><fpage>5131</fpage><lpage>5138</lpage><pub-id pub-id-type="doi">10.1093/cercor/bhab147</pub-id><pub-id pub-id-type="pmid">34117760</pub-id></element-citation></ref><ref id="bib42"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lewicki</surname><given-names>MS</given-names></name></person-group><year iso-8601-date="1998">1998</year><article-title>A review of methods for spike sorting: the detection and classification of neural action potentials</article-title><source>Network</source><volume>9</volume><fpage>R53</fpage><lpage>R78</lpage><pub-id pub-id-type="doi">10.1088/0954-898x/9/4/001</pub-id><pub-id pub-id-type="pmid">10221571</pub-id></element-citation></ref><ref id="bib43"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lindén</surname><given-names>H</given-names></name><name><surname>Tetzlaff</surname><given-names>T</given-names></name><name><surname>Potjans</surname><given-names>TC</given-names></name><name><surname>Pettersen</surname><given-names>KH</given-names></name><name><surname>Grün</surname><given-names>S</given-names></name><name><surname>Diesmann</surname><given-names>M</given-names></name><name><surname>Einevoll</surname><given-names>GT</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Modeling the spatial reach of the LFP</article-title><source>Neuron</source><volume>72</volume><fpage>859</fpage><lpage>872</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2011.11.006</pub-id><pub-id pub-id-type="pmid">22153380</pub-id></element-citation></ref><ref id="bib44"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liu</surname><given-names>YH</given-names></name><name><surname>Smith</surname><given-names>S</given-names></name><name><surname>Mihalas</surname><given-names>S</given-names></name><name><surname>Shea-Brown</surname><given-names>E</given-names></name><name><surname>Sümbül</surname><given-names>U</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Cell-type-specific neuromodulation guides synaptic credit assignment in a spiking neural network</article-title><source>PNAS</source><volume>118</volume><elocation-id>e2111821118</elocation-id><pub-id pub-id-type="doi">10.1073/pnas.2111821118</pub-id><pub-id pub-id-type="pmid">34916291</pub-id></element-citation></ref><ref id="bib45"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Madisen</surname><given-names>L</given-names></name><name><surname>Mao</surname><given-names>T</given-names></name><name><surname>Koch</surname><given-names>H</given-names></name><name><surname>Zhuo</surname><given-names>J</given-names></name><name><surname>Berenyi</surname><given-names>A</given-names></name><name><surname>Fujisawa</surname><given-names>S</given-names></name><name><surname>Hsu</surname><given-names>YWA</given-names></name><name><surname>Garcia</surname><given-names>AJ</given-names></name><name><surname>Gu</surname><given-names>X</given-names></name><name><surname>Zanella</surname><given-names>S</given-names></name><name><surname>Kidney</surname><given-names>J</given-names></name><name><surname>Gu</surname><given-names>H</given-names></name><name><surname>Mao</surname><given-names>Y</given-names></name><name><surname>Hooks</surname><given-names>BM</given-names></name><name><surname>Boyden</surname><given-names>ES</given-names></name><name><surname>Buzsáki</surname><given-names>G</given-names></name><name><surname>Ramirez</surname><given-names>JM</given-names></name><name><surname>Jones</surname><given-names>AR</given-names></name><name><surname>Svoboda</surname><given-names>K</given-names></name><name><surname>Han</surname><given-names>X</given-names></name><name><surname>Turner</surname><given-names>EE</given-names></name><name><surname>Zeng</surname><given-names>H</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>A toolbox of Cre-dependent optogenetic transgenic mice for light-induced activation and silencing</article-title><source>Nature Neuroscience</source><volume>15</volume><fpage>793</fpage><lpage>802</lpage><pub-id pub-id-type="doi">10.1038/nn.3078</pub-id><pub-id pub-id-type="pmid">22446880</pub-id></element-citation></ref><ref id="bib46"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Magland</surname><given-names>J</given-names></name><name><surname>Jun</surname><given-names>JJ</given-names></name><name><surname>Lovero</surname><given-names>E</given-names></name><name><surname>Morley</surname><given-names>AJ</given-names></name><name><surname>Hurwitz</surname><given-names>CL</given-names></name><name><surname>Buccino</surname><given-names>AP</given-names></name><name><surname>Garcia</surname><given-names>S</given-names></name><name><surname>Barnett</surname><given-names>AH</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>SpikeForest, reproducible web-facing ground-truth validation of automated neural spike sorters</article-title><source>eLife</source><volume>9</volume><elocation-id>e55167</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.55167</pub-id><pub-id pub-id-type="pmid">32427564</pub-id></element-citation></ref><ref id="bib47"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Markram</surname><given-names>H</given-names></name><name><surname>Toledo-Rodriguez</surname><given-names>M</given-names></name><name><surname>Wang</surname><given-names>Y</given-names></name><name><surname>Gupta</surname><given-names>A</given-names></name><name><surname>Silberberg</surname><given-names>G</given-names></name><name><surname>Wu</surname><given-names>C</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Interneurons of the neocortical inhibitory system</article-title><source>Nature Reviews. Neuroscience</source><volume>5</volume><fpage>793</fpage><lpage>807</lpage><pub-id pub-id-type="doi">10.1038/nrn1519</pub-id><pub-id pub-id-type="pmid">15378039</pub-id></element-citation></ref><ref id="bib48"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Marre</surname><given-names>O</given-names></name><name><surname>Amodei</surname><given-names>D</given-names></name><name><surname>Deshmukh</surname><given-names>N</given-names></name><name><surname>Sadeghi</surname><given-names>K</given-names></name><name><surname>Soo</surname><given-names>F</given-names></name><name><surname>Holy</surname><given-names>TE</given-names></name><name><surname>Berry</surname><given-names>MJ</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Mapping a complete neural population in the retina</article-title><source>The Journal of Neuroscience</source><volume>32</volume><fpage>14859</fpage><lpage>14873</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.0723-12.2012</pub-id><pub-id pub-id-type="pmid">23100409</pub-id></element-citation></ref><ref id="bib49"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McCormick</surname><given-names>DA</given-names></name><name><surname>Connors</surname><given-names>BW</given-names></name><name><surname>Lighthall</surname><given-names>JW</given-names></name><name><surname>Prince</surname><given-names>DA</given-names></name></person-group><year iso-8601-date="1985">1985</year><article-title>Comparative electrophysiology of pyramidal and sparsely spiny stellate neurons of the neocortex</article-title><source>Journal of Neurophysiology</source><volume>54</volume><fpage>782</fpage><lpage>806</lpage><pub-id pub-id-type="doi">10.1152/jn.1985.54.4.782</pub-id><pub-id pub-id-type="pmid">2999347</pub-id></element-citation></ref><ref id="bib50"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mechler</surname><given-names>F</given-names></name><name><surname>Victor</surname><given-names>JD</given-names></name><name><surname>Ohiorhenuan</surname><given-names>I</given-names></name><name><surname>Schmid</surname><given-names>AM</given-names></name><name><surname>Hu</surname><given-names>Q</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Three-dimensional localization of neurons in cortical tetrode recordings</article-title><source>Journal of Neurophysiology</source><volume>106</volume><fpage>828</fpage><lpage>848</lpage><pub-id pub-id-type="doi">10.1152/jn.00515.2010</pub-id><pub-id pub-id-type="pmid">21613581</pub-id></element-citation></ref><ref id="bib51"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mitchell</surname><given-names>JF</given-names></name><name><surname>Sundberg</surname><given-names>KA</given-names></name><name><surname>Reynolds</surname><given-names>JH</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Differential attention-dependent response modulation across cell classes in macaque visual area V4</article-title><source>Neuron</source><volume>55</volume><fpage>131</fpage><lpage>141</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2007.06.018</pub-id><pub-id pub-id-type="pmid">17610822</pub-id></element-citation></ref><ref id="bib52"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Moore</surname><given-names>AK</given-names></name><name><surname>Wehr</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Parvalbumin-expressing inhibitory interneurons in auditory cortex are well-tuned for frequency</article-title><source>The Journal of Neuroscience</source><volume>33</volume><fpage>13713</fpage><lpage>13723</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.0663-13.2013</pub-id><pub-id pub-id-type="pmid">23966693</pub-id></element-citation></ref><ref id="bib53"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Muthmann</surname><given-names>JO</given-names></name><name><surname>Amin</surname><given-names>H</given-names></name><name><surname>Sernagor</surname><given-names>E</given-names></name><name><surname>Maccione</surname><given-names>A</given-names></name><name><surname>Panas</surname><given-names>D</given-names></name><name><surname>Berdondini</surname><given-names>L</given-names></name><name><surname>Bhalla</surname><given-names>US</given-names></name><name><surname>Hennig</surname><given-names>MH</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Spike detection for large neural populations using high density multielectrode arrays</article-title><source>Frontiers in Neuroinformatics</source><volume>9</volume><elocation-id>28</elocation-id><pub-id pub-id-type="doi">10.3389/fninf.2015.00028</pub-id><pub-id pub-id-type="pmid">26733859</pub-id></element-citation></ref><ref id="bib54"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nowak</surname><given-names>LG</given-names></name><name><surname>Azouz</surname><given-names>R</given-names></name><name><surname>Sanchez-Vives</surname><given-names>MV</given-names></name><name><surname>Gray</surname><given-names>CM</given-names></name><name><surname>McCormick</surname><given-names>DA</given-names></name></person-group><year iso-8601-date="2003">2003</year><article-title>Electrophysiological classes of cat primary visual cortical neurons in vivo as revealed by quantitative analyses</article-title><source>Journal of Neurophysiology</source><volume>89</volume><fpage>1541</fpage><lpage>1566</lpage><pub-id pub-id-type="doi">10.1152/jn.00580.2002</pub-id><pub-id pub-id-type="pmid">12626627</pub-id></element-citation></ref><ref id="bib55"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Obien</surname><given-names>MEJ</given-names></name><name><surname>Deligkaris</surname><given-names>K</given-names></name><name><surname>Bullmann</surname><given-names>T</given-names></name><name><surname>Bakkum</surname><given-names>DJ</given-names></name><name><surname>Frey</surname><given-names>U</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Revealing neuronal function through microelectrode array recordings</article-title><source>Frontiers in Neuroscience</source><volume>8</volume><elocation-id>423</elocation-id><pub-id pub-id-type="doi">10.3389/fnins.2014.00423</pub-id><pub-id pub-id-type="pmid">25610364</pub-id></element-citation></ref><ref id="bib56"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Pachitariu</surname><given-names>M</given-names></name><name><surname>Sridhar</surname><given-names>S</given-names></name><name><surname>Stringer</surname><given-names>C</given-names></name></person-group><year iso-8601-date="2023">2023</year><data-title>Solving the spike sorting problem with kilosort</data-title><version designator="3011620">3011620</version><source>Github</source><ext-link ext-link-type="uri" xlink:href="https://github.com/cortex-lab/KiloSort">https://github.com/cortex-lab/KiloSort</ext-link></element-citation></ref><ref id="bib57"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Peters</surname><given-names>AJ</given-names></name><name><surname>Fabre</surname><given-names>JMJ</given-names></name><name><surname>Steinmetz</surname><given-names>NA</given-names></name><name><surname>Harris</surname><given-names>KD</given-names></name><name><surname>Carandini</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Striatal activity topographically reflects cortical activity</article-title><source>Nature</source><volume>591</volume><fpage>420</fpage><lpage>425</lpage><pub-id pub-id-type="doi">10.1038/s41586-020-03166-8</pub-id><pub-id pub-id-type="pmid">33473213</pub-id></element-citation></ref><ref id="bib58"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pettersen</surname><given-names>KH</given-names></name><name><surname>Einevoll</surname><given-names>GT</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Amplitude variability and extracellular low-pass filtering of neuronal spikes</article-title><source>Biophysical Journal</source><volume>94</volume><fpage>784</fpage><lpage>802</lpage><pub-id pub-id-type="doi">10.1529/biophysj.107.111179</pub-id><pub-id pub-id-type="pmid">17921225</pub-id></element-citation></ref><ref id="bib59"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Peyrache</surname><given-names>A</given-names></name><name><surname>Dehghani</surname><given-names>N</given-names></name><name><surname>Eskandar</surname><given-names>EN</given-names></name><name><surname>Madsen</surname><given-names>JR</given-names></name><name><surname>Anderson</surname><given-names>WS</given-names></name><name><surname>Donoghue</surname><given-names>JA</given-names></name><name><surname>Hochberg</surname><given-names>LR</given-names></name><name><surname>Halgren</surname><given-names>E</given-names></name><name><surname>Cash</surname><given-names>SS</given-names></name><name><surname>Destexhe</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Spatiotemporal dynamics of neocortical excitation and inhibition during human sleep</article-title><source>PNAS</source><volume>109</volume><fpage>1731</fpage><lpage>1736</lpage><pub-id pub-id-type="doi">10.1073/pnas.1109895109</pub-id><pub-id pub-id-type="pmid">22307639</pub-id></element-citation></ref><ref id="bib60"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Peyrache</surname><given-names>A</given-names></name><name><surname>Destexhe</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Electrophysiological monitoring of inhibition in mammalian species, from rodents to humans</article-title><source>Neurobiology of Disease</source><volume>130</volume><elocation-id>104500</elocation-id><pub-id pub-id-type="doi">10.1016/j.nbd.2019.104500</pub-id><pub-id pub-id-type="pmid">31195126</pub-id></element-citation></ref><ref id="bib61"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Prentice</surname><given-names>JS</given-names></name><name><surname>Homann</surname><given-names>J</given-names></name><name><surname>Simmons</surname><given-names>KD</given-names></name><name><surname>Tkačik</surname><given-names>G</given-names></name><name><surname>Balasubramanian</surname><given-names>V</given-names></name><name><surname>Nelson</surname><given-names>PC</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Fast, scalable, Bayesian spike identification for multi-electrode arrays</article-title><source>PLOS ONE</source><volume>6</volume><elocation-id>e19884</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0019884</pub-id><pub-id pub-id-type="pmid">21799725</pub-id></element-citation></ref><ref id="bib62"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Ramsay</surname><given-names>JO</given-names></name><name><surname>Silverman</surname><given-names>BW</given-names></name></person-group><year iso-8601-date="1997">1997</year><source>Functional Data Analysis</source><publisher-name>Springer</publisher-name></element-citation></ref><ref id="bib63"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ren</surname><given-names>N</given-names></name><name><surname>Ito</surname><given-names>S</given-names></name><name><surname>Hafizi</surname><given-names>H</given-names></name><name><surname>Beggs</surname><given-names>JM</given-names></name><name><surname>Stevenson</surname><given-names>IH</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Model-based detection of putative synaptic connections from spike recordings with latency and type constraints</article-title><source>Journal of Neurophysiology</source><volume>124</volume><fpage>1588</fpage><lpage>1604</lpage><pub-id pub-id-type="doi">10.1152/jn.00066.2020</pub-id><pub-id pub-id-type="pmid">32937091</pub-id></element-citation></ref><ref id="bib64"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rey</surname><given-names>HG</given-names></name><name><surname>Pedreira</surname><given-names>C</given-names></name><name><surname>Quian Quiroga</surname><given-names>R</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Past, present and future of spike sorting techniques</article-title><source>Brain Research Bulletin</source><volume>119</volume><fpage>106</fpage><lpage>117</lpage><pub-id pub-id-type="doi">10.1016/j.brainresbull.2015.04.007</pub-id><pub-id pub-id-type="pmid">25931392</pub-id></element-citation></ref><ref id="bib65"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Riquelme</surname><given-names>JL</given-names></name><name><surname>Hemberger</surname><given-names>M</given-names></name><name><surname>Laurent</surname><given-names>G</given-names></name><name><surname>Gjorgjieva</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2023">2023</year><article-title>Single spikes drive sequential propagation and routing of activity in a cortical network</article-title><source>eLife</source><volume>12</volume><elocation-id>e79928</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.79928</pub-id><pub-id pub-id-type="pmid">36780217</pub-id></element-citation></ref><ref id="bib66"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rossant</surname><given-names>C</given-names></name><name><surname>Kadir</surname><given-names>SN</given-names></name><name><surname>Goodman</surname><given-names>DFM</given-names></name><name><surname>Schulman</surname><given-names>J</given-names></name><name><surname>Hunter</surname><given-names>MLD</given-names></name><name><surname>Saleem</surname><given-names>AB</given-names></name><name><surname>Grosmark</surname><given-names>A</given-names></name><name><surname>Belluscio</surname><given-names>M</given-names></name><name><surname>Denfield</surname><given-names>GH</given-names></name><name><surname>Ecker</surname><given-names>AS</given-names></name><name><surname>Tolias</surname><given-names>AS</given-names></name><name><surname>Solomon</surname><given-names>S</given-names></name><name><surname>Buzsaki</surname><given-names>G</given-names></name><name><surname>Carandini</surname><given-names>M</given-names></name><name><surname>Harris</surname><given-names>KD</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Spike sorting for large, dense electrode arrays</article-title><source>Nature Neuroscience</source><volume>19</volume><fpage>634</fpage><lpage>641</lpage><pub-id pub-id-type="doi">10.1038/nn.4268</pub-id><pub-id pub-id-type="pmid">26974951</pub-id></element-citation></ref><ref id="bib67"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sakata</surname><given-names>S</given-names></name><name><surname>Harris</surname><given-names>KD</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Laminar structure of spontaneous and sensory-evoked population activity in auditory cortex</article-title><source>Neuron</source><volume>64</volume><fpage>404</fpage><lpage>418</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2009.09.020</pub-id><pub-id pub-id-type="pmid">19914188</pub-id></element-citation></ref><ref id="bib68"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shein-Idelson</surname><given-names>M</given-names></name><name><surname>Pammer</surname><given-names>L</given-names></name><name><surname>Hemberger</surname><given-names>M</given-names></name><name><surname>Laurent</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Large-scale mapping of cortical synaptic projections with extracellular electrode arrays</article-title><source>Nature Methods</source><volume>14</volume><fpage>882</fpage><lpage>890</lpage><pub-id pub-id-type="doi">10.1038/nmeth.4393</pub-id><pub-id pub-id-type="pmid">28805794</pub-id></element-citation></ref><ref id="bib69"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sirota</surname><given-names>A</given-names></name><name><surname>Montgomery</surname><given-names>S</given-names></name><name><surname>Fujisawa</surname><given-names>S</given-names></name><name><surname>Isomura</surname><given-names>Y</given-names></name><name><surname>Zugaro</surname><given-names>M</given-names></name><name><surname>Buzsáki</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Entrainment of neocortical neurons and gamma oscillations by the hippocampal theta rhythm</article-title><source>Neuron</source><volume>60</volume><fpage>683</fpage><lpage>697</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2008.09.014</pub-id><pub-id pub-id-type="pmid">19038224</pub-id></element-citation></ref><ref id="bib70"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stark</surname><given-names>E</given-names></name><name><surname>Eichler</surname><given-names>R</given-names></name><name><surname>Roux</surname><given-names>L</given-names></name><name><surname>Fujisawa</surname><given-names>S</given-names></name><name><surname>Rotstein</surname><given-names>HG</given-names></name><name><surname>Buzsáki</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Inhibition-induced theta resonance in cortical circuits</article-title><source>Neuron</source><volume>80</volume><fpage>1263</fpage><lpage>1276</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2013.09.033</pub-id><pub-id pub-id-type="pmid">24314731</pub-id></element-citation></ref><ref id="bib71"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stringer</surname><given-names>C</given-names></name><name><surname>Pachitariu</surname><given-names>M</given-names></name><name><surname>Steinmetz</surname><given-names>NA</given-names></name><name><surname>Okun</surname><given-names>M</given-names></name><name><surname>Bartho</surname><given-names>P</given-names></name><name><surname>Harris</surname><given-names>KD</given-names></name><name><surname>Sahani</surname><given-names>M</given-names></name><name><surname>Lesica</surname><given-names>NA</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Inhibitory control of correlated intrinsic variability in cortical networks</article-title><source>eLife</source><volume>5</volume><elocation-id>e19695</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.19695</pub-id><pub-id pub-id-type="pmid">27926356</pub-id></element-citation></ref><ref id="bib72"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sylwestrak</surname><given-names>EL</given-names></name><name><surname>Jo</surname><given-names>YJ</given-names></name><name><surname>Vesuna</surname><given-names>S</given-names></name><name><surname>Wang</surname><given-names>X</given-names></name><name><surname>Holcomb</surname><given-names>B</given-names></name><name><surname>Tien</surname><given-names>RH</given-names></name><name><surname>Kim</surname><given-names>DK</given-names></name><name><surname>Fenno</surname><given-names>L</given-names></name><name><surname>Ramakrishnan</surname><given-names>C</given-names></name><name><surname>Allen</surname><given-names>WE</given-names></name><name><surname>Chen</surname><given-names>R</given-names></name><name><surname>Shenoy</surname><given-names>KV</given-names></name><name><surname>Sussillo</surname><given-names>D</given-names></name><name><surname>Deisseroth</surname><given-names>K</given-names></name></person-group><year iso-8601-date="2022">2022</year><article-title>Cell-type-specific population dynamics of diverse reward computations</article-title><source>Cell</source><volume>185</volume><fpage>3568</fpage><lpage>3587</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2022.08.019</pub-id><pub-id pub-id-type="pmid">36113428</pub-id></element-citation></ref><ref id="bib73"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tamura</surname><given-names>H</given-names></name><name><surname>Kaneko</surname><given-names>H</given-names></name><name><surname>Kawasaki</surname><given-names>K</given-names></name><name><surname>Fujita</surname><given-names>I</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Presumed inhibitory neurons in the macaque inferior temporal cortex: visual response properties and functional interactions with adjacent neurons</article-title><source>Journal of Neurophysiology</source><volume>91</volume><fpage>2782</fpage><lpage>2796</lpage><pub-id pub-id-type="doi">10.1152/jn.01267.2003</pub-id><pub-id pub-id-type="pmid">14711977</pub-id></element-citation></ref><ref id="bib74"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Thivierge</surname><given-names>JP</given-names></name><name><surname>Giraud</surname><given-names>E</given-names></name><name><surname>Lynn</surname><given-names>M</given-names></name><name><surname>Théberge Charbonneau</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2022">2022</year><article-title>Key role of neuronal diversity in structured reservoir computing</article-title><source>Chaos</source><volume>32</volume><elocation-id>113130</elocation-id><pub-id pub-id-type="doi">10.1063/5.0111131</pub-id><pub-id pub-id-type="pmid">36456321</pub-id></element-citation></ref><ref id="bib75"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Vendramin</surname><given-names>L</given-names></name><name><surname>Campello</surname><given-names>R</given-names></name><name><surname>Hruschka</surname><given-names>ER</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>On the comparison of relative clustering validity criteria</article-title><conf-name>Proceedings of the 2009 SIAM International Conference on Data Mining</conf-name><fpage>733</fpage><lpage>744</lpage><pub-id pub-id-type="doi">10.1137/1.9781611972795.63</pub-id></element-citation></ref><ref id="bib76"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wilson</surname><given-names>FA</given-names></name><name><surname>O’Scalaidhe</surname><given-names>SP</given-names></name><name><surname>Goldman-Rakic</surname><given-names>PS</given-names></name></person-group><year iso-8601-date="1994">1994</year><article-title>Functional synergism between putative gamma-aminobutyrate-containing neurons and pyramidal neurons in prefrontal cortex</article-title><source>PNAS</source><volume>91</volume><fpage>4009</fpage><lpage>4013</lpage><pub-id pub-id-type="doi">10.1073/pnas.91.9.4009</pub-id></element-citation></ref><ref id="bib77"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Xu</surname><given-names>R</given-names></name><name><surname>Wunsch</surname><given-names>D</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Survey of clustering algorithms</article-title><source>IEEE Transactions on Neural Networks</source><volume>16</volume><fpage>645</fpage><lpage>678</lpage><pub-id pub-id-type="doi">10.1109/TNN.2005.845141</pub-id><pub-id pub-id-type="pmid">15940994</pub-id></element-citation></ref><ref id="bib78"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yael</surname><given-names>D</given-names></name><name><surname>Bar-Gad</surname><given-names>I</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Filter based phase distortions in extracellular spikes</article-title><source>PLOS ONE</source><volume>12</volume><elocation-id>e0174790</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0174790</pub-id><pub-id pub-id-type="pmid">28358895</pub-id></element-citation></ref><ref id="bib79"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yger</surname><given-names>P</given-names></name><name><surname>Spampinato</surname><given-names>GL</given-names></name><name><surname>Esposito</surname><given-names>E</given-names></name><name><surname>Lefebvre</surname><given-names>B</given-names></name><name><surname>Deny</surname><given-names>S</given-names></name><name><surname>Gardella</surname><given-names>C</given-names></name><name><surname>Stimberg</surname><given-names>M</given-names></name><name><surname>Jetter</surname><given-names>F</given-names></name><name><surname>Zeck</surname><given-names>G</given-names></name><name><surname>Picaud</surname><given-names>S</given-names></name><name><surname>Duebel</surname><given-names>J</given-names></name><name><surname>Marre</surname><given-names>O</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>A spike sorting toolbox for up to thousands of electrodes validated with ground truth recordings in vitro and in vivo</article-title><source>eLife</source><volume>7</volume><elocation-id>e34518</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.34518</pub-id><pub-id pub-id-type="pmid">29557782</pub-id></element-citation></ref><ref id="bib80"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Yger</surname><given-names>P</given-names></name><name><surname>Stimberg</surname><given-names>M</given-names></name><name><surname>Lefebvre</surname><given-names>B</given-names></name><name><surname>Gardella</surname><given-names>C</given-names></name><name><surname>Marre</surname><given-names>O</given-names></name><name><surname>Guzman</surname><given-names>J</given-names></name><name><surname>Burman</surname><given-names>A</given-names></name><name><surname>Acland</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2023">2023</year><data-title>SpyKING CIRCUS</data-title><source>GitHub</source><ext-link ext-link-type="uri" xlink:href="https://github.com/spyking-circus/spyking-circus/">https://github.com/spyking-circus/spyking-circus/</ext-link></element-citation></ref></ref-list></back><sub-article article-type="editor-report" id="sa0"><front-stub><article-id pub-id-type="doi">10.7554/eLife.106557.3.sa0</article-id><title-group><article-title>eLife Assessment</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Scimemi</surname><given-names>Annalisa</given-names></name><role specific-use="editor">Reviewing Editor</role><aff><institution>University at Albany, State University of New York</institution><country>United States</country></aff></contrib></contrib-group><kwd-group kwd-group-type="evidence-strength"><kwd>Solid</kwd></kwd-group><kwd-group kwd-group-type="claim-importance"><kwd>Valuable</kwd></kwd-group></front-stub><body><p>In this manuscript, the authors describe a software package for automatic differentiation of action potentials generated by excitatory and inhibitory neurons, acquired using high-density microelectrode arrays. The work is <bold>valuable</bold> as it offers a tool with the potential to automatically identify these neuron types in vitro. It is <bold>solid</bold>, as it provides a tool to identify putative excitatory and inhibitory neurons on high-density electrode arrays, which can be used in conjunction with other existing spike sorting pipelines.</p></body></sub-article><sub-article article-type="referee-report" id="sa1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.106557.3.sa1</article-id><title-group><article-title>Reviewer #1 (Public review):</article-title></title-group><contrib-group><contrib contrib-type="author"><anonymous/><role specific-use="referee">Reviewer</role></contrib></contrib-group></front-stub><body><p>Summary:</p><p>The authors note that while many software packages exist for spike sorting, these do not automatically differentiate with known accuracy between excitatory and inhibitory neurons. Moreover, most existing spike sorting packages are for in vivo use, where the majority of electrodes are separated from each other by several hundred microns or more. There is a need for spike sorting packages that can take advantage of high-density electrode arrays where all electrodes are within a few tens of microns from other electrodes. Here, the authors offer such a software package with SpikeMAP, and they validate its performance in identifying parvalbumin interneurons that were optogenetically stimulated.</p><p>Strengths:</p><p>The main strength of this work is that the authors use ground truth measures to show that SpikeMAP can take features of spike shapes to correctly identify known parvalbumin interneurons against a background of other neuron types. They use spike width and peak to peak distance as the key features for distinguishing between neuron types, a method that has been around for many years (Barthó, Peter, et al. &quot;Characterization of neocortical principal cells and interneurons by network interactions and extracellular features.&quot; Journal of neurophysiology 92.1 (2004): 600-608.), but whose performance has not been validated in the context of high-density electrode arrays.</p><p>Another strength of this approach is that it is automated - a necessity if your electrode array has 4096 electrodes. Hand-sorting or even checking such a large number of channels is something even the cruellest advisor would not wish upon a graduate student. With such large channel counts, it is essential to have automated methods that are known to work accurately. Hence, the combination of validation and automation is an important advance.</p><p>A nice feature of this work is that with high-density electrode arrays, the spike waveforms appear on multiple nearby electrodes simultaneously. And since spike amplitudes fall off with distance, this allows triangulation of neuron locations within the regular electrode array. Thus, spike correlations between neuron types, or within neuron types, can be plotted as a function of distance. While SpikeMAP is not the first to do this (Peyrache, Adrien, et al. &quot;Spatiotemporal dynamics of neocortical excitation and inhibition during human sleep.&quot; Proceedings of the national academy of sciences 109.5 (2012): 1731-1736.), it is a welcome capability of this package.</p><p>It is also good that the code for this package is open-source, allowing a community of people (I expect in vitro labs will especially want to use this) to use the code and further improve it.</p><p>Weaknesses:</p><p>As this code was developed for use with a 4096-electrode array, it is important to be aware of double counting neurons across the many electrodes. I understand that there are ways within the code to ensure that this does not happen, but care must be taken in two key areas: First, action potentials traveling down axons will exhibit a triphasic waveform that is different from the biphasic waveform that appears near the cell body, but these two signals will still be from the same neuron (for example, see Litke et al., 2004 &quot;What does the eye tell the brain: Development of a System for the Large-Scale Recording of Retinal Output Activity&quot;; figure 14). I did not see anything that would directly address this situation, so it might be something for you to consider in updated versions of the code. Second, spike shapes are known to change when firing rates are high, like in bursting neurons (Harris, K.D., Hirase, H., Leinekugel, X., Henze, D.A. &amp; Buzsáki, G. Temporal interaction between single spikes and complex spike bursts in hippocampal pyramidal cells. Neuron 32, 141-149 (2001)). I did not see this addressed in the present version of the manuscript.</p><p>Another area for possible improvement would be to build on the excellent validation experiments you have already conducted with parvalbumin interneurons. Although it would take more work, similar experiments could be conducted for somatostatin and vasoactive intestinal peptide neurons against a background of excitatory neurons. These may have different spike profiles, but your success in distinguishing them can only be known if you validate against ground truth, like you did for the PV interneurons.</p><p>Appraisal:</p><p>This work addresses the need for an automated spike sorting software package for high density electrode arrays. Although no spike sorting software is flawless, the package presented here, SpikeMAP, has been validated on PV interneurons, inspiring a degree of confidence. This is a good start, and further validation on other neuron types could increase that confidence. Groups doing in vitro experiments, where 4096 electrode arrays are more common, could find this system particularly helpful.</p><p>Comments on revised version:</p><p>I appreciate the dialogue that has occurred over this submission. I have seen how the authors have taken into account the issues that I have raised, as well as those brought up by reviewer 2. I am satisfied that the paper has improved and is now a novel and useful contribution in the area of spike sorting.</p></body></sub-article><sub-article article-type="referee-report" id="sa2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.106557.3.sa2</article-id><title-group><article-title>Reviewer #2 (Public review):</article-title></title-group><contrib-group><contrib contrib-type="author"><anonymous/><role specific-use="referee">Reviewer</role></contrib></contrib-group></front-stub><body><p>Summary:</p><p>In this paper, entitled &quot;SpikeMAP: An unsupervised spike sorting pipeline for cortical excitatory and inhibitory 2 neurons in high-density multielectrode arrays with ground-truth validation&quot;, the authors are presenting spikeMAP, a pipeline for the analysis of large-scale recordings of in vitro cortical activity. According to the authors, spikeMAP not only allows for the detection of spikes produced by single neurons (spike sorting), but also allows for the reliable distinction between genetically determined cell types by utilizing viral and optogenetic strategies as ground-truth validation. While I find that the paper is nicely written, and easy to follow, I find that the algorithmic part of the paper is not really new and should have been more carefully compared to existing solutions. While the GT recordings to assess the possibilities of a spike sorting tool to distinguish properly between excitatory and inhibitory neurons is interesting, spikeMAP does not seem to bring anything new to state of the art solutions, and/or, at least, it would deserve to be properly benchmarked. This is why I would suggest the authors to perform a more intensive comparison with existing spike sorters.</p><p>Strengths:</p><p>The GT recordings with optogenetic activation of the cells, based on the opsins is interesting and might provide useful data to quantify how good spike sorting pipelines are, in vitro, to discriminate between excitatory and inhibitory neurons. Such an approach can be quite complementary with artificially generated ground truth.</p><p>Weaknesses:</p><p>The global workflow of spikeMAP, described in Figure 1, seems to be very similar to the one of [Hilgen et al, 2020, 10.1016/j.celrep.2017.02.038.]. Therefore, the first question is what is the rationale of reinventing the wheel, and not using tools that are doing something very similar (as mentioned by the authors themselves). I have a hard time, in general, believing that spikeMAP has something particularly special, given its Methods, compared to state-of-the-art spike sorters. This is why at the very least, the title of the paper is misleading, because it let the reader think that the core of the paper will be about a new spike sorting pipeline. If this is the main message the authors want to convey, then I think that numerous validations/benchmarks are missing to assess first how good spikeMAP is, w.r.t. spike sorting in general, before deciding if this is indeed the right tool to discriminate excitatory vs inhibitory cells. The GT validation, while interesting, is not enough to entirely validate the paper. The details are a bit too scarce to me, or would deserve to be better explained (see other comments after)</p><p>Regarding the putative location of the spikes, it has been shown that center of mass, while easy to compute, is not the most accurate solution [Scopin et al, 2024, 10.1016/j.jneumeth.2024.110297]. For example, it has an intrinsic bias for finding positions within the boundaries of the electrodes, while some other methods such as monopolar triangulation or grid-based convolution might have better performances. Can the authors comment on the choice of Center of Mass as a unique way to triangulate the sources?</p><p>Still in Figure 1, I am not sure to really see the point of Spline Interpolation. I see the point of such a smoothing, but the authors should demonstrate that it has a key impact on the distinction of Excitatory vs. Inhibitory cells. What's special with the value of 90kHz for a signal recorded at 18kHz? What is the gain with spline enhancement compared to without? Does such a value depend on the sampling rate, or is it a global optimum found by the authors?</p><p>Figure 2 is not really clear, especially panel B. The choice of the time scale for the B panel might not be the most appropriate, and the legend filtered/unfiltered with a dot is not clear to me in Bii. In panel E, the authors are making two clusters with PCA projections on single waveforms. Does this mean that the PCA is only applied to the main waveforms, i.e. the ones obtained where the amplitudes are peaking the most? This is not really clear from the methods, but if this is the case, then this approach is a bit simplistic and not really matching state-of-the-art solutions. Spike waveforms are quite often, especially with such high-density arrays, covering multiple channels at once and thus the extracellular patterns triggered by the single units on the MEA are spatio-temporal motifs occurring on several channels. This is why, in modern spike sorters, the information in a local neighbourhood is often kept to be projected, via PCA, on the lower dimensional space before clustering. Information on a single channel only might not be informative enough to disambiguate sources. Can the authors comment on that, and what is the exact spatial resolution of the 3Brain device? The way the authors are performing the SVD should be clarified in the methods section. Is it on a single channel, and/or on multiple channels in a local neighbourhood?</p><p>About the isolation of the single units, here again, I think the manuscript lacks some technical details. The authors are saying that they are using a k-means cluster analysis with k=2. This means that the authors are explicitly looking for 2 clusters per electrodes. If so, this is a really strong assumption that should not be held in the context of spike sorting, because since it is a blind source separation technique, one cannot pre-determine in advance how many sources are present in the vicinity of a given electrode. While the illustration on Figure 2E is ok, there is no guarantee that one cannot find more clusters, so why this choice of k=2? Again, this is why most modern spike sorting pipelines are not relying on k-means, to avoid any hard coded number of clusters. Can the authors comment on that?</p><p>I'm surprised by the linear decay of the maximal amplitude as a function of the distance from soma, as shown in Figure 2H. Is it really what should be expected? Based on the properties of the extracellular media, shouldn't we expect a power law for the decay of the amplitude? This is strange that up to 100um away from the some, the max amplitude only dropped from 260 to 240 uV. Can the authors comment on that? It would be interesting to plot that for all neurons recorded, in a normed manner V/max(V) as function of distances, to see what the curve looks like</p><p>In Figure 3A, it seems that the total number of cells is rather low for such a large number of electrodes. What are the quality criteria that are used to keep these cells? Did the authors exclude some cells from the analysis, and if yes, what are the quality criteria that are used to keep cells? If no criteria are used (because none is mentioned in the Methods), then how come so few cells are detected, and can the authors convince us that these neurons are indeed &quot;clean&quot; units (RPVs, SNRs, ...)</p><p>Still in Figure 3A, it looks like there is a bias to find inhibitory cells at the borders, since they do not appear to be uniformly distributed over the MEA. Can the authors comment on that? What would be the explanation for such a behaviour? It would be interesting to see some macroscopic quantities on Excitatory/Inhibitory cells, such as mean firing rates, averaged SNRs, ... Because again, in Figure 3C, it is not clear to me that the firing rates of inhibitory cells is higher than Excitatory ones, while it should be in theory.</p><p>For Figure 3 in general, I would have performed an exhaustive comparison of putative cells found by spikeMAP and other sorters. More precisely, I think that to prove the point that spikeMAP is indeed bringing something new to the field of spike sorting, the authors should have compared the performances of various spike sorters to discriminate Exc vs Inh cells based on their ground truth recordings. For example, either using Kilosort [Pachitariu et al, 2024, 10.1038/s41592-024-02232-7], or some other sorters that might be working with such large high-density data [Yger et al, 2018, 10.7554/eLife.34518]</p><p>Figure 4 has a big issue, and I guess the panels A and B should be redrawn. I don't understand what the red rectangle is displaying.</p><p>I understand that Figure 4 is only one example, but I have a hard time understanding from the manuscript how many slices/mice were used to obtain the GT data? I guess the manuscript could be enhanced by turning the data into an open access dataset, but then some clarification is needed. How many flashes/animals/slices are we talking about. Maybe this should be illustrated in Figure 4, if this figure is devoted to the introduction of the GT data.</p><p>While there is no doubt that GT data as the ones recorded here by the authors are the most interesting data from a validation point of view, the pretty low yield of such experiments should not discourage the use of artificially generated recordings such as the ones made in [Buccino et al, 2020, 10.1007/s12021-020-09467-7] or even recently in [Laquitaine et al, 2024, 10.1101/2024.12.04.626805v1]. In these papers, the authors have putative waveforms/firing rates patterns for excitatory and inhibitory cells, and thus the authors could test how good they are in discriminating the two subtypes</p><p>Comments on revised version:</p><p>While I must thank the authors for their answers, I still think that they miss an important one, and only partially answering some of my concerns.</p><p>I truly think that SpikeMAP would benefit with a comparison with a state-of-the-art spike sorting pipeline, for example Kilosort. The authors said that they made the sorter modular enough such that only the E/I classification step can be compared. I think this would be worth it, just to be sure that SpikeMAP spike sorting, which might be more simple than other recent solution (with template matching), is not missing some cells, and thus degrading the E/I classification performances. I know that such a comparison is not straightforward, because there is no clear ground truth, but I would still need to be convinced that the sorting pipelines is bringing something, on its own. While there is no doubt that the E/I classification layer can be interesting, especially given the recordings shared by the authors, I'm still a bit puzzled by the sorting step. Thus maybe either a Table, a figure, or even as Supplementary one. Or the authors could try to generate fake GT data with MEArec for example, with putative E/I cells (discriminated via waveforms and firing rates) and show on such (oversimplified) data that SpikeMAP is performing similarly to modern spike sorters. Otherwise, this is a bit hard to judge...</p></body></sub-article><sub-article article-type="author-comment" id="sa3"><front-stub><article-id pub-id-type="doi">10.7554/eLife.106557.3.sa3</article-id><title-group><article-title>Author response</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Giraud</surname><given-names>Eloise</given-names></name><role specific-use="author">Author</role><aff><institution>University of Ottawa</institution><addr-line><named-content content-type="city">Ottawa</named-content></addr-line><country>Canada</country></aff></contrib><contrib contrib-type="author"><name><surname>Lynn</surname><given-names>Michael</given-names></name><role specific-use="author">Author</role><aff><institution>University of Oxford</institution><addr-line><named-content content-type="city">Oxford</named-content></addr-line><country>United Kingdom</country></aff></contrib><contrib contrib-type="author"><name><surname>Vincent-Lamarre</surname><given-names>Philippe</given-names></name><role specific-use="author">Author</role><aff><institution>University of Montreal</institution><addr-line><named-content content-type="city">Montreal</named-content></addr-line><country>Canada</country></aff></contrib><contrib contrib-type="author"><name><surname>Beique</surname><given-names>Jean-Claude</given-names></name><role specific-use="author">Author</role><aff><institution>University of Ottawa</institution><addr-line><named-content content-type="city">Ottawa</named-content></addr-line><country>Canada</country></aff></contrib><contrib contrib-type="author"><name><surname>Thivierge</surname><given-names>Jean-Philippe</given-names></name><role specific-use="author">Author</role><aff><institution>University of Ottawa</institution><addr-line><named-content content-type="city">Ottawa</named-content></addr-line><country>Canada</country></aff></contrib></contrib-group></front-stub><body><p>The following is the authors’ response to the original reviews.</p><disp-quote content-type="editor-comment"><p><bold>Reviewer #1 (Public review)</bold></p><p>As this code was developed for use with a 4096 electrode array, it is important to be aware of double-counting neurons across the many electrodes. I understand that there are ways within the code to ensure that this does not happen, but care must be taken in two key areas. Firstly, action potentials traveling down axons will exhibit a triphasic waveform that is different from the biphasic waveform that appears near the cell body, but these two signals will still be from the same neuron (for example, see Litke et al., 2004 &quot;What does the eye tell the brain: Development of a System for the Large-Scale Recording of Retinal Output Activity&quot;; figure 14). I did not see anything that would directly address this situation, so it might be something for you to consider in updated versions of the code.</p></disp-quote><p>Thank you for this comment. We have added a routine to the SpikeMAP to remove highly correlated spikes detected within a given spatial radius of each other. The following was added to the main text (line 149):</p><p>“As an additional verification step, SpikeMAP allows the computation of spike-count correlations between putative neurons located within a user-defined radius. Signals that exceed a defined threshold of correlation can be rejected as they likely reflect the same underlying cell.”</p><disp-quote content-type="editor-comment"><p>Secondly, spike shapes are known to change when firing rates are high, like in bursting neurons (Harris, K.D., Hirase, H., Leinekugel, X., Henze, D.A. &amp; Buzsáki, G. Temporal interaction between single spikes and complex spike bursts in hippocampal pyramidal cells. Neuron 32, 141-149 (2001)). I did not see this addressed in the present version of the manuscript.</p></disp-quote><p>We have added a routine to SpikeMAP that computes population spike rates to verify stationarity over time. We have also added a routine to identify putative bursting neurons through a Hartigan statistical dip test applied to the inter-spike distribution of individual cells.</p><p>We added the following (line 204):</p><p>“Further, SpikeMAP contains a routine to perform a Hartigan statistical dip test on the inter-spike distribution of individual cells to detect putative bursting neurons.”</p><disp-quote content-type="editor-comment"><p>Another area for possible improvement would be to build on the excellent validation experiments you have already conducted with parvalbumin interneurons. Although it would take more work, similar experiments could be conducted for somatostatin and vasoactive intestinal peptide neurons against a background of excitatory neurons. These may have different spike profiles, but your success in distinguishing them can only be known if you validate against ground truth, like you did for the PV interneurons.</p></disp-quote><p>We have added the following (line 326):</p><p>“future work could include different inhibitory interneurons such as somatostatin (SOM) and vasoactive intestinal polypeptide (VIP) neurons to improve the classification of inhibitory cell types. Another avenue could involve applying SpikeMAP on artificially generated spike data (Buccino &amp; Einevoll 2021; Laquitaine et al., 2024).”</p><disp-quote content-type="editor-comment"><p><bold>Reviewer #2 (Public review)</bold></p><p>Summary:</p><p>While I find that the paper is nicely written and easy to follow, I find that the algorithmic part of the paper is not really new and should have been more carefully compared to existing solutions. While the GT recordings to assess the possibilities of a spike sorting tool to distinguish properly between excitatory and inhibitory neurons are interesting, spikeMAP does not seem to bring anything new to state-of-the-art solutions, and/or, at least, it would deserve to be properly benchmarked. I would suggest that the authors perform a more intensive comparison with existing spike sorters.</p></disp-quote><p>Thank you for your insightful comment. A full comparison between SpikeMAP and related methods is provided in Table. 1. As can be seen, SpikeMAP is the only method listed that performs E/I sorting on large-scale multielectrodes. Nonetheless, several aspects of SpikeMAP included in the spike sorting pipeline do overlap with existing methods, as these constitute necessary steps prior to performing E/I identification. These steps are not novel to the current work, nor do they constitute rigid options that cannot be substituted by the user. Rather, we aim to offer SpikeMAP users the option to combine E/I identification with preliminary steps performed either through our software or through another package of their choosing. For instance, preliminary spike sorting could be done through Kilosort before importing the spike data into SpikeMAP for E/I identification. To allow greater flexibility, we have now modularized our suite so that E/I identification can be performed as a stand-alone module. We have clarified the text accordingly (line 317):</p><p>“While SpikeMAP is the only known method to enable the identification of putative excitatory and inhibitory neurons on high-density multielectrode arrays (Table 1), several aspects of SpikeMAP included in the spike sorting pipeline (Figure 1) overlap with existing methods, as these constitute required steps prior to performing E/I identification. To enable users the ability to integrate SpikeMAP with existing toolboxes, we provide a modularized suite of protocols so that E/I identification can be performed separately from preliminary spike sorting steps. In this way, a user could carry out spike sorting through Kilosort or another package before importing their data to SpikeMAP for E/I identification.”</p><disp-quote content-type="editor-comment"><p>Weaknesses:</p><p>(1) The global workflow of spikeMAP, described in Figure 1, seems to be very similar to that of Hilgen et al. 2020 (10.1016/j.celrep.2017.02.038). Therefore, the first question is what is the rationale of reinventing the wheel, and not using tools that are doing something very similar (as mentioned by the authors themselves). I have a hard time, in general, believing that spikeMAP has something particularly special, given its Methods, compared to state-of-the-art spike sorters.</p></disp-quote><p>The paper by Hilgen et al. is reported in Table 1. As seen, while this paper employs optogenetics, it does not target inhibitory (e.g., PV) cells. We have added the following clarification (line 82):</p><p>“Despite evidence showing differences in action potential kinetics for distinct cell-types as well as the use of optogenetics (Hilgen et al., 2017), there exists no large-scale validation efforts, to our knowledge, showing that extracellular waveforms can be used to reliably distinguish cell-types.”</p><disp-quote content-type="editor-comment"><p>This is why, at the very least, the title of the paper is misleading, because it lets the reader think that the core of the paper will be about a new spike sorting pipeline. If this is the main message the authors want to convey, then I think that numerous validations/benchmarks are missing to assess first how good spikeMAP is, with reference to spike sorting in general, before deciding if this is indeed the right tool to discriminate excitatory vs inhibitory cells. The GT validation, while interesting, is not enough to entirely validate the paper. The details are a bit too scarce for me, or would deserve to be better explained (see other comments after).</p></disp-quote><p>We thank the reviewer for this comment, and have amended the title as follows:</p><p>“SpikeMAP: An unsupervised pipeline for the identification of cortical excitatory and inhibitory neurons in high-density multielectrode arrays with ground-truth validation”</p><disp-quote content-type="editor-comment"><p>(2) Regarding the putative location of the spikes, it has been shown that the center of mass, while easy to compute, is not the most accurate solution [Scopin et al, 2024, 10.1016/j.jneumeth.2024.110297]. For example, it has an intrinsic bias for finding positions within the boundaries of the electrodes, while some other methods, such as monopolar triangulation or grid-based convolution,n might have better performances. Can the authors comment on the choice of the Center of Mass as a unique way to triangulate the sources?</p></disp-quote><p>We agree with the reviewer that the center-of-mass algorithm carries limitations that are addressed by other methods. To address this issue, we have included two additional protocols in SpikeMAP to perform monopolar triangulation and grid-based convolution, offering additional options for users of the package. The text has been clarified as follows (line 429):</p><p>“In addition to center-of-mass triangulation, SpikeMAP includes protocols to perform monopolar triangulation and grid-based convolution, offering additional options to estimate putative soma locations based on waveform amplitudes.”</p><disp-quote content-type="editor-comment"><p>(3) Still in Figure 1, I am not sure I really see the point of Spline Interpolation. I see the point of such a smoothing, but the authors should demonstrate that it has a key impact on the distinction of Excitatory vs. Inhibitory cells. What is special about the value of 90kHz for a signal recorded at 18kHz? What is the gain with spline enhancement compared to without? Does such a value depend on the sampling rate, or is it a global optimum found by the authors?</p></disp-quote><p>We clarified the text as follows (line 183):</p><p>“While we found that a resolution of 90 kHZ provided a reasonable estimate of spike waveforms, this value can be adjusted as a parameter in SpikeMAP.”</p><disp-quote content-type="editor-comment"><p>(4) Figure 2 is not really clear, especially panel B. The choice of the time scale for the B panel might not be the most appropriate, and the legend filtered/unfiltered with a dot is not clear to me in Bii.</p></disp-quote><p>We apologize for the rendering issues in the Figures that occurred during conversion into PDF format. We have now ensured that all figures are properly displayed.</p><p>In panel E, the authors are making two clusters with PCA projections on single waveforms. Does this mean that the PCA is only applied to the main waveforms, i.e. the ones obtained where the amplitudes are peaking the most? This is not really clear from the methods, but if this is the case, then this approach is a bit simplistic and does not really match state-of-the-art solutions. Spike waveforms are quite often, especially with such high-density arrays, covering multiple channels at once, and thus the extracellular patterns triggered by the single units on the MEA are spatio-temporal motifs occurring on several channels. This is why, in modern spike sorters, the information in a local neighbourhood is often kept to be projected, via PCA, on the lower-dimensional space before clustering. Information on a single channel only might not be informative enough to disambiguate sources. Can the authors comment on that, and what is the exact spatial resolution of the 3Brain device? The way the authors are performing the SVD should be clarified in the methods section. Is it on a single channel, and/or on multiple channels in a local neighbourhood?</p><p>We agree with the reviewer that it would be useful to have the option of performing PCA on several channels at once, since spikes can occur at several channels at the same time. We have now added a routine to SpikeMAP that allows users to define a radius around individual channels prior to performing PCA. The text was clarified as follows (line 131):</p><p>“The SpikeMAP suite also offers a routine to select a radius around individual channels in order to enter groups of adjacent channels in PCA.”</p><disp-quote content-type="editor-comment"><p>(5) About the isolation of the single units, here again, I think the manuscript lacks some technical details. The authors are saying that they are using a k-means cluster analysis with k=2. This means that the authors are explicitly looking for 2 clusters per electrode? If so, this is a really strong assumption that should not be held in the context of spike sorting, because, since it is a blind source separation technique, one can not pre-determine in advance how many sources are present in the vicinity of a given electrode. While the illustration in Figure 2E is ok, there is no guarantee that one can not find more clusters, so why this choice of k=2? Again, this is why most modern spike sorting pipelines do not rely on k-means, to avoid any hard-coded number of clusters. Can the authors comment on that?</p></disp-quote><p>We clarified the text as follows (line 135):</p><p>“In SpikeMAP, the optimal number of k-means clusters can be chosen by a Calinski-Harabasz criterion (Calinski and Harabasz, 1974) or pre-selected by the user.”</p><disp-quote content-type="editor-comment"><p>(6) I'm surprised by the linear decay of the maximal amplitude as a function of the distance from the soma, as shown in Figure 2H. Is it really what should be expected? Based on the properties of the extracellular media, shouldn't we expect a power law for the decay of the amplitude? This is strange that up to 100um away from the soma, the max amplitude only dropped from 260 to 240 uV. Can the authors comment on that? It would be interesting to plot that for all neurons recorded, in a normed manner V/max(V) as function of distances, to see what the curve looks like.</p></disp-quote><p>We added Supplemental Figure 1 showing the drop in voltage over all putative somas (N=1,950) of one recording, after excluding somas with an increase voltage away from electrode peak and computing normed values V/max(V). We see a distribution of slopes as well as intercepts across somas, showing some variability across recordings sites. As the reviewer suggests, it is possible that a power-law describes these data better than a linear function, and this would need to be investigated further by quantitatively comparing the fit of these functions.</p><disp-quote content-type="editor-comment"><p>(7) In Figure 3A, it seems that the total number of cells is rather low for such a large number of electrodes. What are the quality criteria that are used to keep these cells? Did the authors exclude some cells from the analysis, and if yes, what are the quality criteria that are used to keep cells? If no criteria are used (because none are mentioned in the Methods), then how come so few cells are detected, and can the authors convince us that these neurons are indeed &quot;clean&quot; units (RPVs, SNRs, ...)?</p></disp-quote><p>The reviewer is correct to point out that a number of stringent criteria were employed to exclude some putative cells. We now outline these criteria directly in the text (line 161):</p><p>“ At different steps in the process, conditions for rejecting spikes can be tailored by applying: (1) a stringent threshold to filtered voltages; (2) a minimal cut-off on the signal-to-noise ratio of voltages (see Supplemental Figure 2); (3) an LDA for cluster separability; (4) a minimal spike rate to putative neurons; (5) a Hartigan statistical dip test to detect spike bursting; (6) a decrease in voltage away from putative somas; and (7) a maximum spike-count correlation for nearby channels. Together, these criteria allow SpikeMAP users the ability to precisely control parameters relevant to automated spike sorting.”</p><p>Further, we provide SNRs of individual channels (Supplemental Figure 2), and added to the SpikeMAP software the ability to apply a minimal criterion based on SNR.</p><disp-quote content-type="editor-comment"><p>(8) Still in Figure 3A, it looks like there is a bias to find inhibitory cells at the borders, since they do not appear to be uniformly distributed over the MEA. Can the authors comment on that? What would be the explanation for such a behaviour? It would be interesting to see some macroscopic quantities on Excitatory/Inhibitory cells, such as mean firing rates, averaged SNRs... Because again, in Figure 3C, it is not clear to me that the firing rates of inhibitory cells are higher than Excitatory ones, whilst they should be in theory.</p></disp-quote><p>We have added figures showing the distribution of E and I firing rates across a population of N=1,950 putative cells (Supplemental Figure 3). Firing rates of inhibitory neurons are marginally higher than excitatory neurons, and both E and I follow an approximately exponential distribution of rates.</p><p>Reviewer may be right that there are more I neurons at borders in Fig.3B because injections were done in medial prefrontal cortex, so this may reflect an experimental artefact related to a high probability of activating I neurons in locations where the opsin was activated. We added a sentence to the text to clarify this point (line 201):</p><p>“It is possible that the spatial location of putative I cells reflects the site of injection of the opsin in medial prefrontal cortex.”</p><disp-quote content-type="editor-comment"><p>(9) For Figure 3 in general, I would have performed an exhaustive comparison of putative cells found by spikeMAP and other sorters. More precisely, I think that to prove the point that spikeMAP is indeed bringing something new to the field of spike sorting, the authors should have compared the performances of various spike sorters to discriminate Exc vs Inh cells based on their ground truth recordings. For example, either using Kilosort [Pachitariu et al, 2024, 10.1038/s41592-024-02232-7], or some other sorters that might be working with such large high-density data [Yger et al, 2018, 10.7554/eLife.34518].</p></disp-quote><p>The reviewer is correct to point out that our the spike-sorting portion of our pipeline shares similarities with related approaches. Other aspects, however, are unique to SpikeMAP. We have clarified the text accordingly:</p><p>“In sum, SpikeMAP provides an end-to-end pipeline to perform spike-sorting on high-density multielectrode arrays. Some elements of this pipeline are similar to related approaches (Table 1), including the use of voltage filtering, PCA, and k-means clustering. Other elements are novel, including the use of spline interpolation, LDA, and the ability to identify putative excitatory and inhibitory cells.”</p><disp-quote content-type="editor-comment"><p>(10) Figure 4 has a big issue, and I guess the panels A and B should be redrawn. I don't understand what the red rectangle is displaying.</p></disp-quote><p>Again, we apologize for the rendering issues in the Figures that occurred during conversion into PDF format. We have now ensured that all figures are properly displayed.</p><disp-quote content-type="editor-comment"><p>(11) I understand that Figure 4 is only one example, but I have a hard time understanding from the manuscript how many slices/mices were used to obtain the GT data? I guess the manuscript could be enhanced by turning the data into an open-access dataset, but then some clarification is needed. How many flashes/animals/slices are we talking about? Maybe this should be illustrated in Figure 4, if this figure is devoted to the introduction of the GT data.</p></disp-quote><p>Details of the open access data are now provided in Supplemental Table 1. We also clarified Figure 5B:</p><p>“Quantification of change in firing rate following optogenetic stimulation. Average firing rates are taken over four recordings obtained from 3 mice.”</p><disp-quote content-type="editor-comment"><p>(12) While there is no doubt that GT data as the ones recorded here by the authors are the most interesting data from a validation point of view, the pretty low yield of such experiments should not discourage the use of artificially generated recordings such as the ones made in [Buccino et al, 2020, 10.1007/s12021-020-09467-7] or even recently in [Laquitaine et al, 2024, 10.1101/2024.12.04.626805v1]. In these papers, the authors have putative waveforms/firing rate patterns for excitatory and inhibitory cells, and thus, the authors could test how good they are in discriminating the two subtypes.</p></disp-quote><p>We agree with the reviewer that it would be worthwhile for future work to apply SpikeMAP to artificially generated spike trains, and have added the following (line 328):</p><p>“Another avenue could involve applying SpikeMAP on artificially generated spike data (Buccino &amp; Einevoll 2021; Laquitaine et al., 2024).”</p><disp-quote content-type="editor-comment"><p><bold>Reviewer #1 (Recommendations for the authors):</bold></p><p>(1) Line 154 seems to include a parenthetical expression left over from editing: &quot;sensitive to noise (contamination? Better than noise?) generated by the signal of proximal units.&quot; See also line 186: &quot;use (reliance?) of light-sensitive&quot; and line 245: &quot;In the absence of synaptic blockers (right?),&quot; and line 270: &quot;the size of the data prevents manual intervention (curation?).&quot; Check carefully for all parentheses like that, which should be removed.</p></disp-quote><p>Thank you for pointing this out. We have revised the text and removed parenthetical expressions left over from editing.</p><disp-quote content-type="editor-comment"><p>(2) In lines 285-286, you state that: &quot;k-mean clustering of spike waveform properties best differentiated the two principal classes of cells...&quot; But I could not find where you compared k-means clustering to other methods. I think you just argued that k-means seemed to work well, but not better than, another method. If that is so, then you should probably rephrase those lines.</p></disp-quote><p>The reviewer is correct that direct comparisons are not performed here, hence we removed this sentence.</p><disp-quote content-type="editor-comment"><p>(3) Methods section, E/I classification, lines 396-405: You give us figures on what fraction was E and I (PV subtype) (94.75% and 5.25%), but there is more that you could have said. First of all, what is the expected fraction of parvalbumin-sensitive interneurons in the cortex - is it near 5%?</p></disp-quote><p>We clarified the text as follows (line 444): “This number is close to the expected percentage of PV interneurons in cortex (4-6%) (Markram et al. 2004).”</p><disp-quote content-type="editor-comment"><p>Second, how would these percentages change if you altered the threshold from 3 s.d. to something lower, like 2 s.d.? Giving us some idea of how the threshold affects the fraction of PV interneurons could give us an idea of whether this method agrees with our expectations or not.</p></disp-quote><p>While SpikeMAP offers the flexibility to set the voltage threshold manually, we opted for a stringent threshold to demonstrate the capabilities of the software. As seen in Figure 2D, at 2 and 3 s.d., the signal is largely accounted for by Gaussian noise, while deviation from noise arises around 4 s.d. We clarified the text as follows (line 120):</p><p>“At a threshold of -3 , the signal could be largely accounted for by Gaussian noise, while a separation between signal and noise began around a threshold of -4 ”</p><disp-quote content-type="editor-comment"><p>Third, did the inhibitory neurons identified by this optogenetic method also have narrow spike widths at half amplitude? Could you do a scatterplot of all the spike widths and inter-peak distances that had color-coded dots for E and I based on your optogenetic method?</p></disp-quote><p>We have added a scatterplot (Supplemental Figure 5).</p><disp-quote content-type="editor-comment"><p>(4) Can you compare your methods with others now widely in use, like, for example, Spiking Circus or Kilosort? You do that in Table 1 in terms of features, but not in terms of performance. For example, you could have applied Kilosort4 to your data from the 4096 electrode array and seen how often it sorted the same neurons that SpikeMAP did. I realize this could not give you a comparison of how many were E/I, but it could tell you how close your numbers of neurons agreed with their numbers. Were your numbers within 5% of each other? This would be helpful for groups who are already using Kilosort4.</p></disp-quote><p>As mentioned ealier, packages listed in Table 1 do not provide an identification of putative E/I neurons on high-density electrode arrays. To facilitation the integration of SpikeMAP with other spike sorting packages, our suite now provides a stand-alone module to perform E/I identification. This is now mentioned in the text (see earlier comment).</p><disp-quote content-type="editor-comment"><p><bold>Reviewer #2 (Recommendations for the authors):</bold></p><p>I would encourage the authors to decide what the paper is about: is it about a new sorting method (and if yes, more tests/benchmarks are needed to explain the pros and the cons of the pipelines, and the Methods need to be expanded). Or is it about the new data for Ground Truth validation, and again, if yes, then maybe explain more what they are, how many slices/mice/cells, ... Maybe also consider making the data available online as an open dataset.</p></disp-quote><p>We agree with the reviewer that the paper is best slated toward ground truth validation of E/I identification. We now specify how many slices/mice/cells etc. (see Supplemental Table 1) and make the data available online as open source.</p></body></sub-article></article>