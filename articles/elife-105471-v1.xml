<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD with MathML3 v1.3 20210610//EN"  "JATS-archivearticle1-3-mathml3.dtd"><article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.3"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn publication-format="electronic" pub-type="epub">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">105471</article-id><article-id pub-id-type="doi">10.7554/eLife.105471</article-id><article-id pub-id-type="doi" specific-use="version">10.7554/eLife.105471.3</article-id><article-version article-version-type="publication-state">version of record</article-version><article-categories><subj-group subj-group-type="display-channel"><subject>Research Article</subject></subj-group><subj-group subj-group-type="heading"><subject>Computational and Systems Biology</subject></subj-group><subj-group subj-group-type="heading"><subject>Immunology and Inflammation</subject></subj-group></article-categories><title-group><article-title>Thrifty wide-context models of B cell receptor somatic hypermutation</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Sung</surname><given-names>Kevin</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-7289-845X</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund2"/><xref ref-type="other" rid="fund3"/><xref ref-type="other" rid="fund4"/><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author"><name><surname>Johnson</surname><given-names>Mackenzie M</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-3915-2023</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="other" rid="fund2"/><xref ref-type="other" rid="fund4"/><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author"><name><surname>Dumm</surname><given-names>Will</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund2"/><xref ref-type="other" rid="fund3"/><xref ref-type="other" rid="fund4"/><xref ref-type="fn" rid="con3"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author"><name><surname>Simon</surname><given-names>Noah</given-names></name><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="other" rid="fund2"/><xref ref-type="other" rid="fund4"/><xref ref-type="fn" rid="con4"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author"><name><surname>Haddox</surname><given-names>Hugh</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund2"/><xref ref-type="other" rid="fund3"/><xref ref-type="other" rid="fund4"/><xref ref-type="other" rid="fund5"/><xref ref-type="fn" rid="con5"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author"><name><surname>Fukuyama</surname><given-names>Julia</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-7590-5563</contrib-id><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="other" rid="fund1"/><xref ref-type="other" rid="fund2"/><xref ref-type="other" rid="fund4"/><xref ref-type="fn" rid="con6"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" corresp="yes"><name><surname>Matsen</surname><given-names>Frederick A</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-0607-6025</contrib-id><email>matsen@fredhutch.org</email><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="aff" rid="aff5">5</xref><xref ref-type="aff" rid="aff6">6</xref><xref ref-type="other" rid="fund1"/><xref ref-type="other" rid="fund2"/><xref ref-type="other" rid="fund3"/><xref ref-type="other" rid="fund4"/><xref ref-type="other" rid="fund5"/><xref ref-type="fn" rid="con7"/><xref ref-type="fn" rid="conf1"/></contrib><aff id="aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/007ps6h72</institution-id><institution>Computational Biology Program, Fred Hutchinson Cancer Center</institution></institution-wrap><addr-line><named-content content-type="city">Seattle</named-content></addr-line><country>United States</country></aff><aff id="aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/00cvxb145</institution-id><institution>Department of Biostatistics, University of Washington</institution></institution-wrap><addr-line><named-content content-type="city">Seattle</named-content></addr-line><country>United States</country></aff><aff id="aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/01kg8sb98</institution-id><institution>Department of Statistics, Indiana University</institution></institution-wrap><addr-line><named-content content-type="city">Bloomington</named-content></addr-line><country>United States</country></aff><aff id="aff4"><label>4</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/006w34k90</institution-id><institution>Howard Hughes Medical Institute</institution></institution-wrap><addr-line><named-content content-type="city">Seattle</named-content></addr-line><country>United States</country></aff><aff id="aff5"><label>5</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/00cvxb145</institution-id><institution>Department of Genome Sciences, University of Washington</institution></institution-wrap><addr-line><named-content content-type="city">Seattle</named-content></addr-line><country>United States</country></aff><aff id="aff6"><label>6</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/00cvxb145</institution-id><institution>Department of Statistics, University of Washington</institution></institution-wrap><addr-line><named-content content-type="city">Seattle</named-content></addr-line><country>United States</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Mora</surname><given-names>Thierry</given-names></name><role>Reviewing Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/05a0dhs15</institution-id><institution>École Normale Supérieure - PSL</institution></institution-wrap><country>France</country></aff></contrib><contrib contrib-type="senior_editor"><name><surname>Walczak</surname><given-names>Aleksandra M</given-names></name><role>Senior Editor</role><aff><institution>CNRS</institution><country>France</country></aff></contrib></contrib-group><pub-date publication-format="electronic" date-type="publication"><day>29</day><month>08</month><year>2025</year></pub-date><volume>14</volume><elocation-id>RP105471</elocation-id><history><date date-type="sent-for-review" iso-8601-date="2025-01-13"><day>13</day><month>01</month><year>2025</year></date></history><pub-history><event><event-desc>This manuscript was published as a preprint.</event-desc><date date-type="preprint" iso-8601-date="2024-12-01"><day>01</day><month>12</month><year>2024</year></date><self-uri content-type="preprint" xlink:href="https://doi.org/10.1101/2024.11.26.625407"/></event><event><event-desc>This manuscript was published as a reviewed preprint.</event-desc><date date-type="reviewed-preprint" iso-8601-date="2025-03-18"><day>18</day><month>03</month><year>2025</year></date><self-uri content-type="reviewed-preprint" xlink:href="https://doi.org/10.7554/eLife.105471.1"/></event><event><event-desc>The reviewed preprint was revised.</event-desc><date date-type="reviewed-preprint" iso-8601-date="2025-07-16"><day>16</day><month>07</month><year>2025</year></date><self-uri content-type="reviewed-preprint" xlink:href="https://doi.org/10.7554/eLife.105471.2"/></event></pub-history><permissions><copyright-statement>© 2025, Sung et al</copyright-statement><copyright-year>2025</copyright-year><copyright-holder>Sung et al</copyright-holder><ali:free_to_read/><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><ali:license_ref>http://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-105471-v1.pdf"/><self-uri content-type="figures-pdf" xlink:href="elife-105471-figures-v1.pdf"/><abstract><p>Somatic hypermutation (SHM) is the diversity-generating process in antibody affinity maturation. Probabilistic models of SHM are needed for analyzing rare mutations, understanding the selective forces guiding affinity maturation, and understanding the underlying biochemical process. High-throughput data offers the potential to develop and fit models of SHM on relevant data sets. In this article, we model SHM using modern frameworks. We are motivated by recent work suggesting the importance of a wider context for SHM; however, assigning an independent rate to each k-mer leads to an exponential proliferation of parameters. Thus, using convolutions on 3-mer embeddings, we develop ‘thrifty’ models of SHM of various sizes; these can have fewer free parameters than a 5-mer model and yet have a significantly wider context. These offer a slight performance improvement over a 5-mer model, and other modern model elaborations worsen performance. We also find that a per-site effect is not necessary to explain SHM patterns given nucleotide context. Also, the two current methods for fitting an SHM model—on out-of-frame sequence data and on synonymous mutations—produce significantly different results, and augmenting out-of-frame data with synonymous mutations does not aid out-of-sample performance.</p></abstract><kwd-group kwd-group-type="author-keywords"><kwd>B-cell receptors</kwd><kwd>somatic hypermutation</kwd><kwd>convolutional neural networks</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research organism</title><kwd>Human</kwd></kwd-group><funding-group><award-group id="fund1"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000002</institution-id><institution>National Institutes of Health</institution></institution-wrap></funding-source><award-id>R01-AI146028</award-id><principal-award-recipient><name><surname>Johnson</surname><given-names>Mackenzie M</given-names></name><name><surname>Fukuyama</surname><given-names>Julia</given-names></name><name><surname>Matsen</surname><given-names>Frederick A</given-names></name></principal-award-recipient></award-group><award-group id="fund2"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000002</institution-id><institution>National Institutes of Health</institution></institution-wrap></funding-source><award-id>S10OD028685</award-id><principal-award-recipient><name><surname>Sung</surname><given-names>Kevin</given-names></name><name><surname>Johnson</surname><given-names>Mackenzie M</given-names></name><name><surname>Dumm</surname><given-names>Will</given-names></name><name><surname>Simon</surname><given-names>Noah</given-names></name><name><surname>Haddox</surname><given-names>Hugh</given-names></name><name><surname>Fukuyama</surname><given-names>Julia</given-names></name><name><surname>Matsen</surname><given-names>Frederick A</given-names></name></principal-award-recipient></award-group><award-group id="fund3"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000011</institution-id><institution>Howard Hughes Medical Institute</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Sung</surname><given-names>Kevin</given-names></name><name><surname>Dumm</surname><given-names>Will</given-names></name><name><surname>Haddox</surname><given-names>Hugh</given-names></name><name><surname>Matsen</surname><given-names>Frederick A</given-names></name></principal-award-recipient></award-group><award-group id="fund4"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000001</institution-id><institution>National Science Foundation</institution></institution-wrap></funding-source><award-id>PHY-2309135</award-id><principal-award-recipient><name><surname>Sung</surname><given-names>Kevin</given-names></name><name><surname>Johnson</surname><given-names>Mackenzie M</given-names></name><name><surname>Dumm</surname><given-names>Will</given-names></name><name><surname>Simon</surname><given-names>Noah</given-names></name><name><surname>Haddox</surname><given-names>Hugh</given-names></name><name><surname>Fukuyama</surname><given-names>Julia</given-names></name><name><surname>Matsen</surname><given-names>Frederick A</given-names></name></principal-award-recipient></award-group><award-group id="fund5"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000936</institution-id><institution>Gordon and Betty Moore Foundation</institution></institution-wrap></funding-source><award-id>2919.02</award-id><principal-award-recipient><name><surname>Haddox</surname><given-names>Hugh</given-names></name><name><surname>Matsen</surname><given-names>Frederick A</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>Convolutional embedding models efficiently capture wide sequence context in antibody somatic hypermutation, avoiding exponential k-mer parameter scaling and eliminating the need for per-site modeling.</meta-value></custom-meta><custom-meta specific-use="meta-only"><meta-name>publishing-route</meta-name><meta-value>prc</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>Antibodies are an essential component of the adaptive immune response. They are secreted by B cells, and when displayed on the surface of B cells are called B cell receptors. When stimulated by antigen binding, B cells undergo a process called ‘affinity maturation’ which involves mutation and selection. The mutation process happens at a very high rate relative to the rate of normal somatic mutation and is called somatic hypermutation (SHM). As such, it is an essential part of the adaptive immune response. It is generated by a complex collection of interacting pathways of DNA damage and error-prone repair, which have been elucidated through decades of research (<xref ref-type="bibr" rid="bib53">Wagner and Neuberger, 1996</xref>; <xref ref-type="bibr" rid="bib49">Teng and Papavasiliou, 2007</xref>; <xref ref-type="bibr" rid="bib27">Methot and Di Noia, 2017</xref>; <xref ref-type="bibr" rid="bib34">Pilzecker and Jacobs, 2019</xref>). These pathways lead to a very non-uniform distribution of mutations.</p><p>Furthermore, the mutation biases are predictable from local sequence context. Many papers have investigated predictors of mutation rates from molecular sequence, including early work establishing the biases (<xref ref-type="bibr" rid="bib6">Dunn-Walters et al., 1998</xref>; <xref ref-type="bibr" rid="bib39">Rogozin and Kolchanov, 1992</xref>; <xref ref-type="bibr" rid="bib40">Rogozin and Diaz, 2004</xref>), to parametric models estimating the mutability based on local sequence ‘motif’, or sequence neighborhood around a focal base (<xref ref-type="bibr" rid="bib59">Yaari et al., 2013</xref>; <xref ref-type="bibr" rid="bib7">Elhanati et al., 2015</xref>; <xref ref-type="bibr" rid="bib5">Cui et al., 2016</xref>; <xref ref-type="bibr" rid="bib8">Feng et al., 2019</xref>; <xref ref-type="bibr" rid="bib9">Fisher et al., 2025</xref>).</p><p>Such models are important when predicting the probability of amino acid changes in affinity maturation, for example, for understanding the prospects of selecting such mutations in reverse vaccinology (<xref ref-type="bibr" rid="bib23">Martin Beem et al., 2023</xref>; <xref ref-type="bibr" rid="bib56">Wiehe et al., 2018</xref>) or in computing a model of natural selection on antibodies (<xref ref-type="bibr" rid="bib25">McCoy et al., 2015</xref>; <xref ref-type="bibr" rid="bib12">Hoehn et al., 2017</xref>; <xref ref-type="bibr" rid="bib13">Hoehn et al., 2019</xref>).</p><p>The most popular models for SHM are the S5F 5-mer model and its variants (<xref ref-type="bibr" rid="bib59">Yaari et al., 2013</xref>; <xref ref-type="bibr" rid="bib5">Cui et al., 2016</xref>). They have shown their worth for over a decade now, including tasks such as predicting the probability of mutations to mature broadly neutralizing antibodies against HIV (<xref ref-type="bibr" rid="bib56">Wiehe et al., 2018</xref>; <xref ref-type="bibr" rid="bib57">Wiehe et al., 2022</xref>). However, biological considerations suggest that a wider context should be considered.</p><p>Indeed, the consensus view of SHM requires processes such as patch removal around a lesion created by the activation-induced cytidine deaminase (AID) enzyme (<xref ref-type="bibr" rid="bib34">Pilzecker and Jacobs, 2019</xref>) and subsequent error-prone repair. Thus, for example, the presence of an AID hotspot several bases away may influence the probability of a mutation at a focal base. More recently, mesoscale-level sequence effects on AID deamination potentially deriving from local DNA sequence flexibility have been discovered (<xref ref-type="bibr" rid="bib54">Wang et al., 2023</xref>). In addition, other work has found that position in the sequence can influence SHM (<xref ref-type="bibr" rid="bib4">Cohen et al., 2011</xref>; <xref ref-type="bibr" rid="bib45">Spisak et al., 2020</xref>; <xref ref-type="bibr" rid="bib61">Zhou and Kleinstein, 2020</xref>).</p><p>This begs the question of how one could use more complex models to predict SHM. 7-mer models, which have three flanking bases on either side of the focal base, have been used (<xref ref-type="bibr" rid="bib7">Elhanati et al., 2015</xref>; <xref ref-type="bibr" rid="bib22">Marcou et al., 2018</xref>). However, one cannot simply increase the size of the k-mer model indefinitely because the number of parameters grows exponentially with the size of the k-mer. More recent models of SHM include position-specific terms (<xref ref-type="bibr" rid="bib45">Spisak et al., 2020</xref>) and context models of size up to 21 parameterized by a convolutional neural network (<xref ref-type="bibr" rid="bib48">Tang et al., 2022</xref>). In other contexts, models based on the transformer architecture, <xref ref-type="bibr" rid="bib51">Vaswani et al., 2017</xref> have shown great success, raising the question of whether such an architecture could be used here.</p><p>In this article, we develop new models using modern frameworks and provide a comprehensive evaluation of the models. We especially focus on the development of parameter-efficient convolutional neural networks of various sizes, which we call ‘thrifty’ models. These models have wide nucleotide context yet can have fewer parameters than a 5-mer model, while providing slightly better performance on metrics in train and test time. On the other hand, we find that elaborations such as a per-site rate and transformer only harm out-of-sample performance. We also find a clear difference between training models to predict well on out-of-frame data, compared to training models to predict well on synonymous mutations. To make these models useful for the community, we have released an open-source Python package <ext-link ext-link-type="uri" xlink:href="https://github.com/matsengrp/netam">https://github.com/matsengrp/netam</ext-link> (<xref ref-type="bibr" rid="bib24">Matsen and Dumm, 2025</xref>), with pretrained models and a simple API. Our analysis for this article is reproducible via <ext-link ext-link-type="uri" xlink:href="https://github.com/matsengrp/thrifty-experiments-1">https://github.com/matsengrp/thrifty-experiments-1</ext-link> (copy archived at <xref ref-type="bibr" rid="bib46">Sung, 2025</xref>).</p></sec><sec id="s2" sec-type="results"><title>Results</title><sec id="s2-1"><title>Overview of data preparation and objective</title><p>We will begin with an overview of our models and data. Full details are provided in ‘Materials and methods’.</p><p>Our objective in this project is to predict the probability of observed SHM in a child sequence relative to a parent sequence. We follow previous work (<xref ref-type="bibr" rid="bib45">Spisak et al., 2020</xref>) in overall goal and data setup. Specifically, we predict mutations in BCR sequences that are out-of-frame, that is, such that the sequence cannot code for a productive receptor. Because the data is out-of-frame, this means that the sequences under consideration are less likely to have undergone selective pressure in the germinal centers and instead provide more information about the SHM process. We also provide more relevant parent sequences and predict finer-scale events by using phylogenetic reconstruction and ancestral sequence inference on sequences clustered into clonal families (<xref ref-type="fig" rid="fig1">Figure 1a</xref>). We split the tree with ancestral sequences into pairs of parent and child sequences, which we call parent–child pairs. We also experiment with using synonymous mutation data by masking mutations from the loss function that are not synonymous (below; details in ‘Materials and methods’).</p><fig-group><fig id="fig1" position="float"><label>Figure 1.</label><caption><title>Overview of data processing and objective.</title><p>(<bold>a</bold>) Out-of-frame sequences are clustered into clonal families. Trees are built on clonal families and then ancestral sequences are reconstructed using a simple sequence model. The prediction task is to predict the location and identity of mutations of child sequences given parent sequences. (<bold>b</bold>) Strategy for ‘thrifty’ convolutional neural networks with relatively few parameters. We use a trainable embedding of each 3-mer into a space; downstream convolutions happen on sequential collections of these embeddings. The ‘width’ of the k-mer model is determined by the size of the convolutional kernel, which in this cartoon is 3. This would give us effectively a 5-mer model because the 3-mer model adds one base on either side of a convolution of length 3. For the sake of simplicity, the probability distribution of the new base conditioned on there being a substitution (which we call the conditional substitution probability [CSP]) is not shown. The CSP output can emerge in several ways (<xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>).</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-105471-fig1-v1.tif"/></fig><fig id="fig1s1" position="float" specific-use="child-fig"><label>Figure 1—figure supplement 1.</label><caption><title>Strategies for estimating both per-site rate and conditional substitution probability (CSP).</title><p>Our three strategies for estimating the per-site rate and CSPs. In the joined version, the two outputs come directly out of the convolutional layer. In the hybrid version, the two outputs share the embedding layer. In the independent version, the two outputs are estimated separately.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-105471-fig1-figsupp1-v1.tif"/></fig></fig-group><p>In all models, the distribution of mutations at a particular site is assumed to be independent of mutations at all other sites (but not independent of context). We follow many authors starting from <xref ref-type="bibr" rid="bib59">Yaari et al., 2013</xref> in estimating a per-site rate, as well as a per-site probability distribution among the non-identical bases describing the base selected in the event of a mutation. We will call this the conditional substitution probability (CSP). For each site <inline-formula><alternatives><mml:math id="inf1"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mstyle></mml:math><tex-math id="inft1">\begin{document}$i$\end{document}</tex-math></alternatives></inline-formula>, we assume that the mutation process is an exponential waiting time process with rate <inline-formula><alternatives><mml:math id="inf2"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math><tex-math id="inft2">\begin{document}$\lambda_{i}$\end{document}</tex-math></alternatives></inline-formula>. Once the mutation occurs, we assume that the base is selected according to a categorical distribution with probabilities <inline-formula><alternatives><mml:math id="inf3"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">p</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math><tex-math id="inft3">\begin{document}$\mathbf{p}_{i}$\end{document}</tex-math></alternatives></inline-formula>. Similar assumptions have been made previously (<xref ref-type="bibr" rid="bib21">Levinstein Hallak and Rosset, 2022</xref>; <xref ref-type="bibr" rid="bib20">Levinstein Hallak et al., 2018</xref>; <xref ref-type="bibr" rid="bib41">Rosset, 2007</xref>; <xref ref-type="bibr" rid="bib45">Spisak et al., 2020</xref>). To accommodate evolutionary time in our model, we include <italic>offsets</italic> in our exponential model—if <inline-formula><alternatives><mml:math id="inf4"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:mstyle></mml:math><tex-math id="inft4">\begin{document}$t$\end{document}</tex-math></alternatives></inline-formula> is a branch length parameter for a sequence pair, we use parameter <inline-formula><alternatives><mml:math id="inf5"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mover><mml:mi>λ</mml:mi><mml:mo stretchy="false">~</mml:mo></mml:mover></mml:mrow><mml:mo>=</mml:mo><mml:mi>t</mml:mi><mml:mi>λ</mml:mi></mml:mrow></mml:mstyle></mml:math><tex-math id="inft5">\begin{document}$\tilde\lambda=t\lambda$\end{document}</tex-math></alternatives></inline-formula> for model inference so that the model is able to learn <inline-formula><alternatives><mml:math id="inf6"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>λ</mml:mi></mml:mrow></mml:mstyle></mml:math><tex-math id="inft6">\begin{document}$\lambda$\end{document}</tex-math></alternatives></inline-formula> irrespective of evolutionary time on a particular branch. This parameter <inline-formula><alternatives><mml:math id="inf7"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:mstyle></mml:math><tex-math id="inft7">\begin{document}$t$\end{document}</tex-math></alternatives></inline-formula> is frequently the normalized mutation count (<xref ref-type="bibr" rid="bib45">Spisak et al., 2020</xref>) but can be optimized as part of a joint optimization.</p><p>We used two data sets, which we will call the <monospace><monospace>briney</monospace></monospace> and <monospace><monospace>tang</monospace></monospace> data sets. The <monospace><monospace>briney</monospace></monospace> data (<xref ref-type="bibr" rid="bib2">Briney et al., 2019</xref>) consists of samples from nine individuals, but two of these samples resulted in many more sequences than the rest. Thus, we will use a test–train split in which these two samples form the training data and the other seven samples form the testing data. We acknowledge the important work the <xref ref-type="bibr" rid="bib45">Spisak et al., 2020</xref> team did in processing the <monospace>briney</monospace> data. The <monospace>tang</monospace> data (<xref ref-type="bibr" rid="bib52">Vergani et al., 2017</xref>; <xref ref-type="bibr" rid="bib47">Tang et al., 2020</xref>) will be a further test set. Details on data processing appear in ‘Materials and methods’. In ‘Materials and methods’, we describe our attempts to find additional data sets.</p></sec><sec id="s2-2"><title>Models</title><p>We use the following strategy to combine the predictive power of local-context models without having the parameter penalty (<xref ref-type="fig" rid="fig1">Figure 1b</xref>). Each 3-mer is mapped into an embedding space of a fixed dimension, and these embedding locations are trainable parameters of the model. The idea is that the embedding abstracts some SHM-relevant characteristics of that 3-mer. Each sequence is then represented as a matrix with (sequence length) rows and (embedding dimension) columns. We then apply convolutional filters to these matrices, with taller convolutional filters effectively increasing the context of the model. For example, a kernel size of 11 gives effectively a 13-mer model (because of the additional base on either side of the 3-mer). We then apply a simple linear layer to the result of this step in order to get a mutation rate estimate for each site.</p><p>As described above, this class of models predicts both the per-site rate of SHM as well as the probability of alternate bases after mutation (called the CSP as above). We make these two model outputs in three ways (<xref ref-type="fig" rid="fig1">Figure 1</xref>, <xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>): they can share everything except for the final layer (‘joined’ model), or they can share the embedding layer (‘hybrid’ model), or they can be estimated separately (‘independent’ model). A key difference with a full k-mer model is that when we increase the size of the kernel, the number of parameters increases linearly, not exponentially. In this way, the thriftiest well-performing model is effectively a 13-mer model with fewer parameters than a 5-mer model; however, one can scale these models among a variety of dimensions (<xref ref-type="table" rid="table1">Table 1</xref>).</p><table-wrap id="table1" position="float"><label>Table 1.</label><caption><title>Selected model shapes and dropout probabilities.</title><p>The release name of the model is the name of the trained model released in the GitHub repository. The paper name is the name of the model used in this article, which describes more about its architecture. ‘Kernel’: the size of the convolutional kernel used in the model. ‘Embed’: the size of the embedding used for each 3-mer. Because there is one additional base on either side of a 3-mer, a model with kernel size 9 is effectively an 11-mer model, and a model with kernel size 11 is effectively a 13-mer model. The ‘Medium’ and ‘Large’ labels in the paper name designate the settings for Kernel, Embed, Filters, and Dropout.</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" valign="bottom"><italic>Release name</italic>: paper name</th><th align="left" valign="bottom">Kernel</th><th align="left" valign="bottom">Embed</th><th align="left" valign="bottom">Filters</th><th align="left" valign="bottom">Dropout</th><th align="left" valign="bottom">Params</th></tr></thead><tbody><tr><td align="left" valign="bottom"><italic>ThriftyHumV0.2-20</italic>: CNN Joined Large</td><td align="left" valign="bottom">11</td><td align="left" valign="bottom">7</td><td align="left" valign="bottom">19</td><td align="left" valign="bottom">0.3</td><td align="left" valign="bottom">2057</td></tr><tr><td align="left" valign="bottom">5mer</td><td align="left" valign="bottom">-</td><td align="left" valign="bottom">-</td><td align="left" valign="bottom">-</td><td align="left" valign="bottom">-</td><td align="left" valign="bottom">3077</td></tr><tr><td align="left" valign="bottom">Spisak</td><td align="left" valign="bottom">-</td><td align="left" valign="bottom">-</td><td align="left" valign="bottom">-</td><td align="left" valign="bottom">-</td><td align="left" valign="bottom">3576</td></tr><tr><td align="left" valign="bottom"><italic>ThriftyHumV0.2-45</italic>: CNN Indep Medium</td><td align="left" valign="bottom">9</td><td align="left" valign="bottom">7</td><td align="left" valign="bottom">16</td><td align="left" valign="bottom">0.2</td><td align="left" valign="bottom">4539</td></tr><tr><td align="left" valign="bottom"><italic>ThriftyHumV0.2-59</italic>: CNN Indep Large</td><td align="left" valign="bottom">11</td><td align="left" valign="bottom">7</td><td align="left" valign="bottom">19</td><td align="left" valign="bottom">0.3</td><td align="left" valign="bottom">5931</td></tr></tbody></table></table-wrap><p>We implemented our models in PyTorch (<xref ref-type="bibr" rid="bib33">Paszke, 2019</xref>)<italic>.</italic> Because of the small size of these models, they are fast to train and use. The hyperparameters for the models (<xref ref-type="table" rid="table1">Table 1</xref>) were selected with a run of Optuna (<xref ref-type="bibr" rid="bib1">Akiba et al., 2019</xref>) early in the project and then fixed. Further optimization was not pursued because of the limited performance differences between the existing models.</p></sec><sec id="s2-3"><title>Thrifty CNNs give a modest performance improvement</title><p>In order to evaluate our proposed methods and compare to previous work, we first characterized the models in terms of predictive performance using area under the ROC curve (AUROC), area under the precision-recall curve (AUPRC), R-precision, and substitution accuracy. AUROC can be interpreted as the probability that the model correctly identifies sites that mutate as having higher mutability than those that do not. In fact, if one randomly selects a positive–negative pair, the AUROC is the probability that the positive example is assigned a higher probability than the negative example. However, this measure is sensitive to class imbalance, and we are in the imbalanced setting here because mutations are relatively rare. AUPRC provides an alternative that is less sensitive to class imbalance effects (<xref ref-type="bibr" rid="bib32">Ozenne et al., 2015</xref>; <xref ref-type="bibr" rid="bib42">Saito and Rehmsmeier, 2015</xref>) because the precision is the fraction of positive predictions that are true positives. R-precision gives a sense of how accurate the model is among sites that are most mutable. Specifically, if a given pair of parent and child sequences had <inline-formula><alternatives><mml:math id="inf8"><mml:mi>R</mml:mi></mml:math><tex-math id="inft8">\begin{document}$R$\end{document}</tex-math></alternatives></inline-formula> mutations, R-precision is the precision of the predictions of mutability at the <inline-formula><alternatives><mml:math id="inf9"><mml:mi>R</mml:mi></mml:math><tex-math id="inft9">\begin{document}$R$\end{document}</tex-math></alternatives></inline-formula> sites that are ranked as being most mutable. To evaluate performance at predicting per-base substitution probabilities (given a mutation occurred), we report substitution accuracy: how frequently is the predicted-most-likely base the one to which a site mutates?</p><p>We found that the thrifty convolutional neural network (CNN) models gave a modest performance improvement for these predictive metrics compared to existing models (<xref ref-type="fig" rid="fig2">Figure 2,</xref> <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>). Specifically, we compared to a 5-mer model trained in exactly the same way, as well as a reimplementation of the model of <xref ref-type="bibr" rid="bib45">Spisak et al., 2020</xref>. We confirmed that our reimplementation infers very similar parameters to the previous implementation, although we add a slight regularization to avoid some aspects of the original model fit that appear to be artifacts (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2</xref>). Because the <xref ref-type="bibr" rid="bib45">Spisak et al., 2020</xref> model fits a per-site rate, and the <monospace>briney</monospace> data does not have full sequence coverage, we limited all evaluation to a region well covered by the <monospace>briney</monospace> data: positions 80 to 319, inclusive.</p><fig-group><fig id="fig2" position="float"><label>Figure 2.</label><caption><title>Model predictive performance on held-out samples: held-out individuals from the <monospace>briney</monospace> data (upper row) and on a separate sequencing experiment (<monospace>tang</monospace> data, lower row).</title><p>Note that the two rows use different x-axis scales. The integer in parentheses indicates the number of parameters of the model. Each model has multiple points, each corresponding to an independent model training. This is a subset of the models for clarity; see <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref> for all models.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-105471-fig2-v1.tif"/></fig><fig id="fig2s1" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 1.</label><caption><title>Performance results for all the models.</title><p>Performance results for all the models: held-out individuals from the <monospace>briney</monospace> data (upper row) and the <monospace>tang</monospace> data (lower row). The ‘Small’ thrifty models have settings (7, 6, 14, 0.1) for hyperparameters (Kernel, Embed, Filters, Dropout), as described in <xref ref-type="table" rid="table1">Table 1</xref>.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-105471-fig2-figsupp1-v1.tif"/></fig><fig id="fig2s2" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 2.</label><caption><title>Agreement between the original ‘shmoof’ model of <xref ref-type="bibr" rid="bib45">Spisak et al., 2020</xref> and our ‘reshmoof’ reimplementation.</title><p>There is good agreement between the originally inferred shmoof coefficients and our re-implementation, both in the motif mutability terms and the per-position mutabilities. The primary exception is that we infer more reasonable values when sequencing coverage is weak or absent and avoid an extreme value at site 67. These are due to a slight regularization to the per-position mutabilities. This analysis can be reproduced using the <monospace>reshmoof.ipynb</monospace> notebook.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-105471-fig2-figsupp2-v1.tif"/></fig><fig id="fig2s3" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 3.</label><caption><title>Performance comparison including S5F model with original coefficients.</title><p>Performance plot including the original S5F model (vertical black lines) for held-out individuals from the <monospace>briney</monospace> data (upper row) and on a separate sequencing experiment (<monospace>tang</monospace> data, lower row).</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-105471-fig2-figsupp3-v1.tif"/></fig></fig-group><p>We were surprised to find that all metrics except substitution accuracy were better on data from a distinct sequencing experiment (<monospace>tang</monospace> data) than on held-out samples from the same sequencing experiment (<monospace>briney</monospace> data). We attribute this to there being a difference in sequencing error between the two experiments. The <monospace>briney</monospace> data allowed sequences with only a single UMI representative (<xref ref-type="bibr" rid="bib45">Spisak et al., 2020</xref>) while the <monospace>tang</monospace> data required at least two sequences per UMI (<xref ref-type="bibr" rid="bib47">Tang et al., 2020</xref>). If our model is successfully learning substitution probabilities due to SHM rather than the sequencing error, we would expect our model to underestimate the number of substitutions at positions with a low probability of substitution in the <monospace>briney</monospace> data (which we expect to have more sequencing error) but not in the <monospace>tang</monospace> data (which we expect to have less sequencing error). This is in fact what we see in our characterization of model fit below. We were also surprised to find that the per-site rate did not seem to help the 5-mer model on held-out data, despite the results of <xref ref-type="bibr" rid="bib45">Spisak et al., 2020</xref>; see ‘Discussion’.</p><p>We did not see a substantial performance improvement by increasing the number of parameters of the CNNs. Recall that our models differ in terms of how much they share between predicting the position of mutations and predicting their base identity (<xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>). Although the ‘Large Indep’ model that has the most flexibility may do a slightly better job with held-out samples from the same experiment in terms of substitution accuracy, it does not appear any better when considering data from another experiment.</p><p>We also compared our work to a previous deep neural network model of SHM (<xref ref-type="bibr" rid="bib48">Tang et al., 2022</xref>)<italic>,</italic> which was trained on the <monospace>tang</monospace> data set. A DeepSHM model consists of a pair of CNN models, one for estimating mutation frequencies and another for CSPs; this is akin to our ‘independent’ model configuration. Each of these CNNs has over 250,000 parameters, so in total is about 100 times larger than the largest CNN model we trained. These CNNs are also slow to evaluate: because they make predictions one k-mer at a time, one must iterate over the sequence and obtain predictions for every site. Because the DeepSHM model cannot handle ambiguous nucleotides, we had to remove these from the evaluation. The authors found the best performance is achieved with 15-mers, which is comparable with the 11-mers and 13-mers in our thrifty models. We evaluated the DeepSHM 15-mer model on the subset of the <monospace>briney</monospace> data and found it performs better than S5F but comparable to our models (<xref ref-type="table" rid="table2">Table 2</xref>). Specifically, our models performed comparably when trained on the <monospace>tang</monospace> data only, but when trained on the combined <monospace>tang</monospace> data and <monospace>briney</monospace> two largest repertoires, our models performed slightly better on the <monospace>briney</monospace> held-out repertoires.</p><table-wrap id="table2" position="float"><label>Table 2.</label><caption><title>Performance evaluation on held-out <monospace>briney </monospace>data for S5F, DeepSHM, and thrifty models.</title><p>The * on S5F indicates that this model was trained using synonymous mutations on a distinct data set to those considered here. The †on <monospace>tang †</monospace> is to signify that this is the tang data but with a different preprocessing scheme (<xref ref-type="bibr" rid="bib48">Tang et al., 2022</xref>).</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" valign="bottom">Model</th><th align="left" valign="bottom">Training data</th><th align="left" valign="bottom">AUROC</th><th align="left" valign="bottom">AUPRC</th><th align="left" valign="bottom">R-prec</th><th align="left" valign="bottom">Sub. acc.</th></tr></thead><tbody><tr><td align="left" valign="bottom">S5F</td><td align="char" char="." valign="bottom">*</td><td align="char" char="." valign="bottom">0.775</td><td align="char" char="." valign="bottom">0.0698</td><td align="char" char="." valign="bottom">0.0290</td><td align="char" char="." valign="bottom">0.514</td></tr><tr><td align="left" valign="bottom">CNN Joined Large</td><td align="left" valign="bottom"><monospace>tang</monospace></td><td align="char" char="." valign="bottom">0.787</td><td align="char" char="." valign="bottom">0.0850</td><td align="char" char="." valign="bottom">0.0406</td><td align="char" char="." valign="bottom">0.510</td></tr><tr><td align="left" valign="bottom">CNN Indep Medium</td><td align="left" valign="bottom"><monospace>tang</monospace></td><td align="char" char="." valign="bottom">0.786</td><td align="char" char="." valign="bottom">0.0848</td><td align="char" char="." valign="bottom">0.0407</td><td align="char" char="." valign="bottom">0.528</td></tr><tr><td align="left" valign="bottom">CNN Indep Large</td><td align="left" valign="bottom"><monospace>tang</monospace></td><td align="char" char="." valign="bottom">0.786</td><td align="char" char="." valign="bottom">0.0852</td><td align="char" char="." valign="bottom">0.0406</td><td align="char" char="." valign="bottom">0.524</td></tr><tr><td align="left" valign="bottom">DeepSHM</td><td align="left" valign="bottom"><monospace>tang</monospace>†</td><td align="char" char="." valign="bottom">0.786</td><td align="char" char="." valign="bottom">0.0876</td><td align="char" char="." valign="bottom">0.0421</td><td align="char" char="." valign="bottom">0.537</td></tr><tr><td align="left" valign="bottom">CNN Joined Large</td><td align="left" valign="bottom"><monospace>tang</monospace>+<monospace>briney</monospace></td><td align="char" char="." valign="bottom">0.793</td><td align="char" char="." valign="bottom">0.0923</td><td align="char" char="." valign="bottom">0.0439</td><td align="char" char="." valign="bottom">0.551</td></tr><tr><td align="left" valign="bottom">CNN Indep Medium</td><td align="left" valign="bottom"><monospace>tang</monospace>+<monospace>briney</monospace></td><td align="char" char="." valign="bottom">0.793</td><td align="char" char="." valign="bottom">0.0919</td><td align="char" char="." valign="bottom">0.0441</td><td align="char" char="." valign="bottom">0.560</td></tr><tr><td align="left" valign="bottom">CNN Indep Large</td><td align="left" valign="bottom">tang+briney</td><td align="char" char="." valign="bottom">0.794</td><td align="char" char="." valign="bottom">0.0926</td><td align="char" char="." valign="bottom">0.0450</td><td align="char" char="." valign="bottom">0.562</td></tr></tbody></table><table-wrap-foot><fn><p>AUPRC, area under the precision-recall curve; AUROC, area under the ROC curve; R-prec, R-precision; sub. acc., substitution accuracy.</p></fn></table-wrap-foot></table-wrap><p>We next characterized models in terms of out-of-sample model fit. For each site in the parent of each parent–child pair (PCP) of sequences, we computed the probability of a nucleotide substitution at that site in the corresponding child. We then compared the sum of those probabilities to the actual number of substitutions that were observed at each site in the PCPs (<xref ref-type="fig" rid="fig3">Figure 3</xref>). If the observed and expected counts match, then the model is doing a good job, on average, of predicting site-specific probabilities of substitution. We assessed matching using an ‘overlap’ metric, which quantifies the size of the intersection of the histograms divided by the average area of the histograms. We also assessed model log likelihood. These assessments were performed after branch length optimization to maximize likelihood.</p><fig-group><fig id="fig3" position="float"><label>Figure 3.</label><caption><title>Model fit on held-out samples: held-out individuals from the <monospace>briney</monospace> data (upper row) and on a separate sequencing experiment (<monospace>tang</monospace> data, lower row).</title><p>Observed mutations in held-out data are placed in bins according to their probability of mutation. For every bin, the points show the observed number of mutations in that bin, while the bars show the expected number of mutations in that bin. The overlap metric is the area of the intersection of the observed and expected divided by the average area between the two.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-105471-fig3-v1.tif"/></fig><fig id="fig3s1" position="float" specific-use="child-fig"><label>Figure 3—figure supplement 1.</label><caption><title>Comparison of held-out log likelihoods between the models.</title><p>Comparison of held-out log likelihoods between the models.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-105471-fig3-figsupp1-v1.tif"/></fig></fig-group><p>We found that, as with the predictive metrics, all models gave similar performance, the differences of which were smaller than the differences between data sets. The overlap metric was better on the 5-mer model for the held-out <monospace>briney</monospace> data, but was better for the CNN models for the <monospace>tang</monospace> data. The log likelihood was slightly better for the CNN model for all held-out data sets (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1</xref>).</p></sec><sec id="s2-4"><title>Further model elaborations did not improve out of sample performance</title><p>We tried adding a per-site rate to our CNN models, as well as other elaborations such as a transformer model directly on the amino acid embeddings, and a transformer combined with a CNN. We also tried adding a positional encoding to the input for the CNN model, which does not require additional parameters, but rather perturbs the input embeddings in a way that indicates their position in the sequence (<xref ref-type="bibr" rid="bib51">Vaswani et al., 2017</xref>). None of these elaborations improved performance on held-out data. All of these experiments can be found in notebooks in the GitHub repository associated with this article.</p><p>We also found that jointly optimizing branch lengths along with model parameters did not improve out-of-sample performance.</p></sec><sec id="s2-5"><title>Out-of-frame evolution and synonymous mutations give different results</title><p>We conclude from the above that the richness of these models is limited by data volume, but unfortunately we were not able to find additional data sets with many out-of-frame sequences (see end of ‘Materials and methods’). This raised the question of if we can use synonymous mutations of productive sequences to augment our data set. To do so, we trained models using a combination of the original training using the <monospace>briney</monospace> data but also with the <monospace>tang</monospace> data where the loss function was restricted to fourfold synonymous sites.</p><p>We found that adding these synonymous mutations to the training set reduced performance on the held-out out-of-frame data (<xref ref-type="fig" rid="fig4">Figure 4</xref>). Furthermore, when we train in the usual way using the <monospace>briney</monospace> data and evaluate on synonymous data, we do significantly worse than the S5F model, which was trained on synonymous mutations (<xref ref-type="fig" rid="fig4">Figure 4</xref>, <xref ref-type="fig" rid="fig4s1">Figure 4—figure supplements 1 and 2</xref>). Our conclusion is that these two sources of data capture the effect of different processes.</p><fig-group><fig id="fig4" position="float"><label>Figure 4.</label><caption><title>The relative change in performance for each statistic, namely the statistic for the model trained with out-of-frame (OOF) data and synonymous data, minus the statistic for the model trained with OOF data only, divided by the statistic trained with OOF data only.</title><p>Thus, adding in synonymous mutations to the training set does not help predict on held-out out-of-frame data. Results shown for <monospace>briney</monospace> data (upper row) and <monospace>tang</monospace> data (lower row).</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-105471-fig4-v1.tif"/></fig><fig id="fig4s1" position="float" specific-use="child-fig"><label>Figure 4—figure supplement 1.</label><caption><title>S5F performs better for mutation position prediction on synonymous mutations in the <monospace>jaffe</monospace> data than any model trained on out-of-frame data.</title><p>S5F performs better for mutation position prediction on synonymous mutations in the <monospace>jaffe</monospace> data than any model trained on out-of-frame data. The performance plot is as before, but the black vertical bar indicates the performance of the S5F model, and all models evaluated on synonymous mutations in the <monospace>jaffe</monospace> data.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-105471-fig4-figsupp1-v1.tif"/></fig><fig id="fig4s2" position="float" specific-use="child-fig"><label>Figure 4—figure supplement 2.</label><caption><title>S5F performs better for mutation position prediction on synonymous mutations in the <monospace>tang</monospace> data than any model trained on out-of-frame data.</title><p>S5F performs better for mutation position prediction on synonymous mutations in the <monospace>tang</monospace> data than any model trained on out-of-frame data. Performance plot is as before, but the black vertical bar indicates the performance of the S5F model, and all models evaluated on synonymous mutations in the <monospace>tang</monospace> data.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-105471-fig4-figsupp2-v1.tif"/></fig></fig-group></sec></sec><sec id="s3" sec-type="discussion"><title>Discussion</title><p>Models of SHM are important to understand affinity maturation of B cells. They can also provide insight into the mechanism of SHM itself. Here we have developed a collection of models and worked to learn what they can teach us about SHM.</p><p>Specifically, by using an overlapping 3-mer embedding approach, we can parameterize wide-context models with relatively few parameters. For example, we can parameterize a 13-mer model with fewer parameters than a 5-mer model with better out-of-sample performance. A similar approach of embedded k-mers has been successful previously for genome regulatory element function prediction (<xref ref-type="bibr" rid="bib16">Ji et al., 2021</xref>).</p><p>Our first main result is that these models are better than previous models using a 5-mer context, but only slightly so. This is interesting given that more distant effects are well motivated biologically, both in terms of the consensus model of SHM involving DNA damage, stripping, and repair (<xref ref-type="bibr" rid="bib34">Pilzecker and Jacobs, 2019</xref>), as well as more recent results showing that the mesoscale environment of the BCR is important for SHM (<xref ref-type="bibr" rid="bib54">Wang et al., 2023</xref>). Although another model formulation may be able to pick up these features, the present approach should be able to pick up features such as a nearby AID hotspot.</p><p>We found that adding a per-site rate to our models did not help predict on out-of-sample data. This is in contrast to recent work of <xref ref-type="bibr" rid="bib45">Spisak et al., 2020</xref> suggesting that a per-site rate was helpful to predict SHM. We suspect that this contrast may be because of the means of evaluating this model. The <xref ref-type="bibr" rid="bib45">Spisak et al., 2020</xref> paper quantifies an improved model fit over a 5-mer model by calculating a Pearson <inline-formula><alternatives><mml:math id="inf10"><mml:msup><mml:mi>r</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:math><tex-math id="inft10">\begin{document}$r^{2}$\end{document}</tex-math></alternatives></inline-formula> for each region comparing the model prediction to the aggregated mutation count per site for sites in that region. The <xref ref-type="bibr" rid="bib45">Spisak et al., 2020</xref> model is itself parameterized in a per-site way, and so it is not surprising that the model has excellent fit according to this metric (Figure 4J of <xref ref-type="bibr" rid="bib45">Spisak et al., 2020</xref>)<italic>.</italic> Although they did a data-splitting exercise, this data split was on the level of parent–child pairs (not specified in the original paper; clarified via personal communication), which means that many of the parent sequences in the training set were very similar to parent sequences (<xref ref-type="bibr" rid="bib45">Spisak et al., 2020</xref>) and actually not to a separately trained 5-mer model, but to the 5-mer component <inline-formula><alternatives><mml:math id="inf11"><mml:msub><mml:mi>γ</mml:mi><mml:mi>w</mml:mi></mml:msub></mml:math><tex-math id="inft11">\begin{document}$\gamma_{w}$\end{document}</tex-math></alternatives></inline-formula> of the joint model (typo in the original paper; clarified via personal communication).</p><p>We tried other means of adding per-site rates to the model, such as positional encoding and a transformer component, but these did not help. Although it is quite possible that sites evolve differently according to their absolute position in the sequence, our work shows that this is not necessary as part of a predictive model. Due to commonalities between neighborhoods of sites in sequences, it is difficult or perhaps impossible to disentangle the effect of a per-site rate from the effect of the motif model given a sufficiently rich motif model.</p><p>From a biological perspective, our findings indicate that while per-site rate (<xref ref-type="bibr" rid="bib4">Cohen et al., 2011</xref>; <xref ref-type="bibr" rid="bib45">Spisak et al., 2020</xref>; <xref ref-type="bibr" rid="bib61">Zhou and Kleinstein, 2020</xref>) and mesoscale-level (<xref ref-type="bibr" rid="bib54">Wang et al., 2023</xref>) effects may exist in SHM, their impact appears insufficient to significantly enhance statistical modeling performance. We refrain from making further biological conclusions and suggest that more definitive conclusions require an explicitly mechanistic model (<xref ref-type="bibr" rid="bib9">Fisher et al., 2025</xref>).</p><p>Our work also contrasts the two main ways of training a neutral model: one is to use synonymous mutations (<xref ref-type="bibr" rid="bib58">Yaari et al., 2012</xref>), and the other is to use out-of-frame sequences (<xref ref-type="bibr" rid="bib45">Spisak et al., 2020</xref>) or some other sequences that one can assume are evolving neutrally (<xref ref-type="bibr" rid="bib5">Cui et al., 2016</xref>). Here we find evidence that these two methods give different results and that models trained on one task do not do well on the other. This may be from synonymous mutations being under selection due to codon usage effects or could be from only a subset of motifs being possible to estimate from synonymous data (<xref ref-type="bibr" rid="bib59">Yaari et al., 2013</xref>). Another possible explanation is that the spatial correlation of mutations (<xref ref-type="bibr" rid="bib45">Spisak et al., 2020</xref>) leads to correlation in mutations at synonymous and non-synonymous sites: as an extreme example, a fourfold synonymous site could be next to a site under strong purifying selection, and if these two sites only mutate together this would effectively lead to purifying selection on the synonymous site. One could also imagine that the out-of-frame sequences are under selection such as having an insertion–deletion mutation that throws a sequence under selection out of frame, but this is mitigated by the ancestral sequence reconstruction and the removal of the naive sequence from the tree. From a model-fitting perspective, the contrast between these two objectives is disappointing because productive sequences are much more available than out-of-frame sequences.</p><p>Overall, we have presented and tested a variety of new models with test–train splits and found a slight improvement using parameter sparse or ‘thrifty’ CNNs. One interesting aspect of these models is that they allow for a wider k-mer context without having a parameter explosion. It is possible that the conclusions would differ if we had considerably more data, though despite our best efforts (see ‘Materials and methods’) we were unable to find a large additional volume of out-of-frame data. If and when additional data becomes available, our reproducible analysis can be used to evaluate these models on that data.</p></sec><sec id="s4" sec-type="materials|methods"><title>Materials and methods</title><sec id="s4-1"><title>Data sets and data processing</title><p>Our primary data set is the one introduced by <xref ref-type="bibr" rid="bib45">Spisak et al., 2020</xref> in their recent work on modeling SHM. The data consists of human, out-of-frame IgH sequences sampled from several individuals (<xref ref-type="bibr" rid="bib2">Briney et al., 2019</xref>), aligned using pRESTO (<xref ref-type="bibr" rid="bib50">Vander Heiden et al., 2014</xref>). The resulting data comes to us as a collection of trees, one for each clonal family with at least six observed sequences in an individual, complete with (ancestral and observed) sequences and branch lengths, as well as a collection of metadata annotating, among other things, the identity and position of the V gene in the sequence. Starting from the clonal family clustering and multiple sequence alignments from <xref ref-type="bibr" rid="bib45">Spisak et al., 2020</xref>, we remove sequences containing gaps to avoid ambiguity of site positions due to insertions or deletions. Resulting clonal families with less than six observed sequences are discarded. Phylogenetic inference in each clonal family is then redone with IQ-TREE (<xref ref-type="bibr" rid="bib28">Minh et al., 2020</xref>). We apply the K80 (<xref ref-type="bibr" rid="bib17">Kimura, 1980</xref>) substitution model and use the germline sequence as an outgroup, following the method of <xref ref-type="bibr" rid="bib45">Spisak et al., 2020</xref>, and additionally allow for mutation rate heterogeneity among sites with a four-category FreeRate model <xref ref-type="bibr" rid="bib44">Soubrier et al., 2012</xref>; <xref ref-type="bibr" rid="bib60">Yang, 1995</xref>. The edges of the inferred phylogenetic trees are taken as parent–child pairs, except for the edge containing the naive sequence outgroup.</p><p>Additionally, we use the <monospace>tang</monospace> data set of human IgH sequences previously used for modeling SHM by <xref ref-type="bibr" rid="bib48">Tang et al., 2022</xref>. This data set, originally generated by <xref ref-type="bibr" rid="bib47">Tang et al., 2020</xref>; <xref ref-type="bibr" rid="bib52">Vergani et al., 2017</xref>, includes full-length BCR repertoires from 21 individuals. We obtained preprocessed samples directly from the authors (<xref ref-type="bibr" rid="bib47">Tang et al., 2020</xref>). We extracted the IgH sequences from marginal zone (MZ), memory (M), and plasma (PC) B cells and completed germline and clonal family inferences with <monospace>partis</monospace> (<xref ref-type="bibr" rid="bib35">Ralph and Matsen, 2016a</xref>; <xref ref-type="bibr" rid="bib36">Ralph and Matsen, 2016b</xref>; <xref ref-type="bibr" rid="bib37">Ralph and Matsen, 2019</xref>). We keep clonal families of two or more sequences that consist of only out-of-frame sequences. In <monospace>partis</monospace>, a sequence is considered out-of-frame if either of the conserved codons for cysteine or tryptophan bounding the CDR3 is out-of-frame with the germline V gene. We then perform phylogenetic inference and ancestral sequence reconstruction for each clonal family using IQ-TREE as described above. The first site of the sequence is set to align with the start of the germline V gene; if necessary, nucleotides before the start of the V gene are truncated or sites at the 5’ end with missing reads are padded with ‘N’.</p><p>A small number of the edges have very long branch lengths, some of which seem to correspond to improper alignments. Following the lead of the authors of <xref ref-type="bibr" rid="bib45">Spisak et al., 2020</xref>, we filter our data to only include edges with fewer than 10 mutations, which results in a modest ∼6.4% reduction in the available data.</p><p>The <monospace>jaffe</monospace> data set (<xref ref-type="bibr" rid="bib15">Jaffe et al., 2022</xref>) consists of paired heavy chain and light chain, full-length sequences of productive antibodies from four donors. We process the data with <monospace>partis</monospace> and IQ-TREE, similar to the <monospace>tang</monospace> data set. The <monospace>jaffe</monospace> synonymous data set are parent–child pairs from <monospace>jaffe</monospace> where we mask sites in the child sequence that are not fourfold degenerate in the parent context. For each parent–child pair, we check each codon context in the parent sequence for fourfold degenerate sites. For these sites, the corresponding nucleotide in the child sequence is preserved while all other sites are masked.</p><p>The data sets used in this article are summarized in <xref ref-type="table" rid="table3">Table 3</xref>.</p><table-wrap id="table3" position="float"><label>Table 3.</label><caption><title>Data used in this article.</title><p><monospace>briney</monospace> data is from <xref ref-type="bibr" rid="bib2">Briney et al., 2019</xref> after processing done by <xref ref-type="bibr" rid="bib45">Spisak et al., 2020</xref>. <monospace>tang</monospace> data is from <xref ref-type="bibr" rid="bib52">Vergani et al., 2017</xref>; <xref ref-type="bibr" rid="bib47">Tang et al., 2020</xref> and was sequenced using the methods of <xref ref-type="bibr" rid="bib52">Vergani et al., 2017</xref>. Out-of-frame sequences from <monospace>briney</monospace> and <monospace>tang</monospace> are used. For productive sequences from <monospace>tang</monospace>, only fourfold synonymous sites are used. <monospace>jaffe</monospace> data is from <xref ref-type="bibr" rid="bib15">Jaffe et al., 2022</xref> sequenced using 10X, where only fourfold synonymous sites of productive sequences are used. The ‘read/cell’ column is the sequencing depth listed as average number of reads per cell. ‘Samples’ is the number of individual samples in the data set; in these data sets, each sample is from a distinct individual. ‘CFs’ is the number of clonal families in the data set. ‘PCPs’ is the number of parent–child pairs in the data set. ‘Median mutations’ is the median number of mutations per PCP in the data set.</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" valign="bottom">Name</th><th align="left" valign="bottom">Type</th><th align="left" valign="bottom">Sequencing methods</th><th align="left" valign="bottom">Read/cell</th><th align="left" valign="bottom">Samples</th><th align="left" valign="bottom">CFs</th><th align="left" valign="bottom">PCPs</th><th align="left" valign="bottom">Median mutations</th></tr></thead><tbody><tr><td align="left" valign="bottom"><monospace>briney</monospace></td><td align="left" valign="bottom">Out-of-frame</td><td align="left" valign="bottom">Bulk</td><td align="left" valign="bottom">∼1</td><td align="left" valign="bottom">9</td><td align="left" valign="bottom">3903</td><td align="left" valign="bottom">52,915</td><td align="char" char="." valign="bottom">2</td></tr><tr><td align="left" valign="bottom"><monospace>tang</monospace></td><td align="left" valign="bottom">Out-of-frame</td><td align="left" valign="bottom">Single cell</td><td align="left" valign="bottom">∼40</td><td align="left" valign="bottom">21</td><td align="left" valign="bottom">3209</td><td align="left" valign="bottom">9984</td><td align="char" char="." valign="bottom">7</td></tr><tr><td align="left" valign="bottom"><monospace>tang</monospace></td><td align="left" valign="bottom">Productive</td><td align="left" valign="bottom">Single cell</td><td align="left" valign="bottom">∼40</td><td align="left" valign="bottom">21</td><td align="left" valign="bottom">157,863</td><td align="left" valign="bottom">820,837</td><td align="char" char="." valign="bottom">1</td></tr><tr><td align="left" valign="bottom"><monospace>jaffe</monospace></td><td align="left" valign="bottom">Productive</td><td align="left" valign="bottom">Single cell</td><td align="left" valign="bottom">∼5000</td><td align="left" valign="bottom">4</td><td align="left" valign="bottom">67,304</td><td align="left" valign="bottom">282,732</td><td align="char" char="." valign="bottom">1</td></tr></tbody></table></table-wrap></sec><sec id="s4-2"><title>Models</title><p>In all the models we propose, we model SHM using a two-part model. First, we assume that the occurrence of point mutations follows a per-site exponential waiting time that is dependent entirely on the parent sequence. Furthermore, we assume that all mutations occur simultaneously, so that we can ignore how the order of point mutations along a branch affects likelihood computations. The other output of the model is the prediction of base identity. We interpret the normalized version of these rates as conditional probabilities given that the mutation has occurred.</p><p>For the ‘thrifty’ models, we have an embedding of each 3-mer along the sequence, which is then the input for a convolutional layer (<xref ref-type="fig" rid="fig1">Figure 1b</xref>). The output of the convolutional layer is then the input for the mutation rate estimate, which is shown in <xref ref-type="fig" rid="fig1">Figure 1b</xref> as well as the CSP (<xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>).</p><p>All models are implemented in PyTorch (<xref ref-type="bibr" rid="bib33">Paszke, 2019</xref>) and can be found in the GitHub repository associated with this article.</p></sec><sec id="s4-3"><title>Model training</title><p>Our loss functions are the likelihood of child mutation locations using offset, as well as a categorical cross-entropy loss for the base identity. We sum these log losses together using a weight of 0.01 on the cross-entropy loss to approximately even out the contributions of these two sources of loss.</p><p>Models were trained for 100 epochs, with the Poisson offset simply being the normalized count of mutations in the child sequence. We also tried a more sophisticated approach of joint optimization of branch length and model parameters.</p></sec><sec id="s4-4"><title>Model evaluation</title><sec id="s4-4-1"><title>AUROC</title><p>The receiver operating characteristic (ROC) curve is a method of visualizing the tradeoff between true-positive rate (<inline-formula><alternatives><mml:math id="inf12"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">T</mml:mi><mml:mi mathvariant="normal">P</mml:mi><mml:mi mathvariant="normal">R</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mtext>TP</mml:mtext><mml:mrow><mml:mtext>TP</mml:mtext><mml:mo>+</mml:mo><mml:mtext>FN</mml:mtext></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:math><tex-math id="inft12">\begin{document}${\rm TPR}=\frac{\text{TP}}{\text{TP}+\text{FN}}$\end{document}</tex-math></alternatives></inline-formula>) and false-positive rate (<inline-formula><alternatives><mml:math id="inf13"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">F</mml:mi><mml:mi mathvariant="normal">P</mml:mi><mml:mi mathvariant="normal">R</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>F</mml:mi><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mi>N</mml:mi></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mi>F</mml:mi><mml:mi>P</mml:mi></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:math><tex-math id="inft13">\begin{document}${\rm FPR}=\frac{{FP}}{{TN}+{FP}}$\end{document}</tex-math></alternatives></inline-formula>) as we vary the cutoff value we use for separating positive and negative predictions. Notice that the denominators in each statistic depend only on the true labels, so the tradeoff parallels the one between true positives and false positives. Given a random classifier, the TPR is expected to be equal to FPR, meaning that the ROC would be a diagonal line from (0, 0) to (1, 1).</p><p>In order to reduce the ROC curve to a single quantity for performance assessment, one can compute the AUROC, which, when compared to 0.5, gives a sense of how well the classifier is doing when compared with a random classifier. <xref ref-type="bibr" rid="bib11">Hanley and McNeil, 1982</xref> show that AUROC is equivalent to the probability that the classifier correctly ranks a randomly chosen pair of points, one from the negative and one from the positive class.</p></sec><sec id="s4-4-2"><title>AUPRC</title><p>Class imbalance, where we have many more negative examples than positive examples, can muddle performance evaluation of a classifier. Specifically, a large number of correctly identified negative examples can obscure the relatively poor performance of a classifier on a class that is under-represented in the data. Another approach is to instead consider precision and recall (Saito and Rehmsmeier, 2015). Analogous to the ROC curve, the principle here is to track the precision (<inline-formula><alternatives><mml:math id="inf14"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>T</mml:mi><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mi>P</mml:mi></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mi>F</mml:mi><mml:mi>P</mml:mi></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:math><tex-math id="inft14">\begin{document}$\frac{{TP}}{{TP}+{FP}}$\end{document}</tex-math></alternatives></inline-formula>) and recall (<inline-formula><alternatives><mml:math id="inf15"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>T</mml:mi><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi>T</mml:mi><mml:mi>P</mml:mi></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mi>F</mml:mi><mml:mi>N</mml:mi></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:math><tex-math id="inft15">\begin{document}$\frac{{TP}}{{TP}+{FN}}$\end{document}</tex-math></alternatives></inline-formula>) as we vary the cutoff parameter and plot the resulting points. Similar to before, we can distill the information of this curve down to a single number in the unit interval by computing the AUPRC. The precision of a classifier that uniformly assigns sites to the positive and negative classes will be<disp-formula id="equ1"><alternatives><mml:math id="m1"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi mathvariant="normal">#</mml:mi><mml:mtext> mutated sites</mml:mtext></mml:mrow><mml:mrow><mml:mi mathvariant="normal">#</mml:mi><mml:mtext> sites</mml:mtext></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:math><tex-math id="t1">\begin{document}$$\displaystyle \rho = \frac{\# \text{ mutated sites}}{\# \text{ sites}}$$\end{document}</tex-math></alternatives></disp-formula></p><p>in expectation. Thus, if we exclude pathologically bad classifiers, <inline-formula><alternatives><mml:math id="inf16"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow></mml:mstyle></mml:math><tex-math id="inft16">\begin{document}$\rho$\end{document}</tex-math></alternatives></inline-formula> forms a baseline minimum value of the AUPRC. In contrast with the AUROC, neither precision nor recall is affected by the addition or removal of true negative (i.e., non-mutated sites that were predicted not to mutate) examples, and in fact the relationship is driven by the tradeoff between false positives and false negatives.</p></sec><sec id="s4-4-3"><title>R-precision</title><p>In order to characterize the ability of our classifiers to correctly identify sites that will mutate, we consider another metric: R-precision. This is the easiest to explain by first introducing top-<inline-formula><alternatives><mml:math id="inf17"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:mstyle></mml:math><tex-math id="inft17">\begin{document}$k$\end{document}</tex-math></alternatives></inline-formula> precision, in which we take the <inline-formula><alternatives><mml:math id="inf18"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:mstyle></mml:math><tex-math id="inft18">\begin{document}$k$\end{document}</tex-math></alternatives></inline-formula> ‘hottest’ (i.e., predicted to mutate with the highest probability) sites according to our classifier and compute the precision on those sites. We can refine top-<inline-formula><alternatives><mml:math id="inf19"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:mstyle></mml:math><tex-math id="inft19">\begin{document}$k$\end{document}</tex-math></alternatives></inline-formula> precision above to <inline-formula><alternatives><mml:math id="inf20"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:mstyle></mml:math><tex-math id="inft20">\begin{document}$R$\end{document}</tex-math></alternatives></inline-formula>-precision, which is the top-<inline-formula><alternatives><mml:math id="inf21"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:mstyle></mml:math><tex-math id="inft21">\begin{document}$k$\end{document}</tex-math></alternatives></inline-formula> precision when <inline-formula><alternatives><mml:math id="inf22"><mml:mi>k</mml:mi></mml:math><tex-math id="inft22">\begin{document}$k$\end{document}</tex-math></alternatives></inline-formula> is set equal to the expected or observed number of mutations. This value can be interpreted in the following way: an <inline-formula><alternatives><mml:math id="inf23"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:mstyle></mml:math><tex-math id="inft23">\begin{document}$R$\end{document}</tex-math></alternatives></inline-formula>-precision of 0.1 means that if the classifier is told to predict the correct sites to mutate given their count, 10% of them will have actually mutated. As with AUPRC, a random classifier will have an <inline-formula><alternatives><mml:math id="inf24"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:mstyle></mml:math><tex-math id="inft24">\begin{document}$R$\end{document}</tex-math></alternatives></inline-formula>-precision of <inline-formula><alternatives><mml:math id="inf25"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow></mml:mstyle></mml:math><tex-math id="inft25">\begin{document}$\rho$\end{document}</tex-math></alternatives></inline-formula>.</p></sec><sec id="s4-4-4"><title>Substitution accuracy</title><p>As described above, when evaluating performance at predicting per-base substitution probabilities (given a mutation occurred), we report accuracy: how frequently is the predicted-most-likely base the one to which a site mutates?</p></sec></sec><sec id="s4-5"><title>Software</title><p>Our work is released in an open-source Python package <ext-link ext-link-type="uri" xlink:href="https://github.com/matsengrp/netam">https://github.com/matsengrp/netam</ext-link> (<xref ref-type="bibr" rid="bib24">Matsen and Dumm, 2025</xref>), with a simple API that makes it easy to train and evaluate models. We release trained models and their weights. Our analysis for this article is reproducible via <ext-link ext-link-type="uri" xlink:href="https://github.com/matsengrp/thrifty-experiments-1">https://github.com/matsengrp/thrifty-experiments-1</ext-link>(copy archived at <xref ref-type="bibr" rid="bib46">Sung, 2025</xref>), which includes notebooks that reproduce the figures and tables in this article. We used the following software: PyTorch (<xref ref-type="bibr" rid="bib33">Paszke, 2019</xref>), pandas (<xref ref-type="bibr" rid="bib26">McKinney, 2010</xref>), matplotlib (<xref ref-type="bibr" rid="bib14">Hunter, 2007</xref>), seaborn (<xref ref-type="bibr" rid="bib55">Waskom, 2021</xref>), snakemake (<xref ref-type="bibr" rid="bib29">Mölder, 2021</xref>), pytest (<xref ref-type="bibr" rid="bib19">Krekel et al., 2004</xref>), and biopython (<xref ref-type="bibr" rid="bib3">Cock et al., 2009</xref>).</p></sec><sec id="s4-6"><title>Attempts to find additional full-length, out-of-frame sequences</title><p>While the primary data set used here and originally by <xref ref-type="bibr" rid="bib45">Spisak et al., 2020</xref> provides a large number of out-of-frame human IgH sequences, the sequencing methods used resulted in minimal coverage at the start of the V gene and thus limited information for that region (<xref ref-type="bibr" rid="bib2">Briney et al., 2019</xref>). Alternatively, the Tang data set provides relatively high coverage along the full IgH sequence, but is limited in the amount of unique sequences sampled. We sought to supplement this data with additional full-length, out-of-frame human IgH sequences. Full-length IgH data is generally limited by design in common sequencing approaches. Even productive IgH data show low coverage at the start of the V gene, as evidenced by over 40% of the sequences in the Observed Antibody Space (OAS) database lacking sequence data for the first 15 amino acids (<xref ref-type="bibr" rid="bib31">Olsen et al., 2022b</xref>; <xref ref-type="bibr" rid="bib18">Kovaltsuk et al., 2018</xref>; <xref ref-type="bibr" rid="bib30">Olsen et al., 2022a</xref>). We focus our efforts on data sets from recent studies focused on full-length antibody sequencing (<xref ref-type="bibr" rid="bib10">Ford et al., 2023</xref>; <xref ref-type="bibr" rid="bib43">Soto et al., 2019</xref>; <xref ref-type="bibr" rid="bib38">Rodriguez et al., 2023</xref>). For all data sets, we implemented the <monospace>partis</monospace>-IQ-TREE pipeline as previously described on pre-processed data and extracted parent–child pairs for all clonal families of size 2+. Overall, out-of-frame sequences make up a relatively small proportion of sequence data (with this proportion varying by study/sequencing protocols), and none of the data sets considered had enough depth to extract a meaningful amount of out-of-frame sequence data for our purposes. The details of these efforts are described below.</p><p>From <xref ref-type="bibr" rid="bib10">Ford et al., 2023</xref>, we obtained preprocessed data for 10 IgG FLAIRR-seq samples from the authors. Using consensus sequences from UMIs that were observed more than once (DUPCOUNT&gt;1), we recovered 7938 out-of-frame sequences across all samples. These sequences belonged to 226 clonal families of size 2+ and 2633 singletons. This amounted to only 722 parent–child pairs, of which only 324 contained a mutation event. In attempts to extract more out-of-frame data, we additionally ran our pipeline on the preprocessed data including consensus sequences that were only observed once (and thus included no UMI error correction). From the 10 samples, we were able to recover 52,785 out-of-frame sequences, some of which were not UMI error corrected. This resulted in 2415 clonal families of size 2+ and 22,983 singletons, but still only gave us 6296 parent–child pairs with mutation events (9114 in total). We note that this sequencing method provided a higher proportion of out-of-frame sequences (9% for fully preprocessed data) than other methods we considered.</p><p>From <xref ref-type="bibr" rid="bib38">Rodriguez et al., 2023</xref>, we obtained preprocessed 5’ RACE AIRR-seq sequencing data for 51 IgG samples from the authors. We ran our pipeline on the preprocessed data and recovered only 4337 out-of-frame sequences in total. These sequences belonged to 188 clonal families of size 2+ and 1925 singletons. Of the 889 parent–child pairs from non-singletons, only 215 contained a mutation event. While the proportion of out-of-frame sequences was on par with the primary data set, sequence depth per sample was shallow and thus out-of-frame data was limited.</p><p>From <xref ref-type="bibr" rid="bib43">Soto et al., 2019</xref>, we obtained preprocessed data for all three HIP donors from the authors. We ran our pipeline on a large subset of the data (sampling the first 1 million sequences for each donor IgH fasta file) to assess its potential for our purposes. From the 3 million sequences processed, we extracted 2686 out-of-frame sequences in total. These sequences corresponded to 11 clonal families of size 2+ and 2618 singletons. We obtained 102 parent–child pairs from non-singletons, of which only 57 contained a mutation event. The relatively low recovery of out-of-frame sequences in this subset of the data suggested that processing the full data set would not yield a meaningful amount of parent–child pairs for this study. We additionally observed that all of these sequences had no coverage at the start of the V gene, missing the first 12–60 bases.</p></sec></sec></body><back><sec sec-type="additional-information" id="s5"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="COI-statement" id="conf1"><p>No competing interests declared</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>Data curation, Software, Validation, Methodology, Writing – review and editing</p></fn><fn fn-type="con" id="con2"><p>Data curation, Software, Validation, Methodology, Writing – review and editing</p></fn><fn fn-type="con" id="con3"><p>Software, Validation, Methodology, Writing – review and editing</p></fn><fn fn-type="con" id="con4"><p>Methodology, Writing – review and editing</p></fn><fn fn-type="con" id="con5"><p>Methodology, Writing – review and editing</p></fn><fn fn-type="con" id="con6"><p>Methodology, Writing – review and editing</p></fn><fn fn-type="con" id="con7"><p>Conceptualization, Software, Formal analysis, Funding acquisition, Validation, Visualization, Methodology, Writing – original draft, Project administration, Writing – review and editing</p></fn></fn-group></sec><sec sec-type="supplementary-material" id="s6"><title>Additional files</title><supplementary-material id="mdar"><label>MDAR checklist</label><media xlink:href="elife-105471-mdarchecklist1-v1.pdf" mimetype="application" mime-subtype="pdf"/></supplementary-material></sec><sec sec-type="data-availability" id="s7"><title>Data availability</title><p>Processed data for this study is available on Dryad, <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5061/dryad.np5hqc044">https://doi.org/10.5061/dryad.np5hqc044</ext-link>. Software to produce the figures in the manuscript is available on GitHub (<ext-link ext-link-type="uri" xlink:href="https://github.com/matsengrp/thrifty-experiments-1">https://github.com/matsengrp/thrifty-experiments-1</ext-link>; copy archived at <xref ref-type="bibr" rid="bib46">Sung, 2025</xref>).</p><p>The following previously published dataset was used:</p><p><element-citation publication-type="data" specific-use="references" id="dataset1"><person-group person-group-type="author"><name><surname>Matsen IV</surname><given-names>FA</given-names></name><name><surname>Sung</surname><given-names>K</given-names></name><name><surname>Johnson</surname><given-names>MM</given-names></name></person-group><year iso-8601-date="2025">2025</year><data-title>B cell receptor parent-child pairs for studying somatic hypermutation</data-title><source>Dryad Digital Repository</source><pub-id pub-id-type="doi">10.5061/dryad.np5hqc044</pub-id></element-citation></p></sec><ack id="ack"><title>Acknowledgements</title><p>We thank the authors of <xref ref-type="bibr" rid="bib45">Spisak et al., 2020</xref> for providing the data and answering questions about their work. We are also grateful to the authors of <xref ref-type="bibr" rid="bib48">Tang et al., 2022</xref> for providing the data and answering questions about their work, as well as to the lab of Corey Watson for sharing data from <xref ref-type="bibr" rid="bib10">Ford et al., 2023</xref> and <xref ref-type="bibr" rid="bib38">Rodriguez et al., 2023</xref>. Additionally, we thank Luke Myers and the authors of <xref ref-type="bibr" rid="bib43">Soto et al., 2019</xref> for sharing their preprocessed data. This work was supported by NIH grant R01-AI146028. Scientific Computing Infrastructure at Fred Hutch funded by ORIP grant S10OD028685. Frederick Matsen is an investigator of the Howard Hughes Medical Institute. This work was partially completed at the Kavli Institute for Theoretical Physics (KITP) at the University of California, Santa Barbara, and thus was supported by grant no. NSF PHY-2309135 to the Kavli Institute for Theoretical Physics (KITP) and the Gordon and Betty Moore Foundation Grant No. 2919.02.</p></ack><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Akiba</surname><given-names>T</given-names></name><name><surname>Sano</surname><given-names>S</given-names></name><name><surname>Yanase</surname><given-names>T</given-names></name><name><surname>Ohta</surname><given-names>T</given-names></name><name><surname>Koyama</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Optuna: a next-generation hyperparameter optimization framework</article-title><conf-name>Proceedings of the 25th ACM SIGKDD international conference on knowledge discovery and data mining</conf-name><pub-id pub-id-type="doi">10.1145/3292500.3330701</pub-id></element-citation></ref><ref id="bib2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Briney</surname><given-names>B</given-names></name><name><surname>Inderbitzin</surname><given-names>A</given-names></name><name><surname>Joyce</surname><given-names>C</given-names></name><name><surname>Burton</surname><given-names>DR</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Commonality despite exceptional diversity in the baseline human antibody repertoire</article-title><source>Nature</source><volume>566</volume><fpage>393</fpage><lpage>397</lpage><pub-id pub-id-type="doi">10.1038/s41586-019-0879-y</pub-id><pub-id pub-id-type="pmid">30664748</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cock</surname><given-names>PJA</given-names></name><name><surname>Antao</surname><given-names>T</given-names></name><name><surname>Chang</surname><given-names>JT</given-names></name><name><surname>Chapman</surname><given-names>BA</given-names></name><name><surname>Cox</surname><given-names>CJ</given-names></name><name><surname>Dalke</surname><given-names>A</given-names></name><name><surname>Friedberg</surname><given-names>I</given-names></name><name><surname>Hamelryck</surname><given-names>T</given-names></name><name><surname>Kauff</surname><given-names>F</given-names></name><name><surname>Wilczynski</surname><given-names>B</given-names></name><name><surname>de Hoon</surname><given-names>MJL</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Biopython: freely available Python tools for computational molecular biology and bioinformatics</article-title><source>Bioinformatics</source><volume>25</volume><fpage>1422</fpage><lpage>1423</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btp163</pub-id><pub-id pub-id-type="pmid">19304878</pub-id></element-citation></ref><ref id="bib4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cohen</surname><given-names>RM</given-names></name><name><surname>Kleinstein</surname><given-names>SH</given-names></name><name><surname>Louzoun</surname><given-names>Y</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Somatic hypermutation targeting is influenced by location within the immunoglobulin V region</article-title><source>Molecular Immunology</source><volume>48</volume><fpage>1477</fpage><lpage>1483</lpage><pub-id pub-id-type="doi">10.1016/j.molimm.2011.04.002</pub-id><pub-id pub-id-type="pmid">21592579</pub-id></element-citation></ref><ref id="bib5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cui</surname><given-names>A</given-names></name><name><surname>Di Niro</surname><given-names>R</given-names></name><name><surname>Vander Heiden</surname><given-names>JA</given-names></name><name><surname>Briggs</surname><given-names>AW</given-names></name><name><surname>Adams</surname><given-names>K</given-names></name><name><surname>Gilbert</surname><given-names>T</given-names></name><name><surname>O’Connor</surname><given-names>KC</given-names></name><name><surname>Vigneault</surname><given-names>F</given-names></name><name><surname>Shlomchik</surname><given-names>MJ</given-names></name><name><surname>Kleinstein</surname><given-names>SH</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>A model of somatic hypermutation targeting in mice based on high-throughput ig sequencing data</article-title><source>Journal of Immunology</source><volume>197</volume><fpage>3566</fpage><lpage>3574</lpage><pub-id pub-id-type="doi">10.4049/jimmunol.1502263</pub-id><pub-id pub-id-type="pmid">27707999</pub-id></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dunn-Walters</surname><given-names>DK</given-names></name><name><surname>Dogan</surname><given-names>A</given-names></name><name><surname>Boursier</surname><given-names>L</given-names></name><name><surname>MacDonald</surname><given-names>CM</given-names></name><name><surname>Spencer</surname><given-names>J</given-names></name></person-group><year iso-8601-date="1998">1998</year><article-title>Base-specific sequences that bias somatic hypermutation deduced by analysis of out-of-frame human IgVH genes</article-title><source>Journal of Immunology</source><volume>160</volume><fpage>2360</fpage><lpage>2364</lpage><pub-id pub-id-type="pmid">9498777</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Elhanati</surname><given-names>Y</given-names></name><name><surname>Sethna</surname><given-names>Z</given-names></name><name><surname>Marcou</surname><given-names>Q</given-names></name><name><surname>Callan</surname><given-names>CG</given-names><suffix>Jr</suffix></name><name><surname>Mora</surname><given-names>T</given-names></name><name><surname>Walczak</surname><given-names>AM</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Inferring processes underlying B-cell repertoire diversity</article-title><source>Philosophical Transactions of the Royal Society of London. Series B, Biological Sciences</source><volume>370</volume><elocation-id>20140243</elocation-id><pub-id pub-id-type="doi">10.1098/rstb.2014.0243</pub-id><pub-id pub-id-type="pmid">26194757</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Feng</surname><given-names>J</given-names></name><name><surname>Shaw</surname><given-names>DA</given-names></name><name><surname>Minin</surname><given-names>VN</given-names></name><name><surname>Simon</surname><given-names>N</given-names></name><name><surname>Matsen</surname><given-names>FA</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Survival analysis of DNA mutation motifs with penalized proportional hazards</article-title><source>The Annals of Applied Statistics</source><volume>13</volume><fpage>1268</fpage><lpage>1294</lpage><pub-id pub-id-type="doi">10.1214/18-aoas1233</pub-id><pub-id pub-id-type="pmid">33214798</pub-id></element-citation></ref><ref id="bib9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fisher</surname><given-names>T</given-names></name><name><surname>Sung</surname><given-names>K</given-names></name><name><surname>Simon</surname><given-names>N</given-names></name><name><surname>Fukuyama</surname><given-names>J</given-names></name><name><surname>Matsen IV</surname><given-names>FA</given-names></name></person-group><year iso-8601-date="2025">2025</year><article-title>Inferring mechanistic parameters of somatic hypermutation using neural networks and approximate Bayesian computation</article-title><source>The Annals of Applied Statistics</source><volume>19</volume><fpage>720</fpage><lpage>743</lpage><pub-id pub-id-type="doi">10.1214/24-AOAS1985</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ford</surname><given-names>EE</given-names></name><name><surname>Tieri</surname><given-names>D</given-names></name><name><surname>Rodriguez</surname><given-names>OL</given-names></name><name><surname>Francoeur</surname><given-names>NJ</given-names></name><name><surname>Soto</surname><given-names>J</given-names></name><name><surname>Kos</surname><given-names>JT</given-names></name><name><surname>Peres</surname><given-names>A</given-names></name><name><surname>Gibson</surname><given-names>WS</given-names></name><name><surname>Silver</surname><given-names>CA</given-names></name><name><surname>Deikus</surname><given-names>G</given-names></name><name><surname>Hudson</surname><given-names>E</given-names></name><name><surname>Woolley</surname><given-names>CR</given-names></name><name><surname>Beckmann</surname><given-names>N</given-names></name><name><surname>Charney</surname><given-names>A</given-names></name><name><surname>Mitchell</surname><given-names>TC</given-names></name><name><surname>Yaari</surname><given-names>G</given-names></name><name><surname>Sebra</surname><given-names>RP</given-names></name><name><surname>Watson</surname><given-names>CT</given-names></name><name><surname>Smith</surname><given-names>ML</given-names></name></person-group><year iso-8601-date="2023">2023</year><article-title>FLAIRR-Seq: a method for single-molecule resolution of near full-length antibody H chain repertoires</article-title><source>Journal of Immunology</source><volume>210</volume><fpage>1607</fpage><lpage>1619</lpage><pub-id pub-id-type="doi">10.4049/jimmunol.2200825</pub-id><pub-id pub-id-type="pmid">37027017</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hanley</surname><given-names>JA</given-names></name><name><surname>McNeil</surname><given-names>BJ</given-names></name></person-group><year iso-8601-date="1982">1982</year><article-title>The meaning and use of the area under a receiver operating characteristic (ROC) curve</article-title><source>Radiology</source><volume>143</volume><fpage>29</fpage><lpage>36</lpage><pub-id pub-id-type="doi">10.1148/radiology.143.1.7063747</pub-id><pub-id pub-id-type="pmid">7063747</pub-id></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hoehn</surname><given-names>KB</given-names></name><name><surname>Lunter</surname><given-names>G</given-names></name><name><surname>Pybus</surname><given-names>OG</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>A phylogenetic codon substitution model for antibody lineages</article-title><source>Genetics</source><volume>206</volume><fpage>417</fpage><lpage>427</lpage><pub-id pub-id-type="doi">10.1534/genetics.116.196303</pub-id><pub-id pub-id-type="pmid">28315836</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hoehn</surname><given-names>KB</given-names></name><name><surname>Vander Heiden</surname><given-names>JA</given-names></name><name><surname>Zhou</surname><given-names>JQ</given-names></name><name><surname>Lunter</surname><given-names>G</given-names></name><name><surname>Pybus</surname><given-names>OG</given-names></name><name><surname>Kleinstein</surname><given-names>SH</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Repertoire-wide phylogenetic models of B cell molecular evolution reveal evolutionary signatures of aging and vaccination</article-title><source>PNAS</source><volume>116</volume><fpage>22664</fpage><lpage>22672</lpage><pub-id pub-id-type="doi">10.1073/pnas.1906020116</pub-id><pub-id pub-id-type="pmid">31636219</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hunter</surname><given-names>JD</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Matplotlib: a 2D graphics environment</article-title><source>Computing in Science &amp; Engineering</source><volume>9</volume><fpage>90</fpage><lpage>95</lpage><pub-id pub-id-type="doi">10.1109/MCSE.2007.55</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jaffe</surname><given-names>DB</given-names></name><name><surname>Shahi</surname><given-names>P</given-names></name><name><surname>Adams</surname><given-names>BA</given-names></name><name><surname>Chrisman</surname><given-names>AM</given-names></name><name><surname>Finnegan</surname><given-names>PM</given-names></name><name><surname>Raman</surname><given-names>N</given-names></name><name><surname>Royall</surname><given-names>AE</given-names></name><name><surname>Tsai</surname><given-names>F</given-names></name><name><surname>Vollbrecht</surname><given-names>T</given-names></name><name><surname>Reyes</surname><given-names>DS</given-names></name><name><surname>Hepler</surname><given-names>NL</given-names></name><name><surname>McDonnell</surname><given-names>WJ</given-names></name></person-group><year iso-8601-date="2022">2022</year><article-title>Functional antibodies exhibit light chain coherence</article-title><source>Nature</source><volume>611</volume><fpage>352</fpage><lpage>357</lpage><pub-id pub-id-type="doi">10.1038/s41586-022-05371-z</pub-id><pub-id pub-id-type="pmid">36289331</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ji</surname><given-names>Y</given-names></name><name><surname>Zhou</surname><given-names>Z</given-names></name><name><surname>Liu</surname><given-names>H</given-names></name><name><surname>Davuluri</surname><given-names>RV</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>DNABERT: pre-trained bidirectional encoder representations from transformers model for DNA-language in genome</article-title><source>Bioinformatics</source><volume>37</volume><fpage>2112</fpage><lpage>2120</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btab083</pub-id><pub-id pub-id-type="pmid">33538820</pub-id></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kimura</surname><given-names>M</given-names></name></person-group><year iso-8601-date="1980">1980</year><article-title>A simple method for estimating evolutionary rates of base substitutions through comparative studies of nucleotide sequences</article-title><source>Journal of Molecular Evolution</source><volume>16</volume><fpage>111</fpage><lpage>120</lpage><pub-id pub-id-type="doi">10.1007/BF01731581</pub-id><pub-id pub-id-type="pmid">7463489</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kovaltsuk</surname><given-names>A</given-names></name><name><surname>Leem</surname><given-names>J</given-names></name><name><surname>Kelm</surname><given-names>S</given-names></name><name><surname>Snowden</surname><given-names>J</given-names></name><name><surname>Deane</surname><given-names>CM</given-names></name><name><surname>Krawczyk</surname><given-names>K</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Observed antibody space: a resource for data mining next-generation sequencing of antibody repertoires</article-title><source>Journal of Immunology</source><volume>201</volume><fpage>2502</fpage><lpage>2509</lpage><pub-id pub-id-type="doi">10.4049/jimmunol.1800708</pub-id><pub-id pub-id-type="pmid">30217829</pub-id></element-citation></ref><ref id="bib19"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Krekel</surname><given-names>H</given-names></name><name><surname>Oliveira</surname><given-names>B</given-names></name><name><surname>Pfannschmidt</surname><given-names>R</given-names></name><name><surname>Bruynooghe</surname><given-names>F</given-names></name><name><surname>Laugher</surname><given-names>B</given-names></name><name><surname>Bruhin</surname><given-names>F</given-names></name></person-group><year iso-8601-date="2004">2004</year><data-title>Pytest</data-title><version designator="8.1.1">8.1.1</version><source>Github</source><ext-link ext-link-type="uri" xlink:href="https://github.com/pytest-dev/pytest">https://github.com/pytest-dev/pytest</ext-link></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Levinstein Hallak</surname><given-names>K</given-names></name><name><surname>Tzur</surname><given-names>S</given-names></name><name><surname>Rosset</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Big data analysis of human mitochondrial DNA substitution models: a regression approach</article-title><source>BMC Genomics</source><volume>19</volume><elocation-id>759</elocation-id><pub-id pub-id-type="doi">10.1186/s12864-018-5123-x</pub-id><pub-id pub-id-type="pmid">30340456</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Levinstein Hallak</surname><given-names>K</given-names></name><name><surname>Rosset</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2022">2022</year><article-title>Statistical modeling of SARS-CoV-2 substitution processes: predicting the next variant</article-title><source>Communications Biology</source><volume>5</volume><elocation-id>285</elocation-id><pub-id pub-id-type="doi">10.1038/s42003-022-03198-y</pub-id><pub-id pub-id-type="pmid">35351970</pub-id></element-citation></ref><ref id="bib22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Marcou</surname><given-names>Q</given-names></name><name><surname>Mora</surname><given-names>T</given-names></name><name><surname>Walczak</surname><given-names>AM</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>High-throughput immune repertoire analysis with IGoR</article-title><source>Nature Communications</source><volume>9</volume><elocation-id>561</elocation-id><pub-id pub-id-type="doi">10.1038/s41467-018-02832-w</pub-id><pub-id pub-id-type="pmid">29422654</pub-id></element-citation></ref><ref id="bib23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Martin Beem</surname><given-names>JS</given-names></name><name><surname>Venkatayogi</surname><given-names>S</given-names></name><name><surname>Haynes</surname><given-names>BF</given-names></name><name><surname>Wiehe</surname><given-names>K</given-names></name></person-group><year iso-8601-date="2023">2023</year><article-title>ARMADiLLO: a web server for analyzing antibody mutation probabilities</article-title><source>Nucleic Acids Research</source><volume>51</volume><fpage>W51</fpage><lpage>W56</lpage><pub-id pub-id-type="doi">10.1093/nar/gkad398</pub-id><pub-id pub-id-type="pmid">37260077</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Matsen</surname><given-names>FA</given-names></name><name><surname>Dumm</surname><given-names>W</given-names></name></person-group><year iso-8601-date="2025">2025</year><data-title>netam</data-title><source>GitHub</source><ext-link ext-link-type="uri" xlink:href="https://github.com/matsengrp/netam">https://github.com/matsengrp/netam</ext-link></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McCoy</surname><given-names>CO</given-names></name><name><surname>Bedford</surname><given-names>T</given-names></name><name><surname>Minin</surname><given-names>VN</given-names></name><name><surname>Bradley</surname><given-names>P</given-names></name><name><surname>Robins</surname><given-names>H</given-names></name><name><surname>Matsen</surname><given-names>FA</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Quantifying evolutionary constraints on B-cell affinity maturation</article-title><source>Philosophical Transactions of the Royal Society of London. Series B, Biological Sciences</source><volume>370</volume><elocation-id>20140244</elocation-id><pub-id pub-id-type="doi">10.1098/rstb.2014.0244</pub-id><pub-id pub-id-type="pmid">26194758</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>McKinney</surname><given-names>W</given-names></name></person-group><year iso-8601-date="2010">2010</year><chapter-title>Data structures for statistical computing in python</chapter-title><person-group person-group-type="editor"><name><surname>Millman</surname><given-names>J</given-names></name></person-group><source>Python in Science Conference</source><publisher-name>Scientific Research</publisher-name><fpage>56</fpage><lpage>61</lpage><pub-id pub-id-type="doi">10.25080/Majora-92bf1922-00a</pub-id></element-citation></ref><ref id="bib27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Methot</surname><given-names>SP</given-names></name><name><surname>Di Noia</surname><given-names>JM</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Molecular mechanisms of somatic hypermutation and class switch recombination</article-title><source>Advances in Immunology</source><volume>133</volume><fpage>37</fpage><lpage>87</lpage><pub-id pub-id-type="doi">10.1016/bs.ai.2016.11.002</pub-id><pub-id pub-id-type="pmid">28215280</pub-id></element-citation></ref><ref id="bib28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Minh</surname><given-names>BQ</given-names></name><name><surname>Schmidt</surname><given-names>HA</given-names></name><name><surname>Chernomor</surname><given-names>O</given-names></name><name><surname>Schrempf</surname><given-names>D</given-names></name><name><surname>Woodhams</surname><given-names>MD</given-names></name><name><surname>von Haeseler</surname><given-names>A</given-names></name><name><surname>Lanfear</surname><given-names>R</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>IQ-TREE 2: new models and efficient methods for phylogenetic inference in the genomic era</article-title><source>Molecular Biology and Evolution</source><volume>37</volume><fpage>1530</fpage><lpage>1534</lpage><pub-id pub-id-type="doi">10.1093/molbev/msaa015</pub-id><pub-id pub-id-type="pmid">32011700</pub-id></element-citation></ref><ref id="bib29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mölder</surname><given-names>F</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Sustainable data analysis with snakemake [version 2; peer review: 2 approved]</article-title><source>F1000research</source><volume>10</volume><elocation-id>29032.2</elocation-id><pub-id pub-id-type="doi">10.12688/f1000research.29032.2</pub-id></element-citation></ref><ref id="bib30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Olsen</surname><given-names>TH</given-names></name><name><surname>Boyles</surname><given-names>F</given-names></name><name><surname>Deane</surname><given-names>CM</given-names></name></person-group><year iso-8601-date="2022">2022a</year><article-title>Observed antibody space: a diverse database of cleaned, annotated, and translated unpaired and paired antibody sequences</article-title><source>Protein Science</source><volume>31</volume><fpage>141</fpage><lpage>146</lpage><pub-id pub-id-type="doi">10.1002/pro.4205</pub-id><pub-id pub-id-type="pmid">34655133</pub-id></element-citation></ref><ref id="bib31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Olsen</surname><given-names>TH</given-names></name><name><surname>Moal</surname><given-names>IH</given-names></name><name><surname>Deane</surname><given-names>CM</given-names></name></person-group><year iso-8601-date="2022">2022b</year><article-title>AbLang: an antibody language model for completing antibody sequences</article-title><source>Bioinformatics Advances</source><volume>2</volume><elocation-id>vbac046</elocation-id><pub-id pub-id-type="doi">10.1093/bioadv/vbac046</pub-id><pub-id pub-id-type="pmid">36699403</pub-id></element-citation></ref><ref id="bib32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ozenne</surname><given-names>B</given-names></name><name><surname>Subtil</surname><given-names>F</given-names></name><name><surname>Maucort-Boulch</surname><given-names>D</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>The precision--recall curve overcame the optimism of the receiver operating characteristic curve in rare diseases</article-title><source>Journal of Clinical Epidemiology</source><volume>68</volume><fpage>855</fpage><lpage>859</lpage><pub-id pub-id-type="doi">10.1016/j.jclinepi.2015.02.010</pub-id><pub-id pub-id-type="pmid">25881487</pub-id></element-citation></ref><ref id="bib33"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Paszke</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>PyTorch: An Imperative Style, High-Performance Deep Learning Library</article-title><source>arXiv</source><ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/1912.01703">https://arxiv.org/abs/1912.01703</ext-link></element-citation></ref><ref id="bib34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pilzecker</surname><given-names>B</given-names></name><name><surname>Jacobs</surname><given-names>H</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Mutating for good: DNA damage responses during somatic hypermutation</article-title><source>Frontiers in Immunology</source><volume>10</volume><elocation-id>438</elocation-id><pub-id pub-id-type="doi">10.3389/fimmu.2019.00438</pub-id><pub-id pub-id-type="pmid">30915081</pub-id></element-citation></ref><ref id="bib35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ralph</surname><given-names>DK</given-names></name><name><surname>Matsen</surname><given-names>FA</given-names></name></person-group><year iso-8601-date="2016">2016a</year><article-title>Consistency of VDJ rearrangement and substitution parameters enables accurate B cell receptor sequence annotation</article-title><source>PLOS Computational Biology</source><volume>12</volume><elocation-id>e1004409</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1004409</pub-id><pub-id pub-id-type="pmid">26751373</pub-id></element-citation></ref><ref id="bib36"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ralph</surname><given-names>DK</given-names></name><name><surname>Matsen</surname><given-names>FA</given-names></name></person-group><year iso-8601-date="2016">2016b</year><article-title>Likelihood-based inference of B cell clonal families</article-title><source>PLOS Computational Biology</source><volume>12</volume><elocation-id>e1005086</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1005086</pub-id><pub-id pub-id-type="pmid">27749910</pub-id></element-citation></ref><ref id="bib37"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ralph</surname><given-names>DK</given-names></name><name><surname>Matsen</surname><given-names>FA</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Per-sample immunoglobulin germline inference from B cell receptor deep sequencing data</article-title><source>PLOS Computational Biology</source><volume>15</volume><elocation-id>e1007133</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1007133</pub-id><pub-id pub-id-type="pmid">31329576</pub-id></element-citation></ref><ref id="bib38"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rodriguez</surname><given-names>OL</given-names></name><name><surname>Safonova</surname><given-names>Y</given-names></name><name><surname>Silver</surname><given-names>CA</given-names></name><name><surname>Shields</surname><given-names>K</given-names></name><name><surname>Gibson</surname><given-names>WS</given-names></name><name><surname>Kos</surname><given-names>JT</given-names></name><name><surname>Tieri</surname><given-names>D</given-names></name><name><surname>Ke</surname><given-names>H</given-names></name><name><surname>Jackson</surname><given-names>KJL</given-names></name><name><surname>Boyd</surname><given-names>SD</given-names></name><name><surname>Smith</surname><given-names>ML</given-names></name><name><surname>Marasco</surname><given-names>WA</given-names></name><name><surname>Watson</surname><given-names>CT</given-names></name></person-group><year iso-8601-date="2023">2023</year><article-title>Genetic variation in the immunoglobulin heavy chain locus shapes the human antibody repertoire</article-title><source>Nature Communications</source><volume>14</volume><elocation-id>4419</elocation-id><pub-id pub-id-type="doi">10.1038/s41467-023-40070-x</pub-id><pub-id pub-id-type="pmid">37479682</pub-id></element-citation></ref><ref id="bib39"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rogozin</surname><given-names>IB</given-names></name><name><surname>Kolchanov</surname><given-names>NA</given-names></name></person-group><year iso-8601-date="1992">1992</year><article-title>Somatic hypermutagenesis in immunoglobulin genes. II. Influence of neighbouring base sequences on mutagenesis</article-title><source>Biochimica et Biophysica Acta</source><volume>1171</volume><fpage>11</fpage><lpage>18</lpage><pub-id pub-id-type="doi">10.1016/0167-4781(92)90134-l</pub-id><pub-id pub-id-type="pmid">1420357</pub-id></element-citation></ref><ref id="bib40"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rogozin</surname><given-names>IB</given-names></name><name><surname>Diaz</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Cutting edge: DGYW/WRCH is a better predictor of mutability at G:C bases in Ig hypermutation than the widely accepted RGYW/WRCY motif and probably reflects a two-step activation-induced cytidine deaminase-triggered process</article-title><source>Journal of Immunology</source><volume>172</volume><fpage>3382</fpage><lpage>3384</lpage><pub-id pub-id-type="doi">10.4049/jimmunol.172.6.3382</pub-id><pub-id pub-id-type="pmid">15004135</pub-id></element-citation></ref><ref id="bib41"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rosset</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Efficient inference on known phylogenetic trees using Poisson regression</article-title><source>Bioinformatics</source><volume>23</volume><fpage>e142</fpage><lpage>e147</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btl306</pub-id><pub-id pub-id-type="pmid">17237083</pub-id></element-citation></ref><ref id="bib42"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Saito</surname><given-names>T</given-names></name><name><surname>Rehmsmeier</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>The precision-recall plot is more informative than the ROC plot when evaluating binary classifiers on imbalanced datasets</article-title><source>PLOS ONE</source><volume>10</volume><elocation-id>e0118432</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0118432</pub-id><pub-id pub-id-type="pmid">25738806</pub-id></element-citation></ref><ref id="bib43"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Soto</surname><given-names>C</given-names></name><name><surname>Bombardi</surname><given-names>RG</given-names></name><name><surname>Branchizio</surname><given-names>A</given-names></name><name><surname>Kose</surname><given-names>N</given-names></name><name><surname>Matta</surname><given-names>P</given-names></name><name><surname>Sevy</surname><given-names>AM</given-names></name><name><surname>Sinkovits</surname><given-names>RS</given-names></name><name><surname>Gilchuk</surname><given-names>P</given-names></name><name><surname>Finn</surname><given-names>JA</given-names></name><name><surname>Crowe</surname><given-names>JE</given-names><suffix>Jr</suffix></name></person-group><year iso-8601-date="2019">2019</year><article-title>High frequency of shared clonotypes in human B cell receptor repertoires</article-title><source>Nature</source><volume>566</volume><fpage>398</fpage><lpage>402</lpage><pub-id pub-id-type="doi">10.1038/s41586-019-0934-8</pub-id><pub-id pub-id-type="pmid">30760926</pub-id></element-citation></ref><ref id="bib44"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Soubrier</surname><given-names>J</given-names></name><name><surname>Steel</surname><given-names>M</given-names></name><name><surname>Lee</surname><given-names>MSY</given-names></name><name><surname>Der Sarkissian</surname><given-names>C</given-names></name><name><surname>Guindon</surname><given-names>S</given-names></name><name><surname>Ho</surname><given-names>SYW</given-names></name><name><surname>Cooper</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>The influence of rate heterogeneity among sites on the time dependence of molecular rates</article-title><source>Molecular Biology and Evolution</source><volume>29</volume><fpage>3345</fpage><lpage>3358</lpage><pub-id pub-id-type="doi">10.1093/molbev/mss140</pub-id><pub-id pub-id-type="pmid">22617951</pub-id></element-citation></ref><ref id="bib45"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Spisak</surname><given-names>N</given-names></name><name><surname>Walczak</surname><given-names>AM</given-names></name><name><surname>Mora</surname><given-names>T</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Learning the heterogeneous hypermutation landscape of immunoglobulins from high-throughput repertoire data</article-title><source>Nucleic Acids Research</source><volume>48</volume><fpage>10702</fpage><lpage>10712</lpage><pub-id pub-id-type="doi">10.1093/nar/gkaa825</pub-id><pub-id pub-id-type="pmid">33035336</pub-id></element-citation></ref><ref id="bib46"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Sung</surname><given-names>K</given-names></name></person-group><year iso-8601-date="2025">2025</year><data-title>thrifty-experiments-1</data-title><version designator="swh:1:rev:957abfe9935e52c0f62acf76a83f02d5ce7d7d57">swh:1:rev:957abfe9935e52c0f62acf76a83f02d5ce7d7d57</version><source>Software Heritage</source><ext-link ext-link-type="uri" xlink:href="https://archive.softwareheritage.org/swh:1:dir:405161c44db3e7ca818d218e1c51a835b11b7de5;origin=https://github.com/matsengrp/thrifty-experiments-1;visit=swh:1:snp:c87b9420c6e0d0baa5f550c7f31b3aba95b6d6fd;anchor=swh:1:rev:957abfe9935e52c0f62acf76a83f02d5ce7d7d57">https://archive.softwareheritage.org/swh:1:dir:405161c44db3e7ca818d218e1c51a835b11b7de5;origin=https://github.com/matsengrp/thrifty-experiments-1;visit=swh:1:snp:c87b9420c6e0d0baa5f550c7f31b3aba95b6d6fd;anchor=swh:1:rev:957abfe9935e52c0f62acf76a83f02d5ce7d7d57</ext-link></element-citation></ref><ref id="bib47"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tang</surname><given-names>C</given-names></name><name><surname>Bagnara</surname><given-names>D</given-names></name><name><surname>Chiorazzi</surname><given-names>N</given-names></name><name><surname>Scharff</surname><given-names>MD</given-names></name><name><surname>MacCarthy</surname><given-names>T</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>AID Overlapping and polη hotspots are key features of evolutionary variation within the human antibody heavy chain (IGHV) genes</article-title><source>Frontiers in Immunology</source><volume>11</volume><elocation-id>788</elocation-id><pub-id pub-id-type="doi">10.3389/fimmu.2020.00788</pub-id><pub-id pub-id-type="pmid">32425948</pub-id></element-citation></ref><ref id="bib48"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tang</surname><given-names>C</given-names></name><name><surname>Krantsevich</surname><given-names>A</given-names></name><name><surname>MacCarthy</surname><given-names>T</given-names></name></person-group><year iso-8601-date="2022">2022</year><article-title>Deep learning model of somatic hypermutation reveals importance of sequence context beyond hotspot targeting</article-title><source>iScience</source><volume>25</volume><elocation-id>103668</elocation-id><pub-id pub-id-type="doi">10.1016/j.isci.2021.103668</pub-id><pub-id pub-id-type="pmid">35036866</pub-id></element-citation></ref><ref id="bib49"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Teng</surname><given-names>G</given-names></name><name><surname>Papavasiliou</surname><given-names>FN</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Immunoglobulin somatic hypermutation</article-title><source>Annual Review of Genetics</source><volume>41</volume><fpage>107</fpage><lpage>120</lpage><pub-id pub-id-type="doi">10.1146/annurev.genet.41.110306.130340</pub-id><pub-id pub-id-type="pmid">17576170</pub-id></element-citation></ref><ref id="bib50"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vander Heiden</surname><given-names>JA</given-names></name><name><surname>Yaari</surname><given-names>G</given-names></name><name><surname>Uduman</surname><given-names>M</given-names></name><name><surname>Stern</surname><given-names>JNH</given-names></name><name><surname>O’Connor</surname><given-names>KC</given-names></name><name><surname>Hafler</surname><given-names>DA</given-names></name><name><surname>Vigneault</surname><given-names>F</given-names></name><name><surname>Kleinstein</surname><given-names>SH</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>pRESTO: a toolkit for processing high-throughput sequencing raw reads of lymphocyte receptor repertoires</article-title><source>Bioinformatics</source><volume>30</volume><fpage>1930</fpage><lpage>1932</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btu138</pub-id><pub-id pub-id-type="pmid">24618469</pub-id></element-citation></ref><ref id="bib51"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Vaswani</surname><given-names>A</given-names></name><name><surname>Shazeer</surname><given-names>N</given-names></name><name><surname>Parmar</surname><given-names>N</given-names></name><name><surname>Uszkoreit</surname><given-names>J</given-names></name><name><surname>Jones</surname><given-names>L</given-names></name><name><surname>Gomez</surname><given-names>AN</given-names></name><name><surname>Kaiser</surname><given-names>Ł</given-names></name><name><surname>Polosukhin</surname><given-names>I</given-names></name><name><surname>Luxburg</surname><given-names>UV</given-names></name><name><surname>Bengio</surname><given-names>S</given-names></name><name><surname>Wallach</surname><given-names>H</given-names></name><name><surname>Fergus</surname><given-names>R</given-names></name><name><surname>Vishwanathan</surname><given-names>S</given-names></name><name><surname>Garnett</surname><given-names>R</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Attention is all you need</article-title><conf-name>Advances in Neural Information Processing Systems</conf-name><fpage>1</fpage><lpage>11</lpage></element-citation></ref><ref id="bib52"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vergani</surname><given-names>S</given-names></name><name><surname>Korsunsky</surname><given-names>I</given-names></name><name><surname>Mazzarello</surname><given-names>AN</given-names></name><name><surname>Ferrer</surname><given-names>G</given-names></name><name><surname>Chiorazzi</surname><given-names>N</given-names></name><name><surname>Bagnara</surname><given-names>D</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Novel method for high-throughput full-length IGHV-D-J sequencing of the immune repertoire from bulk B-cells with single-cell resolution</article-title><source>Frontiers in Immunology</source><volume>8</volume><elocation-id>1157</elocation-id><pub-id pub-id-type="doi">10.3389/fimmu.2017.01157</pub-id><pub-id pub-id-type="pmid">28959265</pub-id></element-citation></ref><ref id="bib53"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wagner</surname><given-names>SD</given-names></name><name><surname>Neuberger</surname><given-names>MS</given-names></name></person-group><year iso-8601-date="1996">1996</year><article-title>Somatic hypermutation of immunoglobulin genes</article-title><source>Annual Review of Immunology</source><volume>14</volume><fpage>441</fpage><lpage>457</lpage><pub-id pub-id-type="doi">10.1146/annurev.immunol.14.1.441</pub-id><pub-id pub-id-type="pmid">8962691</pub-id></element-citation></ref><ref id="bib54"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname><given-names>Y</given-names></name><name><surname>Zhang</surname><given-names>S</given-names></name><name><surname>Yang</surname><given-names>X</given-names></name><name><surname>Hwang</surname><given-names>JK</given-names></name><name><surname>Zhan</surname><given-names>C</given-names></name><name><surname>Lian</surname><given-names>C</given-names></name><name><surname>Wang</surname><given-names>C</given-names></name><name><surname>Gui</surname><given-names>T</given-names></name><name><surname>Wang</surname><given-names>B</given-names></name><name><surname>Xie</surname><given-names>X</given-names></name><name><surname>Dai</surname><given-names>P</given-names></name><name><surname>Zhang</surname><given-names>L</given-names></name><name><surname>Tian</surname><given-names>Y</given-names></name><name><surname>Zhang</surname><given-names>H</given-names></name><name><surname>Han</surname><given-names>C</given-names></name><name><surname>Cai</surname><given-names>Y</given-names></name><name><surname>Hao</surname><given-names>Q</given-names></name><name><surname>Ye</surname><given-names>X</given-names></name><name><surname>Liu</surname><given-names>X</given-names></name><name><surname>Liu</surname><given-names>J</given-names></name><name><surname>Cao</surname><given-names>Z</given-names></name><name><surname>Huang</surname><given-names>S</given-names></name><name><surname>Song</surname><given-names>J</given-names></name><name><surname>Pan-Hammarström</surname><given-names>Q</given-names></name><name><surname>Zhao</surname><given-names>Y</given-names></name><name><surname>Alt</surname><given-names>FW</given-names></name><name><surname>Zheng</surname><given-names>X</given-names></name><name><surname>Da</surname><given-names>L-T</given-names></name><name><surname>Yeap</surname><given-names>L-S</given-names></name><name><surname>Meng</surname><given-names>F-L</given-names></name></person-group><year iso-8601-date="2023">2023</year><article-title>Mesoscale DNA feature in antibody-coding sequence facilitates somatic hypermutation</article-title><source>Cell</source><volume>186</volume><fpage>2193</fpage><lpage>2207</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2023.03.030</pub-id><pub-id pub-id-type="pmid">37098343</pub-id></element-citation></ref><ref id="bib55"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Waskom</surname><given-names>ML</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>seaborn: statistical data visualization</article-title><source>Journal of Open Source Software</source><volume>6</volume><elocation-id>3021</elocation-id><pub-id pub-id-type="doi">10.21105/joss.03021</pub-id></element-citation></ref><ref id="bib56"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wiehe</surname><given-names>K</given-names></name><name><surname>Bradley</surname><given-names>T</given-names></name><name><surname>Meyerhoff</surname><given-names>RR</given-names></name><name><surname>Hart</surname><given-names>C</given-names></name><name><surname>Williams</surname><given-names>WB</given-names></name><name><surname>Easterhoff</surname><given-names>D</given-names></name><name><surname>Faison</surname><given-names>WJ</given-names></name><name><surname>Kepler</surname><given-names>TB</given-names></name><name><surname>Saunders</surname><given-names>KO</given-names></name><name><surname>Alam</surname><given-names>SM</given-names></name><name><surname>Bonsignori</surname><given-names>M</given-names></name><name><surname>Haynes</surname><given-names>BF</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Functional relevance of improbable antibody mutations for HIV Broadly neutralizing antibody development</article-title><source>Cell Host &amp; Microbe</source><volume>23</volume><fpage>759</fpage><lpage>765</lpage><pub-id pub-id-type="doi">10.1016/j.chom.2018.04.018</pub-id><pub-id pub-id-type="pmid">29861171</pub-id></element-citation></ref><ref id="bib57"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Wiehe</surname><given-names>K</given-names></name><name><surname>Saunders</surname><given-names>KO</given-names></name><name><surname>Stalls</surname><given-names>V</given-names></name><name><surname>Cain</surname><given-names>DW</given-names></name><name><surname>Venkatayogi</surname><given-names>S</given-names></name><name><surname>Martin Beem</surname><given-names>JS</given-names></name><name><surname>Berry</surname><given-names>M</given-names></name><name><surname>Evangelous</surname><given-names>T</given-names></name><name><surname>Henderson</surname><given-names>R</given-names></name><name><surname>Hora</surname><given-names>B</given-names></name><name><surname>Xia</surname><given-names>SM</given-names></name><name><surname>Jiang</surname><given-names>C</given-names></name><name><surname>Newman</surname><given-names>A</given-names></name><name><surname>Bowman</surname><given-names>C</given-names></name><name><surname>Lu</surname><given-names>X</given-names></name><name><surname>Bryan</surname><given-names>ME</given-names></name><name><surname>Bal</surname><given-names>J</given-names></name><name><surname>Sanzone</surname><given-names>A</given-names></name><name><surname>Chen</surname><given-names>H</given-names></name><name><surname>Eaton</surname><given-names>A</given-names></name><name><surname>Tomai</surname><given-names>MA</given-names></name><name><surname>Fox</surname><given-names>CB</given-names></name><name><surname>Tam</surname><given-names>Y</given-names></name><name><surname>Barbosa</surname><given-names>C</given-names></name><name><surname>Bonsignori</surname><given-names>M</given-names></name><name><surname>Muramatsu</surname><given-names>H</given-names></name><name><surname>Alam</surname><given-names>SM</given-names></name><name><surname>Montefiori</surname><given-names>D</given-names></name><name><surname>Williams</surname><given-names>WB</given-names></name><name><surname>Pardi</surname><given-names>N</given-names></name><name><surname>Tian</surname><given-names>M</given-names></name><name><surname>Weissman</surname><given-names>D</given-names></name><name><surname>Alt</surname><given-names>FW</given-names></name><name><surname>Acharya</surname><given-names>P</given-names></name><name><surname>Haynes</surname><given-names>BF</given-names></name></person-group><year iso-8601-date="2022">2022</year><article-title>Mutation-Guided Vaccine Design: A Strategy for Developing Boosting Immunogens for HIV Broadly Neutralizing Antibody Induction</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/2022.11.11.516143</pub-id></element-citation></ref><ref id="bib58"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yaari</surname><given-names>G</given-names></name><name><surname>Uduman</surname><given-names>M</given-names></name><name><surname>Kleinstein</surname><given-names>SH</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Quantifying selection in high-throughput Immunoglobulin sequencing data sets</article-title><source>Nucleic Acids Research</source><volume>40</volume><elocation-id>e134</elocation-id><pub-id pub-id-type="doi">10.1093/nar/gks457</pub-id><pub-id pub-id-type="pmid">22641856</pub-id></element-citation></ref><ref id="bib59"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yaari</surname><given-names>Gur</given-names></name><name><surname>Vander Heiden</surname><given-names>JA</given-names></name><name><surname>Uduman</surname><given-names>M</given-names></name><name><surname>Gadala-Maria</surname><given-names>D</given-names></name><name><surname>Gupta</surname><given-names>N</given-names></name><name><surname>Stern</surname><given-names>JNH</given-names></name><name><surname>O’Connor</surname><given-names>KC</given-names></name><name><surname>Hafler</surname><given-names>DA</given-names></name><name><surname>Laserson</surname><given-names>U</given-names></name><name><surname>Vigneault</surname><given-names>F</given-names></name><name><surname>Kleinstein</surname><given-names>SH</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Models of somatic hypermutation targeting and substitution based on synonymous mutations from high-throughput immunoglobulin sequencing data</article-title><source>Frontiers in Immunology</source><volume>4</volume><elocation-id>358</elocation-id><pub-id pub-id-type="doi">10.3389/fimmu.2013.00358</pub-id><pub-id pub-id-type="pmid">24298272</pub-id></element-citation></ref><ref id="bib60"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yang</surname><given-names>Z</given-names></name></person-group><year iso-8601-date="1995">1995</year><article-title>A space-time process model for the evolution of DNA sequences</article-title><source>Genetics</source><volume>139</volume><fpage>993</fpage><lpage>1005</lpage><pub-id pub-id-type="doi">10.1093/genetics/139.2.993</pub-id><pub-id pub-id-type="pmid">7713447</pub-id></element-citation></ref><ref id="bib61"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhou</surname><given-names>JQ</given-names></name><name><surname>Kleinstein</surname><given-names>SH</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Position-dependent differential targeting of somatic hypermutation</article-title><source>Journal of Immunology</source><volume>205</volume><fpage>3468</fpage><lpage>3479</lpage><pub-id pub-id-type="doi">10.4049/jimmunol.2000496</pub-id><pub-id pub-id-type="pmid">33188076</pub-id></element-citation></ref></ref-list></back><sub-article article-type="editor-report" id="sa0"><front-stub><article-id pub-id-type="doi">10.7554/eLife.105471.3.sa0</article-id><title-group><article-title>eLife Assessment</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Mora</surname><given-names>Thierry</given-names></name><role specific-use="editor">Reviewing Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/05a0dhs15</institution-id><institution>École Normale Supérieure - PSL</institution></institution-wrap><country>France</country></aff></contrib></contrib-group><kwd-group kwd-group-type="evidence-strength"><kwd>Convincing</kwd></kwd-group><kwd-group kwd-group-type="claim-importance"><kwd>Important</kwd></kwd-group></front-stub><body><p>This study provides an <bold>important</bold> method to model the statistical biases of hypermutations during the affinity maturation of antibodies. The authors show <bold>convincingly</bold> that their model outperforms previous methods with fewer parameters; this is made possible by the use of machine learning to expand the context dependence of the mutation bias. They also show that models learned from nonsynonymous mutations and from out-of-frame sequences are different, prompting new questions about germinal center function. Strengths of the study include an open-access tool for using the model, a careful curation of existing data sets, and a rigorous benchmark; it is also shown that current machine-learning methods are currently limited by the availability of data, which explains the only modest gain in model performance afforded by modern machine learning.</p></body></sub-article><sub-article article-type="referee-report" id="sa1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.105471.3.sa1</article-id><title-group><article-title>Reviewer #1 (Public review):</article-title></title-group><contrib-group><contrib contrib-type="author"><anonymous/><role specific-use="referee">Reviewer</role></contrib></contrib-group></front-stub><body><p>Summary:</p><p>This paper introduces a new class of machine learning models for capturing how likely a specific nucleotide in a rearranged IG gene is to undergo somatic hypermutation. These models modestly outperform existing state-of-the-art efforts, despite having fewer free parameters. A surprising finding is that models trained on all mutations from non-functional rearrangements give divergent results from those trained on only silent mutations from functional rearrangements.</p><p>Strengths:</p><p>* The new model structure is quite clever and will provide a powerful way to explore larger models.</p><p>* Careful attention is paid to curating and processing large existing data sets.</p><p>* The authors are to be commended for their efforts to communicate with the developers of previous models and use the strongest possible versions of those in their current evaluation.</p><p>Weaknesses:</p><p>* No significant weaknesses noted</p></body></sub-article><sub-article article-type="referee-report" id="sa2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.105471.3.sa2</article-id><title-group><article-title>Reviewer #2 (Public review):</article-title></title-group><contrib-group><contrib contrib-type="author"><anonymous/><role specific-use="referee">Reviewer</role></contrib></contrib-group></front-stub><body><p>This work offers an insightful contribution for researchers in computational biology, immunology, and machine learning. By employing a 3-mer embedding and CNN architecture, the authors demonstrate that it is possible to extend sequence context without exponentially increasing the model's complexity. Key findings include:</p><p>• Efficiency and Performance: Thrifty CNNs outperform traditional 5-mer models and match the performance of significantly larger models like DeepSHM.</p><p>• Neutral Mutation Data: A distinction is made between using synonymous mutations and out-of-frame sequences for model training, with evidence suggesting these methods capture different aspects of SHM, or different biases in the type of data.</p><p>• Open Source Contributions: The release of a Python package and pretrained models adds practical value for the community.</p><p>However, readers should be aware of the limitations. The improvements over existing models are modest, and the work is constrained by the availability of high-quality out-of-frame sequence data. The study also highlights that more complex modeling techniques, like transformers, did not enhance predictive performance, which underscores the role of data availability in such studies.</p></body></sub-article><sub-article article-type="referee-report" id="sa3"><front-stub><article-id pub-id-type="doi">10.7554/eLife.105471.3.sa3</article-id><title-group><article-title>Reviewer #3 (Public review):</article-title></title-group><contrib-group><contrib contrib-type="author"><anonymous/><role specific-use="referee">Reviewer</role></contrib></contrib-group></front-stub><body><p>Summary:</p><p>Modeling and estimating sequence context biases during B cell somatic hypermutation is important for accurately modeling B cell evolution to better understand responses to infection and vaccination. Sung et al. introduce new statistical models that capture a wider sequence context of somatic hypermutation with a comparatively small number of additional parameters. They demonstrate their model's performance with rigorous testing across multiple subjects and datasets. Prior work has captured the mutation biases of fixed 3-, 5-, and 7-mers, but each of these expansions has significantly more parameters. The authors developed a machine-learning-based approach to learn these biases using wider contexts with comparatively few parameters.</p><p>Strengths:</p><p>Well motivated and defined problem. Clever solution to expand nucleotide context. Complete separation of training and test data by using different subjects for training vs testing. Release of open-source tools and scripts for reproducibility.</p><p>The authors have addressed my prior comments.</p></body></sub-article><sub-article article-type="author-comment" id="sa4"><front-stub><article-id pub-id-type="doi">10.7554/eLife.105471.3.sa4</article-id><title-group><article-title>Author response</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Sung</surname><given-names>Kevin</given-names></name><role specific-use="author">Author</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/007ps6h72</institution-id><institution>Fred Hutchinson Cancer Center</institution></institution-wrap><addr-line><named-content content-type="city">Seattle</named-content></addr-line><country>United States</country></aff></contrib><contrib contrib-type="author"><name><surname>Johnson</surname><given-names>Mackenzie M</given-names></name><role specific-use="author">Author</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/007ps6h72</institution-id><institution>Fred Hutchinson Cancer Center</institution></institution-wrap><addr-line><named-content content-type="city">Seattle</named-content></addr-line><country>United States</country></aff></contrib><contrib contrib-type="author"><name><surname>Dumm</surname><given-names>Will</given-names></name><role specific-use="author">Author</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/007ps6h72</institution-id><institution>Fred Hutchinson Cancer Center</institution></institution-wrap><addr-line><named-content content-type="city">Seattle</named-content></addr-line><country>United States</country></aff></contrib><contrib contrib-type="author"><name><surname>Simon</surname><given-names>Noah</given-names></name><role specific-use="author">Author</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/00cvxb145</institution-id><institution>University of Washington</institution></institution-wrap><addr-line><named-content content-type="city">Seattle</named-content></addr-line><country>United States</country></aff></contrib><contrib contrib-type="author"><name><surname>Haddox</surname><given-names>Hugh</given-names></name><role specific-use="author">Author</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/007ps6h72</institution-id><institution>Fred Hutchinson Cancer Center</institution></institution-wrap><addr-line><named-content content-type="city">Seattle</named-content></addr-line><country>United States</country></aff></contrib><contrib contrib-type="author"><name><surname>Fukuyama</surname><given-names>Julia</given-names></name><role specific-use="author">Author</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/02k40bc56</institution-id><institution>Indiana University Bloomington</institution></institution-wrap><addr-line><named-content content-type="city">Bloomington</named-content></addr-line><country>United States</country></aff></contrib><contrib contrib-type="author"><name><surname>Matsen</surname><given-names>Frederick A</given-names></name><role specific-use="author">Author</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/007ps6h72</institution-id><institution>Fred Hutchinson Cancer Center</institution></institution-wrap><addr-line><named-content content-type="city">Seattle</named-content></addr-line><country>United States</country></aff></contrib></contrib-group></front-stub><body><p>The following is the authors’ response to the previous reviews</p><disp-quote content-type="editor-comment"><p><bold>Reviewer #1 (Public Review):</bold></p><p>Summary:</p><p>This paper introduces a new class of machine learning models for capturing how likely a specific nucleotide in a rearranged IG gene is to undergo somatic hypermutation. These models modestly outperform existing state-of-the-art efforts, despite having fewer free parameters. A surprising finding is that models trained on all mutations from non-functional rearrangements give divergent results from those trained on only silent mutations from functional rearrangements.</p><p>Strengths:</p><p>(1) The new model structure is quite clever and will provide a powerful way to explore larger models.</p><p>(2) Careful attention is paid to curating and processing large existing data sets.</p><p>(3) The authors are to be commended for their efforts to communicate with the developers of previous models and use the strongest possible versions of those in their current evaluation.</p></disp-quote><p>Thank you very much for your comments. We especially appreciate the last comment, as we have indeed tried hard to do so.</p><disp-quote content-type="editor-comment"><p>Weaknesses:</p><p>(1) 10x/single cell data has a fairly different error profile compared to bulk data. A synonymous model should be built from the same</p><p><code>briney</code></p><p>dataset as the base model to validate the difference between the two types of training data.</p></disp-quote><p>Thank you for pointing this out.</p><p>We have repeated the same analysis with synonymous mutations derived from the bulk-sequenced</p><p>The fact that both the 10x and the</p><disp-quote content-type="editor-comment"><p>(2) The decision to test only kernels of 7, 9, and 11 is not described. The selection/optimization of embedding size is not explained. The filters listed in Table 1 are not defined.</p></disp-quote><p>We have added the following to the Models subsection to further explain these decisions:</p><p>“The hyperparameters for the models (Table 1) were selected with a run of Optuna (Akiba et al., 2019) early in the project and then fixed. Further optimization was not pursued because of the limited performance differences between the existing models.”</p><disp-quote content-type="editor-comment"><p><bold>Reviewer #2 (Public Review):</bold></p><p>Summary:</p><p>This work offers an insightful contribution for researchers in computational biology, immunology, and machine learning. By employing a 3-mer embedding and CNN architecture, the authors demonstrate that it is possible to extend sequence context without exponentially increasing the model's complexity.</p><p>Key findings:</p><p>(1) Efficiency and Performance: Thrifty CNNs outperform traditional 5-mer models and match the performance of significantly larger models like DeepSHM.</p><p>(2)Neutral Mutation Data: A distinction is made between using synonymous mutations and out-of-frame sequences for model training, with evidence suggesting these methods capture different aspects of SHM or different biases.</p><p>(3) Open Source Contributions: The release of a Python package and pre-trained models adds practical value for the community.</p></disp-quote><p>Thank you for your positive comments. We believe that we have been clear about the modest improvements (e.g., the abstract says “slight improvement”), and we discuss the data limitations extensively. If there are ways we can do this more effectively, we are happy to hear them.</p><disp-quote content-type="editor-comment"><p><bold>Reviewer #3 (Public Review):</bold></p><p>Summary:</p><p>Sung et al. introduce new statistical models that capture a wider sequence context of somatic hypermutation with a comparatively small number of additional parameters. They demonstrate their model’s performance with rigorous testing across multiple subjects and datasets.</p><p>Strengths:</p><p>Well-motivated and defined problem. Clever solution to expand nucleotide context. Complete separation of training and test data by using different subjects for training vs testing. Release of open-source tools and scripts for reproducibility.</p></disp-quote><p>Thank you for your positive comments.</p><disp-quote content-type="editor-comment"><p>Weaknesses:</p><p>This study could be improved with better descriptions of dataset sequencing technology, sequencing depth, etc.</p></disp-quote><p>We have added columns to Table 3 that report sequencing technology and depth for each dataset.</p><disp-quote content-type="editor-comment"><p><bold>Reviewer #1 (Recommendations for the Authors):</bold></p><p>(1) There seems to be a contradiction between Tables 2 and 3 as to whether the Tang et al. dataset was used to train models or only to test them.</p></disp-quote><p>Thank you for catching this. The &quot;purpose&quot; column in Table 3 was for the main analysis, while Table 2 is describing only models trained to compare with DeepSHM. Explaining this seems more work than it's worth, so we simply removed that column from Table 2. The dataset purposes are clear from the text.</p><disp-quote content-type="editor-comment"><p>(2) In Figure 4, I assume the two rows correspond to the Briney and Tang datasets, as in Figure 2, but this is not explicitly described.</p></disp-quote><p>Yes, you are correct. We added an explanation in the caption of Figure 4.</p><disp-quote content-type="editor-comment"><p>(3) Figure 2, supplement 1 should include a table like Table 1 that describes these additional models.</p></disp-quote><p>We have added an explanation in the caption to Table 1 that &quot;Medium&quot; and &quot;Large&quot; refer to specific hyperparameter choices. The caption to Figure 2, supplement 1 now describes the corresponding hyperparameter choices for &quot;Small&quot; thrifty models.</p><disp-quote content-type="editor-comment"><p>(4) On line 378 &quot;Therefore in either case&quot; seems extraneous.</p></disp-quote><p>Indeed. We have dropped those words.</p><disp-quote content-type="editor-comment"><p>(5) In the last paragraph of the Discussion, only the attempt to curate the Ford dataset is described. I am not sure if you intended to discuss the Rodriguez dataset here or not.</p></disp-quote><p>Thank you for pointing this out. We have updated the Materials and Methods section to include our attempts to recover data from Rodriguez et al., 2023.</p><disp-quote content-type="editor-comment"><p>(6) Have you looked to see if Soto et al. (Nature 2019) provides usable data for your purposes?</p></disp-quote><p>Thank you for making us aware of this dataset!</p><p>We assessed it but found that the recovery of usable out-of-frame sequences was too low to be useful for our analysis. We now describe this evaluation in the paper.</p><disp-quote content-type="editor-comment"><p>(7) Cui et al. note a high similarity between S5F and S5NF (r=0.93). Does that constrain the possible explanations for the divergence you see?</p></disp-quote><p>This is an excellent point.</p><p>We don't believe the correlation observed in Cui and our results are incompatible. Our point is not that the two sources of neutral data are completely different but that they differ enough to limit generalization. Also, the Spearman correlation in Cui is 0.86, which aligns with our observed drop in R-precision.</p><disp-quote content-type="editor-comment"><p>(8) Are you able to test the effects of branch length or background SHM on the model?</p></disp-quote><p>We're unsure what is meant by “background SHM.”</p><p>We did try joint optimization of branch length and model parameters, but it did not improve performance. Differences in clone size thresholds do exist between datasets, but Figure 3 suggests that tang is better sequence data.</p><disp-quote content-type="editor-comment"><p>(9) Would the model be expected to scale up to a kernel of, say, 50? Would that help yield biological insight?</p></disp-quote><p>We did not test such large models because larger kernels did not improve performance.</p><p>While your suggestion is intriguing, distinguishing biological effects from overfitting would be difficult. We explore biological insights more directly in our recent mechanistic model paper (Fisher et al., 2025), which is now cited in a new paragraph on biological conclusions.</p><disp-quote content-type="editor-comment"><p><bold>Reviewer #2 (Recommendations for the Authors):</bold></p><p>(1) Consider applying a stricter filtration approach to the Briney dataset to make it more comparable to the Tang dataset.</p></disp-quote><p>Thank you. We agree that differences in datasets are interesting, though model rankings remain consistent. We now include supplementary figures comparing synonymous and out-of-frame models from the</p><disp-quote content-type="editor-comment"><p>(2) You omit mutations between the unmutated germline and the MRCA of each tree. Why?</p></disp-quote><p>The inferred germline may be incorrect due to germline variation or CDR3 indels, which could introduce spurious mutations. Following Spisak et al. (2020), we exclude this branch.</p><p>Yes, singletons are discarded: ~28k in tang and ~1.1M in jaffe.</p><disp-quote content-type="editor-comment"><p>(3) Could a unified model trained on both data types offer further insights?</p></disp-quote><p>We agree and present such an analysis in Figure 4.</p><disp-quote content-type="editor-comment"><p>(4) Tree inference biases from parent-child distances may impact the results.</p></disp-quote><p>While this is an important issue, all models are trained on the same trees, so we expect any noise or bias to be consistent. Different datasets help confirm the robustness of our findings.</p><disp-quote content-type="editor-comment"><p>(5) Simulations would strengthen validation.</p></disp-quote><p>We focused on real datasets, which we view as a strength. While simulations could help, designing a meaningful simulation model would be nontrivial. We have clarified this point in the manuscript.</p><disp-quote content-type="editor-comment"><p><bold>Reviewer #3 (Recommendations for the Authors):</bold></p><p>There are typos in lines 109, 110, 301, 307, and 418.</p></disp-quote><p>Thank you, we have corrected them.</p></body></sub-article></article>