<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.1d3 20150301//EN"  "JATS-archivearticle1.dtd"><article article-type="research-article" dtd-version="1.1d3" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="hwp">eLife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn publication-format="electronic">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">05913</article-id><article-id pub-id-type="doi">10.7554/eLife.05913</article-id><article-categories><subj-group subj-group-type="display-channel"><subject>Research Article</subject></subj-group><subj-group subj-group-type="heading"><subject>Neuroscience</subject></subj-group></article-categories><title-group><article-title>The self-organization of grid cells in 3D</article-title></title-group><contrib-group><contrib contrib-type="author" corresp="yes" id="author-22612"><name><surname>Stella</surname><given-names>Federico</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="corresp" rid="cor1">*</xref><xref ref-type="other" rid="par-1"/><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-16297"><name><surname>Treves</surname><given-names>Alessandro</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf1"/></contrib><aff id="aff1"><label>1</label><institution content-type="dept">Cognitive Neuroscience</institution>, <institution>Scuola Internazionale Superiore di Studi Avanzati</institution>, <addr-line><named-content content-type="city">Trieste</named-content></addr-line>, <country>Italy</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor" id="author-8684"><name><surname>Goldman</surname><given-names>Mark S</given-names></name><role>Reviewing editor</role><aff><institution>University of California at Davis</institution>, <country>United States</country></aff></contrib></contrib-group><author-notes><corresp id="cor1"><label>*</label>For correspondence: <email>fstella@sissa.it</email></corresp></author-notes><pub-date date-type="pub" publication-format="electronic"><day>30</day><month>03</month><year>2015</year></pub-date><pub-date pub-type="collection"><year>2015</year></pub-date><volume>4</volume><elocation-id>e05913</elocation-id><history><date date-type="received"><day>05</day><month>12</month><year>2014</year></date><date date-type="accepted"><day>25</day><month>03</month><year>2015</year></date></history><permissions><copyright-statement>© 2015, Stella and Treves</copyright-statement><copyright-year>2015</copyright-year><copyright-holder>Stella and Treves</copyright-holder><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-05913-v2.pdf"/><abstract><object-id pub-id-type="doi">10.7554/eLife.05913.001</object-id><p>Do we expect periodic grid cells to emerge in bats, or perhaps dolphins, exploring a three-dimensional environment? How long will it take? Our self-organizing model, based on ring-rate adaptation, points at a complex answer. The mathematical analysis leads to asymptotic states resembling face centered cubic (FCC) and hexagonal close packed (HCP) crystal structures, which are calculated to be very close to each other in terms of cost function. The simulation of the full model, however, shows that the approach to such asymptotic states involves several sub-processes over distinct time scales. The smoothing of the initially irregular multiple fields of individual units and their arrangement into hexagonal grids over certain best planes are observed to occur relatively quickly, even in large 3D volumes. The correct mutual orientation of the planes, though, and the coordinated arrangement of different units, take a longer time, with the network showing no sign of convergence towards either a pure FCC or HCP ordering.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.05913.001">http://dx.doi.org/10.7554/eLife.05913.001</ext-link></p></abstract><abstract abstract-type="executive-summary"><object-id pub-id-type="doi">10.7554/eLife.05913.002</object-id><title>eLife digest</title><p>Our ability to navigate through our environment depends on a region of the brain called the hippocampus. In the 1990s it was shown that this structure, which takes its name from the Greek word for ‘seahorse’ owing to its shape, was larger in London taxi drivers than it was in the general population. However, as early as the 1960s, experiments in rats had revealed that specific cells within the hippocampus—called place cells—fire whenever an animal is in a particular location, and thus enable the animal to build up a map of its environment.</p><p>In 2014, the scientist who discovered place cells shared the Nobel Prize in Physiology or Medicine with two neuroscientists who had discovered an additional type of cell that is involved in navigation. These grid cells, which are located in a region of the brain that provides input to the hippocampus, ‘fire’ at multiple points in space. When the scientists who discovered grid cells plotted these points in two dimensions, they formed a grid of tessellating triangles that spanned the entire area.</p><p>However, many animals, including aquatic mammals, monkeys and bats, navigate in three dimensions rather than two. This raises an obvious question: can grid cells also represent three-dimensional space? Stella and Treves have addressed this issue by constructing a computer model that simulates grid cell activity in a virtual bat flying through a virtual room. The model reveals that grid cells switch from firing largely at random to firing in some semblance of a three-dimensional pattern relatively quickly.</p><p>However, this pattern bears little resemblance to the highly ordered arrangement seen in two dimensions. Indeed, the model suggests that a bat flying at 1 metre per second around a room that measured 2.5 × 2.5 × 2.5 metres would need to fly continuously for a very long time (at least 80 hours) before such a pattern could be established in three dimensions. This suggests that the regular tessellation shown by grid cells in two dimensions might not be routinely established in three dimensions. Instead, simpler ‘precursor’ firing patterns may form over shorter periods of time, providing a looser mapping of three-dimensional space.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.05913.002">http://dx.doi.org/10.7554/eLife.05913.002</ext-link></p></abstract><kwd-group kwd-group-type="author-keywords"><title>Author keywords</title><kwd>bat</kwd><kwd>neural network</kwd><kwd>grid cells</kwd><kwd>spatial representations</kwd><kwd>learning</kwd><kwd>pattern formation</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research organism</title><kwd>Other</kwd></kwd-group><funding-group><award-group id="par-1"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000780</institution-id><institution>European Commission (EC)</institution></institution-wrap></funding-source><award-id>FET grant GRIDMAP</award-id><principal-award-recipient><name><surname>Stella</surname><given-names>Federico</given-names></name></principal-award-recipient></award-group><funding-statement>The funder had no role in study design, data collection and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta><meta-name>elife-xml-version</meta-name><meta-value>2.3</meta-value></custom-meta><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>A computational model for the formation of neural networks of grid cells in virtual bats suggests that the highly ordered networks presumed to support spatial navigation in two dimensions cannot be routinely established in three-dimensional space.</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>Where does our internal representation of space come from? And how does it code for space extending in three dimensions? New findings about space-related activity in the bat have recently raised this question again (<xref ref-type="bibr" rid="bib23">Ulanovsky and Moss, 2011</xref>; <xref ref-type="bibr" rid="bib28">Yartsev et al., 2011</xref>; <xref ref-type="bibr" rid="bib27">Yartsev and Ulanovsky, 2013</xref>; <xref ref-type="bibr" rid="bib4">Finkelstein et al., 2014</xref>). The similarity in the place cell and, most remarkably, in the grid cell representation between rodents and bats suggests a common neural substrate for spatial navigation, shared across these mammals (<xref ref-type="bibr" rid="bib1">Andersen and Buneo, 2002</xref>; <xref ref-type="bibr" rid="bib9">Jacobs et al., 2010</xref>; <xref ref-type="bibr" rid="bib17">Sereno and Lehky, 2011</xref>; <xref ref-type="bibr" rid="bib12">Killian et al., 2012</xref>; <xref ref-type="bibr" rid="bib8">Indovina et al., 2013</xref>; <xref ref-type="bibr" rid="bib10">Jacobs et al., 2013</xref>; <xref ref-type="bibr" rid="bib22">Thurley et al., 2014</xref>), and it provides an indication possibly valid also for other animals living and moving extensively in three dimensions, like for example dolphins, monkeys and even non-mammalian species (<xref ref-type="bibr" rid="bib7">Healy et al., 2005</xref>; <xref ref-type="bibr" rid="bib2">Dacke and Srinivasan, 2007</xref>; <xref ref-type="bibr" rid="bib26">Wu and Dickman, 2012</xref>; <xref ref-type="bibr" rid="bib3">Burt de Perera and Holbrook, 2012</xref>). At the same time, the obvious difference in the behavior of these species requires a system that flexibly adapts to perform computations as different as mapping two- or three-dimensional space (<xref ref-type="bibr" rid="bib13">Knierim et al., 2000</xref>; <xref ref-type="bibr" rid="bib6">Hayman et al., 2011</xref>; <xref ref-type="bibr" rid="bib21">Taube and Shinder, 2013</xref>). Here we describe a model of grid cell formation that accounts for both these aspects of spatial cognition, in a unitary perspective on the mEC network (<xref ref-type="fig" rid="fig1">Figure 1</xref>).<fig id="fig1" position="float"><label>Figure 1.</label><caption><title>Scheme of the simulations.</title><p>(<bold>A</bold>) We simulate the trajectory of a bat exploring a volume of space over a prolonged period of time. At each step, the bat moves forward at a constant speed and chooses a new direction of movement close to the previous one. (<bold>B</bold>) The feed-forward network (equivalent to that shown in <xref ref-type="bibr" rid="bib14">[Kropff and Treves, 2008]</xref>), including here only two mEC neurons. The would-be grid units receive inputs from place cell-like units with firing fields similar to those reported in <xref ref-type="bibr" rid="bib27">Yartsev and Ulanovsky (2013</xref>). (<bold>C</bold>) Snapshots of the evolution of the firing rate map of a single unit. The figures correspond to (from left to right) 2, 5, 10 and 20 million time steps of learning.</p></caption><graphic xlink:href="elife-05913-fig1-v2"/><permissions><copyright-statement>© 2013, M Yartsev, N Ulanovsky.</copyright-statement><copyright-year>2013</copyright-year><copyright-holder>M Yartsev, N Ulanovsky</copyright-holder><license><license-p>Figure 1 is reproduced from M Yartsev, N Ulanovsky. 2013. Representation of three-dimensional space in the hippocampus of flying bats<italic>. Science</italic> <bold>340</bold>:367–372. Reprinted with permission from AAAS.</license-p></license></permissions></fig></p><p>Grid cells seemingly require some clever engineering design that generates the common periodicity among neighboring units while keeping them distinct in terms of spatial phase (<xref ref-type="bibr" rid="bib30">Zilli, 2012</xref>). While place cell and head direction cells have been shown to directly generalize to three dimensions (<xref ref-type="bibr" rid="bib27">Yartsev and Ulanovsky, 2013</xref>; <xref ref-type="bibr" rid="bib4">Finkelstein et al., 2014</xref>), the form that grid cells will exhibit in higher dimensionality (currently tested in flying bats [<xref ref-type="bibr" rid="bib5">Ginosar et al., 2014</xref>]) is still not clear. Further, the question is still open of how the mechanism producing such a complex periodic pattern on a surface can, in the case of bats, extend to a volume (<xref ref-type="bibr" rid="bib11">Jeffery et al., 2013</xref>), even when accepting the information-theoretic optimality of a regular lattice (<xref ref-type="bibr" rid="bib16">Mathis et al., 2014</xref>). In the self-organization perspective that we propose, the spatial responses first emerge spontaneously, at the single unit level, with no engineering required. In the simplest version of the model, which we have explored in a series of studies (<xref ref-type="bibr" rid="bib14">Kropff and Treves, 2008</xref>; <xref ref-type="bibr" rid="bib19">Si et al., 2012</xref>; <xref ref-type="bibr" rid="bib20">Stella et al., 2013</xref>), the periodicity of the grid pattern is a result of firing rate adaptation during exploration sessions that span a considerable developmental time (<xref ref-type="fig" rid="fig1">Figure 1, c</xref>). It is fixated gradually by means of synaptic plasticity in the feed-forward connections, which convey broad spatial inputs, for example but not necessarily from ‘place units’ (<xref ref-type="fig" rid="fig1">Figure 1, b</xref>). Contrary to other models limited to the explanation of grid cell expression, this model delves into the issue of their induction and, most importantly, can account for the effects of the geometry of the explored environment on the outcome of the self-organization process. We have shown how, for example, the model produces pentagonal grids on a spherical surface and heptagonal ones on a hyperbolic one (<xref ref-type="bibr" rid="bib24">Urdapilleta et al., 2015</xref>). The nature of our model allows us to now investigate the process of grid cell self-organization in three dimensions without the need to modify any of its features. We use bats as our reference, as it is the species currently available for experiments during roughly homogeneous navigation along the three dimensions of physical space (<xref ref-type="fig" rid="fig1">Figure 1, a</xref>).</p></sec><sec id="s2"><title>Model</title><sec id="s2-1"><title>Numerical simulations</title><p>In our simulations a virtual bat explores a volume of side <italic>L</italic> with a constant speed <italic>v</italic>. The position of the animal is sampled at time steps of constant Δ<italic>t</italic>. We temporarily leave these quantities unspecified. We will discuss their actual values at the end of the paper as they are critical for the interpretation of the results. For the moment they should be understood as expressed in arbitrary units. The path the animal performs is generated as a correlated random walk in which the direction of movement at any time step depends on the previous one. For simplicity, the change in running direction between two consecutive steps of the virtual bat is sampled from a Gaussian distribution with zero mean and standard deviation <italic>σ</italic><sub><italic>h</italic></sub> = 0.15 radians.</p><sec id="s2-1-1"><title>The network</title><p>Our model is comprised of two layers. The input network represents, for example, the CA1 region of the hippocampus and contains <italic>N</italic><sub><italic>inp</italic></sub> = 12<sup>3</sup> units. The output network represents a population of <italic>N</italic><sub><italic>mEC</italic></sub> = 125 would-be grid units in mEC, all with the same adaptation parameters when not differently stated. Each mEC unit receives afferent spatial inputs which, as already discussed in <xref ref-type="bibr" rid="bib14">Kropff and Treves (2008</xref>), we take for simplicity to arise from regularly arranged place cells, although they could also arise from spatially modulated units in the adjacent cortices. The input to unit <italic>i</italic> at time <italic>t</italic> is then given by <inline-formula><mml:math id="inf1"><mml:mrow><mml:msubsup><mml:mi>h</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula>:<disp-formula id="equ1"><label>(1)</label><mml:math id="m1"><mml:mrow><mml:msubsup><mml:mi>h</mml:mi><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:munder><mml:mstyle displaystyle="true"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow></mml:mstyle><mml:mi>j</mml:mi></mml:munder><mml:mtext> </mml:mtext><mml:msubsup><mml:mi>W</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:msubsup><mml:mi>r</mml:mi><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>The weight <inline-formula><mml:math id="inf2"><mml:mrow><mml:msubsup><mml:mi>W</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> connects input unit <italic>j</italic> to mEC unit <italic>i</italic>. We will assume that at the time the mEC units develop their firing maps, spatially modulated or place cell-like activity is already present, either in the parahippocampal cortex or in the hippocampus. The network model works in the same way with any kind of spatially modulated input, but the place cell assumption reduces the averaging necessary for learning. Moreover, as recent studies have shown (<xref ref-type="bibr" rid="bib15">Langston et al., 2010</xref>; <xref ref-type="bibr" rid="bib25">Wills et al., 2010</xref>), it is entirely plausible that place cells develop an adult-like spatial code earlier than grid cells do. We thus model the place field as a Gaussian bump centered in the place cell preferred position <inline-formula><mml:math id="inf3"><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>: <disp-formula id="equ2"><label>(2)</label><mml:math id="m2"><mml:mrow><mml:msubsup><mml:mi>r</mml:mi><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mtext>exp</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mi>t</mml:mi></mml:msup><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>p</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where <inline-formula><mml:math id="inf4"><mml:mrow><mml:msup><mml:mrow><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>→</mml:mo></mml:mover></mml:mrow><mml:mi>t</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> is the position at time <italic>t</italic> of the simulated bat, <italic>σ</italic><sub><italic>p</italic></sub> = 0.05 <italic>L</italic> is the width of the firing field and <inline-formula><mml:math id="inf5"><mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>−</mml:mo><mml:mi>b</mml:mi></mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the Euclidean distance between two points <italic>a</italic> and <italic>b</italic> in three dimensions. Place field centers are homogeneously distributed in the volume (consistently with the experimental data presented in <xref ref-type="bibr" rid="bib27">[Yartsev and Ulanovsky, 2013]</xref>). Note that the choice of the value for the parameter <italic>σ</italic><sub><italic>p</italic></sub> is not itself crucial for our model (<xref ref-type="bibr" rid="bib14">Kropff and Treves, 2008</xref>). The range of values that it can take in simulations, however, is constrained in practice by the number of place cells used in the model. Basically the dimension of each place field should guarantee a homogeneous amount of global input activity across the environment. Given a sufficient place field density in the input layer, the parameter does not play a critical role anymore. As we show in the following, the properties of the developing grid fields depend on the time scale of adaptation and not on the size of the place fields.</p></sec><sec id="s2-1-2"><title>Single unit dynamics</title><p>The firing rate <inline-formula><mml:math id="inf6"><mml:mrow><mml:msubsup><mml:mtext>Ψ</mml:mtext><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> of mEC unit <italic>i</italic> is determined by a non-linear transfer function<disp-formula id="equ3"><label>(3)</label><mml:math id="m3"><mml:mrow><mml:msubsup><mml:mtext>Ψ</mml:mtext><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mfrac><mml:mtext>arctan </mml:mtext><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msup><mml:mi>g</mml:mi><mml:mi>t</mml:mi></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>α</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo>−</mml:mo><mml:msup><mml:mi>μ</mml:mi><mml:mi>t</mml:mi></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mtext>Θ</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>α</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo>−</mml:mo><mml:msup><mml:mi>μ</mml:mi><mml:mi>t</mml:mi></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>which is normalized to have maximal firing rate equal to 1 (in arbitrary units), and Θ(⋅) is the Heaviside function. The variable <italic>μ</italic><sup><italic>t</italic></sup> is a threshold while <inline-formula><mml:math id="inf7"><mml:mrow><mml:msubsup><mml:mi>α</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> represents the adaptation-mediated input to the unit <italic>i</italic>. It is related to <inline-formula><mml:math id="inf8"><mml:mrow><mml:msubsup><mml:mi>h</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> as follows:<disp-formula id="equ4"><label>(4)</label><mml:math id="m4"><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:msubsup><mml:mi>α</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mi>α</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>h</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>−</mml:mo><mml:msubsup><mml:mi>β</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>−</mml:mo><mml:msubsup><mml:mi>α</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msubsup><mml:mi>β</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mi>β</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>h</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>−</mml:mo><mml:msubsup><mml:mi>β</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula>where <italic>β</italic><sub><italic>i</italic></sub> has slower dynamics than <italic>α</italic><sub><italic>i</italic></sub>, with <italic>b</italic><sub>2</sub> = <italic>b</italic><sub>1</sub>/3, <italic>b</italic><sub>1</sub> = 0.1 (in a continuous formulation, the <italic>b</italic> coefficients become rates, in units of (Δ<italic>t</italic><sup>−1</sup>)). This adaptive dynamics makes it more difficult for a neuron to fire for prolonged periods of time, and corresponds to the kernel <italic>K</italic> considered in the analytical treatment (<xref ref-type="bibr" rid="bib14">Kropff and Treves, 2008</xref>). The gain <italic>g</italic><sup><italic>t</italic></sup> and threshold <italic>μ</italic><sup><italic>t</italic></sup> are iteratively adjusted by <xref ref-type="disp-formula" rid="equ5">Equation 5</xref> at every time step to fix the mean activity <inline-formula><mml:math id="inf9"><mml:mrow><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:munder><mml:mstyle displaystyle="true"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow></mml:mstyle><mml:mi>i</mml:mi></mml:munder><mml:mtext> </mml:mtext><mml:msubsup><mml:mtext>Ψ</mml:mtext><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo>/</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>E</mml:mi><mml:mi>C</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and the sparsity <inline-formula><mml:math id="inf10"><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:munder><mml:mstyle displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mi>i</mml:mi></mml:munder><mml:mtext> </mml:mtext><mml:msubsup><mml:mtext>Ψ</mml:mtext><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>/</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>E</mml:mi><mml:mi>C</mml:mi></mml:mrow></mml:msub><mml:munder><mml:mstyle displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mi>i</mml:mi></mml:munder><mml:mtext> </mml:mtext><mml:msubsup><mml:mtext>Ψ</mml:mtext><mml:mi>i</mml:mi><mml:mrow><mml:msup><mml:mi>t</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> within a 10% relative error bound from pre-specified values, <italic>a</italic><sub>0</sub> = 0.1 and <italic>s</italic><sub>0</sub> = 0.3, respectively. If <italic>k</italic> is indexing the iteration process:<disp-formula id="equ5"><label>(5)</label><mml:math id="m5"><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:msup><mml:mi>μ</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:msup><mml:mi>μ</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi>a</mml:mi><mml:mi>k</mml:mi></mml:msup><mml:mo>−</mml:mo><mml:msub><mml:mi>a</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msup><mml:mi>g</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:msup><mml:mi>g</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:msup><mml:mi>g</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi>s</mml:mi><mml:mi>k</mml:mi></mml:msup><mml:mo>−</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula></p><p><italic>b</italic><sub>3</sub> = 0.01 and <italic>b</italic><sub>4</sub> = 0.1 are also rates, but in terms of intermediate iteration steps. <italic>a</italic><sup><italic>k</italic></sup> and <italic>s</italic><sup><italic>k</italic></sup> are the values of mean activity and sparsity determined by <italic>μ</italic><sup><italic>t</italic>,<italic>k</italic></sup> and <italic>g</italic><sup><italic>t</italic>,<italic>k</italic></sup> in the intermediate iteration steps. The iteration stops once the gain and threshold have been brought within the 10% error range, and the activity of mEC units is determined by the final values of the gain and threshold in <xref ref-type="disp-formula" rid="equ3">Equation 3</xref>.</p></sec><sec id="s2-1-3"><title>Synaptic plasticity model</title><p>The learning process modifies the strength of the feed-forward connections according to a Hebbian rule:<disp-formula id="equ6"><label>(6)</label><mml:math id="m6"><mml:mrow><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mi>W</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:mi mathvariant="italic">ϵ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mtext>Ψ</mml:mtext><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:msubsup><mml:mi>r</mml:mi><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo>−</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mtext>Ψ</mml:mtext><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>i</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>r</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>j</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>with a rate <italic>ϵ</italic> = 0.002. <inline-formula><mml:math id="inf11"><mml:mrow><mml:mover accent="true"><mml:mrow><mml:msubsup><mml:mtext>Ψ</mml:mtext><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:msubsup></mml:mrow><mml:mo stretchy="true">¯</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf12"><mml:mrow><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>r</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> are estimated mean firing rates of mEC unit <italic>i</italic> and place unit <italic>j</italic> that are adjusted at each time step of the simulation:<disp-formula id="equ7"><label>(7)</label><mml:math id="m7"><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mtext>Ψ</mml:mtext><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mtext>Ψ</mml:mtext><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>i</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:mi>η</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mtext>Ψ</mml:mtext><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo>−</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mtext>Ψ</mml:mtext><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>i</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>r</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>r</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>j</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:mi>η</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>r</mml:mi><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo>−</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>r</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mi>j</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula>with <italic>η</italic> = 0.05 a time averaging factor. After each learning step, the provisional <inline-formula><mml:math id="inf13"><mml:mrow><mml:msubsup><mml:mrow><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> weights are normalized into unitary norm:<disp-formula id="equ8"><label>(8)</label><mml:math id="m8"><mml:mrow><mml:munder><mml:mstyle displaystyle="true"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow></mml:mstyle><mml:mi>j</mml:mi></mml:munder><mml:mtext> </mml:mtext><mml:msubsup><mml:mi>W</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>Units that win during competitive learning (enforced by <xref ref-type="disp-formula" rid="equ5">Equation 5</xref>) manage to establish strong connections with units that provide strong inputs. As learning proceeds, the units establish fields where they both receive strong inputs and, at the same time, are recovering from adaptation. The emergence of the grid map is the product of averaging over millions of time steps. It remains to be assessed whether this mechanism we propose might also account for the formation of new grid representations in a novel environment the animal adapts to, for a sufficient time, or if, instead, it can only be applied to the developmental period.</p></sec><sec id="s2-1-4"><title>Grid alignment: head direction input</title><p>Two substantial extensions are represented by the introduction in the model of head direction information, through the assignment of preferred directions to mEC units, and by the presence of recurrent connections in the mEC layer beside the feed-forward set between the two layers (<xref ref-type="bibr" rid="bib19">Si et al., 2012</xref>). Both these additions to the earlier version of the model are important for the grid alignment issue that we are going to study in the 3D case. With these two additional elements, the overall input to unit <italic>j</italic> is now:<disp-formula id="equ9"><label>(9)</label><mml:math id="m9"><mml:mrow><mml:msubsup><mml:mi>h</mml:mi><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:munder><mml:mstyle displaystyle="true"><mml:mrow><mml:mo>∑</mml:mo></mml:mrow></mml:mstyle><mml:mi>j</mml:mi></mml:munder><mml:mtext> </mml:mtext><mml:msubsup><mml:mi>W</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:msubsup><mml:mi>r</mml:mi><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:mi>ρ</mml:mi><mml:munder><mml:mstyle displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mi>k</mml:mi></mml:munder><mml:mtext> </mml:mtext><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mtext>Ψ</mml:mtext><mml:mi>k</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mi>τ</mml:mi></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>with <italic>ρ</italic> = 0.1 a factor setting the relative strength of feed-forward <inline-formula><mml:math id="inf14"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>W</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and collateral weights <inline-formula><mml:math id="inf30"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, and <italic>τ</italic> = 25 steps a delay in signal transmission, as discussed by <xref ref-type="bibr" rid="bib19">Si et al. (2012</xref>). The multiplicative factor <inline-formula><mml:math id="inf15"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> in <xref ref-type="disp-formula" rid="equ9">Equation 9</xref> is a tuning function which is maximal when the current direction of the animal movement <italic>ω</italic><sub><italic>t</italic></sub> is along the preferred direction <italic>θ</italic><sub><italic>i</italic></sub> assigned to unit <italic>i</italic> (<xref ref-type="bibr" rid="bib29">Zhang, 1996</xref>).<disp-formula id="equ10"><label>(10)</label><mml:math id="m10"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mi>θ</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>ω</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>c</mml:mi><mml:mo>+</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>c</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mtext>exp</mml:mtext><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>ν</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mtext>cos</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>θ</mml:mi><mml:mo>−</mml:mo><mml:mi>ω</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where <italic>c</italic> = 0.2 and <italic>ν</italic> = 0.8 are parameters determining the minimum value and the width of the cell tuning curve. Preferred head directions are randomly assigned to mEC units and they uniformly span the 4<italic>π</italic> solid angle.</p></sec><sec id="s2-1-5"><title>Collateral weights</title><p>The appearance of fields in the output layer of the model is fully independent of the presence of collateral connections. Instead, their basic function is to favor the appearance of a certain phase shift of the fields in the post-synaptic unit relative to the pre-synaptic one, and consequently to induce the alignment of grids, producing a common orientation in the population (<xref ref-type="bibr" rid="bib18">Si and Treves, 2013</xref>). In this study we will not deal with collateral weight self-organization, only with feed-forward weight learning. For simplicity, the collateral weights are set at convenient values at the beginning of the simulations and left unchanged afterwards. We will deal with the issue of recurrent connection plasticity in future work (but see <xref ref-type="bibr" rid="bib18">[Si and Treves, 2013]</xref>).</p><p>Collateral weights are set in the following way (<xref ref-type="bibr" rid="bib14">Kropff and Treves, 2008</xref>): each mEC unit is temporarily assigned a preferred position, an auxiliary field at coordinates (<italic>x</italic><sub><italic>i</italic></sub>, <italic>y</italic><sub><italic>i</italic></sub>, <italic>z</italic><sub><italic>i</italic></sub>). The coordinates are randomly chosen among the place field centers of the input layer. These auxiliary fields are introduced only for the sake of weight definition and do not play any role in other parts of the simulations. The collateral weight between unit <italic>i</italic> and unit <italic>k</italic> is then calculated as<disp-formula id="equ11"><label>(11)</label><mml:math id="m11"><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mtext>exp</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mi>d</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>f</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mi>κ</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow><mml:mo>+</mml:mo></mml:msup><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where [*]<sup>+</sup> denotes the Heaviside step function, <italic>κ</italic> = 0.05 is an inhibition factor to favor sparse weights, <inline-formula><mml:math id="inf16"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the tuning function defined above (in <xref ref-type="disp-formula" rid="equ10">Equation 10</xref>), <italic>ω</italic><sub><italic>ik</italic></sub> is the direction of the line connecting the auxiliary fields of unit <italic>i</italic> and <italic>k</italic>, <italic>σ</italic><sub><italic>f</italic></sub> = 0.2 <italic>L</italic> defines how broad the connectivity is, and <italic>d</italic><sub><italic>ki</italic></sub> is defined as<disp-formula id="equ12"><label>(12)</label><mml:math id="m12"><mml:mrow><mml:msubsup><mml:mi>d</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mi>l</mml:mi><mml:mtext>cos</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mi>l</mml:mi><mml:mtext>cos</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mi>l</mml:mi><mml:mtext>cos</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>that is, it is the distance between the auxiliary fields with an offset <italic>l</italic> = <italic>v</italic> × <italic>τ</italic>.</p><p>The normalization on this set of connections is performed as in <xref ref-type="disp-formula" rid="equ8">Equation 8</xref>. The definition of the weights is such that it generates strong positive interactions between cells with similar preferred head direction and activation fields appropriately shifted along the same head direction.</p></sec></sec><sec id="s2-2"><title>Analytical model</title><p>The self-organization process we consider at the single-unit level can be described in analytical terms as an unsupervised optimization process, if one neglects the collateral interactions that are presumed to align the grids (<xref ref-type="bibr" rid="bib19">Si et al., 2012</xref>). The simplified version of the model which can be analyzed mathematically is very abstract, and does not specify most of the parameters necessary to the simulations. Nevertheless, it indicates which are the asymptotic states that should be approached by the system after having evolved for a long time.</p><p>The asymptotic states are defined in terms of a variational principle, amounting to the minimization of a cost function of the form:<disp-formula id="equ13"><label>(13)</label><mml:math id="m13"><mml:mrow><mml:mi>H</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>H</mml:mi><mml:mi>K</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>H</mml:mi><mml:mi>A</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mo>=</mml:mo><mml:msup><mml:mstyle displaystyle="true"><mml:mo>∫</mml:mo></mml:mstyle><mml:mtext>​</mml:mtext></mml:msup><mml:mi>d</mml:mi><mml:mi>χ</mml:mi><mml:msup><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>▽</mml:mo><mml:mtext>Ψ</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>χ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:mi>γ</mml:mi><mml:msup><mml:mstyle displaystyle="true"><mml:mo>∫</mml:mo></mml:mstyle><mml:mtext>​</mml:mtext></mml:msup><mml:mi>d</mml:mi><mml:mi>χ</mml:mi><mml:msup><mml:mstyle displaystyle="true"><mml:mo>∫</mml:mo></mml:mstyle><mml:mtext>​</mml:mtext></mml:msup><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mtext>Ψ</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>χ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>K</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mi>t</mml:mi><mml:mo>′</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mtext>Ψ</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>χ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>t</mml:mi><mml:mo>′</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where <italic>χ</italic> is the spatial coordinate and Ψ represents the firing rate of the neuron across the environment. The functional is defined based on the hypothesis that the activity of the units reflects only two simple constraints:<list list-type="order"><list-item><p>The minimization of the variability of the maps across space, that is, a preference for smooth maps. Such smoothness is expected to stem from the smoothness of the spatial inputs and of the neuronal transfer function. This constraint is expressed in the first term of the functional, the <italic>kinetic</italic> one.</p></list-item><list-item><p>The penalization of maps that require a neuron to fire for prolonged periods of time, which is opposed by neuronal fatigue. The second term of the functional, the <italic>adaptation</italic> term, represents this constraint.</p></list-item></list></p><p>The parameter <italic>γ</italic> parameterizes the relative importance of the two constraints.</p><p>The dependence of the functional on time can be eliminated by taking into account the averaging effect of a long run over many trajectories and different speeds experienced during training. We therefore substitute the time-dependent kernel <italic>K</italic>(<italic>t</italic> − <italic>t</italic>′) in the second term of <xref ref-type="disp-formula" rid="equ13">Equation 13</xref> with an effective space-dependent one, <italic>K</italic>(<italic>χ</italic>′ − <italic>χ</italic>), using the average speed of the animal to fix the relationship between the two:<disp-formula id="equ14"><label>(14)</label><mml:math id="m14"><mml:mrow><mml:mi>H</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>H</mml:mi><mml:mi>K</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>H</mml:mi><mml:mi>A</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>V</mml:mi></mml:mfrac><mml:munder><mml:mstyle displaystyle="true"><mml:mo>∫</mml:mo></mml:mstyle><mml:mtext>Γ</mml:mtext></mml:munder><mml:mi>d</mml:mi><mml:msup><mml:mi>χ</mml:mi><mml:mi>d</mml:mi></mml:msup><mml:msup><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>▽</mml:mo><mml:mtext>Ψ</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>χ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:mi>γ</mml:mi><mml:mfrac><mml:mn>1</mml:mn><mml:mi>V</mml:mi></mml:mfrac><mml:munder><mml:mstyle displaystyle="true"><mml:mo>∫</mml:mo></mml:mstyle><mml:mtext>Γ</mml:mtext></mml:munder><mml:mi>d</mml:mi><mml:mi>χ</mml:mi><mml:mtext>Ψ</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mi>χ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:munder><mml:mstyle displaystyle="true"><mml:mo>∫</mml:mo></mml:mstyle><mml:mtext>Γ</mml:mtext></mml:munder><mml:mi>d</mml:mi><mml:mi>χ</mml:mi><mml:mo>′</mml:mo><mml:mtext>Ψ</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>χ</mml:mi><mml:mo>′</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>K</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>|</mml:mo><mml:mi>χ</mml:mi><mml:mo>′</mml:mo><mml:mo>−</mml:mo><mml:mi>χ</mml:mi><mml:mo>|</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where we have also made explicit the normalization by the area <italic>V</italic> of the <italic>d</italic>-dimensional environment Γ.</p><p>We directly apply this expression to ask which is the favorite arrangement of the fields in a 3D volume <italic>V</italic>.</p><sec id="s2-2-1"><title>Optimal packing</title><p>Unlike on the plane, where the hexagonal tiling is always the optimal one, three-dimensional space admits a multitude of equally optimal orderings of spheres. The problem of sphere packing, in a volume of 3D space, is a well-known mathematical problem, and it is known since the time of Gauss that any of these infinite optimal solutions can be described in terms of two fundamental arrangements, called face centered cubic (FCC) and hexagonal close packed (HCP), that represent the only two regular solutions to the problem. Both solutions are based on a series of layers of spheres arranged in a hexagonal pattern. These layers are stacked one upon the other with given phase differences between them (<xref ref-type="fig" rid="fig2">Figure 2</xref>). The difference between FCC and HCP lies in the sequence with which these phases appear. Given one of these layers, and taking it as a reference with positioning A, there are two possible arrangements (B and C) of the next layer, obtained with a translation of A, that puts all the spheres at the same distance from their neighbors. Any sequence of A, B and C without immediate repetitions has the same, maximum, packing score, but among all sequences there are the two regular prototypes:<list list-type="bullet"><list-item><p><bold>FCC</bold> = ABCABCABCA.</p></list-item><list-item><p><bold>HCP</bold> = ABABABABAB.</p></list-item></list><fig id="fig2" position="float"><object-id pub-id-type="doi">10.7554/eLife.05913.003</object-id><label>Figure 2.</label><caption><title>Regular optimal solutions to the sphere packing problem in 3D.</title><p>Top: Functions used in cost function calculation for face centered cubic (FCC) and hexagonal close packed (HCP) structures. Color markers are used to indicate the layering in the field arrangement: FCC results from an A(red)B(blue)C(green) sequence, HCP from an A(red)B(blue)A(red) sequence. Middle: Same as above but from a different viewpoint to highlight the different organization of the relative phases. Bottom: Autocorrelograms of the above functions. Color markers indicate the magnitude of the corresponding peak in the autocorrelogram. Purple: full peaks. Orange: half peaks.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.05913.003">http://dx.doi.org/10.7554/eLife.05913.003</ext-link></p></caption><graphic xlink:href="elife-05913-fig2-v2"/></fig></p><p>In both combinations each sphere has 12 first neighbors, and if <italic>d</italic> is the diameter of a sphere (or the distance between the centers of two neighboring spheres), then the inter-layer separation is <inline-formula><mml:math id="inf17"><mml:mrow><mml:mfrac><mml:mrow><mml:msqrt><mml:mn>6</mml:mn></mml:msqrt></mml:mrow><mml:mn>3</mml:mn></mml:mfrac><mml:mi>d</mml:mi></mml:mrow></mml:math></inline-formula>. If we consider the unit cell of 13 spheres (a central sphere + 12 neighbors) in <xref ref-type="fig" rid="fig2">Figure 2</xref>, then FCC and HCP differ only regarding the position of three spheres (compare the position of the fields marked in green and red in the top-left and top-right panels in <xref ref-type="fig" rid="fig2">Figure 2</xref>). In fact, while in FCC neighbor spheres are arranged in six pairs with symmetrical positions with respect to the center, in HCP there are only three of these pairs, those on the central plane (fields marked in blue in <xref ref-type="fig" rid="fig2">Figure 2</xref>, top right).</p><p>Considering the three-dimensional distribution of activity <italic>ψ</italic>(<italic>x</italic>) that minimizes the cost function in <xref ref-type="disp-formula" rid="equ14">Equation 14</xref>, we then compare the relative optimality of FCC and HCP configurations. To do so we define two analytical expressions for the two arrangements of fields in terms of a combination of plane waves, as they are well suited to be treated in this formulation of the problem.</p></sec><sec id="s2-2-2"><title>FCC symmetry</title><p>To represent the FCC arrangement of fields we use the following expression:<disp-formula id="equ15"><label>(15)</label><mml:math id="m15"><mml:mrow><mml:msup><mml:mi>ψ</mml:mi><mml:mrow><mml:mi>F</mml:mi><mml:mi>C</mml:mi><mml:mi>C</mml:mi></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mi>r</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>4</mml:mn></mml:mfrac><mml:munderover><mml:mstyle displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>4</mml:mn></mml:munderover><mml:mtext>cos</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>·</mml:mo><mml:mi>r</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>a combination of four plane waves (<xref ref-type="fig" rid="fig2">Figure 2</xref>, top left), with the four wave vectors <italic>k</italic><sub><italic>i</italic></sub> given by the matrix:<disp-formula id="equ16"><label>(16)</label><mml:math id="m16"><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mrow><mml:mi>a</mml:mi></mml:mfrac><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:mrow><mml:msqrt><mml:mrow><mml:mn>3</mml:mn><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msqrt></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mn>2</mml:mn><mml:mo>/</mml:mo><mml:msqrt><mml:mn>3</mml:mn></mml:msqrt></mml:mrow></mml:mtd><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:msqrt><mml:mn>6</mml:mn></mml:msqrt></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:msqrt><mml:mn>3</mml:mn></mml:msqrt></mml:mrow></mml:mtd><mml:mtd><mml:mn>1</mml:mn></mml:mtd><mml:mtd><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:msqrt><mml:mn>6</mml:mn></mml:msqrt></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:msqrt><mml:mn>3</mml:mn></mml:msqrt></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:msqrt><mml:mn>6</mml:mn></mml:msqrt></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>The directions of the wave vectors are equivalent to those of the center-to-vertex axes in a tetrahedron. This choice gives<disp-formula id="equ17"><label>(17)</label><mml:math id="m17"><mml:mrow><mml:mtext>Spacing</mml:mtext><mml:mo>=</mml:mo><mml:mi>a</mml:mi><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula><disp-formula id="equ18"><label>(18)</label><mml:math id="m18"><mml:mrow><mml:mtext>Normalization</mml:mtext><mml:mo>&lt;</mml:mo><mml:msup><mml:mi>ψ</mml:mi><mml:mrow><mml:mi>F</mml:mi><mml:mi>C</mml:mi><mml:mi>C</mml:mi></mml:mrow></mml:msup><mml:mo>&gt;</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula><disp-formula id="equ19"><label>(19)</label><mml:math id="m19"><mml:mrow><mml:mo>|</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msup><mml:mo>|</mml:mo><mml:mn>2</mml:mn></mml:msup><mml:mo>=</mml:mo><mml:mfrac><mml:mn>3</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mrow><mml:mi>a</mml:mi></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>As any power of the previous expression maintains the same symmetry properties, we will actually compute the cost function for the first few powers:<disp-formula id="equ20"><label>(20)</label><mml:math id="m20"><mml:mrow><mml:msubsup><mml:mi>ψ</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mi>F</mml:mi><mml:mi>C</mml:mi><mml:mi>C</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mi>r</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msubsup><mml:mi>p</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mi>F</mml:mi><mml:mi>C</mml:mi><mml:mi>C</mml:mi></mml:mrow></mml:msubsup><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>4</mml:mn></mml:mfrac><mml:munderover><mml:mstyle displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>4</mml:mn></mml:munderover><mml:mtext> cos</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>·</mml:mo><mml:mi>r</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mi>n</mml:mi></mml:msup><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>Here <inline-formula><mml:math id="inf18"><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mi>F</mml:mi><mml:mi>C</mml:mi><mml:mi>C</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> is used to maintain the normalization.</p><p>The first term of the cost function, the spatial average &lt;<italic>ψ</italic><sub><italic>n</italic></sub>∇<italic>ψ</italic><sub><italic>n</italic></sub>&gt;, can then be evaluated analytically by expanding <italic>ψ</italic><sub><italic>n</italic></sub> over the Fourier modes and taking into account the orthonormality relations of planar waves. This calculation is quite simple for low powers, but the number of terms increases rapidly with <italic>n</italic>. The resulting formulas for <italic>n</italic> = 2 are reported in the ‘Materials and methods’ section.</p><p>The second term can be similarly calculated by using the change of variable <bold>q</bold> = <bold>x</bold>′ − <bold>x</bold> together with the trigonometric property:<disp-formula id="equ21"><label>(21)</label><mml:math id="m21"><mml:mrow><mml:mtext>cos</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">k</mml:mi><mml:mo>·</mml:mo><mml:mi mathvariant="bold">q</mml:mi><mml:mo>+</mml:mo><mml:mi mathvariant="bold">k</mml:mi><mml:mo>·</mml:mo><mml:mi mathvariant="bold">x</mml:mi><mml:mo>+</mml:mo><mml:mi>ϕ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mtext>cos</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">k</mml:mi><mml:mo>·</mml:mo><mml:mi mathvariant="bold">q</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mtext>cos</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">k</mml:mi><mml:mo>·</mml:mo><mml:mi mathvariant="bold">x</mml:mi><mml:mo>+</mml:mo><mml:mi>ϕ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mtext>sin</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">k</mml:mi><mml:mo>·</mml:mo><mml:mi mathvariant="bold">q</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mtext>sin</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="bold">k</mml:mi><mml:mo>·</mml:mo><mml:mi mathvariant="bold">q</mml:mi><mml:mo>+</mml:mo><mml:mi>ϕ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>Since sin(<bold>k</bold>⋅<bold>q</bold>)<italic>K</italic>(<bold>q</bold>) is an odd function and the integration domain is symmetrical around <italic><bold>q</bold></italic> = 0, the second term in <xref ref-type="disp-formula" rid="equ21">Equation 21</xref> does not survive the first integral in <italic>H</italic><sub><italic>A</italic></sub> (<xref ref-type="disp-formula" rid="equ14">Equation 14</xref>).</p><p>The calculations can then be performed as in the previous case after introducing the 3D Fourier transform of the adaptation kernel <italic>K</italic>:<disp-formula id="equ22"><label>(22)</label><mml:math id="m22"><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munder><mml:mstyle displaystyle="true"><mml:mo>∫</mml:mo></mml:mstyle><mml:mi>V</mml:mi></mml:munder><mml:mtext> </mml:mtext><mml:mi>d</mml:mi><mml:mi>q</mml:mi><mml:mi>K</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>q</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mtext>cos</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>·</mml:mo><mml:mi>q</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>The adaptation kernel may take various forms, but for reasons that will become clear in the next section, here we consider a kernel in a form that makes it factorable over the spatial variables. We use a difference of radially symmetric Gaussians:<disp-formula id="equ23"><label>(23)</label><mml:math id="m23"><mml:mrow><mml:mi>K</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>q</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mi>K</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>q</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mi>ρ</mml:mi><mml:msub><mml:mi>K</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>q</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>v</mml:mi><mml:msub><mml:mi>τ</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mn>3</mml:mn><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:mtext>exp</mml:mtext><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mi>q</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mi>v</mml:mi><mml:msub><mml:mi>τ</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfrac></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mi>ρ</mml:mi><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>v</mml:mi><mml:msub><mml:mi>τ</mml:mi><mml:mi>S</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mn>3</mml:mn><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:mtext>exp</mml:mtext><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mi>q</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mi>v</mml:mi><mml:msub><mml:mi>τ</mml:mi><mml:mi>S</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfrac></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>The Fourier transform of this kernel is:<disp-formula id="equ24"><label>(24)</label><mml:math id="m24"><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mi>L</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mi>ρ</mml:mi><mml:msub><mml:mrow><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mi>S</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mo>=</mml:mo><mml:mtext>exp</mml:mtext><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mi>v</mml:mi><mml:msub><mml:mi>τ</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mi>ρ</mml:mi><mml:mtext> exp</mml:mtext><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mi>v</mml:mi><mml:msub><mml:mi>τ</mml:mi><mml:mi>S</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>Again the computation of the integral, although conceptually straightforward, becomes increasingly demanding with higher values of <italic>n</italic> due to the explosion in the number of terms.</p></sec><sec id="s2-2-3"><title>HCP symmetry</title><p>Since the hexagonal close packing does not have central symmetry, the choice of a function reproducing the arrangement of fields is less evident. We opt for:<disp-formula id="equ25"><label>(25)</label><mml:math id="m25"><mml:mrow><mml:msubsup><mml:mi>ψ</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mi>H</mml:mi><mml:mi>C</mml:mi><mml:mi>P</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mi>r</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msubsup><mml:mi>p</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mi>H</mml:mi><mml:mi>C</mml:mi><mml:mi>P</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>2</mml:mn><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>2</mml:mn><mml:mtext>cos</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>z</mml:mi></mml:msub><mml:mo>·</mml:mo><mml:mi>r</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mfrac><mml:mn>2</mml:mn><mml:mn>3</mml:mn></mml:mfrac><mml:munderover><mml:mstyle displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mi>i</mml:mi><mml:mn>3</mml:mn></mml:munderover><mml:mtext> cos</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>·</mml:mo><mml:mi>r</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>2</mml:mn><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>2</mml:mn><mml:mtext>cos</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi mathvariant="italic">z</mml:mi></mml:msub><mml:mo>·</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="italic">r</mml:mi><mml:mo>+</mml:mo><mml:mtext>Δ</mml:mtext><mml:mi>z</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mfrac><mml:mn>2</mml:mn><mml:mn>3</mml:mn></mml:mfrac><mml:munderover><mml:mstyle displaystyle="true"><mml:mo>∑</mml:mo></mml:mstyle><mml:mi>i</mml:mi><mml:mn>3</mml:mn></mml:munderover><mml:mtext> cos</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>·</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mo>+</mml:mo><mml:mtext>Δ</mml:mtext><mml:mi>x</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mi>n</mml:mi></mml:msup><mml:mo>,</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula>where two separate wave vectors are present: <italic>k</italic><sub><italic>xy</italic></sub> fixing the spacing on planar hexagonal layers, and <italic>k</italic><sub><italic>z</italic></sub> used instead to regulate the distance between layers (<xref ref-type="fig" rid="fig2">Figure 2</xref>, top right). As in the previous case, we consider different powers of the same formula, as they all present peaks in the same configuration.</p><p>The components of <italic>k</italic><sub><italic>xy</italic></sub> are, again<disp-formula id="equ26"><label>(26)</label><mml:math id="m26"><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mrow><mml:mi>a</mml:mi></mml:mfrac><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mn>2</mml:mn><mml:mo>/</mml:mo><mml:msqrt><mml:mn>3</mml:mn></mml:msqrt></mml:mrow></mml:mtd><mml:mtd><mml:mn>0</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:msqrt><mml:mn>3</mml:mn></mml:msqrt></mml:mrow></mml:mtd><mml:mtd><mml:mn>1</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:msqrt><mml:mn>3</mml:mn></mml:msqrt></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>with <inline-formula><mml:math id="inf19"><mml:mrow><mml:mo>|</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mo>|</mml:mo><mml:mn>2</mml:mn></mml:msup><mml:mo>=</mml:mo><mml:mfrac><mml:mn>4</mml:mn><mml:mn>3</mml:mn></mml:mfrac><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mo>/</mml:mo><mml:mi mathvariant="italic">a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula> while the <italic>z</italic> component is set to <inline-formula><mml:math id="inf20"><mml:mrow><mml:mo>|</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>z</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msqrt><mml:mn>3</mml:mn></mml:msqrt></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:msqrt><mml:mn>2</mml:mn></mml:msqrt></mml:mrow></mml:mfrac><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mo>/</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf21"><mml:mrow><mml:mo>|</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>z</mml:mi></mml:msub><mml:msup><mml:mo>|</mml:mo><mml:mn>2</mml:mn></mml:msup><mml:mo>=</mml:mo><mml:mfrac><mml:mn>3</mml:mn><mml:mn>8</mml:mn></mml:mfrac><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mo>/</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula>. To obtain the correct HCP arrangement of fields, Δ<italic>x</italic> and Δ<italic>z</italic> should be set to:<disp-formula id="equ27"><label>(27)</label><mml:math id="m27"><mml:mrow><mml:mtext>Δ</mml:mtext><mml:mi>x</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msqrt><mml:mn>3</mml:mn></mml:msqrt></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula><disp-formula id="equ28"><label>(28)</label><mml:math id="m28"><mml:mrow><mml:mtext>Δ</mml:mtext><mml:mi>z</mml:mi><mml:mo>=</mml:mo><mml:msqrt><mml:mrow><mml:mfrac><mml:mn>2</mml:mn><mml:mn>3</mml:mn></mml:mfrac></mml:mrow></mml:msqrt><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>Spacing and normalization are the same as for FCC.</p><p>The convenience of choosing a factorizing Gaussian kernel (<xref ref-type="disp-formula" rid="equ23">Equation 23</xref>) is now evident: it allows splitting of the integrals in <xref ref-type="disp-formula" rid="equ14">Equation 14</xref> into the <italic>xy</italic> and <italic>z</italic> component. Apart from this expedient, the calculations for the HCP function follow the same line of those previously described for the FCC case. A significant difference is the dependence of the HCP solution on two parameters <italic>k</italic><sub><italic>x</italic></sub> and <italic>k</italic><sub><italic>z</italic></sub>. Therefore, while the choice of the adaptation parameters <italic>τ</italic><sub><italic>L</italic></sub> and <italic>τ</italic><sub><italic>S</italic></sub> fixes one of the two (as shown in <xref ref-type="fig" rid="fig3">Figure 3</xref>, left), one can still optimize over the ratio between the two. The value of <italic>k</italic><sub><italic>z</italic></sub>/<italic>k</italic><sub><italic>xy</italic></sub> that should be observed in the presence of a perfect HCP pattern can be calculated as 3/32<sup>1/2</sup> ≈ 0.53. In <xref ref-type="fig" rid="fig3">Figure 3</xref> (right), we plot the values obtained for different powers of our expression for the HCP arrangement. While for higher values of <italic>n</italic> the value of <italic>k</italic><sub><italic>z</italic></sub>/<italic>k</italic><sub><italic>xy</italic></sub> extracted from the optimization progressively approaches the theoretical one, interestingly the <italic>n</italic> = 1 case exhibits a very different behavior with an optimal <italic>k</italic><sub><italic>z</italic></sub>/<italic>k</italic><sub><italic>xy</italic></sub> = 0, independently of the value of <italic>γ</italic>. As <italic>k</italic><sub><italic>z</italic></sub> represents the reciprocal of the inter-layer spacing (and also the wavelength of the activity modulation along the z-axis), this value indicates that the minimum value of the cost function is obtained with infinite distance (and infinitely slow modulation of the activity), or equivalently with a column-like distribution of activity, with a single layer of fields extending indefinitely in the vertical direction (<xref ref-type="bibr" rid="bib11">Jeffery et al., 2013</xref>). This solution is distinct from the case of a single layer of fields, with no activity above and below them, a situation that does not entail the regular, three-dimensional configurations we are interested in. In <xref ref-type="fig" rid="fig3">Figure 3</xref> we plot the values of the wave vectors obtained with the set of parameters: <italic>vτ</italic><sub><italic>L</italic></sub> = 1, <inline-formula><mml:math id="inf22"><mml:mrow><mml:mi>ν</mml:mi><mml:msub><mml:mi>τ</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>3</mml:mn></mml:mfrac><mml:mi>ν</mml:mi><mml:msub><mml:mi>τ</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, <italic>ρ</italic> = 0.03. Changing these parameters alters the absolute values of the curves but does not affect the qualitative behavior of the solutions to the minimization of the cost function.<fig id="fig3" position="float"><object-id pub-id-type="doi">10.7554/eLife.05913.005</object-id><label>Figure 3.</label><caption><title>Analytical estimation of the optimal grid parameters.</title><p>Results for the grid parameters resulting from the cost function minimization. Left: Optimal grid spacing for face centered cubic (FCC) and hexagonal close packed (HCP) structures and various powers of the respective expressions. Right: Optimal ratio between horizontal spacing and vertical spacing for different powers of the HCP expression. The orange continuous line indicates the theoretical value to obtain a perfect HCP arrangement. All the plots are obtained with parameters: <italic>vτ</italic><sub><italic>L</italic></sub> = 1, <inline-formula><mml:math id="inf23"><mml:mrow><mml:mi>ν</mml:mi><mml:msub><mml:mi>τ</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>3</mml:mn></mml:mfrac><mml:mi>ν</mml:mi><mml:msub><mml:mi>τ</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, <italic>ρ</italic> = 0.03.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.05913.005">http://dx.doi.org/10.7554/eLife.05913.005</ext-link></p></caption><graphic xlink:href="elife-05913-fig3-v2"/></fig></p></sec></sec></sec><sec id="s3" sec-type="results"><title>Results</title><sec id="s3-1"><title>Asymptotic states for individual grids</title><sec id="s3-1-1"><title>Self-organized grids appear to express a mixture of symmetries</title><p>In our simulations the activity of mEC units is progressively shaped over an extended period of time. Starting from an initial random arrangement of connections and a correspondingly heterogeneous distribution of activity, the combined effect of adaptation and synaptic learning leads the units to approach, after a transient reorganization of their firing fields in space, a stable configuration that is the outcome of the self-organization process. Looking at the firing configurations developed by the units in our simulations, one can notice a similarity with the theoretical solutions maximizing the packing density of spheres described above. In <xref ref-type="fig" rid="fig4">Figure 4</xref> we show two typical examples from the units emerging in the model mEC layer in two distinct simulations, each taken after about 15 million time steps of learning time. On the top row the firing rates of the units presents a blobby appearance, with equally sized, spherical fields homogeneously distributed in the volume. Although rate maps resemble those we expect from a regular tiling of the three-dimensional environment, they are not very informative about the overall organization of the fields nor about any symmetry in their spatial distribution. Computing the corresponding autocorrelograms we indeed find that the two units are rather different in this respect, as they express two distinct field configurations. One is in fact presenting an approximately FCC arrangement (<xref ref-type="fig" rid="fig4">Figure 4</xref>, left), while the other is close to an HCP one (<xref ref-type="fig" rid="fig4">Figure 4</xref>, right). Overlaying the axes of symmetry of the two ideal arrangements (green and orange lines) illustrates the differences between the two.<fig id="fig4" position="float"><object-id pub-id-type="doi">10.7554/eLife.05913.004</object-id><label>Figure 4.</label><caption><title>Two illustrative examples of unit activity obtained from simulations.</title><p>Left: Face centered cubic (FCC)-like unit. Right: Hexagonal close packed (HCP)-like unit. Top: Rate maps. Bottom: Autocorrelograms. We plot the central portion of the autocorrelogram comprising the peaks surrounding the origin. Red and blue contours correspond to a correlation value of 0.2 and 0.25, respectively.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.05913.004">http://dx.doi.org/10.7554/eLife.05913.004</ext-link></p></caption><graphic xlink:href="elife-05913-fig4-v2"/></fig></p><p>Thus, self-organization based on synaptic adaptation can have multiple outcomes, leading to equivalently stable solutions. Identical systems, with the same network properties and subject to the same evolution dynamics might approach different asymptotic states, just as an effect of the random initial conditions.</p><p>This fact does not necessarily imply that different solutions can coexist in the same population. The presence of interactions between units might indeed induce a global response to the initial conditions driving all the cells to develop the same symmetric properties. By making use of the measures of order described in the ‘Measure of long-range order’ section in ‘Materials and methods’ and calculating the similarity of each activity pattern either to an FCC or to an HCP, we can assess the presence within a population of mEC units of the different asymptotic arrangements. In <xref ref-type="fig" rid="fig5">Figure 5</xref> we show the distribution of the two scores, again taken after a long learning time (15 million time steps), for units all belonging to the same mEC population. The values of the two scores indicate the presence of both arrangements in the system. If we look at the scores for each unit at a given time (<xref ref-type="fig" rid="fig5">Figure 5</xref>, left), we indeed find that these are not clustered in two groups, each one expressing a homogeneous HCP or FCC arrangement, but instead they cover an entire continuum of scores between the two extremes, expressing all intermediate arrangements.<fig id="fig5" position="float"><object-id pub-id-type="doi">10.7554/eLife.05913.006</object-id><label>Figure 5.</label><caption><title>3D grid units do not converge towards a common arrangement of fields.</title><p>Left: Distribution of face centered cubic (FCC) and hexagonal close packed (HCP) scores in a population of simulated mEC units. The scores span a continuum between a pure FCC arrangement (bottom right corner) and a pure HCP one (top left corner of the figure) and are widely distributed between the two extremes. Right: Analytical cost function for various powers of FCC and HCP as a function of <italic>γ</italic> parameter. Continuous lines indicate the minimum value within each set of solutions and are found to alternate as a global minimum in different ranges of values of <italic>γ</italic>. For small values of the parameter <italic>γ</italic>, instead, the trivial solution <italic>ψ</italic> = 0 is favored. The plot is obtained with: <italic>vτ</italic><sub><italic>L</italic></sub> = 1, <inline-formula><mml:math id="inf24"><mml:mrow><mml:mi>ν</mml:mi><mml:msub><mml:mi>τ</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>3</mml:mn></mml:mfrac><mml:mi>ν</mml:mi><mml:msub><mml:mi>τ</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, <italic>ρ</italic> = 0.03.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.05913.006">http://dx.doi.org/10.7554/eLife.05913.006</ext-link></p></caption><graphic xlink:href="elife-05913-fig5-v2"/></fig></p></sec><sec id="s3-1-2"><title>Which is the most favorable analytical solution?</title><p>This result points to a high degree of independence of each unit and at the same time to a rather weak preference of the system for either of the regular configurations of fields. We can contrast our observations on the asymptotic states approached by the mEC units simulated numerically with the analytic evaluation of the cost function associated with the regular asymptotic states (see the ‘Measure of long-range order’ section in ‘Materials and methods’). The calculations are based on the functional in <xref ref-type="disp-formula" rid="equ14">Equation 14</xref>, comprising two terms, one representing the degree of smoothness of the map, the other the effects of adaptation. Its minimization (adjusting regular solutions to fit with the firing rate adaptation time scale) shows a rather complex interplay between different possible states (<xref ref-type="fig" rid="fig5">Figure 5</xref>, right). First of all, considering FCC and HCP separately, we see how, for both of them, solutions of higher power become successively favored as the value of the <italic>γ</italic> parameter increases, that is, as the weight of the adaptation component becomes increasingly dominant in the evaluation of the cost function. Therefore, the same arrangement of field positions, but with the fields becoming more and more concentrated and peaked, is selected moving rightward on the graph. In parallel, the two configurations, FCC and HCP, compete with each other, and the two are alternating as the optimal solution in different portions of the parameter space. The picture that emerges from this analysis is one of close equivalence of FCC and HCP in terms of optimality. There is no evidence of a regime in which one of the two strongly dominates the other. Instead, the features that are common to the two, like the hexagonal arrangement and the 12 first neighbors, appear to be the relevant ones for the evaluation of the cost function, with the differences appearing when considering higher order features only marginally contributing to its value and therefore generating minuscule quantitative differences between the two.</p><p>Analytical calculations deal with an abstract and simplified formulation of the properties of our network. The conclusion they suggest, however, is supported by our observations from the numerical simulation of the full model. The system does not appear to converge asymptotically to either of the two regular configurations of fields. Although neither FCC- nor HCP-symmetric solutions provide a unique description of the final arrangement of the units, the simulations produce examples of units similar to either of the two optimal packing solutions. The discrepancy between the configurations observed and the symmetric solutions, however, is not due to the emergence of mixtures of the two (like for example in a ABABCAB ordering of the layers), but rather to small deviations of the relative phases between fields of different layers from the optimal ones. Although we tested our model in environments of different size (as discussed in a following section), the model is computationally extremely demanding to run in very large environments, large enough to investigate this sort of mixed ordering. Analytical results show a substantial equivalence of FCC and HCP ordering, thus implying, in large structures, the possibility of multiple switching between the two, without altering the overall optimality of the configuration. Nevertheless, simulations show that this equivalence, even in the case of the small environments we tested (where we could usually observe three or only slightly more layers at the same time), is expressed in intermediate arrangements which are only partially symmetric. It is thus likely that introducing additional layers would just propagate this situation further without leading to the appearance of FCC and HCP mixtures.</p></sec></sec><sec id="s3-2"><title>Time scales for the emergence of local order</title><p>Constructing either an FCC or an HCP arrangement of fields is a rather articulated endeavor that requires assembling a hierarchy of elements of increasing complexity. The three-dimensional structure described by the two arrangements implies the establishment of long-range relationships between the level of activity at distant points of the environment and involves determining the position of a large number of fields at the same time. Both FCC and HCP are described by unitary cells of 13 fields and the difference between the two lies in the different positioning of just three of them with respect to the others. It is evident by looking at <xref ref-type="fig" rid="fig2">Figure 2</xref>, however, that this long-range order is constructed from a set of building blocks that express symmetries and regularities at a local level, involving fewer fields and a smaller set of constraints. Understanding the outcome of the self-organization of grid cells in three dimensions can be thus approached bottom-up, starting from basic features of the representation and then following the learning process up towards their combination into overarching structures.</p><p>As in the two-dimensional case, a description of the grid can start from computing the mean distance between first-neighbor fields and the mean angle formed by triplets of adjacent fields. These two measures involve, respectively, two and three fields at a time and are not informative about correlations extending beyond these boundaries.</p><p>At this level order emerges almost immediately (<xref ref-type="fig" rid="fig6">Figure 6</xref>). The mean angle among neighboring fields (calculated over all the triplets of all the cells of a simulated population) is close to <italic>π</italic>/3 from the very beginning of learning and the real effect of continuing exploration is the reduction of the variability over the course of about 4 million time steps.<fig id="fig6" position="float"><object-id pub-id-type="doi">10.7554/eLife.05913.007</object-id><label>Figure 6.</label><caption><title>Emergence of local regularities in the arrangement of fields.</title><p>Left: Mean angle formed by triplets of fields as a function of learning time (see the ‘Local gridness measure’ section in ‘Materials and methods’ for details on the measure). Right: Mean spacing between fields extracted from the autocorrelograms, for various conditions as a function of learning time.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.05913.007">http://dx.doi.org/10.7554/eLife.05913.007</ext-link></p></caption><graphic xlink:href="elife-05913-fig6-v2"/></fig></p><p>A similar behavior is observed when plotting the value of the mean spacing of the grids in time (calculated from the unit autocorrelograms) (<xref ref-type="fig" rid="fig6">Figure 6</xref>, right: blue line). Also in this case, after a short transient the value stabilizes after around 3–4 million time steps. Our choice of model parameters (and specifically of the adaptation parameter) leads to a spacing of 0.55 × <italic>L</italic>. We run simulations in different conditions to test the sensitivity of this quantity to specific components of the model. We consider the case of having no internal connectivity in mEC, removing any interaction between different mEC units (<xref ref-type="fig" rid="fig6">Figure 6</xref>, right: red line) that are therefore developing grids independently, and the case in which rather than having a single value of the adaptation time course, common to all the units, the population expresses a range of possible values, drawn from a uniform distribution ranging from 0.85 × <italic>b</italic>1 to 1.2 × <italic>b</italic>1, where <italic>b</italic>1 = 0.1 is the value otherwise used (<xref ref-type="fig" rid="fig6">Figure 6</xref>, right: green line). In both cases we see that the time course of the development of a common grid spacing is not affected by the modifications of the standard model. Stabilization is obtained in the same time interval and while removing collateral connections appears to have absolutely no effect, the variability in the adaptation parameter results in a slightly different final value of the spacing (0.5 × <italic>L</italic>).</p><p>These results indicate that the three-dimensional grid develops from the same ingredients of its lower dimensional equivalent. Mean spacing and mean angle are quickly fixed over the entire network almost simultaneously and are the first recognizable signs of the emergence of an ordered structure from the initial random distribution of activity. The equivalence between this process and that observed in a model of two-dimensional grid development is due to the same principles driving self-organization. The presence of an additional dimension does not affect the way in which fields are initially brought by adaptation to homogeneously and regularly cover the entire space.</p></sec><sec id="s3-3"><title>Time scales for the emergence of long-range order</title><p>Using the measure described in the ‘Local gridness measure’ section in ‘Materials and methods’, we can evaluate the difference between the distribution of activity of a unit and a random arrangement of fields. Plotting the average across units of this index, which reflects the decrease of the variance in the angles between triplets, already observed in <xref ref-type="fig" rid="fig6">Figure 6</xref>, we see again (<xref ref-type="fig" rid="fig7">Figure 7</xref>, top left), that after roughly 4 million time steps the system is already arranged in a stable ordered manner, with equilateral triangles among neighboring fields that dominate the activity pattern. This ordering can be generated by the system independently of higher order symmetries, and it provides a first step for further arranging fields in more articulated structures.<fig id="fig7" position="float"><object-id pub-id-type="doi">10.7554/eLife.05913.008</object-id><label>Figure 7.</label><caption><title>Three distinct time courses for the emergence of long-range ordering.</title><p>The panels present the time evolution of the measure of different symmetries in the arrangement of fields. Top row: Fast convergence of neighboring triplets of fields towards equilateral triangles (left) and of group of fields into planes with a hexagonal arrangement (right). Middle row: Slow convergence of the different units in the population towards a common orientation of the layers of fields. Left: Angle between the principal plane expressed by the various units. Right: Angle between fields arranged over mutually aligned planes. Bottom row: No convergence of global, inter-planar order. The measures of similarity with face centered cubic (FCC) and hexagonal close packed (HCP) ordering do not evolve with the extension of the learning time and remain close to intermediate values indicating an even distribution of the values over the population of grid cells. See ‘Materials and methods’ for details on the measures.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.05913.008">http://dx.doi.org/10.7554/eLife.05913.008</ext-link></p></caption><graphic xlink:href="elife-05913-fig7-v2"/></fig></p><p>A second step taken by the system is the coordination of multiple field triplets to arrange them in a hexagonal pattern. This process corresponds to the formation of a grid on the plane, but in three dimensions it involves the creation of not just one hexagon but of multiple superimposed planes each of which contains hexagonally arranged fields. To investigate the structure of the activity on the single layers, we take multiple slices of the autocorrelogram matrix. We take sections passing through the center, with different angles of azimuth and elevation. We then compute the autocorrelogram values on each of these planes, and we compare it with a hexagonal template of equidistant peaks with <italic>π</italic>/3 periodicity. The plane most resembling a hexagonal pattern according to a correlation measure (the ‘best plane’) is selected together with its similarity score. This method provides us with an equivalent of the traditional grid score used to judge the quality of planar grid cells. In <xref ref-type="fig" rid="fig7">Figure 7</xref> (top right) we plot the time evolution of the average over the population of this score. Starting from very low values, indicative of a still unorganized ensemble of fields, the score steadily rises to reach a value of about 0.85 (out of a maximum of 1) after 6 million time steps and then remains stable over the rest of the simulation.</p><p>The previous analysis considers each unit separately and does not provide a measure of the coordination across the population of the formation of the field layering. But the presence of collateral interactions should induce some coordination in the way these layers are arranged in different cells, that is, in the direction along which these best planes align in space. We looked for the dispersion of their orientations, calculating the angles formed by the best planes of different cells (<italic>β</italic>, <xref ref-type="fig" rid="fig7">Figure 7</xref>, middle left), and the angle between the hexagonal grid axis of cells sharing a similar best plane (<italic>ω</italic>, <xref ref-type="fig" rid="fig7">Figure 7</xref>, middle right). We indeed see that collateral interaction tends to align in time the principal layer of different cells, defining a preferred orientation for the global structure of the grid. The emergence of the common alignment of the layers is slower than the formation of the layers themselves. It takes about 12 million time steps of exploration time to significantly reduce the dispersion of the angles (note that <italic>β</italic> is slightly faster, maybe indicating a tendency to first define the layers and then arrange shifts within them).</p><p>Having hexagonal layers tiled upon each other along the same direction still leaves to each cell the degree of freedom of setting the relative phase between pairs of these layers. It is clear at this point that a proper choice of these phases would result in the reproduction of either an FCC arrangement or an HCP arrangement. This higher level in the hierarchy of order for three-dimensional grids, which when attained would provide a completely regular tiling of the volume, does not have a correspondence in the two-dimensional case. It is thus a completely new level of complexity that can be only expressed when producing grids in three dimensions. In the bottom panels of <xref ref-type="fig" rid="fig7">Figure 7</xref> we show the time course of the scores for FCC and HCP similarity (see the ‘Measure of long-range order’ section in ‘Materials and methods’). Their values are almost unchanged over the duration of the simulations and after 30 million time steps, a time largely exceeding that necessary for the other quantities to converge, both of them are still close to 0.5, which reflects the presence in the population of a large distribution of values.</p><p>Our simulations are able to distinguish a hierarchy in the time course leading to the formation of three-dimensional grids. Different levels of complexity appear in the arrangement of fields with different speed. Fast converging quantities like the formation of equilateral triangles of fields and successively of layers of fields with hexagonal symmetry appear first, framing the activity of single units in the network. These initial structures are then modified on a slower time scale to obtain a global coordination among cells. Planes of fields are rotated to align them across the population, generating a common tiling of the fields of different cells that conserve their unique spatial phase. This global ordering is only partial though, as the phases of the units are only partially overlapping with those necessary to reproduce a perfectly regular tiling of the volume (either with an FCC or an HCP). If we exclude the very initial phase of network dynamics, self-organization does not appear to affect these aspects of network activity that therefore remain loosely determined even after a very extended period of time.</p></sec><sec id="s3-4"><title>Volume dependence of the time scales</title><p>The critical question is how would these timescales scale up with the size of the environment. At least for the most rapid self-organizing processes, their very nature, dependent on plasticity in the feed-forward connections, would appear at first sight to require the pairing of each activity field of each unit to the specific configuration of sensory inputs which impinge at the same time on the feed-forward connections, therefore implying times for the formation of the grid that scale up with the number of fields in the volume. A volume of linear size <italic>L</italic> includes roughly <inline-formula><mml:math id="inf25"><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msqrt><mml:mn>2</mml:mn></mml:msqrt><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>L</mml:mi><mml:mo>/</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>3</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula> fields of spacing <italic>a</italic> in either an FCC or HCP arrangement (and <inline-formula><mml:math id="inf26"><mml:mrow><mml:mn>6</mml:mn><mml:msqrt><mml:mn>2</mml:mn></mml:msqrt><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>L</mml:mi><mml:mo>/</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>3</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula> trajectories connecting neighboring fields). A square of side <italic>L</italic> on a plane would include roughly <inline-formula><mml:math id="inf27"><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>/</mml:mo><mml:msqrt><mml:mn>3</mml:mn></mml:msqrt></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>L</mml:mi><mml:mo>/</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula> fields. The emergence of equilateral triangles in 3D appears to require roughly a factor 2 more time than in 2D (<xref ref-type="bibr" rid="bib19">Si et al., 2012</xref>), in approximate agreement with the factor <inline-formula><mml:math id="inf28"><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>/</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msqrt><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>3</mml:mn><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msqrt><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>L</mml:mi><mml:mo>/</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>≃</mml:mo><mml:mn>1.2</mml:mn><mml:mo>×</mml:mo><mml:mn>1.8</mml:mn><mml:mo>≃</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></inline-formula> coming from the above argument. Note that if that were correct, equilateral triangles in an environment roughly four times as large, as can be argued to be the one used in the bat experiments in the Ulanovsky laboratory (<xref ref-type="bibr" rid="bib5">Ginosar et al., 2014</xref>), would emerge in roughly 40–50 hr of continuous flight. Although the developmental maturation of the bat encompasses longer cumulative flying hours, what is likely relevant for structuring the feed-forward connections is time spent flying in the environment of the actual experiment. Not only can the mechanisms leading to grid-like activity only unfold while navigating and not during rest periods, they also appear to require, in our model, the exact configuration of input activity at each location in the environment. Therefore this constraint is likely to put the time scale of grid cell formation well above the feasible time duration of the experiment.</p><p>In fact, however, we find that the time for self-organization lengthens only a little, and clearly sublinearly, with the volume flown by the virtual bat. Given the multiple sub-processes involved in the self-organization of the grid units, we focus on a summary measure, derived from the analytical model: the cost function (<xref ref-type="disp-formula" rid="equ14">Equation 14</xref>). Each of the two terms of the cost function, the kinetic and the adaptation kernel, can be calculated for each model grid unit at each time step of the simulation, and average values can be extracted and fit, for example, with sums of exponential functions. What cannot be calculated from the simulations themselves is the value of the <italic>γ</italic> factor that, in the cost function, would determine the weight of the adaptation kernel with respect to the kinetic term.</p><p>We find that the population-averaged data points for both terms can be well fit by a sum of two exponentials, plus a constant (<xref ref-type="fig" rid="fig8">Figure 8</xref>, inset) and with the same time parameter for the first exponential in each term:<disp-formula id="equ29"><label>(29)</label><mml:math id="m29"><mml:mrow><mml:msub><mml:mi>H</mml:mi><mml:mi>K</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>≃</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mi>v</mml:mi></mml:msub><mml:mtext> exp</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mi>t</mml:mi><mml:mo>/</mml:mo><mml:msubsup><mml:mi>τ</mml:mi><mml:mi>v</mml:mi><mml:mi>S</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>B</mml:mi><mml:mi>v</mml:mi></mml:msub><mml:mtext> exp</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mi>t</mml:mi><mml:mo>/</mml:mo><mml:msubsup><mml:mi>τ</mml:mi><mml:mi>v</mml:mi><mml:mi>L</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mi>K</mml:mi><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula><disp-formula id="equ30"><label>(30)</label><mml:math id="m30"><mml:mrow><mml:msub><mml:mi>H</mml:mi><mml:mi>A</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>≃</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mi>v</mml:mi></mml:msub><mml:mtext> exp</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mi>t</mml:mi><mml:mo>/</mml:mo><mml:msubsup><mml:mi>τ</mml:mi><mml:mi>v</mml:mi><mml:mi>S</mml:mi></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mi>v</mml:mi></mml:msub><mml:mtext> exp</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mi>t</mml:mi><mml:mo>/</mml:mo><mml:msup><mml:mi>τ</mml:mi><mml:mi>M</mml:mi></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>E</mml:mi><mml:mi>v</mml:mi></mml:msub><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula>with <italic>A</italic>, <italic>B</italic>, <italic>C</italic>, <italic>D</italic>, <italic>E</italic> volume-dependent positive fit parameters, and <italic>τ</italic><sup><italic>S</italic>,<italic>M</italic>,<italic>L</italic></sup> short, medium and long relaxation time scales (<italic>K</italic> turns out not to depend on the volume; nor, it seems, does <italic>τ</italic><sup><italic>M</italic></sup>).<fig id="fig8" position="float"><object-id pub-id-type="doi">10.7554/eLife.05913.009</object-id><label>Figure 8.</label><caption><title>Effect of environment volume on grid developmental time.</title><p>Temporal evolution of the cost function calculated for environments of different size. Lines from green to red correspond to environments of increasing size: 1 (green), 1.2, 1.4, 1.44, 1.68 and 1.96 (red) times the basic volume, respectively. With the choice of parameters reported in the discussion, these volumes would range from a 15.625 m<sup>3</sup> room to a 30.625 m<sup>3</sup> room. The inset shows the breakdown of the contribution to the total cost of the kinetic part and of the adaptation part for the cubic environment of size 2.5 × 2.5 × 2.5 m. Dots correspond to data points, lines to a fit. The constant of the kernel term, which varies with the volume, is not included for clarity.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.05913.009">http://dx.doi.org/10.7554/eLife.05913.009</ext-link></p></caption><graphic xlink:href="elife-05913-fig8-v2"/></fig></p><p>The short term relaxation is therefore a joint decrease of both terms, while later the adaptation term rises, whereas the kinetic term continues to decrease. An empirical ansatz can be defined for <italic>γ</italic> as the largest value that still keeps the sum <italic>H</italic><sub><italic>K</italic></sub>(<italic>t</italic>) + <italic>γH</italic><sub><italic>A</italic></sub>(<italic>t</italic>) monotonically decreasing. With this ansatz, we plot the estimate of the cost function (without the <italic>E</italic><sub><italic>v</italic></sub> term, for clarity) for varying volume sizes, where we have multiplied either one or two of the three linear dimensions by either 1.2 or 1.4, obtaining volumes larger than the standard one by factors 1.2, 1.4, 1.44, 1.68 and 1.96. We can see from <xref ref-type="fig" rid="fig8">Figure 8</xref> that the relaxation of this estimated cost function is mainly determined by the most rapid exponential terms, and is virtually complete by 3–4 million time steps, with a limited volume dependence. Consequently, apart from the slight prolongation of the initial transient, the time evolution of our measure for volumes of different size appears to be quite similar.</p><p>These results suggest that the time required for the complex dynamics of grid development depends only weakly on the number of fields that have to be arranged in a orderly manner in the volume. The initial relaxation, which accomplishes most of the rearrangement and probably centers on adjusting the angles between triplets of fields (cp. <xref ref-type="fig" rid="fig7">Figure 7</xref>, top left and <xref ref-type="fig" rid="fig8">Figure 8</xref>), occurs in a time that increases sublinearly with system size. This is followed by some bouncing back of the adaptation term, which may have to do with the finer adjustment of most field distances, leading to planar hexagonal grids (see <xref ref-type="fig" rid="fig6">Figures 6</xref> and <xref ref-type="fig" rid="fig7">7</xref>, top right), with a time constant which can be taken to be independent of the volume. It is protracted later by continued but minor smoothing of the fields, now in place on the best planes, concurrent, if collateral interactions are included, with the adjustment of the planes with respect to each other (<xref ref-type="fig" rid="fig7">Figure 7</xref>, middle), which extends over longer times. We do note that we have observed considerable variability in the degree of smoothness of the individual fields obtained at the end of the simulation, with a tendency for the larger volumes to require longer time and end up with rougher fields. Given the variability from simulation to simulation, however, it remains to be determined whether this trend is robust and whether it points at a significant bifurcation in trajectories of grid development.</p></sec></sec><sec id="s4" sec-type="discussion"><title>Discussion</title><p>How are these results relevant to predict the grid configuration expressed in 3D, and that can be tested in a flying bat? Our model points towards a hierarchy of timescales, associated with the emergence of periodical spatial activity of increasing complexity. To establish a relation between our results and a real bat, it is necessary to specify the actual values of the temporal and spatial parameters of our model, to obtain a time scale for the development of the grids that we can then compare with experimental findings.</p><p>If we take time steps of size Δ<italic>t</italic> = 10 <italic>ms</italic> and an average bat velocity of <italic>v</italic> = 1 <italic>m/s</italic>, the small environment used in most of our simulations will correspond to a cubic room of size <italic>L</italic> = 2.5 <italic>m</italic>. Then, with this choice of parameters, grids are formed with a field spacing of 2.5 <italic>m</italic> × 0.55 ≈ 1.4 <italic>m</italic> and an interlayer distance of <inline-formula><mml:math id="inf29"><mml:mrow><mml:mn>2.5</mml:mn><mml:mi>m</mml:mi><mml:mo>×</mml:mo><mml:mn>0.55</mml:mn><mml:mo>×</mml:mo><mml:mfrac><mml:mrow><mml:msqrt><mml:mn>6</mml:mn></mml:msqrt></mml:mrow><mml:mn>3</mml:mn></mml:mfrac><mml:mo>≈</mml:mo><mml:mn>1.1</mml:mn><mml:mi>m</mml:mi></mml:mrow></mml:math></inline-formula>. The time scale of grid formation can be calculated considering that 1 million simulation time steps correspond to 10,000 s or nearly 3 hr. Our model then predicts, in an environment the size of ours, the presence of (i) triplets of fields forming roughly equilateral triangles in ≈10–12 hr of continuous flight, (ii) hexagons in ≈15–18 hr, and finally (iii) different units that achieve a common orientation after ≈30–35 hr. These time scales do not seem very different from those predicted by the same model for the development of grids in a two-dimensional environment of similar linear size (relative to the grid spacing). Figure 6 in <xref ref-type="bibr" rid="bib19">Si et al. (2012</xref>) indicates a time scale of about 20,000 s, or 5–6 hr, for the development of gridness in 2D. At the same time, this moderate increase in grid formation time might make it comparable to the flight time available for spatial learning during bat experiments. In these conditions, even the weak, sub-linear dependence of time scales with volume, that we do observe, may be sufficient to determine a switch between the possibility of forming regular structures and leaving them beyond reach.</p><p>A regular tiling of the environment (either in the form of an FCC or of an HCP lattice) is a different story, even though it would be the optimal arrangement from an information-theoretic perspective (<xref ref-type="bibr" rid="bib16">Mathis et al., 2014</xref>). The total simulation time would correspond to a maximum of ≈80–90 hr of continuous bat flight in the (2.5 <italic>m</italic>)<sup>3</sup> volume. This time is just a lower bound for the time necessary to form a regular tiling of the environment, and likely a loose one, as our simulations do not seem to be converging towards one of them.</p><p>These considerations suggest that bats may form a partially regular 3D tiling of the environment at most once, and then possibly only if constrained to fly for a prolonged time in a rather small cage, while a completely regular, crystalline tiling of space seems to be hardly in the range of time available to real bats.</p><p>In conclusion, the presence of an additional dimension does not seem to preclude the appearance of some orderly arrangement of the fields in mEC units of bats. Nevertheless, this order might express only a partial set of the full spectrum of potential three-dimensional symmetry properties. It might be still sufficient to distinguish the activity of these cells from a random multi-peaked pattern, but it would place it at a substantial distance from a perfectly regular pattern, too. In our model this distance varies across a population of cells: some of them show only small deviations from perfect symmetry. We thus cannot exclude the possibility of finding some of these extreme cases in real animals. At the same time, the vast majority of simulated grid cells are very far from a perfectly regular arrangement and while the number of units actually found in the tails of the distribution of scores might be strongly dependent on some specific factors of the development of grid cells, the bulk of grid-like but imperfect cells can be regarded as a robust aspect of our model, and might extend to very different situations of 3D grid cell development, possibly including other species experiencing three-dimensional navigation.</p></sec><sec id="s5" sec-type="materials|methods"><title>Materials and methods</title><sec id="s5-1"><title>Local gridness measure</title><p>The triangular tile is the minimal structure associated with regular volume tessellations. The two properties defining any regular triangle are the length of the side and the internal angle. Therefore, to characterize the local structure of the grid pattern in an individual unit we extract these two properties from the spikes it produces. Firstly, from our three-dimensional rate maps we generate a representative number of spike pairs through a Poisson process to construct the distribution of distances. Typically, this distribution is highly multi-peaked, where the first peak corresponds to distances between intra-field spikes, the second peak between spikes belonging to neighboring fields, and subsequent peaks between spikes in non-adjacent fields. Since the length of the side of the tiling triangle in a regular pattern would correspond to the location of the second peak, we define a range of distances around this peak as a filter condition to declare spikes belonging to neighboring fields. The limits of this range were defined by the surrounding troughs, if they exist, or fixed to 0.5 <italic>d</italic> and 1.4 <italic>d</italic>, if they do not, where <italic>d</italic> is the distance corresponding to the second peak, declared as the grid distance of the unit. As a control condition, we generate a distribution of pseudo-spikes from reshuffling spike–cell combinations and randomly reassigning spikes to different units, thus removing the field structure of the activity of each cell. Therefore, distances between pseudo-spikes are unimodally distributed. Secondly, triplets of spikes were putatively classified as belonging to neighboring fields based on distance filtering in the previous range, and the three internal angles determined. These three angles were pooled together and accumulated in an overall angular distribution. The distribution of angles so obtained for the spiking activity and the control condition were different and their ratio was used to characterize the angle subtended in the triangular pattern. Typically (in the asymptotical state), this ratio was unimodal and distributed asymmetrically around a peak. We defined the characteristic angle as the median of the above-chance distribution (ratio values above unity indicate an above-chance condition or, in other words, angles more frequently obtained than randomly) and the significance of the angle as the maximum of the ratio distribution.</p></sec><sec id="s5-2"><title>Measure of long-range order</title><p>FCC and HCP differences in the configuration of fields generate distinct symmetry properties for the two arrangements. These symmetries are reflected in the autocorrelograms that can be extracted from them. In the same way as the autocorrelogram of a hexagonal grid is a hexagonal grid, calculating the autocorrelogram of FCC (using function 20) just reproduces the same configuration (<xref ref-type="fig" rid="fig2">Figure 2</xref>, bottom left) of fields, with six symmetric pairs of equivalent peaks surrounding the central one. Indeed the symmetries of the structure are such that one can find four planes passing through the origin which contain peaks arranged in a hexagonal way; these planes form angles of 72° and are all equivalent. The case is different for HCP, where the central symmetry is missing. In this case the autocorrelogram extracted from <xref ref-type="disp-formula" rid="equ25">Equation 25</xref> does not reproduce the original form of the function. In <xref ref-type="fig" rid="fig2">Figure 2</xref>, bottom right, one can see that the autocorrelogram presents nine pairs of peaks around the central one. But in this case these peaks are not all the same. The HCP structure is again periodical for translations along a plane, generating six peaks of height 1, like those of FCC (<xref ref-type="fig" rid="fig2">Figure 2</xref>, purple peaks). As the structure is translated out of this preferred plane, the ABAB arrangement of the HCP layers is such that there are no translations that reproduce the exact same configuration of fields, in the autocorrelogram. The six peaks above the central one (<xref ref-type="fig" rid="fig2">Figure 2</xref>, orange peaks) are indeed half-peaks, corresponding to an overlap of only half (six out of 12) of the peaks of the basic unit. Therefore, although one can identify seven planes with hexagonally arranged peaks on this autocorrelogram, they are not all equivalent to those in FCC. Only one of them contains all the peaks of height 1 and forms an angle of 72° with the other six, which include half-peaks and form an angle of 56° between them. We can then use different measures to quantify the degree of similarity of a unit activity to the FCC and HCP prototypical field arrangements. One measure is based on the autocorrelogram. From this, we first identify the best plane, the one which yields the highest grid score, measured here as the value of the planar autocorrelogram at the origin, that is, the planar autocorrelation over all the slices passing through the origin. Once the best plane has been identified, we use the fact that the FCC has three more planes with hexagonal symmetry, at ∼72° from the best plane and between one another. HCP instead has six of them, again at ∼72° from the best plane, but at ∼56° between them. We then take the slice scores, that is, the planar autocorrelation values on any one slice. We take all the slices at an angle of ∼72° from the best plane and sum the scores of the best triplet of slices with ∼72° of separation (<italic>ζ</italic><sub>2 − 4</sub>). We then exclude them and take a second triplet of slices again with a ∼72° distance from one another and a distance of ∼56° from the first triplet (<italic>ζ</italic><sub>5 − 7</sub>). These two numbers tell us about the number of different planes with hexagonal symmetry that can be built from our autocorrelograms. Both scores run from −3 to 3, as they are the sum of three correlations. We expect <italic>ζ</italic><sub>2 − 4</sub> to be high for both FCC and HCP arrangements, and its value should be considered as an indicator of the general quality of the grid. <italic>ζ</italic><sub>5 − 7</sub> instead should be high only for those grids presenting an HCP type of arrangement, but again its value might be affected by the quality of the grid. We thus define a score for the degree of FCC similarity as:<disp-formula id="equ31"><label>(31)</label><mml:math id="m31"><mml:mrow><mml:msub><mml:mi>χ</mml:mi><mml:mrow><mml:mi>F</mml:mi><mml:mi>C</mml:mi><mml:mi>C</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>ζ</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mo>−</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>ζ</mml:mi><mml:mrow><mml:mn>5</mml:mn><mml:mo>−</mml:mo><mml:mn>7</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>/</mml:mo><mml:msub><mml:mi>ζ</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mo>−</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>that should be close to 1 in the presence of FCC, and to 0 in the HCP case.</p><p>On the other hand, HCP is characterized by the repetition of the same field positions every two layers, while FCC has a periodicity of three layers. Then another way to characterize the grids is to look for similarities between layers. Since the best plane we calculated indicates the direction of stacking of layers in the HCP (along its normal vector), we can go back to the firing rate map, take slices along this direction (that is, slices with the same best plane orientation) and calculate the correlation between planes separated by a two-layer distance (2 × <italic>λ</italic><sub><italic>z</italic></sub>):<disp-formula id="equ32"><label>(32)</label><mml:math id="m32"><mml:mrow><mml:msub><mml:mi>χ</mml:mi><mml:mrow><mml:mi>H</mml:mi><mml:mi>C</mml:mi><mml:mi>P</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi><mml:mi>o</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>×</mml:mo><mml:msub><mml:mi>λ</mml:mi><mml:mi>z</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>Contrary to the previous score, this one should be close to 1 when HCP is expressed, and to 0 when FCC is.</p></sec><sec id="s5-3"><title>Cost function expression for <italic>n</italic> = 2</title><p>Here we give an example of the expression for the cost function obtained for n = 2.<disp-formula id="equ33"><label>(33)</label><mml:math id="m33"><mml:mrow><mml:mi>H</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msubsup><mml:mi>ψ</mml:mi><mml:mn>2</mml:mn><mml:mrow><mml:mi>F</mml:mi><mml:mi>C</mml:mi><mml:mi>C</mml:mi></mml:mrow></mml:msubsup><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>71</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mi>k</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mrow><mml:mn>162</mml:mn></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:mi>γ</mml:mi><mml:mo>×</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>648</mml:mn><mml:mo>×</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>256</mml:mn><mml:mrow><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>k</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>2</mml:mn><mml:mi>k</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mn>6</mml:mn><mml:mo>×</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:msqrt><mml:mrow><mml:mn>2</mml:mn><mml:mo>/</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msqrt><mml:mi>k</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>2</mml:mn><mml:mi>k</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>/</mml:mo><mml:msqrt><mml:mn>3</mml:mn></mml:msqrt></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula><disp-formula id="equ34"><label>(34)</label><mml:math id="m34"><mml:mrow><mml:mi>H</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>ψ</mml:mi><mml:mn>2</mml:mn><mml:mrow><mml:mi>H</mml:mi><mml:mi>C</mml:mi><mml:mi>P</mml:mi></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>3045</mml:mn><mml:mo>×</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:mn>1881</mml:mn><mml:mo>×</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mi>z</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mrow><mml:mn>2601</mml:mn></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:mi>γ</mml:mi><mml:mo>×</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>3468</mml:mn></mml:mrow></mml:mfrac><mml:mo>×</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>54</mml:mn><mml:mrow><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:msub><mml:mi>k</mml:mi><mml:mi>z</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mn>1160</mml:mn><mml:mrow><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mn>1920</mml:mn><mml:mrow><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>z</mml:mi></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mn>36</mml:mn><mml:mo>×</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mn>2</mml:mn><mml:msub><mml:mi>k</mml:mi><mml:mi>z</mml:mi></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mn>2</mml:mn><mml:mo>×</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:msub><mml:mi>k</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mn>48</mml:mn><mml:mo>×</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:msub><mml:mi>k</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>z</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mn>9</mml:mn><mml:mo>×</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:msub><mml:mi>k</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mn>2</mml:mn><mml:msub><mml:mi>k</mml:mi><mml:mi>z</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mn>200</mml:mn><mml:mo>×</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msqrt><mml:mn>3</mml:mn></mml:msqrt><mml:msub><mml:mi>k</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mn>36</mml:mn><mml:mo>×</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msqrt><mml:mn>3</mml:mn></mml:msqrt><mml:msub><mml:mi>k</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mn>2</mml:mn><mml:msub><mml:mi>k</mml:mi><mml:mi>z</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>where <italic>k</italic> is the only parameter for spacing in FCC and <italic>k</italic><sub><italic>xy</italic></sub>, <italic>k</italic><sub><italic>z</italic></sub> are the two spacings of HCP, along the horizontal and vertical plane, respectively.</p></sec></sec></body><back><ack id="ack"><title>Acknowledgements</title><p>This work partially was supported by EU FET grant GRIDMAP. Discussions with the GRIDMAP collaboration, with its reviewers, with Andreas Herz and particularly with Nachum Ulanovsky and members of his laboratory are gratefully acknowledged.</p></ack><sec id="s6" sec-type="additional-information"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="conflict" id="conf1"><p>The authors declare that no competing interests exist.</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>FS, Conception and design, Acquisition of data, Analysis and interpretation of data, Drafting or revising the article</p></fn><fn fn-type="con" id="con2"><p>AT, Conception and design, Analysis and interpretation of data, Drafting or revising the article</p></fn></fn-group></sec><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Andersen</surname><given-names>R</given-names></name><name><surname>Buneo</surname><given-names>C</given-names></name></person-group><year>2002</year><article-title>Intentional maps in posterior parietal cortex</article-title><source>Annual Review of Neuroscience</source><volume>25</volume><fpage>189</fpage><lpage>220</lpage><pub-id pub-id-type="doi">10.1146/annurev.neuro.25.112701.142922</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Burt de Perera</surname><given-names>T</given-names></name><name><surname>Holbrook</surname><given-names>RI</given-names></name></person-group><year>2012</year><article-title>Three-dimensional spatial representation in freely swimming fish</article-title><source>Cognitive Processing</source><volume>13</volume><supplement>Suppl 1</supplement><fpage>S107</fpage><lpage>S111</lpage><pub-id pub-id-type="doi">10.1007/s10339-012-0473-9</pub-id></element-citation></ref><ref id="bib2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dacke</surname><given-names>M</given-names></name><name><surname>Srinivasan</surname><given-names>M</given-names></name></person-group><year>2007</year><article-title>Honeybee navigation: distance estimation in the third dimension</article-title><source>The Journal of Experimental Biology</source><volume>210</volume><fpage>845</fpage><lpage>853</lpage><pub-id pub-id-type="doi">10.1242/jeb.002089</pub-id></element-citation></ref><ref id="bib4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Finkelstein</surname><given-names>A</given-names></name><name><surname>Derdikman</surname><given-names>D</given-names></name><name><surname>Rubin</surname><given-names>A</given-names></name><name><surname>Foerster</surname><given-names>JN</given-names></name><name><surname>Las</surname><given-names>L</given-names></name><name><surname>Ulanovsky</surname><given-names>N</given-names></name></person-group><year>2014</year><article-title>Three-dimensional head-direction coding in the bat brain</article-title><source>Nature</source><volume>517</volume><fpage>159</fpage><pub-id pub-id-type="doi">10.1038/nature14031</pub-id></element-citation></ref><ref id="bib5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ginosar</surname><given-names>G</given-names></name><name><surname>Finkelstein</surname><given-names>A</given-names></name><name><surname>Las</surname><given-names>L</given-names></name><name><surname>Ulanovsky</surname><given-names>N</given-names></name></person-group><year>2014</year><article-title>In search of 3-D grid cells in flying bats</article-title><source>In: 9th FENS Forum of Neuroscience, Milan, Italy, 5-9 July 2014</source><comment>Abstract: FENS-2107</comment></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hayman</surname><given-names>R</given-names></name><name><surname>Verriotis</surname><given-names>MA</given-names></name><name><surname>Jovalekic</surname><given-names>A</given-names></name><name><surname>Fenton</surname><given-names>AA</given-names></name><name><surname>Jeffery</surname><given-names>KJ</given-names></name></person-group><year>2011</year><article-title>Anisotropic encoding of three-dimensional space by place cells and grid cells</article-title><source>Nature Neuroscience</source><volume>14</volume><fpage>1182</fpage><lpage>1188</lpage><pub-id pub-id-type="doi">10.1038/nn.2892</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Healy</surname><given-names>S</given-names></name><name><surname>de Kort</surname><given-names>S</given-names></name><name><surname>Clayton</surname><given-names>N</given-names></name></person-group><year>2005</year><article-title>The hippocampus, spatial memory and food hoarding: a puzzle revisited</article-title><source>Trends in Ecology &amp; Evolution</source><volume>20</volume><fpage>17</fpage><lpage>22</lpage><pub-id pub-id-type="doi">10.1016/j.tree.2004.10.006</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Indovina</surname><given-names>I</given-names></name><name><surname>Maffei</surname><given-names>V</given-names></name><name><surname>Pauwels</surname><given-names>K</given-names></name><name><surname>Macaluso</surname><given-names>E</given-names></name><name><surname>Orban</surname><given-names>GA</given-names></name><name><surname>Lacquaniti</surname><given-names>F</given-names></name></person-group><year>2013</year><article-title>Simulated self-motion in a visual gravity field: sensitivity to vertical and horizontal heading in the human brain</article-title><source>Neuroimage</source><volume>71</volume><fpage>114</fpage><lpage>124</lpage><pub-id pub-id-type="doi">10.1016/j.neuroimage.2013.01.005</pub-id></element-citation></ref><ref id="bib9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jacobs</surname><given-names>J</given-names></name><name><surname>Kahana</surname><given-names>M</given-names></name><name><surname>Ekstrom</surname><given-names>A</given-names></name><name><surname>Mollison</surname><given-names>MV</given-names></name><name><surname>Fried</surname><given-names>I</given-names></name></person-group><year>2010</year><article-title>A sense of direction in human entorhinal cortex</article-title><source>Proceedings of the National Academy of Sciences of USA</source><volume>107</volume><fpage>6487</fpage><lpage>6492</lpage><pub-id pub-id-type="doi">10.1073/pnas.0911213107</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jacobs</surname><given-names>J</given-names></name><name><surname>Weidemann</surname><given-names>C</given-names></name><name><surname>Miller</surname><given-names>J</given-names></name><name><surname>Solway</surname><given-names>A</given-names></name><name><surname>Burke</surname><given-names>J</given-names></name><name><surname>Wei</surname><given-names>X</given-names></name><name><surname>Suthana</surname><given-names>N</given-names></name><name><surname>Sperling</surname><given-names>M</given-names></name><name><surname>Sharan</surname><given-names>A</given-names></name><name><surname>Fried</surname><given-names>I</given-names></name><name><surname>Kahana</surname><given-names>MJ</given-names></name></person-group><year>2013</year><article-title>Direct recordings of grid-like neuronal activity in human spatial navigation</article-title><source>Nature Neuroscience</source><volume>16</volume><fpage>1188</fpage><lpage>1190</lpage><pub-id pub-id-type="doi">10.1038/nn.3466</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jeffery</surname><given-names>K</given-names></name><name><surname>Jovalekic</surname><given-names>A</given-names></name><name><surname>Verriotis</surname><given-names>M</given-names></name><name><surname>Hayman</surname><given-names>R</given-names></name></person-group><year>2013</year><article-title>Navigating in a three-dimensional world</article-title><source>The Behavioral and Brain Sciences</source><volume>36</volume><fpage>523</fpage><lpage>543</lpage><pub-id pub-id-type="doi">10.1017/S0140525X12002476</pub-id></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Killian</surname><given-names>N</given-names></name><name><surname>Jutras</surname><given-names>MJ</given-names></name><name><surname>Buffalo</surname><given-names>EA</given-names></name></person-group><year>2012</year><article-title>A map of visual space in the primate entorhinal cortex</article-title><source>Nature</source><volume>491</volume><fpage>761</fpage><lpage>764</lpage><pub-id pub-id-type="doi">10.1038/nature11587</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Knierim</surname><given-names>JJ</given-names></name><name><surname>McNaughton</surname><given-names>BL</given-names></name><name><surname>Poe</surname><given-names>GR</given-names></name></person-group><year>2000</year><article-title>Three-dimensional spatial selectivity of hippocampal neurons during space flight</article-title><source>Nature Neuroscience</source><volume>3</volume><fpage>209</fpage><lpage>210</lpage><pub-id pub-id-type="doi">10.1038/72910</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kropff</surname><given-names>E</given-names></name><name><surname>Treves</surname><given-names>A</given-names></name></person-group><year>2008</year><article-title>The emergence of grid cells: Intelligent design or just adaptation?</article-title><source>Hippocampus</source><volume>18</volume><fpage>1256</fpage><lpage>1269</lpage><pub-id pub-id-type="doi">10.1002/hipo.20520</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Langston</surname><given-names>RF</given-names></name><name><surname>Ainge</surname><given-names>JA</given-names></name><name><surname>Couey</surname><given-names>JJ</given-names></name><name><surname>Canto</surname><given-names>CB</given-names></name><name><surname>Bjerknes</surname><given-names>TL</given-names></name><name><surname>Witter</surname><given-names>MP</given-names></name><name><surname>Moser</surname><given-names>EI</given-names></name><name><surname>Moser</surname><given-names>MB</given-names></name></person-group><year>2010</year><article-title>Development of the spatial representation system in the rat</article-title><source>Science</source><volume>328</volume><fpage>1576</fpage><lpage>1580</lpage><pub-id pub-id-type="doi">10.1126/science.1188210</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mathis</surname><given-names>A</given-names></name><name><surname>Stemmler</surname><given-names>M</given-names></name><name><surname>Herz</surname><given-names>A</given-names></name></person-group><year>2014</year><article-title>Probable nature of higher-dimensional symmetries underlying mammalian grid-cell activity pattern</article-title><source>arXiv: 1411.2136</source><comment><ext-link ext-link-type="uri" xlink:href="http://arxiv.org/abs/1411.2136">http://arxiv.org/abs/1411.2136</ext-link></comment></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sereno</surname><given-names>A</given-names></name><name><surname>Lehky</surname><given-names>S</given-names></name></person-group><year>2011</year><article-title>Population coding of visual space: comparison of spatial representations in dorsal and ventral pathways</article-title><source>Frontiers in Computational Neuroscience</source><volume>4</volume><fpage>159</fpage><pub-id pub-id-type="doi">10.3389/fncom.2010.00159</pub-id></element-citation></ref><ref id="bib19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Si</surname><given-names>B</given-names></name><name><surname>Kropff</surname><given-names>E</given-names></name><name><surname>Treves</surname><given-names>A</given-names></name></person-group><year>2012</year><article-title>Grid alignment in entorhinal cortex</article-title><source>Biological Cybernetics</source><volume>106</volume><fpage>483</fpage><lpage>506</lpage><pub-id pub-id-type="doi">10.1007/s00422-012-0513-7</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Si</surname><given-names>B</given-names></name><name><surname>Treves</surname><given-names>A</given-names></name></person-group><year>2013</year><article-title>A model for the differentiation between grid and conjunctive units in medial entorhinal cortex</article-title><source>Hippocampus</source><volume>23</volume><fpage>1410</fpage><lpage>1424</lpage><pub-id pub-id-type="doi">10.1002/hipo.22194</pub-id></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stella</surname><given-names>F</given-names></name><name><surname>Si</surname><given-names>B</given-names></name><name><surname>Kropff</surname><given-names>E</given-names></name><name><surname>Treves</surname><given-names>A</given-names></name></person-group><year>2013</year><article-title>Grid cells on the ball</article-title><source>Journal of Statistical Mechanics</source><volume>2013</volume><fpage>P03013</fpage><pub-id pub-id-type="doi">10.1088/1742-5468/2013/03/P03013</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Taube</surname><given-names>J</given-names></name><name><surname>Shinder</surname><given-names>M</given-names></name></person-group><year>2013</year><article-title>On the nature of three-dimensional encoding in the cognitive map: Commentary on Hayman, Verriotis, Jovalekic, Fenton, and Jeffery</article-title><source>Hippocampus</source><volume>23</volume><fpage>14</fpage><lpage>21</lpage><pub-id pub-id-type="doi">10.1002/hipo.22074</pub-id></element-citation></ref><ref id="bib22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Thurley</surname><given-names>K</given-names></name><name><surname>Henke</surname><given-names>J</given-names></name><name><surname>Hermann</surname><given-names>J</given-names></name><name><surname>Ludwig</surname><given-names>B</given-names></name><name><surname>Tatarau</surname><given-names>C</given-names></name><name><surname>Watzig</surname><given-names>A</given-names></name><name><surname>Herz</surname><given-names>AV</given-names></name><name><surname>Grothe</surname><given-names>B</given-names></name><name><surname>Leibold</surname><given-names>C</given-names></name></person-group><year>2014</year><article-title>Mongolian gerbils learn to navigate in complex virtual spaces</article-title><source>Behavioural Brain Research</source><volume>266</volume><fpage>161</fpage><lpage>168</lpage><pub-id pub-id-type="doi">10.1016/j.bbr.2014.03.007</pub-id></element-citation></ref><ref id="bib23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ulanovsky</surname><given-names>N</given-names></name><name><surname>Moss</surname><given-names>C</given-names></name></person-group><year>2011</year><article-title>Dynamics of hippocampal spatial representation in echolocating bats</article-title><source>Hippocampus</source><volume>21</volume><fpage>150</fpage><lpage>161</lpage><pub-id pub-id-type="doi">10.1002/hipo.20731</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Urdapilleta</surname><given-names>E</given-names></name><name><surname>Troiani</surname><given-names>F</given-names></name><name><surname>Stella</surname><given-names>F</given-names></name><name><surname>Treves</surname><given-names>A</given-names></name></person-group><year>2015</year><source>Journal of the Royal Society Interface</source><volume>12</volume><comment>20141214</comment><pub-id pub-id-type="doi">10.1098/rsif.2014.1214</pub-id></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wills</surname><given-names>TJ</given-names></name><name><surname>Cacucci</surname><given-names>F</given-names></name><name><surname>Burgess</surname><given-names>N</given-names></name><name><surname>O'Keefe</surname><given-names>J</given-names></name></person-group><year>2010</year><article-title>Development of the hippocampal cognitive map in preweanling rats</article-title><source>Science</source><volume>328</volume><fpage>1573</fpage><lpage>1576</lpage><pub-id pub-id-type="doi">10.1126/science.1188224</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wu</surname><given-names>LQ</given-names></name><name><surname>Dickman</surname><given-names>JD</given-names></name></person-group><year>2012</year><article-title>Neural correlates of a magnetic sense</article-title><source>Science</source><volume>336</volume><fpage>1054</fpage><lpage>1057</lpage><pub-id pub-id-type="doi">10.1126/science.1216567</pub-id></element-citation></ref><ref id="bib27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yartsev</surname><given-names>M</given-names></name><name><surname>Ulanovsky</surname><given-names>N</given-names></name></person-group><year>2013</year><article-title>Representation of three-dimensional space in the hippocampus of flying bats</article-title><source>Science</source><volume>340</volume><fpage>367</fpage><lpage>372</lpage><pub-id pub-id-type="doi">10.1126/science.1235338</pub-id></element-citation></ref><ref id="bib28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yartsev</surname><given-names>M</given-names></name><name><surname>Witter</surname><given-names>M</given-names></name><name><surname>Ulanovsky</surname><given-names>N</given-names></name></person-group><year>2011</year><article-title>Grid cells without theta oscillations in the entorhinal cortex of bats</article-title><source>Nature</source><volume>479</volume><fpage>103</fpage><lpage>107</lpage><pub-id pub-id-type="doi">10.1038/nature10583</pub-id></element-citation></ref><ref id="bib29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhang</surname><given-names>K</given-names></name></person-group><year>1996</year><article-title>Representation of spatial orientation by the intrinsic dynamics of the head-direction cell ensemble: a theory</article-title><source>The Journal of Neuroscience</source><volume>16</volume><fpage>2112</fpage><lpage>2126</lpage></element-citation></ref><ref id="bib30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zilli</surname><given-names>E</given-names></name></person-group><year>2012</year><article-title>Models of grid cell spatial firing published 2005-2011</article-title><source>Frontiers in Neural Circuits</source><volume>6</volume><fpage>16</fpage><pub-id pub-id-type="doi">10.3389/fncir.2012.00016</pub-id></element-citation></ref></ref-list></back><sub-article article-type="article-commentary" id="SA1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.05913.010</article-id><title-group><article-title>Decision letter</article-title></title-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Goldman</surname><given-names>Mark S</given-names></name><role>Reviewing editor</role><aff><institution>University of California at Davis</institution>, <country>United States</country></aff></contrib></contrib-group></front-stub><body><boxed-text><p>eLife posts the editorial decision letter and author response on a selection of the published articles (subject to the approval of the authors). An edited version of the letter sent to the authors after peer review is shown, indicating the substantive concerns or comments; minor concerns are not usually shown. Reviewers have the opportunity to discuss the decision before the letter is sent (see <ext-link ext-link-type="uri" xlink:href="http://elifesciences.org/review-process">review process</ext-link>). Similarly, the author response typically shows only responses to the major concerns raised by the reviewers.</p></boxed-text><p>Thank you for sending your work entitled “The Self-Organization of Grid Cells in 3D” for consideration at <italic>eLife</italic>. Your article has been favorably evaluated by Eve Marder (Senior editor), a Mark Goldman (guest Reviewing editor), and two reviewers.</p><p>The Reviewing editor and the reviewers discussed their comments before we reached this decision, and the Reviewing editor has assembled the following comments to help you prepare a revised submission:</p><p>In the interesting manuscript “The self-organization of grid cells in 3D”, Stella and Treves provide the first predictions for the development through ontogeny of 3D firing patterns in 3D grid cells. The authors pursue a two-pronged approach in which they simulate a set of weekly selective 3D place cells with feedforward plastic synapses onto a population of entering grid cells and demonstrate the formation of 3D grid fields, with the grid spacing being controlled by the time-constant of firing-rate adaptation. Additionally they employ an effective field approach to analytically predict low-energy configurations of the population firing rate maps.</p><p>Surprisingly, their model predicts that an adult network of 3D grid cells should comprise of a heterogeneous mix of both perfect (lattice like) 3D grids but also much-distorted grids. They show that, as the network is learning, already at the very beginning there appear triplets of spatial blobs of activity that are angled at 60-degrees. Only much later, with extensive training, do these triplets “crystallize”, and the network gradually develops optimal-packing structures such as the hexagonal close pack (HCP) lattice or face centered cubic (FCC) lattice - as well as neurons which exhibit a mixture of HCP/FCC. This study is very interesting in that it provides direct predictions on how and why 3D grid cells should develop during ontogeny; there is very little data on this and so it is quite interesting that the authors have managed to make headway on this topic through careful theoretical analysis, examining the space of possibilities ahead of experiments. The model also explains how and why a high heterogeneity of 3D grid cells is expected - from cells exhibiting only triplets of activity-blobs angled at 60-degrees (but without any large-scale lattice organization), through random mixtures of HCP and FCC lattices, and ending with perfectly crystallized HCP and FCC lattices. This study will be of great interest to many neuroscientists, system biologists and physicists.</p><p>Comments:</p><p>1) In the Abstract (and in many other places in the paper): The focus seems to be on predictions for bat experiments. Why do the authors single out the bat as the only relevant animal model for 3D grids? The predictions in the paper are very general, and may hold also for monkeys, dolphins, cats, or humans that also move through 3D space. The focus on bats is too narrow, and should be broadened throughout.</p><p>2) In the subsection “The network”, the authors mention that sigma_p = 0.05L. Does changing the sigma_p of the place cells affect any of the final properties of the grids, and/or their developmental time course?</p><p>3) In the end of the subsection headed “HCP symmetry”, it is unclear why the authors write that small k<sub>z</sub> is equivalent to columns spreading over the z-axis (height) entire room. An alternative possibility is having only one layer of <italic>spherical</italic> blobs in the XY plane, without any additional layers repeating in the z-dimension. Are these options equivalent in terms of the minimization of the cost function?</p><p>4) Results section, subsection headed “Which is the most favorable analytical solution?”: The authors focus on HCP and FCC, but it is unclear here to which degree do they see also other solutions, besides HCP and FCC, e.g. random order of layers: ABCABABACBCBA… which is an arrangement that pack 3D space just as well as FCC or HCP but does not have any large-scale structure along the z-axis. Did you observe such neurons in your simulations?</p><p>5) In the Discussion: The impression one gets from the end of the Discussion is that almost no cells at all are expected to exhibit perfect FCC or HCP - but in fact, according to <xref ref-type="fig" rid="fig4">Figure 4</xref> (left), it seems that at least some of the grid cells are actually expected to develop a perfect FCC or a perfect HCP; is this correct? These cells might be a minority, but at least some are expected to develop FCC or FCP. So I think it's worthwhile to write it here explicitly, because right now the discussions seems to suggest the opposite.</p><p>6) The model does not allow for plasticity between grid cells. The spatially localized structure for grid cell firing is essentially built in by hand through hand tuning, ahead of time, the lateral synapses. Note that this is only a suggestion for a future avenue of research and does not need to be addressed for the manuscript to be deemed acceptable. The progress made on addressing this difficult theoretical problem is sufficient for publication already.</p><p>7) The Results section could be written to be in a somewhat more accessible form for the general, less mathematical reader.</p></body></sub-article><sub-article article-type="reply" id="SA2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.05913.011</article-id><title-group><article-title>Author response</article-title></title-group></front-stub><body><p><italic>1) In the Abstract (and in many other places in the paper): The focus seems to be on predictions for bat experiments. Why do the authors single out the bat as the only relevant animal model for 3D grids? The predictions in the paper are very general, and may hold also for monkeys, dolphins, cats, or humans that also move through 3D space. The focus on bats is too narrow, and should be broadened throughout</italic>.</p><p>We agree, with the qualification that the prevalence of an allocentric coding of the animal’s own position in space has yet to be established for most mammalian orders. We would not want our model to be seen as taking a stand, for example, on the controversial issue of place vs. spatial view codes in monkeys. To avoid that, while still pointing at the potential generality of the conclusions, we have added, in the Abstract, “… bats, or perhaps dolphins…”, and, as a second sentence of the Introduction, “how does it code for space extending in three dimensions?”</p><p>Still in the first paragraph, we have expanded a sentence to read: “… and it provides an indication possibly valid also for other animals living and moving extensively in three dimensions, like for example dolphins, monkeys and even nonmammalian species”. And, in the second: “the form that grid cells will exhibit in higher dimensionality (currently tested in flying bats; Jeffery, 2013) is still not clear.” We have also concluded the Introduction with the sentence: “We use bats as our reference, as it is the species currently available for experiments during roughly homogeneous navigation along the three dimensions of physical space.”</p><p>In the Discussion, instead of just asking “expressed by a flying bat?” we now ask “expressed in 3D, and that can be tested in a flying bat?” and see below (point 5) for the sentence inserted at the very end of the Discussion.</p><p><italic>2) In the subsection “The network”, the authors mention that sigma_p = 0.05L. Does changing the sigma_p of the place cells affect any of the final properties of the grids, and/or their developmental time course?</italic></p><p>That paragraph has now been extended to clarify this point:</p><p>“Place field centers are homogeneously distributed in the volume (consistently with the experimental data presented in Yartsev, 2013). […] the properties of the developing grid fields depend on the time scale of adaptation and not on the size of the place fields.”</p><p><italic>3) In the end of the subsection “HCP symmetry”: It is unclear why the authors write that small k</italic><sub><italic>z</italic></sub> <italic>is equivalent to columns spreading over the z-axis (height) entire room. An alternative possibility is having only one layer of</italic> spherical <italic>blobs in the XY plane</italic>, <italic>without any additional layers repeating in the z-dimension. Are these options equivalent in terms of the minimization of the cost function?</italic></p><p>We have hopefully clarified this point by expanding the relevant paragraph:</p><p>“… of the inter-layer spacing (and also the wavelength of the activity modulation along the zaxis), this value […] with no activity above and below them, a situation that does not entail the regular, three dimensional configurations we are interested in.”</p><p><italic>4) Results section, subsection headed “Which is the most favorable analytical solution?”: The authors focus on HCP and FCC, but it is unclear here to which degree do they see also other solutions, besides HCP and FCC, e.g. random order of layers: ABCABABACBCBA… which is an arrangement that pack 3D space just as well as FCC or HCP but does not have any large-scale structure along the z-axis. Did you observe such neurons in your simulations?</italic></p><p>We have added this discussion at the end of section A of the Results, on the most favourable analytical solution:</p><p>“The discrepancy between the configurations observed and the symmetric solutions […] additional layers would just propagate further this situation without leading to the appearance of FCC and HCP mixtures.”</p><p><italic>5) In the Discussion: The impression one gets from the end of the Discussion is that almost no cells at all are expected to exhibit perfect FCC or HCP - but in fact, according to</italic> <xref ref-type="fig" rid="fig4"><italic>Figure 4</italic></xref> <italic>(left), it seems that at least some of the grid cells are actually expected to develop a perfect FCC or a perfect HCP; is this correct? These cells might be a minority, but at least some are expected to develop FCC or FCP. So I think it's worthwhile to write it here explicitly, because right now the discussions seems to suggest the opposite</italic>.</p><p>We have added a passage to clarify this point at the end of the Discussion:</p><p>“In our model this distance varies across a population of cells […] possibly including other species experiencing three-dimensional navigation.</p><p><italic>6) The model does not allow for plasticity between grid cells. The spatially localized structure for grid cell firing is essentially built in by hand through hand tuning, ahead of time, the lateral synapses. Note that this is only a suggestion for a future avenue of research and does not need to be addressed for the manuscript to be deemed acceptable. The progress made on addressing this difficult theoretical problem is sufficient for publication already</italic>.</p><p>In the section on “Collateral Weights”, we have now clarified in the very beginning that “the appearance of fields in the output layer of the model is fully independent of the presence of collateral connections. Instead, their basic function…”</p><p>7) The Results section could be written to be in a somewhat more accessible form for the general, less mathematical reader.</p><p>We have made some adjustments to the Results and Methods section, for example in the first paragraph of the Methods, we have added for clarity the sentence: “The path the animal performs is generated as a correlated random walk in which the direction of movement at any time step depends on the previous one”.</p><p>We have also added some clarifications in the “Volume Dependence” subsection of the Results, where the issue of dimensional scaling is discussed.</p><p>We have introduced a new figure (<xref ref-type="fig" rid="fig1">Figure 1</xref>) to provide a pictorial explanation of the model and of the main idea conveyed in the Results section: the model does indeed produce three-dimensional grids but this process requires an extensive amount of time. We also extended <xref ref-type="fig" rid="fig2">Figure 2</xref> to include an additional visualization of the FCC and HCP arrangements of fields from a different point of view. The panels in the second row now highlight the different tiling of the layers in the two structures.</p><p>==========</p></body></sub-article></article>