<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.1 20151215//EN"  "JATS-archivearticle1.dtd"><article article-type="research-article" dtd-version="1.1" xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn pub-type="epub" publication-format="electronic">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">66747</article-id><article-id pub-id-type="doi">10.7554/eLife.66747</article-id><article-categories><subj-group subj-group-type="display-channel"><subject>Research Advance</subject></subj-group><subj-group subj-group-type="heading"><subject>Computational and Systems Biology</subject></subj-group><subj-group subj-group-type="heading"><subject>Evolutionary Biology</subject></subj-group></article-categories><title-group><article-title>Mapping single-cell atlases throughout Metazoa unravels cell type evolution</article-title></title-group><contrib-group><contrib contrib-type="author" id="author-146178"><name><surname>Tarashansky</surname><given-names>Alexander J</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" equal-contrib="yes" id="author-223115"><name><surname>Musser</surname><given-names>Jacob M</given-names></name><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="equal-contrib1">†</xref><xref ref-type="other" rid="fund3"/><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" equal-contrib="yes" id="author-223116"><name><surname>Khariton</surname><given-names>Margarita</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="equal-contrib1">†</xref><xref ref-type="fn" rid="con3"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-105965"><name><surname>Li</surname><given-names>Pengyang</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="con4"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-62167"><name><surname>Arendt</surname><given-names>Detlev</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0001-7833-050X</contrib-id><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="other" rid="fund3"/><xref ref-type="fn" rid="con5"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-169216"><name><surname>Quake</surname><given-names>Stephen R</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="aff" rid="aff5">5</xref><xref ref-type="fn" rid="con6"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" corresp="yes" id="author-105963"><name><surname>Wang</surname><given-names>Bo</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0001-8880-1432</contrib-id><email>wangbo@stanford.edu</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff6">6</xref><xref ref-type="other" rid="fund1"/><xref ref-type="other" rid="fund2"/><xref ref-type="fn" rid="con7"/><xref ref-type="fn" rid="conf1"/></contrib><aff id="aff1"><label>1</label><institution>Department of Bioengineering, Stanford University</institution><addr-line><named-content content-type="city">Stanford</named-content></addr-line><country>United States</country></aff><aff id="aff2"><label>2</label><institution>European Molecular Biology Laboratory, Developmental Biology Unit</institution><addr-line><named-content content-type="city">Heidelberg</named-content></addr-line><country>Germany</country></aff><aff id="aff3"><label>3</label><institution>Centre for Organismal Studies, University of Heidelberg</institution><addr-line><named-content content-type="city">Heidelberg</named-content></addr-line><country>Germany</country></aff><aff id="aff4"><label>4</label><institution>Department of Applied Physics, Stanford University</institution><addr-line><named-content content-type="city">Stanford</named-content></addr-line><country>United States</country></aff><aff id="aff5"><label>5</label><institution>Chan Zuckerberg Biohub</institution><addr-line><named-content content-type="city">San Francisco</named-content></addr-line><country>United States</country></aff><aff id="aff6"><label>6</label><institution>Department of Developmental Biology, Stanford University School of Medicine</institution><addr-line><named-content content-type="city">Stanford</named-content></addr-line><country>United States</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Shalek</surname><given-names>Alex K</given-names></name><role>Reviewing Editor</role><aff><institution>Broad Institute of MIT and Harvard</institution><country>United States</country></aff></contrib><contrib contrib-type="senior_editor"><name><surname>Barkai</surname><given-names>Naama</given-names></name><role>Senior Editor</role><aff><institution>Weizmann Institute of Science</institution><country>Israel</country></aff></contrib></contrib-group><author-notes><fn fn-type="con" id="equal-contrib1"><label>†</label><p>These authors contributed equally to this work</p></fn></author-notes><pub-date date-type="publication" publication-format="electronic"><day>04</day><month>05</month><year>2021</year></pub-date><pub-date pub-type="collection"><year>2021</year></pub-date><volume>10</volume><elocation-id>e66747</elocation-id><history><date date-type="received" iso-8601-date="2021-01-26"><day>26</day><month>01</month><year>2021</year></date><date date-type="accepted" iso-8601-date="2021-04-30"><day>30</day><month>04</month><year>2021</year></date></history><permissions><copyright-statement>© 2021, Tarashansky et al</copyright-statement><copyright-year>2021</copyright-year><copyright-holder>Tarashansky et al</copyright-holder><ali:free_to_read/><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><ali:license_ref>http://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-66747-v2.pdf"/><related-article ext-link-type="doi" id="ra1" related-article-type="article-reference" xlink:href="10.7554/eLife.48994"/><abstract><p>Comparing single-cell transcriptomic atlases from diverse organisms can elucidate the origins of cellular diversity and assist the annotation of new cell atlases. Yet, comparison between distant relatives is hindered by complex gene histories and diversifications in expression programs. Previously, we introduced the self-assembling manifold (SAM) algorithm to robustly reconstruct manifolds from single-cell data (Tarashansky et al., 2019). Here, we build on SAM to map cell atlas manifolds across species. This new method, SAMap, identifies homologous cell types with shared expression programs across distant species within phyla, even in complex examples where homologous tissues emerge from distinct germ layers. SAMap also finds many genes with more similar expression to their paralogs than their orthologs, suggesting paralog substitution may be more common in evolution than previously appreciated. Lastly, comparing species across animal phyla, spanning sponge to mouse, reveals ancient contractile and stem cell families, which may have arisen early in animal evolution.</p></abstract><kwd-group kwd-group-type="author-keywords"><kwd>single-cell atlas</kwd><kwd>cell type evolution</kwd><kwd>gene expression program</kwd><kwd>contractile cells</kwd><kwd>stem cells</kwd><kwd>gene orthology</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research organism</title><kwd>Mouse</kwd><kwd>Planarian</kwd><kwd><italic>Xenopus</italic></kwd><kwd>Zebrafish</kwd><kwd>Other</kwd></kwd-group><funding-group><award-group id="fund1"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000997</institution-id><institution>Arnold and Mabel Beckman Foundation</institution></institution-wrap></funding-source><award-id>Beckman Young Investigator Award</award-id><principal-award-recipient><name><surname>Wang</surname><given-names>Bo</given-names></name></principal-award-recipient></award-group><award-group id="fund2"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000002</institution-id><institution>National Institutes of Health</institution></institution-wrap></funding-source><award-id>1R35GM138061</award-id><principal-award-recipient><name><surname>Wang</surname><given-names>Bo</given-names></name></principal-award-recipient></award-group><award-group id="fund3"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000780</institution-id><institution>European Commission</institution></institution-wrap></funding-source><award-id>788921</award-id><principal-award-recipient><name><surname>Musser</surname><given-names>Jacob M</given-names></name><name><surname>Arendt</surname><given-names>Detlev</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>Mapping single-cell atlases throughout Metazoa systematically characterizes cell type diversity and the evolution of their associated gene expression programs.</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>There is much ongoing success in producing single-cell transcriptomic atlases to investigate the cell type diversity within individual organisms (<xref ref-type="bibr" rid="bib48">Regev et al., 2017</xref>). With the growing diversity of cell atlases across the tree of life (<xref ref-type="bibr" rid="bib9">Briggs et al., 2018</xref>; <xref ref-type="bibr" rid="bib12">Cao et al., 2019</xref>; <xref ref-type="bibr" rid="bib18">Fincher et al., 2018</xref>; <xref ref-type="bibr" rid="bib23">Hu et al., 2020</xref>; <xref ref-type="bibr" rid="bib38">Musser et al., 2019</xref>; <xref ref-type="bibr" rid="bib44">Plass et al., 2018</xref>; <xref ref-type="bibr" rid="bib54">Siebert et al., 2019</xref>; <xref ref-type="bibr" rid="bib66">Wagner et al., 2018</xref>), a new frontier is emerging: the use of cross-species cell type comparisons to unravel the origins of cellular diversity and uncover species-specific cellular innovations (<xref ref-type="bibr" rid="bib3">Arendt et al., 2019</xref>; <xref ref-type="bibr" rid="bib52">Shafer, 2019</xref>). Further, these comparisons promise to accelerate cell type annotation and discovery by transferring knowledge from well-studied model organisms to under-characterized animals.</p><p>However, recent comparative single-cell analyses are mostly limited to species within the same phylum (<xref ref-type="bibr" rid="bib5">Baron et al., 2016</xref>; <xref ref-type="bibr" rid="bib20">Geirsdottir et al., 2019</xref>; <xref ref-type="bibr" rid="bib51">Sebé-Pedrós et al., 2018</xref>; <xref ref-type="bibr" rid="bib63">Tosches et al., 2018</xref>). Comparisons across longer evolutionary distances and across phyla are challenging for two major reasons. First, gene regulatory programs diversify during evolution, diminishing the similarities in cell-type-specific gene expression patterns. Second, complex gene evolutionary history causes distantly related organisms to share few one-to-one gene orthologs (<xref ref-type="bibr" rid="bib40">Nehrt et al., 2011</xref>), which are often relied upon for comparative studies (<xref ref-type="bibr" rid="bib9">Briggs et al., 2018</xref>; <xref ref-type="bibr" rid="bib52">Shafer, 2019</xref>). This effect is compounded by the growing evidence suggesting that paralogs may be more functionally similar than orthologs across species, due to differential gain (neo-functionalization), loss (non-functionalization), or partitioning (sub-functionalization) events among paralogs (<xref ref-type="bibr" rid="bib40">Nehrt et al., 2011</xref>; <xref ref-type="bibr" rid="bib46">Prince and Pickett, 2002</xref>; <xref ref-type="bibr" rid="bib56">Stamboulian et al., 2020</xref>; <xref ref-type="bibr" rid="bib58">Studer and Robinson-Rechavi, 2009</xref>).</p><p>Here, we present the Self-Assembling Manifold mapping (SAMap) algorithm to enable mapping single-cell transcriptomes between phylogenetically remote species. SAMap relaxes the constraints imposed by sequence orthology, using expression similarity between mapped cells to infer the relative contributions of homologous genes, which in turn refines the cell type mapping. In addition, SAMap uses a graph-based data integration technique to identify reciprocally connected cell types across species with greater robustness than previous single-cell data integration methods (<xref ref-type="bibr" rid="bib21">Haghverdi et al., 2018</xref>; <xref ref-type="bibr" rid="bib22">Hie et al., 2019</xref>; <xref ref-type="bibr" rid="bib45">Polański et al., 2019</xref>; <xref ref-type="bibr" rid="bib57">Stuart et al., 2019</xref>).</p><p>Using SAMap, we compared seven whole-body cell atlases from species spanning animal phylogeny, which have divergent transcriptomes and complex molecular homologies (<xref ref-type="fig" rid="fig1">Figure 1A–B</xref> and <xref ref-type="supplementary-material" rid="supp1">Supplementary file 1</xref>). We began with well-characterized cell types in developing frog and zebrafish embryos. We found broad concordance between transcriptomic signatures and ontogenetic relationships, which validated our mapping results, yet also detected striking examples of homologous cell types emerging from different germ layers. We next extended the comparison to animals from the same phylum but with highly divergent body plans, using a planarian flatworm and a parasitic blood fluke, and found one-to-one homologies even between cell subtypes. Comparing all seven species from sponge to mouse, we identified densely interconnected cell type families broadly shared across animals, including contractile and stem cells, along with their respective gene expression programs. Lastly, we noticed that homologous cell types often exhibit differential expression of orthologs and similar expression of paralogs, suggesting that the substitution and swapping of paralogs in cell types may be more common in evolution than previously appreciated. Overall, our study represents an important step toward analyzing the evolutionary origins of specialized cell types and their associated gene expression programs in animals.</p><fig-group><fig id="fig1" position="float"><label>Figure 1.</label><caption><title>SAMap addresses challenges in mapping cell atlases of distantly related species.</title><p>(<bold>A</bold>) Schematic showing the phylogenetic relationships among seven species analyzed. (<bold>B</bold>) Challenges in mapping single-cell transcriptomes. Gene duplications cause large numbers of homologs per gene, determined by reciprocal BLAST (cut-off: E-value &lt;10<sup>−6</sup>), and frequent gene losses and the acquisition of new genes result in large fractions of transcriptomes lacking homology, which limits the amount of information comparable across species. (<bold>C</bold>) SAMap workflow. Homologous gene pairs initially weighted by protein sequence similarity are used to align the manifolds, low dimensional representations of the cell atlases. Gene-gene correlations calculated from the aligned manifolds are used to update the edge weights in the bipartite graph, which are then used to improve manifold alignment. (<bold>D</bold>) Mutual nearest neighborhoods improve the detection of cross-species mutual nearest neighbors by connecting cells that target one other’s within-species neighborhoods. (<bold>E</bold>) Convergence of SAMap is evaluated by the root mean square error (RMSE) of the alignment scores between mapped clusters in adjacent iterations for all 21 pairwise comparisons of the seven species.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-66747-fig1-v2.tif"/></fig><fig id="fig1s1" position="float" specific-use="child-fig"><label>Figure 1—figure supplement 1.</label><caption><title>Scalability of SAMap.</title><p>The runtime (<bold>A</bold>) and memory usage (<bold>B</bold>) of all mappings performed in this study are plotted versus the total number of cells from both datasets. For this study, SAMap was run on a standard desktop computer running Ubuntu 18.04, with an 8-core i7 Intel processor and 64 Gb of RAM.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-66747-fig1-figsupp1-v2.tif"/></fig></fig-group></sec><sec id="s2" sec-type="results"><title>Results</title><sec id="s2-1"><title>The SAMap algorithm</title><p>SAMap iterates between two modules. The first module constructs a gene-gene bipartite graph with cross-species edges connecting homologous gene pairs, initially weighted by protein sequence similarity (<xref ref-type="fig" rid="fig1">Figure 1C</xref>). In the second module, SAMap uses the gene-gene graph to project the two single-cell transcriptomic datasets into a joint, lower-dimensional manifold representation, from which each cell’s mutual cross-species neighbors are linked to stitch the cell atlases together (<xref ref-type="fig" rid="fig1">Figure 1D</xref>). Then, using the joint manifold, the expression correlations between homologous genes are computed and used to reweight the edges in the gene-gene homology graph in order to relax SAMap’s initial dependence on sequence similarity. The new homology graph is used as input to the subsequent iteration of SAMap, and the algorithm continues until convergence, defined as when the cross-species mapping does not significantly change between iterations (<xref ref-type="fig" rid="fig1">Figure 1E</xref>).</p><p>This algorithm overcomes several challenges inherent to mapping single-cell transcriptomes between distantly related species. First, complex gene evolutionary history often results in many-to-many homologies with convoluted functional relationships (<xref ref-type="bibr" rid="bib9">Briggs et al., 2018</xref>; <xref ref-type="bibr" rid="bib40">Nehrt et al., 2011</xref>). SAMap accounts for this by using the full homology graph to project each dataset into both its own and its partner’s respective principal component (PC) spaces, constructed by the SAM algorithm, which we previously developed to robustly and sensitively identify cell types (<xref ref-type="bibr" rid="bib60">Tarashansky et al., 2019</xref>). The resulting within- and cross-species projections are concatenated to form the joint space. For the cross-species projections, we translate each species’ features into those of its partner, with the expression for individual genes imputed as the weighted average of their homologs specified in the gene-gene bipartite graph. Iteratively refining the homology graph to only include positively correlated gene pairs prunes the many-to-many homologies to only include genes that are expressed in the same mapped cell types.</p><p>Second, frequent gene losses and the acquisitions of new genes result in many cell type gene expression signatures being species-specific, limiting the amount of information that is comparable across species. Restricting the analysis of each dataset to only include genes that are shared across species would result in a decreased ability to resolve cell types and subtypes with many species-specific gene signatures. SAMap solves this problem by constructing the joint space through the concatenation of within- and cross-species projections, thus encoding all genes from both species.</p><p>Third, the evolution of expression programs gradually diminishes the similarity between homologous cell types. To account for this effect, SAMap links cell types across species while tolerating their differences. Cells are mapped by calculating each of their <italic>k</italic> mutual nearest cross-species neighbors in the combined projection. To establish more robust mutual connectivity, we integrate information from each cell’s local, within-species neighborhood (<xref ref-type="fig" rid="fig1">Figure 1D</xref>), overcoming the inherent stochasticity of cross-species correlations. Two cells are thus defined as mutual nearest cross-species neighbors when their respective neighborhoods have mutual connectivity. It is important to note that the magnitude of connections is not directly calculated from their expression similarity, allowing cell types with diverged expression profiles to be tightly linked if they are among each other’s closest cross-species neighbors.</p><p>Lastly, SAMap is robust to technical batch effects between datasets that are collected through different platforms. For instance, we have succeeded in running SAMap on datasets containing hundreds of thousands of cells that were collected with different single-cell platforms, including 10X genomics, Drop-Seq, SmartSeq, and MARS-Seq. SAMap runtimes were typically less than an hour on an average desktop computer for the largest dataset we tested (<xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>). Further, SAMap overcomes potential memory issues when running on large datasets by chunking its computationally intensive operations into smaller blocks, saturating the memory usage with respect to the number of cells (<xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1B</xref>).</p></sec><sec id="s2-2"><title>Homologous cell types emerging from distinct germ layers in frog and zebrafish</title><p>We first applied SAMap to the <italic>Xenopus</italic> and zebrafish atlases, which both encompass embryogenesis until early organogenesis (<xref ref-type="bibr" rid="bib9">Briggs et al., 2018</xref>; <xref ref-type="bibr" rid="bib66">Wagner et al., 2018</xref>). Previous analysis linked cell types between these two organisms by matching ontogeny, thereby providing a reference for comparison. SAMap produced a combined manifold with a high degree of cross-species alignment while maintaining high resolution for distinguishing cell types in each species (<xref ref-type="fig" rid="fig2">Figure 2A</xref>). We measured the mapping strength between cell types by calculating an alignment score (edge width in <xref ref-type="fig" rid="fig2">Figure 2B</xref> and color map in <xref ref-type="fig" rid="fig2">Figure 2C</xref>), defined as the average number of mutual nearest cross-species neighbors of each cell relative to the maximum possible number of neighbors.</p><fig-group><fig id="fig2" position="float"><label>Figure 2.</label><caption><title>SAMap successfully maps <italic>D. rerio</italic> and <italic>X. tropicalis</italic> atlases.</title><p>(<bold>A</bold>) UMAP projection of the combined zebrafish (yellow) and <italic>Xenopus</italic> (blue) manifolds, with example cell types circled. (<bold>B</bold>) Sankey plot summarizing the cell type mappings. Edges with alignment score &lt;0.1 are omitted. Edges that connect developmentally distinct secretory cell types are highlighted in black, with connections across germ layers highlighted in red. (<bold>C</bold>) Heatmaps of alignment scores between developmental time points for ionocyte, forebrain/midbrain, placodal, and neural crest lineages. X-axis: <italic>Xenopus</italic>. Y-axis: zebrafish. (<bold>D</bold>) Expressions of orthologous gene pairs linked by SAMap are overlaid on the combined UMAP projection. Expressing cells are color-coded by species, with those connected across species colored cyan. Cells with no expression are shown in gray. The mapped secretory cell types are highlighted with circles. (<bold>E</bold>) SAMap alignment scores compared to those of benchmarking methods using one-to-one vertebrate orthologs as input. Each dot represents a cell type pair supported by ontogeny annotations.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-66747-fig2-v2.tif"/></fig><fig id="fig2s1" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 1.</label><caption><title>Existing methods failed to map <italic>D. rerio</italic> and <italic>X. tropicalis</italic> atlases.</title><p>(<bold>A</bold>) UMAP projections of the integration results from SAMap using the full homology graph, compared to LIGER, BBKNN, Scanorama, Seurat, Harmony, and SAMap using 1–1 orthologs. For fair comparisons, all methods were run on the <italic>D. rerio</italic> and <italic>X. torpicalis</italic> atlases subsampled to approximately 15,000 cells to satisfy the computational constraints of Seurat and LIGER. (<bold>B</bold>) Histograms of alignment scores between individual cells.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-66747-fig2-figsupp1-v2.tif"/></fig></fig-group><p>SAMap revealed broad agreement between transcriptomic similarity and developmental ontogeny, linking 26 out of 27 expected pairs based on previous annotations (<xref ref-type="fig" rid="fig2">Figure 2B</xref> and <xref ref-type="supplementary-material" rid="supp2">Supplementary file 2</xref>; <xref ref-type="bibr" rid="bib9">Briggs et al., 2018</xref>). The only exception is the embryonic kidney (pronephric duct/mesenchyme), potentially indicating that their gene expression programs have significantly diverged. In addition, SAMap succeeded in drawing parallels between the development of homologous cell types and matched time points along several cell lineages (<xref ref-type="fig" rid="fig2">Figure 2C</xref>). While the concordance was consistent across cell types, we noticed that the exact progression of developmental timing can vary, suggesting that SAMap can quantify heterochrony with cell type resolution.</p><p>SAMap also linked a group of secretory cell types that differ in their developmental origin, some even arising from different germ layers (highlighted edges in <xref ref-type="fig" rid="fig2">Figure 2B</xref>). Within ectoderm, frog cement gland cells map to zebrafish <italic>muc5ac<sup>+</sup></italic> secretory epidermal cells, and frog small secretory cells (SSCs) map to zebrafish <italic>pvalb8<sup>+</sup></italic> mucous cells (<xref ref-type="bibr" rid="bib26">Janicke et al., 2010</xref>). Across germ layers, SSCs also map weakly to zebrafish endodermal cells, and frog ectodermal hatching gland maps to zebrafish mesodermal hatching gland. These cell types are linked through a large set of genes, including proteins involved in vesicular protein trafficking and several conserved transcription factors (TFs) such as <italic>myb</italic>, <italic>foxa1, xbp1</italic>, and <italic>klf17</italic> (<xref ref-type="fig" rid="fig2">Figure 2D</xref>), which all have documented functions in controlling the differentiation of secretory cell types (<xref ref-type="bibr" rid="bib6">Bennett et al., 2007</xref>; <xref ref-type="bibr" rid="bib13">Dubaissi et al., 2014</xref>; <xref ref-type="bibr" rid="bib42">Pan et al., 2014</xref>). For example, <italic>klf17</italic> is expressed in zebrafish and frog hatching glands, and plays essential roles in regulating gland cell specification in both species (<xref ref-type="bibr" rid="bib29">Kurauchi et al., 2010</xref>; <xref ref-type="bibr" rid="bib59">Suzuki et al., 2019</xref>). Together, the conserved cell type specification programs (<xref ref-type="bibr" rid="bib17">Erwin and Davidson, 2009</xref>) between developmentally distinct secretory cells support the notion that they may be transcriptionally and evolutionarily related despite having different developmental origins (<xref ref-type="bibr" rid="bib2">Arendt et al., 2016</xref>).</p><p>To benchmark the performance of SAMap, we used eggNOG (<xref ref-type="bibr" rid="bib25">Huerta-Cepas et al., 2019</xref>) to define one-to-one vertebrate orthologs between zebrafish and frog and fed these gene pairs as input to several broadly used single-cell data integration methods, Seurat (<xref ref-type="bibr" rid="bib57">Stuart et al., 2019</xref>), LIGER (<xref ref-type="bibr" rid="bib69">Welch et al., 2019</xref>), Harmony (<xref ref-type="bibr" rid="bib28">Korsunsky et al., 2019</xref>), Scanorama (<xref ref-type="bibr" rid="bib22">Hie et al., 2019</xref>), and BBKNN (<xref ref-type="bibr" rid="bib45">Polański et al., 2019</xref>). We found that they failed to map the two atlases, yielding minimal alignment between them (<xref ref-type="fig" rid="fig2">Figure 2E</xref> and <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>). We also compared the results when restricting SAMap to using the one-to-one orthologs instead of the full homology graph. Even when removing the many-to-many gene homologies and the iterative refinement of the homology graph, we identified similar, albeit weaker, cell type mappings. This suggests that, at least for the frog and zebrafish comparison, SAMap’s performance is owed in large part to its robust, atlas stitching approach.</p><p>Finally, to test if SAMap is robust to incomplete cell type atlases, we downsampled the frog and zebrafish data by systematically removing individual cell types. We found that cell types whose homologous partners were removed mapped weakly to closely related cell types, some of which were already present in the original mapping. For example, optic cells from both species were also connected to eye primordium, frog skeletal muscles to zebrafish presomitic mesoderm, and frog hindbrain to zebrafish forebrain/midbrain (<xref ref-type="supplementary-material" rid="supp3">Supplementary file 3</xref>). We observed several new mapping pairs, but their alignment scores were all barely above the detection threshold of SAMap. Moreover, most of these edges were mapped between cell types with similar developmental origins, with the only exception being the zebrafish neural crest mapped to the frog otic placode in the absence of frog neural crest cells. Examining the genes that support this mapping revealed that both cell types express s<italic>ox9</italic> and <italic>sox10</italic>, two TFs previously implicated to form a conserved gene regulatory circuit common to otic/neural crest cells (<xref ref-type="bibr" rid="bib7">Betancur et al., 2011</xref>). Taken together, these results suggest that SAMap is more sensitive in linking homologous cell types compared to other existing methods, exhibits high robustness when applied to incomplete datasets, and yields mapping results that are well supported by conserved gene expression programs.</p></sec><sec id="s2-3"><title>Paralog substitutions are prevalent between homologous cell types in frog and zebrafish</title><p>The key benefit of using the full homology graph is to enable the systematic identification of gene paralogs that exhibit greater similarity in expression across species than their corresponding orthologs. These events are expected to arise as the result of gene duplications followed by diversification of the resulting in-paralogs (<xref ref-type="bibr" rid="bib58">Studer and Robinson-Rechavi, 2009</xref>). In an alternative scenario, genetic compensation by transcriptional adaptation, where loss-of-function mutations are balanced by upregulation of related genes with similar sequences (<xref ref-type="bibr" rid="bib16">El-Brolosy et al., 2019</xref>), could also result in this signature.</p><p>In total, SAMap selected 8286 vertebrate orthologs and 7093 paralogs, as enumerated by eggNOG, for manifold alignment. Paralogs were identified as non-orthologous genes that map to the same eggNOG orthology group ancestral to Vertebrata. Among these, 565 genes have markedly higher expression correlations (correlation difference &gt;0.3) with their paralogs than their orthologs (see <xref ref-type="fig" rid="fig3">Figure 3A</xref> for examples), and 209 of them have orthologs that are either completely absent or lowly expressed with no cell-type specificity (<xref ref-type="supplementary-material" rid="supp4">Supplementary file 4</xref>). We term these events as ‘paralog substitutions’, as the orthologs may have lost or changed their functional roles at some point and were compensated for by their paralogs. Substituting paralogs were identified in most cells types with some (e.g. dorsal organizer) exhibiting higher rates than others (<xref ref-type="fig" rid="fig3">Figure 3B</xref>), suggesting uneven diversification rates of paralogs across cell types. SAMap also linked an additional 297 homologous pairs previously unannotated by orthology or paralogy, but which exhibit sequence similarity and high expression correlations (&gt;0.5 Pearson correlation). These likely represent unannotated orthologs/paralogs or isofunctional, distantly related homologs (<xref ref-type="bibr" rid="bib19">Gabaldón and Koonin, 2013</xref>).</p><fig-group><fig id="fig3" position="float"><label>Figure 3.</label><caption><title>SAMap reveals prevalent paralog substitutions in frog and zebrafish.</title><p>(<bold>A</bold>) Expression of orthologous (top) and paralogous (bottom) gene pairs overlaid on the combined UMAP projection. Expressing cells are color-coded by species, with those that are connected across species colored cyan. Cells with no expression are shown in gray. Paralogs are ordered by the evolutionary time when they are inferred to have duplicated. (<bold>B</bold>) Paralog substitution scores of all cell types. The substitution score counts the number of substituting paralogs that are differentially expressed in a particular cell type while normalizing for the number of differentially expressed genes in a cell type and the number of paralogs of a gene (see Materials and methods). (<bold>C</bold>) The percentage of paralogs from each phylogenetic age that were substituted for orthologs in frog or zebrafish lineages.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-66747-fig3-v2.tif"/></fig><fig id="fig3s1" position="float" specific-use="child-fig"><label>Figure 3—figure supplement 1.</label><caption><title>Paralog substitution analysis yields similar results using the SAMap manifold constructed from one-to-one orthologs.</title><p>Comparison of substitution rates for different paralog ages (<bold>A</bold>) and cell type substitution scores (<bold>B</bold>) calculated from the original frog-zebrafish manifold versus the manifold generated using only one-to-one orthologs. (<bold>C</bold>) Histogram showing the distribution of correlation differences for paralog substitutions specific to the original (teal) and one-to-one ortholog based analyses (orange), along with those identified in both mappings (blue). Note that the majority of substitution events, especially in the large correlation difference regime, are present in both mapped manifolds.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-66747-fig3-figsupp1-v2.tif"/></fig></fig-group><p>We next asked whether paralog substitution rates depend on the evolutionary time since gene duplication. We categorized paralogs by the taxonomic level of their most recent shared orthology group and found that more recent paralogs substitute orthologs at higher rates than more ancient paralogs (<xref ref-type="fig" rid="fig3">Figure 3C</xref>). This observation is consistent with the expectation that less diverged genes may be more capable of functionally compensating for each other. To rule out the possibility that these paralogs were linked spuriously during the homology refinement steps of SAMap, we repeated the paralog substitution analysis on an aligned manifold constructed using only one-to-one orthologs. We identified 70% of the paralog substitutions and observed similar patterns in evolutionary time and cell type dependencies (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1A–B</xref>). The other 30% of substitutions had smaller correlation differences on the border of our detection threshold (i.e. correlation difference &gt;0.3) (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1C</xref>). Failure to detect these substitutions was due to inaccurate imputation of gene expressions across species when restricting the mapping to one-to-one orthologs, which resulted in weaker alignment with fewer cross-species edges. Altogether, these results illustrate the potential of SAMap in leveraging single-cell gene expression data for pruning the networks of homologous genes to identify evolutionary substitution of paralogs and, more generally, identify non-orthologous gene pairs that may perform similar functions in the cell types within which they are expressed.</p></sec><sec id="s2-4"><title>Homologous cell types between two flatworm species with divergent body plans</title><p>To test if we can identify homologous cell types in animals with radically different body plans, we mapped the cell atlases of two flatworms, the planarian <italic>Schmidtea mediterranea</italic> (<xref ref-type="bibr" rid="bib18">Fincher et al., 2018</xref>), and the trematode <italic>Schistosoma mansoni</italic>, which we collected recently (<xref ref-type="bibr" rid="bib33">Li et al., 2021</xref>). They represent two distant lineages within the same phylum but have remarkably distinct body plans and autecology (<xref ref-type="bibr" rid="bib31">Laumer et al., 2015</xref>; <xref ref-type="bibr" rid="bib34">Littlewood and Waeschenbach, 2015</xref>). While planarians live in freshwater and are known for their ability to regenerate (<xref ref-type="bibr" rid="bib47">Reddien, 2018</xref>), schistosomes live as parasites in humans. The degree to which cell types are conserved between them is unresolved, given the vast phenotypic differences caused by the transition from free-living to parasitic habits (<xref ref-type="bibr" rid="bib31">Laumer et al., 2015</xref>).</p><p>SAMap revealed broad cell type homology between schistosomes and planarians. The schistosome had cells mapped to the planarian stem cells, called neoblasts, as well as most of the differentiated tissues: neural, muscle, intestine, epidermis, parenchymal, protonephridia, and <italic>cathepsin</italic><sup>+</sup> cells, the latter of which consists of cryptic cell types that, until now, have only been found in planarians (<xref ref-type="bibr" rid="bib18">Fincher et al., 2018</xref>; <xref ref-type="fig" rid="fig4">Figure 4A</xref>). These mappings are supported by both known cell-type-specific marker genes and numerous homologous transcriptional regulators (<xref ref-type="fig" rid="fig4">Figure 4B</xref> and <xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1</xref>).</p><fig-group><fig id="fig4" position="float"><label>Figure 4.</label><caption><title>SAMap transfers cell type information from a well-annotated organism (planarian <italic>S. mediterranea</italic>) to its less-studied cousin (schistosome <italic>S. mansoni</italic>) and identifies parallel stem cell compartments.</title><p>(<bold>A</bold>) UMAP projection of the combined manifolds. Tissue type annotations are adopted from the <italic>S. mediterranea</italic> atlas (<xref ref-type="bibr" rid="bib18">Fincher et al., 2018</xref>). The schistosome atlas was collected from juvenile worms, which we found to contain neoblasts with an abundance comparable to that of planarian neoblasts (<xref ref-type="bibr" rid="bib33">Li et al., 2021</xref>). (<bold>B</bold>) Overlapping expressions of selected tissue-specific TFs with expressing cell types circled. (<bold>C</bold>) UMAP projection of the aligned manifolds showing planarian and schistosome stem cells, with homologous subpopulations circled. Planarian neoblast data is from <xref ref-type="bibr" rid="bib76">Zeng et al., 2018</xref>, and cNeoblasts correspond to the Nb2 population, which are pluripotent cells that can rescue neoblast-depleted planarians in transplantation experiments. (<bold>D</bold>) Distributions of conserved TF expressions in each neoblast subpopulation. Expression values are <italic>k</italic>-nearest-neighbor averaged and standardized, with negative values set to zero. Blue: planarian; yellow: schistosome.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-66747-fig4-v2.tif"/></fig><fig id="fig4s1" position="float" specific-use="child-fig"><label>Figure 4—figure supplement 1.</label><caption><title>SAMap-linked gene pairs that are enriched in cell type pairs between <italic>S. mediterranea</italic> and <italic>S. mansoni</italic>.</title><p>(<bold>A</bold>) Rows: linked cell types. Schistosome cell types correspond to Leiden clusters. Columns: genes linked by SAMap with overlapping eukaryotic eggNOG orthology groups. We calculate the average standardized expression of each gene in an orthology group for its corresponding cell type in a particular pair and report the highest expression. A selected set of orthology groups corresponding to transcriptional regulators are labeled. (<bold>B</bold>) Fluorescence in situ hybridization shows the co-expression of <italic>wnt11</italic> (Smp_156540) and a panel of muscle markers (<italic>collagen</italic>, <italic>troponin</italic>, <italic>myosin</italic> and <italic>tropomyosin</italic>) in <italic>S. mansoni</italic> juveniles. The body wall muscles are expected to be located close to the parasite surface (dashed outline). The images are maximum intensity projections constructed from ~10 confocal slices with optimal axial spacing recommended by the Zen software collected on a Zeiss LSM 800 confocal microscope using a 40× (N.A. = 1.1, working distance = 0.62 mm) water-immersion objective (LD C-Apochromat Corr M27). (<bold>C</bold>) Whole mount in situ hybridization images showing that the expression of <italic>wnt11</italic> and <italic>frizzled</italic> (Smp_174350) are concentrated in the parasite tail (arrows) with decreasing gradients extending anteriorly. In planarian muscles, Wnt genes provide the positional cues for setting up the body plan during regeneration (<xref ref-type="bibr" rid="bib50">Scimone et al., 2017</xref>; <xref ref-type="bibr" rid="bib47">Reddien, 2018</xref>). The presence of an anterior-posterior expression gradient of <italic>wnt11</italic> and <italic>frizzled</italic> in muscles of schistosome juveniles suggests that they may have similar functional roles in patterning during development.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-66747-fig4-figsupp1-v2.tif"/></fig><fig id="fig4s2" position="float" specific-use="child-fig"><label>Figure 4—figure supplement 2.</label><caption><title>Schistosome muscle progenitors express canonical muscle markers.</title><p>UMAP projections of schistosome stem cells with gene expressions overlaid. μ and μ’ cells are circled. Colormap: expression in units of <inline-formula><mml:math id="inf1"><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mi>D</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:math></inline-formula>. For visualization, expression was smoothed via nearest-neighbor averaging using SAM. Note that <italic>myod1</italic> and <italic>cabp</italic> are expressed in both presumptive muscle progenitor populations, whereas all other markers are enriched in μ’ cells. All genes displayed are also expressed in fully differentiated muscle tissues.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-66747-fig4-figsupp2-v2.tif"/></fig></fig-group><p>We next determined if cell type homologies exist at the subtype level. For this, we compared the stem cells, as planarian neoblasts are known to comprise populations of pluripotent cells and tissue-specific progenitors (<xref ref-type="bibr" rid="bib18">Fincher et al., 2018</xref>; <xref ref-type="bibr" rid="bib76">Zeng et al., 2018</xref>). By mapping the schistosome stem cells to a planarian neoblast atlas (<xref ref-type="bibr" rid="bib76">Zeng et al., 2018</xref>), we found that the schistosome has a population of stem cells, ε-cells (<xref ref-type="bibr" rid="bib67">Wang et al., 2018</xref>), that cluster with the planarian’s pluripotent neoblasts, both expressing a common set of TFs (e.g. <italic>soxp2, unc4</italic>, <italic>pax6a</italic>, <italic>gcm1</italic>) (<xref ref-type="fig" rid="fig4">Figure 4C–D</xref>). The ε-cells are closely associated with juvenile development and lost in adult schistosomes (<xref ref-type="bibr" rid="bib67">Wang et al., 2018</xref>; <xref ref-type="bibr" rid="bib39">Nanes Sarfati et al., 2021</xref>), indicating pluripotent stem cells may be a transient population restricted to their early developmental stages. This is consistent with the fact that, whereas schistosomes can heal wounds, they have limited regenerative ability (<xref ref-type="bibr" rid="bib71">Wendt and Collins, 2016</xref>). SAMap also linked other schistosome stem cell populations with planarian progenitors, including two populations of schistosome stem cells – denoted as μ (<xref ref-type="bibr" rid="bib60">Tarashansky et al., 2019</xref>) and μ’ – to planarian muscle progenitors, all of which express <italic>myoD</italic>, a canonical master regulator of myogenesis (<xref ref-type="bibr" rid="bib50">Scimone et al., 2017</xref>). These likely represent early and late muscle progenitors, respectively, as μ-cells do not yet express differentiated muscle markers such as <italic>troponin</italic>, whereas μ’-cells do (<xref ref-type="fig" rid="fig4s2">Figure 4—figure supplement 2</xref>).</p></sec><sec id="s2-5"><title>Cell type families spanning the animal tree of life</title><p>To compare cell types across broader taxonomic scales, we extended our analysis to include juvenile freshwater sponge (<italic>Spongilla lacustris</italic>) (<xref ref-type="bibr" rid="bib38">Musser et al., 2019</xref>), adult <italic>Hydra</italic> (<italic>Hydra vulgaris</italic>) (<xref ref-type="bibr" rid="bib54">Siebert et al., 2019</xref>), and mouse (<italic>Mus musculus</italic>) embryogenesis (<xref ref-type="bibr" rid="bib43">Pijuan-Sala et al., 2019</xref>) atlases. In total, SAMap linked 1051 cross-species pairs of cell types, defined by the annotations used in each respective study. Of the cell type pairs, 95% are supported by at least 40 enriched gene pairs, and 87% are supported by more than 100 gene pairs, indicating that SAMap does not spuriously connect cell types with limited overlap in transcriptional profiles (<xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1A</xref>).</p><p>We next extended the notion of cell type pairs to cell type trios, as mapped cell types gain additional support if they share transitive relationships to other cell types through independent mappings, forming cell type triangles among species. The transitivity of a cell type pair (edge) or a cell type (node) can be quantified as the fraction of triads to which they belong that form triangles (<xref ref-type="fig" rid="fig5">Figure 5A</xref>). The majority (81%) of cell type pairs have non-zero transitivity independent of alignment score and the number of enriched gene pairs (<xref ref-type="fig" rid="fig5s1">Figure 5—figure supplements 1</xref>–<xref ref-type="fig" rid="fig5s2">2</xref>). Cell type pairs with fewer than 40 enriched gene pairs tend to have lower (&lt;0.4) transitivity (<xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1B</xref>). The transitivity measure can also be used to identify potentially spurious connections. 16% of mapped cell type pairs have zero edge transitivity but non-zero node transitivity. These cell types are connected to only a single member of an interconnected cell type group (motifs 2 and 3 in <xref ref-type="fig" rid="fig5">Figure 5B</xref>). Such links may be of lower confidence as they should connect to other members of the group and are thus excluded from downstream analysis.</p><fig-group><fig id="fig5" position="float"><label>Figure 5.</label><caption><title>Mapping evolutionarily distant species identifies densely connected cell type groups.</title><p>(<bold>A</bold>) Schematic illustrating edge (left) and node (right) transitivities, defined as the fraction of triads (set of three connected nodes) in closed triangles. (<bold>B</bold>) The percentage of cell type pairs that are topologically equivalent to the green edge in each illustrated motif. (<bold>C</bold>) Network graphs showing highly connected cell type families. Each node represents a cell type, color-coded by species (detailed annotations are provided in <xref ref-type="supplementary-material" rid="supp7">Supplementary file 7</xref>). Mapped cell types are connected with an edge. (<bold>D</bold>) Boxplot showing the median and interquartile ranges of node transitivities for highly connected cell type groups. For all box plots, the whiskers denote the maximum and minimum observations. The average node transitivity per group is compared to a bootstrapped null transitivity distribution, generated by repeatedly sampling subsets of nodes in the cell type graph and calculating their transitivities. **p&lt;5×10<sup>−5</sup>, ***p&lt;5×10<sup>−7</sup>. (<bold>E</bold>) Boxplot showing the median and interquartile ranges of the number of enriched gene pairs in highly connected cell type groups. All cell type connections in these groups have at least 40 enriched gene pairs (dashed line).</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-66747-fig5-v2.tif"/></fig><fig id="fig5s1" position="float" specific-use="child-fig"><label>Figure 5—figure supplement 1.</label><caption><title>Number of enriched gene pairs are mostly independent of edge transitivity.</title><p>(<bold>A</bold>) Box plot showing the median and interquartile ranges of the number of enriched gene pairs in cell type mappings from all 21 pairwise mappings between the seven species. The whiskers denote the maximum and minimum observations. Of cell type mappings, 87% have greater than 40 enriched gene pairs (dashed line). Species acronyms are the same as in <xref ref-type="fig" rid="fig1">Figure 1A</xref>. (<bold>B</bold>) Top left: The edge transitivity is plotted against the number of enriched gene pairs for all cell type pairs in the connectivity graph. Dashed line: the linear best fit, with the Pearson correlation coefficient reported at the top. Top right: magnified view of the mapped cell type pairs supported by small numbers of gene pairs (&lt;40) to show that those edges have low transitivity scores (&lt;0.4). The sublots below show the number of enriched gene pairs and edge transitivity for individual species pairs.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-66747-fig5-figsupp1-v2.tif"/></fig><fig id="fig5s2" position="float" specific-use="child-fig"><label>Figure 5—figure supplement 2.</label><caption><title>Alignment scores are mostly independent of edge transitivity.</title><p>Top left: alignment scores and edge transitivity for all cell type pairs in the connectivity graph including the seven species. Dashed line: the linear best fit, with the Pearson correlation coefficient reported at the top. Alignment scores and edge transitivity for individual species pairs are shown in the remaining subplots.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-66747-fig5-figsupp2-v2.tif"/></fig></fig-group><p>Among the interconnected groups of cell types, we identified families of neural cells and contractile cells (<xref ref-type="fig" rid="fig5">Figure 5C</xref>). Both cell type families are highly transitive compared to the overall graph transitivity (bootstrap p-value&lt;1×10<sup>−5</sup>), meaning that their constituent cell types have more transitive edges within the group than outside the group (<xref ref-type="fig" rid="fig5">Figure 5D</xref>). In addition, the dense, many-to-many connections within the contractile and neural families are each supported by at least 40 enriched gene pairs (<xref ref-type="fig" rid="fig5">Figure 5E</xref>). Consistent with the nerve net hypothesis suggesting a unified origin of neural cell types (<xref ref-type="bibr" rid="bib64">Tosches and Arendt, 2013</xref>), the neural family includes vertebrate brain tissues, both bilaterian and cnidarian neurons, cnidarian nematocytes that share the excitatory characteristics of neurons (<xref ref-type="bibr" rid="bib68">Weir et al., 2020</xref>), and <italic>Spongilla</italic> choanocytes and apopylar cells, both of which are not considered as neurons but have been shown to express postsynaptic-like scaffolding machinery (<xref ref-type="bibr" rid="bib38">Musser et al., 2019</xref>; <xref ref-type="bibr" rid="bib73">Wong et al., 2019</xref>). The contractile family includes myocytes in bilaterian animals, <italic>Hydra</italic> myoepithelial cells that are known to have contractile myofibrils (<xref ref-type="bibr" rid="bib11">Buzgariu et al., 2015</xref>), and sponge pinacocytes and myopeptidocytes, both of which have been implicated to play roles in contractility (<xref ref-type="bibr" rid="bib38">Musser et al., 2019</xref>; <xref ref-type="bibr" rid="bib51">Sebé-Pedrós et al., 2018</xref>). In contrast to the families encompassing all seven species, we also found a fully interconnected group that contains invertebrate multipotent stem cells, including planarian and schistosome neoblasts, <italic>Hydra</italic> interstitial cells, and sponge archeocytes (<xref ref-type="bibr" rid="bib1">Alié et al., 2015</xref>). The lack of one-to-one connections across phyla is in keeping with recent hypotheses that ancestral cell types diversified into families of cell types after speciation events (<xref ref-type="bibr" rid="bib2">Arendt et al., 2016</xref>; <xref ref-type="bibr" rid="bib3">Arendt et al., 2019</xref>). Our findings thus suggest that these cell type families diversified early in animal evolution.</p></sec><sec id="s2-6"><title>Transcriptomic signatures of cell type families</title><p>The high interconnectedness between cell types across broad taxonomic scales suggests that they should share ancestral transcriptional programs (<xref ref-type="bibr" rid="bib2">Arendt et al., 2016</xref>). SAMap identified broad transcriptomic similarity between bilaterian and non-bilaterian contractile cells that extends beyond the core contractile apparatus. It links a total of 23601 gene pairs, connecting 5471 unique genes, which are enriched in at least one contractile cell type pair. Performing functional enrichment analysis on these genes, we found cytoskeleton and signal transduction functions to be enriched (p-value&lt;10<sup>−3</sup>) based on the KOG functional classifications (<xref ref-type="bibr" rid="bib62">Tatusov et al., 2003</xref>) assigned by eggNOG (<xref ref-type="fig" rid="fig6">Figure 6A</xref>). These genes include orthology groups spanning diverse functional roles in contractile cells, including members of the adhesion complex that connects cells, actomyosin networks that drive contractility, and signaling pathways that stimulate contraction (<xref ref-type="fig" rid="fig6">Figure 6B</xref> and <xref ref-type="supplementary-material" rid="supp5">Supplementary file 5</xref>). This observation suggests that contractile cells near the beginning of animal evolution already possessed the broad assemblage of gene modules associated with different functional aspects of derived muscle cell types in extant animals.</p><fig-group><fig id="fig6" position="float"><label>Figure 6.</label><caption><title>SAMap identifies muscle and stem cell transcriptional signatures conserved across species.</title><p>(<bold>A</bold>) Enrichment of KOG functional annotations calculated for genes shared in contractile cell types. For each species, genes enriched in individual contractile cell types are combined. (<bold>B</bold>) Expression and enrichment of conserved muscle genes in contractile cell types. Color: mean standardized expression. Symbol size: the fraction of cells each gene is expressed in per cell type. Homologs are grouped based on overlapping eukaryotic eggNOG orthology groups. If multiple genes from a species are contained within an orthology group, the gene with highest standardized expression is shown. Genes in blue: core transcriptional program of bilaterian muscles; red: transcriptional regulators conserved throughout Metazoa. (<bold>C</bold>) Enrichment of KOG functional annotations for genes shared by stem cell types. (<bold>D</bold>) Top: boxplot showing the median and interquartile ranges of the mean standardized expressions of stem cell-enriched genes in multipotent stem cells (MSCs), lineage-committed stem cells (LSCs), and differentiated cells (DCs). MSCs include sponge archaeocytes (<xref ref-type="bibr" rid="bib38">Musser et al., 2019</xref>), hydra interstitial stem cells (<xref ref-type="bibr" rid="bib54">Siebert et al., 2019</xref>), planarian neoblasts cluster 0 defined in <xref ref-type="bibr" rid="bib18">Fincher et al., 2018</xref>, schistosome ε-cells (<xref ref-type="bibr" rid="bib60">Tarashansky et al., 2019</xref>). LSCs include sponge transition cells, hydra ecto- and endo-epithelial stem cells; planarian <italic>piwi</italic><sup>+ </sup>cells that cluster with differentiated tissues, and schistosome tissue-specific progenitors. Bottom: dot plot showing the mean standardized expressions of selected transcriptional regulators. The transcript IDs corresponding to each gene are listed in <xref ref-type="supplementary-material" rid="supp6">Supplementary file 6</xref>.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-66747-fig6-v2.tif"/></fig><fig id="fig6s1" position="float" specific-use="child-fig"><label>Figure 6—figure supplement 1.</label><caption><title>Phylogenetic reconstruction of animal contractile cell transcriptional regulators.</title><p>Trees depict <italic>Csrp/Crip</italic> (<bold>A</bold>) and Fox group I (<bold>B</bold>) gene families. Genes labeled red are enriched in at least one contractile gene pair identified via SAMap. Support values indicate bootstrap support from 1000 nonparametric (<italic>Csrp</italic>) or ultrafast (<italic>Fox</italic>) bootstrap replicates. Besides these two transcriptional regulators, contractile cells in all seven species were found to be also enriched for transcription factors from the C2H2 Zinc Finger, Lim Homeobox, and Paired Homeobox families, though in different cell types we found enrichment of a number of distinct orthologs. Whether this reflects an ancestral role for these transcription factor families in regulating contractility or their independent evolution will require additional taxonomic sampling and broader coverage of muscle cell diversity to resolve.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-66747-fig6-figsupp1-v2.tif"/></fig></fig-group><p>We also identified several transcriptional regulators shared among contractile cells (<xref ref-type="fig" rid="fig6">Figure 6B</xref>). Previously known core regulators involved in myocyte specification (<xref ref-type="bibr" rid="bib10">Brunet et al., 2016</xref>) were enriched only in bilaterian (e.g. <italic>myod</italic> and <italic>tcf4/E12</italic>) or vertebrate contractile cells (e.g. <italic>mef2</italic>). In contrast, we found homologs of Muscle Lim Protein (<italic>Csrp</italic>) and Forkhead Box Group 1 (<xref ref-type="bibr" rid="bib30">Larroux et al., 2008</xref>) enriched in contractile cells from all seven species. The Fox proteins included FoxC, which is known to regulate cardiac muscle identity in vertebrates (<xref ref-type="bibr" rid="bib10">Brunet et al., 2016</xref>) and is contractile-specific in all species except schistosome and <italic>Spongilla</italic>. Notably, we also identified FoxG orthologs to be enriched in three of the four invertebrates (<xref ref-type="fig" rid="fig6s1">Figure 6—figure supplement 1</xref>), suggesting that FoxG may play an underappreciated role in contractile cell specification outside vertebrates. Whether the most conserved regulators are positioned at the center of the cell type specification regulatory complex remains an important question to address in future studies.</p><p>For the family of invertebrate multipotent stem cells, we identified 3343 genes that are enriched in at least one cell type pair and observed significant enrichment (p-value&lt;10<sup>−3</sup>) of genes involved in translational regulation such as RNA processing, translation, and post-translational modification (<xref ref-type="fig" rid="fig6">Figure 6C</xref>). We also observed cell cycle and DNA replication genes, as expected for actively dividing cells, though these were not the most enriched categories. Shared stem cell genes comprise 979 orthology groups, 17% of which are enriched in all cell types of this family (<xref ref-type="supplementary-material" rid="supp5">Supplementary file 5</xref>). Importantly, these genes have consistently higher expression in the multipotent stem cells (MSCs) compared to lineage-restricted stem cells (LSCs) and differentiated cells (DCs) for all four species (<xref ref-type="fig" rid="fig6">Figure 6D</xref>), and may represent a large, deeply conserved gene module specifically associated with multipotency.</p><p>Next, we asked whether there is an MSC-specific transcriptional regulatory program. Notably, we identified a number of transcriptional regulators enriched in MSCs across all four invertebrates. This included TFs from <italic>sox</italic> and <italic>klf</italic> orthology groups, the transcriptional coactivator <italic>sub1</italic>, and several chromatin modifiers, including <italic>ssrp1</italic>, a subunit of the FACT complex, and <italic>kat7</italic>, a histone acetyltransferase (<xref ref-type="fig" rid="fig6">Figure 6D</xref> and <xref ref-type="supplementary-material" rid="supp6">Supplementary file 6</xref>). <italic>sox</italic> and <italic>klf</italic> are well-known pluripotency factors (<xref ref-type="bibr" rid="bib8">Bialkowska et al., 2017</xref>; <xref ref-type="bibr" rid="bib49">Sarkar and Hochedlinger, 2013</xref>), whereas the others have been studied in various processes associated with stem cell functions (<xref ref-type="bibr" rid="bib35">MacPherson et al., 2020</xref>; <xref ref-type="bibr" rid="bib55">Sikder et al., 2019</xref>; <xref ref-type="bibr" rid="bib75">Zeng et al., 2013</xref>). The conserved enrichment of these transcriptional regulators in invertebrate MSCs suggests that their functional role in stem cells may be more phylogenetically ancient than previously appreciated. Determining their roles in establishing and maintaining multipotency across diverse animal taxa is an important avenue of future research.</p></sec></sec><sec id="s3" sec-type="discussion"><title>Discussion</title><p>Cell types evolve as their gene expression programs change either as integrated units or via evolutionary splitting that results in separate derived programs. While this notion of coupled cellular and molecular evolution has gained significant traction in the past years, systematically comparing cell type-specific gene expression programs across species has remained a challenging problem. Here, we map single-cell atlases between evolutionarily distant species in a manner that accounts for the complexity of gene evolution. SAMap aligns cell atlases in two mutually reinforcing directions, mapping both the genes and the cells, with each feeding back into the other. Although this algorithm scales well to the majority of presently available whole-organism cell atlases, the size of single-cell datasets will continue to increase. The most memory-intensive steps in SAMap are the neighborhood coarsening of cross-species edges and the cross-species imputation of gene expression to calculate gene-gene correlations, both of which could be intractable for datasets containing millions of cells. Our current solution is to chunk these operations into smaller blocks for large datasets to avoid memory limitations, but the runtime increases significantly as a result. An option for mapping massive datasets may be to downsample each atlas. So long as all cell types are preserved and remain separable during downsampling, we expect the mapping results to be the same.</p><p>SAMap allows us to identify one-to-one cell type concordance between animals in the same phylum, whereas between phyla, we observe interconnected cell types forming distinct families. These findings support the notion that cell types evolve via hierarchical diversification (<xref ref-type="bibr" rid="bib3">Arendt et al., 2019</xref>), resulting in cell type families composed of evolutionarily related cell types sharing a regulatory gene expression program that originated in their common ancestor. One-to-one cell type homologies should exist only if no further cell type diversification has occurred since the speciation. To understand the genetic underpinnings of the observed cell type homologies, we have examined similarities in gene expression programs of several cell types in depth. Among various gene sets, we have focused on TFs, as they form regulatory networks that specify cell type identities and activate downstream differentiation gene batteries (<xref ref-type="bibr" rid="bib17">Erwin and Davidson, 2009</xref>). Notably, many of the aligned cell types we identified share expression of transcription factors known to play important roles in cell type differentiation, suggesting SAMap alignments based on mutual connectivity reflect evolutionary homology, rather than convergent functional similarity. SAMap thus provides a roadmap for tracing cell type evolutionary history and identifying the molecular changes in transcription factor regulatory complexes that have driven cell type diversification.</p><p>In parallel, SAMap systematically identifies instances where paralogs exhibit greater expression similarity than orthologs across species. Paralog substitution can occur due to differential loss or retention of cell-type-specific expression patterns of genes that were duplicated in the common ancestor (<xref ref-type="bibr" rid="bib53">Shafer et al., 2020</xref>; <xref ref-type="bibr" rid="bib58">Studer and Robinson-Rechavi, 2009</xref>) or due to compensating upregulation of paralogs following a loss-of-function mutation acquired by an ortholog (<xref ref-type="bibr" rid="bib16">El-Brolosy et al., 2019</xref>). Considering our observation that paralog substitutions occur at higher rates for more recent paralogs, which should be more capable of functionally compensating for each other, we expect the latter scenario to be more likely, at least between frog and zebrafish. Paralog substitutions may also play an important role in cell type diversification, enabling newly evolved sister cell types to subfunctionalize via the use of distinct paralogs. Whereas the analysis presented here focuses on comparisons between two species, incorporating multiple species into a single analysis that also accounts for their phylogenetic relatedness could enable determining the stability of paralog substitutions within clades and their associated cell type diversification events. However, this will require datasets that densely sample species within specific clades and at key branching points along the tree of life.</p><p>Besides applications in evolutionary biology, we anticipate SAMap can catalyze the annotation of new cell atlases from non-model organisms, which often represents a substantial bottleneck requiring extensive manual curation and prior knowledge. Its ability to use the existing atlases to inform the annotation of cell types in related species will keep improving as more datasets become available to better sample the diversity of cell types throughout the animal kingdom.</p></sec><sec id="s4" sec-type="materials|methods"><title>Materials and methods</title><sec id="s4-1"><title>Data and code availability</title><p>The source code for SAMap is publicly available at Github (<ext-link ext-link-type="uri" xlink:href="https://github.com/atarashansky/SAMap">https://github.com/atarashansky/SAMap</ext-link>; copy archived at <ext-link ext-link-type="uri" xlink:href="https://archive.softwareheritage.org/swh:1:dir:b7290584f7f332259ae7fa6116cec731029e3d34;origin=https://github.com/atarashansky/SAMap;visit=swh:1:snp:bb64030722e96892face5ccb7f217991bab07c03;anchor=swh:1:rev:c696585f8fe41ec1599b0720df579f3cb14f935b">swh:1:rev:c696585f8fe41ec1599b0720df579f3cb14f935b</ext-link>; <xref ref-type="bibr" rid="bib61">Tarashansky et al., 2021</xref>), along with the code to perform the analysis and generate the types of plots presented in the figures. We also provide a wrapper function to launch a graphical user interface provided by the SAM package to interactively explore both datasets in the combined manifold. The datasets analyzed in this study are detailed in <xref ref-type="supplementary-material" rid="supp1">Supplementary file 1</xref> with their accessions and annotations provided.</p></sec><sec id="s4-2"><title>The SAMap algorithm</title><p>The SAMap algorithm contains three major steps: preprocessing, mutual nearest neighborhood alignment, and gene-gene correlation initialization. The latter two are repeated for three iterations, by default, to balance alignment performance and computational runtime.</p><sec id="s4-2-1"><title>Preprocessing</title><sec id="s4-2-1-1"><title>Generate gene homology graph via reciprocal BLAST</title><p>We first construct a gene-gene bipartite graph between two species by performing reciprocal BLAST of their respective transcriptomes using <italic>tblastx</italic>, or proteomes using <italic>blastp. tblastn</italic> and <italic>blastx</italic> are used for BLAST between proteome and transcriptome. When a pair of genes share multiple High Scoring Pairs (HSPs), which are local regions of matching sequences, we use the HSP with the highest bit score to measure homology. Only pairs with E-value &lt;10<sup>−6</sup> are included in the graph.</p><p>Although we define similarity using BLAST, SAMap is compatible with other protein homology detection methods (e.g. HMMER [<xref ref-type="bibr" rid="bib14">Eddy, 2008</xref>]) or orthology inference tools (e.g. OrthoClust [<xref ref-type="bibr" rid="bib74">Yan et al., 2014</xref>] and eggNOG [<xref ref-type="bibr" rid="bib25">Huerta-Cepas et al., 2019</xref>]). While each of these methods has known strengths and limitations, BLAST is chosen for its broad usage, technical convenience, and compatibility with low-quality transcriptomes.</p><p>We encode the BLAST results into two triangular adjacency matrices, <inline-formula><mml:math id="inf2"><mml:mi>A</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf3"><mml:mi>B</mml:mi></mml:math></inline-formula>, each containing bit scores in one BLAST direction. We combine <inline-formula><mml:math id="inf4"><mml:mi>A</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf5"><mml:mi>B</mml:mi></mml:math></inline-formula> to form a gene-gene adjacency matrix <inline-formula><mml:math id="inf6"><mml:mi>G</mml:mi></mml:math></inline-formula>. After symmetrizing <inline-formula><mml:math id="inf7"><mml:mi>G</mml:mi></mml:math></inline-formula>, we remove edges that only appear in one direction: <inline-formula><mml:math id="inf8"><mml:mi>G</mml:mi><mml:mo>=</mml:mo><mml:mi>R</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>i</mml:mi><mml:mi>p</mml:mi><mml:mo>(</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mfenced close="]" open="[" separators="|"><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:mi>A</mml:mi><mml:mo>+</mml:mo><mml:mi>B</mml:mi></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:mi>A</mml:mi><mml:mo>+</mml:mo><mml:mi>B</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mo>)</mml:mo><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="fraktur">R</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:math></inline-formula>, where <inline-formula><mml:math id="inf9"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>R</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>i</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> only keeps reciprocal edges, and <inline-formula><mml:math id="inf10"><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf11"><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> are the number of genes of the two species, respectively. To filter out relatively weak homologies, we also remove edges where <inline-formula><mml:math id="inf12"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>b</mml:mi></mml:mrow></mml:msub><mml:mo>&lt;</mml:mo><mml:mn>0.25</mml:mn><mml:munder><mml:mrow><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi></mml:mrow><mml:mi>b</mml:mi></mml:munder><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>b</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>. Edge weights are then normalized by the maximum edge weight for each gene and transformed by a hyperbolic tangent function to increase discriminatory power between low and high edge weights, <inline-formula><mml:math id="inf13"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>G</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mi>b</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mn>0.5</mml:mn><mml:mo>+</mml:mo><mml:mn>0.5</mml:mn><mml:mi>t</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mi>h</mml:mi><mml:mo>(</mml:mo><mml:mn>10</mml:mn><mml:mi>G</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mi>b</mml:mi></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:munder><mml:mrow><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:munder><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>G</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mi>b</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>-</mml:mo><mml:mn>5</mml:mn><mml:mo>)</mml:mo></mml:math></inline-formula>.</p></sec><sec id="s4-2-1-2"><title>Construct manifolds for each cell atlas separately using the SAM algorithm</title><p>The single-cell RNAseq datasets are normalized such that each cell has a total number of raw counts equal to the median size of single-cell libraries. Gene expressions are then log-normalized with the addition of a pseudocount of 1. Genes expressed (i.e. <inline-formula><mml:math id="inf14"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:msub><mml:mi>g</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>D</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>&gt;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula>) in greater than 96% of cells are filtered out. SAM is run using the following parameters: <italic>preprocessing = ‘StandardScaler’</italic>, <italic>weight_PCs = False</italic>, <italic>k = 20</italic>, and <italic>npcs = 150</italic>. A detailed description of parameters is provided previously (<xref ref-type="bibr" rid="bib60">Tarashansky et al., 2019</xref>). SAM outputs <inline-formula><mml:math id="inf15"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf16"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>, which are directed adjacency matrices that encode <italic>k</italic>-nearest neighbor graphs for the two datasets, respectively.</p><p>SAM only includes the top 3000 genes ranked by SAM weights and the first 150 principal components (PCs) in the default mode to reduce computational complexity. However, downstream mapping requires PC loadings for all genes. Thus, in the final iteration of SAM, we run PCA on all genes and take the top 300 PCs. This step generates a loading matrix for each species <inline-formula><mml:math id="inf17"><mml:mi>i</mml:mi></mml:math></inline-formula>, <inline-formula><mml:math id="inf18"><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="fraktur">R</mml:mi></mml:mrow><mml:mrow><mml:mn>300</mml:mn><mml:mo>×</mml:mo><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:math></inline-formula>.</p></sec></sec><sec id="s4-2-2"><title>Mutual nearest neighborhood alignment</title><sec id="s4-2-2-1"><title>Transform feature spaces between species</title><p>For the gene expression matrices <inline-formula><mml:math id="inf19"><mml:msub><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="fraktur">R</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:math></inline-formula>, where <inline-formula><mml:math id="inf20"><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow/></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf21"><mml:mi>m</mml:mi></mml:math></inline-formula> are the number of cells and genes respectively, we first zero the expression of genes that do not have an edge in <inline-formula><mml:math id="inf22"><mml:mover accent="true"><mml:mrow><mml:mi>G</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula> and standardize the expression matrices such that each gene has zero mean and unit variance, yielding <inline-formula><mml:math id="inf23"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>. <inline-formula><mml:math id="inf24"><mml:mover accent="true"><mml:mrow><mml:mi>G</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula> represents a bipartite graph in the form of <inline-formula><mml:math id="inf25"><mml:mover accent="true"><mml:mrow><mml:mi>G</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mfenced close="]" open="[" separators="|"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mtd><mml:mtd><mml:mi>H</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="fraktur">R</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msup><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="fraktur">R</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mtd><mml:mtd><mml:msub><mml:mrow><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfenced></mml:math></inline-formula>, where <inline-formula><mml:math id="inf26"><mml:msub><mml:mrow><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is <inline-formula><mml:math id="inf27"><mml:mi>m</mml:mi><mml:mo>×</mml:mo><mml:mi>m</mml:mi></mml:math></inline-formula> zero matrix and <inline-formula><mml:math id="inf28"><mml:mi>H</mml:mi></mml:math></inline-formula> is the biadjacency matrix. Letting <inline-formula><mml:math id="inf29"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>H</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf30"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup></mml:math></inline-formula> encoding directed edges from species 1 to 2 and 2 to 1, respectively, we normalize the biadjacency matrix <inline-formula><mml:math id="inf31"><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> such that each row sums to 1: <inline-formula><mml:math id="inf32"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>S</mml:mi><mml:mi>u</mml:mi><mml:mi>m</mml:mi><mml:mi>N</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>m</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="fraktur">R</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:math></inline-formula>, where the <inline-formula><mml:math id="inf33"><mml:mi>S</mml:mi><mml:mi>u</mml:mi><mml:mi>m</mml:mi><mml:mi>N</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>m</mml:mi></mml:math></inline-formula> function normalizes the rows to sum to 1. The feature spaces can be transformed between the two species via weighted averaging of gene expression, <inline-formula><mml:math id="inf34"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>H</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>.</p></sec><sec id="s4-2-2-2"><title>Project single-cell gene expressions into a joint PC space</title><p>We project the expression data from two species into a joint PC space (<xref ref-type="bibr" rid="bib4">Barkas et al., 2019</xref>), <inline-formula><mml:math id="inf35"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup></mml:math></inline-formula> and <inline-formula><mml:math id="inf36"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup></mml:math></inline-formula>. We then horizontally concatenate the principal components <inline-formula><mml:math id="inf37"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf38"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> to form <inline-formula><mml:math id="inf39"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="fraktur">R</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:mn>600</mml:mn></mml:mrow></mml:msup></mml:math></inline-formula>.</p></sec><sec id="s4-2-2-3"><title>Calculate k-nearest cross-species neighbors for all cells</title><p>Using the joint PCs, <inline-formula><mml:math id="inf40"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>, we identify for each cell the <inline-formula><mml:math id="inf41"><mml:mi>k</mml:mi></mml:math></inline-formula>-nearest neighbors in the other dataset using cosine similarity (<inline-formula><mml:math id="inf42"><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>20</mml:mn></mml:math></inline-formula> by default). Neighbors are identified using the <italic>hnswlib</italic> library, a fast approximate nearest-neighbor search algorithm (<xref ref-type="bibr" rid="bib37">Malkov and Yashunin, 2020</xref>). This outputs two directed biadjacency matrices <inline-formula><mml:math id="inf43"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="fraktur">R</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:math></inline-formula> for <inline-formula><mml:math id="inf44"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> or <inline-formula><mml:math id="inf45"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> with edge weights equal to the cosine similarity between the PCs.</p></sec><sec id="s4-2-2-4"><title>Apply the graph-coarsening mapping kernel to identify cross-species mutual nearest neighborhoods</title><p>To increase the stringency and confidence of mapping, we only rely on cells that are <italic>mutual</italic> nearest cross-species neighbors, which are typically defined as two cells reciprocally connected to one another (<xref ref-type="bibr" rid="bib21">Haghverdi et al., 2018</xref>). However, due to the noise in cell-cell correlations and stochasticity in the kNN algorithms, cross-species neighbors are often randomly assigned from a pool of cells that appear equally similar, decreasing the likelihood of mutual connectivity between individual cells even if they have similar expression profiles. To overcome this limitation, we integrate information from each cell’s local neighborhood to establish more robust mutual connectivity between cells across species. Two cells are thus defined as mutual nearest cross-species neighbors when their respective neighborhoods have mutual connectivity.</p><p>Specifically, the nearest neighbor graphs <inline-formula><mml:math id="inf46"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> generated by SAM are used to calculate the neighbors of cells <inline-formula><mml:math id="inf47"><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> hops away along outgoing edges: <inline-formula><mml:math id="inf48"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mo>̄</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:math></inline-formula>, where <inline-formula><mml:math id="inf49"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mo>̄</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> are adjacency matrices that contain the number of paths connecting two cells <inline-formula><mml:math id="inf50"><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> hops away, for <inline-formula><mml:math id="inf51"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> or 2. <inline-formula><mml:math id="inf52"><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> determines the length-scale over which we integrate incoming edges for species <inline-formula><mml:math id="inf53"><mml:mi>i</mml:mi></mml:math></inline-formula>. Its default value is 2 if the dataset size is less than 20,000 cells and 3 otherwise. However, cells within tight clusters may have spurious edges connecting to other parts of the manifold only a few hops away. To avoid integrating neighborhood information outside this local structure, we use the Leiden algorithm (<xref ref-type="bibr" rid="bib65">Traag et al., 2019</xref>) to cluster the graph and identify a local neighborhood size for each cell (the resolution parameter is set to 3 by default). If cell <inline-formula><mml:math id="inf54"><mml:mi>a</mml:mi></mml:math></inline-formula> belongs to cluster <inline-formula><mml:math id="inf55"><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>, then its neighborhood size is <inline-formula><mml:math id="inf56"><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo></mml:math></inline-formula>. For each row <inline-formula><mml:math id="inf57"><mml:mi>a</mml:mi></mml:math></inline-formula> in <inline-formula><mml:math id="inf58"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mo>̄</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> we only keep the <inline-formula><mml:math id="inf59"><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> geodesically closest cells, letting the pruned graph update <inline-formula><mml:math id="inf60"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>.</p><p>Edges outgoing from cell <inline-formula><mml:math id="inf61"><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> in species <inline-formula><mml:math id="inf62"><mml:mi>i</mml:mi></mml:math></inline-formula> are encoded in the corresponding row in the adjacency matrix: <inline-formula><mml:math id="inf63"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math></inline-formula>. We compute the fraction of the outgoing edges from each cell that target the local neighborhood of a cell in the other species: <inline-formula><mml:math id="inf64"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>c</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mrow/></mml:msubsup><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="inf65"><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math></inline-formula> is the set of cells in the neighborhood of cell <inline-formula><mml:math id="inf66"><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> in species <inline-formula><mml:math id="inf67"><mml:mi>j</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf68"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math></inline-formula> is the fraction of outgoing edges from cell <inline-formula><mml:math id="inf69"><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> in species <inline-formula><mml:math id="inf70"><mml:mi>i</mml:mi></mml:math></inline-formula> targeting the neighborhood of cell <inline-formula><mml:math id="inf71"><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> in species <inline-formula><mml:math id="inf72"><mml:mi>j</mml:mi></mml:math></inline-formula>.</p><p>To reduce the density of <inline-formula><mml:math id="inf73"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> so as to satisfy computational memory constraints, we remove edges with weight less than 0.1. Finally, we apply the mutual nearest neighborhood criterion by taking the element-wise, geometric mean of the two directed bipartite graphs: <inline-formula><mml:math id="inf74"><mml:mover accent="true"><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:msqrt><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>∘</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:msqrt></mml:math></inline-formula>. This operation ensures that only bidirectional edges are preserved, as small edge weights in either direction results in small geometric means.</p></sec><sec id="s4-2-2-5"><title>Assign the k-nearest cross-species neighborhoods for each cell</title><p>Given the mutual nearest neighborhoods <inline-formula><mml:math id="inf75"><mml:mover accent="true"><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="fraktur">R</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:math></inline-formula>, we select the <italic>k</italic> nearest neighborhoods for each cell in both directions to update the directed biadjacency matrices <inline-formula><mml:math id="inf76"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf77"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>: <inline-formula><mml:math id="inf78"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>K</mml:mi><mml:mi>N</mml:mi><mml:mi>N</mml:mi><mml:mo>(</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo>)</mml:mo></mml:math></inline-formula> and <inline-formula><mml:math id="inf79"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>K</mml:mi><mml:mi>N</mml:mi><mml:mi>N</mml:mi><mml:mo>(</mml:mo><mml:msup><mml:mrow><mml:msup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup></mml:mrow><mml:mrow/></mml:msup><mml:mo>,</mml:mo><mml:mi>k</mml:mi><mml:mo>)</mml:mo></mml:math></inline-formula>, with <inline-formula><mml:math id="inf80"><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>20</mml:mn></mml:math></inline-formula> by default.</p></sec><sec id="s4-2-2-6"><title>Stitch the manifolds</title><p>We use <inline-formula><mml:math id="inf81"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf82"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> to combine the manifolds <inline-formula><mml:math id="inf83"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf84"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> into a unified graph. We first weight the edges in <inline-formula><mml:math id="inf85"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf86"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> to account for the number of shared cross-species neighbors by computing the one-mode projections of <inline-formula><mml:math id="inf87"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf88"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>. In addition, for cells with strong cross-species alignment, we attenuate the weight of their within-species edges. For cells with little to no cross-species alignment, their within-species are kept the same to ensure that the local topological information around cells with no alignment is preserved.</p><p>Specifically, we use <inline-formula><mml:math id="inf89"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf90"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> to mask the edges in the one-mode projections, <inline-formula><mml:math id="inf91"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>U</mml:mi><mml:mo>(</mml:mo><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>∘</mml:mo><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>m</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mi>N</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>m</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>)</mml:mo></mml:math></inline-formula> and <inline-formula><mml:math id="inf92"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>U</mml:mi><mml:mo>(</mml:mo><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>∘</mml:mo><mml:mo>(</mml:mo><mml:mi>N</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>m</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mi>N</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>m</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>)</mml:mo></mml:math></inline-formula>, where <inline-formula><mml:math id="inf93"><mml:mi>U</mml:mi><mml:mo>(</mml:mo><mml:mi>E</mml:mi><mml:mo>)</mml:mo></mml:math></inline-formula> sets all edge weights in graph <inline-formula><mml:math id="inf94"><mml:mi>E</mml:mi></mml:math></inline-formula> to 1 and <inline-formula><mml:math id="inf95"><mml:mi>N</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>m</mml:mi></mml:math></inline-formula> normalizes the outgoing edges from each cell to sum to 1. The minimum edge weight is set to be 0.3 to ensure that neighbors in the original manifolds with no shared cross-species neighbors still retain connectivity: <inline-formula><mml:math id="inf96"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mover><mml:mi>N</mml:mi><mml:mo>∼</mml:mo></mml:mover><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0.3</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mover><mml:mi>N</mml:mi><mml:mo>∼</mml:mo></mml:mover><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf97"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mover><mml:mi>N</mml:mi><mml:mo>∼</mml:mo></mml:mover><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0.3</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mover><mml:mi>N</mml:mi><mml:mo>∼</mml:mo></mml:mover><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> for all edges <inline-formula><mml:math id="inf98"><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>)</mml:mo></mml:math></inline-formula>. We then scale the within-species edges from cell <inline-formula><mml:math id="inf99"><mml:mi>i</mml:mi></mml:math></inline-formula> by the total weight of its cross-species edges: <inline-formula><mml:math id="inf100"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:mfrac><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msubsup><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf101"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:mfrac><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msubsup><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>)</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>. Finally, the within- and cross-species graphs are stitched together to form the combined nearest neighbor graph <inline-formula><mml:math id="inf102"><mml:mi>N</mml:mi></mml:math></inline-formula>: <inline-formula><mml:math id="inf103"><mml:mi>N</mml:mi><mml:mo>=</mml:mo><mml:mo>[</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>⊕</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>]</mml:mo><mml:mo>⊕</mml:mo><mml:mo>[</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>⊕</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>]</mml:mo></mml:math></inline-formula>. The overall alignment score between species 1 and 2 is defined as <inline-formula><mml:math id="inf104"><mml:mi>S</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msubsup><mml:mrow><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msubsup><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msubsup><mml:mrow><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msubsup><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:math></inline-formula>.</p></sec></sec><sec id="s4-2-3"><title>Homology graph refinement</title><sec id="s4-2-3-1"><title>Update edge weights in the gene-gene bipartite graph with expression correlations</title><p>To compute correlations between gene pairs, we first transfer expressions from one species to the other: <inline-formula><mml:math id="inf105"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mo>̄</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mi>m</mml:mi><mml:msub><mml:mrow/><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math></inline-formula>, where <inline-formula><mml:math id="inf106"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mo>̄</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math></inline-formula> is the imputed expressions of gene <inline-formula><mml:math id="inf107"><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> from species <inline-formula><mml:math id="inf108"><mml:mi>j</mml:mi></mml:math></inline-formula> for cell <inline-formula><mml:math id="inf109"><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> in species <inline-formula><mml:math id="inf110"><mml:mi>i</mml:mi></mml:math></inline-formula>, and <inline-formula><mml:math id="inf111"><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math></inline-formula> is row <inline-formula><mml:math id="inf112"><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> of the biadjacency matrix encoding the cross-species neighbors of cell <inline-formula><mml:math id="inf113"><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> in species <inline-formula><mml:math id="inf114"><mml:mi>i</mml:mi></mml:math></inline-formula>, all for <inline-formula><mml:math id="inf115"><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mo>(</mml:mo><mml:mn>1,2</mml:mn><mml:mo>)</mml:mo></mml:math></inline-formula> and <inline-formula><mml:math id="inf116"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula>. We similarly use the manifolds constructed by SAM to smooth the within-species gene expressions using kNN averaging: <inline-formula><mml:math id="inf117"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mo>̄</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math></inline-formula>, where <inline-formula><mml:math id="inf118"><mml:msub><mml:mrow><mml:mi>N</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is the nearest-neighbor graph for species <inline-formula><mml:math id="inf119"><mml:mi>j</mml:mi></mml:math></inline-formula>. We then concatenate the within- and cross-species gene expressions such that the expression of gene <inline-formula><mml:math id="inf120"><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> from species <inline-formula><mml:math id="inf121"><mml:mi>j</mml:mi></mml:math></inline-formula> in both species is <inline-formula><mml:math id="inf122"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mo>̄</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mo>=</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mo>̄</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>⊕</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mo>̄</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math></inline-formula>.</p><p>For all gene pairs in the initial unpruned homology graph, <inline-formula><mml:math id="inf123"><mml:mover accent="true"><mml:mrow><mml:mi>G</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula>, we compute their correlations, <inline-formula><mml:math id="inf124"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>G</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mi>b</mml:mi></mml:mrow></mml:msub><mml:mo>:</mml:mo><mml:mo>=</mml:mo><mml:mi>θ</mml:mi><mml:mo>(</mml:mo><mml:mn>0</mml:mn><mml:mo>)</mml:mo><mml:mi>C</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>r</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mo>̄</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mo>̄</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:math></inline-formula>, where <inline-formula><mml:math id="inf125"><mml:mi>θ</mml:mi><mml:mo>(</mml:mo><mml:mn>0</mml:mn><mml:mo>)</mml:mo></mml:math></inline-formula> is a Heaviside step function centered at 0 to set negative correlations to zero. We then use the expression correlations to update the corresponding edge weights in <inline-formula><mml:math id="inf126"><mml:mover accent="true"><mml:mrow><mml:mi>G</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula>, which are again normalized through <inline-formula><mml:math id="inf127"><mml:msub><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>G</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mi>b</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0.5</mml:mn><mml:mo>+</mml:mo><mml:mn>0.5</mml:mn><mml:mi>t</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mi>h</mml:mi><mml:mo>(</mml:mo><mml:mn>10</mml:mn><mml:mover accent="true"><mml:mrow><mml:mi>G</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mi>b</mml:mi></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:munder><mml:mrow><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:munder><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>G</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mi>b</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>-</mml:mo><mml:mn>5</mml:mn><mml:mo>)</mml:mo></mml:math></inline-formula>.</p></sec></sec></sec><sec id="s4-3"><title>Annotation of cell atlases</title><p>To annotate the primary zebrafish and <italic>Xenopus</italic> cell types, the cell subtype annotations provided by the original publications (<xref ref-type="bibr" rid="bib9">Briggs et al., 2018</xref>; <xref ref-type="bibr" rid="bib66">Wagner et al., 2018</xref>) are coarsened using a combination of the manual matching and developmental hierarchies. For example, as ‘involuting marginal zone’ in <italic>Xenopus</italic> is manually matched to ‘non-dorsal margin’, 'dorsal margin' 'non-dorsal margin involuted', and ‘dorsal margin involuted’ in zebrafish, we label these cells as ‘involuting marginal zone’. In cases where the matching is insufficient to coarsen the annotations, we use the provided developmental trees to name a group of terminal cell subtypes by their common ontogenic ancestor. Cell types that do not cluster well in the manifold reconstructed by SAM are excluded from the comparison. These include germline, heart, and olfactory placode cells, as they are mixed with other cell types in the <italic>Xenopus</italic> atlas. The germline cells are scattered across the reconstructed manifold and do not concentrate in a distinct cluster. The heart cells and olfactory placode cells are inextricably mixed with larger populations of intermediate mesoderm and placodal cells, respectively. Similarly, the iridoblast, epiphysis, <italic>nanog</italic><sup>+</sup>, apoptotic-like, and forerunner cells are excluded because they do not cluster distinctly in the zebrafish atlas.</p><p>The annotations provided by their respective studies are used to label the cells in the <italic>Spongilla</italic>, <italic>Hydra</italic>, planarian, and mouse atlases. To annotate the schistosome cells, we use known marker genes to annotate the main schistosome tissue types (<xref ref-type="bibr" rid="bib33">Li et al., 2021</xref>). Annotations for all single cells in all datasets are provided in <xref ref-type="supplementary-material" rid="supp1">Supplementary file 1</xref>.</p></sec><sec id="s4-4"><title>Visualization</title><p>The combined manifold <inline-formula><mml:math id="inf128"><mml:mi>N</mml:mi></mml:math></inline-formula> is embedded into 2D projections using UMAP implemented in the scanpy package (<xref ref-type="bibr" rid="bib72">Wolf et al., 2018</xref>) by <italic>scanpy.tl.umap</italic> with the parameter <italic>min_dist</italic> = 0.1. The sankeyD3 package (<ext-link ext-link-type="uri" xlink:href="https://rdrr.io/github/fbreitwieser/sankeyD3/man/sankeyD3-package.html">https://rdrr.io/github/fbreitwieser/sankeyD3/man/sankeyD3-package.html</ext-link>) in R is used to generate the sankey plots. Edge thickness corresponds to the alignment score between mapped cell types. The alignment score between cell types <inline-formula><mml:math id="inf129"><mml:mi>a</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf130"><mml:mi>b</mml:mi></mml:math></inline-formula> is defined as <inline-formula><mml:math id="inf131"><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi><mml:mi>b</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mo>+</mml:mo><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo></mml:mrow></mml:mfrac><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow/></mml:msubsup><mml:mrow><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow/></mml:msubsup><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow/></mml:msubsup><mml:mrow><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow/></mml:msubsup><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:math></inline-formula>, where <inline-formula><mml:math id="inf132"><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf133"><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> are the set of cells in cell types <inline-formula><mml:math id="inf134"><mml:mi>a</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf135"><mml:mi>b</mml:mi></mml:math></inline-formula>, respectively. Cell type pairs with alignment score less than <inline-formula><mml:math id="inf136"><mml:mi>z</mml:mi></mml:math></inline-formula> are filtered out. By default, <inline-formula><mml:math id="inf137"><mml:mi>z</mml:mi></mml:math></inline-formula> is set to be 0.1.</p><p>The network graphs in <xref ref-type="fig" rid="fig5">Figure 5C</xref> are generated using the <italic>networkx</italic> package (<ext-link ext-link-type="uri" xlink:href="https://networkx.github.io">https://networkx.github.io</ext-link>) in python. To focus on densely connected cell type groups, we filter out cell type pairs with alignment score less than 0.05.</p></sec><sec id="s4-5"><title>Identification of gene pairs that drive cell type mappings</title><p>We define <inline-formula><mml:math id="inf138"><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf139"><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> to contain SAMap-linked genes from species 1 and 2, respectively. Note that a gene may appear multiple times as SAMap allows for one-to-many homology. Let <inline-formula><mml:math id="inf140"><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math></inline-formula> denote the set of all cells with cross species edges between cell types <inline-formula><mml:math id="inf141"><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf142"><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>. We calculate the average standardized expression of all cells from species <inline-formula><mml:math id="inf143"><mml:mi>i</mml:mi></mml:math></inline-formula> that are in <inline-formula><mml:math id="inf144"><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math></inline-formula>: <inline-formula><mml:math id="inf145"><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mo>{</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>x</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>}</mml:mo><mml:mo>|</mml:mo></mml:mrow></mml:mfrac><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mrow/></mml:msubsup><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="inf146"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>Z</mml:mi></mml:mrow><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="fraktur">R</mml:mi></mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula> is the standardized expression of genes <inline-formula><mml:math id="inf147"><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> in cell <inline-formula><mml:math id="inf148"><mml:mi>x</mml:mi></mml:math></inline-formula>. The correlation between <inline-formula><mml:math id="inf149"><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf150"><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math></inline-formula> can be written as <inline-formula><mml:math id="inf151"><mml:mi>C</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>r</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>|</mml:mo></mml:mrow></mml:msubsup><mml:mrow><mml:mi>S</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∘</mml:mo><mml:mi>S</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="inf152"><mml:mi>S</mml:mi><mml:mo>(</mml:mo><mml:mi>Z</mml:mi><mml:mo>)</mml:mo></mml:math></inline-formula> standardizes vector <inline-formula><mml:math id="inf153"><mml:mi>Z</mml:mi></mml:math></inline-formula> to have zero mean and unit variance. We use the summand to identify gene pairs that contribute most positively to the correlation. We assign each gene pair a score: <inline-formula><mml:math id="inf154"><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>T</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>S</mml:mi><mml:mo>(</mml:mo><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>)</mml:mo><mml:mo>∘</mml:mo><mml:mi>T</mml:mi><mml:mo>(</mml:mo><mml:mi>S</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>g</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>)</mml:mo></mml:math></inline-formula>, where <inline-formula><mml:math id="inf155"><mml:mi>T</mml:mi><mml:mo>(</mml:mo><mml:mi>Z</mml:mi><mml:mo>)</mml:mo></mml:math></inline-formula> sets negative values in vector <inline-formula><mml:math id="inf156"><mml:mi>Z</mml:mi></mml:math></inline-formula> to zero in order to ignore lowly-expressed genes. To be inclusive, we begin with the top 1000 gene pairs according to <inline-formula><mml:math id="inf157"><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and filter out gene pairs in which one or both of the genes are not differentially expressed in their respective cell types (p-value &gt; 10<sup>−2</sup>), have less than 0.2 SAM weight, or are expressed in fewer than 5% of the cells in the cluster. The differential expression of each gene in each cell type is calculated using the Wilcoxon rank-sum test implemented in the <italic>scanpy</italic> function <italic>scanpy.tl.rank_genes_groups</italic>.</p></sec><sec id="s4-6"><title>Orthology group assignment</title><p>We use the eggNOG mapper (v5.0) (<xref ref-type="bibr" rid="bib25">Huerta-Cepas et al., 2019</xref>) to assign each gene to an orthology group with default parameters. For the zebrafish-to-<italic>Xenopus</italic> mapping, genes are considered orthologs if they map to the same vertebrate orthology group. For the pan-species analysis, we group genes from all species with overlapping orthology assignments. In <xref ref-type="fig" rid="fig6">Figure 6B</xref>, each column corresponds to one of these groups. As each group may contain multiple genes from each species, we present the expression of the gene with the highest enrichment score per species. All gene names and corresponding orthology groups are reported in <xref ref-type="supplementary-material" rid="supp5">Supplementary file 5</xref>.</p></sec><sec id="s4-7"><title>Paralog substitution analysis</title><p>SAMap outputs gene-gene correlations across the combined manifold for all pairs of genes in the homology graph. As determined by eggNOG, genes that map to the same orthology group for the two species’ most recent common ancestor are considered orthologs, and those that map to the same orthology group more ancestral than Vertebrata are considered as paralogs. We note that as eggNOG does not provide an orthology group corresponding to the osteichtyan ancestor, our analysis does not include the paralogs that duplicated in between the osteichtyan and the vertebrate ancestors. If a gene has significantly higher correlation to one of its paralogs than its ortholog (&gt;0.3 by default), we consider its ortholog to have been substituted. Paralog substitutions are identified using the <italic>samap.analysis.ParalogSubstitutions</italic> function provided by the SAMap package.</p><p>The evolutionary time period in which paralogs were duplicated can be inferred by identifying their most recent shared orthology group. We calculate the enrichment of paralog substitutions for each taxonomic level (i.e. Chordata, Bilateria, Metazoa, Opisthokonta, and Eukaryota) using the eggNOG orthology group assignments. We normalize the number of substituting paralogs by the total number of paralogs at each level to calculate the rate of paralog substitution across evolutionary time.</p><p>To quantify the enrichment of substituting paralogs in each cell type, we define a cell type-specific substitution score. We first assign paralog substitution events to cell types if the paralogous gene pairs are enriched in any of their mappings. Each cell type <inline-formula><mml:math id="inf158"><mml:mi>k</mml:mi></mml:math></inline-formula> then has a set of substituting paralogs <inline-formula><mml:math id="inf159"><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>. The score <inline-formula><mml:math id="inf160"><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> for cell type <inline-formula><mml:math id="inf161"><mml:mi>k</mml:mi></mml:math></inline-formula> is calculated as <inline-formula><mml:math id="inf162"><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>P</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="inf163"><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is the number of paralogs of ortholog <inline-formula><mml:math id="inf164"><mml:mi>i</mml:mi></mml:math></inline-formula> normalized by the maximum number of paralogs observed across all genes to accounts for the fact that genes with more paralogs are more likely to match with substituting paralogs by random chance, and <inline-formula><mml:math id="inf165"><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is the number of differentially expressed genes in cell type <inline-formula><mml:math id="inf166"><mml:mi>k</mml:mi></mml:math></inline-formula>. Similarly, the denominator accounts for the fact that cell types with more differentially expressed genes are more likely to have paralog substitutions by random chance. The substitution scores for cell types with annotated homologs across species are averaged.</p></sec><sec id="s4-8"><title>Phylogenetic reconstruction of gene trees</title><p>We generate gene trees to validate the identity of genes involved in putative examples of paralog substitution and of <italic>Fox</italic> and <italic>Csrp</italic> transcriptional regulators that are identified as enriched in contractile cells. For this, we first gather protein sequences from potential homologs using the eggnog version 5.0 orthology database (<xref ref-type="bibr" rid="bib25">Huerta-Cepas et al., 2019</xref>). For the <italic>Fox</italic> and <italic>Csrp</italic> phylogenies, we include all Fox clade I (<xref ref-type="bibr" rid="bib30">Larroux et al., 2008</xref>) and Csrp/Crip homologs, respectively, from the seven species included in our study.</p><p>Alignment of protein sequences is performed with Clustal Omega version 1.2.4 using default settings as implemented on the EMBL EBI web services platform (<xref ref-type="bibr" rid="bib36">Madeira et al., 2019</xref>). Maximum likelihood tree reconstruction is performed using IQ-TREE version 1.6.12 (<xref ref-type="bibr" rid="bib41">Nguyen et al., 2015</xref>) with the ModelFinder Plus option (<xref ref-type="bibr" rid="bib27">Kalyaanamoorthy et al., 2017</xref>). For the <italic>Csrp</italic> tree, we perform 1000 nonparametric bootstrap replicates to assess node support. For <italic>Fox</italic>, we utilize the ultrafast bootstrap support option with 1000 replicates. For each gene tree we choose the model that minimizes the Bayesian Information Criterion (BIC) score in ModelFinder. This results in selection of the following models: DCMut+R4 (<italic>Csrp</italic>) and VT+F + R5 (<italic>Fox</italic>). The final consensus trees are visualized and rendered using the ETE3 v3.1.1 python toolkit (<xref ref-type="bibr" rid="bib24">Huerta-Cepas et al., 2016</xref>) and the Interactive Tree of Life v4 (<xref ref-type="bibr" rid="bib32">Letunic and Bork, 2019</xref>).</p></sec><sec id="s4-9"><title>KOG functional annotation and enrichment analysis</title><p>Using the eggNOG mapper, KOG functional annotations are transferred to individual transcripts from their assigned orthology group. For enrichment analysis, all genes enriched in the set of cell type pairs of interest are lumped to form the target set for each species. For example, the target set for <italic>Spongilla</italic> archaeocytes used in <xref ref-type="fig" rid="fig6">Figure 6C</xref> is composed of all genes enriched between <italic>Spongilla</italic> archaeocytes and other invertebrate stem cells. Note that this set includes genes from other species that are linked by SAMap to the <italic>Spongilla</italic> archeocyte genes. We include genes from other species in the target set to account for differences in KOG functional annotation coverage between species. As such, the annotated transcripts from all seven species are combined to form the background set. We use a hypergeometric statistical test (<xref ref-type="bibr" rid="bib15">Eden et al., 2009</xref>) to measure the enrichment of the KOG terms in the target genes compared to the background genes.</p></sec><sec id="s4-10"><title>Mapping zebrafish and <italic>Xenopus</italic> atlases using existing methods</title><p>For benchmarking, we use vertebrate orthologs as determined by eggNOG as input to Harmony (<xref ref-type="bibr" rid="bib28">Korsunsky et al., 2019</xref>), LIGER (<xref ref-type="bibr" rid="bib69">Welch et al., 2019</xref>), Seurat (<xref ref-type="bibr" rid="bib57">Stuart et al., 2019</xref>), Scanorama (<xref ref-type="bibr" rid="bib22">Hie et al., 2019</xref>), BBKNN (<xref ref-type="bibr" rid="bib45">Polański et al., 2019</xref>), which are all run with default parameters. One-to-one orthologs are selected from one-to-many and many-to-many orthologs by using the bipartite maximum weight matching algorithm implemented in <italic>networkx</italic>. When using the one-to-one orthologs as input for SAMap, we run for only one iteration. The resulting integrated lower-dimensional coordinates (PCs for Seurat, Harmony, and Scanorama and non-negative matrix factorization coordinates for LIGER) and stitched graphs (BBKNN and SAMap) are all projected into 2D with UMAP (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1A</xref>). The integrated coordinates are used to generate a nearest neighbor graph using the correlation distance metric, which is then used to compute the alignment scores in <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1B</xref>. The alignment scores for SAMap and BBKNN are directly computed from their combined graphs.</p></sec><sec id="s4-11"><title>In situ hybridization in schistosomes</title><p><italic>S. mansoni</italic> (strain: NMRI) juveniles are retrieved from infected female Swiss Webster mice (NR-21963) at ~3 weeks post-infection by hepatic portal vein perfusion using 37°C DMEM supplemented with 5% heat inactivated FBS. The infected mice are provided by the NIAID Schistosomiasis Resource Center for distribution through BEI Resources, NIH-NIAID Contract HHSN272201000005I. In adherence to the Animal Welfare Act and the Public Health Service Policy on Humane Care and Use of Laboratory Animals, all experiments with and care of mice are performed in accordance with protocols approved by the Institutional Animal Care and Use Committees (IACUC) of Stanford University (protocol approval number 30366). In situ hybridization experiments are performed as described previously (<xref ref-type="bibr" rid="bib60">Tarashansky et al., 2019</xref>), using riboprobes synthesized from gene fragments cloned with the listed primers: collagen (Smp_170340): <named-content content-type="sequence">GGTGAAGAAGGCTGTTGTGG</named-content>, <named-content content-type="sequence">ACGATCCCCTTTCACTCCTG</named-content>; tropomyosin (Smp_031770): <named-content content-type="sequence">AAGCTGAAGTCGCCTCACTA</named-content>, <named-content content-type="sequence">CATATGCCTCTTCACGCTGG</named-content>; troponin (Smp_018250): <named-content content-type="sequence">CGTAAACCTGGTCAGAAGCG</named-content>, <named-content content-type="sequence">ATCCTTTTCCTCCAGAGCGT</named-content>; myosin regulatory light chain (Smp_132670): <named-content content-type="sequence">GAGACAGCGAGTAGTGGAGG</named-content>, <named-content content-type="sequence">TGCCTTCTTTGATTGGAGCT</named-content>; wnt11 (Smp_156540): <named-content content-type="sequence">TGTGGTGATGAAGATGGCAG</named-content>, <named-content content-type="sequence">CCACGGCCACAACACATATT</named-content>; frizzled (Smp_174350): <named-content content-type="sequence">CGAACAGGCGCATGACAATA</named-content>, <named-content content-type="sequence">TGCTAGTCCTGTTGTCGTGT</named-content>.</p></sec></sec></body><back><ack id="ack"><title>Acknowledgements</title><p>We thank D Wagner and C Juliano for sharing data and essential discussions. We also thank S Granick, L Luo, and J Kebschull for their critical reading of the manuscript. AJT is a Bio-X Stanford Interdisciplinary Graduate Fellow. JM and DA thank the support from an Advanced grant of the European Commission (‘NeuralCellTypeEvo’ 788921). This work is supported by a Beckman Young Investigator Award and an NIH grant (1R35GM138061) to BW.</p></ack><sec id="s5" sec-type="additional-information"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="COI-statement" id="conf1"><p>No competing interests declared</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>Conceptualization, Data curation, Software, Formal analysis, Validation, Investigation, Visualization, Methodology, Writing - original draft, Writing - review and editing</p></fn><fn fn-type="con" id="con2"><p>Data curation, Formal analysis, Investigation, Writing - review and editing</p></fn><fn fn-type="con" id="con3"><p>Visualization, Writing - review and editing</p></fn><fn fn-type="con" id="con4"><p>Investigation</p></fn><fn fn-type="con" id="con5"><p>Supervision, Writing - review and editing</p></fn><fn fn-type="con" id="con6"><p>Supervision, Writing - review and editing</p></fn><fn fn-type="con" id="con7"><p>Conceptualization, Supervision, Investigation, Writing - original draft, Writing - review and editing, Project administration</p></fn></fn-group><fn-group content-type="ethics-information"><title>Ethics</title><fn fn-type="other"><p>Animal experimentation: All experiments with and care of mice are performed in accordance with protocols approved by the Institutional Animal Care and Use Committees (IACUC) of Stanford University (protocol approval number 30366).</p></fn></fn-group></sec><sec id="s6" sec-type="supplementary-material"><title>Additional files</title><supplementary-material id="supp1"><label>Supplementary file 1.</label><caption><title>Cell atlas metadata and cell annotations.</title><p>Metadata include the number of cells, number of transcripts in the transcriptome, median number of transcripts detected per cell, the reference transcriptome used in this study, database through which the transcriptomes are provided, technology used for constructing the cell atlases, atlas data accessions, processing notes, and references. Leiden clusters and cell type annotations are reported for cells in each atlas. The Zebrafish and <italic>Xenopus</italic> tables include both the original cell type annotations and those used in this study. <italic>D. rerio</italic>, <italic>X. tropicalis</italic>, and mouse annotations include developmental stages.</p></caption><media mime-subtype="xlsx" mimetype="application" xlink:href="elife-66747-supp1-v2.xlsx"/></supplementary-material><supplementary-material id="supp2"><label>Supplementary file 2.</label><caption><title>Cell type annotations for the zebrafish-<italic>Xenopus</italic> mapping.</title><p>Correspondence between the cell type annotations provided in the original study (<xref ref-type="bibr" rid="bib9">Briggs et al., 2018</xref>; <xref ref-type="bibr" rid="bib66">Wagner et al., 2018</xref>) and corresponding annotations used in this study is provided for both <italic>D. rerio</italic> and <italic>X. tropicalis</italic> atlases.</p></caption><media mime-subtype="xlsx" mimetype="application" xlink:href="elife-66747-supp2-v2.xlsx"/></supplementary-material><supplementary-material id="supp3"><label>Supplementary file 3.</label><caption><title>Mapping of zebrafish-<italic>Xenopus</italic> atlases with individual cell types removed.</title><p>The two highest-scoring partners are reported for each cell type in the original mapping and the mapping after its homolog was removed. The new mappings are categorized as being present in the original analysis, not present in the original analysis but connecting developmentally related cells, or neither.</p></caption><media mime-subtype="xlsx" mimetype="application" xlink:href="elife-66747-supp3-v2.xlsx"/></supplementary-material><supplementary-material id="supp4"><label>Supplementary file 4.</label><caption><title>Identified paralogs with greater expression similarity than orthologs in the zebrafish-<italic>Xenopus</italic> mapping.</title><p>Each row contains a pair of vertebrate-orthologous genes and a corresponding pair of eukaryotic paralogs with higher correlation in expression compared to the orthologs, the expression correlations for ortholog and paralog pairs, the difference between their correlations, the paralogs’ last common ancestor, and the cell types in which the genes are enriched. Highlighted rows are shown in <xref ref-type="fig" rid="fig3">Figure 3A</xref>.</p></caption><media mime-subtype="xlsx" mimetype="application" xlink:href="elife-66747-supp4-v2.xlsx"/></supplementary-material><supplementary-material id="supp5"><label>Supplementary file 5.</label><caption><title>Genes enriched in contractile cell types and invertebrate stem cells highlighted in <xref ref-type="fig" rid="fig6">Figure 6</xref>.</title><p>The IDs of the genes enriched in the contractile and invertebrate stem cell types are provided along with the IDs of the eggNOG orthology groups to which they belong. In cases where multiple genes from a species belonging to the same orthology group are enriched, the most differentially expressed gene is shown. The descriptions in the stem cell table are orthology annotations associated with the <italic>Spongilla</italic> genes provided in the original study (<xref ref-type="bibr" rid="bib38">Musser et al., 2019</xref>).</p></caption><media mime-subtype="xlsx" mimetype="application" xlink:href="elife-66747-supp5-v2.xlsx"/></supplementary-material><supplementary-material id="supp6"><label>Supplementary file 6.</label><caption><title>Transcript IDs corresponding to the multipotent stem cell enriched genes shown in <xref ref-type="fig" rid="fig6">Figure 6D</xref>.</title></caption><media mime-subtype="xlsx" mimetype="application" xlink:href="elife-66747-supp6-v2.xlsx"/></supplementary-material><supplementary-material id="supp7"><label>Supplementary file 7.</label><caption><title>Cell types in the cell type families shown in <xref ref-type="fig" rid="fig5">Figure 5C</xref>.</title><p>For the schistosome cell types, we annotate two neural clusters, both of which express the neural marker <italic>complexin</italic> (<xref ref-type="bibr" rid="bib33">Li et al., 2021</xref>). One of the clusters expresses the antigen <italic>SmKK7</italic>, so we label the clusters ‘Neural’ and ‘Neural_KK7’, respectively. The ‘Muscle’ population contains non-stem cells expressing <italic>troponin</italic>. The ‘Tegument_prog’ and ‘Tegument’ populations consist of cells expressing tegument progenitor and differentiated marker genes, respectively, as reported in a previous study (<xref ref-type="bibr" rid="bib70">Wendt et al., 2018</xref>).</p></caption><media mime-subtype="xlsx" mimetype="application" xlink:href="elife-66747-supp7-v2.xlsx"/></supplementary-material><supplementary-material id="transrepform"><label>Transparent reporting form</label><media mime-subtype="docx" mimetype="application" xlink:href="elife-66747-transrepform-v2.docx"/></supplementary-material></sec><sec id="s7" sec-type="data-availability"><title>Data availability</title><p>All data analyzed during this study are available through various sources as listed in Supplementary file 1.</p><p>The following previously published datasets were used:</p><p><element-citation id="dataset1" publication-type="data" specific-use="references"><person-group person-group-type="author"><name><surname>Musser</surname><given-names>JM</given-names></name></person-group><year iso-8601-date="2019">2019</year><data-title>Whole-body single-cell RNA sequencing reveals components of elementary neural circuits in a sponge</data-title><source>NCBI Gene Expression Omnibus</source><pub-id assigning-authority="NCBI" pub-id-type="accession" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE134912">GSE134912</pub-id></element-citation></p><p><element-citation id="dataset2" publication-type="data" specific-use="references"><person-group person-group-type="author"><name><surname>Siebert</surname><given-names>S</given-names></name><name><surname>Cazet</surname><given-names>J</given-names></name><name><surname>Farrell</surname><given-names>JA</given-names></name></person-group><year iso-8601-date="2018">2018</year><data-title>Stem cell differentiation trajectories in Hydra resolved at single cell resolution</data-title><source>NCBI Gene Expression Omnibus</source><pub-id assigning-authority="NCBI" pub-id-type="accession" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE121617">GSE121617</pub-id></element-citation></p><p><element-citation id="dataset3" publication-type="data" specific-use="references"><person-group person-group-type="author"><name><surname>Fincher</surname><given-names>CT</given-names></name><name><surname>Wurtzel</surname><given-names>O</given-names></name><name><surname>de</surname><given-names>Hoog T</given-names></name><name><surname>Kravarik</surname><given-names>KM</given-names></name><name><surname>Reddien</surname><given-names>PW</given-names></name></person-group><year iso-8601-date="2018">2018</year><data-title>Cell type transcriptome atlas for the planarian Schmidtea mediterranea</data-title><source>NCBI Gene Expression Omnibus</source><pub-id assigning-authority="NCBI" pub-id-type="accession" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE111764">GSE111764</pub-id></element-citation></p><p><element-citation id="dataset4" publication-type="data" specific-use="references"><person-group person-group-type="author"><name><surname>Zeng</surname><given-names>A</given-names></name><name><surname>Li</surname><given-names>H</given-names></name><name><surname>Sánchez Alvarado</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2017">2017</year><data-title>Tetraspanin family member functionally resolves and facilitates the purification of adult pluripotent stem cells used for whole-body regeneration</data-title><source>NCBI Gene Expression Omnibus</source><pub-id assigning-authority="NCBI" pub-id-type="accession" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE107873">GSE107873</pub-id></element-citation></p><p><element-citation id="dataset5" publication-type="data" specific-use="references"><person-group person-group-type="author"><name><surname>Xue</surname><given-names>Y</given-names></name><name><surname>Li</surname><given-names>P</given-names></name><name><surname>Quake</surname><given-names>SR</given-names></name><name><surname>Wang</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2020">2020</year><data-title>Single-cell analysis reveals regulation of germline stem cell fate in the human parasite Schistosoma mansoni</data-title><source>NCBI Gene Expression Omnibus</source><pub-id assigning-authority="NCBI" pub-id-type="accession" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE147355">GSE147355</pub-id></element-citation></p><p><element-citation id="dataset6" publication-type="data" specific-use="references"><person-group person-group-type="author"><name><surname>Wagner</surname><given-names>DE</given-names></name><name><surname>Weinreb</surname><given-names>C</given-names></name><name><surname>Collins</surname><given-names>ZM</given-names></name><name><surname>Megason</surname><given-names>SG</given-names></name><name><surname>Klein</surname><given-names>AM</given-names></name></person-group><year iso-8601-date="2018">2018</year><data-title>Systematic mapping of cell state trajectories, cell lineage, and perturbations in the zebrafish embryo using single cell transcriptomics</data-title><source>NCBI Gene Expression Omnibus</source><pub-id assigning-authority="NCBI" pub-id-type="accession" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE112294">GSE112294</pub-id></element-citation></p><p><element-citation id="dataset7" publication-type="data" specific-use="references"><person-group person-group-type="author"><name><surname>Briggs</surname><given-names>JA</given-names></name><name><surname>Weinreb</surname><given-names>C</given-names></name><name><surname>Wagner</surname><given-names>DE</given-names></name><name><surname>Megason</surname><given-names>S</given-names></name><name><surname>Peshkin</surname><given-names>L</given-names></name><name><surname>Kirschner</surname><given-names>MW</given-names></name><name><surname>Klein</surname><given-names>AM</given-names></name></person-group><year iso-8601-date="2018">2018</year><data-title>The dynamics of gene expression in vertebrate embryogenesis at single cell resolution</data-title><source>NCBI Gene Expression Omnibus</source><pub-id assigning-authority="NCBI" pub-id-type="accession" xlink:href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE113074">GSE113074</pub-id></element-citation></p><p><element-citation id="dataset8" publication-type="data" specific-use="references"><person-group person-group-type="author"><name><surname>Griffiths</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2018">2018</year><data-title>Embryo Timecourse</data-title><source>Github</source><pub-id assigning-authority="other" pub-id-type="accession" xlink:href="https://github.com/MarioniLab/EmbryoTimecourse2018">ab59525</pub-id></element-citation></p></sec><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Alié</surname> <given-names>A</given-names></name><name><surname>Hayashi</surname> <given-names>T</given-names></name><name><surname>Sugimura</surname> <given-names>I</given-names></name><name><surname>Manuel</surname> <given-names>M</given-names></name><name><surname>Sugano</surname> <given-names>W</given-names></name><name><surname>Mano</surname> <given-names>A</given-names></name><name><surname>Satoh</surname> <given-names>N</given-names></name><name><surname>Agata</surname> <given-names>K</given-names></name><name><surname>Funayama</surname> <given-names>N</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>The ancestral gene repertoire of animal stem cells</article-title><source>PNAS</source><volume>112</volume><fpage>E7093</fpage><lpage>E7100</lpage><pub-id pub-id-type="doi">10.1073/pnas.1514789112</pub-id><pub-id pub-id-type="pmid">26644562</pub-id></element-citation></ref><ref id="bib2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Arendt</surname> <given-names>D</given-names></name><name><surname>Musser</surname> <given-names>JM</given-names></name><name><surname>Baker</surname> <given-names>CVH</given-names></name><name><surname>Bergman</surname> <given-names>A</given-names></name><name><surname>Cepko</surname> <given-names>C</given-names></name><name><surname>Erwin</surname> <given-names>DH</given-names></name><name><surname>Pavlicev</surname> <given-names>M</given-names></name><name><surname>Schlosser</surname> <given-names>G</given-names></name><name><surname>Widder</surname> <given-names>S</given-names></name><name><surname>Laubichler</surname> <given-names>MD</given-names></name><name><surname>Wagner</surname> <given-names>GP</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>The origin and evolution of cell types</article-title><source>Nature Reviews Genetics</source><volume>17</volume><fpage>744</fpage><lpage>757</lpage><pub-id pub-id-type="doi">10.1038/nrg.2016.127</pub-id><pub-id pub-id-type="pmid">27818507</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Arendt</surname> <given-names>D</given-names></name><name><surname>Bertucci</surname> <given-names>PY</given-names></name><name><surname>Achim</surname> <given-names>K</given-names></name><name><surname>Musser</surname> <given-names>JM</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Evolution of neuronal types and families</article-title><source>Current Opinion in Neurobiology</source><volume>56</volume><fpage>144</fpage><lpage>152</lpage><pub-id pub-id-type="doi">10.1016/j.conb.2019.01.022</pub-id><pub-id pub-id-type="pmid">30826503</pub-id></element-citation></ref><ref id="bib4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Barkas</surname> <given-names>N</given-names></name><name><surname>Petukhov</surname> <given-names>V</given-names></name><name><surname>Nikolaeva</surname> <given-names>D</given-names></name><name><surname>Lozinsky</surname> <given-names>Y</given-names></name><name><surname>Demharter</surname> <given-names>S</given-names></name><name><surname>Khodosevich</surname> <given-names>K</given-names></name><name><surname>Kharchenko</surname> <given-names>PV</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Joint analysis of heterogeneous single-cell RNA-seq dataset collections</article-title><source>Nature Methods</source><volume>16</volume><fpage>695</fpage><lpage>698</lpage><pub-id pub-id-type="doi">10.1038/s41592-019-0466-z</pub-id><pub-id pub-id-type="pmid">31308548</pub-id></element-citation></ref><ref id="bib5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Baron</surname> <given-names>M</given-names></name><name><surname>Veres</surname> <given-names>A</given-names></name><name><surname>Wolock</surname> <given-names>SL</given-names></name><name><surname>Faust</surname> <given-names>AL</given-names></name><name><surname>Gaujoux</surname> <given-names>R</given-names></name><name><surname>Vetere</surname> <given-names>A</given-names></name><name><surname>Ryu</surname> <given-names>JH</given-names></name><name><surname>Wagner</surname> <given-names>BK</given-names></name><name><surname>Shen-Orr</surname> <given-names>SS</given-names></name><name><surname>Klein</surname> <given-names>AM</given-names></name><name><surname>Melton</surname> <given-names>DA</given-names></name><name><surname>Yanai</surname> <given-names>I</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>A single-cell transcriptomic map of the human and mouse pancreas reveals inter- and intra-cell population structure</article-title><source>Cell Systems</source><volume>3</volume><fpage>346</fpage><lpage>360</lpage><pub-id pub-id-type="doi">10.1016/j.cels.2016.08.011</pub-id><pub-id pub-id-type="pmid">27667365</pub-id></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bennett</surname> <given-names>JT</given-names></name><name><surname>Joubin</surname> <given-names>K</given-names></name><name><surname>Cheng</surname> <given-names>S</given-names></name><name><surname>Aanstad</surname> <given-names>P</given-names></name><name><surname>Herwig</surname> <given-names>R</given-names></name><name><surname>Clark</surname> <given-names>M</given-names></name><name><surname>Lehrach</surname> <given-names>H</given-names></name><name><surname>Schier</surname> <given-names>AF</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Nodal signaling activates differentiation genes during zebrafish gastrulation</article-title><source>Developmental Biology</source><volume>304</volume><fpage>525</fpage><lpage>540</lpage><pub-id pub-id-type="doi">10.1016/j.ydbio.2007.01.012</pub-id><pub-id pub-id-type="pmid">17306247</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Betancur</surname> <given-names>P</given-names></name><name><surname>Sauka-Spengler</surname> <given-names>T</given-names></name><name><surname>Bronner</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>A Sox10 enhancer element common to the otic placode and neural crest is activated by tissue-specific paralogs</article-title><source>Development</source><volume>138</volume><fpage>3689</fpage><lpage>3698</lpage><pub-id pub-id-type="doi">10.1242/dev.057836</pub-id><pub-id pub-id-type="pmid">21775416</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bialkowska</surname> <given-names>AB</given-names></name><name><surname>Yang</surname> <given-names>VW</given-names></name><name><surname>Mallipattu</surname> <given-names>SK</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Krüppel-like factors in mammalian stem cells and development</article-title><source>Development</source><volume>144</volume><fpage>737</fpage><lpage>754</lpage><pub-id pub-id-type="doi">10.1242/dev.145441</pub-id><pub-id pub-id-type="pmid">28246209</pub-id></element-citation></ref><ref id="bib9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Briggs</surname> <given-names>JA</given-names></name><name><surname>Weinreb</surname> <given-names>C</given-names></name><name><surname>Wagner</surname> <given-names>DE</given-names></name><name><surname>Megason</surname> <given-names>S</given-names></name><name><surname>Peshkin</surname> <given-names>L</given-names></name><name><surname>Kirschner</surname> <given-names>MW</given-names></name><name><surname>Klein</surname> <given-names>AM</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>The dynamics of gene expression in vertebrate embryogenesis at single-cell resolution</article-title><source>Science</source><volume>360</volume><elocation-id>eaar5780</elocation-id><pub-id pub-id-type="doi">10.1126/science.aar5780</pub-id><pub-id pub-id-type="pmid">29700227</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Brunet</surname> <given-names>T</given-names></name><name><surname>Fischer</surname> <given-names>AH</given-names></name><name><surname>Steinmetz</surname> <given-names>PR</given-names></name><name><surname>Lauri</surname> <given-names>A</given-names></name><name><surname>Bertucci</surname> <given-names>P</given-names></name><name><surname>Arendt</surname> <given-names>D</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>The evolutionary origin of bilaterian smooth and striated myocytes</article-title><source>eLife</source><volume>5</volume><elocation-id>e19607</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.19607</pub-id><pub-id pub-id-type="pmid">27906129</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Buzgariu</surname> <given-names>W</given-names></name><name><surname>Al Haddad</surname> <given-names>S</given-names></name><name><surname>Tomczyk</surname> <given-names>S</given-names></name><name><surname>Wenger</surname> <given-names>Y</given-names></name><name><surname>Galliot</surname> <given-names>B</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Multi-functionality and plasticity characterize epithelial cells in <italic>Hydra</italic></article-title><source>Tissue Barriers</source><volume>3</volume><elocation-id>e1068908</elocation-id><pub-id pub-id-type="doi">10.1080/21688370.2015.1068908</pub-id><pub-id pub-id-type="pmid">26716072</pub-id></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cao</surname> <given-names>C</given-names></name><name><surname>Lemaire</surname> <given-names>LA</given-names></name><name><surname>Wang</surname> <given-names>W</given-names></name><name><surname>Yoon</surname> <given-names>PH</given-names></name><name><surname>Choi</surname> <given-names>YA</given-names></name><name><surname>Parsons</surname> <given-names>LR</given-names></name><name><surname>Matese</surname> <given-names>JC</given-names></name><name><surname>Wang</surname> <given-names>W</given-names></name><name><surname>Levine</surname> <given-names>M</given-names></name><name><surname>Chen</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Comprehensive single-cell transcriptome lineages of a proto-vertebrate</article-title><source>Nature</source><volume>571</volume><fpage>349</fpage><lpage>354</lpage><pub-id pub-id-type="doi">10.1038/s41586-019-1385-y</pub-id><pub-id pub-id-type="pmid">31292549</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dubaissi</surname> <given-names>E</given-names></name><name><surname>Rousseau</surname> <given-names>K</given-names></name><name><surname>Lea</surname> <given-names>R</given-names></name><name><surname>Soto</surname> <given-names>X</given-names></name><name><surname>Nardeosingh</surname> <given-names>S</given-names></name><name><surname>Schweickert</surname> <given-names>A</given-names></name><name><surname>Amaya</surname> <given-names>E</given-names></name><name><surname>Thornton</surname> <given-names>DJ</given-names></name><name><surname>Papalopulu</surname> <given-names>N</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>A secretory cell type develops alongside multiciliated cells, ionocytes and goblet cells, and provides a protective, anti-infective function in the frog embryonic mucociliary epidermis</article-title><source>Development</source><volume>141</volume><fpage>1514</fpage><lpage>1525</lpage><pub-id pub-id-type="doi">10.1242/dev.102426</pub-id><pub-id pub-id-type="pmid">24598166</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Eddy</surname> <given-names>SR</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>A probabilistic model of local sequence alignment that simplifies statistical significance estimation</article-title><source>PLOS Computational Biology</source><volume>4</volume><elocation-id>e1000069</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1000069</pub-id><pub-id pub-id-type="pmid">18516236</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Eden</surname> <given-names>E</given-names></name><name><surname>Navon</surname> <given-names>R</given-names></name><name><surname>Steinfeld</surname> <given-names>I</given-names></name><name><surname>Lipson</surname> <given-names>D</given-names></name><name><surname>Yakhini</surname> <given-names>Z</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>GOrilla: a tool for discovery and visualization of enriched GO terms in ranked gene lists</article-title><source>BMC Bioinformatics</source><volume>10</volume><elocation-id>48</elocation-id><pub-id pub-id-type="doi">10.1186/1471-2105-10-48</pub-id><pub-id pub-id-type="pmid">19192299</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>El-Brolosy</surname> <given-names>MA</given-names></name><name><surname>Kontarakis</surname> <given-names>Z</given-names></name><name><surname>Rossi</surname> <given-names>A</given-names></name><name><surname>Kuenne</surname> <given-names>C</given-names></name><name><surname>Günther</surname> <given-names>S</given-names></name><name><surname>Fukuda</surname> <given-names>N</given-names></name><name><surname>Kikhi</surname> <given-names>K</given-names></name><name><surname>Boezio</surname> <given-names>GLM</given-names></name><name><surname>Takacs</surname> <given-names>CM</given-names></name><name><surname>Lai</surname> <given-names>SL</given-names></name><name><surname>Fukuda</surname> <given-names>R</given-names></name><name><surname>Gerri</surname> <given-names>C</given-names></name><name><surname>Giraldez</surname> <given-names>AJ</given-names></name><name><surname>Stainier</surname> <given-names>DYR</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Genetic compensation triggered by mutant mRNA degradation</article-title><source>Nature</source><volume>568</volume><fpage>193</fpage><lpage>197</lpage><pub-id pub-id-type="doi">10.1038/s41586-019-1064-z</pub-id><pub-id pub-id-type="pmid">30944477</pub-id></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Erwin</surname> <given-names>DH</given-names></name><name><surname>Davidson</surname> <given-names>EH</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>The evolution of hierarchical gene regulatory networks</article-title><source>Nature Reviews Genetics</source><volume>10</volume><fpage>141</fpage><lpage>148</lpage><pub-id pub-id-type="doi">10.1038/nrg2499</pub-id><pub-id pub-id-type="pmid">19139764</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fincher</surname> <given-names>CT</given-names></name><name><surname>Wurtzel</surname> <given-names>O</given-names></name><name><surname>de Hoog</surname> <given-names>T</given-names></name><name><surname>Kravarik</surname> <given-names>KM</given-names></name><name><surname>Reddien</surname> <given-names>PW</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Cell type transcriptome atlas for the planarian <italic>Schmidtea mediterranea</italic></article-title><source>Science</source><volume>360</volume><elocation-id>eaaq1736</elocation-id><pub-id pub-id-type="doi">10.1126/science.aaq1736</pub-id><pub-id pub-id-type="pmid">29674431</pub-id></element-citation></ref><ref id="bib19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gabaldón</surname> <given-names>T</given-names></name><name><surname>Koonin</surname> <given-names>EV</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Functional and evolutionary implications of gene orthology</article-title><source>Nature Reviews Genetics</source><volume>14</volume><fpage>360</fpage><lpage>366</lpage><pub-id pub-id-type="doi">10.1038/nrg3456</pub-id><pub-id pub-id-type="pmid">23552219</pub-id></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Geirsdottir</surname> <given-names>L</given-names></name><name><surname>David</surname> <given-names>E</given-names></name><name><surname>Keren-Shaul</surname> <given-names>H</given-names></name><name><surname>Weiner</surname> <given-names>A</given-names></name><name><surname>Bohlen</surname> <given-names>SC</given-names></name><name><surname>Neuber</surname> <given-names>J</given-names></name><name><surname>Balic</surname> <given-names>A</given-names></name><name><surname>Giladi</surname> <given-names>A</given-names></name><name><surname>Sheban</surname> <given-names>F</given-names></name><name><surname>Dutertre</surname> <given-names>CA</given-names></name><name><surname>Pfeifle</surname> <given-names>C</given-names></name><name><surname>Peri</surname> <given-names>F</given-names></name><name><surname>Raffo-Romero</surname> <given-names>A</given-names></name><name><surname>Vizioli</surname> <given-names>J</given-names></name><name><surname>Matiasek</surname> <given-names>K</given-names></name><name><surname>Scheiwe</surname> <given-names>C</given-names></name><name><surname>Meckel</surname> <given-names>S</given-names></name><name><surname>Mätz-Rensing</surname> <given-names>K</given-names></name><name><surname>van der Meer</surname> <given-names>F</given-names></name><name><surname>Thormodsson</surname> <given-names>FR</given-names></name><name><surname>Stadelmann</surname> <given-names>C</given-names></name><name><surname>Zilkha</surname> <given-names>N</given-names></name><name><surname>Kimchi</surname> <given-names>T</given-names></name><name><surname>Ginhoux</surname> <given-names>F</given-names></name><name><surname>Ulitsky</surname> <given-names>I</given-names></name><name><surname>Erny</surname> <given-names>D</given-names></name><name><surname>Amit</surname> <given-names>I</given-names></name><name><surname>Prinz</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Cross-species single-cell analysis reveals divergence of the primate microglia program</article-title><source>Cell</source><volume>179</volume><fpage>1609</fpage><lpage>1622</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2019.11.010</pub-id><pub-id pub-id-type="pmid">31835035</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Haghverdi</surname> <given-names>L</given-names></name><name><surname>Lun</surname> <given-names>ATL</given-names></name><name><surname>Morgan</surname> <given-names>MD</given-names></name><name><surname>Marioni</surname> <given-names>JC</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Batch effects in single-cell RNA-sequencing data are corrected by matching mutual nearest neighbors</article-title><source>Nature Biotechnology</source><volume>36</volume><fpage>421</fpage><lpage>427</lpage><pub-id pub-id-type="doi">10.1038/nbt.4091</pub-id><pub-id pub-id-type="pmid">29608177</pub-id></element-citation></ref><ref id="bib22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hie</surname> <given-names>B</given-names></name><name><surname>Bryson</surname> <given-names>B</given-names></name><name><surname>Berger</surname> <given-names>B</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Efficient integration of heterogeneous single-cell transcriptomes using Scanorama</article-title><source>Nature Biotechnology</source><volume>37</volume><fpage>685</fpage><lpage>691</lpage><pub-id pub-id-type="doi">10.1038/s41587-019-0113-3</pub-id><pub-id pub-id-type="pmid">31061482</pub-id></element-citation></ref><ref id="bib23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hu</surname> <given-names>M</given-names></name><name><surname>Zheng</surname> <given-names>X</given-names></name><name><surname>Fan</surname> <given-names>CM</given-names></name><name><surname>Zheng</surname> <given-names>Y</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Lineage dynamics of the endosymbiotic cell type in the soft coral <italic>Xenia</italic></article-title><source>Nature</source><volume>582</volume><fpage>534</fpage><lpage>538</lpage><pub-id pub-id-type="doi">10.1038/s41586-020-2385-7</pub-id><pub-id pub-id-type="pmid">32555454</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Huerta-Cepas</surname> <given-names>J</given-names></name><name><surname>Serra</surname> <given-names>F</given-names></name><name><surname>Bork</surname> <given-names>P</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>ETE 3: reconstruction, analysis, and visualization of phylogenomic data</article-title><source>Molecular Biology and Evolution</source><volume>33</volume><fpage>1635</fpage><lpage>1638</lpage><pub-id pub-id-type="doi">10.1093/molbev/msw046</pub-id><pub-id pub-id-type="pmid">26921390</pub-id></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Huerta-Cepas</surname> <given-names>J</given-names></name><name><surname>Szklarczyk</surname> <given-names>D</given-names></name><name><surname>Heller</surname> <given-names>D</given-names></name><name><surname>Hernández-Plaza</surname> <given-names>A</given-names></name><name><surname>Forslund</surname> <given-names>SK</given-names></name><name><surname>Cook</surname> <given-names>H</given-names></name><name><surname>Mende</surname> <given-names>DR</given-names></name><name><surname>Letunic</surname> <given-names>I</given-names></name><name><surname>Rattei</surname> <given-names>T</given-names></name><name><surname>Jensen</surname> <given-names>LJ</given-names></name><name><surname>von Mering</surname> <given-names>C</given-names></name><name><surname>Bork</surname> <given-names>P</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>eggNOG 5.0: a hierarchical, functionally and phylogenetically annotated orthology resource based on 5090 organisms and 2502 viruses</article-title><source>Nucleic Acids Research</source><volume>47</volume><fpage>D309</fpage><lpage>D314</lpage><pub-id pub-id-type="doi">10.1093/nar/gky1085</pub-id><pub-id pub-id-type="pmid">30418610</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Janicke</surname> <given-names>M</given-names></name><name><surname>Renisch</surname> <given-names>B</given-names></name><name><surname>Hammerschmidt</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Zebrafish grainyhead-like1 is a common marker of different non-keratinocyte epidermal cell lineages, which segregate from each other in a Foxi3-dependent manner</article-title><source>The International Journal of Developmental Biology</source><volume>54</volume><fpage>837</fpage><lpage>850</lpage><pub-id pub-id-type="doi">10.1387/ijdb.092877mj</pub-id><pub-id pub-id-type="pmid">19757382</pub-id></element-citation></ref><ref id="bib27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kalyaanamoorthy</surname> <given-names>S</given-names></name><name><surname>Minh</surname> <given-names>BQ</given-names></name><name><surname>Wong</surname> <given-names>TKF</given-names></name><name><surname>von Haeseler</surname> <given-names>A</given-names></name><name><surname>Jermiin</surname> <given-names>LS</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>ModelFinder: fast model selection for accurate phylogenetic estimates</article-title><source>Nature Methods</source><volume>14</volume><fpage>587</fpage><lpage>589</lpage><pub-id pub-id-type="doi">10.1038/nmeth.4285</pub-id><pub-id pub-id-type="pmid">28481363</pub-id></element-citation></ref><ref id="bib28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Korsunsky</surname> <given-names>I</given-names></name><name><surname>Millard</surname> <given-names>N</given-names></name><name><surname>Fan</surname> <given-names>J</given-names></name><name><surname>Slowikowski</surname> <given-names>K</given-names></name><name><surname>Zhang</surname> <given-names>F</given-names></name><name><surname>Wei</surname> <given-names>K</given-names></name><name><surname>Baglaenko</surname> <given-names>Y</given-names></name><name><surname>Brenner</surname> <given-names>M</given-names></name><name><surname>Loh</surname> <given-names>PR</given-names></name><name><surname>Raychaudhuri</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Fast, sensitive and accurate integration of single-cell data with harmony</article-title><source>Nature Methods</source><volume>16</volume><fpage>1289</fpage><lpage>1296</lpage><pub-id pub-id-type="doi">10.1038/s41592-019-0619-0</pub-id><pub-id pub-id-type="pmid">31740819</pub-id></element-citation></ref><ref id="bib29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kurauchi</surname> <given-names>T</given-names></name><name><surname>Izutsu</surname> <given-names>Y</given-names></name><name><surname>Maéno</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Involvement of Neptune in induction of the hatching gland and neural crest in the <italic>Xenopus</italic> embryo</article-title><source>Differentiation</source><volume>79</volume><fpage>251</fpage><lpage>259</lpage><pub-id pub-id-type="doi">10.1016/j.diff.2010.01.003</pub-id><pub-id pub-id-type="pmid">20172647</pub-id></element-citation></ref><ref id="bib30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Larroux</surname> <given-names>C</given-names></name><name><surname>Luke</surname> <given-names>GN</given-names></name><name><surname>Koopman</surname> <given-names>P</given-names></name><name><surname>Rokhsar</surname> <given-names>DS</given-names></name><name><surname>Shimeld</surname> <given-names>SM</given-names></name><name><surname>Degnan</surname> <given-names>BM</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Genesis and expansion of metazoan transcription factor gene classes</article-title><source>Molecular Biology and Evolution</source><volume>25</volume><fpage>980</fpage><lpage>996</lpage><pub-id pub-id-type="doi">10.1093/molbev/msn047</pub-id><pub-id pub-id-type="pmid">18296413</pub-id></element-citation></ref><ref id="bib31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Laumer</surname> <given-names>CE</given-names></name><name><surname>Hejnol</surname> <given-names>A</given-names></name><name><surname>Giribet</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Nuclear genomic signals of the ‘microturbellarian’ roots of platyhelminth evolutionary innovation</article-title><source>eLife</source><volume>4</volume><elocation-id>e05503</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.05503</pub-id></element-citation></ref><ref id="bib32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Letunic</surname> <given-names>I</given-names></name><name><surname>Bork</surname> <given-names>P</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Interactive tree of life (iTOL) v4: recent updates and new developments</article-title><source>Nucleic Acids Research</source><volume>47</volume><fpage>W256</fpage><lpage>W259</lpage><pub-id pub-id-type="doi">10.1093/nar/gkz239</pub-id><pub-id pub-id-type="pmid">30931475</pub-id></element-citation></ref><ref id="bib33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname> <given-names>P</given-names></name><name><surname>Nanes Sarfati</surname> <given-names>D</given-names></name><name><surname>Xue</surname> <given-names>Y</given-names></name><name><surname>Yu</surname> <given-names>X</given-names></name><name><surname>Tarashansky</surname> <given-names>AJ</given-names></name><name><surname>Quake</surname> <given-names>SR</given-names></name><name><surname>Wang</surname> <given-names>B</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Single-cell analysis of <italic>Schistosoma mansoni</italic> identifies a conserved genetic program controlling germline stem cell fate</article-title><source>Nature Communications</source><volume>12</volume><elocation-id>485</elocation-id><pub-id pub-id-type="doi">10.1038/s41467-020-20794-w</pub-id><pub-id pub-id-type="pmid">33473133</pub-id></element-citation></ref><ref id="bib34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Littlewood</surname> <given-names>DT</given-names></name><name><surname>Waeschenbach</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Evolution: a turn up for the worms</article-title><source>Current Biology</source><volume>25</volume><fpage>R457</fpage><lpage>R460</lpage><pub-id pub-id-type="doi">10.1016/j.cub.2015.04.012</pub-id><pub-id pub-id-type="pmid">26035788</pub-id></element-citation></ref><ref id="bib35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>MacPherson</surname> <given-names>L</given-names></name><name><surname>Anokye</surname> <given-names>J</given-names></name><name><surname>Yeung</surname> <given-names>MM</given-names></name><name><surname>Lam</surname> <given-names>EYN</given-names></name><name><surname>Chan</surname> <given-names>YC</given-names></name><name><surname>Weng</surname> <given-names>CF</given-names></name><name><surname>Yeh</surname> <given-names>P</given-names></name><name><surname>Knezevic</surname> <given-names>K</given-names></name><name><surname>Butler</surname> <given-names>MS</given-names></name><name><surname>Hoegl</surname> <given-names>A</given-names></name><name><surname>Chan</surname> <given-names>KL</given-names></name><name><surname>Burr</surname> <given-names>ML</given-names></name><name><surname>Gearing</surname> <given-names>LJ</given-names></name><name><surname>Willson</surname> <given-names>T</given-names></name><name><surname>Liu</surname> <given-names>J</given-names></name><name><surname>Choi</surname> <given-names>J</given-names></name><name><surname>Yang</surname> <given-names>Y</given-names></name><name><surname>Bilardi</surname> <given-names>RA</given-names></name><name><surname>Falk</surname> <given-names>H</given-names></name><name><surname>Nguyen</surname> <given-names>N</given-names></name><name><surname>Stupple</surname> <given-names>PA</given-names></name><name><surname>Peat</surname> <given-names>TS</given-names></name><name><surname>Zhang</surname> <given-names>M</given-names></name><name><surname>de Silva</surname> <given-names>M</given-names></name><name><surname>Carrasco-Pozo</surname> <given-names>C</given-names></name><name><surname>Avery</surname> <given-names>VM</given-names></name><name><surname>Khoo</surname> <given-names>PS</given-names></name><name><surname>Dolezal</surname> <given-names>O</given-names></name><name><surname>Dennis</surname> <given-names>ML</given-names></name><name><surname>Nuttall</surname> <given-names>S</given-names></name><name><surname>Surjadi</surname> <given-names>R</given-names></name><name><surname>Newman</surname> <given-names>J</given-names></name><name><surname>Ren</surname> <given-names>B</given-names></name><name><surname>Leaver</surname> <given-names>DJ</given-names></name><name><surname>Sun</surname> <given-names>Y</given-names></name><name><surname>Baell</surname> <given-names>JB</given-names></name><name><surname>Dovey</surname> <given-names>O</given-names></name><name><surname>Vassiliou</surname> <given-names>GS</given-names></name><name><surname>Grebien</surname> <given-names>F</given-names></name><name><surname>Dawson</surname> <given-names>SJ</given-names></name><name><surname>Street</surname> <given-names>IP</given-names></name><name><surname>Monahan</surname> <given-names>BJ</given-names></name><name><surname>Burns</surname> <given-names>CJ</given-names></name><name><surname>Choudhary</surname> <given-names>C</given-names></name><name><surname>Blewitt</surname> <given-names>ME</given-names></name><name><surname>Voss</surname> <given-names>AK</given-names></name><name><surname>Thomas</surname> <given-names>T</given-names></name><name><surname>Dawson</surname> <given-names>MA</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>HBO1 is required for the maintenance of leukaemia stem cells</article-title><source>Nature</source><volume>577</volume><fpage>266</fpage><lpage>270</lpage><pub-id pub-id-type="doi">10.1038/s41586-019-1835-6</pub-id><pub-id pub-id-type="pmid">31827282</pub-id></element-citation></ref><ref id="bib36"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Madeira</surname> <given-names>F</given-names></name><name><surname>Park</surname> <given-names>Ymi</given-names></name><name><surname>Lee</surname> <given-names>J</given-names></name><name><surname>Buso</surname> <given-names>N</given-names></name><name><surname>Gur</surname> <given-names>T</given-names></name><name><surname>Madhusoodanan</surname> <given-names>N</given-names></name><name><surname>Basutkar</surname> <given-names>P</given-names></name><name><surname>Tivey</surname> <given-names>ARN</given-names></name><name><surname>Potter</surname> <given-names>SC</given-names></name><name><surname>Finn</surname> <given-names>RD</given-names></name><name><surname>Lopez</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>The EMBL-EBI search and sequence analysis tools APIs in 2019</article-title><source>Nucleic Acids Research</source><volume>47</volume><fpage>W636</fpage><lpage>W641</lpage><pub-id pub-id-type="doi">10.1093/nar/gkz268</pub-id></element-citation></ref><ref id="bib37"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Malkov</surname> <given-names>YA</given-names></name><name><surname>Yashunin</surname> <given-names>DA</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Efficient and robust approximate nearest neighbor search using hierarchical navigable small world graphs</article-title><source>IEEE Transactions on Pattern Analysis and Machine Intelligence</source><volume>42</volume><fpage>824</fpage><lpage>836</lpage><pub-id pub-id-type="doi">10.1109/TPAMI.2018.2889473</pub-id><pub-id pub-id-type="pmid">30602420</pub-id></element-citation></ref><ref id="bib38"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Musser</surname> <given-names>JM</given-names></name><name><surname>Schippers</surname> <given-names>KJ</given-names></name><name><surname>Nickel</surname> <given-names>M</given-names></name><name><surname>Mizzon</surname> <given-names>G</given-names></name><name><surname>Kohn</surname> <given-names>AB</given-names></name><name><surname>Pape</surname> <given-names>C</given-names></name><name><surname>Hammel</surname> <given-names>JU</given-names></name><name><surname>Wolf</surname> <given-names>F</given-names></name><name><surname>Liang</surname> <given-names>C</given-names></name><name><surname>Hernández-Plaza</surname> <given-names>A</given-names></name><name><surname>Achim</surname> <given-names>K</given-names></name><name><surname>Schieber</surname> <given-names>NL</given-names></name><name><surname>Francis</surname> <given-names>WR</given-names></name><name><surname>Vargas R.</surname> <given-names>S</given-names></name><name><surname>Kling</surname> <given-names>S</given-names></name><name><surname>Renkert</surname> <given-names>M</given-names></name><name><surname>Feuda</surname> <given-names>R</given-names></name><name><surname>Gaspar</surname> <given-names>I</given-names></name><name><surname>Burkhardt</surname> <given-names>P</given-names></name><name><surname>Bork</surname> <given-names>P</given-names></name><name><surname>Beck</surname> <given-names>M</given-names></name><name><surname>Kreshuk</surname> <given-names>A</given-names></name><name><surname>Wörheide</surname> <given-names>G</given-names></name><name><surname>Huerta-Cepas</surname> <given-names>J</given-names></name><name><surname>Schwab</surname> <given-names>Y</given-names></name><name><surname>Moroz</surname> <given-names>LL</given-names></name><name><surname>Arendt</surname> <given-names>D</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Profiling cellular diversity in sponges informs animal cell type and nervous system evolution</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/758276</pub-id></element-citation></ref><ref id="bib39"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nanes Sarfati</surname> <given-names>D</given-names></name><name><surname>Li</surname> <given-names>P</given-names></name><name><surname>Tarashansky</surname> <given-names>AJ</given-names></name><name><surname>Wang</surname> <given-names>B</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Single-cell deconstruction of stem-cell-driven schistosome development</article-title><source>Trends in Parasitology</source><comment>In press</comment><pub-id pub-id-type="doi">10.1016/j.pt.2021.03.005</pub-id><pub-id pub-id-type="pmid">33893056</pub-id></element-citation></ref><ref id="bib40"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nehrt</surname> <given-names>NL</given-names></name><name><surname>Clark</surname> <given-names>WT</given-names></name><name><surname>Radivojac</surname> <given-names>P</given-names></name><name><surname>Hahn</surname> <given-names>MW</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Testing the ortholog conjecture with comparative functional genomic data from mammals</article-title><source>PLOS Computational Biology</source><volume>7</volume><elocation-id>e1002073</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1002073</pub-id><pub-id pub-id-type="pmid">21695233</pub-id></element-citation></ref><ref id="bib41"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nguyen</surname> <given-names>LT</given-names></name><name><surname>Schmidt</surname> <given-names>HA</given-names></name><name><surname>von Haeseler</surname> <given-names>A</given-names></name><name><surname>Minh</surname> <given-names>BQ</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>IQ-TREE: a fast and effective stochastic algorithm for estimating maximum-likelihood phylogenies</article-title><source>Molecular Biology and Evolution</source><volume>32</volume><fpage>268</fpage><lpage>274</lpage><pub-id pub-id-type="doi">10.1093/molbev/msu300</pub-id><pub-id pub-id-type="pmid">25371430</pub-id></element-citation></ref><ref id="bib42"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pan</surname> <given-names>JH</given-names></name><name><surname>Adair-Kirk</surname> <given-names>TL</given-names></name><name><surname>Patel</surname> <given-names>AC</given-names></name><name><surname>Huang</surname> <given-names>T</given-names></name><name><surname>Yozamp</surname> <given-names>NS</given-names></name><name><surname>Xu</surname> <given-names>J</given-names></name><name><surname>Reddy</surname> <given-names>EP</given-names></name><name><surname>Byers</surname> <given-names>DE</given-names></name><name><surname>Pierce</surname> <given-names>RA</given-names></name><name><surname>Holtzman</surname> <given-names>MJ</given-names></name><name><surname>Brody</surname> <given-names>SL</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Myb permits multilineage airway epithelial cell differentiation</article-title><source>Stem Cells</source><volume>32</volume><fpage>3245</fpage><lpage>3256</lpage><pub-id pub-id-type="doi">10.1002/stem.1814</pub-id><pub-id pub-id-type="pmid">25103188</pub-id></element-citation></ref><ref id="bib43"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pijuan-Sala</surname> <given-names>B</given-names></name><name><surname>Griffiths</surname> <given-names>JA</given-names></name><name><surname>Guibentif</surname> <given-names>C</given-names></name><name><surname>Hiscock</surname> <given-names>TW</given-names></name><name><surname>Jawaid</surname> <given-names>W</given-names></name><name><surname>Calero-Nieto</surname> <given-names>FJ</given-names></name><name><surname>Mulas</surname> <given-names>C</given-names></name><name><surname>Ibarra-Soria</surname> <given-names>X</given-names></name><name><surname>Tyser</surname> <given-names>RCV</given-names></name><name><surname>Ho</surname> <given-names>DLL</given-names></name><name><surname>Reik</surname> <given-names>W</given-names></name><name><surname>Srinivas</surname> <given-names>S</given-names></name><name><surname>Simons</surname> <given-names>BD</given-names></name><name><surname>Nichols</surname> <given-names>J</given-names></name><name><surname>Marioni</surname> <given-names>JC</given-names></name><name><surname>Göttgens</surname> <given-names>B</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>A single-cell molecular map of mouse gastrulation and early organogenesis</article-title><source>Nature</source><volume>566</volume><fpage>490</fpage><lpage>495</lpage><pub-id pub-id-type="doi">10.1038/s41586-019-0933-9</pub-id><pub-id pub-id-type="pmid">30787436</pub-id></element-citation></ref><ref id="bib44"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Plass</surname> <given-names>M</given-names></name><name><surname>Solana</surname> <given-names>J</given-names></name><name><surname>Wolf</surname> <given-names>FA</given-names></name><name><surname>Ayoub</surname> <given-names>S</given-names></name><name><surname>Misios</surname> <given-names>A</given-names></name><name><surname>Glažar</surname> <given-names>P</given-names></name><name><surname>Obermayer</surname> <given-names>B</given-names></name><name><surname>Theis</surname> <given-names>FJ</given-names></name><name><surname>Kocks</surname> <given-names>C</given-names></name><name><surname>Rajewsky</surname> <given-names>N</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Cell type atlas and lineage tree of a whole complex animal by single-cell transcriptomics</article-title><source>Science</source><volume>360</volume><elocation-id>eaaq1723</elocation-id><pub-id pub-id-type="doi">10.1126/science.aaq1723</pub-id><pub-id pub-id-type="pmid">29674432</pub-id></element-citation></ref><ref id="bib45"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Polański</surname> <given-names>K</given-names></name><name><surname>Young</surname> <given-names>MD</given-names></name><name><surname>Miao</surname> <given-names>Z</given-names></name><name><surname>Meyer</surname> <given-names>KB</given-names></name><name><surname>Teichmann</surname> <given-names>SA</given-names></name><name><surname>Park</surname> <given-names>J-E</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>BBKNN: fast batch alignment of single cell transcriptomes</article-title><source>Bioinformatics</source><volume>36</volume><fpage>964</fpage><lpage>965</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btz625</pub-id></element-citation></ref><ref id="bib46"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Prince</surname> <given-names>VE</given-names></name><name><surname>Pickett</surname> <given-names>FB</given-names></name></person-group><year iso-8601-date="2002">2002</year><article-title>Splitting pairs: the diverging fates of duplicated genes</article-title><source>Nature Reviews Genetics</source><volume>3</volume><fpage>827</fpage><lpage>837</lpage><pub-id pub-id-type="doi">10.1038/nrg928</pub-id><pub-id pub-id-type="pmid">12415313</pub-id></element-citation></ref><ref id="bib47"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Reddien</surname> <given-names>PW</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>The cellular and molecular basis for planarian regeneration</article-title><source>Cell</source><volume>175</volume><fpage>327</fpage><lpage>345</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2018.09.021</pub-id><pub-id pub-id-type="pmid">30290140</pub-id></element-citation></ref><ref id="bib48"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Regev</surname> <given-names>A</given-names></name><name><surname>Teichmann</surname> <given-names>SA</given-names></name><name><surname>Lander</surname> <given-names>ES</given-names></name><name><surname>Amit</surname> <given-names>I</given-names></name><name><surname>Benoist</surname> <given-names>C</given-names></name><name><surname>Birney</surname> <given-names>E</given-names></name><name><surname>Bodenmiller</surname> <given-names>B</given-names></name><name><surname>Campbell</surname> <given-names>P</given-names></name><name><surname>Carninci</surname> <given-names>P</given-names></name><name><surname>Clatworthy</surname> <given-names>M</given-names></name><name><surname>Clevers</surname> <given-names>H</given-names></name><name><surname>Deplancke</surname> <given-names>B</given-names></name><name><surname>Dunham</surname> <given-names>I</given-names></name><name><surname>Eberwine</surname> <given-names>J</given-names></name><name><surname>Eils</surname> <given-names>R</given-names></name><name><surname>Enard</surname> <given-names>W</given-names></name><name><surname>Farmer</surname> <given-names>A</given-names></name><name><surname>Fugger</surname> <given-names>L</given-names></name><name><surname>Göttgens</surname> <given-names>B</given-names></name><name><surname>Hacohen</surname> <given-names>N</given-names></name><name><surname>Haniffa</surname> <given-names>M</given-names></name><name><surname>Hemberg</surname> <given-names>M</given-names></name><name><surname>Kim</surname> <given-names>S</given-names></name><name><surname>Klenerman</surname> <given-names>P</given-names></name><name><surname>Kriegstein</surname> <given-names>A</given-names></name><name><surname>Lein</surname> <given-names>E</given-names></name><name><surname>Linnarsson</surname> <given-names>S</given-names></name><name><surname>Lundberg</surname> <given-names>E</given-names></name><name><surname>Lundeberg</surname> <given-names>J</given-names></name><name><surname>Majumder</surname> <given-names>P</given-names></name><name><surname>Marioni</surname> <given-names>JC</given-names></name><name><surname>Merad</surname> <given-names>M</given-names></name><name><surname>Mhlanga</surname> <given-names>M</given-names></name><name><surname>Nawijn</surname> <given-names>M</given-names></name><name><surname>Netea</surname> <given-names>M</given-names></name><name><surname>Nolan</surname> <given-names>G</given-names></name><name><surname>Pe'er</surname> <given-names>D</given-names></name><name><surname>Phillipakis</surname> <given-names>A</given-names></name><name><surname>Ponting</surname> <given-names>CP</given-names></name><name><surname>Quake</surname> <given-names>S</given-names></name><name><surname>Reik</surname> <given-names>W</given-names></name><name><surname>Rozenblatt-Rosen</surname> <given-names>O</given-names></name><name><surname>Sanes</surname> <given-names>J</given-names></name><name><surname>Satija</surname> <given-names>R</given-names></name><name><surname>Schumacher</surname> <given-names>TN</given-names></name><name><surname>Shalek</surname> <given-names>A</given-names></name><name><surname>Shapiro</surname> <given-names>E</given-names></name><name><surname>Sharma</surname> <given-names>P</given-names></name><name><surname>Shin</surname> <given-names>JW</given-names></name><name><surname>Stegle</surname> <given-names>O</given-names></name><name><surname>Stratton</surname> <given-names>M</given-names></name><name><surname>Stubbington</surname> <given-names>MJT</given-names></name><name><surname>Theis</surname> <given-names>FJ</given-names></name><name><surname>Uhlen</surname> <given-names>M</given-names></name><name><surname>van Oudenaarden</surname> <given-names>A</given-names></name><name><surname>Wagner</surname> <given-names>A</given-names></name><name><surname>Watt</surname> <given-names>F</given-names></name><name><surname>Weissman</surname> <given-names>J</given-names></name><name><surname>Wold</surname> <given-names>B</given-names></name><name><surname>Xavier</surname> <given-names>R</given-names></name><name><surname>Yosef</surname> <given-names>N</given-names></name><collab>Human Cell Atlas Meeting Participants</collab></person-group><year iso-8601-date="2017">2017</year><article-title>The human cell atlas</article-title><source>eLife</source><volume>6</volume><elocation-id>e27041</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.27041</pub-id><pub-id pub-id-type="pmid">29206104</pub-id></element-citation></ref><ref id="bib49"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sarkar</surname> <given-names>A</given-names></name><name><surname>Hochedlinger</surname> <given-names>K</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>The sox family of transcription factors: versatile regulators of stem and progenitor cell fate</article-title><source>Cell Stem Cell</source><volume>12</volume><fpage>15</fpage><lpage>30</lpage><pub-id pub-id-type="doi">10.1016/j.stem.2012.12.007</pub-id><pub-id pub-id-type="pmid">23290134</pub-id></element-citation></ref><ref id="bib50"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Scimone</surname> <given-names>ML</given-names></name><name><surname>Cote</surname> <given-names>LE</given-names></name><name><surname>Reddien</surname> <given-names>PW</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Orthogonal muscle fibres have different instructive roles in planarian regeneration</article-title><source>Nature</source><volume>551</volume><fpage>623</fpage><lpage>628</lpage><pub-id pub-id-type="doi">10.1038/nature24660</pub-id><pub-id pub-id-type="pmid">29168507</pub-id></element-citation></ref><ref id="bib51"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sebé-Pedrós</surname> <given-names>A</given-names></name><name><surname>Chomsky</surname> <given-names>E</given-names></name><name><surname>Pang</surname> <given-names>K</given-names></name><name><surname>Lara-Astiaso</surname> <given-names>D</given-names></name><name><surname>Gaiti</surname> <given-names>F</given-names></name><name><surname>Mukamel</surname> <given-names>Z</given-names></name><name><surname>Amit</surname> <given-names>I</given-names></name><name><surname>Hejnol</surname> <given-names>A</given-names></name><name><surname>Degnan</surname> <given-names>BM</given-names></name><name><surname>Tanay</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Early metazoan cell type diversity and the evolution of multicellular gene regulation</article-title><source>Nature Ecology &amp; Evolution</source><volume>2</volume><fpage>1176</fpage><lpage>1188</lpage><pub-id pub-id-type="doi">10.1038/s41559-018-0575-6</pub-id><pub-id pub-id-type="pmid">29942020</pub-id></element-citation></ref><ref id="bib52"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shafer</surname> <given-names>MER</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Cross-species analysis of single-cell transcriptomic data</article-title><source>Frontiers in Cell and Developmental Biology</source><volume>7</volume><elocation-id>175</elocation-id><pub-id pub-id-type="doi">10.3389/fcell.2019.00175</pub-id><pub-id pub-id-type="pmid">31552245</pub-id></element-citation></ref><ref id="bib53"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Shafer</surname> <given-names>MER</given-names></name><name><surname>Sawh</surname> <given-names>AN</given-names></name><name><surname>Schier</surname> <given-names>AF</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Gene family evolution underlies cell type diversification in the hypothalamus of teleosts</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/2020.12.13.414557</pub-id></element-citation></ref><ref id="bib54"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Siebert</surname> <given-names>S</given-names></name><name><surname>Farrell</surname> <given-names>JA</given-names></name><name><surname>Cazet</surname> <given-names>JF</given-names></name><name><surname>Abeykoon</surname> <given-names>Y</given-names></name><name><surname>Primack</surname> <given-names>AS</given-names></name><name><surname>Schnitzler</surname> <given-names>CE</given-names></name><name><surname>Juliano</surname> <given-names>CE</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Stem cell differentiation trajectories in <italic>Hydra</italic> resolved at single-cell resolution</article-title><source>Science</source><volume>365</volume><elocation-id>eaav9314</elocation-id><pub-id pub-id-type="doi">10.1126/science.aav9314</pub-id><pub-id pub-id-type="pmid">31346039</pub-id></element-citation></ref><ref id="bib55"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sikder</surname> <given-names>S</given-names></name><name><surname>Kumari</surname> <given-names>S</given-names></name><name><surname>Mustafi</surname> <given-names>P</given-names></name><name><surname>Ramdas</surname> <given-names>N</given-names></name><name><surname>Padhi</surname> <given-names>S</given-names></name><name><surname>Saha</surname> <given-names>A</given-names></name><name><surname>Bhaduri</surname> <given-names>U</given-names></name><name><surname>Banerjee</surname> <given-names>B</given-names></name><name><surname>Manjithaya</surname> <given-names>R</given-names></name><name><surname>Kundu</surname> <given-names>TK</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Nonhistone human chromatin protein PC4 is critical for genomic integrity and negatively regulates autophagy</article-title><source>The FEBS Journal</source><volume>286</volume><fpage>4422</fpage><lpage>4442</lpage><pub-id pub-id-type="doi">10.1111/febs.14952</pub-id><pub-id pub-id-type="pmid">31169983</pub-id></element-citation></ref><ref id="bib56"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stamboulian</surname> <given-names>M</given-names></name><name><surname>Guerrero</surname> <given-names>RF</given-names></name><name><surname>Hahn</surname> <given-names>MW</given-names></name><name><surname>Radivojac</surname> <given-names>P</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>The ortholog conjecture revisited: the value of orthologs and paralogs in function prediction</article-title><source>Bioinformatics</source><volume>36</volume><fpage>i219</fpage><lpage>i226</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btaa468</pub-id><pub-id pub-id-type="pmid">32657391</pub-id></element-citation></ref><ref id="bib57"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stuart</surname> <given-names>T</given-names></name><name><surname>Butler</surname> <given-names>A</given-names></name><name><surname>Hoffman</surname> <given-names>P</given-names></name><name><surname>Hafemeister</surname> <given-names>C</given-names></name><name><surname>Papalexi</surname> <given-names>E</given-names></name><name><surname>Mauck</surname> <given-names>WM</given-names></name><name><surname>Hao</surname> <given-names>Y</given-names></name><name><surname>Stoeckius</surname> <given-names>M</given-names></name><name><surname>Smibert</surname> <given-names>P</given-names></name><name><surname>Satija</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Comprehensive integration of single-cell data</article-title><source>Cell</source><volume>177</volume><fpage>1888</fpage><lpage>1902</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2019.05.031</pub-id><pub-id pub-id-type="pmid">31178118</pub-id></element-citation></ref><ref id="bib58"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Studer</surname> <given-names>RA</given-names></name><name><surname>Robinson-Rechavi</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>How confident can we be that orthologs are similar, but paralogs differ?</article-title><source>Trends in Genetics</source><volume>25</volume><fpage>210</fpage><lpage>216</lpage><pub-id pub-id-type="doi">10.1016/j.tig.2009.03.004</pub-id><pub-id pub-id-type="pmid">19368988</pub-id></element-citation></ref><ref id="bib59"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Suzuki</surname> <given-names>H</given-names></name><name><surname>Ishizaka</surname> <given-names>T</given-names></name><name><surname>Yanagi</surname> <given-names>K</given-names></name><name><surname>Sone</surname> <given-names>R</given-names></name><name><surname>Sunaga</surname> <given-names>Y</given-names></name><name><surname>Ohga</surname> <given-names>R</given-names></name><name><surname>Kawahara</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Characterization of <italic>biklf/klf17</italic>-deficient zebrafish in posterior lateral line neuromast and hatching gland development</article-title><source>Scientific Reports</source><volume>9</volume><elocation-id>13680</elocation-id><pub-id pub-id-type="doi">10.1038/s41598-019-50149-5</pub-id><pub-id pub-id-type="pmid">31558744</pub-id></element-citation></ref><ref id="bib60"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tarashansky</surname> <given-names>AJ</given-names></name><name><surname>Xue</surname> <given-names>Y</given-names></name><name><surname>Li</surname> <given-names>P</given-names></name><name><surname>Quake</surname> <given-names>SR</given-names></name><name><surname>Wang</surname> <given-names>B</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Self-assembling manifolds in single-cell RNA sequencing data</article-title><source>eLife</source><volume>8</volume><elocation-id>e48994</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.48994</pub-id><pub-id pub-id-type="pmid">31524596</pub-id></element-citation></ref><ref id="bib61"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Tarashansky</surname> <given-names>AJ</given-names></name><name><surname>Manning</surname> <given-names>J</given-names></name><name><surname>DeWinter</surname> <given-names>S</given-names></name><name><surname>Hulselmans</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2021">2021</year><data-title>SAMap -- version 0.1.7</data-title><source>Software Heritage</source><version designator="swh:1:rev:c696585f8fe41ec1599b0720df579f3cb14f935b">swh:1:rev:c696585f8fe41ec1599b0720df579f3cb14f935b</version><ext-link ext-link-type="uri" xlink:href="https://archive.softwareheritage.org/swh:1:rev:c696585f8fe41ec1599b0720df579f3cb14f935b">https://archive.softwareheritage.org/swh:1:rev:c696585f8fe41ec1599b0720df579f3cb14f935b</ext-link></element-citation></ref><ref id="bib62"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tatusov</surname> <given-names>RL</given-names></name><name><surname>Fedorova</surname> <given-names>ND</given-names></name><name><surname>Jackson</surname> <given-names>JD</given-names></name><name><surname>Jacobs</surname> <given-names>AR</given-names></name><name><surname>Kiryutin</surname> <given-names>B</given-names></name><name><surname>Koonin</surname> <given-names>EV</given-names></name><name><surname>Krylov</surname> <given-names>DM</given-names></name><name><surname>Mazumder</surname> <given-names>R</given-names></name><name><surname>Mekhedov</surname> <given-names>SL</given-names></name><name><surname>Nikolskaya</surname> <given-names>AN</given-names></name><name><surname>Rao</surname> <given-names>BS</given-names></name><name><surname>Smirnov</surname> <given-names>S</given-names></name><name><surname>Sverdlov</surname> <given-names>AV</given-names></name><name><surname>Vasudevan</surname> <given-names>S</given-names></name><name><surname>Wolf</surname> <given-names>YI</given-names></name><name><surname>Yin</surname> <given-names>JJ</given-names></name><name><surname>Natale</surname> <given-names>DA</given-names></name></person-group><year iso-8601-date="2003">2003</year><article-title>The COG database: an updated version includes eukaryotes</article-title><source>BMC Bioinformatics</source><volume>4</volume><elocation-id>41</elocation-id><pub-id pub-id-type="doi">10.1186/1471-2105-4-41</pub-id><pub-id pub-id-type="pmid">12969510</pub-id></element-citation></ref><ref id="bib63"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tosches</surname> <given-names>MA</given-names></name><name><surname>Yamawaki</surname> <given-names>TM</given-names></name><name><surname>Naumann</surname> <given-names>RK</given-names></name><name><surname>Jacobi</surname> <given-names>AA</given-names></name><name><surname>Tushev</surname> <given-names>G</given-names></name><name><surname>Laurent</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Evolution of pallium, hippocampus, and cortical cell types revealed by single-cell transcriptomics in reptiles</article-title><source>Science</source><volume>360</volume><fpage>881</fpage><lpage>888</lpage><pub-id pub-id-type="doi">10.1126/science.aar4237</pub-id><pub-id pub-id-type="pmid">29724907</pub-id></element-citation></ref><ref id="bib64"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tosches</surname> <given-names>MA</given-names></name><name><surname>Arendt</surname> <given-names>D</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>The bilaterian forebrain: an evolutionary chimaera</article-title><source>Current Opinion in Neurobiology</source><volume>23</volume><fpage>1080</fpage><lpage>1089</lpage><pub-id pub-id-type="doi">10.1016/j.conb.2013.09.005</pub-id><pub-id pub-id-type="pmid">24080363</pub-id></element-citation></ref><ref id="bib65"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Traag</surname> <given-names>VA</given-names></name><name><surname>Waltman</surname> <given-names>L</given-names></name><name><surname>van Eck</surname> <given-names>NJ</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>From Louvain to Leiden: guaranteeing well-connected communities</article-title><source>Scientific Reports</source><volume>9</volume><elocation-id>5233</elocation-id><pub-id pub-id-type="doi">10.1038/s41598-019-41695-z</pub-id><pub-id pub-id-type="pmid">30914743</pub-id></element-citation></ref><ref id="bib66"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wagner</surname> <given-names>DE</given-names></name><name><surname>Weinreb</surname> <given-names>C</given-names></name><name><surname>Collins</surname> <given-names>ZM</given-names></name><name><surname>Briggs</surname> <given-names>JA</given-names></name><name><surname>Megason</surname> <given-names>SG</given-names></name><name><surname>Klein</surname> <given-names>AM</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Single-cell mapping of gene expression landscapes and lineage in the zebrafish embryo</article-title><source>Science</source><volume>360</volume><fpage>981</fpage><lpage>987</lpage><pub-id pub-id-type="doi">10.1126/science.aar4362</pub-id><pub-id pub-id-type="pmid">29700229</pub-id></element-citation></ref><ref id="bib67"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname> <given-names>B</given-names></name><name><surname>Lee</surname> <given-names>J</given-names></name><name><surname>Li</surname> <given-names>P</given-names></name><name><surname>Saberi</surname> <given-names>A</given-names></name><name><surname>Yang</surname> <given-names>H</given-names></name><name><surname>Liu</surname> <given-names>C</given-names></name><name><surname>Zhao</surname> <given-names>M</given-names></name><name><surname>Newmark</surname> <given-names>PA</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Stem cell heterogeneity drives the parasitic life cycle of <italic>Schistosoma mansoni</italic></article-title><source>eLife</source><volume>7</volume><elocation-id>e35449</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.35449</pub-id><pub-id pub-id-type="pmid">29988015</pub-id></element-citation></ref><ref id="bib68"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Weir</surname> <given-names>K</given-names></name><name><surname>Dupre</surname> <given-names>C</given-names></name><name><surname>van Giesen</surname> <given-names>L</given-names></name><name><surname>Lee</surname> <given-names>AS</given-names></name><name><surname>Bellono</surname> <given-names>NW</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>A molecular filter for the cnidarian stinging response</article-title><source>eLife</source><volume>9</volume><elocation-id>e57578</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.57578</pub-id><pub-id pub-id-type="pmid">32452384</pub-id></element-citation></ref><ref id="bib69"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Welch</surname> <given-names>JD</given-names></name><name><surname>Kozareva</surname> <given-names>V</given-names></name><name><surname>Ferreira</surname> <given-names>A</given-names></name><name><surname>Vanderburg</surname> <given-names>C</given-names></name><name><surname>Martin</surname> <given-names>C</given-names></name><name><surname>Macosko</surname> <given-names>EZ</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Single-cell multi-omic integration compares and contrasts features of brain cell identity</article-title><source>Cell</source><volume>177</volume><fpage>1873</fpage><lpage>1887</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2019.05.006</pub-id><pub-id pub-id-type="pmid">31178122</pub-id></element-citation></ref><ref id="bib70"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wendt</surname> <given-names>GR</given-names></name><name><surname>Collins</surname> <given-names>JN</given-names></name><name><surname>Pei</surname> <given-names>J</given-names></name><name><surname>Pearson</surname> <given-names>MS</given-names></name><name><surname>Bennett</surname> <given-names>HM</given-names></name><name><surname>Loukas</surname> <given-names>A</given-names></name><name><surname>Berriman</surname> <given-names>M</given-names></name><name><surname>Grishin</surname> <given-names>NV</given-names></name><name><surname>Collins</surname> <given-names>JJ</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Flatworm-specific transcriptional regulators promote the specification of tegumental progenitors in <italic>Schistosoma mansoni</italic></article-title><source>eLife</source><volume>7</volume><elocation-id>e33221</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.33221</pub-id><pub-id pub-id-type="pmid">29557781</pub-id></element-citation></ref><ref id="bib71"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wendt</surname> <given-names>GR</given-names></name><name><surname>Collins</surname> <given-names>JJ</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Schistosomiasis as a disease of stem cells</article-title><source>Current Opinion in Genetics &amp; Development</source><volume>40</volume><fpage>95</fpage><lpage>102</lpage><pub-id pub-id-type="doi">10.1016/j.gde.2016.06.010</pub-id><pub-id pub-id-type="pmid">27392295</pub-id></element-citation></ref><ref id="bib72"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wolf</surname> <given-names>FA</given-names></name><name><surname>Angerer</surname> <given-names>P</given-names></name><name><surname>Theis</surname> <given-names>FJ</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>SCANPY: large-scale single-cell gene expression data analysis</article-title><source>Genome Biology</source><volume>19</volume><elocation-id>15</elocation-id><pub-id pub-id-type="doi">10.1186/s13059-017-1382-0</pub-id><pub-id pub-id-type="pmid">29409532</pub-id></element-citation></ref><ref id="bib73"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wong</surname> <given-names>E</given-names></name><name><surname>Mölter</surname> <given-names>J</given-names></name><name><surname>Anggono</surname> <given-names>V</given-names></name><name><surname>Degnan</surname> <given-names>SM</given-names></name><name><surname>Degnan</surname> <given-names>BM</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Co-expression of synaptic genes in the sponge <italic>Amphimedon queenslandica</italic> uncovers ancient neural submodules</article-title><source>Scientific Reports</source><volume>9</volume><elocation-id>15781</elocation-id><pub-id pub-id-type="doi">10.1038/s41598-019-51282-x</pub-id><pub-id pub-id-type="pmid">31673079</pub-id></element-citation></ref><ref id="bib74"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yan</surname> <given-names>KK</given-names></name><name><surname>Wang</surname> <given-names>D</given-names></name><name><surname>Rozowsky</surname> <given-names>J</given-names></name><name><surname>Zheng</surname> <given-names>H</given-names></name><name><surname>Cheng</surname> <given-names>C</given-names></name><name><surname>Gerstein</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>OrthoClust: an orthology-based network framework for clustering data across multiple species</article-title><source>Genome Biology</source><volume>15</volume><elocation-id>R100</elocation-id><pub-id pub-id-type="doi">10.1186/gb-2014-15-8-r100</pub-id><pub-id pub-id-type="pmid">25249401</pub-id></element-citation></ref><ref id="bib75"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zeng</surname> <given-names>A</given-names></name><name><surname>Li</surname> <given-names>YQ</given-names></name><name><surname>Wang</surname> <given-names>C</given-names></name><name><surname>Han</surname> <given-names>XS</given-names></name><name><surname>Li</surname> <given-names>G</given-names></name><name><surname>Wang</surname> <given-names>JY</given-names></name><name><surname>Li</surname> <given-names>DS</given-names></name><name><surname>Qin</surname> <given-names>YW</given-names></name><name><surname>Shi</surname> <given-names>Y</given-names></name><name><surname>Brewer</surname> <given-names>G</given-names></name><name><surname>Jing</surname> <given-names>Q</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Heterochromatin protein 1 promotes self-renewal and triggers regenerative proliferation in adult stem cells</article-title><source>Journal of Cell Biology</source><volume>201</volume><fpage>409</fpage><lpage>425</lpage><pub-id pub-id-type="doi">10.1083/jcb.201207172</pub-id><pub-id pub-id-type="pmid">23629965</pub-id></element-citation></ref><ref id="bib76"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zeng</surname> <given-names>A</given-names></name><name><surname>Li</surname> <given-names>H</given-names></name><name><surname>Guo</surname> <given-names>L</given-names></name><name><surname>Gao</surname> <given-names>X</given-names></name><name><surname>McKinney</surname> <given-names>S</given-names></name><name><surname>Wang</surname> <given-names>Y</given-names></name><name><surname>Yu</surname> <given-names>Z</given-names></name><name><surname>Park</surname> <given-names>J</given-names></name><name><surname>Semerad</surname> <given-names>C</given-names></name><name><surname>Ross</surname> <given-names>E</given-names></name><name><surname>Cheng</surname> <given-names>LC</given-names></name><name><surname>Davies</surname> <given-names>E</given-names></name><name><surname>Lei</surname> <given-names>K</given-names></name><name><surname>Wang</surname> <given-names>W</given-names></name><name><surname>Perera</surname> <given-names>A</given-names></name><name><surname>Hall</surname> <given-names>K</given-names></name><name><surname>Peak</surname> <given-names>A</given-names></name><name><surname>Box</surname> <given-names>A</given-names></name><name><surname>Sánchez Alvarado</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Prospectively isolated tetraspanin<sup>+ </sup>neoblasts are adult pluripotent stem cells underlying planaria regeneration</article-title><source>Cell</source><volume>173</volume><fpage>1593</fpage><lpage>1608</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2018.05.006</pub-id><pub-id pub-id-type="pmid">29906446</pub-id></element-citation></ref></ref-list></back><sub-article article-type="decision-letter" id="sa1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.66747.sa1</article-id><title-group><article-title>Decision letter</article-title></title-group><contrib-group><contrib contrib-type="editor"><name><surname>Shalek</surname><given-names>Alex K</given-names></name><role>Reviewing Editor</role><aff><institution>Broad Institute of MIT and Harvard</institution><country>United States</country></aff></contrib></contrib-group></front-stub><body><boxed-text><p>Our editorial process produces two outputs: i) <ext-link ext-link-type="uri" xlink:href="https://sciety.org/articles/activity/10.1101/2020.09.28.317784">public reviews</ext-link> designed to be posted alongside <ext-link ext-link-type="uri" xlink:href="https://www.biorxiv.org/content/10.1101/2020.09.28.317784v1">the preprint</ext-link> for the benefit of readers; ii) feedback on the manuscript for the authors, including requests for revisions, shown below. We also include an acceptance summary that explains what the editors found interesting or important about the work.</p></boxed-text><p><bold>Acceptance summary:</bold></p><p>The development of single-cell genomic methods has transformed our understanding of cell types and their attributes across organisms. Here, Tarashansky et al. develop SAMap (Self-Assembling Manifold mapping), a graph-based data integration method which builds upon their previously described SAM algorithm, to facilitate assignment of homologous genes and cell types across diverse species. As the authors show, this empowers comparative analyses across phyla to facilitate cellular annotation and examine the evolutionary origins of cellular diversity. Overall, the algorithm has the potential to be broadly enabling for comparative cellular atlasing.</p><p><bold>Decision letter after peer review:</bold></p><p>Thank you for submitting your article &quot;Mapping single-cell atlases throughout Metazoa unravels cell type evolution&quot; for consideration by <italic>eLife</italic>. Your article has been reviewed by 3 peer reviewers, and the evaluation has been overseen by Alex K Shalek as the Reviewing Editor and Naama Barkai as the Senior Editor. The reviewers have opted to remain anonymous.</p><p>The Reviewing Editor has drafted this to help you prepare a revised submission.</p><p>Essential revisions:</p><p>1. While authors clearly demonstrate the promise of SAMap, the manuscript would benefit from an accessible discussion of the algorithm's potential applications, limitations and drawbacks to help inform use. For example, how does the algorithm depend on cell numbers, data quality, or the use of a consistent experimental method? If a cell type is missing from one atlas (e.g., due to limited cell numbers), will the algorithm overfit? Performing downsampling analyses, leaving one cluster out (e.g., when comparing zebrafish and <italic>Xenopus</italic> (Figure 2)), or linking datasets across methods (e.g., Smart-Seq2 and 10x; inDrop and 10x) would help to address these points.</p><p>2. The authors' analyses present several intriguing evolutionary observations such as those on widespread paralog substitution, the multifunctionality of ancestral contractile cells, and the existence of a deeply conserved gene module associated with multipotency. Each would benefit from further investigation. For example, with respect to the paralogs, are similar levels of substitution observed when paralogs are excluded during manifold assembly (i.e., do they drive cell type assignments)? Similarly, how does paralog substitution depend on how recently those paralogs arose or their stability? Meanwhile, the points on multifunctionality and multipotency would benefit from deeper analysis and discussion, or more cautious language. Re: the first point above, each observation would also benefit from presentation of potential alternative interpretations in the Discussion section.</p><p><italic>Reviewer #1 (Recommendations for the authors):</italic></p><p>I am very supportive of this manuscript and agree with the authors assessment of the utility of the method they have developed. My major concerns emerge from some of the evolutionary interpretations of the results. In particular, I wonder whether it would be possible to exclude the paralog pairs for which substitution has been observed during manifold assembly to determine whether those paralogs are driving cell type assignments leading to a tautology. I would recommend that in the three instances where evolutionary conclusions are proposed, the authors consider alternative interpretations within their discussion.</p><p><italic>Reviewer #2 (Recommendations for the authors):</italic></p><p>The paper is solid.</p><p><italic>Reviewer #3 (Recommendations for the authors):</italic></p><p>The study and methods give a great conceptual overview of the novel approach, but the details for implementation are not clear, and the github is not well documented. I would encourage further details and more clear documentation on the github – for example the paralog substitution findings are an important result and use case, but there is limited methods description and it is unclear how to run the function.</p><p>Finally, the reciprocal BLAST is slow to run, especially for all by all transcripts, but it only needs to run once. I would consider posting the results of this analysis on the github for widely used species pairs, which could also accelerate adoption by reducing the barrier to running the full suite.</p></body></sub-article><sub-article article-type="reply" id="sa2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.66747.sa2</article-id><title-group><article-title>Author response</article-title></title-group></front-stub><body><disp-quote content-type="editor-comment"><p>Essential revisions:</p><p>1. While authors clearly demonstrate the promise of SAMap, the manuscript would benefit from an accessible discussion of the algorithm's potential applications, limitations and drawbacks to help inform use. For example, how does the algorithm depend on cell numbers, data quality, or the use of a consistent experimental method? If a cell type is missing from one atlas (e.g., due to limited cell numbers), will the algorithm overfit? Performing downsampling analyses, leaving one cluster out (e.g., when comparing zebrafish and <italic>Xenopus</italic> (Figure 2)), or linking datasets across methods (e.g., Smart-Seq2 and 10x; inDrop and 10x) would help to address these points.</p></disp-quote><p>1.1. Thanks for raising these important questions. Now we discuss the technical specifics of SAMap more explicitly (lines 133-141) and included a new figure (Figure 1—figure supplement 1). The datasets analyzed in this study range from thousands to hundreds of thousands of cells sequenced using different methods. For example, the planarian atlas contained 50,000 cells sampled with Drop-Seq and the schistosome atlas contains 7,000 cells sampled with Smart-Seq2. In addition, we have recently applied SAMap to map a dataset of lower quality collected from <italic>Amphimedon queenslandica</italic> (Sebé-Pedrós et al., 2018) using MARS-seq to the 10x dataset of <italic>Spongilla lacustris (Musser et al., 2019).</italic> We found broad concordance between the major cell type families (see <xref ref-type="fig" rid="respfig1">Author response image 1</xref>). This newer result is included in another paper that is currently under review. SAMap’s use of mutual connectivity to determine alignment strength rather than absolute measures of similarity such as correlation makes it robust to technical batch effects such as those related to the different library preparation methods used.</p><p>Although SAMap scales well to the majority of currently available whole-organism cell atlases, datasets will continue to get larger. Currently, the most memory-intensive steps in SAMap are the neighborhood coarsening of cross-species edges and the cross-species gene expression imputation to calculate gene-gene correlations, both of which can be intractable for datasets containing millions of cells. Our current solution is to chunk these operations into smaller blocks for large datasets to avoid memory limitations, but the runtime increases significantly as a result. An option for mapping massive datasets may be to downsample each atlas. So long as all cell types are preserved and remain separable during downsampling, we expect the mapping results to be the same. We now discuss these points in the text (lines 409-418).</p><fig id="respfig1"><label>Author response image 1.</label><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-66747-resp-fig1-v2.tif"/></fig><p>1.2. To evaluate if SAMap overfits in cases where some cell types are missing, we performed dropout experiments in which we systematically removed each cell type that has an annotated homolog in the comparison of zebrafish and frog atlases. Cell types whose homologous partners were removed weakly mapped to closely related cell types, and many of these links were already present in the original analysis (Supplementary File 3). For example, optic cells from both species are also connected to eye primordium, frog skeletal muscles to zebrafish presomitic mesoderm, and frog hindbrain to zebrafish forebrain/midbrain. While we observed several mappings that were not present in the original analysis, their alignment scores were all barely above the detection threshold of SAMap. Moreover, most of these edges were mapped between cell types with similar developmental origins, with the only exception being the zebrafish neural crest mapped to the frog otic placode in the absence of frog neural crest cells. Examining the genes that support this mapping revealed that both cell types express <italic>sox9</italic> and <italic>sox10</italic>, two TFs previously implicated to form a conserved gene regulatory circuit common to otic/neural crest cells (Betancur et al., 2011). These results are now discussed in the text (lines 194-210).</p><disp-quote content-type="editor-comment"><p>2. The authors' analyses present several intriguing evolutionary observations such as those on widespread paralog substitution, the multifunctionality of ancestral contractile cells, and the existence of a deeply conserved gene module associated with multipotency. Each would benefit from further investigation. For example, with respect to the paralogs, are similar levels of substitution observed when paralogs are excluded during manifold assembly (i.e., do they drive cell type assignments)? Similarly, how does paralog substitution depend on how recently those paralogs arose or their stability? Meanwhile, the points on multifunctionality and multipotency would benefit from deeper analysis and discussion, or more cautious language. Re: the first point above, each observation would also benefit from presentation of potential alternative interpretations in the Discussion section.</p></disp-quote><p>2.1. Thanks for these great suggestions. SAMap yields a similar combined manifold when using only one-to-one orthologs (Figure 2E), suggesting that at least for the zebrafish-frog comparison the paralogs are not driving the manifold mapping. To rule out the possibility that these paralogs were linked spuriously during the homology refinement steps of SAMap, we repeated the paralog substitution analysis on the combined manifold constructed using only one-to-one orthologs. This identified a largely similar set of paralog substitution events, although weaker manifold alignment when restricting the mapping to one-to-one orthologs led to the loss of some substitution paralogs that showed lower correlations. These new results are now reported in Figure 3—figure supplement 1 and discussed in the text (lines 242-251).</p><p>2.2. To determine whether paralog substitution depends on how recently they arose, we used the orthology groups provided by Eggnog to infer when paralogs duplicated during evolution. We found that more recent paralogs substitute at higher rates than more ancestral paralogs, which is in line with the expectation that less diverged genes are likely more capable of functionally substituting each other (Figure 3C). We also used the paralog substitution score to quantify the rate of paralog substitution in each cell type and observed that substituting paralogs are expressed in a wide variety of cell types, with some (e.g., dorsal organizer) exhibiting higher rates than others (Figure 3B), indicating uneven diversification rates of paralogs across cell types. Unfortunately, assessing the stability of paralog substitutions within a clade requires more cell atlases than what are available at the moment. This analysis needs to densely sample species within clades and at key branching points along the tree of life. We now discuss these new results and possible future directions in the text (lines 229-231, lines 237-242, and lines 448-455).</p><p>2.3. We apologize for the confusing statement on muscle cell type functions. We have modified the text (lines 356-359) to clarify that ancestral contractile cells may already possess the broad assemblage of gene modules associated with different functional aspects of modern muscle cell types, including the adhesion complex that connects cells, actomyosin networks that drive contractility, and signaling pathways that stimulate contraction.</p><p>2.4. To expand the analysis on multipotency, we extend the comparison to include multipotent stem cells (MSCs), lineage-restricted stem cells, and differentiated cells for all four invertebrates analyzed in this study. Importantly, this new analysis identified several transcription factors and chromatin modifiers enriched in MSCs that may play essential roles in establishing gene expression programs associated with multipotency (Figure 6D). These new results are nor discussed in the text (lines 382-399). Thanks for this great suggestion.</p><disp-quote content-type="editor-comment"><p>Reviewer #1 (Recommendations for the authors):</p><p>I am very supportive of this manuscript and agree with the authors assessment of the utility of the method they have developed. My major concerns emerge from some of the evolutionary interpretations of the results. In particular, I wonder whether it would be possible to exclude the paralog pairs for which substitution has been observed during manifold assembly to determine whether those paralogs are driving cell type assignments leading to a tautology. I would recommend that in the three instances where evolutionary conclusions are proposed, the authors consider alternative interpretations within their discussion.</p></disp-quote><p>Thanks for the support and great suggestions! We now have strengthened these parts through new analysis and better discussions. Please see reply to editor’s comments, 2.1-2.4.</p><disp-quote content-type="editor-comment"><p>Reviewer #3 (Recommendations for the authors):</p><p>The study and methods give a great conceptual overview of the novel approach, but the details for implementation are not clear, and the github is not well documented. I would encourage further details and more clear documentation on the github – for example the paralog substitution findings are an important result and use case, but there is limited methods description and it is unclear how to run the function.</p></disp-quote><p>We have made a number of improvements to the Github for aid usability, summarized here:</p><p>1. We now provide a Docker container which launches a Jupyter notebook server configured to run SAMap and all its associated functions.</p><p>2. The paralog substitution analysis function has better documentation and accepts both cross-species and within-species paralogs. Within-species paralogs are translated to cross-species paralogs automatically by using the cross-species orthologs as anchors.</p><p>3. We now provide a built-in function to convert Eggnog mapping tables to ortholog gene pairs at specified taxonomic levels.</p><p>4. We provided a built-in function to perform functional enrichment analysis given any functional annotations (e.g. GO terms or KOG annotations).</p><p>5. We provide several functions to facilitate convenient visualization of SAMap results:</p><p>a. A function that launches an interactive GUI provided by the SAM package to facilitate interactive exploration of the SAMap manifold.</p><p>b. A function that creates an interactive Sankey plot.</p><p>c. A function that displays a cell type mapping heatmap.</p><p>d. A function to overlay expression patterns on the combined manifold to create plots like the ones shown in Figure 3A.</p><p>e. A function to create the enrichment plots shown in Figure 6A,C.</p><p>6. All exposed functions now have docstrings with descriptions for each input parameter and returned output.</p><p>7. We have provided more thorough tutorials in a Jupyter notebook on Github, along with a Jupyter notebook showing all possible outputs of a complete run.</p><p>We have also added a section to the methods describing the paralog substitution analysis in more detail (lines 692-721).</p><disp-quote content-type="editor-comment"><p>Finally, the reciprocal BLAST is slow to run, especially for all by all transcripts, but it only needs to run once. I would consider posting the results of this analysis on the github for widely used species pairs, which could also accelerate adoption by reducing the barrier to running the full suite.</p></disp-quote><p>This is an excellent suggestion. We have added a database of species codes, transcriptome versions, and corresponding BLAST tables to the Github. In the future, we aim to release an online database and interactive explorer that documents mappings (and all associated inputs/outputs) between all pairs of species uploaded to the database.</p></body></sub-article></article>