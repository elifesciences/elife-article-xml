<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD with MathML3 v1.3 20210610//EN"  "JATS-archivearticle1-3-mathml3.dtd"><article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.3"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn publication-format="electronic" pub-type="epub">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">95494</article-id><article-id pub-id-type="doi">10.7554/eLife.95494</article-id><article-id pub-id-type="doi" specific-use="version">10.7554/eLife.95494.3</article-id><article-version article-version-type="publication-state">version of record</article-version><article-categories><subj-group subj-group-type="display-channel"><subject>Tools and Resources</subject></subj-group><subj-group subj-group-type="heading"><subject>Computational and Systems Biology</subject></subj-group><subj-group subj-group-type="heading"><subject>Immunology and Inflammation</subject></subj-group></article-categories><title-group><article-title>ImmCellTyper facilitates systematic mass cytometry data analysis for deep immune profiling</article-title></title-group><contrib-group><contrib contrib-type="author" corresp="yes" equal-contrib="yes"><name><surname>Sun</surname><given-names>Jing</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0009-0001-7102-7556</contrib-id><email>jing.1.sun@kcl.ac.uk</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="equal-contrib1">†</xref><xref ref-type="other" rid="fund3"/><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" equal-contrib="yes"><name><surname>Choy</surname><given-names>Desmond</given-names></name><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="equal-contrib1">†</xref><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author"><name><surname>Sompairac</surname><given-names>Nicolas</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0001-8759-2077</contrib-id><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="con3"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author"><name><surname>Jamshidi</surname><given-names>Shirin</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0001-8290-6698</contrib-id><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="con4"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author"><name><surname>Mishto</surname><given-names>Michele</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="other" rid="fund1"/><xref ref-type="other" rid="fund2"/><xref ref-type="fn" rid="con5"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" corresp="yes"><name><surname>Kordasti</surname><given-names>Shahram</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-0347-4207</contrib-id><email>shahram.kordasti@kcl.ac.uk</email><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="aff" rid="aff5">5</xref><xref ref-type="other" rid="fund1"/><xref ref-type="other" rid="fund2"/><xref ref-type="fn" rid="con6"/><xref ref-type="fn" rid="conf1"/></contrib><aff id="aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/0220mzb33</institution-id><institution>Centre for Inflammation Biology and Cancer Immunology &amp; Peter Gorer Department of Immunobiology, King's College London</institution></institution-wrap><addr-line><named-content content-type="city">London</named-content></addr-line><country>United Kingdom</country></aff><aff id="aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/0220mzb33</institution-id><institution>School of Cancer and Pharmaceutical Sciences, King’s College London</institution></institution-wrap><addr-line><named-content content-type="city">London</named-content></addr-line><country>United Kingdom</country></aff><aff id="aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/04tnbqb63</institution-id><institution>Research Group of Molecular Immunology, Francis Crick Institute</institution></institution-wrap><addr-line><named-content content-type="city">London</named-content></addr-line><country>United Kingdom</country></aff><aff id="aff4"><label>4</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/04r33pf22</institution-id><institution>Haematology Department, Guy’s Hospital</institution></institution-wrap><addr-line><named-content content-type="city">London</named-content></addr-line><country>United Kingdom</country></aff><aff id="aff5"><label>5</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/00x69rs40</institution-id><institution>Department of Clinical and Molecular Sciences, Università Politecnica delle Marche</institution></institution-wrap><addr-line><named-content content-type="city">Ancona</named-content></addr-line><country>Italy</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Hong</surname><given-names>Seunghee</given-names></name><role>Reviewing Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/01wjejq96</institution-id><institution>Yonsei University</institution></institution-wrap><country>Republic of Korea</country></aff></contrib><contrib contrib-type="senior_editor"><name><surname>Rath</surname><given-names>Satyajit</given-names></name><role>Senior Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/028qa3n13</institution-id><institution>Indian Institute of Science Education and Research (IISER)</institution></institution-wrap><country>India</country></aff></contrib></contrib-group><author-notes><fn fn-type="con" id="equal-contrib1"><label>†</label><p>These authors contributed equally to this work</p></fn></author-notes><pub-date publication-format="electronic" date-type="publication"><day>06</day><month>09</month><year>2024</year></pub-date><volume>13</volume><elocation-id>RP95494</elocation-id><history><date date-type="sent-for-review" iso-8601-date="2024-01-16"><day>16</day><month>01</month><year>2024</year></date></history><pub-history><event><event-desc>This manuscript was published as a preprint.</event-desc><date date-type="preprint" iso-8601-date="2024-01-17"><day>17</day><month>01</month><year>2024</year></date><self-uri content-type="preprint" xlink:href="https://doi.org/10.1101/2024.01.15.575790"/></event><event><event-desc>This manuscript was published as a reviewed preprint.</event-desc><date date-type="reviewed-preprint" iso-8601-date="2024-04-05"><day>05</day><month>04</month><year>2024</year></date><self-uri content-type="reviewed-preprint" xlink:href="https://doi.org/10.7554/eLife.95494.1"/></event><event><event-desc>The reviewed preprint was revised.</event-desc><date date-type="reviewed-preprint" iso-8601-date="2024-08-14"><day>14</day><month>08</month><year>2024</year></date><self-uri content-type="reviewed-preprint" xlink:href="https://doi.org/10.7554/eLife.95494.2"/></event></pub-history><permissions><copyright-statement>© 2024, Sun, Choy et al</copyright-statement><copyright-year>2024</copyright-year><copyright-holder>Sun, Choy et al</copyright-holder><ali:free_to_read/><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><ali:license_ref>http://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-95494-v1.pdf"/><self-uri content-type="figures-pdf" xlink:href="elife-95494-figures-v1.pdf"/><abstract><p>Mass cytometry is a cutting-edge high-dimensional technology for profiling marker expression at the single-cell level, advancing clinical research in immune monitoring. Nevertheless, the vast data generated by cytometry by time-of-flight (CyTOF) poses a significant analytical challenge. To address this, we describe ImmCellTyper (<ext-link ext-link-type="uri" xlink:href="https://github.com/JingAnyaSun/ImmCellTyper">https://github.com/JingAnyaSun/ImmCellTyper</ext-link>), a novel toolkit for CyTOF data analysis. This framework incorporates BinaryClust, an in-house developed semi-supervised clustering tool that automatically identifies main cell types. BinaryClust outperforms existing clustering tools in accuracy and speed, as shown in benchmarks with two datasets of approximately 4 million cells, matching the precision of manual gating by human experts. Furthermore, ImmCellTyper offers various visualisation and analytical tools, spanning from quality control to differential analysis, tailored to users’ specific needs for a comprehensive CyTOF data analysis solution. The workflow includes five key steps: (1) batch effect evaluation and correction, (2) data quality control and pre-processing, (3) main cell lineage characterisation and quantification, (4) in-depth investigation of specific cell types; and (5) differential analysis of cell abundance and functional marker expression across study groups. Overall, ImmCellTyper combines expert biological knowledge in a semi-supervised approach to accurately deconvolute well-defined main cell lineages, while maintaining the potential of unsupervised methods to discover novel cell subsets, thus facilitating high-dimensional immune profiling.</p></abstract><kwd-group kwd-group-type="author-keywords"><kwd>CyTOF</kwd><kwd>computational framework</kwd><kwd>immune profiling</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research organism</title><kwd>Human</kwd></kwd-group><funding-group><award-group id="fund1"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100015570</institution-id><institution>Blood Cancer UK</institution></institution-wrap></funding-source><award-id>Ref. 22009</award-id><principal-award-recipient><name><surname>Mishto</surname><given-names>Michele</given-names></name><name><surname>Kordasti</surname><given-names>Shahram</given-names></name></principal-award-recipient></award-group><award-group id="fund2"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000289</institution-id><institution>Cancer Research UK</institution></institution-wrap></funding-source><award-id>CTRQQR-2021/100004</award-id><principal-award-recipient><name><surname>Mishto</surname><given-names>Michele</given-names></name><name><surname>Kordasti</surname><given-names>Shahram</given-names></name></principal-award-recipient></award-group><award-group id="fund3"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100004543</institution-id><institution>China Scholarship Council</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Sun</surname><given-names>Jing</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection, and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>ImmCellTyper enhances CyTOF data analysis by combining expert biological knowledge with advanced clustering tools to provide an accurate, comprehensive, and user-friendly solution for high-dimensional immune profiling.</meta-value></custom-meta><custom-meta specific-use="meta-only"><meta-name>publishing-route</meta-name><meta-value>prc</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>Mass cytometry or cytometry by time-of-flight (CyTOF) is a powerful high-throughput single-cell technology which employs stable elemental isotopes, as the same manner of fluorophores, to detect cellular proteins of interest. This approach successfully tackles the panel multiplex challenges faced by traditional flow cytometry due to spectral overlap and permits simultaneous measurement of over 40 parameters on millions of cells. To date, CyTOF has been widely applied in basic and translational medical research, such as deep immunophenotyping and characterisation of novel refined cell subsets, immune monitoring of cell-adoptive therapy, and dissecting cell subpopulations from heterogeneous tumour samples (<xref ref-type="bibr" rid="bib28">Spitzer and Nolan, 2016</xref>). Nonetheless, the advantages of CyTOF come with the problem of handling high-dimensional dataset. Traditional gating strategy for flow cytometry, while still serving as the ‘gold standard’ for cell population identification in cytometry data, may not be an optimal option for CyTOF data due to its high-dimensional settings. The high-parametric resolution in CyTOF, aimed at revealing previously undiscovered cell subpopulations, leads to a significant increase in the complexity of gating schemas and hierarchical depth, which makes manual gating extremely labour intensive and time-consuming (<xref ref-type="bibr" rid="bib13">Kimball et al., 2018</xref>). Therefore, effective computational toolkits and pipelines are entailed for CyTOF data mining and analysis.</p><p>Efforts have been directed towards developing means of clustering algorithms to deconvolute a pool of live cell mixture into distinct cell populations, which facilitates CyTOF data analysis. For instance, unsupervised methods, which include flowSOM (<xref ref-type="bibr" rid="bib32">Van Gassen et al., 2015</xref>), Phenograph (<xref ref-type="bibr" rid="bib15">Levine et al., 2015</xref>), X-shift (<xref ref-type="bibr" rid="bib27">Samusik et al., 2016</xref>), spade (<xref ref-type="bibr" rid="bib26">Qiu et al., 2011</xref>), DensVM (<xref ref-type="bibr" rid="bib6">Becher et al., 2014</xref>), etc., often combine with dimension reduction techniques like <italic>t</italic>-distributed stochastic neighbour embedding (<italic>t</italic>-SNE) (<xref ref-type="bibr" rid="bib20">Maaten and Hinton, 2008</xref>), Uniform Manifold Approximation and Projection (UMAP) (<xref ref-type="bibr" rid="bib22">McInnes and Healy, 2018</xref>), principal component analysis (PCA), etc., and require manual annotation of each cluster based on the marker expression patterns indicated by heatmaps. This approach works well to analyse populations in a data-driven manner, with all files concatenated and analysed all at once. Compared to manual gating, it has advantages in terms of convenience, efficiency, and relative unbiasedness from biological preconception, facilitating the detection of novel cell phenotypes for deep phenotyping. However, the unsupervised approaches are not always ideal and suitable for cytometry data. Mathematical clustering does not necessarily have biological meaning, leading to occasional inaccuracies. And several benchmarking studies suggested that the accuracy for these unsupervised tools may not be optimal (<xref ref-type="bibr" rid="bib17">Liu et al., 2019</xref>). Additionally, the technical uncertainty of results produced by different clustering approaches remains a conundrum. Even for the same unsupervised method, the discrepancy among different runs without setting a seed, reduces the reproducibility and may cause confusion, particularly for biologists with limited computational knowledge. Moreover, manual validation is also essential, as biological annotation is the inevitable step to provide biological relevant labels for the clusters. However, this process can be time-consuming and subjective, hindering the automation of pipelines. This problem is particularly pronounced for a large marker panel and samples with high heterogeneity, resulting in a higher number of clusters that need to be annotated.</p><p>Advances in artificial intelligence have accelerated the development of alternative clustering methods in a supervised manner for cell type inference. These methods consider the ‘ground truth’ or prior knowledge about the marker expression of each given cell types to automatically label each cell. Currently, a couple of semi-automatic methods have been developed, such as linear discriminant analysis (LDA) (<xref ref-type="bibr" rid="bib1">Abdelaal et al., 2019</xref>), DGCyTOF (<xref ref-type="bibr" rid="bib10">Cheng et al., 2022</xref>), CyAnno (<xref ref-type="bibr" rid="bib12">Kaushik et al., 2021</xref>), DeepCyTOF (<xref ref-type="bibr" rid="bib16">Li et al., 2017</xref>), Automated Cell-type Discovery and Classification (ACDC) (<xref ref-type="bibr" rid="bib14">Lee et al., 2017</xref>), Semi-supervised Category Identification and Assignment (SCINA) (<xref ref-type="bibr" rid="bib35">Zhang et al., 2019</xref>), etc. ACDC (<xref ref-type="bibr" rid="bib14">Lee et al., 2017</xref>) and SCINA (<xref ref-type="bibr" rid="bib35">Zhang et al., 2019</xref>) use a matrix of pre-defined markers for each cell type to annotate the clusters showing the same signature. These methods assume that markers are either expressed or not expressed (binary), which limits their ability to distinguish cell subtypes with similar phenotypes, particularly non-canonical cell types that cannot be easily separated linearly. Alternatively, DeepCyTOF and LDA use a marker expression matrix extracted from manually gated cell types as a training dataset to build a machine-learning model for cell type prediction. This approach has higher precision and accuracy compared with aforementioned methods (<xref ref-type="bibr" rid="bib17">Liu et al., 2019</xref>). Nonetheless, it can be labour intensive for preparation of the training set manually. Also, these methods are limited in their ability to predict novel cell subsets beyond the pre-gated set of cell types and lack a systematic and comprehensive way to assign the cells which were not identifiable under any of the gated cell types. New solutions have emerged with algorithms such as DGCyTOF (<xref ref-type="bibr" rid="bib10">Cheng et al., 2022</xref>) and CyAnno (<xref ref-type="bibr" rid="bib12">Kaushik et al., 2021</xref>), the former adopts a deep learning classification combined with hierarchical stable-clustering methods and an iteration calibration system to identify known cell types and assign novel subsets; while CyAnno is based on a machine-learning framework which allows the integrative modelling of both ‘gated’ and ‘ungated’ cells. Both methods have demonstrated high accuracy in their test datasets, but unfortunately are not widely used by the research community, possibly due to the issue for the hassle of training data preparation, the lack of user-friendliness and implementation challenges for bench researchers.</p><p>To address the common drawbacks of current semi-supervised and unsupervised clustering algorithms and preserve their strengths in discovering both canonical and non-canonical cell subsets, respectively, we propose a strategy implemented in ImmCellTyper for cell classification named BinaryClust. By considering biologists’ prior biological knowledge and interpretation for canonical cell clusters in a semi-supervised manner, BinaryClust first automatically characterises the main cell lineages in a fast and accurate way. Subsequently, it extracts specific cell types of interest for further clustering using unsupervised algorithms to identify cell subsets including previously unreported non-conventional population. In addition, this R-implemented pipeline takes advantage of SingleCellExperiment class for data management, providing an easy-to-use and organised systematic workflow of CyTOF data handling. The whole pipeline includes quality control and batch effect correction, which helps to effectively pool datasets from different batches, and ensures the robustness for downstream analysis. Meanwhile, modules like dimension reduction, semi-supervised and unsupervised clustering (flowSOM and Phenograph), interactive data visualisation, and statistical testing for complex study design were also incorporated in this pipeline. Compared with existing integrated computational workflow, such as CATALYST (<xref ref-type="bibr" rid="bib23">Nowicka et al., 2017</xref>), CapX (<xref ref-type="bibr" rid="bib21">Marsh-Wakefield et al., 2019</xref>), Cytofkit (<xref ref-type="bibr" rid="bib9">Chen et al., 2016</xref>), and ImmunoCluster (<xref ref-type="bibr" rid="bib25">Opzoomer et al., 2021</xref>), which was developed and maintained by our team, this recently developed toolkit advanced further on coherence, functionality and user-friendliness. Overall, this approach has the potential to facilitate and smooth the investigation of CyTOF-based research.</p></sec><sec id="s2" sec-type="results"><title>Results</title><sec id="s2-1"><title>BinaryClust is comparable with manual gating in quantifying the abundances of main cell lineages</title><p>The core concept for BinaryClust is depicted in <xref ref-type="fig" rid="fig1">Figure 1</xref>, where a simple user-designed cell type marker expression matrix is required and serves as a reference to characterise the main cell lineages, with positive markers indicated in ‘+’, negative markers in ‘-’, and irrelevant markers in ‘A’. <italic>K</italic>-means (<italic>k</italic> = 2) will be applied to divide the positive and negative cell population of each marker, then align it to the reference table to infer main cell types. This is followed by the extraction of population-of-interest for downstream clustering using unsupervised methods for subpopulation discovery.</p><fig-group><fig id="fig1" position="float"><label>Figure 1.</label><caption><title>Schematic diagram of BinaryClust framework.</title><p>Semi-supervised classification is first performed on selected markers in the user-defined marker expression matrix to classify and annotate major cell types. Population-of-interest can be further extracted and explored using unsupervised clustering methods followed by differential analysis. Created with <ext-link ext-link-type="uri" xlink:href="https://www.biorender.com/">BioRender.com</ext-link>.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-95494-fig1-v1.tif"/></fig><fig id="fig1s1" position="float" specific-use="child-fig"><label>Figure 1—figure supplement 1.</label><caption><title>Manual hierarchical gating strategy for main cell linages from human peripheral blood mononuclear cell (PBMC) samples (myeloproliferative neoplasm [MPN] dataset, <italic>n</italic> = 9).</title><p>All FCS files were cleaned up to remove doublets, normalisation beads and debris (please refer to the methods for standard clean-up procedure), and pre-gated for CD45<sup>+</sup> leukocytes. (<bold>A</bold>) Serial bi-axial scatter plots representing the gating diagram for T cell subsets (CD4 T cells, CD8 T cells, and gamma delta T cells), NK cells and dendritic cells based on the indicated phenotypic markers. (<bold>B</bold>) Serial bi-axial scatter plot indicating the gating strategy to isolate monocytes and B cells from leukocytes. All manual gating was done using Cytobank platform (<ext-link ext-link-type="uri" xlink:href="https://premium.cytobank.org/cytobank/">https://premium.cytobank.org/cytobank/</ext-link>).</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-95494-fig1-figsupp1-v1.tif"/></fig><fig id="fig1s2" position="float" specific-use="child-fig"><label>Figure 1—figure supplement 2.</label><caption><title>Clean-up procedure of cytometry by time-of-flight (CyTOF) data using Cytobank.</title></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-95494-fig1-figsupp2-v1.tif"/></fig></fig-group><p>To assess the performance of the automated cell type classification and prediction, we generated a test CyTOF dataset using peripheral blood mononuclear cell (PBMC) samples from seven patients with myeloproliferative neoplasm (MPN) and two healthy donors, employing a 37-marker deep immunophenotyping panel (<xref ref-type="table" rid="app1table1">Appendix 1—table 1</xref>). Manual gating was performed by two independent experts which identified seven main cell lineages. These results act as the reference for evaluating the computer-aided methods. The hierarchical sequential gating strategy was explicitly illustrated in <xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>. We evaluated the agreement between manual gating results and BinaryClust results regarding cell frequencies of each population. The mean value was calculated from manual gating results of two experts to compare with BinaryClust-generated results using Pearson correlation analysis. As shown in <xref ref-type="fig" rid="fig2">Figure 2A</xref>, the two methods exhibit a strong correlation with coefficient (<italic>R</italic><sup>2</sup>) equals to 1, 1, 0.99, 0.96, 0.96, 0.99, 0.99 for CD4 T cells, CD8 T cells, dendritic cells, NK cells, monocytes, and gamma delta T cells, respectively (all p &lt; 0.0001). And most of the data points remain close to the line of equality (red line, <italic>R</italic><sup>2</sup> = 1), indicating a high degree of agreement. Meanwhile, the Bland–Altman plots in <xref ref-type="fig" rid="fig2">Figure 2B</xref> also suggest no consistent bias of manual gating versus BinaryClust across all the identified cell types. The good performance of BinaryClust was further validated in the influenza dataset published by our group (<xref ref-type="bibr" rid="bib3">Alimam et al., 2021</xref>), which contains FCS files from 11 individuals with six main immune cell types detected (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1A, B</xref>).</p><fig-group><fig id="fig2" position="float"><label>Figure 2.</label><caption><title>Agreement evaluation comparing manual gating and BinaryClust in myeloproliferative neoplasm (MPN) cohort (<italic>n</italic> = 9).</title><p>Manual gating of B cells, CD4 T cells, CD8 T cells, dendritic cells, NK cells, monocytes, and gamma delta T cells were performed by two independent experts using Cytobank, and mean values of the population percentages were calculated to compare with BinaryClust results. Each dot represents one patient sample. (<bold>A</bold>) Scatter plot showing the correlation between the two methods, with the red line indicating perfect agreement (correlation coefficient = 1). (<bold>B</bold>) Bland–Altman plots of the two measurement methods among all the cell populations, with the black line suggesting the mean observed difference and red dotted lines indicating limits of agreement (1.96× standard deviations).</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-95494-fig2-v1.tif"/></fig><fig id="fig2s1" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 1.</label><caption><title>Agreement evaluation between ImmCellTyper and manual gating in influenza dataset (<italic>n</italic> = 11).</title><p>Manual gating was performed using Cytobank and exported manually. (<bold>A</bold>) Correlation plots between ImmCellTyper results and manual gating results concerning percentages in CD4 T cells, gamma delta T cells, dendritic cells, NK cells, CD8 T cells, and B cells, with red line indicating perfect agreement (correlation coefficient = 1). (<bold>B</bold>) Bland–Altman plots of the two measurements in the indicated populations, with black line suggesting mean difference between measurements and dotted red line indicating limits of agreement (1.96× standard deviations). (<bold>C</bold>) Calculation of precision, recall, <italic>F</italic>-measure for ImmCellTyper method in comparison to manual gating in the indicated cell populations.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-95494-fig2-figsupp1-v1.tif"/></fig></fig-group></sec><sec id="s2-2"><title>BinaryClust achieves high accuracy and speed compared with flowSOM and LDA</title><p>To further evaluate BinaryClust’s performance, we compared it with the well-performing unsupervised algorithm flowSOM and supervised classifier LDA. FlowSOM was run on the same MPN dataset with <italic>k</italic> value set as 20, followed by manual annotation and cluster merging to identify the same cell populations as in manual gating and BinaryClust. The cell frequencies derived from BinaryClust, flowSOM, and manual gating (expert1 and expert2) were compared using interaction plot (<xref ref-type="fig" rid="fig3">Figure 3</xref>). We observed that BinaryClust remains consistent with manual gating (all p &gt; 0.05), whereas flowSOM identified significantly less gamma delta T cells and dendritic cells (p &lt; 0.001 and p = 0.006, respectively) compared with the other three measurements. We also increased the initial <italic>k</italic> value to 40 to improve accuracy by over clustering then merging clusters (<xref ref-type="bibr" rid="bib32">Van Gassen et al., 2015</xref>). We found that the average frequency for gamma delta T cells and dendritic cells increased to 1.5% and 4.65%, respectively, but still remained significantly different (p &lt; 0.05) from the other two methods. It is also interesting to see that although the same gating strategy was applied, different experts obtained results with slight variation despite no statistical significance. The same findings were confirmed using boxplot as shown in <xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1</xref>.</p><fig-group><fig id="fig3" position="float"><label>Figure 3.</label><caption><title>Comparison of manual gating (manual1 and manual2), BinaryClust, and flowSOM clustering results in myeloproliferative neoplasm (MPN) cohort (<italic>n</italic> = 9).</title><p>Interaction plots showing the individual measurement (percentage) of each study participant with indicated colours by different methods across main cell lineages (B cells, CD8 T cells, gamma delta T cells, NK cells, dendritic cells, monocytes, and CD4 T cells); analysis of variance (ANOVA) was used for statistical testing, and significance was marked by asterisk. *p &lt; 0.05, **p &lt; 0.01, ***p &lt; 0.001, ****p &lt; 0.0001.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-95494-fig3-v1.tif"/></fig><fig id="fig3s1" position="float" specific-use="child-fig"><label>Figure 3—figure supplement 1.</label><caption><title>Boxplots of the indicated cell percentages generated by different methods.</title><p>Statistical significance was marked by asterisk. *p &lt; 0.05, **p &lt; 0.01, ***p &lt; 0.001.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-95494-fig3-figsupp1-v1.tif"/></fig></fig-group><p>Subsequently, LDA was also tested on the same dataset. Since this method requires a training dataset from manual gating to build a model, we exported the cell events and cluster assignment from Cytobank, then equally partitioned all cells into training and test dataset. Due to the difference in method implementation, we did not include LDA for cell abundance quantification comparison with other methods, since only half of the cells were used for prediction. To ensure an equitable comparison and further evaluate the accuracy, <italic>F</italic>-measure, and Adjusted Rand Index (ARI) were calculated using manual gating cluster IDs as reference. As indicated in <xref ref-type="table" rid="table1">Table 1</xref>, for the MPN dataset, BinaryClust achieved high <italic>F</italic>-measure and ARI in all seven cell types with an average of 0.94 and 0.91, respectively. The performance remains excellent in influenza dataset as well (average <italic>F</italic>-measure = 0.98, <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1C</xref>). LDA has equivalent prediction accuracy as BinaryClust with an average <italic>F</italic>-measure of 0.93 and ARI of 0.90. Both supervised methods outperformed flowSOM (average <italic>F</italic>-measure = 0.75, average ARI = 0.66), which is in line with previous benchmarking study on evaluating supervised and unsupervised clustering algorithms (<xref ref-type="bibr" rid="bib17">Liu et al., 2019</xref>). Notably, for cell types that constitute a substantial proportion in the pool like CD4 T cells, CD8 T cells, NK cells, monocytes, and B cells, flowSOM can identify them with high precision and sensitivity, while this is not the case for dendritic cells and gamma delta T cells which account for less than 3% of the whole population (<italic>F</italic>-measure = 0.51 and 0.15, respectively). Even so, the overall <italic>F</italic>-measure and ARI for flowSOM considering cell proportion reached 0.81 and 0.80.</p><table-wrap id="table1" position="float"><label>Table 1.</label><caption><title>Precision, recall, <italic>F</italic>-measure, and ARI of indicated clustering methods.</title></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" valign="bottom"/><th align="left" valign="bottom">Gated population</th><th align="left" valign="bottom">Counts</th><th align="left" valign="bottom">Cluster cell counts</th><th align="left" valign="bottom">True positive</th><th align="left" valign="bottom">Precision</th><th align="left" valign="bottom">Recall</th><th align="left" valign="bottom"><italic>F</italic>-measure</th><th align="left" valign="bottom">Average <italic>F</italic>-measure</th><th align="left" valign="bottom">ARI</th><th align="left" valign="bottom">Average ARI</th></tr></thead><tbody><tr><td align="left" valign="bottom">BinaryClust2</td><td align="left" valign="bottom">CD4 T cells</td><td align="left" valign="bottom">1,270,041</td><td align="left" valign="bottom">1,232,832</td><td align="left" valign="bottom">1,226,712</td><td align="left" valign="bottom">1.00</td><td align="left" valign="bottom">0.97</td><td align="left" valign="bottom">0.98</td><td align="left" valign="bottom">0.93</td><td align="left" valign="bottom">0.95</td><td align="left" valign="bottom">0.91</td></tr><tr><td align="left" valign="bottom"/><td align="left" valign="bottom">CD8 T cells</td><td align="left" valign="bottom">601,995</td><td align="left" valign="bottom">601,639</td><td align="left" valign="bottom">582,402</td><td align="left" valign="bottom">0.97</td><td align="left" valign="bottom">0.97</td><td align="left" valign="bottom">0.97</td><td align="left" valign="bottom"/><td align="left" valign="bottom">0.95</td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom"/><td align="left" valign="bottom">NK cells</td><td align="left" valign="bottom">389,261</td><td align="left" valign="bottom">380,999</td><td align="left" valign="bottom">376,561</td><td align="left" valign="bottom">0.99</td><td align="left" valign="bottom">0.97</td><td align="left" valign="bottom">0.98</td><td align="left" valign="bottom"/><td align="left" valign="bottom">0.97</td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom"/><td align="left" valign="bottom">Monocytes</td><td align="left" valign="bottom">576,624</td><td align="left" valign="bottom">625,735</td><td align="left" valign="bottom">568,924</td><td align="left" valign="bottom">0.91</td><td align="left" valign="bottom">0.99</td><td align="left" valign="bottom">0.95</td><td align="left" valign="bottom"/><td align="left" valign="bottom">0.92</td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom"/><td align="left" valign="bottom">B cells</td><td align="left" valign="bottom">397,279</td><td align="left" valign="bottom">380,170</td><td align="left" valign="bottom">374,501</td><td align="left" valign="bottom">0.99</td><td align="left" valign="bottom">0.94</td><td align="left" valign="bottom">0.96</td><td align="left" valign="bottom"/><td align="left" valign="bottom">0.95</td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom"/><td align="left" valign="bottom">Dendritic cells</td><td align="left" valign="bottom">135,894</td><td align="left" valign="bottom">86,012</td><td align="left" valign="bottom">84,130</td><td align="left" valign="bottom">0.98</td><td align="left" valign="bottom">0.62</td><td align="left" valign="bottom">0.76</td><td align="left" valign="bottom"/><td align="left" valign="bottom">0.74</td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom"/><td align="left" valign="bottom">TCRgd T cells</td><td align="left" valign="bottom">87,194</td><td align="left" valign="bottom">73,599</td><td align="left" valign="bottom">73,562</td><td align="left" valign="bottom">1.00</td><td align="left" valign="bottom">0.84</td><td align="left" valign="bottom">0.91</td><td align="left" valign="bottom"/><td align="left" valign="bottom">0.91</td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">flowSOM</td><td align="left" valign="bottom">CD4 T cells</td><td align="left" valign="bottom">1,270,041</td><td align="left" valign="bottom">1,268,929</td><td align="left" valign="bottom">1,226,712</td><td align="left" valign="bottom">0.97</td><td align="left" valign="bottom">0.97</td><td align="left" valign="bottom">0.97</td><td align="left" valign="bottom">0.70</td><td align="left" valign="bottom">0.90</td><td align="left" valign="bottom">0.66</td></tr><tr><td align="left" valign="bottom">(<italic>k</italic> = 20)</td><td align="left" valign="bottom">CD8 T cells</td><td align="left" valign="bottom">601,995</td><td align="left" valign="bottom">692,374</td><td align="left" valign="bottom">571,344</td><td align="left" valign="bottom">0.83</td><td align="left" valign="bottom">0.95</td><td align="left" valign="bottom">0.88</td><td align="left" valign="bottom"/><td align="left" valign="bottom">0.81</td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom"/><td align="left" valign="bottom">NK cells</td><td align="left" valign="bottom">389,261</td><td align="left" valign="bottom">393,646</td><td align="left" valign="bottom">365,403</td><td align="left" valign="bottom">0.93</td><td align="left" valign="bottom">0.94</td><td align="left" valign="bottom">0.93</td><td align="left" valign="bottom"/><td align="left" valign="bottom">0.91</td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom"/><td align="left" valign="bottom">Monocytes</td><td align="left" valign="bottom">576,624</td><td align="left" valign="bottom">792,447</td><td align="left" valign="bottom">568,284</td><td align="left" valign="bottom">0.72</td><td align="left" valign="bottom">0.99</td><td align="left" valign="bottom">0.83</td><td align="left" valign="bottom"/><td align="left" valign="bottom">0.73</td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom"/><td align="left" valign="bottom">B cells</td><td align="left" valign="bottom">397,279</td><td align="left" valign="bottom">405,886</td><td align="left" valign="bottom">390,077</td><td align="left" valign="bottom">0.96</td><td align="left" valign="bottom">0.98</td><td align="left" valign="bottom">0.97</td><td align="left" valign="bottom"/><td align="left" valign="bottom">0.96</td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom"/><td align="left" valign="bottom">Dendritic cells</td><td align="left" valign="bottom">135,894</td><td align="left" valign="bottom">20,832</td><td align="left" valign="bottom">18,254</td><td align="left" valign="bottom">0.88</td><td align="left" valign="bottom">0.13</td><td align="left" valign="bottom">0.23</td><td align="left" valign="bottom"/><td align="left" valign="bottom">0.22</td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom"/><td align="left" valign="bottom">TCRgd T cells</td><td align="left" valign="bottom">87,194</td><td align="left" valign="bottom">19,720</td><td align="left" valign="bottom">4967</td><td align="left" valign="bottom">0.25</td><td align="left" valign="bottom">0.06</td><td align="left" valign="bottom">0.09</td><td align="left" valign="bottom"/><td align="left" valign="bottom">0.08</td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">LDA</td><td align="left" valign="bottom">CD4 T cells</td><td align="left" valign="bottom">634,733</td><td align="left" valign="bottom">665,481</td><td align="left" valign="bottom">632,700</td><td align="left" valign="bottom">0.95</td><td align="left" valign="bottom">1.00</td><td align="left" valign="bottom">0.97</td><td align="left" valign="bottom">0.93</td><td align="left" valign="bottom">0.93</td><td align="left" valign="bottom">0.90</td></tr><tr><td align="left" valign="bottom"/><td align="left" valign="bottom">CD8 T cells</td><td align="left" valign="bottom">301,138</td><td align="left" valign="bottom">327,469</td><td align="left" valign="bottom">299,309</td><td align="left" valign="bottom">0.91</td><td align="left" valign="bottom">0.99</td><td align="left" valign="bottom">0.95</td><td align="left" valign="bottom"/><td align="left" valign="bottom">0.92</td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom"/><td align="left" valign="bottom">NK cells</td><td align="left" valign="bottom">194,470</td><td align="left" valign="bottom">202,110</td><td align="left" valign="bottom">187,259</td><td align="left" valign="bottom">0.93</td><td align="left" valign="bottom">0.96</td><td align="left" valign="bottom">0.94</td><td align="left" valign="bottom"/><td align="left" valign="bottom">0.92</td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom"/><td align="left" valign="bottom">Monocytes</td><td align="left" valign="bottom">288,338</td><td align="left" valign="bottom">301,387</td><td align="left" valign="bottom">282,836</td><td align="left" valign="bottom">0.94</td><td align="left" valign="bottom">0.98</td><td align="left" valign="bottom">0.96</td><td align="left" valign="bottom"/><td align="left" valign="bottom">0.94</td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom"/><td align="left" valign="bottom">B cells</td><td align="left" valign="bottom">198,582</td><td align="left" valign="bottom">211,090</td><td align="left" valign="bottom">195,908</td><td align="left" valign="bottom">0.93</td><td align="left" valign="bottom">0.99</td><td align="left" valign="bottom">0.96</td><td align="left" valign="bottom"/><td align="left" valign="bottom">0.94</td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom"/><td align="left" valign="bottom">Dendritic cells</td><td align="left" valign="bottom">68,152</td><td align="left" valign="bottom">90,456</td><td align="left" valign="bottom">61,785</td><td align="left" valign="bottom">0.68</td><td align="left" valign="bottom">0.91</td><td align="left" valign="bottom">0.78</td><td align="left" valign="bottom"/><td align="left" valign="bottom">0.75</td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom"/><td align="left" valign="bottom">TCRgd T cells</td><td align="left" valign="bottom">43,405</td><td align="left" valign="bottom">43,064</td><td align="left" valign="bottom">39,976</td><td align="left" valign="bottom">0.93</td><td align="left" valign="bottom">0.92</td><td align="left" valign="bottom">0.92</td><td align="left" valign="bottom"/><td align="left" valign="bottom">0.92</td><td align="left" valign="bottom"/></tr></tbody></table><table-wrap-foot><fn><p>ARI, Adjusted Rand Index; LDA, linear discriminant analysis.</p></fn></table-wrap-foot></table-wrap><p>It has been demonstrated that flowSOM and LDA are among the fastest clustering algorithms without compromising their performance. Here, we compared the speed among the three approaches in MPN, Influenza, and COVID-19 datasets (<xref ref-type="bibr" rid="bib11">Chevrier et al., 2021</xref>) which contain 2,231,053, 210,933, and 3,862,628 cells, respectively. Since LDA requires training data to be executed, we did not run it on COVID-19 dataset due to the absence of manual gating results. As shown in <xref ref-type="fig" rid="fig4">Figure 4</xref>, BinaryClust exhibited the highest speed in both MPN and Influenza dataset but fell behind flowSOM slightly in COVID-19 dataset.</p><fig id="fig4" position="float"><label>Figure 4.</label><caption><title>Comparison of BinaryClust, flowSOM, and linear discriminant analysis (LDA) on speed.</title><p>Bar chart showing runtime (in seconds) of the three methods in three different datasets.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-95494-fig4-v1.tif"/></fig></sec><sec id="s2-3"><title>ImmCellTyper pipeline supports interactive data visualisation and comparison among study groups</title><p>BinaryClust is an important component of ImmCellTyper, a comprehensive integrated pipeline designed for systematic CyTOF data mining. Hence, we utilised the visualisation functions to further prove the reliability and robustness of BinaryClust.</p><p>BinaryClust inherently considers CyTOF makers as binary distributed which is in most of the case, but not always. Therefore, it is crucial to check the marker behaviour before running the pipeline. As shown in <xref ref-type="fig" rid="fig5">Figure 5A</xref>, all markers selected for the classification matrix (<xref ref-type="fig" rid="fig5">Figure 5B</xref>) displayed a binary distribution implying the suitability for this pipeline. After clustering (<xref ref-type="fig" rid="fig5">Figure 5C</xref>), median marker expression heatmap (<xref ref-type="fig" rid="fig5">Figure 5D</xref>) can check the reliability of the results before proceeding for downstream analysis. In MPN dataset, we projected the cluster assignment resulted from BinaryClust and manual gating to UMAP (<xref ref-type="fig" rid="fig5">Figure 5E</xref>), along with the expression of the phenotypic markers (<xref ref-type="fig" rid="fig5">Figure 5F</xref> and <xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1A</xref>). High similarity was observed between BinaryClust and manual gating, whereas slight difference was found on flowSOM results coloured UMAP on islands of CD8 T cells and CD4 T cells (<xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1B</xref>). FlowSOM appeared to classify cells that were close on spatial distance into the same cluster, in contrast to prior knowledge-based methods: BinaryClust and manual gating.</p><fig-group><fig id="fig5" position="float"><label>Figure 5.</label><caption><title>Cell type characterisation and visualisation using ImmCellTyper pipeline in myeloproliferative neoplasm (MPN) dataset (<italic>n</italic> = 9).</title><p>(<bold>A</bold>) Intensity distribution of selected phenotypic markers used for BinaryClust classification, coloured by sample_id. (<bold>B</bold>) Pre-defined expression classification matrix for the MPN dataset, ‘+’ indicates positive, ‘-’ indicates negative, and ‘A’ suggests ‘any’. (<bold>C</bold>) Proportion of the main cell lineages of all cells in the concatenated FCS files after classification. (<bold>D</bold>) Median marker expression heatmap of BinaryClust classification results. (<bold>E</bold>) UMAP plot of random downsample of 2000 cells per patient coloured by main cell types based on BinaryClust classification (left) and manual gating results (right). (<bold>F</bold>) UMAP plots coloured by normalised expression of indicated markers (CD3, CD4, CD8a, CD20, CD19, CD14, and CD56) across 2000 cells per sample.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-95494-fig5-v1.tif"/></fig><fig id="fig5s1" position="float" specific-use="child-fig"><label>Figure 5—figure supplement 1.</label><caption><title>Comparison of different clustering methods in MPN cohort.</title><p>(<bold>A</bold>) UMAP plots of normalised expression of indicated markers (CD66b, HLADR, TCRgd, CD20, CD16, and CD161) across 2000 cells per sample in myeloproliferative neoplasm (MPN) dataset. (<bold>B</bold>) FlowSOM clustering was performed on the same dataset to compare with BinarClust, <italic>k</italic> = 20 was chosen followed by manual annotation of each cluster. UMAP plot was projected with merged flowSOM clusters with biological annotation (downsample 2000 cells per sample). (<bold>C</bold>) The corresponding median marker expression heatmap after flowSOM clustering and annotation.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-95494-fig5-figsupp1-v1.tif"/></fig></fig-group></sec><sec id="s2-4"><title>Application of ImmCellTyper pipeline to the COVID-19 dataset demonstrates its versatile functionalities for comprehensive data analysis</title><p>To showcase the analytical and visualisation functions of ImmCellTyper pipeline, we used the dataset published by <xref ref-type="bibr" rid="bib11">Chevrier et al., 2021</xref>, which described the immune signature of mild and severe COVID-19 patients in comparison with healthy individuals. There are a total of 82 FCS files with a 40-plex marker panel focussing on innate immunity in this dataset. An initial marker expression check was carried out based on the user-defined matrix (<xref ref-type="fig" rid="fig6">Figure 6B</xref>) and displayed in <xref ref-type="fig" rid="fig6">Figure 6A</xref>. BinaryClust was then performed and identified 12-cell populations as expected. We used <italic>t</italic>-SNE in this dataset for dimension reduction, coloured by cell types and faceted by disease conditions, which exhibited substantial immune alteration among healthy control, mild and severe COVID-19 patients (<xref ref-type="fig" rid="fig6">Figure 6C</xref>). From the heatmap in <xref ref-type="fig" rid="fig6">Figure 6D</xref>, we can have an overview of the marker expression of each population, which remains consistent with our initial definition indicated in the expression matrix.</p><fig id="fig6" position="float"><label>Figure 6.</label><caption><title>Applying ImmCellTyper pipeline on COVID-19 patient dataset (<italic>n</italic> = 82) published by <xref ref-type="bibr" rid="bib11">Chevrier et al., 2021</xref>.</title><p>(<bold>A</bold>) Marker intensity distribution of selected phenotypic markers used for BinaryClust classification, coloured by disease severity (<italic>n</italic> = 22 healthy individuals, 28 mild COVID-19 patients, and 38 severe COVID-19 patients). (<bold>B</bold>) Pre-defined marker expression classification matrix used for BinaryClust. (<bold>C</bold>) <italic>t</italic>-Distributed stochastic neighbour embedding (<italic>t</italic>-SNE) plots, with 1000 cells per sample, were coloured by the main cell types generated by BinaryClust and faceted by different study groups. (<bold>D</bold>) The corresponding median marker expression heatmap of BinaryClust results for the COVID-19 dataset.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-95494-fig6-v1.tif"/></fig><p>The abundances of the identified cell types were quantified for each individual study participant in the format of stacked histogram (<xref ref-type="fig" rid="fig7">Figure 7A</xref>) and summarised in boxplot (<xref ref-type="fig" rid="fig7">Figure 7B</xref>). Compared with healthy volunteers, there are significant immune alterations in COVID-19 patients in B cells, basophils, cDCs, monocytes, NK cells, CD8 T cells, neutrophils, and pDCs (all p &lt; 0.05), which depicts a similar trend to the original paper, despite slight discrepancies caused by different statistical methods used. Kruskal–Wallis test was conducted for this dataset followed by multiple testing correction (Benjamini–Hochberg [BH] procedure) and Dunn’s test for post hoc analysis, while Chevirer et al. used Mann–Whitney–Wilcoxon test corrected by Holm method. We then selected nine markers (IL-6, PD-L1, VISTA, IDO, TIM-3, TMEM173, Granzyme B, PPARg, and Ki-67) as the state markers which can reflect the functional or proliferative status of the immune cell types. Notably, as shown in <xref ref-type="fig" rid="fig7">Figure 7C</xref>, Granzyme B was observed to be significantly highly expressed in COVID-19 patients versus healthy control across all identified immune cell types (all p &lt; 0.05), TMEM173 was substantially up-regulated in COVID-19 patients particularly in monocytes, neutrophils, and CD4 T cells; and PD-L1 expression remained low for all cells, indicating the immune system of COVID-19 patients was highly activated without exhaustion regardless of disease severity, which was not explored previously. Since monocytes and neutrophils were of particular interest in the original paper, and the panel also included specific markers for in-depth interrogation, we then extracted the two population and carried out Phenograph (<italic>k</italic> = 60) to investigate the subclusters. As shown in <xref ref-type="fig" rid="fig7">Figure 7D–E</xref>, Phenograph returned 16 and 14 subclusters, respectively, for monocytes and neutrophils, with heatmap provided in <xref ref-type="fig" rid="fig7s1">Figure 7—figure supplement 1A, B</xref>.</p><fig-group><fig id="fig7" position="float"><label>Figure 7.</label><caption><title>Quantification and statistical analysis comparing the study conditions in COVID-19 dataset (<italic>n</italic> = 82).</title><p>(<bold>A</bold>) Stacked histogram of main cell type composition per individual generated by BinaryClust, and grouped by study conditions (healthy, mild, and severe). (<bold>B</bold>) Boxplots representing cell abundance frequencies among the study conditions, faceted by different main cell types. (<bold>C</bold>) State marker expression intensities with comparison of the study groups across the main cell types. (<bold>D</bold>) Clusters of monocytes and neutrophils were extracted from the whole cells for downstream interrogation. <italic>t</italic>-Distributed stochastic neighbour embedding (<italic>t</italic>-SNE) plots with random downsample of 1000 monocyte cells and (<bold>E</bold>) neutrophils per sample were coloured by study conditions and Phenograph clustering results (<italic>k</italic> = 60), respectively. Statistical significance was marked by asterisk. *p &lt; 0.05, **p &lt; 0.01, ***p &lt; 0.001, ****p &lt; 0.0001.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-95494-fig7-v1.tif"/></fig><fig id="fig7s1" position="float" specific-use="child-fig"><label>Figure 7—figure supplement 1.</label><caption><title>Expression heatmaps of monocytes and neotrophils in COVID-19 dataset.</title><p>Marker expression heatmap of (<bold>A</bold>) monocytes and (<bold>B</bold>) neutrophils generated by Phenograph clustering.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-95494-fig7-figsupp1-v1.tif"/></fig></fig-group><p>Reanalysis of the COVID-19 dataset demonstrated the concordance of ImmCellTyper pipeline with original reports with additional findings, as well as its versatile interactive data visualisation functionalities.</p></sec></sec><sec id="s3" sec-type="discussion"><title>Discussion</title><p>In this study, we present an analytical pipeline named ImmCellTyper for systematic exploration of CyTOF data. This pipeline addresses a comprehensive range of analytical needs encompassing data quality check, batch effects examination/correction, cell type identification, and downstream differential analysis accompanied by high-quality, publishable data visualisations. Furthermore, ImmCellTyper includes an in-house developed, knowledge-based, semi-supervised classifier BinaryClust with high accuracy and speed, and also integrates the well-performing and state-of-the-art unsupervised algorithms (Phenograph and flowSOM). By adopting the strategy of first obtaining the main cell types and then select specific cell types for in-depth interrogation with higher clustering resolution, ImmCellTyper combines the advantages of both supervised and unsupervised clustering algorithms for discovery of both major populations and refined subpopulations. Designed for ease of use, this pipeline features a clear and user-friendly workflow, and is compatible to the widely used pipeline CATALYST, aiming to provide a one-stop solution for CyTOF users.</p><p>For validating the robustness of the automated cell characterisation function of ImmCellTyper: BinaryClust, we involved two independent datasets (MPN and Influenza datasets) and compared with existing clustering tools flowSOM and LDA. Previous benchmarking studies indicated that flowSOM was one of the best-performing unsupervised tools in precision, speed, and stability, with <italic>F</italic>-measure ranges from 0.58 to 0.90 in various datasets (<xref ref-type="bibr" rid="bib17">Liu et al., 2019</xref>), and was widely used in high-impact research publications (<xref ref-type="bibr" rid="bib17">Liu et al., 2019</xref>; <xref ref-type="bibr" rid="bib18">Liu et al., 2020</xref>). However, the results of flowSOM vary upon the <italic>k</italic> values set by the users which causes some uncertainty and impairs reproducibility of the results. In contrast, semi-supervised clustering methods like ACDC, DeepCyTOF (<xref ref-type="bibr" rid="bib16">Li et al., 2017</xref>), and LDA outperformed the unsupervised methods in the same benchmarking study. The <italic>F</italic>-measure obtained by ACDC and LDA ranged from 0.78 to 0.99, which was significantly higher than unsupervised approaches including Accense, PhenoGraph, Xshift, <italic>k</italic>-means, flowMeans (<xref ref-type="bibr" rid="bib2">Aghaeepour et al., 2011</xref>), FlowSOM, and DEPECHE (<xref ref-type="bibr" rid="bib30">Theorell et al., 2019</xref>) (<italic>F</italic>-measure: 0.28–0.93) (<xref ref-type="bibr" rid="bib18">Liu et al., 2020</xref>). In this study, we chose LDA because it has proven to be superior to ACDC and DeepCyTOF in terms of precision and speed (<xref ref-type="bibr" rid="bib17">Liu et al., 2019</xref>; <xref ref-type="bibr" rid="bib1">Abdelaal et al., 2019</xref>). The excellent performance of LDA was demonstrated in MPN dataset of this study with <italic>F</italic>-measure reached 0.93 for around 4 million cells. BinaryClust was comparable in accuracy (<italic>F</italic>-measure = 0.94) but much faster in speed. Both semi-supervised approaches outperformed flowSOM as expected. Although semi-supervised methods seem to perform better, the mainstream for CyTOF data analysis still relies on unsupervised methods. The reason for this might be that most of the semi-supervised methods rely on manual gating as reference and requires either the manually gated expression matrix or user-defined binary matrix as training data. This process takes extra time and efforts especially for defining subpopulations, and may introduce end-user bias. Additionally, the common restriction for all the supervised methods is that they have limited capability to reveal novel subsets as those are not pre-defined in the training pool, which poses a critical challenge for the pursuit of novel discoveries. Considering all these strength and limitations, as a semi-supervised method, BinaryClust possesses the advantages of incorporating prior biological knowledge, being reproducible across runs and accurate on cell type identification. Meanwhile, the input requirement is a simple matrix of cell population definition based on marker positivity, avoiding the hassle to manually gate example FCS files. With a deep understanding that certain CyTOF markers are expressed on a continuum rather than binary manner, this automated supervised approach will only be used for classification of main cell lineages. The test datasets in this study contained data from human PBMC samples which represented a heterogeneous pool of immune cells, covering the major types of various immune populations, and demonstrated excellent performance of BinaryClust on classifying CD4 T cells, CD8 T cells, gamma delta T cells, NK cells, monocytes, dendritic cells, and B cells. We also recommend checking marker expression distribution before running the pipeline to ensure accurate results. After the above step, this pipeline supports cell population extraction for further dissection into subclusters using unsupervised approaches, which excel in detecting rare and refined subpopulations. Phenograph is a particularly effective tool for this purpose. By applying this strategy, our previous work with BinaryClust facilitated the evaluation of the impact of systematic anti-cancer agents on lymphocyte population in non-small cell lung cancer patients, as well as the characteristics of autologous T cell products after manufacturing (<xref ref-type="bibr" rid="bib24">O’Brien Gore et al., 2023</xref>).</p><p>Another purpose behind the development of the ImmCellTyper framework is to cater to general analysis needs, spanning from pre-processing to downstream differential analysis. There are existing well-established pipelines like CATALYST (<xref ref-type="bibr" rid="bib23">Nowicka et al., 2017</xref>), diffcyt (<xref ref-type="bibr" rid="bib34">Weber et al., 2019</xref>), Cytofkit (<xref ref-type="bibr" rid="bib9">Chen et al., 2016</xref>), ImmunoCluster (<xref ref-type="bibr" rid="bib25">Opzoomer et al., 2021</xref>), etc., each of them has its own strength and limitations. One of the challenges existed in CyTOF data pre-processing is effectively integrating multiple batches, given the technical differences arising from experiments and instrumental acquisition, which could result in the separation of clustering across batches and potentially confounding the signal of interest. In ImmCellTyper pipeline, we provide the functionality for batch effects examination and incorporated two well-performing batch correction algorithms CytoNorm (<xref ref-type="bibr" rid="bib33">Van Gassen et al., 2020</xref>) and CytofRUV (<xref ref-type="bibr" rid="bib31">Trussart et al., 2020</xref>) into our framework prior to downstream analysis, which ensures the quality of the data and, to the best of our knowledge, makes it the first integrated pipeline with this module. For the downstream analysis, tools like diffcyt and CATALYST group markers into phenotypic and state makers, enabling the detection of differentially abundant cell clusters and differential expression of functional markers within each cell population (<xref ref-type="bibr" rid="bib34">Weber et al., 2019</xref>). This well-recognised strategy has been extensively applied in various studies. But one limitation is that it directly classifies cells into high-resolution clusters, and cannot automatically merge subclusters into one major population with similar phenotypes (<xref ref-type="bibr" rid="bib34">Weber et al., 2019</xref>). Our pipeline addresses this problem via a precise and convenient solution: using the semi-supervised classifier (BinaryClust) of ImmCellTyper. The two pipelines (CATALYST and ImmCellTyper) are well compatible, allowing users to leverage their functions together and providing a broader range of analytical options. On the other hand, Cytofkit has the advantages of the graphical user interface for non-specialists, integration of a variety of clustering (DensVM [<xref ref-type="bibr" rid="bib6">Becher et al., 2014</xref>], ClusterX, FlowSOM, Phenograph), dimension reduction (PCA, ISOMAP, <italic>t</italic>-SNE) methods, and inference of the relatedness among cell populations, but it does not support complex study design, group comparison, and statistical testing (<xref ref-type="bibr" rid="bib9">Chen et al., 2016</xref>). Several methods have been developed to fit with the high-dimensional features of CyTOF data for differential analysis including diffcyt, CellCnn (<xref ref-type="bibr" rid="bib5">Arvaniti and Claassen, 2017</xref>), cydar (<xref ref-type="bibr" rid="bib19">Lun et al., 2017</xref>), citrus (<xref ref-type="bibr" rid="bib7">Bruggner et al., 2014</xref>), cyEMD (<xref ref-type="bibr" rid="bib4">Arend et al., 2022</xref>), etc. Nonetheless, none of them is applicable to compare more than two study groups at once which involves multiple testing. Therefore, to accommodate study designs involving multiple groups, ImmCellTyper does statistics via first applying Kruskal–Wallis test, followed by BH procedure for multiple testing correction and post hoc analysis via Dunn’s test or pairwise Wilcoxon test. In cases where the comparison involves only two groups, Mann–Whitney test will be applied in terms of cell frequency, as the distribution of CyTOF data generally does not fit for normal distribution.</p><p>One limitation of this computational pipeline is that its semi-supervised cluster identification may not be well suited for the direct identification of specific subpopulations which are defined by continuum markers. This is due to the method’s reliance on the presumption that makers are binary distributed. In addition, for users with general interest in charactering subclusters of each main cell lineage, it can be laborious to first perform BinaryClust then extract every population for unsupervised clustering. In such scenarios, BinaryClust can be used in parallel with other clustering methods or pipelines like CATALYST. This allows users to quickly obtain additional information about main cell types with the accuracy comparable to manual gating.</p><p>In summary, we introduce a novel open-source R-implemented strategy and a versatile toolbox for CyTOF data analysis. The future direction is to automate the data clean-up, compensation, and bead normalisation steps. Additionally, we also aim to implement the whole pipeline into Python, a more accessible programming language for bioinformatics novices and biologists who wish to perform high-dimensional data analysis independently.</p></sec><sec id="s4" sec-type="materials|methods"><title>Materials and methods</title><table-wrap id="keyresource" position="anchor"><label>Key resources table</label><table frame="hsides" rules="groups"><thead><tr><th align="left" valign="bottom">Reagent type (species) or resource</th><th align="left" valign="bottom">Designation</th><th align="left" valign="bottom">Source or reference</th><th align="left" valign="bottom">Identifiers</th><th align="left" valign="bottom">Additional information</th></tr></thead><tbody><tr><td align="left" valign="bottom">Antibody</td><td align="left" valign="bottom">Maxpar Direct Immune Profiling Assay</td><td align="left" valign="bottom">Standard Biotools</td><td align="left" valign="bottom">Cat# 201325</td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Antibody</td><td align="left" valign="bottom">anti-CD95<break/>(RRID:<ext-link ext-link-type="uri" xlink:href="https://identifiers.org/RRID/RRID:AB_314546">AB_314546</ext-link>,<break/>mouse, monoclonal)</td><td align="left" valign="bottom">Biolegend</td><td align="left" valign="bottom">Cat# 305607</td><td align="left" valign="bottom">1:200, 1.5 μl</td></tr><tr><td align="left" valign="bottom">Antibody</td><td align="left" valign="bottom">anti-TIGIT<break/>(mouse, monoclonal)</td><td align="left" valign="bottom">Standard Biotools</td><td align="left" valign="bottom">Cat# 201406 (Maxpar Direct T cell expansion panel 2)</td><td align="left" valign="bottom">1:300, 1 μl</td></tr><tr><td align="left" valign="bottom">Antibody</td><td align="left" valign="bottom">anti-PD1<break/>(mouse, monoclonal)</td><td align="left" valign="bottom">Standard Biotools</td><td align="left" valign="bottom">Cat# 201406 (Maxpar Direct T cell expansion panel 2)</td><td align="left" valign="bottom">1:200, 1.5 μl</td></tr><tr><td align="left" valign="bottom">Antibody</td><td align="left" valign="bottom">anti-ICOS<break/>(hamster, monoclonal)</td><td align="left" valign="bottom">Standard Biotools</td><td align="left" valign="bottom">Cat# 201406 (Maxpar Direct T cell expansion panel 2)</td><td align="left" valign="bottom">1:200, 1.5 μl</td></tr><tr><td align="left" valign="bottom">Antibody</td><td align="left" valign="bottom">anti-TIM3<break/>(mouse, monoclonal)</td><td align="left" valign="bottom">Standard Biotools</td><td align="left" valign="bottom">Cat# 201406 (Maxpar Direct T cell expansion panel 2)</td><td align="left" valign="bottom">1:300, 1 μl</td></tr><tr><td align="left" valign="bottom">Antibody</td><td align="left" valign="bottom">anti-OX40<break/>(mouse monoclonal)</td><td align="left" valign="bottom">Standard Biotools</td><td align="left" valign="bottom">Cat# 201406 (Maxpar Direct T cell expansion panel 2)</td><td align="left" valign="bottom">1:300, 1 μl</td></tr><tr><td align="left" valign="bottom">Antibody</td><td align="left" valign="bottom">anti-CXCR4<break/>(mouse, monoclonal)</td><td align="left" valign="bottom">Standard Biotools</td><td align="left" valign="bottom">Cat# 201406 (Maxpar Direct T cell expansion panel 2)</td><td align="left" valign="bottom">1:300, 1 μl</td></tr><tr><td align="left" valign="bottom">Genetic reagent; Recombinant DNA reagent</td><td align="left" valign="bottom">Pierce 16% Formaldehyde (methanol-free)</td><td align="left" valign="bottom">Thermo Fisher</td><td align="left" valign="bottom">Cat# 28906</td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Genetic reagent; Recombinant DNA reagent</td><td align="left" valign="bottom">Trypan blue solution (0.4%)</td><td align="left" valign="bottom">Gibco</td><td align="left" valign="bottom">Cat# 15250-061</td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Genetic reagent; Recombinant DNA reagent</td><td align="left" valign="bottom">Human TruStain FcX</td><td align="left" valign="bottom">Biolegend</td><td align="left" valign="bottom">Cat# 422302</td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Genetic reagent; Recombinant DNA reagent</td><td align="left" valign="bottom">EQ Four Element Calibration beads</td><td align="left" valign="bottom">Standard Biotools</td><td align="left" valign="bottom">Cat# 201078</td><td align="left" valign="bottom"/></tr></tbody></table></table-wrap><sec id="s4-1"><title>BinaryClust</title><p>Most of the CyTOF markers exhibit log-normal or bi-modal distribution with zero inflation after arcsinh transformation. Thus, we employ binary classification using <italic>k</italic>-means to group cells into negative and positive populations (<italic>k</italic> = 2) for each marker indicated in the user-defined classification matrix. Here, <italic>k</italic>-means is an unsupervised clustering algorithm to cluster the data based on the Euclidean distance among points, which is calculated by the formula below:<disp-formula id="equ1"><mml:math id="m1"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>d</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>q</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msqrt><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:mo>⋅</mml:mo><mml:mo>⋅</mml:mo><mml:mo>⋅</mml:mo><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>n</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>n</mml:mi></mml:msub><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mn>2</mml:mn></mml:msup></mml:msqrt><mml:mo>.</mml:mo></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>Then assign each data point into a cluster centroid which is denoted by <italic>ci</italic>, and dist() is the Euclidean distance:<disp-formula id="equ2"><mml:math id="m2"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>arg</mml:mi><mml:mspace width="thinmathspace"/><mml:munder><mml:mo form="prefix">min</mml:mo><mml:mrow><mml:mi>c</mml:mi><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:mi>C</mml:mi></mml:mrow></mml:munder><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>x</mml:mi><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mn>2</mml:mn></mml:msup></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>By aligning the <italic>k</italic>-means results with the user-designed classification matrix, cell populations can be subsequently classified and annotated.</p></sec><sec id="s4-2"><title>R package ImmCellTyper</title><p>This computational pipeline is implemented in the R package ImmCellTyper and publicly available on Github (<ext-link ext-link-type="uri" xlink:href="https://github.com/JingAnyaSun/ImmCellTyper">https://github.com/JingAnyaSun/ImmCellTyper</ext-link>, <xref ref-type="bibr" rid="bib29">Sun et al., 2023</xref>). Instructions for package installation and function usage can be found in the README file on the Github page. It is recommended to first examine the unwanted non-biological variation across batches and perform additional batch normalisation if necessary. Afterwards, import the data into the second part of the pipeline for downstream analysis. Users are required to prepare all the FCS files, sample metadata containing the details and grouping information of each sample, panel metadata with the information of the antibody panel with metal tags used in the experiments, and cell type classification matrix with phenotypic marker expression in a binary manner of each cell lineage. All files need to be in the right format to use the pipeline.</p></sec><sec id="s4-3"><title>ImmCellTyper workflow overview</title><p>ImmCellTyper pipeline is composed of seven steps corresponding to two separate sub-pipelines, as described in <xref ref-type="fig" rid="fig8">Figure 8</xref> and Github vignettes (<ext-link ext-link-type="uri" xlink:href="https://github.com/JingAnyaSun/ImmCellTyper/tree/main/vignettes">https://github.com/JingAnyaSun/ImmCellTyper/tree/main/vignettes</ext-link>; <xref ref-type="bibr" rid="bib29">Sun et al., 2023</xref>):</p><list list-type="order"><list-item><p>Sub-pipeline1 (corresponds to <xref ref-type="fig" rid="fig8">Figure 8</xref>, workflow step 2): Batch effects evaluation and correction. Batch effects occur when samples were collected and measured at different sites or time points, especially for large-scale studies. It is crucial to remove the unwanted variation which might interfere the true biological differences. After bead normalisation and data clean-up (<xref ref-type="fig" rid="fig8">Figure 8</xref>, workflow step 1), which can be performed using third-party platforms, such as CyTOF v7.0 system control software and Cytobank, users can systematically examine batch effects on two levels including marker behaviours and clustering results based on the method introduced by <xref ref-type="bibr" rid="bib31">Trussart et al., 2020</xref>. If needed, CytoNorm and CytofRUV, which are well-performing correction algorithms, can be used to align the existing batch effects.</p></list-item><list-item><p>Sub-pipeline2 (corresponds to <xref ref-type="fig" rid="fig8">Figure 8</xref>, workflow steps 3–7): Semi-supervised classification, differential analysis, and in-depth investigation. When data are cleaned and normalised, they can be imported into the second part of the pipeline, constructed into a SingleCellExperiment object, and undergo semi-supervised classification to identify the major cell types and test the differential frequencies or state marker expression among study groups. After that, if the users have certain interests of specific cell types and pre-design the panel for that, or in another circumstance, the initial statistics draw the user’s attention into a certain cell type, institutively, further clustering using unsupervised tools like flowSOM or Phenograph should be conducted with an increased cluster resolution and deeper investigation for cell subsets, after extracting the cell population of interest. ImmCellTyper pipeline has the same data storage and infrastructure as CATALYST, therefore all the functions in CATALYST can be seamlessly used in ImmCellTyper, tailored to user’s analytical needs. We do not elaborate on the basic functions of CATALYST, which can be found in the tutorial vignettes of the package (<ext-link ext-link-type="uri" xlink:href="https://github.com/HelenaLC/CATALYST">https://github.com/HelenaLC/CATALYST</ext-link>; <xref ref-type="bibr" rid="bib8">CATALYST-project, 2024</xref>).</p></list-item></list><fig id="fig8" position="float"><label>Figure 8.</label><caption><title>Overall schematic outline of the ImmCellTyper workflow with description for each step.</title></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-95494-fig8-v1.tif"/></fig></sec><sec id="s4-4"><title>Batch correction algorithms</title><p>The batch effect correction algorithms embedded in the function of ‘batchNorm’ comprises CytoNorm, as described by <xref ref-type="bibr" rid="bib33">Van Gassen et al., 2020</xref> and CytofRUV by <xref ref-type="bibr" rid="bib31">Trussart et al., 2020</xref>. Both algorithms rely on anchors (reference samples/technical replicates) across batches to perform normalisation. CytoNorm uses flowSOM clustering to first identify clusters prior to a population-specific transformation on the reference samples by computing the quantile values and aligning them with splines, whereas CytofRUV applies remove unwanted variation III (RUV-III) to CyTOF data by estimating and eliminating the non-biological variation of the pseudo-replicates.</p></sec><sec id="s4-5"><title>Agreement evaluation</title><p>To assess the agreement among manual gating, BinaryClust classification and flowSOM clustering, we used correlation, interaction plot, and Bland–Altman analysis. Correlation evaluates the relationship between two variables which does not mean concordance, but if two methods agree, surely, they should be highly correlated. We compared the results of cell population frequency generated by experts and BinaryClust using Pearson correlation, calculated the correlation coefficient and p value, with the line of equality indicating perfect agreement (red solid line, <italic>R</italic><sup>2</sup> = 1) in the plots to help gauge the degree of agreement between the two methods; Bland–Altman plot refers to a dot plot of the difference between two variables (<italic>y</italic>-axis) against the mean of them (<italic>x</italic>-axis), as described by J. Martian Bland and Douglas G. Altman in 1986, which represents a graphical magnitude of bias (average of difference) with 95% confidence interval. The math formula for the limit of agreement is as below:<disp-formula id="equ3"><mml:math id="m3"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi mathvariant="normal">L</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">t</mml:mi><mml:mi mathvariant="normal">s</mml:mi><mml:mspace width="thinmathspace"/><mml:mi mathvariant="normal">o</mml:mi><mml:mi mathvariant="normal">f</mml:mi><mml:mspace width="thinmathspace"/><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">g</mml:mi><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">t</mml:mi><mml:mo>=</mml:mo><mml:mspace width="thinmathspace"/><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mspace width="thinmathspace"/><mml:mi mathvariant="normal">d</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">f</mml:mi><mml:mi mathvariant="normal">f</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">c</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mspace width="thinmathspace"/><mml:mi mathvariant="normal">o</mml:mi><mml:mi mathvariant="normal">b</mml:mi><mml:mi mathvariant="normal">s</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">v</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">d</mml:mi><mml:mo>±</mml:mo><mml:mn>1.96</mml:mn><mml:mo>×</mml:mo><mml:mi mathvariant="normal">s</mml:mi><mml:mi mathvariant="normal">t</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">d</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">d</mml:mi><mml:mspace width="thinmathspace"/><mml:mi mathvariant="normal">d</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">v</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">t</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">o</mml:mi><mml:mi mathvariant="normal">n</mml:mi></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>We also used Interaction plot to display the interaction effects of the three methods including manual gating, BinaryClust classification, and flowSOM clustering on the measurement of cell frequencies to evaluate the agreement.</p></sec><sec id="s4-6"><title><italic>F</italic>-measure</title><p><italic>F</italic>-measure is a method to assess the accuracy of the clustering method compared to gold standard, which is manual gating results in this study. It stands for the harmonic mean of the precision and recall values, which can be calculated using below formula:<disp-formula id="equ4"><mml:math id="m4"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>F</mml:mi><mml:mrow><mml:mtext>-</mml:mtext><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">s</mml:mi><mml:mi mathvariant="normal">u</mml:mi><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">e</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mi>x</mml:mi><mml:mspace width="thinmathspace"/><mml:mfrac><mml:mrow><mml:mrow><mml:mi mathvariant="normal">P</mml:mi><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">c</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">s</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">o</mml:mi><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:mo>×</mml:mo><mml:mrow><mml:mi mathvariant="normal">R</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">c</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">l</mml:mi><mml:mi mathvariant="normal">l</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="normal">P</mml:mi><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">c</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">s</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">o</mml:mi><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mi mathvariant="normal">R</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">c</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">l</mml:mi><mml:mi mathvariant="normal">l</mml:mi></mml:mrow></mml:mrow></mml:mfrac></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>Here, precision represents the positive predictive value: the proportion of true positive instances divided by the instances classified as positive by the clustering algorithm; recall evaluates the sensitivity, which is the number of true positive events correctly identified by the algorithm among all events that belong to the cluster. <italic>F</italic>-measure ranges from 0 to 1, where 1 suggests perfect performance and 0 indicates poor precision and recall.</p></sec><sec id="s4-7"><title>Adjusted Rand Index</title><p>Adjusted Rand Index is a widely used method to measure the similarity between two clustering results. We used it to assess the agreement between test clustering algorithm and the gold standard labels which is derived from manual gating. ARI is defined as the following formula based on a contingency matrix (where <italic>n</italic><sub><italic>ij</italic></sub>, <italic>a</italic><sub><italic>i</italic></sub>, <italic>b</italic><sub><italic>j</italic></sub> are values from the contingency table):<disp-formula id="equ5"><mml:math id="m5"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi mathvariant="normal">A</mml:mi><mml:mi mathvariant="normal">R</mml:mi><mml:mi mathvariant="normal">I</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi mathvariant="normal">Σ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mtable rowspacing="4pt" columnspacing="1em"><mml:mtr><mml:mtd><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>2</mml:mn></mml:mtd></mml:mtr></mml:mtable><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi mathvariant="normal">Σ</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mtable rowspacing="4pt" columnspacing="1em"><mml:mtr><mml:mtd><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>2</mml:mn></mml:mtd></mml:mtr></mml:mtable><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mi mathvariant="normal">Σ</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mtable rowspacing="4pt" columnspacing="1em"><mml:mtr><mml:mtd><mml:msub><mml:mi>b</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>2</mml:mn></mml:mtd></mml:mtr></mml:mtable><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo fence="true" stretchy="true" symmetric="true" maxsize="1.623em" minsize="1.623em">/</mml:mo></mml:mrow><mml:mrow><mml:mtable rowspacing="4pt" columnspacing="1em"><mml:mtr><mml:mtd><mml:mi>n</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>2</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="normal">Σ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mtable rowspacing="4pt" columnspacing="1em"><mml:mtr><mml:mtd><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mtd></mml:mtr></mml:mtable><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi mathvariant="normal">Σ</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mtable rowspacing="4pt" columnspacing="1em"><mml:mtr><mml:mtd><mml:msub><mml:mi>b</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>2</mml:mn></mml:mtd></mml:mtr></mml:mtable><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="normal">Σ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mtable rowspacing="4pt" columnspacing="1em"><mml:mtr><mml:mtd><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mtd></mml:mtr></mml:mtable><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi mathvariant="normal">Σ</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mtable rowspacing="4pt" columnspacing="1em"><mml:mtr><mml:mtd><mml:msub><mml:mi>b</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>2</mml:mn></mml:mtd></mml:mtr></mml:mtable><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mrow><mml:mo fence="true" stretchy="true" symmetric="true" maxsize="1.623em" minsize="1.623em">/</mml:mo></mml:mrow><mml:mtable rowspacing="4pt" columnspacing="1em"><mml:mtr><mml:mtd><mml:mi>n</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>2</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mfrac></mml:mstyle></mml:mrow></mml:math></disp-formula></p></sec><sec id="s4-8"><title>Differential analysis</title><p>In order to perform the differential analysis of cell abundances and state marker expression among study groups, we consider the number of study groups into two conditions in function ‘StatTest’: (1) <italic>n</italic> = 2, Mann–Whitney–Wilcoxon analysis will be applied as cell frequency/marker expression does not fit normal distribution; (2) <italic>n</italic> = 3, Kruskal–Wallis test will be first performed followed by multiple testing correction using BH procedure and post hoc analysis (Dunn’s test or pairwise Wilcoxon test).</p></sec><sec id="s4-9"><title>Sample collection and preparation for CyTOF</title><p>PBMC samples from MPN patients were requested and obtained from biobank at Guy’s Hospital, under a protocol approved by the KCL Biobank Access Committee (REC18/EE/0025). Healthy volunteers were recruited at Guy’s hospital with informed consent and ethical approval by King’s College Research Ethics Committee (HR-17/18-5960 MOD-20/21-5960) in accordance with the Declaration of Helsinki. All identifiable information of study participants were securely stored in a trusted research environment managed by members of the team.</p><p>Venous blood samples from healthy volunteers were collected in BD vacutainer Ethylenediaminetetraacetic Acid (EDTA) tubes, and PBMCs were isolated and purified using Ficoll-Hypaque density gradient centrifugation. In brief, blood was carefully layered onto Ficoll and spined at 460 × <italic>g</italic> for 20 min at room temperature (RT) without brake; upon observing a clear separation of blood components, PBMCs were then carefully isolated and washed three times with RPMI 1640 medium to remove other contaminants. Subsequently, the purified PBMCs were cryopreserved in liquid nitrogen at a density of 1 × 10<sup>7</sup> cells per vial.</p></sec><sec id="s4-10"><title>CyTOF antibody staining</title><p>Cryopreserved cells were quickly thawed at 37°C in water bath, suspended in pre-warmed RPMI 1640 medium, washed three times, and underwent Fc-blocking using human TruStain FcX (Biolegend) for 10 min at RT. Given that the antibody panel employs indirect detection of CD95 using anti-CD95-APC and anti-APC-106Cd, cells were initially stained with anti-CD95-APC for 30 min in a dark place, followed by two washes with 2-ml cell staining buffer (CSB). After the removal of supernatant, cells were resuspended in 300 µl CSB and transferred into the dip tube containing lyophilised antibody mix of Maxpar direct immune profiling assay (Standard BioTools). Additional antibodies used to study T cell activation, migration, and exhaustion status (anti-TIM3, anti-PD-1, anti-ICOS, anti-TIGIT, and anti-OX40) were also added. Cells were incubated with the antibody mix for 30 min at RT in compliance with the manufacturer’s instructions, washed twice and fixed using a freshly prepared 1.6% paraformaldehyde (PFA, Thermo Fisher Scientific) solution for 10 min at RT. In the end, cells were washed with CSB twice to remove residual PFA and stained with 125 nM Cell-ID intercalator-Iridium in 1 ml Maxpar Fix and Perm Buffer (Standard BioTools) overnight at 4°C. The stained cells were frozen down using freezing media (fetal bovine serum containing 10% Dimethyl sulfoxide (DMSO)) and stored at −80°C freezer before data acquisition.</p><p>On the day for CyTOF acquisition, cryopreserved samples were thawed, washed twice with 1 ml CSB, followed by additional two washes with 1 ml cell acquisition solution (Standard BioTools), and centrifuged at 800 × <italic>g</italic> for 5 min. Cells were then filtered through a 40-μm cell strainer to avoid blockage and cell count was determined by Countess automated cell counter (Invitrogen). EQ four-element calibration beads (Standard BioTools) were added to a final concentration of 0.5 × 10<sup>6</sup> cells/ml to adjust signal fluctuation of the instrument. CyTOF acquisition was performed on Helios mass cytometer system. For each batch of cell staining and run, technical replicates from the same healthy donor were included to evaluate and correct batch effects.</p><p>The full antibody panel including the metal tag, clone, and supplier is listed in <xref ref-type="table" rid="app1table1">Appendix 1—table 1</xref>.</p></sec><sec id="s4-11"><title>CyTOF data pre-processing</title><p>FCS files were first processed for bead normalisation using CyTOF v7.0 system control software (Standard BioTools) to correct signal drift during acquisition. Subsequently, the files were imported into Cytobank (Cytobank Inc) for data cleaning, with a detailed procedure illustrated in <xref ref-type="fig" rid="fig1s2">Figure 1—figure supplement 2</xref>. The aim is to remove non-events including debris, doublets, normalisation (EQ) beads, and other undesired events like dead cells. The CD45<sup>+</sup> cell population was pre-gated using Cytobank for downstream analysis.</p></sec><sec id="s4-12"><title>Manual gating</title><p>Manual gating for major cell populations was performed using Cytobank platform, and gatingML files were exported and converted into gatingSet object to extract labels of each cell via the R packages flowWorkspace, openCyto, and CytoML. These data were used as reference for benchmarking computer-aided algorithms.</p></sec></sec></body><back><sec sec-type="additional-information" id="s5"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="COI-statement" id="conf1"><p>No competing interests declared</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>Conceptualization, Data curation, Software, Formal analysis, Investigation, Visualization, Methodology, Writing - original draft, Writing - review and editing</p></fn><fn fn-type="con" id="con2"><p>Conceptualization, Software, Supervision, Investigation, Methodology, Writing - review and editing</p></fn><fn fn-type="con" id="con3"><p>Validation, Methodology, Writing - review and editing</p></fn><fn fn-type="con" id="con4"><p>Investigation, Methodology, Writing - review and editing</p></fn><fn fn-type="con" id="con5"><p>Supervision, Funding acquisition, Project administration, Writing - review and editing</p></fn><fn fn-type="con" id="con6"><p>Conceptualization, Resources, Supervision, Funding acquisition, Investigation, Project administration, Writing - review and editing</p></fn></fn-group><fn-group content-type="ethics-information"><title>Ethics</title><fn fn-type="other"><p>PBMC samples from MPN patients were requested and obtained from biobank at Guy's Hospital, under a protocol approved by the KCL Biobank Access Committee (REC18/EE/0025). Healthy volunteers were recruited at Guy's hospital with informed consent and ethical approval by King's College Research Ethics Committee (HR-17/18-5960 MOD-20/21-5960) in accordance with the Declaration of Helsinki. All identifiable information of study participants were securely stored in a trusted research environment managed by members of the team.</p></fn></fn-group></sec><sec sec-type="supplementary-material" id="s6"><title>Additional files</title><supplementary-material id="mdar"><label>MDAR checklist</label><media xlink:href="elife-95494-mdarchecklist1-v1.pdf" mimetype="application" mime-subtype="pdf"/></supplementary-material></sec><sec sec-type="data-availability" id="s7"><title>Data availability</title><p>In this study, we tested ImmCellTyper pipeline on the MPN cohort with 7 MPN patients and 2 healthy volunteers, influenza cohort with 11 patients, and the COVID-19 cohort with 59 COVID-19 patients and 23 healthy volunteers. The FCS files (after clean-up and gating of CD45 population) and metadata of the MPN cohort were deposited in Zenodo (<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.10076940">https://doi.org/10.5281/zenodo.10076940</ext-link>); the influenza cohort was published by our lab (<xref ref-type="bibr" rid="bib3">Alimam et al., 2021</xref>), and the data were stored in Zenodo (<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.7982165">https://doi.org/10.5281/zenodo.7982165</ext-link>); the COVID-19 dataset was previously published by Chevrier et al. (<xref ref-type="bibr" rid="bib11">Chevrier et al., 2021</xref>) and the FCS files can be retrieved from Mendeley Data (<ext-link ext-link-type="uri" xlink:href="https://data.mendeley.com/datasets/vyy8ttw7n9/1">https://data.mendeley.com/datasets/vyy8ttw7n9/1</ext-link>).</p><p>The following dataset was generated:</p><p><element-citation publication-type="data" specific-use="isSupplementedBy" id="dataset1"><person-group person-group-type="author"><name><surname>Sun</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2023">2023</year><data-title>CyTOF data for MPN dataset</data-title><source>Zenodo</source><pub-id pub-id-type="doi">10.5281/zenodo.10076940</pub-id></element-citation></p><p>The following previously published datasets were used:</p><p><element-citation publication-type="data" specific-use="references" id="dataset2"><person-group person-group-type="author"><name><surname>Chevrier</surname><given-names>S</given-names></name><name><surname>Zurbuchen</surname><given-names>Y</given-names></name><name><surname>Cervia</surname><given-names>C</given-names></name></person-group><year iso-8601-date="2020">2020</year><data-title>A distinct innate immune signature marks progression from mild to severe COVID-19</data-title><source>Mendeley Data</source><pub-id pub-id-type="doi">10.17632/vyy8ttw7n9.1</pub-id></element-citation></p><p><element-citation publication-type="data" specific-use="references" id="dataset3"><person-group person-group-type="author"><name><surname>Alimam</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2021">2021</year><data-title>CyTOF test data for BinaryClust2</data-title><source>Zenodo</source><pub-id pub-id-type="doi">10.5281/zenodo.7982165</pub-id></element-citation></p></sec><ack id="ack"><title>Acknowledgements</title><p>This work is supported in part by: Blood Cancer UK [Ref. 22009] and CRUK City of London Centre (CoL) Award [CTRQQR-2021/100004] to MM and SK; JS was supported by the K-CSC scholarship. We thank BRC flowCore at Guy’s Hospital for technical support, Biobank at King’s College London for patient samples; We are thankful for Cynthia Bishop, Katrina Todd, Rosa Andres Ejarque, Elena Torre, Robert Page, Rita Antunes Dos Reis, and Mishto lab members at King’s College London, Daniel Dancer, Thomas Adejumo at Standard Biotools for technical assistance and sample management, as well as all study participants for their kind support for this research. Special thanks to Eliezer Van Allen and Jihye Park at Dana Farber Cancer Institute to review and comment this work.</p></ack><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Abdelaal</surname><given-names>T</given-names></name><name><surname>van Unen</surname><given-names>V</given-names></name><name><surname>Höllt</surname><given-names>T</given-names></name><name><surname>Koning</surname><given-names>F</given-names></name><name><surname>Reinders</surname><given-names>MJT</given-names></name><name><surname>Mahfouz</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Predicting cell populations in single cell mass cytometry data</article-title><source>Cytometry. Part A</source><volume>95</volume><fpage>769</fpage><lpage>781</lpage><pub-id pub-id-type="doi">10.1002/cyto.a.23738</pub-id><pub-id pub-id-type="pmid">30861637</pub-id></element-citation></ref><ref id="bib2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Aghaeepour</surname><given-names>N</given-names></name><name><surname>Nikolic</surname><given-names>R</given-names></name><name><surname>Hoos</surname><given-names>HH</given-names></name><name><surname>Brinkman</surname><given-names>RR</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Rapid cell population identification in flow cytometry data</article-title><source>Cytometry. Part A</source><volume>79</volume><fpage>6</fpage><lpage>13</lpage><pub-id pub-id-type="doi">10.1002/cyto.a.21007</pub-id><pub-id pub-id-type="pmid">21182178</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Alimam</surname><given-names>S</given-names></name><name><surname>Ann Timms</surname><given-names>J</given-names></name><name><surname>Harrison</surname><given-names>CN</given-names></name><name><surname>Dillon</surname><given-names>R</given-names></name><name><surname>Mare</surname><given-names>T</given-names></name><name><surname>DeLavallade</surname><given-names>H</given-names></name><name><surname>Radia</surname><given-names>D</given-names></name><name><surname>Woodley</surname><given-names>C</given-names></name><name><surname>Francis</surname><given-names>Y</given-names></name><name><surname>Sanchez</surname><given-names>K</given-names></name><name><surname>Kordasti</surname><given-names>S</given-names></name><name><surname>McLornan</surname><given-names>DP</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Altered immune response to the annual influenza A vaccine in patients with myeloproliferative neoplasms</article-title><source>British Journal of Haematology</source><volume>193</volume><fpage>150</fpage><lpage>154</lpage><pub-id pub-id-type="doi">10.1111/bjh.17096</pub-id><pub-id pub-id-type="pmid">33159465</pub-id></element-citation></ref><ref id="bib4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Arend</surname><given-names>L</given-names></name><name><surname>Bernett</surname><given-names>J</given-names></name><name><surname>Manz</surname><given-names>Q</given-names></name><name><surname>Klug</surname><given-names>M</given-names></name><name><surname>Lazareva</surname><given-names>O</given-names></name><name><surname>Baumbach</surname><given-names>J</given-names></name><name><surname>Bongiovanni</surname><given-names>D</given-names></name><name><surname>List</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2022">2022</year><article-title>A systematic comparison of novel and existing differential analysis methods for CyTOF data</article-title><source>Briefings in Bioinformatics</source><volume>23</volume><elocation-id>bbab471</elocation-id><pub-id pub-id-type="doi">10.1093/bib/bbab471</pub-id><pub-id pub-id-type="pmid">34850807</pub-id></element-citation></ref><ref id="bib5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Arvaniti</surname><given-names>E</given-names></name><name><surname>Claassen</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Sensitive detection of rare disease-associated cell subsets via representation learning</article-title><source>Nature Communications</source><volume>8</volume><elocation-id>14825</elocation-id><pub-id pub-id-type="doi">10.1038/ncomms14825</pub-id><pub-id pub-id-type="pmid">28382969</pub-id></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Becher</surname><given-names>B</given-names></name><name><surname>Schlitzer</surname><given-names>A</given-names></name><name><surname>Chen</surname><given-names>J</given-names></name><name><surname>Mair</surname><given-names>F</given-names></name><name><surname>Sumatoh</surname><given-names>HR</given-names></name><name><surname>Teng</surname><given-names>KWW</given-names></name><name><surname>Low</surname><given-names>D</given-names></name><name><surname>Ruedl</surname><given-names>C</given-names></name><name><surname>Riccardi-Castagnoli</surname><given-names>P</given-names></name><name><surname>Poidinger</surname><given-names>M</given-names></name><name><surname>Greter</surname><given-names>M</given-names></name><name><surname>Ginhoux</surname><given-names>F</given-names></name><name><surname>Newell</surname><given-names>EW</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>High-dimensional analysis of the murine myeloid cell system</article-title><source>Nature Immunology</source><volume>15</volume><fpage>1181</fpage><lpage>1189</lpage><pub-id pub-id-type="doi">10.1038/ni.3006</pub-id><pub-id pub-id-type="pmid">25306126</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bruggner</surname><given-names>RV</given-names></name><name><surname>Bodenmiller</surname><given-names>B</given-names></name><name><surname>Dill</surname><given-names>DL</given-names></name><name><surname>Tibshirani</surname><given-names>RJ</given-names></name><name><surname>Nolan</surname><given-names>GP</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Automated identification of stratifying signatures in cellular subpopulations</article-title><source>PNAS</source><volume>111</volume><fpage>E2770</fpage><lpage>E2777</lpage><pub-id pub-id-type="doi">10.1073/pnas.1408792111</pub-id><pub-id pub-id-type="pmid">24979804</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="software"><person-group person-group-type="author"><collab>CATALYST-project</collab></person-group><year iso-8601-date="2024">2024</year><data-title>CATALYST</data-title><version designator="462b121">462b121</version><source>GitHub</source><ext-link ext-link-type="uri" xlink:href="https://github.com/HelenaLC/CATALYST">https://github.com/HelenaLC/CATALYST</ext-link></element-citation></ref><ref id="bib9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname><given-names>H</given-names></name><name><surname>Lau</surname><given-names>MC</given-names></name><name><surname>Wong</surname><given-names>MT</given-names></name><name><surname>Newell</surname><given-names>EW</given-names></name><name><surname>Poidinger</surname><given-names>M</given-names></name><name><surname>Chen</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Cytofkit: a bioconductor package for an integrated mass cytometry data analysis pipeline</article-title><source>PLOS Computational Biology</source><volume>12</volume><elocation-id>e1005112</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1005112</pub-id><pub-id pub-id-type="pmid">27662185</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cheng</surname><given-names>L</given-names></name><name><surname>Karkhanis</surname><given-names>P</given-names></name><name><surname>Gokbag</surname><given-names>B</given-names></name><name><surname>Liu</surname><given-names>Y</given-names></name><name><surname>Li</surname><given-names>L</given-names></name></person-group><year iso-8601-date="2022">2022</year><article-title>DGCyTOF: Deep learning with graphic cluster visualization to predict cell types of single cell mass cytometry data</article-title><source>PLOS Computational Biology</source><volume>18</volume><elocation-id>e1008885</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1008885</pub-id><pub-id pub-id-type="pmid">35404970</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chevrier</surname><given-names>S</given-names></name><name><surname>Zurbuchen</surname><given-names>Y</given-names></name><name><surname>Cervia</surname><given-names>C</given-names></name><name><surname>Adamo</surname><given-names>S</given-names></name><name><surname>Raeber</surname><given-names>ME</given-names></name><name><surname>de Souza</surname><given-names>N</given-names></name><name><surname>Sivapatham</surname><given-names>S</given-names></name><name><surname>Jacobs</surname><given-names>A</given-names></name><name><surname>Bachli</surname><given-names>E</given-names></name><name><surname>Rudiger</surname><given-names>A</given-names></name><name><surname>Stüssi-Helbling</surname><given-names>M</given-names></name><name><surname>Huber</surname><given-names>LC</given-names></name><name><surname>Schaer</surname><given-names>DJ</given-names></name><name><surname>Nilsson</surname><given-names>J</given-names></name><name><surname>Boyman</surname><given-names>O</given-names></name><name><surname>Bodenmiller</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>A distinct innate immune signature marks progression from mild to severe COVID-19</article-title><source>Cell Reports. Medicine</source><volume>2</volume><elocation-id>100166</elocation-id><pub-id pub-id-type="doi">10.1016/j.xcrm.2020.100166</pub-id><pub-id pub-id-type="pmid">33521697</pub-id></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kaushik</surname><given-names>A</given-names></name><name><surname>Dunham</surname><given-names>D</given-names></name><name><surname>He</surname><given-names>Z</given-names></name><name><surname>Manohar</surname><given-names>M</given-names></name><name><surname>Desai</surname><given-names>M</given-names></name><name><surname>Nadeau</surname><given-names>KC</given-names></name><name><surname>Andorf</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>CyAnno: a semi-automated approach for cell type annotation of mass cytometry datasets</article-title><source>Bioinformatics</source><volume>37</volume><fpage>4164</fpage><lpage>4171</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btab409</pub-id><pub-id pub-id-type="pmid">34037686</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kimball</surname><given-names>AK</given-names></name><name><surname>Oko</surname><given-names>LM</given-names></name><name><surname>Bullock</surname><given-names>BL</given-names></name><name><surname>Nemenoff</surname><given-names>RA</given-names></name><name><surname>van Dyk</surname><given-names>LF</given-names></name><name><surname>Clambey</surname><given-names>ET</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>A beginner’s guide to analyzing and visualizing mass cytometry data</article-title><source>Journal of Immunology</source><volume>200</volume><fpage>3</fpage><lpage>22</lpage><pub-id pub-id-type="doi">10.4049/jimmunol.1701494</pub-id><pub-id pub-id-type="pmid">29255085</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lee</surname><given-names>HC</given-names></name><name><surname>Kosoy</surname><given-names>R</given-names></name><name><surname>Becker</surname><given-names>CE</given-names></name><name><surname>Dudley</surname><given-names>JT</given-names></name><name><surname>Kidd</surname><given-names>BA</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Automated cell type discovery and classification through knowledge transfer</article-title><source>Bioinformatics</source><volume>33</volume><fpage>1689</fpage><lpage>1695</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btx054</pub-id><pub-id pub-id-type="pmid">28158442</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Levine</surname><given-names>JH</given-names></name><name><surname>Simonds</surname><given-names>EF</given-names></name><name><surname>Bendall</surname><given-names>SC</given-names></name><name><surname>Davis</surname><given-names>KL</given-names></name><name><surname>Amir</surname><given-names>ED</given-names></name><name><surname>Tadmor</surname><given-names>MD</given-names></name><name><surname>Litvin</surname><given-names>O</given-names></name><name><surname>Fienberg</surname><given-names>HG</given-names></name><name><surname>Jager</surname><given-names>A</given-names></name><name><surname>Zunder</surname><given-names>ER</given-names></name><name><surname>Finck</surname><given-names>R</given-names></name><name><surname>Gedman</surname><given-names>AL</given-names></name><name><surname>Radtke</surname><given-names>I</given-names></name><name><surname>Downing</surname><given-names>JR</given-names></name><name><surname>Pe’er</surname><given-names>D</given-names></name><name><surname>Nolan</surname><given-names>GP</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Data-driven phenotypic dissection of AML reveals progenitor-like cells that correlate with prognosis</article-title><source>Cell</source><volume>162</volume><fpage>184</fpage><lpage>197</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2015.05.047</pub-id><pub-id pub-id-type="pmid">26095251</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>H</given-names></name><name><surname>Shaham</surname><given-names>U</given-names></name><name><surname>Stanton</surname><given-names>KP</given-names></name><name><surname>Yao</surname><given-names>Y</given-names></name><name><surname>Montgomery</surname><given-names>RR</given-names></name><name><surname>Kluger</surname><given-names>Y</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Gating mass cytometry data by deep learning</article-title><source>Bioinformatics</source><volume>33</volume><fpage>3423</fpage><lpage>3430</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btx448</pub-id><pub-id pub-id-type="pmid">29036374</pub-id></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liu</surname><given-names>X</given-names></name><name><surname>Song</surname><given-names>W</given-names></name><name><surname>Wong</surname><given-names>BY</given-names></name><name><surname>Zhang</surname><given-names>T</given-names></name><name><surname>Yu</surname><given-names>S</given-names></name><name><surname>Lin</surname><given-names>GN</given-names></name><name><surname>Ding</surname><given-names>X</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>A comparison framework and guideline of clustering methods for mass cytometry data</article-title><source>Genome Biology</source><volume>20</volume><elocation-id>297</elocation-id><pub-id pub-id-type="doi">10.1186/s13059-019-1917-7</pub-id><pub-id pub-id-type="pmid">31870419</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liu</surname><given-names>P</given-names></name><name><surname>Liu</surname><given-names>S</given-names></name><name><surname>Fang</surname><given-names>Y</given-names></name><name><surname>Xue</surname><given-names>X</given-names></name><name><surname>Zou</surname><given-names>J</given-names></name><name><surname>Tseng</surname><given-names>G</given-names></name><name><surname>Konnikova</surname><given-names>L</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Recent advances in computer-assisted algorithms for cell subtype identification of cytometry data</article-title><source>Frontiers in Cell and Developmental Biology</source><volume>8</volume><elocation-id>234</elocation-id><pub-id pub-id-type="doi">10.3389/fcell.2020.00234</pub-id><pub-id pub-id-type="pmid">32411698</pub-id></element-citation></ref><ref id="bib19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lun</surname><given-names>ATL</given-names></name><name><surname>Richard</surname><given-names>AC</given-names></name><name><surname>Marioni</surname><given-names>JC</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Testing for differential abundance in mass cytometry data</article-title><source>Nature Methods</source><volume>14</volume><fpage>707</fpage><lpage>709</lpage><pub-id pub-id-type="doi">10.1038/nmeth.4295</pub-id><pub-id pub-id-type="pmid">28504682</pub-id></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Maaten</surname><given-names>L</given-names></name><name><surname>Hinton</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Viualizing data using t-SNE</article-title><source>Journal of Machine Learning Research</source><volume>9</volume><fpage>2579</fpage><lpage>2605</lpage></element-citation></ref><ref id="bib21"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Marsh-Wakefield</surname><given-names>F</given-names></name><name><surname>Kruzins</surname><given-names>A</given-names></name><name><surname>McGuire</surname><given-names>HM</given-names></name><name><surname>Yang</surname><given-names>S</given-names></name><name><surname>Bryant</surname><given-names>C</given-names></name><name><surname>Fazekas de St Groth</surname><given-names>B</given-names></name><name><surname>Nassif</surname><given-names>N</given-names></name><name><surname>Byrne</surname><given-names>SN</given-names></name><name><surname>Gibson</surname><given-names>J</given-names></name><name><surname>Brown</surname><given-names>C</given-names></name><name><surname>Larsen</surname><given-names>S</given-names></name><name><surname>McCulloch</surname><given-names>D</given-names></name><name><surname>Boyle</surname><given-names>R</given-names></name><name><surname>Clark</surname><given-names>G</given-names></name><name><surname>Joshua</surname><given-names>D</given-names></name><name><surname>Ho</surname><given-names>PJ</given-names></name><name><surname>Vuckovic</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Mass cytometry discovers two discrete subsets of CD39<sup>-</sup>Treg which discriminate mgus from multiple myeloma</article-title><source>Frontiers in Immunology</source><volume>10</volume><elocation-id>1596</elocation-id><pub-id pub-id-type="doi">10.3389/fimmu.2019.01596</pub-id><pub-id pub-id-type="pmid">31428081</pub-id></element-citation></ref><ref id="bib22"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>McInnes</surname><given-names>L</given-names></name><name><surname>Healy</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>UMAP: Uniform Manifold Approximation and Projection for Dimension Reduction</article-title><source>arXiv</source><ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/1802.03426">https://arxiv.org/abs/1802.03426</ext-link></element-citation></ref><ref id="bib23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nowicka</surname><given-names>M</given-names></name><name><surname>Krieg</surname><given-names>C</given-names></name><name><surname>Crowell</surname><given-names>HL</given-names></name><name><surname>Weber</surname><given-names>LM</given-names></name><name><surname>Hartmann</surname><given-names>FJ</given-names></name><name><surname>Guglietta</surname><given-names>S</given-names></name><name><surname>Becher</surname><given-names>B</given-names></name><name><surname>Levesque</surname><given-names>MP</given-names></name><name><surname>Robinson</surname><given-names>MD</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>CyTOF workflow: differential discovery in high-throughput high-dimensional cytometry datasets</article-title><source>F1000Research</source><volume>6</volume><elocation-id>748</elocation-id><pub-id pub-id-type="doi">10.12688/f1000research.11622.3</pub-id><pub-id pub-id-type="pmid">28663787</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>O’Brien Gore</surname><given-names>C</given-names></name><name><surname>Billman</surname><given-names>A</given-names></name><name><surname>Hunjan</surname><given-names>S</given-names></name><name><surname>Colebrook</surname><given-names>J</given-names></name><name><surname>Choy</surname><given-names>D</given-names></name><name><surname>Li</surname><given-names>W</given-names></name><name><surname>Haynes</surname><given-names>J</given-names></name><name><surname>Wade</surname><given-names>J</given-names></name><name><surname>Hobern</surname><given-names>E</given-names></name><name><surname>McDonald</surname><given-names>L</given-names></name><name><surname>Papa</surname><given-names>S</given-names></name><name><surname>Brugman</surname><given-names>M</given-names></name><name><surname>Kordasti</surname><given-names>S</given-names></name><name><surname>Montiel-Equihua</surname><given-names>C</given-names></name></person-group><year iso-8601-date="2023">2023</year><article-title>Pre-treatment with systemic agents for advanced NSCLC elicits changes in the phenotype of autologous Tcell therapy products</article-title><source>Molecular Therapy Oncolytics</source><volume>31</volume><elocation-id>100749</elocation-id><pub-id pub-id-type="doi">10.1016/j.omto.2023.100749</pub-id><pub-id pub-id-type="pmid">38075248</pub-id></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Opzoomer</surname><given-names>JW</given-names></name><name><surname>Timms</surname><given-names>JA</given-names></name><name><surname>Blighe</surname><given-names>K</given-names></name><name><surname>Mourikis</surname><given-names>TP</given-names></name><name><surname>Chapuis</surname><given-names>N</given-names></name><name><surname>Bekoe</surname><given-names>R</given-names></name><name><surname>Kareemaghay</surname><given-names>S</given-names></name><name><surname>Nocerino</surname><given-names>P</given-names></name><name><surname>Apollonio</surname><given-names>B</given-names></name><name><surname>Ramsay</surname><given-names>AG</given-names></name><name><surname>Tavassoli</surname><given-names>M</given-names></name><name><surname>Harrison</surname><given-names>C</given-names></name><name><surname>Ciccarelli</surname><given-names>F</given-names></name><name><surname>Parker</surname><given-names>P</given-names></name><name><surname>Fontenay</surname><given-names>M</given-names></name><name><surname>Barber</surname><given-names>PR</given-names></name><name><surname>Arnold</surname><given-names>JN</given-names></name><name><surname>Kordasti</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title><italic>ImmunoCluster</italic> provides a computational framework for the nonspecialist to profile high-dimensional cytometry data</article-title><source>eLife</source><volume>10</volume><elocation-id>e62915</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.62915</pub-id><pub-id pub-id-type="pmid">33929322</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Qiu</surname><given-names>P</given-names></name><name><surname>Simonds</surname><given-names>EF</given-names></name><name><surname>Bendall</surname><given-names>SC</given-names></name><name><surname>Gibbs</surname><given-names>KD</given-names></name><name><surname>Bruggner</surname><given-names>RV</given-names></name><name><surname>Linderman</surname><given-names>MD</given-names></name><name><surname>Sachs</surname><given-names>K</given-names></name><name><surname>Nolan</surname><given-names>GP</given-names></name><name><surname>Plevritis</surname><given-names>SK</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Extracting a cellular hierarchy from high-dimensional cytometry data with SPADE</article-title><source>Nature Biotechnology</source><volume>29</volume><fpage>886</fpage><lpage>891</lpage><pub-id pub-id-type="doi">10.1038/nbt.1991</pub-id><pub-id pub-id-type="pmid">21964415</pub-id></element-citation></ref><ref id="bib27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Samusik</surname><given-names>N</given-names></name><name><surname>Good</surname><given-names>Z</given-names></name><name><surname>Spitzer</surname><given-names>MH</given-names></name><name><surname>Davis</surname><given-names>KL</given-names></name><name><surname>Nolan</surname><given-names>GP</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Automated mapping of phenotype space with single-cell data</article-title><source>Nature Methods</source><volume>13</volume><fpage>493</fpage><lpage>496</lpage><pub-id pub-id-type="doi">10.1038/nmeth.3863</pub-id><pub-id pub-id-type="pmid">27183440</pub-id></element-citation></ref><ref id="bib28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Spitzer</surname><given-names>MH</given-names></name><name><surname>Nolan</surname><given-names>GP</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Mass cytometry: single cells, many features</article-title><source>Cell</source><volume>165</volume><fpage>780</fpage><lpage>791</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2016.04.019</pub-id><pub-id pub-id-type="pmid">27153492</pub-id></element-citation></ref><ref id="bib29"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Sun</surname><given-names>J</given-names></name><name><surname>Choy</surname><given-names>D</given-names></name><name><surname>Kordasti</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2023">2023</year><data-title>ImmCellTyper</data-title><version designator="Version 0.0.0.9000">Version 0.0.0.9000</version><source>Github</source><ext-link ext-link-type="uri" xlink:href="https://github.com/JingAnyaSun/ImmCellTyper">https://github.com/JingAnyaSun/ImmCellTyper</ext-link></element-citation></ref><ref id="bib30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Theorell</surname><given-names>A</given-names></name><name><surname>Bryceson</surname><given-names>YT</given-names></name><name><surname>Theorell</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Determination of essential phenotypic elements of clusters in high-dimensional entities-DEPECHE</article-title><source>PLOS ONE</source><volume>14</volume><elocation-id>e0203247</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0203247</pub-id><pub-id pub-id-type="pmid">30845234</pub-id></element-citation></ref><ref id="bib31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Trussart</surname><given-names>M</given-names></name><name><surname>Teh</surname><given-names>CE</given-names></name><name><surname>Tan</surname><given-names>T</given-names></name><name><surname>Leong</surname><given-names>L</given-names></name><name><surname>Gray</surname><given-names>DH</given-names></name><name><surname>Speed</surname><given-names>TP</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Removing unwanted variation with CytofRUV to integrate multiple CyTOF datasets</article-title><source>eLife</source><volume>9</volume><elocation-id>e59630</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.59630</pub-id><pub-id pub-id-type="pmid">32894218</pub-id></element-citation></ref><ref id="bib32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Van Gassen</surname><given-names>S</given-names></name><name><surname>Callebaut</surname><given-names>B</given-names></name><name><surname>Van Helden</surname><given-names>MJ</given-names></name><name><surname>Lambrecht</surname><given-names>BN</given-names></name><name><surname>Demeester</surname><given-names>P</given-names></name><name><surname>Dhaene</surname><given-names>T</given-names></name><name><surname>Saeys</surname><given-names>Y</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>FlowSOM: using self-organizing maps for visualization and interpretation of cytometry data</article-title><source>Cytometry. Part A</source><volume>87</volume><fpage>636</fpage><lpage>645</lpage><pub-id pub-id-type="doi">10.1002/cyto.a.22625</pub-id><pub-id pub-id-type="pmid">25573116</pub-id></element-citation></ref><ref id="bib33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Van Gassen</surname><given-names>S</given-names></name><name><surname>Gaudilliere</surname><given-names>B</given-names></name><name><surname>Angst</surname><given-names>MS</given-names></name><name><surname>Saeys</surname><given-names>Y</given-names></name><name><surname>Aghaeepour</surname><given-names>N</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>CytoNorm: a normalization algorithm for cytometry data</article-title><source>Cytometry. Part A</source><volume>97</volume><fpage>268</fpage><lpage>278</lpage><pub-id pub-id-type="doi">10.1002/cyto.a.23904</pub-id><pub-id pub-id-type="pmid">31633883</pub-id></element-citation></ref><ref id="bib34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Weber</surname><given-names>LM</given-names></name><name><surname>Nowicka</surname><given-names>M</given-names></name><name><surname>Soneson</surname><given-names>C</given-names></name><name><surname>Robinson</surname><given-names>MD</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Diffcyt: differential discovery in high-dimensional cytometry via high-resolution clustering</article-title><source>Communications Biology</source><volume>2</volume><elocation-id>183</elocation-id><pub-id pub-id-type="doi">10.1038/s42003-019-0415-5</pub-id><pub-id pub-id-type="pmid">31098416</pub-id></element-citation></ref><ref id="bib35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhang</surname><given-names>Z</given-names></name><name><surname>Luo</surname><given-names>D</given-names></name><name><surname>Zhong</surname><given-names>X</given-names></name><name><surname>Choi</surname><given-names>JH</given-names></name><name><surname>Ma</surname><given-names>Y</given-names></name><name><surname>Wang</surname><given-names>S</given-names></name><name><surname>Mahrt</surname><given-names>E</given-names></name><name><surname>Guo</surname><given-names>W</given-names></name><name><surname>Stawiski</surname><given-names>EW</given-names></name><name><surname>Modrusan</surname><given-names>Z</given-names></name><name><surname>Seshagiri</surname><given-names>S</given-names></name><name><surname>Kapur</surname><given-names>P</given-names></name><name><surname>Hon</surname><given-names>GC</given-names></name><name><surname>Brugarolas</surname><given-names>J</given-names></name><name><surname>Wang</surname><given-names>T</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>SCINA: a semi-supervised subtyping algorithm of single cells and bulk samples</article-title><source>Genes</source><volume>10</volume><elocation-id>531</elocation-id><pub-id pub-id-type="doi">10.3390/genes10070531</pub-id><pub-id pub-id-type="pmid">31336988</pub-id></element-citation></ref></ref-list><app-group><app id="appendix-1"><title>Appendix 1</title><table-wrap id="app1table1" position="float"><label>Appendix 1—table 1.</label><caption><title>CyTOF antibody panel for MPN cohort.</title></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" valign="bottom">Antibody</th><th align="left" valign="bottom">Clone</th><th align="left" valign="bottom">Metal tag</th><th align="left" valign="top">Manufacturer</th></tr></thead><tbody><tr><td align="left" valign="bottom">Anti-CD45</td><td align="left" valign="bottom">HI30</td><td align="left" valign="bottom">89Y</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Live/dead Indicator</td><td align="left" valign="bottom">N/A</td><td align="left" valign="bottom">103Rh</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CD95</td><td align="left" valign="bottom">DX2</td><td align="left" valign="bottom">APC</td><td align="left" valign="top">Biolegend</td></tr><tr><td align="left" valign="bottom">Anti-APC</td><td align="left" valign="bottom">APC003</td><td align="left" valign="bottom">106Cd</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CD196</td><td align="left" valign="bottom">G034E3</td><td align="left" valign="bottom">141Pr</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-OX40</td><td align="left" valign="bottom">ACT35</td><td align="left" valign="bottom">142Nd</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CD123</td><td align="left" valign="bottom">6H6</td><td align="left" valign="bottom">143Nd</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CD19</td><td align="left" valign="bottom">HIB19</td><td align="left" valign="bottom">144Nd</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CD4</td><td align="left" valign="bottom">RPA-T4</td><td align="left" valign="bottom">145Nd</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CD8a</td><td align="left" valign="bottom">RPA-T8</td><td align="left" valign="bottom">146Nd</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CD11c</td><td align="left" valign="bottom">Bu15</td><td align="left" valign="bottom">147Sm</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CD16</td><td align="left" valign="bottom">3G8</td><td align="left" valign="bottom">148Nd</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CD45RO</td><td align="left" valign="bottom">UCHL1</td><td align="left" valign="bottom">149Sm</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CD45RA</td><td align="left" valign="bottom">HI100</td><td align="left" valign="bottom">150Nd</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CD161</td><td align="left" valign="bottom">HP-3G10</td><td align="left" valign="bottom">151Eu</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CD194</td><td align="left" valign="bottom">L291H4</td><td align="left" valign="bottom">152Sm</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CD25</td><td align="left" valign="bottom">BC96</td><td align="left" valign="bottom">153Eu</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CD27</td><td align="left" valign="bottom">O323</td><td align="left" valign="bottom">154Sm</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CD57</td><td align="left" valign="bottom">HCD57</td><td align="left" valign="bottom">155Gd</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CD183</td><td align="left" valign="bottom">G025H7</td><td align="left" valign="bottom">156Gd</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CD185</td><td align="left" valign="bottom">J252D4</td><td align="left" valign="bottom">158Gd</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-TIM-3</td><td align="left" valign="bottom">F38-2E2</td><td align="left" valign="bottom">159Tb</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CD28</td><td align="left" valign="bottom">CD28.2</td><td align="left" valign="bottom">160Gd</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CD38</td><td align="left" valign="bottom">HB-7</td><td align="left" valign="bottom">161Dy</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CD56</td><td align="left" valign="bottom">NCAM16.2</td><td align="left" valign="bottom">163Dy</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-TCRgd</td><td align="left" valign="bottom">B1</td><td align="left" valign="bottom">164Dy</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-PD-1</td><td align="left" valign="bottom">EH12.2H7</td><td align="left" valign="bottom">165Ho</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CD294</td><td align="left" valign="bottom">BM16</td><td align="left" valign="bottom">166Er</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CD197</td><td align="left" valign="bottom">G043H7</td><td align="left" valign="bottom">167Er</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CD14</td><td align="left" valign="bottom">63D3</td><td align="left" valign="bottom">168Er</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-ICOS</td><td align="left" valign="bottom">C398.4A</td><td align="left" valign="bottom">169Tm</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CD3</td><td align="left" valign="bottom">UCHT1</td><td align="left" valign="bottom">170Er</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CD20</td><td align="left" valign="bottom">2H7</td><td align="left" valign="bottom">171Yb</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CD66b</td><td align="left" valign="bottom">G10F5</td><td align="left" valign="bottom">172Yb</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-HLA-DR</td><td align="left" valign="bottom">LN3</td><td align="left" valign="bottom">173Yb</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-IgD</td><td align="left" valign="bottom">IA6-2</td><td align="left" valign="bottom">174Yb</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CXCR4</td><td align="left" valign="bottom">12G5</td><td align="left" valign="bottom">175Lu</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-CD127</td><td align="left" valign="bottom">A019D5</td><td align="left" valign="bottom">176Yb</td><td align="left" valign="top">Standard BioTools</td></tr><tr><td align="left" valign="bottom">Anti-TIGIT</td><td align="left" valign="bottom">MBSA43</td><td align="left" valign="bottom">209Bi</td><td align="left" valign="top">Standard BioTools</td></tr></tbody></table></table-wrap></app></app-group></back><sub-article article-type="editor-report" id="sa0"><front-stub><article-id pub-id-type="doi">10.7554/eLife.95494.3.sa0</article-id><title-group><article-title>eLife assessment</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Hong</surname><given-names>Seunghee</given-names></name><role specific-use="editor">Reviewing Editor</role><aff><institution>Yonsei University</institution><country>Republic of Korea</country></aff></contrib></contrib-group><kwd-group kwd-group-type="evidence-strength"><kwd>Convincing</kwd></kwd-group><kwd-group kwd-group-type="claim-importance"><kwd>Useful</kwd></kwd-group></front-stub><body><p>ImmCellTyper presents a <bold>useful</bold> toolkit for CyTOF data analysis, integrating BinaryClust for semi-supervised clustering and cell type annotation. The evidence supporting the findings is <bold>convincing</bold>, with appropriate and validated methodology. This tool will be helpful to researchers in immunology and cytometry, offering a robust solution for cell type identification and differential analysis.</p></body></sub-article><sub-article article-type="referee-report" id="sa1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.95494.3.sa1</article-id><title-group><article-title>Reviewer #3 (Public rbioreview):</article-title></title-group><contrib-group><contrib contrib-type="author"><anonymous/><role specific-use="referee">Reviewer</role></contrib></contrib-group></front-stub><body><p>Summary:</p><p>ImmCellTyper is a new toolkit for Cytometry by time-of-flight data analysis. It includes BinaryClust, a semi-supervised clustering tool (which takes into account the prior biological knowledge), designed for automated classification and annotation of specific cell types and subpopulations. ImmCellTyper also integrates a variety of tools to perform data quality analysis, batch effect correction, dimension reduction, unsupervised clustering, and differential analysis.</p><p>Strengths:</p><p>The proposed algorithm takes into account the prior knowledge.</p><p>The results on different benchmark indicates competitive or better performance (in terms of accuracy and speed) depending on the method.</p></body></sub-article><sub-article article-type="author-comment" id="sa2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.95494.3.sa2</article-id><title-group><article-title>Author response</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Sun</surname><given-names>Jing</given-names></name><role specific-use="author">Author</role><aff><institution>King&amp;apos;s College London</institution><addr-line><named-content content-type="city">London</named-content></addr-line><country>United Kingdom</country></aff></contrib><contrib contrib-type="author"><name><surname>Choy</surname><given-names>Desmond</given-names></name><role specific-use="author">Author</role><aff><institution>King&amp;apos;s College London</institution><addr-line><named-content content-type="city">London</named-content></addr-line><country>United Kingdom</country></aff></contrib><contrib contrib-type="author"><name><surname>Sompairac</surname><given-names>Nicolas</given-names></name><role specific-use="author">Author</role><aff><institution>King&amp;apos;s College London</institution><addr-line><named-content content-type="city">London</named-content></addr-line><country>United Kingdom</country></aff></contrib><contrib contrib-type="author"><name><surname>Jamshidi</surname><given-names>Shirin</given-names></name><role specific-use="author">Author</role><aff><institution>Kings College London</institution><addr-line><named-content content-type="city">London</named-content></addr-line><country>United Kingdom</country></aff></contrib><contrib contrib-type="author"><name><surname>Mishto</surname><given-names>Michele</given-names></name><role specific-use="author">Author</role><aff><institution>King&amp;apos;s College London</institution><addr-line><named-content content-type="city">London</named-content></addr-line><country>United Kingdom</country></aff></contrib><contrib contrib-type="author"><name><surname>Kordasti</surname><given-names>Shahram</given-names></name><role specific-use="author">Author</role><aff><institution>King&amp;apos;s College London</institution><addr-line><named-content content-type="city">London</named-content></addr-line><country>United Kingdom</country></aff></contrib></contrib-group></front-stub><body><p>The following is the authors’ response to the original reviews.</p><disp-quote content-type="editor-comment"><p><bold>Public Reviews:</bold></p><p><bold>Reviewer #1 (Public Review):</bold></p><p>Summary:</p><p>This manuscript presented a useful toolkit designed for CyTOF data analysis, which integrates 5 key steps as an analytical framework. A semi-supervised clustering tool was developed, and its performance was tested in multiple independent datasets. The tool was compared to human experts as well as supervised and unsupervised methods.</p><p>Strengths:</p><p>The study employed multiple independent datasets to test the pipeline. A new semi-supervised clustering method was developed.</p><p>Weaknesses:</p><p>The examination of the whole pipeline is incomplete. Lack of descriptions or justifications for some analyses.</p></disp-quote><p>We thank the reviewer’s overall summary and comments of this manuscript. In the last part of the results, we showcased the functionalities of ImmCellTyper in covid dataset, including quality check, BinaryClust clustering, cell abundance quantification, state marker expression comparison within each identified cell types, cell population extraction, subpopulation discovery using unsupervised methods, and data visualization etc. We added more descriptions in the text based on the reviewer’s suggestions.</p><disp-quote content-type="editor-comment"><p><bold>Reviewer #2 (Public Review):</bold></p><p>Summary:</p><p>The authors have developed marker selection and k-means (k=2) based binary clustering algorithm for the first-level supervised clustering of the CyTOF dataset. They built a seamless pipeline that offers the multiple functionalities required for CyTOF data analysis.</p><p>Strengths:</p><p>The strength of the study is the potential use of the pipeline for the CyTOF community as a wrapper for multiple functions required for the analysis. The concept of the first line of binary clustering with known markers can be practically powerful.</p><p>Weaknesses:</p><p>The weakness of the study is that there's little conceptual novelty in the algorithms suggested from the study and the benchmarking is done in limited conditions.</p></disp-quote><p>We thank the reviewer’s overall summary and comments of this manuscript. While the concept of binary clustering by k-means is not novel, BinaryClust only uses it for individual markers to identify positive and negative cells, then combine it with the pre-defined matrix for cell type identification. This has not been introduced elsewhere. Furthermore, ImmCellTyper streamlines the entire analysis process and enhances data exploration on multiple levels. For instance, users can evaluate functional marker expression level/cellular abundance across both main cell types and subpopulations; Also, this computational framework leverages the advantages of both semi-supervised and unsupervised clustering methods to facilitate subpopulation discovery. We believe these contributions warrant consideration as advancements in the field.</p><p>As for the benchmarking, we limited the depth only to main cell types rather than subpopulations. The reason is because we only apply BinaryClust to identify main cell types; For the cell subsets discovery, unsupervised methods integrated in this pipeline has already been published and widely used by the research community. Therefore, it does not seem to be necessary for additional benchmarking.</p><disp-quote content-type="editor-comment"><p><bold>Reviewer #3 (Public Review):</bold></p><p>Summary:</p><p>ImmCellTyper is a new toolkit for Cytometry by time-of-flight data analysis. It includes BinaryClust, a semi-supervised clustering tool (which takes into account prior biological knowledge), designed for automated classification and annotation of specific cell types and subpopulations. ImmCellTyper also integrates a variety of tools to perform data quality analysis, batch effect correction, dimension reduction, unsupervised clustering, and differential analysis.</p><p>Strengths:</p><p>The proposed algorithm takes into account the prior knowledge.</p><p>The results on different benchmarks indicate competitive or better performance (in terms of accuracy and speed) depending on the method.</p><p>Weaknesses:</p><p>The proposed algorithm considers only CyTOF markers with binary distribution.</p></disp-quote><p>We thank the reviewer’s overall summary and comments of this manuscript. Binary classification can be considered as an imitation of human gating strategy, as it is applied to each marker. For example, when characterizing the CD8 T cells, we aim for CD19-CD14-CD3+CD4- population, which is binary in nature (either positive and negative) and follows the same logic as the method (BinaryClust) we developed. Results indicated that it works very well for well-defined main cell lineages, particularly when the expression of the defining marker is not continuous. However, the limitation is for subpopulation identification, because a handful makers behave in a continuum manner, so we suggest unsupervised method after BinaryClust, which also brings another advantage of identifying unknown subsets beyond our current knowledge, and none of the semi-supervised tools can achieve that. To address the reviewer’s concern, we considered the limitation of binary distribution, but it does not profoundly affect the application of the pipeline.</p><disp-quote content-type="editor-comment"><p><bold>Recommendations for the authors:</bold></p><p><bold>Reviewer #1 (Recommendations For The Authors):</bold></p></disp-quote><p>Many thanks for the reviewers’ comments and suggestions, please see below the point-to-point response:</p><disp-quote content-type="editor-comment"><p>(1) The style of in-text reference citation is not consistent. Many do not have published years.</p></disp-quote><p>The style of the reference citation has been revised and improved.</p><disp-quote content-type="editor-comment"><p>(2) The font size in the table of Figure 1 is too small, so is Figure 2.</p></disp-quote><p>The font size has been increased.</p><disp-quote content-type="editor-comment"><p>(3) Is flowSOM used as part of BinaryClust? How should the variable running speed of BinaryClust be interpreted, given that it is occasionally slower and sometimes faster than flowSOM in the datasets?</p></disp-quote><p>To answer reviewer’s question, flowSOM is not a part of BinaryClust. They are separate clustering methods that have been incorporated into the ImmCellTyper pipeline. As described in Figure 1, BinaryClust, a semi-supervised method, is used to classify the main cell lineages; while flowSOM, an unsupervised method, is recommended here for further subpopulation discovery. So, they operate independently of each other. To avoid confusions, we slightly modified Figure 1 for clarification.</p><p>Regarding the variability in running speed in Figure 4. The performance of algorithms can indeed be influenced by the characteristics of the datasets, such as size and complexity. The differences observed between the covid dataset and the MPN dataset, such as marker panel, experimental protocol, and data acquisition process etc., could account for this variation. Our explanation is that flowSOM suits better the data structure of covid dataset, which might be the reason why it is slightly faster to analyse compared to the MPN dataset. Moreover, for the covid dataset, the runtime for both BinaryClust and flowSOM is less than 100s, and the difference is not notable.</p><disp-quote content-type="editor-comment"><p>(4) In the Method section ImmCellTyper workflow overview, it is difficult to link the description of the pipeline to Figure 8. There are two sub-pipelines in the text and seven steps in the figure. What are their relations? Some steps are not introduced in the text, such as Data transformation and SCE object construction. What is co-factor 5?</p></disp-quote><p>Figure 8 provides an overview of the entire workflow for CyTOF data analysis, starting from the raw fcs file data and proceeding until downstream analysis (seven steps). But the actual implementation of the pipeline was divided into two separate sections, as outlined in the vignettes of the ImmCellTyper GitHub page (<ext-link ext-link-type="uri" xlink:href="https://github.com/JingAnyaSun/ImmCellTyper/tree/main/vignettes">https://github.com/JingAnyaSun/ImmCellTyper/tree/main/vignettes</ext-link>).</p><p>Users will initially run ‘Intro_to_batch_exam_correct’ to perform data quality check and identify potential batch effects, followed by ‘Intro_to_data_analysis’ for data exploration. We agree with the reviewer that the method for this section is a bit confusing, so we’ve added more description for clarification.</p><p>In processing mass cytometry data, arcsine transformation is commonly applied to handle zero values, skewed distributions, and to improve visualization as well as clustering performance. The co-factor here is used as a parameter to scale down the data to control the width of the linear region before arcsine transformation. We usually get the best results by using co-factor 5 for CyTOF data.</p><disp-quote content-type="editor-comment"><p>(5) For differential analysis, could the pipeline analyze paired/repeated samples?</p></disp-quote><p>For the statistical step, ImmCellTyper supports both two-study group comparison using Mann-Whitney Wilcoxon test, and multiple study group comparison (n&gt;2) using Kruskal Wallis test followed by post hoc analysis (pairwise Wilcoxon test or Dunn’s test) with multiple testing correction using Benjamini-Hochberg Procedure.</p><p>Certainly, this pipeline allows flexibilities, users can also extract the raw data of cell frequencies and apply suitable statistical methods for testing.</p><disp-quote content-type="editor-comment"><p>(6) In Figure 2A, the range of the two axes is different for Dendritic cells, which could be misleading. Why the agreement is bad for dendritic cells?</p></disp-quote><p>The range for the axes is automatically adapted to the data structure, which explains why they may not necessarily be equal. The co-efficient factor for the correlation of DCs is 0.958, compared to other cell types (&gt; 0.99), it is relatively worse but does not indicate poor agreement.</p><p>Moreover, the abundance of DCs is much less than other cell types, comprising approximately 2-5% of whole cells. As a result, even small differences in abundance may appear to as significant variations. For example, a difference of 1% in DC abundance represents a 2-fold change, which can be perceived as substantial.</p><p>Overall, while the agreement for DCs may appear comparatively lower, it is not necessarily indicative of poor performance, considering both the coefficient factor and the relative abundance of DCs compared to other cell types.</p><disp-quote content-type="editor-comment"><p>(7) In the Results section BinaryClust achieves high accuracy, what method was used to get the p-value, such as lines 212, 213, etc.?</p></disp-quote><p>The accuracy of BinaryClust was tested using F-measure and ARI against ground truth (manual gating), the detailed description/calculation can be found in methods. For line 212 and 213, the p-value was calculated using ANOVA for the interaction plot shown in Figure 3. We’ve now added the statistical information into the figure legend.</p><disp-quote content-type="editor-comment"><p>(8) The performance comparison between BinaryClust and LDA is close. The current comparison design looks unfair. Given LDA only trained using half data, LDA may outperform BinaryClust.</p></disp-quote><p>It is true that LDA was trained using half data, which is because this method requires manual gating results as training dataset to build a model, then apply the model to the rest of the files to label cell types. Here we used 50% of the whole dataset as training set. We are of course very happy to implement any additional suggestions for a better partition ratio.</p><disp-quote content-type="editor-comment"><p>(9) There are 5 key steps in the proposed workflow. However, not every step was presented in the Results.</p></disp-quote><p>Thanks for the comments. The results primarily focused on demonstrating the precision and performance of BinaryClust in comparison with ground truth and existing tools. Additionally, a case study showcasing the application/functions of the entire pipeline in a dataset was also presented. Due to limitation in space, the implementation details of the pipeline were described in the method section and github documentations, which users/readers can easily access.</p><disp-quote content-type="editor-comment"><p><bold>Reviewer #2 (Recommendations For The Authors):</bold></p><p>The tools suggested by the authors could be potentially useful to the community. However, it's difficult to understand the conceptual novelty of the algorithms suggested here. The concept of binary clustering has been described before (<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1186/s12859-022-05085-z">https://doi.org/10.1186/s12859-022-05085-z</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1152/ajplung.00104.2022">https://doi.org/10.1152/ajplung.00104.2022</ext-link>), and it mainly utilizes k-means clustering set to generate binary clusters based on selected markers. Other algorithms associated with the package are taken from other studies.</p></disp-quote><p>We acknowledge the reviewer’s comment regarding the novelty of our method. While the concept of binary clustering by k-means has been previously described to transcriptome data, our approach applies it to CyTOF data analysis, which has not been introduced elsewhere. Furthermore, ImmCellTyper streamlines the entire analysis process and enhances data exploration on multiple levels. For instance, users can evaluate functional marker expression level/cellular abundance across both main cell types and subpopulations; Also, as stated in the manuscript, this computational framework leverages the advantages of both semi-supervised and unsupervised clustering methods to facilitate subpopulation discovery. We believe these contributions warrant consideration as advancements in the field.</p><disp-quote content-type="editor-comment"><p>In addition, the benchmarking of clustering performance, especially to reproduce manual gating and comparison to tools such as flowSOM is not comprehensive enough. The result for the benchmarking test could significantly vary depending on how the authors set the ground truth (resolution of cell type annotations). The authors should compare the tool's performance by changing the depth of cell type annotations. Especially, the low abundance cell types such as gdT cells or DCs were not effectively captured by the suggested methods.</p></disp-quote><p>Thanks for the comment. We appreciate the reviewer’s concern. However, as illustrated in figure 1, our approach uses BinaryClust, a semi-supervised method, to identify main cell types rather than directly targeting subpopulations. The reason is because semi-supervised method relies on users’ prior definition thus is limited to discover novel subsets. In the ImmCellTyper framework, unsupervised method was subsequently applied for subset exploration following the BinaryClust step.</p><p>Regarding benchmarking, we focused on testing the precision of BinaryClust for main cell type characterization, because it is what the method is used for in the pipeline, and we believe this is sufficient. As for the cell subsets discovery, the unsupervised methods we integrated has already been published and widely used by the research community. Therefore, it does not seem to be necessary for additional benchmarking.</p><p>Moreover, as shown in Figure 3 and Table 1, our results indicated that the F-measure for DCs and gdT cells in BinaryClust is 0.80 and 0.92 respectively, which were very close to ground truth and outperformed flowSOM, demonstrating its effectiveness.</p><p>We hope these clarifications address the reviewer’s concern.</p><disp-quote content-type="editor-comment"><p>Minor comments:</p><p>(1) In Figure 4, it's perplexing to note that BinaryClust shows the slowest runtime for the COVID dataset, compared to the MPN dataset, which features a similar number of cells. What causes this variation? Is it dependent on the number of markers utilized for the clustering? This should be clarified/tested.</p></disp-quote><p>Thanks for the comment, but we are not sure that we fully understand the question. As shown in figure 4 that BinaryClust has slightly higher runtime in MPN dataset than covid dataset, which is reasonable because and the cell number in MPN dataset is around 1.6 million more than covid dataset.</p><disp-quote content-type="editor-comment"><p>(2) Some typos are noted:</p><p>- DeepCyTOF and LDA use a maker expression matrix extracted → &quot;marker&quot;?*</p></disp-quote><p>Corrected.</p><disp-quote content-type="editor-comment"><p>- Datasets(Chevrier et al.)which → spacing*</p></disp-quote><p>Corrected.</p><disp-quote content-type="editor-comment"><p>- This is due to the method's reliance → spacing*</p></disp-quote><p>Corrected.</p><disp-quote content-type="editor-comment"><p><bold>Reviewer #3 (Recommendations For The Authors):</bold></p><p>Is it possible to accommodate more than two levels within the clustering process, i.e., can the proposed semi-supervised clustering tool be extended to multi-levels instead of binary?</p></disp-quote><p>Thanks for the comments. Binary classification can be considered as an imitation of human gating strategy, as it is applied to each marker. For example, when characterizing the CD8 T cells, we aim for CD19-CD14-CD3+CD4- population, which is binary in nature (either positive and negative) and follows the same logic as the method (BinaryClust) we developed. Results indicated that it works very well for well-defined main cell lineages. However, the limitation is for subpopulation identification, because a handful of makers behave in a continuum manner, so we would suggest unsupervised method after BinaryClust, which also brings another advantage of identifying unknown subsets beyond our current knowledge, and none of the semi-supervised tools can achieve that. To answer the reviewer’s question, it is possible to set the number to 3,4,5 rather than just 2, but considering the design and rationale of the entire framework (as describe in the manuscript and above), it doesn’t seem to be necessary.</p><disp-quote content-type="editor-comment"><p>Could you please comment on why on the COVID dataset, BinaryClust was slower as compared to flowSOM?</p></disp-quote><p>Thanks for the question. The performance of algorithms can indeed be affected by the characteristics of the datasets, such as their size and complexity. The covid and MPN datasets differ in various aspects including marker panel, experimental protocol, and data acquisition process, among others, which wound account for the observed variation in speed. So, our explanation is flowSOM suits better for the structure of covid dataset than MPN dataset. Additionally, for covid dataset, both BinaryClust and flowSOM have runtimes of less than 100s, and the difference between the two isn’t particularly dramatic.</p><disp-quote content-type="editor-comment"><p>Minor errors:</p><p>Line#215 &quot;(ref) &quot; reference is missing</p></disp-quote><p>Added.</p><disp-quote content-type="editor-comment"><p>Figure 3, increase the font of the text in order to improve readability.</p></disp-quote><p>Increased.</p><disp-quote content-type="editor-comment"><p>Line#229 didn't --&gt; did not.</p></disp-quote><p>Corrected</p><disp-quote content-type="editor-comment"><p>Line#293 repetition of the reference.</p></disp-quote><p>The repetition is due to the format of the citation, which has been revised.</p></body></sub-article></article>