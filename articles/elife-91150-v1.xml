<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD with MathML3 v1.3 20210610//EN"  "JATS-archivearticle1-3-mathml3.dtd"><article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.3"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn publication-format="electronic" pub-type="epub">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">91150</article-id><article-id pub-id-type="doi">10.7554/eLife.91150</article-id><article-id pub-id-type="doi" specific-use="version">10.7554/eLife.91150.4</article-id><article-version article-version-type="publication-state">version of record</article-version><article-categories><subj-group subj-group-type="display-channel"><subject>Tools and Resources</subject></subj-group><subj-group subj-group-type="heading"><subject>Cell Biology</subject></subj-group><subj-group subj-group-type="heading"><subject>Immunology and Inflammation</subject></subj-group></article-categories><title-group><article-title>UFMTrack, an Under-Flow Migration Tracker enabling analysis of the entire multi-step immune cell extravasation cascade across the blood-brain barrier in microfluidic devices</article-title></title-group><contrib-group><contrib contrib-type="author" corresp="yes"><name><surname>Vladymyrov</surname><given-names>Mykhailo</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-5720-9740</contrib-id><email>mykhailo.vladymyrov@unibe.ch</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author"><name><surname>Marchetti</surname><given-names>Luca</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author"><name><surname>Aydin</surname><given-names>Sidar</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0001-7791-7931</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="con3"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author"><name><surname>Soldati</surname><given-names>Sasha GN</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="con4"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author"><name><surname>Mossu</surname><given-names>Adrien</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="con5"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author"><name><surname>Pal</surname><given-names>Arindam</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-3784-7868</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="con6"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author"><name><surname>Gueissaz</surname><given-names>Laurent</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0009-0008-8695-7992</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="con7"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author"><name><surname>Ariga</surname><given-names>Akitaka</given-names></name><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="fn" rid="con8"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author"><name><surname>Engelhardt</surname><given-names>Britta</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-3059-9846</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="con9"/><xref ref-type="fn" rid="conf1"/></contrib><aff id="aff1"><label>1</label><institution>Theodor Kocher Institute</institution><addr-line><named-content content-type="city">Bern</named-content></addr-line><country>Switzerland</country></aff><aff id="aff2"><label>2</label><institution>Data Science Lab</institution><addr-line><named-content content-type="city">Bern</named-content></addr-line><country>Switzerland</country></aff><aff id="aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/02k7v4d05</institution-id><institution>Laboratory for High Energy Physics, University of Bern</institution></institution-wrap><addr-line><named-content content-type="city">Bern</named-content></addr-line><country>Switzerland</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Dalal</surname><given-names>Yamini</given-names></name><role>Reviewing Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/040gcmg81</institution-id><institution>National Cancer Institute</institution></institution-wrap><country>United States</country></aff></contrib><contrib contrib-type="senior_editor"><name><surname>Dalal</surname><given-names>Yamini</given-names></name><role>Senior Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/040gcmg81</institution-id><institution>National Cancer Institute</institution></institution-wrap><country>United States</country></aff></contrib></contrib-group><pub-date publication-format="electronic" date-type="publication"><day>15</day><month>04</month><year>2025</year></pub-date><volume>13</volume><elocation-id>RP91150</elocation-id><history><date date-type="sent-for-review" iso-8601-date="2023-08-31"><day>31</day><month>08</month><year>2023</year></date></history><pub-history><event><event-desc>This manuscript was published as a preprint.</event-desc><date date-type="preprint" iso-8601-date="2023-09-04"><day>04</day><month>09</month><year>2023</year></date><self-uri content-type="preprint" xlink:href="https://doi.org/10.1101/2023.01.04.522827"/></event><event><event-desc>This manuscript was published as a reviewed preprint.</event-desc><date date-type="reviewed-preprint" iso-8601-date="2024-05-21"><day>21</day><month>05</month><year>2024</year></date><self-uri content-type="reviewed-preprint" xlink:href="https://doi.org/10.7554/eLife.91150.1"/></event><event><event-desc>The reviewed preprint was revised.</event-desc><date date-type="reviewed-preprint" iso-8601-date="2024-10-07"><day>07</day><month>10</month><year>2024</year></date><self-uri content-type="reviewed-preprint" xlink:href="https://doi.org/10.7554/eLife.91150.2"/></event><event><event-desc>The reviewed preprint was revised.</event-desc><date date-type="reviewed-preprint" iso-8601-date="2024-12-27"><day>27</day><month>12</month><year>2024</year></date><self-uri content-type="reviewed-preprint" xlink:href="https://doi.org/10.7554/eLife.91150.3"/></event></pub-history><permissions><copyright-statement>© 2024, Vladymyrov et al</copyright-statement><copyright-year>2024</copyright-year><copyright-holder>Vladymyrov et al</copyright-holder><ali:free_to_read/><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><ali:license_ref>http://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-91150-v1.pdf"/><self-uri content-type="figures-pdf" xlink:href="elife-91150-figures-v1.pdf"/><abstract><p>The endothelial blood-brain barrier (BBB) strictly controls immune cell trafficking into the central nervous system (CNS). In neuroinflammatory diseases such as multiple sclerosis, this tight control is, however, disturbed, leading to immune cell infiltration into the CNS. The development of in vitro models of the BBB combined with microfluidic devices has advanced our understanding of the cellular and molecular mechanisms mediating the multistep T-cell extravasation across the BBB. A major bottleneck of these in vitro studies is the absence of a robust and automated pipeline suitable for analyzing and quantifying the sequential interaction steps of different immune cell subsets with the BBB under physiological flow in vitro. Here, we present the under-flow migration tracker (<sup>UFM</sup>Track) framework for studying immune cell interactions with endothelial monolayers under physiological flow. We then showcase a pipeline built based on it to study the entire multistep extravasation cascade of immune cells across brain microvascular endothelial cells under physiological flow in vitro. <sup>UFM</sup>Track achieves 90% track reconstruction efficiency and allows for scaling due to the reduction of the analysis cost and by eliminating experimenter bias. This allowed for an in-depth analysis of all behavioral regimes involved in the multistep immune cell extravasation cascade. The study summarizes how <sup>UFM</sup>Track can be employed to delineate the interactions of CD4<sup>+</sup> and CD8<sup>+</sup> T cells with the BBB under physiological flow. We also demonstrate its applicability to the other BBB models, showcasing broader applicability of the developed framework to a range of immune cell-endothelial monolayer interaction studies. The <sup>UFM</sup>Track framework along with the generated datasets is publicly available in the corresponding repositories.</p></abstract><kwd-group kwd-group-type="author-keywords"><kwd>leukocyte trafficking</kwd><kwd>blood-brain barrier</kwd><kwd>cell tracking under flow</kwd><kwd>automated analysis</kwd><kwd>machine learning</kwd><kwd>microfluidics</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research organism</title><kwd>Mouse</kwd><kwd>Human</kwd></kwd-group><funding-group><award-group id="fund1"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100009068</institution-id><institution>University of Bern</institution></institution-wrap></funding-source><award-id>UniBe ID Grant</award-id><principal-award-recipient><name><surname>Vladymyrov</surname><given-names>Mykhailo</given-names></name><name><surname>Ariga</surname><given-names>Akitaka</given-names></name><name><surname>Engelhardt</surname><given-names>Britta</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>The established under-flow migration tracker (<sup>UFM</sup>Track) framework allows for automated and scalable studies of immune cell interactions with and extravasation across endothelial monolayer under flow in vitro.</meta-value></custom-meta><custom-meta specific-use="meta-only"><meta-name>publishing-route</meta-name><meta-value>prc</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>Immune cells continuously travel throughout our body as a means of immune surveillance. Moving within the bloodstream allows for their fast transport to even distant sites but requires extravasation once they have reached their target organ. Immune cell extravasation across the vascular wall is a multistep process regulated by the sequential interaction of different signaling and adhesion molecules on the endothelium and the immune cells (<xref ref-type="bibr" rid="bib27">Nishihara et al., 2020</xref>; <xref ref-type="bibr" rid="bib25">Marchetti and Engelhardt, 2020</xref>). These molecular interactions mediate distinct sequential steps, namely tethering and rolling to reduce travel speed, shear-resistant arrest, polarization, and crawling of the immune cell on the luminal surface of the endothelium and, finally, immune cell diapedesis across the endothelial layer (<xref ref-type="bibr" rid="bib25">Marchetti and Engelhardt, 2020</xref>; <xref ref-type="bibr" rid="bib30">Nourshargh and Alon, 2014</xref>; <xref ref-type="bibr" rid="bib29">Nourshargh et al., 2010</xref>).</p><p>The precise molecular mechanisms mediating the multistep immune cell extravasation in each organ depend not only on the immune cell subset but also on the specific characteristics of the vascular bed. For example, in the central nervous system (CNS), the endothelial blood-brain barrier (BBB) establishes a tight barrier that strictly controls the transport of molecules across the BBB, ensuring tissue homeostasis required for neuronal function (<xref ref-type="bibr" rid="bib25">Marchetti and Engelhardt, 2020</xref>; <xref ref-type="bibr" rid="bib13">Engelhardt et al., 2017</xref>). The BBB similarly controls immune cell trafficking into the CNS. Thus, accounting for these special barrier properties, unique characteristics of the multistep T-cell migration across the BBB have been described. For instance, T cells crawl for very long distances against the direction of blood flow on the surface of the BBB endothelium in search of permissive locations for diapedesis (<xref ref-type="bibr" rid="bib7">Bartholomäus et al., 2009</xref>; <xref ref-type="bibr" rid="bib23">Lyck and Engelhardt, 2012</xref>; <xref ref-type="bibr" rid="bib10">Castro Dias et al., 2021</xref>). Research on T-cell interaction with the BBB has already been successfully translated into therapies in the clinic (<xref ref-type="bibr" rid="bib45">Steinman and Zamvil, 2005</xref>; <xref ref-type="bibr" rid="bib42">Singer, 2017</xref>).</p><p>Exploring the entire multistep extravasation of immune cells across the BBB has been significantly advanced by making use of in vitro BBB models maintaining their barrier properties and placing them into microfluidic devices (<xref ref-type="bibr" rid="bib24">Lyck et al., 2023</xref>). Combined with microscopic setups that allow for in vitro live-cell imaging (<xref ref-type="fig" rid="fig1">Figure 1A and B</xref>) of the immune cell interaction with the brain endothelial monolayer under physiological flow over time, the molecular mechanisms mediating the sequential interaction of T cells during extravasation across the BBB have been delineated (<xref ref-type="bibr" rid="bib25">Marchetti and Engelhardt, 2020</xref>). The live-cell imaging is largely performed in the phase-contrast imaging modality (<xref ref-type="fig" rid="fig1">Figure 1C</xref>), which does not require establishing fluorescent labels of the imaged cells and avoids potential phototoxicity of the fluorescent imaging modality. These studies have shown that upon their arrest, T cells polarize and either crawl at speeds between 3 and 10 µm/min over the brain endothelial monolayer or probe the endothelial monolayer by remaining rather stationary and sending cellular protrusions into the endothelial monolayer (<xref ref-type="fig" rid="fig1">Figure 1D</xref>; <xref ref-type="bibr" rid="bib44">Steiner et al., 2010</xref>; <xref ref-type="bibr" rid="bib35">Rudolph et al., 2016</xref>). Both behaviors can lead to diapedesis of the T cells across the brain endothelial monolayers. This process lasts at least 3–5 min, with some immune cells observed to protrude and retract several times prior to finalizing a prolonged diapedesis process to the abluminal side of the brain endothelial monolayer (<xref ref-type="bibr" rid="bib10">Castro Dias et al., 2021</xref>; <xref ref-type="bibr" rid="bib2">Abadier et al., 2015</xref>). Finally, T cells that have successfully migrated across the brain endothelial monolayer usually continue to migrate underneath the endothelial monolayer (<xref ref-type="bibr" rid="bib41">Shulman et al., 2009</xref>; <xref ref-type="bibr" rid="bib5">Arts et al., 2021</xref>).</p><fig id="fig1" position="float"><label>Figure 1.</label><caption><title>In vitro analysis of the multistep cascade of T-cell migration across the blood-brain barrier (BBB) model under physiological flow.</title><p>(<bold>A</bold>) In vitro under-flow assay setup. T cells were perfused on top of the primary mouse brain microvascular endothelial cell (pMBMEC) monolayer, and their migration under flow was observed using phase-contrast imaging modality. Imaging was performed with a time step of 10 s/time frame. (<bold>B</bold>) In vitro flow assay timeline. During the accumulation phase under flow with the shear stress of 0.1 dynes/cm<sup>2</sup>, T cells adhered to the pMBMEC monolayer. After 5 min (time frame 30), the shear stress was increased to 1.5 dynes/cm<sup>2</sup>, leading to rapid detachment of not firmly adhering T cells. Analysis of the post-arrest T-cell behavior was thus starting at 5.5 min (time frame 33). tf = time frame. (<bold>C</bold>) Example of phase-contrast imaging data. Red arrow – crawling T cell; yellow arrow – fully transmigrated T cell; yellow arrowhead – transmigrated part of a partially transmigrated T cell; red V arrowheads – pMBMECs. Scale bar is 20 µm. (<bold>D</bold>) Schematic representation of distinct T-cell behavior regimes detected and analyzed using the developed under-flow migration tracker (<sup>UFM</sup>Track) framework. Crawling cells migrate continuously while probing cells interact with the pMBMECs and move around the interaction point within two cell size (20 µm) as indicated by the arrows. Side and top views are shown.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-91150-fig1-v1.tif"/></fig><p>The data analysis of these ‘in vitro flow assays’ requires time-consuming offline frame-by-frame analysis of the imaging data by individual experimenters, in which the dynamic interactions of each individual immune cell has to be followed over the entire time of the assay manually and assigned to specific categories. Such analysis is tedious, and accurately assigning the different T-cell behaviors requires experience. Thus, this manual analysis is prone to inevitable errors and subjective judgments of the various experiments. Furthermore, the time-consuming manual T-cell tracking limits the number of events that can be studied and, thus, the statistical power of the analysis.</p><p>Automation of the analysis of the recorded multistep T-cell extravasation across the BBB in the microfluidic device would thus be highly desirable. It is, however, hampered as these assays are usually performed with unlabeled cells and imaged by phase contrast (<xref ref-type="fig" rid="fig1">Figure 1C</xref>), which poses a challenge due to the similar grayscales and morphology of the immune cells interacting with the brain endothelial cells. Further challenges include rapid cell movement under flow. When perfused on top of the endothelial cells in the presence of shear flow, at first T cells instantly appear within the field of view (FoV). Later on they are often either suddenly displaced over a certain distance or completely detached and washed away (<xref ref-type="fig" rid="fig1">Figure 1D</xref>). Proper analysis of these events is mandatory for reliable T-cell tracking but also with respect to the study of the overall avidity of the dynamic T-cell interaction steps with the underlying brain endothelium. Thus, it was compulsory to establish a tracking solution that accounts for the effect of the flow on the migrating cells and the distinct migration regimes.</p><p>Segmenting of cells imaged in phase contrast migrating on top of cellular monolayer of similar appearance is a challenging task. Furthermore, the analysis of T-cell interactions requires detection and quantification of the transmigration. While recent advances in computer vision established several frameworks for detection (<xref ref-type="bibr" rid="bib18">He et al., 2017</xref>; <xref ref-type="bibr" rid="bib52">Wang et al., 2022</xref>; <xref ref-type="bibr" rid="bib8">Carion et al., 2020</xref>; <xref ref-type="bibr" rid="bib40">Schmidt et al., 2018</xref>) or segmentation (<xref ref-type="bibr" rid="bib34">Ronneberger et al., 2015</xref>; <xref ref-type="bibr" rid="bib46">Stringer et al., 2021</xref>), no tool is readily available to complete both tasks simultaneously.</p><p>There is a large number of powerful cell tracking solutions developed that focus on different aspects of cell migration and are embedded in different frameworks or solutions. The general-purpose Trackpy (<xref ref-type="bibr" rid="bib3">Allan et al., 2021</xref>) allows for simple particle tracking and is not suitable to track cells migrating under flow. It is used for the tracking of cells imaged in phase contrast in the Usiigaci framework (<xref ref-type="bibr" rid="bib47">Tsai et al., 2019</xref>). The widely used TrackMate (<xref ref-type="bibr" rid="bib15">Ershov et al., 2022</xref>) plugin for ImageJ (<xref ref-type="bibr" rid="bib36">Rueden et al., 2017</xref>) allows for tracking of particles performing either the Brownian motion or a linear motion, but not the combination of two. Instant appearance or disappearance as well as the resolving tracks of under-segmented cells cannot be easily established in this framework. Similarly, CellTraxx (<xref ref-type="bibr" rid="bib19">Holme et al., 2023</xref>) performs matching of cells in the adjacent frames, prohibiting its use for tracking of under-segmented, intersecting cells or under flow. The Bayesian Tracker (btrack) framework (<xref ref-type="bibr" rid="bib48">Ulicna et al., 2021</xref>) is using spatial information as well as appearance information for track linking focusing on the cell divisions required for cell lineage tracing.</p><p>Here, we introduce the developed under-flow migration tracker (<sup>UFM</sup>Track) framework that systematically addresses the hurdles mentioned above, allowing it to perform automated tracking and analysis of cell-cell interactions imaged in phase contrast. We also show a successful implementation of <sup>UFM</sup>Track to build an analysis pipeline for T-cell interactions with brain microvascular endothelial cells in vitro under physiological flow. <sup>UFM</sup>Track reaches 90% T-cell tracking efficiency, performing comparably to manual analysis while eliminating the experimenter’s bias and improving the accuracy of T-cell tracking. Therefore, it enables significant savings in the labor force and time for data analysis.</p></sec><sec id="s2" sec-type="results"><title>Results</title><p>To design and develop the automated T-cell under-flow migration analysis framework (<sup>UFM</sup>Track framework) presented here, we made use of in vitro imaging datasets following T-cell migration across primary mouse brain microvascular endothelial cells (pMBMECs) under physiological flow in vitro. The framework combines three components: T-cell segmentation and transmigration detection, T-cell tracking under flow, and analysis of each of the multistep T-cell migration cascade steps. Segmentation and transmigration detection of the T cells, migrating on the pMBMECs, is performed with a 2D+T U-Net-like convolutional neural network (<xref ref-type="bibr" rid="bib34">Ronneberger et al., 2015</xref>). The T-cell under-flow tracking algorithm was formulated as a constrained optimization problem.</p><p>Next, we describe the methods and algorithms employed to develop <sup>UFM</sup>Track. Links to the code and the datasets used for model training can be found in the Data availability section.</p><sec id="s2-1"><title>T-cell segmentation</title><p>Reliable cell segmentation is crucial for reliable cell tracking. In the phase-contrast imaging modality, it was impossible to achieve reliable differentiation between T cells and endothelial cells of the pMBMEC monolayer based on pixel intensity. For detection of T-cell transmigration across pMBMEC monolayers (diapedesis), sufficiently reliable cell segmentation of the transmigrated T cells was also required. To achieve this, we have designed 2D and 2D+T U-Net-like (<xref ref-type="bibr" rid="bib34">Ronneberger et al., 2015</xref>) fully convolutional neural network-based models for multitask learning. The models were trained to predict three maps: cell probability, the probability that the T cell is below the pMBMEC monolayer, and cell centroids. The models performed predictions based on the grayscale of the respective phase-contrast images in the case of the 2D model or sequences of 5 time frames in the case of the 2D+T model. The models were implemented in TensorFlow (<xref ref-type="bibr" rid="bib1">Abadi et al., 2016</xref>). The training was performed on a dataset corresponding to 154 Megapixels of raw image data using the annotation mask for T cells (‘T-cell mask’) and the mask of the transmigrated part of the T cells (‘transmigration mask’), the centroids map, and the weight map (<xref ref-type="fig" rid="fig2">Figure 2</xref>). For validation, 37 Megapixels of raw imaging data were used. The models have approximately 3 and 8 M parameters correspondingly, and the model architectures are summarized in <xref ref-type="table" rid="app1table1">Appendix 1—table 1</xref> and <xref ref-type="table" rid="app1table2">Appendix 1—table 2</xref>. Details on models’ implementation, training, and image processing can be found in the ‘Segmentation models’ section in Appendix 1.</p><fig id="fig2" position="float"><label>Figure 2.</label><caption><title>Example of data used for training of the T-cell segmentation model.</title><p>From left to right: Phase-contrast microscopy image of T cells migrating on top of the primary mouse brain microvascular endothelial cell (pMBMEC) monolayer; annotated T-cell mask; annotated mask of transmigrated part of T cells; T-cell centroids; <inline-formula><mml:math id="inf1"><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> weight map. The bottom row shows zoom-in on the highlighted area. Scale bars are 50 µm in the top row and 20 µm in the bottom row.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-91150-fig2-v1.tif"/></fig><p>In the T-cell mask prediction task, the 2D+T model outperformed the 2D model by a notable 9% according to the average precision (AP) metric (<xref ref-type="table" rid="table1">Table 1</xref>). At the same time, for the transmigration mask, which is much more difficult to infer, the 2D model performance reached only 54%, which is insufficient for reliable detection of T cells migrating across the pMBMEC monolayer. In this task, the 2D+T model outperformed the 2D model by 32% AP. We observed that the 2D+T model was sensitive to frame misalignment, leading to false positive detection of transmigrated T cells. Thus, to generate the preliminary T-cell masks used for frame alignment and histogram normalization, we employed the 2D model. Afterward, for the T-cell segmentation and transmigration detection, we employed the 2D+T model, followed by a watershed algorithm based on the inferred T-cell mask and the cell centroids as seed points. A stitched phase-contrast image sequence can be seen in <xref ref-type="video" rid="video1">Video 1</xref> and overlayed with the segmented cells and highlighted transmigration mask in <xref ref-type="video" rid="video2">Video 2</xref>.</p><table-wrap id="table1" position="float"><label>Table 1.</label><caption><title>Comparison of the performance of the 2D and 2D+T models for T-cell segmentation.</title></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" valign="bottom"/><th align="center" valign="bottom" colspan="2">Performance, AP</th></tr></thead><tbody><tr><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">2D</td><td align="char" char="." valign="bottom">2D+T</td></tr><tr><td align="left" valign="bottom">T-cell mask</td><td align="char" char="." valign="bottom">86.12%</td><td align="char" char="." valign="bottom">95.26%</td></tr><tr><td align="left" valign="bottom">Transmigration mask</td><td align="char" char="." valign="bottom">50.56%</td><td align="char" char="." valign="bottom">82.74%</td></tr></tbody></table></table-wrap><media mimetype="video" mime-subtype="mp4" xlink:href="elife-91150-video1.mp4" id="video1"><label>Video 1.</label><caption><title>Phase-contrast time-lapse image sequence of CD4 T cells interacting with IL-1β-stimulated endothelium.</title><p>Eight tiles of the imaging are aligned and stitched together.</p></caption></media><media mimetype="video" mime-subtype="mp4" xlink:href="elife-91150-video2.mp4" id="video2"><label>Video 2.</label><caption><title>Segmented T cells in the phase-contrast time-lapse image sequence of CD4 T cells interacting with IL-1β-stimulated endothelium.</title><p>The mask of the segmented T cell is overlayed in red. The transmigration probability map is overlayed in yellow.</p></caption></media><p>After segmentation, we suppressed the noise by discarding small objects with an area below 30 pixels (the mean area of a T cell is about 400 pixels). For each T cell, we evaluated its coordinates as geometric mean coordinates, the angle of the longer axis, and the elongation <inline-formula><mml:math id="inf2"><mml:mi>ϵ</mml:mi><mml:mo>=</mml:mo><mml:msqrt><mml:mfrac><mml:mrow><mml:mrow><mml:msub><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:msup><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>`</mml:mi></mml:mrow></mml:msubsup><mml:mo>−</mml:mo><mml:msubsup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>`</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:msup><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>`</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:mrow></mml:mfrac></mml:msqrt></mml:math></inline-formula> , where <inline-formula><mml:math id="inf3"><mml:msup><mml:mrow><mml:msubsup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>`</mml:mi></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>`</mml:mi></mml:mrow></mml:msup></mml:math></inline-formula> are projections of the <italic>i</italic>th T-cell mask pixel coordinates on the orthogonal long and short axes of the T cell, and <inline-formula><mml:math id="inf4"><mml:msubsup><mml:mrow><mml:msubsup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>`</mml:mi></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:mi>`</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> are the corresponding projections of the geometrical center of the T cell. The summation is performed over the area covered by the mask of the corresponding T cell. Additionally, we evaluated the mean T-cell probability <inline-formula><mml:math id="inf5"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mover><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo accent="false">¯</mml:mo></mml:mover></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>i</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mfrac><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, mean transmigration probability <inline-formula><mml:math id="inf6"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mover><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo accent="false">¯</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>i</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mfrac><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, and cell transmigration coefficient as <inline-formula><mml:math id="inf7"><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mi>i</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mrow><mml:msub><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mfrac><mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mo>⁡</mml:mo><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mrow></mml:math></inline-formula> , where <inline-formula><mml:math id="inf8"><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mi>i</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is number of cell pixels and <inline-formula><mml:math id="inf9"><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>, <inline-formula><mml:math id="inf10"><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> are the T-cell and transmigration probabilities for <italic>i</italic>th pixel in the predicted T-cell mask.</p></sec><sec id="s2-2"><title>T-cell tracking</title><p>The presence of flow causes several types of discontinuous events that were managed with a specialized tracking algorithm. These are: (1) the sudden appearance of T cells in the FoV, (2) the sudden detachment of a T cell followed by its disappearance from FoV, and (3) the displacement over significant distances (up to hundreds of micrometers) of T cells that do not adhere firmly to the pMBMECs. The primary inspiration for our approach was the conservation tracking algorithm (<xref ref-type="bibr" rid="bib39">Schiegg et al., 2013</xref>). We could consistently reconstruct the T-cell tracks by performing global optimization constrained to controlled probabilities of T-cell appearance, disappearance, and displacement due to the flow at every timepoint. The standard tracking algorithms like tracking by association is either unable to detect track links with high displacement and thus reconstructs several disconnected segments of a cell track, or leads to a high number of false track links. Our procedure favors the reconstruction of long T-cell tracks while at the same time allowing for tracking of the T cells which detach or are displaced by the flow (‘accelerated T-cell movement’) over a longer distance (8 µm) with speed significantly higher than their crawling speed.</p><p>The tracking consists of four main steps: linking, searching for track candidates, global track consistency resolving, and resolving the track intersections. The inputs for the tracking are the segmented cells and the cell centroids (<xref ref-type="fig" rid="fig3">Figure 3A</xref>). The centroids and the cell proximity are used to quantify under-segmentation by introducing the node multiplicity (<xref ref-type="fig" rid="fig3">Figure 3B</xref>, see section T-cell tracking in Appendix 1 for details). At the linking step, we identified all possible connections of T cells between the time frames (<xref ref-type="fig" rid="fig3">Figure 3C</xref>).</p><fig-group><fig id="fig3" position="float"><label>Figure 3.</label><caption><title>The T-cell tracking pipeline.</title><p>(<bold>A</bold>) Segmentation and centroids of two migrating T cells under flow over time. (<bold>B</bold>) Nodes corresponding to segmented T cells. Node sizes and colors denote the multiplicity estimate of a node. (<bold>C</bold>) Nodes, together with links between adjacent in space and time nodes, form a graph. (<bold>D</bold>) Selected links are obtained with global optimization on the graph. (<bold>E</bold>) Graph of segments and vertices obtained according to node multiplicity. (<bold>F</bold>) Resolving global segment multiplicity consistency with global optimization on the graph. Additionally, a search for rapid displacement of segmented T cells due to under-segmentation or flow is performed. (<bold>G</bold>) Extension of tracks of individual T cells into the track intersection. (<bold>H</bold>) Resolving track intersections.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-91150-fig3-v1.tif"/></fig><fig id="fig3s1" position="float" specific-use="child-fig"><label>Figure 3—figure supplement 1.</label><caption><title>Transmigration detection.</title><p>Based on the filtered transmigration factor <inline-formula><mml:math id="inf11"><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> we obtained Boolean masks for partial and full transmigration. Next, we obtained Boolean masks for T-cell migration before and during uncompleted, direct, full, and reverse transmigrations.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-91150-fig3-figsupp1-v1.tif"/></fig></fig-group><p>Next, during the search for track candidates, we aimed to find continuous track segments of T cells or under-segmented groups of T cells crawling on top of or below the pMBMEC monolayer without accelerated movement segments on the T-cell track characterized by rapid T-cell displacements. The whole dataset of T cells across all timepoints was represented as a graph. Each vertex corresponds to a T cell (multiplicity m=1) or a group of potentially under-segmented T cells (m&gt;1). The vertices are connected according to links obtained at the linking step. Track segments were found by performing global optimization to find consistent connectivity of vertices across the timepoints (<xref ref-type="fig" rid="fig3">Figure 3D</xref>) by employing an approach inspired by the conservation tracking algorithm summarized in <xref ref-type="bibr" rid="bib39">Schiegg et al., 2013</xref>. Optimization was performed using the CP-SAT constrained optimization procedure using the open-source OR-Tools library (<xref ref-type="bibr" rid="bib32">Perron and Furnon, 2021</xref>).</p><p>Next, resolving global track consistency was performed. In this step, the scope of T-cell tracking is shifted from individual nodes (representing T cells at particular time frames as well as groups of under-segmented T cells) to the track segments (unambiguous sequences of nodes) and vertices at the endpoints of the segments. These are track start and end points, points of merging and separation of track segments in case of under-segmentation, as well as ambiguous points on a track. The latter was identified by sudden T-cell displacement, a hallmark of detaching and reattaching T cells and T-cells transitioning from properly segmented to under-segmented T cells or vice versa (<xref ref-type="fig" rid="fig3">Figure 3E</xref>). This was followed by the search for potential missing track segments due to accelerated T-cell movement under flow and missing links in the track crossing points. Both are characterized by significant displacement lengths such that they were not detected during the linking step. Thus, we will refer to both as ‘jumps’ in this section. We have also eliminated short and therefore unreliable segments, as well as segments whose multiplicity was found to be <inline-formula><mml:math id="inf12"><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:math></inline-formula> (<xref ref-type="fig" rid="fig3">Figure 3F</xref>). Afterward, we separated the segments into two categories, namely segments with multiplicity <inline-formula><mml:math id="inf13"><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:math></inline-formula>, i.e., tracks of isolated T cells, and segments with multiplicity <inline-formula><mml:math id="inf14"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>M</mml:mi><mml:mo>&gt;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula>, i.e., tracks of under-segmented groups of T cells, where tracks of several T cells intersected. Finally, we extended the tracks of isolated T cells into the intersection if the branching vertex had a multiplicity of <inline-formula><mml:math id="inf15"><mml:mi>n</mml:mi></mml:math></inline-formula> and was splitting in exactly <inline-formula><mml:math id="inf16"><mml:mi>n</mml:mi></mml:math></inline-formula> segments with multiplicity <inline-formula><mml:math id="inf17"><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:math></inline-formula> (<xref ref-type="fig" rid="fig3">Figure 3G</xref>).</p><p>Lastly, we resolved the track intersections to obtain reliable T-cell tracks, i.e., identifying track segments corresponding to the same T cell before and after the under-segmented track region (<xref ref-type="fig" rid="fig3">Figure 3H</xref>).</p><p>Detailed information on the developed under-flow T-cell tracking algorithm is given in the T-cell tracking section in Appendix 1.</p></sec><sec id="s2-3"><title>T-cell migration analysis</title><p>Next, we performed the T-cell migration analysis based on the reconstructed T-cell tracks. We selected tracks inside the fiducial area of the FoV, namely coordinates of the T cell at all timepoints along the track were located at least 25 µm away from the bounding box enclosing all segmented T cells. Next, tracks of T cells touching another T cell at the end of the assay acquisition were excluded since T cells directly adjacent to each other can hide the start of T-cell transmigration across the pMBMEC monolayer and thus compromise correct detection and quantification of this step. Additionally, only tracks with T cells were assigned in at least 6 time frames during the physiological flow phase. We also require T cells to be assigned for at least 75% of time frames along the track. Under-segmented parts of T-cell tracks were not considered. Examples of selected tracks can be seen in <xref ref-type="video" rid="video3">Video 3</xref>.</p><media mimetype="video" mime-subtype="mp4" xlink:href="elife-91150-video3.mp4" id="video3"><label>Video 3.</label><caption><title>Tracks of T cells reconstructed in the phase-contrast time-lapse image sequence of CD4 T cells interacting with IL-1β-stimulated endothelium.</title><p>Tracks are shown after the flow was increased to a shear stress level of 1.5 dynes/cm<sup>2</sup>. All videos are shown accelerated by a factor of 96 as can be seen on the timestamp label. Only tracks included in the analysis are shown (see text for details). Scale bar = 200 µm.</p></caption></media><p>After exclusion of the tracks of the cellular debris, which were misclassified as T cells during the segmentation step, using a dedicated ‘not-a-T-cell’ classifier, we performed identification of transmigration (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1</xref>), probing and crawling migration regimes, as well as accelerated movement along the T-cell track. Detailed information on the analysis of the T-cell tracks is given in the ‘T-cell migration analysis’ section in Appendix 1.</p><p>Finally, for each track, we evaluated motility parameters for each of the following migration regimes: probing before the transmigration, crawling before the transmigration, all crawling above pMBMECs monolayer including T-cell crawling segments after the first transmigration attempts, all crawling below pMBMECs monolayer, whole T-cell track excluding accelerated movement and tracking inefficiency regions, as well as whole T-cell track. Specifically, we evaluated the following T-cell motility parameters: duration of each migration regime, the total vector and absolute displacements, the migration path length, the average migration speed (displacement over time), average crawling speed (path length over time), and finally the mean and standard deviation of the instantaneous speed. We evaluated migration time, displacement, and average speed for the accelerated movement regime.</p></sec><sec id="s2-4"><title>Analysis of trafficking datasets</title><p>Having developed a full pipeline based on the <sup>UFM</sup>Track framework for automated analysis of the multistep T-cell migration cascade across the BBB model, we next aimed to compare the results of the automated analysis with previous studies, assess the capacity of the framework to gain novel insight into T-cell migration under flow, and evaluate its performance as compared to manual analysis.</p><sec id="s2-4-1"><title>CD4<sup>+</sup> T-cell analysis</title><p>To this end, we first analyzed a total of 18 imaging datasets each corresponding to 32 min recording dedicated to understanding the multistep migration of CD4<sup>+</sup> T cells across non-stimulated (n=6), TNF-stimulated (n=5), and IL1-β-stimulated (n=7) pMBMEC monolayers under physiological flow with the developed pipeline.</p><p>In these in vitro live-cell imaging datasets, phase-contrast imaging was performed as described in the ‘Data acquisition’ subsection in the Materials and methods section. The T-cell accumulation phase corresponding to the shear stress of 0.1 dynes/cm<sup>2</sup> lasted for 32 time frames (5 min), followed by conditions of physiological flow (shear stress 1.5 dynes/cm<sup>2</sup>) for the subsequent 160 time frames (27 min). The shear stress is controlled by an automated syringe pump. After increasing to physiological flow rates (<xref ref-type="bibr" rid="bib44">Steiner et al., 2010</xref>), a significant number of T cells detached from the pMBMEC monolayers, with higher numbers of T cells detaching from non-stimulated pMBMEC monolayers when compared to those stimulated with pro-inflammatory cytokines as detected by the distribution of the track ending times between 5 and 30 min (<xref ref-type="fig" rid="fig4">Figure 4A</xref>).</p><fig id="fig4" position="float"><label>Figure 4.</label><caption><title>Analysis of CD4<sup>+</sup> T-cell tracks.</title><p>(<bold>A</bold>) Start and end time distribution of CD4<sup>+</sup> T-cell tracks on non-stimulated or TNF- or IL-1β-stimulated primary mouse brain microvascular endothelial cells (pMBMECs). Under-flow migration tracker (<sup>UFM</sup>Track) correctly captures increased T-cell detachment from the non-stimulated pMBMECs after 5 min when the flow is increased to physiological levels. (<bold>B</bold>) Quantification of CD4<sup>+</sup> T-cell behavior in the respective categories obtained on non-stimulated and TNF- and IL-1β-stimulated pMBMECs. Error bars show the statistical error of the mean (see text for details). (<bold>C–H</bold>) Motility parameters of the crawling CD4<sup>+</sup> T cells were obtained for the three endothelial stimulatory conditions. Distributions of T-cell path length (<bold>C</bold>), displacement (<bold>D</bold>), crawling speed (path/time) (<bold>E</bold>), migration speed (displacement/time) (<bold>F</bold>), variability of instantaneous T-cell crawling speed along the track (standard deviation, <bold>G</bold>), and meandering index (<bold>H</bold>). (<bold>I</bold>) Distribution of CD4<sup>+</sup> T-cell accelerated movement (AM) speed is a proxy metric for the T-cell adhesion to the healthy or inflamed endothelium. (<bold>J</bold>) Migration speed distribution of the transmigrated CD4<sup>+</sup> T cells. Stimulation applied to the luminal side of pMBMECs affects T-cell migration at the abluminal side of pMBMECs after their transmigration. FT – T cells performed full transmigration; UT – T cells performed uncompleted transmigration. Statistical tests are performed with the Mann-Whitney U test. Statistical significance is indicated as follows: ns – Not significant (p &gt; 0.05); * – p ≤ 0.05; ** – p ≤ 0.01; *** – p ≤ 0.001; **** – p ≤ 0.0001.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-91150-fig4-v1.tif"/></fig><p>Analyzing these datasets with the established <sup>UFM</sup>Track framework, the T-cell behavior type for each detected T-cell track and the aggregated T-cell behavior statistic were obtained for the stimulated and non-stimulated pMBMEC monolayers (<xref ref-type="fig" rid="fig4">Figure 4B</xref>). The total number of analyzed T-cell tracks is n=971, n=780, and n=1218 for the non-stimulated, TNF-stimulated, and IL1-β-stimulated pMBMEC monolayers correspondingly. The data obtained with <sup>UFM</sup>Track were in accordance with our previous observations obtained by manual frame-by-frame analysis (<xref ref-type="bibr" rid="bib44">Steiner et al., 2010</xref>; <xref ref-type="bibr" rid="bib2">Abadier et al., 2015</xref>; <xref ref-type="bibr" rid="bib17">Haghayegh Jahromi et al., 2019</xref>). We further obtained the data for T-cell migration speed, T-cell displacement, and T-cell path lengths for the crawling T cells, as these are the primary cell motility parameters. As shown in <xref ref-type="fig" rid="fig4">Figure 4C–H</xref>, we observed statistically significant differences in the mean T-cell motility parameters depending on the pMBMECs stimulation condition. Furthermore, we observed differences in the shape of the distribution of T-cell crawling speeds, consistent with our previous reports of underlying differences in the mechanisms mediating T-cell crawling on non-stimulated vs cytokine-stimulated pMBMECs (<xref ref-type="bibr" rid="bib17">Haghayegh Jahromi et al., 2019</xref>). While not statistically significant for the IL1-b and with a low significance for the TNF stimulations, an increased variance of the T-cell instantaneous speed on stimulated compared to non-stimulated pMBMECs is observed (<xref ref-type="fig" rid="fig4">Figure 4G</xref>). This suggests that T-cell crawling is often interrupted by T-cell recognizing specific cues on the stimulated endothelium. The T-cell meandering index distribution was high on non-stimulated and lower on stimulated pMBMECs (<xref ref-type="fig" rid="fig4">Figure 4H</xref>), underscoring that cytokine stimulation enhances directed T-cell movement on the pMBMEC monolayer.</p><p>Since the analysis was performed automatically with <sup>UFM</sup>Track, it allowed for deeper insights into the T-cell migration behavior on the pMBMEC monolayers than obtained by manual frame-by-frame analysis. Specifically, the detection of accelerated movement by <sup>UFM</sup>Track enables the researcher to quantify the kinetics of individual T-cell detachment from the endothelium rather than simply quantifying a bulk T-cell detachment rate. This detachment kinetics is reflected in the average speed experienced during accelerated movement, which is significantly lower for the IL1-b condition (<xref ref-type="fig" rid="fig4">Figure 4I</xref>), suggesting the need to break more bonds with the endothelium when pro-inflammatory cytokines are present.</p><p>As our <sup>UFM</sup>Track workflow achieves sufficient segmentation efficiency to detect T cells below the pMBMEC monolayer and T-cell transmigration across the pMBMEC monolayer, it also enables investigation of T-cell movement after the transmigration step. In <xref ref-type="fig" rid="fig4">Figure 4J</xref>, we show the distribution of the migration speed for the transmigrated CD4<sup>+</sup> T cells. Interestingly, cytokine stimulation of pMBMECs, although applied from the luminal side, also affected T-cell movement at the abluminal side of the pMBMEC monolayer. While, in the microfluidic device used in the present study, the migration of T cells below the pMBMEC monolayer may not be biologically relevant, this analysis option will be valuable for future studies involving multilayer in vitro BBB models that include the vascular basement membrane in addition to pericytes and astrocytes to mimic the entire neurovascular unit (<xref ref-type="bibr" rid="bib10">Castro Dias et al., 2021</xref>; <xref ref-type="bibr" rid="bib26">Mossu et al., 2019</xref>).</p><p>Importantly, our <sup>UFM</sup>Track automatically detects and characterizes unusual events, such as reverse T-cell transmigration, that are easily overlooked with manual counting. We do not present the statistics here, as only a few such events were observed. However, when applied to the multilayer BBBs in forthcoming in vitro models, systematic detection and analysis of these rare events will be important to understand T-cell migration in immune surveillance.</p></sec><sec id="s2-4-2"><title>CD8<sup>+</sup> T-cell analysis</title><p>As we have previously shown that the multistep T-cell extravasation across pMBMEC monolayers differs between CD4<sup>+</sup> and CD8<sup>+</sup> T cells (<xref ref-type="bibr" rid="bib35">Rudolph et al., 2016</xref>), we next analyzed two datasets studying the multistep migration of CD8<sup>+</sup> T cells across non-stimulated and TNF/interferon-gamma (TNF/IFN-γ)-stimulated pMBMEC monolayers under physiological flow over 161 time frames (27 min). The CD8<sup>+</sup> T cells were slightly different in size and appearance when compared to the CD4<sup>+</sup> T cells used for training the segmentation model. To benchmark our established <sup>UFM</sup>Track pipeline in this more difficult configuration, the datasets were first manually analyzed by four experimenters: one advanced experimenter with 4 years of experience (AdEx) and three inexperienced experimenters who received comparable 2 hr introduction and training (Ex1-Ex3). The analyses were performed on the subset of the acquisition, 161 time frames long starting from time frame 31.</p></sec></sec><sec id="s2-5"><title>CD8<sup>+</sup> T-cell analysis</title><p>Manual cell analysis and tracking were performed as described in the ‘Materials and methods’ section separately for each of the 8 tiles of the tiled acquisition. Next, all crawling CD8<sup>+</sup> T cells that did not perform transmigration were manually tracked for the time span after the flow was increased to the physiological level using the manual tracking in ImageJ.</p><p>First, we compared the CD8<sup>+</sup> T-cell behavior statistics obtained manually and by our automated analysis pipeline (<xref ref-type="fig" rid="fig5">Figure 5A–C</xref>). The results obtained by the automated analysis were in full agreement with the manual analysis performed by the experienced experimenter. At the same time, the data highlight the variability of the results from the inexperienced experimenters, confirming the potential for significant experimenter bias.</p><fig-group><fig id="fig5" position="float"><label>Figure 5.</label><caption><title>Comparison of automated analysis with under-flow migration tracker (<sup>UFM</sup>Track) and manual analysis of the CD8<sup>+</sup> T-cell tracks.</title><p>(<bold>A–C</bold>) CD8<sup>+</sup> T-cell behavior statistic obtained for non-stimulated (NS) and cytokine-stimulated primary mouse brain microvascular endothelial cells (pMBMECs) as obtained manually by four experimenters, as well as automatically with <sup>UFM</sup>Track. (<bold>A</bold>) Quantification of CD8<sup>+</sup> T-cell behavior in the respective categories obtained on non-stimulated and TNF/interferon-gamma (TNF/IFN-γ)-stimulated pMBMECs is consistent with results obtained by manual frame-by-frame analysis. Cytokine stimulation of pMBMECs increases T-cell probing behavior (<bold>B</bold>) and T-cell transmigration rate (<bold>C</bold>). Error bars show the standard deviation of the manual analysis and the statistical error of the mean for automated analysis. Points correspond to individual experimenters. (<bold>D</bold>) Counts of CD8<sup>+</sup> T cells were obtained manually by four experimenters and automatically by <sup>UFM</sup>Track. The T-cell detection efficiency is above 90%. Error bars show the standard deviation of the manual analysis and the statistical error of the mean for the automated analysis. Points correspond to individual experimenters. (<bold>E</bold>) Detection efficiency of crawling CD8<sup>+</sup> T-cell tracks between the manual and automated analysis. (<bold>F–I</bold>) Comparison of CD8<sup>+</sup> T-cell crawling speed (path/time) (<bold>F, G</bold>) and migration speed (displacement/time) (<bold>H, I</bold>) on non-stimulated (<bold>F, H</bold>) and cytokine-stimulated (<bold>G, I</bold>) pMBMECs. The T-cell position assignment error in manual tracking leads to biased crawling speed estimation. (<bold>J</bold>) Comparison of the analysis time (per cell) required for behavior analysis and tracking of CD8<sup>+</sup> T cells. (<bold>K</bold>) Total analysis time (per dataset) for behavior analysis and tracking of CD8<sup>+</sup> T cells. Comparison is shown for manual analysis with tracking of crawling cells only (crawling manual), the time estimate for manual analysis with tracking of all cells (all manual), and the in-depth automated analysis of all cell tracks with <sup>UFM</sup>Track (all auto). FT – T cells performed full transmigration; UT – T cells performed uncompleted transmigration; NT – T cells did not perform transmigration. Statistical tests are performed with the Mann-Whitney U test. Statistical significance is indicated as follows: ns – Not significant (p &gt; 0.05); * – p ≤ 0.05; ** – p ≤ 0.01; *** – p ≤ 0.001; **** – p ≤ 0.0001.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-91150-fig5-v1.tif"/></fig><fig id="fig5s1" position="float" specific-use="child-fig"><label>Figure 5—figure supplement 1.</label><caption><title>Comparison of reconstructed T-cell tracks with the result of manual analysis.</title><p>Overlay of crawling CD8<sup>+</sup> T-cell crawling tracks on top of non-stimulated (top) and TNF/interferon-gamma (TNF/IFNγ)-stimulated primary mouse brain microvascular endothelial cells (pMBMECs) (bottom) tracked manually by three experimenters as well as automatically. Errors in manual tracking led to a jittery pattern in the T-cell tracks. This lead, in turn, to the overestimation of the T-cell crawling speed.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-91150-fig5-figsupp1-v1.tif"/></fig></fig-group><p>We also show the detection efficiency of T cells by the <sup>UFM</sup>Track. To achieve this goal, we combined the numbers of CD8<sup>+</sup> T cells detected in each tile by manual analysis. Due to the overlap between the individual tiles, some CD8<sup>+</sup> T cells are seen more than once. To obtain an estimate of the total CD8<sup>+</sup> T-cell count detected manually, we scaled the number of CD8<sup>+</sup> T cells accordingly to the number of detected unique T-cell tracks (see next paragraph). By this approach, we found T-cell detection efficiency to be above 90% (<xref ref-type="fig" rid="fig5">Figure 5D</xref>). The increased T-cell density can explain lower efficiency in the non-stimulated condition. These findings set the appropriate T-cell density for automated analysis of their migration behavior on pMBMEC monolayers to 200–300 cells per FoV of the size of 3.8 mm<sup>2</sup> or 50–80 cells/mm<sup>2</sup>.</p><p>Next, we compared the T-cells tracks as obtained manually by three experimenters as well as automatically by our <sup>UFM</sup>Track. To this end, we first matched the tracks in adjacent tiles to obtain the tracks on the whole imaging area, avoiding multiple counts of the same track. This was achieved by pattern matching with initial offsets between tiles obtained by an automatic frame alignment procedure performed as part of the automatic analysis. We considered T-cell tracks observed in different tiles to be tracks of the same T cell if <inline-formula><mml:math id="inf18"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mn>0.8</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula>, where <inline-formula><mml:math id="inf19"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> is the fraction of timepoints along a track at which the distance between the T cells was below 17 µm and <inline-formula><mml:math id="inf20"><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> was the fraction of timepoints along a track at which distance between cells was above 25 µm. We used the same approach to match the T-cell tracks obtained by each experimenter and the automated <sup>UFM</sup>Track. To compare performance in an objective manner, we excluded manually obtained tracks that lay outside of the fiducial volume of the automated analysis, as well as T cells that were touching another T cell at the end of the acquisition, as those were also excluded from the automated analysis. We then took as 100% the sum of all T-cell tracks detected manually. We evaluated the fraction of all T-cell tracks detected by each experimenter as well as automatically by our <sup>UFM</sup>Track.</p><p>In <xref ref-type="fig" rid="fig5">Figure 5E</xref>, we show that our pipeline achieves a comparable T-cell tracking efficiency when compared to the manual analysis. While its performance was not superior to that of the experimenter with 4 years of expertise in the analysis of the under-flow datasets, it does perform better than less experienced experimenters.</p><p>We also compared the T-cell motility parameters obtained manually and automatically for the non-stimulated and stimulated pMBMECs (<xref ref-type="fig" rid="fig5">Figure 5F–I</xref>). Data obtained for the CD8<sup>+</sup> T-cell migration speed on pMBMECs was comparable between all experimenters and the automated analysis. In contrast, results obtained for the T-cell crawling speed were significantly different between the automated approach and manual analysis. Taking a closer look at the T-cell tracks (<xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1</xref>), we readily observed that the manual analysis contains significant errors in the assignment of the T-cell position. This leads to a jittery pattern in the T-cell migration tracks and overestimates the T-cell path and, thus, T-cell crawling speed. Employing our novel automated analysis pipeline eliminated this systematic error in the measurements.</p><p>To finally investigate the potential benefit in the time required for automated vs manual data analysis, we examined the time required for a given experimenter to analyze such datasets manually using the Clockify time tracker (<xref ref-type="bibr" rid="bib11">Clockify, 2022</xref>). In <xref ref-type="fig" rid="fig5">Figure 5J</xref>, we show the average time investment needed to perform a complete T-cell behavior analysis and T-cell tracking in each imaging tile, as well as on average. Clearly, the experienced experimenter outperforms the inexperienced experimenters by a factor of 3. On average, a researcher would thus spend 8.1 hr analyzing a dataset with 300T cells when only the tracks of crawling T cells (50%, i.e. 150 cells) are analyzed. If all T-cell tracks were to be analyzed, this time would further increase to 12.9 hr. Given that on average 10 datasets can be produced per day, manual analysis becomes a bottleneck, leading to delays in exhaustive data analysis and thus ultimately in research progress. The <sup>UFM</sup>Track framework reduces analysis time by a factor of 3 when analyzing only crawling cells and 5 if all cell tracks are to be analyzed (<xref ref-type="fig" rid="fig5">Figure 5K</xref>). With an average analysis time of 2.3 hr, the 10 experiments carried out in 1 day can be thoroughly analyzed within 1 day of machine time. This enables the scalability of flow-based immune cell migration experiments while simultaneously lifting the burden of tedious and time-consuming manual analysis from the researchers.</p><sec id="s2-5-1"><title>Applicability of <sup>UFM</sup>Track to different models of immune cell-endothelial cell interactions</title><p>Next we have assessed the broader applicability of the <sup>UFM</sup>Track framework to different cell typesand BBB models often employed for the in vitro under-flow cell trafficking assays. To this end, we have performed the automated analysis of the multistep T-cell migration cascade in a set of datasets (one to eight) across different cell types and assays. Specifically, we attempted to verify the feasibility of analysis of datasets where the cells forming the monolayer or the migrating cells have noticeably different appearances, cells from other species are used, specifically human-derived cells, and datasets with a different imaging modality. These include human peripheral blood mononuclear cells (hPBMCs), human T cells, bone marrow-derived macrophages (BMDM) interacting with a monolayer of mouse- and human-derived brain microvascular endothelial cells as well as with immobilized recombinant BBB adhesion molecules (see ‘Materials and methods’ section for details). To assess the performance of the model in each condition, we have performed a visual inspection of the cell masks, transmigration masks, and cell tracks for few datasets in each assay type. We then analyzed cell behavior distribution or motility parameters relevant in each case.</p><sec id="s2-5-1-1"><title>hPBMC on HBMEC monolayer</title><p>The interaction of hPBMCs with the BBB is altered under different disease conditions. We have therefore analyzed a dataset of human PBMCs on human brain microvascular endothelial cells (HBMEC) to quantify the cell behavior statistic. While the endothelial cells look significantly different than the pMBMECs, the segmentation and transmigration detection quality was sufficient to perform the cell migration analysis. This was also confirmed by the visual inspection of the cell and transmigration masks and cell tracking results (<xref ref-type="fig" rid="fig6">Figure 6A</xref>). We then quantified the PBMC behavior distribution and the crawling and migration speed of the crawling PBMC (<xref ref-type="fig" rid="fig6">Figure 6B and C</xref>).</p><fig-group><fig id="fig6" position="float"><label>Figure 6.</label><caption><title>Analysis of different blood-brain barrier (BBB) models with under-flow migration tracker (<sup>UFM</sup>Track).</title><p>(<bold>A–C</bold>) Human peripheral blood mononuclear cells (PBMCs) interacting with human brain microvascular endothelial cells (HBMEC). (<bold>A</bold>) Raw image frame, segmentation, and tracking results. (<bold>B</bold>) PBMCs behavior distribution. (<bold>C</bold>) Crawling and migration speed distribution. (<bold>D–F</bold>) Bone marrow-derived macrophages (BMDM) interacting with the primary mouse brain microvascular endothelial cell (pMBMEC) monolayer. (<bold>D</bold>) Raw image frame, segmentation, and tracking results. (<bold>E</bold>) BMDM crawling vs probing behavior distribution. (<bold>F</bold>) Crawling and migration speed distribution. (<bold>G–K</bold>) Human T cells interacting with the extended endothelial cell culture method brain microvascular endothelial cell (EECM-BMEC) monolayer. (<bold>G</bold>) Raw image frame, segmentation, and tracking results. (<bold>H</bold>) Crawling and migration speed distributions for the control condition (ctrl) and with the blocking anti-bodies (bab). (<bold>I</bold>) X and Y relative cell displacement. (<bold>J</bold>) Crawling vs probing behavior comparison. (<bold>K</bold>) Transmigrations behavior comparison. (<bold>L–O</bold>) Human T cells interacting with immobilized recombinant BBB adhesion molecules. (<bold>L</bold>) Raw fluorescent image frame, thresholding-based segmentation, and tracking results. (<bold>M</bold>) Crawling vs probing behavior distribution. (<bold>N</bold>) X and Y relative displacement (<bold>O</bold>). Crawling vs probing speed comparison. Scale bars = 50 µm. Statistical tests are performed with the Mann-Whitney U test. Statistical significance is indicated as follows: ns – Not significant (p &gt; 0.05); * – p ≤ 0.05; ** – p ≤ 0.01; *** – p ≤ 0.001; **** – p ≤ 0.0001.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-91150-fig6-v1.tif"/></fig><fig id="fig6s1" position="float" specific-use="child-fig"><label>Figure 6—figure supplement 1.</label><caption><title>Comparison of sizes of crawling cells.</title><p>Under-flow migration tracker (<sup>UFM</sup>Track) is able to successfully reconstruct tracks of migrating cells of different sizes. CD4 and CD8 – mouse CD4<sup>+</sup> and CD8<sup>+</sup> cells, BMDM – bone marrow-derived macrophages, hT – human T cells, hPBMC – human peripheral blood mononuclear cells. The statistical tests are performed with the Mann-Whitney U test. Statistical significance is indicated as follows: ns – Not significant (p &gt; 0.05); * – p ≤ 0.05; ** – p ≤ 0.01; *** – p ≤ 0.001; **** – p ≤ 0.0001.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-91150-fig6-figsupp1-v1.tif"/></fig></fig-group></sec><sec id="s2-5-1-2"><title>BMDM on the pMBMEC monolayer</title><p>Invasion of macrophages into the CNS contributes to many neurological disorders. Therefore, we have explored if <sup>UFM</sup>Track also allows us to analyze the interaction of BMDMs with the BBB under physiological flow in vitro. To this end, we have analyzed two datasets of mouse BMDMs interacting with pMBMEC monolayers (<xref ref-type="fig" rid="fig6">Figure 6D</xref>). Despite the different behavior and appearance of the macrophages as compared to the T cells, the segmentation quality was sufficient to perform the cell tracking and analyze cell motility parameters (<xref ref-type="fig" rid="fig6">Figure 6E and F</xref>), as confirmed by visual inspection of the macrophages masks and cell tracking results (<xref ref-type="fig" rid="fig6">Figure 6D</xref>). Nonetheless, due to the different appearance of the flattening crawling cells and the transmigrated cells, the transmigration detection trained on the mouse T cells does not perform sufficiently well for the robust detection of transmigrating macrophages.</p></sec><sec id="s2-5-1-3"><title>Human T cells on EECM-BMEC monolayer</title><p>Next, we analyzed eight datasets of human T cells interacting with the human induced pluripotent stem cell (hiPSC) derived extended endothelial cell culture method brain microvascular endothelial cell (EECM-BMEC)-like cell monolayers (<xref ref-type="fig" rid="fig6">Figure 6G</xref>). EECM-BMECs establish barrier properties comparable to primary human BMECs and display a mature immune phenotype allowing to perform studies for the first time in a fully autologous manner of immune cell interactions with patient-derived in vitro models of the BBB (<xref ref-type="bibr" rid="bib28">Nishihara et al., 2021</xref>). Despite the cells being of different species, the T cells were successfully segmented, and their transmigration was detected, as confirmed by visual inspection of the T-cell and transmigration masks and cell tracking results (<xref ref-type="fig" rid="fig6">Figure 6G</xref>).</p><p>We have confirmed the differences in migration statistics (<xref ref-type="fig" rid="fig6">Figure 6J and K</xref>), migration and crawling speed of the crawling T cells (<xref ref-type="fig" rid="fig6">Figure 6H</xref>), as well as the previously reported difference in relative (normalized to track path length) displacement (<xref ref-type="fig" rid="fig6">Figure 6I</xref>) of the T cells treated with anti-α4-integrin+anti-β2-integrin blocking antibodies (bab) and control (ctrl) condition (<xref ref-type="bibr" rid="bib43">Soldati et al., 2023</xref>).</p></sec><sec id="s2-5-1-4"><title>Human T cells on immobilized recombinant BBB adhesion molecules</title><p>Finally, we have analyzed datasets acquired in a different imaging modality. Seven datasets of human T cells interacting with immobilized recombinant BBB adhesion molecules, namely ICAM-1, VCAM-1, and their combination (<xref ref-type="fig" rid="fig6">Figure 6l</xref>). In this case, the fluorescently labeled cells were imaged with epi-fluorescent microscopy. In the absence of a monolayer, transmigration detection is not necessary. Thus, we performed cell segmentation directly on the fluorescent signal (see Materials and methods for details) using the same segmentation strategy as for the T-cell masks. The tracking was then performed the same way as for other experiments. The T cells were successfully segmented and tracked, as confirmed by visual inspection. We compared T-cell behavior and motility parameters for three conditions of the recombinant adhesion molecules: ICAM-1, VCAM-1, and ICAM1+VCAM1 (<xref ref-type="fig" rid="fig6">Figure 6M and O</xref>). Consistent with previous observations (<xref ref-type="bibr" rid="bib44">Steiner et al., 2010</xref>; <xref ref-type="bibr" rid="bib43">Soldati et al., 2023</xref>) where the analysis was performed using the ImageJ (<xref ref-type="bibr" rid="bib36">Rueden et al., 2017</xref>) either manually or with the TrackMate (<xref ref-type="bibr" rid="bib15">Ershov et al., 2022</xref>) plugin, we observed that in the absence of ICAM-1, T cells were moving in the direction of flow (<xref ref-type="fig" rid="fig6">Figure 6N</xref>). At the same time, <sup>UFM</sup>Track allows for capturing the rapid accelerated motions of the cells and thus reconstructing longer continuous T cell tracks. This enables capturing the migrations properties of the consecutive steps of the T-cell migration cascade on the cell-by-cell basis.</p></sec></sec></sec></sec><sec id="s3" sec-type="discussion"><title>Discussion</title><p>In this study, we have developed the <sup>UFM</sup>Track framework. It consists of independent modules and allows for segmentation (<xref ref-type="fig" rid="fig2">Figure 2</xref>), tracking (<xref ref-type="fig" rid="fig3">Figure 3</xref>), and motility analysis of immune cells, migrating on, across, and below (<xref ref-type="fig" rid="fig1">Figure 1D</xref>) the monolayer of brain microvascular endothelial cells under physiological flow in vitro. The developed method relies exclusively on phase-contrast imaging data (<xref ref-type="fig" rid="fig1">Figure 1B</xref>). Therefore, it does not require establishing fluorescent labels of the migrating immune cell population to be studied, avoids potential phototoxicity to be considered for fluorescent imaging modalities (<xref ref-type="bibr" rid="bib20">Jae Oh et al., 1999</xref>; <xref ref-type="bibr" rid="bib37">Saetzler et al., 1997</xref>; <xref ref-type="bibr" rid="bib33">Purschke et al., 2010</xref>), and is thus the preferred choice for analyzing the trafficking of sensitive cell types. T-cell segmentation and prediction of the transmigrated T-cell areas are performed using a custom 2D+T U-Net-like convolutional neural network. It enables reliable segmentation of T cells both above and below the pMBMEC monolayer. The existing particle and cell tracking toolkits consider migration of one cell type and thus are not suitable for the detection of distinct migration regimes and cell interactions (<xref ref-type="bibr" rid="bib3">Allan et al., 2021</xref>; <xref ref-type="bibr" rid="bib47">Tsai et al., 2019</xref>; <xref ref-type="bibr" rid="bib15">Ershov et al., 2022</xref>; <xref ref-type="bibr" rid="bib48">Ulicna et al., 2021</xref>). Furthermore, to our knowledge, none of the existing algorithms consider migration under the flow causing rapid cell displacement. The tracking of T-cell interactions with the pMBMECs during all migration regimes under physiological flow required designing a new tracking algorithm considering rapid T-cell appearance, disappearance, and displacement in the FoV caused by the flow. We have also developed approaches that resolve track intersections, i.e., identifying track segments corresponding to the same T cell before and after under-segmented track regions, which are inevitable during T-cell migration. By establishing the detection of T-cell crawling, probing, transmigration, and accelerated movement combined with reliable T-cell tracking, we have enabled the in-depth analysis of distinct migration regimes on a cell-by-cell basis. By reducing the dataset analysis time by a factor of 5, <sup>UFM</sup>Track allows for performing a thorough analysis of 10 experiments that a researcher can carry out in 1 day within 1 day of machine time. We have demonstrated that the automated analysis performs on par with manual analysis while improving accuracy and eliminating experimenter bias, and enables scalability of flow-based immune cell migration experiments by reducing the analysis cost and lifting the burden of time-consuming manual analysis.</p><p>In this work, we have demonstrated the applicability of the developed framework to the analysis of the multistep extravasation of CD4<sup>+</sup> and CD8<sup>+</sup> T cells across non-stimulated or cytokine-stimulated pMBMEC monolayers under physiological flow. We have also demonstrated that the developed framework allows for automated analysis of T-cell behavior statistics and motility parameters of distinct T-cell migration regimes. Results of the automated analysis of CD4<sup>+</sup> T-cell behavioral statistics performed with <sup>UFM</sup>Track are in agreement with previous studies using manual data analysis (<xref ref-type="fig" rid="fig4">Figure 4B</xref>; <xref ref-type="bibr" rid="bib2">Abadier et al., 2015</xref>). The automated analysis of datasets of CD8<sup>+</sup> T-cell migration has shown comparable performance with manual analysis performed by one experimenter with 4 years of analysis experience and three less-experienced experimenters. At the same time, the variance of the results obtained manually showed significant experimenter bias that the automated analysis eliminated (<xref ref-type="fig" rid="fig5">Figure 5F</xref>). Additionally, the automated analysis allowed for in-depth analysis of all T-cell migration categories and precise evaluation of T-cell motility parameters, which was not achieved by manual T-cell tracking, even by the most experienced user.</p><p>We have further demonstrated the applicability of the <sup>UFM</sup>Track framework to the analysis of different cell types (BMDM, PBMC), species (human-derived T cells, HBMEC, and EECM-BMEC), as well as tracking and analysis of cell migration imaged using the fluorescent imaging modality. In all cases, the cells could be successfully segmented and tracked, and the cell migration analysis was performed on a cell-by-cell basis. The main challenge for the system is reliable segmentation of the T cells and the transmigrated T cells. In the case of HBMEC the monolayer has a dotted pattern unlike the rather smooth pMBMEC. This leads to more false positives in the T-cell segmentation at the level of individual frames, which nonetheless could be efficiently filtered at the level of cell tracking. In the case of the BMDMs, since they have significantly different appearances during transmigration from the T cells, reliable transmigration detection was not obtained. This prevents the system from quantifying the transmigration statistics of the BMDMs, yet the cell detection and thus motility parameter evaluation of BMDMs was successful (<xref ref-type="fig" rid="fig6">Figure 6D–F</xref>). For all the other analyzed cell types, both the cell segmentation and transmigration detection model trained on the annotated CD4<sup>+</sup> T cells also produced transmigration maps of sufficient quality for reliable transmigration detection. The framework was able to successfully detect the cells of sizes that differ by almost a factor of two (<xref ref-type="fig" rid="fig6s1">Figure 6—figure supplement 1</xref>). This demonstrates that, simply by discriminating cells by size, it is possible to extend <sup>UFM</sup>Track to study the interaction of several types of immune cells migrating on top of a cellular monolayer under flow and imaged by phase contrast.</p><p>Quantifying the fraction of transmigrated T cells is crucial for studying the molecular mechanisms governing the infiltration of autoaggressive T cells across the BBB into the CNS parenchyma and the immune surveillance. The role of specific endothelial or T-cell adhesion molecules in influencing the dynamic interactions of T cells with pMBMECs can, e.g., be probed by quantifying the ratio of T-cell crawling behavior to T-cell probing (<xref ref-type="fig" rid="fig6">Figure 6M</xref>; <xref ref-type="bibr" rid="bib2">Abadier et al., 2015</xref>; <xref ref-type="bibr" rid="bib53">Wimmer et al., 2019</xref>; <xref ref-type="bibr" rid="bib6">Aydin et al., 2023</xref>). The analysis procedure established in the <sup>UFM</sup>Track framework is flexible and can be easily extended to evaluate further properties of the migrating cells. For example, the number of times a T cell interrupts its crawling regime by switching to short probing behavior on the endothelium can be evaluated, thus providing information on the distribution of ‘hot spots’ on the endothelium. Additionally, experiment scalability and the analysis on a cell-by-cell basis enable the search for distinct populations of T cells, e.g., according to the distribution of probing to crawling behavioral ratios. The strength of T-cell adhesion to the endothelium can be probed with the developed framework using the measure of T-cell detachment rate and the distribution of the previously overlooked T-cell accelerated movement occurrences and accelerated movement speed. Finally, the possibility of quantifying the motility parameters of the transmigrated T cells enables future studies involving multilayer in vitro BBB models that include the vascular basement membrane in addition to mural cells such as pericytes and astrocytes mimicking the entire neurovascular unit.</p><p>While in this work we have focused primarily on the analysis of mouse T cells interacting with pMBMEC under flow or other immune cells interacting with the endothelial monolayer, the methods we present establish a foundation for a broad range of studies involving in vitro under-flow studies of immune cell trafficking. The tracking algorithm and motility analysis developed in the <sup>UFM</sup>Track framework are also directly applicable to the analysis of immune cell interactions with recombinant BBB adhesion molecules under flow. In this case, either phase-contrast or epi-fluorescent imaging can be employed when studying fluorescently labeled immune cells, as demonstrated. The T-cell segmentation based on deep neural networks can be applied to studies of the trafficking of other immune cell subsets on and across the pMBMEC monolayer. We demonstrated the successful application of the <sup>UFM</sup>Track to cells with significantly different appearances, such as the HBMEC cellular monolayers.</p><p>We make <sup>UFM</sup>Track available to the community to build upon it for addressing their specific research questions. The modularity of the framework simplifies the adaptation to analysis of different cell types. The application to immune cell trafficking across other endothelial monolayers, including those from different species or vascular beds as well as lymphatic endothelial cells where the cell appearance is drastically different from the ones demonstrated here, is possible but requires fine-tuning of the trained segmentation model. While training the models presented here required a large dataset of annotated T-cell masks, and transmigration masks, this can be largely avoided for future development. Future models can be developed more efficiently by leveraging our existing annotated dataset of T-cell migration on the pMBMECs while employing transfer learning approaches in a multitask framework with weak supervision and fluorescent labels as auxiliary learning targets to adapt the model for the segmentation of cells with different appearances. This can be further improved by adopting self-supervised contrastive or masked learning methods, which have demonstrated significant advancements in model pretraining in recent years (<xref ref-type="bibr" rid="bib9">Caron et al., 2021</xref>; <xref ref-type="bibr" rid="bib4">Archit et al., 2023</xref>; <xref ref-type="bibr" rid="bib22">Kraus et al., 2024</xref>; <xref ref-type="bibr" rid="bib54">Xie et al., 2023</xref>). This is the subject of our future studies. The framework could be employed in combination of other methods, e.g., by incorporating fluorescently labeled endothelial adherens junctions one could differentiate the trans- from the paracellular transmigration in the migrating cells. In this case the transmigration locations detected by the <sup>UFM</sup>Track framework could be automatically extracted for analysis. One could employ the tracking under flow implemented in the <sup>UFM</sup>Track framework for tracking the immune cells migrating on the vascular wall in vivo to capture the accelerated movement of cells. By sharing the data and open-source code of the <sup>UFM</sup>Track framework, i.e., the training data used for the segmentation model training, trained models, as well as the model architecture, and full under-flow T-cell tracking and migration analysis pipeline, we hope to encourage the community to pursue these developments to advance the field.</p><p>One current limitation of the method is the performance reduction of the T-cell tracking when the density of migrating T cells significantly increases (&gt;250 cells/dataset). Thus, the recommended T-cell concentration is about 100–150 k/ml. However, to avoid nonphysiological interactions between migrating T cells and T-cell clumping, the T-cell density should be kept at moderate levels anyway. Additionally, analyzing data from 8 stitched FoVs allows for obtaining comparable statistics. The current analysis of the behavioral statistics quantifies the fraction of different T-cell migration regimes with respect to the number of adhered cells instead of the total T-cell count passing through the microfluidic device. While the number of fast-moving T cells during the accumulation phase cannot be directly counted using the imaging modality employed here, it can be estimated indirectly from the imaging data with additional calibration experiments and a dedicated machine learning model. Another limitation is that currently, we do not consider dividing immune cells. While cell division events happen rarely (&lt;1% of T cells) and are not primary events for the study of immune cell interaction with the BBB model, the modular architecture of our framework will facilitate future extension to detect cell division.</p><p>By enabling experiment scalability, unbiased analysis with advanced accuracy, and an in-depth analysis of large datasets of T-cell dynamics under flow, the computational and analytical framework presented here contributes to the 3R principle when studying the interaction of cells derived from animal models by reducing the number of animals to be sacrificed. <sup>UFM</sup>Track can be employed for fundamental research of the molecular mechanisms governing immune cell trafficking across a range of vascular beds, screening of pharmaceutical treatments, as well as for personalized medicine based on the evaluation of treatment efficacy on patient-derived T-cell migration behavior on patient-derived endothelial monolayers. One can furthermore envisage that <sup>UFM</sup>Track can be suitable to study cancer cell metastasis across different endothelial cell monolayers. Eventually, the developed framework can be extended to real-time operation during image acquisition. Combined with transgenic photo-convertible immune cells allowing for the photoconversion of immune cells according to their behavior will allow for subsequent fluorescent cell sorting and scRNA-Seq analysis. Such advanced studies are needed to reveal the role of genetic differences governing T-cell migration regimes.</p></sec><sec id="s4" sec-type="materials|methods"><title>Materials and methods</title><sec id="s4-1"><title>pMBMEC culture</title><p>pMBMECs were isolated from 8- to 12-week-old C57BL/6J WT mice and cultured exactly as described before (<xref ref-type="bibr" rid="bib44">Steiner et al., 2010</xref>; <xref ref-type="bibr" rid="bib12">Coisne et al., 2013</xref>). Intact monolayers were stimulated or not with 10 ng/mL of recombinant mouse TNF, 20 ng/mL of recombinant mouse IL1-β, or 5 ng/mL recombinant mouse TNF+100 U/mL recombinant mouse IFN-γ 16–24 hr prior to the assays as previously described (<xref ref-type="bibr" rid="bib17">Haghayegh Jahromi et al., 2019</xref>).</p></sec><sec id="s4-2"><title>Human brain microvascular endothelial cells</title><p>HBMEC were kindly provided by Prof. Nicholas Schwab (University of Münster, Germany). They were cultured to confluency on speed coating solution coated µ-Dishes (35 mm, low, iBidi) for 2 days as previously described (<xref ref-type="bibr" rid="bib17">Haghayegh Jahromi et al., 2019</xref>).</p></sec><sec id="s4-3"><title>EECM-BMEC-like cells</title><p>The Extended Endothelial Cell Culture Method (EECM) was used to differentiate human induced pluripotent stem cells (hiPSCs) to brain microvascular endothelial cell (BMEC)-like cells, what were then employed as a human in vitro model of the BBB. In brief, hiPSCs from one healthy control (cell line ID: LNISi002-B) were established from erythroblasts in the laboratory of Renaud DuPasquier (University of Lausanne, Switzerland). EECM-BMEC-like cells were cultured to confluency on collagen IV and fibronectin-coated µ-Dishes (35 mm, low, iBidi) for 2 days (<xref ref-type="bibr" rid="bib43">Soldati et al., 2023</xref>).</p></sec><sec id="s4-4"><title>T-cell and hPBMC preparation</title><p>Naïve CD4<sup>+</sup> and CD8<sup>+</sup> T-cell isolation: Peripheral lymph nodes and spleens from 2D2 and OT-I C57BL/6J mice were harvested, and single-cell suspensions were obtained by homogenization and filtration through a sterile 100 μm nylon mesh. A second filtration was applied after erythrocyte lysis (0.83% NH<sub>4</sub>Cl, Tris-HCl). 2D2 and OT-I cells were isolated respectively with magnetic CD4<sup>+</sup> and CD8<sup>+</sup> T-cell selection beads (EasySep, STEMCELL Technologies).</p><p>In vitro activation of naïve CD8<sup>+</sup> T cells: OT-I CD8<sup>+</sup> T cells were activated as described before (<xref ref-type="bibr" rid="bib35">Rudolph et al., 2016</xref>; <xref ref-type="bibr" rid="bib6">Aydin et al., 2023</xref>). Activated CD8<sup>+</sup> T cells were cultured in IL-2-containing media for 3 days post-activation.</p><p>In vitro activation of naïve CD4<sup>+</sup> T cells: 2D2 CD4<sup>+</sup> T cells were activated as described before (<xref ref-type="bibr" rid="bib17">Haghayegh Jahromi et al., 2019</xref>). Activated CD4<sup>+</sup> T cells were cultured in IL-2-containing media for 24 additional hours.</p><p>hPBMC were isolated from buffy coats of healthy donors by Ficoll-Paque Plus (Cytiva) density gradient and were frozen and stored in a liquid nitrogen tank until use as previously described in <xref ref-type="bibr" rid="bib43">Soldati et al., 2023</xref>.</p><p>Human CD4<sup>+</sup> T cells were isolated by employing a CD4<sup>+</sup> T-cell isolation kit (Miltenyi Biotec kit) following the provider’s instructions. Subsequently, effector/memory CD4<sup>+</sup> T cells were sorted by fluorescence-activated cell sorting into different Th subsets according to their specific surface expression of chemokine receptors (CCR6<sup>−</sup>CXCR3<sup>+</sup>CCR4<sup>−</sup> for Th1; CCR6<sup>+</sup>CXCR3<sup>+</sup>CCR4<sup>−</sup> for Th1*; CCR6<sup>−</sup>CXCR3<sup>−</sup>CCR4<sup>+</sup> for Th2; CCR6<sup>+</sup>CXCR3<sup>−</sup>CCR4<sup>+</sup> for Th17) and expanded as previously described (<xref ref-type="bibr" rid="bib27">Nishihara et al., 2020</xref>; <xref ref-type="bibr" rid="bib26">Mossu et al., 2019</xref>; <xref ref-type="bibr" rid="bib53">Wimmer et al., 2019</xref>; <xref ref-type="bibr" rid="bib14">Engen et al., 2014</xref>; <xref ref-type="bibr" rid="bib38">Sallusto et al., 1998</xref>; <xref ref-type="bibr" rid="bib55">Zielinski et al., 2012</xref>).</p></sec><sec id="s4-5"><title>BMDM preparation</title><p>BMDMs were prepared as described in Berve et al. (manuscript in preparation). In brief, the mouse bone marrow was harvested and washed through a 100 µm nylon mesh. After 7 days of cell culture the cells were plated at a density of 17–20×10<sup>6</sup> cells/mL in BMDM medium supplemented with 5 ng/mL of recombinant mouse macrophage colony stimulating factor (mCSF, R&amp;D Biosystems, Minneapolis, USA, MN, 416-ML-500) onto non-treated 100 mm tissue culture Petri dishes (Greiner Bio-One, St. Gallen, Switzerland) for 7 days at 37°C and 5% CO<sub>2</sub>. The cells were harvested by incubation with 0.05% Trypsin.</p></sec><sec id="s4-6"><title>T-cell binding assays under physiological flow conditions</title><p>For live-cell imaging of T-cell interaction with recombinant BBB cell adhesion molecules under the physiological flow condition, µ-Dishes (35 mm, low, iBidi) were coated with 1.54 μg/mL human recombinant VCAM-1 (BioLegend) and/or 1.14 μg/mL human recombinant ICAM-1 (R&amp;D Systems) in DPBS for 1 hr at 37°C and blocked with 1.5% (vol/vol) bovine serum albumin (Sigma-Aldrich) in DPBS overnight at 4°C.</p><p>CMFDA pre-labeled Th cells were incubated with the isotype control antibody (30 μg/mL) for 30 min at 37°C (8% CO<sub>2</sub>) prior to imaging (exact antibody concentrations are illustrated in the figure legend). The cells were subsequently perfused on top of the pre-coated dishes at a concentration of 10<sup>6</sup>/mL in MAM as previously described (<xref ref-type="bibr" rid="bib44">Steiner et al., 2010</xref>; <xref ref-type="bibr" rid="bib43">Soldati et al., 2023</xref>).</p></sec><sec id="s4-7"><title>In vitro under-flow T-cell migration assay</title><p>We studied the multistep T-cell migration across monolayers of pMBMECs in a custom-made microfluidic device under physiological flow by in vitro live-cell imaging according to the previously established procedure (<xref ref-type="bibr" rid="bib2">Abadier et al., 2015</xref>; <xref ref-type="bibr" rid="bib17">Haghayegh Jahromi et al., 2019</xref>). The custom-made flow chamber was described in depth before (<xref ref-type="bibr" rid="bib24">Lyck et al., 2023</xref>; <xref ref-type="bibr" rid="bib12">Coisne et al., 2013</xref>). The flow chamber was placed on top of the pMBMECs, previously cultured in Ibidi µ-Dish to confluency, and connected to the flow system filled with migration assay medium (MAM) (<xref ref-type="bibr" rid="bib44">Steiner et al., 2010</xref>). During the accumulation phase, T cells at a concentration between 55 and 166 k/mL were perfused on top for 5 min under low shear stress of 0.1 dynes/cm<sup>2</sup>, allowing them to settle on top of the pMBMEC monolayer. We used lower T-cell concentration compared to previous studies to enable automated T-cell interaction analysis. Afterward, the flow was increased to physiological levels with a flow shear stress of 1.5 dynes/cm<sup>2</sup> to study postarrest T-cell behavior on pMBMECs for 27 min (<xref ref-type="fig" rid="fig1">Figure 1A and B</xref>).</p></sec><sec id="s4-8"><title>Data acquisition</title><p>The time-lapse imaging was performed during both accumulation and physiological flow phases using phase-contrast imaging at a frame rate of 6 or 12 frames/min, subsampled to 6 frames/min and resolution of 0.629 µm/pixel with a ×10 objective. In this modality the acquired images are gray scale, and the T cells, especially after the migration across the pMBMEC monolayer, have a similar appearance to the pMBMECs, making the T-cell segmentation task very challenging (<xref ref-type="fig" rid="fig1">Figure 1C</xref>). The data was acquired in tiles of 870×650 µm<sup>2</sup> (1389×1041 pixels) with an overlap of 100 µm, leading to a total acquired image area of 3170×1220 µm<sup>2</sup>. For each experiment, the dataset consists of 30 time frames of T-cell accumulation and 162 time frames of dynamic T-cell interactions with the pMBMEC monolayer under physiological flow. The time step between sequential time frames for each tile is 10 s. The total acquired area is thus limited by the acquisition speed or by the flow chamber size.</p><p>The HBMEC dataset was acquired as previously described (<xref ref-type="bibr" rid="bib43">Soldati et al., 2023</xref>). In brief, 2 tiles were acquired with a total size of 3891×1504 pixels with pixel size 0.69 µm and frame rate 6 frames/min. The accumulation phase was 4 min, and the physiological flow phase was 5 min.</p><p>The BMDM dataset was acquired similarly to the T cell interacting with the pMBMEC datasets. In brief, 1 tile was acquired with a size of 2048×1504 or 1388×1040 pixels with pixel size 0.69 or 0.629 µm and frame rate 6 frames/min. The accumulation phase lasted 6 min, and the physiological flow phase was 25 min.</p><p>The EECM-BMEC dataset was acquired as previously described (<xref ref-type="bibr" rid="bib43">Soldati et al., 2023</xref>). In brief, 2 tiles were acquired with a total size of 3892×1504 or 2638×1048 pixels with pixel size 0.69 or 0.629 µm and frame rate 6 frames/min.</p><p>The dataset of human T cells on immobilized recombinant BBB adhesion molecules was acquired as previously described (<xref ref-type="bibr" rid="bib43">Soldati et al., 2023</xref>). In brief, 2 tiles were acquired with a total size 3891×1504 pixels with pixel size 0.69 µm and frame rate 6 frames/min. The accumulation phase was 4 min, and the physiological flow phase was 5 min. In this dataset, there is only one compartment, thus excluding any transmigration of the T cells. We, therefore, have employed the preprocessed fluorescent images instead of the cell probability map and transmigration map produced by the segmentation neural network. In this case, the centroids are defined as local maxima localized on the preprocessed fluorescent images. The fluorescent images were preprocessed first by performing Gaussian blur filtering in 2D with a standard deviation of 0.75. Next, thresholding was applied to eliminate the background noise, clipping high brightness values (color values with abundance &lt;0.3% of the threshold abundance), scaling to 0–255 8 bit, and saving in a lossless format. Finally, the 2 tiles were stitched together by matching the integrated color distribution in the X direction in the overlapping area.</p></sec><sec id="s4-9"><title>Manual analysis of T-cell migration</title><p>Manual cell analysis and tracking were performed according to the previously established procedure using ImageJ software (ImageJ software, National Institute of Health, Bethesda, MD, USA) (<xref ref-type="bibr" rid="bib35">Rudolph et al., 2016</xref>). The number of arrested T cells was thus counted at time frame 33 of the subset. The behavior of arrested T cells was defined and expressed as fractions of arrested T cells set to 100% as follows:</p><list list-type="bullet"><list-item><p>T cells that detached during the observation time (‘detached’).</p></list-item><list-item><p>T cells that migrated out of the FoV detached during the observation time (‘out of FoV’).</p></list-item><list-item><p>T cells that continuously crawled on the pMBMEC monolayer (‘crawling’).</p></list-item><list-item><p>T cells that remained in the same location (displacement less than twice the cell size) while actively interacting with the pMBMEC monolayer (‘probing’).</p></list-item><list-item><p>T cells that crossed the pMBMEC monolayer with or without prior crawling (‘crawling full transmigration’ and ‘probing full transmigration’). The event of T-cell transmigration across the pMBMECs monolayer became obvious due to the change of appearance of the transmigrated part of the T cells from phase bright (on top of the pMBMECs monolayer) to phase dark.</p></list-item><list-item><p>T cells that partially crossed the pMBMEC monolayer, then retracted the protrusions and continued to migrate above the monolayer (‘crawling uncompleted transmigration’ and ‘probing uncompleted transmigration’).</p></list-item></list></sec><sec id="s4-10"><title><sup>UFM</sup>Track performance evaluation</title><p>The inference of T-cell masks and transmigration masks was performed on a dual-CPU Intel(R) Xeon(R) CPU E5-2670 v3 @ 2.30 GHz, 256 GB RAM node equipped with 8 Graphical Processing Units (GPU) NVIDIA GeForce GTX TITAN X/GeForce GTX 1080. Frame alignment and segmentation were performed on an Intel(R) Core(TM) CPU i7-4771 @ 3.50 GHz, 32 GB RAM workstation with NVIDIA GeForce GTX TITAN GPU. Cell tracking was performed on a dual-CPU Intel(R) Xeon(R) CPU E5-2643 v2 @ 3.50 GHz, 256 GB RAM workstation.</p></sec><sec id="s4-11"><title>Performance analysis</title><p>The statistical tests are performed with the Mann-Whitney U test. Performance of the segmentation models was evaluated based on the pixel classification metrics evaluated using the scikit-learn library (<xref ref-type="bibr" rid="bib31">Pedregosa et al., 2011</xref>). Specifically, the AP is evaluated on the test set as the area under the precision-recall curve, as the weighted mean of precisions achieved at each threshold, with the change in recall from the previous threshold used as the weight. The segmentation thresholds for the cell mask and the transmigrated cell mask predictions were selected to maximize the F1 score.</p></sec></sec></body><back><sec sec-type="additional-information" id="s5"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="COI-statement" id="conf1"><p>No competing interests declared</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>Conceptualization, Data curation, Software, Formal analysis, Supervision, Funding acquisition, Validation, Investigation, Visualization, Methodology, Writing – original draft, Project administration, Writing – review and editing</p></fn><fn fn-type="con" id="con2"><p>Data curation, Investigation, Methodology, Writing – review and editing</p></fn><fn fn-type="con" id="con3"><p>Data curation, Formal analysis, Methodology, Writing – review and editing</p></fn><fn fn-type="con" id="con4"><p>Data curation, Formal analysis, Methodology, Writing – review and editing</p></fn><fn fn-type="con" id="con5"><p>Data curation</p></fn><fn fn-type="con" id="con6"><p>Formal analysis</p></fn><fn fn-type="con" id="con7"><p>Formal analysis</p></fn><fn fn-type="con" id="con8"><p>Conceptualization, Resources, Supervision, Funding acquisition, Methodology, Project administration</p></fn><fn fn-type="con" id="con9"><p>Conceptualization, Resources, Supervision, Funding acquisition, Writing – original draft, Project administration, Writing – review and editing</p></fn></fn-group><fn-group content-type="ethics-information"><title>Ethics</title><fn fn-type="other"><p>Animal procedures were approved by the Veterinary Office of the Canton Bern (permit no BE72/2015, BE77/2018, BE73/2021) and are in line with institutional and standard protocols for the care and use of laboratory animals in Switzerland.</p></fn></fn-group></sec><sec sec-type="supplementary-material" id="s6"><title>Additional files</title><supplementary-material id="mdar"><label>MDAR checklist</label><media xlink:href="elife-91150-mdarchecklist1-v1.pdf" mimetype="application" mime-subtype="pdf"/></supplementary-material></sec><sec sec-type="data-availability" id="s7"><title>Data availability</title><p>The source code for the T-cell segmentation models, data preprocessing, training, performance evaluation, and inference scripts are available on <ext-link ext-link-type="uri" xlink:href="https://github.com/neworldemancer/UFMSegm">GitHub</ext-link> (<xref ref-type="bibr" rid="bib50">Vladymyrov, 2025a</xref>). This repository also contains win64 binaries used for the watershed-based segmentation of the predicted T cell probability maps and transmigration probability maps. The source code for the under-flow T-cell tracking and migration analysis, along with the scripts used for performance evaluation of the framework, is available on <ext-link ext-link-type="uri" xlink:href="https://github.com/neworldemancer/UFMTrack">GitHub</ext-link> (<xref ref-type="bibr" rid="bib51">Vladymyrov, 2025b</xref>). The training phase-contrast data with manual annotations, the reference datasets for histogram normalization, and trained models are available on Zenodo: [<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.7489557">https://doi.org/10.5281/zenodo.7489557</ext-link>]. The datasets used for evaluation of our framework are available on Zenodo: [<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.7489972">https://doi.org/10.5281/zenodo.7489972</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.7489984">https://doi.org/10.5281/zenodo.7489984</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.7489996">https://doi.org/10.5281/zenodo.7489996</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.7490012">https://doi.org/10.5281/zenodo.7490012</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.7490020">https://doi.org/10.5281/zenodo.7490020</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.7490029">https://doi.org/10.5281/zenodo.7490029</ext-link>].</p><p>The following datasets were generated:</p><p><element-citation publication-type="data" specific-use="isSupplementedBy" id="dataset1"><person-group person-group-type="author"><name><surname>Vladymyrov</surname><given-names>M</given-names></name><name><surname>Marchetti</surname><given-names>L</given-names></name><name><surname>Aydin</surname><given-names>S</given-names></name><name><surname>Soldati</surname><given-names>S</given-names></name><name><surname>Mossu</surname><given-names>A</given-names></name><name><surname>Pal</surname><given-names>A</given-names></name><name><surname>Gueissaz</surname><given-names>L</given-names></name><name><surname>Ariga</surname><given-names>A</given-names></name><name><surname>Engelhardt</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2022">2022</year><data-title>UFMTrack T-cell segmentation models and training data</data-title><source>Zenodo</source><pub-id pub-id-type="doi">10.5281/zenodo.7489557</pub-id></element-citation></p><p><element-citation publication-type="data" specific-use="isSupplementedBy" id="dataset2"><person-group person-group-type="author"><name><surname>Vladymyrov</surname><given-names>M</given-names></name><name><surname>Marchetti</surname><given-names>L</given-names></name><name><surname>Aydin</surname><given-names>S</given-names></name><name><surname>Soldati</surname><given-names>S</given-names></name><name><surname>Mossu</surname><given-names>A</given-names></name><name><surname>Pal</surname><given-names>A</given-names></name><name><surname>Gueissaz</surname><given-names>L</given-names></name><name><surname>Ariga</surname><given-names>A</given-names></name><name><surname>Engelhardt</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2022">2022</year><data-title>UFMTrack phase contrast imaging dataset of CD4 T cell interaction with pMBMEC, part 1</data-title><source>Zenodo</source><pub-id pub-id-type="doi">10.5281/zenodo.7489972</pub-id></element-citation></p><p><element-citation publication-type="data" specific-use="isSupplementedBy" id="dataset3"><person-group person-group-type="author"><name><surname>Vladymyrov</surname><given-names>M</given-names></name><name><surname>Marchetti</surname><given-names>L</given-names></name><name><surname>Aydin</surname><given-names>S</given-names></name><name><surname>Soldati</surname><given-names>S</given-names></name><name><surname>Mossu</surname><given-names>A</given-names></name><name><surname>Pal</surname><given-names>A</given-names></name><name><surname>Gueissaz</surname><given-names>L</given-names></name><name><surname>Ariga</surname><given-names>A</given-names></name><name><surname>Engelhardt</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2022">2022</year><data-title>UFMTrack phase contrast imaging dataset of CD4 T cell interaction with pMBMEC, part 2</data-title><source>Zenodo</source><pub-id pub-id-type="doi">10.5281/zenodo.7489984</pub-id></element-citation></p><p><element-citation publication-type="data" specific-use="isSupplementedBy" id="dataset4"><person-group person-group-type="author"><name><surname>Vladymyrov</surname><given-names>M</given-names></name><name><surname>Marchetti</surname><given-names>L</given-names></name><name><surname>Aydin</surname><given-names>S</given-names></name><name><surname>Soldati</surname><given-names>S</given-names></name><name><surname>Mossu</surname><given-names>A</given-names></name><name><surname>Pal</surname><given-names>A</given-names></name><name><surname>Gueissaz</surname><given-names>L</given-names></name><name><surname>Ariga</surname><given-names>A</given-names></name><name><surname>Engelhardt</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2022">2022</year><data-title>UFMTrack phase contrast imaging dataset of CD8 T cell interaction with pMBMEC</data-title><source>Zenodo</source><pub-id pub-id-type="doi">10.5281/zenodo.7489996</pub-id></element-citation></p><p><element-citation publication-type="data" specific-use="isSupplementedBy" id="dataset5"><person-group person-group-type="author"><name><surname>Vladymyrov</surname><given-names>M</given-names></name><name><surname>Marchetti</surname><given-names>L</given-names></name><name><surname>Aydin</surname><given-names>S</given-names></name><name><surname>Soldati</surname><given-names>S</given-names></name><name><surname>Mossu</surname><given-names>A</given-names></name><name><surname>Pal</surname><given-names>A</given-names></name><name><surname>Gueissaz</surname><given-names>L</given-names></name><name><surname>Ariga</surname><given-names>A</given-names></name><name><surname>Engelhardt</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2022">2022</year><data-title>T-cell segmentation, tracking and migration analysis of the CD4 T cells with UFMTrack, part 1</data-title><source>Zenodo</source><pub-id pub-id-type="doi">10.5281/zenodo.7490012</pub-id></element-citation></p><p><element-citation publication-type="data" specific-use="isSupplementedBy" id="dataset6"><person-group person-group-type="author"><name><surname>Vladymyrov</surname><given-names>M</given-names></name><name><surname>Marchetti</surname><given-names>L</given-names></name><name><surname>Aydin</surname><given-names>S</given-names></name><name><surname>Soldati</surname><given-names>S</given-names></name><name><surname>Mossu</surname><given-names>A</given-names></name><name><surname>Pal</surname><given-names>A</given-names></name><name><surname>Gueissaz</surname><given-names>L</given-names></name><name><surname>Ariga</surname><given-names>A</given-names></name><name><surname>Engelhardt</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2022">2022</year><data-title>T-cell segmentation, tracking and migration analysis of the CD4 T cells with UFMTrack, part 2</data-title><source>Zenodo</source><pub-id pub-id-type="doi">10.5281/zenodo.7490020</pub-id></element-citation></p><p><element-citation publication-type="data" specific-use="isSupplementedBy" id="dataset7"><person-group person-group-type="author"><name><surname>Vladymyrov</surname><given-names>M</given-names></name><name><surname>Marchetti</surname><given-names>L</given-names></name><name><surname>Aydin</surname><given-names>S</given-names></name><name><surname>Soldati</surname><given-names>S</given-names></name><name><surname>Mossu</surname><given-names>A</given-names></name><name><surname>Pal</surname><given-names>A</given-names></name><name><surname>Gueissaz</surname><given-names>L</given-names></name><name><surname>Ariga</surname><given-names>A</given-names></name><name><surname>Engelhardt</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2022">2022</year><data-title>T-cell segmentation, tracking and migration analysis of the CD8 T cells with UFMTrack</data-title><source>Zenodo</source><pub-id pub-id-type="doi">10.5281/zenodo.7490029</pub-id></element-citation></p></sec><ack id="ack"><title>Acknowledgements</title><p>We thank Kristina Berve for providing BMDM datasets for analysis with the <sup>UFM</sup>Track. We owe sincere thanks to Dr. James McGrath and Danial Ahmad (Rochester University, NY, USA) for their detailed and insightful feedback on our manuscript. This work was supported by an UniBe ID Grant to MV, BE, and AA and the Microscopy Imaging Center (MIC) of the University of Bern.</p></ack><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Abadi</surname><given-names>M</given-names></name><name><surname>Barham</surname><given-names>P</given-names></name><name><surname>Chen</surname><given-names>J</given-names></name><name><surname>Chen</surname><given-names>Z</given-names></name><name><surname>Davis</surname><given-names>A</given-names></name><name><surname>Dean</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>TensorFlow: a system for large-scale machine learning</article-title><source>arXiv</source><pub-id pub-id-type="doi">10.48550/arXiv.1605.08695</pub-id></element-citation></ref><ref id="bib2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Abadier</surname><given-names>M</given-names></name><name><surname>Haghayegh Jahromi</surname><given-names>N</given-names></name><name><surname>Cardoso Alves</surname><given-names>L</given-names></name><name><surname>Boscacci</surname><given-names>R</given-names></name><name><surname>Vestweber</surname><given-names>D</given-names></name><name><surname>Barnum</surname><given-names>S</given-names></name><name><surname>Deutsch</surname><given-names>U</given-names></name><name><surname>Engelhardt</surname><given-names>B</given-names></name><name><surname>Lyck</surname><given-names>R</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Cell surface levels of endothelial ICAM-1 influence the transcellular or paracellular T-cell diapedesis across the blood-brain barrier</article-title><source>European Journal of Immunology</source><volume>45</volume><fpage>1043</fpage><lpage>1058</lpage><pub-id pub-id-type="doi">10.1002/eji.201445125</pub-id><pub-id pub-id-type="pmid">25545837</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Allan</surname><given-names>DB</given-names></name><name><surname>Caswell</surname><given-names>T</given-names></name><name><surname>Keim</surname><given-names>NC</given-names></name><name><surname>Wel</surname><given-names>CM</given-names></name><name><surname>Trackpy</surname><given-names>VRW</given-names></name></person-group><year iso-8601-date="2021">2021</year><data-title>Trackpy</data-title><version designator="0.5.0">0.5.0</version><source>GitHub</source><ext-link ext-link-type="uri" xlink:href="https://github.com/soft-matter/trackpy">https://github.com/soft-matter/trackpy</ext-link></element-citation></ref><ref id="bib4"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Archit</surname><given-names>A</given-names></name><name><surname>Nair</surname><given-names>S</given-names></name><name><surname>Khalid</surname><given-names>N</given-names></name><name><surname>Hilt</surname><given-names>P</given-names></name><name><surname>Rajashekar</surname><given-names>V</given-names></name><name><surname>Freitag</surname><given-names>M</given-names></name><name><surname>Gupta</surname><given-names>S</given-names></name><name><surname>Dengel</surname><given-names>A</given-names></name><name><surname>Ahmed</surname><given-names>S</given-names></name><name><surname>Pape</surname><given-names>C</given-names></name></person-group><year iso-8601-date="2023">2023</year><article-title>Segment anything for microscopy</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/2023.08.21.554208</pub-id></element-citation></ref><ref id="bib5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Arts</surname><given-names>JJ</given-names></name><name><surname>Mahlandt</surname><given-names>EK</given-names></name><name><surname>Grönloh</surname><given-names>ML</given-names></name><name><surname>Schimmel</surname><given-names>L</given-names></name><name><surname>Noordstra</surname><given-names>I</given-names></name><name><surname>Gordon</surname><given-names>E</given-names></name><name><surname>van Steen</surname><given-names>AC</given-names></name><name><surname>Tol</surname><given-names>S</given-names></name><name><surname>Walzog</surname><given-names>B</given-names></name><name><surname>van Rijssel</surname><given-names>J</given-names></name><name><surname>Nolte</surname><given-names>MA</given-names></name><name><surname>Postma</surname><given-names>M</given-names></name><name><surname>Khuon</surname><given-names>S</given-names></name><name><surname>Heddleston</surname><given-names>JM</given-names></name><name><surname>Wait</surname><given-names>E</given-names></name><name><surname>Chew</surname><given-names>TL</given-names></name><name><surname>Winter</surname><given-names>M</given-names></name><name><surname>Montanez</surname><given-names>E</given-names></name><name><surname>Goedhart</surname><given-names>J</given-names></name><name><surname>van Buul</surname><given-names>JD</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Endothelial junctional membrane protrusions serve as hotspots for neutrophil transmigration</article-title><source>eLife</source><volume>10</volume><elocation-id>e66074</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.66074</pub-id><pub-id pub-id-type="pmid">34431475</pub-id></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Aydin</surname><given-names>S</given-names></name><name><surname>Pareja</surname><given-names>J</given-names></name><name><surname>Schallenberg</surname><given-names>VM</given-names></name><name><surname>Klopstein</surname><given-names>A</given-names></name><name><surname>Gruber</surname><given-names>T</given-names></name><name><surname>Page</surname><given-names>N</given-names></name><name><surname>Bouillet</surname><given-names>E</given-names></name><name><surname>Blanchard</surname><given-names>N</given-names></name><name><surname>Liblau</surname><given-names>R</given-names></name><name><surname>Körbelin</surname><given-names>J</given-names></name><name><surname>Schwaninger</surname><given-names>M</given-names></name><name><surname>Johnson</surname><given-names>AJ</given-names></name><name><surname>Schenk</surname><given-names>M</given-names></name><name><surname>Deutsch</surname><given-names>U</given-names></name><name><surname>Merkler</surname><given-names>D</given-names></name><name><surname>Engelhardt</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2023">2023</year><article-title>Antigen recognition detains CD8<sup>+</sup> T cells at the blood-brain barrier and contributes to its breakdown</article-title><source>Nature Communications</source><volume>14</volume><elocation-id>3106</elocation-id><pub-id pub-id-type="doi">10.1038/s41467-023-38703-2</pub-id><pub-id pub-id-type="pmid">37253744</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bartholomäus</surname><given-names>I</given-names></name><name><surname>Kawakami</surname><given-names>N</given-names></name><name><surname>Odoardi</surname><given-names>F</given-names></name><name><surname>Schläger</surname><given-names>C</given-names></name><name><surname>Miljkovic</surname><given-names>D</given-names></name><name><surname>Ellwart</surname><given-names>JW</given-names></name><name><surname>Klinkert</surname><given-names>WEF</given-names></name><name><surname>Flügel-Koch</surname><given-names>C</given-names></name><name><surname>Issekutz</surname><given-names>TB</given-names></name><name><surname>Wekerle</surname><given-names>H</given-names></name><name><surname>Flügel</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Effector T cell interactions with meningeal vascular structures in nascent autoimmune CNS lesions</article-title><source>Nature</source><volume>462</volume><fpage>94</fpage><lpage>98</lpage><pub-id pub-id-type="doi">10.1038/nature08478</pub-id><pub-id pub-id-type="pmid">19829296</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Carion</surname><given-names>N</given-names></name><name><surname>Massa</surname><given-names>F</given-names></name><name><surname>Synnaeve</surname><given-names>G</given-names></name><name><surname>Usunier</surname><given-names>N</given-names></name><name><surname>Kirillov</surname><given-names>A</given-names></name><name><surname>Zagoruyko</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>End‐to‐End Object Detection with Transformers</article-title><conf-name>Lecture Notes in Computer Science</conf-name><pub-id pub-id-type="doi">10.1007/978-3-030-58452-8_13</pub-id></element-citation></ref><ref id="bib9"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Caron</surname><given-names>M</given-names></name><name><surname>Touvron</surname><given-names>H</given-names></name><name><surname>Misra</surname><given-names>I</given-names></name><name><surname>Jegou</surname><given-names>H</given-names></name><name><surname>Mairal</surname><given-names>J</given-names></name><name><surname>Bojanowski</surname><given-names>P</given-names></name><name><surname>Joulin</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Emerging properties in self-supervised vision transformers</article-title><conf-name>2021 IEEE/CVF International Conference on Computer Vision (ICCV)</conf-name><pub-id pub-id-type="doi">10.1109/ICCV48922.2021.00951</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Castro Dias</surname><given-names>M</given-names></name><name><surname>Odriozola Quesada</surname><given-names>A</given-names></name><name><surname>Soldati</surname><given-names>S</given-names></name><name><surname>Bösch</surname><given-names>F</given-names></name><name><surname>Gruber</surname><given-names>I</given-names></name><name><surname>Hildbrand</surname><given-names>T</given-names></name><name><surname>Sönmez</surname><given-names>D</given-names></name><name><surname>Khire</surname><given-names>T</given-names></name><name><surname>Witz</surname><given-names>G</given-names></name><name><surname>McGrath</surname><given-names>JL</given-names></name><name><surname>Piontek</surname><given-names>J</given-names></name><name><surname>Kondoh</surname><given-names>M</given-names></name><name><surname>Deutsch</surname><given-names>U</given-names></name><name><surname>Zuber</surname><given-names>B</given-names></name><name><surname>Engelhardt</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Brain endothelial tricellular junctions as novel sites for T cell diapedesis across the blood-brain barrier</article-title><source>Journal of Cell Science</source><volume>134</volume><elocation-id>jcs253880</elocation-id><pub-id pub-id-type="doi">10.1242/jcs.253880</pub-id><pub-id pub-id-type="pmid">33912914</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="web"><person-group person-group-type="author"><collab>Clockify</collab></person-group><year iso-8601-date="2022">2022</year><article-title>ClockifyTM ‐ 100% FREE time tracking software</article-title><ext-link ext-link-type="uri" xlink:href="https://clockify.me/">https://clockify.me/</ext-link><date-in-citation iso-8601-date="2022-10-23">October 23, 2022</date-in-citation></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Coisne</surname><given-names>C</given-names></name><name><surname>Lyck</surname><given-names>R</given-names></name><name><surname>Engelhardt</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Live cell imaging techniques to study T cell trafficking across the blood-brain barrier in vitro and in vivo</article-title><source>Fluids and Barriers of the CNS</source><volume>10</volume><elocation-id>e7</elocation-id><pub-id pub-id-type="doi">10.1186/2045-8118-10-7</pub-id><pub-id pub-id-type="pmid">23336847</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Engelhardt</surname><given-names>B</given-names></name><name><surname>Vajkoczy</surname><given-names>P</given-names></name><name><surname>Weller</surname><given-names>RO</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>The movers and shapers in immune privilege of the CNS</article-title><source>Nature Immunology</source><volume>18</volume><fpage>123</fpage><lpage>131</lpage><pub-id pub-id-type="doi">10.1038/ni.3666</pub-id><pub-id pub-id-type="pmid">28092374</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Engen</surname><given-names>SA</given-names></name><name><surname>Valen Rukke</surname><given-names>H</given-names></name><name><surname>Becattini</surname><given-names>S</given-names></name><name><surname>Jarrossay</surname><given-names>D</given-names></name><name><surname>Blix</surname><given-names>IJ</given-names></name><name><surname>Petersen</surname><given-names>FC</given-names></name><name><surname>Sallusto</surname><given-names>F</given-names></name><name><surname>Schenck</surname><given-names>K</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>The oral commensal Streptococcus mitis shows a mixed memory Th cell signature that is similar to and cross-reactive with Streptococcus pneumoniae</article-title><source>PLOS ONE</source><volume>9</volume><elocation-id>e104306</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0104306</pub-id><pub-id pub-id-type="pmid">25119879</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ershov</surname><given-names>D</given-names></name><name><surname>Phan</surname><given-names>MS</given-names></name><name><surname>Pylvänäinen</surname><given-names>JW</given-names></name><name><surname>Rigaud</surname><given-names>SU</given-names></name><name><surname>Le Blanc</surname><given-names>L</given-names></name><name><surname>Charles-Orszag</surname><given-names>A</given-names></name><name><surname>Conway</surname><given-names>JRW</given-names></name><name><surname>Laine</surname><given-names>RF</given-names></name><name><surname>Roy</surname><given-names>NH</given-names></name><name><surname>Bonazzi</surname><given-names>D</given-names></name><name><surname>Duménil</surname><given-names>G</given-names></name><name><surname>Jacquemet</surname><given-names>G</given-names></name><name><surname>Tinevez</surname><given-names>JY</given-names></name></person-group><year iso-8601-date="2022">2022</year><article-title>TrackMate 7: integrating state-of-the-art segmentation algorithms into tracking pipelines</article-title><source>Nature Methods</source><volume>19</volume><fpage>829</fpage><lpage>832</lpage><pub-id pub-id-type="doi">10.1038/s41592-022-01507-1</pub-id><pub-id pub-id-type="pmid">35654950</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Gonzalez</surname><given-names>RC</given-names></name><name><surname>Woods</surname><given-names>RE</given-names></name></person-group><year iso-8601-date="2008">2008</year><source>Digital Image Processing</source><publisher-loc>Upper Saddle River, N.J</publisher-loc><publisher-name>Prentice Hall</publisher-name></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Haghayegh Jahromi</surname><given-names>N</given-names></name><name><surname>Marchetti</surname><given-names>L</given-names></name><name><surname>Moalli</surname><given-names>F</given-names></name><name><surname>Duc</surname><given-names>D</given-names></name><name><surname>Basso</surname><given-names>C</given-names></name><name><surname>Tardent</surname><given-names>H</given-names></name><name><surname>Kaba</surname><given-names>E</given-names></name><name><surname>Deutsch</surname><given-names>U</given-names></name><name><surname>Pot</surname><given-names>C</given-names></name><name><surname>Sallusto</surname><given-names>F</given-names></name><name><surname>Stein</surname><given-names>JV</given-names></name><name><surname>Engelhardt</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Intercellular adhesion molecule-1 (ICAM-1) and ICAM-2 differentially contribute to peripheral activation and CNS entry of autoaggressive Th1 and Th17 cells in experimental autoimmune encephalomyelitis</article-title><source>Frontiers in Immunology</source><volume>10</volume><elocation-id>3056</elocation-id><pub-id pub-id-type="doi">10.3389/fimmu.2019.03056</pub-id><pub-id pub-id-type="pmid">31993059</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>He</surname><given-names>K</given-names></name><name><surname>Gkioxari</surname><given-names>G</given-names></name><name><surname>Dollár</surname><given-names>P</given-names></name><name><surname>Girshick</surname><given-names>R</given-names></name></person-group><year iso-8601-date="2017">2017</year><source>Mask R‐CNN</source><publisher-name>IEEE</publisher-name><pub-id pub-id-type="doi">10.1109/ICCV.2017.322</pub-id></element-citation></ref><ref id="bib19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Holme</surname><given-names>B</given-names></name><name><surname>Bjørnerud</surname><given-names>B</given-names></name><name><surname>Pedersen</surname><given-names>NM</given-names></name><name><surname>de la Ballina</surname><given-names>LR</given-names></name><name><surname>Wesche</surname><given-names>J</given-names></name><name><surname>Haugsten</surname><given-names>EM</given-names></name></person-group><year iso-8601-date="2023">2023</year><article-title>Automated tracking of cell migration in phase contrast images with CellTraxx</article-title><source>Scientific Reports</source><volume>13</volume><elocation-id>22982</elocation-id><pub-id pub-id-type="doi">10.1038/s41598-023-50227-9</pub-id><pub-id pub-id-type="pmid">38151514</pub-id></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jae Oh</surname><given-names>D</given-names></name><name><surname>Min Lee</surname><given-names>G</given-names></name><name><surname>Francis</surname><given-names>K</given-names></name><name><surname>Palsson</surname><given-names>BO</given-names></name></person-group><year iso-8601-date="1999">1999</year><article-title>Phototoxicity of the fluorescent membrane dyes PKH2 and PKH26 on the human hematopoietic KG1a progenitor cell line</article-title><source>Cytometry</source><volume>36</volume><fpage>312</fpage><lpage>318</lpage><pub-id pub-id-type="doi">10.1002/(sici)1097-0320(19990801)36:4&lt;312::aid-cyto5&gt;3.0.co;2-v</pub-id><pub-id pub-id-type="pmid">10404146</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Kingma</surname><given-names>DP</given-names></name><name><surname>Ba</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Adam: a method for stochastic optimization</article-title><conf-name>3rd International Conference on Learning Representations, ICLR 2015 - Conference Track Proceedings</conf-name></element-citation></ref><ref id="bib22"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Kraus</surname><given-names>O</given-names></name><name><surname>Kenyon-Dean</surname><given-names>K</given-names></name><name><surname>Saberian</surname><given-names>S</given-names></name><name><surname>Fallah</surname><given-names>M</given-names></name><name><surname>McLean</surname><given-names>P</given-names></name><name><surname>Leung</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2024">2024</year><article-title>Masked autoencoders for microscopy are scalable learners of cellular biology</article-title><source>arXiv</source><pub-id pub-id-type="doi">10.48550/arXiv.2404.10242</pub-id></element-citation></ref><ref id="bib23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lyck</surname><given-names>R</given-names></name><name><surname>Engelhardt</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Going against the tide--how encephalitogenic T cells breach the blood-brain barrier</article-title><source>Journal of Vascular Research</source><volume>49</volume><fpage>497</fpage><lpage>509</lpage><pub-id pub-id-type="doi">10.1159/000341232</pub-id><pub-id pub-id-type="pmid">22948545</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lyck</surname><given-names>R</given-names></name><name><surname>Nishihara</surname><given-names>H</given-names></name><name><surname>Aydin</surname><given-names>S</given-names></name><name><surname>Soldati</surname><given-names>S</given-names></name><name><surname>Engelhardt</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2023">2023</year><article-title>Modeling brain vasculature immune interactions in vitro</article-title><source>Cold Spring Harbor Perspectives in Medicine</source><volume>13</volume><elocation-id>a041185</elocation-id><pub-id pub-id-type="doi">10.1101/cshperspect.a041185</pub-id><pub-id pub-id-type="pmid">36617644</pub-id></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Marchetti</surname><given-names>L</given-names></name><name><surname>Engelhardt</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Immune cell trafficking across the blood-brain barrier in the absence and presence of neuroinflammation</article-title><source>Vascular Biology</source><volume>2</volume><fpage>H1</fpage><lpage>H18</lpage><pub-id pub-id-type="doi">10.1530/VB-19-0033</pub-id><pub-id pub-id-type="pmid">32923970</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mossu</surname><given-names>A</given-names></name><name><surname>Rosito</surname><given-names>M</given-names></name><name><surname>Khire</surname><given-names>T</given-names></name><name><surname>Li Chung</surname><given-names>H</given-names></name><name><surname>Nishihara</surname><given-names>H</given-names></name><name><surname>Gruber</surname><given-names>I</given-names></name><name><surname>Luke</surname><given-names>E</given-names></name><name><surname>Dehouck</surname><given-names>L</given-names></name><name><surname>Sallusto</surname><given-names>F</given-names></name><name><surname>Gosselet</surname><given-names>F</given-names></name><name><surname>McGrath</surname><given-names>JL</given-names></name><name><surname>Engelhardt</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>A silicon nanomembrane platform for the visualization of immune cell trafficking across the human blood-brain barrier under flow</article-title><source>Journal of Cerebral Blood Flow and Metabolism</source><volume>39</volume><fpage>395</fpage><lpage>410</lpage><pub-id pub-id-type="doi">10.1177/0271678X18820584</pub-id><pub-id pub-id-type="pmid">30565961</pub-id></element-citation></ref><ref id="bib27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nishihara</surname><given-names>H</given-names></name><name><surname>Soldati</surname><given-names>S</given-names></name><name><surname>Mossu</surname><given-names>A</given-names></name><name><surname>Rosito</surname><given-names>M</given-names></name><name><surname>Rudolph</surname><given-names>H</given-names></name><name><surname>Muller</surname><given-names>WA</given-names></name><name><surname>Latorre</surname><given-names>D</given-names></name><name><surname>Sallusto</surname><given-names>F</given-names></name><name><surname>Sospedra</surname><given-names>M</given-names></name><name><surname>Martin</surname><given-names>R</given-names></name><name><surname>Ishikawa</surname><given-names>H</given-names></name><name><surname>Tenenbaum</surname><given-names>T</given-names></name><name><surname>Schroten</surname><given-names>H</given-names></name><name><surname>Gosselet</surname><given-names>F</given-names></name><name><surname>Engelhardt</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Human CD4<sup>+</sup> T cell subsets differ in their abilities to cross endothelial and epithelial brain barriers in vitro</article-title><source>Fluids and Barriers of the CNS</source><volume>17</volume><elocation-id>3</elocation-id><pub-id pub-id-type="doi">10.1186/s12987-019-0165-2</pub-id><pub-id pub-id-type="pmid">32008573</pub-id></element-citation></ref><ref id="bib28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nishihara</surname><given-names>H</given-names></name><name><surname>Gastfriend</surname><given-names>BD</given-names></name><name><surname>Kasap</surname><given-names>P</given-names></name><name><surname>Palecek</surname><given-names>SP</given-names></name><name><surname>Shusta</surname><given-names>EV</given-names></name><name><surname>Engelhardt</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Differentiation of human pluripotent stem cells to brain microvascular endothelial cell-like cells suitable to study immune cell interactions</article-title><source>STAR Protocols</source><volume>2</volume><elocation-id>100563</elocation-id><pub-id pub-id-type="doi">10.1016/j.xpro.2021.100563</pub-id><pub-id pub-id-type="pmid">34151293</pub-id></element-citation></ref><ref id="bib29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nourshargh</surname><given-names>S</given-names></name><name><surname>Hordijk</surname><given-names>PL</given-names></name><name><surname>Sixt</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Breaching multiple barriers: leukocyte motility through venular walls and the interstitium</article-title><source>Nature Reviews. Molecular Cell Biology</source><volume>11</volume><fpage>366</fpage><lpage>378</lpage><pub-id pub-id-type="doi">10.1038/nrm2889</pub-id><pub-id pub-id-type="pmid">20414258</pub-id></element-citation></ref><ref id="bib30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nourshargh</surname><given-names>S</given-names></name><name><surname>Alon</surname><given-names>R</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Leukocyte migration into inflamed tissues</article-title><source>Immunity</source><volume>41</volume><fpage>694</fpage><lpage>707</lpage><pub-id pub-id-type="doi">10.1016/j.immuni.2014.10.008</pub-id><pub-id pub-id-type="pmid">25517612</pub-id></element-citation></ref><ref id="bib31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pedregosa</surname><given-names>F</given-names></name><name><surname>Varoquaux</surname><given-names>G</given-names></name><name><surname>Gramfort</surname><given-names>A</given-names></name><name><surname>Michel</surname><given-names>V</given-names></name><name><surname>Thirion</surname><given-names>B</given-names></name><name><surname>Grisel</surname><given-names>O</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Scikit-learn: machine learning in python</article-title><source>Journal of Machine Learning Research</source><volume>12</volume><fpage>2825</fpage><lpage>2830</lpage></element-citation></ref><ref id="bib32"><element-citation publication-type="web"><person-group person-group-type="author"><name><surname>Perron</surname><given-names>L</given-names></name><name><surname>Furnon</surname><given-names>V</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>OR‐Tools</article-title><ext-link ext-link-type="uri" xlink:href="https://developers.google.com/optimization/">https://developers.google.com/optimization/</ext-link><date-in-citation iso-8601-date="2025-03-19">March 19, 2025</date-in-citation></element-citation></ref><ref id="bib33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Purschke</surname><given-names>M</given-names></name><name><surname>Rubio</surname><given-names>N</given-names></name><name><surname>Held</surname><given-names>KD</given-names></name><name><surname>Redmond</surname><given-names>RW</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Phototoxicity of Hoechst 33342 in time-lapse fluorescence microscopy</article-title><source>Photochemical &amp; Photobiological Sciences</source><volume>9</volume><fpage>1634</fpage><lpage>1639</lpage><pub-id pub-id-type="doi">10.1039/c0pp00234h</pub-id><pub-id pub-id-type="pmid">20931137</pub-id></element-citation></ref><ref id="bib34"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Ronneberger</surname><given-names>O</given-names></name><name><surname>Fischer</surname><given-names>P</given-names></name><name><surname>Brox</surname><given-names>T</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>U‐Net: convolutional networks for biomedical image segmentation</article-title><source>arXiv</source><pub-id pub-id-type="doi">10.48550/arXiv.1505.04597</pub-id></element-citation></ref><ref id="bib35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rudolph</surname><given-names>H</given-names></name><name><surname>Klopstein</surname><given-names>A</given-names></name><name><surname>Gruber</surname><given-names>I</given-names></name><name><surname>Blatti</surname><given-names>C</given-names></name><name><surname>Lyck</surname><given-names>R</given-names></name><name><surname>Engelhardt</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Postarrest stalling rather than crawling favors CD8(+) over CD4(+) T-cell migration across the blood-brain barrier under flow in vitro</article-title><source>European Journal of Immunology</source><volume>46</volume><fpage>2187</fpage><lpage>2203</lpage><pub-id pub-id-type="doi">10.1002/eji.201546251</pub-id><pub-id pub-id-type="pmid">27338806</pub-id></element-citation></ref><ref id="bib36"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rueden</surname><given-names>CT</given-names></name><name><surname>Schindelin</surname><given-names>J</given-names></name><name><surname>Hiner</surname><given-names>MC</given-names></name><name><surname>DeZonia</surname><given-names>BE</given-names></name><name><surname>Walter</surname><given-names>AE</given-names></name><name><surname>Arena</surname><given-names>ET</given-names></name><name><surname>Eliceiri</surname><given-names>KW</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>ImageJ2: ImageJ for the next generation of scientific image data</article-title><source>BMC Bioinformatics</source><volume>18</volume><elocation-id>529</elocation-id><pub-id pub-id-type="doi">10.1186/s12859-017-1934-z</pub-id><pub-id pub-id-type="pmid">29187165</pub-id></element-citation></ref><ref id="bib37"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Saetzler</surname><given-names>RK</given-names></name><name><surname>Jallo</surname><given-names>J</given-names></name><name><surname>Lehr</surname><given-names>HA</given-names></name><name><surname>Philips</surname><given-names>CM</given-names></name><name><surname>Vasthare</surname><given-names>U</given-names></name><name><surname>Arfors</surname><given-names>KE</given-names></name><name><surname>Tuma</surname><given-names>RF</given-names></name></person-group><year iso-8601-date="1997">1997</year><article-title>Intravital fluorescence microscopy: impact of light-induced phototoxicity on adhesion of fluorescently labeled leukocytes</article-title><source>Journal of Histochemistry &amp; Cytochemistry</source><volume>45</volume><fpage>505</fpage><lpage>513</lpage><pub-id pub-id-type="doi">10.1177/002215549704500403</pub-id></element-citation></ref><ref id="bib38"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sallusto</surname><given-names>F</given-names></name><name><surname>Lenig</surname><given-names>D</given-names></name><name><surname>Mackay</surname><given-names>CR</given-names></name><name><surname>Lanzavecchia</surname><given-names>A</given-names></name></person-group><year iso-8601-date="1998">1998</year><article-title>Flexible programs of chemokine receptor expression on human polarized T helper 1 and 2 lymphocytes</article-title><source>The Journal of Experimental Medicine</source><volume>187</volume><fpage>875</fpage><lpage>883</lpage><pub-id pub-id-type="doi">10.1084/jem.187.6.875</pub-id><pub-id pub-id-type="pmid">9500790</pub-id></element-citation></ref><ref id="bib39"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Schiegg</surname><given-names>M</given-names></name><name><surname>Hanslovsky</surname><given-names>P</given-names></name><name><surname>Kausler</surname><given-names>BX</given-names></name><name><surname>Hufnagel</surname><given-names>L</given-names></name><name><surname>Hamprecht</surname><given-names>FA</given-names></name></person-group><year iso-8601-date="2013">2013</year><source>Conservation Tracking</source><publisher-name>IEEE Xplore</publisher-name><pub-id pub-id-type="doi">10.1109/ICCV.2013.364</pub-id></element-citation></ref><ref id="bib40"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Schmidt</surname><given-names>U</given-names></name><name><surname>Weigert</surname><given-names>M</given-names></name><name><surname>Broaddus</surname><given-names>C</given-names></name><name><surname>Myers</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Cell detection with star‐convex polygons</article-title><source>arXiv</source><pub-id pub-id-type="doi">10.1007/978-3-030-00934-2_30</pub-id></element-citation></ref><ref id="bib41"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shulman</surname><given-names>Z</given-names></name><name><surname>Shinder</surname><given-names>V</given-names></name><name><surname>Klein</surname><given-names>E</given-names></name><name><surname>Grabovsky</surname><given-names>V</given-names></name><name><surname>Yeger</surname><given-names>O</given-names></name><name><surname>Geron</surname><given-names>E</given-names></name><name><surname>Montresor</surname><given-names>A</given-names></name><name><surname>Bolomini-Vittori</surname><given-names>M</given-names></name><name><surname>Feigelson</surname><given-names>SW</given-names></name><name><surname>Kirchhausen</surname><given-names>T</given-names></name><name><surname>Laudanna</surname><given-names>C</given-names></name><name><surname>Shakhar</surname><given-names>G</given-names></name><name><surname>Alon</surname><given-names>R</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Lymphocyte crawling and transendothelial migration require chemokine triggering of high-affinity LFA-1 integrin</article-title><source>Immunity</source><volume>30</volume><fpage>384</fpage><lpage>396</lpage><pub-id pub-id-type="doi">10.1016/j.immuni.2008.12.020</pub-id><pub-id pub-id-type="pmid">19268609</pub-id></element-citation></ref><ref id="bib42"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Singer</surname><given-names>BA</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>The role of natalizumab in the treatment of multiple sclerosis: benefits and risks</article-title><source>Therapeutic Advances in Neurological Disorders</source><volume>10</volume><fpage>327</fpage><lpage>336</lpage><pub-id pub-id-type="doi">10.1177/1756285617716002</pub-id><pub-id pub-id-type="pmid">28861122</pub-id></element-citation></ref><ref id="bib43"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Soldati</surname><given-names>S</given-names></name><name><surname>Bär</surname><given-names>A</given-names></name><name><surname>Vladymyrov</surname><given-names>M</given-names></name><name><surname>Glavin</surname><given-names>D</given-names></name><name><surname>McGrath</surname><given-names>JL</given-names></name><name><surname>Gosselet</surname><given-names>F</given-names></name><name><surname>Nishihara</surname><given-names>H</given-names></name><name><surname>Goelz</surname><given-names>S</given-names></name><name><surname>Engelhardt</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2023">2023</year><article-title>High levels of endothelial ICAM-1 prohibit natalizumab mediated abrogation of CD4<sup>+</sup> T cell arrest on the inflamed BBB under flow in vitro</article-title><source>Journal of Neuroinflammation</source><volume>20</volume><elocation-id>123</elocation-id><pub-id pub-id-type="doi">10.1186/s12974-023-02797-8</pub-id><pub-id pub-id-type="pmid">37221552</pub-id></element-citation></ref><ref id="bib44"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Steiner</surname><given-names>O</given-names></name><name><surname>Coisne</surname><given-names>C</given-names></name><name><surname>Cecchelli</surname><given-names>R</given-names></name><name><surname>Boscacci</surname><given-names>R</given-names></name><name><surname>Deutsch</surname><given-names>U</given-names></name><name><surname>Engelhardt</surname><given-names>B</given-names></name><name><surname>Lyck</surname><given-names>R</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Differential roles for endothelial ICAM-1, ICAM-2, and VCAM-1 in shear-resistant T cell arrest, polarization, and directed crawling on blood-brain barrier endothelium</article-title><source>Journal of Immunology</source><volume>185</volume><fpage>4846</fpage><lpage>4855</lpage><pub-id pub-id-type="doi">10.4049/jimmunol.0903732</pub-id><pub-id pub-id-type="pmid">20861356</pub-id></element-citation></ref><ref id="bib45"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Steinman</surname><given-names>L</given-names></name><name><surname>Zamvil</surname><given-names>SS</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Virtues and pitfalls of EAE for the development of therapies for multiple sclerosis</article-title><source>Trends in Immunology</source><volume>26</volume><fpage>565</fpage><lpage>571</lpage><pub-id pub-id-type="doi">10.1016/j.it.2005.08.014</pub-id><pub-id pub-id-type="pmid">16153891</pub-id></element-citation></ref><ref id="bib46"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stringer</surname><given-names>C</given-names></name><name><surname>Wang</surname><given-names>T</given-names></name><name><surname>Michaelos</surname><given-names>M</given-names></name><name><surname>Pachitariu</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Cellpose: a generalist algorithm for cellular segmentation</article-title><source>Nature Methods</source><volume>18</volume><fpage>100</fpage><lpage>106</lpage><pub-id pub-id-type="doi">10.1038/s41592-020-01018-x</pub-id><pub-id pub-id-type="pmid">33318659</pub-id></element-citation></ref><ref id="bib47"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tsai</surname><given-names>HF</given-names></name><name><surname>Gajda</surname><given-names>J</given-names></name><name><surname>Sloan</surname><given-names>TFW</given-names></name><name><surname>Rares</surname><given-names>A</given-names></name><name><surname>Shen</surname><given-names>AQ</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Usiigaci: instance-aware cell tracking in stain-free phase contrast microscopy enabled by machine learning</article-title><source>SoftwareX</source><volume>9</volume><fpage>230</fpage><lpage>237</lpage><pub-id pub-id-type="doi">10.1016/j.softx.2019.02.007</pub-id></element-citation></ref><ref id="bib48"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ulicna</surname><given-names>K</given-names></name><name><surname>Vallardi</surname><given-names>G</given-names></name><name><surname>Charras</surname><given-names>G</given-names></name><name><surname>Lowe</surname><given-names>AR</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Automated deep lineage tree analysis using a bayesian single cell tracking approach</article-title><source>Frontiers in Computer Science</source><volume>3</volume><elocation-id>e559</elocation-id><pub-id pub-id-type="doi">10.3389/fcomp.2021.734559</pub-id></element-citation></ref><ref id="bib49"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vladymyrov</surname><given-names>M</given-names></name><name><surname>Haghayegh Jahromi</surname><given-names>N</given-names></name><name><surname>Kaba</surname><given-names>E</given-names></name><name><surname>Engelhardt</surname><given-names>B</given-names></name><name><surname>Ariga</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>VivoFollow 2: distortion-free multiphoton intravital imaging</article-title><source>Frontiers in Physics</source><volume>7</volume><elocation-id>eo222</elocation-id><pub-id pub-id-type="doi">10.3389/fphy.2019.00222</pub-id></element-citation></ref><ref id="bib50"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Vladymyrov</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2025">2025a</year><data-title>UFMSegm</data-title><version designator="960bbe9">960bbe9</version><source>GitHub</source><ext-link ext-link-type="uri" xlink:href="https://github.com/neworldemancer/UFMSegm">https://github.com/neworldemancer/UFMSegm</ext-link></element-citation></ref><ref id="bib51"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Vladymyrov</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2025">2025b</year><data-title>UFMTrack</data-title><version designator="e9d94c1">e9d94c1</version><source>GitHub</source><ext-link ext-link-type="uri" xlink:href="https://github.com/neworldemancer/UFMTrack">https://github.com/neworldemancer/UFMTrack</ext-link></element-citation></ref><ref id="bib52"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Wang</surname><given-names>CY</given-names></name><name><surname>Bochkovskiy</surname><given-names>A</given-names></name><name><surname>Liao</surname><given-names>HYM</given-names></name></person-group><year iso-8601-date="2022">2022</year><article-title>YOLOv7: Trainable bag-of-freebies sets new state-of-the-art for real-time object detectors</article-title><source>arXiv</source><pub-id pub-id-type="doi">10.48550/arXiv.2207.02696</pub-id></element-citation></ref><ref id="bib53"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wimmer</surname><given-names>I</given-names></name><name><surname>Tietz</surname><given-names>S</given-names></name><name><surname>Nishihara</surname><given-names>H</given-names></name><name><surname>Deutsch</surname><given-names>U</given-names></name><name><surname>Sallusto</surname><given-names>F</given-names></name><name><surname>Gosselet</surname><given-names>F</given-names></name><name><surname>Lyck</surname><given-names>R</given-names></name><name><surname>Muller</surname><given-names>WA</given-names></name><name><surname>Lassmann</surname><given-names>H</given-names></name><name><surname>Engelhardt</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>PECAM-1 stabilizes blood-brain barrier integrity and favors paracellular T-cell diapedesis across the blood-brain barrier during neuroinflammation</article-title><source>Frontiers in Immunology</source><volume>10</volume><elocation-id>711</elocation-id><pub-id pub-id-type="doi">10.3389/fimmu.2019.00711</pub-id><pub-id pub-id-type="pmid">31024547</pub-id></element-citation></ref><ref id="bib54"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Xie</surname><given-names>R</given-names></name><name><surname>Pang</surname><given-names>K</given-names></name><name><surname>Bader</surname><given-names>GD</given-names></name><name><surname>Wang</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2023">2023</year><article-title>MAESTER: masked autoencoder guided segmentation at pixel resolution for accurate, self-supervised subcellular structure recognition</article-title><conf-name>2023 IEEE/CVF Conference on Computer Vision and Pattern Recognition (CVPR)</conf-name><fpage>3292</fpage><lpage>3301</lpage><pub-id pub-id-type="doi">10.1109/CVPR52729.2023.00321</pub-id></element-citation></ref><ref id="bib55"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zielinski</surname><given-names>CE</given-names></name><name><surname>Mele</surname><given-names>F</given-names></name><name><surname>Aschenbrenner</surname><given-names>D</given-names></name><name><surname>Jarrossay</surname><given-names>D</given-names></name><name><surname>Ronchi</surname><given-names>F</given-names></name><name><surname>Gattorno</surname><given-names>M</given-names></name><name><surname>Monticelli</surname><given-names>S</given-names></name><name><surname>Lanzavecchia</surname><given-names>A</given-names></name><name><surname>Sallusto</surname><given-names>F</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Pathogen-induced human TH17 cells produce IFN-γ or IL-10 and are regulated by IL-1β</article-title><source>Nature</source><volume>484</volume><fpage>514</fpage><lpage>518</lpage><pub-id pub-id-type="doi">10.1038/nature10957</pub-id><pub-id pub-id-type="pmid">22466287</pub-id></element-citation></ref></ref-list><app-group><app id="appendix-1"><title>Appendix 1</title><sec sec-type="appendix" id="s8"><title>Segmentation models</title><sec sec-type="appendix" id="s8-1"><title>Training data</title><p>Deep neural networks achieve high performance but require a large amount of data for model training. Thus, in addition to preparing a large high-quality training dataset of annotated T cells, we employed additional learning targets and data augmentation to improve model performance. To train the models, we have manually annotated subsets from four independent experiments, combined corresponding to approximately 30 min of time-lapse acquisition of 880×660 µm<sup>2</sup>, 226 Megapixels in total. The data was split into nonadjacent training and validation datasets of 154 and 37 Megapixels correspondingly. We have annotated the masks of whole T cells (‘T-cell mask’) and the mask of the transmigrated part of the T cells (‘transmigration mask’). Annotation masks were normalized to have the values 0 and 1. Additionally, the center points of the touching and overlapping T cells were annotated, while for the rest of the T cells, the center points were obtained as the center of mass of the T-cell mask. Afterward, maps of centroids were generated where each centroid was represented by higher values in the map following a two-dimensional Gaussian function with width <inline-formula><mml:math id="inf21"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>σ</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>10</mml:mn></mml:mfrac><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, where <inline-formula><mml:math id="inf22"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> is the distance to the nearest centroid. This width was then clipped to the range <inline-formula><mml:math id="inf23"><mml:mi>σ</mml:mi><mml:mo>∈</mml:mo><mml:mfenced open="[" close="]" separators="|"><mml:mrow><mml:mn>1.5</mml:mn><mml:mo>,</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:mfenced></mml:math></inline-formula> pixels so that all centroids have a comparable scale. To prioritize the T-cell segmentation quality in the vicinity of the transmigrated part of the T cells, we created distance maps to the nearest transmigrated T-cell pixel <inline-formula><mml:math id="inf24"><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>. We then created a weight map as <inline-formula><mml:math id="inf25"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:msub><mml:mspace width="thinmathspace"/><mml:mi>e</mml:mi><mml:mi>x</mml:mi><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>. The two annotation masks, the centroids map, and the weight map (<xref ref-type="fig" rid="fig2">Figure 2</xref>) were used in the model loss function (see Training section below).</p><p>Consecutive frames of the time-lapse phase-contrast imaging datasets were aligned by a cross-correlation and global offset optimization analogous to the one described in <xref ref-type="bibr" rid="bib49">Vladymyrov et al., 2020</xref>. Additionally, we have applied histogram normalization of the phase-contrast images (<xref ref-type="bibr" rid="bib16">Gonzalez and Woods, 2008</xref>) to achieve a coherent brightness distribution across all datasets. During histogram normalization, we adjusted the brightness for all pixels such that the brightness distribution of the pMBMECs monolayer in each image matched the brightness distribution of the pMBMECs monolayer in a reference image. We have selected one dataset as a reference according to the best validation performance of trained models. Then, following common practice, we have standardized the brightness distribution according to brightness values between the 2.5th and 97.5th percentile.</p><p>During training, we performed data augmentation consisting of random rotation by arbitrary angle, brightness change (&lt;50%), contrast change (&lt;50%), and affine deformations. During rotation and deformation transformations, the image and all label masks were transformed coherently, employing bilinear interpolation for the input image, centroids, and the weight map. For the T-cell masks and the transmigration masks, the ‘nearest’ interpolation was applied. At each training iteration, a new random transformation was applied to a randomly selected crop of the training dataset, thus producing an unlimited number of possible variations.</p></sec><sec sec-type="appendix" id="s8-2"><title>Training</title><p>We trained the model in a multitask learning framework by optimizing the loss function<disp-formula id="equ1"><mml:math id="m1"><mml:mrow><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mspace width="thinmathspace"/><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>α</mml:mi><mml:mspace width="thinmathspace"/><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf26"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> is the weight map prioritizing T-cell segmentation quality in the vicinity of the transmigrated part of the T cells. Here,<disp-formula id="equ2"><mml:math id="m2"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mi mathvariant="normal">Σ</mml:mi><mml:mrow><mml:mi mathvariant="normal">b</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi mathvariant="normal">l</mml:mi><mml:mrow><mml:mi mathvariant="normal">c</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mover><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mn>1</mml:mn><mml:mrow><mml:mi mathvariant="normal">c</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mrow><mml:mover><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mspace width="thinmathspace"/><mml:msub><mml:mi mathvariant="normal">n</mml:mi><mml:mrow><mml:mi mathvariant="normal">b</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>is the mean cross-entropy for the T-cell mask predicted probability <inline-formula><mml:math id="inf27"><mml:mover accent="true"><mml:mrow><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula> given the ground truth label <inline-formula><mml:math id="inf28"><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>;<disp-formula id="equ3"><mml:math id="m3"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mi mathvariant="normal">Σ</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="normal">b</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:msub><mml:mi mathvariant="normal">l</mml:mi><mml:mrow><mml:mi mathvariant="normal">t</mml:mi><mml:mi mathvariant="normal">m</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mover><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi mathvariant="normal">l</mml:mi><mml:mrow><mml:mi mathvariant="normal">t</mml:mi><mml:mi mathvariant="normal">m</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mrow><mml:mover><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mspace width="thinmathspace"/><mml:msub><mml:mi mathvariant="normal">n</mml:mi><mml:mrow><mml:mi mathvariant="normal">b</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></disp-formula></p><p>is the mean cross-entropy for the transmigrated T-cell mask prediction probability <inline-formula><mml:math id="inf29"><mml:mover accent="true"><mml:mrow><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula> given ground truth transmigration label <inline-formula><mml:math id="inf30"><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>;<disp-formula id="equ4"><mml:math id="m4"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi mathvariant="normal">Σ</mml:mi><mml:mrow><mml:mi mathvariant="normal">b</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mrow><mml:mrow><mml:mover><mml:msub><mml:mi mathvariant="normal">h</mml:mi><mml:mrow><mml:mi mathvariant="normal">c</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mi mathvariant="normal">t</mml:mi></mml:mrow></mml:msub><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mspace width="thinmathspace"/><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></disp-formula></p><p>is the <inline-formula><mml:math id="inf31"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> distance between the predicted value on the centroids map <inline-formula><mml:math id="inf32"><mml:mover accent="true"><mml:mrow><mml:msub><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula> and corresponding label <inline-formula><mml:math id="inf33"><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>. The summation was performed over all <inline-formula><mml:math id="inf34"><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> pixels in the training batch.</p><p>Coefficients <inline-formula><mml:math id="inf35"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mn>5</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf36"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mi>w</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula>, and the characteristic distance from the nearest transmigrated T cell <inline-formula><mml:math id="inf37"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>15</mml:mn><mml:mi>μ</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> were chosen empirically to maximize the intersection-over-union (IoU) metric value in the validation.</p><p>The models were trained on image crops with the size of <inline-formula><mml:math id="inf38"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mn>256</mml:mn><mml:mo>×</mml:mo><mml:mn>256</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> pixels, using Adam optimizer (<xref ref-type="bibr" rid="bib21">Kingma and Ba, 2014</xref>) with a batch size of 2, for 40k iterations (~840 epochs). The training took 17 hr for 2D and 29 hr for the 2D+T models using a single GeForce GTX TITAN X GPU. The learning rate was set to <inline-formula><mml:math id="inf39"><mml:mn>1.5</mml:mn><mml:mo>×</mml:mo><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:math></inline-formula>. During training, the learning rate was adjusted in stages. It was ramped up starting <inline-formula><mml:math id="inf40"><mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mo>/</mml:mo><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula> of the nominal value for 1k iterations and then halved after 20k iterations, as shown in <xref ref-type="fig" rid="app1fig1">Appendix 1—figure 1</xref>. The training was stopped when the validation IoU metric reached its maximum for the T-cell mask prediction. The loss evolution along the training is shown in <xref ref-type="fig" rid="app1fig1">Appendix 1—figure 1</xref>.</p><fig id="app1fig1" position="float"><label>Appendix 1—figure 1.</label><caption><title>Training curves.</title><p>(<bold>A</bold>) Learning rate attenuation along model training. (<bold>B</bold>) Loss value evolution along model training.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-91150-app1-fig1-v1.tif"/></fig></sec><sec sec-type="appendix" id="s8-3"><title>Performance evaluation</title><p>Next, we evaluated the pixel-wise performance of the trained T-cell segmentation models for prediction of the T-cell mask and the transmigration mask on the validation dataset. We assessed the F1 score, Jaccard index, and AP, as shown in <xref ref-type="fig" rid="app1fig2">Appendix 1—figure 2</xref> and <xref ref-type="table" rid="table1">Table 1</xref> for the T-cell and transmigration masks for both the 2D vs 2D+T models. For the T-cell mask prediction, the 2D+T model outperformed the 2D model by a notable 9%. At the same time, for the transmigration mask, which is much more difficult to detect, the 2D model performance reached only 54%, which is insufficient for the reliable detection of T cells migrating across the pMBMEC monolayer. In this task, the 2D+T model outperformed the 2D model by 32% AP. We observed that the 2D+T model was sensitive to frame misalignment, leading to false positive detection of transmigrated T cells. Thus, to generate the preliminary T-cell masks used for frame alignment and histogram normalization, we employed the 2D model. Afterward, for the T-cell segmentation and transmigration detection, we employed the 2D+T model.</p><fig id="app1fig2" position="float"><label>Appendix 1—figure 2.</label><caption><title>Comparison of the 2D and 2D+T-cell segmentation models’ performance for the T-cell mask and transmigration mask prediction.</title><p>F1, Jaccard index and AP metrics are shown.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-91150-app1-fig2-v1.tif"/></fig><table-wrap id="app1table1" position="float"><label>Appendix 1—table 1.</label><caption><title>Architecture of the 2D fully convolutional model for T-cell segmentation.</title></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" valign="bottom">#</th><th align="left" valign="bottom" colspan="2">Operation</th><th align="left" valign="bottom">Kernel</th><th align="left" valign="bottom">Stride</th><th align="left" valign="bottom">DO rate</th><th align="left" valign="bottom">Output size</th><th align="left" valign="bottom">Diagram</th></tr></thead><tbody><tr><td align="char" char="." valign="bottom">1</td><td align="left" valign="bottom" colspan="2">Input</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">256 × 256 × 1</td><td align="left" valign="bottom" rowspan="27"><inline-graphic mimetype="image" mime-subtype="tif" xlink:href="elife-91150-inf001-v1.tif"/> <inline-graphic mimetype="image" mime-subtype="tif" xlink:href="elife-91150-inf002-v1.tif"/></td></tr><tr><td align="char" char="." valign="bottom">2</td><td align="left" valign="bottom" colspan="2">Conv+LReLU</td><td align="char" char="." valign="bottom">7 × 7</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">256 × 256 × 64</td></tr><tr><td align="char" char="." valign="bottom">3</td><td align="left" valign="bottom" colspan="2">Conv+BN+DO+LReLU</td><td align="char" char="." valign="bottom">3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.2</td><td align="char" char="." valign="bottom">256 × 256 ×64</td></tr><tr><td align="char" char="." valign="bottom">4</td><td align="left" valign="bottom" colspan="2">MP</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">2 × 2</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">128 × 128 × 64</td></tr><tr><td align="char" char="." valign="bottom">5</td><td align="left" valign="bottom" colspan="2">Conv+BN+DO +LReLU</td><td align="char" char="." valign="bottom">3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.2</td><td align="char" char="." valign="bottom">128 × 128 ×128</td></tr><tr><td align="char" char="." valign="bottom">6</td><td align="left" valign="bottom" colspan="2">Conv+BN+DO+LReLU</td><td align="char" char="." valign="bottom">3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.2</td><td align="char" char="." valign="bottom">128 × 128 ×128</td></tr><tr><td align="char" char="." valign="bottom">7</td><td align="left" valign="bottom" colspan="2">MP</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">2 × 2</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">64 × 64 × 128</td></tr><tr><td align="char" char="." valign="bottom">8</td><td align="left" valign="bottom" colspan="2">Conv+BN+DO +LReLU</td><td align="char" char="." valign="bottom">3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.2</td><td align="char" char="." valign="bottom">64 × 64 × 256</td></tr><tr><td align="char" char="." valign="bottom">9</td><td align="left" valign="bottom" colspan="2">Conv+BN+DO +LReLU</td><td align="char" char="." valign="bottom">3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.2</td><td align="char" char="." valign="bottom">64 × 64 × 256</td></tr><tr><td align="char" char="." valign="bottom">10</td><td align="left" valign="bottom" colspan="2">MP</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">2 × 2</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">32 × 32 × 256</td></tr><tr><td align="char" char="." valign="bottom">11</td><td align="left" valign="bottom" colspan="2">Conv+BN+DO+LReLU</td><td align="char" char="." valign="bottom">3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.2</td><td align="char" char="." valign="bottom">32 × 32 × 512</td></tr><tr><td align="char" char="." valign="bottom">12</td><td align="left" valign="bottom" colspan="2">TConv+BN+LReLU</td><td align="char" char="." valign="bottom">3 × 3</td><td align="char" char="." valign="bottom">2 × 2</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">64 × 64 × 256</td></tr><tr><td align="char" char="." valign="bottom">13</td><td align="left" valign="bottom" colspan="2">Concat(12, 9)</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">64 × 64 × 512</td></tr><tr><td align="char" char="." valign="bottom">14</td><td align="left" valign="bottom" colspan="2">Conv+BN+DO +LReLU</td><td align="char" char="." valign="bottom">3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.2</td><td align="char" char="." valign="bottom">64 × 64 × 256</td></tr><tr><td align="char" char="." valign="bottom">15</td><td align="left" valign="bottom" colspan="2">Conv+BN+DO +LReLU</td><td align="char" char="." valign="bottom">3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.2</td><td align="char" char="." valign="bottom">64 × 64 × 256</td></tr><tr><td align="char" char="." valign="bottom">16</td><td align="left" valign="bottom" colspan="2">TConv+BN+LReLU</td><td align="char" char="." valign="bottom">3 × 3</td><td align="char" char="." valign="bottom">2 × 2</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">128 × 128 ×128</td></tr><tr><td align="char" char="." valign="bottom">17</td><td align="left" valign="bottom" colspan="2">Concat(16, 6)</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">128 × 128 ×256</td></tr><tr><td align="char" char="." valign="bottom">18</td><td align="left" valign="bottom" colspan="2">Conv+BN+ DO +LReLU</td><td align="char" char="." valign="bottom">3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.2</td><td align="char" char="." valign="bottom">128 × 128 ×128</td></tr><tr><td align="char" char="." valign="bottom">19</td><td align="left" valign="bottom" colspan="2">Conv+BN+DO +LReLU</td><td align="char" char="." valign="bottom">3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.2</td><td align="char" char="." valign="bottom">128 × 128 ×128</td></tr><tr><td align="char" char="." valign="bottom">20</td><td align="left" valign="bottom" colspan="2">TConv+BN+LReLU</td><td align="char" char="." valign="bottom">3 × 3</td><td align="char" char="." valign="bottom">2×2</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">256×256 × 64</td></tr><tr><td align="char" char="." valign="bottom">21</td><td align="left" valign="bottom" colspan="2">Concat(20, 3)</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">256 × 256 ×128</td></tr><tr><td align="char" char="." valign="bottom">22</td><td align="left" valign="bottom" colspan="2">Conv+BN+DO +LReLU</td><td align="char" char="." valign="bottom">3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.2</td><td align="char" char="." valign="bottom">256 × 256 × 64</td></tr><tr><td align="char" char="." valign="bottom">23</td><td align="left" valign="bottom" colspan="2">Conv+BN+DO +LReLU</td><td align="char" char="." valign="bottom">3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.2</td><td align="char" char="." valign="bottom">256 × 256 ×64</td></tr><tr><td align="char" char="." valign="bottom">24</td><td align="left" valign="bottom">└</td><td align="left" valign="bottom">Conv +Sigmoid</td><td align="char" char="." valign="bottom">1 × 1</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">256 × 256 × 2</td></tr><tr><td align="char" char="." valign="bottom">25</td><td align="left" valign="bottom" rowspan="2">└</td><td align="left" valign="bottom">Conv+BN + DO+LReLU</td><td align="char" char="." valign="bottom">3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.1</td><td align="char" char="." valign="bottom">256 × 256 ×16</td></tr><tr><td align="char" char="." valign="bottom">26</td><td align="left" valign="bottom">Conv +SSigmoid</td><td align="char" char="." valign="bottom">3 × 3</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">256 × 256 × 1</td></tr><tr><td align="char" char="." valign="bottom">27</td><td align="left" valign="bottom" colspan="2">Concat(24, 26)</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">256 × 256 × 3</td></tr></tbody></table><table-wrap-foot><fn><p>DO – dropout, Conv – Convolution, TConv – transposed convolution, MP – max pooling, BN – batch normalization, Concat – concatenation of outputs of the specified layers, LReLU – leaky rectified linear unit with <italic>α</italic>=0.05. For the centroids prediction, we scale the output to prevent saturation: SSigmoid(x)=1.1 * Sigmoid(x) – 0.5.</p></fn></table-wrap-foot></table-wrap><table-wrap id="app1table2" position="float"><label>Appendix 1—table 2.</label><caption><title>Architecture of the 2D+T fully convolutional model for T-cell segmentation.</title></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" valign="bottom">#</th><th align="left" valign="bottom" colspan="2">Operation</th><th align="left" valign="bottom">Kernel</th><th align="left" valign="bottom">Stride</th><th align="left" valign="bottom">DO rate</th><th align="left" valign="bottom">Output size</th><th align="left" valign="bottom">Diagram</th></tr></thead><tbody><tr><td align="char" char="." valign="bottom">1</td><td align="left" valign="bottom" colspan="2">Input</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom">5 × 256 × 256 × 1</td><td align="left" valign="bottom" rowspan="37"><inline-graphic mimetype="image" mime-subtype="tif" xlink:href="elife-91150-inf003-v1.tif"/></td></tr><tr><td align="char" char="." valign="bottom">2</td><td align="left" valign="bottom" colspan="2">Conv+LReLU</td><td align="char" char="." valign="bottom">1 × 7 × 7</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom">5 × 256 × 256 × 64</td></tr><tr><td align="char" char="." valign="bottom">3</td><td align="left" valign="bottom" colspan="2">Conv+BN+DO+LReLU</td><td align="char" char="." valign="bottom">3 × 3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.2</td><td align="left" valign="bottom">5 × 256 × 256 ×128</td></tr><tr><td align="char" char="." valign="bottom">4</td><td align="left" valign="bottom">└</td><td align="left" valign="bottom">ZCrop</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"> 1 × 256 ×256 ×128</td></tr><tr><td align="char" char="." valign="bottom">5</td><td align="left" valign="bottom" rowspan="2">└</td><td align="left" valign="bottom">ZCrop</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"> 3 × 256 ×256 ×128</td></tr><tr><td align="char" char="." valign="bottom">6</td><td align="left" valign="bottom">MP</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">1 × 2 × 2</td><td align="left" valign="bottom"/><td align="left" valign="bottom">3 × 128 × 128 × 128</td></tr><tr><td align="char" char="." valign="bottom">7</td><td align="left" valign="bottom" colspan="2">Conv+BN+DO +LReLU</td><td align="char" char="." valign="bottom">1 × 3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.2</td><td align="left" valign="bottom">3 × 128 × 128 ×128</td></tr><tr><td align="char" char="." valign="bottom">8</td><td align="left" valign="bottom" colspan="2">Conv+BN+DO+LReLU</td><td align="char" char="." valign="bottom">1 × 3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.2</td><td align="left" valign="bottom">3 × 128 × 128 ×128</td></tr><tr><td align="char" char="." valign="bottom">9</td><td align="left" valign="bottom">└</td><td align="left" valign="bottom">ZCrop</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"> 1 ×128 ×128 ×128</td></tr><tr><td align="char" char="." valign="bottom">10</td><td align="left" valign="bottom">└</td><td align="left" valign="bottom">MP</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">1×2 × 2</td><td align="left" valign="bottom"/><td align="left" valign="bottom">3 × 64 × 64 × 128</td></tr><tr><td align="char" char="." valign="bottom">11</td><td align="left" valign="bottom" colspan="2">Conv+BN+DO +LReLU</td><td align="char" char="." valign="bottom">1 × 3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.2</td><td align="left" valign="bottom">3 × 64 × 64 × 256</td></tr><tr><td align="char" char="." valign="bottom">12</td><td align="left" valign="bottom" colspan="2">Conv+BN+DO+LReLU</td><td align="char" char="." valign="bottom">3 × 3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.2</td><td align="left" valign="bottom">3 × 64 × 64 × 512</td></tr><tr><td align="char" char="." valign="bottom">13</td><td align="left" valign="bottom" colspan="2">ZCrop</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"> 1 × 64 × 64 × 512</td></tr><tr><td align="char" char="." valign="bottom">14</td><td align="left" valign="bottom" colspan="2">MP</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">1 × 2× 2</td><td align="left" valign="bottom"/><td align="left" valign="bottom">1 × 32 × 32 × 512</td></tr><tr><td align="char" char="." valign="bottom">15</td><td align="left" valign="bottom" colspan="2">Conv+BN+DO +LReLU</td><td align="char" char="." valign="bottom">1 × 3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.2</td><td align="left" valign="bottom">1 × 32 × 32 × 256</td></tr><tr><td align="char" char="." valign="bottom">16</td><td align="left" valign="bottom" colspan="2">Conv+BN+DO+LReLU</td><td align="char" char="." valign="bottom">1 × 3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.2</td><td align="left" valign="bottom">1 × 32 × 32 × 256</td></tr><tr><td align="char" char="." valign="bottom">17</td><td align="left" valign="bottom" colspan="2">MP</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">1 × 2 × 2</td><td align="left" valign="bottom"/><td align="left" valign="bottom">1 × 16 ×16 × 256</td></tr><tr><td align="char" char="." valign="bottom">18</td><td align="left" valign="bottom" colspan="2">Conv+BN+DO+LReLU</td><td align="char" char="." valign="bottom">1 × 3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.2</td><td align="left" valign="bottom">1 × 16 × 16 × 512</td></tr><tr><td align="char" char="." valign="bottom">19</td><td align="left" valign="bottom" colspan="2">TConv +BN + LReLU</td><td align="char" char="." valign="bottom">1 × 3 × 3</td><td align="char" char="." valign="bottom">1 × 2 × 2</td><td align="left" valign="bottom"/><td align="left" valign="bottom">1 × 32 × 32 × 256</td></tr><tr><td align="char" char="." valign="bottom">20</td><td align="left" valign="bottom" colspan="2">Concat(19, 16)</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom">1 × 32 × 32 × 512</td></tr><tr><td align="char" char="." valign="bottom">21</td><td align="left" valign="bottom" colspan="2">Conv +BN + DO +LReLU</td><td align="char" char="." valign="bottom">1 × 3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.2</td><td align="left" valign="bottom">1 × 32 × 32 × 256</td></tr><tr><td align="char" char="." valign="bottom">22</td><td align="left" valign="bottom" colspan="2">TConv +BN + LReLU</td><td align="char" char="." valign="bottom">1 × 3 × 3</td><td align="char" char="." valign="bottom">1 × 2 × 2</td><td align="left" valign="bottom"/><td align="left" valign="bottom">1 × 64 × 64 × 128</td></tr><tr><td align="char" char="." valign="bottom">23</td><td align="left" valign="bottom" colspan="2">Concat(22, 13)</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom">1 × 64 × 64 × 256</td></tr><tr><td align="char" char="." valign="bottom">24</td><td align="left" valign="bottom" colspan="2">Conv +BN + DO +LReLU</td><td align="char" char="." valign="bottom">1 × 3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.2</td><td align="left" valign="bottom">1 × 64 × 64 ×128</td></tr><tr><td align="char" char="." valign="bottom">25</td><td align="left" valign="bottom" colspan="2">Conv +BN + DO +LReLU</td><td align="char" char="." valign="bottom">1 × 3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.2</td><td align="left" valign="bottom">1 × 64 × 64 ×128</td></tr><tr><td align="char" char="." valign="bottom">26</td><td align="left" valign="bottom" colspan="2">TConv +BN + LReLU</td><td align="char" char="." valign="bottom">1 × 3 × 3</td><td align="char" char="." valign="bottom">1 × 2 × 2</td><td align="left" valign="bottom"/><td align="left" valign="bottom">1 × 128 ×128×128</td></tr><tr><td align="char" char="." valign="bottom">27</td><td align="left" valign="bottom" colspan="2">Concat(26, 9)</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom">1 × 128 × 128 × 256</td></tr><tr><td align="char" char="." valign="bottom">28</td><td align="left" valign="bottom" colspan="2">Conv +BN + DO +LReLU</td><td align="char" char="." valign="bottom">1 × 3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.2</td><td align="left" valign="bottom">1 × 128 × 128 × 128</td></tr><tr><td align="char" char="." valign="bottom">29</td><td align="left" valign="bottom" colspan="2">Conv +BN + DO +LReLU</td><td align="char" char="." valign="bottom">1 × 3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.2</td><td align="left" valign="bottom">1 × 128 × 128 × 128</td></tr><tr><td align="char" char="." valign="bottom">30</td><td align="left" valign="bottom" colspan="2">TConv +BN + LReLU</td><td align="char" char="." valign="bottom">1 × 3 × 3</td><td align="char" char="." valign="bottom">1 × 2 × 2</td><td align="left" valign="bottom"/><td align="left" valign="bottom">1 × 256 × 256 × 64</td></tr><tr><td align="char" char="." valign="bottom">31</td><td align="left" valign="bottom" colspan="2">Concat (30, 4)</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom">1 × 256 × 256 × 192</td></tr><tr><td align="char" char="." valign="bottom">32</td><td align="left" valign="bottom" colspan="2">Conv +BN + DO +LReLU</td><td align="char" char="." valign="bottom">1 × 3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.2</td><td align="left" valign="bottom">1 × 256 × 256 × 64</td></tr><tr><td align="char" char="." valign="bottom">33</td><td align="left" valign="bottom" colspan="2">Conv +BN + DO +LReLU</td><td align="char" char="." valign="bottom">1 × 3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.2</td><td align="left" valign="bottom">1×256 × 256 × 64</td></tr><tr><td align="char" char="." valign="bottom">34</td><td align="left" valign="bottom">└</td><td align="left" valign="bottom">Conv +Sigmoid</td><td align="char" char="." valign="bottom">1 × 1 × 1</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom">1 × 256 × 256 × 2</td></tr><tr><td align="char" char="." valign="bottom">35</td><td align="left" valign="bottom" rowspan="2">└</td><td align="left" valign="bottom">Conv +BN + DO +LReLU</td><td align="char" char="." valign="bottom">1 × 3 × 3</td><td align="left" valign="bottom"/><td align="char" char="." valign="bottom">0.1</td><td align="left" valign="bottom">1 × 256 × 256 × 16</td></tr><tr><td align="char" char="." valign="bottom">36</td><td align="left" valign="bottom">Conv +SSigmoid</td><td align="char" char="." valign="bottom">1 × 3 × 3</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom">1 × 256 × 256 × 1</td></tr><tr><td align="char" char="." valign="bottom">37</td><td align="left" valign="bottom"/><td align="left" valign="bottom">Concat (34, 36)</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom">1 × 256 × 256 × 3</td></tr></tbody></table><table-wrap-foot><fn><p>DO – dropout, Conv – Convolution, TConv – transposed convolution, MP – max pooling, BN – batch normalization, Concat – concatenation of outputs of the specified layers, ZCrop – crop center along depth dimension, LReLU – leaky rectified linear unit with <inline-formula><mml:math id="inf41"><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mn>0.05</mml:mn></mml:math></inline-formula>. For the centroids prediction, we scale the output to prevent saturation: SSigmoid(x)=1.1 * Sigmoid(x) – 0.5.</p></fn></table-wrap-foot></table-wrap></sec><sec sec-type="appendix" id="s8-4"><title>Image data processing</title><p>For T-cell segmentation we followed a procedure similar to the one used for training data preprocessing. We first used the 2D model to localize T cells in individual image frames. We then dilated the predicted T-cell masks by 7 pixels, such that the bright halo on the phase-contrast images surrounding the T cells arresting and migrating on top of the pMBMEC monolayer was enclosed in the masked region.</p><p>Next, we performed image histogram normalization of the image frames based on the brightness distribution of the pMBMECs. For this we used the dilated T-cell masks obtained in the previous step. The same histogram reference dataset previously used for the model training was applied. Histogram normalization needed to be performed separately for the image frames obtained during the accumulation phase and the physiological flow phase of the assay. This is due to the overall image brightness increase after increasing the flow rate due to slight change of the sample position.</p><p>The histogram-normalized image sequence was then aligned based on the pMBMECs, using the mask imaged with the same dilated T-cell mask. Frame alignment (<xref ref-type="bibr" rid="bib49">Vladymyrov et al., 2020</xref>) was performed by 5 crops the size of 512×512 pixels each in the corners and in the middle of the frame. We first measured offsets <inline-formula><mml:math id="inf42"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>d</mml:mi><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">→</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and offset errors <inline-formula><mml:math id="inf43"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">→</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> between pairs of image frame crops <inline-formula><mml:math id="inf44"><mml:mi>c</mml:mi></mml:math></inline-formula> at timepoints <inline-formula><mml:math id="inf45"><mml:mi>i</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf46"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="normal">∀</mml:mi><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mi>i</mml:mi><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula>. Then, we employed global solving to find the absolute position <inline-formula><mml:math id="inf47"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and the respective position errors <inline-formula><mml:math id="inf48"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> for each crop <inline-formula><mml:math id="inf49"><mml:mi>c</mml:mi></mml:math></inline-formula>. Finally, we obtained the absolute positions of the entire frames by weighting the positions obtained by the crops:<disp-formula id="equ5"><mml:math id="m5"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:munder><mml:mfrac><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mfrac></mml:mrow><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:munder><mml:mfrac><mml:mn>1</mml:mn><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mfrac></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>The sequence of histogram-normalized and aligned image frames was then fed into the trained 2D+T segmentation model to obtain the T cell and transmigration probability maps, as well as the T-cell centroids. To this end we processed the image sequences in patches of 512×512×5 pixels, with an overlap of 183 pixels. The size of the receptive field of our T-cell segmentation model governed this overlap. Notably, while the models were trained on image crops of 256×256 pixels, the fully convolutional architecture allows the inference to be performed on any input size. Input size is thus limited solely by the available GPU memory.</p><p>The separate tiles of the tiled image sequence acquisition were aligned by overlapping parts of the raw image data. Predicted maps were then stitched together, where maximum predicted probability values were taken for overlapping tile regions.</p><p>To perform T-cell segmentation, we obtained T-cell masks from the T-cell probability map by applying a threshold of 0.33. Seed points were obtained from the T-cell centroid map with a threshold of 0.16. These threshold values maximized the F1 score of the T-cell mask prediction, as seen in <xref ref-type="fig" rid="app1fig2">Appendix 1—figure 2</xref>. The segmentation was then performed with a watershed algorithm based on the T-cell mask and the seed points. A stitched phase-contrast image sequence can be seen in <xref ref-type="video" rid="video1">Video 1</xref> and overlayed with the segmented cells and highlighted transmigration mask in <xref ref-type="video" rid="video2">Video 2</xref>.</p></sec></sec></app><app id="appendix-2"><title>Appendix 2</title><sec sec-type="appendix" id="s9"><title>T-cell tracking</title><sec sec-type="appendix" id="s9-1"><title>Linking T cells</title><p>As the first step, we identified all possible connections of T cells between the time frames. We constructed a graph representation of the datasets, such that graph nodes corresponded to the T cells at all time frames, and the edges in the graph corresponded to links connecting the nodes adjacent in space and time. Along the tracking procedure, we then sought to identify links connecting the same T cell over time. In cases where T cells touched each other, i.e., when several centroids were detected within the same T-cell mask or adjacent T-cell masks with distances below 10 µm (i.e. potentially over-segmented cells), we considered them as one node. At this step, we accounted for this under-segmentation by introducing the node multiplicity number <inline-formula><mml:math id="inf50"><mml:mi>m</mml:mi></mml:math></inline-formula> equal to the number of constituting components. These adjacent cells were assigned to separate tracks after the reliable track segments of isolated T cells were constructed (see Resolving global track consistency section below).</p><p>The links between T cells were searched within a radius <inline-formula><mml:math id="inf51"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>R</mml:mi><mml:mo>=</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo>⋅</mml:mo><mml:mn>15</mml:mn><mml:mspace width="thinmathspace"/><mml:mtext>µm</mml:mtext><mml:mo>+</mml:mo><mml:mn>10</mml:mn><mml:mspace width="thinmathspace"/><mml:mtext>µm</mml:mtext></mml:mrow></mml:mstyle></mml:math></inline-formula>, where time difference <italic>dt</italic> is between 1 and 3 time frames (<xref ref-type="fig" rid="fig3">Figure 3C</xref>).</p></sec><sec sec-type="appendix" id="s9-2"><title>Track segment search</title><p>This step aimed to find continuous track segments of T cells or under-segmented groups of T cells crawling on top of or below the pMBMEC monolayer without accelerated movement segments on the T-cell track characterized by rapid T-cell displacements. The whole dataset of T cells across all timepoints was represented as a graph. Each vertex corresponds either to a T cell (multiplicity <italic>m</italic>=1) or a group of potentially under-segmented T cells (<italic>m</italic>&gt;1). The vertices are connected according to links obtained at the linking step. Track segments were found by performing global optimization to find consistent connectivity of vertices across the timepoints by employing an approach inspired by the conservation tracking algorithm summarized in <xref ref-type="bibr" rid="bib39">Schiegg et al., 2013</xref>. Each vertex was represented as a set of incoming (Left, L) and outgoing (Right, R) links, and additional ‘not-connected’ (NC) left and right links (<xref ref-type="fig" rid="fig3">Figure 3C and D</xref>, <xref ref-type="fig" rid="app2fig1">Appendix 2—figure 1A</xref>, <xref ref-type="table" rid="app2table1">Appendix 2—table 1</xref>). The optimization procedure selected the links that were most likely to be connections between the same T cell in different time frames. The total number of selected links for each vertex on the left and right sides was limited to vertex multiplicity m. Optimization was performed using the CP-SAT constrained optimization procedure using the open-source OR-Tools library (<xref ref-type="bibr" rid="bib32">Perron and Furnon, 2021</xref>).</p><fig id="app2fig1" position="float"><label>Appendix 2—figure 1.</label><caption><title>Parametrization of nodes connections for tracking.</title><p>(<bold>A</bold>) Representation of nodes for track segment search. Connection multiplicity for each link is obtained with global optimization. (<bold>B</bold>) Representation of vertices and segments for global multiplicity consistency optimization. Connection multiplicity for each segment attached to a vertex is obtained with global optimization.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-91150-app2-fig1-v1.tif"/></fig><table-wrap id="app2table1" position="float"><label>Appendix 2—table 1.</label><caption><title>Node variables used in global optimization during link search.</title></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" valign="bottom">Name</th><th align="left" valign="bottom">Description</th><th align="left" valign="bottom">Type</th><th align="left" valign="bottom">Range</th></tr></thead><tbody><tr><td align="left" valign="bottom"><inline-formula><mml:math id="inf52"><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mo>/</mml:mo><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:mrow></mml:mrow></mml:msub><mml:mfenced open="[" close="]" separators="|"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced></mml:math></inline-formula></td><td align="left" valign="bottom">Multiplicity of the [<italic>i</italic>]th node connection on the left/right side</td><td align="left" valign="bottom">Int</td><td align="char" char="." valign="bottom">0–m</td></tr><tr><td align="left" valign="bottom"><inline-formula><mml:math id="inf53"><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>/</mml:mo><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:mrow></mml:mrow></mml:msub><mml:mfenced open="[" close="]" separators="|"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced></mml:math></inline-formula></td><td align="left" valign="bottom"><italic>i</italic>th connection on the left/right is selected</td><td align="left" valign="bottom">Int</td><td align="char" char="." valign="bottom">0–1</td></tr><tr><td align="left" valign="bottom"><inline-formula><mml:math id="inf54"><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>/</mml:mo><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:mrow></mml:mrow></mml:msub></mml:math></inline-formula></td><td align="left" valign="bottom">Not-connected (NC) connection on the left/right is selected</td><td align="left" valign="bottom">Int</td><td align="char" char="." valign="bottom">0–1</td></tr><tr><td align="left" valign="bottom"><inline-formula><mml:math id="inf55"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>l</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula></td><td align="left" valign="bottom">Absolute difference between right and left multiplicity sum</td><td align="left" valign="bottom">Int</td><td align="char" char="." valign="bottom">0–m</td></tr></tbody></table></table-wrap><p>We employed the following constraints for each node.</p><p>Constrain ‘not-connected’ variable:<disp-formula id="equ6"><mml:math id="m6"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>c</mml:mi><mml:mi mathvariant="normal">_</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mtable columnalign="left left" rowspacing=".2em" columnspacing="1em" displaystyle="false"><mml:mtr><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:mtext> </mml:mtext><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mspace width="thickmathspace"/><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mi>i</mml:mi><mml:mo>]</mml:mo></mml:mrow><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>1</mml:mn></mml:mtd><mml:mtd><mml:mtext> </mml:mtext><mml:mi>o</mml:mi><mml:mi>t</mml:mi><mml:mi>h</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>w</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mspace width="thickmathspace"/></mml:mtd></mml:mtr></mml:mtable><mml:mo fence="true" stretchy="true" symmetric="true"/></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>Limit total ‘multiplicity’ of node connections:<disp-formula id="equ7"><mml:math id="m7"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mn>1</mml:mn><mml:mo>≤</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>c</mml:mi><mml:mi mathvariant="normal">_</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mi>i</mml:mi><mml:mo>]</mml:mo></mml:mrow><mml:mo>≤</mml:mo><mml:mi>m</mml:mi></mml:mstyle></mml:mrow></mml:math></disp-formula></p> <p>Link the ‘selected’ flag of a connection with its multiplicity:<disp-formula id="equ8"><mml:math id="m8"><mml:mrow><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>w</mml:mi><mml:mi mathvariant="normal">_</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mi>i</mml:mi><mml:mo>]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mtable columnalign="left left" rowspacing=".2em" columnspacing="1em" displaystyle="false"><mml:mtr><mml:mtd><mml:mn>1</mml:mn></mml:mtd><mml:mtd><mml:mtext> </mml:mtext><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mspace width="thickmathspace"/><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mi>i</mml:mi><mml:mo>]</mml:mo></mml:mrow><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:mtext> </mml:mtext><mml:mi>o</mml:mi><mml:mi>t</mml:mi><mml:mi>h</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>w</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mspace width="thickmathspace"/></mml:mtd></mml:mtr></mml:mtable><mml:mo fence="true" stretchy="true" symmetric="true"/></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>And similarly for the right side.</p><p>If the node has connection candidates on both sides, then evaluate the multiplicity difference:<disp-formula id="equ9"><mml:math id="m9"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi><mml:mi mathvariant="normal">_</mml:mi><mml:mi>l</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mtable columnalign="left left" rowspacing=".2em" columnspacing="1em" displaystyle="false"><mml:mtr><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:mtext> </mml:mtext><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mspace width="thickmathspace"/><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mi>i</mml:mi><mml:mo>]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mspace width="thinmathspace"/><mml:mo>∨</mml:mo><mml:mspace width="thinmathspace"/><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mi>i</mml:mi><mml:mo>]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mi>i</mml:mi><mml:mo>]</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mi>i</mml:mi><mml:mo>]</mml:mo></mml:mrow></mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:mtd><mml:mtd><mml:mtext> </mml:mtext><mml:mi>o</mml:mi><mml:mi>t</mml:mi><mml:mi>h</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>w</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mspace width="thickmathspace"/></mml:mtd></mml:mtr></mml:mtable><mml:mo fence="true" stretchy="true" symmetric="true"/></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>On each edge between connected nodes, the multiplicity on both sides should be the same:<disp-formula id="equ10"><mml:math id="m10"><mml:mrow><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mspace width="thinmathspace"/><mml:mi>l</mml:mi><mml:mi>e</mml:mi><mml:mi>f</mml:mi><mml:mi>t</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>n</mml:mi><mml:mi>o</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>t</mml:mi><mml:mi>o</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>r</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>h</mml:mi><mml:mi>t</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>n</mml:mi><mml:mi>o</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo>]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mspace width="thinmathspace"/><mml:mi>r</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>h</mml:mi><mml:mi>t</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>n</mml:mi><mml:mi>o</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>t</mml:mi><mml:mi>o</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>l</mml:mi><mml:mi>e</mml:mi><mml:mi>f</mml:mi><mml:mi>t</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>n</mml:mi><mml:mi>o</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>Then, the loss function for each node is<disp-formula id="equ11"><mml:math id="m11"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi><mml:mi mathvariant="normal">_</mml:mi><mml:mi>l</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>⋅</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mi>r</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>⋅</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>w</mml:mi><mml:mi mathvariant="normal">_</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mi>i</mml:mi><mml:mo>]</mml:mo></mml:mrow><mml:mo>⋅</mml:mo><mml:mi>w</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mi>i</mml:mi><mml:mo>]</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>This loss has three terms. The first one penalizes differences between connection multiplicity on the left and right sides. The second penalizes solutions where the node is not connected on either side. The last term weights each selected connection to a node on the right. Here, <inline-formula><mml:math id="inf56"><mml:mi>w</mml:mi><mml:mfenced open="[" close="]" separators="|"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced></mml:math></inline-formula> is the weight of the connection to the corresponding right node. Importantly, connection weighting is independent of the connection multiplicity. This design choice was made explicitly since node multiplicity estimates available at this stage are preliminary.</p><p>To account for T-cell detection inefficiency at the edge of the FoV, the penalty for not-connected nodes <inline-formula><mml:math id="inf57"><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is attenuated close to the FoV edge. To this end the weight of a not-connected node exponentially decays when the T cell is closer than <inline-formula><mml:math id="inf58"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>20</mml:mn><mml:mspace width="thinmathspace"/><mml:mi>μ</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> to the edge:<disp-formula id="equ12"><mml:math id="m12"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mi>g</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo>⋅</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>c</mml:mi><mml:mi mathvariant="normal">_</mml:mi><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p>where<disp-formula id="equ13"><mml:math id="m13"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mi>g</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mtable columnalign="left left" rowspacing=".2em" columnspacing="1em" displaystyle="false"><mml:mtr><mml:mtd><mml:mn>1</mml:mn></mml:mtd><mml:mtd><mml:mtext> </mml:mtext><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mspace width="thickmathspace"/><mml:mi>d</mml:mi><mml:mo>&gt;</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>e</mml:mi><mml:mi>x</mml:mi><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>d</mml:mi></mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mfrac><mml:mo>)</mml:mo></mml:mrow></mml:mtd><mml:mtd><mml:mtext> </mml:mtext><mml:mi>o</mml:mi><mml:mi>t</mml:mi><mml:mi>h</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>w</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mspace width="thickmathspace"/></mml:mtd></mml:mtr></mml:mtable><mml:mo fence="true" stretchy="true" symmetric="true"/></mml:mrow></mml:mrow></mml:math></disp-formula></p><p><inline-formula><mml:math id="inf59"><mml:msub><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is chosen such that <inline-formula><mml:math id="inf60"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>c</mml:mi><mml:mi mathvariant="normal">_</mml:mi><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> if <inline-formula><mml:math id="inf61"><mml:mi>d</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf62"><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:math></inline-formula> if <inline-formula><mml:math id="inf63"><mml:mi>d</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>, where the <italic>T</italic> cell radius (half of the crawling T-cell length) <inline-formula><mml:math id="inf64"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>10</mml:mn><mml:mspace width="thinmathspace"/><mml:mtext>µm</mml:mtext></mml:mrow></mml:mstyle></mml:math></inline-formula>.</p><p>The constants <inline-formula><mml:math id="inf65"><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>3</mml:mn></mml:math></inline-formula>, <inline-formula><mml:math id="inf66"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>9</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> were chosen empirically to achieve reliable reconstruction of long tracks.</p><p>Connections between nodes <inline-formula><mml:math id="inf67"><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf68"><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> at time frames <inline-formula><mml:math id="inf69"><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf70"><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> were correspondingly considered if they are at most 3 time frames apart <inline-formula><mml:math id="inf71"><mml:mn>1</mml:mn><mml:mo>≤</mml:mo><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:mi>d</mml:mi><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>3</mml:mn></mml:math></inline-formula>, according to the output of the linking step. The connection weight <inline-formula><mml:math id="inf72"><mml:mi>w</mml:mi></mml:math></inline-formula> between these nodes was evaluated as the negative log-likelihood (NLL) of the connection between these nodes:<disp-formula id="equ14"><mml:math id="m14"><mml:mrow><mml:mi>w</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>A</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></disp-formula></p><p><inline-formula><mml:math id="inf73"><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mfenced separators="|"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>v</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math></inline-formula> is the NLL of the crawling speed (path length over time), where <inline-formula><mml:math id="inf74"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>v</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mn>12</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>⋅</mml:mo><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:math></inline-formula> is the speed estimate based on the positions <inline-formula><mml:math id="inf75"><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> of the closest of the T cells constituting nodes <inline-formula><mml:math id="inf76"><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>, <inline-formula><mml:math id="inf77"><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>. <inline-formula><mml:math id="inf78"><mml:mi>Δ</mml:mi><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn><mml:mi>s</mml:mi></mml:math></inline-formula> is the time step between consecutive time frames. <inline-formula><mml:math id="inf79"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>v</mml:mi><mml:mrow><mml:mtext>µm</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>9</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mrow><mml:mo>µ</mml:mo></mml:mrow><mml:mi mathvariant="normal">m</mml:mi></mml:mrow><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">n</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf80"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>8.5</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mrow><mml:mo>µ</mml:mo></mml:mrow><mml:mi mathvariant="normal">m</mml:mi></mml:mrow><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">n</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> are prior population mean and standard deviation of T-cell crawling speed.</p><p><inline-formula><mml:math id="inf81"><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mfenced separators="|"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>Δ</mml:mi><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>A</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math></inline-formula>, where <inline-formula><mml:math id="inf82"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi><mml:mi>A</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:munder><mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi><mml:mi>s</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mtext> </mml:mtext><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:munder></mml:mrow><mml:mspace width="thinmathspace"/><mml:mn>2</mml:mn><mml:mfrac><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf83"><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf84"><mml:msub><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula> are the areas of the detected constituting cells of nodes <inline-formula><mml:math id="inf85"><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>, <inline-formula><mml:math id="inf86"><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>. <inline-formula><mml:math id="inf87"><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>A</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0.397</mml:mn></mml:math></inline-formula> is the prior standard deviation of <inline-formula><mml:math id="inf88"><mml:mi>Δ</mml:mi><mml:mi>A</mml:mi></mml:math></inline-formula> estimated from the data.</p><p><inline-formula><mml:math id="inf89"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mo>⋅</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> penalizes connections between nonconsecutive time frames while accounting for possible T-cell detection inefficiency. The constant <inline-formula><mml:math id="inf90"><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>2.3</mml:mn></mml:math></inline-formula> was chosen empirically.</p><p>To reduce the time required for this optimization, the procedure was performed independently for each connected by link components of the dataset graph.</p></sec><sec sec-type="appendix" id="s9-3"><title>Resolving global track consistency</title><p>In this step, the scope of T-cell tracking is shifted from individual nodes (representing T cells at particular time frames and groups of under-segmented T cells) to the track segments – unambiguous sequences of nodes and vertices at the endpoints of the segments. These are track start and end points, points of merging and separation of track segments in case of under-segmentation, as well as ambiguous points on a track. The latter were identified by sudden T-cell displacement, a hallmark of detaching and reattaching T cells and T cells transitioning from properly segmented to under-segmented T cells or vice versa (<xref ref-type="fig" rid="fig3">Figure 3D and E</xref>).</p><p>First, the segments were searched as a sequence of links between nodes connected to only one node on the following time frame or nodes branching to multiple nodes and later rejoining to one node. This corresponded to over-segmentation at some points of the track or an under-segmented group of T cells shortly separating to being properly segmented before rejoining. These branching and rejoining node sequences were considered one segment at this stage. The vertices were the starting and end nodes of the segments, including the branching points between the segments. This significantly simplified the graph representation of the T-cell tracks. Next, the segments were split according to additional criteria, such as large displacements caused by T-cell detachment or intersection with another T cell. Empirically we have chosen the displacement threshold for splitting a segment to be <inline-formula><mml:math id="inf91"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>d</mml:mi><mml:mo>&gt;</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>h</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mn>0.5</mml:mn><mml:mspace width="thinmathspace"/><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, where <inline-formula><mml:math id="inf92"><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>, <inline-formula><mml:math id="inf93"><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> are, respectively, the mean and standard deviation of T-cell displacements between consecutive time frames along the given segment. The node with the larger area was assigned as the new vertex. With each segment we associated the segment multiplicity <inline-formula><mml:math id="inf94"><mml:mi>M</mml:mi></mml:math></inline-formula>. Intuitively, this corresponds to the conservation of T-cell number along a track segment. At first, it was estimated as <inline-formula><mml:math id="inf95"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mi>M</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mi>i</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi></mml:mrow><mml:mi>t</mml:mi></mml:munder><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="normal">Σ</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mi>m</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> median multiplicity of constituting nodes along the track (<xref ref-type="fig" rid="fig3">Figure 3D</xref>).</p><p>Next, we searched for potential missing track segments due to accelerated T-cell movement under flow and missing links in the track crossing points. Both are characterized by considerable displacement length such that they were not detected during the linking step. Thus, we will refer to both as ‘jumps’ in this section. The two categories differ in the distribution of displacement length and direction. To perform this search, the likelihood <inline-formula><mml:math id="inf96"><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> of the potential segments between vertices according to the average T-cell ‘jump’ length and direction for displacement caused by flow and T-cell mask fusion due to under-segmentation was evaluated. In the case of jumps caused by under-segmentation, the square root of the displacement is approximately normally distributed. Thus, the NLL of a potential segment was estimated as<disp-formula id="equ15"><mml:math id="m15"><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>j</mml:mi><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:mfrac><mml:mrow><mml:msqrt><mml:mi>d</mml:mi></mml:msqrt><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>,</mml:mo></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf97"><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> are, respectively, the mean and standard deviation of the distributions of the square root of the displacement <inline-formula><mml:math id="inf98"><mml:msqrt><mml:mi>d</mml:mi></mml:msqrt></mml:math></inline-formula> and<disp-formula id="equ16"><mml:math id="m16"><mml:mrow><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mtable columnalign="left left" rowspacing=".2em" columnspacing="1em" displaystyle="false"><mml:mtr><mml:mtd><mml:mn>1</mml:mn></mml:mtd><mml:mtd><mml:mtext> </mml:mtext><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mspace width="thickmathspace"/><mml:msqrt><mml:mi>d</mml:mi></mml:msqrt><mml:mo>&lt;</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>2</mml:mn></mml:mtd><mml:mtd><mml:mtext> </mml:mtext><mml:mi>o</mml:mi><mml:mi>t</mml:mi><mml:mi>h</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>w</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mspace width="thickmathspace"/></mml:mtd></mml:mtr></mml:mtable><mml:mo fence="true" stretchy="true" symmetric="true"/></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>(see <xref ref-type="fig" rid="app2fig2 app2fig2">Appendix 2—figures 2A</xref>). The time duration of this potential segmentation-caused jump segment is also penalized, leading to the total NLL:<disp-formula id="equ17"><mml:math id="m17"><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msqrt><mml:mn>2</mml:mn></mml:msqrt></mml:mrow></mml:mfrac><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>j</mml:mi><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mfenced separators="|"><mml:mrow><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfenced><mml:mo>)</mml:mo><mml:mo>,</mml:mo></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf99"><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:math></inline-formula> is segment duration in time frames and <inline-formula><mml:math id="inf100"><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:math></inline-formula>.</p><p>For the T-cell jumps caused by flow, we empirically estimated (see <xref ref-type="fig" rid="app2fig2">Appendix 2—figure 2B–D</xref>) the shape of the displacement likelihood and parametrized it in the following way:<disp-formula id="equ18"><mml:math id="m18"><mml:mrow><mml:mtable columnalign="left left" rowspacing="4pt" columnspacing="1em"><mml:mtr><mml:mtd><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>f</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>j</mml:mi><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mtable columnalign="left left" rowspacing=".2em" columnspacing="1em" displaystyle="false"><mml:mtr><mml:mtd><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>f</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mi>f</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mfrac><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>f</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msqrt><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:msqrt><mml:mfrac><mml:mrow><mml:mrow><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">c</mml:mi><mml:mi mathvariant="normal">t</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>|</mml:mo><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:mfrac><mml:mo>|</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mi>π</mml:mi></mml:mfrac></mml:mtd><mml:mtd><mml:mtext> </mml:mtext><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mspace width="thickmathspace"/><mml:mi>d</mml:mi><mml:mi>x</mml:mi><mml:mo>&lt;</mml:mo><mml:mn>0</mml:mn><mml:mspace width="thickmathspace"/><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi><mml:mspace width="thickmathspace"/><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mi>d</mml:mi><mml:mi>y</mml:mi></mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mo>&lt;</mml:mo><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mi>d</mml:mi><mml:mi>x</mml:mi></mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>100</mml:mn></mml:mtd><mml:mtd><mml:mtext> </mml:mtext><mml:mi>o</mml:mi><mml:mi>t</mml:mi><mml:mi>h</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>w</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mspace width="thickmathspace"/></mml:mtd></mml:mtr></mml:mtable><mml:mo fence="true" stretchy="true" symmetric="true"/></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf101"><mml:mi>d</mml:mi></mml:math></inline-formula> is the displacement in time <inline-formula><mml:math id="inf102"><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:math></inline-formula>, <inline-formula><mml:math id="inf103"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>f</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>25</mml:mn><mml:mspace width="thinmathspace"/><mml:mi>μ</mml:mi><mml:mi>m</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mi>f</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>12.9</mml:mn><mml:mspace width="thinmathspace"/><mml:mi>μ</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, and <inline-formula><mml:math id="inf104"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>f</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>36</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula>.<disp-formula id="equ19"><mml:math id="m19"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>f</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:msqrt><mml:mn>2</mml:mn></mml:msqrt></mml:mfrac><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>f</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>j</mml:mi><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>f</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mspace width="thinmathspace"/><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf105"><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:math></inline-formula> is segment duration in time frames and <inline-formula><mml:math id="inf106"><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>3</mml:mn><mml:mo>.</mml:mo></mml:math></inline-formula></p><fig id="app2fig2" position="float"><label>Appendix 2—figure 2.</label><caption><title>Under-flow tracking parametrization.</title><p>(<bold>A</bold>) Negative log‐likelihood <inline-formula><mml:math id="inf107"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>j</mml:mi><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> of the potential T-cell jump segments due to under‐segmentation. (<bold>B–D</bold>) Negative log‐likelihood <inline-formula><mml:math id="inf108"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>f</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>j</mml:mi><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> of the potential T-cell jump segments due to the flow. (<bold>B</bold>) <italic>dt</italic>=1, (<bold>C</bold>) <italic>dt</italic>=2, (<bold>D</bold>) <italic>dt</italic>=3. (<bold>E</bold>) Attenuation of the vertex ‘not‐connected’ weight with time allows accounting for the T‐cell accumulation phase at time frames 5–30 and increase of the flow to physiological level at time frame 30. The blue curve shows an attenuation factor on the left side, i.e., corresponding to track start, and the orange curve shows an attenuation factor on the right side corresponding to the end of the track due to cell detachment under the flow.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-91150-app2-fig2-v1.tif"/></fig><p>Since potential segments only with NLL below the not-connected NLL <inline-formula><mml:math id="inf109"><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> can be selected by the optimization procedure, the segments with NLL above <inline-formula><mml:math id="inf110"><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> were discarded. The remaining potential segments of the types ‘segmentation jump’ and ‘flow jump’ were appended to the graph (<xref ref-type="fig" rid="fig3">Figure 3E</xref>, <xref ref-type="fig" rid="app2fig1">Appendix 2—figure 1B</xref>).</p><p>Next, we found the optimal multiplicity on each segment <inline-formula><mml:math id="inf111"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and potential segment <inline-formula><mml:math id="inf112"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>. We identified T-cell jumps along the track as the potential segments where the multiplicity <inline-formula><mml:math id="inf113"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> was found to be nonzero. To this end we performed optimization under the constraint of global multiplicity consistency analogous to the one described above for the track segment search. Optimization was performed on each subgraph connected by segments independently. Here, we demanded the same multiplicity on both ends of the segment <inline-formula><mml:math id="inf114"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>r</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>, consistent with corresponding multiplicity on the connected vertex <inline-formula><mml:math id="inf115"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mi>g</mml:mi><mml:mfenced open="[" close="]" separators="|"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi><mml:mfenced open="[" close="]" separators="|"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mi>t</mml:mi><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>, and same multiplicity on both sides of the vertex,<disp-formula id="equ20"><mml:math id="m20"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi><mml:mi mathvariant="normal">_</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>c</mml:mi><mml:mi mathvariant="normal">_</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>l</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mi>i</mml:mi><mml:mo>]</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>l</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mi>i</mml:mi><mml:mo>]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi><mml:mi mathvariant="normal">_</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>c</mml:mi><mml:mi mathvariant="normal">_</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>r</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mi>i</mml:mi><mml:mo>]</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>r</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mi>i</mml:mi><mml:mo>]</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf116"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is the multiplicities in case the vertex is a track endpoint, <inline-formula><mml:math id="inf117"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is the resolved missing multiplicity at the vertex, and <inline-formula><mml:math id="inf118"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mfenced open="[" close="]" separators="|"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mfenced open="[" close="]" separators="|"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced></mml:math></inline-formula> are the multiplicities of the segments and potential segments correspondingly that are attached to the vertex on left and right sides. Left and right endpoint multiplicity <inline-formula><mml:math id="inf119"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>/</mml:mo><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:mrow></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:math></inline-formula> if any segment is connected on the corresponding side. We constrained <inline-formula><mml:math id="inf120"><mml:msub><mml:mrow><mml:mn>0</mml:mn><mml:mo>≤</mml:mo><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>, <inline-formula><mml:math id="inf121"><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mfenced open="[" close="]" separators="|"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced><mml:mo>≤</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>, and <inline-formula><mml:math id="inf122"><mml:msub><mml:mrow><mml:mn>0</mml:mn><mml:mo>≤</mml:mo><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mfenced open="[" close="]" separators="|"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced><mml:mo>≤</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> where <inline-formula><mml:math id="inf123"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>5</mml:mn></mml:math></inline-formula>. We did not consider intersections of more than 5 T cells, as those could not be reliably identified on the opposite ends of the intersections by their motility parameters (see the Intersection resolving section), and in our experiments we found this value to be sufficient.</p><p>Optimization was subjected to minimizing the loss function in each node:<disp-formula id="equ21"><mml:math id="m21"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>L</mml:mi><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mi>r</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>⋅</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mi>r</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>⋅</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>M</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mi>i</mml:mi><mml:mo>]</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mi>i</mml:mi><mml:mo>]</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>⋅</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mi>i</mml:mi><mml:mo>]</mml:mo></mml:mrow><mml:mo>⋅</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mi>i</mml:mi><mml:mo>]</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>Here, we distinguished missing multiplicity on a vertex <inline-formula><mml:math id="inf124"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>≠</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula>, corresponding to T cells detaching in a group of under-segmented T cells when some of the T-cell tracks continued further from the endpoint of the track, where <inline-formula><mml:math id="inf125"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>≠</mml:mo><mml:mn>0</mml:mn></mml:math></inline-formula>. The first term of the loss function penalized higher multiplicity at the endpoints of the track, encouraging solutions with T-cell tracks being properly segmented in the endpoints. Here, <inline-formula><mml:math id="inf126"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> is the multiplicity at the corresponding endpoint, and the <inline-formula><mml:math id="inf127"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>6.</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula></p><p>Putting additional weight on the missing multiplicity on a vertex in the middle of the graph but not on the first node of a track as opposed to all nodes at non-first time frames of the dataset allowed us to account for flow causing T-cell tracks to start and end at any time frame due to T-cell attachment during the accumulation phase and detachment of T cells carried away by the flow. Thus, the second term penalizes the missing multiplicity on either side of the vertex with the coefficient <inline-formula><mml:math id="inf128"><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>: <inline-formula><mml:math id="inf129"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mi>g</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mspace width="thickmathspace"/><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mspace width="thickmathspace"/><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:msub><mml:mi>c</mml:mi><mml:mi mathvariant="normal">_</mml:mi></mml:msub><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula></p><p>where <inline-formula><mml:math id="inf130"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:msub><mml:mi>c</mml:mi><mml:mi mathvariant="normal">_</mml:mi></mml:msub><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>9</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf131"><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>e</mml:mi><mml:mi>d</mml:mi><mml:mi>g</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> corresponds to the attenuation close to the edges of the FoV as described above. We considered the T-cell accumulation phase under low flow by attenuating the weight of track start and end <inline-formula><mml:math id="inf132"><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> with time (<xref ref-type="fig" rid="app2fig2">Appendix 2—figure 2</xref>):<disp-formula id="equ22"><mml:math id="m22"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mo>,</mml:mo><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mtable columnalign="left left" rowspacing=".2em" columnspacing="1em" displaystyle="false"><mml:mtr><mml:mtd><mml:mfrac><mml:mn>1</mml:mn><mml:mn>9</mml:mn></mml:mfrac></mml:mtd><mml:mtd><mml:mtext> </mml:mtext><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mspace width="thickmathspace"/><mml:mi>t</mml:mi><mml:mo>&lt;</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>c</mml:mi><mml:mo>.</mml:mo><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mfrac><mml:mn>1</mml:mn><mml:mn>9</mml:mn></mml:mfrac><mml:mo>+</mml:mo><mml:mfrac><mml:mn>8</mml:mn><mml:mn>9</mml:mn></mml:mfrac><mml:mfrac><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>c</mml:mi><mml:mo>.</mml:mo><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>c</mml:mi><mml:mo>.</mml:mo><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mn>5</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>c</mml:mi><mml:mo>.</mml:mo><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mtd><mml:mtd><mml:mtext> </mml:mtext><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mspace width="thickmathspace"/><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>c</mml:mi><mml:mo>.</mml:mo><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:mi>t</mml:mi><mml:mo>&lt;</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>c</mml:mi><mml:mo>.</mml:mo><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mn>5</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>1</mml:mn></mml:mtd><mml:mtd><mml:mtext> </mml:mtext><mml:mi>o</mml:mi><mml:mi>t</mml:mi><mml:mi>h</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>w</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mspace width="thickmathspace"/></mml:mtd></mml:mtr></mml:mtable><mml:mo fence="true" stretchy="true" symmetric="true"/></mml:mrow></mml:mrow></mml:math></disp-formula><disp-formula id="equ23"><mml:math id="m23"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mo>,</mml:mo><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mtable columnalign="left left" rowspacing=".2em" columnspacing="1em" displaystyle="false"><mml:mtr><mml:mtd><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac></mml:mtd><mml:mtd><mml:mtext> </mml:mtext><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mspace width="thickmathspace"/><mml:mi>t</mml:mi><mml:mo>&lt;</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>c</mml:mi><mml:mo>.</mml:mo><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mfrac><mml:mn>2</mml:mn><mml:mn>9</mml:mn></mml:mfrac></mml:mtd><mml:mtd><mml:mtext> </mml:mtext><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mspace width="thickmathspace"/><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>c</mml:mi><mml:mo>.</mml:mo><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:mi>t</mml:mi><mml:mo>&lt;</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>c</mml:mi><mml:mo>.</mml:mo><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mn>5</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>1</mml:mn></mml:mtd><mml:mtd><mml:mtext> </mml:mtext><mml:mi>o</mml:mi><mml:mi>t</mml:mi><mml:mi>h</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>w</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mspace width="thickmathspace"/></mml:mtd></mml:mtr></mml:mtable><mml:mo fence="true" stretchy="true" symmetric="true"/></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>This corresponded to a higher probability for track to start or end (T cell attaching/detaching from the pMBMECs monolayer) during the accumulation phase, as well as a high probability for the track to end during the 5 frames after the flow was increased to the physiological level.</p><p>The third term of the loss function encouraged minimal adjustments to the multiplicity estimates by penalizing the difference between the initial multiplicity estimate on T-cell track segments and the final solution with <inline-formula><mml:math id="inf133"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula>.</p><p>The last term accounted for the potential segments. <inline-formula><mml:math id="inf134"><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mfenced open="[" close="]" separators="|"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:math></inline-formula>, if the multiplicity <inline-formula><mml:math id="inf135"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> on the corresponding potential segment was found to be above zero, and <inline-formula><mml:math id="inf136"><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mfenced open="[" close="]" separators="|"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:math></inline-formula> when the multiplicity was zero. <inline-formula><mml:math id="inf137"><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mfenced open="[" close="]" separators="|"><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:mfenced></mml:math></inline-formula> is the NLL of the potential segment, i.e., either <inline-formula><mml:math id="inf138"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>f</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> or <inline-formula><mml:math id="inf139"><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> for the flow- or segmentation-caused jump segments correspondingly. All the coefficients were chosen empirically to optimize the detection of T-cell jumps.</p><p>Finally, we eliminated short and thus unreliable segments, as well as segments for which the multiplicity was found to be <inline-formula><mml:math id="inf140"><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:math></inline-formula> (<xref ref-type="fig" rid="fig3">Figure 3F</xref>). To this end, we iteratively removed vertices, which were not connected on one side and connected to a branching vertex of the graph on the other side by a segment with less than 6 nodes, as well as the connecting segment, and repeated the global multiplicity optimization until reaching convergence. To reduce the wall time required for the optimization, it was again performed independently for each connected component of the dataset graph.</p><p>Afterward, we separated the segments into two categories, namely segments with multiplicity <inline-formula><mml:math id="inf141"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula>, i.e., tracks of isolated T cells, and segments with multiplicity <inline-formula><mml:math id="inf142"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>M</mml:mi><mml:mo>&gt;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula>, i.e., tracks of under-segmented groups of T cells, where tracks of several T cells intersected (<xref ref-type="fig" rid="fig3">Figure 3G</xref>).</p><p>In the end, we extended the tracks of isolated T cells into the intersection if the branching vertex had a multiplicity of <inline-formula><mml:math id="inf143"><mml:mi>n</mml:mi></mml:math></inline-formula> and was splitting in exactly <inline-formula><mml:math id="inf144"><mml:mi>n</mml:mi></mml:math></inline-formula> segments with multiplicity <inline-formula><mml:math id="inf145"><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:math></inline-formula> (<xref ref-type="fig" rid="fig3">Figure 3G</xref>). Specifically, we performed the segment extension if there was an unambiguous assignment of cells constituting the branching vertex to the segments connected to the vertex, i.e., that the weight <inline-formula><mml:math id="inf146"><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> of assigning <italic>i</italic>th cell belonging to the vertex to <italic>j-</italic>th segment connected to the vertex satisfies simultaneously <inline-formula><mml:math id="inf147"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:munder><mml:mrow><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mi>g</mml:mi><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:munder><mml:mspace width="thickmathspace"/><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mspace width="thinmathspace"/><mml:mo>=</mml:mo><mml:mspace width="thinmathspace"/><mml:msub><mml:mi>j</mml:mi><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf148"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:munder><mml:mrow><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mi>g</mml:mi><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow><mml:mi>i</mml:mi></mml:munder><mml:mspace width="thickmathspace"/><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mspace width="thinmathspace"/><mml:mo>=</mml:mo><mml:mspace width="thinmathspace"/><mml:msub><mml:mi>i</mml:mi><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>. To this end, we evaluated the standard deviation <inline-formula><mml:math id="inf149"><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> of the distance from the T cell along the <italic>j-</italic>th segment to the line obtained by linear extrapolation of the cell coordinated at the nearest 6 time frames. We then obtained the expected T-cell position <inline-formula><mml:math id="inf150"><mml:mover accent="true"><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula> by linear extrapolation of the <italic>j-</italic>th segment to the time frame <inline-formula><mml:math id="inf151"><mml:mi>t</mml:mi></mml:math></inline-formula> of the vertex using the nearest 6 time frames of the segment. The assignment weight was evaluated as the NLL:<disp-formula id="equ24"><mml:math id="m24"><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mfenced></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>,</mml:mo></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf152"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>d</mml:mi><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mrow><mml:mover><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> is the distance between position <inline-formula><mml:math id="inf153"><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> of the <italic>i</italic>th cell belonging to the vertex at time frame <inline-formula><mml:math id="inf154"><mml:mi>t</mml:mi></mml:math></inline-formula> and the expected cell position <inline-formula><mml:math id="inf155"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mover><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>.</p></sec><sec sec-type="appendix" id="s9-4"><title>Intersection resolving</title><p>The last step required to obtain reliable T-cell tracks is resolving track intersections, i.e., identifying track segments corresponding to the same T cell before and after the under-segmented track region (<xref ref-type="fig" rid="fig3">Figure 3H</xref>). Even though T-cell motility parameters were found to be quite similar within the population investigated, evaluating them on longer segments allowed us to identify the correspondence between segments of the same T-cell track.</p><p>To this end, we evaluated the NLL of potential assignments of track segments according to the distance between their closest points and mean T-cell crawling speed (cell track path length over time), migration speed (cell displacement over time), directionality, cell ellipticity, and cell area. We estimated these parameters employing the Bayesian estimator with prior expected values evaluated on tracks of isolated T cells obtained after resolving the global track consistency. We then used F-statistic to assess the connection probability and to obtain the corresponding NLL. We then employed the linear assignment problem (LAP) approach to identify the optimal segment assignments across the track intersections. To ensure that reliable connections were made, instead of relying on the assignment with the first solution for all tracks, we instead connected only the segments with the <inline-formula><mml:math id="inf156"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mi>N</mml:mi><mml:mi>L</mml:mi><mml:mi>L</mml:mi><mml:mo>&lt;</mml:mo><mml:mi>N</mml:mi><mml:mi>L</mml:mi><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> progressively increasing <inline-formula><mml:math id="inf157"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mi>N</mml:mi><mml:mi>L</mml:mi><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> in <inline-formula><mml:math id="inf158"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>3</mml:mn><mml:mo>,</mml:mo><mml:mn>6</mml:mn><mml:mo>,</mml:mo><mml:mn>9</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">∞</mml:mi></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> and repeating the parameter estimation for the remaining unresolved track segments and the LAP solving. This ensured that the T-cell motility parameters used for segment matching were estimated on the longer, already connected T-cell track segments.</p><p>This workflow allowed us to determine fully resolved T-cell tracks, with either assigned T-cell position or identified locations of rapid T-cell displacement, cell under-segmentation time span, and missing time frames due to potential T-cell detection inefficiency (<xref ref-type="fig" rid="fig3">Figure 3H</xref>).</p></sec></sec><sec sec-type="appendix" id="s10"><title>T-cell migration analysis</title><p>Next, we performed the T-cell migration analysis based on the reconstructed T-cell tracks. We selected tracks inside the fiducial area of the FoV, namely coordinates of the T cell at all timepoints along the track were located at least 25 µm away from the bounding box enclosing all segmented T cells. Next, tracks of T cells touching another T cell at the end of the assay acquisition were excluded since T cells directly adjacent to each other can hide the start of T-cell transmigration across the pMBMEC monolayer and thus compromise correct detection and quantification of this step. Additionally, only tracks with T cells assigned in at least 6 time frames during the physiological flow phase. We also require T cells to be assigned for at least 75% of time frames along the track. Under-segmented parts of T-cell tracks were not considered. Examples of selected tracks can be seen in <xref ref-type="video" rid="video3">Video 3</xref>.</p><p>First, we counted the number of neighboring tracks, i.e., T cells approaching another T cell closer than 24 µm (1.2 of a crawling T-cell length).</p><p>T-cell transmigration across the pMBMEC monolayer was detected based on the inferred T-cell transmigration coefficient <inline-formula><mml:math id="inf159"><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>. To reduce the noise, we obtained filtered time series of transmigration coefficients <inline-formula><mml:math id="inf160"><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> by applying a Gaussian filter with <inline-formula><mml:math id="inf161"><mml:mi>σ</mml:mi><mml:mo>=</mml:mo><mml:mn>2.5</mml:mn></mml:math></inline-formula> time frames to the <inline-formula><mml:math id="inf162"><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> time series. We defined the T cell to the preliminary categories ‘full transmigration’ and category ‘partial transmigration’ with <inline-formula><mml:math id="inf163"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:mn>0.75</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf164"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:mspace width="thinmathspace"/><mml:mn>0.3</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> respectively. The ‘full transmigration’ and ‘partial transmigration’ Boolean masks were constructed according to the evolution of these two categories along the track (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1</xref>). To further reduce the noise, we also closed short gaps (sequence of false values) in the transmigration masks with length 2 and 3 time frames for the ‘partial’ and ‘full’ transmigration respectively. Then, we removed short sequences of true values in the masks of 4 and 3 time frames correspondingly.</p><p>Based on these preliminary masks, we detected the additional categories of uncompleted transmigration, direct transmigration, and reverse transmigration categories (<xref ref-type="fig" rid="fig1">Figure 1D</xref>). During uncompleted transmigration, the T cell starts the transmigration process and later on retracts the protrusions to continue crawling above the pMBMEC monolayer. Direct transmigration covers the period during which the T cell transmigrates below the pMBMEC monolayer. In contrast, during reverse transmigration, the T cell previously located below the pMBMEC monolayer reversely migrates back to the luminal side of the pMBMEC monolayer (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1</xref>). The start, duration, and number of transmigration attempts were evaluated for each transmigration category.</p><p>We employed an additional classifier to discriminate a migrating T cell from cellular debris or particles (=not-a-T-cell) to reject the cellular debris misclassified as T cells during the segmentation step. This classification was performed based on the measured mean and median T cell areas along the T-cell tracks after the flow was increased to physiological levels. Specifically, we trained a logistic regression model using the scikit-learn package (<xref ref-type="bibr" rid="bib31">Pedregosa et al., 2011</xref>). The model was trained on 105 manually annotated T cells by an experimenter and subsequently validated on 27 additional T cells. We have achieved validation accuracy of 96%. The tracks classified as ‘not-a-T-cell’ were discarded from the downstream analysis.</p><p>Due to occasional over-segmentation of the T cell during the transmigration process, a T cell could be misclassified as detaching instead of as transmigrated. To address this, we have trained a linear classifier to differentiate a detached T cell from a transmigrated T cell. In this case, the classification was performed based on the following parameters: mean <inline-formula><mml:math id="inf165"><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula></p><p>and median <inline-formula><mml:math id="inf166"><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> T-cell area along the part of the T-cell track during the physiological flow phase, <inline-formula><mml:math id="inf167"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mspace width="thinmathspace"/><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mfrac></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf168"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mspace width="thinmathspace"/><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mfrac></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf169"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mspace width="thinmathspace"/><mml:mn>5</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mfrac></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="inf170"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mfrac><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mspace width="thinmathspace"/><mml:mn>5</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mfrac></mml:mrow></mml:mstyle></mml:math></inline-formula>, where <inline-formula><mml:math id="inf171"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mspace width="thinmathspace"/><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf172"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mspace width="thinmathspace"/><mml:mn>5</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> were the T-cell area at the last and mean over the last 5 time frames of the T-cell track correspondingly, mean <inline-formula><mml:math id="inf173"><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and median <inline-formula><mml:math id="inf174"><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> T-cell detection probability as well as probabilities at the last time frame <inline-formula><mml:math id="inf175"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mspace width="thinmathspace"/><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and mean of last 5 time frames <inline-formula><mml:math id="inf176"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mspace width="thinmathspace"/><mml:mn>5</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, and the mean transmigration coefficient over the last 5 time frames of the T-cell track <inline-formula><mml:math id="inf177"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>l</mml:mi><mml:mi>a</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mspace width="thinmathspace"/><mml:mn>5</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>.</p><p>If the track of a T cell remaining above the pMBMEC monolayer ended before the end of the assay and this T cell is classified as detaching, it was marked as a detached T cell accordingly. Following their transmigration across the pMBMEC monolayer, T cells continued to crawl below the pMBMEC monolayer in the microfluidic device but were no longer subjected to flow. If such tracks were ending before the end of the assay, they were labeled as ‘tracking inefficiency’ and were subsequently excluded from further analysis of the post-transmigration motility parameters.</p><p>Next, we created masks of tracking inefficiency and periods of accelerated movement, i.e., rapid displacement of the T cells on the pMBMEC monolayer caused by the flow. For each T-cell track during the physiological flow phase and prior to transmigration, we evaluated the median step speed <inline-formula><mml:math id="inf178"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>v</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mspace width="thinmathspace"/><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, i.e., the T-cell speed between sequential time frames and its median absolute deviation <inline-formula><mml:math id="inf179"><mml:mi>M</mml:mi><mml:mi>A</mml:mi><mml:mi>D</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced></mml:math></inline-formula>. We evaluated the mean instantaneous speed <inline-formula><mml:math id="inf180"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>v</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mo>,</mml:mo><mml:mspace width="thinmathspace"/><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and its standard deviation <inline-formula><mml:math id="inf181"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mspace width="thinmathspace"/><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, excluding steps where the speed was an outlier, i.e., <inline-formula><mml:math id="inf182"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>v</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mo>,</mml:mo><mml:mspace width="thinmathspace"/><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mn>3</mml:mn><mml:mspace width="thinmathspace"/><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mi>v</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, where <inline-formula><mml:math id="inf183"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mi>v</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1.4826</mml:mn><mml:mspace width="thinmathspace"/><mml:mi>M</mml:mi><mml:mi>A</mml:mi><mml:mi>D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula>. We labeled time span along the T-cell tracks as ‘accelerated T-cell movement’ if the instantaneous speed<disp-formula id="equ25"><mml:math id="m25"><mml:mrow><mml:msub><mml:mi>v</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>v</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mo>,</mml:mo><mml:mspace width="thinmathspace"/><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>a</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mn>3</mml:mn><mml:mspace width="thinmathspace"/><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mspace width="thinmathspace"/><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>⋅</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>w</mml:mi><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>g</mml:mi><mml:mspace width="thinmathspace"/><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>and the instantaneous displacement <inline-formula><mml:math id="inf184"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>d</mml:mi><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:mi>d</mml:mi><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula>, where <inline-formula><mml:math id="inf185"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>v</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>w</mml:mi><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>g</mml:mi><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>36</mml:mn><mml:mspace width="thinmathspace"/><mml:mrow><mml:mrow><mml:mrow><mml:mo>µ</mml:mo></mml:mrow><mml:mi mathvariant="normal">m</mml:mi></mml:mrow><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">n</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf186"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>d</mml:mi><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>8</mml:mn><mml:mspace width="thinmathspace"/><mml:mtext>µm</mml:mtext></mml:mrow></mml:mstyle></mml:math></inline-formula>. If a step had a time difference of more than 3 time frames, e.g., in the case of intersecting T-cell tracks, it was labeled as tracking inefficiency.</p><p>If the T-cell displacement was more than <inline-formula><mml:math id="inf187"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mn>20</mml:mn><mml:mspace width="thinmathspace"/><mml:mtext>µm</mml:mtext></mml:mrow></mml:mstyle></mml:math></inline-formula> (length of a crawling T cell) during a cell track segment, irrespective of above or below the pMBMEC monolayer, the segment was marked as crawling. This is analogous to the criteria used during manual analysis (see the ‘Materials and methods’ section). The cell track was marked as probing if the T cell did not crawl before the first transmigration attempts.</p><p>Finally, for each track, we evaluated motility parameters for each of the following migration regimes: probing before the transmigration, crawling before the transmigration, all crawling above pMBMECs monolayer including T-cell crawling segments after the first transmigration attempts, all crawling below pMBMECs monolayer, whole T-cell track excluding accelerated movement and tracking inefficiency regions, as well as whole T-cell track. Specifically, we evaluated the following T-cell motility parameters: duration of each migration regime, the total vector and absolute displacements, the migration path length, the average migration speed (displacement over time), average crawling speed (path length over time), and finally the mean and standard deviation of the instantaneous speed. For the accelerated movement regime, we evaluated migration time, displacement, and average speed.</p></sec></app></app-group></back><sub-article article-type="editor-report" id="sa0"><front-stub><article-id pub-id-type="doi">10.7554/eLife.91150.4.sa0</article-id><title-group><article-title>eLife Assessment</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Dalal</surname><given-names>Yamini</given-names></name><role specific-use="editor">Reviewing Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/040gcmg81</institution-id><institution>National Cancer Institute</institution></institution-wrap><country>United States</country></aff></contrib></contrib-group><kwd-group kwd-group-type="evidence-strength"><kwd>Convincing</kwd></kwd-group><kwd-group kwd-group-type="claim-importance"><kwd>Important</kwd></kwd-group></front-stub><body><p>This work is <bold>important</bold> because it elucidates how immune cells migrate across the blood brain barrier. In the revised version of this study, the authors present a <bold>convincing</bold> framework to visualize, recognize and track the movement of different immune cells across primary human and mouse brain microvascular endothelial cells without the need for fluorescence-based imaging using microfluidic devices. This work will be of broad interest to the cancer biology, immunology and medical therapeutics fields.</p></body></sub-article><sub-article article-type="referee-report" id="sa1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.91150.4.sa1</article-id><title-group><article-title>Reviewer #1 (Public review):</article-title></title-group><contrib-group><contrib contrib-type="author"><anonymous/><role specific-use="referee">Reviewer</role></contrib></contrib-group></front-stub><body><p>Summary:</p><p>It is evident that studying leukocyte extravasation in vitro is a challenge. One needs to include physiological flow, culture cells and isolate primary immune cells. Timing is of utmost importance and a reproducible setup is essential. Extra challenges are met when extravasation kinetics in different vascular beds is required, e.g., across the blood-brain barrier. In this study, the authors describe a reliable and reproducible method to analyze leukocyte TEM under physiological flow conditions, including this analysis. That the software can also detect reverse TEM is a plus.</p><p>Strengths:</p><p>It is quite a challenge to get this assay reproducible and stable, in particular as there is flow included. Also for the analysis, there is currently no clear software analysis program, and many labs have their own methods. This paper gives the opportunity to unify the data and results obtained with this assay under label-free conditions. This should eventually lead to more solid and reproducible results.</p><p>Also, the comparison between manual and software analysis is appreciated.</p></body></sub-article><sub-article article-type="referee-report" id="sa2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.91150.4.sa2</article-id><title-group><article-title>Reviewer #2 (Public review):</article-title></title-group><contrib-group><contrib contrib-type="author"><anonymous/><role specific-use="referee">Reviewer</role></contrib></contrib-group></front-stub><body><p>Summary:</p><p>This paper develops an under-flow migration tracker to evaluate all the steps of the extravasation cascade of immune cells across the BBB. The algorithm is useful and has important applications.</p><p>Strengths:</p><p>The algorithm is almost as accurate as manual tracking and importantly saves time for researchers. The authors have discussed how their tool compares to other tracking methods.</p><p>Weaknesses:</p><p>Applicability can be questioned because the device used is 2D and physiological biology is in 3D. However, the authors have addressed this point in their manuscript.</p></body></sub-article><sub-article article-type="author-comment" id="sa3"><front-stub><article-id pub-id-type="doi">10.7554/eLife.91150.4.sa3</article-id><title-group><article-title>Author response</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Vladymyrov</surname><given-names>Mykhailo</given-names></name><role specific-use="author">Author</role><aff><institution>Theodor Kocher Institute, University of Bern</institution><addr-line><named-content content-type="city">Bern</named-content></addr-line><country>Switzerland</country></aff></contrib><contrib contrib-type="author"><name><surname>Marchetti</surname><given-names>Luca</given-names></name><role specific-use="author">Author</role><aff><institution>Theodor Kocher Institute, University of Bern</institution><addr-line><named-content content-type="city">Bern</named-content></addr-line><country>Switzerland</country></aff></contrib><contrib contrib-type="author"><name><surname>Aydin</surname><given-names>Sidar</given-names></name><role specific-use="author">Author</role><aff><institution>Theodor Kocher Institute, University of Bern</institution><addr-line><named-content content-type="city">Bern</named-content></addr-line><country>Switzerland</country></aff></contrib><contrib contrib-type="author"><name><surname>Soldati</surname><given-names>Sasha GN</given-names></name><role specific-use="author">Author</role><aff><institution>Theodor Kocher Institute, University of Bern</institution><addr-line><named-content content-type="city">Bern</named-content></addr-line><country>Switzerland</country></aff></contrib><contrib contrib-type="author"><name><surname>Mossu</surname><given-names>Adrien</given-names></name><role specific-use="author">Author</role><aff><institution>Theodor Kocher Institute, University of Bern</institution><addr-line><named-content content-type="city">Bern</named-content></addr-line><country>Switzerland</country></aff></contrib><contrib contrib-type="author"><name><surname>Pal</surname><given-names>Arindam</given-names></name><role specific-use="author">Author</role><aff><institution>Theodor Kocher Institute, University of Bern</institution><addr-line><named-content content-type="city">Bern</named-content></addr-line><country>Switzerland</country></aff></contrib><contrib contrib-type="author"><name><surname>Gueissaz</surname><given-names>Laurent</given-names></name><role specific-use="author">Author</role><aff><institution>Theodor Kocher Institute, University of Bern</institution><addr-line><named-content content-type="city">Bern</named-content></addr-line><country>Switzerland</country></aff></contrib><contrib contrib-type="author"><name><surname>Ariga</surname><given-names>Akitaka</given-names></name><role specific-use="author">Author</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/02k7v4d05</institution-id><institution>Laboratory for High Energy Physics, University of Bern</institution></institution-wrap><addr-line><named-content content-type="city">Bern</named-content></addr-line><country>Switzerland</country></aff></contrib><contrib contrib-type="author"><name><surname>Engelhardt</surname><given-names>Britta</given-names></name><role specific-use="author">Author</role><aff><institution>Theodor Kocher Institute, University of Bern</institution><addr-line><named-content content-type="city">Bern</named-content></addr-line><country>Switzerland</country></aff></contrib></contrib-group></front-stub><body><p>The following is the authors’ response to the previous reviews.</p><disp-quote content-type="editor-comment"><p><bold>Public Reviews:</bold></p><p><bold>Reviewer #1 (Public review):</bold></p><p>Summary:</p><p>It is evident that studying leukocyte extravasation in vitro is a challenge. One needs to include physiological flow, culture cells and isolate primary immune cells. Timing is of utmost importance and a reproducible setup essential. Extra challenges are met when extravasation kinetics in different vascular beds is required, e.g., across the blood-brain barrier. In this study, the authors describe a reliable and reproducible method to analyze leukocyte TEM under physiological flow conditions, including this analysis. That the software can also detect reverse TEM is a plus.</p><p>Strengths:</p><p>It is quite a challenge to get this assay reproducible and stable, in particular as there is flow included. Also for the analysis, there is currently no clear software analysis program, and many labs have their own methods. This paper gives the opportunity to unify the data and results obtained with this assay under label-free conditions. This should eventually lead to more solid and reproducible results.</p><p>Also, the comparison between manual and software analysis is appreciated.</p><p>Weaknesses:</p><p>The authors stress that it can be done in BBB models, but I would argue that it is much more broadly applicable. This is not necessarily a weakness of the study but more an opportunity to strengthen the method. So I would encourage the authors to rewrite some parts and make it more broadly applicable.</p></disp-quote><p>We thank the Reviewer for this suggestion. The barrier properties of the BBB influence the dynamic behavior of T cells during their multi-step extravasation cascade. The crawling of CD4 T cells against the direction of blood-flow is e.g. a unique behavior of T cells on the BBB that is also observed in vivo(1-3). Nevertheless we fully agree that in principle UFMTrack is usable for studying in general immune cell interactions with endothelial monolayers under physiological flow. We have thus added a statement in the abstract and expanded the discussion to highlight availability of the framework and the potential necessary adaptations required when using UFMTrack for analyzing different experimental setups. Please also note, UFMTrack has been established as basic framework using the example of brain endothelial monolayers and one flow chamber devices while studying different immune cell subsets. The purpose of the publication is to make UFMTrack available to the community to address their specific questions.</p><p>(1) Kawakami, N., Bartholomäus, I., Pesic, M. &amp; Kyratsous, N. I. Intravital Imaging of Autoreactive T Cells in Living Animals. <italic>Methods Cell Biol.</italic> 113, 149–168 (2013).</p><p>(2) Schläger, C., Litke, T., Flügel, A. &amp; Odoardi, F. In Vivo Visualization of (Auto)Immune Processes in the Central Nervous System of Rodents. in 117–129 (Humana Press, New York, NY, 2014). doi:10.1007/7651_2014_150</p><p>(3) Haghayegh Jahromi, N. <italic>et al.</italic> Intercellular Adhesion Molecule-1 (ICAM-1) and ICAM-2 Differentially Contribute to Peripheral Activation and CNS Entry of Autoaggressive Th1 and Th17 Cells in Experimental Autoimmune Encephalomyelitis. <italic>Front. Immunol.</italic> 10, 3056 (2020).</p></body></sub-article></article>