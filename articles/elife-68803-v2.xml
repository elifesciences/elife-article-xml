<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD with MathML3 v1.2 20190208//EN"  "JATS-archivearticle1-mathml3.dtd"><article article-type="research-article" dtd-version="1.2" xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn pub-type="epub" publication-format="electronic">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">68803</article-id><article-id pub-id-type="doi">10.7554/eLife.68803</article-id><article-categories><subj-group subj-group-type="display-channel"><subject>Tools and Resources</subject></subj-group><subj-group subj-group-type="heading"><subject>Neuroscience</subject></subj-group></article-categories><title-group><article-title>A state space modeling approach to real-time phase estimation</article-title></title-group><contrib-group><contrib contrib-type="author" corresp="yes" id="author-232043"><name><surname>Wodeyar</surname><given-names>Anirudh</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-2577-5139</contrib-id><email>wodeyar@bu.edu</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-232977"><name><surname>Schatza</surname><given-names>Mark</given-names></name><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-56605"><name><surname>Widge</surname><given-names>Alik S</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0001-8510-341X</contrib-id><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="other" rid="fund1"/><xref ref-type="other" rid="fund2"/><xref ref-type="other" rid="fund3"/><xref ref-type="fn" rid="con3"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-128888"><name><surname>Eden</surname><given-names>Uri T</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con4"/><xref ref-type="fn" rid="conf2"/></contrib><contrib contrib-type="author" id="author-147114"><name><surname>Kramer</surname><given-names>Mark A</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con5"/><xref ref-type="fn" rid="conf2"/></contrib><aff id="aff1"><label>1</label><institution>Mathematics and Statistics, Boston University</institution><addr-line><named-content content-type="city">Boston</named-content></addr-line><country>United States</country></aff><aff id="aff2"><label>2</label><institution>Department of Psychiatry, University of Minnesota</institution><addr-line><named-content content-type="city">Minneapolis</named-content></addr-line><country>United States</country></aff><aff id="aff3"><label>3</label><institution>Center for Systems Neuroscience, Boston University</institution><addr-line><named-content content-type="city">Boston</named-content></addr-line><country>United States</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Skinner</surname><given-names>Frances K</given-names></name><role>Reviewing Editor</role><aff><institution>Krembil Research Institute, University Health Network</institution><country>Canada</country></aff></contrib><contrib contrib-type="senior_editor"><name><surname>Colgin</surname><given-names>Laura L</given-names></name><role>Senior Editor</role><aff><institution>University of Texas at Austin</institution><country>United States</country></aff></contrib></contrib-group><pub-date date-type="publication" publication-format="electronic"><day>27</day><month>09</month><year>2021</year></pub-date><pub-date pub-type="collection"><year>2021</year></pub-date><volume>10</volume><elocation-id>e68803</elocation-id><history><date date-type="received" iso-8601-date="2021-03-26"><day>26</day><month>03</month><year>2021</year></date><date date-type="accepted" iso-8601-date="2021-09-24"><day>24</day><month>09</month><year>2021</year></date></history><pub-history><event><event-desc>This manuscript was published as a preprint at bioRxiv.</event-desc><date date-type="preprint" iso-8601-date="2021-03-25"><day>25</day><month>03</month><year>2021</year></date><self-uri content-type="preprint" xlink:href="https://doi.org/10.1101/2021.03.25.437024"/></event></pub-history><permissions><copyright-statement>© 2021, Wodeyar et al</copyright-statement><copyright-year>2021</copyright-year><copyright-holder>Wodeyar et al</copyright-holder><ali:free_to_read/><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><ali:license_ref>http://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-68803-v2.pdf"/><self-uri content-type="figures-pdf" xlink:href="elife-68803-figures-v2.pdf"/><abstract><p>Brain rhythms have been proposed to facilitate brain function, with an especially important role attributed to the phase of low-frequency rhythms. Understanding the role of phase in neural function requires interventions that perturb neural activity at a target phase, necessitating estimation of phase in real-time. Current methods for real-time phase estimation rely on bandpass filtering, which assumes narrowband signals and couples the signal and noise in the phase estimate, adding noise to the phase and impairing detections of relationships between phase and behavior. To address this, we propose a state space phase estimator for real-time tracking of phase. By tracking the analytic signal as a latent state, this framework avoids the requirement of bandpass filtering, separately models the signal and the noise, accounts for rhythmic confounds, and provides credible intervals for the phase estimate. We demonstrate in simulations that the state space phase estimator outperforms current state-of-the-art real-time methods in the contexts of common confounds such as broadband rhythms, phase resets, and co-occurring rhythms. Finally, we show applications of this approach to in vivo data. The method is available as a ready-to-use plug-in for the Open Ephys acquisition system, making it widely available for use in experiments.</p></abstract><kwd-group kwd-group-type="author-keywords"><kwd>phase</kwd><kwd>real-time</kwd><kwd>rhythms</kwd><kwd>EEG</kwd><kwd>LFP</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research organism</title><kwd>Human</kwd><kwd>Rat</kwd></kwd-group><funding-group><award-group id="fund1"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000002</institution-id><institution>National Institutes of Health</institution></institution-wrap></funding-source><award-id>R01 EB026938</award-id><principal-award-recipient><name><surname>Wodeyar</surname><given-names>Anirudh</given-names></name><name><surname>Widge</surname><given-names>Alik S</given-names></name><name><surname>Eden</surname><given-names>Uri T</given-names></name><name><surname>Kramer</surname><given-names>Mark A</given-names></name></principal-award-recipient></award-group><award-group id="fund2"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000002</institution-id><institution>National Institutes of Health</institution></institution-wrap></funding-source><award-id>R01 MH119384</award-id><principal-award-recipient><name><surname>Widge</surname><given-names>Alik S</given-names></name></principal-award-recipient></award-group><award-group id="fund3"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000002</institution-id><institution>National Institutes of Health</institution></institution-wrap></funding-source><award-id>R01 MH123634</award-id><principal-award-recipient><name><surname>Widge</surname><given-names>Alik S</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>A statistically principled approach developed to estimate phase of rhythmic signals in real-time shows robustness to multiple sources of error and also provides confidence criteria.</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>Rhythms, consistently periodic voltage fluctuations, are an ubiquitous phenomenon observed in brain electrophysiology across scales and species. Many studies have described a relationship between rhythms and behavior (<xref ref-type="bibr" rid="bib8">Buzsáki, 2006</xref>; <xref ref-type="bibr" rid="bib22">Haegens and Zion Golumbic, 2018</xref>; <xref ref-type="bibr" rid="bib57">VanRullen, 2016</xref>). A prominent feature of rhythms proposed as relevant for neural processing is the phase. Phase has been proposed to coordinate neural spiking locally and potentially, through coherent networks, even globally (<xref ref-type="bibr" rid="bib17">Fries, 2015</xref>; <xref ref-type="bibr" rid="bib37">Maris et al., 2016</xref>). For example, the phase of slow rhythms (3–15 Hz) has shown relationships to dynamics in perception (<xref ref-type="bibr" rid="bib6">Busch et al., 2009</xref>; <xref ref-type="bibr" rid="bib18">Gaillard et al., 2020</xref>; <xref ref-type="bibr" rid="bib21">Gregoriou et al., 2009</xref>; <xref ref-type="bibr" rid="bib23">Helfrich et al., 2018</xref>). Phase-amplitude synchrony is common (<xref ref-type="bibr" rid="bib10">Canolty and Knight, 2010</xref>; <xref ref-type="bibr" rid="bib25">Hyafil et al., 2015</xref>), and has been suggested to change in neurodegenerative disease (<xref ref-type="bibr" rid="bib24">Hemptinne et al., 2013</xref>). Cross-regional, low-frequency phase synchrony is consistently observed as a correlate of top-down executive control (<xref ref-type="bibr" rid="bib60">Widge et al., 2019</xref>). Most work examining the importance of phase for neural dynamics and behavior has been correlative in nature. To better understand the functional relevance of the phase of a rhythm requires an ability to monitor and perturb phase relationships in real-time.</p><p>Several methods exist to estimate phase in real-time (<xref ref-type="bibr" rid="bib1">Blackwood et al., 2018</xref>; <xref ref-type="bibr" rid="bib11">Chen et al., 2013</xref>; <xref ref-type="bibr" rid="bib36">Mansouri et al., 2017</xref>; <xref ref-type="bibr" rid="bib42">Rodriguez Rivero and Ditterich, 2021</xref>; <xref ref-type="bibr" rid="bib45">Rutishauser et al., 2013</xref>; <xref ref-type="bibr" rid="bib51">Siegle and Wilson, 2014</xref>; <xref ref-type="bibr" rid="bib65">Zrenner et al., 2020</xref>). At their core, these methods rely on bandpass filtering, a mechanism to forward predict data (using autoregressive [AR] models or linear extrapolation of phase) and the Hilbert transform to estimate the phase. Brain rhythms are often non-sinusoidal (<xref ref-type="bibr" rid="bib12">Cole and Voytek, 2017</xref>) and broadband (<xref ref-type="bibr" rid="bib7">Buzsaki, 2004</xref>; <xref ref-type="bibr" rid="bib43">Roopun et al., 2008</xref>), making development of an accurate bandpass filter difficult. While the contemporary modeling approach using filters accurately estimates the phase across a range of contexts, several limitations exist that limit the phase estimate accuracy (<xref ref-type="bibr" rid="bib40">Matsuda and Komaki, 2017</xref>; <xref ref-type="bibr" rid="bib51">Siegle and Wilson, 2014</xref>): (1) By depending on bandpass filters, existing real-time phase estimators are susceptible to non-sinusoidal distortions of the waveform, and inappropriate filter choices may miss the center frequency or total bandwidth of the rhythm. (2) Phase resets, moments when the phase slips because of stimulus presentation or spontaneous dynamics, cannot be tracked using filters, which control the maximum possible instantaneous frequency. (3) By filtering the observed data directly, these approaches do not model signal and noise processes separately. Phase estimates thus represent signal and noise phase together. (4) Many existing approaches depend on buffered processing (e.g., Fourier or related transforms), meaning that current phase estimates are delayed in ways that may not support real-time intervention. Further, buffer-based processing is susceptible to edge effects that are not of concern in traditional, offline analysis. (5) Contemporary approaches do not define a measure of confidence in the phase estimate. Despite these limitations, real-time phase simulations using current techniques have produced interesting results (<xref ref-type="bibr" rid="bib9">Cagnan et al., 2017</xref>; <xref ref-type="bibr" rid="bib13">Desideri et al., 2019</xref>; <xref ref-type="bibr" rid="bib26">Hyman et al., 2003</xref>; <xref ref-type="bibr" rid="bib31">Kundu et al., 2014</xref>; <xref ref-type="bibr" rid="bib48">Schaworonkow et al., 2018</xref>; <xref ref-type="bibr" rid="bib51">Siegle and Wilson, 2014</xref>; <xref ref-type="bibr" rid="bib64">Zrenner et al., 2018</xref>), motivating the value of generating better methods to estimate phase causally.</p><p>To address the limitations of existing approaches, we implement here a dynamical systems approach to real-time phase estimation. Rather than filtering the data to identify the rhythm of interest, we focus on tracking the analytic signal (a complex valued entity, representing the amplitude and phase of a rhythm <xref ref-type="bibr" rid="bib30">Kramer and Eden, 2016</xref>) as a latent process in the observed time series using a model proposed by <xref ref-type="bibr" rid="bib40">Matsuda and Komaki, 2017</xref>. In doing so, we remove the requirement of bandpass filtering and instead model the signal as a state space harmonic oscillator (or combination of such oscillators) driven by noise. This modeling approach allows: (1) a separate estimate of observation noise, (2) a procedure to model and reduce the confounding activity of other rhythms, and (3) a principled method for assessing uncertainty in the real-time phase estimates. After first fitting parameters of the state space harmonic oscillator model acausally, the method then tracks the phase in real-time assuming spectral stationarity. We call this approach the state space phase estimate (SSPE).</p><p>To benchmark the SSPE technique against the current state-of-the-art methods of real-time phase estimation, we design several simulations and analyze case studies of in vivo data. We limit our comparison to the real-time methods proposed in <xref ref-type="bibr" rid="bib65">Zrenner et al., 2020</xref>, and <xref ref-type="bibr" rid="bib1">Blackwood et al., 2018</xref>, methods which provide an estimate of phase on receipt of each new sample of data and have readily available reference code. We additionally apply a standard method for non-real-time phase estimation (an acausal finite impulse response [FIR] filter followed by a Hilbert transform; <xref ref-type="bibr" rid="bib33">Lepage et al., 2013</xref>). We note that these and other existing real-time phase estimation techniques (<xref ref-type="bibr" rid="bib11">Chen et al., 2013</xref>; <xref ref-type="bibr" rid="bib36">Mansouri et al., 2017</xref>; <xref ref-type="bibr" rid="bib42">Rodriguez Rivero and Ditterich, 2021</xref>; <xref ref-type="bibr" rid="bib45">Rutishauser et al., 2013</xref>; <xref ref-type="bibr" rid="bib51">Siegle and Wilson, 2014</xref>) apply a bandpass filter and forecasting technique, and, by that measure, the acausal FIR approach by utilizing more information suggests the room for improvement available for these estimators. We test the ability of these different methods to track the phase of rhythms with different spectral profiles – including narrowband rhythms, broadband rhythms, multiple rhythms, and rhythms with phase resets, and in different signal-to-noise settings. We show that the SSPE method outperforms the existing real-time phase estimation methods in almost all cases. Finally, we illustrate the application of the SSPE method to in vivo local field potential (LFP) and electroencephalogram (EEG) recordings, demonstrate the utility of SSPE for predicting behavior, and introduce a plug-in of the SSPE method for Open Ephys (<xref ref-type="bibr" rid="bib52">Siegle et al., 2017</xref>), making the method widely available for use in real-time experiments. Our work demonstrates that the SSPE method improves the ability to track phase accurately, in real-time, across a diverse set of contexts encountered in data.</p></sec><sec id="s2" sec-type="materials|methods"><title>Materials and methods</title><sec id="s2-1"><title>State space model framework</title><p>To estimate phase in real-time, we utilize a data-driven model (<xref ref-type="bibr" rid="bib40">Matsuda and Komaki, 2017</xref>) that operates based on principles from dynamical systems and Markov models. This type of model (called a state space model) separates what is observed (called the observation equation) from what we wish to estimate (called the state equation). The state equation attempts to capture the underlying, unobserved dynamics of the system, while the observation equation transforms the state into the observed signal. We generate an optimal prediction for the state using a Kalman filter that compares the initial prediction of the observation with the actual observed value.</p><p>Each state variable represents an oscillator with a fixed frequency that undergoes small random perturbations. As these perturbations accumulate, the instantaneous phase and frequency of the oscillator become more uncertain, since the oscillator is not directly observed. We assume that the observed data are noisy versions of these oscillators. The state space model framework combines information from two models: (1) a state model that describes the oscillator dynamics and (2) an observation model that describes how the oscillator generates the data. The methods we develop use both of these sources of information to optimally estimate the instantaneous frequency and phase of each oscillator at every moment in time.</p><p>We implement a linear state equation that models the <italic>real</italic> and <italic>imaginary</italic> part of the complex valued analytic signal of rhythms present in the neural data. For each rhythm modeled, the state equation dynamics rotate the analytic signal at that rhythm’s frequency. The observation equation sums the <italic>real</italic> part of the analytic signals of every modeled rhythm to predict the observed neural activity. We treat as real-valued the real and imaginary parts of the complex valued analytic signal for ease of analysis and interpretation. This state space model structure allows us to derive the amplitude and phase of each modeled rhythm, and estimate the analytic signal in the temporal domain, thus avoiding complications associated with windowing (i.e., the need to choose large enough window sizes to support sufficient frequency resolution and the associated unavoidable temporal delay in phase estimates) that occur in related frequency domain approaches (<xref ref-type="bibr" rid="bib28">Kim et al., 2018</xref>).</p><p>The state space model is linear in the state evolution (dynamics of state transitions) and observation equations. Further, the covariance for the state (which determines the bandwidth for the rhythms) and noise for the observation is Gaussian (white noise). These assumptions (linearity and Gaussianity) imply that we can use the Kalman filter to correct the state estimate based on the true observation (i.e., to filter the state) (<xref ref-type="bibr" rid="bib27">Kalman, 1960</xref>). This type of modeling approach has been successfully applied in many contexts to track latent structure from observed data while accounting for state and observation noise effects (<xref ref-type="bibr" rid="bib4">Brockwell et al., 2004</xref>; <xref ref-type="bibr" rid="bib14">Eden et al., 2018</xref>; <xref ref-type="bibr" rid="bib19">Galka et al., 2004</xref>; <xref ref-type="bibr" rid="bib63">Yousefi et al., 2019</xref>).</p><p>To illustrate this approach, we first consider the case of tracking a single, 6 Hz rhythm. The state equation for this scenario is:<disp-formula id="equ1"><mml:math id="m1"><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>a</mml:mi><mml:mi>O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>u</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>u</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>∼</mml:mo><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>Q</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf1"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> has both a real and imaginary part. At time instant <italic>t−1</italic>, the modeled rhythm is in state <inline-formula><mml:math id="inf2"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, that is, the rhythm is at some point along its trajectory. The state equation provides a prediction for the next point along this trajectory (<inline-formula><mml:math id="inf3"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>) by rotating the current state (<inline-formula><mml:math id="inf4"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>) and adding noise (<inline-formula><mml:math id="inf5"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>u</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>). The rotation matrix <inline-formula><mml:math id="inf6"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>ω</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> rotates the real and imaginary parts of the state by the amount <inline-formula><mml:math id="inf7"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>ω</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> appropriate for a 6 Hz rhythm:<disp-formula id="equ2"><mml:math id="m2"><mml:mrow><mml:mrow><mml:mi mathvariant="italic">O</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>ω</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mtable columnspacing="1em" rowspacing="4pt"><mml:mtr><mml:mtd><mml:mi>cos</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>ω</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mtd><mml:mtd><mml:mo>−</mml:mo><mml:mi>sin</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>ω</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>sin</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>ω</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mtd><mml:mtd><mml:mi>cos</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>ω</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr></mml:mtable><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula><disp-formula id="equ3"><mml:math id="m3"><mml:mrow><mml:mi>ω</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>6</mml:mn><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mi>F</mml:mi><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula></p><p>where <italic>Fs</italic> is the sampling frequency in Hz. After rotation, the state is scaled (or rather, damped) by a factor <inline-formula><mml:math id="inf8"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>, and then Gaussian noise (with mean and variance <inline-formula><mml:math id="inf9"><mml:mi>Q</mml:mi></mml:math></inline-formula>) is added. We estimate the observation at time t (<inline-formula><mml:math id="inf10"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>) as the real part of the state at time <italic>t</italic> with additive noise:<disp-formula id="equ4"><mml:math id="m4"><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>R</mml:mi><mml:mi>e</mml:mi><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mi>ν</mml:mi></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf11"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>ν</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> is Gaussian noise with mean 0 and variance <inline-formula><mml:math id="inf12"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msup><mml:mi>σ</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mstyle></mml:math></inline-formula>. Note that this model for the state is akin to a damped harmonic oscillator driven by noise, a model that has been shown to be relevant and useful for gamma rhythms in the visual cortex (<xref ref-type="bibr" rid="bib5">Burns et al., 2010</xref>; <xref ref-type="bibr" rid="bib55">Spyropoulos et al., 2019</xref>) and also for EEG (<xref ref-type="bibr" rid="bib16">Franaszczuk and Blinowska, 1985</xref>).</p><p>To model <italic>N</italic> rhythms, we define <bold><italic>X</italic></bold> as the state variable, a 2<italic>N</italic> × <italic>T</italic> matrix over total time <italic>T</italic>. An individual time point with state <inline-formula><mml:math id="inf13"><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> (2<italic>N ×</italic> 1 vector) is rotated according to each rhythm’s (<inline-formula><mml:math id="inf14"><mml:msubsup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> , a 2 × 1 complex vector for rhythm <italic>j</italic>) central frequency (<inline-formula><mml:math id="inf15"><mml:msub><mml:mrow><mml:mi>ω</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∆</mml:mo><mml:mi>t</mml:mi><mml:mo>∈</mml:mo><mml:mfenced separators="|"><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>π</mml:mi></mml:mrow></mml:mfenced></mml:math></inline-formula> , where <inline-formula><mml:math id="inf16"><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is frequency in Hz and <inline-formula><mml:math id="inf17"><mml:mo>∆</mml:mo><mml:mi>t</mml:mi></mml:math></inline-formula> is sampling interval) and damped by a constant (<inline-formula><mml:math id="inf18"><mml:msubsup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow/></mml:msubsup></mml:math></inline-formula>). For each rhythm <inline-formula><mml:math id="inf19"><mml:msubsup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> we define <inline-formula><mml:math id="inf20"><mml:msubsup><mml:mrow><mml:mi>θ</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> as a scalar quantity tracking the phase, and <bold>Θ</bold> as an <italic>N × T</italic> matrix of phase values for all rhythms over all time. For the <italic>N</italic> rhythms, <bold><italic>O</italic></bold> is the rotation matrix, a 2<italic>N × 2N</italic> and block diagonal matrix, defined by the central frequency of each rhythm. <bold><italic>A</italic></bold> is the scaling matrix, a diagonal 2<italic>N × 2N</italic> matrix, with scaling factor <inline-formula><mml:math id="inf21"><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mfenced separators="|"><mml:mrow><mml:mn>0,1</mml:mn></mml:mrow></mml:mfenced></mml:math></inline-formula> to ensure stability, the same for each rhythm, and different across rhythms. The driving noise for the state <italic>U</italic> is Gaussian, a 2<italic>N</italic> × <italic>T</italic> matrix with covariance structure <bold><italic>Q</italic></bold>, a 2<italic>N ×</italic> 2<italic>N</italic> diagonal matrix with the same variance for the real and imaginary parts of each rhythm. The state is collapsed into the observation <inline-formula><mml:math id="inf22"><mml:mi>Y</mml:mi></mml:math></inline-formula>(a <italic>T ×</italic> 1 vector) through <italic>M</italic> (a 1 × 2<italic>N</italic> vector) which summates the real parts of the analytic signals of all rhythms. For any time point, the observation <inline-formula><mml:math id="inf23"><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is a scalar. The noise for the observation <inline-formula><mml:math id="inf24"><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is Gaussian with covariance. <inline-formula><mml:math id="inf25"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>R</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula> The model equations are:<disp-formula id="equ5"><label>(1)</label><mml:math id="m5"><mml:mrow><mml:mtable columnalign="left left" columnspacing="1em" rowspacing="4pt"><mml:mtr><mml:mtd><mml:msub><mml:mi>X</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>x</mml:mi><mml:mi>t</mml:mi><mml:mn>1</mml:mn></mml:msubsup><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mi>T</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mo>,</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>x</mml:mi><mml:mi>t</mml:mi><mml:mi>N</mml:mi></mml:msubsup><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mi>T</mml:mi></mml:msup><mml:mo stretchy="false">]</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msubsup><mml:mi>x</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mi>O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mi>x</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>u</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>u</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msubsup><mml:mo>∼</mml:mo><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mi>Q</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula><disp-formula id="equ6"><mml:math id="m6"><mml:mrow><mml:msubsup><mml:mi>θ</mml:mi><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mi>g</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>x</mml:mi><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula><disp-formula id="equ7"><label>(2)</label><mml:math id="m7"><mml:mrow><mml:msubsup><mml:mi>θ</mml:mi><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mi>g</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>x</mml:mi><mml:mi>j</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula><disp-formula id="equ8"><label>(3)</label><mml:math id="m8"><mml:mrow><mml:mrow><mml:mi mathvariant="italic">O</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mtable columnspacing="1em" rowspacing="4pt"><mml:mtr><mml:mtd><mml:mi>cos</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mtd><mml:mtd><mml:mo>−</mml:mo><mml:mi>sin</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>sin</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mtd><mml:mtd><mml:mi>cos</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr></mml:mtable><mml:mo>)</mml:mo></mml:mrow><mml:mspace width="thinmathspace"/><mml:mspace width="thinmathspace"/><mml:msub><mml:mi>Q</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mtable columnspacing="1em" rowspacing="4pt"><mml:mtr><mml:mtd><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mtd><mml:mtd><mml:mn>0</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mtd></mml:mtr></mml:mtable><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula><disp-formula id="equ9"><label>(4)</label><mml:math id="m9"><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>M</mml:mi><mml:msub><mml:mi>X</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo>∼</mml:mo><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>R</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula><disp-formula id="equ10"><label>(5)</label><mml:math id="m10"><mml:mrow><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mo stretchy="false">]</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>We note that the state (<italic>Q</italic>) and observation (<inline-formula><mml:math id="inf26"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>R</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula>) covariance matrices are estimated from the data, as described below. While we term <inline-formula><mml:math id="inf27"><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msup></mml:math></inline-formula> as tracking the analytic signal, this nomenclature differs from the signal processing literature. In signal processing, the analytic signal is defined as a signal that has zero power at negative frequencies. However, given the stochastic frequency modulation permitted in the state vector <inline-formula><mml:math id="inf28"><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msup></mml:math></inline-formula> , we cannot guarantee that <inline-formula><mml:math id="inf29"><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msup></mml:math></inline-formula> has zero power at negative frequencies. Nevertheless, since for sufficiently complex signals there are (potentially) several ways one could represent the dynamics of the amplitude and phase (<xref ref-type="bibr" rid="bib3">Boashash, 1991</xref>; <xref ref-type="bibr" rid="bib44">Rosenblum et al., 1997</xref>), we use the term <italic>analytic signal</italic> here for ease of understanding our intent with this model and comparing it to classical Hilbert-based methods.</p></sec><sec id="s2-2"><title>Real-time phase estimation</title><p>We perform real-time estimation of phase as follows. First, we use an existing interval of data to acausally fit the parameters of the state space model <inline-formula><mml:math id="inf30"><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> , <inline-formula><mml:math id="inf31"><mml:msub><mml:mrow><mml:mi>ω</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> , <inline-formula><mml:math id="inf32"><mml:msub><mml:mrow><mml:mi>Q</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> , <inline-formula><mml:math id="inf33"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>R</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula> using an expectation-maximization (EM) algorithm as proposed by <xref ref-type="bibr" rid="bib54">Soulat et al., 2019</xref>; for details, see the supplementary information in <xref ref-type="bibr" rid="bib54">Soulat et al., 2019</xref>. Under the EM approach, optimization of parameters follows a two-step process. First, initial values for parameters are selected, usually from prior knowledge such as an examination of the power spectrum of an initial data sample. This allows the algorithm to estimate the expectations for the state and the observation. Second, using the state and observation estimates, an analytic solution exists (<xref ref-type="bibr" rid="bib50">Shumway and Stoffer, 1982</xref>) for the parameters that maximizes the likelihood. We repeat the expectation and maximization procedures until the parameter estimates do not change between two iterations beyond a threshold. The rate of convergence of the EM algorithm (speed of computation) depends on the initial parameter estimates and the signal-to-noise ratios (SNR) of the rhythms present in the signal.</p><p>In simulations, unless otherwise specified, we use the first 2 s of data to fit the model parameters. With these model parameters estimated and fixed, we then apply a Kalman filter to predict and update the state estimates, and estimate the phase and amplitude for each oscillator, each representing a different rhythm, for every sample (<xref ref-type="fig" rid="fig1">Figure 1</xref>). We note that the Kalman filter is an optimal filter, that is, in the presence of Gaussian noise, the Kalman filter achieves minimum error and is an unbiased estimate of the mean phase. However, if the noise is not Gaussian, the Kalman filter remains the optimal linear filter for phase estimation under this model. Given the stochastic frequency modulation that is possible under the model, the Kalman filter is robust to small shifts in the central frequency of the rhythm.</p><fig id="fig1" position="float"><label>Figure 1.</label><caption><title>Illustration of state space phase estimate (SSPE) procedure.</title><p>Given an observation (<bold>A</bold>, red), we estimate model parameters in an initial interval of data. At subsequent times, we use the observed data to (<bold>B</bold>) predict and update the state estimate (purple), and (<bold>C</bold>) the phase and credible intervals, causally estimated. Note that prediction can be done for any time after parameter estimation; here we show a representative time interval. (<bold>D</bold>) Conceptual diagram of the steps involved in the SSPE method.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-68803-fig1-v2.tif"/></fig><p>We now define the stages of Kalman filtering. The state is initialized with zeros and the state covariance to a diagonal matrix with 0.001 along the diagonal. To predict the future state and state estimation error at time <italic>t</italic> prior to filtering (<ext-link ext-link-type="uri" xlink:href="https://www.codecogs.com/eqnedit.php?latex=x_t%5e%7bt-1%7d#0">xtt−1</ext-link> and <ext-link ext-link-type="uri" xlink:href="https://www.codecogs.com/eqnedit.php?latex=P_t%5e%7bt-1%7d#0">Ptt−1</ext-link>) given the filtered state and estimation error (<inline-formula><mml:math id="inf34"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>x</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf35"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>P</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula>) from the previous sample (<italic>t−</italic>1), we compute:<disp-formula id="equ11"><label>(6)</label><mml:math id="m11"><mml:mrow><mml:msubsup><mml:mi>x</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mi>a</mml:mi><mml:mi>O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>ω</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mi>x</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:math></disp-formula><disp-formula id="equ12"><label>(7)</label><mml:math id="m12"><mml:mrow><mml:msubsup><mml:mi>P</mml:mi><mml:mi>t</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mi>a</mml:mi><mml:mi>O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mi>P</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mi>O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mi>T</mml:mi></mml:msup><mml:mo>+</mml:mo><mml:mi>Q</mml:mi><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>We then estimate the Kalman gain for the current sample (<italic>t</italic>):<disp-formula id="equ13"><label>(8)</label><mml:math id="m13"><mml:mrow><mml:msub><mml:mi>K</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mi>P</mml:mi><mml:mi>t</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:msup><mml:mi>M</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mi>M</mml:mi><mml:msubsup><mml:mi>P</mml:mi><mml:mi>t</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:msup><mml:mi>M</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>R</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>Finally, we filter the current sample using the Kalman gain to compute filtered state (<inline-formula><mml:math id="inf36"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>x</mml:mi><mml:mi>t</mml:mi><mml:mi>t</mml:mi></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula>) and state estimation error (<inline-formula><mml:math id="inf37"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>P</mml:mi><mml:mi>t</mml:mi><mml:mi>t</mml:mi></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula>) at time <italic>t</italic>:<disp-formula id="equ14"><label>(9)</label><mml:math id="m14"><mml:mrow><mml:msubsup><mml:mi>x</mml:mi><mml:mi>t</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mi>x</mml:mi><mml:mi>t</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:msub><mml:mi>K</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mi>M</mml:mi><mml:msubsup><mml:mi>x</mml:mi><mml:mi>t</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula><disp-formula id="equ15"><label>(10)</label><mml:math id="m15"><mml:mrow><mml:msubsup><mml:mi>P</mml:mi><mml:mi>t</mml:mi><mml:mi>t</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mi>P</mml:mi><mml:mi>t</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>−</mml:mo><mml:msub><mml:mi>K</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mi>M</mml:mi><mml:msubsup><mml:mi>P</mml:mi><mml:mi>t</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>The SSPE method also tracks the state estimation error (<inline-formula><mml:math id="inf38"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>P</mml:mi><mml:mi>t</mml:mi><mml:mi>t</mml:mi></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula>), which allows estimation of confidence in the mean phase estimates. To do so, we sample 10,000 samples from the posterior distribution of each state <italic>j</italic>, and from this estimate the width of the 95% credible intervals for the phase. The credible intervals are derived from the posterior distribution of the state, which is Gaussian; however, following their transformation into angles, the intervals are not constrained to be symmetric. Note that, alternatively, one could attempt to define a closed form for the phase distribution to estimate confidence bounds, as we estimate the posterior distribution for the analytic signal under the Kalman filter. However, this strategy requires an expectation of asymptotic convergence and the assumption of independence of amplitude and phase (<xref ref-type="bibr" rid="bib61">Withers and Nadarajah, 2013</xref>).</p></sec><sec id="s2-3"><title>AR-based forecasting to estimate phase</title><p>While current techniques depend upon filtering to isolate a narrowband rhythm from which to estimate phase, different methods exist to forecast the phase. One category of methods forecasts the phase as a linear extrapolation from the current moment while assuming a singular central frequency, which is estimated from the data (<xref ref-type="bibr" rid="bib42">Rodriguez Rivero and Ditterich, 2021</xref>; <xref ref-type="bibr" rid="bib45">Rutishauser et al., 2013</xref>). Other methods estimate phase by using an AR model. After estimating the AR parameters (either asynchronously or synchronously), these methods forecast data to limit filter edge effects, then use a filter and Hilbert transform to estimate phase (see <xref ref-type="bibr" rid="bib1">Blackwood et al., 2018</xref>, and <xref ref-type="bibr" rid="bib65">Zrenner et al., 2020</xref>). We compare the SSPE to this latter set of techniques as these are more flexible to variability in rhythms than methods that assume a constant central frequency when estimating phase. We implement the version of the <xref ref-type="bibr" rid="bib65">Zrenner et al., 2020</xref>, algorithm accessible at <ext-link ext-link-type="uri" xlink:href="https://github.com/bnplab/phastimate">https://github.com/bnplab/phastimate</ext-link>: and term this method as <italic>Zrenner</italic>. Please refer to <xref ref-type="bibr" rid="bib65">Zrenner et al., 2020</xref>, for algorithm details. The Zrenner algorithm uses an FIR filter (applied forward and backward) and the Hilbert transform as the core phase estimation technique. The AR model used to forecast the data and allow real-time phase estimation (by expanding the window for the FIR filter) is fitted to the 30th order and efficiently updated on every new sample. Compared to the default settings, we set the algorithm to track a 6 Hz rhythm by increasing the window size for the FIR filter to 750 ms, the filter order to 192, and the frequency band to 4–8 Hz. We utilize the implementation of the <xref ref-type="bibr" rid="bib1">Blackwood et al., 2018</xref>, algorithm as provided by the authors. In <xref ref-type="bibr" rid="bib1">Blackwood et al., 2018</xref>, the authors develop a forward bandpass filter – AR-based (fifth-order AR model whose parameters are fit every second) forecasting and then the Hilbert transform – to compute the phase. Here, we instead apply a Hilbert transformer (of order 18) that estimates the phase by directly computing the Hilbert transform while filtering the data as implemented in <xref ref-type="bibr" rid="bib2">Blackwood, 2019</xref>. We do so because this implementation is more computationally efficient, functionally equivalent to the original method, and the code is made widely available. We verified in sample data that application of the original and modified Blackwood methods produced consistent phase estimates. We refer to this method as <italic>Blackwood</italic>.</p></sec><sec id="s2-4"><title>Non-causal phase estimation</title><p>Existing studies compare causal, real-time phase estimation approaches to an acausal estimate of phase computed by applying an (acausal) FIR filter and the Hilbert transform (<xref ref-type="bibr" rid="bib1">Blackwood et al., 2018</xref>; <xref ref-type="bibr" rid="bib11">Chen et al., 2013</xref>; <xref ref-type="bibr" rid="bib65">Zrenner et al., 2020</xref>). To maintain consistency with the existing literature, we do so here and apply a least-squares linear-phase FIR filter of order 750, with bandpass 4–8 Hz. After forward and backward filtering of the data (using MATLAB’s <italic>filtfilt</italic> function), we apply the Hilbert transform to compute the analytic signal (using MATLAB’s <italic>hilbert</italic> function). We estimate phase using the four-quadrant arctan function implemented by MATLAB’s <italic>angle</italic> function and estimate the amplitude envelope using MATLAB’s <italic>abs</italic> function. We use the <italic>angle</italic> function throughout the analysis to estimate the phase from a complex valued analytic signal. This acausal estimate of phase has been proposed to serve as a lower bound in phase estimation error for methods that apply a filter-based approach to real-time phase estimation (<xref ref-type="bibr" rid="bib65">Zrenner et al., 2020</xref>).</p></sec><sec id="s2-5"><title>Defining error as circular standard deviation</title><p>Identifying a common error metric across alternative algorithms to causally estimate phase is crucial for accurate comparison. We follow <xref ref-type="bibr" rid="bib65">Zrenner et al., 2020</xref>, and use the circular standard deviation of the difference between the estimated phase and true phase:<disp-formula id="equ16"><label>(11)</label><mml:math id="m16"><mml:mrow><mml:mi>C</mml:mi><mml:mi>i</mml:mi><mml:mi>r</mml:mi><mml:mi>c</mml:mi><mml:mi>S</mml:mi><mml:mi>D</mml:mi><mml:mo>=</mml:mo><mml:msqrt><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mi>n</mml:mi></mml:mfrac><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mi>θ</mml:mi><mml:mo>−</mml:mo><mml:mi>i</mml:mi><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:msqrt></mml:mrow></mml:math></disp-formula></p><p>where <italic>n</italic> is number of samples, <italic>θ</italic> is true phase, <inline-formula><mml:math id="inf39"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mover><mml:mi>θ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> is the phase estimate, and | | indicates the absolute value. We transform the final result from radians to degrees. The circular standard deviation (a transformed version of the phase locking value) captures the variance in the circular error for the phase estimate and ignores any potential bias (non-zero mean shift).</p></sec><sec id="s2-6"><title>Simulated data</title><sec id="s2-6-1"><title>Narrowband to broadband rhythms</title><p>Our initial simulation tests the capability of different real-time phase estimators to track different frequency band profiles. We shift the bandwidth of the target rhythm from narrow (sharply peaked in the spectral domain at 6 Hz) to wide (broadly peaked in the spectral domain; peak bandwidth 4–8 Hz). We simulate all rhythms for 10 s at a sampling rate of 1000 Hz, with a central frequency of 6 Hz. For each simulated rhythm, we apply each phase estimation method, as described in Results.</p><p>The first type of rhythm we simulate is a pure sinusoid with added white noise:<disp-formula id="equ17"><label>(12)</label><mml:math id="m17"><mml:mrow><mml:mtable columnalign="left left" columnspacing="1em" rowspacing="4pt"><mml:mtr><mml:mtd><mml:mi>Y</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn><mml:mi>cos</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mo>∗</mml:mo><mml:mn>6</mml:mn><mml:mo>∗</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:msub><mml:mi>ϵ</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mspace width="2em"/><mml:msub><mml:mi>ϵ</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>∼</mml:mo><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula></p><p>where <italic>T</italic> is time, and <italic>N</italic>(0,1) indicates a standard normal distribution. The second type of rhythm we simulate is a pure sinusoid with added pink noise, that is, the power spectral density (PSD) of the noise decreases with the reciprocal of frequency (<italic>f</italic>):<disp-formula id="equ18"><label>(13)</label><mml:math id="m18"><mml:mrow><mml:mtable columnalign="left left" columnspacing="1em" rowspacing="4pt"><mml:mtr><mml:mtd><mml:mi>Y</mml:mi><mml:mo>=</mml:mo><mml:mn>10</mml:mn><mml:mi>cos</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mo>∗</mml:mo><mml:mn>6</mml:mn><mml:mo>∗</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:msub><mml:mi>ϵ</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mspace width="2em"/><mml:mi>P</mml:mi><mml:mi>S</mml:mi><mml:mi>D</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>ϵ</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>∼</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:msup><mml:mi>f</mml:mi><mml:mrow><mml:mn>1.5</mml:mn></mml:mrow></mml:msup></mml:mfrac><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula></p><p>The third type of rhythm we simulate is filtered pink noise with added pink noise. To create a broadband spectral peak, we apply the same FIR filter utilized in the acausal phase estimation analysis (see Materials and methods: Non-causal phase estimation) to pink noise (<inline-formula><mml:math id="inf40"><mml:mi>P</mml:mi><mml:mi>S</mml:mi><mml:mi>D</mml:mi></mml:math></inline-formula>~ <inline-formula><mml:math id="inf41"><mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mo>/</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mn>1.5</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula>), normalizing by the standard deviation and amplifying the resulting signal 10-fold. The resulting signal consists of a broad spectral peak centered at 6 Hz. To this broadband signal we again add independent pink noise (<inline-formula><mml:math id="inf42"><mml:msub><mml:mrow><mml:mi>ϵ</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:math></inline-formula>) as in <xref ref-type="disp-formula" rid="equ18">Equation 13</xref>.</p><p>For the final rhythm we simulate a signal <inline-formula><mml:math id="inf43"><mml:msub><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> from the SSPE model (see Materials and methods: State space model framework) which is non-sinusoidal and broadband. The state in the state space model is an AR model of order 2 (<xref ref-type="bibr" rid="bib59">West, 1997</xref>) (equivalently, a damped harmonic oscillator driven by noise), which has been proposed to capture features of gamma rhythms in visual cortex and rhythms in EEG (<xref ref-type="bibr" rid="bib16">Franaszczuk and Blinowska, 1985</xref>; <xref ref-type="bibr" rid="bib62">Xing et al., 2012</xref>; <xref ref-type="bibr" rid="bib5">Burns et al., 2010</xref>; <xref ref-type="bibr" rid="bib55">Spyropoulos et al., 2019</xref>). The addition of observation noise under the state space model can be analogized to measurement noise. Thus, the state space model provides a simple possible model for brain rhythms observed in electrophysiological data. For the model, we fix one latent state (<italic>j</italic> = 1) with frequency 6 Hz (<inline-formula><mml:math id="inf44"><mml:msub><mml:mrow><mml:mi>ω</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>6</mml:mn></mml:math></inline-formula>), and set <italic>a</italic> (scaling factor) <italic>=</italic> 0.99, variance <italic>Q =</italic> 10<italic>,</italic> and observation noise variance (<inline-formula><mml:math id="inf45"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>R</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula>) to 1. For this rhythm, phase was estimated from the state directly as described in Materials and methods: State space model framework. We show example instances of all four simulated rhythm types in <xref ref-type="fig" rid="fig2">Figure 2A</xref>.</p><fig id="fig2" position="float"><label>Figure 2.</label><caption><title>Wide band rhythm’s phase better tracked with state space phase estimate (SSPE).</title><p>(<bold>A</bold>) Example 2 s of simulated observed data (thick curves) and the true phase (thin blue curves) for each scenario. (<bold>B</bold>) For each scenario, example spectra of (B.i) the signal, and (B.ii) the observation (i.e., signal plus noise). Spectra were estimated for 10 s segments using the function ‘pmtm’ in MATLAB, to compute a multitaper estimate with frequency resolution 1 Hz and nine tapers. (<bold>C</bold>) The phase error for each estimation method (see legend) and simulation scenario. In each box plot, the central mark indicates the median; the bottom and top edges of the box indicate the 25th and 75th percentiles, respectively; the whiskers indicate the most extreme data points not considered outliers.</p><p><supplementary-material id="fig2sdata1"><label>Figure 2—source data 1.</label><caption><title>Circular standard deviation for all methods.</title></caption><media mime-subtype="mat" mimetype="application" xlink:href="elife-68803-fig2-data1-v2.mat"/></supplementary-material></p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-68803-fig2-v2.tif"/></fig></sec><sec id="s2-6-2"><title>Two simultaneous rhythms with nearby frequencies</title><p>In many physiologic use cases (<xref ref-type="bibr" rid="bib56">Tort et al., 2010</xref>; <xref ref-type="bibr" rid="bib57">VanRullen, 2016</xref>), we may wish to track one rhythm while ignoring another at a nearby frequency. This may occur because of low spatial resolution (e.g., from mixing of signals due to volume conduction; <xref ref-type="bibr" rid="bib41">Nunez and Srinivasan, 2006</xref>) or because there exist overlapping neural populations expressing different rhythms (<xref ref-type="bibr" rid="bib29">Kocsis et al., 1999</xref>). To simulate this case, we consider two sinusoids. We define the target rhythm to track as a 6 Hz sinusoid with consistent amplitude. We define the confounding rhythm as a sinusoid with varying frequency and amplitude. We define the observation (signal plus noise) as:<disp-formula id="equ19"><label>(14)</label><mml:math id="m19"><mml:mrow><mml:mtable columnalign="left left" columnspacing="1em" rowspacing="4pt"><mml:mtr><mml:mtd><mml:mi>Y</mml:mi><mml:mo>=</mml:mo><mml:mn>25</mml:mn><mml:mi>cos</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mo>∗</mml:mo><mml:mn>6</mml:mn><mml:mo>∗</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mi>A</mml:mi><mml:mo>∗</mml:mo><mml:mn>25</mml:mn><mml:mi>cos</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mo>∗</mml:mo><mml:mi>F</mml:mi><mml:mo>∗</mml:mo><mml:mi>T</mml:mi><mml:mo>+</mml:mo><mml:mfrac><mml:mi>π</mml:mi><mml:mn>4</mml:mn></mml:mfrac><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:msub><mml:mi>ϵ</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mspace width="2em"/><mml:mspace width="2em"/><mml:msub><mml:mi>ϵ</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>∼</mml:mo><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0.5</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf46"><mml:mi>A</mml:mi><mml:mo>∈</mml:mo><mml:mfenced close="]" open="[" separators="|"><mml:mrow><mml:mn>0.2,2</mml:mn></mml:mrow></mml:mfenced></mml:math></inline-formula> and <inline-formula><mml:math id="inf47"><mml:mi>F</mml:mi><mml:mo>∈</mml:mo><mml:mfenced close="]" open="[" separators="|"><mml:mrow><mml:mn>1,11</mml:mn></mml:mrow></mml:mfenced></mml:math></inline-formula> . The confounding rhythm frequency assumes a range of integer values from 1 to 11 Hz. We note that replacing the constant phase shift (<inline-formula><mml:math id="inf48"><mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mo>/</mml:mo><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula>) with a randomly selected (uniform <inline-formula><mml:math id="inf49"><mml:mfenced close="]" open="[" separators="|"><mml:mrow><mml:mo>-</mml:mo><mml:mi>π</mml:mi><mml:mo>,</mml:mo><mml:mi>π</mml:mi></mml:mrow></mml:mfenced></mml:math></inline-formula>) phase shift produces qualitatively consistent results. The confounding rhythm amplitude ranges from 0.2 to 2 times the amplitude of the target rhythm, in increments of 0.2.</p></sec><sec id="s2-6-3"><title>Phase reset</title><p>Ongoing slow rhythms in the brain occasionally undergo a sudden shift in phase. This can occur both in response to a stimulus or as a result of ongoing spontaneous neural dynamics (<xref ref-type="bibr" rid="bib58">Voloh and Womelsdorf, 2016</xref>). To simulate sudden changes in a rhythm’s phase, we implement a pure sinusoid (6 Hz) with additive pink noise and impose phase slips at four distinct time points, separated by at least 1 s. We fix the extent of phase slip, relative to the previous phase, at <inline-formula><mml:math id="inf50"><mml:mrow><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mo>/</mml:mo><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula> . However, the phase at which the slip occurs differs across the four time points (see example in Figure 4A). We simulate the signal in five intervals, as follows:<disp-formula id="equ20"><label>(15)</label><mml:math id="m20"><mml:mrow><mml:mi>Y</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo>&lt;</mml:mo><mml:mi>T</mml:mi><mml:mo>&lt;</mml:mo><mml:mn>3.5</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>10</mml:mn><mml:mi>cos</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mo>∗</mml:mo><mml:mn>6</mml:mn><mml:mo>∗</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:msub><mml:mi>ϵ</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></disp-formula><disp-formula id="equ21"><mml:math id="m21"><mml:mrow><mml:mi>Y</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>3.5</mml:mn><mml:mo>&lt;</mml:mo><mml:mi>T</mml:mi><mml:mo>&lt;</mml:mo><mml:mn>4.75</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>10</mml:mn><mml:mi>cos</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mo>∗</mml:mo><mml:mn>6</mml:mn><mml:mo>∗</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>T</mml:mi><mml:mo>−</mml:mo><mml:mn>3.5</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mfrac><mml:mi>π</mml:mi><mml:mn>2</mml:mn></mml:mfrac><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:msub><mml:mi>ϵ</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></disp-formula><disp-formula id="equ22"><mml:math id="m22"><mml:mrow><mml:mi>Y</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>4.75</mml:mn><mml:mo>&lt;</mml:mo><mml:mi>T</mml:mi><mml:mo>&lt;</mml:mo><mml:mn>6.5</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>10</mml:mn><mml:mi>cos</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mo>∗</mml:mo><mml:mn>6</mml:mn><mml:mo>∗</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>T</mml:mi><mml:mo>−</mml:mo><mml:mn>4.75</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:msub><mml:mi>ϵ</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></disp-formula><disp-formula id="equ23"><mml:math id="m23"><mml:mrow><mml:mi>Y</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>6.5</mml:mn><mml:mo>&lt;</mml:mo><mml:mi>T</mml:mi><mml:mo>&lt;</mml:mo><mml:mn>8.75</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>10</mml:mn><mml:mi>cos</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mo>∗</mml:mo><mml:mn>6</mml:mn><mml:mo>∗</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>T</mml:mi><mml:mo>−</mml:mo><mml:mn>6.5</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mfrac><mml:mi>π</mml:mi><mml:mn>2</mml:mn></mml:mfrac><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:msub><mml:mi>ϵ</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></disp-formula><disp-formula id="equ24"><mml:math id="m24"><mml:mrow><mml:mi>Y</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>8.75</mml:mn><mml:mo>&lt;</mml:mo><mml:mi>T</mml:mi><mml:mo>&lt;</mml:mo><mml:mn>10</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>10</mml:mn><mml:mi>cos</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mo>∗</mml:mo><mml:mn>6</mml:mn><mml:mo>∗</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>T</mml:mi><mml:mo>−</mml:mo><mml:mn>8.75</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:msub><mml:mi>ϵ</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></disp-formula><disp-formula id="equ25"><mml:math id="m25"><mml:mrow><mml:mi>P</mml:mi><mml:mi>S</mml:mi><mml:mi>D</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>ϵ</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>∼</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:msup><mml:mi>f</mml:mi><mml:mrow><mml:mn>1.5</mml:mn></mml:mrow></mml:msup></mml:mfrac></mml:mrow></mml:math></disp-formula></p></sec></sec><sec id="s2-7"><title>Signal-to-noise ratio</title><p>To investigate the impact of SNR on phase estimation, we again simulate a filtered pink noise signal (centered at 6 Hz) with added pink noise (the third type of rhythm simulated in Materials and methods: Narrowband to broadband rhythms). To modulate the SNR, we first compute:<disp-formula id="equ26"><mml:math id="m26"><mml:mrow><mml:mi>S</mml:mi><mml:mi>N</mml:mi><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>n</mml:mi><mml:mi>a</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>o</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf51"><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>n</mml:mi><mml:mi>a</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> (<inline-formula><mml:math id="inf52"><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mi>o</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>) is the standard deviation of the filtered pink noise signal (added pink noise). We then divide the filtered pink noise signal by SNR<sub>0</sub>, multiply the filtered pink noise signal by the chosen SNR (1, 2.5, 5, 7.5, 10), and add this scaled signal to the pink noise.</p></sec><sec id="s2-8"><title>In vivo data</title><p>We consider two datasets to demonstrate how the SSPE method performs in vivo. The first dataset consists of LFP activity collected from the infralimbic cortex in rats. LFP were acquired continuously at 30 kHz (Open Ephys, Cambridge, MA). An adaptor connected the recording head stage (RHD 2132, Intan Technologies LLC, Los Angeles, CA) to two Mill-max male-male connectors (eight channels each, Part number: ED90267-ND, Digi-Key Electronics, Thief River Falls, MN). For additional details on data collection, please refer to <xref ref-type="bibr" rid="bib34">Lo et al., 2020</xref>. We analyze here 250 s of LFP data from one channel. Before real-time phase estimation, we downsample the data to 1000 Hz (with a low pass filter at 100 Hz to prevent aliasing) for computational speed. To model these data, we fit three oscillators with the SSPE method, with the goal of tracking a target theta rhythm (defined as 4–11 Hz). Motivated by an initial spectral analysis of these data, we choose one oscillator to capture low-frequency delta band activity (<inline-formula><mml:math id="inf53"><mml:msub><mml:mrow><mml:mi>ω</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:math></inline-formula> Hz, based on spectral peak), one to capture the theta band rhythm of interest (<inline-formula><mml:math id="inf54"><mml:msub><mml:mrow><mml:mi>ω</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>7</mml:mn></mml:math></inline-formula> Hz), and a final oscillator to track high-frequency activity (<inline-formula><mml:math id="inf55"><mml:msub><mml:mrow><mml:mi>ω</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>40</mml:mn></mml:math></inline-formula> Hz). We estimate these model parameters (so center frequencies may change) using the first 10 s of LFP data, and then fix these model parameters to estimate future phase values (up to 250 s). In doing so, we assume that the same oscillator models in the SSPE method remain appropriate for the entire duration of the LFP recording.</p><p>The second dataset was derived from the publicly available data in <xref ref-type="bibr" rid="bib65">Zrenner et al., 2020</xref>. The data consist of spatially filtered and downsampled scalp EEG recordings from electrode C3 (over central areas), which records a strong somatosensory mu rhythm (8–13 Hz). For details on data collection and preprocessing, see <xref ref-type="bibr" rid="bib65">Zrenner et al., 2020</xref>. We analyze 250 s of data from a single participant for demonstration purposes. For these data, before the real-time phase estimation step, we first apply a moving average causal filter (using 3 s of past data for each new data point) to remove slow drifts. We again track three oscillators in the SSPE method, with the goal of estimating phase from the mu rhythm: one in the delta band (<inline-formula><mml:math id="inf56"><mml:msub><mml:mrow><mml:mi>ω</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>2</mml:mn></mml:math></inline-formula> Hz), one centered at the mu rhythm (<inline-formula><mml:math id="inf57"><mml:msub><mml:mrow><mml:mi>ω</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:math></inline-formula> Hz), and one in the beta band (<inline-formula><mml:math id="inf58"><mml:msub><mml:mrow><mml:mi>ω</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>22</mml:mn></mml:math></inline-formula> Hz). We note that these frequency values initialize the model and are then tracked in time. In analyzing the mu rhythm, we ensured that phase was estimated from an oscillator whose frequency was in the mu rhythm range, that is, 8–12 Hz.</p><p>For the in vivo data, the true phase is unknown. To estimate phase error, we define the true phase as follows: first, we select a 10 s segment centered on the 1 s interval of the phase estimate. We then fit the state space model (<xref ref-type="disp-formula" rid="equ1">Equations 1-4</xref>) acausally to this 10 s segment and estimate the phase in the 1 s interval at the segment’s center. We note that here, the phase estimate is acausal because we use forward and backward smoothing of the state estimate when estimating the analytic signal. We also note that, in some segments, the frequency band of interest may not be identified through EM due to low signal strength. When this occurred, we omit error in the phase estimates, as these intervals lack the frequency of interest.</p></sec><sec id="s2-9"><title>Real-time implementation in TORTE</title><p>To make SSPE more broadly available, we implemented SSPE into the real-time TORTE (Toolkit for Oscillatory Real-time Tracking and Estimation) system (<ext-link ext-link-type="uri" xlink:href="https://github.com/tne-lab/phase-calculator">https://github.com/tne-lab/phase-calculator</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.2548743">10.5281/zenodo.2633295</ext-link>). TORTE is built upon the Open Ephys platform (<ext-link ext-link-type="uri" xlink:href="https://open-ephys.org/">https://open-ephys.org/</ext-link>) and can be used with a broad range of electrophysiologic acquisition devices. Phase outputs and triggers from the system can be used to drive presentation of psychophysical stimuli or delivery of optical/electrical/magnetic stimulation. We directly integrated the MATLAB-based SSPE algorithm described above into C++ for improved efficiency. TORTE uses a buffer-based approach to receive data, based on the buffered approach of the underlying Open Ephys system. New buffers are repeatedly received by TORTE containing the most recent neural data. These buffers are subject to system latency causing a delay between activity in the brain being received by the toolkit. Both the buffer size and latency individually vary from microseconds to a few milliseconds depending on the acquisition system used. The phase of each sample within the buffer is estimated using SSPE. A detector continuously monitors the estimated phase and can trigger output logic at any desired phase. We note that the observation noise parameter (<italic>Q</italic>) is defaulted to 50, but should be updated by the user to the square root of the amplitude. Two modifications were needed to integrate SSPE into TORTE. For computational efficiency, data were downsampled before application of the SSPE algorithm, and then the resulting phase estimates were upsampled back to the native sampling rate. The Open Ephys system can provide buffer sizes that are not exactly divisible into downsampled buffers. When this occurs, the phase estimates at the end of the upsampled buffer cannot be generated from the downsampled SSPE result. To account for this, an additional predicted state sample (with credible intervals) is computed by forward filtering using <xref ref-type="disp-formula" rid="equ1">Equations 07; 08</xref>. This extra value is inserted at the end of the downsampled buffer. This provides an extra data point in the SSPE result that can be used to generate the remainder of samples for the upsampled phase output buffer. The second modification results from the real-time data acquisition by TORTE. In this case, low pass filtering must be causal, not the acausal (i.e., forward-backward filtering) used in the MATLAB implementation. To account for the consistent phase shift introduced in a real-time system, TORTE includes an online learning algorithm that adjusts target phase thresholding to improve event timings in closed loop applications. We test the real-time implementation on an AMD FX-8350 CPU with 16 GB RAM.</p></sec><sec id="s2-10"><title>Code availability</title><p>The code to perform this analysis is available for reuse and further development at MATLAB (<ext-link ext-link-type="uri" xlink:href="https://github.com/Eden-Kramer-Lab/SSPE-paper">https://github.com/Eden-Kramer-Lab/SSPE-paper</ext-link>, copy archived at <ext-link ext-link-type="uri" xlink:href="https://archive.softwareheritage.org/swh:1:dir:61862faff152de83f54ce17fe43cb19a7091f71d;origin=https://github.com/Eden-Kramer-Lab/SSPE-paper;visit=swh:1:snp:0f67f7c5cce107dd9e7e415b876ad174a3254a28;anchor=swh:1:rev:6d80fe9c5f610d0dfffe23b5eef2012f780ba621">swh:1:rev:6d80fe9c5f610d0dfffe23b5eef2012f780ba621</ext-link>, <xref ref-type="bibr" rid="bib39">Mark, 2021b</xref>) and Open Ephys (<ext-link ext-link-type="uri" xlink:href="https://github.com/tne-lab/phase-calculator">https://github.com/tne-lab/phase-calculator</ext-link>, copy archived at <ext-link ext-link-type="uri" xlink:href="https://archive.softwareheritage.org/swh:1:dir:ae4fe43a6d1a3666ed5027098adebba48a852b1d;origin=https://github.com/tne-lab/phase-calculator;visit=swh:1:snp:f83e3de7bd2a19f1a537971992fad49dac910b73;anchor=swh:1:rev:e11421f23403399ca6b2d85132a31e2c1d5b1397">swh:1:rev:e11421f23403399ca6b2d85132a31e2c1d5b1397</ext-link>, <xref ref-type="bibr" rid="bib38">Mark, 2021a</xref>).</p></sec></sec><sec id="s3" sec-type="results"><title>Results</title><p>We first examine in simulations the viability of different causal phase estimation algorithms, and how these existing methods compare to the proposed method – the SSPE. In these simulations, we vary the nature of the underlying rhythm of interest – either the spectral bandwidth or the noise/confounding signal present. Through these simulations, we examine the assumptions under which different methods perform best at estimating the phase in real-time. We then illustrate the application of the SSPE method to in vivo data in two case studies: a rodent LFP and a human EEG.</p><sec id="s3-1"><title>SSPE accurately tracks the phase of a single oscillation</title><p>To test the accuracy of causal estimates of phase, we simulate rhythms with different spectral profiles in four different ways. For the first two rhythms, we simulate a 6 Hz sinusoid and add either white noise (constant power spectrum, ‘sine in white noise’, <xref ref-type="fig" rid="fig2">Figure 2A</xref>.i) or pink noise (power spectrum decreases with the reciprocal of frequency, ‘sine in pink noise’, <xref ref-type="fig" rid="fig2">Figure 2A</xref>.ii). For the next simulation scenario, to generate a broadband spectral peak, we filter pink noise into the band of interest using an FIR filter (4–8 Hz, ‘filtered pink noise’, see Materials and methods), amplify this signal, and then add additional (unfiltered) pink noise (<xref ref-type="fig" rid="fig2">Figure 2A</xref>.iii). For the last simulation, to generate the signal of interest we sample data from the model underlying the SSPE method. The state space harmonic oscillator model (‘state space model’) consists of a damped harmonic oscillator driven by noise (the signal) with additive white noise (<xref ref-type="fig" rid="fig2">Figure 2A</xref>.iv). We note that, for the first two simulation approaches in which the signal is a pure sinusoid, the true phase is known. For the ‘filtered pink noise’ simulation, we estimate the phase by applying the Hilbert transform to the signal before adding noise (see Materials and methods). For the ‘state space model’ simulation, we determine phase directly from the model (see Materials and methods). Thus, in all simulation scenarios, we have an independent measure of the true phase.</p><p>We repeat each simulation 1000 times with different noise instantiations and calculate error as the circular variance of the difference between the estimated phase and true phase (see Materials and methods). We find that for rhythms with narrowband spectral peaks (sine in white noise and sine in pink noise, <xref ref-type="fig" rid="fig2">Figure 2B and C</xref>), all estimators perform well, and those estimators that presume a narrowband signal (i.e., the filter-based approaches) perform best. However, for rhythms with broad spectral peaks (filtered pink noise and state space model, <xref ref-type="fig" rid="fig2">Figure 2B and C</xref>), the SSPE method outperforms the other causal approaches. Moreover, the SSPE method performs as well as (filtered pink noise), or better than (state space model), the acausal FIR method. In what follows, we further explore the implications of this result and the impact on assessment of phase estimator performance. We conclude that the SSPE method performs well in all four simulation scenarios and outperforms existing causal phase estimation methods in two instances with broad spectral peaks.</p></sec><sec id="s3-2"><title>SSPE accurately tracks the phase of two simultaneous oscillations</title><p>To replicate a situation that has been documented in EEG (e.g., multiple alpha rhythms coexisting) (<xref ref-type="bibr" rid="bib57">VanRullen, 2016</xref>) and in LFP (e.g., multiple theta/alpha rhythms in hippocampus) (<xref ref-type="bibr" rid="bib56">Tort et al., 2010</xref>), we simulate two rhythms with similar frequencies. In this situation, phase estimation requires an approach to identify the presence of two rhythms and target the rhythm of interest. This simulation examines the impact of choosing a specific, previously specified, frequency response to isolate the rhythm of interest, as required by the two comparative causal phase estimation methods implemented here. In some cases, a finely tuned bandpass filter may separate the two rhythms, although such a filter requires sufficient prior knowledge and may be difficult to construct, particularly if the center frequencies are not perfectly stationary. The SSPE method provides an alternative approach to identify the two (or potentially more) rhythms without filtering and then allows tracking of the appropriate target rhythm. Further, while we focus on the phase of the target rhythm here, we note that the SSPE method provides estimates of the amplitude and phase of all modeled rhythms.</p><p>To illustrate this scenario, we simulate two slow rhythms at different frequencies. We set the target rhythm as a 6 Hz sinusoid with fixed amplitude, and the confounding rhythm as a 5 Hz sinusoid with 1.5 times the 6 Hz amplitude (<xref ref-type="fig" rid="fig3">Figure 3A</xref>). The observed signal consists of the combined target and confounding rhythms, plus white noise, simulated for 15 s. We apply each phase estimation method to the observed signal, and estimate the phase of the target rhythm after fitting parameters with 5 s of initial data. Visual inspection for this example (<xref ref-type="fig" rid="fig3">Figure 3B</xref>) suggests that only the SSPE method accurately tracks the target phase.</p><fig id="fig3" position="float"><label>Figure 3.</label><caption><title>SSPE performs well when two oscillations exist at nearby frequencies.</title><p>(<bold>A</bold>) Example observed signal (black) and phase for two simulated rhythms, the confounding rhythm at 5 Hz (blue) and the target rhythm at 6 Hz (red). (<bold>B</bold>) Example phase estimates for the target rhythm in (<bold>A</bold>) using four different approaches (see legend). (<bold>C</bold>) Estimation error (circular standard deviation, see scale bars) for each estimation method as a function of frequency and amplitude of the confounding oscillation. In all cases the error increases as the frequency of the confounding oscillation approaches 6 Hz (the frequency of the target oscillation), and as the amplitude of the confounding oscillation increases.</p><p><supplementary-material id="fig3sdata1"><label>Figure 3—source data 1.</label><caption><title>Circular standard deviation for all methods on two simultaneous oscillations simulation.</title></caption><media mime-subtype="mat" mimetype="application" xlink:href="elife-68803-fig3-data1-v2.mat"/></supplementary-material></p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-68803-fig3-v2.tif"/></fig><p>Repeating this analysis with the confounding amplitude and frequency varied across a range of values (frequencies 1–11 Hz and amplitudes 20–200% of the target rhythm; see Materials and methods), we find consistent results. For all methods, the error increases as the frequency of the confounding rhythm approaches the frequency of the target rhythm (6 Hz, <xref ref-type="fig" rid="fig3">Figure 3C</xref>). However, the increased error is restricted to a narrower frequency interval for the SSPE method. For the existing causal phase estimators, the error likely reflects choices in the filtering procedure (i.e., type of filter, features of passband and stopband, window size, see <xref ref-type="bibr" rid="bib46">Sameni and Seraj, 2017</xref>) and modeling procedure (i.e., AR order, number of samples forecasted; <xref ref-type="bibr" rid="bib11">Chen et al., 2013</xref>; <xref ref-type="bibr" rid="bib65">Zrenner et al., 2020</xref>). Similarly, for the acausal FIR estimator, the error likely reflects the filter passband of 4–8 Hz, with increasing error as the confounding rhythm nears the 6 Hz target rhythm. For the existing causal and acausal methods, error also increases as the confounding oscillation amplitude increases (<xref ref-type="fig" rid="fig3">Figure 3C</xref>).</p><p>Previously, we showed that all estimation methods performed well for a signal consisting of a single sinusoid in white noise (see <xref ref-type="fig" rid="fig2">Figure 2</xref>, sine in white noise). Here, we show that for a signal consisting of two sinusoids in white noise, the SSPE method outperforms the existing methods. Unlike these existing methods, the SSPE method estimates parameters for both the target and confounding rhythms, and tracks each oscillation independently. By doing so, the SSPE method accounts for the confounding effect of the nearby oscillation and allows more accurate tracking of the target rhythm. We conclude that the SSPE method outperforms these existing methods in the case of two simultaneous rhythms with nearby frequencies.</p></sec><sec id="s3-3"><title>Phase estimation following phase reset</title><p>Phase resets are defined as consecutive samples of data that show a sudden shift in the oscillatory phase, proposed to represent the presence of synchronization of a neural mass in response to a stimulus, for example (<xref ref-type="bibr" rid="bib32">Lakatos et al., 2009</xref>). Phase resets are common and well documented in electrophysiologic recordings (<xref ref-type="bibr" rid="bib15">Fiebelkorn et al., 2011</xref>; <xref ref-type="bibr" rid="bib35">Makeig et al., 2004</xref>). Recent work delivering electrical stimulation based on phase of the theta rhythm has been forced to avoid segments with phase resets to reduce error in real-time phase estimation (<xref ref-type="bibr" rid="bib20">Gordon et al., 2021</xref>). Further, accurate tracking of phase resets would provide better evidence for the relevance of phase resetting in generating event related potentials (<xref ref-type="bibr" rid="bib47">Sauseng et al., 2007</xref>) – an analysis that could also be performed acausally<ext-link ext-link-type="uri" xlink:href="https://www.zotero.org/google-docs/?ZOBW5s">.</ext-link> We examine the performance of each phase estimation method in the presence of simulated phase resets.</p><p>To do so, we simulate phase reset as a shift in the phase of a 6 Hz sinusoid by 90 degrees at four points in a 10 s signal (example in <xref ref-type="fig" rid="fig4">Figure 4A</xref>). We then compute the error of each phase estimation method in the 167 ms (one period of a 6 Hz rhythm) following the phase reset. Visual inspection of an example phase reset (<xref ref-type="fig" rid="fig4">Figure 4B</xref>) suggests that only the SSPE method accurately tracks the phase in the interval following the reset. We note that we fit SSPE parameters using an initial 2 s interval containing no phase resets (<xref ref-type="disp-formula" rid="equ20">Equation 15</xref>). Repeating this analysis for 1000 simulated signals (4000 total phase resets), we find consistent results; the error of the SSPE method is significantly lower than the error of the other methods (p ~ 0 in all cases using two-sided t-test, see <xref ref-type="table" rid="table1">Table 1</xref>). These results demonstrate that the existing causal and acausal methods implemented here are unable to estimate the phase accurately immediately after a phase reset. To determine how quickly each method returned to accurate phase estimation, we first estimated the pre-stimulus average error for each method, prior to the first phase reset, over a 500 ms interval. We then determined the time between each subsequent phase reset and the moment when the error reduced to 1.5 times the pre-stimulus error. Note that the level of pre-stimulus error differs across methods, so, for example, we determine when the SSPE converges to a lower error than the Blackwood method. We find that each method eventually converged to accurate phase estimation after a phase reset, with the SSPE method converging most rapidly (<xref ref-type="table" rid="table1">Table 1</xref>). The differences between methods likely result from the windowing used by each method when estimating the phase; smaller windows will lead to less impact of the phase reset on the error (as seen with the Blackwood approach converging more quickly than the Zrenner method), with the SSPE needing a window of a single sample.</p><fig id="fig4" position="float"><label>Figure 4.</label><caption><title>The state space phase estimate (SSPE) accurately tracks phase following a phase reset.</title><p>(<bold>A</bold>) Example phase of a 6 Hz sinusoid (blue) with four phase resets (red dashed lines). (<bold>B</bold>) Example phase estimates (thin curves) and the true phase (thick blue curve) at the indicated phase reset in (<bold>A</bold>). The SSPE method (in green) tracks the true phase much more closely than other methods following a phase reset.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-68803-fig4-v2.tif"/></fig><table-wrap id="table1" position="float"><label>Table 1.</label><caption><title>Error following phase reset for different phase estimation methods.</title><p><supplementary-material id="table1sdata1"><label>Table 1—source data 1.</label><caption><title>Circular standard deviation and convergence time information for phase reset simulation.</title></caption><media mime-subtype="zip" mimetype="application" xlink:href="elife-68803-table1-data1-v2.zip"/></supplementary-material></p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" valign="top"/><th align="left" valign="top">SSPE</th><th align="left" valign="top">Blackwood</th><th align="left" valign="top">Zrenner</th><th align="left" valign="top">Acausal FIR</th></tr></thead><tbody><tr><td align="left" valign="top">Error (std. dev.)</td><td align="char" char="." valign="top">2.85 (0.89)<xref ref-type="table-fn" rid="table1fn1">*</xref></td><td align="char" char="." valign="top">62.08 (0.38)</td><td align="char" char="." valign="top">44.68 (0.38)</td><td align="char" char="." valign="top">15.04 (0.23)</td></tr><tr><td align="left" valign="top">Time to convergence(std. dev.)</td><td align="char" char="." valign="top"><italic>34 ms (162</italic>)</td><td align="char" char="." valign="top"><italic>190</italic> ms (<italic>33</italic>)</td><td align="char" char="." valign="top"><italic>747 ms (22</italic>)</td><td align="char" char="." valign="top"><italic>555 ms (206</italic>)</td></tr></tbody></table><table-wrap-foot><fn id="table1fn1"><label>*</label><p>p~0 compared to all other methods.</p></fn></table-wrap-foot></table-wrap><p>We note that these existing methods all require a bandpass filtering step, which limits the fastest rate at which the phase can change (instantaneous frequency <xref ref-type="bibr" rid="bib3">Boashash, 1991</xref>). The SSPE method, however, does not require the phase change within a limited range of instantaneous frequencies and therefore can track rapid changes in phase. We conclude that the SSPE method is able to most rapidly track the true phase after a phase reset and thus provides the most accurate estimate.</p></sec><sec id="s3-4"><title>Phase estimation with different SNR</title><p>To demonstrate the impact of noise on phase estimation, we simulate signals with different SNR. To generate a signal we filter pink noise into the band of interest (see Materials and methods: Signal-to-noise ratio), and then add additional (unfiltered) pink noise. The ratio of the standard deviations of the signal and noise defines the SNR; we modulate the standard deviation of the signal to achieve the desired SNR. Finally, we normalize the full observation so that amplitudes across simulations are consistent. In these simulations the SNR varies from 1 (signal and noise have the same total power) to 10 (signal has 100 times the total power of the noise); see example traces of the observation under each SNR in <xref ref-type="fig" rid="fig5">Figure 5A</xref>.i–iv, and see example spectra under each SNR in <xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1</xref>. We repeat each simulation 1000 times with different noise instantiations for each SNR.</p><fig-group><fig id="fig5" position="float"><label>Figure 5.</label><caption><title>State space phase estimate (SSPE) tracks an oscillatory signal with less error across a range of signal-to-noise ratios (SNR).</title><p>(<bold>A</bold>) Example 2 s of simulated observed data (thick curves) and true phase (thin blue curves) for each SNR value. (<bold>B</bold>) For each SNR, (i) the average credible interval width (colored circles) of the SSPE method for all simulation iterations, and (ii) the average amplitude of the estimated signal (colored circles) for all simulation iterations. White circles (horizontal gray lines) indicate median (25th and 75th percentiles) values for each SNR. (<bold>C</bold>) The phase error for each estimation method (see legend) and simulation SNR. In each box plot, the central mark indicates the median; the bottom and top edges of the box indicate the 25th and 75th percentiles, respectively; the whiskers indicate the most extreme data points not considered outliers.</p><p><supplementary-material id="fig5sdata1"><label>Figure 5—source data 1.</label><caption><title>Circular standard deviation for all methods on signal-to-noise ratio (SNR) simulation.</title></caption><media mime-subtype="mat" mimetype="application" xlink:href="elife-68803-fig5-data1-v2.mat"/></supplementary-material></p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-68803-fig5-v2.tif"/></fig><fig id="fig5s1" position="float" specific-use="child-fig"><label>Figure 5—figure supplement 1.</label><caption><title>Example power spectra for all simulated cases.</title><p>At each signal-to-noise ratio (SNR), for a smooth spectrum, we used 15 s of data and applied the multitaper method with 29 tapers and a bandwidth of 1 Hz. The SNR is controlled by shifting the power of the signal relative to the pink noise, demonstrated by the changing height of the peak at 6 Hz above the noise.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-68803-fig5-figsupp1-v2.tif"/></fig></fig-group><p>We compute two metrics to characterize the impact of signal-to-noise on phase estimation. First, we consider the credible intervals estimated by the SSPE, here measured as the average credible interval width throughout a simulation. As expected, the credible intervals track with the SNR (<xref ref-type="fig" rid="fig5">Figure 5B</xref>.i); signals with higher SNR correspond to smaller credible intervals. Computing the average amplitude (as derived from the acausal FIR, see <italic>Methods: Non-Causal Phase Estimation</italic>) throughout each simulation, we find no overlap between the distributions of amplitudes at SNR = 1 and SNR = 2.5 (<xref ref-type="fig" rid="fig5">Figure 5.ii</xref>), while the distributions of credible intervals overlap. This suggests that, at low SNR, an arbitrary amplitude threshold (e.g., amplitude &gt;1) would eliminate all data at SNR = 1 and preserve all data at SNR = 2.5. Alternatively, using the credible interval width allows identification of transient periods of confidence (e.g., credible interval width &lt;40 degrees) at both SNR values. We also note that the credible interval width – in units of degrees – provides a more intuitive threshold than the amplitude, whose intrinsic meaning at any particular value is only understood relatively. These results suggest that, in this simulation study, amplitude serves as a less accurate criterion for confidence in phase compared to the credible interval width.</p><p>Second, we consider the error in phase estimates using four different phase estimation methods (<xref ref-type="fig" rid="fig5">Figure 5C</xref>). We find that the error for the SSPE method reduces more quickly than for the other methods, and at an SNR of 1, the SSPE method is comparable to or better than the contemporary methods of real-time phase estimation. At SNR = 10, the error in the SSPE phase estimation is comparable to the acausal FIR, while the alternative real-time algorithms continue to perform with error similar to an SNR of 1. These results suggest that, for the two existing real-time phase estimation methods, broadband rhythms are difficult to track even with high SNR, consistent with <xref ref-type="fig" rid="fig2">Figure 2C</xref>.</p></sec><sec id="s3-5"><title>Example in vivo application: rodent LFP</title><p>Having confirmed the SSPE method performs well in simulation, we now illustrate its performance in example in vivo recordings. We first apply the SSPE method to an example LFP recording from rodent infralimbic cortex (see Materials and methods), which contains frequent intervals of theta band (4–8 Hz) activity. Unlike the simulated data considered above, in the in vivo signal, the target rhythm changes in time (e.g., time intervals exist with, and without, the theta rhythm). Accurate application of the SSPE method requires accurate estimation of the parameters defining the oscillators in the SSPE model. In the simulated data, the stationary target rhythm allowed consistent SSPE model parameter estimation from (any) single interval in time; in those simulations, we estimated the SSPE model parameters from a single, early time interval (see Materials and methods) and then used those (fixed) model parameters for future causal phase estimates.</p><p>For the in vivo data, in which the target rhythm may change in time, model estimates from an initial time may be inappropriate – and produce inaccurate phase estimates – at a later time. However, comparing the estimated phase to the true phase (see Materials and methods), we find that the phase error tends to remain consistent in time (blue curve in <xref ref-type="fig" rid="fig6">Figure 6A</xref>; circular standard deviation 95% interval = [33.11, 75.39]; for error of phase estimates computed using alternative methods, see <xref ref-type="fig" rid="fig6s1">Figure 6—figure supplement 1</xref>). We find no evidence of a linear trend in error with time (linear fit, slope = 0.01, p = 0.53); that is, we find no evidence that the error increases in time. Instead, visual inspection suggests that the error increases when the spectral content of the LFP changes (e.g., near 120 s in <xref ref-type="fig" rid="fig6">Figure 6B</xref>). We note that the error bounds are within the bounds of the range expected for real-time phase estimates in <xref ref-type="bibr" rid="bib65">Zrenner et al., 2020</xref>. Finally, we note that visual inspection of the PSD (<xref ref-type="fig" rid="fig6">Figure 6C</xref>) demonstrates that the theta band power appears more closely matched by a broadband peak, rather than a narrowband peak.</p><fig-group><fig id="fig6" position="float"><label>Figure 6.</label><caption><title>Any interval with a prominent rhythm of interest (here: theta) can be used to fit state space phase estimate (SSPE) parameters.</title><p>(<bold>A</bold>) The phase error for a single instance of the model fit (using data at times 10–20 s, blue curve), and the 90% interval for phase error (red bands) at time <italic>t</italic> derived using parameter estimates from all models estimated with data prior to <italic>t</italic>. The moments where no error is reported are moments when an acausal approach failed to detect the theta band rhythm. Right: a histogram of circular deviation across all time demonstrating that error remains below 60 degrees in the majority of cases. (<bold>B</bold>) Corresponding spectrogram of the rodent local field potential (LFP) data (multitaper method with window size 10 s, window overlap 9 s, frequency resolution 2 Hz, and 19 tapers). (<bold>C</bold>) Average power spectral density (PSD) of (<bold>B</bold>) over all times with theta band oscillator identified in (<bold>A</bold>). The mean PSD (dark blue) and 95% confidence intervals (light blue) reveal a broadband peak in the theta band.</p><p><supplementary-material id="fig6sdata1"><label>Figure 6—source data 1.</label><caption><title>Error and spectrogram for in vivo local field potential (LFP) data.</title></caption><media mime-subtype="mat" mimetype="application" xlink:href="elife-68803-fig6-data1-v2.mat"/></supplementary-material></p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-68803-fig6-v2.tif"/></fig><fig id="fig6s1" position="float" specific-use="child-fig"><label>Figure 6—figure supplement 1.</label><caption><title>The state space phase estimate (SSPE) method performs optimally across algorithms when tracking local field potential (LFP) theta.</title><p>The error (circular deviation) in performance of each algorithm across all LFP data. Each dot represents the error computed for 1 s of data. To compute the error, we compare the real-time phase estimate of each method to an acausally derived estimate of the phase by fitting the state space model (see Materials and methods: In vivo data). The SSPE method shows performance comparable to the acausal finite impulse response (FIR).</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-68803-fig6-figsupp1-v2.tif"/></fig></fig-group><p>An alternative approach is to re-estimate the SSPE model parameters over time. By allowing the parameters of the model oscillators to change in time, this approach may improve the accuracy of the phase estimates. To examine this in the in vivo data, we refit the SSPE model parameters in each 10 s interval of the LFP data. More specifically, we refit model parameters in every 10 s interval of the 250 s recording, incrementing the 10 s interval by 1 s, to create 240 models. We then use each of these models to causally estimate the phase for all future times. For example, we use the SSPE model with parameters estimated from the interval 40–50 s to then estimate the phase for data after 50 s. We compute the error in the phase estimates for all 240 models to assess whether refitting the SSPE model parameters impacts future phase estimates. We find no evidence that the distribution of phase errors changes for the refit models compared to the original fixed parameter model for the immediate 30 s that followed (p = 0.21, Wilcoxon rank sum test) or for the entire time period analyzed (red interval in <xref ref-type="fig" rid="fig6">Figure 6A</xref>, circular standard deviation 95% interval = [30.68, 88.7] degrees; p = 0.35 using Wilcoxon rank sum test). The original fixed parameter SSPE model (fit using the first 10 s of data; blue curve in <xref ref-type="fig" rid="fig6">Figure 6A</xref>) performs as well as the models refit with future data. We conclude that, under the assumption that parameters for the frequency band of interest are stable, we are able to estimate the SSPE model parameters whenever there exists a consistent rhythm of interest and then apply this model to estimate phase at future times (here on the scale of hundreds of seconds). In other words, for these data, any 10 s interval with sufficiently strong theta rhythm can be used to fit parameters before the model is applied causally. This result has an important practical implication; the SSPE model parameters can be fit using an initial segment of data, and then applied to derive causal estimates of future phase values. In other words, the model has robust estimation properties; parameters estimated early in the recording remain appropriate for future observations.</p><p>In addition, these results allow a novel insight into the rhythmic activity of the data, beyond those available using traditional methods. Typical analysis of neural rhythms either presumes the presence of a rhythm (for subsequent filtering) or operates in the frequency domain using the PSD and statistical testing to identify significant rhythms. Here, through direct fitting of the state space model to the time series data, we find consistent model parameters that accurately track the observed theta rhythm. This consistency is maintained through variations in the rhythm’s amplitude. These observations suggest that the theta rhythm in infralimbic LFP maintains a consistent underlying rhythmic structure over the entire duration of the observation.</p><sec id="s3-5-1"><title>Confidence in the phase estimate</title><p>Past approaches to causally estimate phase have not attempted to quantify confidence in the phase estimate beyond utilizing the amplitude as a surrogate (<xref ref-type="bibr" rid="bib65">Zrenner et al., 2020</xref>). However, using the amplitude assumes a monotonic linear relationship between the phase confidence bounds and the amplitude, which may not be true (e.g., for an AR(2) process with complex roots, <xref ref-type="bibr" rid="bib55">Spyropoulos et al., 2019</xref>). Unlike existing methods, the SSPE method provides real-time estimates of the credible interval estimates for the phase (resulting from estimating the parameters of the SSPE model and tracking the phase using the Kalman filter; see Materials and methods). To illustrate this, we show the phase and credible interval estimates of the SSPE method for an example 3 s interval of the LFP data (<xref ref-type="fig" rid="fig7">Figure 7</xref>; for comparison to phase estimates computed using alternative methods, see <xref ref-type="fig" rid="fig7s1">Figure 7—figure supplement 1</xref>). We note that, during a prominent theta rhythm, the credible intervals tightly track the mean phase estimate; at other times – when the theta rhythm is less obvious – the credible intervals expand. We can restrict error in the phase estimate by examining only samples with small CI width. When thresholding at 10 degrees of credible interval width, we find that the error decreases from (mean) 46.9 (s.e. 0.89) degrees to 26.91 (s.e. 1.07) degrees, while still retaining 27% of the data. This is within the current state-of-the-art in phase estimation with minimum of 20–40 degrees error as a function of SNR (when applying a sufficiently high amplitude threshold, <xref ref-type="bibr" rid="bib65">Zrenner et al., 2020</xref>).</p><fig-group><fig id="fig7" position="float"><label>Figure 7.</label><caption><title>State space phase estimate (SSPE) tracks in vivo credible intervals for the phase.</title><p>(<bold>A</bold>) Example rodent local field potential (LFP) data (red, solid) with a consistent broadband peak in the theta band (4–8 Hz). The estimated state of the SSPE method (purple, dashed) tracks the observed LFP. (<bold>B</bold>) Phase estimates (purple, dashed) and credible intervals (red, shaded) for the example LFP data in (<bold>A</bold>). When the rhythm appears (yellow shaded region) the credible intervals approach the mean phase; when the rhythm drops out, the credible intervals expand. (C.i) Phase credible intervals versus theta rhythm amplitude for each time point shown as a two-dimensional histogram (color indicates count of time points; see colorbar). (Lower) Example cycles of a rhythm with credible intervals, see <italic>x</italic>-axis of (C.ii) for numerical values of credible intervals. (C.ii) Violin plot of credible intervals for thresholds set at the 65th, 80th, and 95th percentile of the distribution of amplitude. The distribution of credible intervals increases with reduced amplitude threshold, and all amplitude thresholds include times with large credible intervals. Note that the phase and amplitude estimates are auto-correlated in time so that each gray dot is not independent of every other dot.</p><p><supplementary-material id="fig7sdata1"><label>Figure 7—source data 1.</label><caption><title>Amplitude and credible interval widths for local field potential (LFP) data.</title></caption><media mime-subtype="mat" mimetype="application" xlink:href="elife-68803-fig7-data1-v2.mat"/></supplementary-material></p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-68803-fig7-v2.tif"/></fig><fig id="fig7s1" position="float" specific-use="child-fig"><label>Figure 7—figure supplement 1.</label><caption><title>All methods produce similar phase estimates during segments of the theta rhythm with high signal-to-noise ratio (SNR).</title><p>(<bold>A.i</bold>.) Example rodent local field potential (LFP) data. (<bold>A.ii</bold>) Phase estimates from each method (see legend) are consistent when the SNR of the theta rhythm is high.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-68803-fig7-figsupp1-v2.tif"/></fig></fig-group><p>Previous studies have proposed a relationship between the theta amplitude envelope, estimated using the traditional approach of narrowband filtering followed by a Hilbert transform, and confidence in the phase (<xref ref-type="bibr" rid="bib65">Zrenner et al., 2020</xref>); when the theta signal is strong (i.e., the amplitude is large), the theta phase estimate improves. To examine this relationship here, we plot the theta amplitude envelope versus the phase credible intervals derived from the SSPE method (<xref ref-type="fig" rid="fig7">Figure 7C.i</xref>). Visual inspection reveals that, when the amplitude is large, small decreases in amplitude coincide with increased credible intervals, as expected. However, if we choose to approximate certainty in the phase estimate through thresholding the amplitude, we find that fixed amplitude thresholds produce wide ranges of credible intervals (<xref ref-type="fig" rid="fig7">Figure 7C.ii</xref>). This is especially apparent at lower amplitude thresholds; choosing a threshold of 65% results in credible intervals that range from 3.8 (2.5th percentile) to 96.8 (97.5th percentile) degrees. Therefore, a fixed amplitude threshold does not guarantee an accurate phase estimate. Instead, we propose that inspection of the credible intervals better guides certainty in the phase estimate. These credible intervals are directly derived from the modeling procedure, as opposed to surrogate measures of confidence in the phase estimate, such as amplitude. In addition, credible intervals are directly interpretable unlike amplitude thresholds, which depend on the measurement scale (e.g., a credible interval threshold of 10 degrees) versus an amplitude threshold of 10 mV. We conclude that amplitude is linked to confidence in the phase, however, a fixed amplitude threshold is not directly interpretable and encompasses a wide range of credible interval values.</p></sec></sec><sec id="s3-6"><title>Example in vivo application: human EEG</title><p>To illustrate application of the SSPE method in another data modality, we analyze an example EEG recording of the mu rhythm (8–13 Hz) from <xref ref-type="bibr" rid="bib65">Zrenner et al., 2020</xref>. To do so, we apply the SSPE method to track three oscillators (1, 10, 22 Hz) in 10 s intervals (see Materials and methods),and examine the phase estimates of the 8–12 Hz oscillator. Consistent with the rodent LFP data, we find that refitting of the SSPE model parameters is not required. Instead, the SSPE model parameters estimated from an initial 10 s segment of the EEG produce phase estimation errors consistent with SSPE models refit at future times (<xref ref-type="fig" rid="fig8">Figure 8A</xref>). Like the theta rhythm in the LFP rodent data, the mu rhythm in the human EEG data maintains a consistent spectral profile in time (<xref ref-type="fig" rid="fig8">Figure 8B</xref>) and further, it appears to be narrowband (<xref ref-type="fig" rid="fig8">Figure 8C</xref>). Therefore, estimating SSPE model parameters early in the data accurately captures the mu rhythm tracked later in the data, and there is no need to perform the (computationally expensive) refitting of the model.</p><fig-group><fig id="fig8" position="float"><label>Figure 8.</label><caption><title>State space phase estimate (SSPE) parameters can be estimated from any interval of electroencephalogram (EEG) mu rhythm and credible intervals for mu rhythm phase indicate periods of confidence.</title><p>(<bold>A</bold>) Phase error for a model fit using data from the first 10 s (blue curve), and the 95% confidence intervals (red) in the error for phase estimates at time <italic>t</italic> using models fit at times prior to time <italic>t</italic>. Right: histogram of error showing that error remains below 60 degrees in most cases. (<bold>B</bold>) Corresponding spectrogram for the EEG data (multitaper method with window size 10 s, window overlap 9 s, frequency resolution 1 Hz, and 19 tapers). (<bold>C</bold>) Average power spectral density (PSD) of (<bold>B</bold>) over all times in (<bold>A</bold>). The mean PSD (dark blue) and 95% confidence intervals (light blue) reveal a peak in the mu rhythm near 11 Hz. (<bold>D</bold>) Example human EEG data (red, solid) with a consistent peak in the mu rhythm (8–13 Hz). The estimated state of the SSPE method (purple, dashed) tracks the observed mu rhythm. (<bold>E</bold>) Phase estimates (purple, dashed) and credible intervals (red, shaded) for the example EEG data in D. When the rhythm appears (yellow shaded region) credible intervals approach the mean phase; when the rhythm drops out the credible intervals expand.</p><p><supplementary-material id="fig8sdata1"><label>Figure 8—source data 1.</label><caption><title>Error and spectrogram for in vivo electroencephalogram (EEG) analysis.</title></caption><media mime-subtype="mat" mimetype="application" xlink:href="elife-68803-fig8-data1-v2.mat"/></supplementary-material></p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-68803-fig8-v2.tif"/></fig><fig id="fig8s1" position="float" specific-use="child-fig"><label>Figure 8—figure supplement 1.</label><caption><title>All methods produce similar phase estimates during segments of the mu rhythm with high signal-to-noise ratio (SNR).</title><p>(<bold>A.i</bold>) Example mu rhythm clearly visible in the early portion of the electroencephalogram (EEG) trace. (<bold>A.ii</bold>) Phase estimates from each method (see legend) are consistent when the SNR of the mu rhythm is high.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-68803-fig8-figsupp1-v2.tif"/></fig><fig id="fig8s2" position="float" specific-use="child-fig"><label>Figure 8—figure supplement 2.</label><caption><title>The state space phase estimate (SSPE) method performs optimally across algorithms when tracking the electroencephalogram (EEG) mu rhythm.</title><p>The error (circular deviation) in performance of each algorithm across all EEG data. Each dot represents the error computed for 1 s of data. To compute the error, we compare the real-time phase estimate of each method to an acausally derived estimate of the phase by fitting the state space model (see Materials and methods: In vivo data). The SSPE method shows performance comparable to the acausal finite impulse response (FIR).</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-68803-fig8-figsupp2-v2.tif"/></fig><fig id="fig8s3" position="float" specific-use="child-fig"><label>Figure 8—figure supplement 3.</label><caption><title>State space phase estimate (SSPE) captures non-sinusoidality of the mu rhythm.</title><p>(<bold>A.i</bold>) The observed data (orange) is well tracked by the (summed) state estimate (purple, dotted) of the 10 and 22 Hz oscillators. (<bold>A.ii</bold>) Phase estimates for the 10 Hz (blue, dotted) and 20 Hz (orange, dotted) oscillators are tracked simultaneously.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-68803-fig8-figsupp3-v2.tif"/></fig></fig-group><p>The phase estimates and credible intervals for the mu rhythm reveal how this rhythm waxes and wanes in time (example in <xref ref-type="fig" rid="fig8">Figure 8D and E</xref>; for comparison to phase estimates computed using the alternative methods, see <xref ref-type="fig" rid="fig8s1">Figure 8—figure supplements 1</xref> and <xref ref-type="fig" rid="fig8s2">2</xref>). When a strong mu rhythm emerges, tight credible intervals surround the mean phase estimate tracking the rhythm of interest; as the mu rhythm wanes, the credible intervals expand. When we restrict analysis to samples with credible interval width less than 25 degrees, the error drops from 40.5 (s.e. 1.1) to 11.2 (s.e. 0.46) degrees while still retaining 16.4% of the data. As with the LFP, we are able to assess certainty in our phase estimates using the credible intervals. Finally, we note that computing the state estimate including both the 10 and 22 Hz components of the model better approximates the non-sinusoidal waveform of the mu rhythm (<xref ref-type="fig" rid="fig8s3">Figure 8—figure supplement 3</xref>).</p></sec><sec id="s3-7"><title>Pre-stimulus mu rhythm phase predicts MEP amplitude</title><p>To illustrate the utility of real-time phase estimation, we again analyze an example EEG recording from <xref ref-type="bibr" rid="bib65">Zrenner et al., 2020</xref>, in which the authors stimulate a subject at random intervals using transcranial magnetic stimulation to elicit a motor evoked potential (MEP) from the right abductor pollicis brevis muscle. We analyze the MEP amplitude to assess the influence of pre-stimulus mu rhythm phase on the response (replicating the analysis performed by <xref ref-type="bibr" rid="bib65">Zrenner et al., 2020</xref>). We estimate mu rhythm phase using the SSPE method with model parameters derived from a different subject. We find that the pre-stimulus phase of the mu rhythm, at the instant immediately prior to stimulation, predicts (using circular linear regression) 13% of the log-transformed MEP amplitude (<xref ref-type="fig" rid="fig9">Figure 9A</xref>). Furthermore, thresholding the trials using credible interval width, we find improved prediction of the MEP amplitude. When using trials with CI width less than 50 degrees, the mu rhythm phase explains 30% of the variance in the MEP amplitude (<xref ref-type="fig" rid="fig9">Figure 9B</xref>), and with CI width less than 25 degrees, 48% of the variance (<xref ref-type="fig" rid="fig9">Figure 9C</xref>). These results show that modulation of the MEP amplitude depends on the pre-stimulus phase of the mu rhythm, and suggest that accurate estimation of the mu rhythm (e.g., using the SSPE method with narrow CI width) may enhance the evoked motor response.</p><fig id="fig9" position="float"><label>Figure 9.</label><caption><title>Motor evoked potential (MEP) amplitude is predicted by the pre-stimulus state space phase estimate (SSPE) estimated mu rhythm phase.</title><p>(<bold>A</bold>) Log-transformed MEP amplitude versus phase with no threshold applied to the credible interval width. White dot indicates the median of the MEP amplitude. Yellow line is the best fit circular linear regression line (a phase offset sinusoid) showing that the MEP amplitude is maximum at mu rhythm trough (phase = ±<italic>π</italic>). (<bold>B,C</bold>) Including only trials with CI width (<bold>B</bold>) less than 50 degrees, or (<bold>C</bold>) less than 25 degrees more clearly demonstrates the MEP amplitude maxima at the mu rhythm trough.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-68803-fig9-v2.tif"/></fig></sec><sec id="s3-8"><title>Speed and accuracy of TORTE real-time implementation</title><p>To assess the validity of the integration of SSPE into TORTE (<xref ref-type="fig" rid="fig10">Figure 10A</xref>), we generated a 5 Hz sine wave with no additive noise and estimated the phase using the MATLAB and C++ implementations. The parameter estimates for the fitted model were computed on the first 10 s of the data. The computed parameters were nearly identical between the two implementations and the time to estimate the parameters (which, as above, would need to be done only once per experiment) ranged from 2 to 100 s. The phase estimates of the two implementations have a mean circular difference of 2.06 degrees (<xref ref-type="fig" rid="fig10">Figure 10B</xref>) with a circular standard deviation of 0.65 degree; this variation in phase estimates likely arises from differences in filtering in the TORTE real-time (causal filtering on individual buffers) implementation and the offline MATLAB real-time (acausal filtering across all data) implementation. Further, given that it is a near constant shift in phase, the online learning algorithm in TORTE will correct for the biased phase estimates. We also examined the speed of evaluating different sized buffers with SSPE within TORTE. Across five buffer sizes from 420 to 1700 samples (encompassing 9–37 ms of data, see <xref ref-type="fig" rid="fig10">Figure 10C</xref>), estimating phase with SSPE took less than 0.35 ms in the worst case. We note that the system latency of TORTE is in the range of a few milliseconds (driven mainly by the USB-based implementation of the current Open Ephys system), whereas the buffers were evaluated on the scale of microseconds. That is, the real-time bottleneck lies in signal amplification and digitization, not this processing. In conclusion, we present a real-time implementation of SSPE that could be easily deployed in various experimental setups.</p><fig id="fig10" position="float"><label>Figure 10.</label><caption><title>State space phase estimate (SSPE) implementation in Toolkit for Oscillatory Real-time Tracking and Estimation (TORTE) is accurate, with negligible latency.</title><p>(<bold>A</bold>) Open Ephys GUI for using SSPE. The user specifies the number of frequencies to track, the center frequencies to track, the frequencies of interest for phase calculation and output (FOI), variance for the FOI, and the observation error. Observation error determines the effective bandwidth for each frequency. (<bold>B</bold>) Histogram of the circular standard deviation between MATLAB (offline) and TORTE (real-time) implementations of the SSPE. Small variation results from causal low pass filtering in TORTE and acausal filtering in the offline phase estimates. (<bold>C</bold>) Time to evaluate phase versus buffer size. Longer buffer sizes from TORTE require longer calculation time for application of SSPE. However, the calculation time is approximately two orders of magnitude smaller than the buffer size.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-68803-fig10-v2.tif"/></fig></sec></sec><sec id="s4" sec-type="discussion"><title>Discussion</title><p>We have introduced a real-time phase estimator derived from a time series state space model. This approach – the SSPE method – addresses limitations of existing methods (namely, the requirements associated with bandpass filtering in phase estimation) and provides a real-time estimate of confidence in the phase estimate. We demonstrated the benefits of the SSPE method in simulations with varying breadth of the peak rhythm frequency and SNR, a confounding rhythm with a nearby frequency, and phase resets. In two case studies of in vivo data, we showed that re-estimation of model parameters is unnecessary and that the SSPE method provides clear estimates of confidence in phase estimates. We propose that the SSPE serves as a useful tool for real-time phase applications, for example, real-time phase-locked stimulation or real-time phase-amplitude synchrony estimation.</p><sec id="s4-1"><title>Narrowband versus broadband signals</title><p>While brain rhythms tend to be broadband (<xref ref-type="bibr" rid="bib7">Buzsaki, 2004</xref>; <xref ref-type="bibr" rid="bib43">Roopun et al., 2008</xref>), the most common methods in neuroscience to track a rhythm’s phase require appropriate choices of filter parameters (e.g., selection of bandwidth) and generally expect a narrowband oscillation. However, real-time methods that require a narrowband oscillation struggle to capture the phase accurately for broadband rhythms (e.g., <xref ref-type="fig" rid="fig2">Figure 2</xref>). Moreover, when the broadband rhythm has non-negligible power across all frequencies (in which case the phase cycle is more unstable), the standard non-real-time approach (acausal FIR and Hilbert transform) tracks the phase with limited accuracy. For forecasting needed in real-time analyses, implementing the same assumption (of a broadband peak) in the model may improve phase estimation accuracy. In the SSPE method, the assumption of a narrowband oscillation is not required, as the covariance allows flexibility in modeling peaks of different bandwidths.</p></sec><sec id="s4-2"><title>Noise in the signal</title><p>By applying a bandpass filter directly on the observed signal, existing real-time phase estimators do not disambiguate the signal and the noise, thus folding the noise into the phase estimate. The impact of structured noise (e.g., a competing rhythm or sudden phase shift) is particularly visible in <xref ref-type="fig" rid="fig3">Figure 3</xref> and <xref ref-type="fig" rid="fig4">Figure 4</xref>. To address this, the SSPE approach explicitly separates the signal and noise, and models two separate components of noise: state noise and observation noise. The SSPE state consists of harmonic oscillators driven by (white) noise. The resulting spectrum consists of broadband peaks at the oscillator frequencies upon a brown aperiodic component, similar to spectra observed in neural field activity. Confounding rhythms (a particular type of noise) can be explicitly modeled and accounted for in the SSPE approach. We consider the observation noise as additive white noise (flat spectrum) due to unknown noise in the measurement process. This model structure is more flexible than methods reliant on bandpass filters, allowing different expectations for the noise (e.g., modeling a confounding rhythm as a pure harmonic oscillator) or adding additional model elements to account for power at higher frequencies (e.g., adding moving average terms; <xref ref-type="bibr" rid="bib40">Matsuda and Komaki, 2017</xref>).</p></sec><sec id="s4-3"><title>Detecting a rhythm for phase estimation</title><p>To estimate phase for a target rhythm, there should be evidence that the rhythm exists in the data. A few contemporary real-time phase estimators tackle this problem by using an amplitude threshold to decide when a rhythm is present (<xref ref-type="bibr" rid="bib42">Rodriguez Rivero and Ditterich, 2021</xref>; <xref ref-type="bibr" rid="bib45">Rutishauser et al., 2013</xref>). An amplitude criterion depends on accurate knowledge of the distribution of amplitudes possible for the data, relative to the background noise. The SSPE method, in contrast, directly represents the presence/absence of a rhythm in the credible intervals for the phase, as demonstrated for the in vivo data. The result is directly interpretable and permits a more intuitive decision metric (e.g., a threshold depending on the credible interval width) than an arbitrary amplitude criterion. Further, while we expect a central frequency for a rhythm estimated from the data, the Gaussian assumptions of the harmonic oscillator driven by noise allow for the instantaneous frequency to be stochastic. This permits greater flexibility in tracking a rhythm’s central frequency compared to prior phase estimators and supports analysis of broadband rhythms with drifting central peaks, and abrupt changes in phase of a fixed rhythm (e.g., <xref ref-type="fig" rid="fig4">Figure 4</xref>). However, the SSPE method does require identification of target and confounding rhythms for accurate estimation. If details about the rhythms (central frequencies and bandwidth) are unknown, or the target rhythm is known to exist only for short intervals in a long recording, then alternative methods that allow real-time visualization and user-directed intervention in estimation may be pursued (<xref ref-type="bibr" rid="bib42">Rodriguez Rivero and Ditterich, 2021</xref>; <xref ref-type="bibr" rid="bib45">Rutishauser et al., 2013</xref>).</p></sec><sec id="s4-4"><title>Computational speed</title><p>For real-time phase applications, speed of estimation is critical. We focus here on algorithmic speed as opposed to hardware speed, which is a function of the computing device. Algorithmic speed can be measured at two different points: parameter estimation and application. In the SSPE method and other real-time phase estimators (<xref ref-type="bibr" rid="bib11">Chen et al., 2013</xref>; <xref ref-type="bibr" rid="bib65">Zrenner et al., 2020</xref>), the parameter estimation stage is the slower aspect of phase estimation. Past work has required 10 s of minutes for parameter estimation (<xref ref-type="bibr" rid="bib11">Chen et al., 2013</xref>). Here, for the SSPE method using a window size of 10 s and a sampling rate of 1 kHz, we find that parameter estimation time rarely exceeds a minute or two. In the application stage, we find that speed is orders of magnitude faster than the sampling rate (<xref ref-type="fig" rid="fig8">Figure 8</xref>), considerably improving on the algorithmic delays present in existing algorithms (<xref ref-type="bibr" rid="bib42">Rodriguez Rivero and Ditterich, 2021</xref>; <xref ref-type="bibr" rid="bib45">Rutishauser et al., 2013</xref>).</p></sec><sec id="s4-5"><title>Limitations and future directions</title><p>Like all real-time phase estimators, the proposed method possesses specific limitations and opportunities for future improvement. First, the SSPE method treats the generative model for any rhythm as a harmonic oscillator driven by noise. A pure sinusoid is outside this model class, and as such the SSPE method performs slightly worse than filter-based algorithms at tracking the phase of a pure sine. Nonetheless, the error remains small for the SSPE tracking a pure sinusoid in noise (<xref ref-type="fig" rid="fig2">Figure 2</xref>). We note that a simple alteration in the SSPE model (removing the state covariance <italic>Q</italic>) would allow more accurate tracking of a sinusoid, but not the broadband rhythms more commonly observed in vivo. Second, slow drifts (&lt;0.1 Hz) in the baseline of the data can impair the ability of the SSPE method to track the phase. Slow drifts could be modeled as an additional confounding oscillator, however, estimating its presence would require long segments of time (possibly exceeding 40 s). Alternatively, the SSPE model could be updated to include a model of the slow drift dynamics (perhaps as a piecewise linear term), or a moving average mean trend could be causally removed as we demonstrated with the in vivo EEG analysis. Third, in applying the SSPE method, we assume that the model we estimate for a rhythm remains appropriate for the extent of the experimental duration. While we showed in two in vivo case studies that this assumption may be reasonable, in other cases this assumption may fail. Rhythms, observed over time, may be better represented by models with changing parameters. Indeed, non-stationarity is an important issue to consider when tracking brain rhythms. The SSPE method is robust (by virtue of the model structure and application of the Kalman filter) to small changes in the central frequency or the bandwidth of a rhythm (e.g., <xref ref-type="fig" rid="fig2">Figure 2</xref>). However, non-stationary rhythms require new algorithms to be developed (such as the PLSO method in <xref ref-type="bibr" rid="bib53">Song et al., 2020</xref>). An extension of the SSPE method that could potentially track changing central frequencies is to apply an extended Kalman filter (<xref ref-type="bibr" rid="bib49">Schiff, 2012</xref>) that simultaneously estimates the frequencies of interest while filtering the state. Alternatively, the SSPE method could also be extended to implement a switching model that utilizes multiple sets of parameters and switches between parameter sets as necessary, or by refitting the SSPE model as time evolves. Finally, we note that data sampled at a high rate can reduce computational efficiency when fitting parameters for SSPE. To address this, a quasi-Newton optimization – instead of EM, as implemented here – may improve performance, as suggested in <xref ref-type="bibr" rid="bib40">Matsuda and Komaki, 2017</xref>. Determining the optimization framework best suited for practical use remains an important direction for future work.</p></sec><sec id="s4-6"><title>Conclusion</title><p>We introduced a new algorithm – the SSPE method – to track phase in real-time that addresses several limitations of current methods. We demonstrated in simulation that SSPE performs better than current state-of-the art techniques for real-time phase estimation and comparably, or better, than a commonly used acausal FIR approach. We showed in in vivo data that we can estimate SSPE model parameters and apply them for hundreds of seconds without re-estimation. Finally, we showed how credible intervals from the SSPE method track confidence in the real-time phase estimate, and may provide an intuitive, user-determined decision metric for stimulation at a particular phase. We have provided reference implementations suitable for immediate incorporation into phase-aware in vivo experiments. Future work using the SSPE method in practice may help provide critical evidence on the potential functional importance of phase in neural dynamics.</p></sec></sec></body><back><sec id="s5" sec-type="additional-information"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="COI-statement" id="conf1"><p>No competing interests declared</p></fn><fn fn-type="COI-statement" id="conf2"><p>No competing interests declared</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>Conceptualization, Formal analysis, Funding acquisition, Supervision, Investigation, Methodology, Software, Visualization</p></fn><fn fn-type="con" id="con2"><p>Writing - original draft, Formal analysis, Supervision, Investigation, Methodology, Visualization</p></fn><fn fn-type="con" id="con3"><p>Conceptualization, Resources, Funding acquisition, Supervision, Writing – review and editing, Visualization</p></fn><fn fn-type="con" id="con4"><p>Conceptualization, Resources, Supervision, Writing – review and editing, Visualization</p></fn><fn fn-type="con" id="con5"><p>Conceptualization, Resources, Funding acquisition, Supervision, Data curation, Writing – review and editing, Visualization</p></fn></fn-group></sec><sec id="s6" sec-type="supplementary-material"><title>Additional files</title><supplementary-material id="transrepform"><label>Transparent reporting form</label><media mime-subtype="docx" mimetype="application" xlink:href="elife-68803-transrepform1-v2.docx"/></supplementary-material></sec><sec id="s7" sec-type="data-availability"><title>Data availability</title><p>All data generated or analyzed during this study, or were used to create the figures are included in the supporting files, or are available through already public data archives (<ext-link ext-link-type="uri" xlink:href="https://gin.g-node.org/bnplab/phastimate">https://gin.g-node.org/bnplab/phastimate</ext-link>, <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.6084/m9.figshare.14374355">https://doi.org/10.6084/m9.figshare.14374355</ext-link>).</p><p>The following previously published datasets were used:</p><p><element-citation id="dataset1" publication-type="data" specific-use="references"><person-group person-group-type="author"><name><surname>Zrenner</surname><given-names>C</given-names></name><name><surname>Galevska</surname><given-names>D</given-names></name><name><surname>Nieminen</surname><given-names>JO</given-names></name><name><surname>Baur</surname><given-names>D</given-names></name><name><surname>Stefanou</surname><given-names>MI</given-names></name><name><surname>Ziemann</surname><given-names>U</given-names></name></person-group><year iso-8601-date="2020">2020</year><data-title>Phastimate</data-title><source>Phastimate</source><pub-id pub-id-type="accession" xlink:href="https://gin.g-node.org/bnplab/phastimate">116761</pub-id></element-citation></p><p><element-citation id="dataset2" publication-type="data" specific-use="references"><person-group person-group-type="author"><name><surname>Wodeyar</surname><given-names>A</given-names></name><name><surname>Schatza</surname><given-names>M</given-names></name><name><surname>Widge</surname><given-names>A</given-names></name><name><surname>Eden</surname><given-names>UT</given-names></name><name><surname>Kramer</surname><given-names>MA</given-names></name></person-group><year iso-8601-date="2021">2021</year><data-title>SSPE data</data-title><source>figshare</source><pub-id pub-id-type="doi">10.6084/m9.figshare.14374355</pub-id></element-citation></p></sec><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Blackwood</surname><given-names>E</given-names></name><name><surname>Lo</surname><given-names>MC</given-names></name><name><surname>Alik Widge</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2018">2018</year><conf-name>Continuous Phase Estimation for Phase-Locked Neural Stimulation Using an Autoregressive Model for Signal Prediction</conf-name><article-title>Annual International Conference of the IEEE Engineering in Medicine and Biology Society. IEEE Engineering in Medicine and Biology Society. Annual International Conference</article-title><fpage>4736</fpage><lpage>4739</lpage><pub-id pub-id-type="doi">10.1109/EMBC.2018.8513232</pub-id></element-citation></ref><ref id="bib2"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Blackwood</surname><given-names>E</given-names></name></person-group><year iso-8601-date="2019">2019</year><data-title>Tne-lab/phase-calculator: Phase calculator with fixed visualization and structs for channel info</data-title><source>Zenodo</source><ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.2633295">https://doi.org/10.5281/zenodo.2633295</ext-link></element-citation></ref><ref id="bib3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Boashash</surname><given-names>B</given-names></name></person-group><year iso-8601-date="1991">1991</year><article-title>Estimating and interpreting the instantaneous frequency of a signal-part 1: Fundamentals</article-title><source>Proceedings of the IEEE</source><volume>80</volume><fpage>520</fpage><lpage>538</lpage><pub-id pub-id-type="doi">10.1109/5.135376</pub-id></element-citation></ref><ref id="bib4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Brockwell</surname><given-names>AE</given-names></name><name><surname>Rojas</surname><given-names>AL</given-names></name><name><surname>Kass</surname><given-names>RE</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Recursive bayesian decoding of motor cortical signals by particle filtering</article-title><source>Journal of Neurophysiology</source><volume>91</volume><fpage>1899</fpage><lpage>1907</lpage><pub-id pub-id-type="doi">10.1152/jn.00438.2003</pub-id></element-citation></ref><ref id="bib5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Burns</surname><given-names>SP</given-names></name><name><surname>Xing</surname><given-names>D</given-names></name><name><surname>Shelley</surname><given-names>MJ</given-names></name><name><surname>Shapley</surname><given-names>RM</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Searching for Autocoherence in the Cortical Network with a Time-Frequency Analysis of the Local Field Potential</article-title><source>Journal of Neuroscience</source><volume>30</volume><fpage>4033</fpage><lpage>4047</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.5319-09.2010</pub-id><pub-id pub-id-type="pmid">20237274</pub-id></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Busch</surname><given-names>NA</given-names></name><name><surname>Dubois</surname><given-names>J</given-names></name><name><surname>VanRullen</surname><given-names>R</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>The Phase of Ongoing EEG Oscillations Predicts Visual Perception</article-title><source>Journal of Neuroscience</source><volume>29</volume><fpage>7869</fpage><lpage>7876</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.0113-09.2009</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Buzsaki</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Neuronal Oscillations in Cortical Networks</article-title><source>Science</source><volume>304</volume><fpage>1926</fpage><lpage>1929</lpage><pub-id pub-id-type="doi">10.1126/science.1099745</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Buzsáki</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2006">2006</year><source>Rhythms of the Brain</source><publisher-loc>Oxford, UK</publisher-loc><publisher-name>Oxford University Press</publisher-name><pub-id pub-id-type="doi">10.1093/acprof:oso/9780195301069.001.0001</pub-id></element-citation></ref><ref id="bib9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cagnan</surname><given-names>H</given-names></name><name><surname>Pedrosa</surname><given-names>D</given-names></name><name><surname>Little</surname><given-names>S</given-names></name><name><surname>Pogosyan</surname><given-names>A</given-names></name><name><surname>Cheeran</surname><given-names>B</given-names></name><name><surname>Aziz</surname><given-names>T</given-names></name><name><surname>Green</surname><given-names>A</given-names></name><name><surname>Fitzgerald</surname><given-names>J</given-names></name><name><surname>Foltynie</surname><given-names>T</given-names></name><name><surname>Limousin</surname><given-names>P</given-names></name><name><surname>Zrinzo</surname><given-names>L</given-names></name><name><surname>Hariz</surname><given-names>M</given-names></name><name><surname>Friston</surname><given-names>KJ</given-names></name><name><surname>Denison</surname><given-names>T</given-names></name><name><surname>Brown</surname><given-names>P</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Stimulating at the right time: Phase-specific deep brain stimulation</article-title><source>Brain</source><volume>140</volume><fpage>132</fpage><lpage>145</lpage><pub-id pub-id-type="doi">10.1093/brain/aww286</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Canolty</surname><given-names>RT</given-names></name><name><surname>Knight</surname><given-names>RT</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>The functional role of cross-frequency coupling</article-title><source>Trends in Cognitive Sciences</source><volume>14</volume><fpage>506</fpage><lpage>515</lpage><pub-id pub-id-type="doi">10.1016/j.tics.2010.09.001</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname><given-names>LL</given-names></name><name><surname>Madhavan</surname><given-names>R</given-names></name><name><surname>Rapoport</surname><given-names>B</given-names></name><name><surname>Anderson</surname><given-names>WS</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Real-Time Brain Oscillation Detection and Phase-Locked Stimulation Using Autoregressive Spectral Estimation and Time-Series Forward Prediction</article-title><source>IEEE Transactions on Biomedical Engineering</source><volume>60</volume><fpage>753</fpage><lpage>762</lpage><pub-id pub-id-type="doi">10.1109/TBME.2011.2109715</pub-id></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cole</surname><given-names>SR</given-names></name><name><surname>Voytek</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Brain Oscillations and the Importance of Waveform Shape</article-title><source>Trends in Cognitive Sciences</source><volume>21</volume><fpage>137</fpage><lpage>149</lpage><pub-id pub-id-type="doi">10.1016/j.tics.2016.12.008</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Desideri</surname><given-names>D</given-names></name><name><surname>Zrenner</surname><given-names>C</given-names></name><name><surname>Ziemann</surname><given-names>U</given-names></name><name><surname>Belardinelli</surname><given-names>P</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Phase of sensorimotor μ‐oscillation modulates cortical responses to transcranial magnetic stimulation of the human motor cortex</article-title><source>The Journal of Physiology</source><volume>597</volume><fpage>5671</fpage><lpage>5686</lpage><pub-id pub-id-type="doi">10.1113/JP278638</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Eden</surname><given-names>UT</given-names></name><name><surname>Frank</surname><given-names>LM</given-names></name><name><surname>Tao</surname><given-names>L</given-names></name></person-group><year iso-8601-date="2018">2018</year><chapter-title>Characterizing Complex, Multi-Scale Neural Phenomena Using State-Space Models</chapter-title><person-group person-group-type="editor"><name><surname>Chen</surname><given-names>Z</given-names></name><name><surname>Sarma</surname><given-names>SV</given-names></name></person-group><source>Dynamic Neuroscience</source><publisher-name>Springer International Publishing</publisher-name><fpage>29</fpage><lpage>52</lpage><pub-id pub-id-type="doi">10.1007/978-3-319-71976-4_2</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fiebelkorn</surname><given-names>IC</given-names></name><name><surname>Foxe</surname><given-names>JJ</given-names></name><name><surname>Butler</surname><given-names>JS</given-names></name><name><surname>Mercier</surname><given-names>MR</given-names></name><name><surname>Snyder</surname><given-names>AC</given-names></name><name><surname>Molholm</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Ready, Set, Reset: Stimulus-Locked Periodicity in Behavioral Performance Demonstrates the Consequences of Cross-Sensory Phase Reset</article-title><source>Journal of Neuroscience</source><volume>31</volume><fpage>9971</fpage><lpage>9981</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.1338-11.2011</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Franaszczuk</surname><given-names>PJ</given-names></name><name><surname>Blinowska</surname><given-names>KJ</given-names></name></person-group><year iso-8601-date="1985">1985</year><article-title>Linear model of brain electrical activity—EEG as a superposition of damped oscillatory modes</article-title><source>Biological Cybernetics</source><volume>53</volume><fpage>19</fpage><lpage>25</lpage><pub-id pub-id-type="doi">10.1007/BF00355687</pub-id></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fries</surname><given-names>P</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Rhythms for Cognition: Communication through Coherence</article-title><source>Neuron</source><volume>88</volume><fpage>220</fpage><lpage>235</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2015.09.034</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gaillard</surname><given-names>C</given-names></name><name><surname>Ben Hadj Hassen</surname><given-names>S</given-names></name><name><surname>Di Bello</surname><given-names>F</given-names></name><name><surname>Bihan-Poudec</surname><given-names>Y</given-names></name><name><surname>VanRullen</surname><given-names>R</given-names></name><name><surname>Ben Hamed</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Prefrontal attentional saccades explore space rhythmically</article-title><source>Nature Communications</source><volume>11</volume><elocation-id>925</elocation-id><pub-id pub-id-type="doi">10.1038/s41467-020-14649-7</pub-id></element-citation></ref><ref id="bib19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Galka</surname><given-names>A</given-names></name><name><surname>Yamashita</surname><given-names>O</given-names></name><name><surname>Ozaki</surname><given-names>T</given-names></name><name><surname>Biscay</surname><given-names>R</given-names></name><name><surname>Valdés-Sosa</surname><given-names>P</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>A solution to the dynamical inverse problem of EEG generation using spatiotemporal Kalman filtering</article-title><source>NeuroImage</source><volume>23</volume><fpage>435</fpage><lpage>453</lpage><pub-id pub-id-type="doi">10.1016/j.neuroimage.2004.02.022</pub-id></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gordon</surname><given-names>PC</given-names></name><name><surname>Dörre</surname><given-names>S</given-names></name><name><surname>Belardinelli</surname><given-names>P</given-names></name><name><surname>Stenroos</surname><given-names>M</given-names></name><name><surname>Zrenner</surname><given-names>B</given-names></name><name><surname>Ziemann</surname><given-names>U</given-names></name><name><surname>Zrenner</surname><given-names>C</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Prefrontal Theta-Phase Synchronized Brain Stimulation With Real-Time EEG-Triggered TMS</article-title><source>Frontiers in Human Neuroscience</source><volume>15</volume><elocation-id>691821</elocation-id><pub-id pub-id-type="doi">10.3389/fnhum.2021.691821</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gregoriou</surname><given-names>GG</given-names></name><name><surname>Gotts</surname><given-names>SJ</given-names></name><name><surname>Zhou</surname><given-names>H</given-names></name><name><surname>Desimone</surname><given-names>R</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>High-frequency, long-range coupling between prefrontal and visual cortex during attention</article-title><source>Science</source><volume>324</volume><fpage>1207</fpage><lpage>1210</lpage><pub-id pub-id-type="doi">10.1126/science.1171402</pub-id></element-citation></ref><ref id="bib22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Haegens</surname><given-names>S</given-names></name><name><surname>Zion Golumbic</surname><given-names>E</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Rhythmic facilitation of sensory processing: A critical review</article-title><source>Neuroscience &amp; Biobehavioral Reviews</source><volume>86</volume><fpage>150</fpage><lpage>165</lpage><pub-id pub-id-type="doi">10.1016/j.neubiorev.2017.12.002</pub-id></element-citation></ref><ref id="bib23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Helfrich</surname><given-names>RF</given-names></name><name><surname>Fiebelkorn</surname><given-names>IC</given-names></name><name><surname>Szczepanski</surname><given-names>SM</given-names></name><name><surname>Lin</surname><given-names>JJ</given-names></name><name><surname>Parvizi</surname><given-names>J</given-names></name><name><surname>Knight</surname><given-names>RT</given-names></name><name><surname>Kastner</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Neural Mechanisms of Sustained Attention Are Rhythmic</article-title><source>Neuron</source><volume>99</volume><fpage>854</fpage><lpage>865</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2018.07.032</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hemptinne</surname><given-names>C de</given-names></name><name><surname>Ryapolova-Webb</surname><given-names>ES</given-names></name><name><surname>Air</surname><given-names>EL</given-names></name><name><surname>Garcia</surname><given-names>PA</given-names></name><name><surname>Miller</surname><given-names>KJ</given-names></name><name><surname>Ojemann</surname><given-names>JG</given-names></name><name><surname>Ostrem</surname><given-names>JL</given-names></name><name><surname>Galifianakis</surname><given-names>NB</given-names></name><name><surname>Starr</surname><given-names>PA</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Exaggerated phase–amplitude coupling in the primary motor cortex in Parkinson disease</article-title><source>PNAS</source><volume>110</volume><fpage>4780</fpage><lpage>4785</lpage><pub-id pub-id-type="doi">10.1073/pnas.1214546110</pub-id></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hyafil</surname><given-names>A</given-names></name><name><surname>Giraud</surname><given-names>AL</given-names></name><name><surname>Fontolan</surname><given-names>L</given-names></name><name><surname>Gutkin</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Neural Cross-Frequency Coupling: Connecting Architectures, Mechanisms, and Functions</article-title><source>Trends in Neurosciences</source><volume>38</volume><fpage>725</fpage><lpage>740</lpage><pub-id pub-id-type="doi">10.1016/j.tins.2015.09.001</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hyman</surname><given-names>JM</given-names></name><name><surname>Wyble</surname><given-names>BP</given-names></name><name><surname>Goyal</surname><given-names>V</given-names></name><name><surname>Rossi</surname><given-names>CA</given-names></name><name><surname>Hasselmo</surname><given-names>ME</given-names></name></person-group><year iso-8601-date="2003">2003</year><article-title>Stimulation in Hippocampal Region CA1 in Behaving Rats Yields Long-Term Potentiation when Delivered to the Peak of Theta and Long-Term Depression when Delivered to the Trough</article-title><source>Journal of Neuroscience</source><volume>23</volume><fpage>11725</fpage><lpage>11731</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.23-37-11725.2003</pub-id></element-citation></ref><ref id="bib27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kalman</surname><given-names>RE</given-names></name></person-group><year iso-8601-date="1960">1960</year><article-title>A New Approach to Linear Filtering and Prediction Problems</article-title><source>Journal of Basic Engineering</source><volume>82</volume><fpage>35</fpage><lpage>45</lpage><pub-id pub-id-type="doi">10.1115/1.3662552</pub-id></element-citation></ref><ref id="bib28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kim</surname><given-names>SE</given-names></name><name><surname>Behr</surname><given-names>MK</given-names></name><name><surname>Ba</surname><given-names>D</given-names></name><name><surname>Brown</surname><given-names>EN</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>State-space multitaper time-frequency analysis</article-title><source>PNAS</source><volume>115</volume><fpage>E5</fpage><lpage>E14</lpage><pub-id pub-id-type="doi">10.1073/pnas.1702877115</pub-id><pub-id pub-id-type="pmid">29255032</pub-id></element-citation></ref><ref id="bib29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kocsis</surname><given-names>B</given-names></name><name><surname>Bragin</surname><given-names>A</given-names></name><name><surname>Buzsáki</surname><given-names>G</given-names></name></person-group><year iso-8601-date="1999">1999</year><article-title>Interdependence of multiple theta generators in the hippocampus: A partial coherence analysis</article-title><source>The Journal of Neuroscience</source><volume>19</volume><fpage>6200</fpage><lpage>6212</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.19-14-06200.1999</pub-id><pub-id pub-id-type="pmid">10407056</pub-id></element-citation></ref><ref id="bib30"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Kramer</surname><given-names>MA</given-names></name><name><surname>Eden</surname><given-names>UT</given-names></name></person-group><year iso-8601-date="2016">2016</year><source>Case Studies in Neural Data Analysis: A Guide for the Practicing Neuroscientist</source><publisher-loc>Cambridge, MA</publisher-loc><publisher-name>MIT Press</publisher-name></element-citation></ref><ref id="bib31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kundu</surname><given-names>B</given-names></name><name><surname>Johnson</surname><given-names>JS</given-names></name><name><surname>Postle</surname><given-names>BR</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Prestimulation phase predicts the TMS-evoked response</article-title><source>Journal of Neurophysiology</source><volume>112</volume><fpage>1885</fpage><lpage>1893</lpage><pub-id pub-id-type="doi">10.1152/jn.00390.2013</pub-id></element-citation></ref><ref id="bib32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lakatos</surname><given-names>P</given-names></name><name><surname>O’Connell</surname><given-names>MN</given-names></name><name><surname>Barczak</surname><given-names>A</given-names></name><name><surname>Mills</surname><given-names>A</given-names></name><name><surname>Javitt</surname><given-names>DC</given-names></name><name><surname>Schroeder</surname><given-names>CE</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>The Leading Sense: Supramodal Control of Neurophysiological Context by Attention</article-title><source>Neuron</source><volume>64</volume><fpage>419</fpage><lpage>430</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2009.10.014</pub-id></element-citation></ref><ref id="bib33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lepage</surname><given-names>KQ</given-names></name><name><surname>Kramer</surname><given-names>MA</given-names></name><name><surname>Eden</surname><given-names>UT</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Some sampling properties of common phase estimators</article-title><source>Neural Computation</source><volume>25</volume><fpage>901</fpage><lpage>921</lpage><pub-id pub-id-type="doi">10.1162/NECO_a_00422</pub-id><pub-id pub-id-type="pmid">23339610</pub-id></element-citation></ref><ref id="bib34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lo</surname><given-names>MC</given-names></name><name><surname>Younk</surname><given-names>R</given-names></name><name><surname>Widge</surname><given-names>AS</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Paired Electrical Pulse Trains for Controlling Connectivity in Emotion-Related Brain Circuitry</article-title><source>IEEE Transactions on Neural Systems and Rehabilitation Engineering</source><volume>28</volume><fpage>2721</fpage><lpage>2730</lpage><pub-id pub-id-type="doi">10.1109/TNSRE.2020.3030714</pub-id></element-citation></ref><ref id="bib35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Makeig</surname><given-names>S</given-names></name><name><surname>Debener</surname><given-names>S</given-names></name><name><surname>Onton</surname><given-names>J</given-names></name><name><surname>Delorme</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Mining event-related brain dynamics</article-title><source>Trends in Cognitive Sciences</source><volume>8</volume><fpage>204</fpage><lpage>210</lpage><pub-id pub-id-type="doi">10.1016/j.tics.2004.03.008</pub-id></element-citation></ref><ref id="bib36"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mansouri</surname><given-names>F</given-names></name><name><surname>Dunlop</surname><given-names>K</given-names></name><name><surname>Giacobbe</surname><given-names>P</given-names></name><name><surname>Downar</surname><given-names>J</given-names></name><name><surname>Zariffa</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>A Fast EEG Forecasting Algorithm for Phase-Locked Transcranial Electrical Stimulation of the Human Brain</article-title><source>Frontiers in Neuroscience</source><volume>11</volume><elocation-id>0401</elocation-id><pub-id pub-id-type="doi">10.3389/fnins.2017.00401</pub-id></element-citation></ref><ref id="bib37"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Maris</surname><given-names>E</given-names></name><name><surname>Fries</surname><given-names>P</given-names></name><name><surname>van Ede</surname><given-names>F</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Diverse Phase Relations among Neuronal Rhythms and Their Potential Function</article-title><source>Trends in Neurosciences</source><volume>39</volume><fpage>86</fpage><lpage>99</lpage><pub-id pub-id-type="doi">10.1016/j.tins.2015.12.004</pub-id></element-citation></ref><ref id="bib38"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Mark</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2021">2021a</year><data-title>Analytic signal plugin</data-title><version designator="swh:1:rev:e11421f23403399ca6b2d85132a31e2c1d5b1397">swh:1:rev:e11421f23403399ca6b2d85132a31e2c1d5b1397</version><source>Software Heritage</source><ext-link ext-link-type="uri" xlink:href="https://archive.softwareheritage.org/swh:1:dir:ae4fe43a6d1a3666ed5027098adebba48a852b1d;origin=https://github.com/tne-lab/phase-calculator;visit=swh:1:snp:f83e3de7bd2a19f1a537971992fad49dac910b73;anchor=swh:1:rev:e11421f23403399ca6b2d85132a31e2c1d5b1397">https://archive.softwareheritage.org/swh:1:dir:ae4fe43a6d1a3666ed5027098adebba48a852b1d;origin=https://github.com/tne-lab/phase-calculator;visit=swh:1:snp:f83e3de7bd2a19f1a537971992fad49dac910b73;anchor=swh:1:rev:e11421f23403399ca6b2d85132a31e2c1d5b1397</ext-link></element-citation></ref><ref id="bib39"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Mark</surname><given-names>K</given-names></name></person-group><year iso-8601-date="2021">2021b</year><data-title>Sspe-sims</data-title><version designator="swh:1:rev:6d80fe9c5f610d0dfffe23b5eef2012f780ba621">swh:1:rev:6d80fe9c5f610d0dfffe23b5eef2012f780ba621</version><source>Software Heritage</source><ext-link ext-link-type="uri" xlink:href="https://archive.softwareheritage.org/swh:1:dir:61862faff152de83f54ce17fe43cb19a7091f71d;origin=https://github.com/Eden-Kramer-Lab/SSPE-paper;visit=swh:1:snp:0f67f7c5cce107dd9e7e415b876ad174a3254a28;anchor=swh:1:rev:6d80fe9c5f610d0dfffe23b5eef2012f780ba621">https://archive.softwareheritage.org/swh:1:dir:61862faff152de83f54ce17fe43cb19a7091f71d;origin=https://github.com/Eden-Kramer-Lab/SSPE-paper;visit=swh:1:snp:0f67f7c5cce107dd9e7e415b876ad174a3254a28;anchor=swh:1:rev:6d80fe9c5f610d0dfffe23b5eef2012f780ba621</ext-link></element-citation></ref><ref id="bib40"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Matsuda</surname><given-names>T</given-names></name><name><surname>Komaki</surname><given-names>F</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Time Series Decomposition into Oscillation Components and Phase Estimation</article-title><source>Neural Computation</source><volume>29</volume><fpage>332</fpage><lpage>367</lpage><pub-id pub-id-type="doi">10.1162/NECO_a_00916</pub-id></element-citation></ref><ref id="bib41"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Nunez</surname><given-names>PL</given-names></name><name><surname>Srinivasan</surname><given-names>R</given-names></name></person-group><year iso-8601-date="2006">2006</year><source>Electric Fields of the Brain: The Neurophysics of EEG</source><publisher-loc>Oxford, UK</publisher-loc><publisher-name>Oxford University Press</publisher-name></element-citation></ref><ref id="bib42"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rodriguez Rivero</surname><given-names>C</given-names></name><name><surname>Ditterich</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>A user-friendly algorithm for adaptive closed-loop phase-locked stimulation</article-title><source>Journal of Neuroscience Methods</source><volume>347</volume><elocation-id>108965</elocation-id><pub-id pub-id-type="doi">10.1016/j.jneumeth.2020.108965</pub-id><pub-id pub-id-type="pmid">33011185</pub-id></element-citation></ref><ref id="bib43"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Roopun</surname><given-names>AK</given-names></name><name><surname>Kramer</surname><given-names>MA</given-names></name><name><surname>Carracedo</surname><given-names>LM</given-names></name><name><surname>Kaiser</surname><given-names>M</given-names></name><name><surname>Davies</surname><given-names>CH</given-names></name><name><surname>Traub</surname><given-names>RD</given-names></name><name><surname>Kopell</surname><given-names>NJ</given-names></name><name><surname>Whittington</surname><given-names>MA</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Temporal interactions between cortical rhythms</article-title><source>Frontiers in Neuroscience</source><volume>2</volume><elocation-id>034</elocation-id><pub-id pub-id-type="doi">10.3389/neuro.01.034.2008</pub-id></element-citation></ref><ref id="bib44"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rosenblum</surname><given-names>MG</given-names></name><name><surname>Pikovsky</surname><given-names>AS</given-names></name><name><surname>Kurths</surname><given-names>J</given-names></name></person-group><year iso-8601-date="1997">1997</year><article-title>Phase synchronization in driven and coupled chaotic oscillators</article-title><source>IEEE Transactions on Circuits and Systems I</source><volume>44</volume><fpage>874</fpage><lpage>881</lpage><pub-id pub-id-type="doi">10.1109/81.633876</pub-id></element-citation></ref><ref id="bib45"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rutishauser</surname><given-names>U</given-names></name><name><surname>Kotowicz</surname><given-names>A</given-names></name><name><surname>Laurent</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>A method for closed-loop presentation of sensory stimuli conditional on the internal brain-state of awake animals</article-title><source>Journal of Neuroscience Methods</source><volume>215</volume><fpage>139</fpage><lpage>155</lpage><pub-id pub-id-type="doi">10.1016/j.jneumeth.2013.02.020</pub-id></element-citation></ref><ref id="bib46"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sameni</surname><given-names>R</given-names></name><name><surname>Seraj</surname><given-names>E</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>A robust statistical framework for instantaneous electroencephalogram phase and frequency estimation and analysis</article-title><source>Physiological Measurement</source><volume>38</volume><fpage>2141</fpage><lpage>2163</lpage><pub-id pub-id-type="doi">10.1088/1361-6579/aa93a1</pub-id></element-citation></ref><ref id="bib47"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sauseng</surname><given-names>P</given-names></name><name><surname>Klimesch</surname><given-names>W</given-names></name><name><surname>Gruber</surname><given-names>WR</given-names></name><name><surname>Hanslmayr</surname><given-names>S</given-names></name><name><surname>Freunberger</surname><given-names>R</given-names></name><name><surname>Doppelmayr</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Are event-related potential components generated by phase resetting of brain oscillations? A critical discussion</article-title><source>Neuroscience</source><volume>146</volume><fpage>1435</fpage><lpage>1444</lpage><pub-id pub-id-type="doi">10.1016/j.neuroscience.2007.03.014</pub-id></element-citation></ref><ref id="bib48"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schaworonkow</surname><given-names>N</given-names></name><name><surname>Caldana Gordon</surname><given-names>P</given-names></name><name><surname>Belardinelli</surname><given-names>P</given-names></name><name><surname>Ziemann</surname><given-names>U</given-names></name><name><surname>Bergmann</surname><given-names>TO</given-names></name><name><surname>Zrenner</surname><given-names>C</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>μ-Rhythm Extracted With Personalized EEG Filters Correlates With Corticospinal Excitability in Real-Time Phase-Triggered EEG-TMS</article-title><source>Frontiers in Neuroscience</source><volume>12</volume><elocation-id>00954</elocation-id><pub-id pub-id-type="doi">10.3389/fnins.2018.00954</pub-id></element-citation></ref><ref id="bib49"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Schiff</surname><given-names>SJ</given-names></name></person-group><year iso-8601-date="2012">2012</year><source>Neural Control Engineering: The Emerging Intersection between Control Theory and Neuroscience</source><publisher-loc>Cambridge, MA</publisher-loc><publisher-name>MIT Press</publisher-name></element-citation></ref><ref id="bib50"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shumway</surname><given-names>RH</given-names></name><name><surname>Stoffer</surname><given-names>DS</given-names></name></person-group><year iso-8601-date="1982">1982</year><article-title>An Approach to Time Series Smoothing and Forecasting Using the Em Algorithm</article-title><source>Journal of Time Series Analysis</source><volume>3</volume><fpage>253</fpage><lpage>264</lpage><pub-id pub-id-type="doi">10.1111/j.1467-9892.1982.tb00349.x</pub-id></element-citation></ref><ref id="bib51"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Siegle</surname><given-names>JH</given-names></name><name><surname>Wilson</surname><given-names>MA</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Enhancement of encoding and retrieval functions through theta phase-specific manipulation of hippocampus</article-title><source>eLife</source><volume>3</volume><elocation-id>e03061</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.03061</pub-id></element-citation></ref><ref id="bib52"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Siegle</surname><given-names>JH</given-names></name><name><surname>López</surname><given-names>AC</given-names></name><name><surname>Patel</surname><given-names>YA</given-names></name><name><surname>Abramov</surname><given-names>K</given-names></name><name><surname>Ohayon</surname><given-names>S</given-names></name><name><surname>Voigts</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Open Ephys: An open-source, plugin-based platform for multichannel electrophysiology</article-title><source>Journal of Neural Engineering</source><volume>14</volume><elocation-id>045003</elocation-id><pub-id pub-id-type="doi">10.1088/1741-2552/aa5eea</pub-id></element-citation></ref><ref id="bib53"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Song</surname><given-names>AH</given-names></name><name><surname>Ba</surname><given-names>D</given-names></name><name><surname>Brown</surname><given-names>EN</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>PLSO: A Generative Framework for Decomposing Nonstationary Timeseries into Piecewise Stationary Oscillatory Components</article-title><source>arXiv preprint</source><ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/2010.11449">https://arxiv.org/abs/2010.11449</ext-link></element-citation></ref><ref id="bib54"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Soulat</surname><given-names>H</given-names></name><name><surname>Stephen</surname><given-names>EP</given-names></name><name><surname>Beck</surname><given-names>AM</given-names></name><name><surname>Purdon</surname><given-names>PL</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>State Space Methods for Phase Amplitude Coupling Analysis</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/772145</pub-id></element-citation></ref><ref id="bib55"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Spyropoulos</surname><given-names>G</given-names></name><name><surname>Dowdall</surname><given-names>JR</given-names></name><name><surname>Schölvinck</surname><given-names>ML</given-names></name><name><surname>Bosman</surname><given-names>CA</given-names></name><name><surname>Lima</surname><given-names>B</given-names></name><name><surname>Peter</surname><given-names>A</given-names></name><name><surname>Onorato</surname><given-names>I</given-names></name><name><surname>Klon-Lipok</surname><given-names>J</given-names></name><name><surname>Roese</surname><given-names>R</given-names></name><name><surname>Neuenschwander</surname><given-names>S</given-names></name><name><surname>Singer</surname><given-names>W</given-names></name><name><surname>Vinck</surname><given-names>M</given-names></name><name><surname>Fries</surname><given-names>P</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Spontaneous Variability in Gamma Dynamics Described by a Linear Harmonic Oscillator Driven by Noise</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/793729</pub-id></element-citation></ref><ref id="bib56"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tort</surname><given-names>ABL</given-names></name><name><surname>Fontanini</surname><given-names>A</given-names></name><name><surname>Kramer</surname><given-names>MA</given-names></name><name><surname>Jones-Lush</surname><given-names>LM</given-names></name><name><surname>Kopell</surname><given-names>NJ</given-names></name><name><surname>Katz</surname><given-names>DB</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Cortical Networks Produce Three Distinct 7–12 Hz Rhythms during Single Sensory Responses in the Awake Rat</article-title><source>The Journal of Neuroscience</source><volume>30</volume><fpage>4315</fpage><lpage>4324</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.6051-09.2010</pub-id></element-citation></ref><ref id="bib57"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>VanRullen</surname><given-names>R</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Perceptual Cycles</article-title><source>Trends in Cognitive Sciences</source><volume>20</volume><fpage>723</fpage><lpage>735</lpage><pub-id pub-id-type="doi">10.1016/j.tics.2016.07.006</pub-id></element-citation></ref><ref id="bib58"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Voloh</surname><given-names>B</given-names></name><name><surname>Womelsdorf</surname><given-names>T</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>A Role of Phase-Resetting in Coordinating Large Scale Neural Networks During Attention and Goal-Directed Behavior</article-title><source>Frontiers in Systems Neuroscience</source><volume>10</volume><elocation-id>18</elocation-id><pub-id pub-id-type="doi">10.3389/fnsys.2016.00018</pub-id></element-citation></ref><ref id="bib59"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>West</surname><given-names>M</given-names></name></person-group><year iso-8601-date="1997">1997</year><article-title>Time series decomposition</article-title><source>Biometrika</source><volume>84</volume><fpage>489</fpage><lpage>494</lpage></element-citation></ref><ref id="bib60"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Widge</surname><given-names>AS</given-names></name><name><surname>Heilbronner</surname><given-names>SR</given-names></name><name><surname>Hayden</surname><given-names>BY</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Prefrontal cortex and cognitive control: New insights from human electrophysiology</article-title><source>F1000Research</source><volume>8</volume><elocation-id>20044.1</elocation-id><pub-id pub-id-type="doi">10.12688/f1000research.20044.1</pub-id></element-citation></ref><ref id="bib61"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Withers</surname><given-names>CS</given-names></name><name><surname>Nadarajah</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>The distribution of the amplitude and phase of the mean of a sample of complex random variables</article-title><source>Journal of Multivariate Analysis</source><volume>113</volume><fpage>128</fpage><lpage>152</lpage><pub-id pub-id-type="doi">10.1016/j.jmva.2012.05.017</pub-id></element-citation></ref><ref id="bib62"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Xing</surname><given-names>D</given-names></name><name><surname>Shen</surname><given-names>Y</given-names></name><name><surname>Burns</surname><given-names>S</given-names></name><name><surname>Yeh</surname><given-names>CI</given-names></name><name><surname>Shapley</surname><given-names>R</given-names></name><name><surname>Li</surname><given-names>W</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Stochastic Generation of Gamma-Band Activity in Primary Visual Cortex of Awake and Anesthetized Monkeys</article-title><source>Journal of Neuroscience</source><volume>32</volume><fpage>13873</fpage><lpage>13880</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.5644-11.2012</pub-id></element-citation></ref><ref id="bib63"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yousefi</surname><given-names>A</given-names></name><name><surname>Basu</surname><given-names>I</given-names></name><name><surname>Paulk</surname><given-names>AC</given-names></name><name><surname>Peled</surname><given-names>N</given-names></name><name><surname>Eskandar</surname><given-names>EN</given-names></name><name><surname>Dougherty</surname><given-names>DD</given-names></name><name><surname>Cash</surname><given-names>SS</given-names></name><name><surname>Widge</surname><given-names>AS</given-names></name><name><surname>Eden</surname><given-names>UT</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Decoding Hidden Cognitive States From Behavior and Physiology Using a Bayesian Approach</article-title><source>Neural Computation</source><volume>31</volume><fpage>1751</fpage><lpage>1788</lpage><pub-id pub-id-type="doi">10.1162/neco_a_01196</pub-id></element-citation></ref><ref id="bib64"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zrenner</surname><given-names>C</given-names></name><name><surname>Desideri</surname><given-names>D</given-names></name><name><surname>Belardinelli</surname><given-names>P</given-names></name><name><surname>Ziemann</surname><given-names>U</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Real-time EEG-defined excitability states determine efficacy of TMS-induced plasticity in human motor cortex</article-title><source>Brain Stimulation</source><volume>11</volume><fpage>374</fpage><lpage>389</lpage><pub-id pub-id-type="doi">10.1016/j.brs.2017.11.016</pub-id></element-citation></ref><ref id="bib65"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zrenner</surname><given-names>C</given-names></name><name><surname>Galevska</surname><given-names>D</given-names></name><name><surname>Nieminen</surname><given-names>JO</given-names></name><name><surname>Baur</surname><given-names>D</given-names></name><name><surname>Stefanou</surname><given-names>MI</given-names></name><name><surname>Ziemann</surname><given-names>U</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>The shaky ground truth of real-time phase estimation</article-title><source>NeuroImage</source><volume>214</volume><elocation-id>116761</elocation-id><pub-id pub-id-type="doi">10.1016/j.neuroimage.2020.116761</pub-id><pub-id pub-id-type="pmid">32198050</pub-id></element-citation></ref></ref-list></back><sub-article article-type="decision-letter" id="sa1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.68803.sa1</article-id><title-group><article-title>Decision letter</article-title></title-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Skinner</surname><given-names>Frances K</given-names></name><role>Reviewing Editor</role><aff><institution>Krembil Research Institute, University Health Network</institution><country>Canada</country></aff></contrib></contrib-group><contrib-group><contrib contrib-type="reviewer"><name><surname>Lankarany</surname><given-names>Milad</given-names></name><role>Reviewer</role><aff><institution>The Hospital for Sick Children, University of Toronto</institution><country>Canada</country></aff></contrib></contrib-group></front-stub><body><boxed-text id="box1"><p>Our editorial process produces two outputs: (i) <ext-link ext-link-type="uri" xlink:href="https://sciety.org/articles/activity/10.1101/2021.03.25.437024">public reviews</ext-link> designed to be posted alongside <ext-link ext-link-type="uri" xlink:href="https://www.biorxiv.org/content/10.1101/2021.03.25.437024v1">the preprint</ext-link> for the benefit of readers; (ii) feedback on the manuscript for the authors, including requests for revisions, shown below. We also include an acceptance summary that explains what the editors found interesting or important about the work.</p></boxed-text><p><bold>Acceptance summary:</bold></p><p>This paper will be of interest to theoretical and experimental neuroscientists. It proposes a novel approach based on state space modeling to estimate the phase of neural signals like EEG and LFP in real-time. It is expected to help drive the improvement and proliferation of phase-related concepts in neurobiology.</p><p><bold>Decision letter after peer review:</bold></p><p>Thank you for submitting your article &quot;A State Space Modeling Approach to Real-Time Phase Estimation&quot; for consideration by <italic>eLife</italic>. Your article has been reviewed by 3 peer reviewers, and the evaluation has been overseen by a Reviewing Editor and Laura Colgin as the Senior Editor. The following individuals involved in review of your submission have agreed to reveal their identity: Milad Lankarany (Reviewer #1).</p><p>The reviewers have discussed their reviews with one another, and the Reviewing Editor has drafted this to help you prepare a revised submission.</p><p>Essential revisions:</p><p>1) Consider the impact of noise in the phase estimation, include specifications of the Kalman filter and its robustness, and consider the performance of the estimated phase relative to other methods.</p><p>2) Demonstrate the advantage of using this method for exploring the link between rhythms and behaviour and for phase-locked stimulation, and separate applications that require real time phase estimation from those that can be performed offline using acausal methods.</p><p>3) Provide some help to readers from non-technical background by linking the method back to applications and in-vivo data more.</p><p>4) Expand details regarding computing credible intervals, slow drift considerations, and physiological motivation of the simulations.</p><p>Further details are provided below in the 'Recommendations for the authors'.</p><p><italic>Reviewer #1 (Recommendations for the authors):</italic></p><p>I believe the proposed method in this paper is very novel and timely for the neuroscience community. The paper is well organized and written very clearly. I have some comments that might improve the quality of this paper.</p><p>1. Impact of Noise in the phase estimation. Although there is a section in the Discussion related to Noise in Signal, the authors did not address the impact of Signal to Noise Ratio (SNR) on the performance of their algorithms. I think this will add value to your algorithm, specifically because the Kalman Filter can be much more reliable than other methods in this context.</p><p>2. Specifications of the Kalman Filter and its robustness. specifications of the Kalman filter (KF) should be described in the Method Section. For example, the choice of state and observation covariance matrices (Q and R) should be clarified. In this regard, the authors can discuss the robustness of the KF in phase estimation.</p><p>3. For in-vivo data, how the performance of the estimated phase might be compared to other methods (used in the simulation study)? It can be helpful to visually compare the estimated phase calculated by SSPE and other methods which were used in the simulation study.</p><p><italic>Reviewer #2 (Recommendations for the authors):</italic></p><p>I think the manuscript can be improved by</p><p>1) clearly demonstrating the advantage of using this method for exploring the link between rhythms and behaviour and for phase-locked stimulation. The authors should separate applications that require real time phase estimation from those that can be performed offline using acausal methods.</p><p>2) Building on my previous point:</p><p>– In figure 2, proposed method clearly outperforms others for signals generated using the &quot;state space model&quot;. How representative is this for in-vivo recordings?</p><p>– In figure 4, it is demonstrated that other methods cannot track phase-reset, however, is this offset sustained or is it a transient slip in phase estimation for one cycle. In other words, if we zoom out in time, do the other methods converge back to true phase? And if so, when would it be critical to track phase-reset for one cycle?</p><p>– The performance of SSPE should be demonstrated with respect to other methods for in-vivo data (figures 5 and 7) so that the reader can evaluate the utility of this method.</p><p>3) The paper is well written but comes across as very technical. Readers from non-technical backgrounds may struggle with following some of the concepts. This could be improved by linking the method back to applications and in-vivo data more, and also by reviewing the language used in the methods segment.</p><p><italic>Reviewer #3 (Recommendations for the authors):</italic></p><p>1) Credible intervals</p><p>An interesting aspect of the manuscript is the possibility of computing credible intervals, making it possible to establish bounds on time points when the phase can be estimated with sufficient accuracy. In previous approaches, this is usually done via an amplitude threshold, with the assumption that a high amplitude will also result in high phase estimation accuracy. In Figure 6 the authors therefore study the relationship between amplitude and credible intervals. It is tough to interpret this evidence; the argument is that for an amplitude threshold using the 65th percentile the range of credible intervals is from the minimum to maximum possible. But looking at the major bulk of probability mass, it's centered around intervals with an acceptable looking range? Could more details regarding computation of confidence intervals be provided, e.g. are they symmetric? Figure 6C is a scatter plot with lots of points that are correlated, maybe it would be good to visualize this in a different way reducing the number of points per cycle? Can the credible intervals be related to error in degrees? They look pretty negligible in the left part of the figure (given that the real-time procedure also introduces a lag, Figure 8B),is the plotted x-range the relevant one? How does SNR/amplitude relate to phase accuracy to credible intervals? If the spread of credible intervals can be largely explained by amplitude (aka high correlation between credible interval width and amplitude), then maybe this is not such a big factor?</p><p>2) Slow drifts</p><p>A practical reason why existent algorithms rely on buffering is the frequent existence of slow drifts in the data, for which detrending needs to be applied. For the EEG data, the following methodological detail of the current approach is given &quot;Before real-time phase estimation, we high-pass filter the data at 0.5 Hz to remove slow drifts.&quot; This procedure is not possible when estimating the phase in real-time. The authors claim the benefit of their approach is the absence of needing buffers, but in the light of this I am not sure about whether this is the case. In the discussion, the authors discuss the possibility of modeling the slow drifts via an additional rhythm in the state space, but state that long segments of data are needed for this. In my view, this is a crucial aspect of any algorithm targeting real-time phase and more information and analysis resolving slow drifts would greatly improve the actual applicability of the present approach.</p><p>3) Data generation process and simulations</p><p>I find some of the simulations not sufficiently motivated from a physiological perspective.</p><p>– Two simultaneous rhythms with nearby frequencies: In this scenario the authors simulate the signal as a summation of two sinusoids with a frequency offset with a fixed phase shift. This will result in a signal with amplitude modulation with the envelope given by the difference of the frequencies, resulting in the appearance of oscillatory bursts. I would argue that for physiological signals that present like this, it is not of interest to track a single frequency in this signal, as e.g. the trough phase of this compound signal corresponds to a specific physiological state. I would also suggest showing the amplitude for this case in Figure 3. Possibly the simulation could be modified to be better physiologically motivated, as they are certainly cases where there are neighboring rhythms which present on the same electrode through volume conduction, but it is unclear (but would be of interest) to me if the proposed method could be helpful in this case.</p><p>– From my perspective phase is only well-defined if there are clear-cut oscillatory bursts. In that sense, the signal given as an example in Figure 2A iv does not have clear-cut oscillatory states, with no clear spectral peak and the true phase (blue curve) changing rapidly. The authors show that the algorithm performs well here as this is exactly according to their data-generating process assumptions (e.g. Figure 2C right-most), whereas for the other algorithms errors accumulate especially in fast phase changing periods. In my view, this simulated situation conceptually does not capture processes that are relevant to investigating neural oscillations in the brain, which would follow a conceptual model more similar to: multiplicative 1/f contribution * oscillator + additive 1/f contribution, so that presumably corresponds to the presented filtered pink noise case here. Can the authors clarify the motivation for this simulated case?</p><p>– The authors speak of broadband oscillations, for instance relating to the mu-rhythm (l. 554). In my view this is a narrowband oscillation with a clear peak judging from the power spectrum, with the broadness of the peak influenced by the presence of strong amplitude envelope modulations. Can authors clarify their criteria for defining an oscillation as broadband, in my view this is non-standard terminology.</p><p>– One limitation of band-pass filtered approaches that the authors mention is non-sinusoidality (l. 48). In my view, this is manifested in differences in waveform shape, e.g. the arc-shape of the mu-rhythm in Figure 7D. It does not seem that problems in phase estimation for this type of signals (e.g. non-uniform phase-velocity) is addressed by the method as the estimated state does not capture the arc-shape of the rhythm. Can the authors clarify in what way they contribute to resolve this limitation?</p><p>4) I would welcome additional details in the text regarding following methodological procedures, which should yield a more self-contained manuscript:</p><p>– While bandpass filtering and Hilbert-transform are quite common operations for electrophysiologists, a state space approach may be unfamiliar to the typical reader. Possibly it would be helpful to have clearer paragraphs describing the framework (aka rework l. 98ff), I think the attempt here was to first explain the procedure without formulas, which appear further down, I am not quite sure that this succeeded in providing clarity. Maybe it would be helpful to first make an example with only 1 rhythm, so that dimensionality of the involved entities is not as complex as for tracking N rhythms. Maybe it would also be helpful to extend Figure 1 with a conceptual diagram. How is the number and frequency of oscillators chosen for empirical data?</p><p>– E.g. regarding the parameter estimation the reader is referred to the supplementary material of Soulat et al. 2019. Can an intuition about this procedure be given? I find this interesting in the context that a quite large range for expected computation time is given (2-100 s, l. 573). Can the authors comment on factors influencing this? Maybe a more detailed description of the procedure will be helpful for understanding this.</p><p>– Currently descriptions of the comparison algorithms are lacking, e.g. what is the general procedure and difference between Zrenner and Blackwood algorithm, what are the crucial parameters here? The authors give code-accessibility as the main reason for selecting those two specific instances. Because recently a lot of different methods (mostly variants involving band-pass filtering) were proposed for estimating the phase in real-time, maybe those 2 selected ones could be better discussed in the context of others in the literature.</p><p>– typo, l.55 extant -&gt; existant</p><p>– the dotted lines for phase estimates may be not optimal visually (e.g. Figure 6B), maybe shading of credible intervals would look nicer?</p><p>– Can the authors provide more details on how the power spectra were estimated? The simulation ones look like Welch's method and the data ones like multitaper were used.</p><p>– If I understood correctly, the employed two-sided t-test is calculated using lots of correlated data points (using all time points in an interval), resulting in reduced degree of freedom. I think the evidence that the SSPE approach works better here is actually strong, but the t-test looks slightly weird because of wrong degrees of freedom, distracting from the result. Maybe the information from table 1 can just be plotted in a distributional way, more like Figure 2C?</p><p>[Editors' note: further revisions were suggested prior to acceptance, as described below.]</p><p>Thank you for resubmitting your work entitled &quot;A State Space Modeling Approach to Real-Time Phase Estimation&quot; for further consideration by <italic>eLife</italic>. Your revised article has been evaluated by Laura Colgin (Senior Editor) and a Reviewing Editor.</p><p>The manuscript has been considerably improved and this interesting paper provides inspiration for the field, bringing state space models and phase estimation for neural recordings together. However, there are a few remaining points that are mainly related to presentation results that could be improved. It will not be sent back to the reviewers for final evaluation.</p><p><italic>Reviewer #3 (Recommendations for the authors):</italic></p><p>I thank the authors for extensive replies to my comments, which have clarified many aspects and made the method description more accessible. I like the new waveform shape figure showing the simultaneous tracking of the base + harmonic frequency. I find the SSPE method interesting from a principal perspective, but am not yet sure in what way the performance of the algorithm is superior to other algorithms in physiologically relevant cases. My remaining comments:</p><p>1) Plausibility of simulations R3.Q4</p><p>– The state space model simulations (Figure 2A.iv) generating model are not a common data generation model for the rhythms the authors actually investigate (theta and mu). The newly added citations are for the γ-rhythm (and a quite obscure EEG paper). -&gt; I would say this is not a generally accepted data generation model for mu and theta. The fact that the SSPE performs well on data generated from the exact state space model does not seem to entirely relevant for the chosen application, with the simulation lacking stability in cycle periods that is present for mu and theta. Possibly, a note can be added in the Discussion section in the narrow-band vs broad-band signal section, reflecting on broad-band phase would be beneficial.</p><p>– The filtered pink noise seems to result in a broader spectral peak (green line in Figure 2B.ii) than is present in the empirical data. As the band-pass filter parameters of the alternative algorithms are possibly adjusted for more narrowband signals, not adjusting the bandwidth before e.g., doing a Hilbert transform may yield an unfair comparison. Can you comment on that?</p><p>– My suggested approach using multiplicative 1/f corresponds to the second of the simulations provided by the authors in R3.A4. To clarify this, I attach some python lines at the end to show a simulated signal, if there is interest (parameters to be adjusted). The phase estimation errors in the provided plot in the response seem really low, so maybe the oscillatory SNR is too high for this simulated case (also the amplitude modulation is not really prominent?) I find it confusing that the SSPE method does not yield any benefit here. I am not requesting specifically for this type simulation to be included, but I would like to understand generally the conditions under which SSPE yields better results than the alternative algorithms.</p><p>From my understanding, SSPE should yield benefits for phase estimation in intermediate SNR ranges, but at the moment the authors have added more evidence that all algorithms show very similar behavior at high SNR (Figure Supplement I for Figure 7 and 8) and the simulation type provided in Figure 5 has some issues with phase stability as it is filtered pink noise (see comments above) and the modelled SNR range (there is not much change in phase estimation errors which I would have expected to vary with increasing SNR).</p><p>R3.Q3:</p><p>I can acknowledge the scenario of the two simultaneous rhythms with nearby frequencies which the authors attribute to two different rhythms instead of seeing as amplitude modulated bursts. For this case, maybe the modeling scenario would be more general, if the rhythms had varying phase lag (random for each trial) instead of a fixed phase lag (pi/4), which seems like the case in which the rhythms are most easily distinguishable.</p><p>2) The relationship between credible intervals and amplitude measures. R3.Q1.</p><p>– The authors argue for a dissociation between credible intervals and amplitude values, with evidence provided by e.g., Figure 7. Given the nature of the data, with oscillations occurring in bursts and not as a continuous oscillation, I am wary of phase estimates for time points where there is no oscillation (e.g., for the theta data, oscillation probability is heavily dependent on animal speed and there will be periods in the data without an oscillation). My main point here is that credible intervals seem to have a correspondence to amplitudes in a range where an oscillation is clearly present (high amplitude) and phase is not defined when an oscillation is absent. Sure, the acausal FIR will return a value for every time point, but it's not necessarily meaningful in a physiological sense. Taking this as the ground truth is problematic for the credible interval and amplitude measures dissociation. For instance, is there a discernible oscillation for the data in Figure 7 for an amplitude criterion &gt; 65th percentile? Is a wide or narrow credible interval around a value that is not defined meaningful?</p><p>Figure 7C is a scatter plot with lots of points that are correlated, maybe it would be good to visualize this in a different way reducing the number of points per cycle</p><p>possibly by subsampling or a 2D histogram. In the current presentation, the plot basically just shows the range of the data, amplifying low-occurrence data points.</p><p>This suggests that, at low SNR, an arbitrary amplitude threshold (e.g., amplitude &gt; 1) would eliminate all data at SNR=1, and preserve all data at SNR=2.5.</p><p>Typically (e.g., in the Zrenner studies), amplitude is defined as a relative criterion, e.g., with percentile threshold or mean amplitude +- 2.5 SD using some training interval, so I am not sure about this argument.</p><p>– We find that fixed amplitude thresholds produce wide ranges of credible intervals (Figure 7C.ii). This is especially apparent at lower amplitude thresholds; choosing a threshold of 65% results in credible intervals that range from 0.042.29 (minimum) to 174.75 (maximum) degrees.</p><p>Can authors list the 95% range here, rather than min/max?</p><p>– Figure 5: Can a spectrogram can also be plotted in this figure?</p><p>I would expect the height of the spectral peak over the 1/f-contribution to vary here.</p><p>3) Code availability</p><p>I wanted to check the used bandpass filter parameters (since it's not described for the Blackwood algorithm) and noticed that the linked repository does not feature the code to recreate the plots in the manuscript, possibly it would be helpful for other researchers to provide that, also for comparing to other algorithms in the future.</p></body></sub-article><sub-article article-type="reply" id="sa2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.68803.sa2</article-id><title-group><article-title>Author response</article-title></title-group></front-stub><body><disp-quote content-type="editor-comment"><p>Essential revisions:</p><p>1) Consider the impact of noise in the phase estimation, include specifications of the Kalman filter and its robustness, and consider the performance of the estimated phase relative to other methods.</p></disp-quote><p>We address these suggestions in detail below.</p><disp-quote content-type="editor-comment"><p>2) Demonstrate the advantage of using this method for exploring the link between rhythms and behaviour and for phase-locked stimulation, and separate applications that require real time phase estimation from those that can be performed offline using acausal methods.</p></disp-quote><p>We address these suggestions in our response in R2.A2.</p><disp-quote content-type="editor-comment"><p>3) Provide some help to readers from non-technical background by linking the method back to applications and in-vivo data more.</p></disp-quote><p>Please see our responses in R3.A7 for a detailed response to this suggestion.</p><disp-quote content-type="editor-comment"><p>4) Expand details regarding computing credible intervals, slow drift considerations, and physiological motivation of the simulations.</p></disp-quote><p>Please see our responses in R2.A3, R3.A1, R3.A2, R3.A3 and R3.A4 where we address these points.</p><disp-quote content-type="editor-comment"><p>Further details are provided below in the 'Recommendations for the authors'.</p><p>Reviewer #1 (Recommendations for the authors):</p><p>I believe the proposed method in this paper is very novel and timely for the neuroscience community. The paper is well organized and written very clearly.</p></disp-quote><p>Thank you for your kind comments, they helped us further describe how performance links to signal-to-noise ratio and show the performance of SSPE relative to other methods.</p><disp-quote content-type="editor-comment"><p>I have some comments that might improve the quality of this paper.</p><p>1. Impact of Noise in the phase estimation. Although there is a section in the Discussion related to Noise in Signal, the authors did not address the impact of Signal to Noise Ratio (SNR) on the performance of their algorithms. I think this will add value to your algorithm, specifically because the Kalman Filter can be much more reliable than other methods in this context.</p></disp-quote><p>R1.A1. As recommended by the Reviewer, we have updated the manuscript to include a new simulation study characterizing the impact of signal to noise on real time phase estimation. We show that the SSPE method outperforms the other real time methods, and that the credible intervals (CI) vary although signal amplitude is fixed (in response to R3.Q1). We have updated the Results and Methods as follows:</p><p>Results, after Section Phase estimation following phase reset</p><p>“Phase estimation with different signal-to-noise ratios: To demonstrate the impact of noise on phase estimation we simulate signals with different signal-to-noise ratios. To generate a signal we filter pink noise into the band of interest (FIR filter, 4-8 Hz, “Filtered Pink Noise”, see Methods), and then add additional (unfiltered) pink noise. The ratio of the standard deviations of the signal and noise defines the signal-to-noise ratio; we modulate the standard deviation of the signal to achieve the desired SNR. Finally, we normalize the full observation so that amplitudes across simulations are consistent. In these simulations the SNR varies from 1 (signal and noise have the same total power) to 10 (signal has 100 times the total power of the noise); see example traces of the observation under each SNR in Figure 5A.i – iv. We repeat each simulation 1000 times with different noise instantiations for each signal to noise ratio.</p><p>We compute two metrics to characterize the impact of signal-to-noise on phase estimation. First, we consider the credible intervals estimated by the SSPE, here measured as the average credible interval width throughout a simulation. As expected, the credible intervals track with the SNR (Figure 5.B.ii); signals with higher SNR correspond to smaller credible intervals. Computing the average amplitude (as derived from the acausal FIR, see Methods: “Non-Causal Phase Estimation”) throughout each simulation, we find no overlap between the distributions of amplitudes at SNR=1 and SNR=2.5 (5B.ii), while the distributions of credible intervals overlap. This suggests that, at low SNR, an arbitrary amplitude threshold (e.g., amplitude &gt; 1) would eliminate all data at SNR=1, and preserve all data at SNR=2.5. Alternatively, using the credible interval width allows identification of transient periods of confidence (e.g., credible interval width &lt; 40 degrees) at both SNR values. We also note that the CI width – in units of degrees – provides a more intuitive threshold than the amplitude, whose intrinsic meaning at any particular value is only understood relatively. These results suggest that, in this simulation study, amplitude serves as a less accurate criterion for confidence in phase compared to the CI width.</p><p>Second, we consider the error in phase estimates using four different phase estimation methods (Figure 5C). We find that the error for the SSPE method reduces more quickly than for the other methods, and at a SNR of 1, the SSPE method is comparable to or better than the contemporary methods of real-time phase estimation. At SNR = 10, the error in the SSPE phase estimation is comparable to the acausal FIR, while the alternative real-time algorithms continue to perform with error similar to an SNR of 1. These results suggest that, for the two existing real-time phase estimation methods, broadband rhythms are difficult to track even with high SNR, consistent with Figure 2C.”</p><p>Methods, Simulated data, following the sub-section Phase Reset;</p><p>Signal to Noise Ratio</p><p>“To investigate the impact of signal-to-noise ratio (SNR) on phase estimation, we again simulate a filtered pink noise signal (centered at 6 Hz) with added pink noise (the third type of rhythm simulated in Methods: Narrow Band to Broad Band Rhythms). To modulate the SNR, we first compute,<disp-formula id="sa2equ1"><mml:math id="sa2m1"><mml:mrow><mml:mtext>SN</mml:mtext><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mtext> </mml:mtext><mml:mo>=</mml:mo><mml:mtext> </mml:mtext><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mtext>signal</mml:mtext></mml:mrow></mml:msub><mml:mtext> </mml:mtext><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mtext> </mml:mtext><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mtext>noise</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="sa2m2"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mtext>signal</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> (<inline-formula><mml:math id="sa2m3"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mtext>noise</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>) is the standard deviation of the filtered pink noise signal (added pink noise). We then divide the filtered pink noise signal by <inline-formula><mml:math id="sa2m4"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mtext>SN</mml:mtext><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, multiply the filtered pink noise signal by the chosen SNR (1, 2.5, 5, 7.5, 10), and add this scaled signal to the pink noise.”</p><disp-quote content-type="editor-comment"><p>2. Specifications of the Kalman Filter and its robustness. specifications of the Kalman filter (KF) should be described in the Method Section. For example, the choice of state and observation covariance matrices (Q and R) should be clarified. In this regard, the authors can discuss the robustness of the KF in phase estimation.</p></disp-quote><p>R1.A2. As recommended, we have updated the Methods to clarify the choice of the state and observation covariance matrices (Q and R), as well as the starting values for the state and state covariance as follow:</p><p>Methods, following equation (5):</p><p>“We note that the state (Q) and observation (R) covariance matrices are estimated from the data, as described below.”</p><p>Methods, Section Real-time Phase Estimation:</p><p>”We now define the stages of Kalman filtering. The state is initialized with zeros and the state covariance to a diagonal matrix with 0.001 along the diagonal. To predict the future state and state estimation error …”</p><p>We also now discuss the robustness of the Kalman filter in phase estimation:</p><p>Methods, Section Real-time Phase Estimation:</p><p>“ … With these model parameters estimated and fixed, we then apply a Kalman filter to predict and update the state estimates, and estimate the phase and amplitude for each oscillator, each representing a different rhythm, for every sample (Figure 1). We note that the Kalman filter is an optimal filter, i.e., in the presence of Gaussian noise, the Kalman filter achieves minimum error and is an unbiased estimate of the mean phase. However, if the noise is not Gaussian, the Kalman filter remains the optimal linear filter for phase estimation under this model. Given the stochastic frequency modulation that is possible under the model, the Kalman filter is robust to small shifts in the central frequency of the rhythm.”</p><disp-quote content-type="editor-comment"><p>3. For in-vivo data, how the performance of the estimated phase might be compared to other methods (used in the simulation study)? It can be helpful to visually compare the estimated phase calculated by SSPE and other methods which were used in the simulation study.</p></disp-quote><p>R1.A3. To address this, we have updated the Results to include the estimated phase computed with the other real-time phase estimation methods. We show that phase estimates converge when the rhythm has a high signal-to-noise ratio (SNR), but diverge at low SNR for both the theta and the mu rhythm. Additionally, we show error estimates for both the LFP theta and the EEG mu rhythm data, demonstrating that the SSPE performs comparably to the acausal FIR on the data. We note that the error estimate critically depends on the generative model assumed for the in vivo signal (the SSPE method and existing methods assume different underlying models for the rhythm). We have updated the Results in the revised manuscript as follows,</p><p>Results, Section Example in vivo application: rodent LFP:</p><p>…”However, comparing the estimated phase to the true phase (see Methods), we find that the phase error tends to remain consistent in time (blue curve in Figure 6A; circular standard deviation 95 percent interval = [33.11, 75.39]; for error of phase estimates computed using alternative methods, see Figure Supplement 6-I). “…</p><p>“To illustrate this, we show the phase and credible interval estimates of the SSPE method for an example 3 s interval of the LFP data (Figure 7; for comparison to phase estimates computed using the existing methods, see Figure Supplement 7-I). We note that, …”</p><disp-quote content-type="editor-comment"><p>Reviewer #2 (Recommendations for the authors):</p><p>I think the manuscript can be improved by</p><p>1) clearly demonstrating the advantage of using this method for exploring the link between rhythms and behaviour and for phase-locked stimulation. The authors should separate applications that require real time phase estimation from those that can be performed offline using acausal methods.</p></disp-quote><p>R2.A2. To address this question, we again utilize the dataset shared by Zrenner and colleagues in Zrenner et al. 2020. There, the authors stimulate using transcranial magnetic stimulation (TMS) at random phases of the mu rhythm and use a post-hoc causal analysis to examine whether there is modulation of the motor evoked potentials’ (MEP) amplitudes as a function of the phase of the mu rhythm. They show that using their real-time phase estimation method, MEP amplitude is selectively higher closer to the trough of the mu rhythm. We test whether the SSPE method can replicate these findings. To do so, we apply the SSPE method, using parameters estimated on a different subject, to the pre-stimulus EEG data to estimate the phase at the moment of TMS stimulation. We find that phase as estimated from the SSPE method is a strong predictor of the MEP amplitude (when fitting a circular linear regression model), with the peak close to the mu rhythm trough as predicted.</p><p>We add a new figure and results to the Results section of the manuscript, as follows:</p><p>Results: Pre-stimulus Mu-Rhythm Phase Predicts MEP amplitude</p><p>“To illustrate the utility of real-time phase estimation, we again analyze an example EEG recording from (Zrenner et al., 2020) in which the authors stimulate at random intervals using transcranial magnetic stimulation (TMS) a subject using to elicit a motor evoked potential (MEP) from the right abductor pollicis brevis muscle. We analyze the MEP amplitude to assess the influence of pre-stimulus mu rhythm phase on the response (replicating the analysis performed by Zrenner et al. 2020). We estimate mu rhythm phase using the SSPE method with model parameters derived from a different subject. We find that the pre-stimulus phase of the mu rhythm, at the instant immediately prior to stimulation, predicts (using circular linear regression) 13 percent of the log-transformed MEP amplitude (Figure 9A). Furthermore, thresholding the trials using credible interval width, we find improved prediction of the MEP amplitude. When using trials with credible interval width less than 50 degrees, the mu rhythm phase explains 30% of the variance in the MEP amplitude (Figure 9B), and with credible interval width less than 25 degrees, 48% of the variance in the MEP amplitude (Figure 9C). These results show that modulation of the MEP amplitude depends on the pre-stimulus phase of the mu rhythm, and suggest that accurate estimation of the mu rhythm (e.g., using the SSPE method with narrow credible interval width) may enhance the evoked motor response.”</p><p>Further, we have ensured that in the manuscript, we clarify whether real-time analysis is required:</p><p>Phase Estimation Following Phase Reset: “… Further, accurate tracking of phase resets would provide better evidence for the relevance of phase resetting in generating event related potentials (Sauseng et al., 2007) – an analysis that could also be performed acausally.”</p><disp-quote content-type="editor-comment"><p>2) Building on my previous point:</p><p>– In figure 2, proposed method clearly outperforms others for signals generated using the &quot;state space model&quot;. How representative is this for in-vivo recordings?</p></disp-quote><p>R2.A3. To clarify this point, we have updated the manuscript to motivate the state space model as representative of features in in vivo recordings as follows:</p><p>Methods: Narrow Band to Broadband Rhythms: “For the final rhythm we simulate a signal <inline-formula><mml:math id="sa2m5"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> from the SSPE model (see Methods: State Space Model Framework) which is non-sinusoidal and broadband. … The state in the state space model is an auto-regressive model of order 2 (West 1997a) (equivalently, a damped harmonic oscillator driven by noise), which has been proposed to capture features of γ rhythms in visual cortex and rhythms in EEG (Franaszczuk and Blinowska 1985, <ext-link ext-link-type="uri" xlink:href="https://www.zotero.org/google-docs/?MPQP0d">Xing et al., 2012</ext-link>, Burns et al. 2010, Spyropoulos et al. 2020). The addition of observation noise under the state space model can be analogized to measurement noise. Thus, the state space model provides a simple possible model for brain rhythms observed in electrophysiological data.”…</p><p>New references:</p><p>West, M. (1997a) Time series decomposition. Biometrika, 84, 489-494</p><p>Xing, D., Shen, Y., Burns, S., Yeh, C. I., Shapley, R., and Li, W. (2012). Stochastic generation of γ-band activity in primary visual cortex of awake and anesthetized monkeys. Journal of Neuroscience, 32(40), 13873-13880a.</p><p>Burns, S. P., Xing, D., Shelley, M. J., and Shapley, R. M. (2010). Searching for autocoherence in the cortical network with a time-frequency analysis of the local field potential. Journal of Neuroscience, 30(11), 4033-4047.</p><p>Franaszczuk, P. J., and Blinowska, K. J. (1985). Linear model of brain electrical activity—EEG as a superposition of damped oscillatory modes. Biological cybernetics, 53(1), 19-25.</p><p>Spyropoulos, G., Dowdall, J. R., Schölvinck, M. L., Bosman, C. A., Lima, B., Peter, A., … and Fries, P. (2020). Spontaneous variability in γ dynamics described by a linear harmonic oscillator driven by noise. bioRxiv, 793729.</p><disp-quote content-type="editor-comment"><p>– In figure 4, it is demonstrated that other methods cannot track phase-reset, however, is this offset sustained or is it a transient slip in phase estimation for one cycle. In other words, if we zoom out in time, do the other methods converge back to true phase? And if so, when would it be critical to track phase-reset for one cycle?</p></disp-quote><p>R2.A4. Indeed, it is the case that the methods all return to accurately track the rhythm after some time. This simulation suggests that, when stimuli appear for a human or non-human animal during normal behavior (when phase resets might occur), the SSPE method continues to perform well. In fact, recent work attempting to perform phase stimulation based on the theta rhythm has been forced to avoid segments with phase resets to reduce error in real-time phase estimation (Gordon et al. 2021). While bandpass filter approaches struggle with phase estimation in the presence of phase resets as a function of the window size used, the SSPE method (by virtue of the Kalman Filter) continues to perform optimally.</p><p>To address this important question, we include additional analysis and explanation in the revised manuscript as follows:</p><p>Results: Phase estimation following phase reset: “…Phase resets are common and well documented in electrophysiological recordings (Fiebelkorn et al., 2011; Makeig et al., 2004). Recent work delivering electrical stimulation based on phase of the theta rhythm has been forced to avoid segments with phase resets to reduce error in real-time phase estimation (Gordon et al., 2021). Further, accurate tracking of phase resets …</p><p>…“These results demonstrate that the existing causal and acausal methods implemented here are unable to estimate the phase accurately immediately after a phase reset. To determine how quickly each method returned to accurate phase estimation, we first estimated the pre-stimulus average error for each method, prior to the first phase reset, over a 500 ms interval. We then determined the time between each subsequent phase reset and the moment when the error reduced to 1.5 times the pre-stimulus error. Note that the level of pre-stimulus error differs across methods, so, for example, we determine when the SSPE converges to a lower error than the Blackwood method (see top row of Table 1). We find that each method eventually converged to accurate phase estimation after a phase reset, with the SSPE method converging most rapidly (Table 1). The differences between methods likely result from the windowing used by each method when estimating the phase; smaller windows will lead to less impact of the phase reset on the error (as seen with the Blackwood approach converging more quickly than the Zrenner method), with the SSPE needing a window of a single sample.”</p><disp-quote content-type="editor-comment"><p>– The performance of SSPE should be demonstrated with respect to other methods for in-vivo data (figures 5 and 7) so that the reader can evaluate the utility of this method.</p></disp-quote><p>R2.A5. As recommended, we now include this comparison in the revised manuscript. Please see R1.A3 for a detailed response (including new figures) to this comment.</p><disp-quote content-type="editor-comment"><p>3) The paper is well written but comes across as very technical. Readers from non-technical backgrounds may struggle with following some of the concepts. This could be improved by linking the method back to applications and in-vivo data more, and also by reviewing the language used in the methods segment.</p></disp-quote><p>R2.A6. To address this comment, we have updated the manuscript to include additional intuitive descriptions (including a new schematic diagram) in the Methods; please see R3.A7 for details. In addition, we now include a new in vivo application; please see R2.A2 for details.</p><disp-quote content-type="editor-comment"><p>Reviewer #3 (Recommendations for the authors):</p><p>1) Credible intervals</p><p>An interesting aspect of the manuscript is the possibility of computing credible intervals, making it possible to establish bounds on time points when the phase can be estimated with sufficient accuracy. In previous approaches, this is usually done via an amplitude threshold, with the assumption that a high amplitude will also result in high phase estimation accuracy. In Figure 6 the authors therefore study the relationship between amplitude and credible intervals. It is tough to interpret this evidence; the argument is that for an amplitude threshold using the 65th percentile the range of credible intervals is from the minimum to maximum possible. But looking at the major bulk of probability mass, it's centered around intervals with an acceptable looking range? Could more details regarding computation of confidence intervals be provided, e.g. are they symmetric? Figure 6C is a scatter plot with lots of points that are correlated, maybe it would be good to visualize this in a different way reducing the number of points per cycle? Can the credible intervals be related to error in degrees? They look pretty negligible in the left part of the figure (given that the real-time procedure also introduces a lag, Figure 8B),is the plotted x-range the relevant one? How does SNR/amplitude relate to phase accuracy to credible intervals? If the spread of credible intervals can be largely explained by amplitude (aka high correlation between credible interval width and amplitude), then maybe this is not such a big factor?</p></disp-quote><p>R3.A1. We address these important points in the updated manuscript as follows:</p><p>Updates to original Figure 6 (now Figure 7)</p><p>To help improve the interpretation of original Figure 6 (now Figure 7), we have updated the x-axis to show values in degrees. Additionally, we have edited the Figure caption to reflect the autocorrelation of points across time:</p><p>Figure 7 … (C.i): Phase credible intervals versus theta rhythm amplitude for each time point (gray dot). On the x-axis we plot an example cycle of a rhythm with credible intervals, see x-axis of (C.ii) for numerical values of credible intervals. Note that the phase and amplitude estimates are auto-correlated in time so that each gray dot is not independent of every other dot.</p><p>Could more details regarding computation of confidence intervals be provided, e.g. are they symmetric?</p><p>To address this, we have updated the Methods as follows:</p><p>Methods, after Equation (10): “The SSPE method also tracks the state estimation error <inline-formula><mml:math id="sa2m6"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>P</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula>, which allows estimation of confidence in the mean phase estimates. To do so, we sample 10,000 samples from the posterior distribution of each state j, and from this distribution estimate the width of the 95% credible interval for the phase. The credible intervals are derived from the posterior distribution of the state, which is Gaussian; however, following their transformation into angles, the intervals are not constrained to be symmetric. Note that, alternatively, one could attempt to define a closed form for the phase distribution to estimate confidence bounds …”</p><p>Can the credible intervals be related to error in degrees?</p><p>Yes, the credible intervals are expressed in units of radians. We have updated Figure 6 to units of degrees.</p><p>They look pretty negligible in the left part of the figure (given that the real-time procedure also introduces a lag, Figure 8B),is the plotted x-range the relevant one?</p><p>The real-time procedure in C++ introduces a small lag due to buffering implemented in OpenEphys. This lag is not present if the user does a non-buffered analysis as provided in the MATLAB implementation.</p><p>How does SNR/amplitude relate to phase accuracy to credible intervals?</p><p>To address this question, we now include in the revised manuscript a new simulation comparing SNR, credible interval width, and phase accuracy. Please see R1.A1 for details.</p><p>If the spread of credible intervals can be largely explained by amplitude (aka high correlation between credible interval width and amplitude), then maybe this is not such a big factor?</p><p>To address this question, we have updated the Results as follows:</p><p>Results: Confidence in the Phase Estimate: “… Therefore, a fixed amplitude threshold does not guarantee an accurate phase estimate. Instead, we propose that inspection of the credible intervals better guides certainty in the phase estimate. These credible intervals are directly derived from the modeling procedure, as opposed to surrogate measures of confidence in the phase estimate, such as amplitude. In addition, credible intervals are directly interpretable unlike amplitude thresholds, which depend on the measurement scale (e.g., a credible interval threshold of 10 degrees versus an amplitude threshold of 10 millivolts). We conclude that amplitude is linked to confidence in the phase, however, a fixed amplitude threshold is not directly interpretable and encompasses a wide range of credible interval values.”</p><disp-quote content-type="editor-comment"><p>2) Slow drifts</p><p>A practical reason why existent algorithms rely on buffering is the frequent existence of slow drifts in the data, for which detrending needs to be applied. For the EEG data, the following methodological detail of the current approach is given &quot;Before real-time phase estimation, we high-pass filter the data at 0.5 Hz to remove slow drifts.&quot; This procedure is not possible when estimating the phase in real-time. The authors claim the benefit of their approach is the absence of needing buffers, but in the light of this I am not sure about whether this is the case. In the discussion, the authors discuss the possibility of modeling the slow drifts via an additional rhythm in the state space, but state that long segments of data are needed for this. In my view, this is a crucial aspect of any algorithm targeting real-time phase and more information and analysis resolving slow drifts would greatly improve the actual applicability of the present approach.</p></disp-quote><p>R3.A2. To address this important issue, we have updated the procedure to apply a real-time method that avoids acausal filtering. We have updated the Methods to describe this new approach:</p><p>Methods: in vivo Data: “…We analyze 250 s of data from a single participant for demonstration purposes. For these data, before each real-time phase estimation step, we first apply a moving average causal filter (using 3 s of past data for each new data point) to remove slow drifts. We track three oscillators in the SSPE method, …”</p><p>Discussion: ”Alternatively, the SSPE model could be updated to include a model of the slow drift dynamics (perhaps as a piecewise linear term), or a moving average mean trend could be causally removed as we demonstrated with the in vivo EEG analysis…”</p><p>Using this new real-time approach, we find results consistent with the original manuscript. We include the updated Figure 8 (previously Figure 7) and revised caption here:</p><disp-quote content-type="editor-comment"><p>3) Data generation process and simulations</p><p>I find some of the simulations not sufficiently motivated from a physiological perspective.</p><p>– Two simultaneous rhythms with nearby frequencies: In this scenario the authors simulate the signal as a summation of two sinusoids with a frequency offset with a fixed phase shift. This will result in a signal with amplitude modulation with the envelope given by the difference of the frequencies, resulting in the appearance of oscillatory bursts. I would argue that for physiological signals that present like this, it is not of interest to track a single frequency in this signal, as e.g. the trough phase of this compound signal corresponds to a specific physiological state. I would also suggest showing the amplitude for this case in Figure 3. Possibly the simulation could be modified to be better physiologically motivated, as they are certainly cases where there are neighboring rhythms which present on the same electrode through volume conduction, but it is unclear (but would be of interest) to me if the proposed method could be helpful in this case.</p></disp-quote><p>R3.A3. We appreciate the Reviewer’s concerns regarding this simulation. Indeed, the Reviewer’s interpretation is correct: the summed sinusoids can be interpreted as a single neural population oscillating at the average of the two frequencies, with amplitude modulation. With that interpretation, a different analysis approach – perhaps focused on cross-frequency coupling – might be preferred, However, we note that multiple interpretations exist for such a situation, i.e., we believe the inverse solution here is degenerate making our prior expectation important. In many experimental situations, limited spatial resolution prevents distinguishing whether an observed signal represents a single neural population or rhythms from distinct neural populations. In addition, we expect situations in which multiple rhythms exist at nearby frequencies (such as multiple α in EEG over sensorimotor cortex or multiple theta in the hippocampus). Consistent with the latter examples, in this simulation, we assume the prior expectation that the observed signal results from two rhythms.</p><p>We have added text to clarify this assumption, and added the observed signal to the revised Figure as suggested:</p><p>Methods: Two Simultaneous Rhythms With Nearby Frequencies: “… In many physiologic use cases (e.g., in EEG (VanRullen, 2016), and in LFP (Tort et al., 2010)<ext-link ext-link-type="uri" xlink:href="https://www.zotero.org/google-docs/?broken=iRLjLm">)</ext-link>, we may wish to track one rhythm while ignoring another at a nearby frequency. This may occur because of low spatial resolution (e.g., from mixing of signals due to volume conduction (Nunez and Srinivasan, 2006)) or because there exist overlapping neural populations expressing different rhythms (Kocsis et al., 1999). To simulate this case, we consider two sinusoids. …&quot;</p><disp-quote content-type="editor-comment"><p>– From my perspective phase is only well-defined if there are clear-cut oscillatory bursts. In that sense, the signal given as an example in Figure 2A iv does not have clear-cut oscillatory states, with no clear spectral peak and the true phase (blue curve) changing rapidly. The authors show that the algorithm performs well here as this is exactly according to their data-generating process assumptions (e.g. Figure 2C right-most), whereas for the other algorithms errors accumulate especially in fast phase changing periods. In my view, this simulated situation conceptually does not capture processes that are relevant to investigating neural oscillations in the brain, which would follow a conceptual model more similar to: multiplicative 1/f contribution * oscillator + additive 1/f contribution, so that presumably corresponds to the presented filtered pink noise case here. Can the authors clarify the motivation for this simulated case?</p></disp-quote><p>R3.A4. In the revised manuscript, we now better motivate the state-space model in terms of neural oscillations in the brain. Please see R2.A3 above.</p><p>Additionally, we simulated the model suggested by the Reviewer in two ways. In the first, we implemented a model where (1/f) noise was simulated and directly multiplied by a cosine oscillator at 6 Hz, sample by sample. We plot an example realization of this process in <xref ref-type="fig" rid="sa2fig1">Author response image 1</xref>:</p><fig id="sa2fig1" position="float"><label>Author response image 1.</label><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-68803-sa2-fig1-v2.tif"/></fig><p>Sign changes in the pink noise result in discontinuous jumps in the signal. Given this, we attempted a second simulation where the multiplicative (1/f) component was understood to mean that the amplitude had a power spectrum that followed a (1/f) trend, while the phase followed a 6 Hz rotation, with added (1/f) noise. We plot an example realization of this process in <xref ref-type="fig" rid="sa2fig2">Author response image 2</xref>:</p><fig id="sa2fig2" position="float"><label>Author response image 2.</label><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-68803-sa2-fig2-v2.tif"/></fig><p>Testing the error in phase estimation for this signal with added pink noise, we find that the acausal FIR, Blackwood and SSPE methods perform comparably, while the Zrenner approach performs slightly worse than the others (see <xref ref-type="fig" rid="sa2fig3">Author response image 3</xref>).</p><fig id="sa2fig3" position="float"><label>Author response image 3.</label><caption><title>The SSPE method performs as well as the acausal FIR and Blackwood methods for 1/f amplitude modulated data.</title></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-68803-sa2-fig3-v2.tif"/></fig><p>We include this result here for the Reviewer, and if recommended, we will update the manuscript to include it.</p><disp-quote content-type="editor-comment"><p>– The authors speak of broadband oscillations, for instance relating to the mu-rhythm (l. 554). In my view this is a narrowband oscillation with a clear peak judging from the power spectrum, with the broadness of the peak influenced by the presence of strong amplitude envelope modulations. Can authors clarify their criteria for defining an oscillation as broadband, in my view this is non-standard terminology.</p></disp-quote><p>R3.A5. As suggested by the Reviewer, we now refer to the mu rhythm as narrow-band:</p><p>Results: Example in-vivo application: human EEG: “… Like the theta rhythm in the LFP rodent data, the mu rhythm in the human EEG data maintains a consistent spectral profile in time (Figure 8B) and further, it appears to be narrow-band (Figure 8C).”</p><p>Figure 8, caption: “(C) Average power spectral density (PSD) of (B) over all times in (A). The mean PSD (dark blue) and 95% confidence intervals (light blue) reveal a peak in the mu rhythm near 11 Hz. (D) Example human EEG data (red, solid) with a consistent peak in the mu rhythm (8-13 Hz). …”</p><disp-quote content-type="editor-comment"><p>– One limitation of band-pass filtered approaches that the authors mention is non-sinusoidality (l. 48). In my view, this is manifested in differences in waveform shape, e.g. the arc-shape of the mu-rhythm in Figure 7D. It does not seem that problems in phase estimation for this type of signals (e.g. non-uniform phase-velocity) is addressed by the method as the estimated state does not capture the arc-shape of the rhythm. Can the authors clarify in what way they contribute to resolve this limitation?</p></disp-quote><p>R3.A6. We thank the Reviewer for this nice observation. For the human EEG, the SSPE method models both the 10 Hz and the 22 Hz (a potential harmonic) rhythms that together capture the non-sinusoidality of the mu-rhythm. In Figure 7D of the original manuscript, we only showed the 10 Hz component of the model. When we include the summation over the (real-valued portions of the) state estimates of both rhythms, the model estimates capture the arc-shape of the mu rhythm (see Figure 8—figure supplement 1). We also show the phase for the two oscillators, demonstrating the capability of the SSPE approach to estimate simultaneously the phase of the 22 Hz harmonic and the 10 Hz rhythm.</p><p>We have updated the manuscript to include this result as a Supplementary Figure as follows:</p><p>Results: Example in-vivo application: human EEG: “As with the LFP, we are able to assess certainty in our phase estimates using the credible intervals. In Figure Supplement 8-III, we show the state estimate including both the 10 Hz and 22 Hz components of the model and demonstrating that it recreates the non-sinusoidal waveform of the mu rhythm.…”</p><disp-quote content-type="editor-comment"><p>4) I would welcome additional details in the text regarding following methodological procedures, which should yield a more self-contained manuscript:</p><p>– While bandpass filtering and Hilbert-transform are quite common operations for electrophysiologists, a state space approach may be unfamiliar to the typical reader. Possibly it would be helpful to have clearer paragraphs describing the framework (aka rework l. 98ff), I think the attempt here was to first explain the procedure without formulas, which appear further down, I am not quite sure that this succeeded in providing clarity. Maybe it would be helpful to first make an example with only 1 rhythm, so that dimensionality of the involved entities is not as complex as for tracking N rhythms. Maybe it would also be helpful to extend Figure 1 with a conceptual diagram. How is the number and frequency of oscillators chosen for empirical data?</p></disp-quote><p>R3.A7. As recommended, we have update Figure 1 to include a conceptual diagram to help improve understanding of the SSPE method:</p><p>Further, we have edited the beginning of the Methods section to improve accessibility, and now include an example with only 1 rhythm, as recommended:</p><p>Methods: State Space Model Framework:</p><p>“To estimate phase in real-time, we utilize a data-driven model that operates based on principles from dynamical systems and Markov models. This type of model (called a state-space model) separates what is observed (called the observation equation) from what we wish to estimate (called the state equation). The state equation attempts to capture the underlying, unobserved dynamics of the system, while the observation equation transforms the state into the observed signal. We generate an optimal prediction for the state using a Kalman filter that compares the initial prediction of the observation with the actual observed value. […] Note that this model for the state is akin to a damped harmonic oscillator driven by noise, a model that has been shown to be relevant and useful for γ rhythms in the visual cortex (Burns et al., 2010; Spyropoulos et al., 2020) and also for EEG (Franaszczuk and Blinowska, 1985).</p><p>To model N rhythms, we define …”</p><p>How is the number and frequency of oscillators chosen for empirical data?</p><p>As we discuss in the Methods section, we chose the number and frequency of oscillators for the empirical data based on a preliminary analysis of the power spectral density. We have reproduced the relevant text below:</p><p>In vivo data: To model these data, we fit three oscillators with the SSPE method, with the goal of tracking a target theta rhythm (defined as 4 – 11 Hz). Motivated by an initial spectral analysis of these data, we choose one oscillator to capture low frequency δ band activity (<inline-formula><mml:math id="sa2m7"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> Hz, based on spectral peak), one to capture the theta band rhythm of interest (<inline-formula><mml:math id="sa2m8"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>7</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> Hz), and a final oscillator to track high frequency activity (<inline-formula><mml:math id="sa2m9"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>40</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> Hz).</p><disp-quote content-type="editor-comment"><p>– E.g. regarding the parameter estimation the reader is referred to the supplementary material of Soulat et al. 2019. Can an intuition about this procedure be given? I find this interesting in the context that a quite large range for expected computation time is given (2-100 s, l. 573). Can the authors comment on factors influencing this? Maybe a more detailed description of the procedure will be helpful for understanding this.</p></disp-quote><p>R3.A8. To address these questions, we have added text to the Methods section to help further explain the EM procedure and offer potential reasons for the range of times to convergence:</p><p>Methods: Real-time Phase Estimation:</p><p>“We perform real-time estimation of phase as follows. First, we use an existing interval of data to acausally fit the parameters of the state space model <inline-formula><mml:math id="sa2m10"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="sa2m11"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="sa2m12"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>Q</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, <inline-formula><mml:math id="sa2m13"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mi>R</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mstyle></mml:math></inline-formula> using an expectation-maximization (EM) algorithm as proposed by (Soulat et al., 2019); for details see the Supplementary Information in (Soulat et al., 2019). Under the EM approach, optimization of parameters follows a two step process. First, initial values for parameters are selected, usually from prior knowledge such as an examination of the power spectrum of an initial data sample. This allows the algorithm to estimate the expectations for the state and the observation. Second, using the state and observation estimates, an analytic solution exists (Shumway and Stoffer, 1982) for the parameters that maximizes the likelihood. We repeat the expectation and maximization procedures until the parameter estimates do not change between two iterations beyond a threshold. The rate of convergence of the EM algorithm (speed of computation) depends on the initial parameter estimates and the signal-to-noise ratios of the rhythms present in the signal.”</p><disp-quote content-type="editor-comment"><p>– Currently descriptions of the comparison algorithms are lacking, e.g. what is the general procedure and difference between Zrenner and Blackwood algorithm, what are the crucial parameters here? The authors give code-accessibility as the main reason for selecting those two specific instances. Because recently a lot of different methods (mostly variants involving band-pass filtering) were proposed for estimating the phase in real-time, maybe those 2 selected ones could be better discussed in the context of others in the literature.</p></disp-quote><p>R3.A9. Thank you for this suggestion. We have updated the manuscript to place the two algorithms better in the context of others in the literature as follows:</p><p>Methods: AR-based forecasting to Estimate Phase: “While current techniques depend upon filtering to isolate a narrow band rhythm from which to estimate phase, different methods exist to forecast the phase. One category of methods forecasts the phase as a linear extrapolation from the current moment while assuming a singular central frequency, which is estimated from the data (Rivero and Ditterich, 2021; Rutishauser et al., 2013). Other methods estimate phase by using an autoregressive (AR) model. After estimating the AR parameters (either asynchronously or synchronously), these methods forecast data to limit filter edge effects, then utilize a filter and Hilbert transform to estimate phase (Blackwood et al., 2018 and Zrenner et al., 2020). We compare the SSPE to this latter set of techniques as these are more flexible to variability in rhythms than methods that assume a constant central frequency when estimating phase. We implement the version of the Zrenner et al. (2020) algorithm accessible at …”</p><p>We have also added information about the critical hyperparameters of the Zrenner and Blackwood approaches:</p><p>Methods: AR-based forecasting to Estimate Phase: “ … We implement the version of the Zrenner et al. (2020) algorithm accessible at https://github.com/bnplab/phastimate and term this method as Zrenner. Please refer to Zrenner et al. (2020) for algorithm details. The Zrenner algorithm uses an FIR filter (applied forward and backward) and the Hilbert transform as the core phase estimation technique. The AR model used to forecast the data and allow real-time phase estimation (by expanding the window for the FIR filter) is fitted to the 30th order and efficiently updated on every new sample. We set the algorithm to track a 6 Hz rhythm by increasing the window size for the FIR filter to 750 ms, the filter order to 192, and the frequency band to 4 to 8 Hz. We utilize the implementation of the Blackwood et al. (2018) algorithm as provided by the authors. In Blackwood et al. (2018), the authors develop a forward bandpass filter – AR-based (5th order AR model whose parameters are fit every second) forecasting and then the Hilbert transform – to compute the phase. Here, we instead apply a Hilbert transformer (of order 18) that estimates the phase by directly computing the Hilbert transform while filtering the data as implemented in (Blackwood, 2019). We do so because this implementation is more computationally efficient, functionally equivalent to the original method and the code is made widely available. We verified in sample data that application of the original and modified Blackwood methods produced consistent phase estimates. We refer to this method as Blackwood.”</p><disp-quote content-type="editor-comment"><p>– typo, l.55 extant -&gt; existant</p></disp-quote><p>R3.A10. Thank you, we have edited the manuscript, replacing “extant” with “existing”.</p><p>Introduction L55: “Many existing approaches depend on buffered processing (e.g., Fourier or related transforms), …”</p><disp-quote content-type="editor-comment"><p>– the dotted lines for phase estimates may be not optimal visually (e.g. Figure 6B), maybe shading of credible intervals would look nicer?</p></disp-quote><p>R3.A11. Thank you for the suggestion. We have updated the figures to use shading in the revised manuscript. We show the relevant components of the revised figures here:</p><disp-quote content-type="editor-comment"><p>– Can the authors provide more details on how the power spectra were estimated? The simulation ones look like Welch's method and the data ones like multitaper were used.</p></disp-quote><p>R3.A12. As recommended, we have edited the caption of Figure 2 to include these details:</p><p>“… (B) For each scenario, example spectra of (B.i) the signal, and (B.ii) the observation (i.e., signal plus noise). Spectra were estimated for 10 s segments using the function “pmtm” in MATLAB, to compute a multitaper estimate with frequency resolution 1 Hz and 9 tapers.”</p><p>For the in vivo data, the Figure captions include details of the power spectrum calculation, reproduced here:</p><p>Figure 6 “… (B) Corresponding spectrogram of the rodent LFP data (multi-taper method with window size 10 s, window overlap 9 s, frequency resolution 2 Hz, and 19 tapers). (C) Average power spectral density (PSD) of (B) over all times with theta band oscillator identified in (A). The mean PSD (dark blue) and 95% confidence intervals (light blue) reveal a broadband peak in the theta band.</p><p>Figure 8 “… (B) Corresponding spectrogram for the EEG data (multi-taper method with window size 10 s, window overlap 9s, frequency resolution 1 Hz, and 19 tapers). (C) Average power spectral density (PSD) of (B) over all times in (A). The mean PSD (dark blue) and 95% confidence intervals (light blue) reveal a broadband peak in the mu-rhythm near 11 Hz. …”</p><disp-quote content-type="editor-comment"><p>– If I understood correctly, the employed two-sided t-test is calculated using lots of correlated data points (using all time points in an interval), resulting in reduced degree of freedom. I think the evidence that the SSPE approach works better here is actually strong, but the t-test looks slightly weird because of wrong degrees of freedom, distracting from the result. Maybe the information from table 1 can just be plotted in a distributional way, more like Figure 2C?</p></disp-quote><p>R3.A13. The statistical test compares the error estimates across all simulation iterations (N=1000), wherein each iteration has an independent source of noise. Error within each iteration is calculated using all time points within one cycle of the phase reset. We note that the error distributions for each method are approximately normally distributed (see <xref ref-type="fig" rid="sa2fig4">Author response image 4</xref> and 5), and we find that plotting these error estimates as distributions is rather uninformative (<xref ref-type="fig" rid="sa2fig4">Author response image 4</xref>) given the tight bounds of the error distributions, and the large differences in means. We therefore think a table is a better approach for conveying this result.</p><fig id="sa2fig4" position="float"><label>Author response image 4.</label><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-68803-sa2-fig4-v2.tif"/></fig><p>We also examined the error to confirm approximate Gaussianity (<xref ref-type="fig" rid="sa2fig5">Author response image 5</xref>):</p><fig id="sa2fig5" position="float"><label>Author response image 5.</label><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-68803-sa2-fig5-v2.tif"/></fig><p>[Editors' note: further revisions were suggested prior to acceptance, as described below.]</p><disp-quote content-type="editor-comment"><p>Reviewer #3 (Recommendations for the authors):</p><p>I thank the authors for extensive replies to my comments, which have clarified many aspects and made the method description more accessible. I like the new waveform shape figure showing the simultaneous tracking of the base + harmonic frequency. I find the SSPE method interesting from a principal perspective, but am not yet sure in what way the performance of the algorithm is superior to other algorithms in physiologically relevant cases. My remaining comments:</p><p>1) Plausibility of simulations R3.Q4</p><p>– The state space model simulations (Figure 2A.iv) generating model are not a common data generation model for the rhythms the authors actually investigate (theta and mu). The newly added citations are for the γ-rhythm (and a quite obscure EEG paper). -&gt; I would say this is not a generally accepted data generation model for mu and theta. The fact that the SSPE performs well on data generated from the exact state space model does not seem to entirely relevant for the chosen application, with the simulation lacking stability in cycle periods that is present for mu and theta. Possibly, a note can be added in the Discussion section in the narrow-band vs broad-band signal section, reflecting on broad-band phase would be beneficial.</p></disp-quote><p>We agree with the Reviewer that (i) the state space model has not been shown to reproduce theta and mu rhythms, and (ii) it is not surprising that the SSPE method performs well on data generated from the same state space model. We propose that the results shown here provide initial evidence that the state space model can produce theta and mu rhythms, consistent with the in vivo data. We also propose that modeling rhythms as damped harmonic oscillators driven by noise is both simple and physically reasonable. Finally, we note while the parameters used for the state space model instantiation in Figure 2 do not produce phase stability, the model can sustain such phase stability, as demonstrated by the intervals of transient phase stability the Reviewer identifies for the mu and theta rhythms (Figure 7,8).</p><p>As suggested, we have updated the Discussion to note that the phase cycles of the state space model and filtered pink noise are more unstable:</p><p>“Moreover, when the broadband rhythm has non-negligible power across all frequencies (in which case the phase cycle is more unstable), the standard non-real-time approach (acausal FIR and Hilbert transform) tracks the phase with limited accuracy.”</p><disp-quote content-type="editor-comment"><p>– The filtered pink noise seems to result in a broader spectral peak (green line in Figure 2B.ii) than is present in the empirical data. As the band-pass filter parameters of the alternative algorithms are possibly adjusted for more narrowband signals, not adjusting the bandwidth before e.g., doing a Hilbert transform may yield an unfair comparison. Can you comment on that?</p></disp-quote><p>To address this, we now emphasize in the Discussion the importance of filter bandwidth parameters,</p><p>“Narrow-band vs Broadband Signals</p><p>While brain rhythms tend to be broadband (Buzsaki, 2004; Roopun et al., 2008), the most common methods in neuroscience to track a rhythm’s phase require appropriate choices of filter parameters (e.g., selection of bandwidth) and generally expect a narrowband oscillation. …”</p><p>We also note that the SNR in Figure 2B.ii is high, increasing the apparent bandwidth. Increasing the background pink noise (and making the simulated signal more consistent with the in vivo data), would decrease the apparent bandwidth in Figure 2B.ii (see Figure 5 —figure supplement 1).</p><p>Finally, we now make public all the code for the simulations and for plotting the results of the simulations so parameters across approaches can be compared. It is available here: https://github.com/Eden-Kramer-Lab/SSPE-paper</p><disp-quote content-type="editor-comment"><p>– My suggested approach using multiplicative 1/f corresponds to the second of the simulations provided by the authors in R3.A4. To clarify this, I attach some python lines at the end to show a simulated signal, if there is interest (parameters to be adjusted). The phase estimation errors in the provided plot in the response seem really low, so maybe the oscillatory SNR is too high for this simulated case (also the amplitude modulation is not really prominent?) I find it confusing that the SSPE method does not yield any benefit here. I am not requesting specifically for this type simulation to be included, but I would like to understand generally the conditions under which SSPE yields better results than the alternative algorithms.</p></disp-quote><p>Thank you again for recommending this interesting model. The SSPE method does not yield any benefit here because the simulated model of phase is a sinusoid. Thus, methods that assume a narrowband oscillation do better, even when the rhythm waxes and wanes via amplitude modulation; after an accurate estimate of phase when the SNR is high, the true and estimated phases progress linearly, even when the SNR is low (i.e., no rhythm is visible). This is most obvious for the Blackwood and acausal FIR approaches, and less so for the Zrenner method which forecasts more data prior to phase estimation.</p><p>We provide here results from the new simulation, where we set the SNR = 0.5 (code also available at https://github.com/Eden-Kramer-Lab/SSPE-paper/blob/main/simulations/sim_multOneOverF_amp.m):</p><fig id="sa2fig6" position="float"><label>Author response image 6.</label><caption><title>Example data trace for the proposed model.</title><p>The amplitude of the 6 Hz sinusoid waxes and wanes in time.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-68803-sa2-fig6-v2.tif"/></fig><fig id="sa2fig7" position="float"><label>Author response image 7.</label><caption><title>The Blackwood method outperforms the other causal algorithms for the multiplicative 1/f sinusoid example, similar to “Sines in Pink Noise”.</title></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-68803-sa2-fig7-v2.tif"/></fig><p>We conclude – based on the existing simulations in Figure 2, and the new simulation suggested here – that these examples illustrate a more complicated version of the “Sines in Pink Noise” simulation shown in Figure 2; when the true signal is a sinusoid, those estimators that presume a narrow band signal (i.e., the filter based approaches) perform best.</p><disp-quote content-type="editor-comment"><p>From my understanding, SSPE should yield benefits for phase estimation in intermediate SNR ranges, but at the moment the authors have added more evidence that all algorithms show very similar behavior at high SNR (Figure Supplement I for Figure 7 and 8) and the simulation type provided in Figure 5 has some issues with phase stability as it is filtered pink noise (see comments above) and the modelled SNR range (there is not much change in phase estimation errors which I would have expected to vary with increasing SNR).</p></disp-quote><p>We propose that the primary benefits of the SSPE method are due to the state model, more so than the SNR. If the state model is inaccurate, then a phase estimation method will often perform poorly across a broad range of SNR. This is illustrated in Figure 5; estimates from the Blackwood and Zrenner methods do not improve with increasing SNR because the narrowband state model is inaccurate (for this simulated broadband rhythm). For the in vivo data examples (Figure 7,8 Supp I), the phase estimates agree when the rhythm of interest is clearly present. At these times, different state models (sinusoids or noise driven oscillators) produce qualitatively consistent phase estimates.</p><disp-quote content-type="editor-comment"><p>R3.Q3:</p><p>I can acknowledge the scenario of the two simultaneous rhythms with nearby frequencies which the authors attribute to two different rhythms instead of seeing as amplitude modulated bursts. For this case, maybe the modeling scenario would be more general, if the rhythms had varying phase lag (random for each trial) instead of a fixed phase lag (pi/4), which seems like the case in which the rhythms are most easily distinguishable.</p></disp-quote><p>The Reviewer raises a good point. To address this, we implemented this recommendation and repeated the simulations in Figure 3 such that the phase lag between the two rhythms varied randomly (uniformly from 0 to 2*pi) for each trial. We find qualitatively consistent results, <xref ref-type="fig" rid="sa2fig8">Author response image 8</xref>:</p><fig id="sa2fig8" position="float"><label>Author response image 8.</label><caption><title>.</title><p>We find that SSPE still performs well for two oscillations at nearby frequencies, with random initial phases; compare to Figure 3 of the main manuscript.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-68803-sa2-fig8-v2.tif"/></fig><p>We now state this results in the revised manuscript as follows,</p><p>Following Equation (14): “… where [0.2,2] and [1,11]. We note that replacing the constant phase shift (<inline-formula><mml:math id="sa2m14"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>π</mml:mi><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula>) with a randomly selected (uniform <inline-formula><mml:math id="sa2m15"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mo fence="false" stretchy="false">[</mml:mo><mml:mo>−</mml:mo><mml:mi>π</mml:mi><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:mi>π</mml:mi><mml:mo fence="false" stretchy="false">]</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula>) phase shift produces qualitatively consistent results. The confounding rhythm frequency assumes a range of integer values from 1 to 11 Hz. …”</p><disp-quote content-type="editor-comment"><p>2) The relationship between credible intervals and amplitude measures. R3.Q1.</p><p>– The authors argue for a dissociation between credible intervals and amplitude values, with evidence provided by e.g., Figure 7. Given the nature of the data, with oscillations occurring in bursts and not as a continuous oscillation, I am wary of phase estimates for time points where there is no oscillation (e.g., for the theta data, oscillation probability is heavily dependent on animal speed and there will be periods in the data without an oscillation). My main point here is that credible intervals seem to have a correspondence to amplitudes in a range where an oscillation is clearly present (high amplitude) and phase is not defined when an oscillation is absent. Sure, the acausal FIR will return a value for every time point, but it's not necessarily meaningful in a physiological sense. Taking this as the ground truth is problematic for the credible interval and amplitude measures dissociation. For instance, is there a discernible oscillation for the data in Figure 7 for an amplitude criterion &gt; 65th percentile? Is a wide or narrow credible interval around a value that is not defined meaningful?</p></disp-quote><p>To address this, we provide here additional examples of the LFP data shown in Figure 7. These examples illustrate cases in which the amplitude is low (below the 65th percentile), but the credible interval is narrow. At these times, visual inspection suggests a theta rhythm exists, despite the low amplitude. These examples illustrate how an amplitude threshold may fail to capture transient bursts of theta. Conversely, when a theta burst exceeds an amplitude threshold, existing methods may be overly confident in the stability of the phase cycle; these examples show that, even when the amplitude is high, the credible intervals can be large.</p><fig id="sa2fig9" position="float"><label>Author response image 9.</label><caption><title>Credible intervals better capture the presence of theta cycles than an amplitude threshold.</title><p>(A,B) Two example traces showing intervals in which the rhythm amplitude is small (below the 65th percentile, white intervals, also indicated by purple trace equaling 0), yet the credible intervals suggest confidence in the phase estimate, consistent with the presence of a theta rhythm. Visual inspection of data filtered (4 – 11 Hz FIR filter, blue curve) in the theta band suggests the presence of a theta rhythm. Gray intervals indicate periods of high amplitude (above the 65th percentile). In these intervals there exist periods with wide credible intervals (at times when the SSPE method is uncertain if the rhythm is rising or falling) suggesting a simple amplitude threshold is insufficient to determine confidence in the phase estimates.</p></caption><graphic mime-subtype="tiff" mimetype="image" xlink:href="elife-68803-sa2-fig9-v2.tif"/></fig><disp-quote content-type="editor-comment"><p>Figure 7C is a scatter plot with lots of points that are correlated, maybe it would be good to visualize this in a different way reducing the number of points per cycle</p><p>possibly by subsampling or a 2D histogram. In the current presentation, the plot basically just shows the range of the data, amplifying low-occurrence data points.</p></disp-quote><p>As recommended by the Reviewer, we have updated Figure 7C to include a 2D histogram replacing the scatterplot:</p><disp-quote content-type="editor-comment"><p>This suggests that, at low SNR, an arbitrary amplitude threshold (e.g., amplitude &gt; 1) would eliminate all data at SNR=1, and preserve all data at SNR=2.5.</p><p>Typically (e.g., in the Zrenner studies), amplitude is defined as a relative criterion, e.g., with percentile threshold or mean amplitude +- 2.5 SD using some training interval, so I am not sure about this argument.</p></disp-quote><p>The Reviewer identifies a nice solution to avoid the choice of an arbitrary amplitude threshold eliminating or including all data. However, we propose that this criterion still lacks the direct interpretability of a credible interval threshold (e.g., 30 degrees, which is easily interpreted and may include data across amplitudes).</p><disp-quote content-type="editor-comment"><p>– We find that fixed amplitude thresholds produce wide ranges of credible intervals (Figure 7C.ii). This is especially apparent at lower amplitude thresholds; choosing a threshold of 65% results in credible intervals that range from 0.042.29 (minimum) to 174.75 (maximum) degrees.</p><p>Can authors list the 95% range here, rather than min/max?</p></disp-quote><p>Thank you for the suggestion, we have updated the test to reflect the 95% range:</p><p>“This is especially apparent at lower amplitude thresholds; choosing a threshold of 65% results in credible intervals that range from 3.8 (2.5th percentile) to 96.8 (97.5th percentile) degrees.”</p><disp-quote content-type="editor-comment"><p>– Figure 5: Can a spectrogram can also be plotted in this figure?</p><p>I would expect the height of the spectral peak over the 1/f-contribution to vary here.</p></disp-quote><p>To address this, we now include a supplement to Figure 5 that includes the spectra for each simulated SNR.</p><p>We have updated the manuscript as follows:</p><p>“… In these simulations the SNR varies from 1 (signal and noise have the same total power) to 10 (signal has 100 times the total power of the noise); see example traces of the observation under each SNR in Figure 5A.i – iv, and see example spectra under each SNR in Figure 5 —figure supplement 1. We repeat each simulation 1000 times with different noise instantiations for each signal to noise ratio.”</p><disp-quote content-type="editor-comment"><p>3) Code availability</p><p>I wanted to check the used bandpass filter parameters (since it's not described for the Blackwood algorithm) and noticed that the linked repository does not feature the code to recreate the plots in the manuscript, possibly it would be helpful for other researchers to provide that, also for comparing to other algorithms in the future.</p></disp-quote><p>Thank you for raising this important point. We have created an independent repository with code to run the simulations and to recreate the plots in the manuscript. Please see, https://github.com/Eden-Kramer-Lab/SSPE-paper.</p></body></sub-article></article>