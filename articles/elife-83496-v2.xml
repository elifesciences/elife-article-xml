<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD with MathML3 v1.2 20190208//EN"  "JATS-archivearticle1-mathml3.dtd"><article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.2"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn publication-format="electronic" pub-type="epub">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">83496</article-id><article-id pub-id-type="doi">10.7554/eLife.83496</article-id><article-categories><subj-group subj-group-type="display-channel"><subject>Tools and Resources</subject></subj-group><subj-group subj-group-type="heading"><subject>Neuroscience</subject></subj-group></article-categories><title-group><article-title>Histological E-data Registration in rodent Brain Spaces</article-title></title-group><contrib-group><contrib contrib-type="author" corresp="yes" equal-contrib="yes" id="author-255612"><name><surname>Fuglstad</surname><given-names>Jingyi Guo</given-names></name><email>jingyi.guo@ntnu.no</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="equal-contrib1">†</xref><xref ref-type="fn" rid="fn1">§</xref><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" equal-contrib="yes" id="author-255611"><name><surname>Saldanha</surname><given-names>Pearl</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-6749-8240</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="equal-contrib1">†</xref><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf2"/></contrib><contrib contrib-type="author" id="author-255610"><name><surname>Paglia</surname><given-names>Jacopo</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="pa1">#</xref><xref ref-type="fn" rid="con3"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" corresp="yes" id="author-292832"><name><surname>Whitlock</surname><given-names>Jonathan R</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-2642-8737</contrib-id><email>jonathan.whitlock@ntnu.no</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="fn1">§</xref><xref ref-type="other" rid="fund1"/><xref ref-type="other" rid="fund2"/><xref ref-type="other" rid="fund3"/><xref ref-type="other" rid="fund4"/><xref ref-type="fn" rid="con4"/><xref ref-type="fn" rid="conf1"/></contrib><aff id="aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/05xg72x27</institution-id><institution>Kavli Institute for Systems Neuroscience, Norwegian University of Science and Technology (NTNU)</institution></institution-wrap><addr-line><named-content content-type="city">Trondheim</named-content></addr-line><country>Norway</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Wolff</surname><given-names>Mathieu</given-names></name><role>Reviewing Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/057qpr032</institution-id><institution>CNRS, University of Bordeaux</institution></institution-wrap><country>France</country></aff></contrib><contrib contrib-type="senior_editor"><name><surname>Colgin</surname><given-names>Laura L</given-names></name><role>Senior Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/00hj54h04</institution-id><institution>University of Texas at Austin</institution></institution-wrap><country>United States</country></aff></contrib></contrib-group><author-notes><fn fn-type="con" id="equal-contrib1"><label>†</label><p>These authors contributed equally to this work</p></fn><fn fn-type="present-address" id="pa1"><label>#</label><p>KnowBe4, Apotekergata, Norway</p></fn><fn fn-type="other" id="fn1"><label>§</label><p>These authors jointly supervised this work</p></fn></author-notes><pub-date publication-format="electronic" date-type="publication"><day>13</day><month>01</month><year>2023</year></pub-date><pub-date pub-type="collection"><year>2023</year></pub-date><volume>12</volume><elocation-id>e83496</elocation-id><history><date date-type="received" iso-8601-date="2022-09-16"><day>16</day><month>09</month><year>2022</year></date><date date-type="accepted" iso-8601-date="2023-01-12"><day>12</day><month>01</month><year>2023</year></date></history><pub-history><event><event-desc>This manuscript was published as a preprint at .</event-desc><date date-type="preprint" iso-8601-date="2021-10-03"><day>03</day><month>10</month><year>2021</year></date><self-uri content-type="preprint" xlink:href="https://doi.org/10.1101/2021.10.01.462770"/></event></pub-history><permissions><copyright-statement>© 2023, Fuglstad, Saldanha et al</copyright-statement><copyright-year>2023</copyright-year><copyright-holder>Fuglstad, Saldanha et al</copyright-holder><ali:free_to_read/><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><ali:license_ref>http://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-83496-v2.pdf"/><self-uri content-type="figures-pdf" xlink:href="elife-83496-figures-v2.pdf"/><abstract><p>Recording technologies for rodents have seen huge advances in the last decade, allowing users to sample thousands of neurons simultaneously from multiple brain regions. This has prompted the need for digital tool kits to aid in curating anatomical data, however, existing tools either provide limited functionalities or require users to be proficient in coding to use them. To address this we created HERBS (Histological E-data Registration in rodent Brain Spaces), a comprehensive new tool for rodent users that offers a broad range of functionalities through a user-friendly graphical user interface. Prior to experiments, HERBS can be used to plan coordinates for implanting electrodes, targeting viral injections or tracers. After experiments, users can register recording electrode locations (e.g. Neuropixels and tetrodes), viral expression, or other anatomical features, and visualize the results in 2D or 3D. Additionally, HERBS can delineate labeling from multiple injections across tissue sections and obtain individual cell counts.Regional delineations in HERBS are based either on annotated 3D volumes from the Waxholm Space Atlas of the Sprague Dawley Rat Brain or the Allen Mouse Brain Atlas, though HERBS can work with compatible volume atlases from any species users wish to install. HERBS allows users to scroll through the digital brain atlases and provides custom-angle slice cuts through the volumes, and supports free-transformation of tissue sections to atlas slices. Furthermore, HERBS allows users to reconstruct a 3D brain mesh with tissue from individual animals. HERBS is a multi-platform open-source Python package that is available on PyPI and GitHub, and is compatible with Windows, macOS, and Linux operating systems.</p></abstract><kwd-group kwd-group-type="author-keywords"><kwd>atlas</kwd><kwd>anatomical</kwd><kwd>GUI</kwd><kwd>brain</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research organism</title><kwd>Rat</kwd><kwd>Mouse</kwd></kwd-group><funding-group><award-group id="fund1"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100005416</institution-id><institution>Norges Forskningsråd</institution></institution-wrap></funding-source><award-id>300709</award-id><principal-award-recipient><name><surname>Whitlock</surname><given-names>Jonathan R</given-names></name></principal-award-recipient></award-group><award-group id="fund2"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100005416</institution-id><institution>Norges Forskningsråd</institution></institution-wrap></funding-source><award-id>223262</award-id><principal-award-recipient><name><surname>Whitlock</surname><given-names>Jonathan R</given-names></name></principal-award-recipient></award-group><award-group id="fund3"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100005416</institution-id><institution>Norges Forskningsråd</institution></institution-wrap></funding-source><award-id>197467</award-id><principal-award-recipient><name><surname>Whitlock</surname><given-names>Jonathan R</given-names></name></principal-award-recipient></award-group><award-group id="fund4"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100001201</institution-id><institution>Kavli Foundation</institution></institution-wrap></funding-source><principal-award-recipient><name><surname>Whitlock</surname><given-names>Jonathan R</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>HERBS is a catch-all anatomical registration toolkit allowing users to plan surgical coordinates in advance, or visualize anatomical data post hoc in 2D or 3D brain volumes for rats, mice, or any species that has a compatible atlas.</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>Understanding the structure, function, or physiology of neural circuits requires the ability to consistently target brain regions prior to experiments and, afterward, to maintain an accessible, objective record of the areas studied (<xref ref-type="bibr" rid="bib28">Simmons and Swanson, 2009</xref>). Traditionally, post hoc anatomical record-keeping has relied on histological approaches where users delineate anatomical features in tissue sections, then register them manually with a reference atlas. While these and other approaches are critical for grounding experiments anatomically, doing them has become increasingly challenging with the emergence of large-scale recordings spanning multiple brain regions.</p><p>Several software tools have been developed in recent years which use computer vision technology to accelerate and systematize the mapping of experimental results in various model species (e.g., <xref ref-type="bibr" rid="bib26">Shamash et al., 2018</xref>; <xref ref-type="bibr" rid="bib29">Song et al., 2020</xref>; <xref ref-type="bibr" rid="bib8">Claudi et al., 2021</xref>; <xref ref-type="bibr" rid="bib3">Andy, 2022</xref>). When combined with the appropriate reference atlases (e.g., <xref ref-type="bibr" rid="bib9">Franklin and Paxinos, 2008</xref>; <xref ref-type="bibr" rid="bib34">Wang et al., 2020</xref>; <xref ref-type="bibr" rid="bib7">Claudi et al., 2020</xref>), these tool kits give users the ability to reconstruct electrode tracks, viral expression, anatomical projections (<xref ref-type="bibr" rid="bib19">Oh et al., 2014</xref>; <xref ref-type="bibr" rid="bib39">Zingg et al., 2014</xref>; <xref ref-type="bibr" rid="bib35">Winnubst et al., 2019</xref>), cell types (<xref ref-type="bibr" rid="bib11">Fürth et al., 2018</xref>), or to detect cells (<xref ref-type="bibr" rid="bib31">Tyson et al., 2021</xref>), gene expression patterns, or functional nodes (<xref ref-type="bibr" rid="bib17">Lein et al., 2007</xref>; <xref ref-type="bibr" rid="bib20">Ortiz et al., 2020</xref>) in the brain.</p><p>Different types of tool kits have been developed for different brain preparations, including volumetric whole-brain data or sliced tissue sections, with each approach bringing its own strengths and limitations. Whole-brain volume analyses have the advantage of readily conveying the 3D spatial relationships between neuronal pathways and neighboring structures. For instance, ITK-SNAP (<xref ref-type="bibr" rid="bib38">Yushkevich et al., 2006</xref>) is a popular biomedical software used for automatic image segmentation and delineation of regions of interest in human brain imaging data. For animal models, there is <italic>Brainrender</italic> (<xref ref-type="bibr" rid="bib8">Claudi et al., 2021</xref>), which displays any of several atlases incorporated from the BrainGlobe Atlas API in 3D. It provides fast visualization for user-defined data sets, such as reconstructed electrode tracks, viral expression, or anatomical projections. These can be obtained when <italic>Brainrender</italic> is combined with sibling software, Brainreg (<xref ref-type="bibr" rid="bib30">Tyson et al., 2020</xref>), which maps whole-brain data sets to atlases using supervised automatic image registration. While whole-brain data sets provide a holistic quantitative dimension to analyses, generating them is time and resource intensive, requiring either a light sheet scanning microscope or magnetic resonance imaging.</p><p>Because of the comparatively lower cost and simplicity, anatomical mapping using histological tissue sectioning still dominates in most labs (e.g., <xref ref-type="bibr" rid="bib6">Clancy et al., 2019</xref>; <xref ref-type="bibr" rid="bib40">Zutshi et al., 2022</xref>; <xref ref-type="bibr" rid="bib16">Lagartos-Donate et al., 2022</xref>; <xref ref-type="bibr" rid="bib12">Gardner et al., 2022</xref>). This, however, also has its own challenges. One common issue lies in matching a given tissue slice correctly to a reference atlas template. Previous studies have sought to solve this problem using multiple software platforms, like ImageJ (<xref ref-type="bibr" rid="bib25">Schneider et al., 2012</xref>), Adobe Illustrator (<xref ref-type="bibr" rid="bib2">Adobe Inc, 2023b</xref>), or Adobe Photoshop (<xref ref-type="bibr" rid="bib1">Adobe Inc, 2023a</xref>), which can be time consuming for manual curation and is not systematic. Software packages have been developed to address this issue, including the electrode reconstruction tool kit, SHARP-TRACK (<xref ref-type="bibr" rid="bib26">Shamash et al., 2018</xref>). This software uses a global warping transformation method to fit histological images back to a mouse atlas. Afterward, it provides a read-out of the estimated number of channels in each brain region as well as 3D visualizations. As currently configured, the tool kit works only with mouse atlases and is MATLAB-based, which requires a paid license and some programming knowledge.</p><p>Despite the number of tool kits available, there currently is no single software that combines functionalities spanning the gamut of pre-surgical planning and post-experiment registration without requiring programming. To help fill this methodological gap, we developed HERBS, an open-source Python package which brings together a range of functionalities in a user-friendly graphical front-end interface. HERBS can generate pre-surgical coordinates, reconstruct electrode tracks after recordings, mark viral expression volumes, or single cells; delineate regional boundaries in brain slices, and view post hoc anatomical reconstructions in 2D or 3D. There is no upper limit for the number of electrodes that it can reconstruct, so it can be used with microelectrode arrays or multi-tetrode bundles. To serve both rat and mouse users, HERBS has the in-built function to download and run the Waxholm Space (WHS) Atlas of the Sprague Dawley Rat Brain (<xref ref-type="bibr" rid="bib23">Papp et al., 2014</xref>) or the Allen Mouse Brain Atlas (<xref ref-type="bibr" rid="bib34">Wang et al., 2020</xref>). The software also contains an atlas explorer that can scroll freely through either rat or mouse atlases to display coronal, sagittal, and horizontal planar surfaces in 2D, as well as the corresponding mesh or volume of the atlas in 3D.</p><p>For accurate and robust image registration, HERBS provides rigid registration as well as interactive, non-rigid registration using triangulation-based piece-wise affine transformation. It is compatible with most tissue staining methods and image formats, as long as the regions of interest are visible and can be delineated by the user. For users who wish to augment or add functionalities of their own in Python, we provide a standalone Python pipeline tool kit, TRACER (Toolkit for Reconstructing Anatomical CoorindatEs in Rats), in parallel with HERBS (see Materials and methods for more information). To maximize general accessibility, HERBS requires minimal programming knowledge and is compatible with Windows, macOS, and Linux systems. It is intended as an open community resource available for further expansion and refinement. We hope it offers a valuable addition to the anatomical methods available for the neuroscience community.</p></sec><sec id="s2" sec-type="results"><title>Results</title><sec id="s2-1"><title>General outline</title><p>HERBS was designed as an intuitive, generic software tool to provide rodent users with four core functionalities, shown in <xref ref-type="fig" rid="fig1">Figure 1A</xref>. These include (a) generating anatomical target coordinates when planning a surgery; (b) processing and editing raw histological data; (c) registering and reconstructing objects implanted in the brain; and (d) visualizing annotated brain volumes in 3D. Users can carry out each functionality by following a series of steps described in the HERBS Cookbook using a keyboard and mouse. The layout of the user interface for HERBS, including color-coded panels used to execute its functionalities, are shown in <xref ref-type="fig" rid="fig1">Figure 1B</xref>.</p><fig id="fig1" position="float"><label>Figure 1.</label><caption><title>The core functionalities and user interface of HERBS.</title><p>(<bold>A</bold>) HERBS can be used to (<bold>a</bold>) plan electrode insertions or viral injections before surgery, (<bold>b</bold>) process and edit histological images, (<bold>c</bold>) register objects such as probes, virus, cells, and slice boundaries from histological images, and (<bold>d</bold>) visualize the brain in 3D with defined functions. (<bold>B</bold>) The user interface of HERBS consists of the Menu Bar (outlined in blue) for navigating through the functions, the Tool Bar (outlined in red) from which users select actions to perform in the Plot Window (magenta), such as registering or reconstruct objects. The Side Bar (geen) provides tools for visually editing objects or layers. The Status Bar (in purple at bottom) shows the brain regions and coordinates displayed in the Plot Window. The WHS or Allen Mouse Brain atlases can be downloaded and loaded directly through HERBS from the Menu Bar with a click of a button.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-83496-fig1-v2.tif"/></fig><p>When installing HERBS, users can choose whether to use the WHS Atlas of the Sprague Dawley Rat Brain (<xref ref-type="bibr" rid="bib23">Papp et al., 2014</xref>) or the Allen Mouse Brain Atlas (<xref ref-type="bibr" rid="bib34">Wang et al., 2020</xref>) as the anatomical reference (see Cookbook, chapter 6.1). Either atlas can be downloaded through HERBS, as they are both integrated as parts of the software package. We point users wishing to employ other volumetric atlases, including for other species, to section 6.1.3 of the HERBS CookBook for links to illustrated instructions on uploading and installing additional atlases.</p></sec><sec id="s2-2"><title>Generating pre-surgical coordinates</title><p>One of the essential steps in planning a surgery is defining the stereotaxic coordinates to reach specific brain areas of interest. HERBS facilitates this process by allowing users to determine the insertion parameters required to target one or several regions along a linear trajectory. This is done by simply clicking the start point and end point of the desired path on a 2D brain slice image, and there is no limit to the number of trajectories (e.g. recording probes) that can be planned. HERBS then automatically computes the insertion angle and length needed to reach the target brain region, as well as the location of the trajectory relative to Bregma defined in the atlas. The user can print and bring the read-out to the surgery room or save for record keeping. The planning functionality is equally applicable for targeting imaging lenses, injection pipettes for tracer or virus injections, or making focal lesions.</p><p>The working steps for generating pre-surgical coordinates are illustrated in <xref ref-type="fig" rid="fig2">Figure 2</xref>, in which we plan the insertion of a multi-shank Neuropixels 2.0 probe through retrosplenial cortex, visual cortex, and the intermediate hippocampus in the right hemisphere of a rat. The step-by-step protocol is described in the HERBS Cookbook, Chapter 6.4. Neuropixels users should note that estimates of probe length include the 175-µm channel-less shank tip, and that HERBS eliminates it when estimating the number of recording channels in the brain. In the first step, the user scrolls to the brain slice of interest (<xref ref-type="fig" rid="fig2">Figure 2A</xref>). This is aided by the color coding of each brain area in the atlas, which provides visual landmarks for defining boundaries between regions. Next, the probe trajectory is defined in the region(s) of interest with clicks of the mouse (<xref ref-type="fig" rid="fig2">Figure 2B</xref>). Once completed, the probe trajectory is saved as a layer in the Side Bar, after which it is saved to a 3D representation showing the trajectory of the probe in a WHS brain volume (<xref ref-type="fig" rid="fig2">Figure 2C</xref>). After the probe is merged on the Side Bar, a read-out is generated for a 4-shank probe (<xref ref-type="fig" rid="fig2">Figure 2D</xref>) that includes the location and regions traversed. A more detailed read-out table for each shank of the 4-shank probe can also be made (<xref ref-type="fig" rid="fig2">Figure 2E</xref>) which includes inclination, length of probe inserted, number of recording channels per region, and entry and exit coordinates of the probe. Either or both read-outs can be saved per the user’s desire. As there is no limit to the number of probes that can be planned for insertion, the user simply repeats the steps above for each probe. Users can also apply this functionality to target multiple regions using multi-probe implants with user-defined spacing and geometries. Users can define the recording site layout on individual probes as well (see section 6.6 of the CookBook for instructions and links to illustrated tutorials).</p><fig id="fig2" position="float"><label>Figure 2.</label><caption><title>Using HERBS to plan a Neuropixels 2.0 probe implant before surgery.</title><p>(<bold>A</bold>) Once the plane of choice is set (coronal in this example), 2D atlas brain sections with regional delineations appear and the user scrolls to the slice with the region(s) they wish to target. (<bold>B</bold>) The user defines the trajectory of the probe by clicking the desired start and end-points (the insertion angle here is 40.8° lateral tilt at Bremga –6.8 mm). (<bold>C</bold>) A linear probe trajectory is projected into the Waxholm Space in 3D. (<bold>D</bold>) A read-out table for all four probes shows the regions the probe has traversed and the number of channels in each region. (<bold>E</bold>) A detailed read-out for a single probe provides the entry position, probe angle, and insertion length to reach the target regions, as well as an estimation of the number of recording channels in each region in the experiments.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-83496-fig2-v2.tif"/></fig></sec><sec id="s2-3"><title>Reconstructing electrode tracks</title><p>Another core functionality of HERBS is reconstructing electrode paths after surgeries or in vivo recordings, and there is no upper limit on the number of electrodes that can be reconstructed. Prior to reconstructing probe trajectories, histological images can be pre-processed before they are overlaid on their corresponding atlas images. Pre-processing can include rotating the section to an optimal plane, changing brightness, gamma curves, and so forth, and can be done using the image view controller in the Side Bar, or the Edit option in the Menu Bar, as indicated in the interface panel in <xref ref-type="fig" rid="fig1">Figure 1B</xref> (see HERBS Cookbook, chapter 6.6).</p><p>After the image has been loaded and adjusted, the user can begin the steps of the reconstruction pipeline shown in <xref ref-type="fig" rid="fig3">Figure 3</xref>, which uses an example section with a track from a Dil-stained Neuropixels 1.0 probe (red) progressing laterally from visual to auditory cortex (an example image for probe reconstruction is provided in <xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1</xref>). The first step is choosing the plane of sectioning (coronal, sagittal, and horizontal) and scrolling to the corresponding atlas brain slice. Once the corresponding slice is located, the user defines anchor points to warp the histological section onto the atlas section (<xref ref-type="fig" rid="fig3">Figure 3A</xref>) (see Cookbook, chapters 6.4 and 6.5). Once the anchor points are defined and the matching step is complete, the user then clicks a minimum of 4 points along the probe track in the tissue, after which a 3D rendering is generated showing how the probe is situated in the volume of the brain (<xref ref-type="fig" rid="fig3">Figure 3B</xref>) (Cookbook, chapter 6.6.1). A detailed read-out table showing the inclination and length of the probe, regions traversed and number of recording channels per region are generated automatically (<xref ref-type="fig" rid="fig3">Figure 3C</xref>). In cases where histological sections are cut out of plane, HERBS allows the user to tilt the atlas brain up to 30° to facilitate template matching. We also note that electrode track reconstructions can be performed for any type of electrodes, tetrodes, or recording arrays, as well as with different sizes of sections. HERBS facilitates this by allowing users to build user-defined geometry and channel layouts of linear silicon probes (see the subfolder &quot;HERBS/image/probe_related&quot; on the HERBS GitHub page, linked in &quot;Data availability, software, and citation policy&quot; below).</p><fig-group><fig id="fig3" position="float"><label>Figure 3.</label><caption><title>Reconstructing a recording probe trajectory from histological sections.</title><p>(<bold>A</bold>) The initial steps include scrolling to the atlas brain slice (left) that best matches the user’s histological section (middle). User-defined anchor points are then used to stretch and conform the histological section onto the atlas section; once they are merged a new image is generated with the histology warped to overlay the atlas slice (right panel). (<bold>B</bold>) The user then generates an estimate of probe placement and length by clicking at least four points spanning from the entry of the probe in the brain to the distal tip (left). The 3D reconstructed placement of the probe is shown in the sagittal plane (middle panel) and viewed from the top (right panel) in the WHS volume. (<bold>C</bold>) A read-out from the merged probe shows details of the probe insertion, the coordinates, as well as the brain regions the probe traversed in different colors. WHS, Waxholm Space.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-83496-fig3-v2.tif"/></fig><fig id="fig3s1" position="float" specific-use="child-fig"><label>Figure 3—figure supplement 1.</label><caption><title>An example image for learning to use the probe reconstruction functionality, as shown in <xref ref-type="fig" rid="fig3">Figure 3</xref>.</title></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-83496-fig3-figsupp1-v2.tif"/></fig></fig-group></sec><sec id="s2-4"><title>Reconstruction of viral expression</title><p>Beyond electrode reconstructions, HERBS can be used for anatomical applications including visualization of virus expression, tracer labeling, or marking lesions or neurodegeneration. Here, we provide a brief overview of the procedure for reconstructing a spatial volume of adenovirus (AAV) expression (see Cookbook, chapter 6.7 for this and related protocols). The procedure for reconstructing viral expresion volumes is similar to that for probe reconstruction, but the regions defined in each slice are two-dimensional, and the volume to delineate will likely extend over multiple slices (<xref ref-type="fig" rid="fig4">Figure 4</xref>). As with reconstructing a probe track, the first step in reconstructing a viral volume is matching the starting histology section with the corresponding slice in the atlas brain and overlaying the two. The initial slice from an example viral reconstruction is shown in <xref ref-type="fig" rid="fig4">Figure 4A</xref>, and the same image is provided for user practice in <xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1</xref>. The user then defines the perimeter of virus expression by selecting the magic wand tool from the Tool Bar and clicking on a fluorescent region of tissue in the histological section (<xref ref-type="fig" rid="fig4">Figure 4B</xref>). Note that the granularity of the selected region will depend on the magic wand tolerance set by the user. These steps are repeated for each slice included in the visualization. Finally, the marked fluorescent regions from several 2D sections are combined and projected into a 3D brain volume (<xref ref-type="fig" rid="fig4">Figure 4C</xref>), and the list of brain regions in contact with the virus are shown in the read-out with color-coded labels (<xref ref-type="fig" rid="fig4">Figure 4D</xref>). The same functions and steps are used for similar tasks such as labeling single cells, marking fibers of passage, or visualizing lesions. Note also that the resolution of the 3D reconstruction will depend on how many sections the user includes in the reconstruction; the example in <xref ref-type="fig" rid="fig4">Figure 4C</xref> consisted of 11 tissue slices. It is also possible to load cell point data generated from other programs, such as CellFinder (<xref ref-type="bibr" rid="bib31">Tyson et al., 2021</xref>), and to visualize those data in 3D brain volumes. Instructions for importing external cell point data can be found in section 6.8.3 of the HERBS Cookbook.</p><fig-group><fig id="fig4" position="float"><label>Figure 4.</label><caption><title>3D visualization of virus expression across multiple tissue sections.</title><p>(<bold>A</bold>) Shows the spatial extent of AAV-mediated mCherry expression in a coronal section from the frontal cortex of an adult rat. (<bold>B</bold>) The region of viral expression is defined by clicking the fluorescent region of tissue with the magic wand tool; areal boundaries are included at this stage. (<bold>C</bold>) A volumetric rendering of the brain shows the extent of viral expression in cingulate cortex and surrounding areas, with the volume of virus spread (based on the 11 slices used here) expressed in voxels, and the proportion of each region expressing the virus show as a percentage. (<bold>D</bold>) A read-out of the regions in which the virus was expressed.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-83496-fig4-v2.tif"/></fig><fig id="fig4s1" position="float" specific-use="child-fig"><label>Figure 4—figure supplement 1.</label><caption><title>An example image for learning to reconstruct viral expression in a single brain slice, as shown in <xref ref-type="fig" rid="fig4">Figure 4</xref>.</title></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-83496-fig4-figsupp1-v2.tif"/></fig></fig-group></sec></sec><sec id="s3" sec-type="discussion"><title>Discussion</title><p>With HERBS, we seek to furnish rodent users with a user-friendly, click-button GUI that simplifies the process of curating histological data. The functionalities include planning coordinates ahead of surgeries as well as registering and visualizing anatomical data in 2D or 3D after experiments are completed. The GUI can be used to delineate a range of features such as recording locations, lesions or viral expression and is compatible with potentially any histological staining method. With HERBS, the user marks regions of interest on tissue images directly and each slice is mapped to a template, which should greatly reduce subjective judgement and variability across samples and brains. For rat users, HERBS references the newest version (v4) of the WHS rat brain atlas (<xref ref-type="bibr" rid="bib23">Papp et al., 2014</xref>), which contains over 200 labeled cortical and sub-cortical regions at sub-millimeter scales, and for mouse users it references the widely-adopted Allen Mouse Brain Atlas (<xref ref-type="bibr" rid="bib34">Wang et al., 2020</xref>).</p><sec id="s3-1"><title>Novelty and utility of HERBS in relation to other tool kits</title><p>Although several software packages with similar functionalities have been released in recent years (see <xref ref-type="supplementary-material" rid="supp1">Supplementary file 1</xref>), there are a number of features that distinguish HERBS from them. Foremost is its simplicity, since it works via a visually intuitive, click-button interface designed to minimize user effort, and it requires minimal coding and no added software. It is also unique in that it brings together both pre- and post-surgical registration and mapping functionalities in one program. The fact that it specifically includes rats also stands out among the many high-quality rendering and digital atlas resources for mice, such as Brain Mesh (<xref ref-type="bibr" rid="bib37">Yaoyao-Hao, 2020</xref>), SHARPTRACK (<xref ref-type="bibr" rid="bib26">Shamash et al., 2018</xref>), cocoframer (<xref ref-type="bibr" rid="bib17">Lein et al., 2007</xref>), and others (e.g. <xref ref-type="bibr" rid="bib14">Jin et al., 2019</xref>, <xref ref-type="bibr" rid="bib5">Chon et al., 2019</xref>).</p><p>Another recently available anatomical tool kit is <italic>Brainrender</italic> (<xref ref-type="bibr" rid="bib8">Claudi et al., 2021</xref>), which produces visually appealing anatomical renderings from a variety of source atlases through the BrainAtlasglobe API, but differs from HERBS in important ways. The most essential difference is that <italic>Brainrender</italic> was designed as a <italic>visualization</italic> tool. As such, it renders anatomical data in 3D volumes, but it cannot register anatomical data in a reference atlas on its own. Registration must be done beforehand with separate software such as Brainreg (<xref ref-type="bibr" rid="bib32">Tyson et al., 2022</xref>) or CellFinder (<xref ref-type="bibr" rid="bib31">Tyson et al., 2021</xref>). HERBS, in contrast, was designed primarily as a <italic>registration</italic> tool, which comes configured to work with primary source atlases for rats or mice. The HERBS GUI can both download and load these reference atlases, whereas <italic>Brainrender</italic> relies on separate software and plugins which require programming knowledge in Python. The output from HERBS could be used as input for <italic>Brainrender</italic> if formatted appropriately, though HERBS offers some of its own visualization functionalities for simplicity. Finally, Brainreg and <italic>Brainrender</italic> use whole-brain data from light sheet imaging, whereas HERBS works with commonly used histological tissue sectioning methods.</p><p>The Allen Institute recently released the Neuropixels Trajectory Explorer (<xref ref-type="bibr" rid="bib3">Andy, 2022</xref>.), a MATLAB-based platform which can be used to plan coordinates for electrophysiological probes prior to surgery in mice and rats. Currently, the pre-surgical registration step is the only functionality available, as it does not yet have the option to load histology for post hoc processing of probe tracks or viral expression. Unlike <italic>Brainrender</italic> and HERBS, it runs in MATLAB, which typically requires a paid software license. Thus, the main features that distinguish HERBS from other tools are that it (i) offers a combination of functionalities found separately in <italic>Brainrender</italic> and Neuropixels trajectory explorer, (ii) all functionalities in HERBS are accessible with button clicks and keystrokes. It includes reconstructing probe tracks of neuropixel 1.0 and 2.0, tetrodes and linear silicon probes (with user defined geometry and channel layout); along with registering virus expressed with a read-out of the spread in brain regions in volume and percentage, and (iii) it can be used immediately with the WHS Rat Brain Atlas or the Allen Mouse Brain Atlas without requiring additional plugins. Beyond these features, HERBS, similar to Brainreg (<xref ref-type="bibr" rid="bib32">Tyson et al., 2022</xref>), can incorporate other atlases given the correctly formatted files, such as the Paxinos and Watson atlases for rats or mice, provided the user has the appropriate licensing permissions.</p></sec><sec id="s3-2"><title>Sources of error and future improvements</title><p>While we hope that HERBS proves useful in its current form, there are areas where it can be improved and expanded in the future. For example, the template matching step can be time consuming if data sets contain a large number of histological slices, as with virus expression or tracer labeling. We aim to streamline these processes by implementing machine vision-based algorithms for pre-processing user images and matching them to template slices automatically in future versions of HERBS. Furthermore, although we designed HERBS to minimize the need for programming, installing it could be challenging for users who have not installed Python before.</p><p>In developing HERBS we also encountered sources of error which appear general to working with anatomical tissue that has been preserved with fixatives. For instance, we found that probe length estimates can be less consistent when larger numbers of histological slices are used for reconstructions. We suspect these errors could arise from averaging across clicked points defining the probe trajectory, and it is possible that misalignment of clicked points between slices can add to this. Another issue is that fixing tissue with paraformaldehyde causes non-uniform shrinking of the tissue. We found this could lead to small discrepancies when comparing Neuropixels channel counts from HERBS, which uses fixed tissue, against LFP measures taken while the animals were still alive. Although tissue shrinkage is inherent to histological processing and cannot be removed mathematically, HERBS offers a solution by fitting warped tissue to the atlas template using multiple anchor points per slice, which should substantially reduce inconsistencies due to shrinkage.</p><p>Accurately registering raw neuroanatomical data in a reference atlas framework, though critically important, is time consuming, tedious and variable from user to user. HERBS was developed to expedite, simplify, and systematize this process by providing a single tool for generating anatomical coordinates, as well as annotated 2D and 3D visualizations and data tables summarizing its outputs. We wish to emphasize that HERBS is a completely open-source software with which we aim to help our fellow research community. We therefore welcome users to submit suggestions for improvements and to report bugs on our GitHub page, as this will help us continually improve the software and user experience.</p></sec></sec><sec id="s4" sec-type="materials|methods"><title>Materials and methods</title><table-wrap id="keyresource" position="anchor"><label>Key resources table</label><table frame="hsides" rules="groups"><thead><tr><th align="left" valign="bottom">Reagent type (species) or resource</th><th align="left" valign="bottom">Designation</th><th align="left" valign="bottom">Source or reference</th><th align="left" valign="bottom">Identifiers</th><th align="left" valign="bottom">Additional information</th></tr></thead><tbody><tr><td align="left" valign="bottom">Software, algorithm</td><td align="left" valign="bottom">Numpy</td><td align="left" valign="bottom"><xref ref-type="bibr" rid="bib13">Harris et al., 2020</xref></td><td align="left" valign="bottom">RRID:<ext-link ext-link-type="uri" xlink:href="https://identifiers.org/RRID/RRID:SCR_008633">SCR_008633</ext-link></td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Software, algorithm</td><td align="left" valign="bottom">Scipy</td><td align="left" valign="bottom"><xref ref-type="bibr" rid="bib33">Virtanen et al., 2020</xref></td><td align="left" valign="bottom">RRID:<ext-link ext-link-type="uri" xlink:href="https://identifiers.org/RRID/RRID:SCR_008058">SCR_008058</ext-link></td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Software, algorithm</td><td align="left" valign="bottom">OpenCV</td><td align="left" valign="bottom"><xref ref-type="bibr" rid="bib4">Bradski, 2000</xref></td><td align="left" valign="bottom">RRID:<ext-link ext-link-type="uri" xlink:href="https://identifiers.org/RRID/RRID:SCR_01552">SCR_01552</ext-link></td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Software, algorithm</td><td align="left" valign="bottom">PyOpenGL</td><td align="left" valign="bottom"><xref ref-type="bibr" rid="bib36">Woo et al., 1999</xref></td><td align="left" valign="bottom"/><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Software, algorithm</td><td align="left" valign="bottom">PyQT5</td><td align="left" valign="bottom"><xref ref-type="bibr" rid="bib24">PyQT, 2012</xref></td><td align="left" valign="bottom"/><td align="left" valign="bottom"/></tr></tbody></table></table-wrap><sec id="s4-1"><title>Python packages and resources</title><p>HERBS is written entirely in Python version three using basic Python packages, such as numpy, opencv, and scipy, as mentioned in the table below. Details on the specific dependencies used in HERBS can be found in HERBS Cookbook (chapter 3). Documentation and step-wise instructions for installing and implementing HERBS can be found in the HERBS Cookbook (chapter 4). HERBS is an open-source software with hard-coded Python scripts. Should a user wish to customize Python-pipeline, one can use the code of TRACER—which is open-source and available at the <ext-link ext-link-type="uri" xlink:href="https://github.com/Whitlock-Group/TRACER">Github repository</ext-link> (<xref ref-type="bibr" rid="bib22">Paglia et al., 2021</xref>). To use HERBS, we recommend users to create a PyCharm project with Python installation (version 3.8.10) and other supporting packages which are specified in the dependencies section in the HERBS Cookbook (chapter 4).</p></sec><sec id="s4-2"><title>Neuropixels and virus expression</title><p>All experiments were performed in accordance with the Norwegian Animal Welfare Act and the European Convention for the Protection of Vertebrate Animals used for Experimental and Other Scientific Purposes. All procedures were approved by the Norwegian Food Safety Authority (Mattilsynet; protocol IDs 27175 and 25094). All tissue for in-house testing came from adult (&gt;15 weeks) Long-Evans hooded rats. Detailed steps of the surgical preparation and post-operative care are described in <xref ref-type="bibr" rid="bib18">Mimica et al., 2018</xref>.</p><sec id="s4-2-1"><title>Neuropixels</title><p>The probes (version 1.0 Neuropixels, IMEC, Belgium) were coated with DiI (Vybrant DiI, catalog no. V22888, Thermo Fisher Scientific, USA) by repeatedly drawing a 2 µL droplet of DiI solution at the tip of a micropipette up and down the length of the probe shank until all DiI had dried onto the shank, causing the shank to appear pink. The probes were angled in the arm of a stereotaxic frame and inserted at a rate of 100–300 µm per min. The chronically implanted animal was kept &lt;1 week following surgery, after which it was perfused with 4% paraformaldehyde and the brains were removed.</p><p>The brain was transferred to 2% dimethyl sulfoxide (DMSO; VWR, USA) solution for cryoprotection for 1–2 days, after which the Neuropixel shank was removed, the brain was frozen and sectioned in 50 µm slices with a sliding microtome (Microm HM430, Thermo Fisher Scientific). The tissue sections then underwent fluorescent immunostaining against NeuN (catalog no. ABN90P, Sigma-Alrich, USA), followed by secondary antibody-staining with Alexa 647-tagged goat anti-guinea pig antibody (catalog no. A21450, Thermo Fisher Scientific), after which the sections were rinsed, mounted, coverslipped, and stored at 4<sup>0</sup>C. The detailed immunostaining protocol is available per request. Next, the sections were digitized using an automated scanner for fluorescence and brightfield images at the appropriate illumination wavelengths (Zeiss Axio Scan.Z1, Jena, Germany), and were saved in .jpeg format for processing in TRACER.</p></sec><sec id="s4-2-2"><title>Virus expression</title><p>Pulled glass pipettes were used to inject 500 nL of AAV5-mDIx-Chr2-mCherry-Fishell-3 (plasmid no. 83898, Addgene, USA; AAV produced at Kavli Viral Vector Core Facility, NTNU) at a rate of 50 nL per min. Bilateral injections were targeted to the cingulate cortex (Cg1; +2.0 AP, ±0.5 ML, –2.0DV). Five weeks after surgery, the animal was killed and perfused with 4% paraformaldehyde. The brain was removed, post-fixed overnight in 4% paraformaldehyde at 4<sup>0</sup>C, then cryoprotected for 24 hr in 2% DMSO. The brain was then frozen in dry ice and 40 µm sections were collected as described above. Fluorescent signal from the virus was amplified by immunostaining against Red Fluorescent Protein (catalog no. 5F8, Chromotek GmbH, Germany), followed by secondary antibody-staining with Alexa 546-tagged Goat anti-rat IgG (catalog no. A-11081, Thermo Fisher Scientific). The detailed immunostaining protocol is available upon request.</p></sec></sec><sec id="s4-3"><title>Data availability, software, and citation policy</title><p>The software described in this manuscript is an open-source software written completely in Python. HERBS is fully supported by Windows, macOS, and Linux. Source code is available on <ext-link ext-link-type="uri" xlink:href="https://github.com/Whitlock-Group/HERBS">https://github.com/Whitlock-Group/HERBS</ext-link> (<xref ref-type="bibr" rid="bib10">Fuglstad, 2022</xref>). HERBS Cookbook and documents are available on the Whitlock group <ext-link ext-link-type="uri" xlink:href="https://github.com/Whitlock-Group/HERBS">Github page</ext-link>.</p><p>The WHS rat brain atlas files can be found here on the NITRC website (<ext-link ext-link-type="uri" xlink:href="https://www.nitrc.org/projects/whs-sd-atlas">https://www.nitrc.org/projects/whs-sd-atlas</ext-link>). The required atlas files to run HERBS (downloaded upon installation of HERBS) and TRACER are cited below:</p><list list-type="simple"><list-item><p>WHS rat brain atlas v4:</p><list list-type="simple"><list-item><p>WHS_SD_rat_atlas_v4.nii.gz (Kleven et al., in preparation)</p></list-item><list-item><p>WHS_SD_rat_atlas_v4.label (Kleven et al., in preparation)</p></list-item></list></list-item><list-item><p>Previous version of the WHS rat brain atlas (v1.01):</p><list list-type="simple"><list-item><p>WHS_SD_rat_T2star_v1.01.nii.gz (<xref ref-type="bibr" rid="bib23">Papp et al., 2014</xref>)</p></list-item><list-item><p>WHS_SD_rat_brainmask_v1.01.nii.gz (<xref ref-type="bibr" rid="bib23">Papp et al., 2014</xref>)</p></list-item></list></list-item></list><sec id="s4-3-1"><title>Citation policy</title><p>We kindly ask users to cite this paper when using HERBS or TRACER in their studies, and to cite the appropriate version of the WHS rat brain atlas.</p><p>Refer to the WHS Atlas by its RRID: <ext-link ext-link-type="uri" xlink:href="https://identifiers.org/RRID/RRID:SCR_017124">SCR_017124</ext-link>, and cite the first publication (<xref ref-type="bibr" rid="bib23">Papp et al., 2014</xref>) along with the version of the atlas that is used. For example, cite <xref ref-type="bibr" rid="bib15">Kjonigsen et al., 2015</xref>, v2 of the atlas if the user’s work makes particular use of delineations of the hippocampal region. Or cite <xref ref-type="bibr" rid="bib21">Osen et al., 2019</xref>, v3 of the atlas if the user’s work makes particular use of delineations of the auditory system.</p></sec><sec id="s4-3-2"><title>License</title><p>The WHS Atlas of the Sprague Dawley rat brain is licensed under the Creative Commons Attribution ShareAlike (CC BY-SA) 4.0 license: <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-sa/4.0/">https://creativecommons.org/licenses/by-sa/4.0/</ext-link>.</p><p>The Allen Mouse Brain Atlas software and wiki are freely available at <ext-link ext-link-type="uri" xlink:href="https://github.com/cortex-lab/allenCCF">https://github.com/cortex-lab/allenCCF</ext-link> (<xref ref-type="bibr" rid="bib27">Shamash et al., 2022</xref>).</p></sec></sec></sec></body><back><sec sec-type="additional-information" id="s5"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="COI-statement" id="conf1"><p>No competing interests declared</p></fn><fn fn-type="COI-statement" id="conf2"><p>No competing interests declared</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>Conceptualization, Data curation, Software, Supervision, Validation, Visualization, Writing – review and editing</p></fn><fn fn-type="con" id="con2"><p>Software, Validation, Visualization, Writing - original draft, Writing – review and editing</p></fn><fn fn-type="con" id="con3"><p>Software, Validation, Visualization</p></fn><fn fn-type="con" id="con4"><p>Conceptualization, Supervision, Funding acquisition, Project administration, Writing – review and editing</p></fn></fn-group><fn-group content-type="ethics-information"><title>Ethics</title><fn fn-type="other"><p>All experiments were performed in accordance with the Norwegian Animal Welfare Act and the European Convention for the Protection of Vertebrate Animals used for Experimental and Other Scientific Purposes. All procedures were approved by the Norwegian Food Safety Authority (Mattilsynet; protocol IDs 27175 and 25094). All tissue for in-house testing came from adult (&gt;15wk) Long-Evans hooded rats. Detailed steps of the surgical preparation and post-operative care are described in Mimica et al. 2018 (doi:10.1126/science.aau2013).</p></fn></fn-group></sec><sec sec-type="supplementary-material" id="s6"><title>Additional files</title><supplementary-material id="mdar"><label>MDAR checklist</label><media xlink:href="elife-83496-mdarchecklist1-v2.docx" mimetype="application" mime-subtype="docx"/></supplementary-material><supplementary-material id="supp1"><label>Supplementary file 1.</label><caption><title>Table summarizing the currently available anatomical tool kits for use with rodents.</title><p>The name and year of publication for each tool kit are shown at top, and the functionalities of each tool kit are listed below.</p></caption><media xlink:href="elife-83496-supp1-v2.docx" mimetype="application" mime-subtype="docx"/></supplementary-material></sec><sec sec-type="data-availability" id="s7"><title>Data availability</title><p>The software described in this manuscript is an open-source software written completely in Python 3.8. HERBS is fully supported by Windows, macOS and Linux. Source code, HERBS Cookbook and documentation are available on the Whitlock group Github page: <ext-link ext-link-type="uri" xlink:href="https://github.com/Whitlock-Group/HERBS">https://github.com/Whitlock-Group/HERBS</ext-link>. The Waxholm Space rat brain atlas files can be found here from the NITRC website: <ext-link ext-link-type="uri" xlink:href="https://www.nitrc.org/projects/whs-sd-atlas">https://www.nitrc.org/projects/whs-sd-atlas</ext-link>. The Allen Mouse Brain Atlas software and wiki are freely available at: <ext-link ext-link-type="uri" xlink:href="https://github.com/cortex-lab/allenCCF">https://github.com/cortex-lab/allenCCF</ext-link>.</p></sec><ack id="ack"><title>Acknowledgements</title><p>The authors thank T B Leergaard, I E Bjerke, and H Kleven for graciously sharing and assisting with the Waxholm Space atlas version 4; T Tombaz, B Mimica, E H Holmberg, and I Rautio for sample tissue; M Andresen and GM Olsen for technical assistance; E H Holmberg, B Kanter, T Tomaz, I Rautio and A Vollan, J Rudolf, D Hayden for beta testing HERBS and/or TRACER functionalities; M P Witter, GM Olsen, and members of the Whitlock lab for helpful discussion; B Mimica and T Tombaz for motivating the need for such a tool kit. This work was supported by a Research Council of Norway FRIPRO Grant (no. 300709) to JRW, the Centre of Excellence Scheme of the Research Council of Norway (Centre for Neural Computation, Grant no. 223262), the National Infrastructure Scheme of the Research Council of Norway – NORBRAIN (Grant no. 197467), and The Kavli Foundation. The MRI core facility is funded by the Faculty of Medicine at NTNU and Central Norway Regional Health Authority.</p></ack><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="software"><person-group person-group-type="author"><collab>Adobe Inc</collab></person-group><year iso-8601-date="2023">2023a</year><data-title>Adobe illustrator</data-title><publisher-name>Adobe</publisher-name><ext-link ext-link-type="uri" xlink:href="https://adobe.com/products/illustrator">https://adobe.com/products/illustrator</ext-link></element-citation></ref><ref id="bib2"><element-citation publication-type="software"><person-group person-group-type="author"><collab>Adobe Inc</collab></person-group><year iso-8601-date="2023">2023b</year><data-title>Adobe photoshop</data-title><publisher-name>Adobe</publisher-name><ext-link ext-link-type="uri" xlink:href="https://www.adobe.com/products/photoshop.html">https://www.adobe.com/products/photoshop.html</ext-link></element-citation></ref><ref id="bib3"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Andy</surname><given-names>P</given-names></name></person-group><year iso-8601-date="2022">2022</year><data-title>Neuropixels trajectory explorer</data-title><version designator="fdca299">fdca299</version><source>GitHub</source><ext-link ext-link-type="uri" xlink:href="https://github.com/petersaj/neuropixels_trajectory_explorer">https://github.com/petersaj/neuropixels_trajectory_explorer</ext-link></element-citation></ref><ref id="bib4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bradski</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2000">2000</year><article-title>The opencv library</article-title><source>Dr Dobb’s Journal: Software Tools for the Professional Programmer</source><volume>25</volume><fpage>120</fpage><lpage>123</lpage></element-citation></ref><ref id="bib5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chon</surname><given-names>U</given-names></name><name><surname>Vanselow</surname><given-names>DJ</given-names></name><name><surname>Cheng</surname><given-names>KC</given-names></name><name><surname>Kim</surname><given-names>Y</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Enhanced and unified anatomical labeling for a common mouse brain atlas</article-title><source>Nature Communications</source><volume>10</volume><elocation-id>5067</elocation-id><pub-id pub-id-type="doi">10.1038/s41467-019-13057-w</pub-id><pub-id pub-id-type="pmid">31699990</pub-id></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Clancy</surname><given-names>KB</given-names></name><name><surname>Orsolic</surname><given-names>I</given-names></name><name><surname>Mrsic-Flogel</surname><given-names>TD</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Locomotion-dependent remapping of distributed cortical networks</article-title><source>Nature Neuroscience</source><volume>22</volume><fpage>778</fpage><lpage>786</lpage><pub-id pub-id-type="doi">10.1038/s41593-019-0357-8</pub-id><pub-id pub-id-type="pmid">30858604</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Claudi</surname><given-names>F</given-names></name><name><surname>Petrucco</surname><given-names>L</given-names></name><name><surname>Tyson</surname><given-names>AL</given-names></name><name><surname>Branco</surname><given-names>T</given-names></name><name><surname>Margrie</surname><given-names>TW</given-names></name><name><surname>Portugues</surname><given-names>R</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>BrainGlobe atlas API: a common interface for neuroanatomical atlases</article-title><source>Journal of Open Source Software</source><volume>5</volume><elocation-id>2668</elocation-id><pub-id pub-id-type="doi">10.21105/joss.02668</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Claudi</surname><given-names>F</given-names></name><name><surname>Tyson</surname><given-names>AL</given-names></name><name><surname>Petrucco</surname><given-names>L</given-names></name><name><surname>Margrie</surname><given-names>TW</given-names></name><name><surname>Portugues</surname><given-names>R</given-names></name><name><surname>Branco</surname><given-names>T</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Visualizing anatomically registered data with brainrender</article-title><source>eLife</source><volume>10</volume><elocation-id>e65751</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.65751</pub-id><pub-id pub-id-type="pmid">33739286</pub-id></element-citation></ref><ref id="bib9"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Franklin</surname><given-names>K</given-names></name><name><surname>Paxinos</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2008">2008</year><source>The Mouse Brain in Stereotaxic Coordinates,Compact</source><publisher-name>Elsevier</publisher-name></element-citation></ref><ref id="bib10"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Fuglstad</surname><given-names>JG</given-names></name></person-group><year iso-8601-date="2022">2022</year><data-title>HERBS</data-title><version designator="https://github.com/Whitlock-Group/HERBS">https://github.com/Whitlock-Group/HERBS</version><source>GitHub</source><ext-link ext-link-type="uri" xlink:href="https://github.com/Whitlock-Group/HERBS">https://github.com/Whitlock-Group/HERBS</ext-link></element-citation></ref><ref id="bib11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fürth</surname><given-names>D</given-names></name><name><surname>Vaissière</surname><given-names>T</given-names></name><name><surname>Tzortzi</surname><given-names>O</given-names></name><name><surname>Xuan</surname><given-names>Y</given-names></name><name><surname>Märtin</surname><given-names>A</given-names></name><name><surname>Lazaridis</surname><given-names>I</given-names></name><name><surname>Spigolon</surname><given-names>G</given-names></name><name><surname>Fisone</surname><given-names>G</given-names></name><name><surname>Tomer</surname><given-names>R</given-names></name><name><surname>Deisseroth</surname><given-names>K</given-names></name><name><surname>Carlén</surname><given-names>M</given-names></name><name><surname>Miller</surname><given-names>CA</given-names></name><name><surname>Rumbaugh</surname><given-names>G</given-names></name><name><surname>Meletis</surname><given-names>K</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>An interactive framework for whole-brain maps at cellular resolution</article-title><source>Nature Neuroscience</source><volume>21</volume><fpage>139</fpage><lpage>149</lpage><pub-id pub-id-type="doi">10.1038/s41593-017-0027-7</pub-id><pub-id pub-id-type="pmid">29203898</pub-id></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gardner</surname><given-names>RJ</given-names></name><name><surname>Hermansen</surname><given-names>E</given-names></name><name><surname>Pachitariu</surname><given-names>M</given-names></name><name><surname>Burak</surname><given-names>Y</given-names></name><name><surname>Baas</surname><given-names>NA</given-names></name><name><surname>Dunn</surname><given-names>BA</given-names></name><name><surname>Moser</surname><given-names>MB</given-names></name><name><surname>Moser</surname><given-names>EI</given-names></name></person-group><year iso-8601-date="2022">2022</year><article-title>Toroidal topology of population activity in grid cells</article-title><source>Nature</source><volume>602</volume><fpage>123</fpage><lpage>128</lpage><pub-id pub-id-type="doi">10.1038/s41586-021-04268-7</pub-id><pub-id pub-id-type="pmid">35022611</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Harris</surname><given-names>CR</given-names></name><name><surname>Millman</surname><given-names>KJ</given-names></name><name><surname>van der Walt</surname><given-names>SJ</given-names></name><name><surname>Gommers</surname><given-names>R</given-names></name><name><surname>Virtanen</surname><given-names>P</given-names></name><name><surname>Cournapeau</surname><given-names>D</given-names></name><name><surname>Wieser</surname><given-names>E</given-names></name><name><surname>Taylor</surname><given-names>J</given-names></name><name><surname>Berg</surname><given-names>S</given-names></name><name><surname>Smith</surname><given-names>NJ</given-names></name><name><surname>Kern</surname><given-names>R</given-names></name><name><surname>Picus</surname><given-names>M</given-names></name><name><surname>Hoyer</surname><given-names>S</given-names></name><name><surname>van Kerkwijk</surname><given-names>MH</given-names></name><name><surname>Brett</surname><given-names>M</given-names></name><name><surname>Haldane</surname><given-names>A</given-names></name><name><surname>Del Río</surname><given-names>JF</given-names></name><name><surname>Wiebe</surname><given-names>M</given-names></name><name><surname>Peterson</surname><given-names>P</given-names></name><name><surname>Gérard-Marchant</surname><given-names>P</given-names></name><name><surname>Sheppard</surname><given-names>K</given-names></name><name><surname>Reddy</surname><given-names>T</given-names></name><name><surname>Weckesser</surname><given-names>W</given-names></name><name><surname>Abbasi</surname><given-names>H</given-names></name><name><surname>Gohlke</surname><given-names>C</given-names></name><name><surname>Oliphant</surname><given-names>TE</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Array programming with numpy</article-title><source>Nature</source><volume>585</volume><fpage>357</fpage><lpage>362</lpage><pub-id pub-id-type="doi">10.1038/s41586-020-2649-2</pub-id><pub-id pub-id-type="pmid">32939066</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Jin</surname><given-names>M</given-names></name><name><surname>Nguyen</surname><given-names>JD</given-names></name><name><surname>Weber</surname><given-names>SJ</given-names></name><name><surname>Mejias-Aponte</surname><given-names>CA</given-names></name><name><surname>Madangopal</surname><given-names>R</given-names></name><name><surname>Golden</surname><given-names>SA</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>SMART: An Open Source Extension of WholeBrain for IDISCO+ LSFM Intact Mouse Brain Registration and Segmentation</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/727529</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kjonigsen</surname><given-names>LJ</given-names></name><name><surname>Lillehaug</surname><given-names>S</given-names></name><name><surname>Bjaalie</surname><given-names>JG</given-names></name><name><surname>Witter</surname><given-names>MP</given-names></name><name><surname>Leergaard</surname><given-names>TB</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Waxholm space atlas of the rat brain hippocampal region: three-dimensional delineations based on magnetic resonance and diffusion tensor imaging</article-title><source>NeuroImage</source><volume>108</volume><fpage>441</fpage><lpage>449</lpage><pub-id pub-id-type="doi">10.1016/j.neuroimage.2014.12.080</pub-id><pub-id pub-id-type="pmid">25585022</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lagartos-Donate</surname><given-names>MJ</given-names></name><name><surname>Doan</surname><given-names>TP</given-names></name><name><surname>Girão</surname><given-names>PJB</given-names></name><name><surname>Witter</surname><given-names>MP</given-names></name></person-group><year iso-8601-date="2022">2022</year><article-title>Postnatal development of projections of the postrhinal cortex to the entorhinal cortex in the rat</article-title><source>ENeuro</source><volume>9</volume><elocation-id>ENEURO.0057-22.2022</elocation-id><pub-id pub-id-type="doi">10.1523/ENEURO.0057-22.2022</pub-id><pub-id pub-id-type="pmid">35715208</pub-id></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lein</surname><given-names>ES</given-names></name><name><surname>Hawrylycz</surname><given-names>MJ</given-names></name><name><surname>Ao</surname><given-names>N</given-names></name><name><surname>Ayres</surname><given-names>M</given-names></name><name><surname>Bensinger</surname><given-names>A</given-names></name><name><surname>Bernard</surname><given-names>A</given-names></name><name><surname>Boe</surname><given-names>AF</given-names></name><name><surname>Boguski</surname><given-names>MS</given-names></name><name><surname>Brockway</surname><given-names>KS</given-names></name><name><surname>Byrnes</surname><given-names>EJ</given-names></name><name><surname>Chen</surname><given-names>L</given-names></name><name><surname>Chen</surname><given-names>L</given-names></name><name><surname>Chen</surname><given-names>T-M</given-names></name><name><surname>Chin</surname><given-names>MC</given-names></name><name><surname>Chong</surname><given-names>J</given-names></name><name><surname>Crook</surname><given-names>BE</given-names></name><name><surname>Czaplinska</surname><given-names>A</given-names></name><name><surname>Dang</surname><given-names>CN</given-names></name><name><surname>Datta</surname><given-names>S</given-names></name><name><surname>Dee</surname><given-names>NR</given-names></name><name><surname>Desaki</surname><given-names>AL</given-names></name><name><surname>Desta</surname><given-names>T</given-names></name><name><surname>Diep</surname><given-names>E</given-names></name><name><surname>Dolbeare</surname><given-names>TA</given-names></name><name><surname>Donelan</surname><given-names>MJ</given-names></name><name><surname>Dong</surname><given-names>H-W</given-names></name><name><surname>Dougherty</surname><given-names>JG</given-names></name><name><surname>Duncan</surname><given-names>BJ</given-names></name><name><surname>Ebbert</surname><given-names>AJ</given-names></name><name><surname>Eichele</surname><given-names>G</given-names></name><name><surname>Estin</surname><given-names>LK</given-names></name><name><surname>Faber</surname><given-names>C</given-names></name><name><surname>Facer</surname><given-names>BA</given-names></name><name><surname>Fields</surname><given-names>R</given-names></name><name><surname>Fischer</surname><given-names>SR</given-names></name><name><surname>Fliss</surname><given-names>TP</given-names></name><name><surname>Frensley</surname><given-names>C</given-names></name><name><surname>Gates</surname><given-names>SN</given-names></name><name><surname>Glattfelder</surname><given-names>KJ</given-names></name><name><surname>Halverson</surname><given-names>KR</given-names></name><name><surname>Hart</surname><given-names>MR</given-names></name><name><surname>Hohmann</surname><given-names>JG</given-names></name><name><surname>Howell</surname><given-names>MP</given-names></name><name><surname>Jeung</surname><given-names>DP</given-names></name><name><surname>Johnson</surname><given-names>RA</given-names></name><name><surname>Karr</surname><given-names>PT</given-names></name><name><surname>Kawal</surname><given-names>R</given-names></name><name><surname>Kidney</surname><given-names>JM</given-names></name><name><surname>Knapik</surname><given-names>RH</given-names></name><name><surname>Kuan</surname><given-names>CL</given-names></name><name><surname>Lake</surname><given-names>JH</given-names></name><name><surname>Laramee</surname><given-names>AR</given-names></name><name><surname>Larsen</surname><given-names>KD</given-names></name><name><surname>Lau</surname><given-names>C</given-names></name><name><surname>Lemon</surname><given-names>TA</given-names></name><name><surname>Liang</surname><given-names>AJ</given-names></name><name><surname>Liu</surname><given-names>Y</given-names></name><name><surname>Luong</surname><given-names>LT</given-names></name><name><surname>Michaels</surname><given-names>J</given-names></name><name><surname>Morgan</surname><given-names>JJ</given-names></name><name><surname>Morgan</surname><given-names>RJ</given-names></name><name><surname>Mortrud</surname><given-names>MT</given-names></name><name><surname>Mosqueda</surname><given-names>NF</given-names></name><name><surname>Ng</surname><given-names>LL</given-names></name><name><surname>Ng</surname><given-names>R</given-names></name><name><surname>Orta</surname><given-names>GJ</given-names></name><name><surname>Overly</surname><given-names>CC</given-names></name><name><surname>Pak</surname><given-names>TH</given-names></name><name><surname>Parry</surname><given-names>SE</given-names></name><name><surname>Pathak</surname><given-names>SD</given-names></name><name><surname>Pearson</surname><given-names>OC</given-names></name><name><surname>Puchalski</surname><given-names>RB</given-names></name><name><surname>Riley</surname><given-names>ZL</given-names></name><name><surname>Rockett</surname><given-names>HR</given-names></name><name><surname>Rowland</surname><given-names>SA</given-names></name><name><surname>Royall</surname><given-names>JJ</given-names></name><name><surname>Ruiz</surname><given-names>MJ</given-names></name><name><surname>Sarno</surname><given-names>NR</given-names></name><name><surname>Schaffnit</surname><given-names>K</given-names></name><name><surname>Shapovalova</surname><given-names>NV</given-names></name><name><surname>Sivisay</surname><given-names>T</given-names></name><name><surname>Slaughterbeck</surname><given-names>CR</given-names></name><name><surname>Smith</surname><given-names>SC</given-names></name><name><surname>Smith</surname><given-names>KA</given-names></name><name><surname>Smith</surname><given-names>BI</given-names></name><name><surname>Sodt</surname><given-names>AJ</given-names></name><name><surname>Stewart</surname><given-names>NN</given-names></name><name><surname>Stumpf</surname><given-names>K-R</given-names></name><name><surname>Sunkin</surname><given-names>SM</given-names></name><name><surname>Sutram</surname><given-names>M</given-names></name><name><surname>Tam</surname><given-names>A</given-names></name><name><surname>Teemer</surname><given-names>CD</given-names></name><name><surname>Thaller</surname><given-names>C</given-names></name><name><surname>Thompson</surname><given-names>CL</given-names></name><name><surname>Varnam</surname><given-names>LR</given-names></name><name><surname>Visel</surname><given-names>A</given-names></name><name><surname>Whitlock</surname><given-names>RM</given-names></name><name><surname>Wohnoutka</surname><given-names>PE</given-names></name><name><surname>Wolkey</surname><given-names>CK</given-names></name><name><surname>Wong</surname><given-names>VY</given-names></name><name><surname>Wood</surname><given-names>M</given-names></name><name><surname>Yaylaoglu</surname><given-names>MB</given-names></name><name><surname>Young</surname><given-names>RC</given-names></name><name><surname>Youngstrom</surname><given-names>BL</given-names></name><name><surname>Yuan</surname><given-names>XF</given-names></name><name><surname>Zhang</surname><given-names>B</given-names></name><name><surname>Zwingman</surname><given-names>TA</given-names></name><name><surname>Jones</surname><given-names>AR</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Genome-Wide atlas of gene expression in the adult mouse brain</article-title><source>Nature</source><volume>445</volume><fpage>168</fpage><lpage>176</lpage><pub-id pub-id-type="doi">10.1038/nature05453</pub-id><pub-id pub-id-type="pmid">17151600</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mimica</surname><given-names>B</given-names></name><name><surname>Dunn</surname><given-names>BA</given-names></name><name><surname>Tombaz</surname><given-names>T</given-names></name><name><surname>Bojja</surname><given-names>VP</given-names></name><name><surname>Whitlock</surname><given-names>JR</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Efficient cortical coding of 3D posture in freely behaving rats</article-title><source>Science</source><volume>362</volume><fpage>584</fpage><lpage>589</lpage><pub-id pub-id-type="doi">10.1126/science.aau2013</pub-id><pub-id pub-id-type="pmid">30385578</pub-id></element-citation></ref><ref id="bib19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Oh</surname><given-names>SW</given-names></name><name><surname>Harris</surname><given-names>JA</given-names></name><name><surname>Ng</surname><given-names>L</given-names></name><name><surname>Winslow</surname><given-names>B</given-names></name><name><surname>Cain</surname><given-names>N</given-names></name><name><surname>Mihalas</surname><given-names>S</given-names></name><name><surname>Wang</surname><given-names>Q</given-names></name><name><surname>Lau</surname><given-names>C</given-names></name><name><surname>Kuan</surname><given-names>L</given-names></name><name><surname>Henry</surname><given-names>AM</given-names></name><name><surname>Mortrud</surname><given-names>MT</given-names></name><name><surname>Ouellette</surname><given-names>B</given-names></name><name><surname>Nguyen</surname><given-names>TN</given-names></name><name><surname>Sorensen</surname><given-names>SA</given-names></name><name><surname>Slaughterbeck</surname><given-names>CR</given-names></name><name><surname>Wakeman</surname><given-names>W</given-names></name><name><surname>Li</surname><given-names>Y</given-names></name><name><surname>Feng</surname><given-names>D</given-names></name><name><surname>Ho</surname><given-names>A</given-names></name><name><surname>Nicholas</surname><given-names>E</given-names></name><name><surname>Hirokawa</surname><given-names>KE</given-names></name><name><surname>Bohn</surname><given-names>P</given-names></name><name><surname>Joines</surname><given-names>KM</given-names></name><name><surname>Peng</surname><given-names>H</given-names></name><name><surname>Hawrylycz</surname><given-names>MJ</given-names></name><name><surname>Phillips</surname><given-names>JW</given-names></name><name><surname>Hohmann</surname><given-names>JG</given-names></name><name><surname>Wohnoutka</surname><given-names>P</given-names></name><name><surname>Gerfen</surname><given-names>CR</given-names></name><name><surname>Koch</surname><given-names>C</given-names></name><name><surname>Bernard</surname><given-names>A</given-names></name><name><surname>Dang</surname><given-names>C</given-names></name><name><surname>Jones</surname><given-names>AR</given-names></name><name><surname>Zeng</surname><given-names>H</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>A mesoscale connectome of the mouse brain</article-title><source>Nature</source><volume>508</volume><fpage>207</fpage><lpage>214</lpage><pub-id pub-id-type="doi">10.1038/nature13186</pub-id><pub-id pub-id-type="pmid">24695228</pub-id></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ortiz</surname><given-names>C</given-names></name><name><surname>Navarro</surname><given-names>JF</given-names></name><name><surname>Jurek</surname><given-names>A</given-names></name><name><surname>Märtin</surname><given-names>A</given-names></name><name><surname>Lundeberg</surname><given-names>J</given-names></name><name><surname>Meletis</surname><given-names>K</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Molecular atlas of the adult mouse brain</article-title><source>Science Advances</source><volume>6</volume><elocation-id>eabb3446</elocation-id><pub-id pub-id-type="doi">10.1126/sciadv.abb3446</pub-id><pub-id pub-id-type="pmid">32637622</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Osen</surname><given-names>KK</given-names></name><name><surname>Imad</surname><given-names>J</given-names></name><name><surname>Wennberg</surname><given-names>AE</given-names></name><name><surname>Papp</surname><given-names>EA</given-names></name><name><surname>Leergaard</surname><given-names>TB</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Waxholm space atlas of the rat brain auditory system: three-dimensional delineations based on structural and diffusion tensor magnetic resonance imaging</article-title><source>NeuroImage</source><volume>199</volume><fpage>38</fpage><lpage>56</lpage><pub-id pub-id-type="doi">10.1016/j.neuroimage.2019.05.016</pub-id><pub-id pub-id-type="pmid">31100433</pub-id></element-citation></ref><ref id="bib22"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Paglia</surname><given-names>J</given-names></name><name><surname>Sal</surname><given-names>P</given-names></name><name><surname>Fuglstad</surname><given-names>JG</given-names></name></person-group><year iso-8601-date="2021">2021</year><data-title>TRACER - 3D</data-title><source>GitHub</source><ext-link ext-link-type="uri" xlink:href="https://github.com/Whitlock-Group/TRACER">https://github.com/Whitlock-Group/TRACER</ext-link></element-citation></ref><ref id="bib23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Papp</surname><given-names>EA</given-names></name><name><surname>Leergaard</surname><given-names>TB</given-names></name><name><surname>Calabrese</surname><given-names>E</given-names></name><name><surname>Johnson</surname><given-names>GA</given-names></name><name><surname>Bjaalie</surname><given-names>JG</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Waxholm space atlas of the sprague dawley rat brain</article-title><source>NeuroImage</source><volume>97</volume><fpage>374</fpage><lpage>386</lpage><pub-id pub-id-type="doi">10.1016/j.neuroimage.2014.04.001</pub-id><pub-id pub-id-type="pmid">24726336</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="software"><person-group person-group-type="author"><collab>PyQT</collab></person-group><year iso-8601-date="2012">2012</year><data-title>PyQt reference guide</data-title><version designator="1.0">1.0</version><source>PyQt</source><ext-link ext-link-type="uri" xlink:href="http://www.riverbankcomputing.com/static/Docs/PyQt4/html/index.html">http://www.riverbankcomputing.com/static/Docs/PyQt4/html/index.html</ext-link></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schneider</surname><given-names>CA</given-names></name><name><surname>Rasband</surname><given-names>WS</given-names></name><name><surname>Eliceiri</surname><given-names>KW</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Nih image to imagej: 25 years of image analysis</article-title><source>Nature Methods</source><volume>9</volume><fpage>671</fpage><lpage>675</lpage><pub-id pub-id-type="doi">10.1038/nmeth.2089</pub-id><pub-id pub-id-type="pmid">22930834</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Shamash</surname><given-names>P</given-names></name><name><surname>Carandini</surname><given-names>M</given-names></name><name><surname>Harris</surname><given-names>KD</given-names></name><name><surname>Steinmetz</surname><given-names>NA</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>A Tool for Analyzing Electrode Tracks from Slice Histology</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/447995</pub-id></element-citation></ref><ref id="bib27"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Shamash</surname><given-names>P</given-names></name><name><surname>Peters</surname><given-names>A</given-names></name><name><surname>Steinmetz</surname><given-names>N</given-names></name></person-group><year iso-8601-date="2022">2022</year><data-title>Allen CCF tools</data-title><source>GitHub</source><ext-link ext-link-type="uri" xlink:href="https://github.com/cortex-lab/allenCCF">https://github.com/cortex-lab/allenCCF</ext-link></element-citation></ref><ref id="bib28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Simmons</surname><given-names>DM</given-names></name><name><surname>Swanson</surname><given-names>LW</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Comparing histological data from different brains: sources of error and strategies for minimizing them</article-title><source>Brain Research Reviews</source><volume>60</volume><fpage>349</fpage><lpage>367</lpage><pub-id pub-id-type="doi">10.1016/j.brainresrev.2009.02.002</pub-id><pub-id pub-id-type="pmid">19248810</pub-id></element-citation></ref><ref id="bib29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Song</surname><given-names>JH</given-names></name><name><surname>Choi</surname><given-names>W</given-names></name><name><surname>Song</surname><given-names>YH</given-names></name><name><surname>Kim</surname><given-names>JH</given-names></name><name><surname>Jeong</surname><given-names>D</given-names></name><name><surname>Lee</surname><given-names>SH</given-names></name><name><surname>Paik</surname><given-names>SB</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Precise mapping of single neurons by calibrated 3D reconstruction of brain slices reveals topographic projection in mouse visual cortex</article-title><source>Cell Reports</source><volume>31</volume><elocation-id>107682</elocation-id><pub-id pub-id-type="doi">10.1016/j.celrep.2020.107682</pub-id><pub-id pub-id-type="pmid">32460016</pub-id></element-citation></ref><ref id="bib30"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Tyson</surname><given-names>AL</given-names></name><name><surname>Rousseau</surname><given-names>CV</given-names></name><name><surname>Margrie</surname><given-names>TW</given-names></name></person-group><year iso-8601-date="2020">2020</year><data-title>Brainreg: automated 3D brain registration with support for multiple species and atlases</data-title><source>Zenodo</source><ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.3991718">https://doi.org/10.5281/zenodo.3991718</ext-link></element-citation></ref><ref id="bib31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tyson</surname><given-names>AL</given-names></name><name><surname>Rousseau</surname><given-names>CV</given-names></name><name><surname>Niedworok</surname><given-names>CJ</given-names></name><name><surname>Keshavarzi</surname><given-names>S</given-names></name><name><surname>Tsitoura</surname><given-names>C</given-names></name><name><surname>Cossell</surname><given-names>L</given-names></name><name><surname>Strom</surname><given-names>M</given-names></name><name><surname>Margrie</surname><given-names>TW</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>A deep learning algorithm for 3D cell detection in whole mouse brain image datasets</article-title><source>PLOS Computational Biology</source><volume>17</volume><elocation-id>e1009074</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1009074</pub-id><pub-id pub-id-type="pmid">34048426</pub-id></element-citation></ref><ref id="bib32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tyson</surname><given-names>AL</given-names></name><name><surname>Vélez-Fort</surname><given-names>M</given-names></name><name><surname>Rousseau</surname><given-names>CV</given-names></name><name><surname>Cossell</surname><given-names>L</given-names></name><name><surname>Tsitoura</surname><given-names>C</given-names></name><name><surname>Lenzi</surname><given-names>SC</given-names></name><name><surname>Obenhaus</surname><given-names>HA</given-names></name><name><surname>Claudi</surname><given-names>F</given-names></name><name><surname>Branco</surname><given-names>T</given-names></name><name><surname>Margrie</surname><given-names>TW</given-names></name></person-group><year iso-8601-date="2022">2022</year><article-title>Accurate determination of marker location within whole-brain microscopy images</article-title><source>Scientific Reports</source><volume>12</volume><elocation-id>867</elocation-id><pub-id pub-id-type="doi">10.1038/s41598-021-04676-9</pub-id><pub-id pub-id-type="pmid">35042882</pub-id></element-citation></ref><ref id="bib33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Virtanen</surname><given-names>P</given-names></name><name><surname>Gommers</surname><given-names>R</given-names></name><name><surname>Oliphant</surname><given-names>TE</given-names></name><name><surname>Haberland</surname><given-names>M</given-names></name><name><surname>Reddy</surname><given-names>T</given-names></name><name><surname>Cournapeau</surname><given-names>D</given-names></name><name><surname>Burovski</surname><given-names>E</given-names></name><name><surname>Peterson</surname><given-names>P</given-names></name><name><surname>Weckesser</surname><given-names>W</given-names></name><name><surname>Bright</surname><given-names>J</given-names></name><name><surname>van der Walt</surname><given-names>SJ</given-names></name><name><surname>Brett</surname><given-names>M</given-names></name><name><surname>Wilson</surname><given-names>J</given-names></name><name><surname>Millman</surname><given-names>KJ</given-names></name><name><surname>Mayorov</surname><given-names>N</given-names></name><name><surname>Nelson</surname><given-names>ARJ</given-names></name><name><surname>Jones</surname><given-names>E</given-names></name><name><surname>Kern</surname><given-names>R</given-names></name><name><surname>Larson</surname><given-names>E</given-names></name><name><surname>Carey</surname><given-names>CJ</given-names></name><name><surname>Polat</surname><given-names>İ</given-names></name><name><surname>Feng</surname><given-names>Y</given-names></name><name><surname>Moore</surname><given-names>EW</given-names></name><name><surname>VanderPlas</surname><given-names>J</given-names></name><name><surname>Laxalde</surname><given-names>D</given-names></name><name><surname>Perktold</surname><given-names>J</given-names></name><name><surname>Cimrman</surname><given-names>R</given-names></name><name><surname>Henriksen</surname><given-names>I</given-names></name><name><surname>Quintero</surname><given-names>EA</given-names></name><name><surname>Harris</surname><given-names>CR</given-names></name><name><surname>Archibald</surname><given-names>AM</given-names></name><name><surname>Ribeiro</surname><given-names>AH</given-names></name><name><surname>Pedregosa</surname><given-names>F</given-names></name><name><surname>van Mulbregt</surname><given-names>P</given-names></name><collab>SciPy 1.0 Contributors</collab></person-group><year iso-8601-date="2020">2020</year><article-title>SciPy 1.0: fundamental algorithms for scientific computing in python</article-title><source>Nature Methods</source><volume>17</volume><fpage>261</fpage><lpage>272</lpage><pub-id pub-id-type="doi">10.1038/s41592-019-0686-2</pub-id><pub-id pub-id-type="pmid">32015543</pub-id></element-citation></ref><ref id="bib34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname><given-names>Q</given-names></name><name><surname>Ding</surname><given-names>SL</given-names></name><name><surname>Li</surname><given-names>Y</given-names></name><name><surname>Royall</surname><given-names>J</given-names></name><name><surname>Feng</surname><given-names>D</given-names></name><name><surname>Lesnar</surname><given-names>P</given-names></name><name><surname>Graddis</surname><given-names>N</given-names></name><name><surname>Naeemi</surname><given-names>M</given-names></name><name><surname>Facer</surname><given-names>B</given-names></name><name><surname>Ho</surname><given-names>A</given-names></name><name><surname>Dolbeare</surname><given-names>T</given-names></name><name><surname>Blanchard</surname><given-names>B</given-names></name><name><surname>Dee</surname><given-names>N</given-names></name><name><surname>Wakeman</surname><given-names>W</given-names></name><name><surname>Hirokawa</surname><given-names>KE</given-names></name><name><surname>Szafer</surname><given-names>A</given-names></name><name><surname>Sunkin</surname><given-names>SM</given-names></name><name><surname>Oh</surname><given-names>SW</given-names></name><name><surname>Bernard</surname><given-names>A</given-names></name><name><surname>Phillips</surname><given-names>JW</given-names></name><name><surname>Hawrylycz</surname><given-names>M</given-names></name><name><surname>Koch</surname><given-names>C</given-names></name><name><surname>Zeng</surname><given-names>H</given-names></name><name><surname>Harris</surname><given-names>JA</given-names></name><name><surname>Ng</surname><given-names>L</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>The allen mouse brain common coordinate framework: a 3D reference atlas</article-title><source>Cell</source><volume>181</volume><fpage>936</fpage><lpage>953</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2020.04.007</pub-id><pub-id pub-id-type="pmid">32386544</pub-id></element-citation></ref><ref id="bib35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Winnubst</surname><given-names>J</given-names></name><name><surname>Bas</surname><given-names>E</given-names></name><name><surname>Ferreira</surname><given-names>TA</given-names></name><name><surname>Wu</surname><given-names>Z</given-names></name><name><surname>Economo</surname><given-names>MN</given-names></name><name><surname>Edson</surname><given-names>P</given-names></name><name><surname>Arthur</surname><given-names>BJ</given-names></name><name><surname>Bruns</surname><given-names>C</given-names></name><name><surname>Rokicki</surname><given-names>K</given-names></name><name><surname>Schauder</surname><given-names>D</given-names></name><name><surname>Olbris</surname><given-names>DJ</given-names></name><name><surname>Murphy</surname><given-names>SD</given-names></name><name><surname>Ackerman</surname><given-names>DG</given-names></name><name><surname>Arshadi</surname><given-names>C</given-names></name><name><surname>Baldwin</surname><given-names>P</given-names></name><name><surname>Blake</surname><given-names>R</given-names></name><name><surname>Elsayed</surname><given-names>A</given-names></name><name><surname>Hasan</surname><given-names>M</given-names></name><name><surname>Ramirez</surname><given-names>D</given-names></name><name><surname>Dos Santos</surname><given-names>B</given-names></name><name><surname>Weldon</surname><given-names>M</given-names></name><name><surname>Zafar</surname><given-names>A</given-names></name><name><surname>Dudman</surname><given-names>JT</given-names></name><name><surname>Gerfen</surname><given-names>CR</given-names></name><name><surname>Hantman</surname><given-names>AW</given-names></name><name><surname>Korff</surname><given-names>W</given-names></name><name><surname>Sternson</surname><given-names>SM</given-names></name><name><surname>Spruston</surname><given-names>N</given-names></name><name><surname>Svoboda</surname><given-names>K</given-names></name><name><surname>Chandrashekar</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Reconstruction of 1,000 projection neurons reveals new cell types and organization of long-range connectivity in the mouse brain</article-title><source>Cell</source><volume>179</volume><fpage>268</fpage><lpage>281</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2019.07.042</pub-id><pub-id pub-id-type="pmid">31495573</pub-id></element-citation></ref><ref id="bib36"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Woo</surname><given-names>M</given-names></name><name><surname>Neider</surname><given-names>J</given-names></name><name><surname>Davis</surname><given-names>T</given-names></name><name><surname>Shreiner</surname><given-names>D</given-names></name></person-group><year iso-8601-date="1999">1999</year><source>OpenGL Programming Guide: The Official Guide to Learning OpenGL, Version 1.2</source><publisher-name>Addison-Wesley Longman Publishing Co., Inc</publisher-name></element-citation></ref><ref id="bib37"><element-citation publication-type="software"><person-group person-group-type="author"><collab>Yaoyao-Hao</collab></person-group><year iso-8601-date="2020">2020</year><data-title>BrainMesh: A matlab GUI for rendering 3D mouse brain structures</data-title><version designator="13924c0">13924c0</version><source>GitHub</source><ext-link ext-link-type="uri" xlink:href="https://github.com/Yaoyao-Hao/BrainMesh">https://github.com/Yaoyao-Hao/BrainMesh</ext-link></element-citation></ref><ref id="bib38"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yushkevich</surname><given-names>PA</given-names></name><name><surname>Piven</surname><given-names>J</given-names></name><name><surname>Hazlett</surname><given-names>HC</given-names></name><name><surname>Smith</surname><given-names>RG</given-names></name><name><surname>Ho</surname><given-names>S</given-names></name><name><surname>Gee</surname><given-names>JC</given-names></name><name><surname>Gerig</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>User-guided 3D active contour segmentation of anatomical structures: significantly improved efficiency and reliability</article-title><source>NeuroImage</source><volume>31</volume><fpage>1116</fpage><lpage>1128</lpage><pub-id pub-id-type="doi">10.1016/j.neuroimage.2006.01.015</pub-id><pub-id pub-id-type="pmid">16545965</pub-id></element-citation></ref><ref id="bib39"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zingg</surname><given-names>B</given-names></name><name><surname>Hintiryan</surname><given-names>H</given-names></name><name><surname>Gou</surname><given-names>L</given-names></name><name><surname>Song</surname><given-names>MY</given-names></name><name><surname>Bay</surname><given-names>M</given-names></name><name><surname>Bienkowski</surname><given-names>MS</given-names></name><name><surname>Foster</surname><given-names>NN</given-names></name><name><surname>Yamashita</surname><given-names>S</given-names></name><name><surname>Bowman</surname><given-names>I</given-names></name><name><surname>Toga</surname><given-names>AW</given-names></name><name><surname>Dong</surname><given-names>HW</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Neural networks of the mouse neocortex</article-title><source>Cell</source><volume>156</volume><fpage>1096</fpage><lpage>1111</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2014.02.023</pub-id><pub-id pub-id-type="pmid">24581503</pub-id></element-citation></ref><ref id="bib40"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zutshi</surname><given-names>I</given-names></name><name><surname>Valero</surname><given-names>M</given-names></name><name><surname>Fernández-Ruiz</surname><given-names>A</given-names></name><name><surname>Buzsáki</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2022">2022</year><article-title>Extrinsic control and intrinsic computation in the hippocampal CA1 circuit</article-title><source>Neuron</source><volume>110</volume><fpage>658</fpage><lpage>673</lpage><pub-id pub-id-type="doi">10.1016/j.neuron.2021.11.015</pub-id><pub-id pub-id-type="pmid">34890566</pub-id></element-citation></ref></ref-list></back><sub-article article-type="editor-report" id="sa0"><front-stub><article-id pub-id-type="doi">10.7554/eLife.83496.sa0</article-id><title-group><article-title>Editor's evaluation</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Wolff</surname><given-names>Mathieu</given-names></name><role specific-use="editor">Reviewing Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/057qpr032</institution-id><institution>CNRS, University of Bordeaux</institution></institution-wrap><country>France</country></aff></contrib></contrib-group></front-stub><body><p>This paper provides the field with a new and important Python-based tool to assist neurosurgery both before and after a wide range of interventions. In its present form, the software comes as a convincing toolbox that may be helpful for researchers relying on neurosurgery in rodents (both mice and rats).</p></body></sub-article><sub-article article-type="decision-letter" id="sa1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.83496.sa1</article-id><title-group><article-title>Decision letter</article-title></title-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Wolff</surname><given-names>Mathieu</given-names></name><role>Reviewing Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/057qpr032</institution-id><institution>CNRS, University of Bordeaux</institution></institution-wrap><country>France</country></aff></contrib></contrib-group><contrib-group><contrib contrib-type="reviewer"><name><surname>Wolff</surname><given-names>Mathieu</given-names></name><role>Reviewer</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/00hj54h04</institution-id><institution>CNRS, University of Bordeaux</institution></institution-wrap><country>France</country></aff></contrib></contrib-group></front-stub><body><boxed-text id="sa2-box1"><p>In the interests of transparency, eLife publishes the most substantive revision requests and the accompanying author responses.</p></boxed-text><p><bold>Decision letter after peer review:</bold></p><p>[Editors’ note: the authors submitted for reconsideration following the decision after peer review. What follows is the decision letter after the first round of review.]</p><p>Thank you for submitting the paper &quot;TRACER: A toolkit to register and visualize anatomical coordinates in the rat brain&quot; for consideration by <italic>eLife</italic>. Your article has been reviewed by 3 peer reviewers, including Mathieu Wolff as the Reviewing Editor and Reviewer #3, and the evaluation has been overseen by a Senior Editor.</p><p>Comments to the Authors:</p><p>We are sorry to say that, after consultation with the reviewers, we have decided that this work will not be considered further for publication by <italic>eLife</italic>.</p><p>In short, all reviewers found the tool described of this study with a clear value but it really needs further polishing to be widely used within the neuroscience community. At present the installation process is by itself an obstacle for any user with only moderate familiarity with Python-based environment. So this would need to be considerably enhanced to consider a new examination of this tool. In addition a more thorough description of its specific value versus other tools already available including for rats is warranted to understand the added value that TRACER brings.</p><p><italic>Reviewer #1 (Recommendations for the authors):</italic></p><p>General comments:</p><p>It seems like a lot of work to go through all sections and match to the digital atlas. Incorporating matching between pre-processed images and reference sections seems crucial for widespread use of the tool. If this is something that cannot be done in short order, a widespread use of the tool may be limited.</p><p>More extensive comments should be made about Brainrender, which was published in <italic>eLife</italic> in March 2021. This tool is only mentioned and no extensive comparison with TRACER is made.</p><p>Software issues:</p><p>In evaluating the package (on a machine with Linux Mint 20 Cinnamon, version 4.6.7. Linux Kernel, 5.4.0-89-generic), there were issues with getting the atlas to load. It was an issue with an xcf library, so perhaps this is very specific to this setup, but perhaps is worth noting that some Linux users may have a similar issue.</p><p>More generally, there were issues with getting the latest atlas (v4) to work. An error was received that the process was &quot;Killed&quot; and then a message stating that the atlas v3 couldn't be found. Downloading atlas v3 resolved the issue.</p><p>It would be useful to know if this software allow for localization of microelectrode arrays? The paper states that TRACER can place trajectory of 6 probes for prediction or reconstruction, so does this mean it can only be used for single point trajectories (such as those from single shank electrodes, fiber optic cannula, or a drug infusion cannula)? A statement should be included about the utility of TRACER for array probes. (If it is not capable of mapping arrays, perhaps this is a modification to consider for the future).</p><p>The text in Figure 5 as a bit small and maybe the axis labels could also be shortened and bounding boxes removed.</p><p>Potential issue with tissue processing:</p><p>How was shrinkage dealt with in processing the brain tissue? Was any estimate done? This might matter for the specific experiment reported in the manuscript, which involved staining with several antibodies. This could also be a major issue for users, especially in cases where histochemical or immunohistochemical stains might be combined in a study.</p><p><italic>Reviewer #2 (Recommendations for the authors):</italic></p><p>Strengths</p><p>– The tool and user manual both appear excellent. The authors have put a lot of effort into making this tool.</p><p>– Prior tools were focused on mice, while this one is optimized for rat histology.</p><p>– The &quot;surgery planning&quot; aspects were interesting and very useful, particularly for deciding how many recording sites would end up in various brain regions with different insertion angles, etc.</p><p>Weaknesses</p><p>– There were files from the Waxholm Space rat brain atlas that needed to be downloaded. I clicked on the provided link but it wasn't clear how to find the relevant files, they appear to come from multiple different releases. Unless it violates licensing, can these be automatically included in TRACER? Extra steps like this can confuse and trip up new users (like me!), and potentially create obsolete instructions if the external links change their organization or content.</p><p>– The authors correctly note that installing and running TRACER requires some knowledge of Python and the command line. I see this as the biggest weakness of the package. They say they are working on a stand-alone GUI to run it, but in the meantime I suggest they develop instructional videos to talk a new user through a standard installation and example case.</p><p>– Both myself and a grad student in our lab tried to install the tool but ultimately failed to do so. We are moderately experienced with Python and we worked through some errors and felt like we were getting closer, but after ~3 hours we finally gave up. While I'm sure the fault is on our end to some degree, we were motivated to test the tool out and we are experienced in Python but we could not get it installed on our system. I suggest the author's β test the tool with novice users with no instruction other than what is on the Github, and see if they can discover any pain points in the installation process. I believe this is addressable, but is a critical weakness of the tool as it currently stands.</p><p>Suggestions for improving the user experience</p><p>– Strongly encourage the authors to upload the package to Pypi or conda package repository. This will make the installation of the dependencies and the package itself much easier.</p><p>– At the bare minimum, instructions should be expanded and clarified starting from the creation of the environment. If the terminal will be used anyway for installing the dependencies, it is much easier to create the environment using the Anaconda prompt from scratch.</p><p>– Downloading packages from Github can be confusing for people who are not experienced with this. Where the instructions say they need &quot;TRACER package downloaded on your local computer…&quot; I think the user manual should explicitly walk them through each step – What does a user do when they're looking at the Github page? Click download as Zip? Does it matter where this is saved? Should this be unzipped? Getting tripped up on these early steps can be deal breakers for new users.</p><p>– In the user manual, some screenshots would be helpful to orient the user, instead of things like &quot;open the terminal by clicking the arrow near the name of your environment&quot;.</p><p>– After downloading the zip file from Github and extracting the package, the name of the folder is TRACER_main (or TRACER_master) and not just TRACER. So when trying to run it on Spyder (or wherever), it doesn't find the module.</p><p>– To run the package, the working directory has to be inside the first TRACER_main folder, since there is another TRACER_main folder inside the first. This tripped us up for a while.</p><p>Reviewer #3 (Recommendations for the authors):</p><p>The authors propose here a new open-source, python-based toolkit to reconstruct the trajectories of recording electrodes in the rat brain. Other possible applications include to visualize virus spread or to provide candidates stereotaxic coordinates before starting a surgery. At first glance, the tool is promising and may effectively fill a gap as many existing tools have been designed for mice primarily although rats continue to be highly relevant for behavioral studies. Installing and using the tool is not trivial for users with no Python experience though and the added value by comparison with other tools recently developed is unclear as detailed below.</p><p>Installing/running TRACER</p><p>The authors acknowledge in the short discussion that using TRACER may be challenging for users with no experience in Python-based environments. I can concur with that comment. I have asked a few trainees in the lab (with no coding experience) to try to install it and none of them was able to go through the entire process alone. So I think getting a GUI as stand-alone is really needed to impact on the field. Otherwise it is hard to appreciate why this could be more useful than any other tools. I would really encourage the authors to develop this GUI early on rather than only suggesting it's a possible future direction.</p><p>Added value versus other existing tools</p><p>Earlier this year, another paper was published at <italic>eLife</italic> documenting Brainrender, which is potentially suitable across species, including rats (Claudi et al., 2021). There are multiple other resources that are also available. I think a greater effort to explain how the present tool is positioned by respect with these other options is needed. This is very important for the field; while we can appreciate the value of having diverse tools to rely on, there is also some merit in adopting standards and splitting the community around multiple tools may not be beneficial in the long run. I think a much more thorough discussion is needed to present the PROs and CONs of TRACER versus Brainrender and other tools.</p><p>To address my general comments, I think the authors should really answer the following question: Considering that Brainrender is available in multiple species, what is the added value of TRACER?</p><p>I do not intend at all to minimize the work produced by the authors, I just want to make my point clearer from the end-user viewpoint: as many potentially equivalent tools exist, why choosing a specific one over the others?</p><p>[Editors’ note: further revisions were suggested prior to acceptance, as described below.]</p><p>Thank you for resubmitting your work entitled &quot;HERBS: Histological E-data Registration in rodent Brain Spaces&quot; for further consideration by <italic>eLife</italic>. Your revised article has been evaluated by Laura Colgin (Senior Editor) and a Reviewing Editor.</p><p>The manuscript has been improved but there are some remaining issues that need to be addressed, as outlined below:</p><p>All reviewers recognized the value of HERB to process brain histology data and think it could be particularly useful for people working with rats, for which very little tools are currently available. The reviewers also identified a number of points that, if adequately addressed, may considerably improve the impact of HERB for the field. The authors are encouraged to implement these points or at least to provide a thorough discussion on their will and ability to carry further developments of the software in the future.</p><p>1) There is a need for clearer plans for long term sustainability of the software following future releases of Python. The authors should indicate with more details if they have the manpower necessary to ensure the maintenance of all packages in the long run, and possibly to implement further features (see other points below)</p><p>2) Being able to incorporate other brain atlases and other packages (e.g. CellFinder) would enhance its value and the potential for HERB to be widely adopted.</p><p>3) Viral reconstruction could benefit from a more quantitative assessment: since the user is provided with a list of brain structures affected by the viral spread, it would be incredibly helpful to provide the volume estimates (or %) affected for each of these brain regions.</p><p>4) Automatic registration of sections is not available, and therefore requires extensive manual work to use the software. Perhaps the authors have plans to improve on this front.</p><p><italic>Reviewer #2 (Recommendations for the authors):</italic></p><p>We gave HERBS some testing in the team and we found that it could really be very helpful for many researchers.</p><p>One potential caveat will be to ensure that maintenance of the main packages is being covered as new versions of Python are being developed. Recommending older Python versions for HERB may not be a realistic option in the long run as this is currently suggested in the Cooking book (which currently do not point on the right page for Python 3.9.9 – p.10, section 3.4.2).</p><p>We do have a major suggestion for viral spread reconstruction as we think this particular option may be particularly useful. Since the user is provided with a list of brain structures affected by the viral spread, it would be incredibly helpful to provide the volume estimates (or %) affected for each of these brain regions. This would thus open the way for relatively unbiased quantitative analyses (specificity of viral spread, but also lesions, or any infusion). This is much needed in the field to encourage researchers to better report histology data and I strongly believe it will really make HERB reaching another level.</p><p><italic>Reviewer #3 (Recommendations for the authors):</italic></p><p>It would be useful to specify whether this toolkit covers the following features, and if so, how?</p><p>– Designing multi-area implants: does the first section (generating surgical coordinates) include the possibility to design multi-probe implants that could target different brain areas? this can be a great value to those who'd like prototype headstages for targeting multiple areas.</p><p>– Adaptable to other atlases: is it possible to upload brain atlas for similar animals (e.g. naked mole rats or tree shrews)? How about other available rat brain atlases?</p><p>– Integrating other available packages: it would be great if one could easily integrate e.g. CellFinder with HERBS.</p></body></sub-article><sub-article article-type="reply" id="sa2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.83496.sa2</article-id><title-group><article-title>Author response</article-title></title-group></front-stub><body><p>[Editors’ note: the authors resubmitted a revised version of the paper for consideration. What follows is the authors’ response to the first round of review.]</p><disp-quote content-type="editor-comment"><p>Reviewer #1 (Recommendations for the authors):</p><p>General comments:</p><p>It seems like a lot of work to go through all sections and match to the digital atlas. Incorporating matching between pre-processed images and reference sections seems crucial for widespread use of the tool. If this is something that cannot be done in short order, a widespread use of the tool may be limited.</p></disp-quote><p>We agree that automatic template matching would be an extremely convenient functionality to include. We explored this possibility but found that it will require substantial development of machine vision algorithms to automatically match input images to a template. It is a difficult computer vision problem for several reasons, including (i) that histological input images can be stained in various ways which differ qualitatively from atlas images; (ii) the input and atlas images can be of different resolutions; (iii) input images can be slightly out of plane relative to the atlas. After extensive use of the tool, we find that users are likely the best judges of a match between input tissue and the atlas template. Automatic registration is a longer-term goal but one which we are not able to include in this version of the software.</p><disp-quote content-type="editor-comment"><p>More extensive comments should be made about Brainrender, which was published in eLife in March 2021. This tool is only mentioned and no extensive comparison with TRACER is made.</p></disp-quote><p>The new manuscript now describes <italic>Brainrender</italic> more fully in the Introduction (3<sup>rd</sup> paragraph) and in the Discussion (3<sup>rd</sup> paragraph), where we describe the main features which distinguish HERBS from <italic>Brainrender</italic>. This is part of a larger section in the Discussion, “Novelty and utility of HERBS in relation to other tool kits”, in which we discuss HERBS in relation to the other anatomical software released in recent years. As noted above, the primary difference between HERBS and <italic>Brainrender</italic> is that HERBS provides the core function of registering histological images back to a reference atlas, which gives reconstructions anatomical coordinates, in millimetres, relative to Bregma and the brain surface. <italic>Brainrender</italic> provides beautiful visualizations, but it cannot be used to register anatomical data, which is done in a separate step with separate software and plugins. This brings up another major difference, HERBS was designed to be self-sufficient—the GUI can be used to download and load its own source atlases, as well as register and visualize anatomical data without additional software programs.</p><disp-quote content-type="editor-comment"><p>Software issues:</p><p>In evaluating the package (on a machine with Linux Mint 20 Cinnamon, version 4.6.7. Linux Kernel, 5.4.0-89-generic), there were issues with getting the atlas to load. It was an issue with an xcf library, so perhaps this is very specific to this setup, but perhaps is worth noting that some Linux users may have a similar issue.</p></disp-quote><p>We thank the Reviewer for pointing out this difficulty in Linux. We have refined the packaging of the Atlas and have been able to load it on Linux systems (Kubuntu and Ubuntu 18.04) subsequently. We hope this resolves the issue.</p><disp-quote content-type="editor-comment"><p>More generally, there were issues with getting the latest atlas (v4) to work. An error was received that the process was &quot;Killed&quot; and then a message stating that the atlas v3 couldn't be found. Downloading atlas v3 resolved the issue.</p></disp-quote><p>We have revamped the atlas downloading procedure by having a copy of the Waxholm Space Atlas (v4) ready for download from the GitHub repository. Both it and the Allen Mouse Brain Atlas can be downloaded in a click-button process when HERBS is installed. Details on how to do this are provided in the user manual (“HERBS Cookbook” Chapter 6.1) and the “ReadMe” tab on the GitHub page (https://github.com/Whitlock-Group/HERBS/tree/main/Tutorial).</p><disp-quote content-type="editor-comment"><p>It would be useful to know if this software allow for localization of microelectrode arrays? The paper states that TRACER can place trajectory of 6 probes for prediction or reconstruction, so does this mean it can only be used for single point trajectories (such as those from single shank electrodes, fiber optic cannula, or a drug infusion cannula)? A statement should be included about the utility of TRACER for array probes. (If it is not capable of mapping arrays, perhaps this is a modification to consider for the future).</p></disp-quote><p>We are glad to report that HERBS, unlike TRACER, has no upper limit on the number of probes / trajectories it can reconstruct, so it is compatible with multi-electrode arrays and multi-tetrode drives. Each trajectory (electrode) still needs to be defined individually by clicking the start- and endpoints, but again there is no upper bound on how many times this can be done. We note this feature of HERBS in the Introduction (top paragraph on Page 2), and in the Results sections, “Generating pre-surgical coordinates” (page 4, paragraph 2), and “Reconstructing electrode tracks” (page 6, paragraph 1).</p><disp-quote content-type="editor-comment"><p>The text in Figure 5 as a bit small and maybe the axis labels could also be shortened and bounding boxes removed.</p></disp-quote><p>Figure 5 from the original draft has been removed from the current version of the paper.</p><disp-quote content-type="editor-comment"><p>Potential issue with tissue processing:</p><p>How was shrinkage dealt with in processing the brain tissue? Was any estimate done? This might matter for the specific experiment reported in the manuscript, which involved staining with several antibodies. This could also be a major issue for users, especially in cases where histochemical or immunohistochemical stains might be combined in a study.</p></disp-quote><p>This is an excellent question since tissue shrinkage is an inherent constraint when using any kind of tissue fixation, and it may be further compounded during immuno/histochemical staining protocols. While there is no way to regularize or remove shrinkage artifacts completely, our solution to deformation artifacts in HERBS is to include a “matching” step in which histological images are fit onto the reference atlas template. Specifically, HERBS uses triangulation-based piecewise affine transformation to locally warp the histological image to fit the template, based on key point the user defines with mouse-clicks. The warping and template matching methods are noted in the Introduction (2<sup>nd</sup> paragraph on page 2) and in Results section, “Reconstructing electrode tracks” (2<sup>nd</sup> paragraph on page 6). The stepwise process for matching is laid out in detail and with illustrations in the HERBS CookBook (Chapter 6.5).</p><disp-quote content-type="editor-comment"><p>Reviewer #2 (Recommendations for the authors):</p><p>Strengths</p><p>– The tool and user manual both appear excellent. The authors have put a lot of effort into making this tool.</p><p>– Prior tools were focused on mice, while this one is optimized for rat histology.</p><p>– The &quot;surgery planning&quot; aspects were interesting and very useful, particularly for deciding how many recording sites would end up in various brain regions with different insertion angles, etc.</p></disp-quote><p>We thank the Reviewer for their praise and are happy that the amount of effort that went into TRACER was apparent when it was reviewed. We are also glad to share that the new HERBS software now works for both rats and mice, and we note that the surgery planning functionalities are included in the present tool kit as well.</p><disp-quote content-type="editor-comment"><p>Weaknesses</p><p>– There were files from the Waxholm Space rat brain atlas that needed to be downloaded. I clicked on the provided link but it wasn't clear how to find the relevant files, they appear to come from multiple different releases. Unless it violates licensing, can these be automatically included in TRACER? Extra steps like this can confuse and trip up new users (like me!), and potentially create obsolete instructions if the external links change their organization or content.</p></disp-quote><p>We are sorry for the previous difficulty in locating and downloading the relevant files for the Waxholm Space rat brain atlas. We have revamped the atlas downloading procedure by including file links in HERBS so that either the Waxholm Space Rat Brain Atlas (v4) or the Allen Mouse Brain Atlas (Wang et al., <italic>Cell</italic>, 2020) can be downloaded in a click-button process after HERBS is installed. Details on how to do this are provided in the user manual (“HERBS Cookbook”, chapter 6.1) and the “Tutorial” tab on the GitHub page (https://github.com/Whitlock-Group/HERBS/tree/main/Tutorial).</p><disp-quote content-type="editor-comment"><p>– The authors correctly note that installing and running TRACER requires some knowledge of Python and the command line. I see this as the biggest weakness of the package. They say they are working on a stand-alone GUI to run it, but in the meantime I suggest they develop instructional videos to talk a new user through a standard installation and example case.</p></disp-quote><p>We have radically simplified the process of installing HERBS, in that it requires a single command (“pip install herbs”) in a Python terminal. However, this assumes the user is already running a current version of Python, and installation of Python can be challenging for someone who has never done so. To make the process easier, we include links to download the appropriate versions of Python (3.8.10 or 3.9.9) in Chapter 3 of the HERBS Cookbook, and in Chapter 4 we give instructions for installing HERBS from PyPI or GitHub. As for running HERBS, all functionalities are performed with mouse clicks and keystrokes and do not require extensive programming knowledge.</p><disp-quote content-type="editor-comment"><p>– Both myself and a grad student in our lab tried to install the tool but ultimately failed to do so. We are moderately experienced with Python and we worked through some errors and felt like we were getting closer, but after ~3 hours we finally gave up. While I'm sure the fault is on our end to some degree, we were motivated to test the tool out and we are experienced in Python but we could not get it installed on our system. I suggest the author's β test the tool with novice users with no instruction other than what is on the Github, and see if they can discover any pain points in the installation process. I believe this is addressable, but is a critical weakness of the tool as it currently stands.</p></disp-quote><p>We again apologize for the difficulty in installing and running TRACER and are very sorry for costing the Reviewer’s and trainee’s time. To avoid this happening with HERBS, we have had multiple β testers vet the downloading and installation process on their own per the written instructions provided in the Cookbook.</p><disp-quote content-type="editor-comment"><p>Suggestions for improving the user experience</p><p>– Strongly encourage the authors to upload the package to Pypi or conda package repository. This will make the installation of the dependencies and the package itself much easier.</p></disp-quote><p>This is an excellent suggestion, and we are happy to share that HERBS has been uploaded to PyPI: https://pypi.org/project/herbs/</p><disp-quote content-type="editor-comment"><p>– At the bare minimum, instructions should be expanded and clarified starting from the creation of the environment. If the terminal will be used anyway for installing the dependencies, it is much easier to create the environment using the Anaconda prompt from scratch.</p></disp-quote><p>We understand and apologize for the prior lack of clear instructions. We sought to address this issue with additional installation instructions in the HERBS Cookbook, Chapter 4. All useful links for the installation of anaconda and Conda environments have been included in this section. We believe we have solved the installation of dependencies in making HERBS a PyPI package.</p><disp-quote content-type="editor-comment"><p>– Downloading packages from Github can be confusing for people who are not experienced with this. Where the instructions say they need &quot;TRACER package downloaded on your local computer…&quot; I think the user manual should explicitly walk them through each step – What does a user do when they're looking at the Github page? Click download as Zip? Does it matter where this is saved? Should this be unzipped? Getting tripped up on these early steps can be deal breakers for new users.</p></disp-quote><p>We thank the reviewer for pointing out these pitfalls for new users. We have radically simplified the process of installing HERBS by uploading it to PyPI, and by including instructions on downloading HERBS from GitHub, both on the ReadMe page and in the HERBS cookbook. Specifically, Chapter 3 of the Cookbook includes links to download the appropriate versions of Python (3.8.10 or 3.9.9), and Chapter 4 includes basic installation instructions for HERBS (which are single commands) from PyPI and GitHub.</p><disp-quote content-type="editor-comment"><p>– In the user manual, some screenshots would be helpful to orient the user, instead of things like &quot;open the terminal by clicking the arrow near the name of your environment&quot;.</p></disp-quote><p>We thank the Reviewer for this helpful suggestion and again apologize for the difficulties with the user manual for TRACER. Accordingly, the HERBS Cookbook contains numerous screenshots and directions for every step of the core functionalities of the software (the “HERBS recipes” in Chapter 6). We sincerely hope for a better user experience with the HERBS Cookbook.</p><disp-quote content-type="editor-comment"><p>– After downloading the zip file from Github and extracting the package, the name of the folder is TRACER_main (or TRACER_master) and not just TRACER. So when trying to run it on Spyder (or wherever), it doesn't find the module.</p></disp-quote><p>We are very sorry for the difficulties faced for the installation of the TRACER software.</p><p>We have sought to solve installation-related technical issues by making HERBS a PyPI package which can be installed in the terminal or a Python IDE with a simple line. Chapter 4 of the CookBook includes these instructions on the installation process.</p><disp-quote content-type="editor-comment"><p>– To run the package, the working directory has to be inside the first TRACER_main folder, since there is another TRACER_main folder inside the first. This tripped us up for a while.</p></disp-quote><p>The new installation process for HERBS solves this issue as well.</p><disp-quote content-type="editor-comment"><p>Reviewer #3 (Recommendations for the authors):</p><p>The authors propose here a new open-source, python-based toolkit to reconstruct the trajectories of recording electrodes in the rat brain. Other possible applications include to visualize virus spread or to provide candidates stereotaxic coordinates before starting a surgery. At first glance, the tool is promising and may effectively fill a gap as many existing tools have been designed for mice primarily although rats continue to be highly relevant for behavioral studies. Installing and using the tool is not trivial for users with no Python experience though and the added value by comparison with other tools recently developed is unclear as detailed below.</p></disp-quote><p>We thank the Reviewer for taking the time to evaluate and give feedback on the previous submission and TRACER tool kit. Based on the difficulties reported in downloading and operating TRACER in Python, we have re-vamped the tool to work as a click-button GUI, and only one command line in Python is required for the initial installation. Beyond that, the functionalities of HERBS are driven with a mouse and keyboard following detailed instructions, with illustrations, in the Cookbook. We also discuss in more detail how HERBS compares against and differs from other software released in recent years, and have included a new Supplementary Table comparing functionalities of the different tool kits.</p><disp-quote content-type="editor-comment"><p>Installing/running TRACER</p><p>The authors acknowledge in the short discussion that using TRACER may be challenging for users with no experience in Python-based environments. I can concur with that comment. I have asked a few trainees in the lab (with no coding experience) to try to install it and none of them was able to go through the entire process alone. So I think getting a GUI as stand-alone is really needed to impact on the field. Otherwise it is hard to appreciate why this could be more useful than any other tools. I would really encourage the authors to develop this GUI early on rather than only suggesting it's a possible future direction.</p></disp-quote><p>We apologize for difficulties the Reviewer and their trainees encountered in downloading and using TRACER previously, and we thank them for their time and effort. These and similar sentiments from the other Reviewers prompted us to produce the new HERBS GUI in the current paper, which we hope is far simpler to sue. We could not remove usage of Python from the process completely, but once the tool is installed and running it requires no further programming or command windows. We hope the tool in its current form gives a better experience and will reach a wider user base.</p><disp-quote content-type="editor-comment"><p>Added value versus other existing tools</p><p>Earlier this year, another paper was published at eLife documenting Brainrender, which is potentially suitable across species, including rats (Claudi et al., 2021). There are multiple other resources that are also available. I think a greater effort to explain how the present tool is positioned by respect with these other options is needed. This is very important for the field; while we can appreciate the value of having diverse tools to rely on, there is also some merit in adopting standards and splitting the community around multiple tools may not be beneficial in the long run. I think a much more thorough discussion is needed to present the PROs and CONs of TRACER versus Brainrender and other tools.</p></disp-quote><p>We fully agree that it is important for the paper to clearly state what functionalities HERBS and other software offers, and what differentiates HERBS from the tools already out there. This can be found in a new section in the Discussion entitled “Novelty and utility of HERBS in relation to other tool kits”. As noted at the beginning of the Rebuttal, we feel the key distinguishing points are (i) the diversity of functionalities it offers (pre- and post-surgical), (ii) the simplistic, click-button interface of the GUI, and (iii) that the relevant mouse or rat reference atlases can be downloaded from a drop-down menu in the GUI—so it does not require other software. Moreover, it works with nearly any type of slice histology or staining method. These and other details are listed in the new Supplementary Table in the revised manuscript. We hope the HERBS GUI will be of service to those with little to no coding experience.</p><disp-quote content-type="editor-comment"><p>To address my general comments, I think the authors should really answer the following question: Considering that Brainrender is available in multiple species, what is the added value of TRACER?</p></disp-quote><p>We can absolutely appreciate this question, not only with respect to <italic>Brainrender</italic>, but other tools released in the last year. As noted above in the Rebuttal, <italic>Brainrender</italic> is an outstanding visualization resource, but it cannot on its own perform anatomical registration to a reference atlas. This must be done with separate software and plugins, which requires knowledge of programming that a proportion of would-be users may lack. HERBS, on the other hand, was conceived as a registration software that comes with its primary reference atlases in tow, so it fulfills a complementary role to <italic>Brainrender’s</italic> visualization functions. We also included some 2D and 3D visualization functions in HERBS to reduce the need for added software and steps, but we do not include animations like <italic>Brainrender</italic>.</p><disp-quote content-type="editor-comment"><p>I do not intend at all to minimize the work produced by the authors, I just want to make my point clearer from the end-user viewpoint: as many potentially equivalent tools exist, why choosing a specific one over the others?</p></disp-quote><p>We thank the Reviewer for considering our effort and agree it is important to clarify which tools do what, and how the present tool kit is different. We hope the revised manuscript does this more effectively than before. After the original TRACER manuscript was reviewed and rejected, we took the Reviewer's input seriously and sought to generate a radically simpler tool that minimizes user effort. Our main objective with HERBS was to make a tool that we would want to use in our own lab to expedite the time-consuming process of anatomical registration, especially across subjects.</p><disp-quote content-type="editor-comment"><p>[Editors’ note: what follows is the authors’ response to the second round of review.]</p><p>The manuscript has been improved but there are some remaining issues that need to be addressed, as outlined below:</p><p>All reviewers recognized the value of HERB to process brain histology data and think it could be particularly useful for people working with rats, for which very little tools are currently available. The reviewers also identified a number of points that, if adequately addressed, may considerably improve the impact of HERB for the field. The authors are encouraged to implement these points or at least to provide a thorough discussion on their will and ability to carry further developments of the software in the future.</p><p>1) There is a need for clearer plans for long term sustainability of the software following future releases of Python. The authors should indicate with more details if they have the manpower necessary to ensure the maintenance of all packages in the long run, and possibly to implement further features (see other points below)</p></disp-quote><p>The creator of HERBS, Jingyi Guo Fuglstad, has and will continue to actively respond to technical queries posted on the HERBS GitHub page. The co-first author, Pearl Saldanha, will regularly check for updates on dependencies and new versions of Python. HERBS and the CookBook will be duly updated after major updates in Python are released.</p><p>So far, in response to GitHub requests and discussions, several new features have already been implemented, including compatibility with different kinds of linear silicon probes (the geometry and site layout of which the user can define), unmerging of object layers, as well as other functions described below.</p><disp-quote content-type="editor-comment"><p>2) Being able to incorporate other brain atlases and other packages (e.g. CellFinder) would enhance its value and the potential for HERB to be widely adopted.</p></disp-quote><p>We agree that compatibility with other brain atlases would enhance the utility of HERBS for a broader user base. As detailed below in response to Reviewer 3, HERBS is now compatible with any brain atlas, so long as the user can provide the appropriate volume files, segmentation files, and label information. HERBS can also use Mask files if they are included with a given atlas (e.g. the Waxholm Space Atlas). Illustrated instructions on how to upload and process other atlases can be found on the HERBS GitHub Tutorial sub-paged (https://github.com/Whitlock-Group/HERBS/blob/main/Tutorial/upload_and_process_user_defined_atlases.md). This link is noted and included in subsection 6.1.3 of the HERBS CookBook, and the added functionality is stated in the Abstract and on lines 79-82 of the General Outline section in the Results.</p><p>As further requested, we made it possible to load cell point data generated from CellFinder, and to visualize those data in 3D brain volumes according to whichever atlas the user has installed. Instructions on how to do this can be found on the HERBS GitHub sub-page (https://github.com/Whitlock-Group/HERBS/blob/main/Tutorial/External_Related/upload_external_cell_points.md), and can be found in the 6.8.3 sub-section of the CookBook. This is also noted in the manuscript on lines 161-165 of the “Reconstruction of viral expression” sub-section in the Results.</p><disp-quote content-type="editor-comment"><p>3) Viral reconstruction could benefit from a more quantitative assessment: since the user is provided with a list of brain structures affected by the viral spread, it would be incredibly helpful to provide the volume estimates (or %) affected for each of these brain regions.</p></disp-quote><p>We agree this would be highly beneficial for users wishing to have an unbiased estimate of viral spread in affected brain areas. Accordingly, we have updated the viral reconstruction functionality to include the volume (in voxels) of virus expressed in each brain region, as well as the estimated proportion of that brain region expressing the virus. We note that this applies the same for any kind of tissue labeling or lesions in a region of interest.</p><p>The newest version of HERBS generates these estimates automatically for viral expression analyses, and an example of the updated output is shown in the revised Figure 4D in the manuscript (new columns in the readout are for “Volume (stk voxel)” and “Proportion (%)” of each area containing viral expression or labeling).</p><disp-quote content-type="editor-comment"><p>4) Automatic registration of sections is not available, and therefore requires extensive manual work to use the software. Perhaps the authors have plans to improve on this front.</p></disp-quote><p>We acknowledge that it would great to add automated registration and that it would expedite the workflow in HERBS. However, adding automatic slice registration is a very large request, since doing so properly would require the development of sufficiently robust machine vision algorithms that can handle variable histological input. We respectfully suggest that developing such algorithms falls outside the scope of the current version of HERBS, which we feel nevertheless brings considerable added value to users wishing register histological slices in rodents or other species. Automated registration is part of our long-term strategy for HERBS, and this is noted in lines 218-220 of the revised manuscript.</p><disp-quote content-type="editor-comment"><p>Reviewer #2 (Recommendations for the authors):</p><p>We gave HERBS some testing in the team and we found that it could really be very helpful for many researchers.</p><p>One potential caveat will be to ensure that maintenance of the main packages is being covered as new versions of Python are being developed. Recommending older Python versions for HERB may not be a realistic option in the long run as this is currently suggested in the Cooking book (which currently do not point on the right page for Python 3.9.9 – p.10, section 3.4.2).</p></disp-quote><p>Please see our response to this same query in Point (1).</p><disp-quote content-type="editor-comment"><p>We do have a major suggestion for viral spread reconstruction as we think this particular option may be particularly useful. Since the user is provided with a list of brain structures affected by the viral spread, it would be incredibly helpful to provide the volume estimates (or %) affected for each of these brain regions. This would thus open the way for relatively unbiased quantitative analyses (specificity of viral spread, but also lesions, or any infusion). This is much needed in the field to encourage researchers to better report histology data and I strongly believe it will really make HERB reaching another level.</p></disp-quote><p>Please see our response to this same query in Point (3).</p><disp-quote content-type="editor-comment"><p>Reviewer #3 (Recommendations for the authors):</p><p>It would be useful to specify whether this toolkit covers the following features, and if so, how?</p><p>– Designing multi-area implants: does the first section (generating surgical coordinates) include the possibility to design multi-probe implants that could target different brain areas? this can be a great value to those who'd like prototype headstages for targeting multiple areas.</p></disp-quote><p>We have added this feature in the newest version of HERBS—to accommodate users wishing to target multiple brain areas with a custom-developed multi-probe implant. The user can specify the geometry of the probe following the steps in the illustrated tutorial provided on the GitHub sub-page ( https://github.com/Whitlock-Group/HERBS/blob/main/Tutorial/Probe_Related/5-Design_multi_shanks_Probes.md.)</p><p>In addition, the user can define the geometry and site layout on individual probes following a separate illustrated tutorial on the GitHub sub-page linked here. This functionality is noted in the manuscript on lines 113-116, and all probe-related instructions and links to tutorials can be found in the section 6.6 of the CookBook.</p><disp-quote content-type="editor-comment"><p>– Adaptable to other atlases: is it possible to upload brain atlas for similar animals (e.g. naked mole rats or tree shrews)? How about other available rat brain atlases?</p></disp-quote><p>We have added a new feature by which users can upload and use any volume atlas—as long the volume atlas data file (i.e. scanned or imaged brain volume data, such as MRI scans) and the attendant segmentation and label files are provided. Some atlases also include mask files (e.g. the Waxholm Space Atlas), which HERBS can also use.</p><p>This functionality is noted in the revised Abstract, and illustrated instructions on how upload and process other atlases can be found on the HERBS GitHub sub-paged linked here. The update and relevant tutorials are noted in subsection 6.1.3 in the Herbs CookBook.</p><disp-quote content-type="editor-comment"><p>– Integrating other available packages: it would be great if one could easily integrate e.g. CellFinder with HERBS.</p></disp-quote><p>We have now made it possible to load cell point data generated from CellFinder, and to visualize those data in 3D brain volumes according to whichever atlas the user has installed. Instructions on how to do this can be found on the HERBS GitHub sub-paged linked here. The link to this tutorial is available in sub-section 6.8.3 of the CookBook, and the added CellFinder functionality is noted in lines 161-165 of the “Reconstruction of viral expression” sub-section of the Results.</p></body></sub-article></article>