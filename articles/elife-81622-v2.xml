<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD with MathML3 v1.2 20190208//EN"  "JATS-archivearticle1-mathml3.dtd"><article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.2"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn publication-format="electronic" pub-type="epub">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">81622</article-id><article-id pub-id-type="doi">10.7554/eLife.81622</article-id><article-categories><subj-group subj-group-type="display-channel"><subject>Research Article</subject></subj-group><subj-group subj-group-type="heading"><subject>Immunology and Inflammation</subject></subj-group><subj-group subj-group-type="heading"><subject>Physics of Living Systems</subject></subj-group></article-categories><title-group><article-title>Quantifying changes in the T cell receptor repertoire during thymic development</article-title></title-group><contrib-group><contrib contrib-type="author" equal-contrib="yes" id="author-285794"><name><surname>Camaglia</surname><given-names>Francesco</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-4810-2631</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="equal-contrib1">†</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" equal-contrib="yes" id="author-285795"><name><surname>Ryvkin</surname><given-names>Arie</given-names></name><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="equal-contrib1">†</xref><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-91028"><name><surname>Greenstein</surname><given-names>Erez</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-6923-8469</contrib-id><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="con3"/><xref ref-type="fn" rid="conf2"/></contrib><contrib contrib-type="author" id="author-57919"><name><surname>Reich-Zeliger</surname><given-names>Shlomit</given-names></name><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="con4"/><xref ref-type="fn" rid="conf2"/></contrib><contrib contrib-type="author" id="author-53601"><name><surname>Chain</surname><given-names>Benny</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-7417-3970</contrib-id><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="fn" rid="con5"/><xref ref-type="fn" rid="conf2"/></contrib><contrib contrib-type="author" corresp="yes" equal-contrib="yes" id="author-300161"><name><surname>Mora</surname><given-names>Thierry</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-5456-9361</contrib-id><email>thierry.mora@phys.ens.fr</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="equal-contrib2">‡</xref><xref ref-type="other" rid="fund3"/><xref ref-type="fn" rid="con6"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" corresp="yes" equal-contrib="yes" id="author-50904"><name><surname>Walczak</surname><given-names>Aleksandra M</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-2686-5702</contrib-id><email>aleksandra.walczak@phys.ens.fr</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="equal-contrib2">‡</xref><xref ref-type="other" rid="fund2"/><xref ref-type="fn" rid="con7"/><xref ref-type="fn" rid="conf3"/></contrib><contrib contrib-type="author" equal-contrib="yes" id="author-174734" deceased="yes"><name><surname>Friedman</surname><given-names>Nir</given-names></name><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="equal-contrib2">‡</xref><xref ref-type="fn" rid="fn1"/><xref ref-type="fn" rid="con8"/><xref ref-type="fn" rid="conf1"/></contrib><aff id="aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/02feahw73</institution-id><institution>Laboratoire de physique de l’École normale supérieure, CNRS, PSL University, Sorbonne Université, and Université de Paris</institution></institution-wrap><addr-line><named-content content-type="city">Paris</named-content></addr-line><country>France</country></aff><aff id="aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/0316ej306</institution-id><institution>Department of Immunology, Weizmann Institute of Science</institution></institution-wrap><addr-line><named-content content-type="city">Rehovot</named-content></addr-line><country>Israel</country></aff><aff id="aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/02jx3x895</institution-id><institution>Division of Infection and Immunity, University College London</institution></institution-wrap><addr-line><named-content content-type="city">London</named-content></addr-line><country>United Kingdom</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Graw</surname><given-names>Frederik</given-names></name><role>Reviewing Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/038t36y30</institution-id><institution>Heidelberg University</institution></institution-wrap><country>Germany</country></aff></contrib><contrib contrib-type="senior_editor"><name><surname>Taniguchi</surname><given-names>Tadatsugu</given-names></name><role>Senior Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/057zh3y96</institution-id><institution>University of Tokyo</institution></institution-wrap><country>Japan</country></aff></contrib></contrib-group><author-notes><fn fn-type="con" id="equal-contrib1"><label>†</label><p>These authors contributed equally to this work</p></fn><fn fn-type="con" id="equal-contrib2"><label>‡</label><p>These authors also contributed equally to this work</p></fn><fn fn-type="fn" id="fn1"><label>§</label><p>Deceased</p></fn></author-notes><pub-date publication-format="electronic" date-type="publication"><day>20</day><month>01</month><year>2023</year></pub-date><pub-date pub-type="collection"><year>2023</year></pub-date><volume>12</volume><elocation-id>e81622</elocation-id><history><date date-type="received" iso-8601-date="2022-07-05"><day>05</day><month>07</month><year>2022</year></date><date date-type="accepted" iso-8601-date="2023-01-18"><day>18</day><month>01</month><year>2023</year></date></history><pub-history><event><event-desc>This manuscript was published as a preprint at .</event-desc><date date-type="preprint" iso-8601-date="2022-02-15"><day>15</day><month>02</month><year>2022</year></date><self-uri content-type="preprint" xlink:href="https://doi.org/10.1101/2022.02.14.480309"/></event></pub-history><permissions><copyright-statement>© 2023, Camaglia, Ryvkin et al</copyright-statement><copyright-year>2023</copyright-year><copyright-holder>Camaglia, Ryvkin et al</copyright-holder><ali:free_to_read/><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><ali:license_ref>http://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-81622-v2.pdf"/><self-uri content-type="figures-pdf" xlink:href="elife-81622-figures-v2.pdf"/><abstract><p>One of the feats of adaptive immunity is its ability to recognize foreign pathogens while sparing the self. During maturation in the thymus, T cells are selected through the binding properties of their antigen-specific T-cell receptor (TCR), through the elimination of both weakly (positive selection) and strongly (negative selection) self-reactive receptors. However, the impact of thymic selection on the TCR repertoire is poorly understood. Here, we use transgenic Nur77-mice expressing a T-cell activation reporter to study the repertoires of thymic T cells at various stages of their development, including cells that do not pass selection. We combine high-throughput repertoire sequencing with statistical inference techniques to characterize the selection of the TCR in these distinct subsets. We find small but significant differences in the TCR repertoire parameters between the maturation stages, which recapitulate known differentiation pathways leading to the CD4<sup>+</sup> and CD8<sup>+</sup> subtypes. These differences can be simulated by simple models of selection acting linearly on the sequence features. We find no evidence of specific sequences or sequence motifs or features that are suppressed by negative selection. These results favour a collective or statistical model for T-cell self non-self discrimination, where negative selection biases the repertoire away from self recognition, rather than ensuring lack of self-reactivity at the single-cell level.</p></abstract><kwd-group kwd-group-type="author-keywords"><kwd>thymic selection</kwd><kwd>immune repertoires</kwd><kwd>statistical analysis</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research organism</title><kwd>Mouse</kwd></kwd-group><funding-group><award-group id="fund1"><funding-source><institution-wrap><institution>CNRS-Weizmann</institution></institution-wrap></funding-source><award-id>80 prime</award-id><principal-award-recipient><name><surname>Camaglia</surname><given-names>Francesco</given-names></name></principal-award-recipient></award-group><award-group id="fund2"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000781</institution-id><institution>European Research Council</institution></institution-wrap></funding-source><award-id>COG 724208</award-id><principal-award-recipient><name><surname>Walczak</surname><given-names>Aleksandra M</given-names></name></principal-award-recipient></award-group><award-group id="fund3"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100001665</institution-id><institution>Agence Nationale de la Recherche</institution></institution-wrap></funding-source><award-id>ANR-19-CE45-0018</award-id><principal-award-recipient><name><surname>Mora</surname><given-names>Thierry</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>Sequence signatures can be used to discriminate between selected and non-selected immune repertoires at different stages only at the collective population level but not at the level of single cells.</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>In order to protect themselves against infection, jawed vertebrates have evolved an adaptive immune system. T lymphocytes play a leading role in this system. Each T lymphocyte expresses a unique T-cell receptor (TCR) capable of binding short protein fragments presented by the host’s Major Histocompatibility Complexes (MHC), subsequently triggering clonal expansion and differentiation of immune effector function. The T cell system discriminates pathogen derived ‘foreign’ proteins from the body’s own ‘self’ proteins, in such a way that an immune response is usually triggered only by peptides from exposure to a potentially harmful threat. We ask if we can identify specific TCR features which allow the system to discriminate foreign and self-peptides.</p><p>TCRs are generated in a stochastic assembly process based on random recombinations of genomic templates and additional non-templated insertions and deletions (<xref ref-type="bibr" rid="bib18">Hozumi and Tonegawa, 1976</xref>). The ability to discriminate between self and non-self targets cannot therefore be exclusively inherited, but must at least in part be learned afresh in each individual. This process is widely believed to occur during the development of haemopoetic precursors into mature T cells, which occurs in a specialized microenvironment within the thymus. This process has been studied in considerable detail. T cells precursors first produce a β chain and if the generated chain is functional, the cell proliferates and an α chain is generated. While the TCR chains are being assembled, CD4 and CD8 surface markers are expressed as precursor cells transit to the Double Positive state (DP). DP TCR are subject to thymic selection, a process that tests receptor binding by presenting them with the organism’s own proteins, and eliminates very weak binders (positive selection), but also too strongly self-reactive receptors (negative selection) (<xref ref-type="bibr" rid="bib50">Yates, 2014</xref>). During thymic selection, DP cells differentiate into CD4<sup>+</sup> or CD8<sup>+</sup> cells by keeping expression of only one of these molecules, which determines their function. While this picture is well-established and the maturation trajectory has a well established gene expression signature (<xref ref-type="bibr" rid="bib37">Park et al., 2020</xref>), the TCR sequences removed during thymic selection, which should be manifested as ‘holes’ in the repertoire, have never been directly observed. The lack of quantifiable signatures of thymic selection, differentiation and proliferation hinders a dynamic description of TCR maturation (<xref ref-type="bibr" rid="bib39">Robert et al., 2021</xref>).</p><p>Positive and negative selection imposes upper and lower boundaries on the binding energy of the interaction between TCR and self peptide-MHC complexes (<xref ref-type="bibr" rid="bib22">Kosmrlj et al., 2009</xref>). However, it remains unclear whether every thymocite is exposed to every self-antigen, or how efficient the process of selection is. Negative selection is known to be leaky (<xref ref-type="bibr" rid="bib52">Yu et al., 2015</xref>), letting auto-reactive cells differentiate into regulatory cells (<xref ref-type="bibr" rid="bib2">Bains et al., 2013</xref>; <xref ref-type="bibr" rid="bib49">Wing and Sakaguchi, 2010</xref>). The efficiency of negative selection for the naive conventional (non-regulatory) effector T cell compartment remains unclear (<xref ref-type="bibr" rid="bib52">Yu et al., 2015</xref>; <xref ref-type="bibr" rid="bib13">Gallegos and Bevan, 2006</xref>). Partial or incomplete negative selection may limit its impact on the repertoire.</p><p>The difficulty of characterizing selection is partly due to survivor bias when sampling functional immune repertoires in the periphery (<xref ref-type="bibr" rid="bib29">Madi et al., 2017</xref>; <xref ref-type="bibr" rid="bib28">Madi et al., 2014</xref>; <xref ref-type="bibr" rid="bib20">Izraelson et al., 2018</xref>; <xref ref-type="bibr" rid="bib40">Sethna et al., 2017</xref>). To overcome this limitation, we sequenced the TCR repertoire of thymocyte subpopulations isolated from mice carrying a reporter transgene linked to Nur77, a marker of T cell activation both within the thymus and in the periphery. Nur77 expression, in combination with Annexin V, a marker of cell death, allows us to identify cells that are more likely to pass thymic selection, and those that are most likely not to pass selection. Although the CD4+CD8+Annexin V population may still contain some cells which will be negatively selected, but have not yet expressed Annexin V, the overall strategy provides us with a window into the repertoire at various stages of selection. By comparing the sequenced repertoires to statistical models of mouse TCR generation (<xref ref-type="bibr" rid="bib40">Sethna et al., 2017</xref>), and subset-specific models of thymic selection, we searched for specific TCR sequence features that correlate with the different stages of intra-thymic T-cell developement.</p></sec><sec id="s2" sec-type="results"><title>Results</title><sec id="s2-1"><title>Tracking T cell development stages by flow cytometry</title><p>To identify specific sequence features of TCR during each step of thymic selection, we performed high-throughput sequencing of TCR repertoires from different subpopulations of thymocytes from transgenic Nur77 reporter expressing mice. These mice carry a fluorescent reporter gene which is co-expressed with Nur77, a marker of T cell activation (<xref ref-type="bibr" rid="bib26">Liebmann et al., 2018</xref>). Three genetically identical Nur77 reporter mice were sacrificed at the age of 6 weeks, when thymus development is completed and its cell population is stable (<xref ref-type="bibr" rid="bib15">Gray et al., 2006</xref>). All animals were handled according to Weizmann Institute’s Animal Care guidelines, in compliance with national and international regulations. Thymus and spleen were removed, and stained for fluorescence-activated cell sorting (see Materials and Methods). The cells were sorted based on Nur77 reporter expression (to detect activation), Annexin V (to detect early apoptosis) in combination with CD3, CD4, and CD8 cell surface markers. We used the gating strategy illustrated in <xref ref-type="fig" rid="fig1">Figure 1A, B and C</xref> to isolate double positive DP cells preceding selection (CD4<sup>+</sup>CD8<sup>+</sup>, Nur77<sup>-</sup>, Annexin V<sup>-</sup>: DP pre), DP cells in the process of being positively selected (CD4<sup>+</sup>CD8<sup>+</sup>, Nur77<sup>+</sup> Annexin V<sup>-</sup>: DP pos), DP cells dying by neglect or possibly by damage during the preparation (CD4<sup>+</sup>CD8<sup>+</sup>, Nur77 Annexin V<sup>+</sup>: DP dbn); and single positive (SP) cells: CD4<sup>+</sup>CD8<sup>-</sup>, Annexin V<sup>+</sup> (CD4 apo), and CD4<sup>-</sup>CD8<sup>+</sup>, Annexin V<sup>+</sup> cells (CD8 apo). The Annexin V staining was not very strong and did not give a very clear separation between positive and negative populations. In addition, Annexin V<sup>+</sup> subsets may be contaminated by cells that are dying for other reasons than negative selection. Nevertheless, we may still assume that the two apo subsets are enriched in negatively selected cells. In addition, we sequenced the repertoires of mature (post-selection) single positive SP CD4<sup>+</sup> and CD8<sup>+</sup> cells from the spleen (CD4 spl and CD8 spl). The proposed differentiation pathway between these populations at different maturation stages are schematically represented in <xref ref-type="fig" rid="fig1">Figure 1D</xref>. Together, these seven repertoires should contain both the selected thymocytes and the pre-selection repertoires, as well as the thymocytes that fail either positive or negative selection and die in the thymus.</p><fig-group><fig id="fig1" position="float"><label>Figure 1.</label><caption><title>Experiment outline and repertoire sampling.</title><p>(<bold>A</bold>) Flow cytometry scatterplots of T cell population from the thymus according to the markers CD4 and CD8. (<bold>B</bold>) The DP population is separated from DN according to CD3 expression (insert). Cells are then FACS sorted according to the expression of Nur77 and AnnexinV. (<bold>C</bold>) CD4 cells in the spleen (above) and CD8 (below) are FACS sorted according to the expression of CD3 and AnnexinV. (<bold>D</bold>) Schematic evolution of the sampled cell types during thymic maturation. (<bold>E</bold>) Analysis workflow: annotated reads in sampled repertoires are input for model inference (see Materials and Methods). Out-of-frame TCR sequences are pooled from all mice and stages to learn a generation model. In-frame sequences are used to learn maturation stage specific selection models with the generation model as background.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-81622-fig1-v2.tif"/></fig><fig id="fig1s1" position="float" specific-use="child-fig"><label>Figure 1—figure supplement 1.</label><caption><title>Summary of the RepSeq datasets.</title><p>(<bold>A</bold>) Number of reads for the alpha chain vs the number for the beta chain within the same dataset. In the box is shown the Pearson correlation coefficient. Distribution of iNKT clonotypes for the α chain. (<bold>B</bold>) The relative amount of (TRAV11, TRAJ18) clonotypes is significantly higher for all CD4 stages in all mice. (<bold>C</bold>) Numbers of unique productive (in-frame and with no stopping codons) single chain obtained for the maturation stages in each mouse after annotation for the α chain. (<bold>D</bold>) Numbers of unique productive for the β chain.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-81622-fig1-figsupp1-v2.tif"/></fig></fig-group></sec><sec id="s2-2"><title>TCR repertoire sequencing</title><p>We sequenced and annotated the TCR repertoires of each subset as described in Materials and Methods. The cDNA of individual α and β genes (TRA and TRB) were barcoded with unique molecular identifiers (UMI) in order to allow for correction of sequencing errors and PCR bias. However, in this analysis we focused on unique sequences (discarding count information) to avoid expression and amplification biases. As a quality control of the whole procedure, we showed that the number of α and β sequences within each population was highly correlated (<xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1A</xref>). We further verified that the relative fraction of TCRα sequences associated with iNKT cells (identified by TRAV11 and TRAJ18 genes [<xref ref-type="bibr" rid="bib14">Garner et al., 2018</xref>]) is higher in CD4 than in CD8 cells (see <xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1B</xref>).</p><p>We obtained seven datasets for both chains and for each of the three mice. A small fraction of sequences contain stop codons, usually because of a frameshift in the CDR3. These sequences likely come from transcription from a chromosome carrying a nonproductive chain, which is known to persist despite allelic exclusion acting on the TRB locus. The rest of the sequences are assumed to be productive. Since nonproductive TCR owe their survival to the productive gene on the other chromosome, they are not affected by selection. We combined all nonproductive sequences from all subsets to infer a generative mechanistic model of the V(D)J recombination process using IGoR (<xref ref-type="bibr" rid="bib30">Marcou et al., 2018</xref>). Once trained, the model can be used to assign a generation probability <inline-formula><mml:math id="inf1"><mml:msub><mml:mi>P</mml:mi><mml:mi>gen</mml:mi></mml:msub></mml:math></inline-formula> to any TCR sequence observed (<xref ref-type="bibr" rid="bib34">Murugan et al., 2012</xref>; <xref ref-type="bibr" rid="bib30">Marcou et al., 2018</xref>; see Materials and Methods and <xref ref-type="fig" rid="fig1">Figure 1E</xref>).</p><p>The datasets contain ∼1000–50,000 unique productive sequences per subset (<xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1C</xref> for the α chain and <xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1D</xref> for the β chain). Since the 3 mice were isogenic and shared the same MHC haplotype, we expect their repertoires to be subject to the same processes of recombination and selection (<xref ref-type="bibr" rid="bib28">Madi et al., 2014</xref>). Unless specified otherwise, all downstream analyses were therefore carried out on pooled productive TCR sequences from each population from the three individuals to increase statistical power.</p></sec><sec id="s2-3"><title>Repertoires from different T cell populations have different statistical parameters</title><p>To assess how selection acts at the different maturation stages, we studied the distribution of sequence features in TCRα repertoires. We compared TRAV and TRAJ gene usage at the different maturation stages with each other and with their excepted frequency from the generation model learned from nonproductive sequences, which we will refer to as the pre-selection model or <inline-formula><mml:math id="inf2"><mml:msub><mml:mi>P</mml:mi><mml:mi>gen</mml:mi></mml:msub></mml:math></inline-formula>. TRAV usage broadly follows the pattern of the pre-selection model (<xref ref-type="fig" rid="fig2">Figure 2A</xref>), although SP CD4<sup>+</sup> repertoires have a lower proportion of TRAV12-2, and most populations have an increased proportion of TRAV7-2. TRAJ gene usage also broadly agrees with the pre-selection model predictions (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2A</xref>), although SP CD8<sup>+</sup> repertoires have a lower proportion of TRAJ31, SP CD4<sup>+</sup> repertoires have an increased proportion of TRAJ27 and TRAJ32 which is underrepresented in all cell types. For both V and J genes, we see little difference between the repertoires of spleen CD4 and CD8 cells, and their discarded counterparts in the thymus (apo). We also observe strong similarities between all the DP subsets. TRB gene usage follows similar trends, although there are some differences in J gene usage between selected and unselected SP CD4<sup>+</sup> and CD8<sup>+</sup> cells. Overall, the biases of the recombination process dominate any effects of selection on V and J region usage (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1A</xref>, <xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2B</xref>).</p><fig-group><fig id="fig2" position="float"><label>Figure 2.</label><caption><title>Properties of the α chain sequence (the analogous plot for the β chain is showed in <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>).</title><p>The color code is common to all subplots. (<bold>A</bold>) TRAV gene distribution at different maturation stages compared to the pre-selection model distribution <inline-formula><mml:math id="inf3"><mml:msub><mml:mi>P</mml:mi><mml:mi>gen</mml:mi></mml:msub></mml:math></inline-formula> (see <xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2A</xref> for TRAJ). Only the most frequent according to the <inline-formula><mml:math id="inf4"><mml:msub><mml:mi>P</mml:mi><mml:mi>gen</mml:mi></mml:msub></mml:math></inline-formula> model are reported. Errorbars correspond to the empirical standard deviation across the three different mice. (<bold>B</bold>) CDR3 length distribution of TCRα sequences. The errors associated with mouse variability are minor and illustrated via the shaded curves. See <xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3A</xref> for individual curves. The dashed line is the average CDR3 length from the <inline-formula><mml:math id="inf5"><mml:msub><mml:mi>P</mml:mi><mml:mi>gen</mml:mi></mml:msub></mml:math></inline-formula> model. Standard deviations of the average length distributions are shown at right. (<bold>C</bold>) Distribution of the most frequent amino acids at different maturation stages. The counts correspond to the number of observations within the CDR3 (i.e. excluding the first two and the last positions), summed for all the sequences in the subpopulation. Error bars represent the empirical standard deviation across mice. (<bold>D</bold>) Principal component analysis of the TRAV gene distribution at each maturation stage. Insert: projection on the principal axis of the five most abundant TRAV genes (see Materials and Methods). Analogous results for TRAJ are shown in <xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2C</xref>. Source code available at <ext-link ext-link-type="uri" xlink:href="https://github.com/statbiophys/thymic_development_2022/blob/main/fig2.ipynb">https://github.com/statbiophys/thymic_development_2022/blob/main/fig2.ipynb</ext-link>.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-81622-fig2-v2.tif"/></fig><fig id="fig2s1" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 1.</label><caption><title>Analysis of the annotated productive β clonotypes for the different maturation stages.</title><p>(<bold>A</bold>) The distribution of TRBV genes at different maturation stages compared to the generation distribution. (<bold>B</bold>) Distribution of β chain CDR3 amino acid sequence lengths. The CDR3 is defined between the typical cysteine and phenylalanine position. The dashed line represents the average length according to the <inline-formula><mml:math id="inf6"><mml:msub><mml:mi>P</mml:mi><mml:mi>gen</mml:mi></mml:msub></mml:math></inline-formula> model. (<bold>C</bold>) The distribution of the most frequent amino acid within the CDR3 region for the TRBV sequences. (<bold>D</bold>) Principal component analysis according to the TRBV gene distribution at each maturation stage. Insert: projection on the principal axis of the five most representative TRBV genes. Analogous results for TRBJ are shown in <xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2D</xref>.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-81622-fig2-figsupp1-v2.tif"/></fig><fig id="fig2s2" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 2.</label><caption><title>Statistics of the J gene usage and the <inline-formula><mml:math id="inf7"><mml:msub><mml:mi>P</mml:mi><mml:mi>gen</mml:mi></mml:msub></mml:math></inline-formula> distributions.</title><p>(<bold>A</bold>) The distribution of J genes at different maturation stages compared to the generation distribution for the α chain. (<bold>B</bold>) The distribution of J genes for the β chain. (<bold>C</bold>) Principal component analysis of α chain J gene usage. Similarly as for the V genes (<xref ref-type="fig" rid="fig2">Figure 2C</xref>), DP, CD4 and CD8 maturation stages cluster by the cell types. (<bold>D</bold>) Principal component analysis of β chain J gene usage. (<bold>E</bold>) <inline-formula><mml:math id="inf8"><mml:msub><mml:mi>P</mml:mi><mml:mi>gen</mml:mi></mml:msub></mml:math></inline-formula> values distribution for the clonotypes at each maturation stage. Insert: blow up of the peak of the distribution (the dashed line) for the α chain. (<bold>F</bold>) <inline-formula><mml:math id="inf9"><mml:msub><mml:mi>P</mml:mi><mml:mi>gen</mml:mi></mml:msub></mml:math></inline-formula> values distribution the β chain.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-81622-fig2-figsupp2-v2.tif"/></fig><fig id="fig2s3" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 3.</label><caption><title>Separate amino acid CDR3 length distributions across all stages.</title><p>(<bold>A</bold>) Amino acid CDR3 length for TCRα sequences. The thick curve represent the average length across the three different mice, while the shaded part illustrates the mouse variability. On the left of each box, we report the empirical average and standard deviation of the distribution; on the right the coefficient of determination <inline-formula><mml:math id="inf10"><mml:msup><mml:mi>R</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:math></inline-formula> between each individual distribution and the average (see Materials and Methods). (<bold>B</bold>) Analogous for the TCRβ sequences.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-81622-fig2-figsupp3-v2.tif"/></fig></fig-group><p>For both chains, CDR3 amino acid length of SP CD4<sup>+</sup> and CD8<sup>+</sup> has a sharper distribution compared to earlier maturation stages (DP) (see <xref ref-type="fig" rid="fig2">Figure 2B</xref>, <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1B</xref> and <xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3</xref>). This has previously been interpreted as a signature of selection due to structural constraints on the pMHC-TCR complex (<xref ref-type="bibr" rid="bib29">Madi et al., 2017</xref>; <xref ref-type="bibr" rid="bib27">Lu et al., 2019</xref>; <xref ref-type="bibr" rid="bib6">Carter et al., 2019</xref>). We also compared the single amino acid usage (excluding the constant regions) across the different repertoires (<xref ref-type="fig" rid="fig2">Figure 2C</xref> for α chain, <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1C</xref> for β chain). We observe similarities between the DP stages, the CD4 stages and the CD8 stages, as observed for the gene usage. The repertoires from different maturation stages cannot be distinguished by any one individual feature discussed above. However, Principal Component Analysis (PCA) on the TRAV gene usage distributions in individual mice at different stages identified clusters of related cell types (<xref ref-type="fig" rid="fig2">Figure 2D</xref>). The DP Nur77<sup>-</sup> populations cluster with the pre-selection model, the SP CD4<sup>+</sup> and CD8<sup>+</sup> populations form distinct clusters, and the DP pos Nur77<sup>+</sup> cells, which we hypothesise are cells in the process of positive selection, occupy an intermediate position between these three clusters. This pattern is consistent with the known developmental trajectory as illustrated by the arrows in <xref ref-type="fig" rid="fig2">Figure 2D</xref>. PCA of TRAJ usage also shows similar clustering patterns (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2C</xref>). The PCA of TRBV and TRBJ usage also discriminates between SP CD4<sup>+</sup> and CD8<sup>+</sup> populations, and from the pre-selection populations, although the overall pattern is less clear (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1D</xref> and <xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2D</xref>). The overall distribution of TCR generation probabilities, <inline-formula><mml:math id="inf11"><mml:msub><mml:mi>P</mml:mi><mml:mi>gen</mml:mi></mml:msub></mml:math></inline-formula>, does not change from the pre-selection and post-selection thymic stages to the mature peripheral SP repertories (<xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2E, F</xref>), consistent with previous reports comparing thymic and peripheral repertoires (<xref ref-type="bibr" rid="bib40">Sethna et al., 2017</xref>). In summary, the effects of selection impose subtle changes on the pattern of TCR variable gene usage, which cannot be adequately captured by looking at any single V or J gene, but only by a combination of features.</p><p>V and J gene usage, and CDR3 length are coarse grained measures of a TCR repertoire. We therefore explored whether the repertoires of different maturation stages could be linked to more precise features of the TCR sequence, in particular incorporating the sequence of the CDR3. We encoded each TCR as a sparse {0,1} binary vector <inline-formula><mml:math id="inf12"><mml:mover accent="true"><mml:mi>σ</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover></mml:math></inline-formula> which captures V gene, J gene and CDR3 amino acid sequence (for details see Materials and Methods). We then trained a logistic regression model on the set of <inline-formula><mml:math id="inf13"><mml:mover accent="true"><mml:mi>σ</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover></mml:math></inline-formula> from repertoires of different subsets. We trained and tested the classifier to distinguish pairs of repertoires from different subsets. The classifier achieved only moderate Area Under the Curve (AUC) of the Receiver Operating Characteristic (ROC) scores (<xref ref-type="fig" rid="fig3">Figure 3A</xref> for TCRα, and <xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1A</xref> for TCRβ), in agreement with previous studies (<xref ref-type="bibr" rid="bib12">Emerson et al., 2013</xref>; <xref ref-type="bibr" rid="bib19">Isacchini et al., 2021</xref>). We verify that this result is not an artifact introduced by pooling repertoires of different mice, by testing the same techniques on the individual with the largest datasets (mouse 3). The AUC scores for the α and β repertoires are shown respectively in <xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1C, D</xref>.</p><fig-group><fig id="fig3" position="float"><label>Figure 3.</label><caption><title>AUC scores for the pooled TCRα datasets.</title><p>(<bold>A</bold>) Area under the curves (AUC) values computed from Receiver Operating Characteristic (ROC) curves of linear classifiers of TCRα between two subsets. The training/testing set is a random subsample containing 70%/30% of the full dataset at a given maturation stage. (<bold>B</bold>) ROC curves for classifying a group of <inline-formula><mml:math id="inf14"><mml:mi>m</mml:mi></mml:math></inline-formula> sequences from the same maturation stage, between CD4 spl and CD4 apo (red frame in <bold>A</bold>), illustrating the improvement with increasing number of TCRs. See <xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1</xref> and (<bold>B</bold>) for the analogous analysis on TCRβ. Source code available at <ext-link ext-link-type="uri" xlink:href="https://github.com/statbiophys/thymic_development_2022/blob/main/fig3.ipynb">https://github.com/statbiophys/thymic_development_2022/blob/main/fig3.ipynb</ext-link>.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-81622-fig3-v2.tif"/></fig><fig id="fig3s1" position="float" specific-use="child-fig"><label>Figure 3—figure supplement 1.</label><caption><title>AUC scores for the pooled TCRβ datasets and for an individual mouse.</title><p>(<bold>A</bold>) AUC values computed from the ROC curves of the linear classifiers for TCRβ sequences between pairs of maturation stages. The training/testing set is a random subsample containing 70%/30% of the full dataset at a given maturation stage. (<bold>B</bold>) Illustration of the improvements of group discriminability between the stafes CD4 spl and CD4 apo. (<bold>C</bold>) AUC values computed from the ROC curves of the linear classifiers for TCR sequences for the unpooled largest dataset for an individual (mouse 3). We observe that the score is never higher than for the pooled case and in fact it’s tipically worse for the α chain. (<bold>D</bold>) Analogous for the β chain.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-81622-fig3-figsupp1-v2.tif"/></fig><fig id="fig3s2" position="float" specific-use="child-fig"><label>Figure 3—figure supplement 2.</label><caption><title>Validation of the stages discrimination.</title><p>Here we organize the different train/test datasets as in the main text (<xref ref-type="fig" rid="fig3">Figure 3</xref>) and we learn logistic regression classifiers as in Materials and Methods, of which we report the AUC score. Analogous results are obtained by usage of a random decision forest. (<bold>A</bold>) We randomly shuffle the labels for each pair of α stages, observing that it is impossible to obtain two distinguishable repertoires through random mixing. The error for the last digit is expressed in brackets and is obtained from 20 realizations of the shuffling. (<bold>B</bold>) We randomly assign two labels to the TCRα sequences of a single repertoire and split the repertoire in a test and a train group. Again, we show that it’s not possible to obtain the scores of the main text by randomly pick chains from a defined stage. In all these controls we sub-sampled to the size of the smallest dataset available in order to check for issue size. As in the main text (see Materials and Methods), we test linear and decision forest classifiers, imposing the size of the larger class to not exceed of more then 25% the size of the smaller, with the test set corresponding to 30% of data. (<bold>C</bold>) Classifiers learnt on pair of β stages with randomly shuffled labels. (<bold>D</bold>) Classifiers learnt on single βstages with randomly assigned labels.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-81622-fig3-figsupp2-v2.tif"/></fig></fig-group><p>Controls in which population labels were shuffled, resulted in AUC close to 0.5 (<xref ref-type="fig" rid="fig3s2">Figure 3—figure supplement 2A, B</xref> for the α chain, <xref ref-type="fig" rid="fig3s2">Figure 3—figure supplement 2C, D</xref> for β). The results shown in <xref ref-type="fig" rid="fig3">Figure 3</xref> indicate that the TCR populations differ at a statistical level (i.e. have different distributions of sequence features), but that each individual TCR is only a weak predictor of repertoire class. However, better classification efficiencies can be achieved by combining the predictions from sets of TCRs. For example, multiplying the predictions from 30 TCR sequences from the same repertoire (<xref ref-type="fig" rid="fig3">Figure 3B</xref>), we can distinguish CD4 spl and CD4 apo TCRα with an AUC score of &gt;0.85; see <xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1B</xref> for TCRβ. Thus, statistical properties of a repertoire can distinguish it from another repertoire, even when the feature distributions of individual TCRs are largely overlapping.</p></sec><sec id="s2-4"><title>Selection models and <italic>n</italic>-grams capture the relations between the stages of thymic development</title><p>A number of studies have highlighted the importance of short amino acid motifs (<inline-formula><mml:math id="inf15"><mml:mi>k</mml:mi></mml:math></inline-formula>-mers or <inline-formula><mml:math id="inf16"><mml:mi>n</mml:mi></mml:math></inline-formula>-grams) within the CDR3 sequence in determining TCR specificity (<xref ref-type="bibr" rid="bib46">Thomas et al., 2014</xref>; <xref ref-type="bibr" rid="bib45">Sun et al., 2017</xref>; <xref ref-type="bibr" rid="bib8">Cinelli et al., 2017</xref>) (see <xref ref-type="fig" rid="fig4">Figure 4A</xref>). Specifically, <inline-formula><mml:math id="inf17"><mml:mi>n</mml:mi></mml:math></inline-formula>-grams can be used to reduce the dimensionality of the TCR space, while capturing amino acid correlations or patterns which might play a role in antigen recognition. We therefore counted the frequency of <inline-formula><mml:math id="inf18"><mml:mi>n</mml:mi></mml:math></inline-formula>-grams in each repertoire. We excluded from the analysis the most conserved regions (the first two positions in the CDR3 that are usually a cysteine and alanine, and the last one, typically a phenylalanine). We then used these <inline-formula><mml:math id="inf19"><mml:mi>n</mml:mi></mml:math></inline-formula>-gram frequency distributions to calculate the diversity of the repertoire as quantified by the Shannon entropy <inline-formula><mml:math id="inf20"><mml:mi>S</mml:mi></mml:math></inline-formula> (see Materials and Methods). In practice, the Shannon entropy is computationally too expensive to calculate exactly for very large data sets, and we therefore restricted our analysis to <inline-formula><mml:math id="inf21"><mml:mi>n</mml:mi></mml:math></inline-formula>-grams of length 4 or less, using the approximate Nemenman-Shafee-Bialek (NSB) entropy estimator (<xref ref-type="bibr" rid="bib35">Nemenman et al., 2002</xref>) to correct for finite sampling bias (see Materials and Methods). This estimator outcompetes alternative entropy estimators on synthetic data (<xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1</xref>). Our analysis combines together CDR3 of different amino acid lengths which may influence the entropy measurements. However, detailed analysis of the entropy of DP repertoires, using different CDR3 lengths separately, demonstrated that the differences observed due to the lengths effects were small compared to error due to sequencing (<xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1</xref>). Another advantage of the Nemenman-Shafee-Bialek estimator is that it was shown to converge at the sizes of the smallest datasets (∼10<sup>3</sup>-10<sup>4</sup> clonotypes), as reported in <xref ref-type="fig" rid="fig4s2">Figure 4—figure supplement 2</xref>. Once computed the set of entropy measurements based on <inline-formula><mml:math id="inf22"><mml:mi>n</mml:mi></mml:math></inline-formula>-gram frequencies for each different repertoire, we compared the data-derived entropy measurements with the prediction of a simple generative model of each repertoire which treated each feature of each TCR (V gene, J gene and each CDR3 amino acid) as independent. Taking the set of TCR vectors <inline-formula><mml:math id="inf23"><mml:mover accent="true"><mml:mi>σ</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover></mml:math></inline-formula> we fitted a set of parameters <inline-formula><mml:math id="inf24"><mml:msub><mml:mi>E</mml:mi><mml:mi>stage</mml:mi></mml:msub></mml:math></inline-formula> by maximising the posterior probability over all of the TCRs for each repertoire separately <inline-formula><mml:math id="inf25"><mml:mrow><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mi>stage</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>σ</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mi>Z</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>stage</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>σ</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:msup><mml:mo>⁢</mml:mo><mml:msub><mml:mi>P</mml:mi><mml:mi>gen</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>σ</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="inf26"><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mi>gen</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>σ</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> are the pre-selection generative probabilities for all the TCRs, <inline-formula><mml:math id="inf27"><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>stage</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>σ</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is a linear function of the features (<xref ref-type="bibr" rid="bib11">Elhanati et al., 2014</xref>; <xref ref-type="bibr" rid="bib41">Sethna et al., 2020</xref>), and <inline-formula><mml:math id="inf28"><mml:mi>Z</mml:mi></mml:math></inline-formula> is a normalization factor (<xref ref-type="fig" rid="fig1">Figure 1E</xref> and Materials and Methods). The enrichment factors <inline-formula><mml:math id="inf29"><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>stage</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>σ</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> encode the intuition that due to selection, a given TCR in a given repertoire is seen with higher or lower frequency than expected by the pre-selection generation model. Once we had learnt the enrichment factors for each repertoire, we used the resulting model to generate in silico synthetic repertoires of 3 × 10<sup>6</sup> TCRs, and recalculated <inline-formula><mml:math id="inf30"><mml:mi>n</mml:mi></mml:math></inline-formula>-gram frequency distributions and entropy estimates for each synthetic repertoire.</p><fig-group><fig id="fig4" position="float"><label>Figure 4.</label><caption><title><inline-formula><mml:math id="inf31"><mml:mi>n</mml:mi></mml:math></inline-formula>-gram frequency discriminates between repertoires.</title><p>(<bold>A</bold>) <inline-formula><mml:math id="inf32"><mml:mi>n</mml:mi></mml:math></inline-formula>-gram definition. We count how many times <inline-formula><mml:math id="inf33"><mml:mi>n</mml:mi></mml:math></inline-formula>-gram amino acid subsequences are seen in the CDR3 across a repertoire. (<bold>B</bold>) Shannon entropy <inline-formula><mml:math id="inf34"><mml:mi>S</mml:mi></mml:math></inline-formula> of the <inline-formula><mml:math id="inf35"><mml:mi>n</mml:mi></mml:math></inline-formula>-gram distributions normalized by <inline-formula><mml:math id="inf36"><mml:mi>n</mml:mi></mml:math></inline-formula> for the maturation stages. The entropy is estimated with the <xref ref-type="bibr" rid="bib35">Nemenman et al., 2002</xref> estimator and it is expressed in bits. The error on the estimated Shannon entropy from data is estimated from the sequencing error (see Materials and Methods). (<bold>C</bold>) Clustering according to Jensen-Shannon divergence between the 3-gram distributions computed from the selection model <inline-formula><mml:math id="inf37"><mml:msub><mml:mi>P</mml:mi><mml:mi>stage</mml:mi></mml:msub></mml:math></inline-formula> on synthetic repertoires. Dendrogram are computed with the Ward method (see Materials and Methods). (<bold>D</bold>) Clustering based on Jensen-Shannon divergence for the full <inline-formula><mml:math id="inf38"><mml:msub><mml:mi>P</mml:mi><mml:mi>stage</mml:mi></mml:msub></mml:math></inline-formula> selection model using <inline-formula><mml:math id="inf39"><mml:msub><mml:mi>P</mml:mi><mml:mi>stage</mml:mi></mml:msub></mml:math></inline-formula>. Source code available at <ext-link ext-link-type="uri" xlink:href="https://github.com/statbiophys/thymic_development_2022/blob/main/fig4.ipynb">https://github.com/statbiophys/thymic_development_2022/blob/main/fig4.ipynb</ext-link>.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-81622-fig4-v2.tif"/></fig><fig id="fig4s1" position="float" specific-use="child-fig"><label>Figure 4—figure supplement 1.</label><caption><title>Comparison of different entropy estimators and of the dependence on the CDR3aa length choice.</title><p>(<bold>A</bold>) Averages over different subsamples of the same size for productive DP pos pooled <inline-formula><mml:math id="inf40"><mml:mi>α</mml:mi></mml:math></inline-formula> clonotypes. The estimators compared are: Nemenmann-Shafee-Bialek (see Materials and Methods) (<xref ref-type="bibr" rid="bib35">Nemenman et al., 2002</xref>, <xref ref-type="bibr" rid="bib7">Chao and Shen, 2003</xref>, <xref ref-type="bibr" rid="bib31">Miller, 1955</xref>) and maximum likelihood (naive estimator). (<bold>B</bold>) Analogous for the β chain. (<bold>C</bold>) Analysis of the length dependence of 3gram entropy associated to different choices of th CDR3 amino acid lengths for the clonotypes considered in the α DP pre stage. The errorbars are estimated with the NSB method, while the shaded curve represent the sequencing error. We notice how the difference between the different choices is greatly covered by the sequencing error. We prefer then to use all CDR3 lengths for the higher statistics. (<bold>D</bold>) Analogous for the β chain.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-81622-fig4-figsupp1-v2.tif"/></fig><fig id="fig4s2" position="float" specific-use="child-fig"><label>Figure 4—figure supplement 2.</label><caption><title>Convergence of the <inline-formula><mml:math id="inf41"><mml:mi>n</mml:mi></mml:math></inline-formula>-gram entropy estimations.</title><p>(<bold>A</bold>) We subsample the unique clonotypes for the TCRα sequences and we check that the 4-gram entropy estimations converge with increasing number of unique clonotypes. The synthetic sequences are produced with the generation model <inline-formula><mml:math id="inf42"><mml:msub><mml:mi>P</mml:mi><mml:mi>gen</mml:mi></mml:msub></mml:math></inline-formula> (same for all plots), the different selection models <inline-formula><mml:math id="inf43"><mml:msub><mml:mi>P</mml:mi><mml:mi>stage</mml:mi></mml:msub></mml:math></inline-formula> and a <inline-formula><mml:math id="inf44"><mml:msub><mml:mi>P</mml:mi><mml:mi>stage</mml:mi></mml:msub></mml:math></inline-formula> selection model with synthetic nucleotide sequencing error. The estimation is performed using the Nemenman-Shafee-Bialek (NSB) estimator. The error bars for data are obtained with the NSB method, while for synthetic sequences are estimated as the empirical standard deviation over different realizations of the simulation. Due to the increased statistics, the convergence is faster for <inline-formula><mml:math id="inf45"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>n</mml:mi><mml:mo>&lt;</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> (the number of possible <inline-formula><mml:math id="inf46"><mml:mi>n</mml:mi></mml:math></inline-formula>-grams grows as 20<sup>n</sup>, thus we decided to show this analysis only for the case <inline-formula><mml:math id="inf47"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:math></inline-formula>). (<bold>B</bold>) Analogous analysis for TCRβ sequences.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-81622-fig4-figsupp2-v2.tif"/></fig><fig id="fig4s3" position="float" specific-use="child-fig"><label>Figure 4—figure supplement 3.</label><caption><title>Shannon entropy on β-grams and entropy dependency on <inline-formula><mml:math id="inf48"><mml:mi>n</mml:mi></mml:math></inline-formula>.</title><p>(<bold>A</bold>) NSB estimation of the Shannon entropy <inline-formula><mml:math id="inf49"><mml:mi>S</mml:mi></mml:math></inline-formula> normalized by <inline-formula><mml:math id="inf50"><mml:mi>n</mml:mi></mml:math></inline-formula>, associated to <inline-formula><mml:math id="inf51"><mml:mi>n</mml:mi></mml:math></inline-formula>-gram distributions within the CDR3 TCRβ chain of unique clonotypes from the different maturation stages. The error bars for the data are estimated from the sequencing error. (<bold>B</bold>) Decrease in entropy per symbol between <inline-formula><mml:math id="inf52"><mml:mi>n</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf53"><mml:mrow><mml:mi>n</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> grams for the α chain. The decreases are comparable. The errorbars associated to simulation are obtained as the same of the two standard deviations as returned by the NSB estimator. (<bold>C</bold>) For the β chain the decreases get smaller with <inline-formula><mml:math id="inf54"><mml:mi>n</mml:mi></mml:math></inline-formula>.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-81622-fig4-figsupp3-v2.tif"/></fig><fig id="fig4s4" position="float" specific-use="child-fig"><label>Figure 4—figure supplement 4.</label><caption><title>Jensen-Shannon divergence between <inline-formula><mml:math id="inf55"><mml:mi>n</mml:mi></mml:math></inline-formula>-gram distributions.</title><p>(<bold>A</bold>) Jensen-Shannon divergence (<xref ref-type="disp-formula" rid="equ8">Equation 8</xref>) for different <inline-formula><mml:math id="inf56"><mml:mi>n</mml:mi></mml:math></inline-formula>-gram distributions (here <inline-formula><mml:math id="inf57"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>) estimated on synthetic TCRα repertoires for different maturation stages. The dendrogram is computed with the Ward method (see Materials and Methods). (<bold>B</bold>) Divergence for TCRα in the case <inline-formula><mml:math id="inf58"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:math></inline-formula>. We report here the same figure shown in the main text for the sake of comparison (<xref ref-type="fig" rid="fig4">Figure 4C</xref>). (<bold>C</bold>) Divergence for TCRα in the case <inline-formula><mml:math id="inf59"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:math></inline-formula>. (<bold>D</bold>) Divergence for TCRβ in the case <inline-formula><mml:math id="inf60"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>. (<bold>F</bold>) Divergence for TCRβ in the case <inline-formula><mml:math id="inf61"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:math></inline-formula>. (<bold>G</bold>) Divergence for TCRβ in the case <inline-formula><mml:math id="inf62"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:math></inline-formula>.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-81622-fig4-figsupp4-v2.tif"/></fig><fig id="fig4s5" position="float" specific-use="child-fig"><label>Figure 4—figure supplement 5.</label><caption><title>AUC values computed from the ROC curves of the linear classifiers learnt over n-grams features.</title><p>(<bold>A</bold>) 1gram classifiers for the α chain. In the case of 1-grams, the features are assigned according to the counts of appearance of a certain amino acid within the CDR3 region (20 features). (<bold>B</bold>) 1-gram classifiers for the β chain. (<bold>C</bold>) 3-gram classifiers for the α chain. In the case of 3-grams we choose a one-hot-encoding of the 8000 features. We observe the increased discrimination power of the 3-grams with respect to 1-gram as expected, the latter being generally worse than the models learnt on top of <italic>Sonia</italic> features. (<bold>D</bold>) 3-gram classifiers for the β chain.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-81622-fig4-figsupp5-v2.tif"/></fig><fig id="fig4s6" position="float" specific-use="child-fig"><label>Figure 4—figure supplement 6.</label><caption><title>Measure of the Shannon entropy using the full stage models.</title><p>(<bold>A</bold>) Shannon entropy estimation associated to the full <inline-formula><mml:math id="inf63"><mml:msub><mml:mi>P</mml:mi><mml:mi>stage</mml:mi></mml:msub></mml:math></inline-formula> model for the α chain (<xref ref-type="disp-formula" rid="equ7">Equation. 7</xref>) for the different selection models and the <inline-formula><mml:math id="inf64"><mml:msub><mml:mi>P</mml:mi><mml:mi>gen</mml:mi></mml:msub></mml:math></inline-formula> generation model. (<bold>B</bold>) We report here the same figure shown in the main text for the sake of comparison (<xref ref-type="fig" rid="fig4">Figure 4D</xref>). (<bold>C</bold>) Shannon entropy estimation associated to the full <inline-formula><mml:math id="inf65"><mml:msub><mml:mi>P</mml:mi><mml:mi>stage</mml:mi></mml:msub></mml:math></inline-formula> model for the β chain for the different selection models and the <inline-formula><mml:math id="inf66"><mml:msub><mml:mi>P</mml:mi><mml:mi>gen</mml:mi></mml:msub></mml:math></inline-formula> generation model. (<bold>D</bold>) Jensen-Shannon divergence for the β chain <inline-formula><mml:math id="inf67"><mml:msub><mml:mi>P</mml:mi><mml:mi>stage</mml:mi></mml:msub></mml:math></inline-formula> models.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-81622-fig4-figsupp6-v2.tif"/></fig><fig id="fig4s7" position="float" specific-use="child-fig"><label>Figure 4—figure supplement 7.</label><caption><title>Logo plots for the relative enrichment of positional amino acid usage.</title><p>(<bold>A</bold>) Logo plots for the CDR3 amino acid usage inferred by the model, from the left (positive position indexes) and from the right (negative), omitting the first and the last one. Here the quantity <inline-formula><mml:math id="inf68"><mml:mrow><mml:mo stretchy="false">⟨</mml:mo><mml:mrow><mml:msubsup><mml:mi>ϵ</mml:mi><mml:mn>1</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>-</mml:mo><mml:msubsup><mml:mi>ϵ</mml:mi><mml:mn>2</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo stretchy="false">⟩</mml:mo></mml:mrow></mml:math></inline-formula> represents the average difference between weights associated to amino acid <inline-formula><mml:math id="inf69"><mml:mrow><mml:mi>a</mml:mi><mml:mo>⁢</mml:mo><mml:mi>a</mml:mi></mml:mrow></mml:math></inline-formula> at the given position by <inline-formula><mml:math id="inf70"><mml:msub><mml:mi>P</mml:mi><mml:mi>stage</mml:mi></mml:msub></mml:math></inline-formula> models (see Materials and Methods). Analogously with the energy difference, a negative difference implies the feature is favoured in stage 1, vice versa for stage 2. We follow the color scheme from <xref ref-type="bibr" rid="bib47">Tubiana et al., 2019</xref> to highlight the charge properties (red for positive charge, blue for negative charge). On the left is shown the weights difference between stages DP pos and DP dbn for the α chain. For the β chain (right) we see a reduction of positively charged amino acid in DP pos. (<bold>B</bold>) Stages CD4 spl and CD4 apo. Conversely, here the CD4 spl stage show enhancement in positively charged for the β chain (right). (<bold>C</bold>) Stages CD8 spl and CD8 apo. We observe just a slight enhancement of positively charged amino acid in CD8 spl.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-81622-fig4-figsupp7-v2.tif"/></fig><fig id="fig4s8" position="float" specific-use="child-fig"><label>Figure 4—figure supplement 8.</label><caption><title>Hydrophobic score at different stages and AUC scores of classifiers on hydrophobic features.</title><p>(<bold>A</bold>) We measure the increase of hydrophobicity from the generation benchmark using a stage-wide score defined from the inferred <inline-formula><mml:math id="inf71"><mml:msub><mml:mi>P</mml:mi><mml:mi>stage</mml:mi></mml:msub></mml:math></inline-formula> models (see Materials and Methods, <xref ref-type="disp-formula" rid="equ4">Equation 4</xref>). As a control, we compute the same quantity over a set of models learnt on <inline-formula><mml:math id="inf72"><mml:msub><mml:mi>P</mml:mi><mml:mi>gen</mml:mi></mml:msub></mml:math></inline-formula>-generated repertoires of the same sizes (in blue). The error bars correspond to the standard deviation over 25 repetitions. The score is showed at the various stages for the α chain. We observe a clear increase from DP pre to DP pos and a subsequent decrease for the single positive sets, in agreement with the role of positive and negative selection. (<bold>B</bold>) Analogous analysis for the β chain. In this case we also observe AnnexinV+ sets with a higher score than the spleen sets. (<bold>C</bold>) AUC scores computed from the ROC curves of the logisitc regression classifiers learnt over an empirical hydrophobic index of the α repertoires (see Materials and Methods, <xref ref-type="disp-formula" rid="equ5">Equation 5</xref>). (<bold>D</bold>) AUC scores for the classifiers on on hydrophobic features for the β chain.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-81622-fig4-figsupp8-v2.tif"/></fig></fig-group><p>The comparison of the estimated entropy for each <inline-formula><mml:math id="inf73"><mml:mi>n</mml:mi></mml:math></inline-formula>-gram length, and each subpopulation of T cells, using both directly data-derived and model-derived repertoires is illustrated for TCRα (<xref ref-type="fig" rid="fig4">Figure 4B</xref>) and TCRβ (<xref ref-type="fig" rid="fig4s3">Figure 4—figure supplement 3A</xref>) chains. An upper bound for the entropy is given by uniformly distributed amino acids, <inline-formula><mml:math id="inf74"><mml:mrow><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mi>max</mml:mi></mml:msub><mml:mo>/</mml:mo><mml:mi>n</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msub><mml:mi>log</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>⁡</mml:mo><mml:mn>20</mml:mn></mml:mrow><mml:mo>∼</mml:mo><mml:mn>4.3</mml:mn></mml:mrow></mml:math></inline-formula> bits, while amino acids distributed according to their frequency in the overall vertebrate proteome gives a slightly smaller value of ∼4.2 bits per position (<xref ref-type="bibr" rid="bib21">King and Jukes, 1969</xref>). Both the observed and model-derived entropies are less than this maximum even for single amino acids (<inline-formula><mml:math id="inf75"><mml:mi>n</mml:mi></mml:math></inline-formula>-grams of length <inline-formula><mml:math id="inf76"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>), and decrease further with <inline-formula><mml:math id="inf77"><mml:mi>n</mml:mi></mml:math></inline-formula>-gram length (see <xref ref-type="fig" rid="fig4s3">Figure 4—figure supplement 3B, C</xref>). This reflects strong bias on the abundance of individual amino acids, and strong correlations between amino acids within the CDR3 which are observed in all CDR3 repertoires, and are captured by the frequency distribution of the longer <inline-formula><mml:math id="inf78"><mml:mi>n</mml:mi></mml:math></inline-formula>-grams. Two additional important points can be observed. First, the entropy of the repertoires after selection and lineage commitment (in the single positive populations) is less than the earlier pre-selection DP repertoires, which match closely the entropy of the pre-selection generative model (shown by the dotted line for each <inline-formula><mml:math id="inf79"><mml:mi>n</mml:mi></mml:math></inline-formula>-gram length). This decrease becomes more evident with longer <inline-formula><mml:math id="inf80"><mml:mi>n</mml:mi></mml:math></inline-formula>-gram length (the circles lie below the dotted lines). Thus, as predicted, selection does impose some decrease in repertoire diversity, although this is a much smaller effect than the decrease in diversity imposed by the generation process itself. The second key observation is that the entropy calculated directly from <inline-formula><mml:math id="inf81"><mml:mi>n</mml:mi></mml:math></inline-formula>-gram frequency in the data is very similar to that of the synthetic repertoires generated using the linear generative models in which individual TCR amino acids are treated as independent variables. Thus, at least at the level of diversity of <inline-formula><mml:math id="inf82"><mml:mi>n</mml:mi></mml:math></inline-formula>-grams, there is no evidence that selection at any step involves complex sequence motifs, or amino acid interactions, which would not be captured by the linear model. We looked in more detail at the <inline-formula><mml:math id="inf83"><mml:mi>n</mml:mi></mml:math></inline-formula>-gram (<inline-formula><mml:math id="inf84"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:math></inline-formula>) distributions derived by the linear selection models for the different maturation stages. A plot of the Jensen-Shannon divergences (JSD) between all pairwise comparisons largely recapitulated the expected relationships between the subsets, with DP pre and DP dbn clustering with the pre-selection generative model, while the single positive CD4 and CD8 populations clustered separately, and DP pos have an intermediate position (<xref ref-type="fig" rid="fig4">Figure 4C</xref>). A comparison for both TCRα and β for different <inline-formula><mml:math id="inf85"><mml:mi>n</mml:mi></mml:math></inline-formula> is shown in <xref ref-type="fig" rid="fig4s4">Figure 4—figure supplement 4</xref>. Since some differences between populations were seen even for amino acid usage (<inline-formula><mml:math id="inf86"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>), we compared the discriminatory power of models based on <inline-formula><mml:math id="inf87"><mml:mi>n</mml:mi></mml:math></inline-formula>-grams with <inline-formula><mml:math id="inf88"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf89"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:math></inline-formula> (<xref ref-type="fig" rid="fig4s5">Figure 4—figure supplement 5</xref>). The 3-gram model outperformed the 1-gram model in almost all cases. We can go beyond <inline-formula><mml:math id="inf90"><mml:mi>n</mml:mi></mml:math></inline-formula>-grams and use the subset-specific <inline-formula><mml:math id="inf91"><mml:msub><mml:mi>P</mml:mi><mml:mi>stage</mml:mi></mml:msub></mml:math></inline-formula> models to predict the entropy of the full sequence (Materials and Methods), shown in <xref ref-type="fig" rid="fig4s6">Figure 4—figure supplement 6A</xref> for <inline-formula><mml:math id="inf92"><mml:mi>α</mml:mi></mml:math></inline-formula> and <xref ref-type="fig" rid="fig4s6">Figure 4—figure supplement 6C</xref> for β. This entropy is substantially reduced from generation to the DP stages, and further reduced in the single positive stages, especially in CD4<sup>+</sup> subsets. We also computed the <inline-formula><mml:math id="inf93"><mml:mi>JSD</mml:mi></mml:math></inline-formula> of the distributions <inline-formula><mml:math id="inf94"><mml:msub><mml:mi>P</mml:mi><mml:mi>stage</mml:mi></mml:msub></mml:math></inline-formula> between subtypes (<xref ref-type="fig" rid="fig4">Figure 4C</xref> for TCRα and <xref ref-type="fig" rid="fig4s6">Figure 4—figure supplement 6D</xref> for TCRβ). These JSD showed similar patterns as with <inline-formula><mml:math id="inf95"><mml:mi>n</mml:mi></mml:math></inline-formula>-grams, except for CD8<sup>+</sup> spleen cells showing more similarity to the <inline-formula><mml:math id="inf96"><mml:msub><mml:mi>P</mml:mi><mml:mi>gen</mml:mi></mml:msub></mml:math></inline-formula> distribution in TCRβ. Note that the absolute values of the entropies and JSD are larger, since they include information about longer sequences, with additional V and J gene usage information. In summary, we fitted the data with a set of stage-specific generative models based on linear weighted combinations of TCR sequence features. The repertoires generated by this model accurately estimate the sequence and <inline-formula><mml:math id="inf97"><mml:mi>n</mml:mi></mml:math></inline-formula>-gram entropy derived directly from the data, and generate repertoires which differ in a small but reproducible manner from each other. The magnitude of these differences reflect the expected developmental relationships between the different populations.</p></sec><sec id="s2-5"><title>Models capture modulations of hydrophobic residues in different subpopulations</title><p>We inspected single amino acid usage in terms of the model marginals to check for relative positional enrichments between pairs of repertoires (<xref ref-type="disp-formula" rid="equ3">Equation 3</xref>), but we did not observe any striking signal for amino acid charge properties. The logo plots with a visualization of this results are shown in <xref ref-type="fig" rid="fig4s7">Figure 4—figure supplement 7</xref>. Hydrophobic residues in the central positions of the CDR3 have been reported to be enriched in the TCRs of regulatory versus conventional T cells (<xref ref-type="bibr" rid="bib23">Lagattuta et al., 2022</xref>). This suggests hydrophobicity may function as a proxy for auto-reactivity, and might be enriched in cells selected for negative selection (<xref ref-type="bibr" rid="bib43">Stadinski et al., 2016</xref>; <xref ref-type="bibr" rid="bib9">Daley et al., 2019</xref>). To test this idea, we defined a stage-specific hydrophobicity score <inline-formula><mml:math id="inf98"><mml:mi>U</mml:mi></mml:math></inline-formula>, obtained by summing the enrichment factors of hydrophobic residues CFILMWY at central positions of the CDR3 as learnt by our model at each stage (see <xref ref-type="disp-formula" rid="equ4">Equation 4</xref> in Materials and Methods).</p><p>We observe a clear increase of this score from DP pre to DP pos, suggesting that positive selection introduces a bias toward more hydrophobic TCRs (<xref ref-type="fig" rid="fig4s7">Figure 4—figure supplement 7</xref> and B). The score also decreases in the single positive sets (CD4 and CD8), in agreement with the known role of negative selection to prune too strongly self-reactive T cells (<xref ref-type="bibr" rid="bib4">Butler et al., 2013</xref>). Finally, AnnexinV+ single positive sets (‘apo’) show a slightly higher score than their respective spleen (‘spl’) sets (with the exception of the CD8 α chain scores). Overall, these changes in hydrophobicity are consistent with the hypothesised position of the different populations defined in our study in the stages of TCR selection.</p><p>Note that this score (like other scores found in the literature <xref ref-type="bibr" rid="bib19">Isacchini et al., 2021</xref>; <xref ref-type="bibr" rid="bib23">Lagattuta et al., 2022</xref>) is statistical and can not be used to classify individual sequences. To assess how much of single-sequence discriminability is explained by the presence of hydrophobic residues, we then introduced an empirical ‘hydrophobicity index’ <inline-formula><mml:math id="inf99"><mml:mi>u</mml:mi></mml:math></inline-formula>, here defined as the number of hydrophobic residues (again CFILMWY) contained in the CDR3, normalized by its amino acid length (see Materials and Methods, <xref ref-type="disp-formula" rid="equ5">Equation 5</xref>). The classifiers using this feature yielded poor performance (<xref ref-type="fig" rid="fig4s8">Figure 4—figure supplement 8C, D</xref>), worse than the 1-gram models (<xref ref-type="fig" rid="fig4s5">Figure 4—figure supplement 5A, B</xref>).</p></sec><sec id="s2-6"><title>Discriminatory power of thymic selection</title><p>The stage-specific enrichment factors in the generative models described above can be considered as capturing the combination of features which drives a particular selection step. A prediction of this idea is that, at each selection point, the TCRs which are selected and those which are not would have a distribution of model probabilities (<inline-formula><mml:math id="inf100"><mml:msub><mml:mi>P</mml:mi><mml:mi>stage</mml:mi></mml:msub></mml:math></inline-formula>) which are anti-correlated. For example, a TCR that is present in the DP pos repertoire but “forbidden” from the CD4 repertoire (e.g. because of cross-reactivity to a Class II self pMHC) would be expected to have a large positive <inline-formula><mml:math id="inf101"><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mpadded width="+1.7pt"><mml:mi>DP</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi>pos</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and a <inline-formula><mml:math id="inf102"><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mpadded width="+1.7pt"><mml:mi>CD4</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi>spl</mml:mi></mml:mrow></mml:msub><mml:mo>≈</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>, reflecting the large enrichment factor between these two populations. A toy example illustrating this idea is illustrated in (<xref ref-type="fig" rid="fig5">Figure 5A</xref>). We consider a simple model in which TCRs are selected according to their CDR3 length into a ‘long’ population with probability <inline-formula><mml:math id="inf103"><mml:mrow><mml:mrow><mml:mi>P</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>long</mml:mi><mml:mo lspace="2.5pt" rspace="2.5pt" stretchy="false">|</mml:mo><mml:mi>L</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msup><mml:mi>L</mml:mi><mml:mi>h</mml:mi></mml:msup><mml:mo>/</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msup><mml:mi>L</mml:mi><mml:mi>h</mml:mi></mml:msup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>L</mml:mi><mml:mn>0</mml:mn><mml:mi>h</mml:mi></mml:msubsup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> and into a ‘short’ population otherwise. We apply this selection process in silico to <inline-formula><mml:math id="inf104"><mml:msub><mml:mi>P</mml:mi><mml:mi>gen</mml:mi></mml:msub></mml:math></inline-formula>-generated TCRs, and fit a separate <inline-formula><mml:math id="inf105"><mml:msub><mml:mi>P</mml:mi><mml:mi>population</mml:mi></mml:msub></mml:math></inline-formula> model on the synthetic sequences found in each subset. We then calculate <inline-formula><mml:math id="inf106"><mml:msub><mml:mi>E</mml:mi><mml:mi>population</mml:mi></mml:msub></mml:math></inline-formula> for each TCR according to both subset models, and plot these values against each other. The distribution of enrichment strengths according to the two models are clearly anti-correlated (<xref ref-type="fig" rid="fig5">Figure 5A</xref>). In other words, if a TCR is more likely to be classified as a ‘long’ sequence, it is in general less likely to be classified as a ‘short’ one. Interestingly, however, the enrichment strengths distributions from the two models are significantly overlapping. As a result, attempts to classify individual TCRs according to their enrichment strengths is poor, AUC∼ 0.57. We then consider a different toy model where TCRs are selected according to the empirical hydrophobicity index <inline-formula><mml:math id="inf107"><mml:mi>u</mml:mi></mml:math></inline-formula> (<xref ref-type="disp-formula" rid="equ5">Equation 5</xref>). Similarly, we choose to generate a synthetic ‘high hydrophobicity’ (<inline-formula><mml:math id="inf108"><mml:mi>HH</mml:mi></mml:math></inline-formula>) population filtering <inline-formula><mml:math id="inf109"><mml:msub><mml:mi>P</mml:mi><mml:mi>gen</mml:mi></mml:msub></mml:math></inline-formula>-generated TCRs with a probability <inline-formula><mml:math id="inf110"><mml:mrow><mml:mrow><mml:mi>P</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>HH</mml:mi><mml:mo lspace="2.5pt" rspace="2.5pt" stretchy="false">|</mml:mo><mml:mi>u</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msup><mml:mi>u</mml:mi><mml:mi>h</mml:mi></mml:msup><mml:mo>/</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msup><mml:mi>u</mml:mi><mml:mi>h</mml:mi></mml:msup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>u</mml:mi><mml:mn>0</mml:mn><mml:mi>h</mml:mi></mml:msubsup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, otherwise ‘low hydrophobicity’. Repeating the analysis performed with the length example, we observe in the corresponding scatterplot that enrichment strengths are again anti-correlated (<xref ref-type="fig" rid="fig5">Figure 5B</xref>).</p><fig-group><fig id="fig5" position="float"><label>Figure 5.</label><caption><title>Density scatter-plots of TCRα sequences comparing the selection energies learnt at two different stages.</title><p>(<bold>A</bold>) Synthetic example of soft discrimination between ‘short’ and ‘long’ CDR3, where sequences are randomly assigned into either of the two populations with a bias that depends on their CDR3 length. The density scatter plot shows a clear anti-correlation between the selection energies learnt from these two populations. Yet, sequence classification is imprecise, as quantified by the low AUC = 0.57. The parameters chosen for the filter in this example are <inline-formula><mml:math id="inf111"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>13</mml:mn></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf112"><mml:mrow><mml:mi>h</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></inline-formula>. (<bold>B</bold>) Synthetic example of soft discrimination between ‘low’ and ‘high hydrophobic’ CDR3 showing clear anti-correlation between these two populations. Sequence classification is again poor AUC = 0.60. The parameters chosen for the filter on the ‘hydrophobic index’ <inline-formula><mml:math id="inf113"><mml:mi>u</mml:mi></mml:math></inline-formula> in this example are <inline-formula><mml:math id="inf114"><mml:mrow><mml:msub><mml:mi>u</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>≃</mml:mo><mml:mn>0.2</mml:mn></mml:mrow></mml:math></inline-formula> (the median value over a set of <inline-formula><mml:math id="inf115"><mml:msub><mml:mi>P</mml:mi><mml:mi>gen</mml:mi></mml:msub></mml:math></inline-formula>-distributed sequences) and <inline-formula><mml:math id="inf116"><mml:mrow><mml:mi>h</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>. (<bold>C</bold>) The differential enrichment parameter of each TCR calculated according to <inline-formula><mml:math id="inf117"><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mpadded width="+1.7pt"><mml:mi>DP</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi>dbn</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> model is plotted against the energy calculated against the <inline-formula><mml:math id="inf118"><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mpadded width="+1.7pt"><mml:mi>DP</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi>pos</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> model. To correct for bias imposed by the TCRα generation process, the DP pre energy, which encodes background selection common to both stages, is subtracted. The black line is the direction of the major eigenvector of the dots moments matrix. The value <inline-formula><mml:math id="inf119"><mml:mi>r</mml:mi></mml:math></inline-formula> reported in each plot is the Pearson’s correlation coefficient (see Materials and Methods). (<bold>D</bold>) Differential enrichment parameter according to CD4 spl and CD8 spl models, relative to DP pos. (<bold>E</bold>) Differential enrichment parameter according to CD4 spl and CD4 apo models, relative to DP pos. (<bold>F</bold>) Differential enrichment parameter according to CD8 spl and CD8 apo models, relative to DP pos. Source code available at <ext-link ext-link-type="uri" xlink:href="https://github.com/statbiophys/thymic_development_2022/blob/main/fig5.ipynb">https://github.com/statbiophys/thymic_development_2022/blob/main/fig5.ipynb</ext-link>.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-81622-fig5-v2.tif"/></fig><fig id="fig5s1" position="float" specific-use="child-fig"><label>Figure 5—figure supplement 1.</label><caption><title>Differential increments scatterplots for all pairs of stages.</title><p>The differential enrichement parameters assigned by the stage specific selection models relative to the the preceding stage (i.e. energy differences from DP pre or DP pos). Each dot represents one of the 3.10<sup>6</sup> synthetic sequences generated according to the generation model <inline-formula><mml:math id="inf120"><mml:msub><mml:mi>P</mml:mi><mml:mi>gen</mml:mi></mml:msub></mml:math></inline-formula>, here shown according to a dot density plot. Each figure uses the same set of synthetic sequences. (<bold>A</bold>) Density scatterplots of the energy differences between the energies of the TCRα models and the enregy of DP pre. (<bold>B</bold>) Density scatterplots for TCRα where DP pos energy is subtracted instead. (<bold>C</bold>) Density scatterplots for TCRβ where DP pre energy is subtracted. (<bold>D</bold>) Density scatterplots for TCRβ where DP pos energy is subtracted.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-81622-fig5-figsupp1-v2.tif"/></fig></fig-group><p>We extended this approach to look for relationships between enrichment strengths for TCRs at different developmental stages. Since all cells pass through a preceding selection stage, we must consider it as a common background distribution for all the successive thymic stages. We therefore considered the differential enrichment parameter <inline-formula><mml:math id="inf121"><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>stage</mml:mi></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mi>E</mml:mi><mml:mrow><mml:mi>pre</mml:mi><mml:mo>-</mml:mo><mml:mi>stage</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, a linear operator which predicts whether a sequence is more or less likely to be present in a particular developmental stage as compared to the previous stage. We generated a set of sequences using the generation model <inline-formula><mml:math id="inf122"><mml:msub><mml:mi>P</mml:mi><mml:mi>gen</mml:mi></mml:msub></mml:math></inline-formula> (thus with no selection bias), and then computed differential enrichment parameters for each TCR according to all the stage specific models. The full set of pairwise correlations between enrichment values for the different populations relative to <inline-formula><mml:math id="inf123"><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mpadded width="+1.7pt"><mml:mi>DP</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi>pre</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> are shown in (<xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1A</xref> for TCRα and <xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1C</xref> for TCRβ). The DP dbn repertoire showed a narrow distribution of values, which was uncorrelated to any other subset, in particular to DP pos (<xref ref-type="fig" rid="fig5">Figure 5C</xref>). This would be consistent with the DP dbn repertoire containing a random sample of the DP pre repertoire, unrelated to its TCR sequence. To check if the signal coming from DP pos stage is the principal cause of the high correlation between the single positive stages, we repeated the analysis for CD4 and CD8 using <inline-formula><mml:math id="inf124"><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mpadded width="+1.7pt"><mml:mi>DP</mml:mi></mml:mpadded><mml:mo>⁢</mml:mo><mml:mi>pos</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> as the common background distribution (the full set of scatterplots for TCRα is shown in <xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1B</xref>, in <xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1D</xref> for TCRβ). There was therefore no evidence of selection pressure operating on TCR sequence to distinguish these two populations. The correlation between the CD4<sup>+</sup> and CD8<sup>+</sup> subsets was negligible (<inline-formula><mml:math id="inf125"><mml:mrow><mml:mi>r</mml:mi><mml:mo>∼</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>), suggesting that the selection pressures operating on the two populations are distinct (<xref ref-type="fig" rid="fig5">Figure 5D</xref>). The spleen SP and the thymic apo populations were also highly correlated for both CD4<sup>+</sup> and CD8<sup>+</sup> cells (<inline-formula><mml:math id="inf126"><mml:mrow><mml:mi>r</mml:mi><mml:mo>=</mml:mo><mml:mn>0.79</mml:mn></mml:mrow></mml:math></inline-formula> for CD4 spl vs CD4 apo, in <xref ref-type="fig" rid="fig5">Figure 5E</xref>; <inline-formula><mml:math id="inf127"><mml:mrow><mml:mi>r</mml:mi><mml:mo>=</mml:mo><mml:mn>0.66</mml:mn></mml:mrow></mml:math></inline-formula> for CD8 spl vs CD8 apo, in <xref ref-type="fig" rid="fig5">Figure 5F</xref>). Similar results are obtained for the sequences of the β chain (<xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1C D</xref>). In contrast to the examples illustrated above, most plots showed a positive correlation between enrichment values for two models. Thus a common dominant selection process is driving the repertoire shift between the DP pos and all subsequent stages, which dominates the impact of individual stage-specific selection processes. In summary, the TCR enrichment value distributions differ between different thymic populations, but do not show evidence of dominant exclusive sequence-based selection operating at any step of the selection process.</p></sec></sec><sec id="s3" sec-type="discussion"><title>Discussion</title><p>Thymic selection is often portrayed as a simple discrimination process that eliminates TCRs capable of strongly binding any self-peptide, while promoting TCRs that bind them weakly. However, this simple picture has been challenged and the fidelity of the negative selection process and the proportion of the self-repertoire which can effectively be scanned by each individual thymocyte during the window of negative selection remains incompletely understood (<xref ref-type="bibr" rid="bib52">Yu et al., 2015</xref>; <xref ref-type="bibr" rid="bib13">Gallegos and Bevan, 2006</xref>). If significant number of T cells escape negative selection and enter the peripheral repertoire, no sequence feature will unambiguously distinguish TCRs from pre and post-selection repertoires. Many efforts have been made to connect TCR sequences to peptide recognition (<xref ref-type="bibr" rid="bib48">Weber et al., 2021</xref>; <xref ref-type="bibr" rid="bib32">Montemurro et al., 2021</xref>; <xref ref-type="bibr" rid="bib19">Isacchini et al., 2021</xref>). However, these approaches cannot yet be used to define the target peptidome of entire repertoires. Here we take the complementary approach, by looking for TCR sequence features that are linked to thymic selection.</p><p>Although there has been a lot of work on understanding and modeling thymic development (<xref ref-type="bibr" rid="bib50">Yates, 2014</xref>; <xref ref-type="bibr" rid="bib39">Robert et al., 2021</xref>) our study presents the first comprehensive analysis of TCR repertoire of different developmental stages of thymic maturation. By incorporating a reporter for the activation marker Nur77, which is activated during thymic selection, and an early marker of apoptosis, Annexin V, we were able to enrich for identifying subpopulations during the process of positive or negative selection. Although this more sophisticated strategy in principal allows the unbiased isolation of the major stages of thymic selection, some limitations remain. For example, the time interval during which negatively selected cells survive after they received their instruction to go into apoptosis may depend on signal strength. If strong TCR singal strength translates into short subsequent lifetime, then the AnnexinV+ cells sorted may be enriched for cells receiving a rather weaker negative signal. We examined the repertoires from two perspectives. In the first part of the paper, we compare statistical properties of the sequences of the repertoires using features of different dimensionalities, which include V gene, J gene and CDR3 length frequency distributions, and individual CDR3 sequences represented as sparse {0,1} binary vectors. The analysis incorporated both coarse-grained (V, J and CDR3 length) and fine-grained (individual CDR3 sequence) features, and the results were remarkably consistent. No single feature adequately discriminated between any pair of repertoires. Combination of features when averaged across a repertoire did show subtle but reproducible differences between repertoires, which could be used to discriminate between subpopulations using both unsupervised (PCA) and supervised (logistic regression) analysis. Furthermore, the difference between these statistical parameters captured the known developmental trajectory of thymic development, illustrated schematically in <xref ref-type="fig" rid="fig1">Figure 1D</xref>. Interestingly, the smallest distances observed were between mature CD4 or CD8 cells, and their thymic SP negatively selected (apo) counterparts. This suggests that negative selection of single positives is only weakly associated with the sequence properties of single TCRs, or at least single chains. It is in principle possible that larger differences exist in the paired α-β repertoires, which would not be detectable in either the alpha or beta repertoires alone, but previous work on the functional alpha-beta repertoire has suggested that pairing was largely random, with weak associations between some germline genes (<xref ref-type="bibr" rid="bib16">Grigaityte et al., 2017</xref>; <xref ref-type="bibr" rid="bib10">Dupic et al., 2019</xref>).</p><p>An additional possibility which must be considered is that Annexin V staining does not exclusively capture the negatively selected population, but also identifies cells which were damaged during the preparation. Contamination of the AnnexinV+ population by these damaged or dying cells will weaken the selection signature observed, although the fact we do manage to discriminate between the apo and spleen subpopulations (<xref ref-type="fig" rid="fig3">Figure 3A</xref>) indicates that these differences, however small, do exist. Conversely, cells marked for deletion may not have the time to express Annexin V, so that the DPpos subset may contain cells that are being negatively selected against, in addition to cells that are being positively selected (<xref ref-type="bibr" rid="bib44">Stritesky et al., 2013</xref>).</p><p>A limitation of our sorting strategy is that we do not identify Treg from conventional CD4<sup>+</sup> T cells. It has been suggested that regulatory T cells (Tregs), which are more auto-reactive and should thus bear the same marks as the cells that fail negative selection, have distinctive TCR features, notably the presence of hydrophobic residues at key positions (<xref ref-type="bibr" rid="bib43">Stadinski et al., 2016</xref>; <xref ref-type="bibr" rid="bib9">Daley et al., 2019</xref>). TCR scores based on more detailed features than hydrophobicity have been proposed (<xref ref-type="bibr" rid="bib19">Isacchini et al., 2021</xref>; <xref ref-type="bibr" rid="bib23">Lagattuta et al., 2022</xref>). We note that these scores are statistical and do not classify individual sequences. Consistent with these previous results, we can project our model parameters to build a single hydrophobicity index, which we observe to be significantly increased in positively selected cells (DP pos) versus DP pre, and decreased in single positive sets (<xref ref-type="fig" rid="fig4s8">Figure 4—figure supplement 8A, B</xref>). Beyond hydrophobicity, it remains an open question whether the features that drive Treg fate are the same that drive negative selection.</p><p>Although the statistical properties of the repertoires differed between subpopulations, it was not possible to classify individual TCRs at high accuracy. As discussed above, this may in part be due to the fact that the populations we define only imperfectly correlate with their fate and self-reactivity. However, the differences between CD4<sup>+</sup> and CD8<sup>+</sup>repertoires, which are much less likely to be affected by issues of functional or physical cross-contamination, are also seen only at a statistical population level, and not an individual TCR sequence level. Learning the collective properties of at least a few dozen TCRs was required in order to achieve good discrimination between repertoires.</p><p>The statistical population-level differences between populations of thymocytes and mature T cells which we observe is reminiscent of previous models emphasising the importance of collective, rather than individual T cell behavior. <xref ref-type="bibr" rid="bib4">Butler et al., 2013</xref> proposed that a minimum number of T cells must collectively recognize a peptide to trigger a response, proposing quorum sensing as a mechanistic explanation of this collective decision making. Recent experiments have confirmed that quorum sensing between TCRs can occur, mediated via cytokine signaling (<xref ref-type="bibr" rid="bib38">Polonsky et al., 2018</xref>), and estimating a minimum quorum size of activated T cells to be 30. Our results suggest that thymic selection imposes only a rather weak selective pressure on the repertoire, which is consistent with <xref ref-type="bibr" rid="bib4">Butler et al., 2013</xref> ’s hypothesis that most self-peptides are not screened by TCR during negative selection. Our results are consistent with their model, in which even a subtle depletion, rather than complete elimination of non-self TCRs, may still translate into robust self/non-self discrimination in populations of reactive TCRs. Self versus foreign peptide discrimination by TCR is somewhat the conjugate task of self-reactive versus a non self-reactive T cell discrimination during negative selection. While the performance of the two tasks cannot be directly compared at first sight, they are related in that both are impaired by a factor <inline-formula><mml:math id="inf128"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>f</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> due to partial screening of self peptides, where <inline-formula><mml:math id="inf129"><mml:mi>f</mml:mi></mml:math></inline-formula> is the fraction of self-peptides that are presented during thymic developement. The common point is that even when <inline-formula><mml:math id="inf130"><mml:mi>f</mml:mi></mml:math></inline-formula> is small, the law of large numbers can rescue the discrimination task when there are multiple observations. In Materials and Methods, we argue using the model of <xref ref-type="bibr" rid="bib4">Butler et al., 2013</xref> how the idealized performance of repertoire discrimination using multiple (<inline-formula><mml:math id="inf131"><mml:mi>m</mml:mi></mml:math></inline-formula>) TCR (akin to the task of <xref ref-type="fig" rid="fig3">Figure 3B</xref>) may be compared to the task of telling self from foreign peptides in the periphery, when the number of T cells specific to one particular peptide and recruited to the site of infection is <inline-formula><mml:math id="inf132"><mml:mrow><mml:mi>m</mml:mi><mml:mo>×</mml:mo><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="inf133"><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:math></inline-formula> is the average number of self-peptides recognized by a random TCR. While those numbers cannot be applied directly to the results of <xref ref-type="fig" rid="fig3">Figure 3B</xref>, which are based on an imperfect classifier from a single chain, they give a sense of how the same principle of discrimination apply to both cases.</p><p>In the second part of the study we explore in more detail whether we can discover any evidence that thymic selection depends on specific sequence motifs (i.e. a strong correlative structure between CDR3 amino acids). For this purpose, we build on our previous work which have established a framework for the development of generative statistical models of repertoire generation, based firmly on a mechanistic understanding of TCR generation and selection. Specifically, we construct models which incorporate only linear combinations of CDR3 sequences to capture the selective process which can transform one repertoire into another. These models produce an ‘enrichment factor’ for each TCR which estimates its relative likelihood of being in a particular stage-specific population. Intuitively, one can consider these factors as capturing the probable enrichment or depletion of a TCR with a particular sequence when comparing two repertoires. We demonstrate that these linear models effectively capture the progressive decrease in repertoire diversity which we observe in the preselected DP to the SP transition. They also effectively capture the known developmental relationships between the thymic subpopulations. Thus we find no evidence that complex non-linear amino acid sequence interactions are required to explain the observed changes in repertoire observed in our data. We also compared the distributions of enrichment factors between populations. We demonstrate that, contrary to the predictions of a strong binary selection model, we do not observe any negative correlation between enrichment factor distributions between selected and non-selected repertoires. Instead, we observe a set of positive correlations, revealing a dominant conserved selection process spanning the developmental stages between pre-selection DP and mature SP. Consistent with the clustering data discussed above, we find strong correlation between the enrichment factor distributions of mature SP and thymic negatively selected population, and no evidence of binary selection between these two populations.</p><p>In conclusion, we report a comprehensive analysis of the TCR repertoire at various stages of thymic development. We then combine data-driven and model-based analysis of these repertoires. Our conclusions are incompatible with a model of thymic developments which involves a sequence of clear-cut binary selection processes, based on TCR sequence features. Rather, our data suggest a probabilistic fuzzy decision making process at each selection step. We propose that this model is compatible with robust self/non-self discrimination, if T cell responses to antigen are governed by collective quorum based decision making. Further experimental and theoretical work is required to test these hypotheses, which have fundamental implications for strategies to modulate the immune response for prophylaxis or therapy of human disease.</p></sec><sec id="s4" sec-type="materials|methods"><title>Materials and methods</title><sec id="s4-1"><title>Animals</title><p>The experiment was carried out using three 6-week-old male inbred Nur77-GFP/Foxp3-mCherry (C57BL/6 background) (<xref ref-type="bibr" rid="bib33">Moran et al., 2011</xref>). The cross was bred and maintained at the Weizmann institute. This study was performed in strict accordance with the recommendations in the Guide for the Care and Use of Laboratory Animals of the National Institutes of Health. All of the animals were handled according to approved institutional animal care and use committee (IACUC) protocols (#21661115–2) of the Weizmann Institute of Science. The protocol was approved by the Committee on the Ethics of Animal Experiments of the Weizmann Institute of Science. Every effort was made to minimize suffering.</p></sec><sec id="s4-2"><title>Sample preparation and T cell isolation</title><p>Thymocytes and splenocytes were isolated from Nur77-GFP/Foxp3-mCherry 6-week-old mice. Erythrocytes were removed by hypotonic lysis in ammonium chloride. Thymocytes were stained with fluorescent antibodies, and sorted using a flow cytometer as described below. Splenic CD4 and CD8 cells were purified in two steps: (1) CD4<sup>+</sup> positive selection (CD4 (L3T4) MicroBeads, mouse, # 130-117-043, Miltenyi) to generate the ‘CD4 spl’ samples (2) the negative cells fraction were further selected for the CD8<sup>+</sup> positive cells (CD8a (Ly-2) MicroBeads, mouse, # 130-117-044, Miltenyi Biotec) to generate ‘CD8 spl’ samples.</p></sec><sec id="s4-3"><title>Flow cytometry analysis and cells sorting</title><p>The following fluorochrome-labeled mouse antibodies were used according to the manufacturers’ protocols: PerCP/Cy5.5 anti-CD4, PB anti-CD8, PE/cy7 anti-CD3, APC annexinV (Biolegend). UV LIVE/DEAD (ThermoFisher Scientific, # L23105). Labelled cells were sorted on a SORP-FACS-AriaII using a 70 <inline-formula><mml:math id="inf134"><mml:mrow class="ltx_unit"><mml:mi mathvariant="normal">µ</mml:mi><mml:mo>⁢</mml:mo><mml:mi mathvariant="normal">m</mml:mi></mml:mrow></mml:math></inline-formula> nozzle to 5 populations (see <xref ref-type="table" rid="table1">Table 1</xref>). Cell counts are reported in <xref ref-type="supplementary-material" rid="supp2">Supplementary file 2</xref>. Cells were analyzed using <italic>FlowJo</italic> (Tree Star) software.</p><table-wrap id="table1" position="float"><label>Table 1.</label><caption><title>Cell sorting based on fluorochrome-labeled mouse antibodies.</title></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" valign="bottom">Sample\Marker</th><th align="left" valign="bottom">CD4</th><th align="left" valign="bottom">CD8</th><th align="left" valign="bottom">CD3</th><th align="left" valign="bottom">AnnexinV</th><th align="left" valign="bottom">Nur77</th></tr></thead><tbody><tr><td align="left" valign="bottom">DP pre</td><td align="char" char="." valign="bottom">+</td><td align="char" char="." valign="bottom">+</td><td align="char" char="." valign="bottom">+</td><td align="left" valign="bottom">-</td><td align="left" valign="bottom">-</td></tr><tr><td align="left" valign="bottom">DP pos</td><td align="char" char="." valign="bottom">+</td><td align="char" char="." valign="bottom">+</td><td align="char" char="." valign="bottom">+</td><td align="left" valign="bottom">-</td><td align="char" char="." valign="bottom">+</td></tr><tr><td align="left" valign="bottom">DP dbn</td><td align="char" char="." valign="bottom">+</td><td align="char" char="." valign="bottom">+</td><td align="char" char="." valign="bottom">+</td><td align="char" char="." valign="bottom">+</td><td align="left" valign="bottom">-</td></tr><tr><td align="left" valign="bottom">CD4 apo</td><td align="char" char="." valign="bottom">+</td><td align="left" valign="bottom">-</td><td align="char" char="." valign="bottom">+</td><td align="char" char="." valign="bottom">+</td><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">CD8 apo</td><td align="left" valign="bottom">-</td><td align="char" char="." valign="bottom">+</td><td align="char" char="." valign="bottom">+</td><td align="char" char="." valign="bottom">+</td><td align="left" valign="bottom"/></tr></tbody></table></table-wrap></sec><sec id="s4-4"><title>Library preparation for TCR-seq</title><p>All libraries in this work were prepared according to the published method (<xref ref-type="bibr" rid="bib36">Oakes et al., 2017</xref>), with minor adaptations as described below. Briefly, total RNA was extracted from each of the seven populations using RNeasy Micro Kit (# 74004, Qiagen) and cleaned from excess DNA with DNAse 1 enzyme (# M6101, Promega). RNA samples were reverse transcribed to cDNA (SuperScript III, # 12574026, Invitrogen) using primers for the mouse α chain (mAlpha_RC2) and for the mouse β chain (mBeta_RC2) (see <xref ref-type="supplementary-material" rid="supp1">Supplementary file 1</xref>). Following reverse transcription the samples were purified on minielute spin columns (# 28004, QIAGEN). The cDNA was ligated to an oligonucleotide containing a unique 12 basepair molecular identifier (UMI) (6 N_I8.1_6 N_I8.1_SP2, see <xref ref-type="supplementary-material" rid="supp1">Supplementary file 1</xref>) using T4 RNA ligase (M0204S, NEB). Ligation products were purified using Agencourt AMPure XP beads (# A63881, BeckmanCoulter). Next, three rounds of extension PCR were executed (using KAPA HiFi DNA Polymerase, KAPA Biosystems) to add illumina sequencing adaptors and Illumina sample indices for multiplex sequencing (see <xref ref-type="supplementary-material" rid="supp2">Supplementary file 2</xref>). The thermal cycler parameters are an initial denaturation step (3 min at 95 °C) followed by cycles of denaturation (98 °C for 20 s), annealing (61 °C for 15 s), and extension 72 °C for 30 s. The final extension step was at 72 °C for 5 min. The lid was maintained at 105 °C. After the first round PCR (5 cycles), PCR products were purified using Agencourt AMPure XP beads and split in two, and α and β TCR genes were processed separately in subsequent steps. After the second PCR (8 cycles), PCR products were again purified using Agencourt AMPure XP beads. The final amplification using the adapter sequences P5 and P7 were carried out on a real-time qPCR machine, and the amplification was tracked by the incorporation of SYBR green. The cycler was stopped manually when the fluorescent signal reached a predetermined threshold, thus preventing overamplification.</p><p>The final library concentration was measured using Qubit Fluorometric Quantification (ThermoFisher Scientific) and the presence of the correct 600–700 bp product confirmed by electrophoresis on a High Sensitivity D1000 ScreenTape cassette using a 4200 TapeStation System (Agilent). Multiple samples were pooled in equal molarity, and then sequenced using NextSeq 550 (200 bp forward read, 100 bp reverse) (Illumina).</p></sec><sec id="s4-5"><title>Pre-processing and error correction for raw reads</title><p>Data were processed using an in-house pipeline, coded in <italic>R</italic>. First, UMI sequences were transferred from read 2 to read 1. Trimmomatic was used to filter out the raw reads containing bases with Q-value ≤ 20 and trim reads containing adaptors sequences (<xref ref-type="bibr" rid="bib3">Bolger et al., 2014</xref>). The remaining reads were separated according to their barcodes and reads containing the constant region for α or β chain primers sequences were filtered (<named-content content-type="sequence">CAGCAGGTTCTGGGTTCTGGATG </named-content>/ <named-content content-type="sequence">TGGGTGGAGTCACATTTCTCAGATCCT α </named-content>and β chain, respectively), allowing up to three mismatches. To correct for possible sequence errors, we cluster the sequences UMIs’ in two steps; (1) The UMIs with the highest frequency are grouped within a Levenshtein distance of 1 (<xref ref-type="bibr" rid="bib25">Levenshtein, 1966</xref>). (2) Out of these sequences, CDR3AA sequences (starting from the most frequent sequence in a group) were clustered using a Hamming distance threshold of 4 (<xref ref-type="bibr" rid="bib17">Hamming, 1950</xref>). Finally, the UMI of each CDR3 sequence was counted.</p></sec><sec id="s4-6"><title>Annotation and generation model</title><p>From the raw nucleotide reads, we performed a preliminary annotation using the python module <italic>PyIR</italic> (version 1.3.0) (<xref ref-type="bibr" rid="bib42">Soto et al., 2020</xref>), which provides a wrapper and parser of the open source software <italic>IgBlast</italic> (<xref ref-type="bibr" rid="bib51">Ye et al., 2013</xref>). We then separated the productive clonotypes from the out of frame reads and/or reads containing stop codons. We define a clonotype as TCRs sharing V genes, J genes, and the same CDR3 nucleotide sequence. If different reads are annotated as the same clonotype in the same dataset, only the read with highest UMI counts is considered.</p><p>For our models, we use a reduced set of genes from the IMGT free online repository (<xref ref-type="bibr" rid="bib24">Lefranc et al., 2015</xref>) in order to have a single allele per gene, preferring functional alleles to open reading frame or pseudo genes. A further reduction is done for the V genes of the α chain, clustering to a single representative all of the those genes that result indistinguishable in the region from the maximum observed V offset for the annotation to the conserved cysteine. Two genes are said to be indistinguishable if the Hamming distance (<xref ref-type="bibr" rid="bib17">Hamming, 1950</xref>) between the considered regions is equal to 0. For each TRAV cluster, we choose as the representative the most frequent gene in the preliminary annotation. In this way, we obtain 76 V genes and 51 J genes for the α chain, 26 V genes, 2 D genes and 14 J genes for the β chain.</p><p>In order to infer a generation model, we use the open source software <italic>IGoR</italic> (<xref ref-type="bibr" rid="bib30">Marcou et al., 2018</xref>) on all out-of-frame clonotypes pooled from all maturation stages of all mice. The generation model associates to each α (β) read a probability <inline-formula><mml:math id="inf135"><mml:msub><mml:mi>P</mml:mi><mml:mi>gen</mml:mi></mml:msub></mml:math></inline-formula> of being generated through the VJ (VDJ) recombination process. After learning a generation model, we annotate the reads using the most probable alignment scenario using the IGoR software, as the clonotype (V, J gene choice, CDR3 nucleotide sequence) with the highest <inline-formula><mml:math id="inf136"><mml:msub><mml:mi>P</mml:mi><mml:mi>gen</mml:mi></mml:msub></mml:math></inline-formula> among all possible recombination scenarios.</p><p>The PCA was computed in <italic>R</italic> (version 3.6.0) using the function &quot;PCA&quot; from the <italic>FactoMineR</italic> package (version 2.4).</p></sec><sec id="s4-7"><title>Statistical classification</title><p>The features are assigned to each α chain as a binary vector <inline-formula><mml:math id="inf137"><mml:mover accent="true"><mml:mi>σ</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover></mml:math></inline-formula>, where each entry is equal to 1 if the feature is observed, 0 otherwise. In this study the set of features is encoded using the ‘SoniaLeftposRightpos’ class (from the Python package <italic>Sonia</italic> version 0.0.45) which provides 5033 features: 30 for the CDR3 amino acid lengths, 25 left to right positions for each of the 20 amino acids (500 features), 25 right to left positions (500), the joint V/J gene usage (76×51 = 3876) and the independent usage (76+51 = 127). Analogously for the β we obtain 1434 features (without considering D genes).</p><p>To learn the models for the statistical classification of two stages, we first remove all sequences that share the same features between the two sets (i.e. same amino acid CDR3, V and J gene). Then, we balance the size of the sets sub-sampling the larger one so that its size does not exceed 25% of the size of the smaller. Each of the resulting sets is divided into a train and a test set by a ratio 70%/30% (‘StratifiedShuffleSplit’, module ‘model_selection’ from the Python package <italic>scikit-learn</italic>, version 0.24.2). The classifiers are learned with linear models, defined by a single layer with binary cross entropy as a loss function, binary accuracy as metrics, a sigmoid as activation function, coded using the ‘keras’ module from the Python package <italic>tensorflow</italic> (version 2.4.1). We obtained similar performance for the classification task by learning with a random forest algorithm as provided by the function ‘RandomForestModel’ in the module ‘keras’ from the package <italic>tensorflow_decision_forests</italic> (version 0.2.4).</p></sec><sec id="s4-8"><title>Selection model</title><p>To learn a <inline-formula><mml:math id="inf138"><mml:msub><mml:mi>P</mml:mi><mml:mi>stage</mml:mi></mml:msub></mml:math></inline-formula> selection model for each maturation stage, we pooled together the annotated sequences from all mice for the given maturation stage, discarding all clonotypes annotated with non-functional and pseudo genes. We learn a selection model using the open source software <italic>Sonia</italic> for each maturation stage. <italic>Sonia</italic> performs a linear regression over the features of the sequences in the dataset to infer the enrichment ratio between the maturation specific dataset and the generation model. The feature choice for the enrichment model is similar, except for the fact that only independent gene usage is considered, reducing features to 1157 for α chain (1070 for β chain). The probability of observing a sequence in a stage is modeled as<disp-formula id="equ1"><label>(1)</label><mml:math id="m1"><mml:mrow><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mi>stage</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>σ</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mi>Z</mml:mi></mml:mfrac><mml:mo>⁢</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>stage</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>σ</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:msup><mml:mo>⁢</mml:mo><mml:msub><mml:mi>P</mml:mi><mml:mi>gen</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>σ</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf139"><mml:mi>Z</mml:mi></mml:math></inline-formula> is a normalization factor and the energy <inline-formula><mml:math id="inf140"><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>stage</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>σ</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> for a sequence showing a set of features <inline-formula><mml:math id="inf141"><mml:mrow><mml:mi class="ltx_font_mathcaligraphic">ℱ</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>σ</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is defined as<disp-formula id="equ2"><label>(2)</label><mml:math id="m2"><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mrow><mml:mi mathvariant="normal">s</mml:mi><mml:mi mathvariant="normal">t</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">g</mml:mi><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mover><mml:mi>σ</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>f</mml:mi><mml:mspace width="thinmathspace"/><mml:mo>∈</mml:mo><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi mathvariant="script">F</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mover><mml:mi>σ</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:munder><mml:mrow><mml:msubsup><mml:mi>ϵ</mml:mi><mml:mrow><mml:mi mathvariant="normal">s</mml:mi><mml:mi mathvariant="normal">t</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">g</mml:mi><mml:mi mathvariant="normal">e</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mspace width="thinmathspace"/><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mover><mml:mi>σ</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>Here <inline-formula><mml:math id="inf142"><mml:msup><mml:mi>ϵ</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula> is a weight associated to the feature <inline-formula><mml:math id="inf143"><mml:mi>f</mml:mi></mml:math></inline-formula> and is learnt from data. To look at specific enhanced features between stages <inline-formula><mml:math id="inf144"><mml:mi>a</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf145"><mml:mi>b</mml:mi></mml:math></inline-formula> one can obtain the average weights difference from the respective <inline-formula><mml:math id="inf146"><mml:msub><mml:mi>P</mml:mi><mml:mi>stage</mml:mi></mml:msub></mml:math></inline-formula> models as<disp-formula id="equ3"><label>(3)</label><mml:math id="m3"><mml:mrow><mml:mrow><mml:mo>⟨</mml:mo><mml:mrow><mml:msubsup><mml:mi>ϵ</mml:mi><mml:mi>a</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>-</mml:mo><mml:msubsup><mml:mi>ϵ</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>⟩</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msubsup><mml:mi>p</mml:mi><mml:mi>a</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>p</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mn>2</mml:mn></mml:mfrac><mml:mo>⋅</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>ϵ</mml:mi><mml:mi>a</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>-</mml:mo><mml:msubsup><mml:mi>ϵ</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf147"><mml:msubsup><mml:mi>p</mml:mi><mml:mi>stage</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula> is the marginal associated by the model to the feature.</p><p>The limited amount of clonotypes for certain maturation stages precludes using deep neural network based selection models, although we do not expect the conclusions to change with the <italic>DNN SoNNia</italic> model <xref ref-type="bibr" rid="bib19">Isacchini et al., 2021</xref>.</p></sec><sec id="s4-9"><title>Hydrophobicity score</title><p>To study the hydrophobicity increase with respect to the generation, we define a stage-wide score as<disp-formula id="equ4"><label>(4)</label><mml:math id="m4"><mml:mrow><mml:mi>U</mml:mi><mml:mo>=</mml:mo><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mstyle scriptlevel="1"><mml:mtable rowspacing="0.1em" columnspacing="0em" displaystyle="false"><mml:mtr><mml:mtd><mml:mi>a</mml:mi><mml:mspace width="thinmathspace"/><mml:mo>∈</mml:mo><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi mathvariant="normal">h</mml:mi><mml:mi mathvariant="normal">y</mml:mi><mml:mi mathvariant="normal">d</mml:mi><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">o</mml:mi></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>x</mml:mi><mml:mspace width="thinmathspace"/><mml:mo>∈</mml:mo><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi mathvariant="normal">C</mml:mi><mml:mi mathvariant="normal">D</mml:mi><mml:mi mathvariant="normal">R</mml:mi><mml:mn>3</mml:mn><mml:mi mathvariant="normal">c</mml:mi><mml:mi mathvariant="normal">r</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mstyle></mml:mrow></mml:munder><mml:mrow><mml:msup><mml:mi>ϵ</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>⋅</mml:mo><mml:msubsup><mml:mi>p</mml:mi><mml:mrow><mml:mi mathvariant="normal">g</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf148"><mml:msup><mml:mi>ϵ</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo lspace="2.5pt" rspace="2.5pt" stretchy="false">|</mml:mo><mml:mi>x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula> is the weight associated by the model to the amino acid <inline-formula><mml:math id="inf149"><mml:mi>a</mml:mi></mml:math></inline-formula> at position <inline-formula><mml:math id="inf150"><mml:mi>x</mml:mi></mml:math></inline-formula>; the marginal <inline-formula><mml:math id="inf151"><mml:msubsup><mml:mi>p</mml:mi><mml:mi>gen</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo lspace="2.5pt" rspace="2.5pt" stretchy="false">|</mml:mo><mml:mi>x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula> is obtained by the generation model on the same feature (see previous sections). The sum runs over the hydrophobic amino acids CFILMWY, following the definition from <xref ref-type="bibr" rid="bib23">Lagattuta et al., 2022</xref>, considering just the positions of our model which correspond to the central region p108-p114 of the CDR3 in IMGT convention (model positions (4:10) from the left, and, (–11:–5) from the right). We also define an index <inline-formula><mml:math id="inf152"><mml:mi>u</mml:mi></mml:math></inline-formula> for hydrophobicity which can now be associated to each sequence as follow<disp-formula id="equ5"><label>(5)</label><mml:math id="m5"><mml:mrow><mml:mi>u</mml:mi><mml:mo>=</mml:mo><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mstyle scriptlevel="1"><mml:mtable rowspacing="0.1em" columnspacing="0em" displaystyle="false"><mml:mtr><mml:mtd><mml:mi>a</mml:mi><mml:mspace width="thinmathspace"/><mml:mo>∈</mml:mo><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi mathvariant="normal">h</mml:mi><mml:mi mathvariant="normal">y</mml:mi><mml:mi mathvariant="normal">d</mml:mi><mml:mi mathvariant="normal">r</mml:mi><mml:mi mathvariant="normal">o</mml:mi></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>x</mml:mi><mml:mspace width="thinmathspace"/><mml:mo>∈</mml:mo><mml:mspace width="thinmathspace"/><mml:mrow><mml:mi mathvariant="normal">C</mml:mi><mml:mi mathvariant="normal">D</mml:mi><mml:mi mathvariant="normal">R</mml:mi><mml:mn>3</mml:mn><mml:mi mathvariant="normal">c</mml:mi><mml:mi mathvariant="normal">r</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mstyle></mml:mrow></mml:munder><mml:mspace width="negativethinmathspace"/><mml:mspace width="negativethinmathspace"/><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mi>L</mml:mi></mml:mfrac></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>that is the number of hydrophobic residues found in the central region (same choices as above), normalized by the CDR3 length <inline-formula><mml:math id="inf153"><mml:mi>L</mml:mi></mml:math></inline-formula>.</p></sec><sec id="s4-10"><title><italic>n</italic>-gram Shannon entropy estimation</title><p>As a diversity measure we consider the Shannon entropy defined as:<disp-formula id="equ6"><label>(6)</label><mml:math id="m6"><mml:mrow><mml:mi>S</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:munder><mml:mo largeop="true" movablelimits="false" symmetric="true">∑</mml:mo><mml:mi>i</mml:mi></mml:munder><mml:mrow><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:mrow><mml:msub><mml:mi>log</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>⁡</mml:mo><mml:mi>p</mml:mi></mml:mrow><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf154"><mml:mrow><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the probability of finding a clonotype in the data. Since <inline-formula><mml:math id="inf155"><mml:mi>n</mml:mi></mml:math></inline-formula>-grams are sampled from <inline-formula><mml:math id="inf156"><mml:msup><mml:mn>20</mml:mn><mml:mi>n</mml:mi></mml:msup></mml:math></inline-formula> possible motifs, undersampling could bias a naive estimation of the entropy. We overcome this bias by estimating the Shannon entropy using the Nemenman-Shafee-Bialek (NSB) estimator (<xref ref-type="bibr" rid="bib35">Nemenman et al., 2002</xref>). The NSB estimator is computationally tractable and calculates an estimation error. We implement the entropy and variance estimators as given in <xref ref-type="bibr" rid="bib1">Archer et al., 2014</xref>. We verified the NSB estimators better performance for our datasets compared to other non-parametric estimators (<xref ref-type="fig" rid="fig4s1">Figure 4—figure supplement 1A, B</xref>), consistently with previous reports (<xref ref-type="bibr" rid="bib1">Archer et al., 2014</xref>). To check for convergence we subsample the clonotypes in the dataset at increasing sizes and estimate the entropy for each sub-sample (<xref ref-type="fig" rid="fig4s2">Figure 4—figure supplement 2</xref>). Convergence sets a limit legnth of <inline-formula><mml:math id="inf157"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> due to sample size constraints of the smallest dataset.</p></sec><sec id="s4-11"><title>Full model Shannon entropy estimation</title><p>The Shannon entropy in <xref ref-type="disp-formula" rid="equ6">Equation 6</xref> associated to the full <inline-formula><mml:math id="inf158"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mi mathvariant="normal">s</mml:mi><mml:mi mathvariant="normal">t</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">g</mml:mi><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mover><mml:mi>σ</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> model requires summing over all possible clonotypes <inline-formula><mml:math id="inf159"><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mover accent="true"><mml:mi>σ</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula>. Practically we evaluate the entropy by producing synthetic sequences according to the selection model <inline-formula><mml:math id="inf160"><mml:msub><mml:mi>P</mml:mi><mml:mi>stage</mml:mi></mml:msub></mml:math></inline-formula> and averaging the value of <inline-formula><mml:math id="inf161"><mml:mrow><mml:msub><mml:mi>log</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>⁡</mml:mo><mml:msub><mml:mi>P</mml:mi><mml:mi>stage</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>.<disp-formula id="equ7"><label>(7)</label><mml:math id="m7"><mml:mrow><mml:mi>S</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mi mathvariant="normal">s</mml:mi><mml:mi mathvariant="normal">t</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">g</mml:mi><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>≃</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>N</mml:mi></mml:mfrac><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:mrow><mml:msub><mml:mi>log</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>⁡</mml:mo><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mi mathvariant="normal">s</mml:mi><mml:mi mathvariant="normal">t</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">g</mml:mi><mml:mi mathvariant="normal">e</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mover><mml:mi>σ</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mo>∗</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>with clonotypes <inline-formula><mml:math id="inf162"><mml:msubsup><mml:mover accent="true"><mml:mi>σ</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mi>k</mml:mi><mml:mo>*</mml:mo></mml:msubsup></mml:math></inline-formula> sampled from the <inline-formula><mml:math id="inf163"><mml:msub><mml:mi>P</mml:mi><mml:mi>stage</mml:mi></mml:msub></mml:math></inline-formula> distribution.</p><p>Because of sequencing errors, the entropy of <inline-formula><mml:math id="inf164"><mml:mi>n</mml:mi></mml:math></inline-formula>-grams is systematically overestimated in the data. To estimate and correct for this bias, we measured the error rate from the data, provided as a byproduct of the IGoR training procedure (<xref ref-type="bibr" rid="bib30">Marcou et al., 2018</xref>). We used this rate to produce synthetic sequences with simulated sequencing errors. The difference in <inline-formula><mml:math id="inf165"><mml:mi>n</mml:mi></mml:math></inline-formula>-gram entropy between error-prone and error-free sequences was then applied as a subtractive correction factor to the data.</p></sec><sec id="s4-12"><title><italic>n</italic>-gram Jensen-Shannon divergence</title><p>To quantify the distance between two distributions <italic>p</italic><sub><italic>a</italic></sub> and <italic>p</italic><sub><italic>b</italic></sub> defined on the same support, we use the symmetric Jensen-Shannon divergence JSD:<disp-formula id="equ8"><label>(8)</label><mml:math id="m8"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">J</mml:mi><mml:mi mathvariant="normal">S</mml:mi><mml:mi mathvariant="normal">D</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>log</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>⁡</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo stretchy="false">↔</mml:mo><mml:mi>b</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>where the sum runs over all possible observables <inline-formula><mml:math id="inf166"><mml:mi>i</mml:mi></mml:math></inline-formula> and the term <inline-formula><mml:math id="inf167"><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo>↔</mml:mo><mml:mi>b</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> corresponds to the same expression in the first one with <inline-formula><mml:math id="inf168"><mml:mi>a</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf169"><mml:mi>b</mml:mi></mml:math></inline-formula> inverted. The Jensen-Shannon divergence is bounded between 0 and 1 bits, with <inline-formula><mml:math id="inf170"><mml:mrow><mml:mi>JSD</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> bits if the distributions are identical and a maximal difference of <inline-formula><mml:math id="inf171"><mml:mrow><mml:mi>JSD</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> bit. We use <inline-formula><mml:math id="inf172"><mml:mi>JSD</mml:mi></mml:math></inline-formula> to asses the divergence between <inline-formula><mml:math id="inf173"><mml:mi>n</mml:mi></mml:math></inline-formula>-gram distributions and between selection models.</p></sec><sec id="s4-13"><title>Full model Jensen-Shannon divergence</title><p>To compare selection models of complete clonotypes at two maturation stages, the divergence between the <inline-formula><mml:math id="inf174"><mml:msub><mml:mi>P</mml:mi><mml:mi>stage</mml:mi></mml:msub></mml:math></inline-formula> distribution of model <inline-formula><mml:math id="inf175"><mml:mi>a</mml:mi></mml:math></inline-formula> and the model <inline-formula><mml:math id="inf176"><mml:mi>b</mml:mi></mml:math></inline-formula> is:<disp-formula id="equ9"><label>(9)</label><mml:math id="m9"><mml:mrow><mml:mrow><mml:mi mathvariant="normal">J</mml:mi><mml:mi mathvariant="normal">S</mml:mi><mml:mi mathvariant="normal">D</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>≃</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>2</mml:mn><mml:mi>N</mml:mi></mml:mrow></mml:mfrac><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:mrow><mml:msub><mml:mi>log</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>⁡</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mi>E</mml:mi><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mover><mml:mi>σ</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mi>E</mml:mi><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mover><mml:mi>σ</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mi>E</mml:mi><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mrow><mml:mover><mml:mi>σ</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>a</mml:mi></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mo stretchy="false">↔</mml:mo><mml:mi>b</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>where the clonotypes <inline-formula><mml:math id="inf177"><mml:msubsup><mml:mover accent="true"><mml:mi>σ</mml:mi><mml:mo stretchy="false">→</mml:mo></mml:mover><mml:mi>k</mml:mi><mml:mi>a</mml:mi></mml:msubsup></mml:math></inline-formula> are sampled from the <inline-formula><mml:math id="inf178"><mml:msub><mml:mi>P</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:math></inline-formula> distribution. In <xref ref-type="disp-formula" rid="equ9">Equation 9</xref>, we used the fact that a given sequence has the same background generation probability <inline-formula><mml:math id="inf179"><mml:msub><mml:mi>P</mml:mi><mml:mi>gen</mml:mi></mml:msub></mml:math></inline-formula> in both selection models.</p></sec><sec id="s4-14"><title>Discrimination in the thymus vs discrimination in the periphery</title><p>Here we show a formal link between discrimation of negatively selected vs non-negatively selected TCR on the one hand, and foreign vs self-peptide recognition on the other.</p><p>We start by considering (negative) thymic selection. Following <xref ref-type="bibr" rid="bib4">Butler et al., 2013</xref>, we assume that a random TCR will recognize any peptide with probability <inline-formula><mml:math id="inf180"><mml:mi>p</mml:mi></mml:math></inline-formula>. Then the number of recognized self-peptides <inline-formula><mml:math id="inf181"><mml:mi>n</mml:mi></mml:math></inline-formula> by a random TCR is distributed according to a Poisson law of mean <inline-formula><mml:math id="inf182"><mml:mrow><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>N</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="inf183"><mml:mi>N</mml:mi></mml:math></inline-formula> is the number of self-peptides, <inline-formula><mml:math id="inf184"><mml:mrow><mml:mrow><mml:mi>P</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi>Poiss</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>N</mml:mi></mml:mrow><mml:mo stretchy="false">]</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>≡</mml:mo><mml:mrow><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>N</mml:mi></mml:mrow></mml:mrow></mml:msup><mml:mo>⁢</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>N</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mi>n</mml:mi></mml:msup></mml:mrow><mml:mo>/</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:mo>!</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>.</p><p>If each TCR only screens <inline-formula><mml:math id="inf185"><mml:mrow><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mi>f</mml:mi><mml:mo>⁢</mml:mo><mml:mi>N</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> self-peptides, with <inline-formula><mml:math id="inf186"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>f</mml:mi><mml:mo>&lt;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula>, then the probability of passing selection (and ending up in spleen) is <inline-formula><mml:math id="inf187"><mml:mrow><mml:mrow><mml:mi>P</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>spleen</mml:mi><mml:mo lspace="2.5pt" rspace="2.5pt" stretchy="false">|</mml:mo><mml:mi>n</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:mo>/</mml:mo><mml:mi>N</mml:mi></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mi>M</mml:mi></mml:msup><mml:mo>≈</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:mo>⁢</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="inf188"><mml:mrow><mml:mrow><mml:mi>P</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>apo</mml:mi><mml:mo lspace="2.5pt" rspace="2.5pt" stretchy="false">|</mml:mo><mml:mi>n</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:mo>⁢</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:mrow></mml:math></inline-formula> for the probability of ending up in apo (as apostosis, i.e. single-positive cells expressing Annexin V as in our experiments).</p><p>We assume that the discriminator of apo vs spleen single positives is perfect, in the sense it can perfectly deduce <inline-formula><mml:math id="inf189"><mml:mi>n</mml:mi></mml:math></inline-formula> from the TCR sequence. In this idealized case, discrimination errors are entirely attributable to the partial screening of self-peptides. Using Bayes’ law, one can show that the distributions of <inline-formula><mml:math id="inf190"><mml:mi>n</mml:mi></mml:math></inline-formula> in spleen and apo read:<disp-formula id="equ10"><label>(10)</label><mml:math id="m10"><mml:mrow><mml:mtable columnalign="right left" rowspacing="4pt" columnspacing="1em"><mml:mtr><mml:mtd><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="normal">s</mml:mi><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">l</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mtd><mml:mtd><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="normal">s</mml:mi><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">l</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="normal">s</mml:mi><mml:mi mathvariant="normal">p</mml:mi><mml:mi mathvariant="normal">l</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">e</mml:mi><mml:mi mathvariant="normal">n</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mrow><mml:mi mathvariant="normal">P</mml:mi><mml:mi mathvariant="normal">o</mml:mi><mml:mi mathvariant="normal">i</mml:mi><mml:mi mathvariant="normal">s</mml:mi><mml:mi mathvariant="normal">s</mml:mi></mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mi>p</mml:mi><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula><disp-formula id="equ11"><label>(11)</label><mml:math id="m11"><mml:mtable columnspacing="5pt" displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>P</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:mo lspace="2.5pt" rspace="2.5pt" stretchy="false">|</mml:mo><mml:mi>apo</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mrow><mml:mi/><mml:mo>=</mml:mo><mml:mstyle displaystyle="false"><mml:mfrac><mml:mrow><mml:mi>P</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>apo</mml:mi><mml:mo lspace="2.5pt" rspace="2.5pt" stretchy="false">|</mml:mo><mml:mi>n</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:mi>P</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>P</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>apo</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mstyle><mml:mo>=</mml:mo><mml:mstyle displaystyle="false"><mml:mfrac><mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>⁢</mml:mo><mml:mi>M</mml:mi></mml:mrow><mml:mo>/</mml:mo><mml:mi>N</mml:mi></mml:mrow></mml:mrow></mml:msup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>N</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mi>n</mml:mi></mml:msup><mml:mo>⁢</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>N</mml:mi></mml:mrow></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>!</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>M</mml:mi></mml:mrow></mml:mrow></mml:msup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mstyle><mml:mo>≈</mml:mo><mml:mrow><mml:mstyle displaystyle="false"><mml:mfrac><mml:mrow><mml:mi>n</mml:mi><mml:mo>⁢</mml:mo><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>N</mml:mi><mml:mo>⁢</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:mfrac></mml:mstyle><mml:mo>⁢</mml:mo><mml:mstyle displaystyle="false"><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>N</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mi>n</mml:mi></mml:msup><mml:mo>⁢</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>N</mml:mi></mml:mrow></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>!</mml:mo></mml:mrow></mml:mfrac></mml:mstyle></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi>Poiss</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>N</mml:mi></mml:mrow><mml:mo stretchy="false">]</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula></p><p>where the first equation results from direct algebra, and the second is obtained in the limit of small <inline-formula><mml:math id="inf191"><mml:mi>f</mml:mi></mml:math></inline-formula>. The AUC of the discrimination task is then given by the probability that drawing a random number from a Poisson of mean <inline-formula><mml:math id="inf192"><mml:mrow><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>f</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> yields a smaller number than drawing a random number from a Poisson of mean <inline-formula><mml:math id="inf193"><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:math></inline-formula>, and adding 1 to it. If we now use the observation of <inline-formula><mml:math id="inf194"><mml:mi>m</mml:mi></mml:math></inline-formula> TCRs from the same subset (apo or spleen) instead of a single one, the task becomes easier: We can form a collective score by adding up the <inline-formula><mml:math id="inf195"><mml:mi>n</mml:mi></mml:math></inline-formula>’s of each TCR (since they are independent draws from either the apo or spleen ensembles) so that the two Poisson distributions, of respective means <inline-formula><mml:math id="inf196"><mml:mrow><mml:mi>m</mml:mi><mml:mo>⁢</mml:mo><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>f</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf197"><mml:mrow><mml:mi>m</mml:mi><mml:mo>⁢</mml:mo><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula>, become better separated. This is qualitatively the result of <xref ref-type="fig" rid="fig3">Figure 3B</xref>, which is based on the learned score, rather than on an idealized one.</p><p>We now turn to the case of self vs foreign peptide discrimination by a group of <inline-formula><mml:math id="inf198"><mml:mi>R</mml:mi></mml:math></inline-formula> T cells recruited to a site of infection. If the peptide is from the self, then the probability for a given circulating TCR to recognize it is <inline-formula><mml:math id="inf199"><mml:mrow><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>f</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> (<xref ref-type="bibr" rid="bib4">Butler et al., 2013</xref>). Then the number of specific TCR is Poisson distributed with mean <inline-formula><mml:math id="inf200"><mml:mrow><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>f</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>⁢</mml:mo><mml:mi>R</mml:mi></mml:mrow></mml:math></inline-formula>. If the peptide is foreign, that number is also Poisson distributed, but with mean <inline-formula><mml:math id="inf201"><mml:mrow><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>R</mml:mi></mml:mrow></mml:math></inline-formula>. Again, the AUC of the discrimination task is given by the probability of drawing a smaller number from the former distribution than from the latter. This task is expected to be at least as hard as that of apo vs spleen TCR discrimination when <inline-formula><mml:math id="inf202"><mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>R</mml:mi></mml:mrow><mml:mo>≈</mml:mo><mml:mrow><mml:mi>m</mml:mi><mml:mo>⁢</mml:mo><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="inf203"><mml:mrow><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>R</mml:mi></mml:mrow></mml:math></inline-formula> is the expected number of TCR specific to the foreign antigen.</p></sec><sec id="s4-15"><title>Other software for statistical analysis</title><p>The Jensen-Shannon dendrograms linkage is computed by the Ward method as provided by the function ‘linkage’, reordered according to the function ‘optimal_leaf_ordering’, both from the Python module ‘cluster.hierarchy’ in <italic>scipy</italic> package (version 1.7.3). The Pearson correlation coefficient is computed with the Python function ‘pearsonr’ as contained in the module ‘stats’ in the <italic>scipy</italic> package. The coefficient of determination <inline-formula><mml:math id="inf204"><mml:msup><mml:mi>R</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:math></inline-formula> is computed with the Python function ‘r2_score’ as contained in the module ‘metrics’ in the <italic>sklearn</italic> package.</p></sec><sec id="s4-16"><title>Code availability</title><p>All code for reproducing the figures of this paper can be found at <ext-link ext-link-type="uri" xlink:href="https://github.com/statbiophys/thymic_development_2022">https://github.com/statbiophys/thymic_development_2022</ext-link>, (copy archived at <ext-link ext-link-type="uri" xlink:href="https://archive.softwareheritage.org/swh:1:dir:a0e7ef5bd127e913092ac17316f40515d58e182a;origin=https://github.com/statbiophys/thymic_development_2022;visit=swh:1:snp:ad43e1eda6f4dabc5d3e2f87694650d6531057c3;anchor=swh:1:rev:ce4966eee8937544d8c97ff956a049fc32d279da">swh:1:rev:ce4966eee8937544d8c97ff956a049fc32d279da</ext-link>; <xref ref-type="bibr" rid="bib5">Camaglia, 2022</xref>).</p></sec></sec></body><back><sec sec-type="additional-information" id="s5"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="COI-statement" id="conf1"><p>No competing interests declared</p></fn><fn fn-type="COI-statement" id="conf2"><p>No competing interests declared</p></fn><fn fn-type="COI-statement" id="conf3"><p>Senior editor, eLife</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>Conceptualization, Data curation, Software, Formal analysis, Validation, Investigation, Visualization, Methodology, Writing – original draft, Writing – review and editing</p></fn><fn fn-type="con" id="con2"><p>Data curation, Validation, Investigation, Methodology, Writing – review and editing</p></fn><fn fn-type="con" id="con3"><p>Conceptualization, Resources, Data curation, Formal analysis, Validation, Investigation, Visualization, Methodology, Writing – review and editing</p></fn><fn fn-type="con" id="con4"><p>Resources, Supervision, Methodology</p></fn><fn fn-type="con" id="con5"><p>Supervision, Writing – original draft, Project administration, Writing – review and editing</p></fn><fn fn-type="con" id="con6"><p>Conceptualization, Resources, Formal analysis, Supervision, Funding acquisition, Investigation, Visualization, Methodology, Writing – original draft, Project administration, Writing – review and editing</p></fn><fn fn-type="con" id="con7"><p>Conceptualization, Resources, Formal analysis, Supervision, Funding acquisition, Investigation, Methodology, Writing – original draft, Project administration, Writing – review and editing</p></fn><fn fn-type="con" id="con8"><p>Conceptualization, Resources, Data curation, Supervision, Funding acquisition, Validation, Investigation, Methodology, Project administration</p></fn></fn-group><fn-group content-type="ethics-information"><title>Ethics</title><fn fn-type="other"><p>The experiment was carried out using three 6-weeks old male inbred Nur77-GFP/Foxp3-mCherry (C57BL/6 background). The cross was bred and maintained at the Weizmann institute. All animals were handled according to Weizmann Institute's Animal Care guidelines, in compliance with national and international regulations. This study was performed in strict accordance with the recommendations in the Guide for the Care and Use of Laboratory Animals of the National Institutes of Health. All of the animals were handled according to approved institutional animal care and use committee (IACUC) protocols (#21661115-2) of the Weizmann Institute of Science. The protocol was approved by the Committee on the Ethics of Animal Experiments of the Weizmann Institute of Science. Every effort was made to minimize suffering.</p></fn></fn-group></sec><sec sec-type="supplementary-material" id="s6"><title>Additional files</title><supplementary-material id="mdar"><label>MDAR checklist</label><media xlink:href="elife-81622-mdarchecklist1-v2.pdf" mimetype="application" mime-subtype="pdf"/></supplementary-material><supplementary-material id="supp1"><label>Supplementary file 1.</label><caption><title>Primers list.</title></caption><media xlink:href="elife-81622-supp1-v2.xlsx" mimetype="application" mime-subtype="xlsx"/></supplementary-material><supplementary-material id="supp2"><label>Supplementary file 2.</label><caption><title>Cell counts.</title></caption><media xlink:href="elife-81622-supp2-v2.xlsx" mimetype="application" mime-subtype="xlsx"/></supplementary-material></sec><sec sec-type="data-availability" id="s7"><title>Data availability</title><p>All code for reproducing the figures of this paper can be found at <ext-link ext-link-type="uri" xlink:href="https://github.com/statbiophys/thymic_development_2022.git">https://github.com/statbiophys/thymic_development_2022.git</ext-link>, (copy archived at <ext-link ext-link-type="uri" xlink:href="https://archive.softwareheritage.org/swh:1:dir:a0e7ef5bd127e913092ac17316f40515d58e182a;origin=https://github.com/statbiophys/thymic_development_2022;visit=swh:1:snp:ad43e1eda6f4dabc5d3e2f87694650d6531057c3;anchor=swh:1:rev:ce4966eee8937544d8c97ff956a049fc32d279da">swh:1:rev:ce4966eee8937544d8c97ff956a049fc32d279da</ext-link>). The data has been deposited on the SRA as BioProject ID PRJNA804508 <ext-link ext-link-type="uri" xlink:href="http://www.ncbi.nlm.nih.gov/bioproject/804508">http://www.ncbi.nlm.nih.gov/bioproject/804508</ext-link>.</p><p>The following dataset was generated:</p><p><element-citation publication-type="data" specific-use="isSupplementedBy" id="dataset1"><person-group person-group-type="author"><name><surname>Camaglia</surname><given-names>F</given-names></name><name><surname>Ryvkin</surname><given-names>A</given-names></name><name><surname>Greenstein</surname><given-names>E</given-names></name><name><surname>Reich-Zeliger</surname><given-names>S</given-names></name><name><surname>Benny Chain</surname><given-names>TM</given-names></name><name><surname>Aleksandra</surname><given-names>MW</given-names></name><name><surname>Nir</surname><given-names>F</given-names></name></person-group><year iso-8601-date="2022">2022</year><data-title>thymic selection repertoires mice</data-title><source>NCBI BioProject</source><pub-id pub-id-type="accession" xlink:href="http://www.ncbi.nlm.nih.gov/bioproject/PRJNA804508">PRJNA804508</pub-id></element-citation></p></sec><ack id="ack"><title>Acknowledgements</title><p>The study was supported by a ‘80 prime’ CNRS-Weizmann PhD scholarship, European Research Council COG 724208 and ANR-19-CE45-0018 ‘RESP- REP’ from the Agence Nationale de la Recherche and DFG grant CRC 1310 ‘Predictability in Evolution’.</p></ack><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Archer</surname><given-names>E</given-names></name><name><surname>Park</surname><given-names>IM</given-names></name><name><surname>Pillow</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Bayesian Entropy Estimation for Countable Discrete Distributions</article-title><source>arXiv</source><ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/1302.0328">https://arxiv.org/abs/1302.0328</ext-link></element-citation></ref><ref id="bib2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bains</surname><given-names>I</given-names></name><name><surname>Yates</surname><given-names>AJ</given-names></name><name><surname>Callard</surname><given-names>RE</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Heterogeneity in thymic emigrants: implications for thymectomy and immunosenescence</article-title><source>PLOS ONE</source><volume>8</volume><elocation-id>e49554</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0049554</pub-id><pub-id pub-id-type="pmid">23468830</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bolger</surname><given-names>AM</given-names></name><name><surname>Lohse</surname><given-names>M</given-names></name><name><surname>Usadel</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Trimmomatic: a flexible trimmer for illumina sequence data</article-title><source>Bioinformatics</source><volume>30</volume><fpage>2114</fpage><lpage>2120</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btu170</pub-id><pub-id pub-id-type="pmid">24695404</pub-id></element-citation></ref><ref id="bib4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Butler</surname><given-names>TC</given-names></name><name><surname>Kardar</surname><given-names>M</given-names></name><name><surname>Chakraborty</surname><given-names>AK</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Quorum sensing allows T cells to discriminate between self and nonself</article-title><source>PNAS</source><volume>110</volume><fpage>11833</fpage><lpage>11838</lpage><pub-id pub-id-type="doi">10.1073/pnas.1222467110</pub-id><pub-id pub-id-type="pmid">23818603</pub-id></element-citation></ref><ref id="bib5"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Camaglia</surname><given-names>F</given-names></name></person-group><year iso-8601-date="2022">2022</year><data-title>Thymic_development_2022</data-title><version designator="swh:1:rev:ce4966eee8937544d8c97ff956a049fc32d279da">swh:1:rev:ce4966eee8937544d8c97ff956a049fc32d279da</version><source>Software Heritage</source><ext-link ext-link-type="uri" xlink:href="https://archive.softwareheritage.org/swh:1:dir:a0e7ef5bd127e913092ac17316f40515d58e182a;origin=https://github.com/statbiophys/thymic_development_2022;visit=swh:1:snp:ad43e1eda6f4dabc5d3e2f87694650d6531057c3;anchor=swh:1:rev:ce4966eee8937544d8c97ff956a049fc32d279da">https://archive.softwareheritage.org/swh:1:dir:a0e7ef5bd127e913092ac17316f40515d58e182a;origin=https://github.com/statbiophys/thymic_development_2022;visit=swh:1:snp:ad43e1eda6f4dabc5d3e2f87694650d6531057c3;anchor=swh:1:rev:ce4966eee8937544d8c97ff956a049fc32d279da</ext-link></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Carter</surname><given-names>JA</given-names></name><name><surname>Preall</surname><given-names>JB</given-names></name><name><surname>Grigaityte</surname><given-names>K</given-names></name><name><surname>Goldfless</surname><given-names>SJ</given-names></name><name><surname>Jeffery</surname><given-names>E</given-names></name><name><surname>Briggs</surname><given-names>AW</given-names></name><name><surname>Vigneault</surname><given-names>F</given-names></name><name><surname>Atwal</surname><given-names>GS</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Single T cell sequencing demonstrates the functional role of <italic>αβ</italic> TCR pairing in cell lineage and antigen specificity</article-title><source>Frontiers in Immunology</source><volume>10</volume><elocation-id>1516</elocation-id><pub-id pub-id-type="doi">10.3389/fimmu.2019.01516</pub-id><pub-id pub-id-type="pmid">31417541</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chao</surname><given-names>A</given-names></name><name><surname>Shen</surname><given-names>TJ</given-names></name></person-group><year iso-8601-date="2003">2003</year><article-title>Nonparametric estimation of shannon’s index of diversity when there are unseen species in sample</article-title><source>Environmental and Ecological Statistics</source><volume>10</volume><fpage>429</fpage><lpage>443</lpage><pub-id pub-id-type="doi">10.1023/A:1026096204727</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cinelli</surname><given-names>M</given-names></name><name><surname>Sun</surname><given-names>Y</given-names></name><name><surname>Best</surname><given-names>K</given-names></name><name><surname>Heather</surname><given-names>JM</given-names></name><name><surname>Reich-Zeliger</surname><given-names>S</given-names></name><name><surname>Shifrut</surname><given-names>E</given-names></name><name><surname>Friedman</surname><given-names>N</given-names></name><name><surname>Shawe-Taylor</surname><given-names>J</given-names></name><name><surname>Chain</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Feature selection using a one dimensional naïve bayes’ classifier increases the accuracy of support vector machine classification of CDR3 repertoires</article-title><source>Bioinformatics</source><volume>33</volume><fpage>951</fpage><lpage>955</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btw771</pub-id><pub-id pub-id-type="pmid">28073756</pub-id></element-citation></ref><ref id="bib9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Daley</surname><given-names>SR</given-names></name><name><surname>Koay</surname><given-names>HF</given-names></name><name><surname>Dobbs</surname><given-names>K</given-names></name><name><surname>Bosticardo</surname><given-names>M</given-names></name><name><surname>Wirasinha</surname><given-names>RC</given-names></name><name><surname>Pala</surname><given-names>F</given-names></name><name><surname>Castagnoli</surname><given-names>R</given-names></name><name><surname>Rowe</surname><given-names>JH</given-names></name><name><surname>Ott de Bruin</surname><given-names>LM</given-names></name><name><surname>Keles</surname><given-names>S</given-names></name><name><surname>Lee</surname><given-names>YN</given-names></name><name><surname>Somech</surname><given-names>R</given-names></name><name><surname>Holland</surname><given-names>SM</given-names></name><name><surname>Delmonte</surname><given-names>OM</given-names></name><name><surname>Draper</surname><given-names>D</given-names></name><name><surname>Maxwell</surname><given-names>S</given-names></name><name><surname>Niemela</surname><given-names>J</given-names></name><name><surname>Stoddard</surname><given-names>J</given-names></name><name><surname>Rosenzweig</surname><given-names>SD</given-names></name><name><surname>Poliani</surname><given-names>PL</given-names></name><name><surname>Capo</surname><given-names>V</given-names></name><name><surname>Villa</surname><given-names>A</given-names></name><name><surname>Godfrey</surname><given-names>DI</given-names></name><name><surname>Notarangelo</surname><given-names>LD</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Cysteine and hydrophobic residues in CDR3 serve as distinct T-cell self-reactivity indices</article-title><source>The Journal of Allergy and Clinical Immunology</source><volume>144</volume><fpage>333</fpage><lpage>336</lpage><pub-id pub-id-type="doi">10.1016/j.jaci.2019.03.022</pub-id><pub-id pub-id-type="pmid">31053347</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dupic</surname><given-names>T</given-names></name><name><surname>Marcou</surname><given-names>Q</given-names></name><name><surname>Walczak</surname><given-names>AM</given-names></name><name><surname>Mora</surname><given-names>T</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Genesis of the αβ T-cell receptor</article-title><source>PLOS Computational Biology</source><volume>15</volume><elocation-id>e1006874</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1006874</pub-id><pub-id pub-id-type="pmid">30830899</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Elhanati</surname><given-names>Y</given-names></name><name><surname>Murugan</surname><given-names>A</given-names></name><name><surname>Callan</surname><given-names>CG</given-names></name><name><surname>Mora</surname><given-names>T</given-names></name><name><surname>Walczak</surname><given-names>AM</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Quantifying selection in immune receptor repertoires</article-title><source>PNAS</source><volume>111</volume><fpage>9875</fpage><lpage>9880</lpage><pub-id pub-id-type="doi">10.1073/pnas.1409572111</pub-id><pub-id pub-id-type="pmid">24941953</pub-id></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Emerson</surname><given-names>R</given-names></name><name><surname>Sherwood</surname><given-names>A</given-names></name><name><surname>Desmarais</surname><given-names>C</given-names></name><name><surname>Malhotra</surname><given-names>S</given-names></name><name><surname>Phippard</surname><given-names>D</given-names></name><name><surname>Robins</surname><given-names>H</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Estimating the ratio of CD4+ to CD8+ T cells using high-throughput sequence data</article-title><source>Journal of Immunological Methods</source><volume>391</volume><fpage>14</fpage><lpage>21</lpage><pub-id pub-id-type="doi">10.1016/j.jim.2013.02.002</pub-id><pub-id pub-id-type="pmid">23428915</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gallegos</surname><given-names>AM</given-names></name><name><surname>Bevan</surname><given-names>MJ</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Central tolerance: good but imperfect</article-title><source>Immunological Reviews</source><volume>209</volume><fpage>290</fpage><lpage>296</lpage><pub-id pub-id-type="doi">10.1111/j.0105-2896.2006.00348.x</pub-id><pub-id pub-id-type="pmid">16448550</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Garner</surname><given-names>LC</given-names></name><name><surname>Klenerman</surname><given-names>P</given-names></name><name><surname>Provine</surname><given-names>NM</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Insights into mucosal-associated invariant T cell biology from studies of invariant natural killer T cells</article-title><source>Frontiers in Immunology</source><volume>9</volume><elocation-id>1478</elocation-id><pub-id pub-id-type="doi">10.3389/fimmu.2018.01478</pub-id><pub-id pub-id-type="pmid">30013556</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gray</surname><given-names>DHD</given-names></name><name><surname>Seach</surname><given-names>N</given-names></name><name><surname>Ueno</surname><given-names>T</given-names></name><name><surname>Milton</surname><given-names>MK</given-names></name><name><surname>Liston</surname><given-names>A</given-names></name><name><surname>Lew</surname><given-names>AM</given-names></name><name><surname>Goodnow</surname><given-names>CC</given-names></name><name><surname>Boyd</surname><given-names>RL</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Developmental kinetics, turnover, and stimulatory capacity of thymic epithelial cells</article-title><source>Blood</source><volume>108</volume><fpage>3777</fpage><lpage>3785</lpage><pub-id pub-id-type="doi">10.1182/blood-2006-02-004531</pub-id><pub-id pub-id-type="pmid">16896157</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Grigaityte</surname><given-names>K</given-names></name><name><surname>Carter</surname><given-names>JA</given-names></name><name><surname>Goldfless</surname><given-names>SJ</given-names></name><name><surname>Jeffery</surname><given-names>EW</given-names></name><name><surname>Hause</surname><given-names>RJ</given-names></name><name><surname>Jiang</surname><given-names>Y</given-names></name><name><surname>Koppstein</surname><given-names>D</given-names></name><name><surname>Briggs</surname><given-names>AW</given-names></name><name><surname>Church</surname><given-names>GM</given-names></name><name><surname>Vigneault</surname><given-names>F</given-names></name><name><surname>Atwal</surname><given-names>GS</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Single-Cell Sequencing Reveals Αβ Chain Pairing Shapes the T Cell Repertoire</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/213462</pub-id></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hamming</surname><given-names>RW</given-names></name></person-group><year iso-8601-date="1950">1950</year><article-title>Error detecting and error correcting codes</article-title><source>Bell System Technical Journal</source><volume>29</volume><fpage>147</fpage><lpage>160</lpage><pub-id pub-id-type="doi">10.1002/j.1538-7305.1950.tb00463.x</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hozumi</surname><given-names>N</given-names></name><name><surname>Tonegawa</surname><given-names>S</given-names></name></person-group><year iso-8601-date="1976">1976</year><article-title>Evidence for somatic rearrangement of immunoglobulin genes coding for variable and constant regions</article-title><source>PNAS</source><volume>73</volume><fpage>3628</fpage><lpage>3632</lpage><pub-id pub-id-type="doi">10.1073/pnas.73.10.3628</pub-id><pub-id pub-id-type="pmid">824647</pub-id></element-citation></ref><ref id="bib19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Isacchini</surname><given-names>G</given-names></name><name><surname>Walczak</surname><given-names>AM</given-names></name><name><surname>Mora</surname><given-names>T</given-names></name><name><surname>Nourmohammad</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Deep generative selection models of T and B cell receptor repertoires with sonnia</article-title><source>PNAS</source><volume>118</volume><elocation-id>14</elocation-id><pub-id pub-id-type="doi">10.1073/pnas.2023141118</pub-id><pub-id pub-id-type="pmid">33795515</pub-id></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Izraelson</surname><given-names>M</given-names></name><name><surname>Nakonechnaya</surname><given-names>TO</given-names></name><name><surname>Moltedo</surname><given-names>B</given-names></name><name><surname>Egorov</surname><given-names>ES</given-names></name><name><surname>Kasatskaya</surname><given-names>SA</given-names></name><name><surname>Putintseva</surname><given-names>EV</given-names></name><name><surname>Mamedov</surname><given-names>IZ</given-names></name><name><surname>Staroverov</surname><given-names>DB</given-names></name><name><surname>Shemiakina</surname><given-names>II</given-names></name><name><surname>Zakharova</surname><given-names>MY</given-names></name><name><surname>Davydov</surname><given-names>AN</given-names></name><name><surname>Bolotin</surname><given-names>DA</given-names></name><name><surname>Shugay</surname><given-names>M</given-names></name><name><surname>Chudakov</surname><given-names>DM</given-names></name><name><surname>Rudensky</surname><given-names>AY</given-names></name><name><surname>Britanova</surname><given-names>OV</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Comparative analysis of murine T-cell receptor repertoires</article-title><source>Immunology</source><volume>153</volume><fpage>133</fpage><lpage>144</lpage><pub-id pub-id-type="doi">10.1111/imm.12857</pub-id><pub-id pub-id-type="pmid">29080364</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>King</surname><given-names>JL</given-names></name><name><surname>Jukes</surname><given-names>TH</given-names></name></person-group><year iso-8601-date="1969">1969</year><article-title>Non-darwinian evolution</article-title><source>Science</source><volume>164</volume><fpage>788</fpage><lpage>798</lpage><pub-id pub-id-type="doi">10.1126/science.164.3881.788</pub-id><pub-id pub-id-type="pmid">5767777</pub-id></element-citation></ref><ref id="bib22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kosmrlj</surname><given-names>A</given-names></name><name><surname>Chakraborty</surname><given-names>AK</given-names></name><name><surname>Kardar</surname><given-names>M</given-names></name><name><surname>Shakhnovich</surname><given-names>EI</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Thymic selection of T-cell receptors as an extreme value problem</article-title><source>Physical Review Letters</source><volume>103</volume><elocation-id>068103</elocation-id><pub-id pub-id-type="doi">10.1103/PhysRevLett.103.068103</pub-id><pub-id pub-id-type="pmid">19792616</pub-id></element-citation></ref><ref id="bib23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lagattuta</surname><given-names>KA</given-names></name><name><surname>Kang</surname><given-names>JB</given-names></name><name><surname>Nathan</surname><given-names>A</given-names></name><name><surname>Pauken</surname><given-names>KE</given-names></name><name><surname>Jonsson</surname><given-names>AH</given-names></name><name><surname>Rao</surname><given-names>DA</given-names></name><name><surname>Sharpe</surname><given-names>AH</given-names></name><name><surname>Ishigaki</surname><given-names>K</given-names></name><name><surname>Raychaudhuri</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2022">2022</year><article-title>Repertoire analyses reveal T cell antigen receptor sequence features that influence T cell fate</article-title><source>Nature Immunology</source><volume>23</volume><fpage>446</fpage><lpage>457</lpage><pub-id pub-id-type="doi">10.1038/s41590-022-01129-x</pub-id><pub-id pub-id-type="pmid">35177831</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lefranc</surname><given-names>MP</given-names></name><name><surname>Giudicelli</surname><given-names>V</given-names></name><name><surname>Duroux</surname><given-names>P</given-names></name><name><surname>Jabado-Michaloud</surname><given-names>J</given-names></name><name><surname>Folch</surname><given-names>G</given-names></name><name><surname>Aouinti</surname><given-names>S</given-names></name><name><surname>Carillon</surname><given-names>E</given-names></name><name><surname>Duvergey</surname><given-names>H</given-names></name><name><surname>Houles</surname><given-names>A</given-names></name><name><surname>Paysan-Lafosse</surname><given-names>T</given-names></name><name><surname>Hadi-Saljoqi</surname><given-names>S</given-names></name><name><surname>Sasorith</surname><given-names>S</given-names></name><name><surname>Lefranc</surname><given-names>G</given-names></name><name><surname>Kossida</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>IMGT, the international immunogenetics information system 25 years on</article-title><source>Nucleic Acids Research</source><volume>43</volume><fpage>D413</fpage><lpage>D422</lpage><pub-id pub-id-type="doi">10.1093/nar/gku1056</pub-id><pub-id pub-id-type="pmid">25378316</pub-id></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Levenshtein</surname><given-names>VI</given-names></name></person-group><year iso-8601-date="1966">1966</year><article-title>Binary codes capable of correcting deletions, insertions, and reversals</article-title><source>Soviet Physics Doklady</source><volume>10</volume><fpage>707</fpage><lpage>710</lpage></element-citation></ref><ref id="bib26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liebmann</surname><given-names>M</given-names></name><name><surname>Hucke</surname><given-names>S</given-names></name><name><surname>Koch</surname><given-names>K</given-names></name><name><surname>Eschborn</surname><given-names>M</given-names></name><name><surname>Ghelman</surname><given-names>J</given-names></name><name><surname>Chasan</surname><given-names>AI</given-names></name><name><surname>Glander</surname><given-names>S</given-names></name><name><surname>Schädlich</surname><given-names>M</given-names></name><name><surname>Kuhlencord</surname><given-names>M</given-names></name><name><surname>Daber</surname><given-names>NM</given-names></name><name><surname>Eveslage</surname><given-names>M</given-names></name><name><surname>Beyer</surname><given-names>M</given-names></name><name><surname>Dietrich</surname><given-names>M</given-names></name><name><surname>Albrecht</surname><given-names>P</given-names></name><name><surname>Stoll</surname><given-names>M</given-names></name><name><surname>Busch</surname><given-names>KB</given-names></name><name><surname>Wiendl</surname><given-names>H</given-names></name><name><surname>Roth</surname><given-names>J</given-names></name><name><surname>Kuhlmann</surname><given-names>T</given-names></name><name><surname>Klotz</surname><given-names>L</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Nur77 serves as a molecular brake of the metabolic switch during T cell activation to restrict autoimmunity</article-title><source>PNAS</source><volume>115</volume><fpage>E8017</fpage><lpage>E8026</lpage><pub-id pub-id-type="doi">10.1073/pnas.1721049115</pub-id><pub-id pub-id-type="pmid">30072431</pub-id></element-citation></ref><ref id="bib27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lu</surname><given-names>J</given-names></name><name><surname>Van Laethem</surname><given-names>F</given-names></name><name><surname>Bhattacharya</surname><given-names>A</given-names></name><name><surname>Craveiro</surname><given-names>M</given-names></name><name><surname>Saba</surname><given-names>I</given-names></name><name><surname>Chu</surname><given-names>J</given-names></name><name><surname>Love</surname><given-names>NC</given-names></name><name><surname>Tikhonova</surname><given-names>A</given-names></name><name><surname>Radaev</surname><given-names>S</given-names></name><name><surname>Sun</surname><given-names>X</given-names></name><name><surname>Ko</surname><given-names>A</given-names></name><name><surname>Arnon</surname><given-names>T</given-names></name><name><surname>Shifrut</surname><given-names>E</given-names></name><name><surname>Friedman</surname><given-names>N</given-names></name><name><surname>Weng</surname><given-names>NP</given-names></name><name><surname>Singer</surname><given-names>A</given-names></name><name><surname>Sun</surname><given-names>PD</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Molecular constraints on CDR3 for thymic selection of MHC-restricted tcrs from a random pre-selection repertoire</article-title><source>Nature Communications</source><volume>10</volume><elocation-id>1019</elocation-id><pub-id pub-id-type="doi">10.1038/s41467-019-08906-7</pub-id><pub-id pub-id-type="pmid">30833553</pub-id></element-citation></ref><ref id="bib28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Madi</surname><given-names>A</given-names></name><name><surname>Shifrut</surname><given-names>E</given-names></name><name><surname>Reich-Zeliger</surname><given-names>S</given-names></name><name><surname>Gal</surname><given-names>H</given-names></name><name><surname>Best</surname><given-names>K</given-names></name><name><surname>Ndifon</surname><given-names>W</given-names></name><name><surname>Chain</surname><given-names>B</given-names></name><name><surname>Cohen</surname><given-names>IR</given-names></name><name><surname>Friedman</surname><given-names>N</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>T-cell receptor repertoires share a restricted set of public and abundant CDR3 sequences that are associated with self-related immunity</article-title><source>Genome Research</source><volume>24</volume><fpage>1603</fpage><lpage>1612</lpage><pub-id pub-id-type="doi">10.1101/gr.170753.113</pub-id><pub-id pub-id-type="pmid">25024161</pub-id></element-citation></ref><ref id="bib29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Madi</surname><given-names>A</given-names></name><name><surname>Poran</surname><given-names>A</given-names></name><name><surname>Shifrut</surname><given-names>E</given-names></name><name><surname>Reich-Zeliger</surname><given-names>S</given-names></name><name><surname>Greenstein</surname><given-names>E</given-names></name><name><surname>Zaretsky</surname><given-names>I</given-names></name><name><surname>Arnon</surname><given-names>T</given-names></name><name><surname>Laethem</surname><given-names>FV</given-names></name><name><surname>Singer</surname><given-names>A</given-names></name><name><surname>Lu</surname><given-names>J</given-names></name><name><surname>Sun</surname><given-names>PD</given-names></name><name><surname>Cohen</surname><given-names>IR</given-names></name><name><surname>Friedman</surname><given-names>N</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>T cell receptor repertoires of mice and humans are clustered in similarity networks around conserved public CDR3 sequences</article-title><source>eLife</source><volume>6</volume><elocation-id>e22057</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.22057</pub-id><pub-id pub-id-type="pmid">28731407</pub-id></element-citation></ref><ref id="bib30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Marcou</surname><given-names>Q</given-names></name><name><surname>Mora</surname><given-names>T</given-names></name><name><surname>Walczak</surname><given-names>AM</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>High-throughput immune repertoire analysis with igor</article-title><source>Nature Communications</source><volume>9</volume><elocation-id>561</elocation-id><pub-id pub-id-type="doi">10.1038/s41467-018-02832-w</pub-id><pub-id pub-id-type="pmid">29422654</pub-id></element-citation></ref><ref id="bib31"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Miller</surname><given-names>G</given-names></name></person-group><year iso-8601-date="1955">1955</year><article-title>Note on the bias of information estimates</article-title><conf-name>Information Theory in Psychology: Problems and Methods</conf-name><fpage>95</fpage><lpage>100</lpage></element-citation></ref><ref id="bib32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Montemurro</surname><given-names>A</given-names></name><name><surname>Schuster</surname><given-names>V</given-names></name><name><surname>Povlsen</surname><given-names>HR</given-names></name><name><surname>Bentzen</surname><given-names>AK</given-names></name><name><surname>Jurtz</surname><given-names>V</given-names></name><name><surname>Chronister</surname><given-names>WD</given-names></name><name><surname>Crinklaw</surname><given-names>A</given-names></name><name><surname>Hadrup</surname><given-names>SR</given-names></name><name><surname>Winther</surname><given-names>O</given-names></name><name><surname>Peters</surname><given-names>B</given-names></name><name><surname>Jessen</surname><given-names>LE</given-names></name><name><surname>Nielsen</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>NetTCR-2.0 enables accurate prediction of TCR-peptide binding by using paired TCRα and β sequence data</article-title><source>Communications Biology</source><volume>4</volume><elocation-id>1060</elocation-id><pub-id pub-id-type="doi">10.1038/s42003-021-02610-3</pub-id><pub-id pub-id-type="pmid">34508155</pub-id></element-citation></ref><ref id="bib33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Moran</surname><given-names>AE</given-names></name><name><surname>Holzapfel</surname><given-names>KL</given-names></name><name><surname>Xing</surname><given-names>Y</given-names></name><name><surname>Cunningham</surname><given-names>NR</given-names></name><name><surname>Maltzman</surname><given-names>JS</given-names></name><name><surname>Punt</surname><given-names>J</given-names></name><name><surname>Hogquist</surname><given-names>KA</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>T cell receptor signal strength in Treg and iNKT cell development demonstrated by a novel fluorescent reporter mouse</article-title><source>The Journal of Experimental Medicine</source><volume>208</volume><fpage>1279</fpage><lpage>1289</lpage><pub-id pub-id-type="doi">10.1084/jem.20110308</pub-id><pub-id pub-id-type="pmid">21606508</pub-id></element-citation></ref><ref id="bib34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Murugan</surname><given-names>A</given-names></name><name><surname>Mora</surname><given-names>T</given-names></name><name><surname>Walczak</surname><given-names>AM</given-names></name><name><surname>Callan</surname><given-names>CG</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Statistical inference of the generation probability of T-cell receptors from sequence repertoires</article-title><source>PNAS</source><volume>109</volume><fpage>16161</fpage><lpage>16166</lpage><pub-id pub-id-type="doi">10.1073/pnas.1212755109</pub-id><pub-id pub-id-type="pmid">22988065</pub-id></element-citation></ref><ref id="bib35"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Nemenman</surname><given-names>I</given-names></name><name><surname>Shafee</surname><given-names>F</given-names></name><name><surname>Bialek</surname><given-names>W</given-names></name></person-group><year iso-8601-date="2002">2002</year><article-title>Entropy and Inference, Revisited</article-title><source>arXiv</source><ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/physics/0108025">https://arxiv.org/abs/physics/0108025</ext-link></element-citation></ref><ref id="bib36"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Oakes</surname><given-names>T</given-names></name><name><surname>Heather</surname><given-names>JM</given-names></name><name><surname>Best</surname><given-names>K</given-names></name><name><surname>Byng-Maddick</surname><given-names>R</given-names></name><name><surname>Husovsky</surname><given-names>C</given-names></name><name><surname>Ismail</surname><given-names>M</given-names></name><name><surname>Joshi</surname><given-names>K</given-names></name><name><surname>Maxwell</surname><given-names>G</given-names></name><name><surname>Noursadeghi</surname><given-names>M</given-names></name><name><surname>Riddell</surname><given-names>N</given-names></name><name><surname>Ruehl</surname><given-names>T</given-names></name><name><surname>Turner</surname><given-names>CT</given-names></name><name><surname>Uddin</surname><given-names>I</given-names></name><name><surname>Chain</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Quantitative characterization of the T cell receptor repertoire of naïve and memory subsets using an integrated experimental and computational pipeline which is robust, economical, and versatile</article-title><source>Frontiers in Immunology</source><volume>8</volume><elocation-id>1267</elocation-id><pub-id pub-id-type="doi">10.3389/fimmu.2017.01267</pub-id><pub-id pub-id-type="pmid">29075258</pub-id></element-citation></ref><ref id="bib37"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Park</surname><given-names>JE</given-names></name><name><surname>Botting</surname><given-names>RA</given-names></name><name><surname>Domínguez Conde</surname><given-names>C</given-names></name><name><surname>Popescu</surname><given-names>DM</given-names></name><name><surname>Lavaert</surname><given-names>M</given-names></name><name><surname>Kunz</surname><given-names>DJ</given-names></name><name><surname>Goh</surname><given-names>I</given-names></name><name><surname>Stephenson</surname><given-names>E</given-names></name><name><surname>Ragazzini</surname><given-names>R</given-names></name><name><surname>Tuck</surname><given-names>E</given-names></name><name><surname>Wilbrey-Clark</surname><given-names>A</given-names></name><name><surname>Roberts</surname><given-names>K</given-names></name><name><surname>Kedlian</surname><given-names>VR</given-names></name><name><surname>Ferdinand</surname><given-names>JR</given-names></name><name><surname>He</surname><given-names>X</given-names></name><name><surname>Webb</surname><given-names>S</given-names></name><name><surname>Maunder</surname><given-names>D</given-names></name><name><surname>Vandamme</surname><given-names>N</given-names></name><name><surname>Mahbubani</surname><given-names>KT</given-names></name><name><surname>Polanski</surname><given-names>K</given-names></name><name><surname>Mamanova</surname><given-names>L</given-names></name><name><surname>Bolt</surname><given-names>L</given-names></name><name><surname>Crossland</surname><given-names>D</given-names></name><name><surname>de Rita</surname><given-names>F</given-names></name><name><surname>Fuller</surname><given-names>A</given-names></name><name><surname>Filby</surname><given-names>A</given-names></name><name><surname>Reynolds</surname><given-names>G</given-names></name><name><surname>Dixon</surname><given-names>D</given-names></name><name><surname>Saeb-Parsy</surname><given-names>K</given-names></name><name><surname>Lisgo</surname><given-names>S</given-names></name><name><surname>Henderson</surname><given-names>D</given-names></name><name><surname>Vento-Tormo</surname><given-names>R</given-names></name><name><surname>Bayraktar</surname><given-names>OA</given-names></name><name><surname>Barker</surname><given-names>RA</given-names></name><name><surname>Meyer</surname><given-names>KB</given-names></name><name><surname>Saeys</surname><given-names>Y</given-names></name><name><surname>Bonfanti</surname><given-names>P</given-names></name><name><surname>Behjati</surname><given-names>S</given-names></name><name><surname>Clatworthy</surname><given-names>MR</given-names></name><name><surname>Taghon</surname><given-names>T</given-names></name><name><surname>Haniffa</surname><given-names>M</given-names></name><name><surname>Teichmann</surname><given-names>SA</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>A cell atlas of human thymic development defines T cell repertoire formation</article-title><source>Science</source><volume>367</volume><elocation-id>eaay3224</elocation-id><pub-id pub-id-type="doi">10.1126/science.aay3224</pub-id><pub-id pub-id-type="pmid">32079746</pub-id></element-citation></ref><ref id="bib38"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Polonsky</surname><given-names>M</given-names></name><name><surname>Rimer</surname><given-names>J</given-names></name><name><surname>Kern-Perets</surname><given-names>A</given-names></name><name><surname>Zaretsky</surname><given-names>I</given-names></name><name><surname>Miller</surname><given-names>S</given-names></name><name><surname>Bornstein</surname><given-names>C</given-names></name><name><surname>David</surname><given-names>E</given-names></name><name><surname>Kopelman</surname><given-names>NM</given-names></name><name><surname>Stelzer</surname><given-names>G</given-names></name><name><surname>Porat</surname><given-names>Z</given-names></name><name><surname>Chain</surname><given-names>B</given-names></name><name><surname>Friedman</surname><given-names>N</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Induction of CD4 T cell memory by local cellular collectivity</article-title><source>Science</source><volume>360</volume><elocation-id>eaaj1853</elocation-id><pub-id pub-id-type="doi">10.1126/science.aaj1853</pub-id><pub-id pub-id-type="pmid">29903938</pub-id></element-citation></ref><ref id="bib39"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Robert</surname><given-names>PA</given-names></name><name><surname>Kunze-Schumacher</surname><given-names>H</given-names></name><name><surname>Greiff</surname><given-names>V</given-names></name><name><surname>Krueger</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Modeling the dynamics of T-cell development in the thymus</article-title><source>Entropy</source><volume>23</volume><elocation-id>437</elocation-id><pub-id pub-id-type="doi">10.3390/e23040437</pub-id><pub-id pub-id-type="pmid">33918050</pub-id></element-citation></ref><ref id="bib40"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sethna</surname><given-names>Z</given-names></name><name><surname>Elhanati</surname><given-names>Y</given-names></name><name><surname>Dudgeon</surname><given-names>CS</given-names></name><name><surname>Callan</surname><given-names>CG</given-names></name><name><surname>Levine</surname><given-names>AJ</given-names></name><name><surname>Mora</surname><given-names>T</given-names></name><name><surname>Walczak</surname><given-names>AM</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Insights into immune system development and function from mouse T-cell repertoires</article-title><source>PNAS</source><volume>114</volume><fpage>2253</fpage><lpage>2258</lpage><pub-id pub-id-type="doi">10.1073/pnas.1700241114</pub-id><pub-id pub-id-type="pmid">28196891</pub-id></element-citation></ref><ref id="bib41"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sethna</surname><given-names>Z</given-names></name><name><surname>Isacchini</surname><given-names>G</given-names></name><name><surname>Dupic</surname><given-names>T</given-names></name><name><surname>Mora</surname><given-names>T</given-names></name><name><surname>Walczak</surname><given-names>AM</given-names></name><name><surname>Elhanati</surname><given-names>Y</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Population variability in the generation and selection of T-cell repertoires</article-title><source>PLOS Computational Biology</source><volume>16</volume><elocation-id>e1008394</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1008394</pub-id><pub-id pub-id-type="pmid">33296360</pub-id></element-citation></ref><ref id="bib42"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Soto</surname><given-names>C</given-names></name><name><surname>Finn</surname><given-names>JA</given-names></name><name><surname>Willis</surname><given-names>JR</given-names></name><name><surname>Day</surname><given-names>SB</given-names></name><name><surname>Sinkovits</surname><given-names>RS</given-names></name><name><surname>Jones</surname><given-names>T</given-names></name><name><surname>Schmitz</surname><given-names>S</given-names></name><name><surname>Meiler</surname><given-names>J</given-names></name><name><surname>Branchizio</surname><given-names>A</given-names></name><name><surname>Crowe</surname><given-names>JE</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>PyIR: a scalable wrapper for processing billions of immunoglobulin and T cell receptor sequences using igblast</article-title><source>BMC Bioinformatics</source><volume>21</volume><elocation-id>314</elocation-id><pub-id pub-id-type="doi">10.1186/s12859-020-03649-5</pub-id><pub-id pub-id-type="pmid">32677886</pub-id></element-citation></ref><ref id="bib43"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stadinski</surname><given-names>BD</given-names></name><name><surname>Shekhar</surname><given-names>K</given-names></name><name><surname>Gómez-Touriño</surname><given-names>I</given-names></name><name><surname>Jung</surname><given-names>J</given-names></name><name><surname>Sasaki</surname><given-names>K</given-names></name><name><surname>Sewell</surname><given-names>AK</given-names></name><name><surname>Peakman</surname><given-names>M</given-names></name><name><surname>Chakraborty</surname><given-names>AK</given-names></name><name><surname>Huseby</surname><given-names>ES</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Hydrophobic CDR3 residues promote the development of self-reactive T cells</article-title><source>Nature Immunology</source><volume>17</volume><fpage>946</fpage><lpage>955</lpage><pub-id pub-id-type="doi">10.1038/ni.3491</pub-id><pub-id pub-id-type="pmid">27348411</pub-id></element-citation></ref><ref id="bib44"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stritesky</surname><given-names>GL</given-names></name><name><surname>Xing</surname><given-names>Y</given-names></name><name><surname>Erickson</surname><given-names>JR</given-names></name><name><surname>Kalekar</surname><given-names>LA</given-names></name><name><surname>Wang</surname><given-names>X</given-names></name><name><surname>Mueller</surname><given-names>DL</given-names></name><name><surname>Jameson</surname><given-names>SC</given-names></name><name><surname>Hogquist</surname><given-names>KA</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Murine thymic selection quantified using a unique method to capture deleted T cells</article-title><source>PNAS</source><volume>110</volume><fpage>4679</fpage><lpage>4684</lpage><pub-id pub-id-type="doi">10.1073/pnas.1217532110</pub-id><pub-id pub-id-type="pmid">23487759</pub-id></element-citation></ref><ref id="bib45"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sun</surname><given-names>Y</given-names></name><name><surname>Best</surname><given-names>K</given-names></name><name><surname>Cinelli</surname><given-names>M</given-names></name><name><surname>Heather</surname><given-names>JM</given-names></name><name><surname>Reich-Zeliger</surname><given-names>S</given-names></name><name><surname>Shifrut</surname><given-names>E</given-names></name><name><surname>Friedman</surname><given-names>N</given-names></name><name><surname>Shawe-Taylor</surname><given-names>J</given-names></name><name><surname>Chain</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Specificity, privacy, and degeneracy in the CD4 T cell receptor repertoire following immunization</article-title><source>Frontiers in Immunology</source><volume>8</volume><elocation-id>430</elocation-id><pub-id pub-id-type="doi">10.3389/fimmu.2017.00430</pub-id><pub-id pub-id-type="pmid">28450864</pub-id></element-citation></ref><ref id="bib46"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Thomas</surname><given-names>N</given-names></name><name><surname>Best</surname><given-names>K</given-names></name><name><surname>Cinelli</surname><given-names>M</given-names></name><name><surname>Reich-Zeliger</surname><given-names>S</given-names></name><name><surname>Gal</surname><given-names>H</given-names></name><name><surname>Shifrut</surname><given-names>E</given-names></name><name><surname>Madi</surname><given-names>A</given-names></name><name><surname>Friedman</surname><given-names>N</given-names></name><name><surname>Shawe-Taylor</surname><given-names>J</given-names></name><name><surname>Chain</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Tracking global changes induced in the CD4 T-cell receptor repertoire by immunization with a complex antigen using short stretches of CDR3 protein sequence</article-title><source>Bioinformatics</source><volume>30</volume><fpage>3181</fpage><lpage>3188</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btu523</pub-id><pub-id pub-id-type="pmid">25095879</pub-id></element-citation></ref><ref id="bib47"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tubiana</surname><given-names>J</given-names></name><name><surname>Cocco</surname><given-names>S</given-names></name><name><surname>Monasson</surname><given-names>R</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Learning compositional representations of interacting systems with restricted boltzmann machines: comparative study of lattice proteins</article-title><source>Neural Computation</source><volume>31</volume><fpage>1671</fpage><lpage>1717</lpage><pub-id pub-id-type="doi">10.1162/neco_a_01210</pub-id><pub-id pub-id-type="pmid">31260391</pub-id></element-citation></ref><ref id="bib48"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Weber</surname><given-names>A</given-names></name><name><surname>Born</surname><given-names>J</given-names></name><name><surname>Rodriguez Martínez</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Titan: T-cell receptor specificity prediction with bimodal attention networks</article-title><source>Bioinformatics</source><volume>37</volume><fpage>i237</fpage><lpage>i244</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btab294</pub-id><pub-id pub-id-type="pmid">34252922</pub-id></element-citation></ref><ref id="bib49"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wing</surname><given-names>K</given-names></name><name><surname>Sakaguchi</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Regulatory T cells exert checks and balances on self tolerance and autoimmunity</article-title><source>Nature Immunology</source><volume>11</volume><fpage>7</fpage><lpage>13</lpage><pub-id pub-id-type="doi">10.1038/ni.1818</pub-id><pub-id pub-id-type="pmid">20016504</pub-id></element-citation></ref><ref id="bib50"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yates</surname><given-names>AJ</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Theories and quantification of thymic selection</article-title><source>Frontiers in Immunology</source><volume>5</volume><elocation-id>13</elocation-id><pub-id pub-id-type="doi">10.3389/fimmu.2014.00013</pub-id><pub-id pub-id-type="pmid">24550908</pub-id></element-citation></ref><ref id="bib51"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ye</surname><given-names>J</given-names></name><name><surname>Ma</surname><given-names>N</given-names></name><name><surname>Madden</surname><given-names>TL</given-names></name><name><surname>Ostell</surname><given-names>JM</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>IgBLAST: an immunoglobulin variable domain sequence analysis tool</article-title><source>Nucleic Acids Research</source><volume>41</volume><fpage>W34</fpage><lpage>W40</lpage><pub-id pub-id-type="doi">10.1093/nar/gkt382</pub-id><pub-id pub-id-type="pmid">23671333</pub-id></element-citation></ref><ref id="bib52"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yu</surname><given-names>W</given-names></name><name><surname>Jiang</surname><given-names>N</given-names></name><name><surname>Ebert</surname><given-names>PJR</given-names></name><name><surname>Kidd</surname><given-names>BA</given-names></name><name><surname>Müller</surname><given-names>S</given-names></name><name><surname>Lund</surname><given-names>PJ</given-names></name><name><surname>Juang</surname><given-names>J</given-names></name><name><surname>Adachi</surname><given-names>K</given-names></name><name><surname>Tse</surname><given-names>T</given-names></name><name><surname>Birnbaum</surname><given-names>ME</given-names></name><name><surname>Newell</surname><given-names>EW</given-names></name><name><surname>Wilson</surname><given-names>DM</given-names></name><name><surname>Grotenbreg</surname><given-names>GM</given-names></name><name><surname>Valitutti</surname><given-names>S</given-names></name><name><surname>Quake</surname><given-names>SR</given-names></name><name><surname>Davis</surname><given-names>MM</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Clonal deletion prunes but does not eliminate self-specific αβ CD8 (+) T lymphocytes</article-title><source>Immunity</source><volume>42</volume><fpage>929</fpage><lpage>941</lpage><pub-id pub-id-type="doi">10.1016/j.immuni.2015.05.001</pub-id><pub-id pub-id-type="pmid">25992863</pub-id></element-citation></ref></ref-list></back><sub-article article-type="editor-report" id="sa0"><front-stub><article-id pub-id-type="doi">10.7554/eLife.81622.sa0</article-id><title-group><article-title>Editor's evaluation</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Graw</surname><given-names>Frederik</given-names></name><role specific-use="editor">Reviewing Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/038t36y30</institution-id><institution>Heidelberg University</institution></institution-wrap><country>Germany</country></aff></contrib></contrib-group><related-object id="sa0ro1" object-id-type="id" object-id="10.1101/2022.02.14.480309" link-type="continued-by" xlink:href="https://sciety.org/articles/activity/10.1101/2022.02.14.480309"/></front-stub><body><p>This paper addresses an important question within adaptive immunity, namely whether the T cell receptor (TCR) repertoire of negatively selected thymocytes shares common features. The authors analyze T cell receptor sequences from mice as they progress through positive selection, CD4/CD8 lineage commitment, and negative selection. Thereby they find small but consistent differences between the repertoires at these selection stages, providing arguments that their findings do not indicate any sequence-specific selection.</p></body></sub-article><sub-article article-type="decision-letter" id="sa1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.81622.sa1</article-id><title-group><article-title>Decision letter</article-title></title-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Graw</surname><given-names>Frederik</given-names></name><role>Reviewing Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/038t36y30</institution-id><institution>Heidelberg University</institution></institution-wrap><country>Germany</country></aff></contrib></contrib-group></front-stub><body><boxed-text id="sa2-box1"><p>Our editorial process produces two outputs: (i) <ext-link ext-link-type="uri" xlink:href="https://sciety.org/articles/activity/10.1101/2022.02.14.480309">public reviews</ext-link> designed to be posted alongside <ext-link ext-link-type="uri" xlink:href="https://www.biorxiv.org/content/10.1101/2022.02.14.480309v1">the preprint</ext-link> for the benefit of readers; (ii) feedback on the manuscript for the authors, including requests for revisions, shown below. We also include an acceptance summary that explains what the editors found interesting or important about the work.</p></boxed-text><p><bold>Decision letter after peer review:</bold></p><p>Thank you for submitting your article &quot;Population based selection shapes the T cell receptor repertoire during thymic development&quot; for consideration by <italic>eLife</italic>. Your article has been reviewed by 3 peer reviewers, one of whom is a member of our Board of Reviewing Editors, and the evaluation has been overseen by Tadatsugu Taniguchi as the Senior Editor. The reviewers have opted to remain anonymous.</p><p>The reviewers have discussed their reviews with one another, and the Reviewing Editor has drafted this to help you prepare a revised submission.</p><p>All reviewers appreciated the combination of an interesting data set with sophisticated analytical methods to address the very relevant question of how T cell selection is regulated. However, there is the consensus impression that some of the claims and interpretations are not fully supported by the presented analyses. This also affects the main message of the manuscript put prominently within the title, which is one possible hypothesis, but not the only explanation for the presented observations.</p><p>In the light of the comments, we would be willing to consider a substantially revised version of the manuscript that addresses all the points mentioned by the reviewers, and which will be subject to a re-review. In particular, the revision should address the following main recommendations:</p><p>Essential revisions:</p><p>1) A careful revision of each of the claims and conclusions. You should discuss/re-consider for each of the analyses the limitations that are associated with the methods and the underlying data, affecting statistical evidence. In particular this relates to the analysis presented in Figure 3 and 5 (see comment reviewer 3), with especially the former being insufficient in supporting the performed interpretations.</p><p>2) Replacement of the title and careful restructuring of the text to better match supported conclusions and to motivate the performed analyses (see specific comment reviewer 2).</p><p>3) Discussion of the used experimental system (Nur77EGFP/Annexin V) and the possibility to detect possible differences within a data set of the presented size.</p><p>Please also see the detailed comments of the individual reviewers below. As these comments would require substantial changes to the manuscript, partly affecting its central message, please note that a revised manuscript will be subject to a re-review.</p><p><italic>Reviewer #1 (Recommendations for the authors):</italic></p><p>1) The authors mention that they generally pool the read outs from three mice to perform the repertoire comparison, as e.g. based on the n-gram distributions, to increase the statistical power. Despite the reasonable expectation of mice similarity, the questions remains if there might be stronger signals for selection with development stage on an individual level, and the individual signal possibly being masked by the pooled analysis. Looking at Figure S3 with the statistics for the individual mice, there seem to be some (minor) differences in the number of readouts per differentiation step between mice that could affect the analysis. CDR3 length distribution (Figure 2B) and n-gram analysis could be performed on an individual mouse level to provide evidence for the comparability of readouts of individual mice. I assume that e.g. Figure 2B is based on the pooled mouse data. I think it would be helpful to perform some statistical analyses on the level of individual mice to corroborate their similarity and appropriateness for pooling.</p><p>2) Another point concerns the fact that α- and β-chain are analyzed separately, and not in combination. This could also mask possible signatures as already indicated and discussed by the authors. To which extent do the acquired data allow a combined analysis of α- and β-chains with regard to a &quot;connected selectivity&quot;?</p><p>3) The suitability of n-gram distributions and the specific selection of n for comparison might also be dependent on the actual CDR3 length, i.e. only sequences with a sufficient CDR3-length could contain information for appropriate n-gram comparisons. I assume that the n-gram comparison considered all sequences with a CDR3-length of at least n. I am not an expert and this might be an unreasonable suggestion, but would it make sense to compare the n-gram distribution for one particular CDR3-length (e.g. 12) to determine if there are differences between differentiation steps? I think such an approach would assume that there are differences in selection due to the CDR3-length and n-gram distribution, while the current approach neglects the CDR3-length.</p><p><italic>Reviewer #2 (Recommendations for the authors):</italic></p><p>The following points should be addressable with edits of the text:</p><p>1. The sorting approach should be discussed with pros and cons. A critical question is the lifetime of negatively selected cells after they received their instruction to go into apoptosis. If strong TCR signal strength translates into short subsequent lifetime, then the annexin+ cells sorted may be enriched for cells receiving a rather weaker negative selection signal. This caveat should be discussed. The sorting approach as such is valid as thymocytes destined to die are identified.</p><p>2. Kyewski and co-workers have found that 1-3% of thymic epithelial cells robustly present any given peptide they tested (using unrelated peptides from proteins encoded on different chromosomes), sometimes even a higher fraction, 5%; see Pinto et al. PNAS 2013 and references therein. Hence, a thymocyte encountering of the order of 100 mTECs could sample practically the entire self-peptidome. Le Borgne, M. et al. (Ref. 7 in the manuscript) give the actual number scanned as up to 500. Hence, the number of distinct peptides seen by a thymocyte could easily be much higher than the 1-5% of the self-peptidome given by the authors (Le Borgne et al., cited in evidence of this low percentage, do not give such a number, to my knowledge, while Ref. 6 proposes a very interesting theoretical scenario, i.e., if the fraction were so small, selection could still work by quorum sensing, but gives no experimental evidence). Of course, the actual fraction of peptides seen is not clear, as it will depend on the spatial distribution of peptides on mTECs, the path taken by thymocytes, and the sensitivity of recognition. However, the upper limits allowed by the available experimental data appears to be the majority, if not close to 100%, of self-peptides, and these data should be discussed with due balance. Hence my request to adapt this aspect in Introduction, Discussion and Title accordingly.</p><p>3. All TCR α results should be shown in parallel for β (possibly using supplementary Figures, as the authors have done already to a large extent).</p><p>4. A point in the Intro not related to the message of the manuscript: &quot;… imposes.… boundaries on the binding energy.…&quot; The TCR senses also koff, a kinetic property. Beyond a host of indirect evidence, this was demonstrated directly by two optogenetics papers in <italic>eLife</italic> in 2019 (Yousefi et al.; Tischer and Weiner).</p><p><italic>Reviewer #3 (Recommendations for the authors):</italic></p><p>– I would suggest making explicit which kind of changes to the repertoire this study is designed (or able) to detect, and which kind of changes it cannot detect.</p><p>– Related to the above, the limitations of the study could be more clearly emphasized, and some of the conclusions might be somewhat toned down.</p><p>– The data shown in Figure 3B is misleading, as explained above; the authors should consider removing this analysis entirely but at least the interpretation of these data as some sort of evidence for collective decision-making by T cells should be removed.</p><p>– In Figure 4, is it truly necessary to consider 3-grams? Is the discriminatory power of 3-grams (or shorter k-grams) better than that of the P<sub>stage</sub> models and if so, might this indicate overfitting/too high model complexity of the P<sub>stage</sub> models?</p><p>– The scenario simulated in Figure 5A might be too different from the one analyzed in Figure 5B to be a meaningful comparison. The general idea of the negative correlation is obviously valid but can be illustrated using a much simpler model (or even just the basic mathematical argument); alternatively, the model could also incorporate common causes of selection to be more useful.</p><p>– Page 1: The ability to discriminate between self and non-self targets &quot;cannot therefore be inherited&quot; – it could be possible that V and J segments themselves evolved to make receptors that are biased towards recognizing non-self targets?</p><p>– Page 2, left: &quot;cross-reactive to an overwhelming majority of self- peptides.&quot; – unclear what this means, surely a single TCR can't recognize a majority of self-peptides?</p><p>– Page 2, left: discussion of the populations. Here it could already been mentioned that the DPpos population might contain cells that still get negatively selected later, as mentioned in the Discussion.</p><p>– Page 2, bottom right: the pooling subtly but importantly changes the meaning of the performed inferential statistics. (What is the experiment repetition in the frequentist framework?)</p><p>– Figure 1: Why was it necessary to learn a new generation model for these sequences rather than use an existing (mouse-based) one?</p><p>– Figure 1: The Annexin V+ populations are small, and the gating looks somewhat arbitrary, which could be mentioned as a limitation.</p><p>– Page 4, bottom left: What about the distribution of N nucleotides rather than the length of the entire sequence?</p><p>– Page 5, left: &quot;even the smallest AUC are highly significant&quot; – this is just a consequence of the large number of sequences and a low p-value does not make a small AUC more important</p><p>– Page 5, left: &quot;Thus statistical properties of a repertoire can distinguish it from another repertoire, even when the feature distributions of individual TCRs are largely overlapping.&quot; – you could mention that this is just the law of large numbers</p><p>– Page 5, top right: NSB entropy estimator – did this matter for your results?</p><p>– idem &quot;The maximum possible entropy if all 20 amino acids were used uniformly would be S/n = log2 20 ∼ 4.3 bits.&quot; – it is known that amino acid is non-uniform, this is the case for all proteins. A more meaningful baseline would be the entropy for the average frequencies of amino acids</p><p>– Page 6, left: &quot;there is no evidence that selection at any step involves complex sequence motifs, or amino acid interactions, which would not be captured by the linear model&quot; – It is not clear why the presence of such &quot;motifs&quot; would be expected in the first place, but there could still be strong selection against TCRs that recognize peptides in certain (ubiquitous) proteins, and this would not necessarily translate to simple &quot;motifs&quot; that are readily detectable</p><p>– idem &quot;validating the hypothesis of linear selection factors&quot; – I am not sure if this is meant to imply that such linear selection factors truly drive selection. It would seem more likely that the observed differences are population-level consequences of a selection process that operates in a (stochastic) sequence-specific manner</p><p>– Discussion &quot;Consistent with these previous results, we can project our model parameters to build a single hydrophobicity index, which we observe to be significantly increased in positively selected cells (DP pos) versus DP pre, and decreased in single positive sets (Figure S21).&quot; – this raises the question whether the single hydrophobicity index might already be sufficient to explain the differences seen in the repertoire</p><p>– &quot;This number is in agreement with our observations (Figure 5B) that ∼ 30 TCRs increases the AUC of correctly classifying these cells as CD4<sup>+</sup> spleen vs CD4 apo from ∼ 0.59 to ∼ 0.87.&quot; – I think this is not a valid interpretation. First, as noted above, this phenomenon would be observed for any such classification. Second, there is nothing special to an AUC value of 0.87</p><p>– Methods: The Adam optimizer was used for the linear classifiers. Was this necessary (e.g., were the models underspecified) or could a deterministic optimizer have been used?</p><p>[Editors' note: further revisions were suggested prior to acceptance, as described below.]</p><p>Thank you for resubmitting your work entitled &quot;Population based selection shapes the T cell receptor repertoire during thymic development&quot; for further consideration by <italic>eLife</italic>. Your revised article has been evaluated by Tadatsugu Taniguchi (Senior Editor) and a Reviewing Editor. In addition, the previous reviewers have also assessed the submission</p><p>You performed a substantial amount of work to address the previous comments and the manuscript has been substantially improved. However, there are some remaining issues that need to be addressed, as outlined below:</p><p>In particular, the previously identified misinterpretation of &quot;classification of T cells&quot; as &quot;quorum sensing by T cells&quot; is partly re-inforced by the added changes, especially within the Results section (see comment reviewer 3). We would therefore ask you to carefully revisit the corresponding paragraphs within the results and Discussion section and rephrase where necessary. See also the specific recommendations of the reviewer below.</p><p><italic>Reviewer #2 (Recommendations for the authors):</italic></p><p>The authors have done an excellent job of revising the manuscript. I recommend publication as it is.</p><p><italic>Reviewer #3 (Recommendations for the authors):</italic></p><p>The authors have made many changes to the manuscript and added additional findings as well. I think the manuscript has been improved in many places. However, I suspect the revision is not complete. My main criticism had been the interpretation of imperfect classification as evidence for a quorum sensing mechanism. The authors state in their rebuttal letter that they agree with me and that they &quot;radically rewrote&quot; the corresponding text. However, the relevant paragraph in the discussion, the one starting with &quot;Overall, the statistical population-level differences between populations of thymocytes and mature T cells.…&quot;, is entirely unchanged from the previous version. There have been some additional explanations inserted in the Results section, but these are not really correct (i.e. it is said that T cells are &quot;weak learners&quot;, but the &quot;learner&quot; in this context is the classification algorithm built by the authors, not the T cell, which is the instance being classified.) So the same interpretation mistakes are unfortunately still present in the revised version. Perhaps the authors overlooked something.</p></body></sub-article><sub-article article-type="reply" id="sa2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.81622.sa2</article-id><title-group><article-title>Author response</article-title></title-group></front-stub><body><disp-quote content-type="editor-comment"><p>Essential revisions:</p><p>1) A careful revision of each of the claims and conclusions. You should discuss/re-consider for each of the analyses the limitations that are associated with the methods and the underlying data, affecting statistical evidence. In particular this relates to the analysis presented in Figure 3 and 5 (see comment reviewer 3), with especially the former being insufficient in supporting the performed interpretations.</p></disp-quote><p>We have carried out a careful revision taking all these points in consideration. In particular we have thoroughly revised the interpretation of <italic>Figure 3</italic> in accordance with the comments of reviewer 3, which we completely agree with. We have kept in the “toy” example in <italic>Figure 5</italic>, because we feel that this greatly clarifies the method for the non-specialist reader. But we have addressed the point regarding the interpretation, by reorganising the figure with the additional analyses suggested as specified below.</p><disp-quote content-type="editor-comment"><p>2) Replacement of the title and careful restructuring of the text to better match supported conclusions and to motivate the performed analyses (see specific comment reviewer 2).</p></disp-quote><p>We have changed title and addressed the motivation as raised by reviewer 2.</p><disp-quote content-type="editor-comment"><p>3) Discussion of the used experimental system (Nur77EGFP/Annexin V) and the possibility to detect possible differences within a data set of the presented size.</p></disp-quote><p>We have introduced new text at various points in the manuscript, highlighting the limitations of the methods.</p><disp-quote content-type="editor-comment"><p>Reviewer #1 (Recommendations for the authors):</p><p>1) The authors mention that they generally pool the read outs from three mice to perform the repertoire comparison, as e.g. based on the n-gram distributions, to increase the statistical power. Despite the reasonable expectation of mice similarity, the questions remains if there might be stronger signals for selection with development stage on an individual level, and the individual signal possibly being masked by the pooled analysis. Looking at Figure S3 with the statistics for the individual mice, there seem to be some (minor) differences in the number of readouts per differentiation step between mice that could affect the analysis. CDR3 length distribution (Figure 2B) and n-gram analysis could be performed on an individual mouse level to provide evidence for the comparability of readouts of individual mice. I assume that e.g. Figure 2B is based on the pooled mouse data. I think it would be helpful to perform some statistical analyses on the level of individual mice to corroborate their similarity and appropriateness for pooling.</p></disp-quote><p>We agree that analysis of individual mice could give additional information. We have redone <italic>Figure 2</italic> analyses to include individual mice data. However, at a TCR population level the intermouse effects are very small, and the results are not influenced by variability in TCR count between mice.</p><disp-quote content-type="editor-comment"><p>2) Another point concerns the fact that α- and β-chain are analyzed separately, and not in combination. This could also mask possible signatures as already indicated and discussed by the authors. To which extent do the acquired data allow a combined analysis of α- and β-chains with regard to a &quot;connected selectivity&quot;?</p></disp-quote><p>Our ability to co-analyse α and β chains is limited because the method we use does not pair individual TCR α and β chains. So the α and β sequence data are effectively independent data sets.</p><disp-quote content-type="editor-comment"><p>3) The suitability of n-gram distributions and the specific selection of n for comparison might also be dependent on the actual CDR3 length, i.e. only sequences with a sufficient CDR3-length could contain information for appropriate n-gram comparisons. I assume that the n-gram comparison considered all sequences with a CDR3-length of at least n. I am not an expert and this might be an unreasonable suggestion, but would it make sense to compare the n-gram distribution for one particular CDR3-length (e.g. 12) to determine if there are differences between differentiation steps? I think such an approach would assume that there are differences in selection due to the CDR3-length and n-gram distribution, while the current approach neglects the CDR3-length.</p></disp-quote><p>We have done this analysis and included it in <italic>Figure 4—figure supplement 9</italic>. There were small differences in entropy when using different CDR3 length, but the differences are small. We therefore combined all length CDR3s for subsequent analyses to increase statistical power.</p><disp-quote content-type="editor-comment"><p>Reviewer #2 (Recommendations for the authors):</p><p>The following points should be addressable with edits of the text:</p><p>1. The sorting approach should be discussed with pros and cons. A critical question is the lifetime of negatively selected cells after they received their instruction to go into apoptosis. If strong TCR signal strength translates into short subsequent lifetime, then the annexin+ cells sorted may be enriched for cells receiving a rather weaker negative selection signal. This caveat should be discussed. The sorting approach as such is valid as thymocytes destined to die are identified.</p></disp-quote><p>We agree with the reviewer. We have added a short paragraph discussing this point in the <italic>Discussion</italic>.</p><disp-quote content-type="editor-comment"><p>2. Kyewski and co-workers have found that 1-3% of thymic epithelial cells robustly present any given peptide they tested (using unrelated peptides from proteins encoded on different chromosomes), sometimes even a higher fraction, 5%; see Pinto et al. PNAS 2013 and references therein. Hence, a thymocyte encountering of the order of 100 mTECs could sample practically the entire self-peptidome. Le Borgne, M. et al. (Ref. 7 in the manuscript) give the actual number scanned as up to 500. Hence, the number of distinct peptides seen by a thymocyte could easily be much higher than the 1-5% of the self-peptidome given by the authors (Le Borgne et al., cited in evidence of this low percentage, do not give such a number, to my knowledge, while Ref. 6 proposes a very interesting theoretical scenario, i.e., if the fraction were so small, selection could still work by quorum sensing, but gives no experimental evidence). Of course, the actual fraction of peptides seen is not clear, as it will depend on the spatial distribution of peptides on mTECs, the path taken by thymocytes, and the sensitivity of recognition. However, the upper limits allowed by the available experimental data appears to be the majority, if not close to 100%, of self-peptides, and these data should be discussed with due balance. Hence my request to adapt this aspect in Introduction, Discussion and Title accordingly.</p></disp-quote><p>We agree with the reviewer. We have added a short paragraph discussing this point in the <italic>Discussion</italic>.</p><disp-quote content-type="editor-comment"><p>3. All TCR α results should be shown in parallel for β (possibly using supplementary Figures, as the authors have done already to a large extent).</p></disp-quote><p>We have added all the equivalent β results.</p><disp-quote content-type="editor-comment"><p>4. A point in the Intro not related to the message of the manuscript: &quot;… imposes.… boundaries on the binding energy.…&quot; The TCR senses also koff, a kinetic property. Beyond a host of indirect evidence, this was demonstrated directly by two optogenetics papers in eLife in 2019 (Yousefi et al.; Tischer and Weiner).</p></disp-quote><p>We agree and have edited the text accordingly.</p><disp-quote content-type="editor-comment"><p>Reviewer #3 (Recommendations for the authors):</p><p>– I would suggest making explicit which kind of changes to the repertoire this study is designed (or able) to detect, and which kind of changes it cannot detect.</p></disp-quote><p>We have added a section to the <italic>Discussion</italic> which addresses these points.</p><disp-quote content-type="editor-comment"><p>– Related to the above, the limitations of the study could be more clearly emphasized, and some of the conclusions might be somewhat toned down.</p></disp-quote><p>We have added a section to the <italic>Discussion</italic> which addresses these points.</p><disp-quote content-type="editor-comment"><p>– The data shown in Figure 3B is misleading, as explained above; the authors should consider removing this analysis entirely but at least the interpretation of these data as some sort of evidence for collective decision-making by T cells should be removed.</p></disp-quote><p>We are grateful to the reviewer for picking up this important point. The concept of weak learners, i.e. each TCR cannot be unambiguously assigned to a class but that an ensemble of TCRs can, is exactly the point we are trying to make in <italic>Figure 3</italic>. We agree that there is a big jump from this to saying the mechanisms of tolerance in the periphery is due to quorum sensing. This is just one possible strategy to solve the problem of how the immune system makes the self/non-self decision if selection is leaky. We have substantially re-written the text to clarify this.</p><disp-quote content-type="editor-comment"><p>– In Figure 4, is it truly necessary to consider 3-grams? Is the discriminatory power of 3-grams (or shorter k-grams) better than that of the P<sub>stage</sub> models and if so, might this indicate overfitting/too high model complexity of the P<sub>stage</sub> models?</p></disp-quote><p>We have directly compared the discriminatory power of ngram=3 versus ngram=1 (amino acid usage) in <italic>Figure 4—figure supplement 11</italic>, and find that the ngram=3 model outperforms the single amino acid model in almost all comparisons.</p><disp-quote content-type="editor-comment"><p>– The scenario simulated in Figure 5A might be too different from the one analyzed in Figure 5B to be a meaningful comparison. The general idea of the negative correlation is obviously valid but can be illustrated using a much simpler model (or even just the basic mathematical argument); alternatively, the model could also incorporate common causes of selection to be more useful.</p></disp-quote><p>We disagree with the reviewer about our !toy” model which we feel makes the approach much more understandable to the general reader. However, we agree that common cause of selection is an important confounder, thus we decided to add another example related to hydrophobicity to provide further intuition on the expected correlations.</p><p>We also reorganised <italic>Figure 5</italic> in response to the reviewer&quot;s comment in the public review, reporting only the most significant results in the manuscript and moving the rest in the supplementary material. For the correlations between the relative enrichments we use now DP stages relative to DP pre and SP stages relative to DP pos as suggested. The general message is unchanged.</p><disp-quote content-type="editor-comment"><p>– Page 1: The ability to discriminate between self and non-self targets &quot;cannot therefore be inherited&quot; – it could be possible that V and J segments themselves evolved to make receptors that are biased towards recognizing non-self targets?</p></disp-quote><p>We agree and have edited the text appropriately.</p><disp-quote content-type="editor-comment"><p>– Page 2, left: &quot;cross-reactive to an overwhelming majority of self- peptides.&quot; – unclear what this means, surely a single TCR can't recognize a majority of self-peptides?</p></disp-quote><p>This sentence has been removed in the new text.</p><disp-quote content-type="editor-comment"><p>– Page 2, left: discussion of the populations. Here it could already been mentioned that the DPpos population might contain cells that still get negatively selected later, as mentioned in the Discussion.</p></disp-quote><p>We have added a sentence to this effect.</p><disp-quote content-type="editor-comment"><p>– Page 2, bottom right: the pooling subtly but importantly changes the meaning of the performed inferential statistics. (What is the experiment repetition in the frequentist framework?)</p></disp-quote><p>We have carried out additional analyses on individual mice, as specified in response to reviewer, and obtained similar results as on pooled data (<italic>Figure 3—figure supplement 5</italic>).</p><disp-quote content-type="editor-comment"><p>– Figure 1: Why was it necessary to learn a new generation model for these sequences rather than use an existing (mouse-based) one?</p></disp-quote><p>The generation model varies subtly, but significantly depending on mouse strain. Since we used a newly constructed transgenic, we felt it was safer to learn a new generation model. In addition, at the time of the article no model was available for the mouse α chain TCRs.</p><disp-quote content-type="editor-comment"><p>– Figure 1: The Annexin V+ populations are small, and the gating looks somewhat arbitrary, which could be mentioned as a limitation.</p></disp-quote><p>We have added this to the <italic>Results section</italic>.</p><disp-quote content-type="editor-comment"><p>– Page 4, bottom left: What about the distribution of N nucleotides rather than the length of the entire sequence?</p></disp-quote><p>For individual sequences it is not possible to assign the N nucleotides deterministically and thus they are in fact hidden variables [Marcou, 2018. Nature Communications]. We therefore prefer to use the observed variable of CDR3 length, which is more directly linked to the biology the selection process, rather than the N nucleotide distribution which remains hidden to selection.</p><disp-quote content-type="editor-comment"><p>– Page 5, left: &quot;even the smallest AUC are highly significant&quot; – this is just a consequence of the large number of sequences and a low p-value does not make a small AUC more important</p></disp-quote><p>We agree and have removed this sentence.</p><disp-quote content-type="editor-comment"><p>– Page 5, left: &quot;Thus statistical properties of a repertoire can distinguish it from another repertoire, even when the feature distributions of individual TCRs are largely overlapping.&quot; – you could mention that this is just the law of large numbers</p></disp-quote><p>While we agree that overlapping populations can be statistically separated, and that the larger the number of observations, the more precisely and significantly the underlying populations can be identified (the law of large numbers) we think that specifically referring this law may confuse the non-mathematical reader. But we have radically re-written the manuscript to make this point much clearer.</p><disp-quote content-type="editor-comment"><p>– Page 5, top right: NSB entropy estimator – did this matter for your results?</p></disp-quote><p>We have enriched the analysis comparing different estimators where we show that the NSB estimator worked best (<italic>Figure 4—figure supplement 8</italic> and <italic>Figure 4—figure supplement 9</italic>).</p><disp-quote content-type="editor-comment"><p>– idem &quot;The maximum possible entropy if all 20 amino acids were used uniformly would be S/n = log2 20 ∼ 4.3 bits.&quot; – it is known that amino acid is non-uniform, this is the case for all proteins. A more meaningful baseline would be the entropy for the average frequencies of amino acids</p></disp-quote><p>log(20) provides an upper bound on the entropy, and is thus a useful quantity to compare to. However, we agree with the reviewer that the entropy of amino acids according to their distribution in the overall proteome is an additional useful comparison point. We have added its value in the main text (4.2 bits).</p><disp-quote content-type="editor-comment"><p>– Page 6, left: &quot;there is no evidence that selection at any step involves complex sequence motifs, or amino acid interactions, which would not be captured by the linear model&quot; – It is not clear why the presence of such &quot;motifs&quot; would be expected in the first place, but there could still be strong selection against TCRs that recognize peptides in certain (ubiquitous) proteins, and this would not necessarily translate to simple &quot;motifs&quot; that are readily detectable</p></disp-quote><p>We agree and have included an additional discussion of the limitations of what type and magnitude of selection might be expected stressing this point.</p><disp-quote content-type="editor-comment"><p>– idem &quot;validating the hypothesis of linear selection factors&quot; – I am not sure if this is meant to imply that such linear selection factors truly drive selection. It would seem more likely that the observed differences are population-level consequences of a selection process that operates in a (stochastic) sequence-specific manner</p></disp-quote><p>We agree and have clarified this part of the text.</p><disp-quote content-type="editor-comment"><p>– Discussion &quot;Consistent with these previous results, we can project our model parameters to build a single hydrophobicity index, which we observe to be significantly increased in positively selected cells (DP pos) versus DP pre, and decreased in single positive sets (Figure S21).&quot; – this raises the question whether the single hydrophobicity index might already be sufficient to explain the differences seen in the repertoire</p></disp-quote><p>We have included an additional paragraph discussing the hydrophobicity score. We show that it varies between populations, in a way that is overall reflective of the selection process at work. However, if we use a classifier based only on the hydrophobicity score, it performs worse than 1gram classifiers (<italic>Figure 4—figure supplement 14</italic>).</p><disp-quote content-type="editor-comment"><p>– &quot;This number is in agreement with our observations (Figure 5B) that ∼ 30 TCRs increases the AUC of correctly classifying these cells as CD4<sup>+</sup> spleen vs CD4 apo from ∼ 0.59 to ∼ 0.87.&quot; – I think this is not a valid interpretation. First, as noted above, this phenomenon would be observed for any such classification. Second, there is nothing special to an AUC value of 0.87</p></disp-quote><p>We agree and have completely rewritten this part of the text to clarify that we are not suggesting our data validates a quorum sensing model.</p><disp-quote content-type="editor-comment"><p>– Methods: The Adam optimizer was used for the linear classifiers. Was this necessary (e.g., were the models underspecified) or could a deterministic optimizer have been used?</p></disp-quote><p>We have removed this mention, as an Adam optimizer was not necessary.</p><p>[Editors' note: further revisions were suggested prior to acceptance, as described below.]</p><disp-quote content-type="editor-comment"><p>Reviewer #3 (Recommendations for the authors):</p><p>The authors have made many changes to the manuscript and added additional findings as well. I think the manuscript has been improved in many places. However, I suspect the revision is not complete. My main criticism had been the interpretation of imperfect classification as evidence for a quorum sensing mechanism. The authors state in their rebuttal letter that they agree with me and that they &quot;radically rewrote&quot; the corresponding text. However, the relevant paragraph in the discussion, the one starting with &quot;Overall, the statistical population-level differences between populations of thymocytes and mature T cells.…&quot;, is entirely unchanged from the previous version. There have been some additional explanations inserted in the Results section, but these are not really correct (i.e. it is said that T cells are &quot;weak learners&quot;, but the &quot;learner&quot; in this context is the classification algorithm built by the authors, not the T cell, which is the instance being classified.) So the same interpretation mistakes are unfortunately still present in the revised version. Perhaps the authors overlooked something.</p></disp-quote><p>We thank the reviewer for insisting on this point. We were too sloppy in our previous revision and the comment made us realize that we need to be more rigorous when making the link between leaky thymic selection and quorum sensing.</p><p>We have now removed the sentence about TCR being weak learners. In general, we have tried to refrain from interpreting our results in terms of collective decision making in the Result section, deferring our argument about quorum sensing to the Discussion.</p><p>We have extensively rewritten the relevant paragraph in the discussion, with the aim of better explaining the fundamental difference between the two discrimination tasks (self-reactive vs non self-reactive TCR in thymus on the one hand, and self vs foreign peptides discrimination by T cells in the periphery on the other). To tie the two together, we have developed a simple mathematical argument in the Methods following the modeling approach of Butler et al. 2013. However, we tried to remain careful about direct quantitative interpretations of our results in terms of number of cells and making clear that the two tasks are different.</p></body></sub-article></article>