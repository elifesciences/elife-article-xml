<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD with MathML3 v1.2 20190208//EN"  "JATS-archivearticle1-mathml3.dtd"><article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.2"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn publication-format="electronic" pub-type="epub">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">83724</article-id><article-id pub-id-type="doi">10.7554/eLife.83724</article-id><article-categories><subj-group subj-group-type="display-channel"><subject>Tools and Resources</subject></subj-group><subj-group subj-group-type="heading"><subject>Structural Biology and Molecular Biophysics</subject></subj-group></article-categories><title-group><article-title>A Bayesian approach to single-particle electron cryo-tomography in RELION-4.0</article-title></title-group><contrib-group><contrib contrib-type="author" id="author-295073"><name><surname>Zivanov</surname><given-names>Jasenko</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0001-8407-0759</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="other" rid="fund7"/><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-295074"><name><surname>Otón</surname><given-names>Joaquín</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-2195-4730</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-295075"><name><surname>Ke</surname><given-names>Zunlong</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-8408-850X</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff5">5</xref><xref ref-type="fn" rid="con3"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-295076"><name><surname>von Kügelgen</surname><given-names>Andriko</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-0017-2414</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff6">6</xref><xref ref-type="fn" rid="con4"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-295077"><name><surname>Pyle</surname><given-names>Euan</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-4633-4917</contrib-id><xref ref-type="aff" rid="aff7">7</xref><xref ref-type="fn" rid="con5"/><xref ref-type="fn" rid="conf2"/></contrib><contrib contrib-type="author" id="author-295078"><name><surname>Qu</surname><given-names>Kun</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="con6"/><xref ref-type="fn" rid="conf2"/></contrib><contrib contrib-type="author" id="author-295080"><name><surname>Morado</surname><given-names>Dustin</given-names></name><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff5">5</xref><xref ref-type="fn" rid="con7"/><xref ref-type="fn" rid="conf2"/></contrib><contrib contrib-type="author" id="author-295082"><name><surname>Castaño-Díez</surname><given-names>Daniel</given-names></name><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="aff" rid="aff8">8</xref><xref ref-type="other" rid="fund5"/><xref ref-type="fn" rid="con8"/><xref ref-type="fn" rid="conf2"/></contrib><contrib contrib-type="author" id="author-199631"><name><surname>Zanetti</surname><given-names>Giulia</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-1905-0342</contrib-id><xref ref-type="aff" rid="aff7">7</xref><xref ref-type="other" rid="fund4"/><xref ref-type="other" rid="fund6"/><xref ref-type="fn" rid="con9"/><xref ref-type="fn" rid="conf3"/></contrib><contrib contrib-type="author" id="author-295081"><name><surname>Bharat</surname><given-names>Tanmay AM</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-0168-0277</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff6">6</xref><xref ref-type="fn" rid="con10"/><xref ref-type="fn" rid="conf2"/></contrib><contrib contrib-type="author" corresp="yes" id="author-295079"><name><surname>Briggs</surname><given-names>John AG</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-3990-6910</contrib-id><email>briggs@biochem.mpg.de</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff5">5</xref><xref ref-type="other" rid="fund2"/><xref ref-type="other" rid="fund3"/><xref ref-type="fn" rid="con11"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" corresp="yes" id="author-3361"><name><surname>Scheres</surname><given-names>Sjors HW</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-0462-6540</contrib-id><email>scheres@mrc-lmb.cam.ac.uk</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con12"/><xref ref-type="fn" rid="conf3"/></contrib><aff id="aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/00tw3jy02</institution-id><institution>MRC Laboratory of Molecular Biology</institution></institution-wrap><addr-line><named-content content-type="city">Cambridge</named-content></addr-line><country>United Kingdom</country></aff><aff id="aff2"><label>2</label><institution>Laboratory of Biomedical Imaging (LIB)</institution><addr-line><named-content content-type="city">Lausanne</named-content></addr-line><country>Switzerland</country></aff><aff id="aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/02s6k3f65</institution-id><institution>BioEM lab, Biozentrum, University of Basel</institution></institution-wrap><addr-line><named-content content-type="city">Basel</named-content></addr-line><country>Switzerland</country></aff><aff id="aff4"><label>4</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/02j9n6e35</institution-id><institution>ALBA Synchrotron</institution></institution-wrap><addr-line><named-content content-type="city">Barcelona</named-content></addr-line><country>Spain</country></aff><aff id="aff5"><label>5</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/04py35477</institution-id><institution>Max Planck Institute of Biochemistry</institution></institution-wrap><addr-line><named-content content-type="city">Martinsried</named-content></addr-line><country>Germany</country></aff><aff id="aff6"><label>6</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/052gg0110</institution-id><institution>Sir William Dunn School of Pathology, University of Oxford</institution></institution-wrap><addr-line><named-content content-type="city">Oxford</named-content></addr-line><country>United Kingdom</country></aff><aff id="aff7"><label>7</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/02mb95055</institution-id><institution>Institute of Structural and Molecular Biology, Birkbeck College</institution></institution-wrap><addr-line><named-content content-type="city">London</named-content></addr-line><country>United Kingdom</country></aff><aff id="aff8"><label>8</label><institution>Instituto Biofisika</institution><addr-line><named-content content-type="city">Leioa</named-content></addr-line><country>Spain</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Egelman</surname><given-names>Edward H</given-names></name><role>Reviewing Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/0153tk833</institution-id><institution>University of Virginia</institution></institution-wrap><country>United States</country></aff></contrib><contrib contrib-type="senior_editor"><name><surname>Dötsch</surname><given-names>Volker</given-names></name><role>Senior Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/04cvxnb49</institution-id><institution>Goethe University</institution></institution-wrap><country>Germany</country></aff></contrib></contrib-group><pub-date publication-format="electronic" date-type="publication"><day>05</day><month>12</month><year>2022</year></pub-date><pub-date pub-type="collection"><year>2022</year></pub-date><volume>11</volume><elocation-id>e83724</elocation-id><history><date date-type="received" iso-8601-date="2022-09-26"><day>26</day><month>09</month><year>2022</year></date><date date-type="accepted" iso-8601-date="2022-12-04"><day>04</day><month>12</month><year>2022</year></date></history><pub-history><event><event-desc>This manuscript was published as a preprint at .</event-desc><date date-type="preprint" iso-8601-date="2022-02-28"><day>28</day><month>02</month><year>2022</year></date><self-uri content-type="preprint" xlink:href="https://doi.org/10.1101/2022.02.28.482229"/></event></pub-history><permissions><copyright-statement>© 2022, Zivanov et al</copyright-statement><copyright-year>2022</copyright-year><copyright-holder>Zivanov et al</copyright-holder><ali:free_to_read/><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><ali:license_ref>http://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-83724-v3.pdf"/><self-uri content-type="figures-pdf" xlink:href="elife-83724-figures-v3.pdf"/><abstract><p>We present a new approach for macromolecular structure determination from multiple particles in electron cryo-tomography (cryo-ET) data sets. Whereas existing subtomogram averaging approaches are based on 3D data models, we propose to optimise a regularised likelihood target that approximates a function of the 2D experimental images. In addition, analogous to Bayesian polishing and contrast transfer function (CTF) refinement in single-particle analysis, we describe the approaches that exploit the increased signal-to-noise ratio in the averaged structure to optimise tilt-series alignments, beam-induced motions of the particles throughout the tilt-series acquisition, defoci of the individual particles, as well as higher-order optical aberrations of the microscope. Implementation of our approaches in the open-source software package RELION aims to facilitate their general use, particularly for those researchers who are already familiar with its single-particle analysis tools. We illustrate for three applications that our approaches allow structure determination from cryo-ET data to resolutions sufficient for de novo atomic modelling.</p></abstract><kwd-group kwd-group-type="author-keywords"><kwd>maximum likelihood</kwd><kwd>electron tomography</kwd><kwd>subtomogram averaging</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research organism</title><kwd><italic>S. cerevisiae</italic></kwd></kwd-group><funding-group><award-group id="fund1"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100014013</institution-id><institution>UK Research and Innovation</institution></institution-wrap></funding-source><award-id>MC_UP_A025_1013</award-id><principal-award-recipient><name><surname>Scheres</surname><given-names>Sjors HW</given-names></name></principal-award-recipient></award-group><award-group id="fund2"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100014013</institution-id><institution>UK Research and Innovation</institution></institution-wrap></funding-source><award-id>MC_UP_1201/16</award-id><principal-award-recipient><name><surname>Briggs</surname><given-names>John AG</given-names></name></principal-award-recipient></award-group><award-group id="fund3"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000781</institution-id><institution>European Research Council</institution></institution-wrap></funding-source><award-id>ERC-CoG-2014 grant 648432</award-id><principal-award-recipient><name><surname>Briggs</surname><given-names>John AG</given-names></name></principal-award-recipient></award-group><award-group id="fund4"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000781</institution-id><institution>European Research Council</institution></institution-wrap></funding-source><award-id>ERC-StG-2019 grant 852915</award-id><principal-award-recipient><name><surname>Zanetti</surname><given-names>Giulia</given-names></name></principal-award-recipient></award-group><award-group id="fund5"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100001711</institution-id><institution>Swiss National Science Foundation</institution></institution-wrap></funding-source><award-id>205321_179041/1</award-id><principal-award-recipient><name><surname>Castaño-Díez</surname><given-names>Daniel</given-names></name></principal-award-recipient></award-group><award-group id="fund6"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100014013</institution-id><institution>UK Research and Innovation</institution></institution-wrap></funding-source><award-id>BBSRC grant BB/T002670/1</award-id><principal-award-recipient><name><surname>Zanetti</surname><given-names>Giulia</given-names></name></principal-award-recipient></award-group><award-group id="fund7"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100000781</institution-id><institution>European Research Council</institution></institution-wrap></funding-source><award-id>ERC-AdG-2015 grant 692726</award-id><principal-award-recipient><name><surname>Zivanov</surname><given-names>Jasenko</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>New functionality in RELION-4.0 allows convenient structure determination from cryo electron tomography data to resolutions sufficient for de novo atomic modelling.</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>In recent years, electron cryo-microscopy (cryo-EM) has allowed the 3D imaging of an increasing number of biological macromolecules at resolutions sufficient for de novo atomic modelling. This development, originally driven by advances in detector technology, was further facilitated by novel, robust image processing algorithms. In single-particle analysis, images of multiple copies of isolated macromolecular complexes, or particles, that are suspended in random orientations in a thin layer of vitreous water are combined in a 3D reconstruction. Nowadays, many aspects of single-particle analysis workflows can be performed with only minimal human supervision, for example, the detection, extraction, and initial classification of particles in the images (<xref ref-type="bibr" rid="bib51">Zivanov et al., 2018</xref>; <xref ref-type="bibr" rid="bib4">Bepler et al., 2019</xref>; <xref ref-type="bibr" rid="bib47">Wagner et al., 2019</xref>), 3D reconstruction (<xref ref-type="bibr" rid="bib51">Zivanov et al., 2018</xref>; <xref ref-type="bibr" rid="bib33">Punjani et al., 2017</xref>), as well as refinement of the optical parameters (<xref ref-type="bibr" rid="bib51">Zivanov et al., 2018</xref>; <xref ref-type="bibr" rid="bib53">Zivanov et al., 2020</xref>; <xref ref-type="bibr" rid="bib33">Punjani et al., 2017</xref>; <xref ref-type="bibr" rid="bib44">Tegunov et al., 2021</xref>) and per-particle tracking of electron beam-induced motion (<xref ref-type="bibr" rid="bib50">Zheng et al., 2017</xref>; <xref ref-type="bibr" rid="bib52">Zivanov et al., 2019</xref>). Many of the algorithms that underlie these modern methods are built on solid statistical foundations that require few tunable parameters. This decreases the need for operator expertise and provides objectivity, as well as robustness, in obtaining optimal structures.</p><p>The single-particle approach is, however, limited to investigating isolated protein complexes that are purified to relative homogeneity. To examine these complexes in their crowded physiological environment, electron cryo-tomography (cryo-ET) may be used instead. In the tomographic approach, the sample is tilted multiple times during image acquisition, yielding a so-called tilt series of images from which a 3D tomogram can be computed. In the same manner as single-particle analysis, repeated occurrences of particles in those tomograms can then be aligned and averaged to obtain higher-resolution reconstructions. This process is referred to as <italic>subtomogram averaging</italic>. Unlike the field of single-particle analysis, labs use many different tools for subtomogram averaging (e.g. <xref ref-type="bibr" rid="bib26">Kremer et al., 1996</xref>; <xref ref-type="bibr" rid="bib32">Nickell et al., 2005</xref>; <xref ref-type="bibr" rid="bib20">Heumann et al., 2011</xref>; <xref ref-type="bibr" rid="bib7">Castaño-Díez et al., 2012</xref>; <xref ref-type="bibr" rid="bib22">Hrabe et al., 2012</xref>; <xref ref-type="bibr" rid="bib8">Chen et al., 2013</xref>; <xref ref-type="bibr" rid="bib18">Galaz-Montoya et al., 2016</xref>; <xref ref-type="bibr" rid="bib36">Sanchez et al., 2019</xref>; <xref ref-type="bibr" rid="bib9">Chen et al., 2019</xref>; <xref ref-type="bibr" rid="bib25">Jiménez de la Morena et al., 2022</xref>) and many of the tools used require considerable levels of expertise from the operator, often in order to tune parameters that arise from heuristics in the underlying algorithms. This not only provides a barrier for new scientists entering the field, but can also lead to the calculation of suboptimal structures.</p><p>Compared to single-particle analysis, subtomogram averaging faces several unique challenges. In addition to estimating the position and orientation of each particle, the algorithm also has to consider the geometry of the tilt series. Typically, this is solved through a set of preprocessing steps that include estimation of contrast transfer function (CTF) parameters and alignment of the tilt series, followed by the reconstruction of, often inconveniently large, tomograms for the entire field of view. Smaller subtomograms, centred around selected particles, are then extracted from the tomograms and used in a separate process of subtomogram alignment and averaging. The separation between tomogram reconstruction and subtomogram averaging can lead to an accumulation of errors, because errors in the CTF estimation or tilt-series alignments are hard to correct. In addition, because the sample cannot be rotated 180° within the microscope, the subtomograms contain empty regions in Fourier space, the so-called missing wedge, which are difficult to deal with in subtomogram averaging (e.g. see <xref ref-type="bibr" rid="bib40">Schmid and Booth, 2008</xref>; <xref ref-type="bibr" rid="bib16">Förster et al., 2008</xref>; <xref ref-type="bibr" rid="bib2">Bartesaghi et al., 2008</xref>; <xref ref-type="bibr" rid="bib17">Frank et al., 2012</xref>).</p><p>A fundamental problem with subtomogram averaging as described above is that it transforms the original 2D image data into 3D subtomograms, which are then used as a substitute for experimental data in the alignment algorithm. RELION-2 introduced the concept of a 3D CTF to describe the transfer of information from the 2D images to the subtomograms, which dealt to some extent with the missing wedge and the loss of information through interpolations in the reconstruction algorithm (<xref ref-type="bibr" rid="bib5">Bharat and Scheres, 2016</xref>). A drawback of the 3D CTF approach is that it does not deal correctly with the lower resolution regions of Fourier space, where information from different tilt images overlaps. A statistically more attractive approach would be to formulate the optimisation target function directly as a function of the actual 2D images that are measured in the microscope. This has been proposed in an approach called constrained single-particle cryo-ET (<xref ref-type="bibr" rid="bib3">Bartesaghi et al., 2012</xref>), where individually boxed particles from the tilt-series images are processed as in single-particle analysis, but their relative orientations are kept fixed. A similar approach was also implemented in the program emClarity (<xref ref-type="bibr" rid="bib21">Himes and Zhang, 2018</xref>). To deal with unknowns in the relative orientations of the particles from the tilt-series images, as well as their CTFs, the program M recently introduced new optimisation approaches that compare reference projections against the 2D particle images (<xref ref-type="bibr" rid="bib44">Tegunov et al., 2021</xref>). M relies on RELION for alignment and classification of 3D subtomograms that are recalculated from the optimised parameters in M. Nevertheless, this iterative approach allows subtomogram averaging to resolutions that approach those observed for single-particle analysis, even for particles in complex cellular environments (<xref ref-type="bibr" rid="bib44">Tegunov et al., 2021</xref>).</p><p>Here, we describe a new approach to subtomogram averaging in RELION-4.0 that optimises a regularised likelihood function that approximates the direct use of the 2D images of the tilt series. In order to do so at acceptable computational and implementation costs, we have altered the main refinement program in RELION-4.0 to work with so-called <italic>pseudo-subtomograms</italic>: explicitly constructed sets of 3D data arrays that contain sums of CTF pre-multiplied 2D tilt-series images, together with auxiliary arrays that contain the corresponding sum of squared CTFs and how often each 3D voxel has been observed. Pseudo-subtomograms no longer aim to represent the actual scattering potential of the underlying particles, in the way that conventional subtomograms would. Instead, they represent a convenient way to implement an approximation to the 2D approach within the existing RELION code. Evaluation of the pseudo-subtomograms by RELION-4.0 approximates the likelihood of observing a hypothetical particle in the images of the entire tilt series, given the current model. Using that likelihood as a metric, operations equivalent to those in single-particle analysis can now be performed on tomographic data, for example, 3D initial model generation, 3D classification, or high-resolution refinement. In addition, we describe new methods for optimising parameters of the tilt series that exploit the increased signal-to-noise ratio in the average structure. Besides optimisation of the tilt-series alignment itself, we also describe methods analogous to CTF refinement (<xref ref-type="bibr" rid="bib51">Zivanov et al., 2018</xref>; <xref ref-type="bibr" rid="bib53">Zivanov et al., 2020</xref>) for refining descriptors of the optical properties (defocus, astigmatism, and higher-order aberrations) and a method akin to Bayesian polishing (<xref ref-type="bibr" rid="bib52">Zivanov et al., 2019</xref>) to model beam-induced particle motion throughout the tilt series. Once all these parameters have been optimised, new pseudo-subtomograms can be constructed and the alignment can be repeated. The resulting iterative image processing workflow is similar to existing approaches for single-particle analysis in RELION.</p></sec><sec id="s2" sec-type="methods"><title>Methods</title><sec id="s2-1"><title>Particle alignment and averaging</title><p>RELION performs maximum a posteriori estimation to find the set of model parameters <inline-formula><mml:math id="inf1"><mml:mi mathvariant="normal">Θ</mml:mi></mml:math></inline-formula> that maximise the probability of observing the experimental images <inline-formula><mml:math id="inf2"><mml:mi>X</mml:mi></mml:math></inline-formula>. Using Bayes’ theorem, we define a regularised likelihood optimisation target function as<disp-formula id="equ1"><label>(1)</label><mml:math id="m1"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="normal">Θ</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="double-struck">X</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="double-struck">X</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi mathvariant="normal">Θ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="normal">Θ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf3"><mml:mrow><mml:mi>P</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="normal">Θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> expresses prior information about the model, that is, that the reconstructed map has limited power in Fourier space, and <inline-formula><mml:math id="inf4"><mml:mrow><mml:mi>P</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>X</mml:mi><mml:mo lspace="2.5pt" rspace="2.5pt" stretchy="false">|</mml:mo><mml:mi mathvariant="normal">Θ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the likelihood of observing the data given the model. A marginalised likelihood function is used, where one integrates over the unknown alignments <inline-formula><mml:math id="inf5"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>ϕ</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula> of each individual particle. For simplicity, these integrals are omitted from the notations used in this article.</p><p>The data model assumes independent Gaussian noise on the Fourier components of the cryo-EM images of individual particles <inline-formula><mml:math id="inf6"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:mstyle></mml:math></inline-formula>. We therefore write the negative log-likelihood of observing a particle <inline-formula><mml:math id="inf7"><mml:mi>p</mml:mi></mml:math></inline-formula> in a hypothetical alignment <inline-formula><mml:math id="inf8"><mml:mi>ϕ</mml:mi></mml:math></inline-formula> as a sum over a grid of 2D Fourier pixels <inline-formula><mml:math id="inf9"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mstyle></mml:math></inline-formula>:<disp-formula id="equ2"><label>(2)</label><mml:math id="m2"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>−</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo maxsize="1.2em" minsize="1.2em">(</mml:mo></mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>X</mml:mi><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>ϕ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo maxsize="1.2em" minsize="1.2em">)</mml:mo></mml:mrow><mml:mo>∝</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup><mml:mo>−</mml:mo><mml:msup><mml:mtext>CTF</mml:mtext><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mi>V</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mfrac><mml:mo>,</mml:mo></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf10"><mml:msup><mml:mi>X</mml:mi><mml:mi>p</mml:mi></mml:msup></mml:math></inline-formula> is the Fourier transform of the experimental particle image, <inline-formula><mml:math id="inf11"><mml:msup><mml:mtext>CTF</mml:mtext><mml:mi>p</mml:mi></mml:msup></mml:math></inline-formula> its contrast-transfer function, <inline-formula><mml:math id="inf12"><mml:msubsup><mml:mi>V</mml:mi><mml:mi mathvariant="bold">j</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula> denotes the 2D slice out of the 3D Fourier transform of the known map <inline-formula><mml:math id="inf13"><mml:mi>V</mml:mi></mml:math></inline-formula> into the view of the particle, and <inline-formula><mml:math id="inf14"><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>j</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:math></inline-formula> is the noise variance of the frequency band of <inline-formula><mml:math id="inf15"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> given by<disp-formula id="equ3"><label>(3)</label><mml:math id="m3"><mml:mrow><mml:msubsup><mml:mi>V</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="bold">t</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mo>⋅</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mi>V</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula></p><p>for a 2D vector <inline-formula><mml:math id="inf16"><mml:msub><mml:mi mathvariant="bold">t</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:math></inline-formula> and a <inline-formula><mml:math id="inf17"><mml:mrow><mml:mn>2</mml:mn><mml:mo>×</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:math></inline-formula> matrix <inline-formula><mml:math id="inf18"><mml:msub><mml:mi>A</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:math></inline-formula> that respectively encapsulate the particle’s position and orientation, and the evaluation of <inline-formula><mml:math id="inf19"><mml:mrow><mml:mi>V</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mo>⁢</mml:mo><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is achieved through linear interpolation.</p><p>In tomography, our aim is to approximate that same likelihood on tilt-series data. The equivalent is a sum over the pixels of the relevant regions of all images <inline-formula><mml:math id="inf20"><mml:mi>f</mml:mi></mml:math></inline-formula> from the tilt series:<disp-formula id="equ4"><label>(4)</label><mml:math id="m4"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>−</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo maxsize="1.2em" minsize="1.2em">(</mml:mo></mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>X</mml:mi><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>ϕ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo maxsize="1.2em" minsize="1.2em">)</mml:mo></mml:mrow><mml:mo>∝</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>f</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup><mml:mo>−</mml:mo><mml:msubsup><mml:mtext>CTF</mml:mtext><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mi>V</mml:mi><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mfrac><mml:mo>.</mml:mo></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>We model the shifts and rotations as compositions of per-particle and per-image components:<disp-formula id="equ5"><label>(5)</label><mml:math id="m5"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">t</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mi>A</mml:mi><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mo>⊺</mml:mo></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi mathvariant="bold">T</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">t</mml:mi></mml:mrow><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></disp-formula><disp-formula id="equ6"><label>(6)</label><mml:math id="m6"><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p>where we keep the per-particle rotation component, <inline-formula><mml:math id="inf21"><mml:msub><mml:mi>R</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:math></inline-formula>, identical for all images in the tilt series, and only vary <inline-formula><mml:math id="inf22"><mml:msub><mml:mi>A</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:math></inline-formula>, the rotational alignment of the tilt-series images. In turn, the tilt-series alignment <inline-formula><mml:math id="inf23"><mml:msub><mml:mi>A</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:math></inline-formula> is shared among all particles in a given tilt image. The per-particle part of the translation is modelled as a 3D vector, <inline-formula><mml:math id="inf24"><mml:mrow><mml:msub><mml:mi mathvariant="bold">T</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mn>3</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula>, that can vary over different tilt images <inline-formula><mml:math id="inf25"><mml:mi>f</mml:mi></mml:math></inline-formula>. This contrasts with single-particle analysis, where beam-induced motion of the particle can be corrected for as a preprocessing step (<xref ref-type="bibr" rid="bib27">Li et al., 2013</xref>; <xref ref-type="bibr" rid="bib39">Scheres, 2014</xref>; <xref ref-type="bibr" rid="bib50">Zheng et al., 2017</xref>; <xref ref-type="bibr" rid="bib52">Zivanov et al., 2019</xref>), so that each particle is associated with a single 2D translation in a motion-corrected image.</p><p>For our pseudo-subtomogram approach, we now approximate the sum over 2D pixels <inline-formula><mml:math id="inf26"><mml:mi mathvariant="bold">j</mml:mi></mml:math></inline-formula> and tilt images <inline-formula><mml:math id="inf27"><mml:mi>f</mml:mi></mml:math></inline-formula> in <xref ref-type="disp-formula" rid="equ4">Equation 4</xref> by a sum over 3D voxels <inline-formula><mml:math id="inf28"><mml:mi mathvariant="bold">k</mml:mi></mml:math></inline-formula> in the pseudo-subtomogram:<disp-formula id="equ7"><label>(7)</label><mml:math id="m7"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>−</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo maxsize="1.2em" minsize="1.2em">(</mml:mo></mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>X</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>ϕ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo maxsize="1.2em" minsize="1.2em">)</mml:mo></mml:mrow><mml:mo>∝</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msubsup><mml:mi>D</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup><mml:mo>−</mml:mo><mml:msubsup><mml:mi>W</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup><mml:mi>V</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:msup><mml:mi>M</mml:mi><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msup><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>Here, the data term <inline-formula><mml:math id="inf29"><mml:msup><mml:mi>D</mml:mi><mml:mi>p</mml:mi></mml:msup></mml:math></inline-formula>, the weight term <inline-formula><mml:math id="inf30"><mml:msup><mml:mi>W</mml:mi><mml:mi>p</mml:mi></mml:msup></mml:math></inline-formula>, and the multiplicity term <inline-formula><mml:math id="inf31"><mml:msup><mml:mi>M</mml:mi><mml:mi>p</mml:mi></mml:msup></mml:math></inline-formula> are 3D arrays in the Fourier domain. Together, they constitute a pseudo-subtomogram. They are constructed as follows:<disp-formula id="equ8"><label>(8)</label><mml:math id="m8"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msubsup><mml:mi>D</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>f</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:munder><mml:mi>l</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mtext>CTF</mml:mtext><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mi>X</mml:mi><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup></mml:mstyle></mml:mrow></mml:math></disp-formula><disp-formula id="equ9"><label>(9)</label><mml:math id="m9"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msubsup><mml:mi>W</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>f</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:munder><mml:mi>l</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msubsup><mml:mtext>CTF</mml:mtext><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mstyle></mml:mrow></mml:math></disp-formula><disp-formula id="equ10"><label>(10)</label><mml:math id="m10"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msubsup><mml:mi>M</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>f</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:munder><mml:mi>l</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf32"><mml:mrow><mml:mi>l</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mo>⋅</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> represents linear interpolation with forward mapping, that is, each 2D Fourier pixel <inline-formula><mml:math id="inf33"><mml:mi mathvariant="bold">j</mml:mi></mml:math></inline-formula> is projected into 3D Fourier space, updating the eight closest voxels.</p><p>Ignoring the difference of pre-multiplying the images with their CTFs, <xref ref-type="disp-formula" rid="equ7">Equation 7</xref> aims to be equivalent of <xref ref-type="disp-formula" rid="equ4">Equation 4</xref>. The variance <inline-formula><mml:math id="inf34"><mml:msubsup><mml:mi>σ</mml:mi><mml:mi mathvariant="bold">k</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:math></inline-formula> is equivalent to <inline-formula><mml:math id="inf35"><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>j</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:math></inline-formula>, the power of the noise in the individual Fourier components in the 2D images.</p><p>We then optimise <xref ref-type="disp-formula" rid="equ1">Equation 1</xref> by expectation-maximisation (<xref ref-type="bibr" rid="bib12">Dempster et al., 1977</xref>), using <xref ref-type="disp-formula" rid="equ7">Equation 7</xref> to construct the likelihood function and using a prior <inline-formula><mml:math id="inf36"><mml:mrow><mml:mrow><mml:mi>P</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="normal">Θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>∝</mml:mo><mml:mrow><mml:mi>exp</mml:mi><mml:mo>⁢</mml:mo><mml:mrow><mml:msub><mml:mo largeop="true" symmetric="true">∑</mml:mo><mml:mi mathvariant="bold">k</mml:mi></mml:msub><mml:mfrac><mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mi>V</mml:mi><mml:mi mathvariant="bold">k</mml:mi></mml:msub><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>⁢</mml:mo><mml:msubsup><mml:mi>τ</mml:mi><mml:mi>k</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, based on the expected frequency-dependent power of the signal <inline-formula><mml:math id="inf37"><mml:msubsup><mml:mi>τ</mml:mi><mml:mi>k</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:math></inline-formula>. This leads to the following iterative algorithm:<disp-formula id="equ11"><label>(11)</label><mml:math id="m11"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msubsup><mml:mi>V</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:munder><mml:mi>D</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>R</mml:mi><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mo>⊺</mml:mo></mml:mrow></mml:msubsup><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:msup><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow><mml:mrow><mml:mtext>(n+1)</mml:mtext></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mi>W</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>R</mml:mi><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mo>⊺</mml:mo></mml:mrow></mml:msubsup><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:msup><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow><mml:mrow><mml:mtext>(n+1)</mml:mtext></mml:mrow></mml:msup></mml:mrow><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:msup><mml:mrow><mml:msubsup><mml:mi>τ</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mrow><mml:mrow><mml:mtext>(n+1)</mml:mtext></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:mstyle></mml:mstyle></mml:mrow></mml:math></disp-formula><disp-formula id="equ12"><label>(12)</label><mml:math id="m12"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:munder><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mi>V</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:munder><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mstyle></mml:mstyle></mml:mrow></mml:math></disp-formula><disp-formula id="equ13"><label>(13)</label><mml:math id="m13"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msubsup><mml:mi>τ</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>V</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mn>2</mml:mn></mml:mfrac><mml:mfrac><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:munder><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:munder><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow><mml:mo>∈</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold">k</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mstyle></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>where (n) denotes the iteration; the divisions by <inline-formula><mml:math id="inf38"><mml:msubsup><mml:mi>τ</mml:mi><mml:mi>k</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:math></inline-formula> and <inline-formula><mml:math id="inf39"><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>k</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:math></inline-formula> in <xref ref-type="disp-formula" rid="equ11">Equation 11</xref> are evaluated element-wise; and <inline-formula><mml:math id="inf40"><mml:msubsup><mml:mi>τ</mml:mi><mml:mi>k</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:math></inline-formula> and <inline-formula><mml:math id="inf41"><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>k</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:math></inline-formula> are calculated by averaging over <inline-formula><mml:math id="inf42"><mml:msubsup><mml:mi>τ</mml:mi><mml:mi mathvariant="bold">k</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:math></inline-formula> and <inline-formula><mml:math id="inf43"><mml:msubsup><mml:mi>σ</mml:mi><mml:mi mathvariant="bold">k</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:math></inline-formula>, respectively, in hollow spheres of radius <inline-formula><mml:math id="inf44"><mml:mi>k</mml:mi></mml:math></inline-formula> and thickness 1, described by <inline-formula><mml:math id="inf45"><mml:msub><mml:mi>S</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula>. The ratio of the terms containing <inline-formula><mml:math id="inf46"><mml:msub><mml:mi>W</mml:mi><mml:mi mathvariant="bold">k</mml:mi></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf47"><mml:msub><mml:mi>M</mml:mi><mml:mi mathvariant="bold">k</mml:mi></mml:msub></mml:math></inline-formula> in <xref ref-type="disp-formula" rid="equ13">Equation 13</xref> corrects the estimate for the power of the signal from the CTF-corrected map <inline-formula><mml:math id="inf48"><mml:mi>V</mml:mi></mml:math></inline-formula> by the average CTF<sup>2</sup> to account for the fact that the likelihood in <xref ref-type="disp-formula" rid="equ7">Equation 7</xref> was calculated for CTF pre-multiplied images.</p></sec><sec id="s2-2"><title>Pre-oriented priors</title><p>Many proteins are organised in imperfect 2D arrays inside the tomograms, for example, inside membranes or as part of capsid-like structures. Often, the individual protein molecules inside these arrays exhibit limited rotational freedom with respect to the surface normal of the array, although they may be able to rotate freely around that normal. This knowledge is often exploited in subtomogram averaging approaches through local orientational searches, for example, see <xref ref-type="bibr" rid="bib14">Förster et al., 2005</xref>. This not only accelerates the refinement, as fewer orientations need to be evaluated, it also makes it possible to solve more challenging structures because fewer solutions are allowed. In RELION, local orientational searches are implemented as Gaussian priors on the Cartesian translations and on the three Euler angles that describe rotations (<xref ref-type="bibr" rid="bib38">Scheres, 2012</xref>). One advantage of using pseudo-subtomogram alignment is that the coordinate system of the pseudo-subtomograms themselves can be chosen arbitrarily. By default, pseudo-subtomograms are created in the same orientation as the tomogram, but the user can choose to orient them in a more meaningful way. For example, by constructing the pseudo-subtomograms with their <inline-formula><mml:math id="inf49"><mml:mi>Z</mml:mi></mml:math></inline-formula>-axis parallel to the 2D array, using a rotational prior of approximately 90° on the tilt angle will limit the amount of rocking of the particles inside the array, while avoiding singularities in the definition of the Euler angles that occur when the tilt angle is close to 0°.</p></sec><sec id="s2-3"><title>Tilt-series refinement</title><p>Averaging over multiple particles leads to an increased signal-to-noise ratio in the estimated density map <inline-formula><mml:math id="inf50"><mml:mi>V</mml:mi></mml:math></inline-formula>. We also implemented procedures that exploit <inline-formula><mml:math id="inf51"><mml:mi>V</mml:mi></mml:math></inline-formula> for subsequent re-estimation of parameters that describe the tilt series. These procedures do not require pseudo-subtomograms, but are performed by comparing projections of the density maps directly with the (Fourier) pixels of 2D boxes that are extracted from the tilt-series images, with a sufficient size to hold the CTF-delocalised signal. The various tilt-series parameters are then estimated by minimising the negative log-likelihood as defined in <xref ref-type="disp-formula" rid="equ4">Equation 4</xref>, that is, the sum over noise-weighted square differences between the prediction and the observation.</p><p>The tilt-series properties that can be refined fall into two broad categories: optical and geometrical. The optical refinement concerns the different parameters of the CTF, while the geometrical refinement aims to optimise the alignment of the tilt series, as well as the beam-induced motion of the individual particles. Both sets of algorithms are closely related to the corresponding single-particle algorithms in RELION: optical-aberration refinement (<xref ref-type="bibr" rid="bib51">Zivanov et al., 2018</xref>; <xref ref-type="bibr" rid="bib53">Zivanov et al., 2020</xref>) and Bayesian polishing (<xref ref-type="bibr" rid="bib52">Zivanov et al., 2019</xref>), respectively. In spite of the similarity between the algorithms, the models that are optimised differ significantly from single-particle analysis. Details of the implementation of the optical and geometrical refinement algorithms are given in Appendix 1. We also note that Bayesian polishing in SPA describes particle motions between individual movie frames. Although our approach for tomography can also consider movie frames, the current implementation uses the same regularisation of particle motions between movie frames within each tilt image as between the movie frames from other tilt images. Because preliminary tests showed limited benefits in considering the movie frames in this manner, only the functionality to model particle motions between the tilt-series images was exposed on the GUI.</p><p>CTF refinement for tomographic data in RELION-4.0 includes optimisation of scale factors that model frequency-dependent radiation damage, defocus, astigmatism, and higher-order symmetrical and antisymmetrical aberrations. Although individual particles within a field of view are at distinct defoci in the tilt-series images, their relative defoci are known from the geometry of the tilt series and the known 3D positions of the particles in the tomogram. Therefore, one can efficiently perform defocus estimation in a single pass, considering all particles in a tilt-series image simultaneously. In order to do so, we modified procedures that were developed for higher-order aberration estimation in single-particle analysis (<xref ref-type="bibr" rid="bib53">Zivanov et al., 2020</xref>), where the information from all particles in each tilt-series image is condensed into two images that are used to estimate a common phase shift (see Appendix).</p><p>Similar procedures can also be used to model higher-order symmetrical and antisymmetrical aberrations in the tomographic data. Analogously to our single-particle approach, they are modelled using Zernike polynomials and estimated in the same way. Because the higher-order aberrations are often only a limiting factor at relatively high spatial frequencies, a large number of particles are needed to estimate them reliably. Optimally, higher-order aberrations would thus be estimated globally, over the entire data set, and only for cases that yield high-resolution averages. If aberrations change during data collection, data sets may be split into optics groups, for which aberrations are estimated separately. Typically, the third-order antisymmetrical aberrations are the most important ones, that is, trefoil and axial coma, which can both be caused by a tilted beam. The resolution gains that these optimisations will yield depend on the microscope (mis)alignment. Provided alignment has been performed reasonably well, higher-order aberration correction will probably be most useful for reconstructions that extend beyond 3 Å resolution.</p><p>The geometric alignment includes both (rigid) rotational and translational re-alignment of the tilt-series images, as well as the modelling of beam-induced motion of individual particles throughout the tilt series. For the latter, we neglect rotations of the particles, and only model beam-induced translations. By doing so, we can precompute the likelihood of each particle being in each position around its original one, and then look for an alignment that simultaneously maximises the sum of those likelihoods over all tilt-series images and all particles, as well as a prior that ensures spatially coherent motion. This allows us to evaluate the likelihood of a hypothetical particle position by looking up a single interpolated value in an image. In this formulation, the problem becomes equivalent to the Bayesian polishing approach that we originally developed for single-particle analysis, except for the inclusion of a third spatial dimension for the motion.</p></sec></sec><sec id="s3" sec-type="results"><title>Results</title><p>We tested our approach on three test cases. <xref ref-type="table" rid="app2table1">Appendix 2—table 1</xref> provides experimental details for each of the data sets; <xref ref-type="table" rid="app2table2">Appendix 2—table 2</xref> provides details on the image processing.</p><sec id="s3-1"><title>HIV-1 immature capsid</title><p>We tested the workflow above on the cryo-ET data set that was used to determine the structure of the immature capsid lattice and spacer peptide 1 (CA-SP1) regions of the Gag polyprotein from human immunodeficiency virus 1 (HIV-1) (<xref ref-type="bibr" rid="bib41">Schur et al., 2016</xref>) (EMPIAR-10164). We used the same subset of five tomograms that were also used to assess the NovaCTF (<xref ref-type="bibr" rid="bib45">Turoňová et al., 2017</xref>), emClarity (<xref ref-type="bibr" rid="bib21">Himes and Zhang, 2018</xref>), and Warp (<xref ref-type="bibr" rid="bib43">Tegunov and Cramer, 2019</xref>) programs. Introducing 3D CTF correction, and using the alignment parameters from the original analysis by Schur et al., NovaCTF reported a resolution of 3.9 Å (<xref ref-type="bibr" rid="bib45">Turoňová et al., 2017</xref>). The Warp program introduced local and global motion correction in the tilt-series images, as well as optimisation of CTF parameters. The combination of Warp and subtomogram alignment and averaging in RELION-3 led to a resolution of 3.8 Å. A recent application of emClarity led to a reconstruction to 3.3 Å resolution (<xref ref-type="bibr" rid="bib31">Ni et al., 2022</xref>).</p><p>We used tilt-series projections after movie frame alignment from the original analysis (<xref ref-type="bibr" rid="bib41">Schur et al., 2016</xref>), without any other preprocessing step, along with the tilt-series alignment data, performed with IMOD package (<xref ref-type="bibr" rid="bib26">Kremer et al., 1996</xref>), and CTF parameters estimation using CTFFIND4 (<xref ref-type="bibr" rid="bib35">Rohou and Grigorieff, 2015</xref>). We used 12,910 particles from the five tomograms subset, reconstructed an initial reference map using the original published particle alignment, and filtered it to 5 Å. A first alignment in 3D auto-refine, followed by averaging of the initial pseudo-subtomograms, led to a resolution of 3.6 Å. This average was then used for a full cycle of pseudo-subtomogram improvement and realignment. We first applied CTF refinement to optimise the defoci of all particles. This improved the resolution only marginally. Subsequent optimisation of the tilt-series geometry, including modelling local particle motion, improved the resolution to 3.5 Å. Finally, realignment of newly generated pseudo-subtomograms led to a resolution of 3.4 Å. A second cycle of these three steps provided 3.3 Å, while a third cycle converged to 3.2 Å (<xref ref-type="fig" rid="fig1">Figure 1a</xref>). Geometrical refinement was performed estimating local particle motion. The consideration of deformations did not show additional improvement. In the first cycle, where improvements in both CTFs and geometry are most obvious, the order of applying those optimisations did not alter the final result for this data set. These data and results are also distributed as part of the subtomogram tutorial in RELION-4.0, as described on <ext-link ext-link-type="uri" xlink:href="https://relion.readthedocs.io/en/release-4.0/">https://relion.readthedocs.io/en/release-4.0/</ext-link>. <xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref> shows the improvement in map quality during the iterative refinement process; <xref ref-type="fig" rid="fig1s2">Figure 1—figure supplement 2</xref> shows a comparison with the 3.3 Å map from emClarity.</p><fig-group><fig id="fig1" position="float"><label>Figure 1.</label><caption><title>Subtomogram averaging of the HIV-1 immature capsid.</title><p>(<bold>a</bold>) Fourier Shell Correlation (FSC) for resolution estimation of iteratively improved reconstructions using the new RELION-4.0 workflow. (<bold>b</bold>) Representative region of reconstructed density in the final map. (<bold>c</bold>) The same density as in (<bold>b</bold>), together with the published atomic model 5L93, which has not been additionally refined in the density.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-83724-fig1-v3.tif"/></fig><fig id="fig1s1" position="float" specific-use="child-fig"><label>Figure 1—figure supplement 1.</label><caption><title>Iterative map improvement.</title><p>Representative region of reconstructed densities at several stages of the iterative refinement process. The four panels on the left show the four stages with the same labels as in <xref ref-type="fig" rid="fig1">Figure 1a</xref>; the fifth panel shows the same region from the final map that was calculated from all 43 tomograms.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-83724-fig1-figsupp1-v3.tif"/></fig><fig id="fig1s2" position="float" specific-use="child-fig"><label>Figure 1—figure supplement 2.</label><caption><title>Comparison with emClarity.</title><p>(<bold>a</bold>) FSC for the RELION-4.0 map, which used 12,910 particles from the five tomogram subset (blue); the reported FSC for emClarity, which used 15,460 particles from the five tomogram subset (orange); and the FSC calculated from the deposited half-maps of emClarity, using the same mask as used for the RELION-4.0 FSC curve (yellow). (<bold>b</bold>) Representative region of the map calculated by RELION-4.0 from the five tomogram subset. (<bold>c</bold>) The same region of the map calculated by emClarity.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-83724-fig1-figsupp2-v3.tif"/></fig><fig id="fig1s3" position="float" specific-use="child-fig"><label>Figure 1—figure supplement 3.</label><caption><title>Comparison with M/RELION-3.1.</title><p>(<bold>a</bold>) FSC for the RELION-4.0 map, which used 144,275 particles from the full 43 tomogram data set (blue); the reported FSC for M/RELION-3.1, which used 130,658 particles from the full 43 tomogram data set (orange); and the FSC calculated from the deposited half-maps of M, using the same mask as used for the RELION-4.0 FSC curve (yellow). (<bold>b</bold>) Representative region of the map calculated by RELION-4.0 from the full 43 tomogram data set. (<bold>c</bold>) The same region of the map calculated by M/RELION-3.1.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-83724-fig1-figsupp3-v3.tif"/></fig></fig-group><p>Analysis of the complete data set generated a structure at 3.0 Å resolution (<xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>), which is the same resolution obtained using the M and RELION-3 workflow (<xref ref-type="bibr" rid="bib44">Tegunov et al., 2021</xref>; <xref ref-type="fig" rid="fig1s3">Figure 1—figure supplement 3</xref>), and is likely limited by flexibility and asymmetry in the CA hexamer.</p></sec><sec id="s3-2"><title><italic>Caulobacter crescentus</italic> S-layer</title><p>We also applied our approach to thin cellular appendages of <italic>C. crescentus</italic> bacteria known as stalks, which have previously been imaged using cryo-ET (<xref ref-type="bibr" rid="bib6">Bharat et al., 2017</xref>). The cell body and cell stalks of <italic>C. crescentus</italic> cells are covered by a nearly hexagonal, paracrystalline array known as the surface layer (S-layer) (<xref ref-type="bibr" rid="bib42">Smit et al., 1992</xref>). The structure of the S-layer was solved using a combination of X-ray crystallography, cryo-EM single-particle analysis, and subtomogram averaging, revealing how the S-layer is attached to bacterial cells by an abundant glycolipid called lipopolysaccharide (LPS) (<xref ref-type="bibr" rid="bib6">Bharat et al., 2017</xref>; <xref ref-type="bibr" rid="bib46">von Kügelgen et al., 2020</xref>). Previously, cryo-ET of the S-layer, using 110 tilt series collected with a dose-symmetric scheme, yielded 51,866 hexamers of the S-layer. This study used a subtomogram averaging approach that is based on a constrained cross-correlation approach implemented in the AV3 MATLAB suite (<xref ref-type="bibr" rid="bib15">Förster and Hegerl, 2007</xref>), and which was specifically optimised for the analysis of macromolecules arranged in a lattice (<xref ref-type="bibr" rid="bib48">Wan et al., 2017</xref>). A 7.4 Å reconstruction of the S-layer was obtained, in which alpha-helices were resolved (<xref ref-type="bibr" rid="bib6">Bharat et al., 2017</xref>). This reconstruction was improved by application of NovaCTF (<xref ref-type="bibr" rid="bib45">Turoňová et al., 2017</xref>), leading to a 4.8 Å reconstruction, in which large amino acid residue side chains were resolved (<xref ref-type="bibr" rid="bib46">von Kügelgen et al., 2020</xref>). Moreover, density for an LPS molecule was observed near the putative LPS-binding residues of the S-layer, in agreement with a cryo-EM single-particle structure of an in vitro reconstituted coplex (<xref ref-type="bibr" rid="bib46">von Kügelgen et al., 2020</xref>). We used the tilt series after movie frame alignment from the initial analysis (<xref ref-type="bibr" rid="bib6">Bharat et al., 2017</xref>), along with the tilt-series alignments performed within IMOD (<xref ref-type="bibr" rid="bib26">Kremer et al., 1996</xref>), CTF parameters from CTFFIND4 (<xref ref-type="bibr" rid="bib35">Rohou and Grigorieff, 2015</xref>), and the Euler angle assignments and subtomogram coordinates from the original analysis. These parameters were imported into RELION-4.0, followed by multiple cycles of pseudo-subtomogram generation and refinement, analogous to the immature HIV-1 data set described above, leading to a 5.6 Å reconstruction of the S-layer hexamer (<xref ref-type="fig" rid="fig2">Figure 2a</xref>). Next, we defined a mask around the central pore of the S-layer, corresponding to the inner domain bound to LPS, to perform focused refinements. Another cycle of pseudo-subtomogram reconstruction, CTF refinement, and refinement within the new mask improved the resolution to 4.4 Å. Accounting for per-particle motions with additional cycles of pseudo-subtomogram improvements and refinements increased the resolution of the central pore to 4.0 Å, and the inner domain of the S-layer to 3.7 Å. Further 3D classification without alignments identified a subset of 42,990 subtomograms that gave a 3.5 Å resolution reconstruction of the inner S-layer.</p><fig-group><fig id="fig2" position="float"><label>Figure 2.</label><caption><title>Subtomogram averaging of the <italic>C</italic>. <italic>crescentus</italic> S-layer from cell stalks.</title><p>(<bold>a</bold>) FSC for resolution estimation of iteratively improved reconstructions using the new RELION-4.0 workflow, tested on the S-layer inner domain. (<bold>b</bold>) Densities for the previously identified lipopolysaccharide (LPS) (cyan and orange) and Ca<sup>2+</sup> ions (green) in prior electron cryo-microscopy (cryo-EM) single-particle analyses are resolved. (<bold>c, d</bold>) The final map shows two densities for bound LPS O-antigen chains. Panel (<bold>c</bold>) shows only the S-layer protein as blue ribbon and (<bold>d</bold>) shows LPS O-antigen as orange and cyan sugars corresponding to the N-acetyl-perosamine and mannose moieties, respectively.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-83724-fig2-v3.tif"/></fig><fig id="fig2s1" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 1.</label><caption><title>Comparison of subtomogram averaging (STA) and single-particle analysis (SPA) reconstructions of the <italic>C</italic>. <italic>crescentus</italic> RsaA.</title><p>(<bold>a</bold>) Bottom view of STA map of <italic>C. crescentus</italic> RsaA with lipopolysaccharide (LPS) O-antigen binding site as orange and cyan sugars corresponding to the N-acetyl-perosamine and mannose moieties, respectively, at a threshold of 9 σ. (<bold>b</bold>) Same view of the SPA map (EMD-10389) with no second LPS O-antigen. (<bold>c</bold>) FSC between the original refined model (PDB-ID: 6T72) and the SPA map (blue), as well as the same model after a rigid body fit (orange solid line) and refinement with a 4 Å resolution cut-off (orange dashed line) into the STA map. (<bold>d</bold>) Overlay of the refined model in the STA map (orange) and the original model (light blue, PDB-ID: 6T72) with an overall RMSD of 0.62 Å.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-83724-fig2-figsupp1-v3.tif"/></fig></fig-group><p>The 3.5 Å map is in excellent agreement with the single-particle structure of the in vitro reconstituted complex, including the LPS binding site (<xref ref-type="bibr" rid="bib46">von Kügelgen et al., 2020</xref>; see <xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>). Furthermore, divalent metal ions, known to be tightly bound to the inner S-layer (<xref ref-type="bibr" rid="bib30">Matthew, 2021</xref>), are resolved (<xref ref-type="fig" rid="fig2">Figure 2b</xref>). Surprisingly, at lower isosurface contour levels, we also observed a second LPS binding site (<xref ref-type="fig" rid="fig2">Figure 2c and d</xref>). The size and shape of this density agree with the structure of the LPS O-antigen, illustrating how improved subtomogram averaging in RELION-4.0 can help uncover new biology.</p></sec><sec id="s3-3"><title>Coat protein complex II</title><p>Finally, we applied our approach to the <italic>Saccharomyces cerevisiae</italic> coat protein complex II (COPII), which mediates the transport of newly synthesised proteins from the endoplasmic reticulum (ER) to the Golgi apparatus as part of the secretory pathway. COPII is formed by five proteins that assemble sequentially on the ER membrane to induce remodelling of the bilayer into coated carriers in a process known as COPII budding, while simultaneously selectively recruiting cargo into these budding membrane carriers. COPII budding can be reconstituted in vitro from purified proteins and artificial membranes, to form small, spherical vesicles, or long, straight tubes. Cryo-ET has previously been used to visualise the architecture of COPII on reconstituted tubules (<xref ref-type="bibr" rid="bib23">Hutchings et al., 2018</xref>; <xref ref-type="bibr" rid="bib24">Hutchings et al., 2021</xref>). The coat assembles into two concentric layers; the inner layer forms a pseudo helical lattice, which has previously been solved to 4.6 Å resolution using Dynamo-based subtomogram averaging protocols (<xref ref-type="bibr" rid="bib7">Castaño-Díez et al., 2012</xref>).</p><p>We used the tilt series after movie alignment from the initial analysis (<xref ref-type="bibr" rid="bib24">Hutchings et al., 2021</xref>), along with the tilt-series alignments performed in Dyname (<xref ref-type="bibr" rid="bib7">Castaño-Díez et al., 2012</xref>) and CTF parameters from CTFFIND4 (<xref ref-type="bibr" rid="bib35">Rohou and Grigorieff, 2015</xref>). COPII-coated tubes were manually traced in the resulting tomograms, and particles were extracted by randomly oversampling their surface, with approximate initial orientations assigned based on the cylindrical geometry. Dynamo was used for initial alignment of 8× binned subtomograms to define the centre of the particles and the directionality of individual tubes. We then imported the particle coordinates for processing in RELION-4.0 using 3D refinement at 4× and 2× binning. Since we expect inner coat subunits to arrange in a lattice, we cleaned the data set by excluding any subtomograms that did not conform to the expected geometrical relationship with their neighbouring particles. A first 3D refinement of the unbinned data set gave a map at 4.4 Å resolution, which was further improved to 4.2 Å and 4.0 Å by tilt-series frame alignment and CTF refinement, respectively. Two further rounds of 3D refinement, followed by tilt-series frame alignment and CTF refinement, yielded a final map with a resolution of 3.8 Å (<xref ref-type="fig" rid="fig3">Figure 3</xref>).</p><fig id="fig3" position="float"><label>Figure 3.</label><caption><title>Subtomogram averaging of the COP-II inner layer.</title><p>(<bold>a</bold>) FSC for resolution estimation of iteratively improved reconstructions using the new RELION-4.0 workflow, tested on the COP-II inner layer. (<bold>b</bold>) Reconstructed density for the inner layer. (<bold>c</bold>) Zoomed-in region of the final map (in transparent grey) with the refined atomic model (blue).</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-83724-fig3-v3.tif"/></fig><p>At this resolution, most side chains are visible in the map, enabling us to build and refine an atomic model. The improved model will allow the design of point mutants to precisely disrupt interfaces between coat subunits and test their effects in COPII budding.</p></sec></sec><sec id="s4" sec-type="discussion"><title>Discussion</title><p>We formulate the problem of averaging over multiple identical particles in tomographic tilt series in an empirical Bayesian framework that is based on a statistical model that approximates one for two-dimensional experimental data. The Bayesian framework has proven effective in reducing the number of tunable parameters and in obtaining high-quality reconstructions from single-particle data (<xref ref-type="bibr" rid="bib13">Fernandez-Leiro and Scheres, 2016</xref>). The two-dimensional data model describes the experimental images better than alternative approaches that use 3D reconstructed subtomograms as an intermediate. One example of a problem with the intermediate 3D data model is the need for missing wedge correction, which arises from the observation that the experimental images were acquired, incompletely, in three dimensions. Artefacts related to suboptimal missing wedge correction may affect both alignment and classification of particles. By using an approximation to the 2D data model, missing wedge correction is no longer required. Instead, the problem approaches that of single-particle analysis, where projections from different orientations and of different structural states are sorted out simultaneously. Provided the 3D Fourier transform of the distinct classes is fully sampled through the orientation distribution of the raw particles, likelihood optimisation techniques have been highly successful in tackling this problem in single-particle analysis (<xref ref-type="bibr" rid="bib37">Scheres et al., 2007</xref>; <xref ref-type="bibr" rid="bib13">Fernandez-Leiro and Scheres, 2016</xref>).</p><p>In practice, the implementation in RELION-4.0 does not use stacks of 2D projection images as input for the refinement program that performs alignment and classification. Instead, the concept of 3D pseudo-subtomograms is introduced, where the tilt-series images are Fourier transformed, pre-multiplied with their CTF, and inserted as a slice into a 3D Fourier volume according to the best current estimates for the tilt-series geometry. The use of 3D pseudo-subtomograms allowed reusing existing code for subtomogram averaging in RELION, while input stacks of 2D images would have required significant software development efforts. Nevertheless, in the future we might still choose to implement a true 2D version of the code, which would be more efficient, both in terms of processing time and disk storage requirements. In cases where the number of tilt images is small in comparison to the box size, fewer Fourier pixels need to be examined in a stack of 2D images than in a pseudo-subtomogram, with a corresponding decrease in processing time. Moreover, the likelihood calculation from the 3D pseudo-subtomogram approach requires separate storage of the accumulated squares of the CTFs, and the corresponding multiplicity terms. In contrast, in the 2D approach, only the 2D images need to be stored, as CTF parameters can be calculated on-the-fly and there is no need for a multiplicity term, giving a corresponding decrease in storage requirements. However, if one were to collect tilt series with very fine angular increments or in a continuous manner (<xref ref-type="bibr" rid="bib10">Chreifi et al., 2019</xref>), then the current implementation may still be preferable.</p><p>Besides the alignment and classification of individual particles, the methods described here also deal with re-estimation of parameters that describe the optical and geometrical features of the tilt series. As soon as an initial average structure has been obtained, its increased signal-to-noise ratio can be exploited to determine these parameters more accurately than what is possible from the raw tilt-series images alone. The implementations in RELION-4.0 again follow those previously implemented for single-particle analysis, where CTF refinement is used for re-estimation of the tilt-series images CTFs, and algorithms akin to Bayesian polishing are used to re-estimate the tilt-series alignment, as well as the movement of individual particles throughout the tilt-series acquisition process. As better tilt-series parameters will allow better pseudo-subtomograms, particle alignment and classification are iterated with the optimisation of the tilt-series parameters.</p><p>Similar tilt-series and CTF optimisation approaches have been implemented in the program M (<xref ref-type="bibr" rid="bib44">Tegunov et al., 2021</xref>). Compared to M, RELION-4.0 uses computationally more efficient algorithms; M uses GPUs to accelerate the calculations. In both tomography and SPA, RELION-4.0 only models beam-induced translations of the particles, whereas M also models beam-induced rotations. Since SPA routinely reaches 2 Å resolutions without modelling beam-induced rotations, we assumed that the effect of rotations of individual particles throughout the tilt series is not large enough to warrant their correction at typical tomography resolutions. In cases where the data do allow for better than 2 Å resolutions, M could still be used to correct for beam-induced rotations in a postprocessing step, following alignment and classification of the individual particles in RELION. It is likely that adaptation of M, in order to function with the pseudo-subtomograms proposed here, would lead to increased synergy between the two programs. In the meantime, external tools to convert from M parameters to RELION-4.0 are already available (<ext-link ext-link-type="uri" xlink:href="https://github.com/joton/reliontomotools">https://github.com/joton/reliontomotools</ext-link>; <xref ref-type="bibr" rid="bib54">Zivanov, 2022</xref> copy archived at <ext-link ext-link-type="uri" xlink:href="https://archive.softwareheritage.org/swh:1:dir:818da4e25a2d63c73d5d3e73507a7a4495836913;origin=https://github.com/joton/reliontomotools;visit=swh:1:snp:13317e0fc4360f2054e622a8f4c5d7ed8b26f948;anchor=swh:1:rev:bfa43828876ceb77bed0c7eb72f794c79c9de5e6">swh:1:rev:bfa43828876ceb77bed0c7eb72f794c79c9de5e6</ext-link>).</p><p>Besides the reduction in tunable parameters that is characteristic of the Bayesian approach, its uptake by researchers that are new to the field is further facilitated through the implementation of a graphical user interface. This interface is already widely used for single-particle analysis and has been extended for the processing of tomographic data in RELION-4.0. Apart from the calculations that will be familiar to users of single-particle analysis, for example, 3D classification, 3D initial model generation, and 3D auto-refinement, the new interface also provides convenient access to the tomography-specific versions for CTF refinement and Bayesian polishing, as well as preprocessing operations to calculate the pseudo-subtomograms. However, tilt-series alignment, tomogram reconstruction, and particle picking are not yet part of the RELION workflow. Efforts to also implement solutions for those steps in a single tomography processing pipeline are ongoing and will be part of future RELION releases. Meanwhile, current import procedures rely on specific preprocessing operations in IMOD (<xref ref-type="bibr" rid="bib26">Kremer et al., 1996</xref>), and particle coordinate conversion tools to use in RELION-4.0 are available for a range of third-party software packages (<xref ref-type="bibr" rid="bib34">Pyle et al., 2022</xref>). To further facilitate the uptake of this new software by the community, we have provided an online tutorial that uses the publicly available HIV-1 immature capsid data set to describe and illustrate all steps necessary to obtain the results described in <xref ref-type="fig" rid="fig1">Figure 1</xref>.</p><p>In summary, we introduce new methods for subtomogram averaging to resolutions that are sufficient for de novo atomic modelling and increase the accessibility of this emerging technique. We envision that our methods will allow more researchers to calculate better structures from tomographic data, which will aid the next revolution in structural biology, where macromolecular complexes are imaged, not in isolation, but in their biologically relevant environment.</p></sec></body><back><sec sec-type="additional-information" id="s5"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="COI-statement" id="conf1"><p>No competing interests declared</p></fn><fn fn-type="COI-statement" id="conf2"><p>No competing interests declared</p></fn><fn fn-type="COI-statement" id="conf3"><p>Reviewing editor, <italic>eLife</italic></p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>Conceptualization, Software, Formal analysis, Investigation, Methodology, Writing – original draft, Writing – review and editing</p></fn><fn fn-type="con" id="con2"><p>Conceptualization, Software, Formal analysis, Investigation, Methodology, Writing – original draft, Writing – review and editing</p></fn><fn fn-type="con" id="con3"><p>Formal analysis, Investigation, Visualization, Methodology, Writing – original draft, Writing – review and editing</p></fn><fn fn-type="con" id="con4"><p>Data curation, Formal analysis, Investigation, Visualization, Methodology, Writing – original draft, Writing – review and editing</p></fn><fn fn-type="con" id="con5"><p>Software, Formal analysis, Investigation, Visualization, Methodology, Writing – original draft, Writing – review and editing</p></fn><fn fn-type="con" id="con6"><p>Formal analysis, Investigation, Methodology, Writing – review and editing</p></fn><fn fn-type="con" id="con7"><p>Software, Investigation, Methodology, Writing – review and editing</p></fn><fn fn-type="con" id="con8"><p>Supervision, Funding acquisition, Project administration, Writing – review and editing</p></fn><fn fn-type="con" id="con9"><p>Formal analysis, Supervision, Funding acquisition, Investigation, Visualization, Writing – original draft, Project administration, Writing – review and editing</p></fn><fn fn-type="con" id="con10"><p>Formal analysis, Supervision, Funding acquisition, Investigation, Visualization, Writing – original draft, Project administration, Writing – review and editing</p></fn><fn fn-type="con" id="con11"><p>Conceptualization, Formal analysis, Supervision, Funding acquisition, Investigation, Visualization, Writing – original draft, Project administration, Writing – review and editing</p></fn><fn fn-type="con" id="con12"><p>Conceptualization, Resources, Data curation, Software, Formal analysis, Supervision, Funding acquisition, Validation, Investigation, Methodology, Writing – original draft, Project administration, Writing – review and editing</p></fn></fn-group></sec><sec sec-type="supplementary-material" id="s6"><title>Additional files</title><supplementary-material id="mdar"><label>MDAR checklist</label><media xlink:href="elife-83724-mdarchecklist1-v3.docx" mimetype="application" mime-subtype="docx"/></supplementary-material></sec><sec sec-type="data-availability" id="s7"><title>Data availability</title><p>We have only used previously published cryo-EM data sets for testing our software. Reconstructed maps and atomic models generated in this study have been submitted to the EMDB and PDB, with entry codes as indicated in Table 1.</p><p>The following previously published dataset was used:</p><p><element-citation publication-type="data" specific-use="references" id="dataset1"><person-group person-group-type="author"><name><surname>Schur</surname><given-names>FK</given-names></name><name><surname>Obr</surname><given-names>M</given-names></name><name><surname>Hagen</surname><given-names>WJ</given-names></name><name><surname>Wan</surname><given-names>W</given-names></name><name><surname>Jakobi</surname><given-names>AJ</given-names></name><name><surname>Kirkpatrick</surname><given-names>JM</given-names></name><name><surname>Sachse</surname><given-names>C</given-names></name><name><surname>Kräusslich</surname><given-names>HG</given-names></name><name><surname>Briggs</surname><given-names>JA</given-names></name></person-group><year iso-8601-date="2018">2018</year><data-title>Cryo-electron tomography of immature HIV-1 dMACANC VLPs</data-title><source>Empiar</source><pub-id pub-id-type="accession" xlink:href="https://www.ebi.ac.uk/empiar/EMPIAR-10164/">EMPIAR-10164</pub-id></element-citation></p></sec><ack id="ack"><title>Acknowledgements</title><p>We are grateful to the MRC-LMB EM facility for help with data acquisition and to Jake Grimmett, Toby Darling, and Ivan Clayson for help with high-performance computing. This work was funded by the UK Research and Innovation (UKRI) Medical Research Council (MC_UP_A025_1013 to SHWS; and MC_UP_1201/16 to JAGB), the European Research Council (ERC) under the European Union’s Horizon 2020 research and innovation program (ERC-CoG-2014, grant 648432, MEMBRANEFUSION to JAGB and ERC StG-2019, grant 852915 CRYTOCOP to GZ); the Swiss National Science Foundation (grant 205321_179041/1 to DC-D), the Max Planck Society (to JAGB) and the UKRI Biotechnology and Biological Sciences Research Council (grant BB/T002670/1 to GZ). TAMB is a recipient of a Sir Henry Dale Fellowship, jointly funded by the Wellcome Trust and the Royal Society (202231/Z/16/Z). JZ was partially funded by the European Union’s Horizon 2020 research and innovation program (ERC-ADG-2015, grant 692726, GlobalBioIm to Michael Unser). TAMB thanks the Vallee Research Foundation, the Leverhulme Trust, and the Lister Institute of Preventative Medicine for support.</p></ack><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Afonine</surname><given-names>PV</given-names></name><name><surname>Poon</surname><given-names>BK</given-names></name><name><surname>Read</surname><given-names>RJ</given-names></name><name><surname>Sobolev</surname><given-names>OV</given-names></name><name><surname>Terwilliger</surname><given-names>TC</given-names></name><name><surname>Urzhumtsev</surname><given-names>A</given-names></name><name><surname>Adams</surname><given-names>PD</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Real-Space refinement in phenix for cryo-EM and crystallography</article-title><source>Acta Crystallographica. Section D, Structural Biology</source><volume>74</volume><fpage>531</fpage><lpage>544</lpage><pub-id pub-id-type="doi">10.1107/S2059798318006551</pub-id><pub-id pub-id-type="pmid">29872004</pub-id></element-citation></ref><ref id="bib2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bartesaghi</surname><given-names>A</given-names></name><name><surname>Sprechmann</surname><given-names>P</given-names></name><name><surname>Liu</surname><given-names>J</given-names></name><name><surname>Randall</surname><given-names>G</given-names></name><name><surname>Sapiro</surname><given-names>G</given-names></name><name><surname>Subramaniam</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Classification and 3D averaging with missing wedge correction in biological electron tomography</article-title><source>Journal of Structural Biology</source><volume>162</volume><fpage>436</fpage><lpage>450</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2008.02.008</pub-id><pub-id pub-id-type="pmid">18440828</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bartesaghi</surname><given-names>A</given-names></name><name><surname>Lecumberry</surname><given-names>F</given-names></name><name><surname>Sapiro</surname><given-names>G</given-names></name><name><surname>Subramaniam</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Protein secondary structure determination by constrained single-particle cryo-electron tomography</article-title><source>Structure</source><volume>20</volume><fpage>2003</fpage><lpage>2013</lpage><pub-id pub-id-type="doi">10.1016/j.str.2012.10.016</pub-id><pub-id pub-id-type="pmid">23217682</pub-id></element-citation></ref><ref id="bib4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bepler</surname><given-names>T</given-names></name><name><surname>Morin</surname><given-names>A</given-names></name><name><surname>Rapp</surname><given-names>M</given-names></name><name><surname>Brasch</surname><given-names>J</given-names></name><name><surname>Shapiro</surname><given-names>L</given-names></name><name><surname>Noble</surname><given-names>AJ</given-names></name><name><surname>Berger</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Positive-unlabeled convolutional neural networks for particle picking in cryo-electron micrographs</article-title><source>Nature Methods</source><volume>16</volume><fpage>1153</fpage><lpage>1160</lpage><pub-id pub-id-type="doi">10.1038/s41592-019-0575-8</pub-id><pub-id pub-id-type="pmid">31591578</pub-id></element-citation></ref><ref id="bib5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bharat</surname><given-names>TA</given-names></name><name><surname>Scheres</surname><given-names>SH</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Resolving macromolecular structures from electron cryo-tomography data using subtomogram averaging in relion</article-title><source>Nature Protocols</source><volume>11</volume><fpage>2054</fpage><lpage>2065</lpage><pub-id pub-id-type="doi">10.1038/nprot.2016.124</pub-id><pub-id pub-id-type="pmid">27685097</pub-id></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bharat</surname><given-names>TAM</given-names></name><name><surname>Kureisaite-Ciziene</surname><given-names>D</given-names></name><name><surname>Hardy</surname><given-names>GG</given-names></name><name><surname>Yu</surname><given-names>EW</given-names></name><name><surname>Devant</surname><given-names>JM</given-names></name><name><surname>Hagen</surname><given-names>WJH</given-names></name><name><surname>Brun</surname><given-names>YV</given-names></name><name><surname>Briggs</surname><given-names>JAG</given-names></name><name><surname>Löwe</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Structure of the hexagonal surface layer on <italic>Caulobacter crescentus</italic> cells</article-title><source>Nature Microbiology</source><volume>2</volume><elocation-id>17059</elocation-id><pub-id pub-id-type="doi">10.1038/nmicrobiol.2017.59</pub-id><pub-id pub-id-type="pmid">28418382</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Castaño-Díez</surname><given-names>D</given-names></name><name><surname>Kudryashev</surname><given-names>M</given-names></name><name><surname>Arheit</surname><given-names>M</given-names></name><name><surname>Stahlberg</surname><given-names>H</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Dynamo: a flexible, user-friendly development tool for subtomogram averaging of cryo-EM data in high-performance computing environments</article-title><source>Journal of Structural Biology</source><volume>178</volume><fpage>139</fpage><lpage>151</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2011.12.017</pub-id><pub-id pub-id-type="pmid">22245546</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname><given-names>Y</given-names></name><name><surname>Pfeffer</surname><given-names>S</given-names></name><name><surname>Hrabe</surname><given-names>T</given-names></name><name><surname>Schuller</surname><given-names>JM</given-names></name><name><surname>Förster</surname><given-names>F</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Fast and accurate reference-free alignment of subtomograms</article-title><source>Journal of Structural Biology</source><volume>182</volume><fpage>235</fpage><lpage>245</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2013.03.002</pub-id><pub-id pub-id-type="pmid">23523719</pub-id></element-citation></ref><ref id="bib9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname><given-names>M</given-names></name><name><surname>Bell</surname><given-names>JM</given-names></name><name><surname>Shi</surname><given-names>X</given-names></name><name><surname>Sun</surname><given-names>SY</given-names></name><name><surname>Wang</surname><given-names>Z</given-names></name><name><surname>Ludtke</surname><given-names>SJ</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>A complete data processing workflow for cryo-et and subtomogram averaging</article-title><source>Nature Methods</source><volume>16</volume><fpage>1161</fpage><lpage>1168</lpage><pub-id pub-id-type="doi">10.1038/s41592-019-0591-8</pub-id><pub-id pub-id-type="pmid">31611690</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chreifi</surname><given-names>G</given-names></name><name><surname>Chen</surname><given-names>S</given-names></name><name><surname>Metskas</surname><given-names>LA</given-names></name><name><surname>Kaplan</surname><given-names>M</given-names></name><name><surname>Jensen</surname><given-names>GJ</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Rapid tilt-series acquisition for electron cryotomography</article-title><source>Journal of Structural Biology</source><volume>205</volume><fpage>163</fpage><lpage>169</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2018.12.008</pub-id><pub-id pub-id-type="pmid">30639925</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Croll</surname><given-names>TI</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>ISOLDE: a physically realistic environment for model building into low-resolution electron-density maps</article-title><source>Acta Crystallographica. Section D, Structural Biology</source><volume>74</volume><fpage>519</fpage><lpage>530</lpage><pub-id pub-id-type="doi">10.1107/S2059798318002425</pub-id><pub-id pub-id-type="pmid">29872003</pub-id></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dempster</surname><given-names>AP</given-names></name><name><surname>Laird</surname><given-names>NM</given-names></name><name><surname>Rubin</surname><given-names>DB</given-names></name></person-group><year iso-8601-date="1977">1977</year><article-title>Maximum likelihood from incomplete data via the em algorithm</article-title><source>Journal of the Royal Statistical Society</source><volume>39</volume><fpage>1</fpage><lpage>22</lpage><pub-id pub-id-type="doi">10.1111/j.2517-6161.1977.tb01600.x</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fernandez-Leiro</surname><given-names>R</given-names></name><name><surname>Scheres</surname><given-names>SH</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Unravelling biological macromolecules with cryo-electron microscopy</article-title><source>Nature</source><volume>537</volume><fpage>339</fpage><lpage>346</lpage><pub-id pub-id-type="doi">10.1038/nature19948</pub-id><pub-id pub-id-type="pmid">27629640</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Förster</surname><given-names>F</given-names></name><name><surname>Medalia</surname><given-names>O</given-names></name><name><surname>Zauberman</surname><given-names>N</given-names></name><name><surname>Baumeister</surname><given-names>W</given-names></name><name><surname>Fass</surname><given-names>D</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Retrovirus envelope protein complex structure in situ studied by cryo-electron tomography</article-title><source>PNAS</source><volume>102</volume><fpage>4729</fpage><lpage>4734</lpage><pub-id pub-id-type="doi">10.1073/pnas.0409178102</pub-id><pub-id pub-id-type="pmid">15774580</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Förster</surname><given-names>F</given-names></name><name><surname>Hegerl</surname><given-names>R</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Structure determination in situ by averaging of tomograms</article-title><source>Methods in Cell Biology</source><volume>79</volume><fpage>741</fpage><lpage>767</lpage><pub-id pub-id-type="doi">10.1016/S0091-679X(06)79029-X</pub-id><pub-id pub-id-type="pmid">17327182</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Förster</surname><given-names>F</given-names></name><name><surname>Pruggnaller</surname><given-names>S</given-names></name><name><surname>Seybert</surname><given-names>A</given-names></name><name><surname>Frangakis</surname><given-names>AS</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Classification of cryo-electron sub-tomograms using constrained correlation</article-title><source>Journal of Structural Biology</source><volume>161</volume><fpage>276</fpage><lpage>286</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2007.07.006</pub-id><pub-id pub-id-type="pmid">17720536</pub-id></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Frank</surname><given-names>GA</given-names></name><name><surname>Bartesaghi</surname><given-names>A</given-names></name><name><surname>Kuybeda</surname><given-names>O</given-names></name><name><surname>Borgnia</surname><given-names>MJ</given-names></name><name><surname>White</surname><given-names>TA</given-names></name><name><surname>Sapiro</surname><given-names>G</given-names></name><name><surname>Subramaniam</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Computational separation of conformational heterogeneity using cryo-electron tomography and 3D sub-volume averaging</article-title><source>Journal of Structural Biology</source><volume>178</volume><fpage>165</fpage><lpage>176</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2012.01.004</pub-id><pub-id pub-id-type="pmid">22248450</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Galaz-Montoya</surname><given-names>JG</given-names></name><name><surname>Hecksel</surname><given-names>CW</given-names></name><name><surname>Baldwin</surname><given-names>PR</given-names></name><name><surname>Wang</surname><given-names>E</given-names></name><name><surname>Weaver</surname><given-names>SC</given-names></name><name><surname>Schmid</surname><given-names>MF</given-names></name><name><surname>Ludtke</surname><given-names>SJ</given-names></name><name><surname>Chiu</surname><given-names>W</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Alignment algorithms and per-particle CTF correction for single particle cryo-electron tomography</article-title><source>Journal of Structural Biology</source><volume>194</volume><fpage>383</fpage><lpage>394</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2016.03.018</pub-id><pub-id pub-id-type="pmid">27016284</pub-id></element-citation></ref><ref id="bib19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Grant</surname><given-names>T</given-names></name><name><surname>Grigorieff</surname><given-names>N</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Measuring the optimal exposure for single particle cryo-EM using a 2.6 Å reconstruction of rotavirus VP6</article-title><source>eLife</source><volume>4</volume><elocation-id>e06980</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.06980</pub-id><pub-id pub-id-type="pmid">26023829</pub-id></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Heumann</surname><given-names>JM</given-names></name><name><surname>Hoenger</surname><given-names>A</given-names></name><name><surname>Mastronarde</surname><given-names>DN</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Clustering and variance maps for cryo-electron tomography using wedge-masked differences</article-title><source>Journal of Structural Biology</source><volume>175</volume><fpage>288</fpage><lpage>299</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2011.05.011</pub-id><pub-id pub-id-type="pmid">21616153</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Himes</surname><given-names>BA</given-names></name><name><surname>Zhang</surname><given-names>P</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>EmClarity: software for high-resolution cryo-electron tomography and subtomogram averaging</article-title><source>Nature Methods</source><volume>15</volume><fpage>955</fpage><lpage>961</lpage><pub-id pub-id-type="doi">10.1038/s41592-018-0167-z</pub-id><pub-id pub-id-type="pmid">30349041</pub-id></element-citation></ref><ref id="bib22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hrabe</surname><given-names>T</given-names></name><name><surname>Chen</surname><given-names>Y</given-names></name><name><surname>Pfeffer</surname><given-names>S</given-names></name><name><surname>Cuellar</surname><given-names>LK</given-names></name><name><surname>Mangold</surname><given-names>AV</given-names></name><name><surname>Förster</surname><given-names>F</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>PyTom: a python-based toolbox for localization of macromolecules in cryo-electron tomograms and subtomogram analysis</article-title><source>Journal of Structural Biology</source><volume>178</volume><fpage>177</fpage><lpage>188</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2011.12.003</pub-id><pub-id pub-id-type="pmid">22193517</pub-id></element-citation></ref><ref id="bib23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hutchings</surname><given-names>J</given-names></name><name><surname>Stancheva</surname><given-names>V</given-names></name><name><surname>Miller</surname><given-names>EA</given-names></name><name><surname>Zanetti</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Subtomogram averaging of COPII assemblies reveals how coat organization dictates membrane shape</article-title><source>Nature Communications</source><volume>9</volume><elocation-id>4154</elocation-id><pub-id pub-id-type="doi">10.1038/s41467-018-06577-4</pub-id><pub-id pub-id-type="pmid">30297805</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hutchings</surname><given-names>J</given-names></name><name><surname>Stancheva</surname><given-names>VG</given-names></name><name><surname>Brown</surname><given-names>NR</given-names></name><name><surname>Cheung</surname><given-names>ACM</given-names></name><name><surname>Miller</surname><given-names>EA</given-names></name><name><surname>Zanetti</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Structure of the complete, membrane-assembled COPII coat reveals a complex interaction network</article-title><source>Nature Communications</source><volume>12</volume><elocation-id>2034</elocation-id><pub-id pub-id-type="doi">10.1038/s41467-021-22110-6</pub-id><pub-id pub-id-type="pmid">33795673</pub-id></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jiménez de la Morena</surname><given-names>J</given-names></name><name><surname>Conesa</surname><given-names>P</given-names></name><name><surname>Fonseca</surname><given-names>YC</given-names></name><name><surname>de Isidro-Gómez</surname><given-names>FP</given-names></name><name><surname>Herreros</surname><given-names>D</given-names></name><name><surname>Fernández-Giménez</surname><given-names>E</given-names></name><name><surname>Strelak</surname><given-names>D</given-names></name><name><surname>Moebel</surname><given-names>E</given-names></name><name><surname>Buchholz</surname><given-names>TO</given-names></name><name><surname>Jug</surname><given-names>F</given-names></name><name><surname>Martinez-Sanchez</surname><given-names>A</given-names></name><name><surname>Harastani</surname><given-names>M</given-names></name><name><surname>Jonic</surname><given-names>S</given-names></name><name><surname>Conesa</surname><given-names>JJ</given-names></name><name><surname>Cuervo</surname><given-names>A</given-names></name><name><surname>Losana</surname><given-names>P</given-names></name><name><surname>Sánchez</surname><given-names>I</given-names></name><name><surname>Iceta</surname><given-names>M</given-names></name><name><surname>Del Cano</surname><given-names>L</given-names></name><name><surname>Gragera</surname><given-names>M</given-names></name><name><surname>Melero</surname><given-names>R</given-names></name><name><surname>Sharov</surname><given-names>G</given-names></name><name><surname>Castaño-Díez</surname><given-names>D</given-names></name><name><surname>Koster</surname><given-names>A</given-names></name><name><surname>Piccirillo</surname><given-names>JG</given-names></name><name><surname>Vilas</surname><given-names>JL</given-names></name><name><surname>Otón</surname><given-names>J</given-names></name><name><surname>Marabini</surname><given-names>R</given-names></name><name><surname>Sorzano</surname><given-names>COS</given-names></name><name><surname>Carazo</surname><given-names>JM</given-names></name></person-group><year iso-8601-date="2022">2022</year><article-title>ScipionTomo: towards cryo-electron tomography software integration, reproducibility, and validation</article-title><source>Journal of Structural Biology</source><volume>214</volume><elocation-id>107872</elocation-id><pub-id pub-id-type="doi">10.1016/j.jsb.2022.107872</pub-id><pub-id pub-id-type="pmid">35660516</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kremer</surname><given-names>JR</given-names></name><name><surname>Mastronarde</surname><given-names>DN</given-names></name><name><surname>McIntosh</surname><given-names>JR</given-names></name></person-group><year iso-8601-date="1996">1996</year><article-title>Computer visualization of three-dimensional image data using imod</article-title><source>Journal of Structural Biology</source><volume>116</volume><fpage>71</fpage><lpage>76</lpage><pub-id pub-id-type="doi">10.1006/jsbi.1996.0013</pub-id><pub-id pub-id-type="pmid">8742726</pub-id></element-citation></ref><ref id="bib27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>X</given-names></name><name><surname>Mooney</surname><given-names>P</given-names></name><name><surname>Zheng</surname><given-names>S</given-names></name><name><surname>Booth</surname><given-names>CR</given-names></name><name><surname>Braunfeld</surname><given-names>MB</given-names></name><name><surname>Gubbens</surname><given-names>S</given-names></name><name><surname>Agard</surname><given-names>DA</given-names></name><name><surname>Cheng</surname><given-names>Y</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Electron counting and beam-induced motion correction enable near-atomic-resolution single-particle cryo-EM</article-title><source>Nature Methods</source><volume>10</volume><fpage>584</fpage><lpage>590</lpage><pub-id pub-id-type="doi">10.1038/nmeth.2472</pub-id><pub-id pub-id-type="pmid">23644547</pub-id></element-citation></ref><ref id="bib28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liu</surname><given-names>DC</given-names></name><name><surname>Nocedal</surname><given-names>J</given-names></name></person-group><year iso-8601-date="1989">1989</year><article-title>On the limited memory bfgs method for large scale optimization</article-title><source>Math Program</source><volume>45</volume><fpage>503</fpage><lpage>528</lpage><pub-id pub-id-type="doi">10.1007/BF01589116</pub-id></element-citation></ref><ref id="bib29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mastronarde</surname><given-names>DN</given-names></name></person-group><year iso-8601-date="2003">2003</year><article-title>SerialEM: a program for automated tilt series acquisition on tecnai microscopes using prediction of specimen position</article-title><source>Microscopy and Microanalysis</source><volume>9</volume><fpage>1182</fpage><lpage>1183</lpage><pub-id pub-id-type="doi">10.1017/S1431927603445911</pub-id></element-citation></ref><ref id="bib30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Matthew</surname><given-names>H</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>High-resolution mapping of metal ions reveals principles of surface layer assembly in caulobacter crescentus cells</article-title><source>Structure</source><volume>1</volume><fpage>215</fpage><lpage>228</lpage><pub-id pub-id-type="doi">10.1016/j.str.2021.10.012</pub-id></element-citation></ref><ref id="bib31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ni</surname><given-names>T</given-names></name><name><surname>Frosio</surname><given-names>T</given-names></name><name><surname>Mendonça</surname><given-names>L</given-names></name><name><surname>Sheng</surname><given-names>Y</given-names></name><name><surname>Clare</surname><given-names>D</given-names></name><name><surname>Himes</surname><given-names>BA</given-names></name><name><surname>Zhang</surname><given-names>P</given-names></name></person-group><year iso-8601-date="2022">2022</year><article-title>High-Resolution in situ structure determination by cryo-electron tomography and subtomogram averaging using emclarity</article-title><source>Nature Protocols</source><volume>17</volume><fpage>421</fpage><lpage>444</lpage><pub-id pub-id-type="doi">10.1038/s41596-021-00648-5</pub-id><pub-id pub-id-type="pmid">35022621</pub-id></element-citation></ref><ref id="bib32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nickell</surname><given-names>S</given-names></name><name><surname>Förster</surname><given-names>F</given-names></name><name><surname>Linaroudis</surname><given-names>A</given-names></name><name><surname>Net</surname><given-names>WD</given-names></name><name><surname>Beck</surname><given-names>F</given-names></name><name><surname>Hegerl</surname><given-names>R</given-names></name><name><surname>Baumeister</surname><given-names>W</given-names></name><name><surname>Plitzko</surname><given-names>JM</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Tom software toolbox: acquisition and analysis for electron tomography</article-title><source>Journal of Structural Biology</source><volume>149</volume><fpage>227</fpage><lpage>234</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2004.10.006</pub-id><pub-id pub-id-type="pmid">15721576</pub-id></element-citation></ref><ref id="bib33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Punjani</surname><given-names>A</given-names></name><name><surname>Rubinstein</surname><given-names>JL</given-names></name><name><surname>Fleet</surname><given-names>DJ</given-names></name><name><surname>Brubaker</surname><given-names>MA</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>CryoSPARC: algorithms for rapid unsupervised cryo-EM structure determination</article-title><source>Nature Methods</source><volume>14</volume><fpage>290</fpage><lpage>296</lpage><pub-id pub-id-type="doi">10.1038/nmeth.4169</pub-id><pub-id pub-id-type="pmid">28165473</pub-id></element-citation></ref><ref id="bib34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pyle</surname><given-names>E</given-names></name><name><surname>Hutchings</surname><given-names>J</given-names></name><name><surname>Zanetti</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2022">2022</year><article-title>Strategies for picking membrane-associated particles within subtomogram averaging workflows</article-title><source>Faraday Discussions</source><volume>240</volume><fpage>101</fpage><lpage>113</lpage><pub-id pub-id-type="doi">10.1039/d2fd00022a</pub-id><pub-id pub-id-type="pmid">35924570</pub-id></element-citation></ref><ref id="bib35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rohou</surname><given-names>A</given-names></name><name><surname>Grigorieff</surname><given-names>N</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>CTFFIND4: fast and accurate defocus estimation from electron micrographs</article-title><source>Journal of Structural Biology</source><volume>192</volume><fpage>216</fpage><lpage>221</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2015.08.008</pub-id><pub-id pub-id-type="pmid">26278980</pub-id></element-citation></ref><ref id="bib36"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Sanchez</surname><given-names>RM</given-names></name><name><surname>Mester</surname><given-names>R</given-names></name><name><surname>Kudryashev</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Fast Alignment of Limited Angle Tomograms by projected Cross Correlation</article-title><conf-name>2019 27th European Signal Processing Conference (EUSIPCO</conf-name><conf-loc>A Coruna, Spain</conf-loc><pub-id pub-id-type="doi">10.23919/EUSIPCO.2019.8903041</pub-id></element-citation></ref><ref id="bib37"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Scheres</surname><given-names>SHW</given-names></name><name><surname>Gao</surname><given-names>H</given-names></name><name><surname>Valle</surname><given-names>M</given-names></name><name><surname>Herman</surname><given-names>GT</given-names></name><name><surname>Eggermont</surname><given-names>PPB</given-names></name><name><surname>Frank</surname><given-names>J</given-names></name><name><surname>Carazo</surname><given-names>J-M</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Disentangling conformational states of macromolecules in 3d-em through likelihood optimization</article-title><source>Nature Methods</source><volume>4</volume><fpage>27</fpage><lpage>29</lpage><pub-id pub-id-type="doi">10.1038/nmeth992</pub-id><pub-id pub-id-type="pmid">17179934</pub-id></element-citation></ref><ref id="bib38"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Scheres</surname><given-names>SHW</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>RELION: implementation of a bayesian approach to cryo-EM structure determination</article-title><source>Journal of Structural Biology</source><volume>180</volume><fpage>519</fpage><lpage>530</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2012.09.006</pub-id><pub-id pub-id-type="pmid">23000701</pub-id></element-citation></ref><ref id="bib39"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Scheres</surname><given-names>SH</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Beam-induced motion correction for sub-megadalton cryo-EM particles</article-title><source>eLife</source><volume>3</volume><elocation-id>e03665</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.03665</pub-id><pub-id pub-id-type="pmid">25122622</pub-id></element-citation></ref><ref id="bib40"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schmid</surname><given-names>MF</given-names></name><name><surname>Booth</surname><given-names>CR</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Methods for aligning and for averaging 3D volumes with missing data</article-title><source>Journal of Structural Biology</source><volume>161</volume><fpage>243</fpage><lpage>248</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2007.09.018</pub-id><pub-id pub-id-type="pmid">18299206</pub-id></element-citation></ref><ref id="bib41"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schur</surname><given-names>FK</given-names></name><name><surname>Obr</surname><given-names>M</given-names></name><name><surname>Hagen</surname><given-names>WJ</given-names></name><name><surname>Wan</surname><given-names>W</given-names></name><name><surname>Jakobi</surname><given-names>AJ</given-names></name><name><surname>Kirkpatrick</surname><given-names>JM</given-names></name><name><surname>Sachse</surname><given-names>C</given-names></name><name><surname>Kräusslich</surname><given-names>H-G</given-names></name><name><surname>Briggs</surname><given-names>JA</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>An atomic model of HIV-1 capsid-sp1 reveals structures regulating assembly and maturation</article-title><source>Science</source><volume>353</volume><fpage>506</fpage><lpage>508</lpage><pub-id pub-id-type="doi">10.1126/science.aaf9620</pub-id><pub-id pub-id-type="pmid">27417497</pub-id></element-citation></ref><ref id="bib42"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Smit</surname><given-names>J</given-names></name><name><surname>Engelhardt</surname><given-names>H</given-names></name><name><surname>Volker</surname><given-names>S</given-names></name><name><surname>Smith</surname><given-names>SH</given-names></name><name><surname>Baumeister</surname><given-names>W</given-names></name></person-group><year iso-8601-date="1992">1992</year><article-title>The S-layer of Caulobacter crescentus: three-dimensional image reconstruction and structure analysis by electron microscopy</article-title><source>Journal of Bacteriology</source><volume>174</volume><fpage>6527</fpage><lpage>6538</lpage><pub-id pub-id-type="doi">10.1128/jb.174.20.6527-6538.1992</pub-id><pub-id pub-id-type="pmid">1400205</pub-id></element-citation></ref><ref id="bib43"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tegunov</surname><given-names>D</given-names></name><name><surname>Cramer</surname><given-names>P</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Real-Time cryo-electron microscopy data preprocessing with warp</article-title><source>Nature Methods</source><volume>16</volume><fpage>1146</fpage><lpage>1152</lpage><pub-id pub-id-type="doi">10.1038/s41592-019-0580-y</pub-id><pub-id pub-id-type="pmid">31591575</pub-id></element-citation></ref><ref id="bib44"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tegunov</surname><given-names>D</given-names></name><name><surname>Xue</surname><given-names>L</given-names></name><name><surname>Dienemann</surname><given-names>C</given-names></name><name><surname>Cramer</surname><given-names>P</given-names></name><name><surname>Mahamid</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Multi-particle cryo-EM refinement with M visualizes ribosome-antibiotic complex at 3.5 Å in cells</article-title><source>Nature Methods</source><volume>18</volume><fpage>186</fpage><lpage>193</lpage><pub-id pub-id-type="doi">10.1038/s41592-020-01054-7</pub-id><pub-id pub-id-type="pmid">33542511</pub-id></element-citation></ref><ref id="bib45"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Turoňová</surname><given-names>B</given-names></name><name><surname>Schur</surname><given-names>FK</given-names></name><name><surname>Wan</surname><given-names>W</given-names></name><name><surname>Briggs</surname><given-names>JA</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Efficient 3d-ctf correction for cryo-electron tomography using novactf improves subtomogram averaging resolution to 3.4å</article-title><source>Journal of Structural Biology</source><volume>199</volume><fpage>187</fpage><lpage>195</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2017.07.007</pub-id><pub-id pub-id-type="pmid">28743638</pub-id></element-citation></ref><ref id="bib46"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>von Kügelgen</surname><given-names>A</given-names></name><name><surname>Tang</surname><given-names>H</given-names></name><name><surname>Hardy</surname><given-names>GG</given-names></name><name><surname>Kureisaite-Ciziene</surname><given-names>D</given-names></name><name><surname>Brun</surname><given-names>YV</given-names></name><name><surname>Stansfeld</surname><given-names>PJ</given-names></name><name><surname>Robinson</surname><given-names>CV</given-names></name><name><surname>Bharat</surname><given-names>TAM</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>In situ structure of an intact lipopolysaccharide-bound bacterial surface layer</article-title><source>Cell</source><volume>180</volume><fpage>348</fpage><lpage>358</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2019.12.006</pub-id><pub-id pub-id-type="pmid">31883796</pub-id></element-citation></ref><ref id="bib47"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wagner</surname><given-names>T</given-names></name><name><surname>Merino</surname><given-names>F</given-names></name><name><surname>Stabrin</surname><given-names>M</given-names></name><name><surname>Moriya</surname><given-names>T</given-names></name><name><surname>Antoni</surname><given-names>C</given-names></name><name><surname>Apelbaum</surname><given-names>A</given-names></name><name><surname>Hagel</surname><given-names>P</given-names></name><name><surname>Sitsel</surname><given-names>O</given-names></name><name><surname>Raisch</surname><given-names>T</given-names></name><name><surname>Prumbaum</surname><given-names>D</given-names></name><name><surname>Quentin</surname><given-names>D</given-names></name><name><surname>Roderer</surname><given-names>D</given-names></name><name><surname>Tacke</surname><given-names>S</given-names></name><name><surname>Siebolds</surname><given-names>B</given-names></name><name><surname>Schubert</surname><given-names>E</given-names></name><name><surname>Shaikh</surname><given-names>TR</given-names></name><name><surname>Lill</surname><given-names>P</given-names></name><name><surname>Gatsogiannis</surname><given-names>C</given-names></name><name><surname>Raunser</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>SPHIRE-cryolo is a fast and accurate fully automated particle picker for cryo-em</article-title><source>Communications Biology</source><volume>2</volume><elocation-id>218</elocation-id><pub-id pub-id-type="doi">10.1038/s42003-019-0437-z</pub-id><pub-id pub-id-type="pmid">31240256</pub-id></element-citation></ref><ref id="bib48"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wan</surname><given-names>W</given-names></name><name><surname>Kolesnikova</surname><given-names>L</given-names></name><name><surname>Clarke</surname><given-names>M</given-names></name><name><surname>Koehler</surname><given-names>A</given-names></name><name><surname>Noda</surname><given-names>T</given-names></name><name><surname>Becker</surname><given-names>S</given-names></name><name><surname>Briggs</surname><given-names>JAG</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Structure and assembly of the ebola virus nucleocapsid</article-title><source>Nature</source><volume>551</volume><fpage>394</fpage><lpage>397</lpage><pub-id pub-id-type="doi">10.1038/nature24490</pub-id><pub-id pub-id-type="pmid">29144446</pub-id></element-citation></ref><ref id="bib49"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Xiong</surname><given-names>Q</given-names></name><name><surname>Morphew</surname><given-names>MK</given-names></name><name><surname>Schwartz</surname><given-names>CL</given-names></name><name><surname>Hoenger</surname><given-names>AH</given-names></name><name><surname>Mastronarde</surname><given-names>DN</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Ctf determination and correction for low dose tomographic tilt series</article-title><source>Journal of Structural Biology</source><volume>168</volume><fpage>378</fpage><lpage>387</lpage><pub-id pub-id-type="doi">10.1016/j.jsb.2009.08.016</pub-id><pub-id pub-id-type="pmid">19732834</pub-id></element-citation></ref><ref id="bib50"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zheng</surname><given-names>SQ</given-names></name><name><surname>Palovcak</surname><given-names>E</given-names></name><name><surname>Armache</surname><given-names>J-P</given-names></name><name><surname>Verba</surname><given-names>KA</given-names></name><name><surname>Cheng</surname><given-names>Y</given-names></name><name><surname>Agard</surname><given-names>DA</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>MotionCor2: anisotropic correction of beam-induced motion for improved cryo-electron microscopy</article-title><source>Nature Methods</source><volume>14</volume><fpage>331</fpage><lpage>332</lpage><pub-id pub-id-type="doi">10.1038/nmeth.4193</pub-id><pub-id pub-id-type="pmid">28250466</pub-id></element-citation></ref><ref id="bib51"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zivanov</surname><given-names>J</given-names></name><name><surname>Nakane</surname><given-names>T</given-names></name><name><surname>Forsberg</surname><given-names>BO</given-names></name><name><surname>Kimanius</surname><given-names>D</given-names></name><name><surname>Hagen</surname><given-names>WJ</given-names></name><name><surname>Lindahl</surname><given-names>E</given-names></name><name><surname>Scheres</surname><given-names>SH</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>New tools for automated high-resolution cryo-em structure determination in relion-3</article-title><source>eLife</source><volume>7</volume><elocation-id>e42166</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.42166</pub-id><pub-id pub-id-type="pmid">30412051</pub-id></element-citation></ref><ref id="bib52"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zivanov</surname><given-names>J</given-names></name><name><surname>Nakane</surname><given-names>T</given-names></name><name><surname>Scheres</surname><given-names>SH</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>A Bayesian approach to beam-induced motion correction in cryo-EM single-particle analysis</article-title><source>IUCrJ</source><volume>6</volume><fpage>5</fpage><lpage>17</lpage><pub-id pub-id-type="doi">10.1107/S205225251801463X</pub-id><pub-id pub-id-type="pmid">30713699</pub-id></element-citation></ref><ref id="bib53"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zivanov</surname><given-names>J</given-names></name><name><surname>Nakane</surname><given-names>T</given-names></name><name><surname>Scheres</surname><given-names>SH</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Estimation of high-order aberrations and anisotropic magnification from cryo-EM data sets in relion-3.1</article-title><source>IUCrJ</source><volume>7</volume><fpage>253</fpage><lpage>267</lpage><pub-id pub-id-type="doi">10.1107/S2052252520000081</pub-id><pub-id pub-id-type="pmid">32148853</pub-id></element-citation></ref><ref id="bib54"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Zivanov</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2022">2022</year><data-title>Reliontomotools</data-title><version designator="swh:1:rev:bfa43828876ceb77bed0c7eb72f794c79c9de5e6">swh:1:rev:bfa43828876ceb77bed0c7eb72f794c79c9de5e6</version><source>Software Heritage</source><ext-link ext-link-type="uri" xlink:href="https://archive.softwareheritage.org/swh:1:dir:818da4e25a2d63c73d5d3e73507a7a4495836913;origin=https://github.com/joton/reliontomotools;visit=swh:1:snp:13317e0fc4360f2054e622a8f4c5d7ed8b26f948;anchor=swh:1:rev:bfa43828876ceb77bed0c7eb72f794c79c9de5e6">https://archive.softwareheritage.org/swh:1:dir:818da4e25a2d63c73d5d3e73507a7a4495836913;origin=https://github.com/joton/reliontomotools;visit=swh:1:snp:13317e0fc4360f2054e622a8f4c5d7ed8b26f948;anchor=swh:1:rev:bfa43828876ceb77bed0c7eb72f794c79c9de5e6</ext-link></element-citation></ref></ref-list><app-group><app id="appendix-1"><title>Appendix 1</title><sec sec-type="appendix" id="s8"><title>CTF refinement</title><p>CTF refinement in RELION-4.0 optimises the following parameters: scale, defocus, astigmatism, and higher-order (even and odd) optical aberrations. Since, save for the difference in defocus, the same CTF needs to be valid for an entire micrograph of particles, similar optimisations can be applied as in our single-particle algorithms. All the relevant information is first consolidated into a minimal form using linear transformations, and the final, typically non-linear, optimisation is then performed on that minimal form.</p><p>We formulate the CTF for tilt-series frame <inline-formula><mml:math id="inf52"><mml:mi>f</mml:mi></mml:math></inline-formula> of particle <inline-formula><mml:math id="inf53"><mml:mi>p</mml:mi></mml:math></inline-formula> as follows:<disp-formula id="equ14"><label>(14)</label><mml:math id="m14"><mml:mrow><mml:msub><mml:mtext>CTF</mml:mtext><mml:mrow><mml:mi>p</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>τ</mml:mi><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mi>sin</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>γ</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf54"><mml:msub><mml:mi>α</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:math></inline-formula> describes the overall scaling factor, <inline-formula><mml:math id="inf55"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>τ</mml:mi><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> the empirical radiation-damage model as defined by <xref ref-type="bibr" rid="bib19">Grant and Grigorieff, 2015</xref>, <inline-formula><mml:math id="inf56"><mml:msub><mml:mi>γ</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>f</mml:mi><mml:mo>⁢</mml:mo><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> the symmetrical phase delay component, and <inline-formula><mml:math id="inf57"><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>f</mml:mi><mml:mo>⁢</mml:mo><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> the antisymmetrical one. Note that only <inline-formula><mml:math id="inf58"><mml:mi>γ</mml:mi></mml:math></inline-formula> varies between particles. This is because it contains the quadratic defocus term that depends on the position of the particle. The phase delays are parametrised the same way as in single-particle analysis in RELION-3 – as a combination of explicitly named low-order terms and higher-order Zernike polynomials:<disp-formula id="equ15"><label>(15)</label><mml:math id="m15"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>γ</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>π</mml:mi><mml:mi>λ</mml:mi><mml:msup><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mrow><mml:mo>⊺</mml:mo></mml:mrow></mml:msup><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo>+</mml:mo><mml:mfrac><mml:mi>π</mml:mi><mml:mn>2</mml:mn></mml:mfrac><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mi>λ</mml:mi><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mn>4</mml:mn></mml:mrow></mml:msup><mml:mo>−</mml:mo><mml:msub><mml:mi>χ</mml:mi><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mo>∑</mml:mo><mml:msubsup><mml:mi>Z</mml:mi><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mstyle><mml:mspace linebreak="newline"/></mml:mrow></mml:math></disp-formula><disp-formula id="equ16"><label>(16)</label><mml:math id="m16"><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mtable rowspacing="4pt" columnspacing="1em"><mml:mtr><mml:mtd><mml:mi>δ</mml:mi><mml:msub><mml:mi>z</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mi>a</mml:mi><mml:mn>1</mml:mn></mml:mtd><mml:mtd><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mtd><mml:mtd><mml:mi>δ</mml:mi><mml:msub><mml:mi>z</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mi>a</mml:mi><mml:mn>2</mml:mn></mml:mtd></mml:mtr></mml:mtable><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>As before, the astigmatic-defocus matrix <inline-formula><mml:math id="inf59"><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is decomposed into a defocus term <inline-formula><mml:math id="inf60"><mml:mrow><mml:mi>δ</mml:mi><mml:mo>⁢</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and two linear astigmatism terms, <italic>a</italic><sub>1</sub> and <italic>a</italic><sub>2</sub>, while <inline-formula><mml:math id="inf61"><mml:msub><mml:mi>C</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:math></inline-formula> describes the spherical aberration of the microscope, <inline-formula><mml:math id="inf62"><mml:msub><mml:mi>χ</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:math></inline-formula> a constant phase offset (owing to amplitude contrast and a phase plate, if one is used), <inline-formula><mml:math id="inf63"><mml:mi>λ</mml:mi></mml:math></inline-formula> is the wavelength of the electron, and <inline-formula><mml:math id="inf64"><mml:msubsup><mml:mi>Z</mml:mi><mml:mi>n</mml:mi><mml:mi>m</mml:mi></mml:msubsup></mml:math></inline-formula> are the higher-order even Zernike terms. One key difference to single-particle analysis is that the defocus term <inline-formula><mml:math id="inf65"><mml:mrow><mml:mi>δ</mml:mi><mml:mo>⁢</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is no longer a free parameter for each particle, but it instead depends on the already known 3D position of the particle. Therefore, in tomography, the defocus term is only estimated once per tilt image, and all the particles contribute to that estimate.</p><p>The scaling factor <inline-formula><mml:math id="inf66"><mml:msub><mml:mi>α</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:math></inline-formula> is estimated by computing the following two sums for each micrograph and dividing them (the † symbol indicates complex conjugation):<disp-formula id="equ17"><label>(17)</label><mml:math id="m17"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>H</mml:mi><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:msub></mml:mfrac></mml:mstyle></mml:mrow></mml:math></disp-formula><disp-formula id="equ18"><label>(18)</label><mml:math id="m18"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:munder><mml:mfrac><mml:mn>1</mml:mn><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mfrac><mml:mtext>Re</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>f</mml:mi><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mtext>CTF</mml:mtext><mml:mrow><mml:mi>p</mml:mi><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">′</mml:mi></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mi>V</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>f</mml:mi><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo>†</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:mrow></mml:math></disp-formula><disp-formula id="equ19"><label>(19)</label><mml:math id="m19"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>H</mml:mi><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:munder><mml:mfrac><mml:mn>1</mml:mn><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mfrac><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msubsup><mml:mtext>CTF</mml:mtext><mml:mrow><mml:mi>p</mml:mi><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">′</mml:mi></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mi>V</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>f</mml:mi><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>.</mml:mo></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>Note that the <inline-formula><mml:math id="inf67"><mml:msup><mml:mtext>CTF</mml:mtext><mml:mo>′</mml:mo></mml:msup></mml:math></inline-formula> used in <xref ref-type="disp-formula" rid="equ19">Equation 19</xref> is missing its scale factor:<disp-formula id="equ20"><label>(20)</label><mml:math id="m20"><mml:mrow><mml:msubsup><mml:mtext>CTF</mml:mtext><mml:mrow><mml:mi>p</mml:mi><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">′</mml:mi></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mi>τ</mml:mi><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mi>sin</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>γ</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>Alternatively, we also allow the user to fit the parameters of Lambert’s extinction model to the data instead, assuming perfectly flat samples of constant thickness. In that case, the CTF scale in image <inline-formula><mml:math id="inf68"><mml:mi>f</mml:mi></mml:math></inline-formula> of tomogram <inline-formula><mml:math id="inf69"><mml:mi>t</mml:mi></mml:math></inline-formula> is expressed as a function of the beam luminance <inline-formula><mml:math id="inf70"><mml:msub><mml:mi>α</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:math></inline-formula>, sample normal <inline-formula><mml:math id="inf71"><mml:msub><mml:mi mathvariant="bold">n</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:math></inline-formula>, and optical sample thickness <inline-formula><mml:math id="inf72"><mml:msub><mml:mi>κ</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:math></inline-formula>:<disp-formula id="equ21"><label>(21)</label><mml:math id="m21"><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>κ</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">n</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:msubsup><mml:mi>κ</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">n</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>⋅</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">z</mml:mi></mml:mrow><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:msubsup></mml:mrow></mml:math></disp-formula></p><p>If this option is used, then the CTF scales of all the tilt series in the data set are estimated together. The beam luminance <inline-formula><mml:math id="inf73"><mml:msub><mml:mi>α</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:math></inline-formula> is modelled globally, while the sample thickness and normal are allowed to differ among tomograms, but not between the images of a tilt series. The vector <inline-formula><mml:math id="inf74"><mml:msub><mml:mi mathvariant="bold">z</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:math></inline-formula> points in viewing direction of tilt image <inline-formula><mml:math id="inf75"><mml:mi>f</mml:mi></mml:math></inline-formula>. Note that this model does not allow for separating the geometrical sample thickness from its extinction factor, so we can only estimate the product of the two. Also, the ice normal is required to be perpendicular to the estimated tilt axis of the tilt series since its component pointing in the direction of the axis is indistinguishable from an increase in ice thickness or opacity. This global optimisation is performed using the sums <inline-formula><mml:math id="inf76"><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf77"><mml:msub><mml:mi>H</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> computed in <xref ref-type="disp-formula" rid="equ18">Equations 18 and 19</xref>, where the subscript <inline-formula><mml:math id="inf78"><mml:mi>t</mml:mi></mml:math></inline-formula> indicates tilt-series <inline-formula><mml:math id="inf79"><mml:mi>t</mml:mi></mml:math></inline-formula>. This is done by finding a global value of <inline-formula><mml:math id="inf80"><mml:msub><mml:mi>α</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:math></inline-formula> and values of <inline-formula><mml:math id="inf81"><mml:msub><mml:mi>κ</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="inf82"><mml:mrow><mml:msub><mml:mi mathvariant="bold">n</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mi>S</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula> for all tomograms that produce <inline-formula><mml:math id="inf83"><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> which minimise the following quantity and thus maximise the overall likelihood in <xref ref-type="disp-formula" rid="equ4">Equation 4</xref>:<disp-formula id="equ22"><label>(22)</label><mml:math id="m22"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>t</mml:mi><mml:mo>,</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:munder><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>H</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>κ</mml:mi><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">n</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mi>G</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>.</mml:mo></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>To perform defocus estimation efficiently, we apply the optimisations we originally developed for the estimation of higher-order aberrations in single-particle analysis (<xref ref-type="bibr" rid="bib53">Zivanov et al., 2020</xref>). It allows us to determine a collective offset to <inline-formula><mml:math id="inf84"><mml:mi>γ</mml:mi></mml:math></inline-formula> for a large set of particles that all have different values of <inline-formula><mml:math id="inf85"><mml:mi>γ</mml:mi></mml:math></inline-formula>. Specifically, it allows the change to the log-likelihood arising from changing the value of <inline-formula><mml:math id="inf86"><mml:mi>γ</mml:mi></mml:math></inline-formula> at any Fourier pixel to be expressed as a pair of 2D images, independently of the number of particles. Therefore, each pixel of each particle only needs to be considered once. After that, the log-likelihood can be evaluated by iterating over the pixels of a single image.</p><p>In single-particle analysis, this approach is used to estimate the higher-order aberrations that are shared among all the particles in a data set. In tomography, we also use this approach to condense the information from all the particles in a tilt image (all of which exhibit slightly different defoci), into two such images, and to then determine the optimal change to <inline-formula><mml:math id="inf87"><mml:mi>γ</mml:mi></mml:math></inline-formula> efficiently using a nonlinear algorithm.</p><p>The two condensed images <inline-formula><mml:math id="inf88"><mml:mi>R</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf89"><mml:mover accent="true"><mml:mi mathvariant="bold">t</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula> that we compute are the same as the ones in single-particle analysis, except for the inclusion of the noise power <inline-formula><mml:math id="inf90"><mml:msup><mml:mi>σ</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:math></inline-formula>. The definitions are repeated here for the sake of completeness. Note that each pixel <inline-formula><mml:math id="inf91"><mml:mi mathvariant="bold">j</mml:mi></mml:math></inline-formula> of <inline-formula><mml:math id="inf92"><mml:mi>R</mml:mi></mml:math></inline-formula> contains a real symmetrical <inline-formula><mml:math id="inf93"><mml:mrow><mml:mn>2</mml:mn><mml:mo>×</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:math></inline-formula> matrix and each pixel of <inline-formula><mml:math id="inf94"><mml:mover accent="true"><mml:mi mathvariant="bold">t</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula> a <inline-formula><mml:math id="inf95"><mml:msup><mml:mi>ℂ</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:math></inline-formula> vector:<disp-formula id="equ23"><label>(23)</label><mml:math id="m23"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:munder><mml:mfrac><mml:mn>1</mml:mn><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mfrac><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msubsup><mml:mrow><mml:mover><mml:mi>V</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:msub><mml:mrow><mml:mi mathvariant="bold">d</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mi>f</mml:mi><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">d</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mi>f</mml:mi><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>⊺</mml:mo></mml:mrow></mml:msubsup></mml:mstyle></mml:mrow></mml:math></disp-formula><disp-formula id="equ24"><label>(24)</label><mml:math id="m24"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold">t</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:msubsup><mml:mi>R</mml:mi><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:munder><mml:mfrac><mml:mn>1</mml:mn><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mfrac><mml:mtext>Re</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>X</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>f</mml:mi><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>†</mml:mo></mml:mrow></mml:msubsup><mml:msubsup><mml:mrow><mml:mover><mml:mi>V</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">d</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mi>f</mml:mi><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf96"><mml:mrow><mml:msub><mml:mi mathvariant="bold">d</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>f</mml:mi><mml:mo>⁢</mml:mo><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula> describes the point on the unit circle corresponding to the initial phase angle <inline-formula><mml:math id="inf97"><mml:msup><mml:mi>γ</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula>, which is given by the initial CTF parameters:<disp-formula id="equ25"><label>(25)</label><mml:math id="m25"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">d</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi><mml:mi>f</mml:mi><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mtable rowspacing="4pt" columnspacing="1em"><mml:mtr><mml:mtd><mml:mi>cos</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>γ</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>sin</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>γ</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr></mml:mtable><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>The predicted 2D images <inline-formula><mml:math id="inf98"><mml:msubsup><mml:mover accent="true"><mml:mi>V</mml:mi><mml:mo>~</mml:mo></mml:mover><mml:mi>f</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula> contain the effect of the initial CTFs, except for the symmetrical aberration:<disp-formula id="equ26"><label>(26)</label><mml:math id="m26"><mml:mrow><mml:msubsup><mml:mrow><mml:mover><mml:mi>V</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>τ</mml:mi><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mi>V</mml:mi><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></disp-formula></p><p>The vector-valued condensed image <inline-formula><mml:math id="inf99"><mml:msub><mml:mover accent="true"><mml:mi mathvariant="bold">t</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>f</mml:mi></mml:msub></mml:math></inline-formula> describes the most likely phase shift <inline-formula><mml:math id="inf100"><mml:mi>γ</mml:mi></mml:math></inline-formula> for each pixel <inline-formula><mml:math id="inf101"><mml:mi mathvariant="bold">j</mml:mi></mml:math></inline-formula>, expressed as a point on a circle, while the matrix-valued one, <inline-formula><mml:math id="inf102"><mml:msub><mml:mi>R</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:math></inline-formula>, describes the anisotropic weight of that information. With these two condensed images computed for a given tilt image <inline-formula><mml:math id="inf103"><mml:mi>f</mml:mi></mml:math></inline-formula>, the change to the likelihood defined in <xref ref-type="disp-formula" rid="equ4">Equation 4</xref> resulting from the change to the phase delay <inline-formula><mml:math id="inf104"><mml:mi>γ</mml:mi></mml:math></inline-formula> at any pixel can be expressed as a quadratic form. Therefore, we look for a change <inline-formula><mml:math id="inf105"><mml:mrow><mml:mi>δ</mml:mi><mml:mo>⁢</mml:mo><mml:mi>D</mml:mi></mml:mrow></mml:math></inline-formula> to the astigmatic-defocus matrices <inline-formula><mml:math id="inf106"><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>⁢</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> which produces phase delays that minimise that quadratic form:<disp-formula id="equ27"><label>(27)</label><mml:math id="m27"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:munder><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">e</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>⊺</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>δ</mml:mi><mml:mi>D</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi mathvariant="bold">e</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>δ</mml:mi><mml:mi>D</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>where the per-pixel error <inline-formula><mml:math id="inf107"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">e</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>δ</mml:mi><mml:mi>D</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> is given by the deviation from the optimal phase shift <inline-formula><mml:math id="inf108"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold">t</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>:<disp-formula id="equ28"><label>(28)</label><mml:math id="m28"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">e</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>δ</mml:mi><mml:mi>D</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mtable rowspacing="4pt" columnspacing="1em"><mml:mtr><mml:mtd><mml:mi>cos</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>δ</mml:mi><mml:mi>γ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mtext>Re</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold">t</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>sin</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>δ</mml:mi><mml:mi>γ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mtext>Im</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mover><mml:mrow><mml:mi mathvariant="bold">t</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mtd></mml:mtr></mml:mtable><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula><disp-formula id="equ29"><label>(29)</label><mml:math id="m29"><mml:mrow><mml:mi>δ</mml:mi><mml:mi>γ</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow><mml:mrow><mml:mo>⊺</mml:mo></mml:mrow></mml:msup><mml:mi>δ</mml:mi><mml:mi>D</mml:mi><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>As an alternative to fitting <inline-formula><mml:math id="inf109"><mml:mi>D</mml:mi></mml:math></inline-formula> independently for each tilt-series image, our program also allows the user to apply an <inline-formula><mml:math id="inf110"><mml:msup><mml:mi>L</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:math></inline-formula> regulariser to the <inline-formula><mml:math id="inf111"><mml:mrow><mml:mi>δ</mml:mi><mml:mo>⁢</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> of the different images in the same series. In that case, the sum in <xref ref-type="disp-formula" rid="equ27">Equation 27</xref> runs over all the pixels <inline-formula><mml:math id="inf112"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:math></inline-formula> of all the tilt-series frames <inline-formula><mml:math id="inf113"><mml:mi>f</mml:mi></mml:math></inline-formula>. This helps to stabilise the CTFs of the higher tilts, but it risks impairing the estimates of the CTFs of the more important lower tilts. Formally, this is done by minimising the following cost:<disp-formula id="equ30"><label>(30)</label><mml:math id="m30"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mtext>glob</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>f</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:munder><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">e</mml:mi></mml:mrow><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow><mml:mrow><mml:mo>⊺</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi mathvariant="bold">e</mml:mi></mml:mrow><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mi>λ</mml:mi><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mrow><mml:mover><mml:mi>D</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>,</mml:mo></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>Since the early tilt-series images carry more information than the later ones, their values in <inline-formula><mml:math id="inf114"><mml:mi>R</mml:mi></mml:math></inline-formula> are typically significantly greater. Therefore, using this formulation, they automatically assume a greater weight in the estimation. The optimal weight for the regulariser itself, <inline-formula><mml:math id="inf115"><mml:mi>λ</mml:mi></mml:math></inline-formula>, cannot be measured from the data. Its optimal value depends on how reproducible the defocus values are for each of the tilt-series images, which in turn depends on the microscope setup, such as the stability of the stage.</p></sec><sec sec-type="appendix" id="s9"><title>Geometric refinement</title><p>Analogously to Bayesian polishing, the log-likelihood of a particle being observed at a position <inline-formula><mml:math id="inf116"><mml:mi mathvariant="bold">s</mml:mi></mml:math></inline-formula> is given by twice its cross-correlation with the predicted image:<disp-formula id="equ31"><label>(31)</label><mml:math id="m31"><mml:mrow><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>X</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="bold">s</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mtext>CC</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">s</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula><disp-formula id="equ32"><label>(32)</label><mml:math id="m32"><mml:mrow><mml:mi>C</mml:mi><mml:mi>C</mml:mi><mml:mo>=</mml:mo><mml:mi>I</mml:mi><mml:mi>F</mml:mi><mml:mi>T</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>ω</mml:mi><mml:mi>X</mml:mi><mml:msup><mml:mi>V</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>†</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula><disp-formula id="equ33"> <label>(33)</label><mml:math id="m33"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mrow><mml:mi mathvariant="bold">j</mml:mi></mml:mrow></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p>where IFT stands for inverse Fourier transform.</p><p>To keep the problem differentiable, the cross-correlation CC is always accessed using cubic interpolation. After the inverse Fourier transformation, each such cross-correlation table is cropped to a smaller size to make storing many such tables feasible, and the memory throughput efficient. The size of the tables can be controlled by the user, and should be set to the maximal positional error expected in the data set.</p><p>The geometrical model that is optimised this way projects points <inline-formula><mml:math id="inf117"><mml:mrow><mml:mi mathvariant="bold">s</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mn>3</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula> in the tomogram to 2D positions <inline-formula><mml:math id="inf118"><mml:mrow><mml:msub><mml:mi mathvariant="bold">p</mml:mi><mml:mi>f</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula> in each tilt image:<disp-formula id="equ34"> <label>(34)</label><mml:math id="m34"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="bold">p</mml:mi></mml:mrow><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>W</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mn mathvariant="bold">1</mml:mn></mml:mrow><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula><disp-formula id="equ35"><label>(35)</label><mml:math id="m35"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>f</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>J</mml:mi><mml:mi>f</mml:mi></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mtable rowspacing="4pt" columnspacing="1em"><mml:mtr><mml:mtd><mml:mi>S</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>1</mml:mn></mml:mtd></mml:mtr></mml:mtable><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>The initial linear projection <inline-formula><mml:math id="inf119"><mml:msub><mml:mi mathvariant="bold">l</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:math></inline-formula> is obtained by multiplying <inline-formula><mml:math id="inf120"><mml:mi mathvariant="bold">s</mml:mi></mml:math></inline-formula> with a <inline-formula><mml:math id="inf121"><mml:mrow><mml:mn>2</mml:mn><mml:mo>×</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:math></inline-formula> matrix <inline-formula><mml:math id="inf122"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula>, and then optionally shifted by the non-linear image distortion <inline-formula><mml:math id="inf123"><mml:mi>W</mml:mi></mml:math></inline-formula>. The cost <inline-formula><mml:math id="inf124"><mml:msub><mml:mi>C</mml:mi><mml:mtext>align</mml:mtext></mml:msub></mml:math></inline-formula> that is being minimised consists of the sum over all (negative) cross-correlation values of all particles in all images plus all regularisers for all regularised parameters:<disp-formula id="equ36"><label>(36)</label><mml:math id="m36"><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mtext>align</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:munder><mml:mo largeop="true" movablelimits="false" symmetric="true">∑</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mtext>CC</mml:mtext><mml:mo>⁢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold">p</mml:mi><mml:mi>f</mml:mi></mml:msub><mml:mo>-</mml:mo><mml:msubsup><mml:mi mathvariant="bold">p</mml:mi><mml:mi>f</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>+</mml:mo><mml:mi>ℜ</mml:mi></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>Although our framework supports arbitrary projection matrices <inline-formula><mml:math id="inf125"><mml:msub><mml:mi>J</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:math></inline-formula>, our optimisation algorithm only looks for orthogonal rotations to the initial projection matrix. This is achieved by parametrising that rotation using Tait–Bryan angles, not Euler angles. The disadvantage of Euler angles is that they are gimbal locked in the initial configuration where all three angles are zero, that is, the first and third angles refer to the same axis. The rigid alignment of the tilt image is never regularised because we do not assume to have any prior information on it.</p><p>The distortion field <inline-formula><mml:math id="inf126"><mml:mi>W</mml:mi></mml:math></inline-formula> can take different forms. We have implemented models that express the distortion using the Fourier basis, a cubic spline basis, and an affine linear one. The intended purpose of these deformations is to model distortions of the image that arise at the image forming lenses at the bottom of the optical system. An imperfect calibration of these lenses is likely to go unnoticed as long as the microscope is only used for single-particle analysis because the same particle is never observed at starkly different positions during the collection of a single-particle movie. In tomography, a given particle may appear at any image position in any tilt image, so arbitrary deformations to the 2D image become relevant. We expect these deformations to be stable over time, so the intended purpose of the deformation field <inline-formula><mml:math id="inf127"><mml:mi>W</mml:mi></mml:math></inline-formula> is to model only one such deformation per tilt series. Optionally, we also allow the user to instead model a different deformation for each tilt image, but we have not encountered any data sets where this has produced an improvement. The deformation fields are optionally regularised by penalising the squared coefficients of the respective model. This limits the extent of deformation, and it forces the system to explain changes in position through particle motion, rather than image deformations.</p><p>The quantity that we do expect to change during the collection of the tilt series is instead the 3D position of the particle, <inline-formula><mml:math id="inf128"><mml:msub><mml:mi mathvariant="bold">s</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:math></inline-formula>. Analogously to Bayesian polishing, we model this change as motion over time. The position in image <inline-formula><mml:math id="inf129"><mml:mi>f</mml:mi></mml:math></inline-formula> is given by the sum over its per-tilt-series-frame velocities <inline-formula><mml:math id="inf130"><mml:mrow><mml:msub><mml:mi mathvariant="bold">v</mml:mi><mml:mi>f</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mn>3</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula> up to that point. Note that the velocity vector <inline-formula><mml:math id="inf131"><mml:msub><mml:mi mathvariant="bold">v</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:math></inline-formula> refers to the motion between images <inline-formula><mml:math id="inf132"><mml:mi>f</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf133"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>f</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>:</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula><disp-formula id="equ37"><label>(37)</label><mml:math id="m37"><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mi>f</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:msup><mml:mi>f</mml:mi><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:msup><mml:mi>f</mml:mi><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup><mml:mo>&lt;</mml:mo><mml:mi>f</mml:mi></mml:mrow></mml:munderover><mml:mrow><mml:msub><mml:mi>v</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>It is important to note that the tilt images are implicitly assumed to be ordered chronologically. In practice, this is usually not given, so the images are reordered by the program based on the cumulative radiation dose of each image.</p><p>As in Bayesian polishing, the motion vectors themselves are expressed in a collective coordinate system for all the particles. This allows the spatial smoothness of a hypothetical motion field to be evaluated and used as a prior. For a more detailed derivation, we refer to the paper on Bayesian polishing for single-particle analysis (<xref ref-type="bibr" rid="bib52">Zivanov et al., 2019</xref>). The formal details will be given in the following for the sake of completeness and to highlight differences to the original formulation.</p><p>The collective coordinate system for particle motion is obtained through a low-rank approximation of a Gaussian process. This is done by constructing and then diagonalising the <inline-formula><mml:math id="inf134"><mml:mrow><mml:mi>P</mml:mi><mml:mo>×</mml:mo><mml:mi>P</mml:mi></mml:mrow></mml:math></inline-formula> covariance matrix <inline-formula><mml:math id="inf135"><mml:mi>S</mml:mi></mml:math></inline-formula> for a set of initial particle positions (where <inline-formula><mml:math id="inf136"><mml:mi>P</mml:mi></mml:math></inline-formula> is the number of particles). The entries of <inline-formula><mml:math id="inf137"><mml:mi>S</mml:mi></mml:math></inline-formula> contain the value of the following square-exponential covariance function for each pair of particles <inline-formula><mml:math id="inf138"><mml:mi>p</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf139"><mml:mi>q</mml:mi></mml:math></inline-formula>:<disp-formula id="equ38"><label>(38)</label><mml:math id="m38"><mml:mrow><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>q</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>V</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold">s</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mi mathvariant="bold">s</mml:mi><mml:mi>q</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>/</mml:mo><mml:msub><mml:mi>σ</mml:mi><mml:mi>D</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>Optionally, the user can instead also use the original formulation without the square inside the exponential:<disp-formula id="equ39"><label>(39)</label><mml:math id="m39"><mml:mrow><mml:mrow><mml:msubsup><mml:mi>S</mml:mi><mml:mrow><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>q</mml:mi></mml:mrow><mml:mo>′</mml:mo></mml:msubsup><mml:mo>=</mml:mo><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>V</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>⁢</mml:mo><mml:mrow><mml:mi>exp</mml:mi><mml:mo>⁡</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="bold">s</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mo>-</mml:mo><mml:msub><mml:mi mathvariant="bold">s</mml:mi><mml:mi>q</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mo>/</mml:mo><mml:msub><mml:mi>σ</mml:mi><mml:mi>D</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>The former option forces particles in immediate proximity to move more similarly, but it allows for a greater discrepancy at greater distances. Both the single-particle and the tomography implementations allow the user to choose either function, but the default has changed from the latter to the former in tomography. This choice was motivated by both empirical observations and the fact that the square-exponential kernel produces fewer meaningful deformation components, which speeds up the optimisation for tomograms with hundreds of particles.</p><p>We perform a singular-value decomposition of the covariance matrix <inline-formula><mml:math id="inf140"><mml:mi>S</mml:mi></mml:math></inline-formula>,<disp-formula id="equ40"><label>(40)</label><mml:math id="m40"><mml:mrow><mml:mrow><mml:mi>S</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mi>U</mml:mi><mml:mo>⁢</mml:mo><mml:mi mathvariant="normal">Λ</mml:mi><mml:mo>⁢</mml:mo><mml:msup><mml:mi>W</mml:mi><mml:mo>⊺</mml:mo></mml:msup></mml:mrow></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p>which allows us to construct the coordinate system as follows:<disp-formula id="equ41"><label>(41)</label><mml:math id="m41"><mml:mrow><mml:mrow><mml:msub><mml:mi mathvariant="bold">b</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:msqrt><mml:msub><mml:mi>λ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:msqrt><mml:mo>⁢</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf141"><mml:mrow><mml:msub><mml:mi>λ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:mi>ℝ</mml:mi></mml:mrow></mml:math></inline-formula> is the <inline-formula><mml:math id="inf142"><mml:msup><mml:mi>i</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>⁢</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup></mml:math></inline-formula> singular value and <inline-formula><mml:math id="inf143"><mml:mrow><mml:msub><mml:mi mathvariant="bold">a</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mi>P</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> the corresponding singular vector. Basis vectors with small <inline-formula><mml:math id="inf144"><mml:msub><mml:mi>λ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> are discarded here to speed up the optimisation. Let <inline-formula><mml:math id="inf145"><mml:msup><mml:mi>P</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:math></inline-formula> represent the number of remaining basis vectors. In this coordinate system, the set of all particle velocities in a tilt image <inline-formula><mml:math id="inf146"><mml:mrow><mml:msub><mml:mi>V</mml:mi><mml:mi>f</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mn>3</mml:mn></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mi>P</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> can be expressed as <inline-formula><mml:math id="inf147"><mml:mrow><mml:msub><mml:mi>V</mml:mi><mml:mi>f</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mi>B</mml:mi><mml:mo>⁢</mml:mo><mml:msub><mml:mi>Q</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="inf148"><mml:msub><mml:mi>Q</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:math></inline-formula> is a <inline-formula><mml:math id="inf149"><mml:mrow><mml:msup><mml:mi>P</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>×</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:math></inline-formula> coefficient matrix that encodes the velocity in three spatial dimensions. Note that the same basis <inline-formula><mml:math id="inf150"><mml:mi>B</mml:mi></mml:math></inline-formula> is shared between all three dimensions and all tilt-series frames. In this coordinate system, the negative log-likelihood of a configuration of particle velocities is given by the Frobenius norm of the coefficient vector, <inline-formula><mml:math id="inf151"><mml:mrow><mml:mo fence="true">||</mml:mo><mml:msub><mml:mi>Q</mml:mi><mml:mi>f</mml:mi></mml:msub><mml:mo fence="true">||</mml:mo></mml:mrow></mml:math></inline-formula>, that is, the sum of the squares of its entries. Therefore, the motion regulariser takes a simple form:<disp-formula id="equ42"><label>(42)</label><mml:math id="m42"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mrow><mml:mi mathvariant="fraktur">R</mml:mi></mml:mrow><mml:mrow><mml:mtext>motion</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>Q</mml:mi><mml:mrow><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p>The acceleration regulariser that would penalise changes in velocity from one tilt-series frame to the next in single-particle analysis has been omitted from tomography. This is because, unlike a single-particle movie, the tilt images are not collected in one continuous exposure. Since they are being exposed individually, there is no reason to assume that the particle velocities will be continuous between them. Two further differences to the original Bayesian polishing are hidden in the notation: the covariance is now based on the 3D distances between the particles, and the coefficient matrix <inline-formula><mml:math id="inf152"><mml:mi>Q</mml:mi></mml:math></inline-formula> contains three columns instead of two.</p><p>As in the original Bayesian polishing approach, the complete alignment of the tilt series is performed by finding parameters that minimise <inline-formula><mml:math id="inf153"><mml:msub><mml:mi>C</mml:mi><mml:mtext>align</mml:mtext></mml:msub></mml:math></inline-formula> from <xref ref-type="disp-formula" rid="equ36">Equation 36</xref> using L-BFGS (<xref ref-type="bibr" rid="bib28">Liu and Nocedal, 1989</xref>). The set of parameters that are being optimised always includes the three Tait–Bryan angles for each tilt image and the set of initial particle positions. The latter are essential because all the information we have about their 3D positions is derived from the tilt images themselves, so changing the alignment requires the particles to be able to shift to more likely positions. Estimating the image deformations and particle motion is optional. If they are being estimated, then a set of deformation coefficients is fitted either to each tilt image or to each tilt series, while a set of motion coefficients is fitted to each image transition.</p><p>In addition to this local, L-BFGS-based refinement, we also offer two methods to align only the 2D shifts of all tilt images globally. This means that instead of trying to obtain the optimal alignment through small changes to the initial one, we instead look for the best possible image shift overall, keeping all other parameters constant. This is helpful when individual tilt images are so badly aligned that a local optimisation cannot converge to the globally optimal position. Note that the initially assumed angles are rarely as incorrect as the image shifts since the angles can be controlled more effectively through the experimental setup.</p><p>There are two variants to this method. If the sample contains few particles per tomogram, then the best results are obtained by predicting an entire micrograph and computing its cross-correlation with the original one. The maximum value in that large cross-correlation image then indicates the optimal image shift. This approach can in theory deal with arbitrarily large misalignments. If the sample is dense, however, then this whole-micrograph approach can fail. In that case, better results are obtained by instead adding up the small, per-particle cross-correlation images defined in <xref ref-type="disp-formula" rid="equ31">Equation 31</xref>, and finding the maximum in that sum. This latter approach can only correct for misalignments smaller than half the box size of the particle, and it often produces inferior results on samples with few particles per tomogram.</p></sec></app><app id="appendix-2"><title>Appendix 2</title><table-wrap id="app2table1" position="float"><label>Appendix 2—table 1.</label><caption><title>Electron cryo-tomography (Cryo-ET) data collection, refinement, and validation statistics.</title></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" valign="bottom"/><th align="left" valign="bottom">HIV-1 Gag(EMD-16207 /EMD-16209)</th><th align="left" valign="bottom">S-layer_inner_domain(EMD-16183)(PDB 8BQE)</th><th align="left" valign="bottom">COPII inner coat(EMD-15949)(PDB 8BSH)</th></tr></thead><tbody><tr><td align="left" valign="bottom"><bold>Data collection</bold></td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Microscope</td><td align="left" valign="bottom">Titan Krios</td><td align="left" valign="bottom">Titan Krios</td><td align="left" valign="bottom">Titan Krios</td></tr><tr><td align="left" valign="bottom">Detector</td><td align="left" valign="bottom">K2 (Gatan)</td><td align="left" valign="bottom">K2 (Gatan)</td><td align="left" valign="bottom">K2 (Gatan)</td></tr><tr><td align="left" valign="bottom">Software</td><td align="left" valign="bottom">SerialEM (<xref ref-type="bibr" rid="bib29">Mastronarde, 2003</xref>)</td><td align="left" valign="bottom">SerialEM (<xref ref-type="bibr" rid="bib29">Mastronarde, 2003</xref>)</td><td align="left" valign="bottom">SerialEM <break/>(<xref ref-type="bibr" rid="bib29">Mastronarde, 2003</xref>)</td></tr><tr><td align="left" valign="bottom">Voltage (kV)</td><td align="left" valign="bottom">300</td><td align="left" valign="bottom">300</td><td align="left" valign="bottom">300</td></tr><tr><td align="left" valign="bottom">Slit width (eV)</td><td align="left" valign="bottom">20</td><td align="left" valign="bottom">20</td><td align="left" valign="bottom">20</td></tr><tr><td align="left" valign="bottom">Defocus range ( μm)</td><td align="left" valign="bottom">–1.5 to –5.0</td><td align="left" valign="bottom">–1.5 to –5.0</td><td align="left" valign="bottom">–1.5 to –4.5</td></tr><tr><td align="left" valign="bottom">Pixel size (Å)</td><td align="left" valign="bottom">1.35</td><td align="left" valign="bottom">1.35</td><td align="left" valign="bottom">1.33</td></tr><tr><td align="left" valign="bottom">Total exposure (<inline-formula><mml:math id="inf154"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo></mml:mrow></mml:msup><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:msup><mml:mtext>\AA</mml:mtext><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mstyle></mml:math></inline-formula>)</td><td align="left" valign="bottom">120–145</td><td align="left" valign="bottom">∼140</td><td align="left" valign="bottom">∼120</td></tr><tr><td align="left" valign="bottom">Exposure per tilt ( <inline-formula><mml:math id="inf155"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo></mml:mrow></mml:msup><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:msup><mml:mtext>\AA</mml:mtext><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mstyle></mml:math></inline-formula>)</td><td align="left" valign="bottom">3.0–3.5</td><td align="left" valign="bottom">3.4</td><td align="left" valign="bottom">2.9</td></tr><tr><td align="left" valign="bottom">Total number of tilts</td><td align="left" valign="bottom">41</td><td align="left" valign="bottom">41</td><td align="left" valign="bottom">41</td></tr><tr><td align="left" valign="bottom">Frames per tilt-movie</td><td align="left" valign="bottom">8–10</td><td align="left" valign="bottom">10</td><td align="left" valign="bottom">10</td></tr><tr><td align="left" valign="bottom">Tilt increment</td><td align="left" valign="bottom"><inline-formula><mml:math id="inf156"><mml:mrow><mml:mo>±</mml:mo><mml:msup><mml:mn>3</mml:mn><mml:mo>∘</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula></td><td align="left" valign="bottom"><inline-formula><mml:math id="inf157"><mml:mrow><mml:mo>±</mml:mo><mml:msup><mml:mn>3</mml:mn><mml:mo>∘</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula></td><td align="left" valign="bottom"><inline-formula><mml:math id="inf158"><mml:mrow><mml:mo>±</mml:mo><mml:msup><mml:mn>3</mml:mn><mml:mo>∘</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula></td></tr><tr><td align="left" valign="bottom">Tilt-series scheme</td><td align="left" valign="bottom">Dose-symmetrical</td><td align="left" valign="bottom">Dose-symmetrical</td><td align="left" valign="bottom">Dose-symmetrical</td></tr><tr><td align="left" valign="bottom">Tilt range</td><td align="left" valign="bottom"><inline-formula><mml:math id="inf159"><mml:mrow><mml:mo>±</mml:mo><mml:msup><mml:mn>60</mml:mn><mml:mo>∘</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula></td><td align="left" valign="bottom"><inline-formula><mml:math id="inf160"><mml:mrow><mml:mo>±</mml:mo><mml:msup><mml:mn>60</mml:mn><mml:mo>∘</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula></td><td align="left" valign="bottom"><inline-formula><mml:math id="inf161"><mml:mrow><mml:mo>±</mml:mo><mml:msup><mml:mn>60</mml:mn><mml:mo>∘</mml:mo></mml:msup></mml:mrow></mml:math></inline-formula></td></tr><tr><td align="left" valign="bottom">Tilt-series (no.)</td><td align="left" valign="bottom">5/43</td><td align="left" valign="bottom">110</td><td align="left" valign="bottom">137</td></tr><tr><td align="left" valign="bottom"><bold>Data processing</bold></td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Software tilt-series alignment</td><td align="left" valign="bottom">IMOD (<xref ref-type="bibr" rid="bib26">Kremer et al., 1996</xref>)</td><td align="left" valign="bottom">IMOD (<xref ref-type="bibr" rid="bib26">Kremer et al., 1996</xref>)</td><td align="left" valign="bottom">Dynamo (<xref ref-type="bibr" rid="bib7">Castaño-Díez et al., 2012</xref>)</td></tr><tr><td align="left" valign="bottom">Software CTF estimation</td><td align="left" valign="bottom">CTFPLOTTER (<xref ref-type="bibr" rid="bib49">Xiong et al., 2009</xref>)</td><td align="left" valign="bottom">CTFFIND4 (<xref ref-type="bibr" rid="bib35">Rohou and Grigorieff, 2015</xref>)</td><td align="left" valign="bottom">CTFFIND4 (<xref ref-type="bibr" rid="bib35">Rohou and Grigorieff, 2015</xref>)</td></tr><tr><td align="left" valign="bottom">Particle images (no.)</td><td align="left" valign="bottom">12,910/144,275</td><td align="left" valign="bottom">42,990</td><td align="left" valign="bottom">106,533</td></tr><tr><td align="left" valign="bottom">Pre-cropped box-size (pix)</td><td align="left" valign="bottom">512</td><td align="left" valign="bottom">600</td><td align="left" valign="bottom">512</td></tr><tr><td align="left" valign="bottom">Final box-size (pix)</td><td align="left" valign="bottom">192</td><td align="left" valign="bottom">180</td><td align="left" valign="bottom">196</td></tr><tr><td align="left" valign="bottom">Pixel size final rec. (Å)</td><td align="left" valign="bottom">1.35</td><td align="left" valign="bottom">1.35</td><td align="left" valign="bottom">1.33</td></tr><tr><td align="left" valign="bottom">Symmetry imposed</td><td align="left" valign="bottom">C6</td><td align="left" valign="bottom">C6</td><td align="left" valign="bottom">C1</td></tr><tr><td align="left" valign="bottom">Map resolution (Å)</td><td align="left" valign="bottom">3.2/3.0</td><td align="left" valign="bottom">3.5</td><td align="left" valign="bottom">3.8</td></tr><tr><td align="left" valign="bottom">FSC threshold</td><td align="left" valign="bottom">0.143</td><td align="left" valign="bottom">0.143</td><td align="left" valign="bottom">0.143</td></tr><tr><td align="left" valign="bottom">Map resolution range (Å)</td><td align="left" valign="bottom">3.2–4.3/3.0–3.5</td><td align="left" valign="bottom">3.5–4.8</td><td align="left" valign="bottom">3.8–7.2</td></tr><tr><td align="left" valign="bottom">Map sharpening B factor (Å <sup>2</sup>)</td><td align="left" valign="bottom">–85 / –95</td><td align="left" valign="bottom">–75</td><td align="left" valign="bottom">–106</td></tr><tr><td align="left" valign="bottom"><bold>Model refinement</bold></td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Initial model used (PDB code)</td><td align="left" valign="bottom"/><td align="left" valign="bottom">6T72</td><td align="left" valign="bottom">6GNI</td></tr><tr><td align="left" valign="bottom">Software</td><td align="left" valign="bottom"/><td align="left" valign="bottom">PHENIX (<xref ref-type="bibr" rid="bib1">Afonine et al., 2018</xref>)</td><td align="left" valign="bottom">Isolde (<xref ref-type="bibr" rid="bib11">Croll, 2018</xref>) and PHENIX (<xref ref-type="bibr" rid="bib1">Afonine et al., 2018</xref>)</td></tr><tr><td align="left" valign="bottom">Model resolution (Å)</td><td align="left" valign="bottom"/><td align="left" valign="bottom">3.6</td><td align="left" valign="bottom">4.0</td></tr><tr><td align="left" valign="bottom">FSC threshold</td><td align="left" valign="bottom"/><td align="left" valign="bottom">0.5</td><td align="left" valign="bottom">0.5</td></tr><tr><td align="left" valign="bottom"><bold>Model composition</bold></td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Non-hydrogen atoms (no.)</td><td align="left" valign="bottom"/><td align="left" valign="bottom">11,274</td><td align="left" valign="bottom">13,635</td></tr><tr><td align="left" valign="bottom">Protein residues (no.)</td><td align="left" valign="bottom"/><td align="left" valign="bottom">1452</td><td align="left" valign="bottom">1729</td></tr><tr><td align="left" valign="bottom"><bold>R.m.s. deviations</bold></td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Bond lengths (Å)</td><td align="left" valign="bottom"/><td align="left" valign="bottom">0.001</td><td align="left" valign="bottom">0.004</td></tr><tr><td align="left" valign="bottom">Bond angles (°)</td><td align="left" valign="bottom"/><td align="left" valign="bottom">0.322</td><td align="left" valign="bottom">0.858</td></tr><tr><td align="left" valign="bottom"><bold>Validation</bold></td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">MolProbity score</td><td align="left" valign="bottom"/><td align="left" valign="bottom">1.13</td><td align="left" valign="bottom">2.01</td></tr><tr><td align="left" valign="bottom">Clashscore</td><td align="left" valign="bottom"/><td align="left" valign="bottom">3.42</td><td align="left" valign="bottom">14.71</td></tr><tr><td align="left" valign="bottom">Poor rotamers (%)</td><td align="left" valign="bottom"/><td align="left" valign="bottom">0</td><td align="left" valign="bottom">0.66</td></tr><tr><td align="left" valign="bottom">C <inline-formula><mml:math id="inf162"><mml:mi>β</mml:mi></mml:math></inline-formula> outliers (%)</td><td align="left" valign="bottom"/><td align="left" valign="bottom">0</td><td align="left" valign="bottom">0.00</td></tr><tr><td align="left" valign="bottom">CABLAM outliers (%)</td><td align="left" valign="bottom"/><td align="left" valign="bottom">0.84</td><td align="left" valign="bottom">2.33</td></tr><tr><td align="left" valign="bottom"><bold>Ramachandran plot</bold></td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Favoured (%)</td><td align="left" valign="bottom"/><td align="left" valign="bottom">98.8</td><td align="left" valign="bottom">95.1</td></tr><tr><td align="left" valign="bottom">Allowed (%)</td><td align="left" valign="bottom"/><td align="left" valign="bottom">1.2</td><td align="left" valign="bottom">4.8</td></tr><tr><td align="left" valign="bottom">Disallowed (%)</td><td align="left" valign="bottom"/><td align="left" valign="bottom">0</td><td align="left" valign="bottom">0.1</td></tr></tbody></table></table-wrap><table-wrap id="app2table2" position="float"><label>Appendix 2—table 2.</label><caption><title>Computational costs and hardware specifics.</title></caption><table frame="hsides" rules="groups"><thead><tr><th align="left" valign="bottom"/><th align="left" valign="bottom">HIV-1 Gag</th><th align="left" valign="bottom">S-layer inner domain</th><th align="left" valign="bottom">COPII inner coat</th></tr></thead><tbody><tr><td align="left" valign="bottom">Tilt-series (no.)</td><td align="left" valign="bottom">5/43</td><td align="left" valign="bottom">110</td><td align="left" valign="bottom">137</td></tr><tr><td align="left" valign="bottom">Final particle images (no.)</td><td align="left" valign="bottom">12,910/144,275</td><td align="left" valign="bottom">42,990</td><td align="left" valign="bottom">106,533</td></tr><tr><td align="left" valign="bottom">Pre-cropped box-size (pix)</td><td align="left" valign="bottom">512</td><td align="left" valign="bottom">600</td><td align="left" valign="bottom">512</td></tr><tr><td align="left" valign="bottom">Final box-size (pix)</td><td align="left" valign="bottom">192</td><td align="left" valign="bottom">180</td><td align="left" valign="bottom">196</td></tr><tr><td align="left" valign="bottom"><bold>Computational costs</bold></td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Pseudo-subtomogram</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Compute time</td><td align="left" valign="bottom">21 min/40 min</td><td align="left" valign="bottom">34 min</td><td align="left" valign="bottom">67 min</td></tr><tr><td align="left" valign="bottom">Number of CPU nodes</td><td align="left" valign="bottom">1/1</td><td align="left" valign="bottom">1</td><td align="left" valign="bottom">1</td></tr><tr><td align="left" valign="bottom">Disk space</td><td align="left" valign="bottom">343 GB/3.8 TB</td><td align="left" valign="bottom">777 GB</td><td align="left" valign="bottom">3.1 TB</td></tr><tr><td align="left" valign="bottom">Refine3D</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Compute time</td><td align="left" valign="bottom">18 hr<xref ref-type="table-fn" rid="app2table2fn1">*</xref>/33 hr</td><td align="left" valign="bottom">14 hr</td><td align="left" valign="bottom">57 hr</td></tr><tr><td align="left" valign="bottom">Number of GPU nodes</td><td align="left" valign="bottom">1/1</td><td align="left" valign="bottom">1</td><td align="left" valign="bottom">1</td></tr><tr><td align="left" valign="bottom">Ctf refinement</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Compute time</td><td align="left" valign="bottom">15 min<xref ref-type="table-fn" rid="app2table2fn1">*</xref>/35 min</td><td align="left" valign="bottom">2 hr</td><td align="left" valign="bottom">2 hr</td></tr><tr><td align="left" valign="bottom">Number of CPU nodes</td><td align="left" valign="bottom">1/1</td><td align="left" valign="bottom">1</td><td align="left" valign="bottom">1</td></tr><tr><td align="left" valign="bottom">Disk space</td><td align="left" valign="bottom">32 MB/247 MB</td><td align="left" valign="bottom">621 MB</td><td align="left" valign="bottom">673 MB</td></tr><tr><td align="left" valign="bottom">Frame alignment</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">Compute time</td><td align="left" valign="bottom">2 hr<xref ref-type="table-fn" rid="app2table2fn1">*</xref>/12 hr</td><td align="left" valign="bottom">2 hr</td><td align="left" valign="bottom">6 hr</td></tr><tr><td align="left" valign="bottom">Number of CPU nodes</td><td align="left" valign="bottom">1/1</td><td align="left" valign="bottom">1</td><td align="left" valign="bottom">1</td></tr><tr><td align="left" valign="bottom">Disk space</td><td align="left" valign="bottom">383 MB/4.1 GB</td><td align="left" valign="bottom">1.9 GB</td><td align="left" valign="bottom">2.2 GB</td></tr><tr><td align="left" valign="bottom"><bold>Hardware specifics</bold></td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">CPU nodes</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">CPU model</td><td align="left" valign="bottom">2x Intel Xeon E5-2698 v4</td><td align="left" valign="bottom">2x Intel Xeon 6258R</td><td align="left" valign="bottom">1x AMD EPYC 7H12</td></tr><tr><td align="left" valign="bottom">CPU memory</td><td align="left" valign="bottom">512 GB</td><td align="left" valign="bottom">754 GB</td><td align="left" valign="bottom">256 GB</td></tr><tr><td align="left" valign="bottom">GPU nodes</td><td align="left" valign="bottom"/><td align="left" valign="bottom"/><td align="left" valign="bottom"/></tr><tr><td align="left" valign="bottom">CPU model</td><td align="left" valign="bottom">2x Intel Xeon Silver 4116</td><td align="left" valign="bottom">2x Intel Xeon E5-2667 v4</td><td align="left" valign="bottom">1x AMD EPYC 7H12</td></tr><tr><td align="left" valign="bottom">CPU memory</td><td align="left" valign="bottom">384 GB</td><td align="left" valign="bottom">256 GB</td><td align="left" valign="bottom">256 GB</td></tr><tr><td align="left" valign="bottom">GPU model</td><td align="left" valign="bottom">2x Nvidia Quadro RTX 5000</td><td align="left" valign="bottom">4x Nvidia GeForce GTX 1080 Ti</td><td align="left" valign="bottom">4x Nvidia RTX A6000</td></tr></tbody></table><table-wrap-foot><fn id="app2table2fn1"><label>*</label><p>These calculations were performed using the same hardware as for the S-layer inner domain.</p></fn></table-wrap-foot></table-wrap></app></app-group></back><sub-article article-type="editor-report" id="sa0"><front-stub><article-id pub-id-type="doi">10.7554/eLife.83724.sa0</article-id><title-group><article-title>Editor's evaluation</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Egelman</surname><given-names>Edward H</given-names></name><role specific-use="editor">Reviewing Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/0153tk833</institution-id><institution>University of Virginia</institution></institution-wrap><country>United States</country></aff></contrib></contrib-group><related-object id="sa0ro1" object-id-type="id" object-id="10.1101/2022.02.28.482229" link-type="continued-by" xlink:href="https://sciety.org/articles/activity/10.1101/2022.02.28.482229"/></front-stub><body><p>Single-particle tomography (SPT) is a useful method to determine the structure of proteins imaged in situ. This important work presents an easy-to-use tool for SPT that approximates the use of 2D tomographic projections using a ‘pseudo-subtomogram’ data structure, chosen to facilitate implementation within the existing RELION codebase. The examples shown provide solid support for the claims about the efficacy of the approach.</p></body></sub-article><sub-article article-type="decision-letter" id="sa1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.83724.sa1</article-id><title-group><article-title>Decision letter</article-title></title-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Egelman</surname><given-names>Edward H</given-names></name><role>Reviewing Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/0153tk833</institution-id><institution>University of Virginia</institution></institution-wrap><country>United States</country></aff></contrib></contrib-group><contrib-group><contrib contrib-type="reviewer"><name><surname>Bartesaghi</surname><given-names>Alberto</given-names></name><role>Reviewer</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/00py81415</institution-id><institution>Duke University</institution></institution-wrap><country>United States</country></aff></contrib></contrib-group></front-stub><body><boxed-text id="sa2-box1"><p>Our editorial process produces two outputs: (i) <ext-link ext-link-type="uri" xlink:href="https://sciety.org/articles/activity/10.1101/2022.02.28.482229">public reviews</ext-link> designed to be posted alongside <ext-link ext-link-type="uri" xlink:href="https://www.biorxiv.org/content/10.1101/2022.02.28.482229v2">the preprint</ext-link> for the benefit of readers; (ii) feedback on the manuscript for the authors, including requests for revisions, shown below. We also include an acceptance summary that explains what the editors found interesting or important about the work.</p></boxed-text><p><bold>Decision letter after peer review:</bold></p><p>Thank you for submitting your article &quot;A Bayesian approach to single-particle electron cryo-tomography in RELION-4.0&quot; for consideration by <italic>eLife</italic>. Your article has been reviewed by 3 peer reviewers, one of whom is a member of Our Board of Reviewing Editors, and the evaluation has been overseen by Volker Dötsch as the Senior Editor. The following individual involved in the review of your submission has agreed to reveal their identity: Alberto Bartesaghi (Reviewer #1).</p><p>The reviewers have discussed their reviews with one another, and the Reviewing Editor has drafted this to help you prepare a revised submission.</p><p>Essential revisions:</p><p>(1) Half the citations in the manuscript are self-references (16 out of 32!), and important/relevant work on SPT was left out and should be referenced: Himes et al., 2018 (https://doi.org/10.1038/s41592-018-0167-z), Chen et al., 2019 (https://doi.org/10.1038/s41592-019-0591-8), and Sanchez et al., 2019 (https://doi.org/10.23919/EUSIPCO.2019.8903041). Also, with the exception of their own sub-volume averaging approach [4], the vast body of work on missing-wedge compensation was not referenced in the introduction.</p><p>(2) In the section on &quot;Orientation priors&quot;, they state that one advantage of the proposed approach is that &quot;the coordinate system of the pseudo subtomograms themselves can be chosen arbitrarily&quot; and that &quot;this not only accelerates the refinement&quot; but also &quot;makes it possible to solve more challenging structures because fewer solutions are allowed&quot;. This advantage, however, is certainly not specific to the &quot;pseudo-subtomogram&quot; data representation proposed here. Indeed, this strategy was originally proposed in the context of single-particle cryo-EM by Jinag et al., 2001 (https://doi.org/10.1006/jsbi.2001.4376) and was first used for processing cryo-ET data by Forster et al., 2005 (https://doi.org/10.1073/pnas.040917810), followed by many others. This point should be contextualized and the appropriate references included.</p><p>(3) Results on the HIV-1 Gag benchmark dataset (EMPIAR-10164) have two components: (1) processing of a &quot;standard&quot; subset consisting of 5 tilt-series, and (2) processing of the entire dataset (43 tilt-series). As far as I know, the best reconstruction obtained using the five tilt-series is a 3.3 A map obtained using emClarity (https://www.ebi.ac.uk/emdb/EMD-13354). Since only lower resolution results obtained with NovaCTF (3.9A) and Warp (3.8A) are cited in the text, my guess is that the authors were not aware of this newer result. Given that the resolution of the emClarity map (3.3A) is similar to the one presented here (3.2A), it would be useful to compare their reconstruction against emClarity's EMD-13354 (both in terms of map features and FSC).</p><p>(4) When processing the entire dataset, a 3.0A resolution map was obtained which matches the resolution obtained by Warp/M [24]. This result, however, is &quot;not shown&quot; (page 5). Since this is the only benchmark dataset analyzed in this study and given that many other packages have analyzed the same data, this map should be presented together with the corresponding FSC curve, data processing details, and comparisons made against M's 3.0A EMD-11655 map.</p><p>(5) No experiments are presented to validate the ability of the approach to correct for higher-order aberrations. Since &quot;higher-order aberration correction will probably be most useful for reconstructions that extend beyond 3A resolution&quot;, why didn't they validate their approach using one of the sub-3A cryo-ET datasets available on EMPIAR (e.g., EMPIAR-10491)?</p><p>(6) It would be useful to include a table with a summary of all the relevant data collection/data processing parameters (e.g., pixel size, detector, number of tilt-series and sub-volumes, symmetry, resolution, number of refinement rounds, etc.) for all datasets analyzed in this study.</p><p>(7) Ony the 3.8A map for the COPII inner coat has been deposited in the EMDB. All other maps and related metadata need to be deposited as well.</p><p>(8) Computational complexity is a very important topic in the context of SPT, but no details are included in the text other than the following statement: &quot;Compared to M, RELION-4.0 uses computationally more efficient algorithms that do not require the computational power of a GPU&quot;. Does this imply that computationally inefficient algorithms require the use of GPUs? If the authors want to comment on computational complexity (which I think would be very important to do), actual numbers need to be presented, such as running times, compute resources used, storage, etc.</p><p>9) Regarding the use of a &quot;true 2D approach&quot; vs. &quot;pseudo-volumes&quot; (page 6), the following claim is made: &quot;For example, the current implementation could be used to process pairs of tilted images, but a 2D implementation would be more efficient&quot;, does this refer to efficiency in computing terms, storage, or both? Also, the authors should comment on the storage requirements of their 3D approach. Since the pseudo-tomograms have three components (Eqs. 8-10), does this mean that they require 3x more storage compared to traditional subtomogram averaging? This would be an important practical consideration for prospective users of this tool and should be adequately discussed.</p><p>10) In general, the use of the term &quot;particle polishing&quot; could lead to misinterpretations since it means different things in SPA and tomography. In SPA, &quot;polishing&quot; refers to the analysis of intermediate vidoe frames (which also exist in tomography), but the present study doesn't consider them at all. Also, I noticed that the term &quot;frames&quot; is used interchangeably to refer to SPA &quot;vidoe frames&quot; and &quot;particle tilts&quot; in tomography, which adds to the confusion. For example, the term &quot;frame alignment&quot; is mentioned twice on page 6, but I believe the authors are really referring to &quot;tilt image alignment&quot; instead. This should be clarified and the terms &quot;frame&quot; and &quot;tilts&quot; should be used consistently throughout the manuscript.</p><p>(11) For the <italic>Caulobacter crescentus</italic> S-layer reconstruction, the new cryo-ET map corresponding to the inner domain of the S-layer seems to have even better resolution than the SPA reconstruction reported in the original work [26] (3.5A vs. 3.7A for EMD-10389). Since the authors say these maps are in &quot;excellent agreement&quot;, a quantitative comparison should be included. Was the second LPS binding site visible in the 3.7A SPA map? In Figure 2d, the fit between LPS and the cryo-ET density (right-hand side) seems to be of lower quality (i.e., no density for parts of the LPS model is seen). Without having access to the maps, it is not possible to properly evaluate these results.</p><p>(12) The paper is well-written and clear, but the description of the new concepts and evaluation of the method is somewhat minimalistic. While these may not be absolutely necessary, they will facilitate better understanding by a broader user community.</p><p>(i) A graph describing the workflow as implemented in RELION, e.g., as a flow chart, would increase the readability of the paper.</p><p>(ii) A figure visually describing the pseudosubtomograms would make the concept clearer to the reader.</p><p>(iii) A more in-depth description of the input files (alignment files from imod, particle lists, and orientation from Dynamo/elsewhere) needed to perform alignments and averaging in RELION using pseudosubtomograms would be beneficial to the community. This could be incorporated into a flowchart as suggested in (i).</p><p>13) Along the same lines, the authors do not include any description of the particle-picking procedures or the software requirements. This seems to be important as the authors state &quot;(particles) relative defoci are known from the geometry of the tilt series and the known 3D positions of the particles in the tomogram&quot;.</p><p>14) In section 2.2 it is shortly discussed that rotational priors can be used to constrain orientational searches. As this is often very useful for particle alignment in cryo-ET, this and the implementation should be described in more detail.</p><p>15) The progress in map quality is only shown by improvements to resolution in the FSC for the test datasets. It would be beneficial to also show the initial and intermediary maps for at least one of the test cases so that the reader can better assess the improvement in map quality. Overall maps should be shown to evaluate performance on the &quot;whole particle&quot; level, given considerations of flexibility (especially in cases where focused refinement was used). Corresponding local resolution maps would be informative in such cases.</p><p>(16) For the immature HIV capsid data, the FSC curves are only shown for the small subset of data. As it is an important point that the RELION pseudosubtomogram approach can reach the same resolution as previous software such as M, the data should also be shown for the full dataset (authors write &quot;data not shown&quot;).</p><p>(17) In general, a proper comparison to the previous approaches/results, maybe by providing the maps for comparison in the figures, would be helpful for the reader to evaluate which approach to choose, and based on what expectations/biological system.</p><p>18) In section 4 it is briefly discussed that particle rotation is not modeled in the per-particle motion correction. They draw parallels to single particles and conclude that this might be an issue at resolutions better than 2 Å. However, could the authors comment on whether the difference in dose and time frame of data collection as well as the thickness of sample, may affect the assumption that this is only an issue at a higher resolution?</p><p>(19) Many subtomogram averages are resolved at a more moderate resolution (e.g. 8-20 Å) than the maps presented in this study due to different reasons. It would be beneficial for the reader if the authors could comment on/discuss which optical and geometrical parameters can be confidently modeled at a lower resolution and if they improve resolution.</p><p>(20) Could the authors comment on whether it is possible to extract the refined optical and geometrical parameters for a set of particles from a tilt series, and apply them to a different set of particles from the same tilt series (or to the full tilt series to obtain a better quality tomogram for new particle picking).</p><p>(21) Along the same line: would it be possible to refine two distinct species (e.g. two distinct conformations of the same protein or two completely unrelated proteins) together in a multi-species refinement of optical and geometrical parameters? As the overall tilt series alignment and imaging parameters are the same, this might aid in refinement for lower abundance.</p><p>(22) On a more conceptual level, the reasoning to separate the SPA/Cryo-ET workflows completely in the software package remains unclear to me and it would be valuable if the authors could briefly discuss this.</p><p>(23) Can the authors comment on the &quot;The data model assumes independent Gaussian noise on the Fourier components of the cryo-EM images of individual particles&quot; with respect to the more complex in situ data, where noise is expected to be more structured?</p></body></sub-article><sub-article article-type="reply" id="sa2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.83724.sa2</article-id><title-group><article-title>Author response</article-title></title-group></front-stub><body><disp-quote content-type="editor-comment"><p>Essential revisions:</p><p>(1) Half the citations in the manuscript are self-references (16 out of 32!), and important/relevant work on SPT was left out and should be referenced: Himes et al., 2018 (https://doi.org/10.1038/s41592-018-0167-z), Chen et al., 2019 (https://doi.org/10.1038/s41592-019-0591-8), and Sanchez et al., 2019 (https://doi.org/10.23919/EUSIPCO.2019.8903041). Also, with the exception of their own sub-volume averaging approach [4], the vast body of work on missing-wedge compensation was not referenced in the introduction.</p></disp-quote><p>We have included the references above, and multiple references to alternative approaches for subtomogram averaging and approaches for missing-wedge correction. The revised manuscript now contains 53 references.</p><disp-quote content-type="editor-comment"><p>(2) In the section on &quot;Orientation priors&quot;, they state that one advantage of the proposed approach is that &quot;the coordinate system of the pseudo subtomograms themselves can be chosen arbitrarily&quot; and that &quot;this not only accelerates the refinement&quot; but also &quot;makes it possible to solve more challenging structures because fewer solutions are allowed&quot;. This advantage, however, is certainly not specific to the &quot;pseudo-subtomogram&quot; data representation proposed here. Indeed, this strategy was originally proposed in the context of single-particle cryo-EM by Jinag et al., 2001 (https://doi.org/10.1006/jsbi.2001.4376) and was first used for processing cryo-ET data by Forster et al., 2005 (https://doi.org/10.1073/pnas.040917810), followed by many others. This point should be contextualized and the appropriate references included.</p></disp-quote><p>This is a misunderstanding. We are not claiming that performing local orientational searches is new in our approach. Only the option to arbitrarily pre-orient the pseudo-subtomograms is new. This makes expressing local angular searches in terms of the Euler angles more straightforward. We have completely rewritten this section to reflect this more clearly; it now reads:</p><p>“Pre-oriented priors</p><p>Many proteins are organised in imperfect 2D arrays inside the tomograms, for example inside membranes or as part of capsid-like structures. Often, the individual protein molecules inside these arrays exhibit limited rotational freedom with respect to the surface normal of the array, although they may be able to rotate freely around that normal. This knowledge is often exploited in subtomogram averaging approaches through local orientational searches, e.g. see Forster2005retro. This not only accelerates the refinement, as fewer orientations need to be evaluated, it also makes it possible to solve more challenging structures because fewer solutions are allowed. In RELION, local orientational searches are implemented as Gaussian priors on the Cartesian translations and on the three Euler angles that describe rotations Scheres2012relion. One advantage of using pseudo subtomogram alignment is that the coordinate system of the pseudo subtomograms themselves can be chosen arbitrarily. By default, pseudo subtomograms are created in the same orientation as the tomogram, but the user can choose to orient them in a more meaningful way. For example, by constructing the pseudo subtomograms with their Z-axis parallel to the 2D array, using a rotational prior of approximately 90<sup>o</sup> on the tilt angle will limit the amount of rocking of the particles inside the array, while avoiding singularities in the definition of the Euler angles that occur when the tilt angle is close to 0<sup>o</sup>.”</p><disp-quote content-type="editor-comment"><p>(3) Results on the HIV-1 Gag benchmark dataset (EMPIAR-10164) have two components:</p><p>(1) processing of a &quot;standard&quot; subset consisting of 5 tilt-series, and (2) processing of the entire dataset (43 tilt-series). As far as I know, the best reconstruction obtained using the five tilt-series is a 3.3 A map obtained using emClarity (https://www.ebi.ac.uk/emdb/EMD-13354). Since only lower resolution results obtained with NovaCTF (3.9A) and Warp (3.8A) are cited in the text, my guess is that the authors were not aware of this newer result. Given that the resolution of the emClarity map (3.3A) is similar to the one presented here (3.2A), it would be useful to compare their reconstruction against emClarity's EMD-13354 (both in terms of map features and FSC).</p></disp-quote><p>We have included a reference to the new emClarity map in the Results section on the 5tomogram HIV data set. A comparison between our map and the emClarity map is now shown in Figure 1 —figure supplement 2. The RELION map is better than the emClarity map, which used a different, more optimistic mask for its original resolution estimation.</p><disp-quote content-type="editor-comment"><p>(4) When processing the entire dataset, a 3.0A resolution map was obtained which matches the resolution obtained by Warp/M [24]. This result, however, is &quot;not shown&quot; (page 5). Since this is the only benchmark dataset analyzed in this study and given that many other packages have analyzed the same data, this map should be presented together with the corresponding FSC curve, data processing details, and comparisons made against M's 3.0A EMD-11655 map.</p></disp-quote><p>We now show these results and a comparison with the map from M in Figure 1 —figure supplement 3. The two maps are very similar.</p><disp-quote content-type="editor-comment"><p>(5) No experiments are presented to validate the ability of the approach to correct for higher-order aberrations. Since &quot;higher-order aberration correction will probably be most useful for reconstructions that extend beyond 3A resolution&quot;, why didn't they validate their approach using one of the sub-3A cryo-ET datasets available on EMPIAR (e.g., EMPIAR-10491)?</p></disp-quote><p>Higher-order aberration correction has now been used on a sub-2A resolution apo-ferritin test data set from a different collaborator. “Unfortunately”, their scope was so well-aligned that not even at this resolution aberration correction led to an improvement. Therefore, and because these collaborators are planning on writing their own publication about these results, we decided not to include these data in our revision.</p><p>We merely describe aberration correction for completeness and to make our potential readers aware of the available tools, as we do not intend to write a separate paper on this functionality. We also note that the application of fast, multi-shot data acquisition techniques for tomography that use beam shifts (like FISE and BISECT) may lead to wider applicability in the future, or least for those who do not align their microscope optimally…</p><disp-quote content-type="editor-comment"><p>(6) It would be useful to include a table with a summary of all the relevant data collection/data processing parameters (e.g., pixel size, detector, number of tilt-series and sub-volumes, symmetry, resolution, number of refinement rounds, etc.) for all datasets analyzed in this study.</p></disp-quote><p>We now include data acquisition details for each data set in Table 1.</p><disp-quote content-type="editor-comment"><p>(7) Only the 3.8A map for the COPII inner coat has been deposited in the EMDB. All other maps and related metadata need to be deposited as well.</p></disp-quote><p>The 5-tomo (EMD-16207) and 43-tomo (EMD-16209) maps of the HIV capsid lattice and the map and model for the <italic>Caulobacter crescentus</italic> S-layer (EMD-16183, PDB 8bqe) have now been submitted. We have also submitted the model for the new COP-II map (PDB-8bsh).</p><disp-quote content-type="editor-comment"><p>(8) Computational complexity is a very important topic in the context of SPT, but no details are included in the text other than the following statement: &quot;Compared to M, RELION-4.0 uses computationally more efficient algorithms that do not require the computational power of a GPU&quot;. Does this imply that computationally inefficient algorithms require the use of GPUs? If the authors want to comment on computational complexity (which I think would be very important to do), actual numbers need to be presented, such as running times, compute resources used, storage, etc.</p></disp-quote><p>We did not imply this. We have rephrased the statement about GPU to:</p><p>“Compared to M, RELION-4.0 uses computationally more efficient algorithms; M uses GPUs to accelerate the calculations.”</p><p>To give better insights into the computational costs, we now include details of image processing requirements for all three data sets in Table 2.</p><disp-quote content-type="editor-comment"><p>(9) Regarding the use of a &quot;true 2D approach&quot; vs. &quot;pseudo-volumes&quot; (page 6), the following claim is made: &quot;For example, the current implementation could be used to process pairs of tilted images, but a 2D implementation would be more efficient&quot;, does this refer to efficiency in computing terms, storage, or both? Also, the authors should comment on the storage requirements of their 3D approach. Since the pseudo-tomograms have three components (Eqs. 8-10), does this mean that they require 3x more storage compared to traditional subtomogram averaging? This would be an important practical consideration for prospective users of this tool and should be adequately discussed.</p></disp-quote><p>Yes, this is a good point, it would affect storage too, as the CTF<sup>2</sup> and multiplicity volumes take up space as well. To explain this better, the revised text now reads:</p><p>“The use of 3D pseudo-subtomograms allowed re-using existing code for subtomogram averaging in RELION, while input stacks of 2D images would have required significant software development efforts. Nevertheless, in the future we might still choose to implement a true 2D version of the code, which would be more efficient, both in terms of processing time and disk storage requirements. In cases where the number of tilt images is small in comparison to the box size, fewer Fourier pixels need to be examined in a stack of 2D images than in a pseudosubtomogram, with a corresponding decrease in processing time. Moreover, the likelihood calculation from the 3D pseudo-subtomogram approach requires separate storage of the accumulated squares of the CTFs, and the corresponding multiplicity terms. In contrast, in the 2D approach, only the 2D images need to be stored, as CTF parameters can be calculated on-the-fly and there is no need for a multiplicity term, giving a corresponding decrease in storage requirements. However, if one were to collect tilt series with very fine angular increments or in a continuous manner, then the current implementation may still be preferable”.</p><disp-quote content-type="editor-comment"><p>10) In general, the use of the term &quot;particle polishing&quot; could lead to misinterpretations since it means different things in SPA and tomography. In SPA, &quot;polishing&quot; refers to the analysis of intermediate vidoe frames (which also exist in tomography), but the present study doesn't consider them at all. Also, I noticed that the term &quot;frames&quot; is used interchangeably to refer to SPA &quot;vidoe frames&quot; and &quot;particle tilts&quot; in tomography, which adds to the confusion. For example, the term &quot;frame alignment&quot; is mentioned twice on page 6, but I believe the authors are really referring to &quot;tilt image alignment&quot; instead. This should be clarified and the terms &quot;frame&quot; and &quot;tilts&quot; should be used consistently throughout the manuscript.</p></disp-quote><p>One complication here is that the terms “frame alignment” and “polishing” are already mentioned on the RELION-4.0 GUI and in its documentation. Still, we recognize the ambiguity of the word frame in our manuscript. Therefore, in all instances of the word “frame”, we explicitly refer to either “vidoe frame” or “tilt series frame” in the revised version.</p><p>That said, the actual program that performs the “frame alignment” can, in fact, also work with vidoe frames from the tilt series images. One problem here is that the regularization of the motions is not done separately for vidoe frames within one tilt image and vidoe frames of the other tilt images. This may explain why preliminary tests with the individual vidoe frames did not yield worthwhile improvements. In the end, we decided not to expose the vidoe-frame functionality to the end-user. We now explicitly mention in the Methods section:</p><p>“We also note that Bayesian Polishing in SPA describes particle motions between individual vidoe frames. Although our approach for tomography can also consider vidoe frames, the current implementation uses the same regularization of particle motions between vidoe frames within each tilt image as between the vidoe frames from other tilt images. Because preliminary tests showed limited benefits in considering the vidoe frames in this manner, only the functionality to model particle motions between the tilt series images were exposed on the GUI.”</p><disp-quote content-type="editor-comment"><p>11) For the <italic>Caulobacter crescentus</italic> S-layer reconstruction, the new cryo-ET map corresponding to the inner domain of the S-layer seems to have even better resolution than the SPA reconstruction reported in the original work [26] (3.5A vs. 3.7A for EMD-10389). Since the authors say these maps are in &quot;excellent agreement&quot;, a quantitative comparison should be included. Was the second LPS binding site visible in the 3.7A SPA map? In Figure 2d, the fit between LPS and the cryo-ET density (right-hand side) seems to be of lower quality (i.e., no density for parts of the LPS model is seen). Without having access to the maps, it is not possible to properly evaluate these results.</p></disp-quote><p>All maps have now been submitted to the EMDB (also see point 7) and we have now included a comparison with the previous 3.7A map in Figure 2 —figure supplement 1. Please note that the 3.7 Å cryo-EM single-particle map was produced from data collected of an in vitro reconstituted specimen, rather than from the S-layer on native membranes on cells. The second LPS binding site was never observed in vitro, illustrating why in situ imaging is vital for obtaining physiologically relevant insights.</p><disp-quote content-type="editor-comment"><p>12) The paper is well-written and clear, but the description of the new concepts and evaluation of the method is somewhat minimalistic. While these may not be absolutely necessary, they will facilitate better understanding by a broader user community.</p><p>(i) A graph describing the workflow as implemented in RELION, e.g., as a flow chart, would increase the readability of the paper.</p><p>(ii) A figure visually describing the pseudosubtomograms would make the concept clearer to the reader.</p><p>(iii) A more in-depth description of the input files (alignment files from imod, particle lists, and orientation from Dynamo/elsewhere) needed to perform alignments and averaging in RELION using pseudosubtomograms would be beneficial to the community. This could be incorporated into a flowchart as suggested in (i).</p><p>(13) Along the same lines, the authors do not include any description of the particle-picking procedures or the software requirements. This seems to be important as the authors state &quot;(particles) relative defoci are known from the geometry of the tilt series and the known 3D positions of the particles in the tomogram&quot;.</p></disp-quote><p>This paper describes the 3D pseudo-subtomogram approach with its correspondingly modified refinement algorithm, as well as the new functionality to perform CTF refinement and tilt series frame alignment in RELION-4.0. Unfortunately, RELION-4.0 does not yet provide a smooth pipeline for the entire processing procedure that would be captured well in a flow chart. Much improved import procedures and a smoother pipeline are the topic on ongoing work, which will be implemented in RELION-4.1. We have modified the Discussion to reflect this more clearly:</p><p>“However, tilt series alignment, tomogram reconstruction and particle picking are not yet part of the RELION workflow. Efforts to also implement solutions for those steps in a single tomography processing pipeline are ongoing and will be part of future RELION releases. Meanwhile, current import procedures rely on specific pre-processing operations in IMOD kremer1996computer, and particle coordinate conversion tools to use in RELION-4.0 are available for a range of third-party software packages pyle2022picking.”</p><disp-quote content-type="editor-comment"><p>(14) In section 2.2 it is shortly discussed that rotational priors can be used to constrain orientational searches. As this is often very useful for particle alignment in cryo-ET, this and the implementation should be described in more detail.</p></disp-quote><p>Performing local angular searches is done using RELION’s standard Gaussian-shaped priors on the Euler angles, which have been described previously. A reference to the corresponding paper has been inserted. Please also see our response to point (2).</p><disp-quote content-type="editor-comment"><p>(15) The progress in map quality is only shown by improvements to resolution in the FSC for the test datasets. It would be beneficial to also show the initial and intermediary maps for at least one of the test cases so that the reader can better assess the improvement in map quality. Overall maps should be shown to evaluate performance on the &quot;whole particle&quot; level, given considerations of flexibility (especially in cases where focused refinement was used). Corresponding local resolution maps would be informative in such cases.</p></disp-quote><p>We have inserted maps describing the stepwise improvement for the HIV immature capsid data set in Figure 1 —figure supplement 1.</p><disp-quote content-type="editor-comment"><p>(16) For the immature HIV capsid data, the FSC curves are only shown for the small subset of data. As it is an important point that the RELION pseudosubtomogram approach can reach the same resolution as previous software such as M, the data should also be shown for the full dataset (authors write &quot;data not shown&quot;).</p></disp-quote><p>This has been done. See point (3).</p><disp-quote content-type="editor-comment"><p>(17) In general, a proper comparison to the previous approaches/results, maybe by providing the maps for comparison in the figures, would be helpful for the reader to evaluate which approach to choose, and based on what expectations/biological system.</p></disp-quote><p>See points (3), (4) and (11).</p><disp-quote content-type="editor-comment"><p>(18) In section 4 it is briefly discussed that particle rotation is not modeled in the per-particle motion correction. They draw parallels to single particles and conclude that this might be an issue at resolutions better than 2 Å. However, could the authors comment on whether the difference in dose and time frame of data collection as well as the thickness of sample, may affect the assumption that this is only an issue at a higher resolution?</p></disp-quote><p>The lower dose in tilt series images, and thicker samples will only make it more difficult to also model the rotations, as both will decrease signal-to-noise ratios in the images. The only advantage of tomographic data is that the distinct tilts provide complementary views of the same structure, which might benefit the rotational alignments.</p><disp-quote content-type="editor-comment"><p>(19) Many subtomogram averages are resolved at a more moderate resolution (e.g. 8-20 Å) than the maps presented in this study due to different reasons. It would be beneficial for the reader if the authors could comment on/discuss which optical and geometrical parameters can be confidently modeled at a lower resolution and if they improve resolution.</p></disp-quote><p>One would expect that shifts of the particles (during subtomogram alignment, but also during tilt series frame alignment) would still be reasonably well defined by such low-medium resolutions. Probably defocus refinement would be more difficult.</p><disp-quote content-type="editor-comment"><p>(20) Could the authors comment on whether it is possible to extract the refined optical and geometrical parameters for a set of particles from a tilt series, and apply them to a different set of particles from the same tilt series (or to the full tilt series to obtain a better quality tomogram for new particle picking).</p></disp-quote><p>This is not yet possible, but we have plans to implement this functionality in the future.</p><disp-quote content-type="editor-comment"><p>21) Along the same line: would it be possible to refine two distinct species (e.g. two distinct conformations of the same protein or two completely unrelated proteins) together in a multi-species refinement of optical and geometrical parameters? As the overall tilt series alignment and imaging parameters are the same, this might aid in refinement for lower abundance.</p></disp-quote><p>Not yet; also see point (19).</p><disp-quote content-type="editor-comment"><p>(22) On a more conceptual level, the reasoning to separate the SPA/Cryo-ET workflows completely in the software package remains unclear to me and it would be valuable if the authors could briefly discuss this.</p></disp-quote><p>The workflows are not separated completely. In fact, their implementation in RELION-4.0 is very much intertwined. This will aid newcomers to the field of tomography, who may already be familiar with SPA processing in RELION. The paper already makes this point.</p><disp-quote content-type="editor-comment"><p>23) Can the authors comment on the &quot;The data model assumes independent Gaussian noise on the Fourier components of the cryo-EM images of individual particles&quot; with respect to the more complex in situ data, where noise is expected to be more structured?</p></disp-quote><p>In neither SPA, nor tomography, is this assumption perfect. In both modalities, neighboring particles will introduce noise that is localized in real-space, and for which correlations thus exist in Fourier space. However, taking such correlations into account would be computationally difficult and expensive.</p></body></sub-article></article>