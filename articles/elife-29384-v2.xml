<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.1 20151215//EN"  "JATS-archivearticle1.dtd"><article article-type="research-article" dtd-version="1.1" xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn pub-type="epub" publication-format="electronic">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">29384</article-id><article-id pub-id-type="doi">10.7554/eLife.29384</article-id><article-categories><subj-group subj-group-type="display-channel"><subject>Tools and Resources</subject></subj-group><subj-group subj-group-type="heading"><subject>Neuroscience</subject></subj-group></article-categories><title-group><article-title>Revealing the distribution of transmembrane currents along the dendritic tree of a neuron from extracellular recordings</article-title></title-group><contrib-group><contrib contrib-type="author" id="author-90312"><name><surname>Cserp√°n</surname><given-names>Dorottya</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-7538-1931</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-90309"><name><surname>Mesz√©na</surname><given-names>Domokos</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-4042-2542</contrib-id><email>meszena.domokos@ttk.mta.hu</email><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-90307"><name><surname>Wittner</surname><given-names>Lucia</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0001-6800-0953</contrib-id><email>wittner.lucia@ttk.mta.hu</email><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="other" rid="fund1"/><xref ref-type="fn" rid="con3"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-90310"><name><surname>T√≥th</surname><given-names>Kinga</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-8751-8499</contrib-id><email>toth.kinga@ttk.mta.hu</email><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="con4"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-90308"><name><surname>Ulbert</surname><given-names>Istv√°n</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0001-9941-9159</contrib-id><email>ulbert.istvan@ttk.mta.hu</email><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="other" rid="fund2"/><xref ref-type="fn" rid="con5"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-90311"><name><surname>Somogyv√°ri</surname><given-names>Zolt√°n</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-4385-3025</contrib-id><email>somogyvari.zoltan@wigner.mta.hu</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="aff" rid="aff5">5</xref><xref ref-type="other" rid="fund3"/><xref ref-type="other" rid="fund4"/><xref ref-type="other" rid="fund5"/><xref ref-type="fn" rid="con6"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" corresp="yes" id="author-89906"><name><surname>W√≥jcik</surname><given-names>Daniel K</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-0812-9872</contrib-id><email>d.wojcik@nencki.gov.pl</email><xref ref-type="aff" rid="aff6">6</xref><xref ref-type="other" rid="fund6"/><xref ref-type="fn" rid="con7"/><xref ref-type="fn" rid="conf1"/></contrib><aff id="aff1"><label>1</label><institution content-type="dept">Wigner Research Centre for Physics</institution><institution>Hungarian Academy of Sciences</institution><addr-line><named-content content-type="city">Budapest</named-content></addr-line><country>Hungary</country></aff><aff id="aff2"><label>2</label><institution content-type="dept">Institute of Cognitive Neuroscience and Psychology, Research Centre for Natural Sciences</institution><institution>Hungarian Academy of Sciences</institution><addr-line><named-content content-type="city">Budapest</named-content></addr-line><country>Hungary</country></aff><aff id="aff3"><label>3</label><institution content-type="dept">Faculty of Information Technology and Bionics</institution><institution>P√°zm√°ny P√©ter Catholic University</institution><addr-line><named-content content-type="city">Budapest</named-content></addr-line><country>Hungary</country></aff><aff id="aff4"><label>4</label><institution>National Institute of Clinical Neurosciences</institution><addr-line><named-content content-type="city">Budapest</named-content></addr-line><country>Hungary</country></aff><aff id="aff5"><label>5</label><institution>Neuromicrosystems Ltd.</institution><addr-line><named-content content-type="city">Budapest</named-content></addr-line><country>Hungary</country></aff><aff id="aff6"><label>6</label><institution content-type="dept">Department of Neurophysiology</institution><institution>Nencki Institute of Experimental Biology of Polish Academy of Sciences</institution><addr-line><named-content content-type="city">Warsaw</named-content></addr-line><country>Poland</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor" id="author-14764"><name><surname>Skinner</surname><given-names>Frances K</given-names></name><role>Reviewing Editor</role><aff><institution>Krembil Research Institute, University Health Network</institution><country>Canada</country></aff></contrib></contrib-group><pub-date date-type="publication" publication-format="electronic"><day>17</day><month>11</month><year>2017</year></pub-date><pub-date pub-type="collection"><year>2017</year></pub-date><volume>6</volume><elocation-id>e29384</elocation-id><history><date date-type="received" iso-8601-date="2017-06-07"><day>07</day><month>06</month><year>2017</year></date><date date-type="accepted" iso-8601-date="2017-11-16"><day>16</day><month>11</month><year>2017</year></date></history><permissions><copyright-statement>¬© 2017, Cserp√°n et al</copyright-statement><copyright-year>2017</copyright-year><copyright-holder>Cserp√°n et al</copyright-holder><ali:free_to_read/><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><ali:license_ref>http://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-29384-v2.pdf"/><abstract><object-id pub-id-type="doi">10.7554/eLife.29384.001</object-id><p>Revealing the current source distribution along the neuronal membrane is a key step on the way to understanding neural computations; however, the experimental and theoretical tools to achieve sufficient spatiotemporal resolution for the estimation remain to be established. Here, we address this problem using extracellularly recorded potentials with arbitrarily distributed electrodes for a neuron of known morphology. We use simulations of models with varying complexity to validate the proposed method and to give recommendations for experimental applications. The method is applied to in vitro data from rat hippocampus.</p></abstract><kwd-group kwd-group-type="author-keywords"><kwd>local field potential</kwd><kwd>LFP</kwd><kwd>current source density</kwd><kwd>CSD</kwd><kwd>kernel methods</kwd><kwd>inverse problem</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research organism</title><kwd>Rat</kwd></kwd-group><funding-group><award-group id="fund2"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100004569</institution-id><institution>Ministerstwo Nauki i Szkolnictwa Wy≈ºszego</institution></institution-wrap></funding-source><award-id>2729/7.PR/2013/2</award-id><principal-award-recipient><name><surname>Ulbert</surname><given-names>Istv√°n</given-names></name></principal-award-recipient></award-group><award-group id="fund3"><funding-source><institution-wrap><institution>Nemzeti Kutat√°si, Fejlesztesi √©s Innovacios Hivatal</institution></institution-wrap></funding-source><award-id>K 113147</award-id><principal-award-recipient><name><surname>Somogyv√°ri</surname><given-names>Zolt√°n</given-names></name></principal-award-recipient></award-group><award-group id="fund4"><funding-source><institution-wrap><institution>Nemzeti Agykutatasi Program</institution></institution-wrap></funding-source><award-id>KTIA NAP 13-1-2013-0001</award-id><principal-award-recipient><name><surname>Somogyv√°ri</surname><given-names>Zolt√°n</given-names></name></principal-award-recipient></award-group><award-group id="fund5"><funding-source><institution-wrap><institution>Nemzeti Kutatasi, Fejilesztesi es Innovacios Hivatal</institution></institution-wrap></funding-source><award-id>NN 118902</award-id><principal-award-recipient><name><surname>Somogyv√°ri</surname><given-names>Zolt√°n</given-names></name></principal-award-recipient></award-group><award-group id="fund6"><funding-source><institution-wrap><institution>Nemzeti Agykutatasi Program</institution></institution-wrap></funding-source><award-id>KTIA-13-NAP-A-IV/1 2 3 4 6</award-id><principal-award-recipient><name><surname>W√≥jcik</surname><given-names>Daniel K</given-names></name></principal-award-recipient></award-group><award-group id="fund1"><funding-source><institution-wrap><institution>Nemzeti Kutatasi, Fejlesztesi es Innovacios Hivatal</institution></institution-wrap></funding-source><award-id>K119443</award-id><principal-award-recipient><name><surname>Wittner</surname><given-names>Lucia</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>A computational method reveals current sources along the dendritic tree of a single neuron of known morphology from extracellular potential.</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>A variety of methods are used to investigate the electrophysiological properties of neurons. To date, patch-clamp (<xref ref-type="bibr" rid="bib39">Neher and Sakmann, 1976</xref>) is the most commonly used technique to monitor neuronal membrane potential. Despite its unquestionable utility, it remains challenging to monitor the activity of a cell at more than one or two sites. Extracellular recordings, on the other hand, deliver a more global picture of neural activity (<xref ref-type="bibr" rid="bib5">Buzs√°ki et al., 2012</xref>; <xref ref-type="bibr" rid="bib13">Einevoll et al., 2013a</xref>). With modern multielectrodes and microelectrode arrays, it is now possible to record neuronal activity from many thousands of channels (<xref ref-type="bibr" rid="bib7">Buzs√°ki, 2004</xref>; <xref ref-type="bibr" rid="bib3">Berdondini et al., 2005</xref>; <xref ref-type="bibr" rid="bib43">Obien et al., 2014</xref>). However, this technique does not permit direct recording of membrane potentials but instead spiking activity [which may be of individual cells (single-unit activity, SUA) or multiple cells (multiunit activity or MUA, which is the mean firing rate of cell populations)] and components of postsynaptic activity visible at low frequencies (&lt;300 Hz, so-called local field potential, LFP); see (<xref ref-type="bibr" rid="bib5">Buzs√°ki et al., 2012</xref>; <xref ref-type="bibr" rid="bib13">Einevoll et al., 2013a</xref>; <xref ref-type="bibr" rid="bib17">G≈ÇƒÖbska et al., 2017</xref>) for discussion.</p><p>So far, the main advantages of high-density array recordings have been improved resolution of spike detection (<xref ref-type="bibr" rid="bib48">Rey et al., 2015</xref>), as more cells can be identified in a single recording, improved stimulation precision (<xref ref-type="bibr" rid="bib23">Hottowy et al., 2012</xref>; <xref ref-type="bibr" rid="bib9">Chichilnisky, 2001</xref>), of particular importance for retinal neuroprosthetics, and new features observed in the profiles of slow fields (<xref ref-type="bibr" rid="bib15">Ferrea et al., 2012</xref>). Recently, high-density probes have also been used in studies of axon tracking (<xref ref-type="bibr" rid="bib2">Bakkum et al., 2013</xref>; <xref ref-type="bibr" rid="bib28">Lewandowska et al., 2016</xref>) and multisynaptic integration (<xref ref-type="bibr" rid="bib24">J√§ckel et al., 2017</xref>).</p><p>Multielectrode recordings have been traditionally used for improved spike sorting (<xref ref-type="bibr" rid="bib7">Buzs√°ki, 2004</xref>; <xref ref-type="bibr" rid="bib3">Berdondini et al., 2005</xref>; <xref ref-type="bibr" rid="bib43">Obien et al., 2014</xref>; <xref ref-type="bibr" rid="bib38">Muthmann et al., 2015</xref>) and for the reconstruction of current source densities (CSD) behind the recorded LFP (<xref ref-type="bibr" rid="bib46">Pitts, 1952</xref>; <xref ref-type="bibr" rid="bib36">Mitzdorf, 1985</xref>; <xref ref-type="bibr" rid="bib54">W√≥jcik, 2015</xref>), although more specific methods have sinse been devised (<xref ref-type="bibr" rid="bib14">Einevoll et al., 2013b</xref>; <xref ref-type="bibr" rid="bib18">G≈ÇƒÖbska et al., 2014</xref>; <xref ref-type="bibr" rid="bib19">G≈ÇƒÖbska et al., 2016</xref>). Several attempts have been made, using different approaches, to localize cells from multielectrode recordings. For example, accounting for the properties of electric field propagation in the tissue (<xref ref-type="bibr" rid="bib38">Muthmann et al., 2015</xref>), that form the basis of CSD methods (<xref ref-type="bibr" rid="bib52">Somogyv√°ri et al., 2005</xref>, Somogyv√°ri et al., 2012<xref ref-type="bibr" rid="bib51">Somogyv√°ri et al., 2012</xref>), or other triangulation approaches (<xref ref-type="bibr" rid="bib34">Mechler et al., 2011</xref>; <xref ref-type="bibr" rid="bib35">Mechler and Victor, 2012</xref>). We are not aware of any prior attempts, however, to reconstruct the CSD of individual neurons using their available morphologies, which we propose here.</p><p>This method assumes we have a set of extracellular recordings, coming from a specific neuron, whose morphology and location with respect to the electrode is known, collected with multiple contacts. This could be realized experimentally by patching a neuron close to the multielectrode and driving it through an intracellular injection or monitoring its activity to determine the contribution of this specific cell to the extracellular field. Computing spike-triggered average of the potential, which we do in our proof-of-concept experiment, or driving the neuron with sinusoidal current and averaging the extracellular potential over periods of the driving current, are ways in which this could be achieved. When the recordings are complete, we inject dye into the cell and reconstruct its morphology. Thus, we obtain a set of synchronous multichannel extracellular recordings reflecting the activity of a single neuron whose morphology is also known, as well as the position of the neuron relative to the electrode contacts. Here, we show how to use this approach to infer the distribution of current sources based on cell morphology as they change in time. The data necessary to apply presented method have been available for some time (<xref ref-type="bibr" rid="bib22">Henze et al., 2000</xref>; <xref ref-type="bibr" rid="bib20">Gold et al., 2006</xref>), although recently have became much more comprehensive (<xref ref-type="bibr" rid="bib24">J√§ckel et al., 2017</xref>). While we believe the estimation of transmembrane currents along the cell morphology using this type of data has not been reported previously, similar questions have been posed by (<xref ref-type="bibr" rid="bib20">Gold et al., 2006</xref>), who attempted to identify the biophysical properties of a neuron membrane based on the extracellular signature of the action potential. A similar strategy was used by <xref ref-type="bibr" rid="bib16">Frey et al., 2009</xref>) in their studies of extracellular action potential shape observed with high-definition multi-electrode arrays.</p><p>The <italic>single-cell kernel Current Source Density</italic> method (skCSD) we introduce here is an application of the framework of the <italic>kernel Current Source Density method</italic> (<xref ref-type="bibr" rid="bib47">Potworowski et al., 2012</xref>) to the data coming from a single cell. This is done by restricting current sources to cell morphology. This can be done efficiently for arbitrarily complex morphologies and arbitrary electrode configurations.</p><p>The importance of this work is that for the first time we show here how a collection of extracellular recordings in combination with cell morphology can be used to estimate how the current sources located on a studied cell contribute to the recorded field potential. Since it is feasible to acquire the relevant data, we believe that the method proposed here may be used to constrain the biophysical properties of the neuron membrane and facilitate consistency of the reconstructed morphology. Further, this method can help guide new discoveries by providing a more global picture of the current distribution based on neuronal morphology, leading to a coherent spatiotemporal view of synaptic drive and return currents of the observed neuron.</p><p>In the following Results section, we start with a high-level overview of the skCSD method. We explain how it is applied and why it works. Then, we validate this method on several ground truth datasets obtained in simulations and apply it to data from a proof-of-concept experiment. In the Discussion, we summarize our main findings and discuss the practical aspects and feasibility of experimental acquisition of the required data. Finally, in the Materials and methods section, we present the skCSD method in detail.</p></sec><sec id="s2" sec-type="results"><title>Results</title><p>The main result of this work is the introduction of the skCSD method, so we start here with a high-level overview. The technical details are deferred to the Materials and methods section. Next, we study the properties of the skCSD reconstruction for three representative morphologies of increasing complexity and for different setups.</p><p>First, for a ball-and-stick neuron, we study the general quality of reconstruction of fine detail by considering CSD distributions in the form of standing waves of increasing spatial frequency which form the Fourier basis of any possible CSD profile. It is unlikely that standing waves would be naturally observed in a cell, therefore to better understand how the results for the Fourier space representation relate to a specific distribution which might arise in a physiological situation, we also consider reconstruction of sources for random synaptic activation of the ball-and-stick cell.</p><p>Secondly, we consider a Y-shaped neuron with a single branching point, we check if skCSD can differentiate between synaptic activations located on the different branches close to the branching point. We also investigate the effects of random distribution of contacts on skCSD reconstruction. Finally, we investigate the possibility of skCSD reconstruction on a realistic model of a ganglion cell placed on a microelectrode array (MEA) as well as the sensitivity of the method to noise.</p><p>After establishing and validating skCSD on these fully controlled model datasets, to demonstrate neurophysiological viability, the CSD distribution was reconstructed for a pyramidal cell using the experimental spike-triggered averages of the recorded potentials.</p><sec id="s2-1"><title>Single-cell kernel current source density method, a high-level overview</title><p>The goal of this section is to provide an overview of the proposed method for non-specialists, with limited mathematical terminology and notation. A more formal discussion is provided in the Materials and methods section.</p><p>Assume we study a neuron, we have its morphology, we know how it is located with respect to a multielectrode used for extracellular recording, we also have a set of simultaneous recordings of extracellular potential generated by this cell collected with this multielectrode. In principle, the number and placement of the electrodes can be arbitrary. Also, the potential may be filtered, or we may consider the full spectrum of the signal, depending on whether we wish to focus more on synaptic contributions or consider the extracellular signatures of spiking. For now, we shall ignore the challenge of separating the part of the signal contributed by the studied neuron from background extracellular signals generated by nearby cells; we shall return to this issue in the Discussion.</p><p>We wish to reconstruct the distribution of current sources which generated the measured potentials. By assumption, we know the potential that comes from the studied cell, we wish to restrict the sources to lie on its morphology. To do this, we first represent the morphology by a closed line which we call the <italic>morphology loop</italic>. To construct it consider a one-dimensional abstraction of the cell, where we ignore the thickness of the dendrites. Alternatively, you may imagine the graph constructed from the lines passing centrally through all the dendrites. Then, starting for example at the soma, we draw a line along this graph passing all sections along the dendrite, eventually reaching the starting point. The morphology loop is shown as the red line in <xref ref-type="fig" rid="fig1">Figure 1</xref>.</p><fig id="fig1" position="float"><object-id pub-id-type="doi">10.7554/eLife.29384.002</object-id><label>Figure 1.</label><caption><title>Schematic overview of the skCSD method.</title><p>The black line indicates the two-dimensional projection of the neuron on the MEA plane, the blue circles mark the location of multielectrode array (hexagonal grid, in this example), <inline-formula><mml:math id="inf1"><mml:msub><mml:mi>r</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula> is the position of the <inline-formula><mml:math id="inf2"><mml:msup><mml:mi>k</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup></mml:math></inline-formula> electrode. The morphology in our method is described by a self-closing curve in three dimensions, which is indicated by red on the plot. We shall refer to this curve as the <italic>morphology loop</italic>. A point of the cell is visited once, if it is a terminal point of a dendrite, more than twice, if it is a branching point and twice in all the other cases. With this strategy, any point on the morphology loop uniquely identifies the physical location of the corresponding part of the cell unambiguously. To set up estimation framework, we distribute one-dimensional, overlapping Gaussian basis functions spanning the current sources. Several of these Gaussians are plotted in green, <inline-formula><mml:math id="inf3"><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> marks the center of the <inline-formula><mml:math id="inf4"><mml:msup><mml:mi>i</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup></mml:math></inline-formula> basis element, <inline-formula><mml:math id="inf5"><mml:mi>R</mml:mi></mml:math></inline-formula> is the width parameter.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-29384-fig1-v2"/></fig><p>If we spread the morphology loop, we obtain a circle, which means all point of dendritic morphology have been mapped to a circle, and the opposite, any point on the circle has been mapped to the morphology. The mapping from the cell to the circle is not unique: we pass by most points on the dendrite twice, with the exception of the tips, which are visited once, and the branching points, which may be visited more than twice in our graph representation. So in most cases, a given point from the morphology corresponds to multiple points from the circle. The other mapping is unique: every point in the circle is mapped onto exactly one point on the morphology without skipping any. One way to think about the morphology loop is as a rubber band tightly wrapping around the neuron‚Äôs morphology.</p><p>We now want to consider the distribution of current sources on the morphology. We found it convenient, technically, to start with a distribution of sources along the morphology loop. Then, we wrap this distribution around the cell together with the loop. We do this by construction. We cover the morphology loop with a large number of identical but translated functions which we call the <italic>CSD basis functions</italic> denoted by <inline-formula><mml:math id="inf6"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>b</mml:mi><mml:mo>~</mml:mo></mml:mover><mml:mi>j</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. There is a large flexibility here, but in practice we use Gaussians, so <inline-formula><mml:math id="inf7"><mml:mrow><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>b</mml:mi><mml:mo>~</mml:mo></mml:mover><mml:mi>j</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>‚àù</mml:mo><mml:mrow><mml:mi>exp</mml:mi><mml:mo>‚Å°</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo>-</mml:mo><mml:msub><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow><mml:mo>‚Å¢</mml:mo><mml:msup><mml:mi>R</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>. The number of basis functions we use, <inline-formula><mml:math id="inf8"><mml:mi>M</mml:mi></mml:math></inline-formula>, and the <italic>width of the basis function</italic>, <inline-formula><mml:math id="inf9"><mml:mi>R</mml:mi></mml:math></inline-formula>, are parameters of the method whose effect on results we discuss below.</p><p>We place these basis functions so that they uniformly cover the morphology loop. We require their centers to be uniformly spaced. When we wrap these functions around the morphology, passing a given dendrite twice will introduce more overlap. We only require that no two functions overlay: we want them to be independent which means each two must differ, here, in practice, be shifted with respect to each other. Once the CSD basis functions are in place, we compute the potential they generate in the whole space. The distribution of the potential in space coming from a single CSD basis function is called a basis function in the potential space, or <italic>potential basis function</italic> for short, and is denoted by <inline-formula><mml:math id="inf10"><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> (we drop the tilde).</p><p>We are now ready to start the estimation of the distribution of the current sources on the cell from the recording. This is a static procedure, in the sense that the estimated CSD at any moment in time depends only on the present value of the measurements. We are looking for the distribution of current sources in the form of a linear combination of the basis sources which we placed. This means a weighted sum of each CSD basis source<disp-formula id="equ1"><mml:math id="m1"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>C</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mo>‚àë</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mover><mml:mi>b</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>Then, the potential they generate, is the linear combination of the respective potential basis sources with the same weights,<disp-formula id="equ2"><label>(1)</label><mml:math id="m2"><mml:mrow><mml:mrow><mml:mrow><mml:mi>V</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munderover><mml:mo largeop="true" movablelimits="false" symmetric="true">‚àë</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>Conceptually, we want to match the described potential with actual measurements and from this infer the weights. In practice, however, we cannot do it directly, because typically there will be many more basis functions, and therefore weights to be estimated, than the available measurements. To understand why this is a problem consider the simplest case, where you have two numbers, <inline-formula><mml:math id="inf11"><mml:mi>x</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf12"><mml:mi>y</mml:mi></mml:math></inline-formula>, to estimate from a single measurement which gives 1, and the physics of the problem gives equal contribution to the measurement, so that we must solve <inline-formula><mml:math id="inf13"><mml:mrow><mml:mrow><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:mi>y</mml:mi></mml:mrow><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula>. It is easy to see that without further constraints this has an infinite number of equally good solutions.</p><p>One way to solve this problem, which was our inspiration, was proposed by <xref ref-type="bibr" rid="bib53">Vapnik (1998</xref>) (Appendix to Chapter 6: Estimating functions on the basis of indirect measurements), who effectively considered the problem of estimating one quantity (here: CSD) from measurements of its function (here: potential). Here, we combine it with the kernel trick (<xref ref-type="bibr" rid="bib49">Sch√∂lkopf and Smola, 2002</xref>), which allows us to make indirect estimation in the high-dimensional space of basis functions through computations in the space of measurements. We construct a <italic>kernel function</italic> which is a sum of products of the potential basis functions with themselves<disp-formula id="equ3"><mml:math id="m3"><mml:mrow><mml:mrow><mml:mrow><mml:mi>K</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo>‚Ä≤</mml:mo></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munderover><mml:mo largeop="true" movablelimits="false" symmetric="true">‚àë</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>‚Å¢</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo>‚Ä≤</mml:mo></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>This function, which takes two spatial arguments, can be understood as a similarity measure between the potentials at the two points. It is easy to see, that any model of potential we can construct from our potential basis functions can also be written as a linear combination of these kernel functions with one of the variables fixed, if we use sufficiently many kernels (large <inline-formula><mml:math id="inf14"><mml:mi>L</mml:mi></mml:math></inline-formula>)<disp-formula id="equ4"><label>(2)</label><mml:math id="m4"><mml:mrow><mml:mrow><mml:mrow><mml:mi>V</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munderover><mml:mo largeop="true" movablelimits="false" symmetric="true">‚àë</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>L</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mi>Œ≤</mml:mi><mml:mi>l</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mi>K</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mi>l</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>The reason is that <inline-formula><mml:math id="inf15"><mml:mrow><mml:mi>K</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mi>l</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is a linear combination of all the basis functions spanning the potential space: <inline-formula><mml:math id="inf16"><mml:mrow><mml:mrow><mml:mi>K</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mi>l</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msubsup><mml:mo largeop="true" symmetric="true">‚àë</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:msubsup><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mi>l</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>‚Å¢</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>. Thus, if we take as many kernels as we have basis sources (<inline-formula><mml:math id="inf17"><mml:mrow><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:mi>M</mml:mi></mml:mrow></mml:math></inline-formula>) and equate <xref ref-type="disp-formula" rid="equ4">Equation 2</xref> with <xref ref-type="disp-formula" rid="equ2">Equation 1</xref>, we have to solve <inline-formula><mml:math id="inf18"><mml:mrow><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mi>L</mml:mi></mml:mrow></mml:math></inline-formula> equations of the form<disp-formula id="equ5"><mml:math id="m5"><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:munderover><mml:mo largeop="true" movablelimits="false" symmetric="true">‚àë</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>L</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mi>Œ≤</mml:mi><mml:mi>l</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mi>l</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>for <inline-formula><mml:math id="inf19"><mml:msub><mml:mi>Œ≤</mml:mi><mml:mi>l</mml:mi></mml:msub></mml:math></inline-formula>, or in other words, we have to find such points <inline-formula><mml:math id="inf20"><mml:msub><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mi>l</mml:mi></mml:msub></mml:math></inline-formula> for which the above equation is solvable. This can be done, this is another way of saying that the functions <inline-formula><mml:math id="inf21"><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> form a basis. It is thus fair to say that the kernel functions <inline-formula><mml:math id="inf22"><mml:mrow><mml:mi>K</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mi>l</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf23"><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> are equivalent basis. At this stage, it is not clear if one basis should be better than the other.</p><p>The rationale for using the kernels is provided by the Representer Theorem (<xref ref-type="bibr" rid="bib49">Sch√∂lkopf and Smola, 2002</xref>), which shows that in the form of <xref ref-type="disp-formula" rid="equ4">Equation 2</xref> we can minimize the prediction error (sum of the squared differences between the predictions of our model and actual measurements) uniquely. Moreover, the solution obtained has as many parameters as there are measurements, and we take <inline-formula><mml:math id="inf24"><mml:msub><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mi>l</mml:mi></mml:msub></mml:math></inline-formula> to be the measurement points. This is the advantage of the kernel approach over direct estimation of underlying model: here the number of parameters to be calculated is the same as the number of measurements <inline-formula><mml:math id="inf25"><mml:mi>N</mml:mi></mml:math></inline-formula>, much less than the original number of basis sources <inline-formula><mml:math id="inf26"><mml:mi>M</mml:mi></mml:math></inline-formula>, so it can be done.</p><p>Since we can expect our measurements to be noisy, a perfect fit will typically misrepresent the true potential, this is called overfitting. To counter this effect, we add a so-called <italic>regularization</italic> term to our error function to be minimized, which is the sum of squared parameters,<disp-formula id="equ6"><mml:math id="m6"><mml:mrow><mml:mrow><mml:mrow><mml:munderover><mml:mo largeop="true" movablelimits="false" symmetric="true">‚àë</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mi>V</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>-</mml:mo><mml:msub><mml:mi>V</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mi>Œª</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:munderover><mml:mo largeop="true" movablelimits="false" symmetric="true">‚àë</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:msubsup><mml:mi>Œ≤</mml:mi><mml:mi>l</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mrow></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>Thus, we want to simultaneously minimize the difference between our prediction and actual measurements while moderating the fluctuations of the interpolated potential in space. This only slightly changes the computation while significantly improving the stability of the solution. The result is<disp-formula id="equ7"><mml:math id="m7"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>Œ≤</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">K</mml:mi><mml:mo mathvariant="bold">+</mml:mo><mml:mi>Œª</mml:mi><mml:mi mathvariant="bold">I</mml:mi></mml:mrow><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo>‚àí</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>‚ãÖ</mml:mo><mml:mrow><mml:mi mathvariant="bold">V</mml:mi></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf27"><mml:mi mathvariant="bold">ùêï</mml:mi></mml:math></inline-formula> is the vector of the measurements <inline-formula><mml:math id="inf28"><mml:msub><mml:mi>V</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula>, I the identity matrix, <inline-formula><mml:math id="inf29"><mml:mrow><mml:msub><mml:mi mathvariant="bold">ùêä</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mi>K</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="inf30"><mml:mi>Œª</mml:mi></mml:math></inline-formula> the regularization parameter, which needs to be set.</p><p>We still need to obtain the CSD profile from the interpolated potential. In fact, we can do this without resorting directly to the basis functions. Replacing one of the potential basis functions in the definition of our kernel with the corresponding CSD basis function, we obtain what we call a <italic>cross-kernel function</italic>,<disp-formula id="equ8"><mml:math id="m8"><mml:mrow><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo>~</mml:mo></mml:mover><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo>‚Ä≤</mml:mo></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munderover><mml:mo largeop="true" movablelimits="false" symmetric="true">‚àë</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>‚Å¢</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>b</mml:mi><mml:mo>~</mml:mo></mml:mover><mml:mi>j</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo>‚Ä≤</mml:mo></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>Defining<disp-formula id="equ9"><mml:math id="m9"><mml:mrow><mml:mrow><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi mathvariant="bold">ùêä</mml:mi><mml:mo>~</mml:mo></mml:mover><mml:mi>T</mml:mi></mml:msup><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>:=</mml:mo><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo>~</mml:mo></mml:mover><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mi mathvariant="normal">‚Ä¶</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo>~</mml:mo></mml:mover><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mi>N</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p>the estimated CSD is<disp-formula id="equ10"><mml:math id="m10"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msup><mml:mi>C</mml:mi><mml:mo>‚àó</mml:mo></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mover><mml:mi mathvariant="bold">K</mml:mi><mml:mo mathvariant="bold">~</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mi>T</mml:mi></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>‚ãÖ</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">K</mml:mi><mml:mo mathvariant="bold">+</mml:mo><mml:mi>Œª</mml:mi><mml:mi mathvariant="bold">I</mml:mi></mml:mrow><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo>‚àí</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>‚ãÖ</mml:mo><mml:mrow><mml:mi mathvariant="bold">V</mml:mi></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>The skCSD is a model-based analysis method since the specific model of CSD distribution we use, collecting of the CSD basis functions along with the model relating these functions to the measurement of potential, influences the result. This is advantageous, since all the assumptions are explicit and the user can see how they affect the result. All the estimation methods of any quantity contain assumptions, which in many cases are implicit and thus it is difficult to analyze how they affect the estimation. With all the parameters explicit we can study how their specific values affect the quality of solution. In particular, we wish to select parameters leading to the optimal solution. We do this using <italic>cross-validation</italic> which we shall now explain.</p><p>We select a set of parameters: <inline-formula><mml:math id="inf31"><mml:mi>R</mml:mi></mml:math></inline-formula>, <inline-formula><mml:math id="inf32"><mml:mi>N</mml:mi></mml:math></inline-formula>, <inline-formula><mml:math id="inf33"><mml:mi>Œª</mml:mi></mml:math></inline-formula>, which fixes the model. Then, going contact by contact, we ignore the signal recorded at that particular site and build models from the remaining signals. This model predicts the potential at the ignored contact. The difference between the prediction and the actual measurement is a measure of prediction quality for a given set of parameters. We then add squares of the differences between the actual measurements at every electrode and predictions from the respective models built from all signals except the reference. Scanning through a range of parameters we look for a minimum prediction error. We use the parameters minimizing the prediction error in the subsequent analysis.</p></sec><sec id="s2-2"><title>Ball-and-stick neuron</title><p>Here, we consider the simplest neuron morphology, the so-called ball-and-stick model, which stands for the soma and a single dendrite. A virtual linear electrode was placed in parallel to the model cell 50¬†Œºm away, the electrodes were distributed evenly along the electrode extending for 600¬†Œºm.</p></sec><sec id="s2-3"><title>Increasing the density and number of electrodes improves spatial resolution of the method</title><p>To study the spatial resolution of the skCSD method, we consider the ground truth membrane current source density distributions in the form of waves with increasing spatial frequencies<disp-formula id="equ11"><mml:math id="m11"><mml:mrow><mml:mrow><mml:mrow><mml:mi>C</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>S</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>D</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi>A</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mi>cos</mml:mi><mml:mo>‚Å°</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>‚Å¢</mml:mo><mml:mi>œÄ</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>f</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>x</mml:mi></mml:mrow><mml:mo>/</mml:mo><mml:mi>L</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf34"><mml:mrow><mml:mi>A</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:mrow><mml:mpadded width="+5pt"><mml:mn>0.15</mml:mn></mml:mpadded><mml:mo>‚Å¢</mml:mo><mml:mi>n</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>A</mml:mi></mml:mrow><mml:mo>/</mml:mo><mml:mi>Œº</mml:mi></mml:mrow><mml:mo>‚Å¢</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:mrow></mml:math></inline-formula> is the amplitude, <inline-formula><mml:math id="inf35"><mml:mrow><mml:mi>f</mml:mi><mml:mo>‚àà</mml:mo><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mn>0.5</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>1.5</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="normal">‚Ä¶</mml:mi><mml:mo>,</mml:mo><mml:mn>12.5</mml:mn><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the spatial frequency, <inline-formula><mml:math id="inf36"><mml:mi>x</mml:mi></mml:math></inline-formula> is the position along the cell, <inline-formula><mml:math id="inf37"><mml:mi>L</mml:mi></mml:math></inline-formula> is the length of the cell. Then, we compute the generated extracellular potential at the electrode locations. The laminar shank consisting of 8, 16 and 128 electrodes was placed 50 Œºm from the cell in parallel to the dendrite. Finite sampling of the extracellular space sets a limit to the spatial resolution of this method. Increasing the density of electrodes within the studied region leads to higher spatial precision. As shown in <xref ref-type="fig" rid="fig2">Figure 2</xref>, with 128 electrodes it is possible to reconstruct higher frequency distributions as compared to eight electrodes. This is reminiscent of the sampling theorem (<xref ref-type="bibr" rid="bib44">Oppenheim et al., 1997</xref>), except here we measure the potential and reconstruct current sources, while in the sampling theorem we consider reconstruction of a continuous signal from discrete samples. What we observe is quite intuitive and typically observed in different discrete inverse methods (<xref ref-type="bibr" rid="bib21">Hansen, 2010</xref>). Note that once we move to complex morphologies and random rather than regular electrode placement, the intuition we build here, that denser probing gives better spatial resolution, would hold true, even if the relation to the sampling theorem would be less apparent.</p><fig id="fig2" position="float"><object-id pub-id-type="doi">10.7554/eLife.29384.003</object-id><label>Figure 2.</label><caption><title>Limitations of the spatial resolution of the skCSD method in a simple ball-and-stick and laminar electrode setup.</title><p>(<bold>A</bold>) The ground truth membrane current source density distribution was constructed from cosine waves of increasing spatial frequency (x-axis) along the cell mophology (y-axis), which is shown in the interval representation. (<bold>B‚ÄìD</bold>) skCSD reconstruction from 8, 16 and 128 electrodes. (<bold>E</bold>) The L1 Error of the skCSD reconstruction for 8 (black), 16 (red) and 128 (green) electrodes for CSD patterns of increasing frequency.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-29384-fig2-v2"/></fig></sec><sec id="s2-4"><title>Reconstruction of random synaptic activation</title><p>Using the ball-and-stick neuron, we now place 100 synapses along the dendrite and stimulate them randomly in time. We simulate 70 ms of recordings from this synaptically activated cell. The stimulation is sufficiently strong to evoke spiking, see Materials and methods for details. The spiking is indicated by strong red spots in the lowest first two segments in <xref ref-type="fig" rid="fig3">Figure 3</xref>, which correspond to the soma. As can be seen, the reconstructed CSD distribution reflects the ground-truth, and the precision of reconstruction improves with an increasing number of contacts, which is reflected in the reduction of cross-validation error. Notice how the reconstructed synaptic activity gets more precise with increased density of probing the potential. In particular observe how the width of the recovered synaptic activations and the somatic activations shrink with an increasing number of electrodes, which clearly shows improved resolution. This is consistent with our observations for the Fourier mode CSD profiles above. Not much change is seen in time, which is a consequence of the fact that skCSD, like all the CSD estimation methods, acts locally in time. That is, for every moment in time, the collection of potentials at this time, is analyzed. There is no direct relation to the past or future of the measured signals.</p><fig id="fig3" position="float"><object-id pub-id-type="doi">10.7554/eLife.29384.004</object-id><label>Figure 3.</label><caption><title>Performance of the skCSD method for a ball-and-stick neuron with random synaptic stimulation for recordings with a laminar probe placed 50 Œº<italic>m</italic> away from the cell.</title><p>(<bold>A</bold>) The ground truth spatio-temporal membrane current density in time (x-axis) along the cell in the interval representation (y-axis). The lowest segment is the soma, where the visible high amplitude of potential is a consequence of spiking. To make the much less pronounced synaptic activity on the dendritic part visible, nonlinear color map was used. Panel (<bold>B</bold>) shows the lowest values of cross-validation and L1 error for the before-mentioned setups. Panels (<bold>C‚ÄìE</bold>) present the best skCSD reconstruction in case of recording with 8, 32, and 128 electrodes. One can see how increasing the number and density of probes in the region improves the reconstruction quality until a certain level. CV error was used here to select the parameters leading to the best reconstructions.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-29384-fig3-v2"/></fig></sec><sec id="s2-5"><title>Simple branching morphology</title><p>Let us now study the effect of branching and breaking of rotational symmetry of the cell using the skCSD method. We consider here a simple <inline-formula><mml:math id="inf38"><mml:mi>Y</mml:mi></mml:math></inline-formula>-shaped model neuron with one branching point (<xref ref-type="fig" rid="fig4">Figure 4B</xref>). We place two synapses, one on each branch (at segments 33 and 62, close to the branching point, see <xref ref-type="fig" rid="fig4">Figure 4D</xref>¬†and <xref ref-type="fig" rid="fig5">Figure 5C</xref>). We consider both simultaneous and independent activation of these synapses, specifically, the first synapse was activated at 5, 45, 60 ms of the 70 ms long simulation, while the other was stimulated at 5, 25, 60 ms from the stimulation onset. Our goals were to determine if it was possible to separate the synaptic inputs located on two different branches, what happens at the branching point, how the arrangement of the electrodes-cell setup influences the reconstruction. We also wanted to determine if this method provides more detail about the current distribution on the cell than what is accessible from the interpolated potential and the CSD reconstructed with kCSD under the assumption of a smooth distribution of sources in space, which is the natural approach to try (<xref ref-type="bibr" rid="bib16">Frey et al., 2009</xref>).</p><fig id="fig4" position="float"><object-id pub-id-type="doi">10.7554/eLife.29384.005</object-id><label>Figure 4.</label><caption><title>Neuron morphologies used for simulation of ground truth data.</title><p>(<bold>A</bold>) Ball-and-stick neuron. (<bold>B</bold>) Y-shaped neuron. (<bold>C</bold>) Ganglion cell.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-29384-fig4-v2"/></fig><fig id="fig5" position="float"><object-id pub-id-type="doi">10.7554/eLife.29384.006</object-id><label>Figure 5.</label><caption><title>Reconstruction of synaptic inputs on a Y-shaped neuron with a regular rectangular 4 √ó 16 electrode grid.</title><p>Each panel (<bold>A‚ÄìC</bold>) shows the spline-interpolated extracellular potential (V), followed by standard kCSD reconstruction, both at the plane of the 4 √ó 16 electrodes‚Äô grid used for simulated measurement. Then, the ground truth and skCSD reconstruction are shown in the branching morphology representation in the plane containing the cell morphology. Each figure shows superimposed morphology of the cell. Note that in panel A the grid is parallel to the cell, while in panels (<bold>B‚ÄìC</bold>) it is perpendicular. The dark gray shapes are guides for the eye and are sums of circles placed along the morphology with radius proportional to the amplitude of the sources at the center of the circle. (<bold>A</bold>) Shows results for a synaptic input depolarizing one branch. (<bold>B</bold>) Shows the same current distribution as in the previous setup, but the grid is rotated by 90 degrees. (<bold>C</bold>) A synaptic input is added to the other branch. Observe that in all three cases, the interpolated potential and the standard CSD reconstruction, which can be drawn only in the plane of the electrodes‚Äô grid, do not differ significantly, hence they cannot distinguish between these three situations. On the other hand, skCSD method is able to identify correctly both synaptic inputs.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-29384-fig5-v2"/></fig></sec><sec id="s2-6"><title>Differentiation of synaptic inputs located on different branches</title><p>To investigate the differentiation power of the proposed approach, we consider two placements of the cell with respect to the electrode grid. Plane <inline-formula><mml:math id="inf39"><mml:mrow><mml:mi>x</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>y</mml:mi></mml:mrow></mml:math></inline-formula>, in which the cell is placed in parallel to the plane of electrodes 50¬†Œºm above (<xref ref-type="fig" rid="fig5">Figure 5A</xref>), and plane <inline-formula><mml:math id="inf40"><mml:mrow><mml:mi>x</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>z</mml:mi></mml:mrow></mml:math></inline-formula>, where the cell is perpendicular to the grid, with the grid 50¬†<inline-formula><mml:math id="inf41"><mml:mrow><mml:mi>Œº</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:math></inline-formula> away from the dendritic shaft stemming from the soma, (<xref ref-type="fig" rid="fig5">Figure 5B,C</xref>). In <xref ref-type="fig" rid="fig5">Figure 5</xref>, each panel (A‚ÄìC) shows the spline-interpolated extracellular potential (V), followed by standard kCSD reconstruction, both at the plane of the 4 √ó 16 electrode grid used for simulated measurement. Then, the ground truth and skCSD reconstruction are shown in the branching morphology representation in the plane containing the cell morphology. Each figure is superimposed with the morphology of the cell. The dark gray shapes are guides for the eye and are sums of circles placed along the morphology with a radius proportional to the amplitude of the sources located at the center of the circle. Panel A shows results for a synaptic input depolarizing one branch. Panel B shows the same current distribution as in the previous setup, but the cell is rotated by 90 degrees with respect to the grid. In panel C synaptic input is added to the other branch. Observe that in all three cases the interpolated potential and the standard CSD reconstruction, which can be drawn only in the plane of the electrode grid, do not differ significantly, hence they cannot distinguish between these three situations. On the other hand, the skCSD method correctly identified the synaptic inputs in all three cases.</p><p>Note that without the method proposed here, the most natural approach to analyze current sources is through use of the regular, population CSD. This approach was used, for example, to investigate the changing distribution of current sources during action potential generation using data from a high-definition MEA (<xref ref-type="bibr" rid="bib16">Frey et al., 2009</xref>). What we show in figures here and below, is that while CSD (kCSD) and skCSD are consistent, using the additional information about morphology renders significantly more detail about the activity studied.</p></sec><sec id="s2-7"><title>The effect of electrode placement on skCSD reconstruction for Y-shaped cell</title><p>In <xref ref-type="fig" rid="fig6">Figure 6</xref>, we show how the number and specific distribution of the electrodes affect the quality of the reconstruction in the case of simultaneous stimulation. Panel 5. A shows the ground truth data, that is the actual distribution of the transmembrane current sources, along the morphology. To visualize it simply, we used the interval representation, the soma is shown first, followed by one branch, followed by the other. <xref ref-type="fig" rid="fig6">Figure 6B</xref> shows the reconstruction results for regularly arranged 8 (4 √ó 2), 16 (4 √ó 4), 32 (4 √ó 8), and 64 (4 √ó 16) electrodes. In <xref ref-type="fig" rid="fig6">Figure 6C</xref>, we show reconstructions for five different random placements of the same number of electrodes as for the regular case. As expected, the skCSD method is able to recover the synaptic activations and the reconstruction resolution increases with the number of electrodes. Note that in certain cases, the random distribution is more efficient than the regular grid, which is probably due to more fortunate samplings of the area covered by the morphology.</p><fig id="fig6" position="float"><object-id pub-id-type="doi">10.7554/eLife.29384.007</object-id><label>Figure 6.</label><caption><title>Reconstruction of synaptic inputs placed on different branches of the Y-shaped neuron for electrodes arranged regularly and randomly within the same area.</title><p>We use the interval representation for visualization. The numbers on horizontal axis enumerate different electrode setups. The black profiles show the averaged membrane current as reconstructed in a given case; for random electrode distribution these are averages over five different realizations. (<bold>A</bold>) Ground truth membrane currents, the strong red indicates the synaptic inputs. (<bold>B</bold>) Reconstruction results for 8 (4 √ó 2), 16 (4 √ó 4), 32 (4 √ó 8), and 64 (4 √ó 16) electrodes arranged regularly. The skCSD reconstruction improves with the number of electrodes as the color representation and the black profiles indicate. (<bold>C</bold>) When distributing the same numbers of electrodes on the same plane as in the previous case, the quality of the average skCSD reconstruction, as indicated by the black profiles, is similar.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-29384-fig6-v2"/></fig></sec><sec id="s2-8"><title>The effect of basis on skCSD reconstruction for the Y-shaped cell</title><p>To investigate reconstruction quality in the parameter space set by the number of basis functions (<inline-formula><mml:math id="inf42"><mml:mi>M</mml:mi></mml:math></inline-formula>), basis function width (<inline-formula><mml:math id="inf43"><mml:mi>R</mml:mi></mml:math></inline-formula>) and regularization parameter (<inline-formula><mml:math id="inf44"><mml:mi>Œª</mml:mi></mml:math></inline-formula>), we used the simulation setup for the Y-shaped morphology with 4 √ó 4 electrodes. <xref ref-type="fig" rid="fig7">Figure 7</xref> shows the L1 reconstruction error for <inline-formula><mml:math id="inf45"><mml:mrow><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mn>32</mml:mn><mml:mo>,</mml:mo><mml:mn>128</mml:mn><mml:mo>,</mml:mo><mml:mn>512</mml:mn><mml:mo>,</mml:mo><mml:mn>1024</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="inf46"><mml:mrow><mml:mi>R</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mn>8</mml:mn><mml:mo>,</mml:mo><mml:mn>16</mml:mn><mml:mo>,</mml:mo><mml:mn>32</mml:mn><mml:mo>,</mml:mo><mml:mn>64</mml:mn><mml:mo>,</mml:mo><mml:mn>128</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="inf47"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>Œª</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mo>‚àí</mml:mo><mml:mn>5</mml:mn></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mo>‚àí</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mo>‚àí</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mo>‚àí</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mn>10</mml:mn><mml:mrow><mml:mo>‚àí</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mstyle></mml:math></inline-formula>. As we can see, for the smallest basis (<inline-formula><mml:math id="inf48"><mml:mrow><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mn>32</mml:mn></mml:mrow></mml:math></inline-formula>) and small <inline-formula><mml:math id="inf49"><mml:mi>Œª</mml:mi></mml:math></inline-formula>, the minimum error is obtained for wide basis sources, so that the basis functions have substantial overlap. This is necessary for the method to be able to reconstruct the family of test sources we considered. As the basis size increases, the reconstruction improves overall with minimum error obtained for narrow basis sources and small <inline-formula><mml:math id="inf50"><mml:mi>Œª</mml:mi></mml:math></inline-formula>. The fact that we have two comparable minima for <inline-formula><mml:math id="inf51"><mml:mrow><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mn>32</mml:mn></mml:mrow></mml:math></inline-formula>, for small and large <inline-formula><mml:math id="inf52"><mml:mi>Œª</mml:mi></mml:math></inline-formula> (top and bottom right of the plot for <inline-formula><mml:math id="inf53"><mml:mrow><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mn>32</mml:mn></mml:mrow></mml:math></inline-formula>), means that the error we obtain by emphasizing the measurements (small <inline-formula><mml:math id="inf54"><mml:mi>Œª</mml:mi></mml:math></inline-formula>) is comparable to the error we obtain by emphasizing the regularization term, which prevents over-fitting (large <inline-formula><mml:math id="inf55"><mml:mi>Œª</mml:mi></mml:math></inline-formula>) and in effect, reflects our doubt about precision of measurement. We interpret it here as the effect of insufficient basis size. This effect disappears with increasing basis size when a unique minimum appears for moderate values of <inline-formula><mml:math id="inf56"><mml:mi>Œª</mml:mi></mml:math></inline-formula> and for narrow basis sources, which can best resolve small details of the CSD to be reconstructed.</p><fig id="fig7" position="float"><object-id pub-id-type="doi">10.7554/eLife.29384.008</object-id><label>Figure 7.</label><caption><title>The effects of basis properties on reconstruction quality.</title><p>We used the Y-shaped morphology and the 4 √ó 4 electrode setup to investigate the effect of using various basis numbers for the reconstruction. L1 error was calculated to compare the results for basis with <inline-formula><mml:math id="inf57"><mml:mrow><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mn>32</mml:mn><mml:mo>,</mml:mo><mml:mn>128</mml:mn><mml:mo>,</mml:mo><mml:mn>512</mml:mn><mml:mo>,</mml:mo><mml:mn>1024</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula> elements, for several values of basis width <inline-formula><mml:math id="inf58"><mml:mi>R</mml:mi></mml:math></inline-formula> and <inline-formula><mml:math id="inf59"><mml:mi>Œª</mml:mi></mml:math></inline-formula>. With few basis sources one cannot recover CSD properly. As the number of basis functions increases, the reconstruction error is minimized for moderate values of <inline-formula><mml:math id="inf60"><mml:mi>Œª</mml:mi></mml:math></inline-formula> and for narrow basis sources, which can best resolve small details of the CSD to be reconstructed.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-29384-fig7-v2"/></fig></sec><sec id="s2-9"><title>Reconstruction of current distribution on complex morphology</title><p>In this section, we consider the performance of the skCSD method in the case of a complicated, biologically realistic scenario. To achieve good spatial resolution, permitting detailed study of a cell with substantial extent, densely packed electrode arrays are required. In the present reconstruction we assumed a hexagonal grid arrangement with 17.5 Œºm inter-electrode distance inspired by recent experiments on reconstructing axonal action potential propagation (<xref ref-type="bibr" rid="bib2">Bakkum et al., 2013</xref>; <xref ref-type="bibr" rid="bib16">Frey et al., 2009</xref>). We assumed a grid consisting of 936 contacts from which we used 128 for reconstruction to be consistent with the hardware of (<xref ref-type="bibr" rid="bib2">Bakkum et al., 2013</xref>; <xref ref-type="bibr" rid="bib16">Frey et al., 2009</xref>).</p><p>In the simulation we assumed an experimentally plausible scenario, where oscillatory current was injected to the soma of a neuron in a slice with other inputs impinging through a 100 excitatory synapses distributed on the dendritic tree. The simulated data consisted of two parts. During the first 400 ms, the cell was stimulated by the injected current as well as through the synapses. The amplitude of the injected current was 3.6 nA, the frequency of the current drive was around 6.5 Hz. During the second 400 ms the cell was stimulated only with the current. <xref ref-type="fig" rid="fig8">Figure 8</xref> shows an example of the skCSD reconstruction at a time selected right after a spike was elicited by the cell. As we can see, neither the standard CSD reconstruction assuming smooth current distribution in space, nor the interpolated potential, give justice to the actual current distribution. At the same time, the skCSD reconstruction is quite a faithful reproduction of the ground truth. A movie comparing the ground truth with kCSD, interpolated potential, and skCSD reconstruction, in time, is provided as a supplementary material (<xref ref-type="video" rid="video1">Video 1</xref>).</p><fig id="fig8" position="float"><object-id pub-id-type="doi">10.7554/eLife.29384.009</object-id><label>Figure 8.</label><caption><title>skCSD reconstruction of dendritic backpropagation patterns for a retinal ganglion cell model driven with oscillatory current.</title><p>(<bold>A</bold>) Somatic membrane potential during the simulation. The red line marks the time instant for which the remaining plots were made. (<bold>B</bold>) Extracellular potential interpolated between the simulated measurements computed at the electrodes, which are marked with asterisks. (<bold>C</bold>) kCSD reconstruction computed from the simulated measurements of the potential. (<bold>D</bold>) Spatial smoothing with a Gaussian kernel was applied to the ground truth membrane current to facilitate comparison with the skCSD reconstruction with the same spatial resolution level. (<bold>E</bold>) skCSD reconstruction computed from the simulated measurements of the potential.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-29384-fig8-v2"/></fig><media id="video1" mime-subtype="mp4" mimetype="video" xlink:href="elife-29384-video1.mp4"><object-id pub-id-type="doi">10.7554/eLife.29384.010</object-id><label>Video 1.</label><caption><title>skCSD reconstruction of current source density distribution on the ganglion cell.</title><p>The video shows the skCSD reconstruction for the retinal ganglion cell model driven with oscillatory current (Section <italic>Reconstruction of current distribution on complex morphology</italic>) for the whole duration of simulation. Figure 7 shows a snapshot taken at <inline-formula><mml:math id="inf61"><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>495.25</mml:mn></mml:mrow></mml:math></inline-formula> ms from the simulation onset. During the first 400 ms of simulation, apart from somatic drive, 100 excitatory synaptic inputs were randomly distributed along the dendrites. For reconstruction, 128 virtual electrodes were selected from the 936 arranged in a hexagonal grid of 17.5 Œºm interelectrode distance to record the extracellular potentials. Panel A presents the somatic membrane potential during the simulation. The red line marks the time instant for which the remaining plots were made. The colormap on Panel B shows the extracellular potential interpolated between the simulated measurements computed at the electrodes, which are marked with asterisks. The regular CSD is shown on Panel C, while the spatially smoothed ground truth membrane current is presented on Panel D. Panel E shows the skCSD reconstruction of current source density along the cell morphology from the selected measurements. The dark gray shapes are guides for the eye and are sums of circles placed along the morphology with radius proportional to the amplitude of the sources at the center of the circle.</p></caption></media></sec><sec id="s2-10"><title>Dependence of reconstruction on noise level</title><p>So far, we have assumed that the data are noise-free which is never true in an experiment. Both the measurement device and the neural tissue are potential sources of distorted data. To investigate how the performance of the method is influenced by noise, we added Gaussian white noise of differing amplitudes to the simulated extracellular recordings of Y-shaped cell described above. <xref ref-type="fig" rid="fig9">Figure 9A</xref> shows the smoothed ground truth we used. The Y-shaped neuron is placed on top of a MEA with a regular grid of 4 √ó 8 electrodes marked by asterisks. <xref ref-type="fig" rid="fig9">Figure 9B</xref> shows the noise-free reconstruction. Panel C‚ÄìF of the figure show the reconstruction results for increasing measurement noise with signal to noise ratio, SNR<inline-formula><mml:math id="inf62"><mml:mrow><mml:mi/><mml:mo>=</mml:mo><mml:mrow><mml:mn>16</mml:mn><mml:mo>,</mml:mo><mml:mn>4</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula>. The signal-to-noise ratio (SNR) here is the standard deviation of the simulated extracellular potentials normalized with the std of the added noise. The degradation of reconstruction visible in this figures is summarized in <xref ref-type="fig" rid="fig9">Figure 9C</xref>. As can be seen in the reconstruction plots (<xref ref-type="fig" rid="fig9">Figure 9D‚ÄìF</xref>), the increasing noise actually does not seem to significantly alter the obtained reconstructions so the regularization is providing adequate correction, except for the noise on the order of signal (<xref ref-type="fig" rid="fig9">Figure 9F</xref>).</p><fig id="fig9" position="float"><object-id pub-id-type="doi">10.7554/eLife.29384.011</object-id><label>Figure 9.</label><caption><title>The effect of noise on the reconstruction.</title><p>The corrupting influence of noise on the skCSD reconstruction is shown with the example of simultaneous excitation of both branches of the Y-shaped cell close to the branching point in case of the 4 √ó 8 electrodes setup. (<bold>A</bold>) Smoothed ground truth CSD shown on the branching morphology used. (<bold>B,D,E,F</bold>) skCSD reconstructions in cases of no added noise and signal-to-noise ratio equal to 16, 4, 1, respectively. Even the highest noise considered does not fully disrupt the reconstructed source distribution, although increasing the noise systematically degrades the result. This is shown in C, where the L1 error of the reconstruction was calculated for the full length of the simulations. This is consistent for different electrode setups which are marked with various colors. While the setups consisting of more electrodes perform better for low noise, the reconstruction seems to be more sensitive to noise in these cases. This might be a side effect of a specific definition of error.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-29384-fig9-v2"/></fig></sec><sec id="s2-11"><title>Dependence of reconstruction on the number and arrangement of recording electrodes</title><p>Reconstruction of the distribution of the current sources along the morphology with skCSD (just like the reconstructions of smooth population distributions with kCSD) formally can be attempted from an arbitrary set of recordings, even a single electrode. While we do not expect enlightening results at this extreme, it is natural to ask the following questions: (1) to what extent can we trust the reconstruction in a given case, (2) which of the reconstructed features are real and which are artifacts of the method, and (3) how can the optimal parameters be selected for this method. We will return to these issues in the Discussion. Here, we wish to investigate how the number of electrodes, the density of the grid, and the area covered by the MEA, affect the results.</p><p>To answer these questions, we selected a snapshot of simulation of the model of the ganglion cell described in the Materials and methods section, with the specific membrane current distribution shown in <xref ref-type="fig" rid="fig10">Figure 10A</xref>. In <xref ref-type="fig" rid="fig10">Figure 10B‚ÄìH</xref>. we show seven different reconstructions assuming different experimental setups, with differing numbers of electrodes, covering different area.</p><fig id="fig10" position="float"><object-id pub-id-type="doi">10.7554/eLife.29384.012</object-id><label>Figure 10.</label><caption><title>Dependence of skCSD reconstruction on multielectrode setup.</title><p>Figures (<bold>A‚ÄìH</bold>) show morphology used in the simulation together with the distribution of current sources in branching morphology representation taken at 247.5 ms of the simulation. Figures (<bold>B‚ÄìH</bold>) show additionally the electrode setup assumed. (<bold>A</bold>) Smoothed ground truth CSD. (<bold>B</bold>) Reconstructed sources for a setup of 5 √ó 5 electrodes with 50 Œºm interelectrode distance (IED) covering a small part of the cell morphology around the soma. (<bold>C</bold>) Reconstructed sources for a setup of 5 √ó 5 electrodes with 100 Œºm IED covering a substantial part of the dendritic tree, which improves the reconstruction of the synaptic input on the left. (<bold>D</bold>) Reconstructed sources for 5 √ó 5 setup with 200 Œºm IED setup; both sinks in the membrane currents are visible. (<bold>E</bold>) Expanding the 5 √ó 5 electrode setup to 400 Œºm IED leads to a small number of electrodes placed in the vicinity of the cell which leads to a poor reconstruction. (<bold>F</bold>) Increasing the number of electrodes to 9 √ó 9 while keeping the coverage, which leads to 200 Œºm IED, does not improve the reconstruction. (<bold>G</bold>) Reducing IED in the previous example to 100 Œºm, which reduces the coverage of the MEA to the whole cell (same area as in panel D) bringing majority of the electrodes close to one of the dendrites, leads to one of the most faithful reconstructions among the ones shown in this figure. (<bold>H</bold>) Shows results for a matrix of 21 √ó 21 contacts with 40 Œºm IED, covering the same area as in examples D and G. The results are very good but the improvement in reconstruction does not justify the use of so many contacts with so high density. (<bold>I</bold>) Comparison of reconstruction errors for all the cases shown. Left axis: L1 error for the training (L1‚ÄìT) and validation (L1‚ÄìV) part . Right axis: crossvalidation error (CV). The L1-T error is marked with black points, L1-V error is represented by green stars. Generally, the L1-V errors are a bit higher than the L1-T errors but show a similar tendency. Also the CV errors, which are drawn with red crosses, show a similar tendency. The reconstructions in panels (<bold>B‚ÄìH</bold>) are for parameters determined with the L1-T error.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-29384-fig10-v2"/></fig><p>In each case, we selected the width of basis functions and the regularization parameter for the method by minimizing the L1 error calculated for the first 1000 time steps of the simulation or cross-validation error (L1-T and CV in <xref ref-type="fig" rid="fig10">Figure 10I</xref>). To verify the quality of reconstruction we computed the L1 error between the ground truth and reconstruction for the remaining 5800 time steps of the simulation. We found that minimization of L1 error gave better results and L1-V in <xref ref-type="fig" rid="fig10">Figure 10I</xref> shows the results for this case; however, the results obtained with minimization of CV error were often not much worse (not shown).</p><p>Given that L1 error can only be used where the ground truth is known, which is in simulations, we propose the following. Given the data necessary for application of the skCSD method, (neuronal morphology, positions of electrode contacts, and recorded signals) different CSD distributions should be assumed for the obtained morphology, reconstructions obtained for a range of parameters, then the L1 error could be used for optimization. Note that it is not necessary to actually simulate a model of the cell with proper membrane biophysics, which often is not known, although it might lead to more physiological test sources. It is sufficient to distribute the different sources along the morphology without making any assumptions concerning the biophysical properties of the neuronal membrane.</p><p>Once the parameters are obtained with this procedure, perform the analysis of actual experimental data with the obtained parameters. Performing the simulations and comparing the best reconstructions with the assumed ground truth has the further benefit of building intuition about which features of the real CSD survive in the reconstruction and which are distorted. This is another example of model-based data analysis which we believe becomes inevitable with the growing complexity of experimental paradigms, such as the one considered here.</p><p>We feel that the above procedure is optimal, since it not only gives optimal parameters, but also allows one to investigate which features are recovered and which are misformed. However, if only parameters for estimation are needed, CV error could be used, which is simpler and the results are often comparable.</p><p>The results obtained in this study are consistent with our expectations: the quality of reconstruction improves with the coverage of the morphology by the electrodes, with increasing density of probing, and with increasing number of probes (<xref ref-type="fig" rid="fig10">Figure 10I</xref>). Interestingly, it seems, that it is difficult to improve the reconstruction beyond a certain level, in consequence, the setups with moderate densities (on the order of 200 Œºm IED) can easily compete with setups at the edge of current developments (40 Œºm IED, [(<xref ref-type="bibr" rid="bib3">Berdondini et al., 2005</xref>). We believe that¬†this is not a hard limit and that better results can be obtained here. This, however, requires further development of the methods.</p></sec><sec id="s2-12"><title>Proof-of-concept experiment: spatial current source distribution of spike-triggered averages</title><p>To examine the experimental feasibility of the skCSD method, we analyzed data from a patch clamp electrode and a linear probe with 14 working electrodes recording signals simultaneously from a hippocampal pyramidal cell in an in vitro slice preparation (see Materials and methods). As there is no ground truth data available in this case, the optimal width of the basis functions and the regularization parameter were selected using the L1 error and simulated data. To do this, we used the same simulation protocol as for the ganglion cell model. A snapshot of the reconstruction is shown in <xref ref-type="fig" rid="fig11">Figure 11</xref> at the moment of firing. A 10 ms long video of the spike triggered average is shown in the supplementary materials (<xref ref-type="video" rid="video2">Video 2</xref>). At ‚àí0.05 ms the brief appearance of a sink (red) in the basal dendrites is visible which can be a consequence of the activation of voltage sensitive channels in the axon hillock, or the first axonal segment leading to the firing of the cell. Since there were no electrodes close to the axon initial segment, the skCSD method did not resolve it, instead it resolved to introduce the activity into the basal dendrite. This phenomenon is quickly replaced by a sink at the soma and in the proximal part of the apical dendritic tree, accompanied by sources (blue) in the basal and in the more distal apical dendrites. The extracellular potential on the second electrode reaches its minimum at 0.45 ms, which signals the peak of the spike. The deep red of the soma at this point signifies a strong sink, while the blue of the surrounding parts of the proximal apical and basal dendrites indicate the current sources set by the return currents. At 1.30 ms a source appears at the soma region, which indicates hyperpolarizing currents. Overall, the observed spatio-temporal CSD dynamics is dominated mostly by the somatic currents, responsible for the spike generation, and the corresponding counter currents. This example demonstrates the experimental feasibility of the skCSD method and may help in planning further experiments, aiming to reveal the spatial distribution and temporal dynamics of the synaptic input currents which evoke the firing of the neuron.</p><fig id="fig11" position="float"><object-id pub-id-type="doi">10.7554/eLife.29384.013</object-id><label>Figure 11.</label><caption><title>skCSD reconstruction of spike-triggered average for a hippocampal pyramidal cell (<bold>A</bold>) Extracellular potentials measured with the five electrodes closest to the soma.</title><p>The 0 s marks the time of the membrane potential crossing the 0 mV threshold. The black vertical line marks the 0.40 ms time instant for which the extracellular potentials and skCSD reconstruction are shown. (<bold>B</bold>) Two-dimensional projection of the cell morphology and extracellular electrodes‚Äô positions marked by stars, the five electrodes used in the top panel of the figure are labeled with matching colors. The amplitudes of the measured potentials are shown as color-coded circles around the electrodes. (<bold>C</bold>) The skCSD reconstruction on the branching morphology representation. This is a snapshot of the cell firing, the red color indicates the sinks close to the soma, the blue marks the current sources on the dendrites.</p></caption><graphic mime-subtype="x-tiff" mimetype="image" xlink:href="elife-29384-fig11-v2"/></fig><media id="video2" mime-subtype="mp4" mimetype="video" xlink:href="elife-29384-video2.mp4"><object-id pub-id-type="doi">10.7554/eLife.29384.014</object-id><label>Video 2.</label><caption><title>Spike triggered average of pyramidal cell in vitro.</title><p>The video shows the recorded potentials and skCSD reconstruction for a 10 ms time window centered around the spike as described in Section <italic>Proof-of-Concept experiment: Spatial Current Source Distribution of Spike-triggered Averages</italic>. The top panel presents the spike triggered averages of the potentials during 5 s before and after the spike recorded at five electrodes closest to the soma. The lower left panel shows the morphology of the cell, electrode positions, and the recorded potentials. The electrodes are marked by stars and the amplitude of the recorded potential is shown as color-coded circles around the electrodes. The snapshot is taken at the time given in the figure title and indicated by the black vertical line in the top panel. The reconstructed skCSD distribution at the same moment is shown in the lower right panel. At -0.05 ms a sink appears at the basal dendrites. This can be a consequence of the activation of voltage-sensitive channels in the axon hillock or the first axonal segment leading to the firing of the cell. Since there were no electrodes close to the axon initial segment, the skCSD method did not resolve it, instead it resolved to introduce the activity into the basal dendrite. This phenomenon is quickly replaced by a sink at the soma and in the proximal part of the apical dendritic tree, accompanied by sources (blue) in the basal and in the more distal apical dendrites. The extracellular potential on the second electrode reaches its minimum at 0.45 ms, which signals the peak of the spike. The deep red of the soma at this point signifies a strong sink, while the blue of the surrounding parts of the proximal apical and basal dendrites indicates the current sources set by the return currents. At 1.30 ms a source appears at the soma region, which indicates hyperpolarizing currents.</p></caption></media></sec></sec><sec id="s3" sec-type="discussion"><title>Discussion</title><sec id="s3-1"><title>Summary</title><p>In this work, we introduced a method to estimate the distribution of current sources (CSD) along the dendritic tree of a neuron given its known morphology and a set of simultaneous extracellular recordings of potential generated predominantly by this cell. First, assuming the ball-and-stick neuron model and a laminar probe parallel to the cell, we studied the basic viability of this method. We showed that introducing more electrodes to cover the same area leads to increased spatial resolution of the method allowing reconstruction of higher Fourier modes of the CSD generating the measured potentials (<xref ref-type="fig" rid="fig2">Figure 2</xref>). In a dynamic scenario of multiple synaptic inputs impinging on the cell, higher density of probes leads to higher reconstruction precision allowing us to distinguish individual inputs (<xref ref-type="fig" rid="fig3">Figure 3</xref>). Testing the reconstruction against the known CSD (the ground truth) shows a clear transition from poor to faithful reconstruction when the electrode distribution becomes dense enough to capture the fine detail of the CSD profile to be reconstructed (<xref ref-type="fig" rid="fig2">Figure 2</xref>.E). We also applied this method to more complex neuron morphologies, namely the Y-shape and ganglion cell. As expected, the reconstructed CSD profiles became more detailed with increasing electrode number over a fixed area (<xref ref-type="fig" rid="fig6">Figures 6</xref>,<xref ref-type="fig" rid="fig10">10</xref>).</p><p>Using the Y-shaped morphology we showed that (i) synaptic inputs activating different dendrites can be separated, <xref ref-type="fig" rid="fig5">Figure 5</xref>; (ii) skCSD provides meaningful information about the membrane CSD in cases, when the interpolated LFP and standard, population CSD analyses, are not informative, <xref ref-type="fig" rid="fig5">Figure 5</xref>; (iii) the reconstruction is not sensitive to a specific selection of electrode placement, <xref ref-type="fig" rid="fig6">Figures 6</xref>,<xref ref-type="fig" rid="fig9">9</xref>; and (iv) even significant additive noise (SNR¬†=¬†1) is not prohibitive for the reconstruction, <xref ref-type="fig" rid="fig9">Figure 9</xref>.</p><p>Biologically, the most relevant example we considered was a ganglion cell model which we studied with virtual multi-electrode arrays of different designs. The MEAs we considered differed with inter-electrode distances for the simulated setups, as well as in the area they covered, ranging from an area close to the soma to roughly four times the size of the smallest square covering the whole morphology. The best results were obtained when we used the electrodes from the region which closely covered the cell (9.G and H); a reduction of inter-electrode distance from 100¬†Œºm to 40¬†Œºm yielded less impressive results than selecting the electrodes from the smallest square covering the morphology. Our study, assumed realistic cell morphology of the ganglion cell and commercially available MEA designs, as well as realistic cell activity, showed that it is feasible to reconstruct the distribution of the current sources in realistic, noisy situations.</p><p>The skCSD method performed adequately for the proof-of-concept experimental data, even if the nature of the experiment allowed only the reconstruction of the general features of the spike-triggered average spatio-temporal current source density distribution patterns.</p><p>While the traditional (population) CSD method was used to analyze membrane currents of single cells before (<xref ref-type="bibr" rid="bib6">Buzs√°ki and Kandel, 1998</xref>; <xref ref-type="bibr" rid="bib4">Bereshpolova et al., 2007</xref>; <xref ref-type="bibr" rid="bib16">Frey et al., 2009</xref>), the first CSD method specific for investigating membrane currents on single cells was proposed by (<xref ref-type="bibr" rid="bib52">Somogyv√°ri et al., 2005</xref>). However, it assumed simplified, linear neuron morphologies. An important preprocessing step proposed there was separating the single neuron‚Äôs contributions to the extracellular potentials from the background activity. The novelty of the skCSD method proposed here is in its use of actual neuronal morphologies and in the underlying algorithmic solutions based on the kCSD method (<xref ref-type="bibr" rid="bib47">Potworowski et al., 2012</xref>) which were initially used in the study of populations of neurons.</p></sec><sec id="s3-2"><title>General comments</title><p>Observe that skCSD, like any other data analysis method, is not a magic wand. Technically, it can be applied to data coming from a single electrode just like the age profile of a human population can be estimated from a single specimen. Obviously, in both cases, the estimate would be a poor reflection of the distribution of interest. As we improve the sampling, the quality of the estimate improves, yet ultimately it is hard to judge a priori how many electrodes is enough and if our results obtain the required level of precision. We see two approaches to address this type of questions. One is through simulations, as we discussed. The other is analysis of the singular vectors arising in the decomposition of the matrix translating the measured potentials into the estimated CSD (<xref ref-type="bibr" rid="bib21">Hansen, 2010</xref>); however, the necessary tools for kCSD and skCSD are still under development. We plan to investigate this further in the future.</p><p>Having obtained the distribution of currents it would be interesting to decompose it into physiologically meaningful components, such as synaptic currents, leak currents, voltage-gated currents for different channels, etc. This seems rather challenging and we do not see a direct way of achieving this from experimental data. It is possible that an application of statistical decomposition methods will prove useful, as in the case of kCSD for population activity (<xref ref-type="bibr" rid="bib29">≈Åƒôski et al., 2010</xref>; <xref ref-type="bibr" rid="bib18">G≈ÇƒÖbska et al., 2014</xref>). However, we find the contributions to the extracellular potential from individual currents highly counter-intuitive (<xref ref-type="bibr" rid="bib17">G≈ÇƒÖbska et al., 2017</xref>).</p></sec><sec id="s3-3"><title>Experimental recommendations</title><p>To attempt experimental application of skCSD we must have (1) an identified cell of known morphology, and (2) a set of simultaneous extracellular recordings of electric potential generated by this cell. Each aspect poses its challenges, some of which have been addressed here. Once we have the necessary data the natural question is how to select the parameters of the method in the specific context of a given setup, specific morphology, and recordings. Our investigations above give some indications. First, the electrodes selected for analysis should essentially uniformly cover the area spanned by the cell. This is illustrated in <xref ref-type="fig" rid="fig6">Figure 6</xref>, which shows that some degree of irregularity does not significantly affect the reconstruction. Secondly, the basis should be selected so that the basis sources could resolve the features on the membrane we are interested in (narrow basis functions) with sufficient multiplicity, that smooth coverage of the cell can be ensured (see <xref ref-type="fig" rid="fig7">Figure 7</xref>).</p><p>Clearly, as the irregularity of the setup grows we expect growing reconstruction errors. This can be studied with singular vectors of the operator transforming potential measurements into reconstructed sources,¬†<xref ref-type="disp-formula" rid="equ31">Equation 21</xref>, as discussed for¬†example by (<xref ref-type="bibr" rid="bib21">Hansen, 2010</xref>). We are convinced, however, that the most efficient approach to investigate the effects of these different parameters is through simulations. This is a natural place to apply the <italic>model-based validation of data analysis</italic> (<xref ref-type="bibr" rid="bib12">Denker et al., 2014</xref>). Our suggestion is to build a computational model of the cell. We believe that for the purpose of parameter selection assuming passive membrane in the dendrites should be sufficient, but of course, more realistic biophysical information may be included, especially if available. The model cell may be stimulated with synaptic input, with current injected, or even specific profiles of ground truth CSD may be placed along the cell. Then the extracellular potential must be computed at points where the actual electrodes are placed in the experiment. One can then investigate the effects of different parameter values on reconstruction and, for the analysis of actual experimental data, select those parameters minimizing prediction error on test data. The advantage of this procedure is two-fold. First, we end up with a selection of parameters adapted for the specific problem at hand. Secondly, we build intuition regarding the interpretation of the results for our specific cell and setup. This approach is the only way to address arbitrary electrode-cell configurations and to determine how much information we can extract in a given case.</p><p>We found that the best way to identify optimal parameters for reconstruction is by minimizing the L1 error between the reconstruction and the ground truth. Since we cannot have the ground truth in an experiment, but we can assume it in the model-based validation, this is another argument for the model-based validation approach. Obviously, to efficiently apply this technique, the appropriate computational tools must be available. We plan to develop and open framework facilitating such studies, meanwhile, the code used for the present study is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/csdori/skCSD">https://github.com/csdori/skCSD</ext-link> (<xref ref-type="bibr" rid="bib11">Cserp√°n, 2017</xref>;¬†copy archived at <ext-link ext-link-type="uri" xlink:href="https://github.com/elifesciences-publications">https://github.com/elifesciences-publications/skCSD</ext-link>).</p></sec><sec id="s3-4"><title>Challenges of recording extracellular potentials and obtaining the morphology from the same cell</title><p>Although recording extracellular potential with a MEA, filling a neuron with a dye, and reconstructing its morphology, are standard experimental techniques, using them simultaneously remains a challenge due to the size of the experimental devices which need to be arranged within a small volume. Cells in the vicinity of the MEA can be filled individually by intracellular or juxtacellular electrodes, or with bulk dying. Individual recording and dying with a glass electrode provides not only the morphology, but also unambiguous spike times, giving an opportunity to determine the extracellular potential fingerprint of the recorded cell on the MEA. Although these would be favorable data, intracellular recording less than¬†100¬†Œºm from the MEA is extremely challenging. Experimental setups featuring the necessary equipment already exist (<xref ref-type="bibr" rid="bib41">Neto et al., 2016</xref>), but as far as we know, have not been used in this way. On the other hand, bulk dying techniques result in more filled neurons, although the quality of the dying, and thus the quality of the 3D morphology reconstructions, is considerably lower in these cases. Although there are methods for estimation of the cell position relative to the MEA (<xref ref-type="bibr" rid="bib52">Somogyv√°ri et al., 2005</xref>, <xref ref-type="bibr" rid="bib51">Somogyv√°ri et al., 2012</xref>), association of multiple optically labeled neurons with the recorded extracellular spike patterns is still unsolved.</p></sec><sec id="s3-5"><title>Challenges of separating the activity of a single neuron from background</title><p>We propose two experimental scenarios one could apply to separate the activity of the studied neuron from the background. If we can sort the spikes elicited by the neuron of interest we can calculate the spike-triggered averages of the potentials reducing all uncorrelated contributions. Unfortunately, in live tissue, contributions from neighboring cells will have some correlations due to shared inputs. Separation of the contribution of the neuron of interest from the correlated background can be obtained in two ways. One is decomposition of the activity into meaningful components, for example, as shown by (<xref ref-type="bibr" rid="bib50">Somogyv√°ri et al., 2015</xref>), the high amplitude correlated oscillatory background of hippocampal theta activity can be extracted with independent component analysis, allowing the determination of cell-type-specific time course of the synaptic input. Alternatively one could consider combining skCSD with population kCSD analysis, that¬†is, consider basis sources covering the cell of interest as well as the space covering the whole population. This will be the subject of further study. The second experimental scenario to obtain the contributions to the extracellular potential from a specific cell is to drive the cell with intracellular current injection of known pattern, for example, with an oscillatory drive as we discussed (<xref ref-type="fig" rid="fig8">Figure 8</xref>), and by averaging over multiple periods (event-based triggering). Again, further study is needed to establish the validity of this type of experimental procedure.</p></sec><sec id="s3-6"><title>Challenges of using novel MEAs</title><p>Handling data from high-density MEAs with thousands of electrodes will require further studies, as the large numbers of small singular values of the kernel matrix may introduce numerical sensitivity to the reconstruction. Also, optimal selection of electrodes in case of programmable MEAs merits further investigations. We believe it is best to address such issues when actual experiments are attempted.</p></sec><sec id="s3-7"><title>Importance of this work</title><p>Traditional electrophysiology has focused on the electrical potential, which is relatively easy to access, from intracellular recordings, all kinds of patch clamp, juxtacellular, to extracellular and voltage-sensitive dyes (<xref ref-type="bibr" rid="bib10">Covey and Carter, 2015</xref>). While the relation of the actual measurement to the voltage at a point may significantly differ, often this is a reasonable interpretation, if needed, more realistic models of measurement can be considered, for example, averaging over the contact surface for extracellular electrodes, etc (<xref ref-type="bibr" rid="bib37">Moulin et al., 2008</xref>; <xref ref-type="bibr" rid="bib40">Ness et al., 2015</xref>).</p><p>Already in the middle of the¬†20th century, Walter H. Pitts observed that for recordings obtained with regular grids one can approximate the Poisson equation to estimate the distribution of current sources in the tissue (<xref ref-type="bibr" rid="bib46">Pitts, 1952</xref>). His approach assumed recordings on a regular 3D grid, which was challenging to obtain for some 60 years (<xref ref-type="bibr" rid="bib32">≈Åƒôski et al., 2007</xref>). However, with the work of Nicholson and Freeman (<xref ref-type="bibr" rid="bib42">Nicholson and Freeman, 1975</xref>) 1D CSD analysis became attractive, as summarized by Ulla Mitzdorf (<xref ref-type="bibr" rid="bib36">Mitzdorf, 1985</xref>). In 2012, we proposed how to overcome the restriction of regular grids with a kernel approach which both allows to use arbitrary distribution of contacts and corrects for noise (<xref ref-type="bibr" rid="bib47">Potworowski et al., 2012</xref>). All the previous work, however, always assumed the contributions to the extracellular potential coming from the whole tissue and smooth in the estimation region.</p><p>In the present work, we show for the first time how a collection of extracellular recordings in combination with a cell morphology can be used to estimate the current sources located on the cell contributing to the recorded potential. Since it is now feasible experimentally to obtain the relevant data, we believe that the method proposed here may find its uses to constrain the biophysical properties of the neuron membrane, facilitate verification of morphological reconstructions, as well as guide new discoveries by offering a more global picture of the distribution of the currents along the cell morphology, giving a coherent view of the global synaptic bombardment and return currents within a cell.</p></sec></sec><sec id="s4" sec-type="materials|methods"><title>Materials and methods</title><table-wrap id="keyresource" position="anchor"><label>Key resources table</label><table frame="hsides" rules="groups"><thead><tr><th>Reagent type (species) <break/>or resource</th><th>Designation</th><th>Source or reference</th><th>Identifiers</th><th>Additional information</th></tr></thead><tbody><tr><td>Strain, strain background (Wistar rat, male)</td><td>Male Wistar rat</td><td>PMID: 11619935</td><td/><td/></tr><tr><td>Biological sample (Wistar rat, male)</td><td>Hippocampal slice</td><td/><td/><td/></tr><tr><td>Chemical compound, drug</td><td>Biocytin</td><td>PMID: 17990268</td><td/><td/></tr><tr><td>Software, algorithm</td><td>Neurolucida Stereo Investigator</td><td>PMCID: PMC3332236</td><td>RRID:<ext-link ext-link-type="uri" xlink:href="https://scicrunch.org/resolver/SCR_001775">SCR_001775</ext-link></td><td/></tr><tr><td>Software, algorithm</td><td>RHD2000-Series Amplifier Evaluation System Intan Technologies, LLC</td><td>Intan Technologies,<ext-link ext-link-type="uri" xlink:href="http://intantech.com/aboutus.html">http://intantech.com/aboutus.html</ext-link></td><td/><td/></tr><tr><td>Software, algorithm</td><td>LFPy</td><td>doi: 10.3389/fninf.2013.00041</td><td>RRID:<ext-link ext-link-type="uri" xlink:href="https://scicrunch.org/resolver/SCR_014805">SCR_014805</ext-link></td><td/></tr><tr><td>Software, algorithm</td><td>NEURON</td><td><ext-link ext-link-type="uri" xlink:href="https://neuron.yale.edu/neuron/">https://neuron.yale.edu/neuron/</ext-link></td><td>RRID:<ext-link ext-link-type="uri" xlink:href="https://scicrunch.org/resolver/SCR_005393">SCR_005393</ext-link></td><td/></tr><tr><td>Software, algorithm</td><td>Python Programming Language</td><td><ext-link ext-link-type="uri" xlink:href="http://www.python.org">http://www.python.org</ext-link></td><td>RRID:<ext-link ext-link-type="uri" xlink:href="https://scicrunch.org/resolver/SCR_008394">SCR_008394</ext-link></td><td/></tr><tr><td>Software, algorithm</td><td>R Project for Statistical Computing</td><td><ext-link ext-link-type="uri" xlink:href="https://www.r-project.org/">https://www.r-project.org/</ext-link></td><td>RRID:<ext-link ext-link-type="uri" xlink:href="https://scicrunch.org/resolver/SCR_001905">SCR_001905</ext-link></td><td/></tr><tr><td>Software, algorithm</td><td>NeuroMorpho.Org</td><td>PMCID: PMC2655120, <ext-link ext-link-type="uri" xlink:href="http://neuromorpho.org/">http://neuromorpho.org/</ext-link></td><td>RRID:<ext-link ext-link-type="uri" xlink:href="https://scicrunch.org/resolver/SCR_002145">SCR_002145</ext-link></td><td/></tr><tr><td>Software, algorithm</td><td>Kernel Current Source Density Python library</td><td>PMID: 22091662</td><td>RRID:<ext-link ext-link-type="uri" xlink:href="https://scicrunch.org/resolver/SCR_015777">SCR_015777</ext-link></td><td/></tr><tr><td>Software, algorithm</td><td>skCSD method</td><td>this paper, <ext-link ext-link-type="uri" xlink:href="https://github.com/csdori/skCSD">https://github.com/csdori/skCSD</ext-link></td><td/><td>A tool for estimating transmembrane currents along the dendritic tree of a neuron from extracellular recordings</td></tr><tr><td>Other</td><td>Ganglion cell morphology</td><td>PMID: 20826176, <ext-link ext-link-type="uri" xlink:href="http://neuromorpho.org/neuron_info.jsp?neuron_name=Badea2011Fig2Du">http://neuromorpho.org/neuron_info.jsp?neuron_name=Badea2011Fig2Du</ext-link></td><td/><td/></tr></tbody></table></table-wrap><sec id="s4-1"><title>Overview of current source density reconstruction methods</title><sec id="s4-1-1"><title>Traditional CSD</title><p>For reader‚Äôs convenience, here we briefly present the basic ideas behind the traditional and recent approaches to reconstruction of current source density (CSD analysis). For a more complete review of CSD analysis see <xref ref-type="bibr" rid="bib54">W√≥jcik (2015</xref>), for recent reviews of the relations between neural activity, current sources and the recordings see (<xref ref-type="bibr" rid="bib5">Buzs√°ki et al., 2012</xref>; <xref ref-type="bibr" rid="bib13">Einevoll et al., 2013a</xref>).</p><p>The relation between current sources in the tissue and the recording potentials is given by the Poisson equation<disp-formula id="equ12"><label>(3)</label><mml:math id="m12"><mml:mrow><mml:mrow><mml:mi>C</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mo>‚àá</mml:mo><mml:mo>‚Å°</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>œÉ</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo>‚àá</mml:mo><mml:mo>‚Å°</mml:mo><mml:mi>V</mml:mi></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf63"><mml:mi>C</mml:mi></mml:math></inline-formula> stands for CSD and <inline-formula><mml:math id="inf64"><mml:mi>V</mml:mi></mml:math></inline-formula> for the potential. While this can be studied numerically for nontrivial conductivity profiles (<xref ref-type="bibr" rid="bib40">Ness et al., 2015</xref>), here we shall mostly assume a constant and homogeneous conductivity tensor, <inline-formula><mml:math id="inf65"><mml:mi>œÉ</mml:mi></mml:math></inline-formula>. In that case, the above equation simplifies to <inline-formula><mml:math id="inf66"><mml:mrow><mml:mi>C</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mi>œÉ</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi mathvariant="normal">Œî</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>V</mml:mi></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula> and can be solved for <inline-formula><mml:math id="inf67"><mml:mi>C</mml:mi></mml:math></inline-formula> given potential in the whole space. On the other hand, given the CSD in the whole space, the potential is given by<disp-formula id="equ13"><label>(4)</label><mml:math id="m13"><mml:mrow><mml:mrow><mml:mrow><mml:mi>V</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>4</mml:mn><mml:mo>‚Å¢</mml:mo><mml:mi>œÄ</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>œÉ</mml:mi></mml:mrow></mml:mfrac><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo largeop="true" rspace="0.8pt" symmetric="true">‚à´</mml:mo><mml:mrow><mml:msup><mml:mi>d</mml:mi><mml:mn>3</mml:mn></mml:msup><mml:mo>‚Å¢</mml:mo><mml:mpadded width="+3.4pt"><mml:msup><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo>‚Ä≤</mml:mo></mml:msup></mml:mpadded><mml:mo>‚Å¢</mml:mo><mml:mfrac><mml:mrow><mml:mi>C</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo>‚Ä≤</mml:mo></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo>-</mml:mo><mml:msup><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo>‚Ä≤</mml:mo></mml:msup></mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mfrac></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>Walter Pitts observed that having recordings on a regular grid of electrodes we can estimate CSD by taking numerical second derivative of the potential (<xref ref-type="bibr" rid="bib46">Pitts, 1952</xref>), we call this approach <italic>traditional CSD method</italic>. Pitt‚Äôs idea gained popularity only after Nicholson and Freeman popularized its use for laminar recordings (<xref ref-type="bibr" rid="bib42">Nicholson and Freeman, 1975</xref>) in the cortex. In this setup, assuming the layers are infinite and homogeneous (<xref ref-type="bibr" rid="bib45">Pettersen et al., 2006</xref>), the current source density at each layer can be estimated from<disp-formula id="equ14"><label>(5)</label><mml:math id="m14"><mml:mrow><mml:mrow><mml:mrow><mml:mi>C</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mi>œÉ</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mfrac><mml:mrow><mml:mrow><mml:mrow><mml:mi>V</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mi>h</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>‚Å¢</mml:mo><mml:mi>V</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mi>V</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>-</mml:mo><mml:mi>h</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:msup><mml:mi>h</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mfrac></mml:mrow></mml:mrow></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf68"><mml:msub><mml:mi>z</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:math></inline-formula> is the position of the <inline-formula><mml:math id="inf69"><mml:msup><mml:mi>j</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>h</mml:mi></mml:mrow></mml:msup></mml:math></inline-formula> electrode and <inline-formula><mml:math id="inf70"><mml:mi>h</mml:mi></mml:math></inline-formula> is the inter-electrode distance.</p></sec><sec id="s4-1-2"><title>Inverse CSD (iCSD)</title><p>To overcome limitations of the traditional approach, such as difficulty of handling the data at the boundary and hidden assumptions about the dimensions we do not probe, Pettersen et al. proposed a model-based <italic>inverse CSD method</italic> (<xref ref-type="bibr" rid="bib45">Pettersen et al., 2006</xref>). Initially proposed in 1D, the method was later generalized to other dimensionalities (<xref ref-type="bibr" rid="bib32">≈Åƒôski et al., 2007</xref>; <xref ref-type="bibr" rid="bib33">≈Åƒôski et al., 2011</xref>). Given a set of recordings <inline-formula><mml:math id="inf71"><mml:mrow><mml:msub><mml:mi>V</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="normal">‚Ä¶</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>V</mml:mi><mml:mi>N</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> at regularly placed electrodes at <inline-formula><mml:math id="inf72"><mml:mrow><mml:msub><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="normal">‚Ä¶</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mi>N</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> this method assumes a model of CSD parametrized with CSD values at the measurement points, <inline-formula><mml:math id="inf73"><mml:mrow><mml:mrow><mml:mi>C</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msubsup><mml:mo largeop="true" symmetric="true">‚àë</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:msubsup><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="inf74"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> are functions taking 1 at <inline-formula><mml:math id="inf75"><mml:msub><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula>, 0 at other measurement points, with the values at other points defined by the specific variant of the method, for example, spline interpolated in spline iCSD (<xref ref-type="bibr" rid="bib54">W√≥jcik, 2015</xref>). Assuming the model <inline-formula><mml:math id="inf76"><mml:mrow><mml:mi>C</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> one computes the potential at the electrode positions obtaining a relation between the model parameters, <inline-formula><mml:math id="inf77"><mml:msub><mml:mi>C</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula>, and the measured potential, <inline-formula><mml:math id="inf78"><mml:msub><mml:mi>V</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula>, which can be inverted leading to an estimate of the CSD in the region of interest.</p></sec><sec id="s4-1-3"><title>Kernel CSD (kCSD)</title><p>The kernel Current Source Density method (<xref ref-type="bibr" rid="bib47">Potworowski et al., 2012</xref>) can be considered a generalization of the inverse CSD. It is a non-parametric method which allows reconstructions from arbitrarily placed electrodes and facilitates dealing with the noise. Conceptually, the method proceeds in two steps. First, one does kernel interpolation of the measured potentials. Next, one applies a 'cross-kernel' to shift the interpolated potential to the CSD. In 3D, in space of homogeneous and isotropic conductivity, this amounts to applying the Laplacian to the interpolated potential, <xref ref-type="disp-formula" rid="equ12">Equation. (3)</xref>. To handle all cases in a general way, including data of lower dimensionality or with non-trivial conductivity, we construct the interpolating kernel and cross-kernel from a collection of basis functions. The idea is to consider current source density in the form of a linear combination of basis sources <inline-formula><mml:math id="inf79"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>b</mml:mi><mml:mo>~</mml:mo></mml:mover><mml:mi>j</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, for example Gaussian,<disp-formula id="equ15"><label>(6)</label><mml:math id="m15"><mml:mrow><mml:mrow><mml:mrow><mml:mi>C</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munderover><mml:mo largeop="true" movablelimits="false" symmetric="true">‚àë</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>b</mml:mi><mml:mo>~</mml:mo></mml:mover><mml:mi>j</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p>where the number of basis sources <inline-formula><mml:math id="inf80"><mml:mrow><mml:mi>M</mml:mi><mml:mo>‚â´</mml:mo><mml:mi>N</mml:mi></mml:mrow></mml:math></inline-formula>, the number of electrodes, and <inline-formula><mml:math id="inf81"><mml:msub><mml:mi>a</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:math></inline-formula> are the weights with which the basis sources are combined into the model CSD. Let <inline-formula><mml:math id="inf82"><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> be the contribution to the extracellular potential from <inline-formula><mml:math id="inf83"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>b</mml:mi><mml:mo>~</mml:mo></mml:mover><mml:mi>j</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, which in 3D is<disp-formula id="equ16"><label>(7)</label><mml:math id="m16"><mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi class="ltx_font_mathcaligraphic">ùíú</mml:mi><mml:mo>‚Å¢</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>b</mml:mi><mml:mo>~</mml:mo></mml:mover><mml:mi>j</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>4</mml:mn><mml:mo>‚Å¢</mml:mo><mml:mi>œÄ</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>œÉ</mml:mi></mml:mrow></mml:mfrac><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo largeop="true" symmetric="true">‚à´</mml:mo><mml:mrow><mml:mi>d</mml:mi><mml:mo>‚Å¢</mml:mo><mml:msup><mml:mi>x</mml:mi><mml:mo>‚Ä≤</mml:mo></mml:msup><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo largeop="true" symmetric="true">‚à´</mml:mo><mml:mrow><mml:mi>d</mml:mi><mml:mo>‚Å¢</mml:mo><mml:msup><mml:mi>y</mml:mi><mml:mo>‚Ä≤</mml:mo></mml:msup><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo largeop="true" symmetric="true">‚à´</mml:mo><mml:mrow><mml:mi>d</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mpadded width="+1.7pt"><mml:msup><mml:mi>z</mml:mi><mml:mo>‚Ä≤</mml:mo></mml:msup></mml:mpadded><mml:mo>‚Å¢</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>b</mml:mi><mml:mo>~</mml:mo></mml:mover><mml:mi>j</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>x</mml:mi><mml:mo>‚Ä≤</mml:mo></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mi>y</mml:mi><mml:mo>‚Ä≤</mml:mo></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mi>z</mml:mi><mml:mo>‚Ä≤</mml:mo></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:msqrt><mml:mrow><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>-</mml:mo><mml:msup><mml:mi>x</mml:mi><mml:mo>‚Ä≤</mml:mo></mml:msup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mo>-</mml:mo><mml:msup><mml:mi>y</mml:mi><mml:mo>‚Ä≤</mml:mo></mml:msup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>z</mml:mi><mml:mo>-</mml:mo><mml:msup><mml:mi>z</mml:mi><mml:mo>‚Ä≤</mml:mo></mml:msup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msqrt></mml:mfrac></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p>but in 1D or 2D we would need to take into account the directions we do not control in experiment (for example, along the slice thickness for a slice placed on a 2D MEA). Then, the potential will have a form<disp-formula id="equ17"><label>(8)</label><mml:math id="m17"><mml:mrow><mml:mrow><mml:mrow><mml:mi>V</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mi class="ltx_font_mathcaligraphic">ùíú</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>C</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munderover><mml:mo largeop="true" movablelimits="false" symmetric="true">‚àë</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>Since we cannot estimate <inline-formula><mml:math id="inf84"><mml:mi>M</mml:mi></mml:math></inline-formula> coefficients <inline-formula><mml:math id="inf85"><mml:msub><mml:mi>a</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:math></inline-formula> from <inline-formula><mml:math id="inf86"><mml:mi>N</mml:mi></mml:math></inline-formula> measurements for <inline-formula><mml:math id="inf87"><mml:mrow><mml:mi>N</mml:mi><mml:mo>&lt;</mml:mo><mml:mi>M</mml:mi></mml:mrow></mml:math></inline-formula>, we construct a kernel for interpolation of the potential,<disp-formula id="equ18"><label>(9)</label><mml:math id="m18"><mml:mrow><mml:mrow><mml:mrow><mml:mi>K</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo>‚Ä≤</mml:mo></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munderover><mml:mo largeop="true" movablelimits="false" symmetric="true">‚àë</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>‚Å¢</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo>‚Ä≤</mml:mo></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>Then, any potential field <inline-formula><mml:math id="inf88"><mml:mrow><mml:mi>V</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> spanned by <inline-formula><mml:math id="inf89"><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> can be written as<disp-formula id="equ19"><label>(10)</label><mml:math id="m19"><mml:mrow><mml:mrow><mml:mrow><mml:mi>V</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munderover><mml:mo largeop="true" movablelimits="false" symmetric="true">‚àë</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>L</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mi>Œ≤</mml:mi><mml:mi>l</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mi>K</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mi>l</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p>for some <inline-formula><mml:math id="inf90"><mml:mi>L</mml:mi></mml:math></inline-formula>, <inline-formula><mml:math id="inf91"><mml:msub><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mi>l</mml:mi></mml:msub></mml:math></inline-formula>, and <inline-formula><mml:math id="inf92"><mml:msub><mml:mi>Œ≤</mml:mi><mml:mi>l</mml:mi></mml:msub></mml:math></inline-formula>, but it minimizes the regularized prediction error<disp-formula id="equ20"><label>(11)</label><mml:math id="m20"><mml:mrow><mml:mrow><mml:mrow><mml:munderover><mml:mo largeop="true" movablelimits="false" symmetric="true">‚àë</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mi>V</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>-</mml:mo><mml:msub><mml:mi>V</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mi>Œª</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:munderover><mml:mo largeop="true" movablelimits="false" symmetric="true">‚àë</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>L</mml:mi></mml:munderover><mml:msubsup><mml:mi>Œ≤</mml:mi><mml:mi>l</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mrow></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p>when <inline-formula><mml:math id="inf93"><mml:mrow><mml:mi>L</mml:mi><mml:mo>=</mml:mo><mml:mi>N</mml:mi></mml:mrow></mml:math></inline-formula>. Here, <inline-formula><mml:math id="inf94"><mml:msub><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula> are the positions of the electrodes, <inline-formula><mml:math id="inf95"><mml:msub><mml:mi>V</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula> are the corresponding measurements, <inline-formula><mml:math id="inf96"><mml:mi>Œª</mml:mi></mml:math></inline-formula> is the regularization constant. The minimizing solution is obtained for<disp-formula id="equ21"><label>(12)</label><mml:math id="m21"><mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">ùú∑</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">ùêä</mml:mi><mml:mo>+</mml:mo><mml:mrow><mml:mi>Œª</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mtext>ùêà</mml:mtext></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>‚ãÖ</mml:mo><mml:mi mathvariant="bold">ùêï</mml:mi></mml:mrow></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf97"><mml:mi mathvariant="bold">ùêï</mml:mi></mml:math></inline-formula> is the vector of the measurements <inline-formula><mml:math id="inf98"><mml:msub><mml:mi>V</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:math></inline-formula>, and <inline-formula><mml:math id="inf99"><mml:mrow><mml:msub><mml:mi mathvariant="bold">ùêä</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mi>K</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:math></inline-formula>.</p><p>To estimate CSD we introduce a cross-kernel<disp-formula id="equ22"><label>(13)</label><mml:math id="m22"><mml:mrow><mml:mrow><mml:mrow><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo>~</mml:mo></mml:mover><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo>‚Ä≤</mml:mo></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munderover><mml:mo largeop="true" movablelimits="false" symmetric="true">‚àë</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>‚Å¢</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>b</mml:mi><mml:mo>~</mml:mo></mml:mover><mml:mi>j</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo>‚Ä≤</mml:mo></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>If we define<disp-formula id="equ23"><mml:math id="m23"><mml:mrow><mml:mrow><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi mathvariant="bold">ùêä</mml:mi><mml:mo>~</mml:mo></mml:mover><mml:mi>T</mml:mi></mml:msup><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>:=</mml:mo><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo>~</mml:mo></mml:mover><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mi mathvariant="normal">‚Ä¶</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi>K</mml:mi><mml:mo>~</mml:mo></mml:mover><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mi>N</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p>then the estimated CSD takes form of<disp-formula id="equ24"><label>(14)</label><mml:math id="m24"><mml:mrow><mml:msup><mml:mi>C</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msup><mml:mover accent="true"><mml:mi mathvariant="bold">ùêä</mml:mi><mml:mo>~</mml:mo></mml:mover><mml:mi>T</mml:mi></mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>‚ãÖ</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùêä</mml:mi><mml:mo>+</mml:mo><mml:mi>Œª</mml:mi><mml:mtext>ùêà</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:msup><mml:mi/><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>‚ãÖ</mml:mo><mml:mi mathvariant="bold">ùêï</mml:mi><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf100"><mml:mi>Œª</mml:mi></mml:math></inline-formula> is the regularization parameter and I the identity matrix; see (<xref ref-type="bibr" rid="bib47">Potworowski et al., 2012</xref>) for derivation and discussion.</p></sec><sec id="s4-1-4"><title>Spike CSD (sCSD)</title><p>The Spike CSD (<xref ref-type="bibr" rid="bib51">Somogyv√°ri et al., 2012</xref>) is the forerunner of the method presented here, as it aims to estimate the current source distribution of single neurons with unknown morphology. The sCSD method provides an estimation of the cell-electrode distance and uses a simplified model of the shape of the neuron to reach this. Separating potential patterns generated by different neurons is critical and it is obtained by clustering extracellular fingerprints of action potentials which are different for every neuron. The limitation of sCSD is the assumed simplified morphology of the model and low spatial resolution. Despite that, even with this simplified model, it was possible to demonstrate for the first time the EC observability of backpropagating action potentials in the basal dendrites of cortical neurons, the forward propagation preceding the action potential on the dendritic tree and the signs of the Ranvier-nodes (<xref ref-type="bibr" rid="bib51">Somogyv√°ri et al., 2012</xref>).</p></sec></sec><sec id="s4-2"><title>skCSD method</title><p>The single-cell kCSD method (skCSD), which we introduce in this work, is an application of the kCSD framework where we assume that the measured extracellular potential comes mainly from a cell of known morphology and known spatial relation to the MEA. To estimate the CSD in this case, we must cover the morphology of the cell with a collection of basis functions. To do this, a one-dimensional parametrization of the cell morphology is needed. This could be done independently for each branch of the neuron or globally for the whole cell at once. While the first approach might seem easier, handling of the branching point is non-trivial. Instead, we decided to fit a closed curve on the morphology, which we call the <italic>morphology loop</italic> (<xref ref-type="fig" rid="fig1">Figure 1</xref>). This curve should cover all the segments of the cell, be as short as possible, and be aligned with the morphology. For example, in case of a ball-and-stick neuron, the curve starts at the soma, goes towards the tip of the dendrite, turns back, goes back to the soma, and closes there. One parameter <inline-formula><mml:math id="inf101"><mml:mi>s</mml:mi></mml:math></inline-formula> is enough to unambiguously determine a position on this line, although most points on the morphology are mapped to two <inline-formula><mml:math id="inf102"><mml:mi>s</mml:mi></mml:math></inline-formula> parameters. We also need a method to handle the branching points and guide the parametrization so that all the branches will be visited in an optimal way. This problem is a special case of the Chinese postman problem known from graph theory (<xref ref-type="bibr" rid="bib27">Kwan, 1962</xref>). Given this information, we can distribute the basis functions <inline-formula><mml:math id="inf103"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>b</mml:mi><mml:mo>~</mml:mo></mml:mover><mml:mi>j</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> along the morphology of the cell (<xref ref-type="fig" rid="fig1">Figure 1</xref>).</p><p>In practice, based on the morphology information we define an ordered sequence of all the segments such that the consecutive segments are always physically connected and preference is given to those neighbors which have not been visited yet. The process is continued until all the segments are covered and the last element in the sequence connects to the first element. Note that in the sequence the final segments of the branches are present once, the branching point multiple times and the intermediate ones twice. Then we fit a spline on the coordinates of the segments following the ordered sequence resulting in a morphology loop construction. The CSD basis functions are distributed along this loop uniformly. Any point <inline-formula><mml:math id="inf104"><mml:mrow><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo>‚â°</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> on the morphology can be parameterized with <inline-formula><mml:math id="inf105"><mml:mrow><mml:mi>s</mml:mi><mml:mo>‚àà</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>l</mml:mi><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> on the loop:<disp-formula id="equ25"><label>(15)</label><mml:math id="m25"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mtable columnalign="left left" columnspacing="1em" rowspacing="4pt"><mml:mtr><mml:mtd><mml:mi>x</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>y</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>z</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>z</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf106"><mml:mi>l</mml:mi></mml:math></inline-formula> is twice the length of all the branches. Consider the following basis functions:<disp-formula id="equ26"><label>(16)</label><mml:math id="m26"><mml:mrow><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>b</mml:mi><mml:mo>~</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>-</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>-</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>/</mml:mo><mml:msup><mml:mi>R</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:math></disp-formula></p><p>where <inline-formula><mml:math id="inf107"><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> is the location of the <inline-formula><mml:math id="inf108"><mml:mi>i</mml:mi></mml:math></inline-formula>-th basis function on the morphology loop, <inline-formula><mml:math id="inf109"><mml:mi>R</mml:mi></mml:math></inline-formula> its width.</p><p>The contribution to the extracellular potential from a basis source <inline-formula><mml:math id="inf110"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>b</mml:mi><mml:mo>~</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is given by<disp-formula id="equ27"><label>(17)</label><mml:math id="m27"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>4</mml:mn><mml:mi>œÄ</mml:mi><mml:mi>œÉ</mml:mi></mml:mrow></mml:mfrac><mml:mo>‚à´</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>b</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:msqrt><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>‚àí</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo>‚àí</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>z</mml:mi><mml:mo>‚àí</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>z</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:msqrt></mml:mfrac><mml:mi>d</mml:mi><mml:mi>s</mml:mi><mml:mo>.</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>As in kCSD, for CSD of the form<disp-formula id="equ28"><mml:math id="m28"><mml:mrow><mml:mrow><mml:mi>C</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munderover><mml:mo largeop="true" movablelimits="false" symmetric="true">‚àë</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>b</mml:mi><mml:mo>~</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>we obtain the extracellular potential as<disp-formula id="equ29"><label>(18)</label><mml:math id="m29"><mml:mrow><mml:mrow><mml:mrow><mml:mi>V</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mtext>ùê±</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munderover><mml:mo largeop="true" movablelimits="false" symmetric="true">‚àë</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mtext>ùê±</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>As before, for estimation of potential we use kernel interpolation. Note that in this case the basis functions in the CSD space, <inline-formula><mml:math id="inf111"><mml:mrow><mml:mover accent="true"><mml:mi>b</mml:mi><mml:mo>~</mml:mo></mml:mover><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, live on the morphology loop, while the basis functions in the potential space, <inline-formula><mml:math id="inf112"><mml:mrow><mml:msub><mml:mi>b</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, live in the physical 3D space. To determine the current source density distribution along the fitted curve, we introduce the following kernel functions:<disp-formula id="equ30"><mml:math id="m30"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mtable columnalign="right left right left right left right left right left right left" columnspacing="0em 2em 0em 2em 0em 2em 0em 2em 0em 2em 0em" displaystyle="true" rowspacing="3pt"><mml:mlabeledtr><mml:mtd><mml:mtext>(19)</mml:mtext></mml:mtd><mml:mtd><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>K</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">‚Ä≤</mml:mi></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:mtd><mml:mtd><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:munderover><mml:mo>‚àë</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mi>b</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">‚Ä≤</mml:mi></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mstyle></mml:mstyle></mml:mtd><mml:mtd/></mml:mlabeledtr><mml:mlabeledtr><mml:mtd><mml:mtext>(20)</mml:mtext></mml:mtd><mml:mtd><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mover><mml:mi>K</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">‚Ä≤</mml:mi></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:mtd><mml:mtd><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mo>=</mml:mo><mml:mstyle displaystyle="true" scriptlevel="0"><mml:munderover><mml:mo>‚àë</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>M</mml:mi></mml:mrow></mml:munderover><mml:msub><mml:mrow><mml:mover><mml:mi>b</mml:mi><mml:mo>~</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">x</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="normal">‚Ä≤</mml:mi></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mstyle></mml:mstyle></mml:mtd><mml:mtd/></mml:mlabeledtr></mml:mtable></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>With these definitions the regularized solution for <inline-formula><mml:math id="inf113"><mml:mi>C</mml:mi></mml:math></inline-formula> on the morphology loop is given by <xref ref-type="disp-formula" rid="equ24">Equation 14</xref>:<disp-formula id="equ31"><label>(21)</label><mml:math id="m31"><mml:mrow><mml:mrow><mml:mrow><mml:mtext>ùêÇ</mml:mtext><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:msup><mml:mover accent="true"><mml:mtext>ùêä</mml:mtext><mml:mo>~</mml:mo></mml:mover><mml:mi>T</mml:mi></mml:msup><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>‚Å¢</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mtext>ùêä</mml:mtext><mml:mo>+</mml:mo><mml:mrow><mml:mi>Œª</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mtext>ùêà</mml:mtext></mml:mrow></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>‚Å¢</mml:mo><mml:mtext>ùêï</mml:mtext></mml:mrow></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>To obtain the distribution of currents at a given point in space we need to sum the currents on the loop at points which are mapped to that physical position <inline-formula><mml:math id="inf114"><mml:mi mathvariant="bold">ùê±</mml:mi></mml:math></inline-formula>:<disp-formula id="equ32"><label>(22)</label><mml:math id="m32"><mml:mrow><mml:mrow><mml:mrow><mml:mtext>ùêÇ</mml:mtext><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:munder><mml:mo largeop="true" movablelimits="false" symmetric="true">‚àë</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>:</mml:mo><mml:mrow><mml:mrow><mml:mi>r</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="bold">ùê±</mml:mi></mml:mrow></mml:mrow></mml:munder><mml:mrow><mml:mtext>ùêÇ</mml:mtext><mml:mo>‚Å¢</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p></sec><sec id="s4-3"><title>Construction of ground truth data</title><p>To validate the method, we used simulated data which allows us to consider arbitrary cell-electrode setups and test various current patterns. The LFPy package (<xref ref-type="bibr" rid="bib30">Lind√©n et al., 2013</xref>) was used to simulate the extracellular potential at arbitrarily placed virtual electrodes. We assumed the .swc morphology description format (<xref ref-type="bibr" rid="bib8">Cannon et al., 1998</xref>) and the sections were further divided to segments. The coordinates of every segment‚Äôs ends were used to find the connections. Once the connection matrix was calculated, we used the Chinese postman algorithm to obtain the morphology loop. We calculated the potential using neuron models with various morphologies shown in <xref ref-type="fig" rid="fig4">Figure 4</xref> and different input distributions, assuming one- and two-dimensional multielectrode arrays. We used toy models to better understand and characterize the method as well as a biologically realistic neuron model to estimate performance of skCSD in an experimentally realistic scenario.</p><p>The simplest setup we used was a ball-and-stick neuron recorded with a laminar probe. Various artificial CSD patterns and also biologically more realistic CSD distributions served as test distributions in order to quantify the spatial resolution and reconstruction errors. To generate the ground truth data we simulated a 500 Œºm long linear cell model of 52 segments in LFPy. The diameter of the two segments representing the soma was 20 Œºm, while the other segments were 4 Œºm wide. 100 synaptic excitation events were distributed randomly along this morphology in order to imitate a biologically realistic scenario.</p><p>To test the effect of branching on the results, a simple Y-shaped morphology was used (<xref ref-type="fig" rid="fig4">Figure 4B</xref>). The synapses were placed at segments 33 and 62 on different branches close to the branching point. The first was stimulated at 5, 45, 60 ms, the other at 5, 25, 60 ms after the onset of the simulation. The idea here was to consider the inputs stimulated together and separately. The times of activation were randomly selected in such a way as to leave enough time for the membrane activity to settle down. This can be viewed as extreme cases of correlated and uncorrelated events. Note that the skCSD reconstruction is not affected directly by the temporal correlation of the synaptic inputs. Just like any CSD estimation method, skCSD is applied to the potentials recorded at a given point in time. Of course, it is affected indirectly, in the sense that slower or faster oscillating inputs lead to different spatial patterns due to filtering effects of the dendritic membrane: fast oscillations induce short dipoles, slow oscillations allow the current to spread along the cell leading to stronger dipoles (<xref ref-type="bibr" rid="bib31">Lind√©n et al., 2010</xref>). We address these effects indirectly in <xref ref-type="fig" rid="fig2">Figure 2</xref>.</p><p>As a realistic example, we used a mouse retinal ganglion cell morphology (<xref ref-type="bibr" rid="bib26">Kong et al., 2005</xref>) from NeuroMorpho.Org (<xref ref-type="bibr" rid="bib1">Ascoli, 2006</xref>). In the simulations 608 segments were used. 100 synaptic excitation events were distributed randomly along this morphology within the first 400 ms of the simulation. The cell was also driven with an oscillatory current. In the dendrites, only passive ion channels were used.</p></sec><sec id="s4-4"><title>Parameters of the simulations</title><p>We simulated three different model morphologies: ball-and-stick (BS), Y-shaped (Y), and a ganglion cell (Gang). The Y-shaped neuron was considered in two situations, when it was parallel (Y) or orthogonal (Y-rot) to the MEA plane. The extracellular potential was computed at multiple points modeling different experimentally viable recording configurations (cell and setup). All combinations used are summarized in <xref ref-type="table" rid="table1">Table 1</xref>. The parameters describing the neuron membrane physiology are given in <xref ref-type="table" rid="table2">Table 2</xref>. The length of the simulation was 70 s in case of the ball-and-stick and Y-shaped neurons, and 850 s for the ganglion cell model.</p><table-wrap id="table1" position="float"><object-id pub-id-type="doi">10.7554/eLife.29384.015</object-id><label>Table 1.</label><caption><title>Main parameters of the simulated cells and setups.</title></caption><table frame="hsides" rules="groups"><thead><tr><th/><th colspan="2">Cell properties</th><th colspan="3">Synapse properties</th><th colspan="2">Distribution of electrodes</th></tr></thead><tbody><tr><td/><td>Length (<inline-formula><mml:math id="inf115"><mml:mi>Œº</mml:mi></mml:math></inline-formula><italic>m</italic> )</td><td>Number of Seg.</td><td>Location (ID of Seg.)</td><td>Number of Syn.</td><td>Synaptic Weight (<inline-formula><mml:math id="inf116"><mml:mi>Œº</mml:mi></mml:math></inline-formula><italic>S</italic> )</td><td>Type</td><td>Number</td></tr><tr><th>BS</th><td>516</td><td>53</td><td>random</td><td>100</td><td>0.01</td><td>linear</td><td>8,16, 32, 64, 128</td></tr><tr><th>Y</th><td>848</td><td>86</td><td>33, 62</td><td>6</td><td>0.04</td><td>rectangular, random</td><td>2 √ó 4, 4 √ó 4, 4x8, 4x16</td></tr><tr><th>Y-rot</th><td>848</td><td>86</td><td>33, 62</td><td>6</td><td>0.04</td><td>rectangular</td><td>8,16, 32, 64</td></tr><tr><th>Gang</th><td>5876</td><td>608</td><td>random</td><td>100</td><td>0.01</td><td>hexagonal, rectangular</td><td>128, 25, 49, 81, 441</td></tr></tbody></table></table-wrap><table-wrap id="table2" position="float"><object-id pub-id-type="doi">10.7554/eLife.29384.016</object-id><label>Table 2.</label><caption><title>Biophysical parameters characterizing the simulated cell models.</title></caption><table frame="hsides" rules="groups"><thead><tr><th>Quantity</th><th>Value</th><th>Unit</th></tr></thead><tbody><tr><td>Initial potential</td><td>‚àí65</td><td><inline-formula><mml:math id="inf117"><mml:mrow><mml:mi>m</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>V</mml:mi></mml:mrow></mml:math></inline-formula></td></tr><tr><td>Axial resistance</td><td>123</td><td><inline-formula><mml:math id="inf118"><mml:mrow><mml:mi mathvariant="normal">Œ©</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>c</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:math></inline-formula></td></tr><tr><td>Membrane resistivity</td><td>30000</td><td><inline-formula><mml:math id="inf119"><mml:mrow><mml:mi mathvariant="normal">Œ©</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>c</mml:mi><mml:mo>‚Å¢</mml:mo><mml:msup><mml:mi>m</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula></td></tr><tr><td>Membrane capacitance</td><td>1</td><td><inline-formula><mml:math id="inf120"><mml:mrow><mml:mrow><mml:mrow><mml:mi>Œº</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>F</mml:mi></mml:mrow><mml:mo>/</mml:mo><mml:mi>c</mml:mi></mml:mrow><mml:mo>‚Å¢</mml:mo><mml:msup><mml:mi>m</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula></td></tr><tr><td>Passive mechanism reversal potential</td><td>‚àí65</td><td><inline-formula><mml:math id="inf121"><mml:mrow><mml:mi>m</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>V</mml:mi></mml:mrow></mml:math></inline-formula></td></tr></tbody></table></table-wrap></sec><sec id="s4-5"><title>Parameters of synapses</title><p>In most simulations we modeled synaptic activity. We used synapses with discontinuous change in conductance at an event followed by an exponential decay with time constant <inline-formula><mml:math id="inf122"><mml:mi>œÑ</mml:mi></mml:math></inline-formula> (ExpSyn model as implemented in the NEURON simulator). When simulating the Y-shaped neuron we placed two synapses with the following parameters: reversal potential: 0 mV , synaptic time constant: 2 ms, synaptic weight: 0.04 ŒºS. The synapses were placed at segments 33 and 62 (see <xref ref-type="fig" rid="fig4">Figures 4</xref>,<xref ref-type="fig" rid="fig5">5</xref>). When simulating the other models (ball-and-stick and ganglion cell) we used the same type of synapse; however, the synaptic weights were a quarter of the above (0.01 ŒºS) since they were more numerous (<xref ref-type="table" rid="table2">Table 2</xref>).</p></sec><sec id="s4-6"><title>Measuring the quality of reconstruction</title><p>To validate the skCSD method, we need to consider two situations. When we know the ground truth ‚Äî the actual distribution of sources which generated the measured potentials ‚Äî we can compare the reconstruction with it. This is available directly only in simulations. In that case, we can measure the prediction error between the reconstruction and the original. However, the skCSD method by its nature gives smooth results. This is a consequence of kernel interpolation of the potential which occurs in the first step of the method. The same phenomenon occurs in regular CSD estimation (<xref ref-type="bibr" rid="bib54">W√≥jcik, 2015</xref>). Thus, we can never recover the original CSD distribution but only a coarse-grained approximation. This is not a significant problem as the coarse-grained CSD should have equivalent physiological consequence. However, to compare the reconstructed density with the ground-truth, which is typically very irregular in consequence of multiple synaptic activations, we always smoothed the ground truth CSD with a Gaussian kernel. The width of the kernel was 15 Œºm for ball-and-stick model, while for the Y-shaped and ganglion cell models we used 30 Œºm.</p><p>Thus, whenever ground truth was known, we computed L1 norm of the difference between the reconstruction <inline-formula><mml:math id="inf123"><mml:msup><mml:mi>C</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:math></inline-formula> and smoothed ground truth <inline-formula><mml:math id="inf124"><mml:mi>C</mml:mi></mml:math></inline-formula> normalized by the L1 norm of <inline-formula><mml:math id="inf125"><mml:mi>C</mml:mi></mml:math></inline-formula>:<disp-formula id="equ33"><label>(23)</label><mml:math id="m33"><mml:mrow><mml:mrow><mml:msub><mml:mi>œµ</mml:mi><mml:mrow><mml:mi>L</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:munder><mml:mo largeop="true" movablelimits="false" symmetric="true">‚àë</mml:mo><mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>e</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>g</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>m</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>e</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>n</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>t</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi>t</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>i</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>m</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>e</mml:mi></mml:mrow></mml:mrow></mml:munder><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mtext>ùêÇ</mml:mtext><mml:mo>-</mml:mo><mml:msup><mml:mtext>ùêÇ</mml:mtext><mml:mo>*</mml:mo></mml:msup></mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:munder><mml:mo largeop="true" movablelimits="false" symmetric="true">‚àë</mml:mo><mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>e</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>g</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>m</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>e</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>n</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>t</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>s</mml:mi></mml:mrow><mml:mo>,</mml:mo><mml:mrow><mml:mi>t</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>i</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>m</mml:mi><mml:mo>‚Å¢</mml:mo><mml:mi>e</mml:mi></mml:mrow></mml:mrow></mml:munder><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mtext>ùêÇ</mml:mtext><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>When analyzing experimental data we only have access to the noisy measurements and cannot apply the above strategy directly. Thus we consider two strategies. One is to use cross-validation error (CV). In leave-one-out cross-validation (<xref ref-type="bibr" rid="bib47">Potworowski et al., 2012</xref>) we estimate CSD from all the measurements but one and compare estimated prediction with actual measurement on the removed electrode. Repeating this procedure for all the electrodes gives us a measure of prediction quality for a given set of parameters for this specific dataset. Scanning over some parameter range we identify optimal parameters as those giving minimum error. They are further used to analyze the complete data. The advantage of using cross-validation error is that it does not require the knowledge of the ground truth current source density distribution and can still provide an estimation about the performance of the skCSD method. As this algorithm is quadratic in the number of electrodes, for large arrays one might prefer to use the leave-p-out cross-validation instead. When we test how the quality of the reconstruction changes with the number of electrodes we use CV error normalized by the number of electrodes which can then be compared between different setups.</p><p>The other strategy we use and recommend in the experimental context, when we know the cell morphology and its geometric relation to the setup, as well as the measurements, is model-based analysis. The idea is to simulate different current source distributions, either placing specific distribution by hand or by modeling activity of the cell assuming passive membrane and random or specific synaptic activations, both of which are relatively inexpensive both in computational time and coding complexity. This reduces the problem to the modeling case. We can use thus generated data (CSD and potentials) scanning for optimal reconstruction parameters to be used in analysis of actual experimental data from the setup.</p><p>To handle the effects of noise one should study its properties on electrodes, for example, assuming white measurement noise identify its variance, then tune the regularization parameter <inline-formula><mml:math id="inf126"><mml:mi>Œª</mml:mi></mml:math></inline-formula> on simulated sets with comparable simulated noise added.</p></sec><sec id="s4-7"><title>Parameter selection</title><p>To apply the skCSD method, we need to decide upon the number of basis functions, set their width (<inline-formula><mml:math id="inf127"><mml:mi>R</mml:mi></mml:math></inline-formula>), and choose the regularization parameter <inline-formula><mml:math id="inf128"><mml:mi>Œª</mml:mi></mml:math></inline-formula>. In this work, the number of basis function was set to 512 for all cases, which is at least twice the number of electrodes used. This is usually not a limitation, the more the better. For the basis width (<xref ref-type="disp-formula" rid="equ26">Equation. (16)</xref>) we took the following values: 8, 16, 32, 64, 128 Œºm. Selection of the regularization parameter is not trivial (<xref ref-type="bibr" rid="bib47">Potworowski et al., 2012</xref>; <xref ref-type="bibr" rid="bib21">Hansen, 2010</xref>). Here, we tested the effect of the regularization parameter taking values of 0.00001, 0.0001, 0.001, 0.01, 0.1 The optimal parameters were identified by the lowest value of reconstruction error.</p></sec><sec id="s4-8"><title>Visual representation of CSD on the morphology</title><p>To visualize the distribution of current sources and other quantities along a neuron morphology we use two representations of the cell:</p><list list-type="order"><list-item><p><italic>Interval representation</italic>: we stack all the compartments consecutively along the y-axis so that the part of the dendrite stemming from the soma is shown first, followed by one branch, followed by the other. The order of the branches in the stack is taken from the morphology loop to make these representations consistent. The <inline-formula><mml:math id="inf129"><mml:mi>x</mml:mi></mml:math></inline-formula>-axis either shows different time instants of the simulations or various distribution patterns.</p></list-item><list-item><p><italic>Branching morphology representation</italic>: in this case a two-dimensional projection of the cell is shown which is colored according to the amplitudes of the membrane current source densities at a time instant. To visually enhance the current events, gray circles proportional to the amplitude of CSD at a point are placed centered at the point to facilitate comprehension.</p></list-item></list></sec><sec id="s4-9"><title>Experimental methods</title><sec id="s4-9-1"><title>In vitro experiment</title><p>One male Wistar rat¬†(300¬†g) was used for the slice preparation procedure. The in vitro experiment was performed according to the EC Council Directive of November 24, 1986 (86/89/EEC) and all procedures were reviewed and approved by the local ethical committee and the Hungarian Central Government Office (license number: PEI/001/695-9/2015). The animal was anesthetized with isoflurane (0.2 ml/100 g). Horizontal hippocampal slices of 500 ¬µm thickness were cut with a vibratome (VT1200s; Leica, Nussloch, Germany). We followed our experimental procedures developed for human in vitro recordings (<xref ref-type="bibr" rid="bib25">Kerekes et al., 2014</xref>), adapted to rodent tissue. Briefly, slices were transferred to a dual superfusion chamber perfused with artificial cerebrospinal fluid. Intracellular patch-clamp recordings, cell filling, visualization and three-dimensional reconstruction of the filled cell was performed as described in (<xref ref-type="bibr" rid="bib25">Kerekes et al., 2014</xref>). For the extracellular local field potential recordings, we used a 16-channel linear multielectrode (A16 √ó 1‚Äì2 mm-50-177-A16, Neuronexus Technologies, Ann Arbor, MI), with an INTAN RHD2000 FPGA-based acquisition system (InTan Technologies, Los Angeles, CA). The system was connected to a laptop via USB 2.0. Wideband signals (0.1‚àí7500 Hz) were recorded with a sampling frequency of 20 kHz and with 16-bit resolution. The recorded neuron was held by a constant¬†‚àí40 nA current injection.</p></sec><sec id="s4-9-2"><title>Data preprocessing</title><p>One hundred and fifty-four spikes were detected on the 180 s long intra-cellular recording by 0¬†mV upward threshold crossing. A¬†¬±¬†5 ms wide time windows were cut around the moments of each spikes on each channels of the extra-cellular (EC) potential recordings and averaged, to access the fine details of the EC spatio-temporal potential pattern which accompanied the firing of the recorded neuron on all channels. Two channels were broken (2, 5); however, as the skCSD method allows retrieving CSD maps from arbitrarily distributed contacts, this has not prevented the analysis; the broken channels were excluded from further consideration. The averaged spatio-temporal potential maps were high-pass filtered by subtracting a moving window average with 100 ms width. This filtering, together with the spike-triggered averaging procedure, ensured that the resulted EC potential map contains only the contribution from the actually recorded cell. The price we paid was filtering out EC signals of the spontaneous repetitive sharp-wave like activity of the slice which was correlated by the firing of the recorded neuron and thus the presumptive synaptic inputs of the recorded neuron as well. An additional temporal smoothing by a moving average with 0.15 ms window was used to reduce the effect of noise.</p></sec></sec></sec></body><back><ack id="ack"><title>Acknowledgements</title><p>Research supported by grants from the Polish Ministry of Science and Higher Education 2729/7.PR/2013/2, the Hungarian National Research, Development and Innovation Fund NKFIH K 113147, K 119443 and NN 118902, and the Hungarian National Brain Research Program KTIA NAP 13-1-2013-0001 and KTIA-13-NAP-A-IV/1,2,3,4,6. We are grateful for Emese P√°lfi and L√°szl√≥ N√©gyessy for the opportunity of using their Neurolucida setup at the Department of Anatomy, Histology and Embryology, Semmelweis University, to Chaitanya Chintaluri and Mark J.¬†Hunt for critical reading of the manuscript, and to Joanna Jƒôdrzejewska-Szmek for help with testing and documenting the software for public exposition.</p></ack><sec id="s5" sec-type="additional-information"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="COI-statement" id="conf1"><p>No competing interests declared</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>Conceptualization, Data curation, Software, Formal analysis, Validation, Investigation, Visualization, Methodology, Writing‚Äîoriginal draft, Writing‚Äîreview and editing</p></fn><fn fn-type="con" id="con2"><p>Data curation, Investigation, Methodology</p></fn><fn fn-type="con" id="con3"><p>Investigation, Methodology</p></fn><fn fn-type="con" id="con4"><p>Investigation, Methodology</p></fn><fn fn-type="con" id="con5"><p>Conceptualization, Supervision, Funding acquisition, Methodology</p></fn><fn fn-type="con" id="con6"><p>Resources, Supervision, Funding acquisition, Methodology, Writing‚Äîoriginal draft, Writing‚Äîreview and editing</p></fn><fn fn-type="con" id="con7"><p>Conceptualization, Supervision, Funding acquisition, Investigation, Methodology, Writing‚Äîoriginal draft, Writing‚Äîreview and editing</p></fn></fn-group><fn-group content-type="ethics-information"><title>Ethics</title><fn fn-type="other"><p>Animal experimentation: The in vitro experiment was performed according to the EC Council Directive of November 24, 1986 (86/89/EEC) and all procedures were reviewed and approved by the local ethical committee and the Hungarian Central Government Office (license number: PEI/001/695-9/2015).</p></fn></fn-group></sec><sec id="s6" sec-type="supplementary-material"><title>Additional files</title><supplementary-material id="transrepform"><object-id pub-id-type="doi">10.7554/eLife.29384.017</object-id><label>Transparent reporting form</label><media mime-subtype="pdf" mimetype="application" xlink:href="elife-29384-transrepform-v2.pdf"/></supplementary-material><sec id="s7" sec-type="datasets"><title>Major datasets</title><p>The following previously published dataset was used:</p><p><related-object content-type="generated-dataset" id="dataset1" source-id="http://neuromorpho.org/neuron_info.jsp?neuron_name=Badea2011Fig2Du" source-id-type="uri"><collab collab-type="author">Badea TC</collab><collab collab-type="author">Nathans J</collab><year>2011</year><source>Neuron morphology Badea2011Fig2Du</source><ext-link ext-link-type="uri" xlink:href="http://neuromorpho.org/neuron_info.jsp?neuron_name=Badea2011Fig2Du">http://neuromorpho.org/neuron_info.jsp?neuron_name=Badea2011Fig2Du</ext-link><comment>Publicly available at NeuroMorpho.Org (ID : NMO_10743)</comment></related-object></p></sec></sec><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ascoli</surname> <given-names>GA</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Mobilizing the base of neuroscience data: the case of neuronal morphologies</article-title><source>Nature Reviews Neuroscience</source><volume>7</volume><fpage>318</fpage><lpage>324</lpage><pub-id pub-id-type="doi">10.1038/nrn1885</pub-id><pub-id pub-id-type="pmid">16552417</pub-id></element-citation></ref><ref id="bib2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bakkum</surname> <given-names>DJ</given-names></name><name><surname>Frey</surname> <given-names>U</given-names></name><name><surname>Radivojevic</surname> <given-names>M</given-names></name><name><surname>Russell</surname> <given-names>TL</given-names></name><name><surname>M√ºller</surname> <given-names>J</given-names></name><name><surname>Fiscella</surname> <given-names>M</given-names></name><name><surname>Takahashi</surname> <given-names>H</given-names></name><name><surname>Hierlemann</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Tracking axonal action potential propagation on a high-density microelectrode array across hundreds of sites</article-title><source>Nature Communications</source><volume>4</volume><elocation-id>2181</elocation-id><pub-id pub-id-type="doi">10.1038/ncomms3181</pub-id><pub-id pub-id-type="pmid">23867868</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Berdondini</surname> <given-names>L</given-names></name><name><surname>van der Wal</surname> <given-names>PD</given-names></name><name><surname>Guenat</surname> <given-names>O</given-names></name><name><surname>de Rooij</surname> <given-names>NF</given-names></name><name><surname>Koudelka-Hep</surname> <given-names>M</given-names></name><name><surname>Seitz</surname> <given-names>P</given-names></name><name><surname>Kaufmann</surname> <given-names>R</given-names></name><name><surname>Metzler</surname> <given-names>P</given-names></name><name><surname>Blanc</surname> <given-names>N</given-names></name><name><surname>Rohr</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>High-density electrode array for imaging in vitro electrophysiological activity</article-title><source>Biosensors and Bioelectronics</source><volume>21</volume><fpage>167</fpage><lpage>174</lpage><pub-id pub-id-type="doi">10.1016/j.bios.2004.08.011</pub-id><pub-id pub-id-type="pmid">15967365</pub-id></element-citation></ref><ref id="bib4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bereshpolova</surname> <given-names>Y</given-names></name><name><surname>Amitai</surname> <given-names>Y</given-names></name><name><surname>Gusev</surname> <given-names>AG</given-names></name><name><surname>Stoelzel</surname> <given-names>CR</given-names></name><name><surname>Swadlow</surname> <given-names>HA</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Dendritic backpropagation and the state of the awake neocortex</article-title><source>Journal of Neuroscience</source><volume>27</volume><fpage>9392</fpage><lpage>9399</lpage><pub-id pub-id-type="doi">10.1523/JNEUROSCI.2218-07.2007</pub-id><pub-id pub-id-type="pmid">17728452</pub-id></element-citation></ref><ref id="bib5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Buzs√°ki</surname> <given-names>G</given-names></name><name><surname>Anastassiou</surname> <given-names>CA</given-names></name><name><surname>Koch</surname> <given-names>C</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>The origin of extracellular fields and currents--EEG, ECoG, LFP and spikes</article-title><source>Nature Reviews Neuroscience</source><volume>13</volume><fpage>407</fpage><lpage>420</lpage><pub-id pub-id-type="doi">10.1038/nrn3241</pub-id><pub-id pub-id-type="pmid">22595786</pub-id></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Buzs√°ki</surname> <given-names>G</given-names></name><name><surname>Kandel</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="1998">1998</year><article-title>Somadendritic backpropagation of action potentials in cortical pyramidal cells of the awake rat</article-title><source>Journal of Neurophysiology</source><volume>79</volume><fpage>1587</fpage><lpage>1591</lpage><pub-id pub-id-type="pmid">9497436</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Buzs√°ki</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Large-scale recording of neuronal ensembles</article-title><source>Nature Neuroscience</source><volume>7</volume><fpage>446</fpage><lpage>451</lpage><pub-id pub-id-type="doi">10.1038/nn1233</pub-id><pub-id pub-id-type="pmid">15114356</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cannon</surname> <given-names>RC</given-names></name><name><surname>Turner</surname> <given-names>DA</given-names></name><name><surname>Pyapali</surname> <given-names>GK</given-names></name><name><surname>Wheal</surname> <given-names>HV</given-names></name></person-group><year iso-8601-date="1998">1998</year><article-title>An on-line archive of reconstructed hippocampal neurons</article-title><source>Journal of Neuroscience Methods</source><volume>84</volume><fpage>49</fpage><lpage>54</lpage><pub-id pub-id-type="doi">10.1016/S0165-0270(98)00091-0</pub-id><pub-id pub-id-type="pmid">9821633</pub-id></element-citation></ref><ref id="bib9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chichilnisky</surname> <given-names>EJ</given-names></name></person-group><year iso-8601-date="2001">2001</year><article-title>A simple white noise analysis of neuronal light responses</article-title><source>Network</source><volume>12</volume><fpage>199</fpage><lpage>213</lpage><pub-id pub-id-type="pmid">11405422</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Covey</surname> <given-names>E</given-names></name><name><surname>Carter</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="2015">2015</year><source>Basic electrophysiological methods</source><publisher-name>Oxford University Press</publisher-name></element-citation></ref><ref id="bib11"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Cserp√°n</surname> <given-names>D</given-names></name></person-group><year iso-8601-date="2017">2017</year><data-title>Single cell kernel current source density</data-title><source>Github</source><version designator="301edcbca2f6b1a6a9e59e6d96a43505e508884c">301edcbca2f6b1a6a9e59e6d96a43505e508884c</version><ext-link ext-link-type="uri" xlink:href="https://github.com/csdori/skCSD">https://github.com/csdori/skCSD</ext-link></element-citation></ref><ref id="bib12"><element-citation publication-type="report"><person-group person-group-type="author"><name><surname>Denker</surname> <given-names>M</given-names></name><name><surname>Einevoll</surname> <given-names>G</given-names></name><name><surname>Franke</surname> <given-names>F</given-names></name><name><surname>Gr√ºn</surname> <given-names>S</given-names></name><name><surname>Hagen</surname> <given-names>E</given-names></name><name><surname>Kerr</surname> <given-names>J</given-names></name><name><surname>Nawrot</surname> <given-names>M</given-names></name><name><surname>Ness</surname> <given-names>TB</given-names></name><name><surname>Ritz</surname> <given-names>R</given-names></name><name><surname>Smith</surname> <given-names>L</given-names></name><name><surname>Wachtler</surname> <given-names>T</given-names></name><name><surname>W√≥jcik</surname> <given-names>D</given-names></name></person-group><year iso-8601-date="2014">2014</year><source>Report From the 1st INCF Workshop on Validation of Analysis Methods</source><publisher-name>Technical Report INCF</publisher-name></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Einevoll</surname> <given-names>GT</given-names></name><name><surname>Kayser</surname> <given-names>C</given-names></name><name><surname>Logothetis</surname> <given-names>NK</given-names></name><name><surname>Panzeri</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="2013">2013a</year><article-title>Modelling and analysis of local field potentials for studying the function of cortical circuits</article-title><source>Nature reviews. Neuroscience</source><volume>14</volume><fpage>770</fpage><lpage>785</lpage><pub-id pub-id-type="doi">10.1038/nrn3599</pub-id><pub-id pub-id-type="pmid">24135696</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Einevoll</surname> <given-names>GT</given-names></name><name><surname>Lind√©n</surname> <given-names>H</given-names></name><name><surname>Tetzlaff</surname> <given-names>T</given-names></name><name><surname>≈Åƒôski</surname> <given-names>S</given-names></name><name><surname>Pettersen</surname> <given-names>KH</given-names></name></person-group><year iso-8601-date="2013">2013b</year><chapter-title>Local field potential: biophysical origin and analysis</chapter-title><person-group person-group-type="editor"><name><surname>Quiroga</surname> <given-names>R. Q</given-names></name><name><surname>Panzeri</surname> <given-names>S</given-names></name></person-group><source>Principles of Neural Coding</source><fpage>37</fpage><lpage>59</lpage></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ferrea</surname> <given-names>E</given-names></name><name><surname>Maccione</surname> <given-names>A</given-names></name><name><surname>Medrihan</surname> <given-names>L</given-names></name><name><surname>Nieus</surname> <given-names>T</given-names></name><name><surname>Ghezzi</surname> <given-names>D</given-names></name><name><surname>Baldelli</surname> <given-names>P</given-names></name><name><surname>Benfenati</surname> <given-names>F</given-names></name><name><surname>Berdondini</surname> <given-names>L</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Large-scale, high-resolution electrophysiological imaging of field potentials in brain slices with microelectronic multielectrode arrays</article-title><source>Frontiers in Neural Circuits</source><volume>6</volume><elocation-id>80</elocation-id><pub-id pub-id-type="doi">10.3389/fncir.2012.00080</pub-id><pub-id pub-id-type="pmid">23162432</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Frey</surname> <given-names>U</given-names></name><name><surname>Egert</surname> <given-names>U</given-names></name><name><surname>Heer</surname> <given-names>F</given-names></name><name><surname>Hafizovic</surname> <given-names>S</given-names></name><name><surname>Hierlemann</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Microelectronic system for high-resolution mapping of extracellular electric fields applied to brain slices</article-title><source>Biosensors and Bioelectronics</source><volume>24</volume><fpage>2191</fpage><lpage>2198</lpage><pub-id pub-id-type="doi">10.1016/j.bios.2008.11.028</pub-id><pub-id pub-id-type="pmid">19157842</pub-id></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>G≈ÇƒÖbska</surname> <given-names>H</given-names></name><name><surname>Chintaluri</surname> <given-names>C</given-names></name><name><surname>W√≥jcik</surname> <given-names>DK</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Collection of Simulated Data from a Thalamocortical Network Model</article-title><source>Neuroinformatics</source><volume>15</volume><fpage>87</fpage><lpage>99</lpage><pub-id pub-id-type="doi">10.1007/s12021-016-9319-4</pub-id><pub-id pub-id-type="pmid">27837401</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>G≈ÇƒÖbska</surname> <given-names>H</given-names></name><name><surname>Potworowski</surname> <given-names>J</given-names></name><name><surname>≈Åƒôski</surname> <given-names>S</given-names></name><name><surname>W√≥jcik</surname> <given-names>DK</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Independent components of neural activity carry information on individual populations</article-title><source>PLoS One</source><volume>9</volume><elocation-id>e105071</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pone.0105071</pub-id><pub-id pub-id-type="pmid">25153730</pub-id></element-citation></ref><ref id="bib19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>G≈ÇƒÖbska</surname> <given-names>HT</given-names></name><name><surname>Norheim</surname> <given-names>E</given-names></name><name><surname>Devor</surname> <given-names>A</given-names></name><name><surname>Dale</surname> <given-names>AM</given-names></name><name><surname>Einevoll</surname> <given-names>GT</given-names></name><name><surname>W√≥jcik</surname> <given-names>DK</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Generalized laminar population analysis (glpa) for interpretation of multielectrode data from cortex</article-title><source>Frontiers in Neuroinformatics</source><volume>10</volume><elocation-id>1</elocation-id><pub-id pub-id-type="doi">10.3389/fninf.2016.00001</pub-id><pub-id pub-id-type="pmid">26834620</pub-id></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gold</surname> <given-names>C</given-names></name><name><surname>Henze</surname> <given-names>DA</given-names></name><name><surname>Koch</surname> <given-names>C</given-names></name><name><surname>Buzs√°ki</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>On the origin of the extracellular action potential waveform: A modeling study</article-title><source>Journal of Neurophysiology</source><volume>95</volume><fpage>3113</fpage><lpage>3128</lpage><pub-id pub-id-type="doi">10.1152/jn.00979.2005</pub-id><pub-id pub-id-type="pmid">16467426</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Hansen</surname> <given-names>P</given-names></name></person-group><year iso-8601-date="2010">2010</year><chapter-title>Society for Industrial and Applied Mathematics</chapter-title><source>Discrete Inverse Problems</source></element-citation></ref><ref id="bib22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Henze</surname> <given-names>DA</given-names></name><name><surname>Borhegyi</surname> <given-names>Z</given-names></name><name><surname>Csicsvari</surname> <given-names>J</given-names></name><name><surname>Mamiya</surname> <given-names>A</given-names></name><name><surname>Harris</surname> <given-names>KD</given-names></name><name><surname>Buzs√°ki</surname> <given-names>G</given-names></name></person-group><year iso-8601-date="2000">2000</year><article-title>Intracellular features predicted by extracellular recordings in the hippocampus in vivo</article-title><source>Journal of Neurophysiology</source><volume>84</volume><fpage>390</fpage><lpage>400</lpage><pub-id pub-id-type="pmid">10899213</pub-id></element-citation></ref><ref id="bib23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hottowy</surname> <given-names>P</given-names></name><name><surname>Skocze≈Ñ</surname> <given-names>A</given-names></name><name><surname>Gunning</surname> <given-names>DE</given-names></name><name><surname>Kachiguine</surname> <given-names>S</given-names></name><name><surname>Mathieson</surname> <given-names>K</given-names></name><name><surname>Sher</surname> <given-names>A</given-names></name><name><surname>WiƒÖcek</surname> <given-names>P</given-names></name><name><surname>Litke</surname> <given-names>AM</given-names></name><name><surname>DƒÖbrowski</surname> <given-names>W</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Properties and application of a multichannel integrated circuit for low-artifact, patterned electrical stimulation of neural tissue</article-title><source>Journal of Neural Engineering</source><volume>9</volume><elocation-id>066005</elocation-id><pub-id pub-id-type="doi">10.1088/1741-2560/9/6/066005</pub-id><pub-id pub-id-type="pmid">23160018</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>J√§ckel</surname> <given-names>D</given-names></name><name><surname>Bakkum</surname> <given-names>DJ</given-names></name><name><surname>Russell</surname> <given-names>TL</given-names></name><name><surname>M√ºller</surname> <given-names>J</given-names></name><name><surname>Radivojevic</surname> <given-names>M</given-names></name><name><surname>Frey</surname> <given-names>U</given-names></name><name><surname>Franke</surname> <given-names>F</given-names></name><name><surname>Hierlemann</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Combination of High-density Microelectrode Array and Patch Clamp Recordings to Enable Studies of Multisynaptic Integration</article-title><source>Scientific Reports</source><volume>7</volume><elocation-id>978</elocation-id><pub-id pub-id-type="doi">10.1038/s41598-017-00981-4</pub-id><pub-id pub-id-type="pmid">28428560</pub-id></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kerekes</surname> <given-names>BP</given-names></name><name><surname>T√≥th</surname> <given-names>K</given-names></name><name><surname>Kasz√°s</surname> <given-names>A</given-names></name><name><surname>Chiovini</surname> <given-names>B</given-names></name><name><surname>Szadai</surname> <given-names>Z</given-names></name><name><surname>Szalay</surname> <given-names>G</given-names></name><name><surname>P√°lfi</surname> <given-names>D</given-names></name><name><surname>Bag√≥</surname> <given-names>A</given-names></name><name><surname>Spitzer</surname> <given-names>K</given-names></name><name><surname>R√≥zsa</surname> <given-names>B</given-names></name><name><surname>Ulbert</surname> <given-names>I</given-names></name><name><surname>Wittner</surname> <given-names>L</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Combined two-photon imaging, electrophysiological, and anatomical investigation of the human neocortex in vitro</article-title><source>Neurophotonics</source><volume>1</volume><elocation-id>11013</elocation-id><pub-id pub-id-type="doi">10.1117/1.NPh.1.1.011013</pub-id><pub-id pub-id-type="pmid">26157969</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kong</surname> <given-names>JH</given-names></name><name><surname>Fish</surname> <given-names>DR</given-names></name><name><surname>Rockhill</surname> <given-names>RL</given-names></name><name><surname>Masland</surname> <given-names>RH</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Diversity of ganglion cells in the mouse retina: unsupervised morphological classification and its limits</article-title><source>The Journal of comparative neurology</source><volume>489</volume><fpage>293</fpage><lpage>310</lpage><pub-id pub-id-type="doi">10.1002/cne.20631</pub-id><pub-id pub-id-type="pmid">16025455</pub-id></element-citation></ref><ref id="bib27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kwan</surname> <given-names>M</given-names></name></person-group><year iso-8601-date="1962">1962</year><article-title>Graphic programming using odd or even points</article-title><source>Chinese Math</source><volume>1</volume><elocation-id>110</elocation-id></element-citation></ref><ref id="bib28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lewandowska</surname> <given-names>MK</given-names></name><name><surname>Radivojeviƒá</surname> <given-names>M</given-names></name><name><surname>J√§ckel</surname> <given-names>D</given-names></name><name><surname>M√ºller</surname> <given-names>J</given-names></name><name><surname>Hierlemann</surname> <given-names>AR</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Cortical Axons, Isolated in Channels, Display Activity-Dependent Signal Modulation as a Result of Targeted Stimulation</article-title><source>Frontiers in Neuroscience</source><volume>10</volume><elocation-id>83</elocation-id><pub-id pub-id-type="doi">10.3389/fnins.2016.00083</pub-id><pub-id pub-id-type="pmid">27013945</pub-id></element-citation></ref><ref id="bib29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>≈Åƒôski</surname> <given-names>S</given-names></name><name><surname>Kublik</surname> <given-names>E</given-names></name><name><surname>Swiejkowski</surname> <given-names>DA</given-names></name><name><surname>Wr√≥bel</surname> <given-names>A</given-names></name><name><surname>W√≥jcik</surname> <given-names>DK</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Extracting functional components of neural dynamics with Independent Component Analysis and inverse Current Source Density</article-title><source>Journal of Computational Neuroscience</source><volume>29</volume><fpage>459</fpage><lpage>473</lpage><pub-id pub-id-type="doi">10.1007/s10827-009-0203-1</pub-id><pub-id pub-id-type="pmid">20033271</pub-id></element-citation></ref><ref id="bib30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lind√©n</surname> <given-names>H</given-names></name><name><surname>Hagen</surname> <given-names>E</given-names></name><name><surname>Lƒôski</surname> <given-names>S</given-names></name><name><surname>Norheim</surname> <given-names>ES</given-names></name><name><surname>Pettersen</surname> <given-names>KH</given-names></name><name><surname>Einevoll</surname> <given-names>GT</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>LFPy: a tool for biophysical simulation of extracellular potentials generated by detailed model neurons</article-title><source>Frontiers in Neuroinformatics</source><volume>7</volume><elocation-id>41</elocation-id><pub-id pub-id-type="doi">10.3389/fninf.2013.00041</pub-id><pub-id pub-id-type="pmid">24474916</pub-id></element-citation></ref><ref id="bib31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lind√©n</surname> <given-names>H</given-names></name><name><surname>Pettersen</surname> <given-names>KH</given-names></name><name><surname>Einevoll</surname> <given-names>GT</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Intrinsic dendritic filtering gives low-pass power spectra of local field potentials</article-title><source>Journal of Computational Neuroscience</source><volume>29</volume><fpage>423</fpage><lpage>444</lpage><pub-id pub-id-type="doi">10.1007/s10827-010-0245-4</pub-id><pub-id pub-id-type="pmid">20502952</pub-id></element-citation></ref><ref id="bib32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>≈Åƒôski</surname> <given-names>S</given-names></name><name><surname>W√≥jcik</surname> <given-names>DK</given-names></name><name><surname>Tereszczuk</surname> <given-names>J</given-names></name><name><surname>Swiejkowski</surname> <given-names>DA</given-names></name><name><surname>Kublik</surname> <given-names>E</given-names></name><name><surname>Wr√≥bel</surname> <given-names>A</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Inverse current-source density method in 3D: reconstruction fidelity, boundary effects, and influence of distant sources</article-title><source>Neuroinformatics</source><volume>5</volume><fpage>207</fpage><lpage>222</lpage><pub-id pub-id-type="doi">10.1007/s12021-007-9000-z</pub-id><pub-id pub-id-type="pmid">18040890</pub-id></element-citation></ref><ref id="bib33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>≈Åƒôski</surname> <given-names>S</given-names></name><name><surname>Pettersen</surname> <given-names>KH</given-names></name><name><surname>Tunstall</surname> <given-names>B</given-names></name><name><surname>Einevoll</surname> <given-names>GT</given-names></name><name><surname>Gigg</surname> <given-names>J</given-names></name><name><surname>W√≥jcik</surname> <given-names>DK</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Inverse current source density method in two dimensions: inferring neural activation from multielectrode recordings</article-title><source>Neuroinformatics</source><volume>9</volume><fpage>401</fpage><lpage>425</lpage><pub-id pub-id-type="doi">10.1007/s12021-011-9111-4</pub-id><pub-id pub-id-type="pmid">21409556</pub-id></element-citation></ref><ref id="bib34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mechler</surname> <given-names>F</given-names></name><name><surname>Victor</surname> <given-names>JD</given-names></name><name><surname>Ohiorhenuan</surname> <given-names>I</given-names></name><name><surname>Schmid</surname> <given-names>AM</given-names></name><name><surname>Hu</surname> <given-names>Q</given-names></name></person-group><year iso-8601-date="2011">2011</year><article-title>Three-dimensional localization of neurons in cortical tetrode recordings</article-title><source>Journal of Neurophysiology</source><volume>106</volume><fpage>828</fpage><lpage>848</lpage><pub-id pub-id-type="doi">10.1152/jn.00515.2010</pub-id><pub-id pub-id-type="pmid">21613581</pub-id></element-citation></ref><ref id="bib35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mechler</surname> <given-names>F</given-names></name><name><surname>Victor</surname> <given-names>JD</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Dipole characterization of single neurons from their extracellular action potentials</article-title><source>Journal of Computational Neuroscience</source><volume>32</volume><fpage>73</fpage><lpage>100</lpage><pub-id pub-id-type="doi">10.1007/s10827-011-0341-0</pub-id><pub-id pub-id-type="pmid">21667156</pub-id></element-citation></ref><ref id="bib36"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mitzdorf</surname> <given-names>U</given-names></name></person-group><year iso-8601-date="1985">1985</year><article-title>Current source-density method and application in cat cerebral cortex: investigation of evoked potentials and EEG phenomena</article-title><source>Physiological Reviews</source><volume>65</volume><fpage>37</fpage><lpage>100</lpage><pub-id pub-id-type="pmid">3880898</pub-id></element-citation></ref><ref id="bib37"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Moulin</surname> <given-names>C</given-names></name><name><surname>Gli√®re</surname> <given-names>A</given-names></name><name><surname>Barbier</surname> <given-names>D</given-names></name><name><surname>Joucla</surname> <given-names>S</given-names></name><name><surname>Yvert</surname> <given-names>B</given-names></name><name><surname>Mailley</surname> <given-names>P</given-names></name><name><surname>Guillemaud</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>A new 3-D finite-element model based on thin-film approximation for microelectrode array recording of extracellular action potential</article-title><source>IEEE Transactions on Biomedical Engineering</source><volume>55</volume><fpage>683</fpage><lpage>692</lpage><pub-id pub-id-type="doi">10.1109/TBME.2007.903522</pub-id><pub-id pub-id-type="pmid">18270005</pub-id></element-citation></ref><ref id="bib38"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Muthmann</surname> <given-names>JO</given-names></name><name><surname>Amin</surname> <given-names>H</given-names></name><name><surname>Sernagor</surname> <given-names>E</given-names></name><name><surname>Maccione</surname> <given-names>A</given-names></name><name><surname>Panas</surname> <given-names>D</given-names></name><name><surname>Berdondini</surname> <given-names>L</given-names></name><name><surname>Bhalla</surname> <given-names>US</given-names></name><name><surname>Hennig</surname> <given-names>MH</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Spike Detection for Large Neural Populations Using High Density Multielectrode Arrays</article-title><source>Frontiers in Neuroinformatics</source><volume>9</volume><elocation-id>28</elocation-id><pub-id pub-id-type="doi">10.3389/fninf.2015.00028</pub-id><pub-id pub-id-type="pmid">26733859</pub-id></element-citation></ref><ref id="bib39"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Neher</surname> <given-names>E</given-names></name><name><surname>Sakmann</surname> <given-names>B</given-names></name></person-group><year iso-8601-date="1976">1976</year><article-title>Single-channel currents recorded from membrane of denervated frog muscle fibres</article-title><source>Nature</source><volume>260</volume><fpage>799</fpage><lpage>802</lpage><pub-id pub-id-type="pmid">1083489</pub-id></element-citation></ref><ref id="bib40"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ness</surname> <given-names>TV</given-names></name><name><surname>Chintaluri</surname> <given-names>C</given-names></name><name><surname>Potworowski</surname> <given-names>J</given-names></name><name><surname>≈Åƒôski</surname> <given-names>S</given-names></name><name><surname>G≈ÇƒÖbska</surname> <given-names>H</given-names></name><name><surname>W√≥jcik</surname> <given-names>DK</given-names></name><name><surname>Einevoll</surname> <given-names>GT</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Modelling and analysis of electrical potentials recorded in microelectrode arrays (MEAs)</article-title><source>Neuroinformatics</source><volume>13</volume><fpage>403</fpage><lpage>426</lpage><pub-id pub-id-type="doi">10.1007/s12021-015-9265-6</pub-id><pub-id pub-id-type="pmid">25822810</pub-id></element-citation></ref><ref id="bib41"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Neto</surname> <given-names>JP</given-names></name><name><surname>Lopes</surname> <given-names>G</given-names></name><name><surname>Fraz√£o</surname> <given-names>J</given-names></name><name><surname>Nogueira</surname> <given-names>J</given-names></name><name><surname>Lacerda</surname> <given-names>P</given-names></name><name><surname>Bai√£o</surname> <given-names>P</given-names></name><name><surname>Aarts</surname> <given-names>A</given-names></name><name><surname>Andrei</surname> <given-names>A</given-names></name><name><surname>Musa</surname> <given-names>S</given-names></name><name><surname>Fortunato</surname> <given-names>E</given-names></name><name><surname>Barquinha</surname> <given-names>P</given-names></name><name><surname>Kampff</surname> <given-names>AR</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Validating silicon polytrodes with paired juxtacellular recordings: method and dataset</article-title><source>Journal of Neurophysiology</source><volume>116</volume><fpage>892</fpage><lpage>903</lpage><pub-id pub-id-type="doi">10.1152/jn.00103.2016</pub-id><pub-id pub-id-type="pmid">27306671</pub-id></element-citation></ref><ref id="bib42"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nicholson</surname> <given-names>C</given-names></name><name><surname>Freeman</surname> <given-names>JA</given-names></name></person-group><year iso-8601-date="1975">1975</year><article-title>Theory of current source-density analysis and determination of conductivity tensor for anuran cerebellum</article-title><source>Journal of Neurophysiology</source><volume>38</volume><fpage>356</fpage><lpage>368</lpage><pub-id pub-id-type="pmid">805215</pub-id></element-citation></ref><ref id="bib43"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Obien</surname> <given-names>ME</given-names></name><name><surname>Deligkaris</surname> <given-names>K</given-names></name><name><surname>Bullmann</surname> <given-names>T</given-names></name><name><surname>Bakkum</surname> <given-names>DJ</given-names></name><name><surname>Frey</surname> <given-names>U</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Revealing neuronal function through microelectrode array recordings</article-title><source>Frontiers in Neuroscience</source><volume>8</volume><elocation-id>423</elocation-id><pub-id pub-id-type="doi">10.3389/fnins.2014.00423</pub-id><pub-id pub-id-type="pmid">25610364</pub-id></element-citation></ref><ref id="bib44"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Oppenheim</surname> <given-names>AV</given-names></name></person-group><person-group person-group-type="author"><name><surname>Willsky</surname> <given-names>A</given-names></name></person-group><person-group person-group-type="author"><name><surname>Nawab</surname> <given-names>S</given-names></name></person-group><year iso-8601-date="1997">1997</year><source>Signals and Systems</source><edition>2nd edition</edition><publisher-loc>New Jersey</publisher-loc><publisher-name>Prentice Hall</publisher-name></element-citation></ref><ref id="bib45"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pettersen</surname> <given-names>KH</given-names></name><name><surname>Devor</surname> <given-names>A</given-names></name><name><surname>Ulbert</surname> <given-names>I</given-names></name><name><surname>Dale</surname> <given-names>AM</given-names></name><name><surname>Einevoll</surname> <given-names>GT</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Current-source density estimation based on inversion of electrostatic forward solution: effects of finite extent of neuronal activity and conductivity discontinuities</article-title><source>Journal of Neuroscience Methods</source><volume>154</volume><fpage>116</fpage><lpage>133</lpage><pub-id pub-id-type="doi">10.1016/j.jneumeth.2005.12.005</pub-id><pub-id pub-id-type="pmid">16436298</pub-id></element-citation></ref><ref id="bib46"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Pitts</surname> <given-names>WH</given-names></name></person-group><year iso-8601-date="1952">1952</year><chapter-title>Investigations on synaptic transmission</chapter-title><person-group person-group-type="editor"><name><surname>Von Foerster</surname> <given-names>H</given-names></name></person-group><source>Cybernetics: Transactions of the 9th Conference</source><publisher-loc>New York</publisher-loc><publisher-name>Josiah Macy Foundation</publisher-name><fpage>159</fpage><lpage>166</lpage></element-citation></ref><ref id="bib47"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Potworowski</surname> <given-names>J</given-names></name><name><surname>Jakuczun</surname> <given-names>W</given-names></name><name><surname>≈Åƒôski</surname> <given-names>S</given-names></name><name><surname>W√≥jcik</surname> <given-names>D</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Kernel current source density method</article-title><source>Neural Computation</source><volume>24</volume><fpage>541</fpage><lpage>575</lpage><pub-id pub-id-type="doi">10.1162/NECO_a_00236</pub-id><pub-id pub-id-type="pmid">22091662</pub-id></element-citation></ref><ref id="bib48"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rey</surname> <given-names>HG</given-names></name><name><surname>Pedreira</surname> <given-names>C</given-names></name><name><surname>Quian Quiroga</surname> <given-names>R</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Past, present and future of spike sorting techniques</article-title><source>Brain Research Bulletin</source><volume>119</volume><fpage>106</fpage><lpage>117</lpage><pub-id pub-id-type="doi">10.1016/j.brainresbull.2015.04.007</pub-id><pub-id pub-id-type="pmid">25931392</pub-id></element-citation></ref><ref id="bib49"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Sch√∂lkopf</surname> <given-names>B</given-names></name><name><surname>Smola</surname> <given-names>AJ</given-names></name></person-group><year iso-8601-date="2002">2002</year><source>Learning with Kernels: Support Vector Machines, Regularization, Optimization, and Beyond</source><publisher-name>MIT press</publisher-name></element-citation></ref><ref id="bib50"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Somogyv√°ri</surname> <given-names>Z</given-names></name><name><surname>Benk≈ë</surname> <given-names>Z</given-names></name><name><surname>J√°lics</surname> <given-names>JZ</given-names></name><name><surname>Roux</surname> <given-names>L</given-names></name><name><surname>Antal</surname> <given-names>B</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Determination of spatio- temporal input current patterns of single hippocampal neurons based on extracellular potential measurements</article-title><source>Program No. 267.02 2015 Neuroscience Meeting Planner. Washington, DC: Society for Neuroscience 2015. Online</source></element-citation></ref><ref id="bib51"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Somogyv√°ri</surname> <given-names>Z</given-names></name><name><surname>Cserp√°n</surname> <given-names>D</given-names></name><name><surname>Ulbert</surname> <given-names>I</given-names></name><name><surname>Erdi</surname> <given-names>P</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Localization of single-cell current sources based on extracellular potential patterns: the spike CSD method</article-title><source>European Journal of Neuroscience</source><volume>36</volume><fpage>3299</fpage><lpage>3313</lpage><pub-id pub-id-type="doi">10.1111/j.1460-9568.2012.08249.x</pub-id><pub-id pub-id-type="pmid">22934892</pub-id></element-citation></ref><ref id="bib52"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Somogyv√°ri</surname> <given-names>Z</given-names></name><name><surname>Zal√°nyi</surname> <given-names>L</given-names></name><name><surname>Ulbert</surname> <given-names>I</given-names></name><name><surname>Erdi</surname> <given-names>P</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Model-based source localization of extracellular action potentials</article-title><source>Journal of Neuroscience Methods</source><volume>147</volume><fpage>126</fpage><lpage>137</lpage><pub-id pub-id-type="doi">10.1016/j.jneumeth.2005.04.002</pub-id><pub-id pub-id-type="pmid">15913782</pub-id></element-citation></ref><ref id="bib53"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Vapnik</surname> <given-names>V</given-names></name></person-group><year iso-8601-date="1998">1998</year><source>Statistical Learning Theory</source><publisher-loc>New York</publisher-loc><publisher-name>Wiley</publisher-name></element-citation></ref><ref id="bib54"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>W√≥jcik</surname> <given-names>DK</given-names></name></person-group><year iso-8601-date="2015">2015</year><chapter-title>Current Source Density (CSD) Analysis</chapter-title><person-group person-group-type="editor"><name><surname>Jaeger</surname> <given-names>D</given-names></name><name><surname>Jung</surname> <given-names>R</given-names></name></person-group><source>Encyclopedia of Computational Neuroscience</source><fpage>915</fpage><lpage>922</lpage></element-citation></ref></ref-list></back><sub-article article-type="decision-letter" id="SA1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.29384.024</article-id><title-group><article-title>Decision letter</article-title></title-group><contrib-group><contrib contrib-type="editor"><name><surname>Skinner</surname><given-names>Frances K</given-names></name><role>Reviewing Editor</role><aff><institution>Krembil Research Institute, University Health Network</institution><country>Canada</country></aff></contrib></contrib-group></front-stub><body><boxed-text><p>In the interests of transparency, eLife includes the editorial decision letter and accompanying author responses. A lightly edited version of the letter sent to the authors after peer review is shown, indicating the most substantive concerns; minor comments are not usually included.</p></boxed-text><p>Thank you for submitting your article &quot;Revealing the Distribution of Transmembrane Currents along the Dendritic Tree of a Neuron from Extracellular Recordings&quot; for consideration by <italic>eLife</italic>. Your article has been favorably evaluated by Richard Aldrich (Senior Editor) and three reviewers, one of whom, Frances Skinner, is a member of our Board of Reviewing Editors. The following individuals involved in review of your submission have agreed to reveal their identity: Alexandra Chatzikalymniou (Reviewer #1), Joshua Goldwyn (Reviewer #2); Michiel Remme (Reviewer #3).</p><p>The reviewers have discussed the reviews with one another and the Reviewing Editor has drafted this decision to help you prepare a revised submission.</p><p>This paper introduces a novel method to estimate current sources underlying extracellular recorded voltages. The method relies on a combination of kernel CSD analysis of the extracellular potential recordings and knowledge of the morphology of a neuron close to the recording electrodes. Assuming one is able to isolate the contribution of this one cell to the extracellular potentials, this method can map the current sources onto this cell. The method was validated against arbitrary morphologies and electrode configurations simulating biologically relevant scenarios from simple (ball and stick and Y shape neuron) to more complicated (ganglion cell model). It is thought that this method has great potential and should be interesting to many neurophysiologists as it allows for significantly improved reconstructions of the current source density distribution along a cell morphology.</p><p>However, the reviewers noted various aspects that need to be addressed.</p><p>Essential revisions:</p><p>1) The code needs to be included and not just upon request.</p><p>Please see the information on <italic>eLife</italic> website regarding Tools and Resources papers: https://submit.elifesciences.org/html/<italic>eLife</italic>_author_instructions.html#types</p><p>&quot;‚Ä¶relevant code must conform to the Open Source Definition and be deposited in an appropriate public repository; and methodological advances need to be comprehensibly described‚Ä¶&quot;</p><p>2) The authors need to edit their paper in the following ways:</p><p>a) Overall editing of the paper is needed.</p><p>There are numerous spelling errors and especially the articles before many nouns are missing. Much more proofreading of the text is recommended as part of the overall revisions.</p><p>b) Bring forth the significance/importance/need for their work earlier. For example, the last section of the Discussion ('importance of this work') could be moved to the beginning of the paper.</p><p>c) Edit and expand writing to be more accessible, to be more understandable to the general reader, and to avoid confusion in what is meant.</p><p>Specifically: i) Since this paper introduces a new methodology, and most readers will not have a e.g. machine learning background, I believe the paper needs to improve the explanation of the methodology, and not just in the Materials and methods, but throughout the paper. Clearly the authors have already attempted to make it readable to non-experts, but I would specifically recommend the following:</p><p>- At the beginning of the results, a summary of the method should be included. That is, present the method in a &quot;self-contained&quot; way so that the reader does not need to 'walk through' several methods (kCSD, sCSD, skCSD) and remarks on the innovations in each &quot;iteration&quot; as given in the Materials and methods at end of the paper.</p><p>- It should be possible to read the paper from beginning to end without running into terms that have not been defined yet (e.g. subsection ‚ÄúDependence of reconstruction on noise level‚Äù: 'regularization'; subsection ‚ÄúDependence of reconstruction on the number and arrangement of Recording Electrodes‚Äù, third paragraph: 'the width of the basis functions'; 'the cross-validation error').</p><p>- In the Materials and methods: some intuition for the kernel method should be given (and not by referring to another paper). Why would one 'avoid direct estimation of coefficients a_j'?. What is gained with the kernel trick? One will have to estimate fewer parameters, but how does that come about? Does this rely on specific assumptions?</p><p>ii) Is it meaningful to make comparisons to interpolated voltage method or kCSD method? These methods are not, to my knowledge, designed or expected to have resolution at the single cell (or subcellular level) ‚Äì well, I suppose the resolution is determined by the electrode grid, but in any case it is not clear to me that readers would assume that these methods &quot;should&quot; be able to resolve branch points or other information local to a dendritic tree. Edit/expand the manuscript to make clear what is meant.</p><p>iii) ‚ÄúProof of concept experiment‚Äù. I am confused by this section. The authors go into detail describing the spatial and dynamical features of the inferred transmembrane currents. But then they seem to nullify their observations and the usefulness of their method when they write &quot;From an experimental setup consisting of only 14 electrodes on a linear probe a detailed distribution of current sources along a complex morphology cannot be expected&quot;. Then, they write &quot;but the firing activity is well observable&quot; ‚Äì but this point is not novel or contested. Indeed, spike identification from multi-electrode recordings is a common data analysis task, and not the (apparent) point of the method presented here.</p><p>See also paragraph in Discussion beginning: &quot;The skCSD method performed adequately for the proof of concept experimental data&quot;. I don't feel this is justified, without further clarification of the message in the subsection ‚ÄúProof of Concept experiment: Spatial Current Source Distribution of Spike-triggered Averages‚Äù. Edit/expand the manuscript to make clear what is meant.</p><p>iv)‚ÄúTo test the effect of branching on the results, a simple Y-shaped morphology was used (<xref ref-type="fig" rid="fig11">Figure 11B</xref>). [‚Ä¶] The first was stimulated at 5, 45, 60 ms, the other at 5, 25, 60 ms after the onset of the simulation.‚Äù Why choose these arbitrary stimulation times? Why are the synapses activated in this specific temporal sequence? It would be interesting to know what the temporal resolution of the technique is. Also, how would the performance of the technique change for different degrees of correlation of synaptic inputs? Edit/expand the manuscript to address reasoning/rationale of these questions.</p><p>v)‚ÄúAs a realistic example, we used a mouse retinal ganglion cell morphology Kong et al. (2005) from NeuroMorpho.Org Ascoli (2006). [‚Ä¶] The cell was also driven with an oscillatory current. In the dendrites, only passive ion channels were used.‚Äù What is the frequency of the oscillatory input and its effect? They do say approximately 6.5Hz (line 175), but it would to helpful to know about different frequencies (say higher Œ≥ frequencies) and/or discuss it. How does the separation sensitivity of current sources depend on the frequency of the oscillatory input used? The validity of the technique should be tested for different oscillatory frequencies so that potential users keep in mind how the performance of current sources separation may vary as a function of input frequency. Is the separation of synaptic inputs equally successful for lower and higher synaptic input frequencies? As users will likely need to reveal current sources of different oscillatory input frequencies this information would be important to present. Edit/expand the manuscript to do and/or discuss these aspects.</p><p>vi) The Introduction (third paragraph) suggested to me that the current injection to the cell is exploited in this new method. However, this idea does not seem to be very central throughout the paper. Perhaps this could be stated more clearly.</p><p>3) Estimating parameters in real experiments.</p><p>The authors suggest using a modeling approach to generate data and optimize the parameters and then use these parameters for the actual data.</p><p>- First of all, from the <xref ref-type="fig" rid="fig8">Figure 8</xref> results it seems the CV error is pretty good (though what is the CV error for case H?). Why not just use that? It would be informative if the authors illustrate how different the CSD estimates are when using the CV error instead of the L1 error in <xref ref-type="fig" rid="fig9">Figure 9</xref>.</p><p>- My main concern with using the modeling approach (L1 error) is that the active properties of the neuron are not known sufficiently well. But I would expect that the presence of active currents (e.g. sodium, calcium, NMDA spikes, but also subthreshold active currents) would have a significant impact on the parameter estimates (R, Œª etc.), compared to the parameters for a passive model (see suggestion in the subsection ‚ÄúExperimental Recommendations‚Äù). The authors should explore this, i.e. show how parameter estimates vary when considering a passive versus some variations of active models. There are various detailed hippocampal pyramidal cell models in modelDB from which the authors could use the active properties for their cell reconstruction and compare the obtained skCSD parameters with those obtained from a passive model.</p><p>- In general, the effects of the parameters Œª, R and M are not properly discussed. How strongly do they affect the CSD estimates?</p></body></sub-article><sub-article article-type="reply" id="SA2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.29384.025</article-id><title-group><article-title>Author response</article-title></title-group></front-stub><body><disp-quote content-type="editor-comment"><p>Essential revisions:</p><p>1) The code needs to be included and not just upon request.</p><p>Please see the information on eLife website regarding Tools and Resources papers: https://submit.elifesciences.org/html/eLife_author_instructions.html#types</p><p>&quot;‚Ä¶relevant code must conform to the Open Source Definition and be deposited in an appropriate public repository; and methodological advances need to be comprehensibly described‚Ä¶&quot;</p></disp-quote><p>We have now placed the code at https://github.com/csdori/skCSD. This is described in the manuscript.</p><disp-quote content-type="editor-comment"><p>2) The authors need to edit their paper in the following ways:</p><p>a) Overall editing of the paper is needed.</p><p>There are numerous spelling errors and especially the articles before many nouns are missing. Much more proofreading of the text is recommended as part of the overall revisions.</p></disp-quote><p>We have gone through the whole manuscript to improve the quality of the text. We hope it is now easier to read.</p><disp-quote content-type="editor-comment"><p>b) Bring forth the significance/importance/need for their work earlier. For example, the last section of the Discussion ('importance of this work') could be moved to the beginning of the paper.</p></disp-quote><p>We have kept the last section where it was but we added some sentences emphasizing importance of this work in the Introduction.</p><disp-quote content-type="editor-comment"><p>c) Edit and expand writing to be more accessible, to be more understandable to the general reader, and to avoid confusion in what is meant.</p><p>Specifically: i) Since this paper introduces a new methodology, and most readers will not have a e.g. machine learning background, I believe the paper needs to improve the explanation of the methodology, and not just in the Materials and methods, but throughout the paper. Clearly the authors have already attempted to make it readable to non-experts, but I would specifically recommend the following:</p><p>- At the beginning of the results, a summary of the method should be included. That is, present the method in a &quot;self-contained&quot; way so that the reader does not need to 'walk through' several methods (kCSD, sCSD, skCSD) and remarks on the innovations in each &quot;iteration&quot; as given in the Materials and methods at end of the paper.</p><p>- It should be possible to read the paper from beginning to end without running into terms that have not been defined yet (e.g. subsection ‚ÄúDependence of reconstruction on noise level‚Äù: 'regularization'; subsection ‚ÄúDependence of reconstruction on the number and arrangement of Recording Electrodes‚Äù, third paragraph: 'the width of the basis functions'; 'the cross-validation error').</p><p>- In the Materials and methods: some intuition for the kernel method should be given (and not by referring to another paper). Why would one 'avoid direct estimation of coefficients a_j'?. What is gained with the kernel trick? One will have to estimate fewer parameters, but how does that come about? Does this rely on specific assumptions?</p></disp-quote><p>We added a new section ‚ÄúSingle cell kernel Current Source Density method, a high-level overview‚Äù at the beginning of Results where we address these points. We feel rather satisfied with the way we have addressed the first two points above, less so with the third. We found it challenging to build simple intuitions of why the kernel methods work as they do. However, we are willing to further expand this point if the reviewers feel this would benefit the readers.</p><disp-quote content-type="editor-comment"><p>ii) Is it meaningful to make comparisons to interpolated voltage method or kCSD method? These methods are not, to my knowledge, designed or expected to have resolution at the single cell (or subcellular level) ‚Äì well, I suppose the resolution is determined by the electrode grid, but in any case it is not clear to me that readers would assume that these methods &quot;should&quot; be able to resolve branch points or other information local to a dendritic tree. Edit/expand the manuscript to make clear what is meant.</p></disp-quote><p>We added a paragraph discussing this point. We feel that without the method proposed here, the most natural approach to analyze current sources is through use of the regular, population CSD. Such an approach was used, for example, to investigate the changing distribution of current sources during action potential generation using data from high-definition MEA (Frey et al., 2009). What we show is that while CSD (kCSD) and skCSD are consistent, using the additional information about morphology renders significantly more detail of the activity studied.</p><disp-quote content-type="editor-comment"><p>iii) ‚ÄúProof of concept experiment‚Äù. I am confused by this section. The authors go into detail describing the spatial and dynamical features of the inferred transmembrane currents. But then they seem to nullify their observations and the usefulness of their method when they write &quot;From an experimental setup consisting of only 14 electrodes on a linear probe a detailed distribution of current sources along a complex morphology cannot be expected&quot;. Then, they write &quot;but the firing activity is well observable&quot; ‚Äì but this point is not novel or contested. Indeed, spike identification from multi-electrode recordings is a common data analysis task, and not the (apparent) point of the method presented here.</p><p>See also paragraph in Discussion beginning: &quot;The skCSD method performed adequately for the proof of concept experimental data&quot;. I don't feel this is justified, without further clarification of the message in the subsection ‚ÄúProof of Concept experiment: Spatial Current Source Distribution of Spike-triggered Averages‚Äù. Edit/expand the manuscript to make clear what is meant.</p></disp-quote><p>We have rewritten this section. Part of confusion stemmed from of our attempt to indicate the limitation of the method when applied to data from a small number of electrodes. We now added a new section in the Discussion, General observations, where we address this and other points raised by the referees.</p><disp-quote content-type="editor-comment"><p>iv) ‚ÄúTo test the effect of branching on the results, a simple Y-shaped morphology was used (<xref ref-type="fig" rid="fig11">Figure 11B</xref>). [‚Ä¶] The first was stimulated at 5, 45, 60 ms, the other at 5, 25, 60 ms after the onset of the simulation.‚Äù Why choose these arbitrary stimulation times? Why are the synapses activated in this specific temporal sequence? It would be interesting to know what the temporal resolution of the technique is. Also, how would the performance of the technique change for different degrees of correlation of synaptic inputs? Edit/expand the manuscript to address reasoning/rationale of these questions.</p></disp-quote><p>The idea here was to consider the inputs stimulated together and separately. The times of activation were randomly selected in such a way to leave enough time for the membrane activity to settle down. This can be viewed as extreme cases of correlated and uncorrelated events. The skCSD reconstruction is not affected directly by the temporal correlation of the synaptic inputs. Just like any CSD estimation method, skCSD is applied to the potentials recorded at a given point in time. Of course, it is affected indirectly in the sense that slower or faster oscillating inputs lead to different spatial patterns due to filtering effects of the dendritic membrane: fast oscillations induce short dipoles, slow oscillations allow the current to spread along the cell leading to stronger dipoles. We address these effects indirectly with the figure studying the reconstruction of Fourier CSD patterns of increasing spatial frequency. We mention it now in the text.</p><disp-quote content-type="editor-comment"><p>v) ‚ÄúAs a realistic example, we used a mouse retinal ganglion cell morphology Kong et al. (2005) from NeuroMorpho.Org Ascoli (2006). [‚Ä¶] The cell was also driven with an oscillatory current. In the dendrites, only passive ion channels were used.‚Äù What is the frequency of the oscillatory input and its effect? They do say approximately 6.5Hz (line 175), but it would to helpful to know about different frequencies (say higher Œ≥ frequencies) and/or discuss it. How does the separation sensitivity of current sources depend on the frequency of the oscillatory input used? The validity of the technique should be tested for different oscillatory frequencies so that potential users keep in mind how the performance of current sources separation may vary as a function of input frequency. Is the separation of synaptic inputs equally successful for lower and higher synaptic input frequencies? As users will likely need to reveal current sources of different oscillatory input frequencies this information would be important to present. Edit/expand the manuscript to do and/or discuss these aspects.</p></disp-quote><p>This question relates to the previous one. While we feel this is an important question, we would rather not pursue this direction of study here, because we feel it would sidetrack the reader. It is true that different types of stimulation, be it by the experimenter or through correlated synaptic activity, will induce different spatio-temporal membrane activity. Since skCSD takes potentials at a given moment in time, what matters is a specific distribution of details that need to be resolved. From the perspective of the viability of the method it is secondary how exactly any specific distribution arose. We return to this point below illustrating it further with new figures.</p><disp-quote content-type="editor-comment"><p>vi) The Introduction (third paragraph) suggested to me that the current injection to the cell is exploited in this new method. However, this idea does not seem to be very central throughout the paper. Perhaps this could be stated more clearly.</p></disp-quote><p>This was a remnant of our initial discussions, an experiment we considered when starting the work on the method. We have now rewritten this part to better explain that what we really need is a morphology of a neuron and a set of simultaneous extracellular recordings, which may be obtained with different experiments.</p><disp-quote content-type="editor-comment"><p>3) Estimating parameters in real experiments.</p><p>The authors suggest using a modeling approach to generate data and optimize the parameters and then use these parameters for the actual data.</p><p>- First of all, from the <xref ref-type="fig" rid="fig8">Figure 8</xref> results it seems the CV error is pretty good (though what is the CV error for case H?). Why not just use that? It would be informative if the authors illustrate how different the CSD estimates are when using the CV error instead of the L1 error in <xref ref-type="fig" rid="fig9">Figure 9</xref>.</p><p>- My main concern with using the modeling approach (L1 error) is that the active properties of the neuron are not known sufficiently well. But I would expect that the presence of active currents (e.g. sodium, calcium, NMDA spikes, but also subthreshold active currents) would have a significant impact on the parameter estimates (R, Œª etc.), compared to the parameters for a passive model (see suggestion in the subsection ‚ÄúExperimental Recommendations‚Äù). The authors should explore this, i.e. show how parameter estimates vary when considering a passive versus some variations of active models. There are various detailed hippocampal pyramidal cell models in modelDB from which the authors could use the active properties for their cell reconstruction and compare the obtained skCSD parameters with those obtained from a passive model.</p></disp-quote><p>Regarding the first point. Indeed, that is a good point. We did consider that, however, our studies indicated overall better results for the approach we recommended (L1). It is true that often the differences were not so great, so in experimental practice it might well be easier without much loss to apply CV error for parameter selection. Indeed, that is what we often do in kCSD applications. We have modified the text to address this. In Author response image 1we include figures from our original studies, left for L1, right for CV error, for the same moment of the cell model activity as in the paper; ignore the errors shown in the corner of each figure, they are not compatible (the rights shows L1 error ‚Äì similarity ‚Äì for the solutions obtained with CV). There is more. However, which can be done with considering different CSD distributions on a morphology, computing extracellular potential and reconstructions. This procedure allows one to better understand which features are recovered and which are mingled.</p><fig id="respfig1"><object-id pub-id-type="doi">10.7554/eLife.29384.019</object-id><label>Author response image 1.</label><caption/><graphic mime-subtype="png" mimetype="image" xlink:href="elife-29384-resp-fig1-v2"/></fig><p>We now address here the questions and comments from the second point but relate also to point iv and v above, as we believe the underlying phenomena are similar, all address the problem of reconstructing varying spatio-temporal electrophysiological mechanisms.</p><p>First observe, that in order to investigate the quality of reconstruction using L1 error one does not need to assume any specific composition of the membrane, ion channels, etc. We only need to place specific set of sources given by some function we specify. From that we can easily compute extracellular potential, which is enough to do the reconstruction which can in turn be compared with the original. This can be done many times for different GT distributions which allows one to study the quality of reconstruction for a given setup, which features are resolved, how well, etc. This is essentially what we do below. This was mentioned in the paper but we now have tried to explain it better.</p><p>Regarding your specific suggestion, the advantage of using regular simulation, with specific composition of the membrane, has obvious advantages as it allows to simulate more physiological distributions. The disadvantage is that we typically do not know the model composition. Although there are plenty neuron models available for download with more complex membrane current mechanisms than we used, a proper study of the various phenomena you mentioned would have exceeded our capacity within the resubmission time. The main differences in the examples presented in the paper and those which might arise in simulations with e.g. various oscillatory input currents, ion-channels and NMDA spikes, would originate from the broader range of spatio-temporal variability in membrane current source density distribution.</p><p>We argued earlier, that the temporal resolution depends only on the sampling frequency of the electrode recording system, which is why we focus on the effects of the spatial resolution. To this end we distributed different Gaussian current source patterns on both branches and the stem of the Y-shaped neuron using different parameters: height, width and location, with one Gaussian source on each branch. The motivation was to simulate a wide range of membrane current patterns, which could represent diverse membrane processes. The temporal evolution of these patterns was not taken into account as the spatial resolution is independent. The reconstructions and the ground truth are shown in the interval representation of the 40 patterns along the segments. <xref ref-type="fig" rid="respfig2">Author response image 2</xref> shows the ground truth membrane current distribution, reconstructions from 4x4 and 4x16 electrodes and the calculated L1 errors for each pattern. One set of parameters was selected based on the L1 error for all the patterns and although with more electrodes the skCSD method performs better, narrow patterns are nevertheless strongly smoothed in space (e.g. patterns 27-30). In conclusion, there is a limit to the spatial resolution of the method, membrane current mechanisms with peaky spatial distributions will appear as wider but lower amplitude phenomena.</p><fig id="respfig2"><object-id pub-id-type="doi">10.7554/eLife.29384.020</object-id><label>Author response image 2.</label><caption><title>40 current source density distribution patterns on the Y-shaped morphology: ground truth, skCSD reconstruction from 4x4 and 4x16 electrodes, and the L1 error for each pattern.</title><p>The optimal parameters for the skCSD reconstruction were chosen by cross-validation for the whole series of patterns. The reconstruction error is higher for patterns with sharp peaks, in this case the skCSD method smooths these peaks in space.</p></caption><graphic mime-subtype="png" mimetype="image" xlink:href="elife-29384-resp-fig2-v2"/></fig><disp-quote content-type="editor-comment"><p>- In general, the effects of the parameters Œª, R and M are not properly discussed. How strongly do they affect the CSD estimates?</p></disp-quote><p>In general, the larger the basis the better. Ideally we would like to have infinite basis with Gaussians distributed smoothly parametrized with position on the morphology. However, it is computationally expensive to use a large basis, so there is a trade-off between the number of CSD features we wish to reconstruct and our patience and computational power. The width of the basis function also has an impact on the spatial resolution of the method, so in the paper we focused on optimising only one of these parameters. To investigate reconstruction quality in the parameter space set by the number of basis functions (M), basis function width (R) and regularization parameter (Œª), we used the simulation setup for Y-shaped morphology with 4x4 electrodes as described in the paper. <xref ref-type="fig" rid="respfig3">Author response image 3</xref> shows the color-coded L1 reconstruction error for M = 32, 128, 512, 1024 when R = 8, 16, 32, 64, 128, and Œª = 1e-5, 1e-4, 1e-3, 1e-2, 1e-1. As expected, 32 basis functions are not enough for a good estimation, but in case of 512 and 1024 basis functions the error map gets similar, although the latter case provides slightly better estimation.</p><fig id="respfig3"><object-id pub-id-type="doi">10.7554/eLife.29384.021</object-id><label>Author response image 3.</label><caption><title>We used the Y-shaped morphology and the 4x4 electrode setup to investigate the effect of using various basis numbers for the reconstruction.</title><p>L1 error was calculated to compare the results for basis with 32, 128, 256, 512, 1024 elements (M), for several values of basis width (R) and Œª. As shown, using few and narrow basis functions can lead to poor reconstruction, but covering the morphology with a sufficient number of basis functions of reasonable width (on the order of L/M with L being the total dendritic length) significantly improves the reconstruction (reduces the error).</p></caption><graphic mime-subtype="png" mimetype="image" xlink:href="elife-29384-resp-fig3-v2"/></fig></body></sub-article></article>