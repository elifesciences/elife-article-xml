<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.1d3 20150301//EN"  "JATS-archivearticle1.dtd"><article article-type="research-article" dtd-version="1.1d3" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="hwp">eLife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn pub-type="epub" publication-format="electronic">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">17219</article-id><article-id pub-id-type="doi">10.7554/eLife.17219</article-id><article-categories><subj-group subj-group-type="heading"><subject>Biophysics and Structural Biology</subject></subj-group><subj-group subj-group-type="heading"><subject>Computational and Systems Biology</subject></subj-group><subj-group subj-group-type="display-channel"><subject>Tools and Resources</subject></subj-group></article-categories><title-group><article-title>Automated structure refinement of macromolecular assemblies from cryo-EM maps using Rosetta</article-title></title-group><contrib-group><contrib contrib-type="author" id="author-54919"><name><surname>Wang</surname><given-names>Ray Yu-Ruei</given-names></name><contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-5025-9596</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/><xref ref-type="fn" rid="pa1">†</xref></contrib><contrib contrib-type="author" id="author-57088"><name><surname>Song</surname><given-names>Yifan</given-names></name><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf2"/><xref ref-type="fn" rid="pa2">‡</xref></contrib><contrib contrib-type="author" id="author-41580"><name><surname>Barad</surname><given-names>Benjamin A</given-names></name><contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-1016-862X</contrib-id><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="aff" rid="aff4">4</xref><xref ref-type="fn" rid="con3"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-13290"><name><surname>Cheng</surname><given-names>Yifan</given-names></name><xref ref-type="aff" rid="aff5">5</xref><xref ref-type="aff" rid="aff6">6</xref><xref ref-type="other" rid="par-1"/><xref ref-type="other" rid="par-2"/><xref ref-type="other" rid="par-3"/><xref ref-type="fn" rid="con4"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" id="author-40263"><name><surname>Fraser</surname><given-names>James S</given-names></name><contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-5080-2859</contrib-id><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="other" rid="par-4"/><xref ref-type="other" rid="par-5"/><xref ref-type="fn" rid="con5"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author" corresp="yes" id="author-56180"><name><surname>DiMaio</surname><given-names>Frank</given-names></name><contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-7524-8938</contrib-id><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="aff" rid="aff7">7</xref><xref ref-type="corresp" rid="cor1">*</xref><xref ref-type="fn" rid="con6"/><xref ref-type="fn" rid="conf1"/></contrib><aff id="aff1"><label>1</label><institution content-type="dept">Graduate Program in Biological Physics, Structure and Design</institution>, <institution>University of Washington</institution>, <addr-line><named-content content-type="city">Seattle</named-content></addr-line>, <country>United States</country></aff><aff id="aff2"><label>2</label><institution content-type="dept">Department of Biochemistry</institution>, <institution>University of Washington</institution>, <addr-line><named-content content-type="city">Seattle</named-content></addr-line>, <country>United States</country></aff><aff id="aff3"><label>3</label><institution content-type="dept">Department of Bioengineering and Therapeutic Science</institution>, <institution>University of California, San Francisco</institution>, <addr-line><named-content content-type="city">San Francisco</named-content></addr-line>, <country>United States</country></aff><aff id="aff4"><label>4</label><institution content-type="dept">Graduate Group in Biophysics</institution>, <institution>University of California, San Francisco</institution>, <addr-line><named-content content-type="city">San Francisco</named-content></addr-line>, <country>United States</country></aff><aff id="aff5"><label>5</label><institution content-type="dept">Keck Advanced Microscopy Laboratory</institution>, <institution>University of California, San Francisco</institution>, <addr-line><named-content content-type="city">San Francisco</named-content></addr-line>, <country>United States</country></aff><aff id="aff6"><label>6</label><institution content-type="dept">Department of Biochemistry and Biophysics</institution>, <institution>University of California, San Francisco</institution>, <addr-line><named-content content-type="city">San Francisco</named-content></addr-line>, <country>United States</country></aff><aff id="aff7"><label>7</label><institution content-type="dept">Institute for Protein Design</institution>, <institution>University of Washington</institution>, <addr-line><named-content content-type="city">Seattle</named-content></addr-line>, <country>United States</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Brunger</surname><given-names>Axel T</given-names></name><role>Reviewing editor</role><aff id="aff8"><institution>Howard Hughes Medical Institute, Stanford University</institution>, <country>United States</country></aff></contrib></contrib-group><author-notes><corresp id="cor1"><email>dimaio@uw.edu</email></corresp><fn fn-type="present-address" id="pa1"><label>†</label><p>Department of Biochemistry and Biophysics, University of California, San Francisco, San Francisco, United States</p></fn><fn fn-type="present-address" id="pa2"><label>‡</label><p>Cyrus Biotechnology, Seattle, United States</p></fn></author-notes><pub-date date-type="pub" publication-format="electronic"><day>26</day><month>09</month><year>2016</year></pub-date><pub-date pub-type="collection"><year>2016</year></pub-date><volume>5</volume><elocation-id>e17219</elocation-id><history><date date-type="received"><day>26</day><month>04</month><year>2016</year></date><date date-type="accepted"><day>22</day><month>09</month><year>2016</year></date></history><permissions><copyright-statement>© 2016, Wang et al</copyright-statement><copyright-year>2016</copyright-year><copyright-holder>Wang et al</copyright-holder><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-17219-v2.pdf"/><abstract><object-id pub-id-type="doi">10.7554/eLife.17219.001</object-id><p>Cryo-EM has revealed the structures of many challenging yet exciting macromolecular assemblies at near-atomic resolution (3–4.5Å), providing biological phenomena with molecular descriptions. However, at these resolutions, accurately positioning individual atoms remains challenging and error-prone. Manually refining thousands of amino acids – typical in a macromolecular assembly – is tedious and time-consuming. We present an automated method that can improve the atomic details in models that are manually built in near-atomic-resolution cryo-EM maps. Applying the method to three systems recently solved by cryo-EM, we are able to improve model geometry while maintaining the fit-to-density. Backbone placement errors are automatically detected and corrected, and the refinement shows a large radius of convergence. The results demonstrate that the method is amenable to structures with symmetry, of very large size, and containing RNA as well as covalently bound ligands. The method should streamline the cryo-EM structure determination process, providing accurate and unbiased atomic structure interpretation of such maps.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.17219.001">http://dx.doi.org/10.7554/eLife.17219.001</ext-link></p></abstract><kwd-group kwd-group-type="author-keywords"><title>Author Keywords</title><kwd>cryo-EM</kwd><kwd>structure refinement</kwd><kwd>atomic models</kwd><kwd>Rosetta</kwd><kwd>macromolecular assemblies</kwd><kwd>membrane proteins</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research Organism</title><kwd>None</kwd></kwd-group><funding-group><award-group id="par-1"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000002</institution-id><institution>National Institutes of Health</institution></institution-wrap></funding-source><award-id>R01GM098672</award-id><principal-award-recipient><name><surname>Cheng</surname><given-names>Yifan</given-names></name></principal-award-recipient></award-group><award-group id="par-2"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000002</institution-id><institution>National Institutes of Health</institution></institution-wrap></funding-source><award-id>P50GM082250</award-id><principal-award-recipient><name><surname>Cheng</surname><given-names>Yifan</given-names></name></principal-award-recipient></award-group><award-group id="par-3"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000002</institution-id><institution>National Institutes of Health</institution></institution-wrap></funding-source><award-id>1P01GM111126</award-id><principal-award-recipient><name><surname>Cheng</surname><given-names>Yifan</given-names></name></principal-award-recipient></award-group><award-group id="par-4"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000002</institution-id><institution>National Institutes of Health</institution></institution-wrap></funding-source><award-id>GM110580</award-id><principal-award-recipient><name><surname>Fraser</surname><given-names>James S</given-names></name></principal-award-recipient></award-group><award-group id="par-5"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000001</institution-id><institution>National Science Foundation</institution></institution-wrap></funding-source><award-id>STC-1231306</award-id><principal-award-recipient><name><surname>Fraser</surname><given-names>James S</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta><meta-name>elife-xml-version</meta-name><meta-value>2.5</meta-value></custom-meta><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>Extensive benchmarking reveals that errors made when manually building models into near-atomic-resolution cryoEM density may automatically be corrected using an improved Rosetta-based structure refinement method.</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>Advances in direct electron detectors, as well as better image analysis algorithms, have led cryo-electron microscopy (cryo-EM) to achieve near-atomic resolution (3–4.5 Å) using single-particle analysis (<xref ref-type="bibr" rid="bib22">Li et al., 2013</xref>; <xref ref-type="bibr" rid="bib3">Bai et al., 2013</xref>; <xref ref-type="bibr" rid="bib24">Scheres, 2012</xref>). Cryo-EM reconstructions at these resolutions, at which individual β-strands are resolvable and bulky sidechains are somewhat visible, make it possible to build an all-atom model directly from such maps (<xref ref-type="bibr" rid="bib21">Kudryashev et al., 2015</xref>; <xref ref-type="bibr" rid="bib27">Wang et al., 2015</xref>). Although sequence can be registered, density maps at this range of resolution do not grant enough information to assign coordinates for each atom in the structure precisely, and thus they cannot always capture molecular interactions for a biochemical process. Furthermore, such model building and refinement is challenging and error prone (<xref ref-type="bibr" rid="bib13">DeLaBarre and Brunger, 2006</xref>; <xref ref-type="bibr" rid="bib8">Brunger et al., 2009</xref>). Nevertheless, determination of detailed atomic interactions from these sparse sources of data is desirable. However, the inherent ambiguity in the data makes accurately identifying molecular interactions extremely difficult, even for experts.</p><p>Model-building into a cryo-EM map at near-atomic resolution generally involves manually building a model into the map with the assistance of a graphical user interface tool (<xref ref-type="bibr" rid="bib16">Emsley et al., 2010</xref>), followed by refinement with software repurposed from X-ray crystallography (<xref ref-type="bibr" rid="bib7">Brown et al., 2015</xref>; <xref ref-type="bibr" rid="bib1">Afonine et al., 2012</xref>). This process requires identification of key amino acid sidechains to register stretches of sequence within the map (possibly aided by information on the topology of a homologous structure), followed by extension of these short fragments of sequence to form one or more fully connected protein chains. At near-atomic resolution, this manual model-building and refinement can be error prone because: (a) the density may not be of sufficient resolution to identify sidechain rotamers uniquely, even for bulky aromatic residues, making it difficult to determine sidechain-sidechain or sidechain-backbone interactions accurately; (b) for regions of non-regular secondary structure (turns or loops) or with poor local resolution, it may be difficult to position backbone atoms accurately; and (c) in these same regions, precise sequence registration may also be error prone. Getting these atomic interactions correct is crucial for understanding detailed atomic mechanisms of protein activities, for designing drugs with a very specific shape complementarity, and for understanding subtle conformational changes of a protein. A structure refinement procedure that can automatically improve the atomic details of a model from such density data is thus very much desired.</p><p>In this manuscript, we develop a three-stage approach for automatically refining manually traced cryo-EM models (<xref ref-type="fig" rid="fig1">Figure 1</xref>). While previously we have developed an iterative local rebuilding tool that is capable of refining homology models into near-atomic-resolution cryo-EM maps (<xref ref-type="bibr" rid="bib14">DiMaio et al., 2015</xref>), several advances were required to extend this tool so that it can successfully refine hand-built models. Our new approach includes a method for automatically detecting and correcting problematic residues in hand-built models without overfitting, a model-selection method for identifying models with good agreement to the density data and with physically realistic geometry, a voxel-size refinement method for correcting errors in calibrating the magnification scaling factor of a microscope, an improved sidechain-optimization method to correct sidechain placement errors in very large systems, and a way to estimate uncertainty in a refined model. These methods, combined, allow the tool to correct backbone errors that significantly deviate from the starting model, but it may still assign a high degree of confidence to these regions in the refined model.<fig-group><fig id="fig1" position="float"><object-id pub-id-type="doi">10.7554/eLife.17219.002</object-id><label>Figure 1.</label><caption><title>An overview of the three stages of automated refinement.</title><p>(Left) In stage 1, problematic regions are predicted using a newly developed error predictor that looks for local strain in the model and poor local density-fit. These selected regions are subject to iterative fragment-based rebuilding within a Monte Carlo sampling trajectory. Refinement in this stage is restricted to using one-half of the data, referred to as the training map. (Middle) In stage 2, the best models from the ~5000 independent Monte Carlo trajectories are selected. Models are selected based: on agreement to the validation map (independently constructed from the other half of the data), then by model geometry as assessed by MolProbity, and finally, on agreement to the full reconstruction. At this point, the selected models should in general have good fit-to-density and good geometry without overfitting to the data. (Right) In stage 3, using the 10 best models selected, we then optimize against the full reconstruction. Two half maps are used to choose the optimal density weight to refine structures using full-reconstruction. Finally, these top 10 models are optimized (without large-scale backbone rebuilding) into the full-reconstruction, which alternates with voxel-size refinement iteratively. Finally, these models are subject to B-factor refinement.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.17219.002">http://dx.doi.org/10.7554/eLife.17219.002</ext-link></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-17219-fig1-v2"/></fig><fig id="fig1s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.17219.003</object-id><label>Figure 1—figure supplement 1.</label><caption><title>A close-up view of model strain indicating errors in density-optimized TRPV1 models using the superceded Rosetta approach.</title><p>Both insets show two regions of models refined by the superceded Rosetta approach, where strain can indicate errors in models. In both cases, phenylalanine sidechains fit the density well, but both show geometric strain around the Cβ atom. The type of strain (as evaluated by MolProbity) is indicated by model color, using the key on the right.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.17219.003">http://dx.doi.org/10.7554/eLife.17219.003</ext-link></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-17219-fig1-figsupp1-v2"/></fig><fig id="fig1s2" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.17219.004</object-id><label>Figure 1—figure supplement 2.</label><caption><title>Incorporating model strain improves error detection.</title><p>Guided by the 3.3-Å 20S proteasome reconstruction, we evaluated 500 models against the high-resolution crystal structure. We plot here the precision (y-axis) and recall (x-axis) of predicting which residues were incorrectly placed (RMS &gt; 1Å). Use of density alone (pink line) is outperformed by using a combination of density and model strain (blue line). Our refinement approach considers four points on this curve when picking density + model strain cutoffs, indicated on the plot with 'Stage1–4'.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.17219.004">http://dx.doi.org/10.7554/eLife.17219.004</ext-link></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-17219-fig1-figsupp2-v2"/></fig><fig id="fig1s3" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.17219.005</object-id><label>Figure 1—figure supplement 3.</label><caption><title>Density weight optimization against half maps for Mitoribosome.</title><p>Before refinement against the full reconstruction, we optimize the weight on the 'fit-to-density' energy using half maps, to avoid overfitting. We plot several key metrics here as a function of weight on the fit-to-density score term (x-axis), including the Fourier Shell Correlation (FSC) 'overfitting' (FSC work-free, top histogram), the Rosetta energy (second histogram), and several Molprobity model geometry terms (histograms 3–6). In all cases, we see a sharp inflection point at which overfitting increases and geometry gets notably worse. As a general rule-of-thumb, we use the weight maximizing FSCfree–(0.04*per-residue-energy to capture this inflection point).</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.17219.005">http://dx.doi.org/10.7554/eLife.17219.005</ext-link></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-17219-fig1-figsupp3-v2"/></fig><fig id="fig1s4" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.17219.006</object-id><label>Figure 1—figure supplement 4.</label><caption><title>Model geometry is improved with a separate pre-proline potential.</title><p>Refined models initially had poor pre-proline geometry. Thus, a new backbone torsional potential was created which separately treats pre-proline and pre-non-proline residues. In the plot, we show the old potential (left), the new pre-non-proline potential (middle), and the pre-proline potential (right) for three different residue identities. The color indicates the unweighted energy values, using the key on the right.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.17219.006">http://dx.doi.org/10.7554/eLife.17219.006</ext-link></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-17219-fig1-figsupp4-v2"/></fig></fig-group></p><p>Finally, we apply this approach to three recently solved cryo-EM single particle reconstructions at near-atomic resolution: the TRPV1 channel at 3.4-Å resolution (TRPV1) (<xref ref-type="bibr" rid="bib23">Liao et al., 2013</xref>), the F<sub>420</sub>-reducing [NiFe] hydrogenase (Frh) at 3.4-Å resolution (<xref ref-type="bibr" rid="bib2">Allegretti et al., 2014</xref>), and the large subunit of mitochondrial ribosomes at 3.4-Å resolution (mitoribosome) (<xref ref-type="bibr" rid="bib6">Brown et al., 2014</xref>). We show that in all three cases of diverse and large systems, we are able to refine models automatically to high-quality (as assessed by MolProbity), while maintaining or improving agreement to the density data. Significantly, in the case of TRPV1, we newly identify a biologically relevant atomic interaction – a disulfide bond – that was not built in the originally deposited model but that is supported in the literature. In the case of Frh, we show that our refinement procedure led to a significant improvement of model geometry. Finally, in the case of mitoribosome, we show significant improvement in model geometry: the number of 'Ramachandran favored' residues increases by 5%, and Molprobity score (<xref ref-type="bibr" rid="bib10">Chen et al., 2010</xref>) improvement is observed in all 48 protein chains.</p></sec><sec id="s2" sec-type="results"><title>Results</title><p>An overview of our refinement approach is shown schematically in <xref ref-type="fig" rid="fig1">Figure 1</xref> (and is fully described in Materials and methods). Broadly, the approach proceeds in three stages. In the first stage, we identify problematic residues by assessing local model-strain and local agreement to density data. These problematic regions are rebuilt against a 'training' half-map using fragment-based Monte Carlo sampling with many independent trajectories followed by all-atom refinement. Second, the best subset of these independent trajectories are selected by identifying a subset of stereochemically correct models with best agreement to an independent 'validation' half-map, to prevent overfitting. Finally, models are further optimized in the full-reconstruction with a weight optimally scaled between experimental data and the forcefield using the 'validation' half map. Our approach adopts and improves upon our previous work on refining cryo-EM structures from distant homology structures (<xref ref-type="bibr" rid="bib14">DiMaio et al., 2015</xref>), in which a similar fragment-based backbone rebuilding strategy was employed. However, several crucial improvements were necessary in extending our previous work to successfully refine hand-traced models, larger complexes, and a more diverse set of systems.</p><sec id="s2-1"><title>Identification of backbone errors using local strain</title><p>In our previous work (<xref ref-type="bibr" rid="bib14">DiMaio et al., 2015</xref>), local fit to density is used to identify residues in a distant homology model. Unlike remote homology models, hand-traced models typically fit the data very well, but are incorrect geometrically (in terms of strain). Consequently, a key improvement is to make use of model strain as a criterion in selecting regions to refine. Moreover, when this previous approach was applied to the <italic>de novo</italic> hand-traced models from cryo-EM maps, we observed that in incorrect regions, the models still fit the density well, but did so by introducing strain into the nearby bond angles and torsions. This often occurred near the Cβ atom of aromatic residues, where strain was introduced to fit the sidechain into the density (<xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>). We reasoned that the backbone was incorrect in these strained residues; by correcting the backbone, we would be able to fit a non-strained sidechain into density. Thus, local strain can serve as an indicator to identify regions that could be refined to improve both the fit-to-density and the model geometry. We developed an error predictor by constructing a function (see Materials and methods) that assesses both local model-map agreement and local model-strain. Using a training dataset composed of error-containing models of a cryo-EM map in which the structure has been determined by X-ray crystallography (<xref ref-type="fig" rid="fig1s2">Figure 1—figure supplement 2</xref>), we show that the new error predictor offers better discrimination of incorrectly versus correctly placed backbone, with an AUPRC (area under precision-recall curve) of 0.80 versus 0.76 using density alone (<xref ref-type="fig" rid="fig1s2">Figure 1—figure supplement 2</xref>). In cases where models are hand-built into density, we expect this strain term to play an even larger role, as fit-to-data is expected to have larger influence on the initially constructed model.</p></sec><sec id="s2-2"><title>Better treatment of sidechain density</title><p>Recent studies have shown that certain sidechains – particularly those containing negatively charged amino acids (Glu/Asp) – tend to suffer from radiation damage and thus appear weaker in single-particle reconstructions (<xref ref-type="bibr" rid="bib5">Bartesaghi et al., 2014</xref>; <xref ref-type="bibr" rid="bib9">Campbell et al., 2015</xref>). Moreover, the density of certain bulky sidechains, such as those containing Lys and Arg, tends to be less well-defined than their backbone density. This missing density dramatically affects the convergence of conformational sampling during structure refinement, during which sidechains tend to be fit into density corresponding to backbone atoms. To compensate for this, we downweigh the contributions of sidechains which are less resolved in cryo-EM density. Down-weighing factors for each amino acid were determined by comparing the average per-amino-acid real-space B-factor on two cryo-EM reconstructions with known high-resolution crystal structures (20S proteasome [<xref ref-type="bibr" rid="bib22">Li et al., 2013</xref>] and β-galactosidase [<xref ref-type="bibr" rid="bib5">Bartesaghi et al., 2014</xref>]), with the ratio of backbone and sidechain average B-factors being used to derive the scaling factors. Table 3 shows the computed scalefactors used in our refinement method.</p></sec><sec id="s2-3"><title>Local sidechain refinement for large complexes</title><p>When our previous all-atom refinement approach was applied to very large complexes (of 800+ residues), we observed many instances in which sidechains were not properly optimized to density (<xref ref-type="fig" rid="fig6s1">Figure 6—figure supplement 1</xref>). It was hypothesized that this was due to the convergence of sidechain optimization, as the number of possible sidechain states expands exponentially with the number of residues present in a protein. Here, we opted to treat this global optimization problem as a series of smaller local optimization problems, repeatedly optimizing overlapping regions of ~20–100 residues until all residues in a protein are visited at least once. This approach resolved this sidechain fitting issue, as shown in <xref ref-type="fig" rid="fig6s1">Figure 6—figure supplement 1</xref> (right panel).</p></sec><sec id="s2-4"><title>Voxel-size refinement</title><p>The voxel size of a cryo-EM reconstruction is determined by the physical pixel size on the detector scaled by a magnification factor. However, the magnification factor may be determined with some inaccuracy, leading to errors in deciding the voxel size of the resulting single-particle reconstruction. It has been shown that voxel size may be off by as much as several percent when using EM maps as molecular replacement targets (<xref ref-type="bibr" rid="bib19">Jackson et al., 2015</xref>). Here, we develop a voxel-size refinement strategy that scales the voxel size of the map to maximize the model-map real-space correlation coefficient. During refinement, we alternate structure refinement and map voxel size refinement with several cycles iteratively until the voxel size converges (<xref ref-type="fig" rid="fig1">Figure 1</xref>). The approach is fully described in the Materials and methods section.</p><p>Moreover, we investigate the robustness of our voxel-size refinement method in the presence of model errors, and demonstrate that our iterative approach captures the general agreement between forcefield and voxel size. We initially made use of an arbitrary target structure (PDB id: 4AKE). We calculated density to 3Å resolution on a 1Å grid and ran several MD trajectories in Rosetta, followed by all-atom minimization, yielding 50 models that are 2.9–3.1Å RMSd from the native structure. We initially refined voxel size against each of these models, yielding voxel sizes from 0.95 to 1.02 Å (stdev = 0.011). Following our iterative procedure, the deviation was much smaller, ranging from 0.99 to 1.02 (stdev = 0.004). <xref ref-type="fig" rid="fig2">Figure 2A</xref> illustrates the distribution of voxel sizes derived from the models before refinement (red curve) and after refinement (blue curve), showing a sharp peak at the true voxel size (1.0Å) after refinement.<fig id="fig2" position="float"><object-id pub-id-type="doi">10.7554/eLife.17219.007</object-id><label>Figure 2.</label><caption><title>The accuracy of voxel size refinement and the effect of B-factor sharpening in Rosetta refinement.</title><p>(<bold>A</bold>) Voxel-size refinement on perturbed models. Perturbed structures were generated by running short MD trajectories in Rosetta, followed by all-atom minimization. Voxel size is refined against the perturbed models, yielding the density distribution in red. Following cycles of iterated voxel refinement and all-atom refinement, the voxel size shows significantly better convergence (blue line). (<bold>B</bold>) Rosetta structure refinement with a range values of B-factor sharpening. Integrated Fourier Shell Correlation eavluated using the validation map (free-iFSC) is plotted here as a function of B-factor sharpening of the training map. The results indicate that our refinement method is not particularly sensitive to the extent of B-factor sharpening, behaving similarly over a range of sharpening values between −40 and −130. The error bars show standard deviation of the free-iFSC among the top10 ensemble models (see Materials and methods for the ensemble selection method).</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.17219.007">http://dx.doi.org/10.7554/eLife.17219.007</ext-link></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-17219-fig2-v2"/></fig></p></sec><sec id="s2-5"><title>The effect of B-factor sharpening in Rosetta structure refinement</title><p>To investigate the extent of B-factor sharpening that would influence the accuracy of Rosetta structure refinement, we benchmarked structure refinement using various B-factors from 0 to −200 (<xref ref-type="fig" rid="fig2">Figure 2B</xref>). Using the 20S proteasome 3.3Å resolution map, we refined a model starting from a template (PDB id: 3H4P, 52% sequence identity) in the training map, and reported the integrated Fourier Shell Correlation evaluated by the validation map (free-iFSC). The method does not show a particularly strong dependency on B-factor sharpening values; with B-factors ranging from –40 to –130, the refinement all performed equally well, as assessed by free-iFSC.</p></sec><sec id="s2-6"><title>The role of independent reconstruction in Rosetta structure refinement</title><p>In our previous approaches, we used independent reconstructions ('validation' half-map) both for model selection (<xref ref-type="bibr" rid="bib14">DiMaio et al., 2015</xref>) and to determine the balance between model geometry and fit-to-data during refinement (<xref ref-type="bibr" rid="bib15">DiMaio et al., 2013</xref>). In this manuscript, we use independent reconstructions in the same manner during the first two stages of refinement (<xref ref-type="fig" rid="fig1">Figure 1</xref>). At the very last stage, however, we perform several steps in the context of the full reconstruction because of the additional sidechain details that may be present only in the full reconstruction. As shown in <xref ref-type="fig" rid="fig1">Figure 1</xref>, for the best 10 sampled models selected from stage 2, we perform a final all-atom and atomic B-factor refinement against the complete reconstruction. Similar to the approach adapted by the REFMAC group (<xref ref-type="bibr" rid="bib7">Brown et al., 2015</xref>; <xref ref-type="bibr" rid="bib17">Fernández et al., 2014</xref>), we use two independent halves of the data (the training and validation half-maps) to optimize the weight used with full-reconstruction data (see Materials and methods and (<xref ref-type="fig" rid="fig1s3">Figure 1—figure supplement 3</xref>), and that weight is used both in refinement against the full reconstruction and in voxel-size refinement. Following refinement against the full reconstruction, model geometry is verified (using MolProbity [<xref ref-type="bibr" rid="bib10">Chen et al., 2010</xref>]) to ensure that it is not worsening during refinement against the full reconstruction. This confers additional sensitivity during model selection.</p></sec><sec id="s2-7"><title>Evaluation of refined models with Molprobity and EMRinger</title><p>Models are evaluated for geometric quality using Molprobity (<xref ref-type="bibr" rid="bib10">Chen et al., 2010</xref>), which compares local geometric features describing an all-atom model to those from high-resolution crystal structures. In addition to using MolProbity to assess model quality, we further validate the Rosetta-refined models with EMRinger (<xref ref-type="bibr" rid="bib4">Barad et al., 2015</xref>), using this tool as an independent source to validate both model geometry and density-fit at sidechain level. EMRinger samples density around Cγ atoms as they are rotated about the χ<sub>1</sub> dihedral angle, and identifies the angle which presents peak density for the Cγ. On the basis of existing statistical and chemical information, this position should generally fall into the rotamer distribution of χ<sub>1,</sub> with angles of 60, 180, and 300 degrees. The distribution of measured peak angles at various signal-to-noise cutoffs is integrated into the EMRinger score, which reports on backbone model-to-map agreement using side chain geometry.</p></sec><sec id="s2-8"><title>Application to TRPV1</title><p>We first applied our new refinement approach to the recently determined 3.4-Å cryo-EM reconstruction of the TRPV1 channel in the apo form (<xref ref-type="bibr" rid="bib23">Liao et al., 2013</xref>). Half-maps were reconstructed by subdividing particles into two sets randomly, with one used for initial model rebuilding and refinement, and the other used for validation. The deposited model (PDB id: 3J5P) was used as input to the protocol described previously. All refinement was carried out using the native C4 symmetry. Because of the highly heterogeneous nature of the system, fragment-based rebuilding (stage 1 and 2) was focused on the trans-membrane domain initially, and then the full three-stage refinement was performed on the full structure (see Materials and methods for details). All input files are included as <xref ref-type="supplementary-material" rid="SD2-data">Supplementary file 1</xref>.</p><p>The results of refinement are indicated in <xref ref-type="fig" rid="fig3">Figures 3</xref> and <xref ref-type="fig" rid="fig4">4</xref> and in <xref ref-type="table" rid="tbl1">Table 1</xref>. The refined model improves model quality and maintains good model-data agreement when compared to the deposited model: the MolProbity score improves from 3.81 to 1.45, the fit-to-data (integrated Fourier shell correlation from 10 to 3.4Å) drops slightly from 0.612 to 0.607, but the EMRinger score improves from 0.65 to 2.34, indicating that the better fitting shown in the deposited model might result from overfitting. <xref ref-type="fig" rid="fig3">Figure 3A–B</xref> compares the refined model and the deposited model, illustrating the model violations reported by MolProbity. <xref ref-type="fig" rid="fig4">Figure 4A</xref> illustrates the convergence of our refined ensemble, showing the 10 selected refined structures, the top model colored by per residue structural variation, and the refined B-factors. Both structural variation and B-factors provide unique insights on assessing the local confidence of the refined models, in which structural variance shows the allowed local conformations that satisfy the density data, while B-factors assess the local resolution of the density data at different regions of a model.<fig id="fig3" position="float"><object-id pub-id-type="doi">10.7554/eLife.17219.008</object-id><label>Figure 3.</label><caption><title>Refinement of the apo TRPV1 channel (EMD-5778) shows improved model quality.</title><p>(<bold>A</bold>) Comparison of the deposited and Rosetta-refined models, as assessed by MolProbity. Residues reported as violations are colored using the key shown on the far right. Blue open arrows indicate that the hydrogen-bond geometry of a β-hairpin was automatically detected and improved in the Rosetta refined model. (<bold>B</bold>) An overlay of the asymmetric unit of the deposited (pink) and the Rosetta-refined (green) model indicates the magnitude of conformational changes that are explored by our refinement approach. (<bold>C</bold>) The agreement of models to map assessed by Fourier space correlation (y-axis) at each resolution shell (x-axis), where the reported resolution (3.4Å) is depicted in a dashed orange line.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.17219.008">http://dx.doi.org/10.7554/eLife.17219.008</ext-link></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-17219-fig3-v2"/></fig><fig id="fig4" position="float"><object-id pub-id-type="doi">10.7554/eLife.17219.009</object-id><label>Figure 4.</label><caption><title>Refinement of the TRPV1 channel identifies a previously unmodeled disulfide bond.</title><p>(<bold>A</bold>) An overview of the entire structure, estimating local model uncertainty in two ways: local structural diversity and refined B-factors. Local structure diversity is indicated by showing (left) an overlay of the top 10 Rosetta models, (middle) the top model colored by per residue deviation, and (right) the refined per-atom B-factors. Using the model selection method illustrated in the middle panel of <xref ref-type="fig" rid="fig1">Figure 1</xref>, the Cα RMSDs among the selected ensemble range from 0.44 to 0.63 Å. The orange square shows the location of a newly identified disulfide bond (C386–C390) revealed by our refinement protocol. (<bold>B</bold>) A zoomed-in view of the disulfide linkage (C386–C390) identified by the automated method. Note that the sidechain coordinates of C390 were unassigned in the deposited model; for presentation, the sidechain atoms of C390 were optimally added by Rosetta on the basis of the deposited backbone torsion angles of C390.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.17219.009">http://dx.doi.org/10.7554/eLife.17219.009</ext-link></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-17219-fig4-v2"/></fig><table-wrap id="tbl1" position="float"><object-id pub-id-type="doi">10.7554/eLife.17219.010</object-id><label>Table 1.</label><caption><p>Structure refinement of macromolecular assemblies from cryo-EM maps using Rosetta.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.17219.010">http://dx.doi.org/10.7554/eLife.17219.010</ext-link></p></caption><table frame="hsides" rules="groups"><thead><tr><th rowspan="2" valign="top"/><th rowspan="2" valign="top">EMD ID</th><th rowspan="2" valign="top">PDB ID</th><th rowspan="2" valign="top">Reported resolution [Å]</th><th rowspan="2" valign="top">Symmetry</th><th rowspan="2" valign="top">Number of amino acids*</th><th colspan="4" valign="top">MolProbity<sup>†</sup></th><th rowspan="2" valign="top">EMRinger score<sup>†</sup></th><th rowspan="2" valign="top">iFSC<sup>‡</sup></th></tr><tr><th valign="top">Score</th><th valign="top">Clash score</th><th valign="top">Rotamer outliers [%]</th><th valign="top">Ramachandran favored [%]</th></tr></thead><tbody><tr><td valign="top">TRPV1</td><td valign="top">5778</td><td valign="top">3j5p</td><td valign="top">3.4</td><td valign="top">C4</td><td valign="top">489 (1956)</td><td valign="top">3.81 / 1.45</td><td valign="top">86.35 / 1.96</td><td valign="top">28.78 / 0.00</td><td valign="top">95.65 / 91.93</td><td valign="top">0.65 / 2.34</td><td valign="top">0.612 / 0.607</td></tr><tr><td valign="top">Frh</td><td valign="top">2513</td><td valign="top">4ci0</td><td valign="top">3.4</td><td valign="top">T</td><td valign="top">893 (10,716)<sup>§</sup></td><td valign="top">3.98 / 1.59</td><td valign="top">120.42 / 3.22</td><td valign="top">39.11 / 0.27</td><td valign="top">96.51 / 92.18</td><td valign="top">1.06 / 2.17</td><td valign="top">0.743 / 0.708</td></tr><tr><td valign="top">Mitoribosome</td><td valign="top">2762</td><td valign="top">3j7y</td><td valign="top">3.4</td><td valign="top">N/A</td><td valign="top">7469<sup>¶</sup></td><td valign="top">2.71 / 1.50</td><td valign="top">8.38 / 3.51</td><td valign="top">8.49 / 0.08</td><td valign="top">89.86 / 94.86</td><td valign="top">2.09 / 2.40</td><td valign="top">0.692 / 0.676</td></tr></tbody></table><table-wrap-foot><fn id="tblfn1"><p>*Number of protein residues in the asymmetric unit and (the total residues) modeled.</p></fn><fn id="tblfn2"><p><sup>†</sup>Scores from deposited (left) versus (/) Rosetta refined (right) model.</p></fn><fn id="tblfn3"><p><sup>‡</sup>Integrated Fourier Shell Correlation (iFSC) from 10–3.4Å resolution shells.</p></fn><fn id="tblfn4"><p><sup>§</sup>In addition to protein residues, nine residues of ligand per asymmetric unit–including a [NiFe] cluster, two metal ions (Fe and Zn), and four [4Fe4S] clusters, and an FAD–were included in the refinement.</p></fn><fn id="tblfn5"><p><sup>¶</sup>In addition to protein residues, 1529 base pairs of RNA molecule were included in the refinement.</p></fn></table-wrap-foot></table-wrap></p><p>Closer inspection of the low-energy refined models identified that serveral made a disulfide linkage (C386–C390) that was not built in the deposited model and was supported by the deposited density data (<xref ref-type="fig" rid="fig4">Figure 4B</xref>). Further refinement (with the addition of the Ankyrin repeat domain) was made using the lowest energy disulfide-containing model as a starting point. This disulfide has previously been identified and characterized in the literature as playing an important role in the TRPV1 channel's response to oxidative stress (<xref ref-type="bibr" rid="bib11">Chuang and Lin, 2009</xref>); this, combined with our model's ability to better explain a tube of density that is unaccounted for in the deposited model, let us speculate that this disulfide bond is present in the cryo-EM reconstruction. The discovery of this linkage also illustrates the magnitude of conformational change that may be captured by our protocol; our Monte Carlo backbone sampling strategy allows refinement to overcome energy barriers that other methods using density minimization alone cannot overcome. Despite the magnitude of these changes, the conformational ensemble is well converged in this region (<xref ref-type="fig" rid="fig4">Figure 4B</xref>, right panel), providing further confidence in our refined model.</p></sec><sec id="s2-9"><title>Refinement of highly liganded complexes: application to the F<sub>420</sub>-reducing [NiFe] hydrogenase complex</title><p>As our next test of the approach, we wanted to illustrate structure refinement of a macromolecular assembly containing proteins with large numbers of ligands, some of which are covalently bound, all in a system with high-order point symmetry. For this, we chose the 3.4-Å reconstruction of the F<sub>420</sub>-reducing [NiFe] hydrogenase complex, in which the asymmetric unit contains three protein chains which feature together with a [NiFe] cluster, two metal ions, four [4Fe4S] clusters that are covalently bound to cysteine sidechains, and a flavin adenine dinucleotide (FAD) (<xref ref-type="fig" rid="fig5">Figure 5A</xref>). The complex is a dodecamer with tetrahedral symmetry, with 12 copies of a 902-residue molecule of three protein chains. We used the <italic>-auto_setup_metals</italic> option of Rosetta to maintain covalent linkages between protein and ligand during refinement (full input files are included as <xref ref-type="supplementary-material" rid="SD3-data">Supplementary file 2</xref>). The results of refinement are indicated in <xref ref-type="fig" rid="fig5">Figure 5</xref> and <xref ref-type="table" rid="tbl1">Table 1</xref>; the MolProbity score improves from 3.98 to 1.59, and the EMRinger score improves from 1.06 to 2.17, but the iFSC drops from 0.743 to 0.708. We reason that the decrease of fit-to-density at high-resolution (10–3.4Å) shells may be a result of overfitting the model to the density map; the deposited model was forced to fit the density by deviating the likely geometry observed in high-resolution crystal structures. This overfitting hypothesis is well supported by a high number of bad clashes and 39% rotamer outliers found in the deposited model (<xref ref-type="table" rid="tbl1">Table 1</xref> and <xref ref-type="fig" rid="fig5">Figure 5C</xref>).<fig-group><fig id="fig5" position="float"><object-id pub-id-type="doi">10.7554/eLife.17219.011</object-id><label>Figure 5.</label><caption><title>Refinement of the F<sub>420</sub>-reducing [NiFe] hydrogenase (EMD-2513) improves the model geometry.</title><p>(<bold>A</bold>) An illustration comparing the model geometry of the deposited (upper panel) and Rosetta-refined (lower panel) models. Three chains (A/B/C) of the asymmetric unit of the complex are shown as cartoon with geometry violations reported by MolProbity colored according to the key shown on the far right. Four iron–sulfur clusters [4Fe4S] and a FAD are shown in a stick representation. Metal ions are depicted as spheres, with Zn grey, Fe orange, and Ni green. (<bold>B</bold>) Model–map agreement – as assessed by Fourier shell correlation (y-axis) as a function of resolution (x-axis) – quantifies this improvement following voxel-size refinement. (<bold>C</bold>) Model quality as assessed by EMRinger and MolProbity. The x-axis shows methods used to evaluate the models, while the y-axis shows the scores under each criterion.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.17219.011">http://dx.doi.org/10.7554/eLife.17219.011</ext-link></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-17219-fig5-v2"/></fig><fig id="fig5s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.17219.012</object-id><label>Figure 5—figure supplement 1.</label><caption><title>The symmetry operators denoted in the deposited PDB (PDB 4ci0) produce a complex that could not fit into the deposited density map properly.</title><p>(Left panel) The symmetric complex downloaded from a protein data bank as a biounit shifts the entire complex out of the deposited density map. The middle and right panels show a zoomed-in view of two regions in the deposited models corresponding to the helix and the sheet indicated by the orange and cyan squares, respectively, in the left panel.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.17219.012">http://dx.doi.org/10.7554/eLife.17219.012</ext-link></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-17219-fig5-figsupp1-v2"/></fig></fig-group></p></sec><sec id="s2-10"><title>Refinement of large complexes: application to the mitochondrial ribosome large subunit</title><p>Finally, we wanted to test the ability of our refinement to scale to large asymmetric macromolecular assemblies, more typical of cryo-EM single particle reconstruction. To do so, we considered refining models against the previously published 3.4-Å cryo-EM reconstruction of the large subunit of the human mitochondrial ribosome (<xref ref-type="bibr" rid="bib6">Brown et al., 2014</xref>). The deposited model had been previously refined with REFMAC (<xref ref-type="bibr" rid="bib7">Brown et al., 2015</xref>), and consists of 48 chains of proteins with 7469 amino acids assigned, and two chains of RNA with 1529 nucleic acid bases.</p><p>In order to make conformational sampling tractable, we used a strategy slightly modified from that shown in <xref ref-type="fig" rid="fig1">Figure 1</xref> (full input files are included as <xref ref-type="supplementary-material" rid="SD4-data">Supplementary file 3</xref>). The first two stages of the protocol (fragment-based backbone rebuilding and model selection) were carried out on each protein chain individually, whereas the third stage was carried out on the fully assembled complex. Model selection was carried out on each individual chain; each selected model was refined in the context of the complete assembly. Nucleic acids were not subject to geometry refinement but were included as rigid bodies throughout the whole-assembly refinement to accurately recapitulate protein–RNA interactions.</p><p>The results of the refinement are indicated in <xref ref-type="fig" rid="fig6">Figure 6</xref> and in <xref ref-type="table" rid="tbl1">Table 1</xref>. Several large-scale conformational changes again appear in converged models; these models show better geometry, improved fit-to-density and fewer unexplained regions of density. The backbone geometry improvements in particular are noticeable in proteins with β-sheet-containing domains. Refinement procedures such as <italic>phenix.real_space_refine</italic> [<xref ref-type="bibr" rid="bib1">Afonine et al., 2012</xref>] and REFMAC [<xref ref-type="bibr" rid="bib7">Brown et al., 2015</xref>] require manual input of secondary structure restraints that are determined either from an initial model or from homologous protein structure to maintain backbone geometry during refinement. In our approach, the Rosetta forcefield is able to optimize hydrogen bond geometry in secondary structures without requiring prior knowledge of secondary structures. This is particularly powerful in refining <italic>de novo</italic> structures whose secondary structure is ambiguous because of poor local resolution. <xref ref-type="fig" rid="fig6">Figure 6C</xref> illustrates an example (chain k) of this from the case of mitoribosome, where a β-sheet not present in the original model is identified, the backbone geometry is improved, and the model fits the density much better than the deposited model (<xref ref-type="fig" rid="fig6">Figure 6B</xref> left panel, red arrow); the refinement also shows a large radius of convergence.<fig-group><fig id="fig6" position="float"><object-id pub-id-type="doi">10.7554/eLife.17219.013</object-id><label>Figure 6.</label><caption><title>Refinement of the large subunit of the human mitochondrial ribosome (EMD-2762) shows improvements to all subunits.</title><p>(<bold>A</bold>) Scatterplots of model quality for each of the 48 protein chains compare the deposited (x-axis) and Rosetta (y-axis) models using MolProbity. On the left, the MolProbity scores of all 48 protein chains are compared, where a lower values indicates a better model geometry. On the right, the percentage of 'Ramachandran favored' residues on each chain are compared, with higher values preferable. (<bold>B</bold>) An evaluation of the fit-to-density of each protein chain. On the left, we compare the Fourier shell correlation (FSC) of each chain before and after refinement; we integrate the FSC from 10Å to 3.4Å. Higher values indicate better agreement with the data. The largest improvement, chain k, is indicated by the red arrow. On the right, we show the full FSC curve, with the deposited model shown in pink, and the Rosetta refined model shown in green; the reported map resolution (3.4Å) is indicated in the dashed orange line. (<bold>C</bold>) A zoomed-in view indicating a much improved backbone geometry and the large radius of convergence of the refinement of chain k. The left panel shows that the density for chain k is in the region of relatively low local resolution.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.17219.013">http://dx.doi.org/10.7554/eLife.17219.013</ext-link></p><p><supplementary-material id="SD1-data"><object-id pub-id-type="doi">10.7554/eLife.17219.014</object-id><label>Figure 6—source data 1.</label><caption><title>Mitoribosome per-chain refinement results.</title><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.17219.014">http://dx.doi.org/10.7554/eLife.17219.014</ext-link></p></caption><media mime-subtype="docx" mimetype="application" xlink:href="elife-17219-fig6-data1-v2.docx"/></supplementary-material></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-17219-fig6-v2"/></fig><fig id="fig6s1" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.17219.015</object-id><label>Figure 6—figure supplement 1.</label><caption><title>Local relax shows better placement of sidechains for large systems.</title><p>In the case of the mitoribosome, refinement of a particularly well-resolved region in the map (left) led to sidechains that are clearly misaligned with the density (middle). This was due to the poor convergence of our Monte Carlo sidechain placing approach when applied to systems with more than 1000 residues. Our alternative approach, LocalRelax, which performs many local sidechain optimizations, correctly places sidechains in a way that is consistent with density (right).</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.17219.015">http://dx.doi.org/10.7554/eLife.17219.015</ext-link></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-17219-fig6-figsupp1-v2"/></fig><fig id="fig6s2" position="float" specific-use="child-fig"><object-id pub-id-type="doi">10.7554/eLife.17219.016</object-id><label>Figure 6—figure supplement 2.</label><caption><title>EMRinger analysis on refinement of the large subunit of the human mitochondrial ribosome.</title><p>A scatterplot of model quality assessed by EMringer of each of the 48 protein chains compares the deposited (x-axis) and Rosetta (y-axis) models.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.17219.016">http://dx.doi.org/10.7554/eLife.17219.016</ext-link></p></caption><graphic mime-subtype="postscript" mimetype="application" xlink:href="elife-17219-fig6-figsupp2-v2"/></fig></fig-group></p><p>The refined ribosome model has 1.50 MolProbity score, 0.676 iFSC, and 2.40 EMRinger score. The largest improvements tend to occur in regions of low local resolution (~5Å assessed by ResMap [<xref ref-type="bibr" rid="bib20">Kucukelbir et al., 2014</xref>] from the original paper) on the periphery of the complex. Looking at the results on individual chains, the MolProbity score improves on all 48 protein chains, in part because of the much-improved backbone geometry assessed by the <italic>Ramachandran favored</italic> term in MolProbity (<xref ref-type="fig" rid="fig6">Figure 6A</xref>, right panel). Our Monte Carlo backbone sampling can correct these incorrect backbone placements, which often require significant compensating conformational changes. EMRinger score is also consistently improved (<xref ref-type="fig" rid="fig6s2">Figure 6—figure supplement 2</xref>), particularly in regions where the deposited model scores poorly.</p></sec><sec id="s2-11"><title>Comparison to <italic>phenix.real_space refinement</italic></title><p>Finally, using the same set of target proteins, we compare the Rosetta refinement results with those of another state-of-the-art real-space refinement method from the <italic>phenix</italic> package (<italic>phenix.real_space_refine</italic>) (<xref ref-type="bibr" rid="bib1">Afonine et al., 2012</xref>). In order to prevent refinement from fitting to noise, starting from the deposited models, we carried out <italic>phenix</italic> real-space refinement in the training maps, which contained only the half of the data used by Rosetta in the first step of the refinement procedure (<xref ref-type="fig" rid="fig1">Figure 1</xref>). We then used the validation map to evaluate and compare the <italic>phenix</italic> refinement results to the Rosetta-refined models before full-map refinement. In the case of TRPV1, <italic>phenix</italic> used 0.24 CPU hours, generating a single model. For Rosetta, the 1000 independent trajectories take about 5 hr each, or 5000 CPU-hours in total. As shown in <xref ref-type="table" rid="tbl2">Table 2</xref>, with much shorter run time (at most 1 hr) <italic>phenix</italic> can yield models with geometry almost as good as Rosetta, albeit with slightly worse density fit as evaluated by both real-space correlation coefficient and iFSC. However, without the Monte Carlo backbone conformational sampling used by Rosetta, models generated from <italic>phenix</italic> tend to minimally perturb the structure, and cannot provide the large backbone corrections shown by our new approach.<table-wrap id="tbl2" position="float"><object-id pub-id-type="doi">10.7554/eLife.17219.017</object-id><label>Table 2.</label><caption><p>Comparison of structure refinement results between Rosetta and phenix.real_space_refine*.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.17219.017">http://dx.doi.org/10.7554/eLife.17219.017</ext-link></p></caption><table frame="hsides" rules="groups"><thead><tr><th rowspan="2" valign="top"/><th rowspan="2" valign="top">RSCC*<sup>,†,‡</sup> <break/>validation map</th><th rowspan="2" valign="top">iFSC*<sup>,†,§</sup> <break/>validation map</th><th rowspan="2" valign="top">EMRinger Score*<sup>,†</sup> <break/>validation map</th><th colspan="4" valign="top">MolProbity<sup>†</sup></th><th rowspan="2" valign="top">Number of residues with better RSCC<sup>†,¶</sup></th></tr><tr><th valign="top">Score</th><th valign="top">Clash score</th><th valign="top">Rotamer outliers [%]</th><th valign="top">Ramachandran favored [%]</th></tr></thead><tbody><tr><td valign="top">TRPV1</td><td valign="top">0.785 / 0.790</td><td valign="top">0.546 / 0.566</td><td valign="top">1.84 / 1.90</td><td valign="top">1.59 / 1.48</td><td valign="top">4.30 / 2.14</td><td valign="top">0.00 / 0.00</td><td valign="top">94.41 / 91.72</td><td valign="top">86 / 250</td></tr><tr><td valign="top">Frh</td><td valign="top">0.835 / 0.835</td><td valign="top">0.504 / 0.517</td><td valign="top">1.36 / 1.27</td><td valign="top">1.68 / 1.62</td><td valign="top">7.99 / 3.66</td><td valign="top">0.68 / 0.13</td><td valign="top">96.31 / 92.67</td><td valign="top">677 / 1328</td></tr><tr><td valign="top">Mitoribosome</td><td valign="top">0.832 / 0.832</td><td valign="top">0.476 / 0.478</td><td valign="top">2.05 / 1.98</td><td valign="top">1.88 / 1.62</td><td valign="top">6.17 / 4.08</td><td valign="top">0.38 / 0.00</td><td valign="top">90.19 / 93.49</td><td valign="top">415 / 564</td></tr></tbody></table><table-wrap-foot><fn id="tblfn6"><p>*To avoid over-fitting, refinement using both methods was carried out using the half-map approach, in which the models were subject to refinement using the training maps. The results showing here were evaluated using the validation-maps. The input model information is the same as reported at <xref ref-type="table" rid="tbl1">Table 1</xref>.</p></fn><fn id="tblfn7"><p><sup>†</sup>Numbers (scores) from <italic>phenix.real_space_refine</italic> (left) versus (/) Rosetta refined (right) model.</p></fn><fn id="tblfn8"><p><sup>‡</sup>Real-space correlation coefficients were evaluated using UCSF Chimera.</p></fn><fn id="tblfn9"><p><sup>§</sup>Integrated Fourier shell correlation (iFSC) from 10–3.4Å resolution shells.</p></fn><fn id="tblfn10"><p><sup>¶</sup>We calculate per-residue real-space correlation coefficient and report the number of residues which show the value of ΔRSCC greater than 0.05.</p></fn></table-wrap-foot></table-wrap></p></sec></sec><sec id="s3" sec-type="discussion"><title>Discussion</title><p>In this report, we develop a method for improving the atomic details of manually traced models from 3–4.5Å resolution cryo-EM density maps. We show the applicability of the approach by applying it to three systems: a membrane protein, a highly symmetric system with a large number of ligands, and an asymmetric macromolecular assembly containing large numbers of protein chains and RNAs. In all cases, we show that we are able to improve model geometry significantly while maintaining good agreement to the density data. We show that model convergence can be used to suggest local model uncertainty in addition to B-factors. Finally, we also show that our models also recover structure features that are supported in the literature, or that are in much better local agreement with the density data.</p><p>Unlike other approaches (<xref ref-type="bibr" rid="bib7">Brown et al., 2015</xref>; <xref ref-type="bibr" rid="bib18">Headd et al., 2012</xref>), our approach can automatically perform large-scale backbone reorganization, correcting backbone placement errors common in these 3–4.5Å resolution datasets. Two features of our refinement approach regarding the use of prior information are crucial to the success of this large-scale refinement. First, the use a physically realistic forcefield throughout refinement handles the under-constrained nature of refinement at these resolutions, using chemical 'domain knowledge' learned from high-resolution crystal structures to implicitly fill in the missing information in the data. Second, our fragment-based rebuilding , which explicitly samples the most likely backbone conformations given a short stretch of sequence, also uses prior information gathered from high-resolution protein structures, further restricting conformation space and filling in additional information that is not present in the data.</p><p>In all cases, we found that the high-resolution density-fit (evaluated by FSC integrated from 10–3.4Å resolution shells) drops slightly after Rosetta structure refinement. We reason that this is probably because the deposited models were overfit to the density maps, so that the models (especially the sidechains) were forced to fit into the density by violating the likely geometry observed from known high-resolution crystal structures. The observation of the slightly decreased of fit-to-density but significant improvement of model geometry bolsters the importance of using prior information (such as sidechain rotatmers), as well as of having a refinement scheme to monitor model overfitting.</p><p>There is an open question as to how structure refinement can be further improved, particularly as refinement extends to even lower resolutions (worse than 5Å). Enhancing the predicting power of the Rosetta modeling methods is key to pushing the resolution limit of the current refinement method further. This can be achieved by improving: (1) the energy function (forcefield) used in structure refinement, and (2) conformational sampling methodology, particularly for systems for which secondary structure prediction is poor. Further improvements in the role of B-factor sharpening and its effect on refinement, as well as better predictors of local model error are necessary. Finally, structure refinement in maps that have highly heterogeneous local resolution remains challenging because a single set of refinement parameters cannot readily be applied at all regions. Methodological improvements that allow the adjustment of parameters based on local map quality will be essential to refine structures accurately from such maps. In our effort to enable automated structure refinement for large macromolecular assemblies, we hope that this method will be a valuable tool for determining atomically accurate structures from near-atomic-resolution cryo-EM data.</p></sec><sec id="s4" sec-type="materials|methods"><title>Materials and methods</title><sec id="s4-1"><title>Preparing maps for refinement</title><p>Split maps were provided by the original authors. One map was randomly chosen for refinement, and the other was used for validation. In all cases, a B-factor of −100 was applied to the map used for refinement using the '<italic>image_handler</italic>' tool in <italic>RELION</italic> (<xref ref-type="bibr" rid="bib24">Scheres, 2012</xref>). The maps were subsequently filtered to the user-refined resolution. In the case of the mitochondrial ribosome, segmented maps were prepared using a custom Rosetta application and the deposited structure to guide segmentation:</p><p><italic>density_tools.default.linuxgccrelease -s 3j7y0.pdb -mapfile EMD-2762.mrc -mask_radius 2 -maskonly</italic></p><p>Some steps of the protocol also made use of the full reconstruction. As with the training map, these were sharpened using a B-factor of –90 with a low-pass filter to 3Å.</p></sec><sec id="s4-2"><title>Preparing structures for refinement</title><p>In the case of TRPV1, residues 111–202 in the Ankryin repeat domain from the deposited model did not have visible density, and so were deleted prior to refinement. Furthermore, automatic refinement was applied in two stages because of the high heterogeneity between the trans-membrane domain and the Ankryin repeat domain. The trans-membrane domain (residue 234–586) was first refined in the masked density using the deposited model. In the case of the mitoribosome, residues from chain t and chain f, in which atoms are assigned to residues 'UNK', were removed from all the refinement processes, as well as from data analyses or results comparisons. In the case of Frh, we found that the deposited symmetry operators (the 'BIOMT' lines) are not able to generate a symmetric model that can properly fit into the density map (<xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1</xref>). To assemble the symmetric complex, we manually docked each subunit of the symmetric complex into the deposited density map (EMD-2513) using Chimera, and used this model as the 'deposited model' used in the paper. The refinement of ligands received special treatment: refinement started using protein only, with constraints maintaining ligand site geometry. Later, ligands were added back on to the protein, which was rerefined.</p></sec><sec id="s4-3"><title>Algorithm for model rebuilding</title><p>Model rebuilding generally follows the procedure from our previous work (<xref ref-type="bibr" rid="bib14">DiMaio et al., 2015</xref>), with a few key changes highlighted below. Rebuilding starts from the deposited structure, which is first conservatively refined using one macrocycle of the Rosetta <italic>relax</italic> protocol to trigger local strain on sidechains, which iterates four cycles Monte Carlo rotamer optimization with all-atom minimization, ramping the weight on van der Waals repulsion in each cycle. Minimization is carried out in Cartesian space, with a term enforcing ideal bond angles, bond lengths, and planarity (<xref ref-type="bibr" rid="bib12">Conway et al., 2014</xref>).</p><p>Following Cartesian minimization, the worst residues are selected using the following equation to evaluate the quality of the model at residue <italic>i</italic>:<disp-formula id="equ1"><mml:math id="m1"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msubsup><mml:mi>Z</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>r</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>⋅</mml:mo><mml:msubsup><mml:mi>Z</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>c</mml:mi><mml:mi>l</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>⋅</mml:mo><mml:msubsup><mml:mi>Z</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>c</mml:mi><mml:mi>l</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>b</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub><mml:mo>⋅</mml:mo><mml:msubsup><mml:mi>Z</mml:mi><mml:mrow><mml:mi>b</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>m</mml:mi><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo>⋅</mml:mo><mml:msubsup><mml:mi>Z</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>m</mml:mi><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>i</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msubsup></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>Four different terms appear in this equation, two of which assess a model’s agreement to data, and two of which assess a model’s local strain. The first two, <inline-formula><mml:math id="inf1"><mml:mrow><mml:msubsup><mml:mi>Z</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf2"><mml:mrow><mml:msubsup><mml:mi>Z</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>c</mml:mi><mml:mi>l</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula>, assess the model–map agreement of the backbone and sidechain atoms of each residue, computing the real-space correlation coefficient in a region around a residue, and converting that to a <italic>Z-score</italic> compared to the entire model. For the former term, an absolute correlation coefficient is computed; for the latter term, the correlation is normalized with respect to residues nearby (those within 10 Å of residue <italic>i</italic>). The latter term is specifically added to deal with maps that have significant diversity in local resolution.</p><p>The second two terms, <inline-formula><mml:math id="inf3"><mml:mrow><mml:msubsup><mml:mi>Z</mml:mi><mml:mrow><mml:mi>b</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="inf4"><mml:mrow><mml:msubsup><mml:mi>Z</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>m</mml:mi><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula>, assess a model’s strain following model refinement. The motivation for these terms is that in cases where the model was built incorrectly into density, it will be energetically unfavorable. Following an initial refinement, these incorrect portions will either be moved away from the data, or will introduce model strain to maintain the favorable agreement with the data, depending upon the balance of forces between the two. These terms compare the per-residue bond geometry term, and the per-residue Ramachandran energy, respectively, to that over the entire structure, and compute a <italic>Z-score</italic> for each residue.</p><p>For each of the four terms, a <italic>Z-score</italic> is computed and is summed together, with a particular weight for each term. The weights were tuned using a 3.3-Å cryo-EM map dataset with known high-resolution structure (the 20S proteasome [<xref ref-type="bibr" rid="bib22">Li et al., 2013</xref>]), where a set of ~500 error-containing models was used as the training data. The results of this tuning process are shown in <xref ref-type="fig" rid="fig1s2">Figure 1—figure supplement 2</xref>. The final weights selected were <inline-formula><mml:math id="inf5"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>d</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>=0.45, <inline-formula><mml:math id="inf6"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>c</mml:mi><mml:mi>l</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>=0.05, <inline-formula><mml:math id="inf7"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>b</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>=0.15, <inline-formula><mml:math id="inf8"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>m</mml:mi><mml:mi>a</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>=0.35.</p><p>After computing this weighted <italic>Z-score</italic> for each residue, all residues with a score below some target value (see the next section on iteration for specific values) are selected for local rebuilding. Local rebuilding uses the iterative fragment-based approach previously published (<xref ref-type="bibr" rid="bib14">DiMaio et al., 2015</xref>). In our new approach, a residue is randomly chosen from the pool tagged for rebuilding from the previous step. Given the local sequence around this selected residue, a set of 25 protein backbone conformations from high-resolution structures with similar local sequence and predicted secondary structure is sampled. Each sampled backbone is refined – as an isolated fragment – into density using the following three-step procedure: (a) only the backbone is minimized in torsion space using a simplified energy function, (b) sidechain rotamers are optimized into density, and (c) both backbone and sidechain are minimized in torsion space using a simplified energy function. Constraints on the ends of each fragment ensure the a local region is reasonable in the context of the entire backbone. Of the 25 sampled fragments, the best is selected by fit-to-density. Finally, the replaced fragment is minimized in the context of the complete structure. This process is run as a Monte Carlo trajectory.</p></sec><sec id="s4-4"><title>Iterative rebuilding and all-atom refinement</title><p>Model rebuilding and all-atom refinement are run iteratively, as shown in <xref ref-type="fig" rid="fig1">Figure 1</xref>. Four separate 200-step Monte Carlo trajectories are run with increasing coverage of predicting errors but sacrificing the accuracy of the predictions. This is done with the <italic>Z-score</italic> cutoff increased in each step, following the schedule shown in <xref ref-type="fig" rid="fig1s2">Figure 1—figure supplement 2</xref>: first residues with <italic>Z</italic>&lt;−0.5 are selected for fragment-based rebuilding, followed by <italic>Z</italic>&lt;−0.3, <italic>Z</italic>&lt;−0.1, and finally <italic>Z</italic>&lt;0. Between each cycle, a single iteration of <italic>Relax</italic> is run, in the same manner as in the pre-refinement step. At the start of each stage, the <inline-formula><mml:math id="inf9"><mml:mrow><mml:msubsup><mml:mi>Z</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>r</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> of a model is re-evaluated as above to avoid refining fixed errors from the previous stage, and residues predicted to be in error are selected. Finally, an additional 200-step Monte Carlo trajectory is run with the <inline-formula><mml:math id="inf10"><mml:mrow><mml:msubsup><mml:mi>Z</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>r</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> computing solely from <inline-formula><mml:math id="inf11"><mml:mrow><mml:msubsup><mml:mi>Z</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>m</mml:mi><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> to ensure the favorable Ramachandran geometry in models.</p></sec><sec id="s4-5"><title>Pre-proline Ramachandran potential</title><p>Following early experiments, a new term was added to Rosetta that enforces a distinct pre-proline Ramachandran potential, replacing the original 20 different potentials:<disp-formula id="equ2"><mml:math id="m2"><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>m</mml:mi><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>φ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>ψ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:mi>A</mml:mi><mml:msub><mml:mi>A</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula></p><p>With 40 different potentials conditioned on the sequence identity of the C-terminal adjacent residue:<disp-formula id="equ3"><mml:math id="m3"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>m</mml:mi><mml:mi>a</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>φ</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>ψ</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>A</mml:mi><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi mathvariant="normal">_</mml:mi><mml:mi>p</mml:mi><mml:mi>r</mml:mi><mml:msub><mml:mi>o</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>This potential was trained using the Richardson 8000 set of high-resolution crystal structures (<xref ref-type="bibr" rid="bib10">Chen et al., 2010</xref>), and smoothed using adaptive kernel density estimates, as with the original Ramachandran potential (<xref ref-type="bibr" rid="bib26">Ting et al., 2010</xref>). They are included in the released Rosetta with the energy term <italic>rama_prepro</italic> (using the same weight as the Rosetta term <italic>rama</italic>). <xref ref-type="fig" rid="fig1s4">Figure 1—figure supplement 4</xref> illustrates the resulting potentials. For all experiments in this manuscript, this term replaced the default Ramachandran score term in Rosetta.</p></sec><sec id="s4-6"><title>Local relax</title><p>Following our four cycles of refinement, we run a modified version of <italic>Relax</italic>, which we call <italic>LocalRelax</italic>. Modifications were made following the observation that – when applied to very large complexes (800+ residues) – we observed many instances in which sidechains were not properly optimized into density, even though the density was very clear. <xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1</xref> shows several such cases.</p><p>In <italic>Local Relax</italic>, small overlapping regions of ~20–100 residues (discontinuous in sequence space) are selected for optimization repeatedly, until the entire protein has been optimized at least once. The approach is based upon the idea of neighbor residues, where residue neighbors are defined as all residues with a Cβ-Cβ distance less than 8Å. We first find the residue <italic>r<sub>i </sub></italic>with the most residue neighbors. Then we optimize the neighbors of <italic>r<sub>i</sub></italic>, and the neighbors-of-neighbors of <italic>r<sub>i</sub></italic>: the neighbors are allowed to optimize both sidechain and backbone conformation, while the neighbors-of-neighbors may only optimize sidechain conformation. This optimization is performed via Monte Carlo sampling of sidechain rotamers, followed by Cartesian minimization of all movable atoms. Following this, all neighbors of <italic>r<sub>i</sub></italic> (as well as <italic>r<sub>i</sub></italic>) are marked as visited, and the process repeats, selecting a new <italic>r<sub>i</sub></italic> as the unmarked residue with the most neighbors. This process continues until all residues are marked. In total, four cycles of this procedure are carried out, increasing the weight on van der Waals repulsion in each cycle. Finally, following coordinate refinement with <italic>LocalRelax</italic>, we fit atomic B-factors following the scheme described in our previous paper (<xref ref-type="bibr" rid="bib14">DiMaio et al., 2015</xref>).</p></sec><sec id="s4-7"><title>Sidechain rescaling</title><p>We compute a scale factor associated with each sidechain that describes how much contribution to the density score is made by each sidechain. The values were computed using the 3.3-Å reconstruction of the 20S proteasome (<xref ref-type="bibr" rid="bib22">Li et al., 2013</xref>) and the 3.2-Å reconstruction of β-galactosidase (<xref ref-type="bibr" rid="bib5">Bartesaghi et al., 2014</xref>). Models were refined into the density and real-space atomic B-factors were fit for each atom. We then converted the atomic B-factors to scale factors using the following transformation:<disp-formula id="equ4"><mml:math id="m4"><mml:mrow><mml:mi>s</mml:mi><mml:mi>c</mml:mi><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:msub><mml:mi>e</mml:mi><mml:mrow><mml:mi>A</mml:mi><mml:mi>A</mml:mi></mml:mrow></mml:msub><mml:mo>≈</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msup><mml:mi>B</mml:mi><mml:mrow><mml:mn>3</mml:mn><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula></p><p>Scales were normalized such that the scale for all backbone atoms was equal to 1. To prevent overfitting, each sidechain was grouped into one of three classes, and all sidechains within a given group were given the average scale factor of the group. Finally, while maintaining the ratio of these three groups with respect to one another, we scaled the relative contribution of backbone versus sidechain density, and selected the best values on the basis of free FSC following refinement. The final values range from 0.66 to 0.78, and are tabulated in <xref ref-type="table" rid="tbl3">Table 3</xref>.<table-wrap id="tbl3" position="float"><object-id pub-id-type="doi">10.7554/eLife.17219.018</object-id><label>Table 3.</label><caption><p>Sidechain scaling factors used in automated Rosetta structure refinement.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.17219.018">http://dx.doi.org/10.7554/eLife.17219.018</ext-link></p></caption><table frame="hsides" rules="groups"><thead><tr><th>Sidechain</th><th>Raw data</th><th>Factor used</th></tr></thead><tbody><tr><td style="background: #FFB74D;" valign="bottom">ARG</td><td style="background: #FFB74D;" valign="bottom">0.84</td><td style="background: #FFB74D;" valign="bottom">0.66</td></tr><tr><td style="background: #FFB74D;" valign="bottom">LYS</td><td style="background: #FFB74D;" valign="bottom">0.84</td><td style="background: #FFB74D;" valign="bottom">0.66</td></tr><tr><td style="background: #FFB74D;" valign="bottom">GLU</td><td style="background: #FFB74D;" valign="bottom">0.85</td><td style="background: #FFB74D;" valign="bottom">0.66</td></tr><tr><td style="background: #FFB74D;" valign="bottom">MET</td><td style="background: #FFB74D;" valign="bottom">0.87</td><td style="background: #FFB74D;" valign="bottom">0.66</td></tr><tr><td style="background: #FFB74D;" valign="bottom">ASP</td><td style="background: #FFB74D;" valign="bottom">0.88</td><td style="background: #FFB74D;" valign="bottom">0.66</td></tr><tr><td style="background: #C5E1A5;" valign="bottom">CYS</td><td style="background: #C5E1A5;" valign="bottom">0.87</td><td style="background: #C5E1A5;" valign="bottom">0.71</td></tr><tr><td style="background: #C5E1A5;" valign="bottom">GLN</td><td style="background: #C5E1A5;" valign="bottom">0.89</td><td style="background: #C5E1A5;" valign="bottom">0.71</td></tr><tr><td style="background: #C5E1A5;" valign="bottom">HIS</td><td style="background: #C5E1A5;" valign="bottom">0.91</td><td style="background: #C5E1A5;" valign="bottom">0.71</td></tr><tr><td style="background: #C5E1A5;" valign="bottom">ASN</td><td style="background: #C5E1A5;" valign="bottom">0.91</td><td style="background: #C5E1A5;" valign="bottom">0.71</td></tr><tr><td style="background: #C5E1A5;" valign="bottom">THR</td><td style="background: #C5E1A5;" valign="bottom">0.94</td><td style="background: #C5E1A5;" valign="bottom">0.71</td></tr><tr><td style="background: #C5E1A5;" valign="bottom">SER</td><td style="background: #C5E1A5;" valign="bottom">0.95</td><td style="background: #C5E1A5;" valign="bottom">0.71</td></tr><tr><td style="background: #90CAF9;" valign="bottom">TYR</td><td style="background: #90CAF9;" valign="bottom">0.95</td><td style="background: #90CAF9;" valign="bottom">0.78</td></tr><tr><td style="background: #90CAF9;" valign="bottom">TRP</td><td style="background: #90CAF9;" valign="bottom">0.96</td><td style="background: #90CAF9;" valign="bottom">0.78</td></tr><tr><td style="background: #90CAF9;" valign="bottom">ALA</td><td style="background: #90CAF9;" valign="bottom">0.97</td><td style="background: #90CAF9;" valign="bottom">0.78</td></tr><tr><td style="background: #90CAF9;" valign="bottom">PHE</td><td style="background: #90CAF9;" valign="bottom">0.98</td><td style="background: #90CAF9;" valign="bottom">0.78</td></tr><tr><td style="background: #90CAF9;" valign="bottom">PRO</td><td style="background: #90CAF9;" valign="bottom">0.98</td><td style="background: #90CAF9;" valign="bottom">0.78</td></tr><tr><td style="background: #90CAF9;" valign="bottom">ILE</td><td style="background: #90CAF9;" valign="bottom">0.99</td><td style="background: #90CAF9;" valign="bottom">0.78</td></tr><tr><td style="background: #90CAF9;" valign="bottom">LEU</td><td style="background: #90CAF9;" valign="bottom">0.99</td><td style="background: #90CAF9;" valign="bottom">0.78</td></tr><tr><td style="background: #90CAF9;" valign="bottom">VAL</td><td style="background: #90CAF9;" valign="bottom">1.00</td><td style="background: #90CAF9;" valign="bottom">0.78</td></tr></tbody></table></table-wrap></p></sec><sec id="s4-8"><title>Voxel-size refinement</title><p>To optimize the voxel size of a map used to refine the model, we fix the model coordinates, and compute the model density. We then refine the voxel size <inline-formula><mml:math id="inf12"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>v</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mrow><mml:mi>z</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> and the origin <inline-formula><mml:math id="inf13"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>o</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mi>o</mml:mi><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>o</mml:mi><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>o</mml:mi><mml:mrow><mml:mi>z</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:mstyle></mml:math></inline-formula> of the map density – fixing these parameters in the model density – to maximize the real-space correlation coefficient between the two:<disp-formula id="equ5"><mml:math id="m5"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mtable columnalign="left left" columnspacing="1em" rowspacing="4pt"><mml:mtr><mml:mtd><mml:mi>C</mml:mi><mml:mi>C</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>o</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mtd><mml:mtd><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mover><mml:mo>∑</mml:mo><mml:mrow><mml:mtext>​</mml:mtext></mml:mrow></mml:mover><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>o</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mover><mml:mi>x</mml:mi><mml:mo stretchy="false">⇀</mml:mo></mml:mover><mml:mo>)</mml:mo></mml:mrow><mml:mo>⋅</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mover><mml:mi>I</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>o</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mover><mml:mi>x</mml:mi><mml:mo stretchy="false">⇀</mml:mo></mml:mover><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mover><mml:mo>∑</mml:mo><mml:mrow><mml:mtext>​</mml:mtext></mml:mrow></mml:mover><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>o</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mover><mml:mi>x</mml:mi><mml:mo stretchy="false">⇀</mml:mo></mml:mover><mml:mo>)</mml:mo></mml:mrow><mml:mo>⋅</mml:mo><mml:mover><mml:mo>∑</mml:mo><mml:mrow><mml:mtext>​</mml:mtext></mml:mrow></mml:mover><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mover><mml:mi>I</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>o</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mover><mml:mi>x</mml:mi><mml:mo stretchy="false">⇀</mml:mo></mml:mover><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mi>o</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mover><mml:mi>x</mml:mi><mml:mo stretchy="false">⇀</mml:mo></mml:mover><mml:mo>)</mml:mo></mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mover><mml:mi>I</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>o</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mover><mml:mi>x</mml:mi><mml:mo stretchy="false">⇀</mml:mo></mml:mover><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mfrac></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mover><mml:mi>I</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mi>o</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>z</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mtd><mml:mtd><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>o</mml:mi><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>x</mml:mi><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>o</mml:mi><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>y</mml:mi><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>o</mml:mi><mml:mrow><mml:mi>z</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>z</mml:mi><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mrow><mml:mi>z</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mstyle></mml:math></disp-formula></p><p>Here, <inline-formula><mml:math id="inf14"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> refers to the experimental map and <inline-formula><mml:math id="inf15"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> to the map derived from the model, while <inline-formula><mml:math id="inf16"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mi>o</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> and <inline-formula><mml:math id="inf17"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> refer to the standard deviations over the corresponding density maps. Sums are taken over the entire map. Off-grid density values are computed using cubic splines to interpolate the calculated density map. This function is optimized with respect to the voxel-size parameters using l-BFGS minimization; analytic derivatives are computed for CC with respect to <italic>v</italic> and <italic>o</italic>, and the same cubic splines are used to calculate derivatives with respect to the calculated map. Voxel size may be refined isotropically or anisotropically (using either four or six total parameters); all experiments in this manuscript treated this refinement isotropically (that is, all three axes are scaled together).</p><p>In this report, although we carried out voxel-size refinement for each of the three targets, we found only minimal changes of voxel size in all the cases. For fair comparison, we report all of the model-to-map metrics using maps with the deposited voxel sizes.</p></sec><sec id="s4-9"><title>Refinement against the full reconstruction and model selection</title><p>The previously described protocol was run to generate 5000 independent trajectories. From these 5000 models, a set of 10 representative models is chosen, following the protocol outlined in <xref ref-type="fig" rid="fig1">Figure 1</xref>. We want our optimized models to be optimal simultaneously in terms of: (a) independent map agreement, (b) physically realistic geometry, and (c) agreement to the full reconstruction. The last of these three is necessary because the full reconstruction often features details that are not present in the independent half maps.</p><p>Independent-map FSCs were computed against the validation map – subject to the same sharpening scheme as the training map – using the <italic>ComputeFSC</italic> mover in Rosetta. The integrated FSC between 10 Å and the reported resolution (3.4 Å in all cases) of the map was used to assess agreement with the independent map. The script computes FSC after masking the map with a mask computed from the model and filtered to 12Å with the command line:</p><p><italic>density_tools.exe -in:file:s model.pdb -mapfile validation_map.mrc -mask_radius 12 -nresbins 50 -lowres 10 -hires 3.4 -verbose</italic></p><p>In the case of the mitochondrial ribsosome, each segmented domain map was evaluated separately. Of the 1000 generated models, the top 50 by independent map agreement are selected.</p><p>Next, we want to identify the models from this subset that are the most physically realistic. To do this, all 50 models are rescored with MolProbity (<xref ref-type="bibr" rid="bib10">Chen et al., 2010</xref>), and the top 10 are selected. While computing similar features to the Rosetta energy, its slightly different implementation makes it a somewhat orthogonal measure for structure evaluation.</p><p>Finally, we want to use features from the full reconstruction to further improve the model, particularly bulky sidechains that may not be visible in the half-map reconstructions. However, when refining against the full reconstruction, we need to be careful not to overfit to the full reconstruction, as we no longer have an independent map with which to evaluate overfitting. We use two ideas to avoid overfitting in this case. First, we do not perform any fragment-based rebuilding with the full map, and instead we perform just two cycles of <italic>LocalRelax</italic> and B-factor refinement with the full map. Second, we use half maps to determine the optimal fit-to-density weight when refining against the full map. The weight is selected using the following relation, where the weight is chosen to maximize the following:<disp-formula id="equ6"><mml:math id="m6"><mml:mrow><mml:mi>U</mml:mi><mml:mo>=</mml:mo><mml:mi>F</mml:mi><mml:mi>S</mml:mi><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mi>f</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mn>0.004</mml:mn><mml:mo>∙</mml:mo><mml:msub><mml:mi>E</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></disp-formula></p><p>Here, <italic>E<sub>i</sub></italic> is the per-residue energy, and is included as additional regularization to avoid overfitting. The value of 0.004 was chosen to normalize the two based on the relative dynamic ranges of both terms.</p><p>The top 10 models from the previous selection are subject to refinement against the full map. The final model is then taken as the model with best integrated-FSC against the full reconstruction. Local deviation over all ten models is used to estimate model uncertainty. The per-residue structural variance of ensemble models is calculated using <italic>Theseus</italic> with the default command line (<xref ref-type="bibr" rid="bib25">Theobald and Wuttke, 2008</xref>).</p></sec><sec id="s4-10"><title>Assembly of the mitochondrial ribosome</title><p>In the case of the mitochondrial ribosome, we refine separate models for each protein subunit. A final assembly step combines the full model. In this final assembly step, all subunits, plus the deposited nucleic acid chains are combined in a single model, and are subject to 2 cycles of <italic>LocalRelax</italic> against the full reconstruction.</p></sec><sec id="s4-11"><title>EMRinger score calculation</title><p>For each of the five models following model selection, EMringer was run using the command:</p><p><italic>phenix.emringer MODEL.pdb MAP.ccp4</italic></p><p>To calculate per-chain EMRinger scores, pdb files were first segmented by chain ID and then EMringer scores were calculated against the segmented pdb files.</p><p>EMRinger scores can be compared absolutely between structures, although model size and local resolution variation are sources of noise for the EMRinger score. Scores below one are indicators of suboptimal model to map agreement for structures better than 4-Å resolution, while a score around zero indicates no improvement beyond randomness.</p></sec><sec id="s4-12"><title>Phenix real-space refinement</title><p>Starting from the deposited model for each of the three targets, real-space refinement was carried out using the Phenix package (v. 2450) with a default setting using the command:</p><p><italic>phenix.real_space_refine MODEL.pdb MAP.mrc resolution=3.4</italic></p><p>For the case of Frh, ligand files were appended to the above command with cif files generated using the command:</p><p><italic>phenix.elbow ligands.pdb</italic></p></sec><sec id="s4-13"><title>Availability</title><p>All methods described are available as part of Rosetta Software Suite, using weekly releases after week 35, 2016. The Rosetta XML files and flags for running all the refinements discussed in this manuscript are included as <xref ref-type="supplementary-material" rid="SD2-data">Supplementary files 1</xref>–<xref ref-type="supplementary-material" rid="SD4-data">3</xref>. The scripts and the tutorial used for running the method described here is available at the website of the corresponding author (<ext-link ext-link-type="uri" xlink:href="https://faculty.washington.edu/dimaio/files/density_tutorial_sept15_2.pdf">https://faculty.washington.edu/dimaio/files/density_tutorial_sept15_2.pdf</ext-link>).</p></sec></sec></body><back><ack id="ack"><title>Acknowledgements</title><p>The authors thank Drs Alan Brown, Alexy Amunts and Venki Ramakrishnan for sharing the half maps of the mitoribosomal large subunit (EMD-2762) with us; the authors especially thank Dr Alan Brown for providing helpful comments on the Rosetta refined mitoribosome, in which the suggestions led to the new development of better optimizing sidechains in very large protein complexes. The authors thank Drs Metteo Allegretti and Janet Vonck for sharing the half maps of Frh (EMD-2513) with us. We thank Dr Erhu Cao for commenting on the refined TRPV1 model initially. We thank Dr Vikram Mulligan for help on using the '-<italic>auto_setup_metals</italic>' module that he developed to facilitate ligand setup in modeling Frh using Rosetta. We also thank the members of the RosettaCommons for the continuted developement of the Rosetta Software Suite. RY-RW is grateful to Dr David Baker for the support and for suggesting avenues of research. This work was supported by the US National Institutes of Health under award numbers R01GM098672 (YC), P50GM082250 (YC), 1P01GM111126 (YC), and GM110580 (JSF); the US National Science Foundation under award number STC-1231306 (JSF).</p></ack><sec id="s5" sec-type="additional-information"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="conflict" id="conf2"><p>YS: Co-founder of Cyrus Biotechnology, Inc., which will develop and market graphic-interface software for using Rosetta.</p></fn><fn fn-type="conflict" id="conf1"><p>The other authors declare that no competing interests exist.</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>RY-RW, Conception and design, Acquisition of data, Analysis and interpretation of data, Drafting or revising the article</p></fn><fn fn-type="con" id="con2"><p>YS, Conception and design</p></fn><fn fn-type="con" id="con3"><p>BAB, Performed the EMringer analysis, Analysis and interpretation of data</p></fn><fn fn-type="con" id="con4"><p>YC, Provided the TRPV1 half-map data set with various bfactor sharpening, and analyzed and interpreted the results on the TRPV1 refinement, Analysis and interpretation of data</p></fn><fn fn-type="con" id="con5"><p>JSF, Performed the EMringer analysis, Analysis and interpretation of data</p></fn><fn fn-type="con" id="con6"><p>FD, Conception and design, Analysis and interpretation of data, Drafting or revising the article</p></fn></fn-group></sec><sec id="s6" sec-type="supplementary-material"><title>Additional files</title><supplementary-material id="SD2-data"><object-id pub-id-type="doi">10.7554/eLife.17219.019</object-id><label>Supplementary file 1.</label><caption><title>Input files to carry out the TRPV1 structure refinement described in the manuscript.</title><p>Structure refinement of TRPV1 using Rosetta involves two steps: (1) refinement of only the transmembrane regions, and (2) refinement of the full system, including the Ankyrin repeat domains. The package includes two folders, one for each of the two steps with the command lines and input files necessary to run TRPV1 structure refinement.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.17219.019">http://dx.doi.org/10.7554/eLife.17219.019</ext-link></p></caption><media mime-subtype="x-gzip" mimetype="application" xlink:href="elife-17219-supp1-v2.gz"/></supplementary-material><supplementary-material id="SD3-data"><object-id pub-id-type="doi">10.7554/eLife.17219.020</object-id><label>Supplementary file 2.</label><caption><title>Input files to carry out the Frh structure refinement described in the manuscript.</title><p>Structure refinement of Frh using Rosetta involves three steps: (1) refinement of the asymmetric unit without ligands present, (2) local refinement of the asymmetric unit with the ligands present, and (3) local refinement the full symmetric complex with ligands present. The package includes three folders, one for each of the three steps with the command lines and input files necessary to run Frh structure refinement.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.17219.020">http://dx.doi.org/10.7554/eLife.17219.020</ext-link></p></caption><media mime-subtype="x-gzip" mimetype="application" xlink:href="elife-17219-supp2-v2.gz"/></supplementary-material><supplementary-material id="SD4-data"><object-id pub-id-type="doi">10.7554/eLife.17219.021</object-id><label>Supplementary file 3.</label><caption><title>Input files to carry out the Mitoribosome structure refinement described in the manuscript.</title><p>Structure refinement of the case of Mitoribosome using Rosetta involves in two steps: (1) refinement of individual chains, and (2) local refinement the whole assembly. The package includes two folders, one for each of the two steps with the command lines and input files necessary to run Mitoribosome structure refinement.</p><p><bold>DOI:</bold> <ext-link ext-link-type="doi" xlink:href="10.7554/eLife.17219.021">http://dx.doi.org/10.7554/eLife.17219.021</ext-link></p></caption><media mime-subtype="x-gzip" mimetype="application" xlink:href="elife-17219-supp3-v2.gz"/></supplementary-material><sec id="s7" sec-type="datasets"><title>Major datasets</title><p>The following previously published datasets were used:</p><p><related-object content-type="generated-dataset" id="data-ro1" source-id="https://www.ebi.ac.uk/pdbe/entry/emdb/EMD-5778" source-id-type="uri"><collab>Liao M</collab><x>,</x> <collab>Cao E</collab><x>,</x> <collab>Julius D</collab><x>,</x> <collab>Cheng Y</collab><x>,</x> <year>2013</year><x>,</x><source>Structure of the capsaicin receptor, TRPV1, determined by single particle electron cryo-microscopy</source><x>,</x> <ext-link ext-link-type="uri" xlink:href="https://www.ebi.ac.uk/pdbe/entry/emdb/EMD-5778">https://www.ebi.ac.uk/pdbe/entry/emdb/EMD-5778</ext-link><x>,</x> <comment>Publicly available at EBI Protein Data Bank in Europe (accession no: EMD-5778)</comment></related-object></p><p><related-object content-type="generated-dataset" id="data-ro2" source-id="http://www.ebi.ac.uk/pdbe/entry/emdb/EMD-2513/" source-id-type="uri"><collab>Allegretti M</collab><x>,</x> <collab>Mills DJ</collab><x>,</x> <collab>McMullan G</collab><x>,</x> <collab>Kuehlbrandt W</collab><x>,</x> <collab>Vonck J</collab><x>,</x> <year>2014</year><x>,</x><source>Electron cryo-microscopy of F420-reducing [NiFe] hydrogenase Frh</source><x>,</x> <ext-link ext-link-type="uri" xlink:href="http://www.ebi.ac.uk/pdbe/entry/emdb/EMD-2513/">http://www.ebi.ac.uk/pdbe/entry/emdb/EMD-2513/</ext-link><x>,</x> <comment>Publicly available at EBI Protein Data Bank in Europe (accession no: EMD-2513)</comment></related-object></p><p><related-object content-type="generated-dataset" id="data-ro3" source-id="http://www.ebi.ac.uk/pdbe/entry/emdb/EMD-2762" source-id-type="uri"><collab>Brown A</collab><x>,</x> <collab>Amunts A</collab><x>,</x> <collab>Bai XC</collab><x>,</x> <collab>Sugimoto Y</collab><x>,</x> <collab>Edwards PC</collab><x>,</x> <collab>Murshudov G</collab><x>,</x> <collab>Scheres SHW</collab><x>,</x> <collab>Ramakrishnan V</collab><x>,</x> <year>2014</year><x>,</x><source>Electron cryo-microscopy of human mitochondrial large ribosomal subunit</source><x>,</x> <ext-link ext-link-type="uri" xlink:href="http://www.ebi.ac.uk/pdbe/entry/emdb/EMD-2762">http://www.ebi.ac.uk/pdbe/entry/emdb/EMD-2762</ext-link><x>,</x> <comment>Publicly available at EBI Protein Data Bank in Europe (accession no: EMD-2762)</comment></related-object></p></sec></sec><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Afonine</surname><given-names>PV</given-names></name><name><surname>Grosse-Kunstleve</surname><given-names>RW</given-names></name><name><surname>Echols</surname><given-names>N</given-names></name><name><surname>Headd</surname><given-names>JJ</given-names></name><name><surname>Moriarty</surname><given-names>NW</given-names></name><name><surname>Mustyakimov</surname><given-names>M</given-names></name><name><surname>Terwilliger</surname><given-names>TC</given-names></name><name><surname>Urzhumtsev</surname><given-names>A</given-names></name><name><surname>Zwart</surname><given-names>PH</given-names></name><name><surname>Adams</surname><given-names>PD</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Towards automated crystallographic structure refinement with phenix.refine</article-title><source>Acta Crystallographica Section D Biological Crystallography</source><volume>68</volume><fpage>352</fpage><lpage>367</lpage><pub-id pub-id-type="doi">10.1107/S0907444912001308</pub-id><pub-id pub-id-type="pmid">22505256</pub-id></element-citation></ref><ref id="bib2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Allegretti</surname><given-names>M</given-names></name><name><surname>Mills</surname><given-names>DJ</given-names></name><name><surname>McMullan</surname><given-names>G</given-names></name><name><surname>Kühlbrandt</surname><given-names>W</given-names></name><name><surname>Vonck</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Atomic model of the F420-reducing [NiFe] hydrogenase by electron cryo-microscopy using a direct electron detector</article-title><source>eLife</source><volume>3</volume><elocation-id>e01963</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.01963</pub-id><pub-id pub-id-type="pmid">24569482</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bai</surname><given-names>XC</given-names></name><name><surname>Fernandez</surname><given-names>IS</given-names></name><name><surname>McMullan</surname><given-names>G</given-names></name><name><surname>Scheres</surname><given-names>SH</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Ribosome structures to near-atomic resolution from thirty thousand cryo-EM particles</article-title><source>eLife</source><volume>2</volume><elocation-id>e00461</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.00461</pub-id><pub-id pub-id-type="pmid">23427024</pub-id></element-citation></ref><ref id="bib4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Barad</surname><given-names>BA</given-names></name><name><surname>Echols</surname><given-names>N</given-names></name><name><surname>Wang</surname><given-names>RY</given-names></name><name><surname>Cheng</surname><given-names>Y</given-names></name><name><surname>DiMaio</surname><given-names>F</given-names></name><name><surname>Adams</surname><given-names>PD</given-names></name><name><surname>Fraser</surname><given-names>JS</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>EMRinger: side chain-directed model and map validation for 3D cryo-electron microscopy</article-title><source>Nature Methods</source><volume>12</volume><fpage>943</fpage><lpage>946</lpage><pub-id pub-id-type="doi">10.1038/nmeth.3541</pub-id><pub-id pub-id-type="pmid">26280328</pub-id></element-citation></ref><ref id="bib5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bartesaghi</surname><given-names>A</given-names></name><name><surname>Matthies</surname><given-names>D</given-names></name><name><surname>Banerjee</surname><given-names>S</given-names></name><name><surname>Merk</surname><given-names>A</given-names></name><name><surname>Subramaniam</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Structure of -galactosidase at 3.2-A resolution obtained by cryo-electron microscopy</article-title><source>PNAS</source><volume>111</volume><fpage>11709</fpage><lpage>11714</lpage><pub-id pub-id-type="doi">10.1073/pnas.1402809111</pub-id></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Brown</surname><given-names>A</given-names></name><name><surname>Amunts</surname><given-names>A</given-names></name><name><surname>Bai</surname><given-names>XC</given-names></name><name><surname>Sugimoto</surname><given-names>Y</given-names></name><name><surname>Edwards</surname><given-names>PC</given-names></name><name><surname>Murshudov</surname><given-names>G</given-names></name><name><surname>Scheres</surname><given-names>SH</given-names></name><name><surname>Ramakrishnan</surname><given-names>V</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Structure of the large ribosomal subunit from human mitochondria</article-title><source>Science</source><volume>346</volume><fpage>718</fpage><lpage>722</lpage><pub-id pub-id-type="doi">10.1126/science.1258026</pub-id><pub-id pub-id-type="pmid">25278503</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Brown</surname><given-names>A</given-names></name><name><surname>Long</surname><given-names>F</given-names></name><name><surname>Nicholls</surname><given-names>RA</given-names></name><name><surname>Toots</surname><given-names>J</given-names></name><name><surname>Emsley</surname><given-names>P</given-names></name><name><surname>Murshudov</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Tools for macromolecular model building and refinement into electron cryo-microscopy reconstructions</article-title><source>Acta Crystallographica Section D Biological Crystallography</source><volume>71</volume><fpage>136</fpage><lpage>153</lpage><pub-id pub-id-type="doi">10.1107/S1399004714021683</pub-id><pub-id pub-id-type="pmid">25615868</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Brunger</surname><given-names>AT</given-names></name><name><surname>DeLaBarre</surname><given-names>B</given-names></name><name><surname>Davies</surname><given-names>JM</given-names></name><name><surname>Weis</surname><given-names>WI</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>X-ray structure determination at low resolution</article-title><source>Acta Crystallographica Section D Biological Crystallography</source><volume>65</volume><fpage>128</fpage><lpage>133</lpage><pub-id pub-id-type="doi">10.1107/S0907444908043795</pub-id><pub-id pub-id-type="pmid">19171967</pub-id></element-citation></ref><ref id="bib9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Campbell</surname><given-names>MG</given-names></name><name><surname>Veesler</surname><given-names>D</given-names></name><name><surname>Cheng</surname><given-names>A</given-names></name><name><surname>Potter</surname><given-names>CS</given-names></name><name><surname>Carragher</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>2.8 Å resolution reconstruction of the Thermoplasma acidophilum 20S proteasome using cryo-electron microscopy</article-title><source>eLife</source><volume>4</volume><elocation-id>e06380</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.06380</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname><given-names>VB</given-names></name><name><surname>Arendall</surname><given-names>WB</given-names></name><name><surname>Headd</surname><given-names>JJ</given-names></name><name><surname>Keedy</surname><given-names>DA</given-names></name><name><surname>Immormino</surname><given-names>RM</given-names></name><name><surname>Kapral</surname><given-names>GJ</given-names></name><name><surname>Murray</surname><given-names>LW</given-names></name><name><surname>Richardson</surname><given-names>JS</given-names></name><name><surname>Richardson</surname><given-names>DC</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>MolProbity: all-atom structure validation for macromolecular crystallography</article-title><source>Acta Crystallographica Section D Biological Crystallography</source><volume>66</volume><fpage>12</fpage><lpage>21</lpage><pub-id pub-id-type="doi">10.1107/S0907444909042073</pub-id><pub-id pub-id-type="pmid">20057044</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chuang</surname><given-names>HH</given-names></name><name><surname>Lin</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Oxidative challenges sensitize the capsaicin receptor by covalent cysteine modification</article-title><source>PNAS</source><volume>106</volume><fpage>20097</fpage><lpage>20102</lpage><pub-id pub-id-type="doi">10.1073/pnas.0902675106</pub-id><pub-id pub-id-type="pmid">19897733</pub-id></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Conway</surname><given-names>P</given-names></name><name><surname>Tyka</surname><given-names>MD</given-names></name><name><surname>DiMaio</surname><given-names>F</given-names></name><name><surname>Konerding</surname><given-names>DE</given-names></name><name><surname>Baker</surname><given-names>D</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Relaxation of backbone bond geometry improves protein energy landscape modeling</article-title><source>Protein Science</source><volume>23</volume><fpage>47</fpage><lpage>55</lpage><pub-id pub-id-type="doi">10.1002/pro.2389</pub-id><pub-id pub-id-type="pmid">24265211</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>DeLaBarre</surname><given-names>B</given-names></name><name><surname>Brunger</surname><given-names>AT</given-names></name></person-group><year iso-8601-date="2006">2006</year><article-title>Considerations for the refinement of low-resolution crystal structures</article-title><source>Acta Crystallographica Section D Biological Crystallography</source><volume>62</volume><fpage>923</fpage><lpage>932</lpage><pub-id pub-id-type="doi">10.1107/S0907444906012650</pub-id><pub-id pub-id-type="pmid">16855310</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>DiMaio</surname><given-names>F</given-names></name><name><surname>Song</surname><given-names>Y</given-names></name><name><surname>Li</surname><given-names>X</given-names></name><name><surname>Brunner</surname><given-names>MJ</given-names></name><name><surname>Xu</surname><given-names>C</given-names></name><name><surname>Conticello</surname><given-names>V</given-names></name><name><surname>Egelman</surname><given-names>E</given-names></name><name><surname>Marlovits</surname><given-names>TC</given-names></name><name><surname>Cheng</surname><given-names>Y</given-names></name><name><surname>Baker</surname><given-names>D</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Atomic-accuracy models from 4.5-Å cryo-electron microscopy data with density-guided iterative local refinement</article-title><source>Nature Methods</source><volume>12</volume><fpage>361</fpage><lpage>365</lpage><pub-id pub-id-type="doi">10.1038/nmeth.3286</pub-id><pub-id pub-id-type="pmid">25707030</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>DiMaio</surname><given-names>F</given-names></name><name><surname>Zhang</surname><given-names>J</given-names></name><name><surname>Chiu</surname><given-names>W</given-names></name><name><surname>Baker</surname><given-names>D</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Cryo-EM model validation using independent map reconstructions</article-title><source>Protein Science</source><volume>22</volume><fpage>865</fpage><lpage>868</lpage><pub-id pub-id-type="doi">10.1002/pro.2267</pub-id><pub-id pub-id-type="pmid">23592445</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Emsley</surname><given-names>P</given-names></name><name><surname>Lohkamp</surname><given-names>B</given-names></name><name><surname>Scott</surname><given-names>WG</given-names></name><name><surname>Cowtan</surname><given-names>K</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Features and development of Coot</article-title><source>Acta Crystallographica Section D Biological Crystallography</source><volume>66</volume><fpage>486</fpage><lpage>501</lpage><pub-id pub-id-type="doi">10.1107/S0907444910007493</pub-id><pub-id pub-id-type="pmid">20383002</pub-id></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fernández</surname><given-names>IS</given-names></name><name><surname>Bai</surname><given-names>XC</given-names></name><name><surname>Murshudov</surname><given-names>G</given-names></name><name><surname>Scheres</surname><given-names>SH</given-names></name><name><surname>Ramakrishnan</surname><given-names>V</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Initiation of translation by cricket paralysis virus IRES requires its translocation in the ribosome</article-title><source>Cell</source><volume>157</volume><fpage>823</fpage><lpage>831</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2014.04.015</pub-id><pub-id pub-id-type="pmid">24792965</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Headd</surname><given-names>JJ</given-names></name><name><surname>Echols</surname><given-names>N</given-names></name><name><surname>Afonine</surname><given-names>PV</given-names></name><name><surname>Grosse-Kunstleve</surname><given-names>RW</given-names></name><name><surname>Chen</surname><given-names>VB</given-names></name><name><surname>Moriarty</surname><given-names>NW</given-names></name><name><surname>Richardson</surname><given-names>DC</given-names></name><name><surname>Richardson</surname><given-names>JS</given-names></name><name><surname>Adams</surname><given-names>PD</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Use of knowledge-based restraints in phenix.refine to improve macromolecular refinement at low resolution</article-title><source>Acta Crystallographica Section D Biological Crystallography</source><volume>68</volume><fpage>381</fpage><lpage>390</lpage><pub-id pub-id-type="doi">10.1107/S0907444911047834</pub-id><pub-id pub-id-type="pmid">22505258</pub-id></element-citation></ref><ref id="bib19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jackson</surname><given-names>RN</given-names></name><name><surname>McCoy</surname><given-names>AJ</given-names></name><name><surname>Terwilliger</surname><given-names>TC</given-names></name><name><surname>Read</surname><given-names>RJ</given-names></name><name><surname>Wiedenheft</surname><given-names>B</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>X-ray structure determination using low-resolution electron microscopy maps for molecular replacement</article-title><source>Nature Protocols</source><volume>10</volume><fpage>1275</fpage><lpage>1284</lpage><pub-id pub-id-type="doi">10.1038/nprot.2015.069</pub-id><pub-id pub-id-type="pmid">26226459</pub-id></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kucukelbir</surname><given-names>A</given-names></name><name><surname>Sigworth</surname><given-names>FJ</given-names></name><name><surname>Tagare</surname><given-names>HD</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Quantifying the local resolution of cryo-EM density maps</article-title><source>Nature Methods</source><volume>11</volume><fpage>63</fpage><lpage>65</lpage><pub-id pub-id-type="doi">10.1038/nmeth.2727</pub-id><pub-id pub-id-type="pmid">24213166</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kudryashev</surname><given-names>M</given-names></name><name><surname>Wang</surname><given-names>RY</given-names></name><name><surname>Brackmann</surname><given-names>M</given-names></name><name><surname>Scherer</surname><given-names>S</given-names></name><name><surname>Maier</surname><given-names>T</given-names></name><name><surname>Baker</surname><given-names>D</given-names></name><name><surname>DiMaio</surname><given-names>F</given-names></name><name><surname>Stahlberg</surname><given-names>H</given-names></name><name><surname>Egelman</surname><given-names>EH</given-names></name><name><surname>Basler</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Structure of the type VI secretion system contractile sheath</article-title><source>Cell</source><volume>160</volume><fpage>952</fpage><lpage>962</lpage><pub-id pub-id-type="doi">10.1016/j.cell.2015.01.037</pub-id><pub-id pub-id-type="pmid">25723169</pub-id></element-citation></ref><ref id="bib22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>X</given-names></name><name><surname>Mooney</surname><given-names>P</given-names></name><name><surname>Zheng</surname><given-names>S</given-names></name><name><surname>Booth</surname><given-names>CR</given-names></name><name><surname>Braunfeld</surname><given-names>MB</given-names></name><name><surname>Gubbens</surname><given-names>S</given-names></name><name><surname>Agard</surname><given-names>DA</given-names></name><name><surname>Cheng</surname><given-names>Y</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Electron counting and beam-induced motion correction enable near-atomic-resolution single-particle cryo-EM</article-title><source>Nature Methods</source><volume>10</volume><fpage>584</fpage><lpage>590</lpage><pub-id pub-id-type="doi">10.1038/nmeth.2472</pub-id><pub-id pub-id-type="pmid">23644547</pub-id></element-citation></ref><ref id="bib23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liao</surname><given-names>M</given-names></name><name><surname>Cao</surname><given-names>E</given-names></name><name><surname>Julius</surname><given-names>D</given-names></name><name><surname>Cheng</surname><given-names>Y</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Structure of the TRPV1 ion channel determined by electron cryo-microscopy</article-title><source>Nature</source><volume>504</volume><fpage>107</fpage><lpage>112</lpage><pub-id pub-id-type="doi">10.1038/nature12822</pub-id><pub-id pub-id-type="pmid">24305160</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Scheres</surname><given-names>SH</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>A Bayesian view on cryo-EM structure determination</article-title><source>Journal of Molecular Biology</source><volume>415</volume><fpage>406</fpage><lpage>418</lpage><pub-id pub-id-type="doi">10.1016/j.jmb.2011.11.010</pub-id><pub-id pub-id-type="pmid">22100448</pub-id></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Theobald</surname><given-names>DL</given-names></name><name><surname>Wuttke</surname><given-names>DS</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Accurate structural correlations from maximum likelihood superpositions</article-title><source>PLoS Computational Biology</source><volume>4</volume><elocation-id>e43</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.0040043</pub-id><pub-id pub-id-type="pmid">18282091</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ting</surname><given-names>D</given-names></name><name><surname>Wang</surname><given-names>G</given-names></name><name><surname>Shapovalov</surname><given-names>M</given-names></name><name><surname>Mitra</surname><given-names>R</given-names></name><name><surname>Jordan</surname><given-names>MI</given-names></name><name><surname>Dunbrack</surname><given-names>RL</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Neighbor-dependent Ramachandran probability distributions of amino acids developed from a hierarchical Dirichlet process model</article-title><source>PLoS Computational Biology</source><volume>6</volume><elocation-id>e1000763</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1000763</pub-id><pub-id pub-id-type="pmid">20442867</pub-id></element-citation></ref><ref id="bib27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname><given-names>RY</given-names></name><name><surname>Kudryashev</surname><given-names>M</given-names></name><name><surname>Li</surname><given-names>X</given-names></name><name><surname>Egelman</surname><given-names>EH</given-names></name><name><surname>Basler</surname><given-names>M</given-names></name><name><surname>Cheng</surname><given-names>Y</given-names></name><name><surname>Baker</surname><given-names>D</given-names></name><name><surname>DiMaio</surname><given-names>F</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>De novo protein structure determination from near-atomic-resolution cryo-EM maps</article-title><source>Nature Methods</source><volume>12</volume><fpage>335</fpage><lpage>338</lpage><pub-id pub-id-type="doi">10.1038/nmeth.3287</pub-id><pub-id pub-id-type="pmid">25707029</pub-id></element-citation></ref></ref-list></back><sub-article article-type="article-commentary" id="SA1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.17219.028</article-id><title-group><article-title>Decision letter</article-title></title-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Brunger</surname><given-names>Axel T</given-names></name><role>Reviewing editor</role><aff id="aff9"><institution>Howard Hughes Medical Institute, Stanford University</institution>, <country>United States</country></aff></contrib></contrib-group></front-stub><body><boxed-text><p>In the interests of transparency, eLife includes the editorial decision letter and accompanying author responses. A lightly edited version of the letter sent to the authors after peer review is shown, indicating the most substantive concerns; minor comments are not usually included.</p></boxed-text><p>Thank you for submitting your article &quot;Automated structure refinement of macromolecular assemblies from cryo-EM maps using Rosetta&quot; for consideration by <italic>eLife</italic>. Your article has been favorably evaluated by John Kuriyan (Senior Editor) and three reviewers, one of whom is a member of our Board of Reviewing Editors and another is Sjors HW Scheres (Reviewer #2).</p><p>The reviewers have discussed the reviews with one another and the Reviewing Editor has drafted this decision to help you prepare a revised submission.</p><p>Summary:</p><p>This manuscript concerns atomic model refinement against maps obtained from single particle electron microscopy data at near atomic resolution (for EM structures determined in the ~ 4.5 to 3 Å range). This is an important topic in modern structural biology, as the recent surge in resolution of cryo-EM structures calls for improvements in the methods to position and refine atoms in these maps.</p><p>Here the authors use the Rosetta package which takes into account prior knowledge about protein structure. Although Rosetta has been previously applied to EM map refinement, the authors describe a number of improvements of the method. The authors implemented (1) procedures to detect regions where the fit of manually built models produced strain in the local geometry as a consequence of misfitting the map or as a consequence of inaccuracy of the magnification parameter. Other improvements include (2) voxel size refinement, which may resolve the magnification inaccuracy of cryoEM maps; (3) side chain down-weighting during refinement, which may be proper for cryoEM maps since the molecules are not packed and therefore side chains less well defined compared to backbone; (4) refinement against the full map at the final stage.</p><p>Although none of these approaches are individually entirely new, it is the combination of these methods that may become a useful tool for the structural biologist working with EM maps. However, the reviewers have identified a number of issues that need to be addressed before a final decision can be made.</p><p>Essential revisions:</p><p>1) The improved refinement methods should be compared to standard refinement approaches, since otherwise it is difficult to judge the improvement of the presented over existing methods. They should for example compare with standard phenix.refine real-space simulated-annealing refinement. The amount of computational time for both approaches should also be provided. Finally, the comparison should systematically assess the quality of the model fit throughout the model, not just by subjectively showing particular regions.</p><p>2) There is clearly a need to find a better estimate of the voxel size. It is tempting to optimize the voxel in the way described here and it has been done in the same way before as published by other groups (these references to previous work should be provided). However, if the model has errors (which it always has), the best modelmap correlation is not always obtained for the correct voxel size. One of the reviewers performed a simple test using a PDB structure (PDB ID 4AKE) and simulated a density with voxel size 1.0 Å. Errors were introduced to the model by adding Gaussian noise to the atomic coordinates, here with a σ of 3 Å. 50 of such randomized models were generated. The modelmap correlation was then plotted for different voxel sizes, showing mean and standard deviation for these 50 models. It turns out that the error of the voxel size optimization is of the same order of magnitude as the typical error of the estimate from the microscope (~1%). Thus, the proposed voxel size estimation method may not produce the true voxel size. This issue needs to be addressed in the manuscript.</p><p>3) <xref ref-type="fig" rid="fig4">Figure 4A</xref> is supposed to show the mismatch of the deposited model and density. One of the reviewers downloaded the deposited model (PDB 4CI0) and EM map (EMD-2513) and could not reproduce this figure. The deposited model actually fits well into the deposited map. Images are attached to this decision letter of a similar view with the same contour level given in the figure caption (0.065). The authors need to clarify this issue.</p><p>4) The authors may wish to further elaborate on two limitations that are briefly mentioned in the final paragraph of the Discussion:</p><p>A) How to handle maps that have dramatic differences in local resolution. For example, in the TrpV1 channel case, the authors had to refine part of the model in two steps against two parts of the map (which is only mentioned in the Methods).</p><p>B) How to determine the sharpening B-factor objectively before real-space refinement. The authors appear to have determined the sharpening B-factor subjectively (as mentioned in the first paragraph of the Methods section). But what criterion was used? This issue may become more difficult when the map has heterogeneous local resolutions.</p><p>5) How does the method handle missing residues in loops or disordered region that are very difficult to place manually? This would be a very useful tool.</p><p>6) <xref ref-type="fig" rid="fig3">Figure 3B</xref>, right panel. How are these different models of the ensemble selected? By using some map correlation criterion to get the &quot;best&quot; fitted models?</p><p>7) The original and optimized voxel sizes for the F420 example is given in the manuscript as 1.320 and 1.326 Å. The changes in voxel sizes should also be given for the other examples.</p><p>[Editors' note: further revisions were requested prior to acceptance, as described below.]</p><p>Thank you for resubmitting your work entitled &quot;Automated structure refinement of macromolecular assemblies from cryo-EM maps using Rosetta&quot; for further consideration at <italic>eLife</italic>. Your article has been favorably evaluated by John Kiriyan (Senior Editor) and three reviewers, one of whom is a member of our Board of Reviewing Editors.</p><p>The manuscript has been improved but there is a remaining issue that needs to be addressed before acceptance, as outlined in the following.</p><p>The reviewers found the explanation on the issue previously raised about <xref ref-type="fig" rid="fig5">Figure 5</xref> not satisfactory. The shift shown in <xref ref-type="fig" rid="fig5">Figure 5</xref> is not a result of voxel size error, but is likely due to the fact that the authors of the F420 structure (PDBID 4ci0) did not carefully generate the biological assembly structure. Maybe there was a slight mismatch in the symmetry operators used to generate the entire assembly. If one fits each subunit rigidly into the density (e.g. in Chimera) then all subunits fit very well (also with the original voxel size of 1.320). <xref ref-type="fig" rid="fig5">Figure 5A</xref> and the &quot;deposited&quot; items in panels B and C should therefore be removed. The effect of changing the voxel size from 1.320 to 1.326 Ang is much smaller than the current figure suggests.</p></body></sub-article><sub-article article-type="reply" id="SA2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.17219.029</article-id><title-group><article-title>Author response</article-title></title-group></front-stub><body><p><italic>Essential revisions:</italic> </p><p><italic>1) The improved refinement methods should be compared to standard refinement approaches, since otherwise it is difficult to judge the improvement of the presented over existing methods. They should for example compare with standard phenix.refine real-space simulated-annealing refinement. The amount of computational time for both approaches should also be provided. Finally, the comparison should systematically assess the quality of the model fit throughout the model, not just by subjectively showing particular regions.</italic> </p><p>This is a very good point. We have included a comparison (in terms of model geometry, agreement-to-data, and runtime) to phenix real_space_refine. We also added a paragraph to compare the results between Rosetta and the Phenix refinement. To systematically assess model quality, we look at per-residue fit-to-data for all cases and report the number of residues which show significant better density-fit for both methods, as well as aggregate statistics such as RSCC, iFSC, and EMringer score (<xref ref-type="table" rid="tbl1">Table 1</xref>).</p><p><italic>2) There is clearly a need to find a better estimate of the voxel size. It is tempting to optimize the voxel in the way described here and it has been done in the same way before as published by other groups (these references to previous work should be provided). However, if the model has errors (which it always has), the best model-map correlation is not always obtained for the correct voxel size. One of the reviewers performed a simple test using a PDB structure (PDB ID 4AKE) and simulated a density with voxel size 1.0 Å. Errors were introduced to the model by adding Gaussian noise to the atomic coordinates, here with a σ of 3 Å. 50 of such randomized models were generated. The model-map correlation was then plotted for different voxel sizes, showing mean and standard deviation for these 50 models. It turns out that the error of the voxel size optimization is of the same order of magnitude as the typical error of the estimate from the microscope (~1%). Thus, the proposed voxel size estimation method may not produce the true voxel size. This issue needs to be addressed in the manuscript.</italic> </p><p>For the references, unfortunately, we were unable to find out the previous work the reviewers pointed out. If advised, we will add them in future edits. However, we make two comments in regards to voxel size refinement. First, previous studies using EM maps as molecular replacement targets showed that voxel spacing may be off by as much as several percent (Jackson et al., Nature Protocols, 2015). More importantly, we feel our iterative approach – cycling between refinement and voxel spacing optimization – captures some of the agreement between forcefield and voxel spacing. We performed a related experiment, which we feel more accurately captures model errors. Using the same target as above (4ake) we ran short Rosetta MD trajectories followed by minimization; these cycles were repeated until models fell ~3Å RMS from the native structure. The result was 50 models each 2.9-3.1Å from native with relatively good energy.</p><p>Our voxel refinement procedure was then applied to each of these models, first optimizing voxel spacing/origin to maximize agreement with the model, and then running our iterative procedure. Five models were generated for each of the 50 starting models, and the one with highest agreement to the data is indicated. It yields the distributions shown below (true voxel size = 1.0Å).</p><p>Following refinement, the standard deviations on voxel size are reduced from 0.011 to 0.004; the latter numbers are increased by a few outlier structures for which the iterative refinement got stuck. This has been added as <xref ref-type="fig" rid="fig2">Figure 2A</xref> in the manuscript. And we added a paragraph describing the experiment.</p><p><italic>3) <xref ref-type="fig" rid="fig4">Figure 4A</xref> is supposed to show the mismatch of the deposited model and density. One of the reviewers downloaded the deposited model (PDB 4CI0) and EM map (EMD-2513) and could not reproduce this figure. The deposited model actually fits well into the deposited map. The authors need to clarify this issue.</italic> </p><p>This figure was generated by downloading the PDB of the full biological unit and comparing it to the map. Even though the deposited asymmetric unit matches nicely with the map, the full biological unit poorly matches with the map. This is probably a minor issue, where the origin of the biological unit is inconsistent with the origin of the map; however, we were pleased to see that our voxel refinement identified this issue.</p><p>This error was first identified when we were trying to evaluate the biological unit with full symmetric partners present using EMRinger, where it was observed that the EMRinger score varied significantly between subunits.</p><p><italic>4) The authors may wish to further elaborate on two limitations that are briefly mentioned in the final paragraph of the Discussion:</italic></p><p><italic>A) How to handle maps that have dramatic differences in local resolution. For example, in the TrpV1 channel case, the authors had to refine part of the model in two steps against two parts of the map (which is only mentioned in the Methods).</italic> </p><p><italic>B) How to determine the sharpening B-factor objectively before real-space refinement. The authors appear to have determined the sharpening B-factor subjectively (as mentioned in the first paragraph of the Methods section). But what criterion was used? This issue may become more difficult when the map has heterogeneous local resolutions.</italic> </p><p>We agree that this is an important question in model refinement. However, a full solution for these problems is beyond the scope of this manuscript. We have made a few comments in the main text on the splitting of TrpV1 into two segments.</p><p>The refinement seems to be somewhat insensitive to differing levels of B factor sharpening. For example, the results (integrated FSC) for the 20S proteasome over different values of B-factor sharpening are plotted below (and added to the manuscript as <xref ref-type="fig" rid="fig2">Figure 2B</xref>); in a range of sharpening values from –40 to –130, refinement performs equally well, even though subjectively, the maps appear different.</p><p>Consequently, we expect the refinement to be somewhat tolerant of small changes to local resolution; TrpV1 is an extreme case, where the repeat protein – particularly beyond the first two repeats – is of very low local resolution and is not tolerated by refinement. This is readily apparent upon running the full refinement and looking at model convergence.</p><p><italic>5) How does the method handle missing residues in loops or disordered region that are very difficult to place manually? This would be a very useful tool.</italic> </p><p>This manuscript is only concerned with fixing local errors in hand-traced models; we have previously developed tools (RosettaCM) for rebuilding missing regions in density (e.g., Song et al. 2014 Structure.).</p><p><italic>6) <xref ref-type="fig" rid="fig3">Figure 3B</xref>, right panel. How are these different models of the ensemble selected? By using some map correlation criterion to get the &quot;best&quot; fitted models?</italic> </p><p>The models are selected using the criterion specified in the manuscript (best 50 by free FSC, best of these by MolProbity), as well as in <xref ref-type="fig" rid="fig1">Figure 1</xref>, Step 2. This has been clarified in the figure text.</p><p><italic>7) The original and optimized voxel sizes for the F420 example is given in the manuscript as 1.320 and 1.326 Å. The changes in voxel sizes should also be given for the other examples.</italic> </p><p>This has been added in the Methods section. In all other cases, voxel spacing changed by &lt;0.5% so the models that used were those refined without voxel spacing refinement.</p><p>[Editors' note: further revisions were requested prior to acceptance, as described below.]</p><p><italic>The manuscript has been improved but there is a remaining issue that needs to be addressed before acceptance, as outlined in the following.</italic> </p><p><italic>The reviewers found the explanation on the issue previously raised about <xref ref-type="fig" rid="fig5">Figure 5</xref> not satisfactory. The shift shown in <xref ref-type="fig" rid="fig5">Figure 5</xref> is not a result of voxel size error, but is likely due to the fact that the authors of the F420 structure (PDBID 4ci0) did not carefully generate the biological assembly structure. Maybe there was a slight mismatch in the symmetry operators used to generate the entire assembly. If one fits each subunit rigidly into the density (e.g. in Chimera) then all subunits fit very well (also with the original voxel size of 1.320). <xref ref-type="fig" rid="fig5">Figure 5A</xref> and the &quot;deposited&quot; items in panels B and C should therefore be removed. The effect of changing the voxel size from 1.320 to 1.326 Ang is much smaller than the current figure suggests.</italic> </p><p>We have followed this suggestion. Following the advice of the reviewers, we docked individual chains into density and re-refined from this starting point. The newly refined voxel size – while increasing slightly – ends up quite close to that of the deposited density map. Therefore, we chose to refine the structure with the deposited voxel size (1.320). We have removed the <xref ref-type="fig" rid="fig5">Figure 5A</xref> and panels as suggested by the reviewers, and highlight instead the geometry improvement of the model following refinement. The Frh statistics in <xref ref-type="table" rid="tbl1">Table 1</xref> and <xref ref-type="table" rid="tbl2">Table 2</xref> were updated, in response to the new experiments from the new starting point. Finally, a new paragraph was added in the Discussion section, addressing the drop of fit-to-density (iFSC) in all three benchmark cases.</p></body></sub-article></article>