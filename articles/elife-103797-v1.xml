<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD with MathML3 v1.3 20210610//EN"  "JATS-archivearticle1-3-mathml3.dtd"><article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.3"><front><journal-meta><journal-id journal-id-type="nlm-ta">elife</journal-id><journal-id journal-id-type="publisher-id">eLife</journal-id><journal-title-group><journal-title>eLife</journal-title></journal-title-group><issn publication-format="electronic" pub-type="epub">2050-084X</issn><publisher><publisher-name>eLife Sciences Publications, Ltd</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">103797</article-id><article-id pub-id-type="doi">10.7554/eLife.103797</article-id><article-id pub-id-type="doi" specific-use="version">10.7554/eLife.103797.3</article-id><article-version article-version-type="publication-state">version of record</article-version><article-categories><subj-group subj-group-type="display-channel"><subject>Research Article</subject></subj-group><subj-group subj-group-type="heading"><subject>Structural Biology and Molecular Biophysics</subject></subj-group></article-categories><title-group><article-title>Expanding automated multiconformer ligand modeling to macrocycles and fragments</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Flowers</surname><given-names>Jessica</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-3501-8804</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="con1"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author"><name><surname>Echols</surname><given-names>Nathaniel</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0009-0007-1597-9302</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="con2"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author"><name><surname>Correy</surname><given-names>Galen J</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0001-5155-7325</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="con3"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author"><name><surname>Jaishankar</surname><given-names>Priyadarshini</given-names></name><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="con4"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author"><name><surname>Togo</surname><given-names>Takaya</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-0243-0760</contrib-id><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="fn" rid="con5"/><xref ref-type="fn" rid="conf1"/></contrib><contrib contrib-type="author"><name><surname>Renslo</surname><given-names>Adam R</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-1240-2846</contrib-id><xref ref-type="aff" rid="aff2">2</xref><xref ref-type="other" rid="fund2"/><xref ref-type="fn" rid="con6"/><xref ref-type="fn" rid="conf2"/></contrib><contrib contrib-type="author"><name><surname>van den Bedem</surname><given-names>Henry</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0003-2358-841X</contrib-id><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="aff" rid="aff3">3</xref><xref ref-type="fn" rid="con7"/><xref ref-type="fn" rid="conf3"/></contrib><contrib contrib-type="author" corresp="yes"><name><surname>Fraser</surname><given-names>James S</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-5080-2859</contrib-id><email>jfraser@fraserlab.com</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="other" rid="fund1"/><xref ref-type="other" rid="fund2"/><xref ref-type="fn" rid="con8"/><xref ref-type="fn" rid="conf4"/></contrib><contrib contrib-type="author" corresp="yes"><name><surname>Wankowicz</surname><given-names>Stephanie A</given-names></name><contrib-id authenticated="true" contrib-id-type="orcid">https://orcid.org/0000-0002-4225-7459</contrib-id><email>stephanie@wankowiczlab.com</email><xref ref-type="aff" rid="aff1">1</xref><xref ref-type="fn" rid="pa1">†</xref><xref ref-type="other" rid="fund2"/><xref ref-type="fn" rid="con9"/><xref ref-type="fn" rid="conf1"/></contrib><aff id="aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/043mz5j54</institution-id><institution>Department of Bioengineering and Therapeutic Sciences, University of California, San Francisco</institution></institution-wrap><addr-line><named-content content-type="city">San Francisco</named-content></addr-line><country>United States</country></aff><aff id="aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/043mz5j54</institution-id><institution>Department of Pharmaceutical Chemistry, University of California, San Francisco</institution></institution-wrap><addr-line><named-content content-type="city">San Francisco</named-content></addr-line><country>United States</country></aff><aff id="aff3"><label>3</label><institution>Atomwise Inc</institution><addr-line><named-content content-type="city">San Francisco</named-content></addr-line><country>United States</country></aff></contrib-group><contrib-group content-type="section"><contrib contrib-type="editor"><name><surname>Graña</surname><given-names>Martin</given-names></name><role>Reviewing Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/04dpm2z73</institution-id><institution>Institut Pasteur de Montevideo</institution></institution-wrap><country>Uruguay</country></aff></contrib><contrib contrib-type="senior_editor"><name><surname>Cui</surname><given-names>Qiang</given-names></name><role>Senior Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/05qwgg493</institution-id><institution>Boston University</institution></institution-wrap><country>United States</country></aff></contrib></contrib-group><author-notes><fn fn-type="present-address" id="pa1"><label>†</label><p>Department of Molecular Physiology and Biophysics, Vanderbilt University, Nashville, United States</p></fn></author-notes><pub-date publication-format="electronic" date-type="publication"><day>30</day><month>06</month><year>2025</year></pub-date><volume>14</volume><elocation-id>RP103797</elocation-id><history><date date-type="sent-for-review" iso-8601-date="2024-10-07"><day>07</day><month>10</month><year>2024</year></date></history><pub-history><event><event-desc>This manuscript was published as a preprint.</event-desc><date date-type="preprint" iso-8601-date="2024-09-23"><day>23</day><month>09</month><year>2024</year></date><self-uri content-type="preprint" xlink:href="https://doi.org/10.1101/2024.09.20.613996"/></event><event><event-desc>This manuscript was published as a reviewed preprint.</event-desc><date date-type="reviewed-preprint" iso-8601-date="2025-01-31"><day>31</day><month>01</month><year>2025</year></date><self-uri content-type="reviewed-preprint" xlink:href="https://doi.org/10.7554/eLife.103797.1"/></event><event><event-desc>The reviewed preprint was revised.</event-desc><date date-type="reviewed-preprint" iso-8601-date="2025-06-05"><day>05</day><month>06</month><year>2025</year></date><self-uri content-type="reviewed-preprint" xlink:href="https://doi.org/10.7554/eLife.103797.2"/></event></pub-history><permissions><copyright-statement>© 2025, Flowers et al</copyright-statement><copyright-year>2025</copyright-year><copyright-holder>Flowers et al</copyright-holder><ali:free_to_read/><license xlink:href="http://creativecommons.org/licenses/by/4.0/"><ali:license_ref>http://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p></license></permissions><self-uri content-type="pdf" xlink:href="elife-103797-v1.pdf"/><self-uri content-type="figures-pdf" xlink:href="elife-103797-figures-v1.pdf"/><related-article related-article-type="article-reference" ext-link-type="doi" xlink:href="10.7554/eLife.90606" id="ra1"/><abstract><p>Small molecule ligands exhibit a diverse range of conformations in solution. Upon binding to a target protein, this conformational diversity is reduced. However, ligands can retain some degree of conformational flexibility even when bound to a receptor. In the Protein Data Bank, a small number of ligands have been modeled with distinct alternative conformations that are supported by macromolecular X-ray crystallography density maps. However, the vast majority of structural models are fit to a single-ligand conformation, potentially ignoring the underlying conformational heterogeneity present in the sample. We previously developed qFit-ligand to sample diverse ligand conformations and to select a parsimonious ensemble consistent with the density. While this approach indicated that many ligands populate alternative conformations, limitations in our sampling procedures often resulted in non-physical conformations and could not model complex ligands like macrocycles. Here, we introduce several improvements to qFit-ligand, including integrating RDKit for stochastic conformational sampling. This new sampling method greatly enriches low-energy conformations of small molecules and macrocycles. We further extended qFit-ligand to identify alternative conformations in PanDDA-modified density maps from high-throughput X-ray fragment screening experiments, as well as single-particle cryo-electron microscopy density maps. The new version of qFit-ligand improves fit to electron density and reduces torsional strain relative to deposited single-conformer models and our prior version of qFit-ligand. These advances enhance the analysis of residual conformational heterogeneity present in ligand-bound structures, which can provide important insights for the rational design of therapeutic agents.</p></abstract><kwd-group kwd-group-type="author-keywords"><kwd>small molecules</kwd><kwd>X-ray crystallography</kwd><kwd>cryo-EM</kwd><kwd>conformational heterogeneity</kwd><kwd>compositional heterogeneity</kwd></kwd-group><kwd-group kwd-group-type="research-organism"><title>Research organism</title><kwd>None</kwd></kwd-group><funding-group><award-group id="fund1"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000057</institution-id><institution>National Institute of General Medical Sciences</institution></institution-wrap></funding-source><award-id>NIHGM145238</award-id><principal-award-recipient><name><surname>Fraser</surname><given-names>James S</given-names></name></principal-award-recipient></award-group><award-group id="fund2"><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/100000060</institution-id><institution>National Institute of Allergy and Infectious Diseases</institution></institution-wrap></funding-source><award-id>U19AI171110</award-id><principal-award-recipient><name><surname>Renslo</surname><given-names>Adam R</given-names></name><name><surname>Fraser</surname><given-names>James S</given-names></name><name><surname>Wankowicz</surname><given-names>Stephanie A</given-names></name></principal-award-recipient></award-group><funding-statement>The funders had no role in study design, data collection, and interpretation, or the decision to submit the work for publication.</funding-statement></funding-group><custom-meta-group><custom-meta specific-use="meta-only"><meta-name>Author impact statement</meta-name><meta-value>qFit-ligand is a computational algorithm that enables accurate modeling of multiple conformational states of ligands in X-ray crystallography and cryo-electron microscopy (cryo-EM).</meta-value></custom-meta><custom-meta specific-use="meta-only"><meta-name>publishing-route</meta-name><meta-value>prc</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1" sec-type="intro"><title>Introduction</title><p>Protein–ligand interactions are fundamental to many biological processes, involving both natural metabolites that regulate proteins and drugs developed to activate or inhibit proteins for therapeutic purposes. Prior to binding, both the ligand and protein receptor can sample a wide number of conformations. Upon binding, it is typically assumed that both ligand and protein will lose access to nearly all of their conformational states (<xref ref-type="bibr" rid="bib11">Chang et al., 2007</xref>). This assumption leads to the common practice in X-ray crystallography and single-particle cryo-electron microscopy (cryo-EM) of modeling the ligand as adopting a single, fixed conformation within the binding site, with little to no consideration of potential heterogeneity other than refined B-factors.</p><p>Both macromolecular X-ray crystallography and cryo-EM generate averaged datasets by compiling scattering information from &gt;10,000s of system copies, including macromolecules, solvents, ions, and small molecules. The resulting data from which structural models are built encompass significant conformational and compositional heterogeneity (<xref ref-type="bibr" rid="bib71">Wankowicz and Fraser, 2024a</xref>). Conformational heterogeneity, when the same substance is in multiple conformations, includes subtle, sub-Ångstrom changes that are difficult to model by eye, yet these shifts are crucial for accurate biological interpretation (<xref ref-type="bibr" rid="bib70">Wankowicz et al., 2022</xref>). Compositional heterogeneity refers to variation in the molecular contents of a sample, such as a ligand or macromolecular subunit only bound in a portion of the complexes captured. Ligand modeling, even as a single conformer, is challenging due to compositional heterogeneity, interference from water molecules, and system-wide conformational heterogeneity, all of which lead to ambiguity in electron density map interpretation (<xref ref-type="bibr" rid="bib42">Nicholls, 2017</xref>). This challenge in manual modeling is a major reason why structural variability is often underrepresented in deposited models. However, in the Protein Data Bank (PDB), a small number of ligands are modeled as multiple conformers, representing their conformational heterogeneity (<xref ref-type="bibr" rid="bib66">van Zundert et al., 2018</xref>; <xref ref-type="bibr" rid="bib34">Liebeschuetz, 2021</xref>). These structures likely represent just a small fraction of ligands with experimental evidence that could support modeling multiple conformations, as has been shown in proteins (<xref ref-type="bibr" rid="bib70">Wankowicz et al., 2022</xref>; <xref ref-type="bibr" rid="bib58">Smith et al., 1986</xref>; <xref ref-type="bibr" rid="bib73">Wankowicz et al., 2024c</xref>). When handled correctly, modeling ligands in multiple conformations can reveal critical information about biological function (<xref ref-type="bibr" rid="bib17">Díaz et al., 2024</xref>) and guide small molecule design (<xref ref-type="bibr" rid="bib75">Zhao et al., 2023</xref>; <xref ref-type="bibr" rid="bib39">Mehlman et al., 2024</xref>).</p><p>To help assist in modeling conformational heterogeneity, we have developed qFit, which can automatically build multiconformer models (<xref ref-type="bibr" rid="bib73">Wankowicz et al., 2024c</xref>; <xref ref-type="bibr" rid="bib65">van den Bedem et al., 2009</xref>; <xref ref-type="bibr" rid="bib33">Keedy et al., 2015</xref>; <xref ref-type="bibr" rid="bib48">Riley et al., 2021</xref>). The underlying concept of qFit is to enumerate a large number of conformations according to a sampling procedure and then to use mixed integer quadratic programming (MIQP) to optimize the selection of a parsimonious set of conformers, along with their corresponding occupancies (<xref ref-type="bibr" rid="bib65">van den Bedem et al., 2009</xref>). This approach improves the fit to experimental data and agreement with geometric priors for proteins (<xref ref-type="bibr" rid="bib73">Wankowicz et al., 2024c</xref>). We previously extended qFit to qFit-ligand to identify and model alternative conformations of ligands to experimental data (<xref ref-type="bibr" rid="bib66">van Zundert et al., 2018</xref>).</p><p>The prior version of qFit-ligand used iterative sampling over each torsional degree of freedom (<xref ref-type="bibr" rid="bib66">van Zundert et al., 2018</xref>). This approach overlooked correlated motions and over-explored conformations that were energetically unfavorable. Here, we present a redeveloped sampling algorithm powered by the RDKit implementation of the Experimental-Torsion Knowledge Distance Geometry (ETKDG) conformer generator, which is a stochastic search method that combines distance geometry and knowledge derived from experimental structures (<xref ref-type="bibr" rid="bib69">Wang et al., 2020</xref>; <xref ref-type="bibr" rid="bib50">Riniker and Landrum, 2015</xref>). We demonstrate that our improved qFit-ligand can automatically model multiple conformations of ligands where supported by electron density. The majority of qFit models improved real space correlation coefficients (RSCC), electron density support for individual atoms (EDIA), and ligand strain. We also extend qFit-ligand to accommodate emerging strategies in structure-based drug design, including macrocycles, fragment screening, and cryo-EM. While the cyclic nature of macrocycles makes modeling the flexibility by our prior approach incredibly troublesome, with improved sampling, we can now model this expanding class of small molecules (<xref ref-type="bibr" rid="bib32">Kamenik et al., 2018</xref>). Second, X-ray-based fragment screening has exploded in popularity since our first release; however, these approaches rely on density map manipulations accounting for compositional heterogeneity (<xref ref-type="bibr" rid="bib44">Pearce et al., 2017</xref>). With improved map handling, we can now model into these ‘event’ maps, identifying multiple conformations even for low molecular weight compounds. Lastly, recent advances in cryo-EM have enabled increasingly high-resolution reconstructions, which in turn allow for atom-level modeling of conformational heterogeneity (<xref ref-type="bibr" rid="bib15">Cushing et al., 2024</xref>). In response, we introduce cryo-EM map compatibility, making qFit-ligand a method for automated multiconformer ligand model building using cryo-EM data. Together, these advancements and the enhanced code base will enable more accurate identification and modeling of ligand conformational heterogeneity across a variety of ligands, leading to a better interpretation of protein–ligand interactions.</p></sec><sec id="s2" sec-type="results"><title>Results</title><sec id="s2-1"><title>Overview of the qFit-ligand algorithm</title><p>The qFit-ligand algorithm takes as input a crystal or cryo-EM structure of an initial protein–ligand complex with a single-conformer ligand in PDBx/mmCIF format, a density map or structure factors (encoded by a ccp4 formatted map or an MTZ), and a SMILES string for the ligand. The SMILES string is used for bond order assignment internally (Methods). The algorithm produces a multiconformer model of the ligand, embedded into the context of the rest of the unaltered structural model. This version of qFit-ligand leverages advances to the code base that have improved the stability of the code for protein modeling applications (<xref ref-type="bibr" rid="bib73">Wankowicz et al., 2024c</xref>) and uses the Chem.rdDistGeom module of RDKit, which implements ETKDG, for conformational sampling (<xref ref-type="bibr" rid="bib69">Wang et al., 2020</xref>; <xref ref-type="bibr" rid="bib50">Riniker and Landrum, 2015</xref>) (see Conformer Generation).</p><p>To ensure compatibility with the surrounding protein, the ensemble is generated under constraints defined by the geometry of the binding site (see Biasing conformer generation), generating 5000–7000 ligand conformations depending on the size of the ligand. We then use quadratic programming (QP) and MIQP optimization algorithms to determine the best fit of the coordinate and occupancy of conformers to the experimental map. For X-ray data, we restrict the algorithm to output a maximum of three conformations, whereas cryo-EM is restricted to outputting a maximum of two conformations. Examples can be found in the qFit Github repository (<ext-link ext-link-type="uri" xlink:href="https://github.com/ExcitedStates/qfit-3.0">https://github.com/ExcitedStates/qfit-3.0</ext-link> copy archived at <xref ref-type="bibr" rid="bib49">Riley et al., 2025</xref>) under version 2025.1 and is packaged as part of SBGrid (<xref ref-type="bibr" rid="bib41">Morin et al., 2013</xref>).</p></sec><sec id="s2-2"><title>Conformer generation</title><p>For an input molecule (<xref ref-type="fig" rid="fig1">Figure 1</xref>), the RDKit Chem.rdDistGeom.EmbedMultipleConfs function generates a distance bounds matrix containing the minimum and maximum allowable distances between every pair of atoms for an input molecule (<xref ref-type="fig" rid="fig1s1">Figure 1—figure supplement 1</xref>; <xref ref-type="bibr" rid="bib8">Blaney and Scott Dixon, 2007</xref>). The algorithm then explores the conformational space by stochastically generating distances within the defined distance bounds, generating diverse and chemically plausible conformers across torsional angles (<xref ref-type="fig" rid="fig1">Figure 1A–E</xref>). For example, within a torsion angle formed by four atoms, the minimum distance between atoms 1 and 4 corresponds to the syn conformation, and the maximum distance corresponds to the anti conformation. Conformations are generated with torsional angles between the maximum and minimum, while obeying other constraints, ensuring exploration of the molecule’s conformational space within realistic and chemically meaningful limits.</p><fig-group><fig id="fig1" position="float"><label>Figure 1.</label><caption><title>qFit-ligand algorithm workflow.</title><p>All ligands undergo three preliminary searches: unconstrained, fixed terminal atoms, and blob search, allowing varying degrees of freedom (<bold>A–C</bold>). If the ligand has short or long side chains, the algorithm progresses to more specialized searches: branch search for ligands with side chains of at least four atoms (<bold>D</bold>), and long chain search for those exceeding 30 atoms (<bold>E</bold>). The algorithm then determines the best fit of generated conformers to electron density through quadratic programming, followed by additional sampling with rotations and translations (<bold>F</bold>). The remaining conformers then undergo quadratic and mixed-integer quadratic programming to ensure that only the most well-supported conformers are included in the final model.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-103797-fig1-v1.tif"/></fig><fig id="fig1s1" position="float" specific-use="child-fig"><label>Figure 1—figure supplement 1.</label><caption><title>RDKit determines a distance bounds matrix for a molecule by establishing upper and lower bounds for interatomic distances.</title><p>These bounds are informed by experimental data and chemical knowledge of bond length, angle, and dihedral angle preferences obtained from the Cambridge Structural Database. Within a torsion angle formed by four atoms, the minimum distance between atoms 1 and 4 corresponds to the syn conformation, and the maximum distance corresponds to the anti conformation. These specific distances, d for syn and d’ for anti, are recorded in the bounds matrix as the lower and upper bounds, respectively. This is performed for every distance between each atom in the molecule. Randomly sampling these bounds with RDKit’s implementation of Experimental-Torsion Knowledge Distance Geometry (ETKDG) gives rise to different conformations of the torsion angle.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-103797-fig1-figsupp1-v1.tif"/></fig><fig id="fig1s2" position="float" specific-use="child-fig"><label>Figure 1—figure supplement 2.</label><caption><title>Correlation between the number of atoms in the input ligand and total qFit-ligand runtime.</title><p>A strong Pearson correlation of 0.75 indicates that as you increase the size of your input molecule, qFit-ligand will take longer to run.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-103797-fig1-figsupp2-v1.tif"/></fig></fig-group><p>The sampled distances are converted into three-dimensional coordinates through an embedding procedure. Next, torsional angles are refined using potentials derived from experimental distributions observed in the Cambridge Structural Database (CSD) (<xref ref-type="bibr" rid="bib4">Allen, 2002</xref>; <xref ref-type="bibr" rid="bib24">Groom and Allen, 2014</xref>) (Methods). Following torsional minimization, we apply the optionally available force field minimization step, using the MMFF94 force field (<xref ref-type="bibr" rid="bib64">Tosco et al., 2014</xref>) to eliminate steric clashes and reduce molecular strain (<xref ref-type="bibr" rid="bib69">Wang et al., 2020</xref>; <xref ref-type="bibr" rid="bib50">Riniker and Landrum, 2015</xref>). All these steps help to ensure that only conformers with low torsional strain are allowed to be selected for final fitting.</p></sec><sec id="s2-3"><title>Biasing conformer generation</title><p>To guide the conformation generation from the Chem.rdDistGeom based on the ligand type and protein pocket, we developed a suite of specialized sampling functions to bias the conformational search toward structures more likely to fit well into the receptor’s binding site. For a given molecule, up to six of these modified sampling functions are used to refine the conformational search. All steps are initialized with the input ligand model and are run in parallel.</p><p>First, in all cases, we perform an <italic>unconstrained search function</italic> (<xref ref-type="fig" rid="fig1">Figure 1A</xref>)<italic>,</italic> a <italic>fixed terminal atoms search function</italic> (<xref ref-type="fig" rid="fig1">Figure 1B</xref>), and a <italic>blob search function</italic> (<xref ref-type="fig" rid="fig1">Figure 1C</xref>). The <italic>unconstrained search function</italic> generates conformers only constrained from the default RDKit parameters as described above. The <italic>fixed terminal atoms search function</italic> places hard constraints on the distance between the terminal atoms, allowing the atoms in between to randomly sample distances within their respective upper and lower bounds. This preserves the overall shape of the ligand while still allowing for internal movement. Finally, the <italic>blob search function</italic> confines generated conformers within a spherical volume, determined by the maximum Euclidean distance from the geometric center of the input ligand to its outermost atoms.</p><p>For ligands with side chains of at least four atoms, we also implement a <italic>branching search function</italic> (<xref ref-type="fig" rid="fig1">Figure 1D</xref>). Here, atoms not included in the side chain (core atoms), are fixed to the coordinates of the input ligand model. This method allows the sampling of side chain conformations while maintaining the relative positioning of the core atoms. When these chains exceed 30 atoms, we apply a <italic>long chain search function</italic> (<xref ref-type="fig" rid="fig1">Figure 1E</xref>). This approach does the opposite of the <italic>branching search function</italic> by fixing the atoms in the long side chains in place while allowing the core atoms to explore various conformations. This ensures the generation of relevant conformations of the core atoms without excessive variability in the side chains, which is crucial for ligands with a high degree of freedom.</p><p>Additionally, an optional flag turns on the <italic>180° flip sampling function</italic>. This function takes the input modeled ligand conformer and rotates it 180° around the three principal axes (<italic>x</italic>, <italic>y</italic>, and <italic>z</italic>), effectively generating three new conformations that are flipped relative to the original structure. After each 180° flip, the function applies rotations to each of these three conformers within a range of ±10° in 2° increments. This option is turned off by default and is only recommended for supervised cases where a user suspects the ligand in their crystal may adopt this specific type of conformational disorder.</p><p>By default, each run of qFit-ligand generates 5000 conformers if the input ligand has fewer than 25 heavy atoms and 7000 otherwise, evenly distributed across the specialized search strategies. Users can optionally customize this number using the command line flag ‘-nc’. After all conformers are generated, we identify pairs of redundant conformers, defined as those with a root mean square deviation (RMSD) less than 0.2 Å, randomly choosing one to remove.</p><p>To select the set of conformers that best explains the observed density, qFit-ligand employs a QP optimization algorithm. For each sampled conformer, we generate a calculated density map based on the ligand’s atomic coordinates, element types, B-factors, and the map resolution. Each conformer is assigned a weight (occupancy) that collectively optimizes the real space residual of the observed density versus the weighted sum of all the calculated densities. The algorithm has two constraints, first that all weights are non-negative and that the sum of all weights lies between 0–1. QP usually outputs 1–80 conformations (Methods). We then further sample these remaining conformers by applying rotational and translational perturbations (<xref ref-type="fig" rid="fig1">Figure 1F</xref>). New conformations are created by rotating by 15° in 5° increments and translating by 0.3 (Å) along the <italic>x</italic>, <italic>y</italic>, and <italic>z</italic> axes. Conformers are then selected through an additional round of QP. The final conformations are then selected using MIQP, where the optimization problem is the same (optimizing real space residuals of observed versus weighted sum of all calculated densities), but with additional linear constraints to limit the final multiconformer model to a maximum of three (or two for cryo-EM) conformers. The output is then one to three ligand conformations with relative occupancies that collectively best explain the observed density (Methods).</p></sec><sec id="s2-4"><title>Refinement of qFit-ligand models</title><p>qFit-ligand builds a parsimonious multiconformer ligand model and outputs both an independent ligand structure and the protein–ligand complex embedded in the rest of the system (containing solvent, other heteroatoms, etc). After running qFit-ligand, we refine this complex using phenix.refine (<xref ref-type="bibr" rid="bib1">Afonine et al., 2012</xref>) or phenix.real_space_refine for cryo-EM structures (<xref ref-type="bibr" rid="bib2">Afonine et al., 2018</xref>). The resulting final, refined model is used for all subsequent comparisons throughout the rest of the paper.</p></sec><sec id="s2-5"><title>qFit-ligand runtime</title><p>qFit-ligand operates on up to five CPU cores, demonstrating efficient performance on a standard laptop, if all five cores are engaged, with typical runtimes for most ligands (70.6%) being less than 10 min (mean: 8.6 min, median: 6.1 min, range: 1.9–44.9 min). qFit-ligand is not parallelized by default, but an optional command line flag ‘-p’ is available to set the number of cores used during conformer generation. Analysis across a large dataset of structures reveals a strong correlation between the size of the input ligand and the runtime (Pearson correlation coefficient of 0.75), with larger ligands resulting in longer processing times (<xref ref-type="fig" rid="fig1s2">Figure 1—figure supplement 2</xref>).</p></sec><sec id="s2-6"><title>Detection of experimental true positive multiconformer ligands</title><p>To develop the new qFit-ligand algorithm, we collected a set of true positive multiconformer ligand models from the PDB. We identified 2,199 PDB files containing ligands with multiple conformations, more than 10 heavy atoms, and resolutions better than 2.0 Å. We removed structures that had alternative conformers in common crystallographic additives (<italic>n</italic> = 453), as well as structures with the same protein and ligand pair (<italic>n</italic> = 212). This further pruned our collection to 1,534 structures, with resolutions ranging from 0.73 to 1.99 Å. We randomly sampled 150 structures and after a manual inspection, removed 15 where the deposited conformations did not visually resolve well into the density, leaving us with 135 structures as a development set for improving qFit-ligand (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>, <xref ref-type="supplementary-material" rid="supp1">Supplementary file 1, table 1</xref>).</p><p>To simulate a realistic scenario where the multiple conformations of a ligand are initially unknown, we retained only the ‘A’ conformations (all structures had 2 conformations), setting its occupancy to 1.00. Occupancy of the ‘A’ conformer was higher than the ‘B’ conformer in 82.2% of structures (<italic>n</italic> = 111/135). These single-conformer ligand structures were refined using phenix.refine (<xref ref-type="bibr" rid="bib1">Afonine et al., 2012</xref>) (Methods). We refer to these altered structures as our ‘modified true positives’, which we use as input to qFit-ligand, and subsequent refinement using Phenix (Methods) (<xref ref-type="bibr" rid="bib1">Afonine et al., 2012</xref>). For the map input, we calculated a 2mF<sub>o</sub> − DF<sub>C</sub> composite omit map using the modified true positive model and the deposited structure factors. A composite omit map is a crystallographic density map that reduces model bias by omitting small regions of the model, calculating the density for each omitted segment, and then combining the results into a final map (<xref ref-type="bibr" rid="bib61">Terwilliger et al., 2008</xref>).</p><p>To evaluate the impact of qFit-ligand algorithmic improvements, we compared the modified true positive dataset to the output of qFit-ligand (qFit-ligand dataset), evaluating three primary metrics: RSCC, EDIAm, and ligand torsion strain (Methods). RSCC evaluates how well the model fits into the electron density, with values exceeding 0.80 indicating a satisfactory agreement between the model and experimental data (<xref ref-type="bibr" rid="bib57">Smart et al., 2018</xref>; <xref ref-type="bibr" rid="bib54">Shao et al., 2022</xref>). EDIAm assesses the local agreement between atomic positions and the electron density map, providing a more sensitive per-atom measure of model quality, where higher values indicate stronger support from the experimental data (<xref ref-type="bibr" rid="bib40">Meyder et al., 2017</xref>). Torsion strain measures the physical viability of predicted conformations, where lower strain values suggest more stable and naturally occurring conformations. To carry out these strain calculations, we use the software <italic>TLDR: Strain</italic> (<xref ref-type="bibr" rid="bib25">Gu et al., 2021</xref>), which calculates ligand strain by comparing the torsional angle populations of a ligand to those in the CSD, quickly assessing strain energy without detailed quantum or molecular mechanical calculations. This is a different strain calculation than what is used internally in RDKit, ensuring that this is a somewhat independent metric. We note that there is currently no consensus in the field regarding what constitutes a significant improvement in RSCC, EDIAm, or strain, but we believe that any marginal improvements likely reflect a model that more accurately reflects the underlying experimental data.</p><p>qFit-ligand modeled an alternative conformation in 72.5% (<italic>n</italic> = 98) of structures. Compared with the modified true positive models, 83.7% (<italic>n</italic> = 113) of qFit-ligand models have a better RSCC, and 77.0% (<italic>n</italic> = 104) structures saw an improvement in EDIAm, representing an improved fit to experimental data in the vast majority of structures. Further, the majority of structures (61.5%, <italic>n</italic> = 83) exhibited reduced torsional strain with qFit-ligand, with a mean difference of –0.2 kcal/mol (<xref ref-type="fig" rid="fig2">Figure 2A, B</xref>, <xref ref-type="fig" rid="fig2s2">Figure 2—figure supplement 2</xref>). This suggests that over half of the qFit-ligand models were more energetically favorable compared to the modified true positive models, however, the majority of these improvements were of relatively low magnitude. The increased strain of the modified true positives may be due to the removal of correctly modeled alternate conformations observed in the deposited structures, followed by re-refinement of an incomplete single-conformer model using Phenix. Thus, the reduced strain observed in our qFit-ligand models relative to the modified true positives is not unexpected. Overall, 48.9% (<italic>n</italic> = 66) of ligands had both improved RSCC and reduced torsional strain, demonstrating that we frequently improved the fit between experimental data, while also maintaining or improving the strain.</p><fig-group><fig id="fig2" position="float"><label>Figure 2.</label><caption><title>Analysis of ligand conformations generated by qFit-ligand.</title><p>(<bold>A</bold>) Differences in real space correlation coefficients (RSCC) (<italic>x</italic>-axis) and torsion strain (<italic>y</italic>-axis) between qFit-ligand predicted structures and modified true positives. The lower right quadrant shows structures for which we improve both RSCC and strain. (<bold>B</bold>) Gallery of examples for which the new qFit-ligand models have improved RSCC, strain, and EDIAm compared to the modified true positives. The composite omit density map is contoured at 1σ for every structure. (<bold>C</bold>) Differences in EDIAm between qFit-ligand models and modified true positives. Positive delta values indicate structures where the qFit-ligand model is a better fit to the experimental density. (<bold>D</bold>) Differences in RSCC and torsion strain between the new qFit-ligand and the prior qFit-ligand. The lower right quadrant shows structures for which we improve both RSCC and strain.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-103797-fig2-v1.tif"/></fig><fig id="fig2s1" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 1.</label><caption><title>Construction of the development true positive dataset and the unbiased true positive dataset.</title></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-103797-fig2-figsupp1-v1.tif"/></fig><fig id="fig2s2" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 2.</label><caption><title>Original (unmodified) multiconformer true positives compared to qFit-ligand conformers.</title><p>The deposited ‘A’ conformer is shown in gray and the deposited ‘B’ conformer in green. The qFit-ligand conformer closest to the deposited ‘B’ is shown in purple. This demonstrates qFit-ligand’s ability to accurately recapitulate the original deposited multiconformer model. The composite omit density map is contoured at 1σ for every structure.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-103797-fig2-figsupp2-v1.tif"/></fig><fig id="fig2s3" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 3.</label><caption><title>Comparison of torsion strain between qFit-ligand models before and after refinement, as well as the deposited structures.</title><p>The five structures for which the refined qFit-ligand model strain was most significantly increased from the deposited model strain are highlighted.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-103797-fig2-figsupp3-v1.tif"/></fig><fig id="fig2s4" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 4.</label><caption><title>Performance comparison of new and prior qFit-ligand algorithms.</title><p>(<bold>A</bold>) Real space correlation coefficients (RSCC) of new versus prior qFit-ligand predicted conformations across the true positive dataset. Bars to the right of the vertical line are for structures where the new qFit-ligand model has a higher (better) RSCC. (<bold>B</bold>) Torsion strain of new versus prior qFit-ligand predicted conformations across the true positive dataset. Bars to the left of the vertical line are for structures where the new qFit-ligand model has improved (lower) internal strain. (<bold>C</bold>) EDIAm of new versus prior qFit-ligand predicted conformations. Bars to the right of the vertical line are for structures where the new qFit-ligand model has a higher (better) EDIAm. (<bold>D</bold>) Gallery of examples for which the new qFit-ligand models are both higher in RSCC/EDIAm and lower in strain compared to the prior qFit-ligand models. The composite omit density map is contoured at 1σ for every structure.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-103797-fig2-figsupp4-v1.tif"/></fig><fig id="fig2s5" position="float" specific-use="child-fig"><label>Figure 2—figure supplement 5.</label><caption><title>Modified true positive dataset comparison of new versus prior qFit-ligand outlier cases.</title><p>Modified true positive model (input for qFit-ligand), new qFit-ligand model, and prior qFit-ligand model for PDB 2JJK, showing their respective real space correlation coefficients (RSCC), strain, EDIAm, and conformer occupancies. Compared to the prior qFit-ligand model, the new model increased RSCC by 0.2, increased EDIAm by 0.1, and decreased strain by 7.3 kcal/mol. The composite omit density map is contoured at 1σ.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-103797-fig2-figsupp5-v1.tif"/></fig></fig-group><p>To identify places for algorithmic improvement, we examined the five qFit-ligand structures for which there was the greatest degradation in strain compared to the input model. In most cases, the unrefined qFit-ligand model displayed strain levels that were much closer to the modified true positive, but strain increased after refinement with Phenix (<xref ref-type="fig" rid="fig2s3">Figure 2—figure supplement 3</xref>). While refinement improves the correlation between the model and the electron density map, it may inadvertently increase strain without careful calibration of geometry weights and restraint files. This should be carefully examined by the modeler.</p><p>To assess improvements over the prior version of qFit-ligand, we examined how the prior version performed on the modified true positive dataset. Compared to the prior version, we found that the new qFit-ligand achieved higher RSCC values in 57.8% (<italic>n</italic> = 78) of the structures (<xref ref-type="fig" rid="fig2s4">Figure 2—figure supplement 4A</xref>), lower strain in 68.9% (<italic>n</italic> = 93) (<xref ref-type="fig" rid="fig2">Figure 2C</xref>, <xref ref-type="fig" rid="fig2s4">Figure 2—figure supplement 4B</xref>), and higher EDIAm in 85.9% (<italic>n</italic> = 116) (<xref ref-type="fig" rid="fig2s4">Figure 2—figure supplement 4C, D</xref>). We closely examined outlier cases where the new qFit-ligand most dramatically outperformed its predecessor. Among the 10 structures with the largest strain reduction and concurrent increase in RSCC and EDIAm, 6 of the deposited true positive models exhibited branching disorder, where a side chain in the ligand adopts an alternate conformation. In these models, the new qFit-ligand decreased strain by up to 8.1 kcal/mol, increased RSCC by up to 0.4, and increased EDIAm by up to 0.6. These examples highlight an improvement in our modeling of non-localized conformational disorder, where the structural heterogeneity affects large portions or the entirety of the ligand, often involving shifts in all atomic coordinates or branching side chains (<xref ref-type="fig" rid="fig2s5">Figure 2—figure supplement 5</xref>).</p><p>Interestingly, among the structures where the prior algorithm produced a model with a higher RSCC (<italic>n</italic> = 56), 67.9% (<italic>n</italic> = 38/56) were found to be higher in strain compared to the models created by the new qFit-ligand. This suggests that while the prior algorithm sometimes provided a better fit to the density, it often did so by compromising on structural or geometric integrity of the ligand. Moreover, of the structures where the prior qFit-ligand produced a model with a better RSCC (<italic>n</italic> = 56), only 14.3% (<italic>n</italic> = 8/56) had a new model RSCC lower than 0.80, indicating that the new qFit-ligand models were still generally well correlated to the experimental data. This demonstrates that the new qFit-ligand algorithm strikes a better balance between agreement with the density data and low-strain conformations. This directly addresses a major limitation in the prior version of qFit-ligand, which often produced conformers that fit the density but were physically or chemically unrealistic, as evidenced by their higher strain.</p></sec><sec id="s2-7"><title>Determining the operational bounds of qFit-ligand using synthetic data</title><p>To determine the lowest ligand occupancy qFit-ligand can accurately recognize and model across resolution ranges, we constructed a synthetic dataset comprised of four main ligand types. These include a ligand with a localized ring flip (3SC), a long linear ligand with non-localized displacement (3P3), one with localized disorder from a simple torsional shift (9BM), and a macrocycle with both branching and terminal end rotation heterogeneity (AR9) (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1</xref>). For each ligand type, we designed an alternate conformation in COOT (<xref ref-type="bibr" rid="bib19">Emsley et al., 2010</xref>) and created synthetic density data across a range of conformer occupancy ratios (0.50/0.50, 0.40/0.60, 0.30/0.70, 0.20/0.80, and 0.10/0.90) and map resolutions (0.8–2.5 Å, in 0.1 Å increments) (Methods). This resulted in 360 unique pairs of electron density maps and models, representing various combinations of conformer occupancy and resolution, which we refer to as the ‘true’ structures (<xref ref-type="fig" rid="fig3s1">Figure 3—figure supplement 1</xref>). We then inserted only the ‘A’ conformers into qFit-ligand to evaluate its ability to predict and approximate the ‘B’ conformer for each ligand type.</p><p>We directly compare the RSCC of the output qFit-ligand models with the true structures containing both conformers (<xref ref-type="fig" rid="fig3">Figure 3A, B</xref>). We observe a decrease in RSCC as resolution gets worse for all occupancy ratios. As map resolution approaches 2.0 Å, regardless of the occupancy split, there is a notable decline in qFit-ligand model RSCC. This suggests that qFit-ligand performs most effectively and consistently with map resolutions better than 2.0 Å.</p><fig-group><fig id="fig3" position="float"><label>Figure 3.</label><caption><title>Resolution and occupancy limits of qFit-ligand.</title><p>(<bold>A</bold>) Real space correlation coefficients (RSCC) of the synthetic true benchmark structures plotted against map resolution (in Ångstroms) for different conformer occupancy ratios, showing a decrease in RSCC with deteriorating map resolution. (<bold>B</bold>) RSCC of qFit-ligand generated multiconformer models, plotted against map resolution and grouped by conformer occupancy split. (<bold>C</bold>) Root mean square deviation (RMSD) between the closest qFit-ligand conformer and the true ‘B’ conformer. (D, left) True structure and qFit-ligand predicted structure of 3SC multiconformer ligand with a map resolution of 0.8 Å and conformer occupancy split of 0.50/0.50. (D, right) True structure and qFit-ligand predicted structure of 3SC multiconformer ligand with a map resolution of 0.8 Å and conformer occupancy split of 0.80/0.20.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-103797-fig3-v1.tif"/></fig><fig id="fig3s1" position="float" specific-use="child-fig"><label>Figure 3—figure supplement 1.</label><caption><title>The four ligand multiconformer models from which our synthetic dataset was built.</title><p>Here, they are shown at a map resolution of 0.8 Å at 1σ.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-103797-fig3-figsupp1-v1.tif"/></fig></fig-group><p>While RSCC quantifies the overall map to model fit, our ultimate objective is the accurate recovery of alternate conformers. Therefore, we further utilized RMSD calculations to examine qFit-ligand’s ability to recover the ‘B’ conformer present in the true model. We found that doing this successfully was correlated with the alternative conformer occupancy (<xref ref-type="fig" rid="fig3">Figure 3C</xref>). qFit-ligand models originating from a true model with an occupancy ratio of 0.50/0.50 and 0.60/0.40 exhibit comparable accuracy. Models with a 0.70/0.30 split begin to display marginally higher RMSD values, as well as an increase in inconsistency across map resolutions, though still remaining within acceptable limits. However, models at 0.80/0.20 exhibit greater variability across resolutions, with those at 0.90/0.10 showing even more pronounced inconsistencies. We show an example of the true versus qFit-ligand generated models for the 3SC ligand at a map resolution of 0.8 Å, with a true model conformer occupancy split of 0.50/0.50 and 0.20/0.80 (<xref ref-type="fig" rid="fig3">Figure 3D</xref>). These results suggest that the qFit-ligand occupancy detection limit is around 30%.</p></sec><sec id="s2-8"><title>qFit-ligand applied to unbiased dataset of experimental true positives</title><p>To determine how qFit-ligand performed on an independent dataset, we curated a new benchmark from the initial true positive collection of 1534 structures, excluding those used in the development set. Recognizing the impracticality of manually inspecting every structure and the detection limit we identified in the synthetic dataset, we applied additional filtering metrics to ensure data quality. Structures were required to have two deposited conformers with a root mean squared deviation (RMSD) of at least 0.2 Å, an average ligand B-factor of less than 80 Å<sup>2</sup>, and conformer occupancies of at least 0.3. This process yielded a final set of 589 structures for analysis (<xref ref-type="fig" rid="fig2s1">Figure 2—figure supplement 1</xref>).</p><p>For all structures, we generated a modified true positive by deleting alternative conformers, setting occupancy to 1, and re-refining the model. We then followed the same outline as above, including pre-qFit refinement, qFit-ligand, and post-qFit refinement. The qFit-ligand models yielded 46.0% (<italic>n</italic> = 271) with a single conformer, 35.7% (<italic>n</italic> = 210) with two conformers, and 18.3% (<italic>n</italic> = 108) with three conformers (<xref ref-type="fig" rid="fig4">Figure 4A</xref>). Comparing qFit-ligand models to the modified true positives, 79.8% (<italic>n</italic> = 470) showed an enhanced RSCC and 80.6% (<italic>n</italic> = 475) of the complexes had a higher EDIAm value (<xref ref-type="fig" rid="fig4">Figure 4C</xref>), reflecting a superior fit to the density map. qFit-ligand models had a reduced torsional strain in 55.3% (<italic>n</italic> = 326) of structures, though the overall strain difference was minimal in most cases (<xref ref-type="fig" rid="fig4">Figure 4B</xref>).</p><fig id="fig4" position="float"><label>Figure 4.</label><caption><title>Analysis of ligand conformations generated by qFit-ligand on the unbiased modified true positive dataset.</title><p>(<bold>A</bold>) Distribution of the number of conformers output by qFit-ligand. (<bold>B</bold>) Differences in real space correlation coefficients (RSCC) and torsion strain between the qFit-ligand models and the modified true positives. The lower right quadrant shows structures for which we improve both RSCC and strain. (<bold>C</bold>) Differences in EDIAm values between the qFit-ligand models and the modified true positives. Bars to the right of the vertical axis represent structures where the qFit-ligand model fits better to the electron density map.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-103797-fig4-v1.tif"/></fig><p>qFit-ligand shows particular strength in scenarios with strong evidence of unmodeled alternate conformations, often improving the fit to density, while sometimes improving the torsional strain. Interestingly, despite modeling a single conformer in nearly half of the structures, there is little to no evidence of qFit-ligand decreasing model-to-map fit. In fact, some of these single conformers show improved quality relative to the modified true positives (<xref ref-type="fig" rid="fig4">Figure 4B</xref>). These findings reinforce that qFit-ligand is not only capable of detecting alternate conformers when supported by the data, but also serves as a valuable alternative to manual ligand modeling even in single-conformer cases.</p></sec><sec id="s2-9"><title>Evaluating qFit-ligand on a set of structures known to be highly strained</title><p>High ligand strain is energetically unfavorable, and the associated energy penalty paid to adopt a distorted bound conformation reduces overall binding affinity (<xref ref-type="bibr" rid="bib59">Smola et al., 2021</xref>; <xref ref-type="bibr" rid="bib30">Jain et al., 2023</xref>). Because of this, it is generally accepted that drug-like molecules should adopt low-energy, minimally strained geometries. However, optimizing both fit to density and internal energetics simultaneously remains a challenge (<xref ref-type="bibr" rid="bib34">Liebeschuetz, 2021</xref>). While our modified true positive datasets demonstrate that qFit-ligand can alleviate distortion by recovering alternate conformations, these cases are somewhat artificial; removing a valid altloc and re-refining can artificially inflate energetic penalties. To further validate our approach, we tested qFit-ligand on deposited structures with genuinely unfavorable conformations to gain a better understanding of whether our modeling algorithm impacts strain by discovering multiple low-energy conformations that satisfy the density as well, or better, than a single high-energy conformation.</p><p>To this end, we curated a dataset of deposited structures containing ligands with unusually high conformational energy by collecting all PDB entries with a resolution between 1.0 and 1.8 Å, an <italic>R</italic><sub>free</sub> below 0.25, and a ligand molecular weight between 400 and 520 Da. We required the structures to not have a deposited alternate conformer. From an initial pool of 5452 structures, we followed the pre-qFit-ligand refinement protocol previously described, calculated ligand energies, and selected those exceeding 10 kcal/mol for our final dataset. This resulted in a collection of 191 structures that we used as input to qFit-ligand (<xref ref-type="supplementary-material" rid="supp2">Supplementary file 2, table 2</xref>). We note that there is no consensus in the field as to what constitutes high strain, but that 10 kcal/mol represents a conservative, if somewhat arbitrary cutoff (<xref ref-type="bibr" rid="bib45">Perola and Charifson, 2004</xref>; <xref ref-type="bibr" rid="bib55">Sitzmann et al., 2012</xref>; <xref ref-type="bibr" rid="bib43">Nicklaus et al., 1995</xref>; <xref ref-type="bibr" rid="bib9">Borbulevych et al., 2018</xref>; <xref ref-type="bibr" rid="bib27">Hao et al., 2007</xref>; <xref ref-type="bibr" rid="bib10">Boström et al., 1998</xref>; <xref ref-type="bibr" rid="bib63">Tong and Zhao, 2021</xref>; <xref ref-type="bibr" rid="bib46">Rai et al., 2019</xref>).</p><p>qFit-ligand modeled 75.4% (<italic>n</italic> = 144) of the structures with a single conformer, while 19.4% (<italic>n</italic> = 37) had two conformers, and 5.2% (<italic>n</italic> = 10) had three conformers (<xref ref-type="fig" rid="fig5">Figure 5A</xref>). Interestingly, even without modeling an alternative conformer in the majority of structures, RSCC increased over the deposited model in 53.4% of structures (<italic>n</italic> = 102), EDIAm increased in 81.2% (<italic>n</italic> = 155), and strain decreased in 66.5% (<italic>n</italic> = 127) (<xref ref-type="fig" rid="fig5">Figure 5B</xref>, <xref ref-type="fig" rid="fig5s1">Figure 5—figure supplement 1</xref>). Many of these strain improvements came from the pool of 144 single-conformer outputs, suggesting that qFit-ligand is able to sample from highly strained input models to result in new models that are out of a local minima (<xref ref-type="fig" rid="fig5">Figure 5C, top</xref>). In fact, the largest strain reductions in this dataset came from this pool of improved single-conformer models. We also identified several examples of qFit-ligand lowering strain through the addition of a well-modeled alternate conformation (<xref ref-type="fig" rid="fig5">Figure 5C, bottom; 5D</xref>). In summary, our analysis reveals that qFit-ligand models adopt strain energies that are generally lowered from geometrically distorted deposited models, which supports using qFit-ligand to correct those distortions, even in the single-conformer case.</p><fig-group><fig id="fig5" position="float"><label>Figure 5.</label><caption><title>qFit-ligand improves fit of highly strained deposited molecules.</title><p>(<bold>A</bold>) Distribution of the number of conformers modeled by qFit-ligand across 191 deposited structures with ligand torsional strain &gt;10 kcal/mol. (<bold>B</bold>) Real space correlation coefficients (RSCC) and strain differences in the refined deposited models and the qFit-ligand predicted models. The lower right quadrant shows structures for which we improve both RSCC and strain. (C, top) Differences in torsion strain between the qFit-ligand models and the refined deposited models for structures where qFit-ligand predicted a single-conformer model. Negative delta values, all bars to the left of the vertical axis, represent structures for which the qFit-ligand model has a lower strain. (C, bottom) Differences in torsion strain between the qFit-ligand models and the refined deposited models for structures where qFit-ligand predicted a multiconformer model. Negative delta values, all bars to the left of the vertical axis, represent structures for which the qFit-ligand model has a lower strain. (<bold>D</bold>) Gallery of examples for which qFit-ligand successfully recovers well-fitting alternate conformers, and therefore reduces strain. The composite omit density map is contoured at 1σ for every structure.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-103797-fig5-v1.tif"/></fig><fig id="fig5s1" position="float" specific-use="child-fig"><label>Figure 5—figure supplement 1.</label><caption><title>Differences in EDIAm between the qFit-ligand models and the refined deposited models.</title><p>Positive delta values, all bars to the right of the vertical axis, represent structures for which the qFit-ligand model has a higher EDIAm.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-103797-fig5-figsupp1-v1.tif"/></fig></fig-group></sec><sec id="s2-10"><title>qFit-ligand can automatically detect and model multiple conformations of macrocycles</title><p>While small molecules are great for inhibiting proteins with deep pockets, many proteins with pharmaceutical interests are classified as ‘undruggable’, due to their flat surfaces or involvement in protein–protein interactions. Macrocycles, cyclic molecules consisting of 12 or more atoms, have a great ability to interact with flat surfaces or shallow grooves (<xref ref-type="bibr" rid="bib74">Yudin, 2015</xref>; <xref ref-type="bibr" rid="bib18">Driggers et al., 2008</xref>; <xref ref-type="bibr" rid="bib14">Cummings and Sekharan, 2019</xref>; <xref ref-type="bibr" rid="bib51">Russo et al., 2016</xref>; <xref ref-type="bibr" rid="bib23">Garcia Jimenez et al., 2023</xref>; <xref ref-type="bibr" rid="bib67">Vinogradov et al., 2019</xref>). Due to their high degrees of freedom, the conformations of macrocycles are difficult to sample exhaustively and are likely to adopt a diverse ensemble in solution and even when bound to a receptor (<xref ref-type="bibr" rid="bib5">Appavoo et al., 2019</xref>).</p><p>With our improved sampling strategy, we wanted to evaluate if we could accurately model multiple conformations of macrocycles. We utilized a dataset of 150 cyclic ligands with map resolutions ranging from 1.1 to 3.6 Å assembled during the development of XGen, an ensemble-based method for modeling macrocycles (<xref ref-type="bibr" rid="bib29">Jain et al., 2020</xref>). Through an ensemble modeling strategy, XGen encodes several full-system copies that collectively satisfy the experimental data using restrained force field energy calculations. This procedure frequently reduced strain compared to input structures. In contrast, qFit-ligand represents conformational heterogeneity through a multiconformer approach, labeling discrete parsimonious conformations with alternative location indicators (altlocs). We wanted to determine if we could detect and explain the similar conformational heterogeneity as XGen using qFit-ligand and multiconformer models.</p><p>All the originally deposited macrocycle models contain only single-conformer ligands. As done above, we re-refined the deposited models before running qFit-ligand. Of these, 19.33% (<italic>n</italic> = 29) could not be refined against the deposited structure factors and were removed from the analysis. We then ran qFit-ligand as described in the methods section and re-refined output structures. Refinement is notoriously difficult for macrocycles due to difficulty creating restraint files. This can lead to altered chemical connectivity, effectively changing the ligand’s composition, therefore, we conducted post-refinement ligand geometry validation checks to ensure that the chemical connectivity of the ligand remained unchanged, even if the conformation varied (Methods). We identified 19 cases of compromised ligand geometry (8 from pre-qFit and 11 from post-qFit refinement), which were subsequently excluded from this analysis. Additionally, strain calculation failed in 19.3% of cases (<italic>n</italic> = 29/150), producing N/A values, leaving 73 structures available for final analysis (<xref ref-type="supplementary-material" rid="supp3">Supplementary file 3, table 3</xref>, <xref ref-type="supplementary-material" rid="supp4">Supplementary file 4, table 6</xref>). Of note, the strain algorithm used was not developed for macrocycles, so this was not completely unexpected (<xref ref-type="bibr" rid="bib25">Gu et al., 2021</xref>). The resolution range of the remaining structures was between 1.4 and 3.2 Å. The loss of structures reflects broader limitations in current bioinformatics and refinement protocols when handling complex macrocycle ligands.</p><p>Analysis of qFit-ligand models for these 73 macrocycles shows the following distribution of conformers per model: 39.7% (<italic>n</italic> = 29) having one conformation, 34.3% (<italic>n</italic> = 25) having two conformations, and 26.0% (<italic>n</italic> = 19) having three conformations (<xref ref-type="fig" rid="fig6s1">Figure 6—figure supplement 1A</xref>). Compared to the single-conformer deposited models, qFit-ligand improved the RSCC in 69.9% (<italic>n</italic> = 51) of structures (<xref ref-type="fig" rid="fig6">Figure 6A</xref>). We observed a correlation between the number of conformers generated by qFit-ligand and the RSCC of the input model (<xref ref-type="fig" rid="fig6s1">Figure 6—figure supplement 1B</xref>), where a lower input RSCC increases the likelihood of identifying more alternate conformers. For our EDIAm calculations, we assume that the electron density contribution from an atom adopts a spherical shape. This assumption becomes invalid at map resolutions worse than 2 Å, as the atomic scattering factors can no longer be reliably approximated by the Gaussian functions. Only 36 structures met the 2 Å resolution criteria, and we computed EDIAm values for this subset. Among them, 58.3% (<italic>n</italic> = 21/36) showed higher EDIAm values in the qFit-ligand models compared to their corresponding deposited structures (<xref ref-type="fig" rid="fig6">Figure 6B</xref>). Torsion strain analysis showed that 57.5% (<italic>n</italic> = 42/73) of structures had a lower qFit-ligand model strain, with a mean strain difference of –0.1 kcal/mol. This indicates that, on average, our models maintain a similar level of energetic favorability as the deposited structures, while improving the fit to density (<xref ref-type="fig" rid="fig6">Figure 6A, C</xref>).</p><fig-group><fig id="fig6" position="float"><label>Figure 6.</label><caption><title>Evaluation of qFit-ligand predicted macrocycle conformations.</title><p>(<bold>A</bold>) Differences in real space correlation coefficients (RSCC) and torsion strain between qFit-ligand predicted structures and refined deposited single-conformer macrocycles. The lower right quadrant shows structures for which we improve both RSCC and strain. (<bold>B</bold>) Differences in EDIAm values between the qFit-ligand and deposited models. Bars to the right of the vertical axis represent structures where the qFit-ligand model fits better to the electron density map. (<bold>C</bold>) Gallery of examples for which the qFit-ligand models have improved RSCC and strain compared to the deposited single-conformer macrocycle ligand. The composite omit density map is contoured at 1σ for every structure.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-103797-fig6-v1.tif"/></fig><fig id="fig6s1" position="float" specific-use="child-fig"><label>Figure 6—figure supplement 1.</label><caption><title>The number of macrocycle alternative conformers produced per PDB and their relationship to fit to density.</title><p>(<bold>A</bold>) Distribution of the number of conformers in qFit-ligand output models, showing varied conformer presence with a median of two conformers per structure. (<bold>B</bold>) Correlation between the number of conformers output by qFit-ligand and the real space correlation coefficients (RSCC) of the input model. Higher input RSCC tends to yield a lower number of qFit-ligand conformers. (<bold>C</bold>) Comparison of strain between the single conformer deposited macrocycle and the qFit-ligand ‘B’ conformer for PDB 4Z2G using the COOT ligand distortion tool. The penalty scores for the two most distorted bonds and angles in the deposited model (left), compared to the same bonds and angles in the qFit-ligand ‘B’ conformer (right), demonstrating reduced strain in the alternate conformation. The deposited conformer is highly strained, with the highest bond penalty scores of 71.97 (C<sub>1</sub>–O<sub>2</sub>) and 69.32 (C<sub>14</sub>–O<sub>3</sub>), and the highest angle penalty scores of 29.97 (C<sub>2</sub>–C<sub>1</sub>–O<sub>2</sub>) and 25.5 (O<sub>3</sub>–C<sub>14</sub>–N<sub>1</sub>). The qFit-ligand ‘B’ conformer is significantly less distorted at these locations. For the same bonds and angles, it produces a penalty score of 1.93 (C<sub>1</sub>–O<sub>2</sub>), 0.45 (C<sub>14</sub>–O<sub>3</sub>), 0.90 (C<sub>2</sub>–C<sub>1</sub>–O<sub>2</sub>), and 1.19 (O<sub>3</sub>–C<sub>14</sub>–N<sub>1</sub>).</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-103797-fig6-figsupp1-v1.tif"/></fig></fig-group><p>A few outlier cases have substantially reduced strain in the qFit-ligand models, particularly PDB 4Z2G, which shows a decrease of 4.61 kcal/mol (<xref ref-type="fig" rid="fig6s1">Figure 6—figure supplement 1C</xref>). In this case, qFit-ligand generated two conformers: one similar, including the strained pathologies, to the deposited model and a second, distinct conformer. Using COOT’s ligand distortion tool, we compared the strain between the deposited and this distinct qFit-ligand ‘B’ conformer by analyzing each bond and angle (<xref ref-type="bibr" rid="bib20">Emsley, 2017</xref>). This tool evaluates deviations from ideal geometries based on COD (Crystallography Open Database) data, with restraint dictionaries generated through the AceDRG program (<xref ref-type="bibr" rid="bib38">Long et al., 2017b</xref>; <xref ref-type="bibr" rid="bib37">Long et al., 2017a</xref>) (Methods). In the qFit model, the overall strain is lower because alternative conformer ‘A’ is now at partial occupancy, and the ‘B’ conformer has much lower strain. Overall, while qFit-ligand primarily improves RSCC across most models, in a subset of cases, it also substantially reduces strain, demonstrating its ability to enhance both the fit and the energetic favorability of macrocycle conformations.</p></sec><sec id="s2-11"><title>qFit-ligand recovers heterogeneity in fragment-soaked event maps</title><p>X-ray crystallography-based fragment screens have taken off in academic and industry settings (<xref ref-type="bibr" rid="bib26">Günther et al., 2021</xref>; <xref ref-type="bibr" rid="bib22">Gahbauer et al., 2023</xref>; <xref ref-type="bibr" rid="bib28">Hartshorn et al., 2005</xref>; <xref ref-type="bibr" rid="bib6">Badger, 2012</xref>). Accurately modeling fragments is essential for effective building and merging strategies to create more drug-like molecules. However, as fragments are often bound at low occupancy, modeling into traditional 2F<sub>o</sub> − F<sub>c</sub> maps is incredibly difficult. To overcome this, ‘event maps’ are often created to detect low-occupancy ligands by averaging electron density across many apo datasets and subtracting these from the density of a potential ligand-bound structure (<xref ref-type="bibr" rid="bib44">Pearce et al., 2017</xref>). This produces a ligand binding ‘event map’ and an estimate of the ligand occupancy. Once event maps are created, a modeler must manually fit the single or multiple conformations of the ligand into it. Therefore, we wanted to determine if qFit-ligand could automatically identify and model multiple conformations in event maps.</p><p>To assess qFit-ligand’s ability to detect multiple conformations in event maps, we took advantage of ongoing fragment-based drug discovery efforts through the UCSF QCRG Antiviral Drug Discovery (AViDD) program to design inhibitors against the severe acute respiratory syndrome-coronavirus-2 NSP3 macrodomain (<xref ref-type="bibr" rid="bib22">Gahbauer et al., 2023</xref>; <xref ref-type="bibr" rid="bib60">Suryawanshi et al., 2024</xref>; <xref ref-type="bibr" rid="bib13">Correy et al., 2024</xref>). We identified previously published and new fragments manually modeled with multiple conformations (<italic>n</italic> = 20) (<xref ref-type="supplementary-material" rid="supp5">Supplementary file 5, table 5</xref>). We used these as a true positive dataset to determine if we could identify multiple fragment conformations in event maps using qFit-ligand.</p><p>We created a modified true positive dataset (<italic>n</italic> = 20) by removing all ‘B’ conformers and setting the ‘A’ conformer occupancy to 1.0. qFit-ligand was then run as described above, but with an event map, rather than a composite omit map (Methods). To determine how precisely we captured the second conformation, we calculated the RMSD between the manually modeled ‘B’ conformer and the closest qFit-ligand conformer for each structure (<xref ref-type="fig" rid="fig7">Figure 7A</xref>). Only 9 of the structures exhibit an RMSD of less than 0.5 Å, indicating that for approximately half of the cases, our algorithm struggles to recapitulate the second deposited conformer. Of the 11 fragments with poor RMSD, about a third (<italic>n</italic> = 4/11) adopted a completely different binding pose, which our current algorithm often fails to capture accurately due to reliance on the input model. This highlights a limitation of our sampling strategy and suggests a potential direction for future development (<xref ref-type="fig" rid="fig7s1">Figure 7—figure supplement 1</xref>).</p><fig-group><fig id="fig7" position="float"><label>Figure 7.</label><caption><title>Evaluation of qFit-ligand on fragments in PanDDA maps.</title><p>(<bold>A</bold>) Root mean square deviation (RMSD) between the deposited ‘B’ conformer and the closest qFit-ligand conformer. Lower values correlate with a closer recapitulation of the deposited heterogeneity. (<bold>B</bold>) Real space correlation coefficients (RSCC) and torsion strain differences in the deposited models and the qFit-ligand predicted models. The lower right quadrant shows structures for which we improve both RSCC and strain. (<bold>C</bold>) Differences in EDIAm values between the qFit-ligand and modified true positive models. Bars to the right of the vertical axis represent structures where the qFit-ligand model fits better to the event map. (<bold>D</bold>) Gallery of examples for which qFit-ligand successfully recovers well-fitting alternate conformers. The composite omit density map is contoured at 1σ for every fragment.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-103797-fig7-v1.tif"/></fig><fig id="fig7s1" position="float" specific-use="child-fig"><label>Figure 7—figure supplement 1.</label><caption><title>PDB 7HHU represents the structure with the highest root mean square deviation (RMSD) between its deposited ‘A’ (green) and ‘B’ (gray) conformers.</title><p>Due to qFit-ligand’s sampling bias toward the input structure, we largely fail to recover the known heterogeneity of this sample, with an RMSD of 0.70 Å between the qFit model and the deposited ‘B’. qFit real space correlation coefficients (RSCC) and strain show improvements over the single conformer modified true positive, but EDIAm worsens. The event density map is contoured at 1σ for both structures.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-103797-fig7-figsupp1-v1.tif"/></fig><fig id="fig7s2" position="float" specific-use="child-fig"><label>Figure 7—figure supplement 2.</label><caption><title>Comparison of deposited conformers ‘A’ (green), ‘B’ (gray), and qFit-ligand conformers for PDB 7HHW.</title><p>qFit-ligand generates a multiconformer model with a relatively high root mean square deviation (RMSD) (0.5 Å) to the deposited ‘B’ conformer. The closest qFit-ligand conformer (yellow) shares an extremely similar atomic space with the deposited ‘B’, differing primarily due to a flipped Thiophene, resulting in the high RMSD. Despite this, the qFit-ligand model has an improved fit to the electron density, indicating that multiple distinct conformations can accurately explain the experimental data.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-103797-fig7-figsupp2-v1.tif"/></fig></fig-group><p>Despite this, compared to the modified true positive models, the qFit-ligand models had a higher RSCC in 17 structures and a higher EDIAm in 15 (<xref ref-type="fig" rid="fig7">Figure 7B, C</xref>). There are a number of structures for which we calculate an RMSD &gt;0.5 Å and also an improved qFit-ligand map-to-model fit. In many of these cases, the improvement is generally very small. In others, we believe they represent situations where multiple combinations of conformations can accurately represent the underlying data. For instance, in PDB 7HHW, the qFit-ligand model generated a flipped Thiophene compared to the deposited model, resulting in a relatively high RMSD to the deposited 'B' while still providing an equally good fit to the electron density (<xref ref-type="fig" rid="fig7s2">Figure 7—figure supplement 2</xref>). In addition, the torsion strain analysis reveals that 13 structures have a lower strain in the qFit-ligand model, and 12 structures have both a higher RSCC and a lower model strain in the qFit-ligand model (<xref ref-type="fig" rid="fig7">Figure 7B</xref>). While the mean strain improvement in the qFit-ligand models was marginal, only –0.6 kcal/mol, it indicates that we can reliably fit to density without straining the molecule (<xref ref-type="fig" rid="fig7">Figure 7D</xref>).</p><p>In this use case, qFit-ligand models alternative conformations into an event map, which represents only partial occupancy of the unit cell. Therefore, we scale the output ligand conformer occupancies to estimated occupancy from the background density correction prior to merging into the full system. Following this scaling, we perform standard refinement and note that the sum of occupancy across ligand conformations is a refined variable that can be &lt;1. Together, these results suggest that qFit-ligand can be used alongside manual modeling of fragment modeling, but additional development is needed where there are large ligand conformational changes.</p></sec><sec id="s2-12"><title>qFit-ligand models multiple conformations of ligands into cryo-EM density maps</title><p>Recent advances in cryo-EM are resulting in many reconstructions with better than 2 Å resolution. At this resolution, it is possible to resolve conformational heterogeneity at the atomic level, prompting us to determine if qFit-ligand can capture this heterogeneity. To evaluate the performance of qFit-ligand on cryo-EM data, we examined recently deposited inhibitors of human CDK-activating kinase, a three-subunit protein complex recognized as a compelling candidate for cancer and antiviral drug development (<xref ref-type="bibr" rid="bib15">Cushing et al., 2024</xref>). Four of their molecules were manually modeled as multiconformer ligands, providing a valuable set of true positives (<xref ref-type="fig" rid="fig8">Figure 8</xref>). All map resolutions were better than 2 Å, and ligand molecular weights were between 350 and 397 Da (<xref ref-type="supplementary-material" rid="supp7">Supplementary file 7, table 7</xref>).</p><fig id="fig8" position="float"><label>Figure 8.</label><caption><title>Gallery of the four cryo-electron microscopy (cryo-EM) structures with deposited model, modified true positive, and qFit-ligand structure.</title><p>In each case, the qFit-ligand model outperforms the modified true positive model in all validation metrics. The EDM density map is contoured at 1σ for every structure.</p></caption><graphic mimetype="image" mime-subtype="tiff" xlink:href="elife-103797-fig8-v1.tif"/></fig><p>For each deposited model, we created a new modified single-conformer true positive following the same procedure as outlined above. Next, we applied a similar pipeline as with the other true positive datasets. For both refinement stages, we instead used <italic>phenix.real_space_refine</italic> (Methods) with the deposited EM map. In all four structures, qFit-ligand identified a second conformation. Compared to the modified single-conformer true positive input model, all generated multiconformers were improved in terms of RSCC, EDIAm, and strain (<xref ref-type="fig" rid="fig8">Figure 8</xref>). Across the four structures, RSCC increased by up to 0.1, EDIAm by up to 0.2, and strain decreased by up to 2.3 kcal/mol in the qFit-ligand models. Interestingly, in all of the structures, qFit-ligand placed slightly different conformations and occupancies compared to the deposited model, however, all resulted in improved RSCC and strain, although two out of the four structures had lower EDIAm (<xref ref-type="fig" rid="fig8">Figure 8</xref>). This result suggests that qFit-ligand can be used to model conformational heterogeneity to improve model quality in cryo-EM derived structures, although this needs to be examined with a larger dataset.</p></sec></sec><sec id="s3" sec-type="discussion"><title>Discussion</title><p>Although ligands can retain conformational flexibility when bound to receptors, this conformational heterogeneity is rarely captured in deposited models, potentially leading to misinterpretations of protein–ligand interactions (<xref ref-type="bibr" rid="bib66">van Zundert et al., 2018</xref>; <xref ref-type="bibr" rid="bib56">Skaist Mehlman et al., 2023</xref>; <xref ref-type="bibr" rid="bib76">Zhou and Hong, 2021</xref>). A key reason for this modeling gap is the significant compositional and conformational heterogeneity surrounding ligands, making accurate modeling of ligands particularly challenging. qFit-ligand directly tackles the challenge of conformational heterogeneity by automatically modeling alternative ligand conformations in high-resolution X-ray crystallography and cryo-EM maps with clear unmodeled features. It is advisable to employ qFit-ligand selectively, focusing on cases where there is a moderate correlation between the input model and the experimental data, strong visual density in the binding pocket, high map resolution, or when a single-conformer ligand model is strained.</p><p>The major advancements in qFit-ligand presented here stem from integrating the torsionally aware sampling strategy from RDKit, resulting in a reduction of ligand torsional strain, while still providing an increase in model to map fit. We observed this improvement in both ligands that fit by multiple low-strain conformations, along with improved fit of single ligand conformations. High ligand strain is energetically unfavorable and can reduce binding affinity (<xref ref-type="bibr" rid="bib55">Sitzmann et al., 2012</xref>). Therefore, we would expect that most observed protein–ligand complexes in the PDB are likely to represent relatively unstrained ligands. While the majority of deposited structures are low in strain, analyses across multiple tools reveal a wide distribution of strain observed, with many structures having high strain (<xref ref-type="bibr" rid="bib59">Smola et al., 2021</xref>; <xref ref-type="bibr" rid="bib30">Jain et al., 2023</xref>; <xref ref-type="bibr" rid="bib63">Tong and Zhao, 2021</xref>). We demonstrate the possibility of using qFit-ligand to fix high-strain ligands by identifying where multiple ligand conformations should be used, or by improving the geometry of a single conformation through torsionally aware sampling.</p><p>In addition to these overall improvements, we have expanded qFit-ligand in three primary directions. First, we enabled qFit-ligand to model conformational heterogeneity in macrocycles. Macrocycles have the possibility for targeting ‘undruggable’ proteins because their exceptional conformational flexibility allows them to interact effectively with relatively flat protein surfaces (<xref ref-type="bibr" rid="bib67">Vinogradov et al., 2019</xref>). We showed that qFit-ligand can parsimoniously capture the heterogeneity present in bound macrocycles, often improving fit to density while lowering strain compared to the deposited single-conformer structures. While a previous effort, XGen, showed that ensemble representations of macrocycles also reduced the strain compared to deposited structures (<xref ref-type="bibr" rid="bib29">Jain et al., 2020</xref>), ensemble models are complex to analyze, difficult to manipulate in model building software (<xref ref-type="bibr" rid="bib19">Emsley et al., 2010</xref>), and require specific refinement protocols that prevent easy integration into modeling pipelines.</p><p>Second, we have added capabilities to model partially occupied fragments from high-throughput screening campaigns. The popularity of X-ray crystallography-based fragment screening has surged due to beamline improvements and algorithmic developments that enhance detection of low-occupancy binding events (<xref ref-type="bibr" rid="bib44">Pearce et al., 2017</xref>). Fragments can potentially bind in multiple conformations due to the small size and promiscuous or weak interactions (<xref ref-type="bibr" rid="bib7">Bian and Xie, 2018</xref>). We expanded qFit-ligand to automatically model fragments into event maps. Because of the weak signal in event maps, we emphasize the importance of manual scrutiny of the output conformations for fragments to an even greater extent than for larger, fully occupied ligands. Further, we identified that qFit-ligand has difficulty identifying alternative conformations resulting from larger translations and ‘ligand flips’ that are more common with fragment screening. We have also added an experimental flag that samples 180° flips of ligands; however, this approach should only be used as an exploratory tool where there is a strong visual prior.</p><p>Third, we can now apply qFit-ligand to cryo-EM data. This capability opens up exciting new opportunities for structure-based drug discovery. There are several applications where cryo-EM is better suited to experimental objectives than crystallography, including the characterization of dynamic and heterogeneous biomolecular assemblies in more native-like environments (<xref ref-type="bibr" rid="bib68">Wang and Wang, 2017</xref>). As a proof of principle, we showed that qFit-ligand can recapitulate deposited alternate conformations from a ligand series, demonstrating its potential to model multiconformer ligands directly into high-resolution cryo-EM density maps.</p><p>Despite these advancements, qFit-ligand has room for further improvement. Our approach is limited by its reliance on an initial single-conformer structure, which introduces bias toward the starting model and hinders effective exploration of conformational space when the input ligand is poorly resolved. Additionally, qFit-ligand performs best when unmodeled density is consistent with subtle conformational changes, such as torsion angle variations or minor translational shifts. It struggles to identify more dramatic conformational heterogeneity, such as 180° flip ligand conformations as seen in our fragment dataset (<xref ref-type="bibr" rid="bib22">Gahbauer et al., 2023</xref>; <xref ref-type="bibr" rid="bib60">Suryawanshi et al., 2024</xref>; <xref ref-type="bibr" rid="bib13">Correy et al., 2024</xref>). As such, qFit-ligand primarily serves as a ‘thought partner’ for manual modeling. Modelers still must resolve many ambiguities, including initial ligand placement, in order to fully take advantage of qFit capabilities. In active modeling workflows or large-scale analyses, the workflow would only accept the output of qFit-ligand when it improves model quality. In cases where qFit-ligand degrades map-to-model fit and/or strain, we can simply revert to the input model. In practice, users can easily remove poorly fitting conformations using molecular modeling software such as COOT, while keeping the well-modeled conformations, which is an advantage of the multiconformer approach over ensemble refinement methods.</p><p>Additionally, our algorithm’s placement within the larger refinement and ligand modeling ecosystem highlighted other areas that need improvement. We note that macrocycles, due to their complicated and interconnected degrees of freedom, suffer acutely from the refinement issues, as demonstrated by the failure of approximately one-third of datasets in our standard preparation or post-refinement pipelines due to ligand parameterization issues. Many of these stemmed from problematic ligand restraint files, highlighting the difficulty of encoding the geometric constraints of macrocycles using standard restraint libraries. Improved force fields or restraints for macrocycles are desperately needed to improve their modeling. New approaches such as quantum mechanical restraints refinement (<xref ref-type="bibr" rid="bib36">Liebschner et al., 2023</xref>), which replaces standard geometric restraints with in situ energy-minimized quantum calculations, may offer a path toward more accurate modeling of chemically complex ligands. We note that even linear non-canonical peptides present similar failure modes to macrocycles, with a mix of ATOM and HETATM records and the need for custom cif definitions and link records. For these reasons, we did not include analysis on small peptide ligands; however, canonical peptides can be modeled with standard qFit (<xref ref-type="bibr" rid="bib73">Wankowicz et al., 2024c</xref>).</p><p>Finally, we ultimately strive for modeling the conformational heterogeneity across the entire system including ligands, proteins, nucleic acids, and water molecules. Currently, qFit algorithms allow for modeling either the protein or the ligand separately, focusing on the conformational possibilities of one while treating the other as static (<xref ref-type="bibr" rid="bib73">Wankowicz et al., 2024c</xref>). Joint modeling across all system components would generate conformational ensembles that enhance our understanding of how the conformational heterogeneity of each component impacts the other. However, the combinatorial complexity of such problems is ill-suited for the sample-and-select strategies employed by qFit. Beyond the computational modeling advancements, without machine-readable and human-interpretable encoding, we will remain limited in understanding the natural heterogeneity that impacts molecular recognition and drug design (<xref ref-type="bibr" rid="bib72">Wankowicz and Fraser, 2024b</xref>). Overall, qFit-ligand provides structural biologists with an efficient tool for modeling parsimonious multiconformer ligand models that fit optimally into electron density maps, reducing the need for manual intervention, aiding in understanding how conformational heterogeneity impacts ligand binding and downstream biology.</p></sec><sec id="s4" sec-type="methods"><title>Methods</title><sec id="s4-1"><title>Running qFit-ligand</title><p>SMILES strings used as input for qFit-ligand are fetched from the PDB, given the three-letter ligand identifier. Our RDKit-based conformer sampling is initialized from the input PDB file; however, RDKit often misassigns bond orders when interpreting PDBs directly. Therefore, we use the SMILES string as a template for correcting bond orders in the generated conformers.</p><p>To run qFit-ligand on regular small molecules and macrocycles, we used the following command:</p><list list-type="simple" id="list1"><list-item><p>qfit_ligand composite_omit_map.mtz refined_pdb.pdb -sm&lt;smiles string&gt; -l 2FOFCWT,PH2FOFCWT &lt;chain,res_num&gt; –p 5.</p></list-item></list><p>To run qFit-ligand when using an event map, we used the following command:</p><list list-type="simple" id="list2"><list-item><p>qfit_ligand event_map.ccp4 input_model.pdb -sm&lt;smiles string&gt; -l FWT,PHWT -r&lt;resolution &gt; &lt;chain,res_num&gt; –p 5</p></list-item></list><p>To run qFit-ligand when using a cryo-EM map, we used the following command:</p><list list-type="simple" id="list3"><list-item><p>qfit_ligand &lt;emd_map&gt;.map input_model.pdb -sm&lt;smiles string&gt; -r&lt;resolution &gt; &lt;chain,res_num&gt; –cryo_em_ligand –p 5</p></list-item></list><p>Code for running qFit-ligand is available in our Github repository (<ext-link ext-link-type="uri" xlink:href="https://github.com/ExcitedStates/qfit-3.0">https://github.com/ExcitedStates/qfit-3.0</ext-link> copy archived at <xref ref-type="bibr" rid="bib49">Riley et al., 2025</xref>) under version 2024.3 and SBGrid (<ext-link ext-link-type="uri" xlink:href="https://sbgrid.org/">https://sbgrid.org/</ext-link>).</p></sec><sec id="s4-2"><title>RDKit’s ETKDG implementation</title><p>ETKDG is an enhancement of traditional Distance Geometry (DG), implemented within RDKit’s EmbedMultipleConfs function (<xref ref-type="bibr" rid="bib50">Riniker and Landrum, 2015</xref>). During the distance bounds matrix construction, bounds are set for 1–2 (bonded atoms), 1–3 (bond angle related atoms), 1–4 (torsion angle related atoms), and 1–5 interactions, based on empirical knowledge of ideal bond lengths and angles from chemical structures. These bounds are subsequently sampled and embedded into 3D coordinates. Next, a minimization step is performed using SMARTS patterns to identify torsional substructures in the molecule (<xref ref-type="bibr" rid="bib52">Schärfer et al., 2013</xref>), where for each SMARTS identified torsion pattern, the corresponding torsional potential is applied to the sampled conformation. These energy functions describe the energetic preference for specific dihedral angles and guide the RDKit-generated torsions toward experimentally observed angle ranges. The functional form is expressed as a cosine series expansion, and the parameters are fit to experimental torsion angle distributions from the CSD. Following the torsional minimization, we apply a force field minimization using the MMFF94 force field via the ForceField.rdForceField module of RDKit. The force field has the functional form of<disp-formula id="equ1"><alternatives><mml:math id="m1"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>E</mml:mi><mml:mrow><mml:mi>M</mml:mi><mml:mi>M</mml:mi><mml:mi>F</mml:mi><mml:mi>F</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>∑</mml:mo><mml:mi>E</mml:mi><mml:msub><mml:mi>B</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mo>∑</mml:mo><mml:mi>E</mml:mi><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>∑</mml:mo><mml:mi>E</mml:mi><mml:mi>B</mml:mi><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mo>∑</mml:mo><mml:mi>E</mml:mi><mml:mi>O</mml:mi><mml:mi>O</mml:mi><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi><mml:mi>k</mml:mi><mml:mo>;</mml:mo><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mo>∑</mml:mo><mml:mi>E</mml:mi><mml:msub><mml:mi>T</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi><mml:mi>k</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mo>∑</mml:mo><mml:mi>E</mml:mi><mml:mi>c</mml:mi><mml:mi>d</mml:mi><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mo>∑</mml:mo><mml:mi>E</mml:mi><mml:msub><mml:mi>Q</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:mrow></mml:mstyle></mml:math><tex-math id="t1">\begin{document}$$\displaystyle  E_{MMFF} =\sum EB_{ij} +\sum EA_{ijk} \sum EBA_{ijk}+\sum EOOP_{ijk;l}+\sum ET_{ijkl}+\sum EcdW_{ij}+\sum EQ_{ij}$$\end{document}</tex-math></alternatives></disp-formula></p><p>Where the terms refer to bond stretching, angle bending, stretch-bend, out-of-plane bending, torsional, van der Waals, and electrostatic, respectively (<xref ref-type="bibr" rid="bib64">Tosco et al., 2014</xref>).</p></sec><sec id="s4-3"><title>Pre-qFit refinement protocol</title><sec id="s4-3-1"><title>For X-ray maps</title><p>Before running qFit-ligand, all input models are stripped of their alt confs, resulting in a set of single-conformer coordinate files with ‘A’ ligand occupancies set to 1.0. We use phenix.ready_set (or phenix.elbow if phenix.ready_set fails) to generate cif files for ligand restraint during refinement. All pre-qFit refinement uses the following parameters.</p><list list-type="simple" id="list5"><list-item><p>refinement.refine.strategy=individual_sites+individual_adp+occupancies</p></list-item><list-item><p>refinement.input.monomers.file_name=ligand.cif</p></list-item><list-item><p>refinement.main.number_of_macro_cycles=5</p></list-item><list-item><p>refinement.main.nqh_flips=True</p></list-item><list-item><p>refinement.output.write_maps=False</p></list-item><list-item><p>refinement.hydrogens.refine=riding</p></list-item><list-item><p>refinement.main.ordered_solvent=True</p></list-item><list-item><p>refinement.target_weights.optimize_xyz_weight=True</p></list-item><list-item><p>refinement.target_weights.optimize_adp_weight=True</p></list-item><list-item><p>refinement.input.xray_data.r_free_flags.generate=True</p></list-item></list><p>After refinement, we generate a composite omit map from the refined model to use as qFit-ligand input.</p><list list-type="simple" id="list6"><list-item><p>phenix.composite_omit_map refined_model.pdb data.mtz omit-type=refine nproc=8r_free_flags.generate=True exclude_bulk_solvent=True</p></list-item></list><p>Setting <italic>exclude_bulk_solvent=True</italic> prevents the bulk solvent model from being applied, which typically accounts for disordered solvent by filling low-density areas in the map. When bulk solvent correction is included, it adjusts the electron density by assuming the presence of uniform solvent in regions of low density, such as areas surrounding the ligand. This can reduce the contrast between weak ligand density and the surrounding solvent, potentially smearing or flattening the electron density around flexible or poorly ordered regions like alternative ligand conformations. By excluding bulk solvent correction, you retain the raw electron density in those regions, ensuring the density is not artificially raised or smoothed. This allows clearer visualization of weak or partial densities that might indicate alternative conformers.</p></sec></sec><sec id="s4-4"><title>For cryo-EM maps</title><p>For cryo-EM data, we use a similar refinement protocol, but instead use phenix.real_space_refine (<xref ref-type="bibr" rid="bib2">Afonine et al., 2018</xref>). We mainly use default parameters, but specify the following:</p><list list-type="simple" id="list7"><list-item><p>refinement.macro_cycles=5</p></list-item><list-item><p>pdb_interpretation.apply_cif_restraints.restraints_file_name</p></list-item></list></sec><sec id="s4-5"><title>Post-qFit refinement protocol</title><p>After qFit-ligand is run, and before the final refinement, if there are any conformers &lt;0.1 occupancy, they are culled from the output multiconformer model. Again, we use phenix.ready_set (or phenix.elbow if phenix.ready_set fails) to generate cif files for ligand restraint during refinement. All crystal structures are subsequently refined with the following parameters.</p><list list-type="simple" id="list8"><list-item><p>refinement.refine.strategy=individual_sites+individual_adp +occupancies</p></list-item><list-item><p>refinement.input.monomers.file_name=ligand.cif</p></list-item><list-item><p>refinement.main.number_of_macro_cycles=5</p></list-item><list-item><p>refinement.main.nqh_flips=True</p></list-item><list-item><p>refinement.refine.adp.individual.isotropic=all</p></list-item><list-item><p>refinement.output.write_maps=False</p></list-item><list-item><p>refinement.hydrogens.refine=riding</p></list-item><list-item><p>refinement.main.ordered_solvent=True</p></list-item><list-item><p>refinement.target_weights.optimize_xyz_weight=True</p></list-item><list-item><p>refinement.target_weights.optimize_adp_weight=True</p></list-item></list><p>All cryo-EM structures are subsequently refined with default parameters along with specifying the following parameters:</p><list list-type="simple" id="list9"><list-item><p>refinement.macro_cycles=5</p></list-item><list-item><p>pdb_interpretation.apply_cif_restraints.restraints_file_name</p></list-item></list><p>After five macro cycles of refinement, we then remove and redistribute the occupancy of any conformers with less than 10% occupancy. We do not re-refine after this redistribution.</p><p>If running qFit-ligand on an event map, the refinement process involves an additional step. When using the optional --BDC flag, the script scales the occupancies of the qFit-ligand generated conformers by a factor of (1 − BDC), and produces a new protein-ligand PDB file with the adjusted occupancies. The new PDB file is then processed through the standard refinement protocol, as described above.</p></sec><sec id="s4-6"><title>Ligand geometry validation of macrocycles</title><p>To validate the geometry of the macrocyclic ligands, we employed a quick check to ensure that the chemical structure had not been altered during refinement. Specifically, we checked that the chemical connectivity of the ligand remained unchanged, even if the conformation varied.</p><list list-type="order" id="list10"><list-item><p>Load the PDB file of the protein–ligand complex along with the SMILES string of the bound ligand. The SMILES string represents the correct chemical connectivity of the ligand as it should appear post-refinement.</p></list-item><list-item><p>Use RDKit to interpret the SMILES string and attempt to assign bond orders to the ligand in the PDB file. This step compares the intended chemical structure (from the SMILES) with the actual structure after refinement. The bond order assignment is used as a proxy to check if the refinement process altered the ligand’s chemical connectivity.</p></list-item><list-item><p>If RDKit successfully assigns bond orders, it suggests that the chemical connectivity has been preserved, and that the refinement process did not improperly modify the ligand’s geometry. However, if RDKit encounters difficulties assigning bond orders, this signals that the refinement may have detrimentally altered the ligand’s structure.</p></list-item></list><p>This method serves as a fast, automated ‘sanity check’ to flag potential problems, helping to avoid the need for manual inspection of each PDB file.</p></sec><sec id="s4-7"><title>COOT’s ligand distortion tool</title><p>To examine how conformational differences impacted strain in select examples from the macrocycle dataset, we used COOT’s ligand distortion tool (<xref ref-type="bibr" rid="bib20">Emsley, 2017</xref>). The penalty score is calculated using Hooke’s Law, where target values and sigma values from the restraint files are used. The non-bonded interactions are penalized using the Lennard–Jones potential, with atom radii taken from the CCP4 geometry tables. Larger deviations from ideal geometries result in higher penalties, and the overall penalty score is calculated as <inline-formula><alternatives><mml:math id="inf1"><mml:mo>(</mml:mo><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:mi>e</mml:mi><mml:mi>v</mml:mi><mml:mi>i</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mi>o</mml:mi><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>σ</mml:mi></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math><tex-math id="inft1">\begin{document}$\left (\frac{deviation}{\sigma }\right)^{2}$\end{document}</tex-math></alternatives></inline-formula>, where σ represents the standard deviation of the target value, functioning as the spring constant in Hooke’s Law.</p><sec id="s4-7-1"><title>Scoring</title><p>QP solvers handle Quadratic Programming problems (<xref ref-type="bibr" rid="bib3">Agrawal et al., 2017</xref>; <xref ref-type="bibr" rid="bib16">Diamond and Boyd, 2016</xref>). These problems involve an objective function that is quadratic (a polynomial of degree two) and is subject to linear constraints. The primary goal in the QP framework is to find the combination of conformer occupancies, stored in vector <inline-formula><alternatives><mml:math id="inf2"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>ω</mml:mi><mml:mo>=&lt;</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mo>.</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo></mml:mrow></mml:mstyle></mml:math><tex-math id="inft2">\begin{document}$\omega =&lt;\omega _{0},...,\omega _{n}\gt $\end{document}</tex-math></alternatives></inline-formula>, that minimize the difference between the observed electron density and the electron density calculated from the model. Mathematically, this minimizes a residual sum-of-squares function, <inline-formula><alternatives><mml:math id="inf3"><mml:mi>r</mml:mi><mml:mi>s</mml:mi><mml:mi>s</mml:mi><mml:mo>(</mml:mo><mml:mi>ω</mml:mi><mml:mo>)</mml:mo></mml:math><tex-math id="inft3">\begin{document}$rss\left (\omega \right)$\end{document}</tex-math></alternatives></inline-formula>:<disp-formula id="equ2"><alternatives><mml:math id="m2"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>ω</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi><mml:mi>s</mml:mi><mml:mi>s</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>ω</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>ω</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mo>∥</mml:mo><mml:msup><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msup><mml:mi>ω</mml:mi><mml:mo>−</mml:mo><mml:msup><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>o</mml:mi></mml:mrow></mml:msup><mml:msup><mml:mo>∥</mml:mo><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:mrow></mml:mstyle></mml:math><tex-math id="t2">\begin{document}$$\displaystyle  min_{\omega } (rss(\omega ))=min_{\omega } (\parallel \rho ^{c}\omega - \rho ^{o}\parallel^{2} )$$\end{document}</tex-math></alternatives></disp-formula></p><list list-type="simple" id="list11"><list-item><p><inline-formula><alternatives><mml:math id="inf4"><mml:msup><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi></mml:mrow></mml:msup></mml:math><tex-math id="inft4">\begin{document}$\rho ^{o}$\end{document}</tex-math></alternatives></inline-formula> is the observed electron density from the user-provided map (target)</p></list-item><list-item><p><inline-formula><alternatives><mml:math id="inf5"><mml:msup><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msup></mml:math><tex-math id="inft5">\begin{document}$\rho ^{c}$\end{document}</tex-math></alternatives></inline-formula> is the weighted calculated electron density from conformers</p></list-item></list><p>These occupancies are meaningful parameters, so we require that their sum is within the unit interval, ensuring the total model density does not surpass 100% occupancy.<disp-formula id="equ3"><alternatives><mml:math id="m3"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi mathvariant="normal">Σ</mml:mi><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:mn>1</mml:mn></mml:mstyle></mml:mrow></mml:mstyle></mml:math><tex-math id="t3">\begin{document}$$\displaystyle  \Sigma \omega _{i}\leq 1$$\end{document}</tex-math></alternatives></disp-formula></p><p>Each individual occupancy must be a positive fractional number, meaning each conformer’s contribution is between none and full.<disp-formula id="equ4"><alternatives><mml:math id="m4"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mn>0</mml:mn><mml:mo>≤</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:mn>1</mml:mn></mml:mstyle></mml:mrow></mml:mstyle></mml:math><tex-math id="t4">\begin{document}$$\displaystyle  0\leq \omega _{i}\leq 1$$\end{document}</tex-math></alternatives></disp-formula></p><p>MIQP solvers extend the capabilities of QP solvers by incorporating integer constraints into the optimization problem.</p><p>Again, we set up the minimization problem:</p><p><inline-formula><alternatives><mml:math id="inf6"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>ω</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi><mml:mi>s</mml:mi><mml:mi>s</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>ω</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>ω</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mo>∥</mml:mo><mml:msup><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msup><mml:mi>ω</mml:mi><mml:mo>−</mml:mo><mml:msup><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>o</mml:mi></mml:mrow></mml:msup><mml:msup><mml:mo>∥</mml:mo><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math><tex-math id="inft6">\begin{document}$min_{\omega } (rss(\omega ))=min_{\omega } (\parallel \rho ^{c}\omega - \rho ^{o}\parallel^{2} )$\end{document}</tex-math></alternatives></inline-formula><disp-formula id="equ5"><alternatives><mml:math id="m5"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi mathvariant="normal">Σ</mml:mi><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:mn>1</mml:mn></mml:mstyle></mml:mrow></mml:mstyle></mml:math><tex-math id="t5">\begin{document}$$\displaystyle  \Sigma \omega _{i}\leq 1$$\end{document}</tex-math></alternatives></disp-formula></p><p>Here, we select up to a predetermined number of conformers (cardinality) that meets a minimum occupancy threshold, with all others set to zero. This selection is achieved through mixed-integer linear constraints:<disp-formula id="equ6"><alternatives><mml:math id="m6"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>t</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:mrow></mml:mstyle></mml:math><tex-math id="t6">\begin{document}$$\displaystyle  z_{i}t_{min}\leq \omega _{i}\leq z_{i}$$\end{document}</tex-math></alternatives></disp-formula></p><p>where<disp-formula id="equ7"><alternatives><mml:math id="m7"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle></mml:math><tex-math id="t7">\begin{document}$$\displaystyle  z_{i}\in \left \{0,1\right \}$$\end{document}</tex-math></alternatives></disp-formula></p><p><inline-formula><alternatives><mml:math id="inf7"><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:math><tex-math id="inft7">\begin{document}$t_{min}$\end{document}</tex-math></alternatives></inline-formula> is the minimum-allowable occupancy value for <inline-formula><alternatives><mml:math id="inf8"><mml:msub><mml:mrow><mml:mi>ω</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><tex-math id="inft8">\begin{document}$\omega _{i}$\end{document}</tex-math></alternatives></inline-formula>. If <inline-formula><alternatives><mml:math id="inf9"><mml:msub><mml:mrow><mml:mi>ω</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><tex-math id="inft9">\begin{document}$\omega _{i}$\end{document}</tex-math></alternatives></inline-formula> in non-zero, it must be at least <inline-formula><alternatives><mml:math id="inf10"><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:math><tex-math id="inft10">\begin{document}$t_{min}$\end{document}</tex-math></alternatives></inline-formula>.</p><p>The integer constraint limits the number of conformers explicitly. Cardinality is set to three, and the minimum occupancy <inline-formula><alternatives><mml:math id="inf11"><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:math><tex-math id="inft11">\begin{document}$t_{min}$\end{document}</tex-math></alternatives></inline-formula> set to 0.20, so only up to three conformers can have non-zero weights (of at least <inline-formula><alternatives><mml:math id="inf12"><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:math><tex-math id="inft12">\begin{document}$t_{min}$\end{document}</tex-math></alternatives></inline-formula>) in the final multiconformer model.</p><p>Should the user include the optional ‘--cryo_em_ligand’ flag on the command line, the cardinality will be reduced from three to two.</p></sec><sec id="s4-7-2"><title>RSCC</title><p>The RSCC is a metric used to assess how well a modeled structure fits into the observed electron density in a crystallographic experiment. It compares the observed electron density values with the electron density values calculated from the model. RSCC values range from 0 to 1, with values above 0.80 generally indicating a good fit. RSCC is calculated using a linear sample correlation coefficient formula:<disp-formula id="equ8"><alternatives><mml:math id="m8"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>R</mml:mi><mml:mi>S</mml:mi><mml:mi>C</mml:mi><mml:mi>C</mml:mi><mml:mo>=</mml:mo><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>v</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:msqrt><mml:mi>v</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mi>v</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:msqrt></mml:mfrac></mml:mstyle></mml:mrow></mml:mstyle></mml:math><tex-math id="t8">\begin{document}$$\displaystyle  RSCC=coor(\rho _{obs},\rho _{calc}) = \frac{cov(\rho_{obs}, \rho_{calc})}{\sqrt{var(\rho_{obs})var(\rho_{calc})} }$$\end{document}</tex-math></alternatives></disp-formula><disp-formula id="equ9"><alternatives><mml:math id="m9"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mspace width="1em"/><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mo>∑</mml:mo><mml:mo>∣</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mo>&lt;</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>&gt;∣</mml:mo><mml:mo>∑</mml:mo><mml:mo>∣</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mo>&lt;</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:mo stretchy="false">∣</mml:mo></mml:mrow><mml:msqrt><mml:mo>∑</mml:mo><mml:mo>∣</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mo>&lt;</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:msup><mml:mo>∣</mml:mo><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>∑</mml:mo><mml:mo>∣</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mo>&lt;</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:msup><mml:mo stretchy="false">∣</mml:mo><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:msqrt></mml:mfrac></mml:mstyle></mml:mrow></mml:mstyle></mml:math><tex-math id="t9">\begin{document}$$\displaystyle  \quad\quad\quad\quad=\frac{\sum\mid \rho _{obs}-&lt;\rho _{obs}&gt;\mid \sum\mid \rho _{calc}-&lt;\rho _{calc}&gt;\mid }{\sqrt{\sum\mid \rho _{obs}-&lt;\rho _{obs}&gt;\mid ^{2}\sum\mid \rho _{calc}-&lt;\rho _{calc}&gt;\mid ^{2} } }$$\end{document}</tex-math></alternatives></disp-formula></p><p>where <inline-formula><alternatives><mml:math id="inf13"><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:math><tex-math id="inft13">\begin{document}$\rho _{obs}$\end{document}</tex-math></alternatives></inline-formula> is the observed electron density at grid points covering the residue of interest (the input density map), and <inline-formula><alternatives><mml:math id="inf14"><mml:msub><mml:mrow><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:math><tex-math id="inft14">\begin{document}$\rho _{calc}$\end{document}</tex-math></alternatives></inline-formula> is the density map calculated from the model (<xref ref-type="bibr" rid="bib62">Tickle, 2012</xref>).</p><p>To calculate RSCC, we must first determine which density map voxels belong to the ligand. We created a mask around the coordinates of the full qFit-ligand ensemble, and only the density values under this mask’s footprint are extracted for the calculation. The same mask is used to calculate the RSCC of the input (single-conformer) model versus the qFit-ligand model.</p><p>Code for calculating RSCC is available on our GitHub repository.</p></sec><sec id="s4-7-3"><title>EDIAm</title><p>EDIA is a method for estimating the electron density support for an individual atom in a density map. This is determined by sampling grid points <inline-formula><alternatives><mml:math id="inf15"><mml:mi>p</mml:mi></mml:math><tex-math id="inft15">\begin{document}$p$\end{document}</tex-math></alternatives></inline-formula> in a sphere around the atom of interest <inline-formula><alternatives><mml:math id="inf16"><mml:mi>a</mml:mi></mml:math><tex-math id="inft16">\begin{document}$a$\end{document}</tex-math></alternatives></inline-formula>, and calculating the weighting factor, an ownership value, and the density score (<xref ref-type="bibr" rid="bib40">Meyder et al., 2017</xref>).<disp-formula id="equ10"><alternatives><mml:math id="m10"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mi mathvariant="normal">E</mml:mi><mml:mi mathvariant="normal">D</mml:mi><mml:mi mathvariant="normal">I</mml:mi><mml:mi mathvariant="normal">A</mml:mi></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mi>f</mml:mi><mml:mn>0</mml:mn><mml:mo>−</mml:mo><mml:mi>f</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mover><mml:mrow><mml:mi>w</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mspace width="thinmathspace"/><mml:mi>o</mml:mi><mml:mspace width="thinmathspace"/><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:munder><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mi>f</mml:mi><mml:mn>0</mml:mn><mml:mo>−</mml:mo><mml:mi>f</mml:mi><mml:mi>c</mml:mi><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mi>w</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:mrow><mml:mi>w</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mstyle></mml:mrow></mml:mstyle></mml:math><tex-math id="t10">\begin{document}$$\displaystyle  {\rm EDIA}(a)=\frac{\sum\limits^{p\in M_{2f0-fc}}{w(p,a)\,o\,(p,a)z(p)} }{\sum\limits_{p\in M_{2f0-fc|w(p,a)&gt;0}}{w(p,a)}}$$\end{document}</tex-math></alternatives></disp-formula></p><p>The distance-dependent weighting factor <inline-formula><alternatives><mml:math id="inf17"><mml:mi>ω</mml:mi><mml:mo>(</mml:mo><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>a</mml:mi><mml:mo>)</mml:mo></mml:math><tex-math id="inft17">\begin{document}$\omega \left (p,a\right)$\end{document}</tex-math></alternatives></inline-formula> distinguishes between meaningful and excess electron density near atom <inline-formula><alternatives><mml:math id="inf18"><mml:mi>a</mml:mi></mml:math><tex-math id="inft18">\begin{document}$a$\end{document}</tex-math></alternatives></inline-formula>, assigning negative weights to density located outside the atom’s expected region. The ownership function <inline-formula><alternatives><mml:math id="inf19"><mml:mi>o</mml:mi><mml:mo>(</mml:mo><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mi>a</mml:mi><mml:mo>)</mml:mo></mml:math><tex-math id="inft19">\begin{document}$o\left (p,a\right)$\end{document}</tex-math></alternatives></inline-formula> allocates each grid point <inline-formula><alternatives><mml:math id="inf20"><mml:mi>p</mml:mi></mml:math><tex-math id="inft20">\begin{document}$p$\end{document}</tex-math></alternatives></inline-formula> to one or more atoms, determining which parts of the map are attributed to which atoms. The density score <inline-formula><alternatives><mml:math id="inf21"><mml:mi>z</mml:mi><mml:mo>(</mml:mo><mml:mi>p</mml:mi><mml:mo>)</mml:mo></mml:math><tex-math id="inft21">\begin{document}$z\left (p\right)$\end{document}</tex-math></alternatives></inline-formula> for an atom <inline-formula><alternatives><mml:math id="inf22"><mml:mi>a</mml:mi></mml:math><tex-math id="inft22">\begin{document}$a$\end{document}</tex-math></alternatives></inline-formula> is then computed as follows:<disp-formula id="equ11"><alternatives><mml:math id="m11"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>z</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mtable columnalign="left left" rowspacing="4pt" columnspacing="1em"><mml:mtr><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:mtext>if </mml:mtext><mml:mfrac><mml:mrow><mml:mi>ρ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mi>σ</mml:mi></mml:mfrac><mml:mo>&lt;</mml:mo><mml:mn>0.0</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mfrac><mml:mrow><mml:mi>ρ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mi>σ</mml:mi></mml:mfrac></mml:mtd><mml:mtd><mml:mtext>if </mml:mtext><mml:mn>0</mml:mn><mml:mo>≤</mml:mo><mml:mfrac><mml:mrow><mml:mi>ρ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mi>σ</mml:mi></mml:mfrac><mml:mo>≤</mml:mo><mml:mi>ζ</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>ζ</mml:mi></mml:mtd><mml:mtd><mml:mtext>if </mml:mtext><mml:mfrac><mml:mrow><mml:mi>ρ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mi>σ</mml:mi></mml:mfrac><mml:mo>&gt;</mml:mo><mml:mi>ζ</mml:mi></mml:mtd></mml:mtr></mml:mtable><mml:mo fence="true" stretchy="true" symmetric="true"/></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle></mml:math><tex-math id="t11">\begin{document}$$\displaystyle  z(p)=\left\{ \begin{array}{ll} 0 &amp; \text{if } \frac{\rho(p) - \mu}{\sigma} &lt; 0.0 \\ \frac{\rho(p) - \mu}{\sigma} &amp; \text{if } 0 \leq \frac{\rho(p) - \mu}{\sigma} \leq \zeta \\ \zeta &amp; \text{if } \frac{\rho(p) - \mu}{\sigma} &gt; \zeta \end{array} \right.$$\end{document}</tex-math></alternatives></disp-formula></p><p>where <inline-formula><alternatives><mml:math id="inf23"><mml:mi>ζ</mml:mi><mml:mo>=</mml:mo><mml:mn>1.2</mml:mn></mml:math><tex-math id="inft23">\begin{document}$\zeta =1.2$\end{document}</tex-math></alternatives></inline-formula>, <inline-formula><alternatives><mml:math id="inf24"><mml:mi>ρ</mml:mi><mml:mo>(</mml:mo><mml:mi>p</mml:mi><mml:mo>)</mml:mo></mml:math><tex-math id="inft24">\begin{document}$\rho \left (p\right)$\end{document}</tex-math></alternatives></inline-formula> represents the density at grid point <inline-formula><alternatives><mml:math id="inf25"><mml:mi>p</mml:mi></mml:math><tex-math id="inft25">\begin{document}$p$\end{document}</tex-math></alternatives></inline-formula>, <italic>µ</italic> is the mean of the <inline-formula><alternatives><mml:math id="inf26"><mml:msub><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mi>f</mml:mi><mml:mi>o</mml:mi><mml:mo>−</mml:mo><mml:mi>f</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:math><tex-math id="inft26">\begin{document}$2_{fo- fc}$\end{document}</tex-math></alternatives></inline-formula> map, and <inline-formula><alternatives><mml:math id="inf27"><mml:mi>σ</mml:mi></mml:math><tex-math id="inft27">\begin{document}$\sigma $\end{document}</tex-math></alternatives></inline-formula> is the root mean square of the <inline-formula><alternatives><mml:math id="inf28"><mml:msub><mml:mrow><mml:mn>2</mml:mn></mml:mrow><mml:mrow><mml:mi>f</mml:mi><mml:mi>o</mml:mi><mml:mo>−</mml:mo><mml:mi>f</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:math><tex-math id="inft28">\begin{document}$2_{fo- fc}$\end{document}</tex-math></alternatives></inline-formula> map. To quantify the fit of an entire molecule to the electron density map (EDIAm), the EDIA score is first computed for each atom individually and then combined across all atoms in the ligand. Code for calculating EDIAm is available on our GitHub repository.</p></sec><sec id="s4-7-4"><title>RMSD</title><p>RMSD is a widely used metric in structural biology for comparing molecular conformations. It measures the average distance between corresponding atoms of two superimposed structures and is valuable for assessing differences in conformers, protein structures, and ligand poses.</p><p>The RMSD between two sets of atomic coordinates is calculated using the formula:<disp-formula id="equ12"><alternatives><mml:math id="m12"><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mi>R</mml:mi><mml:mi>M</mml:mi><mml:mi>S</mml:mi><mml:mi>D</mml:mi><mml:mo>=</mml:mo><mml:msqrt><mml:mfrac><mml:mn>1</mml:mn><mml:mi>N</mml:mi></mml:mfrac><mml:munderover><mml:mo movablelimits="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi></mml:mrow></mml:munderover><mml:mo stretchy="false">[</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>y</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>−</mml:mo><mml:msubsup><mml:mi>y</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>z</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>−</mml:mo><mml:msubsup><mml:mi>z</mml:mi><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo></mml:msqrt></mml:mstyle></mml:mrow></mml:mstyle></mml:math><tex-math id="t12">\begin{document}$$\displaystyle  RMSD=\sqrt{\frac{1}{N}\sum\limits_{i=1}^{N} [(x^{(1)}_{i} +x^{(2)}_{i} )+(y^{(1)}_{i} -y^{(2)}_{i})+(z^{(1)}_{i} -z^{(2)}_{i})] } $$\end{document}</tex-math></alternatives></disp-formula></p><p>where <inline-formula><alternatives><mml:math id="inf29"><mml:mi>N</mml:mi></mml:math><tex-math id="inft29">\begin{document}$N$\end{document}</tex-math></alternatives></inline-formula> is the number of atoms, and <inline-formula><alternatives><mml:math id="inf30"><mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>)</mml:mo></mml:math><tex-math id="inft30">\begin{document}$\left (x_{i}^{\left (1\right)},y_{i}^{\left (1\right)},z_{i}^{\left (1\right)}\right)$\end{document}</tex-math></alternatives></inline-formula> and <inline-formula><alternatives><mml:math id="inf31"><mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>2</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi>y</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>2</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mn>2</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:msubsup><mml:mo>)</mml:mo></mml:math><tex-math id="inft31">\begin{document}$\left (x_{i}^{\left (2\right)},y_{i}^{\left (2\right)},z_{i}^{\left (2\right)}\right)$\end{document}</tex-math></alternatives></inline-formula> are the coordinates of the <italic>i</italic>th atom in the two conformers.</p><p>Code for calculating the RMSD between two conformers of a ligand is available on our GitHub repository.</p></sec></sec><sec id="s4-8"><title>Torsion strain</title><p>To calculate molecular strain, we take advantage of software available at <ext-link ext-link-type="uri" xlink:href="https://tldr.docking.org/">https://tldr.docking.org/</ext-link> <xref ref-type="bibr" rid="bib25">Gu et al., 2021</xref>.</p><p>The TLDR software employs a statistical method based on torsion patterns observed in crystal structures. It identifies all torsions in an input molecule, where each pattern consists of a sequence of four atoms forming a dihedral angle. These patterns are compared against a pre-compiled library of torsion energies sourced from the CSD and PDB.</p><p>For each torsion pattern, the software retrieves a histogram of observed dihedral angles and their associated energies. The dihedral angle of the molecule’s conformation is matched to this histogram, and the corresponding energy is determined. This process is repeated for all torsion patterns in the molecule, and the total strain energy is calculated by summing the individual torsion energies.</p></sec><sec id="s4-9"><title>Generating a synthetic dataset</title><p>To create our synthetic dataset, we constructed four multiconformer ligands using COOT (<xref ref-type="bibr" rid="bib19">Emsley et al., 2010</xref>). We generated five new PDB files for each ligand, varying the occupancy between the two conformers in the ratios: 0.50/0.50, 0.40/0.60, 0.30/0.70, 0.20/0.80, and 0.10/0.90. These files represent different relative populations of the conformers. For each of these ligand models, we produced a series of electron density maps covering resolutions from 0.8 to 2.5 Å, with increments of 0.1 Å using <italic>phenix.fmodel</italic>. This process involves the following steps.</p><p>For each given ligand input coordinate file, the script adjusts the B-factors, or temperature factors, of ligand atoms based on the specified resolution. As the resolution degrades from 0.8 to 2.5 Å, the B-factors incrementally increase. This adjustment models the increased positional uncertainty of atoms that typically occurs at lower resolutions. The modified ligand structures with these adjusted B-factors at each resolution level are saved as new PDB files. Following this, the script utilizes <italic>phenix.fmodel</italic> to calculate theoretical structure factors from each altered atomic model. These structure factors are then used to compute synthetic electron density maps. To each of these maps, we generate and add random Gaussian noise values scaled proportionally to the resolution. This scaling reflects the escalation of experimental noise as resolution deteriorates, a common occurrence in real-life crystallographic data.</p><p><italic>phenix.fmodel</italic> is used with the following parameters:</p><list list-type="simple" id="list12"><list-item><p>phenix.fmodel input_pdb_file.pdb k_sol=0.4 b_sol=45 high_resolution=&lt;resolution &gt; r_free_flags_fraction=0.05 output.file_name = output_file.mtz.</p></list-item></list><p>The full script is available at: <ext-link ext-link-type="uri" xlink:href="https://github.com/fraser-lab/qFit_biological_testset">https://github.com/fraser-lab/qFit_biological_testset</ext-link> (copy archived at <xref ref-type="bibr" rid="bib47">Ravikumar and Wankowicz, 2024</xref>).</p></sec><sec id="s4-10"><title>X-ray crystallography</title><p>Mac1 crystals (P43 construct, residues 3–169) were grown by sitting-drop vapor diffusion in 28% wt/vol 570 polyethylene glycol 3000 and 100 mM <italic>N</italic>-cyclohexyl-2-aminoethanesulfonic acid pH 9.5 as described previously (<xref ref-type="bibr" rid="bib22">Gahbauer et al., 2023</xref>; <xref ref-type="bibr" rid="bib53">Schuller et al., 2021</xref>). Compounds prepared in DMSO (100 mM) were added to crystal drops using an Echo 650 acoustic dispenser (final concentration of 10 mM) (<xref ref-type="bibr" rid="bib12">Collins et al., 2017</xref>). Crystals were incubated at room temperature for 2–4 hr prior to vitrification in liquid nitrogen without additional cryoprotection. X-ray diffraction data were collected at the Advanced Light Source (ALS beamline 8.3.1) or the Stanford Synchrotron Light Source (SSRL beamline 9–2). Data were indexed, integrated, and scaled with XDS (<xref ref-type="bibr" rid="bib31">Kabsch, 2010</xref>) and merged with Aimless (<xref ref-type="bibr" rid="bib21">Evans and Murshudov, 2013</xref>). The P43 Mac1 crystals contain two copies of the protein in the asymmetric unit (chains A and B). The active site of chain A is open; however chain B is blocked by a crystal contact. We previously observed that potent Mac1 inhibitors dissolve crystals, likely through the displacement of the B chain crystal contact (<xref ref-type="bibr" rid="bib22">Gahbauer et al., 2023</xref>). In addition, crystal packing in the chain A active site restricts movement of the Ala129–Gly134 loop, leading to decreased occupancy for compounds with substituents on the pyrrolidinone. To aid modeling the resulting conformational and compositional disorder, we used the PanDDA method (<xref ref-type="bibr" rid="bib44">Pearce et al., 2017</xref>) to model ligands where the occupancy was low (&lt;25%) or where there was substantial disorder. After modeling ligands, structures were refined using phenix.refine (<xref ref-type="bibr" rid="bib35">Liebschner et al., 2019</xref>) as described previously (<xref ref-type="bibr" rid="bib22">Gahbauer et al., 2023</xref>). Data collection settings and statistics are reported in <xref ref-type="supplementary-material" rid="supp6">Supplementary file 6, table 6</xref>.</p></sec><sec id="s4-11"><title>Chemical synthesis</title><p>Unless otherwise noted, all chemical reagents and solvents used are commercially available. Air and/or moisture-sensitive reactions were carried out under an argon atmosphere in oven-dried glassware using anhydrous solvents from commercial suppliers. Air and/or moisture-sensitive reagents were transferred via syringe or cannula and were introduced into reaction vessels through rubber septa. Solvent removal was accomplished with a rotary evaporator at ca. 10–50 Torr. Microwave reactions were carried out in a CEM Discover microwave reactor. Chromatography was carried out using the Isolera Four flash chromatography system with Silia<italic>Sep</italic> silica gel cartridges from Silicycle.</p><list list-type="simple" id="list13"><list-item><p>Reverse phase chromatography was carried out on</p></list-item></list><list list-type="order" id="list14"><list-item><p>Waters 2535 Separation module with Waters 2998 Photodiode Array Detector. Separations were carried out on XBridge Preparative C18, 19 × 50 mm column at ambient temperature</p></list-item><list-item><p>Gilson GX-281 instrument column: Xtimate Prep C18, 21.2 × 250 mm, 150 Å, 10 μm particle size.</p></list-item></list><list list-type="simple" id="list15"><list-item><p>LC/MS data were acquired on</p></list-item></list><list list-type="order" id="list16"><list-item><p>Waters Acquity UPLC QDa mass spectrometer equipped with Quaternary Solvent Manager, Photodiode Array Detector, and Evaporative Light Scattering Detector. Separations were carried out with Acquity UPLCÒ BEH C18 1.7 mm, 2.1 × 50 mm column at 25°C, using a mobile phase of water-acetonitrile containing a constant 0.1% formic acid.</p></list-item><list-item><p>Agilent 1200 Infinity LC with an Agilent 1956 single quadrupole MS using electrospray ionization: Column: SunFire C18 (4.6 × 50 mm, 3.5 um), Mobile phase: H<sub>2</sub>O (10 mmol NH<sub>4</sub>HCO<sub>3</sub>) (A) / ACN (B), Elution program: Gradient from 10 to 95% of B in 1.5 min at 1.8 ml/min, Temperature: 50°C, Detection: UV (214, 254 nm) and MS (ESI, POS mode, 103–100 amu).</p></list-item></list><p>Chemical shifts are reported in d units (ppm). NMR spectra were referenced relative to residual NMR solvent peaks. Coupling constants (<italic>J</italic>) are reported in hertz (Hz). NMR spectra were recorded on Bruker Avance III HD 400 MHz spectrometer or Bruker 500 MHz spectrometer.</p></sec><sec id="s4-12"><title>4-Chloro-9<italic>H</italic>-pyrimido[4,5-<italic>b</italic>]indol-8-amine</title><p>A solution of 3-fluoro-2-nitroaniline (11 g, 70.51 mmol) in acetic anhydride (20 ml) was stirred at room temperature for 16 hr. The reaction mixture was filtered, and the solids were washed with petroleum ether (100 ml) and dried to obtain 10.7 g (77%) of <italic>N</italic>-(3-fluoro-2-nitrophenyl)acetamide as a brown solid. LC–MS (ESI): <italic>m</italic>/<italic>z</italic> = 199.3 (M+H)<sup>+</sup>.</p><p>To a solution of <italic>N</italic>-(3-fluoro-2-nitrophenyl)acetamide (10.7 g, 54.04 mmol) in DMF (100 ml) was added methyl 2-isocyanoacetate (8.02 g, 81.06 mmol) and potassium carbonate (14.92 g, 108.08 mmol). After stirring at 80°C for 2 hr, the reaction mixture was cooled to room temperature, acidified with 2 N HCl (ca. 2000 ml), and extracted with ethyl acetate (300 ml *3). The combined organic layers were washed with brine (100 ml), dried over sodium sulfate, and concentrated under reduced pressure. The residue was purified by silica gel chromatography (10:1 petroleum ether/ethyl acetate) to obtain 11 g (73%) of methyl 2-(3-acetamido-2-nitrophenyl)-2-isocyanoacetate as a yellow solid. LC–MS (ESI): <italic>m</italic>/<italic>z</italic> = 278.2 (M+H)<sup>+</sup>.</p><p>To a solution of methyl 2-(3-acetamido-2-nitrophenyl)-2-isocyanoacetate (11 g, 39.71 mmol) in <italic>glacial</italic> acetic acid (100 ml), was added slowly zinc dust (25.81 g, 397.10 mmol) in two portions. After stirring at 60°C for 2 hr, the reaction mixture was cooled to room temperature, filtered, and washed with THF. The filtrate was concentrated under reduced pressure and purified by silica gel chromatography (10:1 dichloromethane/methanol) to obtain 6.2 g (63%) of methyl 7-acetamido-2-amino-1<italic>H</italic>-indole-3-carboxylate as a yellow solid. LC–MS (ESI): <italic>m</italic>/<italic>z</italic> = 248.3 (M+H)<sup>+</sup>.</p><p>A solution of methyl 7-acetamido-2-amino-1<italic>H</italic>-indole-3-carboxylate (6.2 g, 25.10 mmol) in formamide (450 ml) was stirred at 220°C for 2 hr. The reaction mixture was then cooled to room temperature and poured in 100 ml of water. The resulting mixture was allowed to stand for 15 min before the solids were collected by filtration, washed with water, and dried to obtain 4.1 g of a 1:2 mixture of <italic>N</italic>-(4-hydroxy-9H-pyrimido[4,5-<italic>b</italic>]indol-8-yl)acetamide and <italic>N</italic>-(4-hydroxy-9<italic>H</italic>-pyrimido[4,5-<italic>b</italic>]indol-8-yl)formamide. This mixture was taken in methanol (25 ml) and aqueous 12 N NaOH (25 ml). After stirring at 60°C for 16 hr, the reaction mixture was then cooled to room temperature, concentrated under reduced pressure to remove methanol, and the residue was poured into 100 ml of water. The resulting mixture was allowed to stand for 15 min before the solids were collected by filtration, washed with water, and dried to obtain 3.5 g (70%) of 8-amino-9<italic>H</italic>-pyrimido[4,5-<italic>b</italic>]indol-4-ol as a brown solid. LC–MS (ESI): <italic>m</italic>/<italic>z</italic> = 201.2 (M+H)<sup>+</sup>.</p><p>A solution of 8-amino-9H-pyrimido[4,5-<italic>b</italic>]indol-4-ol (3.5 g, 17.5 mmol) in formamide (30 ml) was stirred at 150°C. After 6 hr, the reaction mixture was cooled to room temperature and poured into water (200 ml). The resulting mixture was allowed to stand for 15 min before the solids were collected by filtration, washed with water, and dried to obtain 3.5 g (88%) of <italic>N</italic>-(4-hydroxy-9<italic>H</italic>-pyrimido[4,5-<italic>b</italic>]indol-8-yl)formamide as a brown solid. LC–MS (ESI): <italic>m</italic>/<italic>z</italic> = 229.2 (M+H)<sup>+</sup>.</p><p>To a solution of <italic>N</italic>-(4-hydroxy-9<italic>H</italic>-pyrimido[4,5-<italic>b</italic>]indol-8-yl)formamide (3.5 g, 15.35 mmol) in phosphorus oxychloride (30 ml) was added <italic>N</italic>,<italic>N</italic>-diiisopropylethylamine (5.94 g, 46.05 mmol). After refluxing for 16 hr, the reaction mixture was cooled to room temperature, concentrated, and poured into water (20 ml). The resulting solid was filtered to obtain 500 mg of a mixture of <italic>N</italic>-(4-chloro-9<italic>H</italic>-pyrimido[4,5-<italic>b</italic>]indol-8-yl)formamide and 4-chloro-9<italic>H</italic>-pyrimido[4,5-<italic>b</italic>]indol-8-amine as a black solid. This mixture was taken in 4 N HCl in dioxane (15 ml). After stirring at room temperature for 4 hr, the reaction mixture was concentrated under reduced pressure, and the residue was adjusted to pH 7 with aq.Na<sub>2</sub>CO<sub>3</sub>, and extracted with EA (3 × 30 ml). The organic layers were dried over sodium sulfate, concentrated under reduced pressure, and the residue was purified by reverse phase chromatography (water/acetonitrile/0.1% ammonium bicarbonate) to obtain 320 mg (10%) of 4-chloro-9<italic>H</italic>-pyrimido[4,5-<italic>b</italic>]indol-8-amine as a white solid. <sup>1</sup>H NMR (500 MHz, DMSO) δ 12.42 (s, 1H), 8.74 (s, 1H), 7.58 (d, <italic>J</italic> = 7.8 Hz, 1H), 7.25–7.08 (m, 1H), 6.93 (d, <italic>J</italic> = 7.7 Hz, 1H), 5.76 (s, 2H). LC–MS (ESI): <italic>m</italic>/<italic>z</italic> = 219.2 (M+H)<sup>+</sup>.</p></sec><sec id="s4-13"><title>AVI-4197/RLA-5830</title><p>To a solution of <italic>N</italic>-(4-chloro-9<italic>H</italic>-pyrimido[4,5-<italic>b</italic>]indol-8-yl)formamide and 4-chloro-9<italic>H</italic>-pyrimido[4,5-<italic>b</italic>]indol-8-amine (110 mg, 0.447 mmol), (<italic>R</italic>)-valinol (69.01 mg, 0.67 mmol) in DMSO (2 ml) was added triethylamine (171.6 mg, 1.41 mmol). After stirring at 100°C for 16 hr, the reaction mixture was extracted with ethyl acetate (3 × 20 ml), washed with brine (20 ml). The organic layer was dried over Na<sub>2</sub>SO<sub>4</sub>. The organic extracts were concentrated, and the residue was purified by silica gel column chromatography (50% ethyl acetate/petroleum ether) to obtain (<italic>R</italic>)-<italic>N</italic>-(4-((1-hydroxy-3-methylbutan-2-yl)amino)-9<italic>H</italic>-pyrimido[4,5-<italic>b</italic>]indol-8-yl)formamide as a white solid (45 mg, yield: 15.2%). LC–MS (ESI): <italic>m</italic>/<italic>z</italic> = 314.3 (M+H)<sup>+</sup>; RT = 1.30 min.</p><p>A solution of (<italic>R</italic>)-<italic>N</italic>-(4-((1-hydroxy-3-methylbutan-2-yl)amino)-9<italic>H</italic>-pyrimido[4,5-<italic>b</italic>]indol-8-yl)formamide (40 mg, 0.13 mmol) in HCl-dioxane (15 ml) was stirred at room temperature for 4 hr. The mixture was adjusted to pH 7 with aq.Na<sub>2</sub>CO<sub>3</sub>, and extracted with ethyl acetate (3 × 30 ml). The organic layer was dried over Na<sub>2</sub>SO<sub>4</sub>, the organic was concentrated and the residue was purified by reverse phase chromatography (0.1% NH<sub>4</sub>HCO<sub>3</sub> in water, 10–100% ACN) to obtain (<italic>R</italic>)-2-((8-amino-9<italic>H</italic>-pyrimido[4,5-<italic>b</italic>]indol-4-yl)amino)-3-methylbutan-1-ol (AVI-4197) as a white solid (28.1 mg, yield: 70.52%). <sup>1</sup>H NMR (500 MHz, MeOD) δ 8.27 (s, 1H), 7.38 (d, <italic>J</italic> = 7.8 Hz, 1H), 7.12 (t, <italic>J</italic> = 7.8 Hz, 1H), 6.82 (d, <italic>J</italic> = 7.7 Hz, 1H), 4.30–4.26 (m, 1H), 3.88 (dd, <italic>J</italic> = 11.3, 4.8 Hz, 1H), 3.80 (dd, <italic>J</italic> = 11.3, 4.0 Hz, 1H), 2.17 (d, <italic>J</italic> = 7.1 Hz, 1H), 1.06 (dd, <italic>J</italic> = 15.1, 6.8 Hz, 6H). LC–MS (ESI): <italic>m</italic>/<italic>z</italic> 286.3 (M+H)<sup>+</sup>.</p></sec><sec id="s4-14"><title>AVI-3367/RLA-5721</title><p>A mixture of 4-chloro-9<italic>H</italic>-pyrimido[4,5-<italic>b</italic>]indol-8-amine (28 mg, 0.13 mmol) and 1-aminopyrrolidin-2-one hydrochloride (35 mg, 0.26 mmol) in isopropanol/water (10:1, 1.1 ml) was heated to 100°C for 18 hr. The reaction mixture was filtered, the residue was washed with ethyl acetate and dried to obtain 28 mg (77%) of 1-((8-amino-9<italic>H</italic>-pyrimido[4,5-<italic>b</italic>]indol-4-yl)amino)pyrrolidin-2-one as brown solid. <sup>1</sup>H NMR (DMSO-<italic>d</italic><sub>6</sub>, 400 MHz) δ 12.99 (br s, 1H), 8.62 (s, 1H), 7.92 (br d, 1H, <italic>J</italic> = 7.5 Hz), 7.27 (t, 1H, <italic>J</italic> = 7.9 Hz), 7.05 (br d, 1H, <italic>J</italic> = 7.5 Hz), 3.70 (br t, 2H, <italic>J</italic> = 6.9 Hz), 2.44–2.53 (m, 2H), 2.20 (br t, 2H, <italic>J</italic> = 7.4 Hz). <sup>13</sup>C NMR (METHANOL-d<sub>4</sub>, 100 MHz) δ 175.9, 155.9, 154.3, 153.2, 132.5, 125.7, 121.9, 119.4, 111.3, 111.1, 97.0, 48.6, 47.9, 28.5, 15.9. LC–MS (ESI): <italic>m</italic>/<italic>z</italic> = 283 (M+H)<sup>+</sup>.</p><p>To a solution of 1-((8-amino-9<italic>H</italic>-pyrimido[4,5-<italic>b</italic>]indol-4-yl)amino)pyrrolidin-2-one (15 mg, 0.053 mmol) and triethylamine (0.015 ml, 0.11 mmol) in THF (1 ml), was added ethyl chloroformate (0.005 ml, 0.056 mmol). After stirring at 65°C for 18 hr, the reaction mixture was purified by reverse phase chromatography (water/acetonitrile/0.1% formic acid) to obtain 2.7 mg (13%) of ethyl (4-((2-oxopyrrolidin-1-yl)amino)-9<italic>H</italic>-pyrimido[4,5-<italic>b</italic>]indol-8-yl)carbamate formic acid salt (AVI-3367) as tan solid. <sup>1</sup>H NMR (METHANOL-d<sub>4</sub>, 400 MHz) δ 8.42 (s, 1H), 7.94 (d, 1H, <italic>J</italic> = 7.8 Hz), 7.59 (br s, 1H), 7.28 (t, 1H, <italic>J</italic> = 7.9 Hz), 4.1–4.26–4.30 (m, 2H), 3.84 (t, 2H, <italic>J</italic> = 7.1 Hz), 2.60 (t, 2H, <italic>J</italic> = 8.0 Hz), 2.30–2.33 (m, 2H), 1.36–1.39 (m, 3H). LC–MS (ESI): <italic>m</italic>/<italic>z</italic> = 355 (M+H)<sup>+</sup>.</p></sec><sec id="s4-15"><title>(<italic>R</italic>)-2-((6-Bromo-7<italic>H</italic>-pyrrolo[2,3-<italic>d</italic>]pyrimidin-4-yl)amino)-3-methylbutan-1-ol</title><p>To a solution of 6-bromo-4-chloro-7<italic>H</italic>-pyrrolo[2,3-<italic>d</italic>]pyrimidine (900 mg, 3.9 mmol) in dry DMSO (10 ml) was added (<italic>R</italic>)-2-amino-3-methylbutan-1-ol (602 mg, 5.8 mmol) and TEA (787 mg, 7.8 mmol), the mixture was stirred at 110°C for 16 hr. LC–MS analysis showed the complete consumption of compound 6-bromo-4-chloro-7<italic>H</italic>-pyrrolo[2,3-<italic>d</italic>]pyrimidine. The mixture was diluted with ethyl acetate (40.0 ml) and washed with water (5.0 ml) and brine (5.0 ml). The organic layer was dried over Na<sub>2</sub>SO<sub>4</sub> and concentrated under reduced pressure. The residue was purified by prep-HPLC (0.1% NH<sub>4</sub>HCO<sub>3</sub> in water, 10–100% ACN) to give (<italic>R</italic>)-2-((6-bromo-7<italic>H</italic>-pyrrolo[2,3-<italic>d</italic>]pyrimidin-4-yl)amino)-3-methylbutan-1-ol as a white solid (522 mg, yield: 45%). <sup>1</sup>H NMR (500 MHz, DMSO-<italic>d</italic><sub>6</sub>) δ 12.22 (s, 1H), 8.03 (s, 1H), 7.00 (d, 1H, <italic>J</italic> = 8.8 Hz), 6.79 (s, 1H), 4.62 (t, 1H, <italic>J</italic> = 5.2 Hz), 4.13 (s, 1H), 3.52 (dd, 2H, <italic>J</italic> = 9.4, 4.0 Hz), 1.98 (dt, 1H, <italic>J</italic> = 13.6, 6.8 Hz), 0.91 (dd, 6 H, <italic>J</italic> = 8.6, 6.9 Hz). LC–MS (ESI): <italic>m</italic>/<italic>z</italic> = 299.2 (M+H)<sup>+</sup>.</p></sec><sec id="s4-16"><title>AVI-4099 (RLA-5789)</title><p>A mixture of (<italic>R</italic>)-2-((6-bromo-7<italic>H</italic>-pyrrolo[2,3-<italic>d</italic>]pyrimidin-4-yl)amino)-3-methylbutan-1-ol (10.0 mg, 33.4 μmol), 5-(4,4,5,5-tetramethyl-1,3,2-dioxaborolan-2-yl)-1<italic>H</italic>-pyrazole (13.0 mg, 66.9 μmol), Pd(dppf)Cl<sub>2</sub> (4.9 mg, 6.7 μmol) and CsOH (12.5 mg, 83.6 μmol) in 0.25 ml of mixed solvent (<italic><sup>n</sup></italic>BuOH/H<sub>2</sub>O = 4/1) was stirred at 130°C for 20 min with microwave. The residue was purified by prep-HPLC (water, 0–30% ACN with 0.1% formic acid) to give (<italic>R</italic>)-2-((6-(1<italic>H</italic>-pyrazol-5-yl)-7<italic>H</italic>-pyrrolo[2,3-<italic>d</italic>]pyrimidin-4-yl)amino)-3-methylbutan-1-ol, formic acid salt (AVI-4099) as a white solid (3.7 mg, yield: 39%). <sup>1</sup>H NMR (400 MHz, MeOD) (mixture of rotamers was observed) δ 8.42 (brs, 1H), 8.12 (brs, 1H), 7.73 (d, 1H, <italic>J</italic> = 2.3 Hz), 6.97 (s, 1H), 6.72 (d, 1H, <italic>J</italic> = 2.3 Hz), 4.16–4.11 (m, 1H), 3.84–3.75 (m, 2H), 2.16–2.06 (m, 1H), 1.09–1.02 (m, 6H). LC–MS (ESI): <italic>m</italic>/<italic>z</italic> = 287 (M+H)<sup>+</sup>.</p></sec><sec id="s4-17"><title>AVI-4211 (RLA-5849)</title><p>A mixture of (<italic>R</italic>)-2-((6-bromo-7<italic>H</italic>-pyrrolo[2,3-<italic>d</italic>]pyrimidin-4-yl)amino)-3-methylbutan-1-ol (15.0 mg, 50.1 μmol), phenylboronic acid (12.2 mg, 100.0 μmol), Pd(dppf)Cl<sub>2</sub> (3.7 mg, 5.01 μmol), and Cs<sub>2</sub>CO<sub>3</sub> (40.8 mg, 125 μmol) in 0.22 ml of mixed solvent (dioxane/H<sub>2</sub>O = 10/1) was stirred at 110°C for 17 hr. The residue was purified by prep-HPLC (water, 0–70% ACN with 0.1% formic acid) to give (<italic>R</italic>)-3-methyl-2-((6-phenyl-7<italic>H</italic>-pyrrolo[2,3-<italic>d</italic>]pyrimidin-4-yl)amino)butan-1-ol, formic acid salt (AVI-4211) as a white solid (9.7 mg, yield: 57%). <sup>1</sup>H NMR (400 MHz, MeOD) (mixture of rotamers was observed) δ 8.41 (brs, 1H), 8.11 (brs, 1H), 7.79 (brd, 1H, <italic>J</italic> = 8.0 Hz), 7.45 (brdd, 2H, <italic>J</italic> = 8.0, 7.5 Hz), 7.33 (brt, 1 H, <italic>J</italic> = 7.5 Hz), 7.03 (brs, 1H), 4.16–4.12 (m, 1H), 3.85–3.75 (m, 2H), 2.15–2.08 (m, 1H), 1.08–1.04 (m, 6H). LC–MS (ESI): <italic>m</italic>/<italic>z</italic> = 297 (M+H)<sup>+</sup>.</p></sec><sec id="s4-18"><title>AVI-372/RLA-5628</title><p>To a solution of 4-chloro-5-iodopyrimidine (400 mg, 1.66 mmol) in acetonitrile (5 ml) was added 1-aminopyrrolidin-2-one hydrochloride (250 mg, 1.84 mmol) and potassium carbonate (460 mg, 3.33 mmol). The reaction mixture was stirred at 80°C for 1 hr. The mixture was added water (15.0 ml) and extracted with ethyl acetate (30 ml *3). The combined organics were washed with brine (10 ml). The organic layer was dried over sodium sulfate and concentrated under reduced pressure. The residue was purified by silica gel column chromatography (10:1 dichloromethane/methanol) to afford 384 mg (76%) of 1-((5-iodopyrimidin-4-yl)amino)pyrrolidin-2-one. LC–MS (ESI): <italic>m</italic>/<italic>z</italic> = 305.</p><p>To a solution of 1-((5-iodopyrimidin-4-yl)amino)pyrrolidin-2-one (20 mg, 0.066 mmol) in 1,4-dioxane (1 ml) was added 2-fluoro-6-(tributylstannyl)pyridine (26 mg, 0.066 mmol), copper (I) iodide (1.3 mg, 0.0066 mmol), triethylamine (0.028 ml, 0.2 mmol) and Pd(PPh<sub>3</sub>)<sub>4</sub>(7.6 mg, 0.0066 mmol). After stirring at 110°C for 18 hr, the reaction mixture was filtered through a celite pad and purified by reverse phase chromatography (water/acetonitrile/0.1% formic acid) to obtain 8 mg (40%) of 1-((5-(6-fluoropyridin-2-yl)pyrimidin-4-yl)amino)pyrrolidin-2-one formic acid salt (AVI-372) as a pale yellow oil. <sup>1</sup>H NMR (METHANOL-d<sub>4</sub>, 400 MHz) δ 8.71 (br s, 1H), 8.65 (br s, 1H), 8.56 (br s, 1H), 8.34 (br s, 1H), 7.66 (t, 1H, <italic>J</italic> = 5.6 Hz), 3.68 (t, 2H, <italic>J</italic> = 7.2 Hz), 2.47 (br t, 2H, <italic>J</italic> = 8.0 Hz), 2.16–2.20 (m, 2H). LC–MS (ESI): <italic>m</italic>/<italic>z</italic> = 274 (M+H)<sup>+</sup>.</p></sec><sec id="s4-19"><title>AVI-411/RLA-5549</title><p>A mixture of 4,6-dichloropyrimidine (100 mg, 0.671 mmol, 1.0 equiv), tert-Butyl 5-amino-1<italic>H</italic>-indazole-1-carboxylate (157 mg, 0.671 mmol, 1.0 equiv) and NEt<sub>3</sub> (196 µl, 1.41 mmol, 2.1 equiv) in i-PrOH (3 ml) was stirred in the microwave at 100°C for 20 min. The reaction mixture was cooled and evaporated under reduced pressure. The residue was diluted with saturated NaHCO<sub>3</sub> solution (20 ml) and extracted with EtOAc (3 × 20 ml). The combined organic extracts were washed with water (2 × 20 ml), brine (1 × 40 ml), dried (MgSO<sub>4</sub>), filtered and purified by silica gel chromatography (0–5% MeOH/DCM) to obtain 30.8 mg (19%) of <italic>N</italic>-(6-chloropyrimidin-4-yl)-1<italic>H</italic>-indazol-5-amine as a light yellow solid.</p><p>A mixture of <italic>N</italic>-(6-chloropyrimidin-4-yl)-1<italic>H</italic>-indazol-5-amine (30 mg, 0.12 mmol, 1.0 equiv) and 1-aminopyrrolidin-2-one hydrochloride (17 mg, 0.12 mmol, 1.0 equiv) in i-PrOH (0.4 ml) was stirred in the microwave at 100°C for 20 min. The reaction mixture was cooled and evaporated under reduced pressure. The residue was diluted with saturated NaHCO<sub>3</sub> solution (20 ml) and extracted with EtOAc (3 × 20 ml). The combined organic extracts were washed with water (2 × 20 ml), brine (1 × 40 ml), dried (MgSO<sub>4</sub>), filtered and purified by reverse phase chromatography (water/MeCN/0.1% formic acid) to obtain 8.1 mg (21%) of 1-((6-((1<italic>H</italic>-indazol-5-yl)amino)pyrimidin-4-yl)amino)pyrrolidin-2-one as a colorless oil. <sup>1</sup>H NMR (METHANOL-d<sub>4</sub>, 400 MHz) δ 8.14 (s, 1H), 8.03 (s, 1H), 7.84 (d, 1H, <italic>J</italic> = 1.7 Hz), 7.56 (d, 1H, <italic>J</italic> = 8.8 Hz), 7.39 (dd, 1H, <italic>J</italic> = 1.8, 8.9 Hz), 5.84 (s, 1H), 3.63 (t, 2H, <italic>J</italic> = 7.1 Hz), 2.43–2.48 (m, 2H), 2.15 (t, 2H, <italic>J</italic> = 7.7 Hz). LC–MS (ESI): <italic>m</italic>/<italic>z</italic> = 283 (M+H)<sup>+</sup>.</p></sec><sec id="s4-20"><title>AVI-1495 (RLA-5688)</title><p>A mixture of 5-bromo-4-chloro-7<italic>H</italic>-pyrrolo[2,3-<italic>d</italic>]pyrimidine (15.0 mg, 64.5 μmol), 1-(aminomethyl)cyclopropan-1-ol (13.3 mg, 129.0 μmol) in 0.22 ml of mixed solvent IPA/H<sub>2</sub>O (10:1) was stirred at 100°C for 16 hr. The residue was purified by prep-HPLC (water, 0–40% ACN) to give 1-(((5-bromo-7<italic>H</italic>-pyrrolo[2,3-<italic>d</italic>]pyrimidin-4-yl)amino)methyl)cyclopropan-1-ol (AVI-1495), as a brown solid (6.3 mg, yield: 34%). <sup>1</sup>H NMR (400 MHz, MeOD) δ 8.13 (s, 1H), 7.18 (s, 1H), 3.74 (s, 2H), 0.82–0.78 (m, 2H), 0.74–0.71 (m, 2H). LC–MS (ESI): <italic>m</italic>/<italic>z</italic> = 310 (M+H)<sup>+</sup>.</p></sec><sec id="s4-21"><title>AVI-3571 (RLA-5703)</title><p>A mixture of 4-chloro-5-methyl-7<italic>H</italic>-pyrrolo[2,3-<italic>d</italic>]pyrimidine (15.0 mg, 89.5 μmol), 1-(aminomethyl)cyclobutan-1-ol (18.1 mg, 179.0 μmol) in 0.22 ml of mixed solvent IPA/H<sub>2</sub>O (10:1) was stirred at 100°C for 4 days. The residue was purified by prep-HPLC (water, 0–5% ACN with 0.1% formic acid) to give 1-(((5-methyl-7<italic>H</italic>-pyrrolo[2,3-<italic>d</italic>]pyrimidin-4-yl)amino)methyl)cyclobutan-1-ol (AVI-3571), formic acid salt as a white solid (7.7 mg, yield: 31%). <sup>1</sup>H NMR (400 MHz, MeOD) δ 8.08 (s, 1H), 6.87 (s, 1H), 3.74 (s, 2H), 2.46 (s, 3H), 2.19–2.07 (m, 4H), 1.83–1.75 (m, 1H), 1.70–1.63 (m, 1H). LC–MS (ESI): <italic>m</italic>/<italic>z</italic> = 233 (M+H)<sup>+</sup>.</p></sec><sec id="s4-22"><title>AVI-1507 (RLA-5699)</title><p>To a solution of 4-chloro-7<italic>H</italic>-pyrrolo[2,3-<italic>d</italic>]pyrimidine (70 mg,0.45 mmol) in dry DMSO (5 ml) was added (<italic>R</italic>)-pyrrolidin-2-ylmethanol (51 mg, 0.50 mmol) and TEA (227 mg, 2.25 mmol), the mixture was stirred at 110°C for 16 hr. The mixture was diluted with ethyl acetate (50.0 ml) and washed with water (10.0 ml), brine (10.0 ml). The organic layer was dried over Na<sub>2</sub>SO<sub>4</sub> and concentrated under reduced pressure. The residue was purified by prep-HPLC (0.1% NH<sub>4</sub>HCO<sub>3</sub> in water, 5–45% ACN) to give (<italic>R</italic>)-(1-(7<italic>H</italic>-pyrrolo[2,3-<italic>d</italic>]pyrimidin-4-yl)pyrrolidin-2-yl)methanol (AVI-1507) as a white solid (35 mg, yield: 35%). <sup>1</sup>H NMR (500 MHz, MeOD) δ 8.07 (d, <italic>J</italic> = 5.4 Hz, 1H), 7.08 (d, <italic>J</italic> = 3.6 Hz, 1H), 6.66 (d, <italic>J</italic> = 3.6 Hz, 1H), 4.66–4.44 (m, 1H), 3.93 (d, <italic>J</italic> = 8.8 Hz, 1H), 3.87–3.71 (m, 2H), 3.63 (dd, <italic>J</italic> = 10.9, 6.5 Hz, 1H), 2.21–1.99 (m, 4H). LC–MS (ESI): <italic>m</italic>/<italic>z</italic> = 219.1 (M+H)<sup>+</sup>.</p></sec></sec></body><back><sec sec-type="additional-information" id="s5"><title>Additional information</title><fn-group content-type="competing-interest"><title>Competing interests</title><fn fn-type="COI-statement" id="conf1"><p>No competing interests declared</p></fn><fn fn-type="COI-statement" id="conf2"><p>is a co-founder of TheRas, Elgia Therapeutics, and Tatara Therapeutics, and receives sponsored research support from Merck, Sharp and Dohme</p></fn><fn fn-type="COI-statement" id="conf3"><p>is an employee of Atomwise Inc, but the work in this publication does not overlap with his role there</p></fn><fn fn-type="COI-statement" id="conf4"><p>is a consultant to, shareholder of, and receives sponsored research support from Relay Therapeutics and a consultant to and shareholder of Vilya Therapeutics</p></fn></fn-group><fn-group content-type="author-contribution"><title>Author contributions</title><fn fn-type="con" id="con1"><p>Data curation, Software, Formal analysis, Validation, Investigation, Visualization, Methodology, Writing – original draft, Writing – review and editing</p></fn><fn fn-type="con" id="con2"><p>Software, Methodology, Writing – review and editing</p></fn><fn fn-type="con" id="con3"><p>Data curation, Writing – review and editing</p></fn><fn fn-type="con" id="con4"><p>Data curation, Writing – review and editing</p></fn><fn fn-type="con" id="con5"><p>Data curation, Writing – review and editing</p></fn><fn fn-type="con" id="con6"><p>Project administration, Writing – review and editing</p></fn><fn fn-type="con" id="con7"><p>Software, Writing – review and editing</p></fn><fn fn-type="con" id="con8"><p>Conceptualization, Supervision, Funding acquisition, Writing – original draft, Project administration, Writing – review and editing</p></fn><fn fn-type="con" id="con9"><p>Conceptualization, Software, Formal analysis, Validation, Investigation, Writing – original draft, Project administration, Writing – review and editing</p></fn></fn-group></sec><sec sec-type="supplementary-material" id="s6"><title>Additional files</title><supplementary-material id="mdar"><label>MDAR checklist</label><media xlink:href="elife-103797-mdarchecklist1-v1.pdf" mimetype="application" mime-subtype="pdf"/></supplementary-material><supplementary-material id="supp1"><label>Supplementary file 1.</label><caption><title>Test set PDBs and associated statistics.</title></caption><media xlink:href="elife-103797-supp1-v1.xlsx" mimetype="application" mime-subtype="xlsx"/></supplementary-material><supplementary-material id="supp2"><label>Supplementary file 2.</label><caption><title>High strain PDBs and associated statistics.</title></caption><media xlink:href="elife-103797-supp2-v1.xlsx" mimetype="application" mime-subtype="xlsx"/></supplementary-material><supplementary-material id="supp3"><label>Supplementary file 3.</label><caption><title>Macrocycle PDBs and associated statistics.</title></caption><media xlink:href="elife-103797-supp3-v1.xlsx" mimetype="application" mime-subtype="xlsx"/></supplementary-material><supplementary-material id="supp4"><label>Supplementary file 4.</label><caption><title>Removed Macrocycle PDBs.</title></caption><media xlink:href="elife-103797-supp4-v1.xlsx" mimetype="application" mime-subtype="xlsx"/></supplementary-material><supplementary-material id="supp5"><label>Supplementary file 5.</label><caption><title>Fragment PDBs and associated statistics.</title></caption><media xlink:href="elife-103797-supp5-v1.xlsx" mimetype="application" mime-subtype="xlsx"/></supplementary-material><supplementary-material id="supp6"><label>Supplementary file 6.</label><caption><title>X-ray data collection settings and statistics.</title></caption><media xlink:href="elife-103797-supp6-v1.xlsx" mimetype="application" mime-subtype="xlsx"/></supplementary-material><supplementary-material id="supp7"><label>Supplementary file 7.</label><caption><title>CryoEM PDBs.</title></caption><media xlink:href="elife-103797-supp7-v1.xlsx" mimetype="application" mime-subtype="xlsx"/></supplementary-material></sec><sec sec-type="data-availability" id="s7"><title>Data availability</title><p>All data and code are avaliable in the github: <ext-link ext-link-type="uri" xlink:href="https://github.com/ExcitedStates/qfit-3.0">https://github.com/ExcitedStates/qfit-3.0</ext-link> (copy archived at <xref ref-type="bibr" rid="bib49">Riley et al., 2025</xref>).</p></sec><ack id="ack"><title>Acknowledgements</title><p>This work was supported by a National Institutes of Health NIHGM145238 and Chan Zuckerberg Initiative Essential Open Software grant to JSF and NIH NIAID Antiviral Drug Discovery (AViDD) grant U19AI171110 to JSF, SAW, and ARR. We thank Nigel Moriarty for help with ligand refinement and feedback on the manuscript, Matthew Smith for help with ligand strain calculations, Paul Emsley for clarifications about ligand strain calculations, Seth Harris, Colin Grambow, and Emel Adaligil for feedback on macrocycle fitting and strain.</p></ack><ref-list><title>References</title><ref id="bib1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Afonine</surname><given-names>PV</given-names></name><name><surname>Grosse-Kunstleve</surname><given-names>RW</given-names></name><name><surname>Echols</surname><given-names>N</given-names></name><name><surname>Headd</surname><given-names>JJ</given-names></name><name><surname>Moriarty</surname><given-names>NW</given-names></name><name><surname>Mustyakimov</surname><given-names>M</given-names></name><name><surname>Terwilliger</surname><given-names>TC</given-names></name><name><surname>Urzhumtsev</surname><given-names>A</given-names></name><name><surname>Zwart</surname><given-names>PH</given-names></name><name><surname>Adams</surname><given-names>PD</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Towards automated crystallographic structure refinement with phenix.refine</article-title><source>Acta Crystallographica. Section D, Biological Crystallography</source><volume>68</volume><fpage>352</fpage><lpage>367</lpage><pub-id pub-id-type="doi">10.1107/S0907444912001308</pub-id><pub-id pub-id-type="pmid">22505256</pub-id></element-citation></ref><ref id="bib2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Afonine</surname><given-names>PV</given-names></name><name><surname>Poon</surname><given-names>BK</given-names></name><name><surname>Read</surname><given-names>RJ</given-names></name><name><surname>Sobolev</surname><given-names>OV</given-names></name><name><surname>Terwilliger</surname><given-names>TC</given-names></name><name><surname>Urzhumtsev</surname><given-names>A</given-names></name><name><surname>Adams</surname><given-names>PD</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Real-space refinement in PHENIX for cryo-EM and crystallography</article-title><source>Acta Crystallographica. Section D, Structural Biology</source><volume>74</volume><fpage>531</fpage><lpage>544</lpage><pub-id pub-id-type="doi">10.1107/S2059798318006551</pub-id><pub-id pub-id-type="pmid">29872004</pub-id></element-citation></ref><ref id="bib3"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Agrawal</surname><given-names>A</given-names></name><name><surname>Verschueren</surname><given-names>R</given-names></name><name><surname>Diamond</surname><given-names>S</given-names></name><name><surname>Boyd</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>A rewriting system for convex optimization problems</article-title><source>arXiv</source><ext-link ext-link-type="uri" xlink:href="https://doi.org/10.48550/arXiv.1709.04494">https://doi.org/10.48550/arXiv.1709.04494</ext-link></element-citation></ref><ref id="bib4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Allen</surname><given-names>FH</given-names></name></person-group><year iso-8601-date="2002">2002</year><article-title>The Cambridge Structural Database: a quarter of a million crystal structures and rising</article-title><source>Acta Crystallographica. Section B, Structural Science</source><volume>58</volume><fpage>380</fpage><lpage>388</lpage><pub-id pub-id-type="doi">10.1107/s0108768102003890</pub-id><pub-id pub-id-type="pmid">12037359</pub-id></element-citation></ref><ref id="bib5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Appavoo</surname><given-names>SD</given-names></name><name><surname>Huh</surname><given-names>S</given-names></name><name><surname>Diaz</surname><given-names>DB</given-names></name><name><surname>Yudin</surname><given-names>AK</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Conformational control of macrocycles by remote structural modification</article-title><source>Chemical Reviews</source><volume>119</volume><fpage>9724</fpage><lpage>9752</lpage><pub-id pub-id-type="doi">10.1021/acs.chemrev.8b00742</pub-id><pub-id pub-id-type="pmid">31411458</pub-id></element-citation></ref><ref id="bib6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Badger</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Crystallographic fragment screening</article-title><source>Methods in Molecular Biology</source><volume>841</volume><fpage>161</fpage><lpage>177</lpage><pub-id pub-id-type="doi">10.1007/978-1-61779-520-6_7</pub-id><pub-id pub-id-type="pmid">22222452</pub-id></element-citation></ref><ref id="bib7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bian</surname><given-names>Y</given-names></name><name><surname>Xie</surname><given-names>XQS</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Computational fragment-based drug design: current trends, strategies, and applications</article-title><source>The AAPS Journal</source><volume>20</volume><elocation-id>59</elocation-id><pub-id pub-id-type="doi">10.1208/s12248-018-0216-7</pub-id><pub-id pub-id-type="pmid">29633051</pub-id></element-citation></ref><ref id="bib8"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Blaney</surname><given-names>JM</given-names></name><name><surname>Scott Dixon</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2007">2007</year><chapter-title>Distance geometry in molecular modeling</chapter-title><person-group person-group-type="editor"><name><surname>Lipkowitz</surname><given-names>KB</given-names></name></person-group><source>Reviews in Computational Chemistry</source><publisher-name>John Wiley &amp; Sons</publisher-name><fpage>299</fpage><lpage>335</lpage><pub-id pub-id-type="doi">10.1002/9780470125823.ch6</pub-id></element-citation></ref><ref id="bib9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Borbulevych</surname><given-names>O</given-names></name><name><surname>Martin</surname><given-names>RI</given-names></name><name><surname>Westerhoff</surname><given-names>LM</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>High-throughput quantum-mechanics/molecular-mechanics (ONIOM) macromolecular crystallographic refinement with PHENIX/DivCon: the impact of mixed Hamiltonian methods on ligand and protein structure</article-title><source>Acta Crystallographica. Section D, Structural Biology</source><volume>74</volume><fpage>1063</fpage><lpage>1077</lpage><pub-id pub-id-type="doi">10.1107/S2059798318012913</pub-id><pub-id pub-id-type="pmid">30387765</pub-id></element-citation></ref><ref id="bib10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Boström</surname><given-names>J</given-names></name><name><surname>Norrby</surname><given-names>PO</given-names></name><name><surname>Liljefors</surname><given-names>T</given-names></name></person-group><year iso-8601-date="1998">1998</year><article-title>Conformational energy penalties of protein-bound ligands</article-title><source>Journal of Computer-Aided Molecular Design</source><volume>12</volume><fpage>383</fpage><lpage>396</lpage><pub-id pub-id-type="doi">10.1023/a:1008007507641</pub-id><pub-id pub-id-type="pmid">9777496</pub-id></element-citation></ref><ref id="bib11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chang</surname><given-names>CA</given-names></name><name><surname>Chen</surname><given-names>W</given-names></name><name><surname>Gilson</surname><given-names>MK</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Ligand configurational entropy and protein binding</article-title><source>PNAS</source><volume>104</volume><fpage>1534</fpage><lpage>1539</lpage><pub-id pub-id-type="doi">10.1073/pnas.0610494104</pub-id><pub-id pub-id-type="pmid">17242351</pub-id></element-citation></ref><ref id="bib12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Collins</surname><given-names>PM</given-names></name><name><surname>Ng</surname><given-names>JT</given-names></name><name><surname>Talon</surname><given-names>R</given-names></name><name><surname>Nekrosiute</surname><given-names>K</given-names></name><name><surname>Krojer</surname><given-names>T</given-names></name><name><surname>Douangamath</surname><given-names>A</given-names></name><name><surname>Brandao-Neto</surname><given-names>J</given-names></name><name><surname>Wright</surname><given-names>N</given-names></name><name><surname>Pearce</surname><given-names>NM</given-names></name><name><surname>von Delft</surname><given-names>F</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Gentle, fast and effective crystal soaking by acoustic dispensing</article-title><source>Acta Crystallographica. Section D, Structural Biology</source><volume>73</volume><fpage>246</fpage><lpage>255</lpage><pub-id pub-id-type="doi">10.1107/S205979831700331X</pub-id><pub-id pub-id-type="pmid">28291760</pub-id></element-citation></ref><ref id="bib13"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Correy</surname><given-names>GJ</given-names></name><name><surname>Rachman</surname><given-names>M</given-names></name><name><surname>Togo</surname><given-names>T</given-names></name><name><surname>Gahbauer</surname><given-names>S</given-names></name><name><surname>Doruk</surname><given-names>YU</given-names></name><name><surname>Stevens</surname><given-names>M</given-names></name><name><surname>Jaishankar</surname><given-names>P</given-names></name><name><surname>Kelley</surname><given-names>B</given-names></name><name><surname>Goldman</surname><given-names>B</given-names></name><name><surname>Schmidt</surname><given-names>M</given-names></name><name><surname>Kramer</surname><given-names>T</given-names></name><name><surname>Ashworth</surname><given-names>A</given-names></name><name><surname>Riley</surname><given-names>P</given-names></name><name><surname>Shoichet</surname><given-names>BK</given-names></name><name><surname>Renslo</surname><given-names>AR</given-names></name><name><surname>Walters</surname><given-names>WP</given-names></name><name><surname>Fraser</surname><given-names>JS</given-names></name></person-group><year iso-8601-date="2024">2024</year><article-title>Extensive exploration of structure activity relationships for the SARS-CoV-2 Macrodomain from Shape-Based Fragment Merging and Active Learning</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/2024.08.25.609621</pub-id></element-citation></ref><ref id="bib14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cummings</surname><given-names>MD</given-names></name><name><surname>Sekharan</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Structure-based macrocycle design in small-molecule drug discovery and simple metrics to identify opportunities for macrocyclization of small-molecule ligands</article-title><source>Journal of Medicinal Chemistry</source><volume>62</volume><fpage>6843</fpage><lpage>6853</lpage><pub-id pub-id-type="doi">10.1021/acs.jmedchem.8b01985</pub-id><pub-id pub-id-type="pmid">30860377</pub-id></element-citation></ref><ref id="bib15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cushing</surname><given-names>VI</given-names></name><name><surname>Koh</surname><given-names>AF</given-names></name><name><surname>Feng</surname><given-names>J</given-names></name><name><surname>Jurgaityte</surname><given-names>K</given-names></name><name><surname>Bondke</surname><given-names>A</given-names></name><name><surname>Kroll</surname><given-names>SHB</given-names></name><name><surname>Barbazanges</surname><given-names>M</given-names></name><name><surname>Scheiper</surname><given-names>B</given-names></name><name><surname>Bahl</surname><given-names>AK</given-names></name><name><surname>Barrett</surname><given-names>AGM</given-names></name><name><surname>Ali</surname><given-names>S</given-names></name><name><surname>Kotecha</surname><given-names>A</given-names></name><name><surname>Greber</surname><given-names>BJ</given-names></name></person-group><year iso-8601-date="2024">2024</year><article-title>High-resolution cryo-EM of the human CDK-activating kinase for structure-based drug design</article-title><source>Nature Communications</source><volume>15</volume><elocation-id>2265</elocation-id><pub-id pub-id-type="doi">10.1038/s41467-024-46375-9</pub-id><pub-id pub-id-type="pmid">38480681</pub-id></element-citation></ref><ref id="bib16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Diamond</surname><given-names>S</given-names></name><name><surname>Boyd</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>CVXPY: a python-embedded modeling language for convex optimization</article-title><source>Journal of Machine Learning Research</source><volume>17</volume><elocation-id>83</elocation-id><pub-id pub-id-type="pmid">27375369</pub-id></element-citation></ref><ref id="bib17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Díaz</surname><given-names>RE</given-names></name><name><surname>Ecker</surname><given-names>AK</given-names></name><name><surname>Correy</surname><given-names>GJ</given-names></name><name><surname>Asthana</surname><given-names>P</given-names></name><name><surname>Young</surname><given-names>ID</given-names></name><name><surname>Faust</surname><given-names>B</given-names></name><name><surname>Thompson</surname><given-names>MC</given-names></name><name><surname>Seiple</surname><given-names>IB</given-names></name><name><surname>Van Dyken</surname><given-names>S</given-names></name><name><surname>Locksley</surname><given-names>RM</given-names></name><name><surname>Fraser</surname><given-names>JS</given-names></name></person-group><year iso-8601-date="2024">2024</year><article-title>Structural characterization of ligand binding and pH-specific enzymatic activity of mouse Acidic Mammalian Chitinase</article-title><source>eLife</source><volume>12</volume><elocation-id>RP89918</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.89918</pub-id><pub-id pub-id-type="pmid">38884443</pub-id></element-citation></ref><ref id="bib18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Driggers</surname><given-names>EM</given-names></name><name><surname>Hale</surname><given-names>SP</given-names></name><name><surname>Lee</surname><given-names>J</given-names></name><name><surname>Terrett</surname><given-names>NK</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>The exploration of macrocycles for drug discovery--an underexploited structural class</article-title><source>Nature Reviews. Drug Discovery</source><volume>7</volume><fpage>608</fpage><lpage>624</lpage><pub-id pub-id-type="doi">10.1038/nrd2590</pub-id><pub-id pub-id-type="pmid">18591981</pub-id></element-citation></ref><ref id="bib19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Emsley</surname><given-names>P</given-names></name><name><surname>Lohkamp</surname><given-names>B</given-names></name><name><surname>Scott</surname><given-names>WG</given-names></name><name><surname>Cowtan</surname><given-names>K</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>Features and development of coot</article-title><source>Acta Crystallographica. Section D, Biological Crystallography</source><volume>66</volume><fpage>486</fpage><lpage>501</lpage><pub-id pub-id-type="doi">10.1107/S0907444910007493</pub-id><pub-id pub-id-type="pmid">20383002</pub-id></element-citation></ref><ref id="bib20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Emsley</surname><given-names>P</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Tools for ligand validation in coot</article-title><source>Acta Crystallographica. Section D, Structural Biology</source><volume>73</volume><fpage>203</fpage><lpage>210</lpage><pub-id pub-id-type="doi">10.1107/S2059798317003382</pub-id><pub-id pub-id-type="pmid">28291755</pub-id></element-citation></ref><ref id="bib21"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Evans</surname><given-names>PR</given-names></name><name><surname>Murshudov</surname><given-names>GN</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>How good are my data and what is the resolution?</article-title><source>Acta Crystallographica. Section D, Biological Crystallography</source><volume>69</volume><fpage>1204</fpage><lpage>1214</lpage><pub-id pub-id-type="doi">10.1107/S0907444913000061</pub-id><pub-id pub-id-type="pmid">23793146</pub-id></element-citation></ref><ref id="bib22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gahbauer</surname><given-names>S</given-names></name><name><surname>Correy</surname><given-names>GJ</given-names></name><name><surname>Schuller</surname><given-names>M</given-names></name><name><surname>Ferla</surname><given-names>MP</given-names></name><name><surname>Doruk</surname><given-names>YU</given-names></name><name><surname>Rachman</surname><given-names>M</given-names></name><name><surname>Wu</surname><given-names>T</given-names></name><name><surname>Diolaiti</surname><given-names>M</given-names></name><name><surname>Wang</surname><given-names>S</given-names></name><name><surname>Neitz</surname><given-names>RJ</given-names></name><name><surname>Fearon</surname><given-names>D</given-names></name><name><surname>Radchenko</surname><given-names>DS</given-names></name><name><surname>Moroz</surname><given-names>YS</given-names></name><name><surname>Irwin</surname><given-names>JJ</given-names></name><name><surname>Renslo</surname><given-names>AR</given-names></name><name><surname>Taylor</surname><given-names>JC</given-names></name><name><surname>Gestwicki</surname><given-names>JE</given-names></name><name><surname>von Delft</surname><given-names>F</given-names></name><name><surname>Ashworth</surname><given-names>A</given-names></name><name><surname>Ahel</surname><given-names>I</given-names></name><name><surname>Shoichet</surname><given-names>BK</given-names></name><name><surname>Fraser</surname><given-names>JS</given-names></name></person-group><year iso-8601-date="2023">2023</year><article-title>Iterative computational design and crystallographic screening identifies potent inhibitors targeting the Nsp3 macrodomain of SARS-CoV-2</article-title><source>PNAS</source><volume>120</volume><elocation-id>e2212931120</elocation-id><pub-id pub-id-type="doi">10.1073/pnas.2212931120</pub-id><pub-id pub-id-type="pmid">36598939</pub-id></element-citation></ref><ref id="bib23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Garcia Jimenez</surname><given-names>D</given-names></name><name><surname>Poongavanam</surname><given-names>V</given-names></name><name><surname>Kihlberg</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2023">2023</year><article-title>Macrocycles in drug discovery─learning from the past for the future</article-title><source>Journal of Medicinal Chemistry</source><volume>66</volume><fpage>5377</fpage><lpage>5396</lpage><pub-id pub-id-type="doi">10.1021/acs.jmedchem.3c00134</pub-id><pub-id pub-id-type="pmid">37721863</pub-id></element-citation></ref><ref id="bib24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Groom</surname><given-names>CR</given-names></name><name><surname>Allen</surname><given-names>FH</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>The Cambridge Structural Database in retrospect and prospect</article-title><source>Angewandte Chemie</source><volume>53</volume><fpage>662</fpage><lpage>671</lpage><pub-id pub-id-type="doi">10.1002/anie.201306438</pub-id><pub-id pub-id-type="pmid">24382699</pub-id></element-citation></ref><ref id="bib25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gu</surname><given-names>S</given-names></name><name><surname>Smith</surname><given-names>MS</given-names></name><name><surname>Yang</surname><given-names>Y</given-names></name><name><surname>Irwin</surname><given-names>JJ</given-names></name><name><surname>Shoichet</surname><given-names>BK</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Ligand strain energy in large library docking</article-title><source>Journal of Chemical Information and Modeling</source><volume>61</volume><fpage>4331</fpage><lpage>4341</lpage><pub-id pub-id-type="doi">10.1021/acs.jcim.1c00368</pub-id><pub-id pub-id-type="pmid">34467754</pub-id></element-citation></ref><ref id="bib26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Günther</surname><given-names>S</given-names></name><name><surname>Reinke</surname><given-names>PYA</given-names></name><name><surname>Fernández-García</surname><given-names>Y</given-names></name><name><surname>Lieske</surname><given-names>J</given-names></name><name><surname>Lane</surname><given-names>TJ</given-names></name><name><surname>Ginn</surname><given-names>HM</given-names></name><name><surname>Koua</surname><given-names>FHM</given-names></name><name><surname>Ehrt</surname><given-names>C</given-names></name><name><surname>Ewert</surname><given-names>W</given-names></name><name><surname>Oberthuer</surname><given-names>D</given-names></name><name><surname>Yefanov</surname><given-names>O</given-names></name><name><surname>Meier</surname><given-names>S</given-names></name><name><surname>Lorenzen</surname><given-names>K</given-names></name><name><surname>Krichel</surname><given-names>B</given-names></name><name><surname>Kopicki</surname><given-names>JD</given-names></name><name><surname>Gelisio</surname><given-names>L</given-names></name><name><surname>Brehm</surname><given-names>W</given-names></name><name><surname>Dunkel</surname><given-names>I</given-names></name><name><surname>Seychell</surname><given-names>B</given-names></name><name><surname>Gieseler</surname><given-names>H</given-names></name><name><surname>Norton-Baker</surname><given-names>B</given-names></name><name><surname>Escudero-Pérez</surname><given-names>B</given-names></name><name><surname>Domaracky</surname><given-names>M</given-names></name><name><surname>Saouane</surname><given-names>S</given-names></name><name><surname>Tolstikova</surname><given-names>A</given-names></name><name><surname>White</surname><given-names>TA</given-names></name><name><surname>Hänle</surname><given-names>A</given-names></name><name><surname>Groessler</surname><given-names>M</given-names></name><name><surname>Fleckenstein</surname><given-names>H</given-names></name><name><surname>Trost</surname><given-names>F</given-names></name><name><surname>Galchenkova</surname><given-names>M</given-names></name><name><surname>Gevorkov</surname><given-names>Y</given-names></name><name><surname>Li</surname><given-names>C</given-names></name><name><surname>Awel</surname><given-names>S</given-names></name><name><surname>Peck</surname><given-names>A</given-names></name><name><surname>Barthelmess</surname><given-names>M</given-names></name><name><surname>Schlünzen</surname><given-names>F</given-names></name><name><surname>Lourdu Xavier</surname><given-names>P</given-names></name><name><surname>Werner</surname><given-names>N</given-names></name><name><surname>Andaleeb</surname><given-names>H</given-names></name><name><surname>Ullah</surname><given-names>N</given-names></name><name><surname>Falke</surname><given-names>S</given-names></name><name><surname>Srinivasan</surname><given-names>V</given-names></name><name><surname>França</surname><given-names>BA</given-names></name><name><surname>Schwinzer</surname><given-names>M</given-names></name><name><surname>Brognaro</surname><given-names>H</given-names></name><name><surname>Rogers</surname><given-names>C</given-names></name><name><surname>Melo</surname><given-names>D</given-names></name><name><surname>Zaitseva-Kinneberg</surname><given-names>JI</given-names></name><name><surname>Knoska</surname><given-names>J</given-names></name><name><surname>Peña-Murillo</surname><given-names>GE</given-names></name><name><surname>Mashhour</surname><given-names>AR</given-names></name><name><surname>Hennicke</surname><given-names>V</given-names></name><name><surname>Fischer</surname><given-names>P</given-names></name><name><surname>Hakanpää</surname><given-names>J</given-names></name><name><surname>Meyer</surname><given-names>J</given-names></name><name><surname>Gribbon</surname><given-names>P</given-names></name><name><surname>Ellinger</surname><given-names>B</given-names></name><name><surname>Kuzikov</surname><given-names>M</given-names></name><name><surname>Wolf</surname><given-names>M</given-names></name><name><surname>Beccari</surname><given-names>AR</given-names></name><name><surname>Bourenkov</surname><given-names>G</given-names></name><name><surname>von Stetten</surname><given-names>D</given-names></name><name><surname>Pompidor</surname><given-names>G</given-names></name><name><surname>Bento</surname><given-names>I</given-names></name><name><surname>Panneerselvam</surname><given-names>S</given-names></name><name><surname>Karpics</surname><given-names>I</given-names></name><name><surname>Schneider</surname><given-names>TR</given-names></name><name><surname>Garcia-Alai</surname><given-names>MM</given-names></name><name><surname>Niebling</surname><given-names>S</given-names></name><name><surname>Günther</surname><given-names>C</given-names></name><name><surname>Schmidt</surname><given-names>C</given-names></name><name><surname>Schubert</surname><given-names>R</given-names></name><name><surname>Han</surname><given-names>H</given-names></name><name><surname>Boger</surname><given-names>J</given-names></name><name><surname>Monteiro</surname><given-names>DCF</given-names></name><name><surname>Zhang</surname><given-names>L</given-names></name><name><surname>Sun</surname><given-names>X</given-names></name><name><surname>Pletzer-Zelgert</surname><given-names>J</given-names></name><name><surname>Wollenhaupt</surname><given-names>J</given-names></name><name><surname>Feiler</surname><given-names>CG</given-names></name><name><surname>Weiss</surname><given-names>MS</given-names></name><name><surname>Schulz</surname><given-names>EC</given-names></name><name><surname>Mehrabi</surname><given-names>P</given-names></name><name><surname>Karničar</surname><given-names>K</given-names></name><name><surname>Usenik</surname><given-names>A</given-names></name><name><surname>Loboda</surname><given-names>J</given-names></name><name><surname>Tidow</surname><given-names>H</given-names></name><name><surname>Chari</surname><given-names>A</given-names></name><name><surname>Hilgenfeld</surname><given-names>R</given-names></name><name><surname>Uetrecht</surname><given-names>C</given-names></name><name><surname>Cox</surname><given-names>R</given-names></name><name><surname>Zaliani</surname><given-names>A</given-names></name><name><surname>Beck</surname><given-names>T</given-names></name><name><surname>Rarey</surname><given-names>M</given-names></name><name><surname>Günther</surname><given-names>S</given-names></name><name><surname>Turk</surname><given-names>D</given-names></name><name><surname>Hinrichs</surname><given-names>W</given-names></name><name><surname>Chapman</surname><given-names>HN</given-names></name><name><surname>Pearson</surname><given-names>AR</given-names></name><name><surname>Betzel</surname><given-names>C</given-names></name><name><surname>Meents</surname><given-names>A</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>X-ray screening identifies active site and allosteric inhibitors of SARS-CoV-2 main protease</article-title><source>Science</source><volume>372</volume><fpage>642</fpage><lpage>646</lpage><pub-id pub-id-type="doi">10.1126/science.abf7945</pub-id><pub-id pub-id-type="pmid">33811162</pub-id></element-citation></ref><ref id="bib27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hao</surname><given-names>MH</given-names></name><name><surname>Haq</surname><given-names>O</given-names></name><name><surname>Muegge</surname><given-names>I</given-names></name></person-group><year iso-8601-date="2007">2007</year><article-title>Torsion angle preference and energetics of small-molecule ligands bound to proteins</article-title><source>Journal of Chemical Information and Modeling</source><volume>47</volume><fpage>2242</fpage><lpage>2252</lpage><pub-id pub-id-type="doi">10.1021/ci700189s</pub-id><pub-id pub-id-type="pmid">17880058</pub-id></element-citation></ref><ref id="bib28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hartshorn</surname><given-names>MJ</given-names></name><name><surname>Murray</surname><given-names>CW</given-names></name><name><surname>Cleasby</surname><given-names>A</given-names></name><name><surname>Frederickson</surname><given-names>M</given-names></name><name><surname>Tickle</surname><given-names>IJ</given-names></name><name><surname>Jhoti</surname><given-names>H</given-names></name></person-group><year iso-8601-date="2005">2005</year><article-title>Fragment-based lead discovery using X-ray crystallography</article-title><source>Journal of Medicinal Chemistry</source><volume>48</volume><fpage>403</fpage><lpage>413</lpage><pub-id pub-id-type="doi">10.1021/jm0495778</pub-id><pub-id pub-id-type="pmid">15658854</pub-id></element-citation></ref><ref id="bib29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jain</surname><given-names>AN</given-names></name><name><surname>Cleves</surname><given-names>AE</given-names></name><name><surname>Brueckner</surname><given-names>AC</given-names></name><name><surname>Lesburg</surname><given-names>CA</given-names></name><name><surname>Deng</surname><given-names>Q</given-names></name><name><surname>Sherer</surname><given-names>EC</given-names></name><name><surname>Reibarkh</surname><given-names>MY</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>XGen: real-space fitting of complex ligand conformational ensembles to X-ray electron density maps</article-title><source>Journal of Medicinal Chemistry</source><volume>63</volume><fpage>10509</fpage><lpage>10528</lpage><pub-id pub-id-type="doi">10.1021/acs.jmedchem.0c01373</pub-id><pub-id pub-id-type="pmid">32877178</pub-id></element-citation></ref><ref id="bib30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jain</surname><given-names>AN</given-names></name><name><surname>Brueckner</surname><given-names>AC</given-names></name><name><surname>Cleves</surname><given-names>AE</given-names></name><name><surname>Reibarkh</surname><given-names>M</given-names></name><name><surname>Sherer</surname><given-names>EC</given-names></name></person-group><year iso-8601-date="2023">2023</year><article-title>A distributional model of bound ligand conformational strain: from small molecules up to large peptidic macrocycles</article-title><source>Journal of Medicinal Chemistry</source><volume>66</volume><fpage>1955</fpage><lpage>1971</lpage><pub-id pub-id-type="doi">10.1021/acs.jmedchem.2c01744</pub-id><pub-id pub-id-type="pmid">36701387</pub-id></element-citation></ref><ref id="bib31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kabsch</surname><given-names>W</given-names></name></person-group><year iso-8601-date="2010">2010</year><article-title>XDS</article-title><source>Acta Crystallographica. Section D, Biological Crystallography</source><volume>66</volume><fpage>125</fpage><lpage>132</lpage><pub-id pub-id-type="doi">10.1107/S0907444909047337</pub-id><pub-id pub-id-type="pmid">20124692</pub-id></element-citation></ref><ref id="bib32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kamenik</surname><given-names>AS</given-names></name><name><surname>Lessel</surname><given-names>U</given-names></name><name><surname>Fuchs</surname><given-names>JE</given-names></name><name><surname>Fox</surname><given-names>T</given-names></name><name><surname>Liedl</surname><given-names>KR</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Peptidic macrocycles - conformational sampling and thermodynamic characterization</article-title><source>Journal of Chemical Information and Modeling</source><volume>58</volume><fpage>982</fpage><lpage>992</lpage><pub-id pub-id-type="doi">10.1021/acs.jcim.8b00097</pub-id><pub-id pub-id-type="pmid">29652495</pub-id></element-citation></ref><ref id="bib33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Keedy</surname><given-names>DA</given-names></name><name><surname>Fraser</surname><given-names>JS</given-names></name><name><surname>van den Bedem</surname><given-names>H</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Exposing hidden alternative backbone conformations in X-ray crystallography using qFit</article-title><source>PLOS Computational Biology</source><volume>11</volume><elocation-id>e1004507</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1004507</pub-id><pub-id pub-id-type="pmid">26506617</pub-id></element-citation></ref><ref id="bib34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liebeschuetz</surname><given-names>JW</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>The good, the bad, and the twisted revisited: an analysis of ligand geometry in highly resolved protein-ligand X-ray structures</article-title><source>Journal of Medicinal Chemistry</source><volume>64</volume><fpage>7533</fpage><lpage>7543</lpage><pub-id pub-id-type="doi">10.1021/acs.jmedchem.1c00228</pub-id><pub-id pub-id-type="pmid">34060310</pub-id></element-citation></ref><ref id="bib35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liebschner</surname><given-names>D</given-names></name><name><surname>Afonine</surname><given-names>PV</given-names></name><name><surname>Baker</surname><given-names>ML</given-names></name><name><surname>Bunkóczi</surname><given-names>G</given-names></name><name><surname>Chen</surname><given-names>VB</given-names></name><name><surname>Croll</surname><given-names>TI</given-names></name><name><surname>Hintze</surname><given-names>B</given-names></name><name><surname>Hung</surname><given-names>LW</given-names></name><name><surname>Jain</surname><given-names>S</given-names></name><name><surname>McCoy</surname><given-names>AJ</given-names></name><name><surname>Moriarty</surname><given-names>NW</given-names></name><name><surname>Oeffner</surname><given-names>RD</given-names></name><name><surname>Poon</surname><given-names>BK</given-names></name><name><surname>Prisant</surname><given-names>MG</given-names></name><name><surname>Read</surname><given-names>RJ</given-names></name><name><surname>Richardson</surname><given-names>JS</given-names></name><name><surname>Richardson</surname><given-names>DC</given-names></name><name><surname>Sammito</surname><given-names>MD</given-names></name><name><surname>Sobolev</surname><given-names>OV</given-names></name><name><surname>Stockwell</surname><given-names>DH</given-names></name><name><surname>Terwilliger</surname><given-names>TC</given-names></name><name><surname>Urzhumtsev</surname><given-names>AG</given-names></name><name><surname>Videau</surname><given-names>LL</given-names></name><name><surname>Williams</surname><given-names>CJ</given-names></name><name><surname>Adams</surname><given-names>PD</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Macromolecular structure determination using X-rays, neutrons and electrons: recent developments in Phenix</article-title><source>Acta Crystallographica. Section D, Structural Biology</source><volume>75</volume><fpage>861</fpage><lpage>877</lpage><pub-id pub-id-type="doi">10.1107/S2059798319011471</pub-id><pub-id pub-id-type="pmid">31588918</pub-id></element-citation></ref><ref id="bib36"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liebschner</surname><given-names>D</given-names></name><name><surname>Moriarty</surname><given-names>NW</given-names></name><name><surname>Poon</surname><given-names>BK</given-names></name><name><surname>Adams</surname><given-names>PD</given-names></name></person-group><year iso-8601-date="2023">2023</year><article-title>In situ ligand restraints from quantum-mechanical methods</article-title><source>Acta Crystallographica. Section D, Structural Biology</source><volume>79</volume><fpage>100</fpage><lpage>110</lpage><pub-id pub-id-type="doi">10.1107/S2059798323000025</pub-id><pub-id pub-id-type="pmid">36762856</pub-id></element-citation></ref><ref id="bib37"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Long</surname><given-names>F</given-names></name><name><surname>Nicholls</surname><given-names>RA</given-names></name><name><surname>Emsley</surname><given-names>P</given-names></name><name><surname>Graǽulis</surname><given-names>S</given-names></name><name><surname>Merkys</surname><given-names>A</given-names></name><name><surname>Vaitkus</surname><given-names>A</given-names></name><name><surname>Murshudov</surname><given-names>GN</given-names></name></person-group><year iso-8601-date="2017">2017a</year><article-title>Validation and extraction of molecular-geometry information from small-molecule databases</article-title><source>Acta Crystallographica. Section D, Structural Biology</source><volume>73</volume><fpage>103</fpage><lpage>111</lpage><pub-id pub-id-type="doi">10.1107/S2059798317000079</pub-id><pub-id pub-id-type="pmid">28177306</pub-id></element-citation></ref><ref id="bib38"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Long</surname><given-names>F</given-names></name><name><surname>Nicholls</surname><given-names>RA</given-names></name><name><surname>Emsley</surname><given-names>P</given-names></name><name><surname>Graǽulis</surname><given-names>S</given-names></name><name><surname>Merkys</surname><given-names>A</given-names></name><name><surname>Vaitkus</surname><given-names>A</given-names></name><name><surname>Murshudov</surname><given-names>GN</given-names></name></person-group><year iso-8601-date="2017">2017b</year><article-title>AceDRG: a stereochemical description generator for ligands</article-title><source>Acta Crystallographica. Section D, Structural Biology</source><volume>73</volume><fpage>112</fpage><lpage>122</lpage><pub-id pub-id-type="doi">10.1107/S2059798317000067</pub-id><pub-id pub-id-type="pmid">28177307</pub-id></element-citation></ref><ref id="bib39"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mehlman</surname><given-names>T</given-names></name><name><surname>Ginn</surname><given-names>HM</given-names></name><name><surname>Keedy</surname><given-names>DA</given-names></name></person-group><year iso-8601-date="2024">2024</year><article-title>An expanded trove of fragment-bound structures for the allosteric enzyme PTP1B from computational reanalysis of large-scale crystallographic data</article-title><source>Structure</source><volume>32</volume><fpage>1231</fpage><lpage>1238</lpage><pub-id pub-id-type="doi">10.1016/j.str.2024.05.010</pub-id><pub-id pub-id-type="pmid">38861991</pub-id></element-citation></ref><ref id="bib40"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Meyder</surname><given-names>A</given-names></name><name><surname>Nittinger</surname><given-names>E</given-names></name><name><surname>Lange</surname><given-names>G</given-names></name><name><surname>Klein</surname><given-names>R</given-names></name><name><surname>Rarey</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Estimating electron density support for individual atoms and molecular fragments in X-ray structures</article-title><source>Journal of Chemical Information and Modeling</source><volume>57</volume><fpage>2437</fpage><lpage>2447</lpage><pub-id pub-id-type="doi">10.1021/acs.jcim.7b00391</pub-id><pub-id pub-id-type="pmid">28981269</pub-id></element-citation></ref><ref id="bib41"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Morin</surname><given-names>A</given-names></name><name><surname>Eisenbraun</surname><given-names>B</given-names></name><name><surname>Key</surname><given-names>J</given-names></name><name><surname>Sanschagrin</surname><given-names>PC</given-names></name><name><surname>Timony</surname><given-names>MA</given-names></name><name><surname>Ottaviano</surname><given-names>M</given-names></name><name><surname>Sliz</surname><given-names>P</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Collaboration gets the most out of software</article-title><source>eLife</source><volume>2</volume><elocation-id>e01456</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.01456</pub-id><pub-id pub-id-type="pmid">24040512</pub-id></element-citation></ref><ref id="bib42"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nicholls</surname><given-names>RA</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>Ligand fitting with CCP4</article-title><source>Acta Crystallographica. Section D, Structural Biology</source><volume>73</volume><fpage>158</fpage><lpage>170</lpage><pub-id pub-id-type="doi">10.1107/S2059798316020143</pub-id><pub-id pub-id-type="pmid">28177312</pub-id></element-citation></ref><ref id="bib43"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nicklaus</surname><given-names>MC</given-names></name><name><surname>Wang</surname><given-names>S</given-names></name><name><surname>Driscoll</surname><given-names>JS</given-names></name><name><surname>Milne</surname><given-names>GW</given-names></name></person-group><year iso-8601-date="1995">1995</year><article-title>Conformational changes of small molecules binding to proteins</article-title><source>Bioorganic &amp; Medicinal Chemistry</source><volume>3</volume><fpage>411</fpage><lpage>428</lpage><pub-id pub-id-type="doi">10.1016/0968-0896(95)00031-b</pub-id><pub-id pub-id-type="pmid">8581425</pub-id></element-citation></ref><ref id="bib44"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pearce</surname><given-names>NM</given-names></name><name><surname>Krojer</surname><given-names>T</given-names></name><name><surname>Bradley</surname><given-names>AR</given-names></name><name><surname>Collins</surname><given-names>P</given-names></name><name><surname>Nowak</surname><given-names>RP</given-names></name><name><surname>Talon</surname><given-names>R</given-names></name><name><surname>Marsden</surname><given-names>BD</given-names></name><name><surname>Kelm</surname><given-names>S</given-names></name><name><surname>Shi</surname><given-names>J</given-names></name><name><surname>Deane</surname><given-names>CM</given-names></name><name><surname>von Delft</surname><given-names>F</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>A multi-crystal method for extracting obscured crystallographic states from conventionally uninterpretable electron density</article-title><source>Nature Communications</source><volume>8</volume><elocation-id>15123</elocation-id><pub-id pub-id-type="doi">10.1038/ncomms15123</pub-id><pub-id pub-id-type="pmid">28436492</pub-id></element-citation></ref><ref id="bib45"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Perola</surname><given-names>E</given-names></name><name><surname>Charifson</surname><given-names>PS</given-names></name></person-group><year iso-8601-date="2004">2004</year><article-title>Conformational analysis of drug-like molecules bound to proteins: an extensive study of ligand reorganization upon binding</article-title><source>Journal of Medicinal Chemistry</source><volume>47</volume><fpage>2499</fpage><lpage>2510</lpage><pub-id pub-id-type="doi">10.1021/jm030563w</pub-id><pub-id pub-id-type="pmid">15115393</pub-id></element-citation></ref><ref id="bib46"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rai</surname><given-names>BK</given-names></name><name><surname>Sresht</surname><given-names>V</given-names></name><name><surname>Yang</surname><given-names>Q</given-names></name><name><surname>Unwalla</surname><given-names>R</given-names></name><name><surname>Tu</surname><given-names>M</given-names></name><name><surname>Mathiowetz</surname><given-names>AM</given-names></name><name><surname>Bakken</surname><given-names>GA</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Comprehensive assessment of torsional strain in crystal structures of small molecules and protein-ligand complexes using ab initio calculations</article-title><source>Journal of Chemical Information and Modeling</source><volume>59</volume><fpage>4195</fpage><lpage>4208</lpage><pub-id pub-id-type="doi">10.1021/acs.jcim.9b00373</pub-id><pub-id pub-id-type="pmid">31573196</pub-id></element-citation></ref><ref id="bib47"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Ravikumar</surname><given-names>A</given-names></name><name><surname>Wankowicz</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2024">2024</year><data-title>QFit_biological_testset</data-title><version designator="swh:1:rev:3acedb2fc3a1e15cd18d97c21cf6dba1acd3e152">swh:1:rev:3acedb2fc3a1e15cd18d97c21cf6dba1acd3e152</version><source>Software Heritage</source><ext-link ext-link-type="uri" xlink:href="https://archive.softwareheritage.org/swh:1:dir:a4c6660c8b7273f443d1e8a7b5b16ee3ba200d7c;origin=https://github.com/fraser-lab/qFit_biological_testset;visit=swh:1:snp:9baf2d7de14a4aefe08b2b3d953f1de898e4e179;anchor=swh:1:rev:3acedb2fc3a1e15cd18d97c21cf6dba1acd3e152">https://archive.softwareheritage.org/swh:1:dir:a4c6660c8b7273f443d1e8a7b5b16ee3ba200d7c;origin=https://github.com/fraser-lab/qFit_biological_testset;visit=swh:1:snp:9baf2d7de14a4aefe08b2b3d953f1de898e4e179;anchor=swh:1:rev:3acedb2fc3a1e15cd18d97c21cf6dba1acd3e152</ext-link></element-citation></ref><ref id="bib48"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Riley</surname><given-names>BT</given-names></name><name><surname>Wankowicz</surname><given-names>SA</given-names></name><name><surname>de Oliveira</surname><given-names>SHP</given-names></name><name><surname>van Zundert</surname><given-names>GCP</given-names></name><name><surname>Hogan</surname><given-names>DW</given-names></name><name><surname>Fraser</surname><given-names>JS</given-names></name><name><surname>Keedy</surname><given-names>DA</given-names></name><name><surname>van den Bedem</surname><given-names>H</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>qFit 3: Protein and ligand multiconformer modeling for X-ray crystallographic and single-particle cryo-EM density maps</article-title><source>Protein Science</source><volume>30</volume><fpage>270</fpage><lpage>285</lpage><pub-id pub-id-type="doi">10.1002/pro.4001</pub-id><pub-id pub-id-type="pmid">33210433</pub-id></element-citation></ref><ref id="bib49"><element-citation publication-type="software"><person-group person-group-type="author"><name><surname>Riley</surname><given-names>B</given-names></name><name><surname>Wankowicz</surname><given-names>S</given-names></name><name><surname>Flowers</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2025">2025</year><data-title>Qfit-3.0</data-title><version designator="swh:1:rev:21ece80597178624b3ecd4727c6f32d17ea3b49a">swh:1:rev:21ece80597178624b3ecd4727c6f32d17ea3b49a</version><source>Software Heritage</source><ext-link ext-link-type="uri" xlink:href="https://archive.softwareheritage.org/swh:1:dir:0cf8545e831fcd8ce919ecbe0670869a5f256c4e;origin=https://github.com/ExcitedStates/qfit-3.0;visit=swh:1:snp:ce6b47860792642044d69da32bd569b8077ed463;anchor=swh:1:rev:21ece80597178624b3ecd4727c6f32d17ea3b49a">https://archive.softwareheritage.org/swh:1:dir:0cf8545e831fcd8ce919ecbe0670869a5f256c4e;origin=https://github.com/ExcitedStates/qfit-3.0;visit=swh:1:snp:ce6b47860792642044d69da32bd569b8077ed463;anchor=swh:1:rev:21ece80597178624b3ecd4727c6f32d17ea3b49a</ext-link></element-citation></ref><ref id="bib50"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Riniker</surname><given-names>S</given-names></name><name><surname>Landrum</surname><given-names>GA</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Better informed distance geometry: using what we know to improve conformation generation</article-title><source>Journal of Chemical Information and Modeling</source><volume>55</volume><fpage>2562</fpage><lpage>2574</lpage><pub-id pub-id-type="doi">10.1021/acs.jcim.5b00654</pub-id><pub-id pub-id-type="pmid">26575315</pub-id></element-citation></ref><ref id="bib51"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Russo</surname><given-names>A</given-names></name><name><surname>Aiello</surname><given-names>C</given-names></name><name><surname>Grieco</surname><given-names>P</given-names></name><name><surname>Marasco</surname><given-names>D</given-names></name></person-group><year iso-8601-date="2016">2016</year><article-title>Targeting “undruggable” proteins: design of synthetic cyclopeptides</article-title><source>Current Medicinal Chemistry</source><volume>23</volume><fpage>748</fpage><lpage>762</lpage><pub-id pub-id-type="doi">10.2174/0929867323666160112122540</pub-id><pub-id pub-id-type="pmid">26758797</pub-id></element-citation></ref><ref id="bib52"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schärfer</surname><given-names>C</given-names></name><name><surname>Schulz-Gasch</surname><given-names>T</given-names></name><name><surname>Ehrlich</surname><given-names>H-C</given-names></name><name><surname>Guba</surname><given-names>W</given-names></name><name><surname>Rarey</surname><given-names>M</given-names></name><name><surname>Stahl</surname><given-names>M</given-names></name></person-group><year iso-8601-date="2013">2013</year><article-title>Torsion angle preferences in druglike chemical space: a comprehensive guide</article-title><source>Journal of Medicinal Chemistry</source><volume>56</volume><fpage>2016</fpage><lpage>2028</lpage><pub-id pub-id-type="doi">10.1021/jm3016816</pub-id><pub-id pub-id-type="pmid">23379567</pub-id></element-citation></ref><ref id="bib53"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schuller</surname><given-names>M</given-names></name><name><surname>Correy</surname><given-names>GJ</given-names></name><name><surname>Gahbauer</surname><given-names>S</given-names></name><name><surname>Fearon</surname><given-names>D</given-names></name><name><surname>Wu</surname><given-names>T</given-names></name><name><surname>Díaz</surname><given-names>RE</given-names></name><name><surname>Young</surname><given-names>ID</given-names></name><name><surname>Carvalho Martins</surname><given-names>L</given-names></name><name><surname>Smith</surname><given-names>DH</given-names></name><name><surname>Schulze-Gahmen</surname><given-names>U</given-names></name><name><surname>Owens</surname><given-names>TW</given-names></name><name><surname>Deshpande</surname><given-names>I</given-names></name><name><surname>Merz</surname><given-names>GE</given-names></name><name><surname>Thwin</surname><given-names>AC</given-names></name><name><surname>Biel</surname><given-names>JT</given-names></name><name><surname>Peters</surname><given-names>JK</given-names></name><name><surname>Moritz</surname><given-names>M</given-names></name><name><surname>Herrera</surname><given-names>N</given-names></name><name><surname>Kratochvil</surname><given-names>HT</given-names></name><name><surname>Aimon</surname><given-names>A</given-names></name><name><surname>Bennett</surname><given-names>JM</given-names></name><name><surname>Brandao Neto</surname><given-names>J</given-names></name><name><surname>Cohen</surname><given-names>AE</given-names></name><name><surname>Dias</surname><given-names>A</given-names></name><name><surname>Douangamath</surname><given-names>A</given-names></name><name><surname>Dunnett</surname><given-names>L</given-names></name><name><surname>Fedorov</surname><given-names>O</given-names></name><name><surname>Ferla</surname><given-names>MP</given-names></name><name><surname>Fuchs</surname><given-names>MR</given-names></name><name><surname>Gorrie-Stone</surname><given-names>TJ</given-names></name><name><surname>Holton</surname><given-names>JM</given-names></name><name><surname>Johnson</surname><given-names>MG</given-names></name><name><surname>Krojer</surname><given-names>T</given-names></name><name><surname>Meigs</surname><given-names>G</given-names></name><name><surname>Powell</surname><given-names>AJ</given-names></name><name><surname>Rack</surname><given-names>JGM</given-names></name><name><surname>Rangel</surname><given-names>VL</given-names></name><name><surname>Russi</surname><given-names>S</given-names></name><name><surname>Skyner</surname><given-names>RE</given-names></name><name><surname>Smith</surname><given-names>CA</given-names></name><name><surname>Soares</surname><given-names>AS</given-names></name><name><surname>Wierman</surname><given-names>JL</given-names></name><name><surname>Zhu</surname><given-names>K</given-names></name><name><surname>O’Brien</surname><given-names>P</given-names></name><name><surname>Jura</surname><given-names>N</given-names></name><name><surname>Ashworth</surname><given-names>A</given-names></name><name><surname>Irwin</surname><given-names>JJ</given-names></name><name><surname>Thompson</surname><given-names>MC</given-names></name><name><surname>Gestwicki</surname><given-names>JE</given-names></name><name><surname>von Delft</surname><given-names>F</given-names></name><name><surname>Shoichet</surname><given-names>BK</given-names></name><name><surname>Fraser</surname><given-names>JS</given-names></name><name><surname>Ahel</surname><given-names>I</given-names></name><collab>QCRG Structural Biology Consortium</collab></person-group><year iso-8601-date="2021">2021</year><article-title>Fragment binding to the Nsp3 macrodomain of SARS-CoV-2 identified through crystallographic screening and computational docking</article-title><source>Science Advances</source><volume>7</volume><elocation-id>eabf8711</elocation-id><pub-id pub-id-type="doi">10.1126/sciadv.abf8711</pub-id><pub-id pub-id-type="pmid">33853786</pub-id></element-citation></ref><ref id="bib54"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shao</surname><given-names>C</given-names></name><name><surname>Bittrich</surname><given-names>S</given-names></name><name><surname>Wang</surname><given-names>S</given-names></name><name><surname>Burley</surname><given-names>SK</given-names></name></person-group><year iso-8601-date="2022">2022</year><article-title>Assessing PDB macromolecular crystal structure confidence at the individual amino acid residue level</article-title><source>Structure</source><volume>30</volume><fpage>1385</fpage><lpage>1394</lpage><pub-id pub-id-type="doi">10.1016/j.str.2022.08.004</pub-id><pub-id pub-id-type="pmid">36049478</pub-id></element-citation></ref><ref id="bib55"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sitzmann</surname><given-names>M</given-names></name><name><surname>Weidlich</surname><given-names>IE</given-names></name><name><surname>Filippov</surname><given-names>IV</given-names></name><name><surname>Liao</surname><given-names>C</given-names></name><name><surname>Peach</surname><given-names>ML</given-names></name><name><surname>Ihlenfeldt</surname><given-names>W-D</given-names></name><name><surname>Karki</surname><given-names>RG</given-names></name><name><surname>Borodina</surname><given-names>YV</given-names></name><name><surname>Cachau</surname><given-names>RE</given-names></name><name><surname>Nicklaus</surname><given-names>MC</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>PDB ligand conformational energies calculated quantum-mechanically</article-title><source>Journal of Chemical Information and Modeling</source><volume>52</volume><fpage>739</fpage><lpage>756</lpage><pub-id pub-id-type="doi">10.1021/ci200595n</pub-id><pub-id pub-id-type="pmid">22303903</pub-id></element-citation></ref><ref id="bib56"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Skaist Mehlman</surname><given-names>T</given-names></name><name><surname>Biel</surname><given-names>JT</given-names></name><name><surname>Azeem</surname><given-names>SM</given-names></name><name><surname>Nelson</surname><given-names>ER</given-names></name><name><surname>Hossain</surname><given-names>S</given-names></name><name><surname>Dunnett</surname><given-names>L</given-names></name><name><surname>Paterson</surname><given-names>NG</given-names></name><name><surname>Douangamath</surname><given-names>A</given-names></name><name><surname>Talon</surname><given-names>R</given-names></name><name><surname>Axford</surname><given-names>D</given-names></name><name><surname>Orins</surname><given-names>H</given-names></name><name><surname>von Delft</surname><given-names>F</given-names></name><name><surname>Keedy</surname><given-names>DA</given-names></name></person-group><year iso-8601-date="2023">2023</year><article-title>Room-temperature crystallography reveals altered binding of small-molecule fragments to PTP1B</article-title><source>eLife</source><volume>12</volume><elocation-id>e84632</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.84632</pub-id><pub-id pub-id-type="pmid">36881464</pub-id></element-citation></ref><ref id="bib57"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Smart</surname><given-names>OS</given-names></name><name><surname>Horský</surname><given-names>V</given-names></name><name><surname>Gore</surname><given-names>S</given-names></name><name><surname>Svobodová Vařeková</surname><given-names>R</given-names></name><name><surname>Bendová</surname><given-names>V</given-names></name><name><surname>Kleywegt</surname><given-names>GJ</given-names></name><name><surname>Velankar</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>Validation of ligands in macromolecular structures determined by X-ray crystallography</article-title><source>Acta Crystallographica. Section D, Structural Biology</source><volume>74</volume><fpage>228</fpage><lpage>236</lpage><pub-id pub-id-type="doi">10.1107/S2059798318002541</pub-id><pub-id pub-id-type="pmid">29533230</pub-id></element-citation></ref><ref id="bib58"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Smith</surname><given-names>JL</given-names></name><name><surname>Hendrickson</surname><given-names>WA</given-names></name><name><surname>Honzatko</surname><given-names>RB</given-names></name><name><surname>Sheriff</surname><given-names>S</given-names></name></person-group><year iso-8601-date="1986">1986</year><article-title>Structural heterogeneity in protein crystals</article-title><source>Biochemistry</source><volume>25</volume><fpage>5018</fpage><lpage>5027</lpage><pub-id pub-id-type="doi">10.1021/bi00366a008</pub-id><pub-id pub-id-type="pmid">3768328</pub-id></element-citation></ref><ref id="bib59"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Smola</surname><given-names>M</given-names></name><name><surname>Gutten</surname><given-names>O</given-names></name><name><surname>Dejmek</surname><given-names>M</given-names></name><name><surname>Kožíšek</surname><given-names>M</given-names></name><name><surname>Evangelidis</surname><given-names>T</given-names></name><name><surname>Tehrani</surname><given-names>ZA</given-names></name><name><surname>Novotná</surname><given-names>B</given-names></name><name><surname>Nencka</surname><given-names>R</given-names></name><name><surname>Birkuš</surname><given-names>G</given-names></name><name><surname>Rulíšek</surname><given-names>L</given-names></name><name><surname>Boura</surname><given-names>E</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Ligand strain and its conformational complexity is a major factor in the binding of cyclic dinucleotides to STING protein</article-title><source>Angewandte Chemie</source><volume>60</volume><fpage>10172</fpage><lpage>10178</lpage><pub-id pub-id-type="doi">10.1002/anie.202016805</pub-id><pub-id pub-id-type="pmid">33616279</pub-id></element-citation></ref><ref id="bib60"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Suryawanshi</surname><given-names>RK</given-names></name><name><surname>Jaishankar</surname><given-names>P</given-names></name><name><surname>Correy</surname><given-names>GJ</given-names></name><name><surname>Rachman</surname><given-names>MM</given-names></name><name><surname>O’Leary</surname><given-names>PC</given-names></name><name><surname>Taha</surname><given-names>TY</given-names></name><name><surname>Zapatero-Belinchón</surname><given-names>FJ</given-names></name><name><surname>McCavittMalvido</surname><given-names>M</given-names></name><name><surname>Doruk</surname><given-names>YU</given-names></name><name><surname>Stevens</surname><given-names>MGV</given-names></name><name><surname>Diolaiti</surname><given-names>ME</given-names></name><name><surname>Jogalekar</surname><given-names>MP</given-names></name><name><surname>Richards</surname><given-names>AL</given-names></name><name><surname>Montano</surname><given-names>M</given-names></name><name><surname>Rosecrans</surname><given-names>J</given-names></name><name><surname>Matthay</surname><given-names>M</given-names></name><name><surname>Togo</surname><given-names>T</given-names></name><name><surname>Gonciarz</surname><given-names>RL</given-names></name><name><surname>Gopalkrishnan</surname><given-names>S</given-names></name><name><surname>Neitz</surname><given-names>RJ</given-names></name><name><surname>Krogan</surname><given-names>NJ</given-names></name><name><surname>Swaney</surname><given-names>DL</given-names></name><name><surname>Shoichet</surname><given-names>BK</given-names></name><name><surname>Ott</surname><given-names>M</given-names></name><name><surname>Renslo</surname><given-names>AR</given-names></name><name><surname>Ashworth</surname><given-names>A</given-names></name><name><surname>Fraser</surname><given-names>JS</given-names></name></person-group><year iso-8601-date="2024">2024</year><article-title>The Mac1 ADP-ribosylhydrolase is a therapeutic target for SARS-CoV-2</article-title><source>bioRxiv</source><pub-id pub-id-type="doi">10.1101/2024.08.08.606661</pub-id></element-citation></ref><ref id="bib61"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Terwilliger</surname><given-names>TC</given-names></name><name><surname>Grosse-Kunstleve</surname><given-names>RW</given-names></name><name><surname>Afonine</surname><given-names>PV</given-names></name><name><surname>Moriarty</surname><given-names>NW</given-names></name><name><surname>Adams</surname><given-names>PD</given-names></name><name><surname>Read</surname><given-names>RJ</given-names></name><name><surname>Zwart</surname><given-names>PH</given-names></name><name><surname>Hung</surname><given-names>L-W</given-names></name></person-group><year iso-8601-date="2008">2008</year><article-title>Iterative-build OMIT maps: map improvement by iterative model building and refinement without model bias</article-title><source>Acta Crystallographica. Section D, Biological Crystallography</source><volume>64</volume><fpage>515</fpage><lpage>524</lpage><pub-id pub-id-type="doi">10.1107/S0907444908004319</pub-id><pub-id pub-id-type="pmid">18453687</pub-id></element-citation></ref><ref id="bib62"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tickle</surname><given-names>IJ</given-names></name></person-group><year iso-8601-date="2012">2012</year><article-title>Statistical quality indicators for electron-density maps</article-title><source>Acta Crystallographica. Section D, Biological Crystallography</source><volume>68</volume><fpage>454</fpage><lpage>467</lpage><pub-id pub-id-type="doi">10.1107/S0907444911035918</pub-id><pub-id pub-id-type="pmid">22505266</pub-id></element-citation></ref><ref id="bib63"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tong</surname><given-names>J</given-names></name><name><surname>Zhao</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Large-scale analysis of bioactive ligand conformational strain energy by <italic>Ab Initio</italic> calculation</article-title><source>Journal of Chemical Information and Modeling</source><volume>61</volume><fpage>1180</fpage><lpage>1192</lpage><pub-id pub-id-type="doi">10.1021/acs.jcim.0c01197</pub-id><pub-id pub-id-type="pmid">33630603</pub-id></element-citation></ref><ref id="bib64"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tosco</surname><given-names>P</given-names></name><name><surname>Stiefl</surname><given-names>N</given-names></name><name><surname>Landrum</surname><given-names>G</given-names></name></person-group><year iso-8601-date="2014">2014</year><article-title>Bringing the MMFF force field to the RDKit: implementation and validation</article-title><source>Journal of Cheminformatics</source><volume>6</volume><fpage>1</fpage><lpage>4</lpage><pub-id pub-id-type="doi">10.1186/s13321-014-0037-3</pub-id></element-citation></ref><ref id="bib65"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>van den Bedem</surname><given-names>H</given-names></name><name><surname>Dhanik</surname><given-names>A</given-names></name><name><surname>Latombe</surname><given-names>JC</given-names></name><name><surname>Deacon</surname><given-names>AM</given-names></name></person-group><year iso-8601-date="2009">2009</year><article-title>Modeling discrete heterogeneity in X-ray diffraction data by fitting multi-conformers</article-title><source>Acta Crystallographica. Section D, Biological Crystallography</source><volume>65</volume><fpage>1107</fpage><lpage>1117</lpage><pub-id pub-id-type="doi">10.1107/S0907444909030613</pub-id><pub-id pub-id-type="pmid">19770508</pub-id></element-citation></ref><ref id="bib66"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>van Zundert</surname><given-names>GCP</given-names></name><name><surname>Hudson</surname><given-names>BM</given-names></name><name><surname>de Oliveira</surname><given-names>SHP</given-names></name><name><surname>Keedy</surname><given-names>DA</given-names></name><name><surname>Fonseca</surname><given-names>R</given-names></name><name><surname>Heliou</surname><given-names>A</given-names></name><name><surname>Suresh</surname><given-names>P</given-names></name><name><surname>Borrelli</surname><given-names>K</given-names></name><name><surname>Day</surname><given-names>T</given-names></name><name><surname>Fraser</surname><given-names>JS</given-names></name><name><surname>van den Bedem</surname><given-names>H</given-names></name></person-group><year iso-8601-date="2018">2018</year><article-title>qFit-ligand reveals widespread conformational heterogeneity of drug-like molecules in X-Ray electron density maps</article-title><source>Journal of Medicinal Chemistry</source><volume>61</volume><fpage>11183</fpage><lpage>11198</lpage><pub-id pub-id-type="doi">10.1021/acs.jmedchem.8b01292</pub-id><pub-id pub-id-type="pmid">30457858</pub-id></element-citation></ref><ref id="bib67"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vinogradov</surname><given-names>AA</given-names></name><name><surname>Yin</surname><given-names>Y</given-names></name><name><surname>Suga</surname><given-names>H</given-names></name></person-group><year iso-8601-date="2019">2019</year><article-title>Macrocyclic peptides as drug candidates: recent progress and remaining challenges</article-title><source>Journal of the American Chemical Society</source><volume>141</volume><fpage>4167</fpage><lpage>4181</lpage><pub-id pub-id-type="doi">10.1021/jacs.8b13178</pub-id><pub-id pub-id-type="pmid">30768253</pub-id></element-citation></ref><ref id="bib68"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname><given-names>HW</given-names></name><name><surname>Wang</surname><given-names>JW</given-names></name></person-group><year iso-8601-date="2017">2017</year><article-title>How cryo-electron microscopy and X-ray crystallography complement each other</article-title><source>Protein Science</source><volume>26</volume><fpage>32</fpage><lpage>39</lpage><pub-id pub-id-type="doi">10.1002/pro.3022</pub-id><pub-id pub-id-type="pmid">27543495</pub-id></element-citation></ref><ref id="bib69"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname><given-names>S</given-names></name><name><surname>Witek</surname><given-names>J</given-names></name><name><surname>Landrum</surname><given-names>GA</given-names></name><name><surname>Riniker</surname><given-names>S</given-names></name></person-group><year iso-8601-date="2020">2020</year><article-title>Improving conformer generation for small rings and macrocycles based on distance geometry and experimental torsional-angle preferences</article-title><source>Journal of Chemical Information and Modeling</source><volume>60</volume><fpage>2044</fpage><lpage>2058</lpage><pub-id pub-id-type="doi">10.1021/acs.jcim.0c00025</pub-id><pub-id pub-id-type="pmid">32155061</pub-id></element-citation></ref><ref id="bib70"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wankowicz</surname><given-names>SA</given-names></name><name><surname>de Oliveira</surname><given-names>SH</given-names></name><name><surname>Hogan</surname><given-names>DW</given-names></name><name><surname>van den Bedem</surname><given-names>H</given-names></name><name><surname>Fraser</surname><given-names>JS</given-names></name></person-group><year iso-8601-date="2022">2022</year><article-title>Ligand binding remodels protein side-chain conformational heterogeneity</article-title><source>eLife</source><volume>11</volume><elocation-id>e74114</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.74114</pub-id><pub-id pub-id-type="pmid">35312477</pub-id></element-citation></ref><ref id="bib71"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wankowicz</surname><given-names>SA</given-names></name><name><surname>Fraser</surname><given-names>JS</given-names></name></person-group><year iso-8601-date="2024">2024a</year><article-title>Comprehensive encoding of conformational and compositional protein structural ensembles through the mmCIF data structure</article-title><source>IUCrJ</source><volume>11</volume><fpage>494</fpage><lpage>501</lpage><pub-id pub-id-type="doi">10.1107/S2052252524005098</pub-id><pub-id pub-id-type="pmid">38958015</pub-id></element-citation></ref><ref id="bib72"><element-citation publication-type="preprint"><person-group person-group-type="author"><name><surname>Wankowicz</surname><given-names>S</given-names></name><name><surname>Fraser</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2024">2024b</year><article-title>Comprehensive encoding of conformational and compositional protein structural ensembles through mmcif data structure</article-title><source>ChemRxiv</source><ext-link ext-link-type="uri" xlink:href="https://chemrxiv.org/engage/chemrxiv/article-details/6604af7c9138d231617aff11">https://chemrxiv.org/engage/chemrxiv/article-details/6604af7c9138d231617aff11</ext-link></element-citation></ref><ref id="bib73"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wankowicz</surname><given-names>SA</given-names></name><name><surname>Ravikumar</surname><given-names>A</given-names></name><name><surname>Sharma</surname><given-names>S</given-names></name><name><surname>Riley</surname><given-names>B</given-names></name><name><surname>Raju</surname><given-names>A</given-names></name><name><surname>Hogan</surname><given-names>DW</given-names></name><name><surname>Flowers</surname><given-names>J</given-names></name><name><surname>van den Bedem</surname><given-names>H</given-names></name><name><surname>Keedy</surname><given-names>DA</given-names></name><name><surname>Fraser</surname><given-names>JS</given-names></name></person-group><year iso-8601-date="2024">2024c</year><article-title>Automated multiconformer model building for X-ray crystallography and cryo-EM</article-title><source>eLife</source><volume>12</volume><elocation-id>RP90606</elocation-id><pub-id pub-id-type="doi">10.7554/eLife.90606</pub-id><pub-id pub-id-type="pmid">38904665</pub-id></element-citation></ref><ref id="bib74"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yudin</surname><given-names>AK</given-names></name></person-group><year iso-8601-date="2015">2015</year><article-title>Macrocycles: lessons from the distant past, recent developments, and future directions</article-title><source>Chemical Science</source><volume>6</volume><fpage>30</fpage><lpage>49</lpage><pub-id pub-id-type="doi">10.1039/c4sc03089c</pub-id><pub-id pub-id-type="pmid">28553456</pub-id></element-citation></ref><ref id="bib75"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhao</surname><given-names>J</given-names></name><name><surname>Cochrane</surname><given-names>CS</given-names></name><name><surname>Najeeb</surname><given-names>J</given-names></name><name><surname>Gooden</surname><given-names>D</given-names></name><name><surname>Sciandra</surname><given-names>C</given-names></name><name><surname>Fan</surname><given-names>P</given-names></name><name><surname>Lemaitre</surname><given-names>N</given-names></name><name><surname>Newns</surname><given-names>K</given-names></name><name><surname>Nicholas</surname><given-names>RA</given-names></name><name><surname>Guan</surname><given-names>Z</given-names></name><name><surname>Thaden</surname><given-names>JT</given-names></name><name><surname>Fowler</surname><given-names>VG</given-names><suffix>Jr</suffix></name><name><surname>Spasojevic</surname><given-names>I</given-names></name><name><surname>Sebbane</surname><given-names>F</given-names></name><name><surname>Toone</surname><given-names>EJ</given-names></name><name><surname>Duncan</surname><given-names>C</given-names></name><name><surname>Gammans</surname><given-names>R</given-names></name><name><surname>Zhou</surname><given-names>P</given-names></name></person-group><year iso-8601-date="2023">2023</year><article-title>Preclinical safety and efficacy characterization of an LpxC inhibitor against Gram-negative pathogens</article-title><source>Science Translational Medicine</source><volume>15</volume><elocation-id>eadf5668</elocation-id><pub-id pub-id-type="doi">10.1126/scitranslmed.adf5668</pub-id><pub-id pub-id-type="pmid">37556556</pub-id></element-citation></ref><ref id="bib76"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhou</surname><given-names>P</given-names></name><name><surname>Hong</surname><given-names>J</given-names></name></person-group><year iso-8601-date="2021">2021</year><article-title>Structure- and ligand-dynamics-based design of novel antibiotics targeting lipid a enzymes LpxC and LpxH in gram-negative bacteria</article-title><source>Accounts of Chemical Research</source><volume>54</volume><fpage>1623</fpage><lpage>1634</lpage><pub-id pub-id-type="doi">10.1021/acs.accounts.0c00880</pub-id><pub-id pub-id-type="pmid">33720682</pub-id></element-citation></ref></ref-list></back><sub-article article-type="editor-report" id="sa0"><front-stub><article-id pub-id-type="doi">10.7554/eLife.103797.3.sa0</article-id><title-group><article-title>eLife Assessment</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Graña</surname><given-names>Martin</given-names></name><role specific-use="editor">Reviewing Editor</role><aff><institution-wrap><institution-id institution-id-type="ror">https://ror.org/04dpm2z73</institution-id><institution>Institut Pasteur de Montevideo</institution></institution-wrap><country>Uruguay</country></aff></contrib></contrib-group><kwd-group kwd-group-type="evidence-strength"><kwd>Solid</kwd></kwd-group><kwd-group kwd-group-type="claim-importance"><kwd>Valuable</kwd></kwd-group></front-stub><body><p>The work presents a <bold>valuable</bold> extension of qFit-ligand, a computational method for modeling conformational heterogeneity of ligands in X-ray crystallography and cryo-EM density maps. The authors provide <bold>solid</bold> evidence of improved capabilities through careful validation against the previous version, particularly in expanding ligand sampling within conformational space. Such improvements suggest practical utility for challenging applications, including macrocyclic compound modeling and crystallographic drug fragment screening.</p></body></sub-article><sub-article article-type="referee-report" id="sa1"><front-stub><article-id pub-id-type="doi">10.7554/eLife.103797.3.sa1</article-id><title-group><article-title>Reviewer #1 (Public review):</article-title></title-group><contrib-group><contrib contrib-type="author"><anonymous/><role specific-use="referee">Reviewer</role></contrib></contrib-group></front-stub><body><p>Summary:</p><p>Flowers et al describe an improved version of qFit-ligand, an extension of qFit. qFit and qFit-ligand seek to model conformational heterogeneity of proteins and ligands, respectively, cryo-EM and X-ray (electron) density maps using multiconformer models-essentially extensions of the traditional alternate conformer approach in which substantial parts of the protein or ligand are kept in place. By contrast, ensemble approaches represent conformational heterogeneity through a superposition of independent molecular conformations.</p><p>The authors provide a clear and systematic description of the improvements made to the code, most notably the implementation of a different conformer generator algorithm centered around RDKit. This approach yields modest improvements in the strain of the proposed conformers (meaning that more physically reasonable conformations are generated than with the &quot;old&quot; qFit-ligand) and real space correlation of the model with the experimental electron density maps, indicating that the generated conformers also better explain the experimental data then before. In addition, the authors expand the scope of ligands that can be treated, most notably allowing for multi conformer modeling of macrocyclic compounds.</p><p>Strengths:</p><p>The manuscript is well written, provides a thorough analysis, and represents a needed improvement of our collective ability to model small-molecule binding to macromolecules based on cryo-EM and X-ray crystallography, and can therefore has a positive impact on both drug discovery and general biological research.</p><p>Weaknesses:</p><p>Weaknesses were addressed during review. Overall, the demonstrated performance gains are modest.</p><p>Specific comments:</p><p>(1) The accuracy of initial placement may be critical. At the same time, in my experience ambiguous cases are quite common, for example with flat ligands with a few substituents sticking out or with ligands with highly mobile tails. There remain some questions regarding sensitivity to initial ligand placement, which individual users should check for.</p></body></sub-article><sub-article article-type="referee-report" id="sa2"><front-stub><article-id pub-id-type="doi">10.7554/eLife.103797.3.sa2</article-id><title-group><article-title>Reviewer #3 (Public review):</article-title></title-group><contrib-group><contrib contrib-type="author"><anonymous/><role specific-use="referee">Reviewer</role></contrib></contrib-group></front-stub><body><p>Summary:</p><p>The manuscript by Flowers et al. aimed to enhance the accuracy of automated ligand model building by refining the qFit-ligand algorithm. Recognizing that ligands can exhibit conformational flexibility even when bound to receptors, the authors developed a bioinformatic pipeline to model alternate ligand conformations while improving fitting and more energetically favorable conformations.</p><p>Strengths:</p><p>The authors present a computational pipeline designed to automatically model and fit ligands into electron density maps, identifying potential alternative conformations within the structures.</p><p>Weaknesses:</p><p>Ligand modeling, particularly in cases of poorly defined electron density, remains a challenging task. The procedure presented in this manuscript exhibits limitations in low-resolution electron density maps (lower than 2.0 Å) and low-occupancy scenarios. Considering that the maps used to establish the operational bounds of qFit-ligand were synthetically generated, it's likely that the resolution cutoff will be even stricter when applied to real-world data.</p></body></sub-article><sub-article article-type="author-comment" id="sa3"><front-stub><article-id pub-id-type="doi">10.7554/eLife.103797.3.sa3</article-id><title-group><article-title>Author response</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Flowers</surname><given-names>Jessica</given-names></name><role specific-use="author">Author</role><aff><institution>University of California San Francisco</institution><addr-line><named-content content-type="city">San Francisco</named-content></addr-line><country>United States</country></aff></contrib><contrib contrib-type="author"><name><surname>Echols</surname><given-names>Nathaniel</given-names></name><role specific-use="author">Author</role><aff><institution>University of California San Francisco</institution><addr-line><named-content content-type="city">San Francisco</named-content></addr-line><country>United States</country></aff></contrib><contrib contrib-type="author"><name><surname>Correy</surname><given-names>Galen J</given-names></name><role specific-use="author">Author</role><aff><institution>Department of Bioengineering and Therapeutic Sciences, University of California San Francisco, San Francisco, CA 94158</institution><addr-line><named-content content-type="city">San Francisco</named-content></addr-line><country>United States</country></aff></contrib><contrib contrib-type="author"><name><surname>Jaishankar</surname><given-names>Priyadarshini</given-names></name><role specific-use="author">Author</role><aff><institution>University of California, San Francisco</institution><addr-line><named-content content-type="city">San Francisco</named-content></addr-line><country>United States</country></aff></contrib><contrib contrib-type="author"><name><surname>Togo</surname><given-names>Takaya</given-names></name><role specific-use="author">Author</role><aff><institution>Department of Pharmaceutical Chemistry, University of California San Francisco, San Francisco, CA 94158</institution><addr-line><named-content content-type="city">San Francisco</named-content></addr-line><country>United States</country></aff></contrib><contrib contrib-type="author"><name><surname>Renslo</surname><given-names>Adam R</given-names></name><role specific-use="author">Author</role><aff><institution>University of California, San Francisco</institution><addr-line><named-content content-type="city">San Francisco</named-content></addr-line><country>United States</country></aff></contrib><contrib contrib-type="author"><name><surname>van den Bedem</surname><given-names>Henry</given-names></name><role specific-use="author">Author</role><aff><institution>Atomwise, Inc</institution><addr-line><named-content content-type="city">San Francisco</named-content></addr-line><country>United States</country></aff></contrib><contrib contrib-type="author"><name><surname>Fraser</surname><given-names>James S</given-names></name><role specific-use="author">Author</role><aff><institution>University of California, San Francisco</institution><addr-line><named-content content-type="city">San Francisco</named-content></addr-line><country>United States</country></aff></contrib><contrib contrib-type="author"><name><surname>Wankowicz</surname><given-names>Stephanie A</given-names></name><role specific-use="author">Author</role><aff><institution>University of California, San Francisco</institution><addr-line><named-content content-type="city">San Francisco</named-content></addr-line><country>United States</country></aff></contrib></contrib-group></front-stub><body><p>The following is the authors’ response to the original reviews</p><disp-quote content-type="editor-comment"><p><bold>Public Reviews:</bold></p><p><bold>Reviewer #1 (Public review):</bold></p><p>Summary:</p><p>Flowers et al describe an improved version of qFit-ligand, an extension of qFit. qFit and qFit-ligand seek to model conformational heterogeneity of proteins and ligands, respectively, cryo-EM and X-ray (electron) density maps using multi-conformer models - essentially extensions of the traditional alternate conformer approach in which substantial parts of the protein or ligand are kept in place. By contrast, ensemble approaches represent conformational heterogeneity through a superposition of independent molecular conformations.</p><p>The authors provide a clear and systematic description of the improvements made to the code, most notably the implementation of a different conformer generator algorithm centered around RDKit. This approach yields modest improvements in the strain of the proposed conformers (meaning that more physically reasonable conformations are generated than with the &quot;old&quot; qFit-ligand) and real space correlation of the model with the experimental electron density maps, indicating that the generated conformers also better explain the experimental data than before. In addition, the authors expand the scope of ligands that can be treated, most notably allowing for multi-conformer modeling of macrocyclic compounds.</p><p>Strengths:</p><p>The manuscript is well written, provides a thorough analysis, and represents a needed improvement of our collective ability to model small-molecule binding to macromolecules based on cryo-EM and X-ray crystallography, and can therefore have a positive impact on both drug discovery and general biological research.</p><p>Weaknesses:</p><p>There are several points where the manuscript needs clarification in order to better understand the merits of the described work. Overall the demonstrated performance gains are modest (although the theoretical ceiling on gains in model fit and strain energy are not clear!).</p></disp-quote><p>We thank the reviewer for their thoughtful review. To address comments, we have added clarifying statements and discussion points around the extent of performance gains, our choice of benchmarking metrics, and the “standards” in the field for significance. We expanded our analysis to highlight how to use qFit ligand in “discovery” mode, which is aimed at supporting individual modeling efforts. As we now write in the discussion:</p><p>“It is advisable to employ qFit-ligand selectively, focusing on cases with a moderate correlation between your input model and the experimental data, strong visual density in the binding pocket, high map resolution, or when your single-conformer ligand model is strained.”</p><p>Additionally, we note in the discussion:</p><p>“qFit-ligand primarily serves as a “thought partner” for manual modeling. Modelers still must resolve many ambiguities, including initial ligand placement, to fully take advantage of qFit capabilities. In active modeling workflows or large scale analyses, the workflow would only accept the output of qFit-ligand when it improves model quality. In cases where qFit-ligand degrades map-to-model fit and/or strain, we can simply revert to the input model. In practice, users can easily remove poorly fitting conformations using molecular modeling software such as COOT, while keeping the well modeled conformations, which is an advantage of the multiconformer approach over ensemble refinement methods.”</p><disp-quote content-type="editor-comment"><p><bold>Reviewer #2 (Public review):</bold></p><p>Summary:</p><p>The manuscript by Flowers et al. aimed to enhance the accuracy of automated ligand model building by refining the qFit-ligand algorithm. Recognizing that ligands can exhibit conformational flexibility even when bound to receptors, the authors developed a bioinformatic pipeline to model alternate ligand conformations while improving fitting and more energetically favorable conformations.</p><p>Strengths:</p><p>The authors present a computational pipeline designed to automatically model and fit ligands into electron density maps, identifying potential alternative conformations within the structures.</p><p>Weaknesses:</p><p>Ligand modeling, particularly in cases of poorly defined electron density, remains a challenging task. The procedure presented in this manuscript exhibits clear limitations in low-resolution electron density maps (resolution &gt; 2.0 Å) and low-occupancy scenarios, significantly restricting its applicability. Considering that the maps used to establish the operational bounds of qFit-ligand were synthetically generated, it's likely that the resolution cutoff will be even stricter when applied to real-world data.</p></disp-quote><p>We thank Reviewer #2 for their comments on the role of conformational flexibility and how our tool addresses the complexity involved in modeling alternative conformations. We agree that there are limitations at low resolution, limiting the application of our algorithm. That is the case with all structural biology tools. Automatically finding alternative conformations of ligands in high-resolution structures is an enhancement to the toolbox of ligand fitting. Expanding the algorithm to work with fragment screening data is important in this realm, as almost all of this data fits in the high-resolution range where qFit-ligand works best.</p><disp-quote content-type="editor-comment"><p>The reported changes in real-space correlation coefficients (RSCC) are not substantial, especially considering a cutoff of 0.1. Furthermore, the significance of improvements in the strain metric remains unclear. A comprehensive analysis of the distribution of this metric across the Protein Data Bank (PDB) would provide valuable insights.</p></disp-quote><p>We agree that the changes are small, partially because the baseline (manually modeled ligands) is very high. To provide additional evidence, we added evaluations using EDIAm, which is a more sensitive metric. In Figure 2 (page 10), representing the development dataset, we see more improvements above 0.1. With this being said, it is unclear what constitutes a ‘substantial’ improvement for either of these metrics, especially considering alternative conformations may only change the coordinates of a subset of ligands, just slightly improving the fit to density.</p><p>We agree that looking across the PDB on strain would provide valuable insight. To explore this, we looked to see how qFit-ligand could improve the fitting of deposited ligands with high strain (see section: Evaluating qFit-ligand on a set of structures known to be highly strained, Page 15). While only a subset of these structures had alternative conformers placed (24.6%), we observed that in this subset, the ligands often improved the RSCC and strain. This figure also demonstrates that while RSCC may not change much numerically, the alternative conformers explain previously unexplained density with lower energy conformers than what is currently deposited.</p><disp-quote content-type="editor-comment"><p>To mitigate the risk of introducing bias by avoiding real strained ligand conformations, the authors should demonstrate the effectiveness of the new procedure by testing it on known examples of strained ligand-substrate complexes.</p></disp-quote><p>See above.</p><disp-quote content-type="editor-comment"><p><bold>Recommendations for the authors:</bold></p><p><bold>Reviewer #1 (Recommendations for the authors):</bold></p><p>A - Specific comments:</p><p>(1) It appears necessary to provide qFit-ligand with an initial model with the ligand already placed. This is not clear from the start of the introduction on page 3. It appears that ligand position is only weakly adjusted fairly late in the process, in step F of Figure 1. It seems, therefore, that the accuracy of initial placement is rather critical (see the example discussed on page 21). At the same time, in my experience, ambiguous cases are quite common, for example with flat ligands with a few substituents sticking out or with ligands with highly mobile tails. It would be helpful for the authors to comment on the sensitivity to initial ligand placement, either in the discussion or, better yet, in the form of an analysis in which the starting model position is randomly perturbed.</p></disp-quote><p>In our revised version, we have modified the introduction to clarify the necessity of including an initial ligand model (page 4).</p><p>“The qFit-ligand algorithm takes as input a crystal or cryo-EM structure of an initial protein-ligand complex with a single conformer ligand in PDBx/mmCIF format, a density map or structure factors (encoded by a ccp4 formatted map or an MTZ), and a SMILES string for the ligand.”</p><p>We also describe our sampling algorithm more clearly (see: Biasing Conformer Generation, page 6). Steps A-E generate many conformations (using RDKit), which are then selected/fit into experimental density (using quadratic programming). To help with additional shifting issues in the input ligand, after the first selection, we do additional rotation/translation of the generated conformers that are kept. We then do another round of fitting to the density (quadratic programming followed by mixed integer quadratic programming).</p><p>Given this sampling, we have not elected to do an additional computational experiment to test the “radius of convergence” or dependence on initial conditions. However, we outline the fundamental procedure here so that someone can build on the work and test the idea:</p><p>- Create single conformer models as we currently do</p><p>- randomly perturb the coordinates of the ligand by 0.1-0.3Å</p><p>- refine to convergence, creating a series of “perturbed, modified true positives” for each dataset</p><p>- Run qFit ligand</p><p>- Evaluate the variability in the resulting multi-conformer models</p><disp-quote content-type="editor-comment"><p>(2) Top of page 6 (&quot;Biasing Conformer Generation&quot;): the authors say &quot;as we only want to generate ligands that physically fit within the protein binding pocket, we bias conformation generation towards structures more likely to fit well within the receptor's binding site&quot;. Apart from the odd redundancy of this sentence, I am confused: at the stage that seems to be referred to here (A-C in Figure 1) is the fit to the electron density already taken into account, or does this only happen later (after step E)?</p></disp-quote><p>Thank you for pointing this out. We have edited the statement to clarify it:</p><p>“To guide the conformation generation from the Chem.rdDistGeom based on the ligand type and protein pocket, we developed a suite of specialized sampling functions to bias the conformational search towards structures more likely to fit well into the receptor’s binding site.”</p><p>We do not consider the electron density during conformer generation (only selection from the generated conformers). The sampling is additionally biased by the type of ligand and the size of the binding pocket.</p><disp-quote content-type="editor-comment"><p>(3) qFit-ligand appears to be quite slow. Are there prospects for speedup? Can the code take advantage of GPUs or multi-CPU environments?</p></disp-quote><p>We agree with this. We have made some algorithmic improvements, most notably removing duplicate conformers based on root mean squared distance. This, along with parallelization, decreased the average runtime from ~19 minutes to ~8 minutes (see additional details: qFit-ligand runtime, page 8). We do not currently take advantage of GPU specific code.</p><disp-quote content-type="editor-comment"><p>(4) Section: Detection of experimental true positive multi-conformer ligands:</p><p>a) Why are carbohydrate ligands excluded? This seems like an important class of ligands that one would like qFit to be able to treat! Which brings me to a related question: can covalently attached groups (e.g., glycosylation sites!) be modeled using qFit-ligand, or is qFit-ligand restricted to non-covalently bound groups?</p></disp-quote><p>Currently, qFit-ligand does not support covalently bound ligands, but this is an area of interest we are hoping to expand into. In the revised version, we added the non-covalently attached carbohydrates back into the true positive dataset. In Figure 4 (page 14), we show that qFit-ligand is able to improve fit to the experimental density in around 80% of structures, while also often reducing torsion strain (see additional details: qFit-ligand applied to unbiased dataset of experimental true positives, page 14).</p><disp-quote content-type="editor-comment"><p>b) &quot;as well as 758 cases where the ligand model's deposited alternate conformations (altlocs) were not bound in the same chain and residue number&quot; - I do not understand what this means, or why it leads to the exclusion of so many structures. Likewise, a number of additional exclusions are described in Figure S3. Some more background on why these all happened would be helpful. Are you just left with the &quot;easy&quot; cases?</p></disp-quote><p>Sometimes modelers will list the multiple conformations of a bound ligand as a separate residue within the PDB file, rather than as a single multiconformer model. For example, rather than writing a multiconformer LIG bound at A, 201 with altlocs ‘A’ and ‘B’, a modeler might write this instead as LIG, A, 201 and LIG A, 301. We initially excluded these kinds of structures. However, we agree that this choice resulted in the removal of many potentially valid true positives. We have since updated our data processing pipeline to include these cases, and they are examined in the updated manuscript.</p><disp-quote content-type="editor-comment"><p>c) I do not follow the argument made at the end of this section (last two paragraphs on page 9): &quot;when using a single average conformation to describe density from multiple conformations, the true low-energy states may be ignored&quot;. I get that, but the conformations in the &quot;modified true positives&quot; dataset derive directly from models in which two conformations were modeled, so this cannot be the explanation for why qFit-ligand models result in somewhat lower average strain. It would seem that the paper could be served by providing examples where single conformations were modeled in deposited structures, but qFit detects multiple conformations.</p></disp-quote><p>We agree with this comment that the strain obtained from the modified true positives is likely higher than the deposited models. However, the modified structure is refined with a single conformation, and therefore changed from the deposited “A” conformation. Thus, the reduced strain observed in our qFit-ligand models relative to the modified true positives is not unexpected.</p><p>To expand our dataset, we also looked at deposited structures with high strain, all of which were modeled as single conformers. Here, we saw a decrease in strain when alternative conformers were placed (see section: Evaluating qFit-ligand on a set of structures known to be highly strained, page 15). Further, we provide an example from the XGen macrocycle dataset where a ligand initially modeled as a single conformer exhibited relatively high strain. After qFit‐ligand modeled a second conformation, the overall strain was reduced (Figure 6C, page 19; Figure 6—figure supplement 1C, page 59).</p><disp-quote content-type="editor-comment"><p>(5) Section: qFit-ligand applied to an unbiased dataset of experimental true positives Bottom of page 14: The paragraph starting with &quot;qFit-ligand shows particular strength in scenarios with strong evidence...&quot; is enigmatic: there's no illustration (unless it directly relates to the findings in Figure 4, in which case this should be more explicit). Since this points out when the reader will and will not benefit from using qFit-ligand, it should be clear what the authors are talking about.</p></disp-quote><p>This claim considers all the evidence presented in the manuscript, not necessarily one particular aspect of it. We advise using qFit-ligand when there is a moderate correlation between the input model and the experimental data, strong visual density in the binding pocket, high map resolution, and/or when your single conformer ligand model is strained. We have made all of these points clearer in the updated manuscript.</p><disp-quote content-type="editor-comment"><p>B - Section: qFit-ligand can automatically detect and model multiple conformations of macrocycles:</p><p>This is an exciting extension of qFit-ligand, but some aspects of the analysis strike me as worrisome. Of the initial dataset of 150 structures, fewer than half make it all the way through analysis. It's hard to believe that this is a fully representative subset. Why, for example, could 29 structures not be refined against the deposited structure factors? Why does strain calculation (in RDKit?) fail on 30 ligands? What about the other 18 cases--why did these fail (in PHENIX?).</p></disp-quote><p>We agree that this is a striking number of failures, however, we note that they are not specific shortcomings of qFit-ligand (in fact, most are because standard structural biology and/or cheminformatics software fail on many PDB depositions). Therefore, these failures reflect broader limitations in standard bioinformatics and refinement restraint files when handling macrocycles. The strain calculator we used was not built for macrocycles, and after consulting with many experts in the field, the consensus was that no method works well with macrocycles. We discuss these issues in additional detail in the discussion (page 27):</p><p>“Additionally, our algorithm’s placement within the larger refinement and ligand modeling ecosystem highlighted other areas that need improvement. We note that macrocycles, due to their complicated and interconnected degrees of freedom, suffer acutely from the refinement issues, as demonstrated by the failure of approximately one-third of datasets in our standard preparation or post-refinement pipelines due to ligand parameterization issues. Many of these stemmed from problematic ligand restraint files, highlighting the difficulty of encoding the geometric constraints of macrocycles using standard restraint libraries. Improved force-field or restraints for macrocycles are desperately needed to improve their modeling.”</p><disp-quote content-type="editor-comment"><p>C - Minor issues:</p><p>(1) &quot;Fragment-soaked event maps&quot; - this is a semantically strange section title!</p></disp-quote><p>We have updated the section title in our revised manuscript. The new title is ‘qFit-ligand recovers heterogeneity in fragment-soaked event maps’.</p><disp-quote content-type="editor-comment"><p>(2) Too many digits! All over the manuscript, percentages are displayed with 0.01% precision, while these mostly refer to datasets with ~150 structures. Shifting just one structure from one category to another changes these percentages by nearly 1%.</p></disp-quote><p>We have updated the sig figs in our revised manuscript.</p><disp-quote content-type="editor-comment"><p>(3) The authors are keen to classify decreases in RSCC as significant only when these changes exceed 0.1, but do not apply the same standard for increases. For instance, in Figure 4B if we were to classify improvements as significant if ΔRSCC &gt; 0.1, there would be fewer significant improvements than decreases in performance (although it is visually clear that for most datasets things get better. Similarly, in Figure 5A if we were to classify improvements as significant if ΔRSCC &gt; 0.1, qFit-ligand would only yield significant improvements for two out of 73 cases-not a lot).</p></disp-quote><p>We agree with the reviewer that there needs to be more consistency in our analysis of improvements/deteriorations. However, we note that operationally, when the decreases in model quality are observed, the modeler would simply reject the new model in favor of the input model. We have added to the discussion:</p><p>“In active modeling workflows or large scale analyses, the workflow would only accept the output of qFit-ligand when it improves model quality. In cases where qFit-ligand degrades map-to-model fit and/or strain, we can simply revert to the input model. In practice, users can easily remove poorly fitting conformations using molecular modeling software such as COOT, while keeping the well modeled conformations, which is an advantage of the multiconformer approach over ensemble refinement methods.”</p><p>There is generally no consensus in the field as to what might indicate a ‘significant’ change in RSCC, and any threshold we choose would be arbitrary. We note that in our manuscript, we had previously characterized a decrease in RSCC to be ‘significant’ if it exceeded 0.1. However, as there is no real scientific justification for this cutoff, or any cutoff, we moved away from this framing in the revised manuscript. Therefore, we just classify if we improve RSCC. For example, on page 9:</p><p>“qFit-ligand modeled an alternative conformation in 72.5% (n=98) of structures. Compared with the modified true positive models, 83.7% (n=113) of qFit-ligand models have a better RSCC and 77.0% (n=104) structures saw an improvement in EDIAm, representing an improved fit to experimental data in the vast majority of structures.”</p><p>In addition, we have conducted additional experiments using more sensitive metrics (EDIAm) to further illustrate qFit-ligand’s performance.</p><disp-quote content-type="editor-comment"><p>(4) Small peptides are not discussed as a class of ligands, although these are quite common.</p></disp-quote><p>Canonical peptides can be modeled with standard qFit. Non-canonical peptides present failure modes similar to the macrocycles discussed above, with a mix of ATOM and HETATM records and the need for custom cif definitions and link records. For these reasons we have not included an analysis outside of the macrocycle section. We have noted this caveat in the discussion:</p><p>“We note that even linear non-canonical peptides present similar failure modes to macrocycles, with a mix of ATOM and HETATM records and the need for custom cif definitions and link records. For these reasons, we did not include analysis on small peptide ligands; however, canonical peptides can be modeled with standard qFit [8].”</p><disp-quote content-type="editor-comment"><p>(5) Top of page 10: &quot;while refinement improves&quot;: what kind of refinement does this refer to?</p></disp-quote><p>This refers to refinement with Phenix. We have updated this language to reflect this (page 8). “We refer to these altered structures as our ‘modified true positives’, which we use as input to qFit-ligand, and subsequent refinement using Phenix.”</p><disp-quote content-type="editor-comment"><p>(6) Bottom of page 11: &quot;they often did&quot; -&gt; &quot;it often did&quot;</p></disp-quote><p>We have made this change in the revised version.</p><disp-quote content-type="editor-comment"><p>(7) Top of page 14: RMSDs and B factors do have units.</p></disp-quote><p>We have added the units in our revision.</p><disp-quote content-type="editor-comment"><p>(8) Top of page 24. In the generation of a composite omit map, why are new Rfree flags being generated? Did I misunderstand that?</p></disp-quote><p><italic>r_free_flags.generate=True</italic> only creates R-free flags if they are not present in the input file as is the case for many (especially older) PDB depositions.</p><disp-quote content-type="editor-comment"><p>(9) Bottom of page 27: how large is the mask? Presumably when alt confs of the ligand are possible, it would be helpful for the mask to cover those?</p></disp-quote><p>We agree that this mask should be updated. In our revision, we define the mask around the coordinates of the full qFit-ligand ensemble. The same mask is used to calculate the RSCC of the input (single conformer) model versus the qFit-ligand model.</p><disp-quote content-type="editor-comment"><p>(10) Middle of page 29: &quot;These structure factors are then used to compute synthetic electron density maps.&quot; - It is not clear whether the following three sentences are an explanation of the details of that statement or rather things that are done afterwards.</p></disp-quote><p>We clarify this in the manuscript (page 36).</p><p>“These structure factors are then used to compute synthetic electron density maps. To each of these maps, we generate and add random Gaussian noise values scaled proportionally to the resolution. This scaling reflects the escalation of experimental noise as resolution deteriorates, a common occurrence in real-life crystallographic data.”</p><disp-quote content-type="editor-comment"><p>(11) Chemical synthesis: I am not qualified to assess this and am surprised to see some much detail here rather than in some other manuscript. Are the corresponding structures deposited anywhere?</p></disp-quote><p>All of the structures we discuss in this manuscript are deposited in the PDB and listed in Supplementary Table 5.</p><disp-quote content-type="editor-comment"><p><bold>Reviewer #2 (Recommendations for the authors):</bold></p><p>The data should consistently present the number of structures that exhibit improvements or deterioration in particular metrics, like RSCC and strain, using a cutoff that should be significant. For instance, stating that &quot;85.93% (n=116) of structures having a better RSCC in the qFit-ligand models compared to the modified true positive models&quot; without clarifying the magnitude of improvement (e.g., a marginal increase of 0.01 in RSCC) lacks meaningful context. The figures should clearly indicate the specific cutoff values used for each metric. The accompanying text should provide a detailed explanation for the selection of these cutoff values, justifying their significance in the context of the study.</p><p>Currently, there is no established consensus within the field on what constitutes a 'significant' improvement in RSCC or strain values. As such, we chose not to impose an arbitrary cutoff and just look at which structures improve RSCC. We also removed all language stating significance, as there isn’t a good standard in the field to assess significance. This is especially important as only improvements would be considered in an active modeling project. In cases where qFit ligand degrades the RSCC (or strain) to a large extent, the modeler would simply revert to the input model.</p><p>In the first section of Results: &quot;First, for all ligands, we perform an unconstrained search function allowing the generated conformers to only be constrained from the bounds matrix (Figure 1A). This is particularly advantageous for small ligands that benefit from less restriction to fully explore their conformational space. We then perform a fixed terminal atoms search function (Figure 1B).&quot; It is unclear whether a fixed terminal atom search was conducted for each conformer generated in the initial step to further explore the conformational space. This aspect should be clarified to provide a more comprehensive understanding of the methodology.</p></disp-quote><p>Each independent conformer generation function (A-E) is initialized with only the input ligand model and runs in parallel with the other functions. These functions do not build on each other, but rather perturb the input molecule independently of one another. In our updated manuscript, we have clarified the methodology (page 6).</p><p>“First, in all cases, we perform an unconstrained search function (Figure 1A), a fixed terminal atoms search function (Figure 1B), and a blob search function (Figure 1C).”</p><disp-quote content-type="editor-comment"><p>Phrase: &quot;We randomly sampled 150 structures and, after manual inspection of the fit of alternative conformations, chose 135 crystal structures as a development set for improving qFit-ligand.&quot; The authors should explain why they filtered 10% of the structures.</p></disp-quote><p>To develop qFit-ligand, we wanted to use a very high-quality dataset. We needed to know with some degree of certainty that if qFit-ligand failed to produce an alternate conformation (or generated conformations low in RSCC or high in strain), the failure was due to an algorithmic limitation rather than poor-quality input data. Therefore, after selection based on numerical metrics, we manually examined each ligand in Coot to observe if we believed the alternative conformers fit well into the density.</p></body></sub-article></article>