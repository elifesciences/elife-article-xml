<?xml version="1.0" ?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.3 20210610//EN"  "JATS-archivearticle1-mathml3.dtd"><article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.3" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="nlm-ta">elife</journal-id>
<journal-id journal-id-type="publisher-id">eLife</journal-id>
<journal-title-group>
<journal-title>eLife</journal-title>
</journal-title-group>
<issn publication-format="electronic" pub-type="epub">2050-084X</issn>
<publisher>
<publisher-name>eLife Sciences Publications, Ltd</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">88640</article-id>
<article-id pub-id-type="doi">10.7554/eLife.88640</article-id>
<article-id pub-id-type="doi" specific-use="version">10.7554/eLife.88640.1</article-id>
<article-version-alternatives>
<article-version article-version-type="publication-state">reviewed preprint</article-version>
<article-version article-version-type="preprint-version">1.2</article-version>
</article-version-alternatives>
<article-categories>
<subj-group subj-group-type="heading">
<subject>Structural Biology and Molecular Biophysics</subject>
</subj-group>
</article-categories>
<title-group>
<article-title>Optimized path planning surpasses human efficiency in cryo-EM imaging</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-6280-8019</contrib-id>
<name>
<surname>Li</surname>
<given-names>Yilai</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="author-notes" rid="n1">*</xref>
<xref ref-type="author-notes" rid="n2">†</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Fan</surname>
<given-names>Quanfu</given-names>
</name>
<xref ref-type="aff" rid="a2">2</xref>
<xref ref-type="author-notes" rid="n1">*</xref>
<xref ref-type="author-notes" rid="n3">‡</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Xu</surname>
<given-names>Ziping</given-names>
</name>
<xref ref-type="aff" rid="a3">3</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Lee</surname>
<given-names>Emma Rose</given-names>
</name>
<xref ref-type="aff" rid="a4">4</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Cohn</surname>
<given-names>John</given-names>
</name>
<xref ref-type="aff" rid="a2">2</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Demers</surname>
<given-names>Veronique</given-names>
</name>
<xref ref-type="aff" rid="a2">2</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Lee</surname>
<given-names>Ja Young</given-names>
</name>
<xref ref-type="aff" rid="a2">2</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Yip</surname>
<given-names>Lucy</given-names>
</name>
<xref ref-type="aff" rid="a2">2</xref>
</contrib>
<contrib contrib-type="author" corresp="yes">
<name>
<surname>Cianfrocco</surname>
<given-names>Michael A.</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="aff" rid="a5">5</xref>
<xref ref-type="corresp" rid="cor1">#</xref>
</contrib>
<contrib contrib-type="author" corresp="yes">
<name>
<surname>Vos</surname>
<given-names>Seychelle M.</given-names>
</name>
<xref ref-type="aff" rid="a4">4</xref>
<xref ref-type="corresp" rid="cor1">#</xref>
</contrib>
<aff id="a1"><label>1</label><institution>Life Sciences Institute, University of Michigan</institution>, Ann Arbor, MI <country>USA</country></aff>
<aff id="a2"><label>2</label><institution>MIT-IBM Watson AI Lab</institution>, Cambridge, MA <country>USA</country></aff>
<aff id="a3"><label>3</label><institution>Department of Statistics, University of Michigan</institution>, Ann Arbor, MI <country>USA</country></aff>
<aff id="a4"><label>4</label><institution>Department of Biology, Massachusetts Institute of Technology</institution>, Cambridge, MA <country>USA</country></aff>
<aff id="a5"><label>5</label><institution>Department of Biological Chemistry, Michigan Medicine, University of Michigan</institution>, Ann Arbor, MI <country>USA</country></aff>
</contrib-group>
<contrib-group content-type="section">
<contrib contrib-type="editor">
<name>
<surname>Frost</surname>
<given-names>Adam</given-names>
</name>
<role>Reviewing Editor</role>
<aff>
<institution-wrap>
<institution>University of California, San Francisco (Adjunct)</institution>
</institution-wrap>
<city>San Francisco</city>
<country>United States of America</country>
</aff>
</contrib>
<contrib contrib-type="senior_editor">
<name>
<surname>Maduke</surname>
<given-names>Merritt</given-names>
</name>
<role>Senior Editor</role>
<aff>
<institution-wrap>
<institution>Stanford University</institution>
</institution-wrap>
<city>Stanford</city>
<country>United States of America</country>
</aff>
</contrib>
</contrib-group>
<author-notes>
<corresp id="cor1"><label>#</label><bold>Materials and Correspondence</bold> Requests for materials or correspondence should be directed to M.A.C. (<email>mcianfro@umich.edu</email>) or S.M.V. (<email>seyvos@mit.edu</email>).</corresp>
<fn id="n1" fn-type="equal"><label>*</label><p>Equal contributions</p></fn>
<fn id="n2" fn-type="present-address"><label>†</label><p>ByteDance Inc., San Jose, CA USA</p></fn>
<fn id="n3" fn-type="present-address"><label>‡</label><p>Amazon.com, Cambridge, MA USA</p></fn>
</author-notes>
<pub-date date-type="original-publication" iso-8601-date="2023-07-26">
<day>26</day>
<month>07</month>
<year>2023</year>
</pub-date>
<volume>12</volume>
<elocation-id>RP88640</elocation-id>
<history>
<date date-type="sent-for-review" iso-8601-date="2023-04-27">
<day>27</day>
<month>04</month>
<year>2023</year>
</date>
</history>
<pub-history>
<event>
<event-desc>Preprint posted</event-desc>
<date date-type="preprint" iso-8601-date="2023-04-19">
<day>19</day>
<month>04</month>
<year>2023</year>
</date>
<self-uri content-type="preprint" xlink:href="https://doi.org/10.1101/2022.06.17.496614"/>
</event>
</pub-history>
<permissions>
<copyright-statement>© 2023, Li et al</copyright-statement>
<copyright-year>2023</copyright-year>
<copyright-holder>Li et al</copyright-holder>
<ali:free_to_read/>
<license xlink:href="https://creativecommons.org/licenses/by/4.0/">
<ali:license_ref>https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
<license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p>
</license>
</permissions>
<self-uri content-type="pdf" xlink:href="elife-preprint-88640-v1.pdf"/>
<abstract>
<title>Abstract</title>
<p>Cryo-electron microscopy (cryo-EM) represents a powerful technology for determining atomic models of biological macromolecules(<xref ref-type="bibr" rid="c15">Kühlbrandt, 2014</xref>). Despite this promise, human-guided cryo-EM data collection practices limit the impact of cryo-EM because of a path planning problem: cryo-EM datasets typically represent 2-5% of the total sample area. Here, we address this fundamental problem by formalizing cryo-EM data collection as a path planning optimization from low signal data. Within this framework, we incorporate reinforcement learning (RL) and deep regression to design an algorithm that uses distributed surveying of cryo-EM samples at low magnification to learn optimal cryo-EM data collection policies. Our algorithm - cryoRL - solves the problem of path planning on cryo-EM grids, allowing the algorithm to maximize data quality in a limited time without human intervention. A head-to-head comparison of cryoRL versus human subjects shows that cryoRL performs in the top 10% of test subjects, surpassing the majority of users in collecting high-quality images from the same sample. CryoRL establishes a general framework that will enable human-free cryo-EM data collection to increase the impact of cryo-EM across life sciences research.</p>
</abstract>

</article-meta>
<notes>
<notes notes-type="competing-interest-statement">
<title>Competing Interest Statement</title><p>Y.L., Q.F., J.C., M.A.C., and S.M.V. are listed as co-inventors on a patent related to the cryoRL algorithm.</p></notes>
<fn-group content-type="summary-of-updates">
<title>Summary of Updates:</title>
<fn fn-type="update"><p>We have revised the text, included a new section on background theory, and included single particle analysis of human vs. cryoRL trajectories.</p></fn>
</fn-group>
</notes>
</front>
<body>
<sec id="s1">
<title>Main</title>
<p>Cryo-EM is one of the fastest-growing areas of structural biology, enabling 3D structure determination of important macromolecular complexes and membrane proteins(<xref ref-type="bibr" rid="c25">Nogales and Scheres, 2015</xref>). The impact of cryo-EM ranges from plant biology to human health and disease. Indeed, the widespread growth of cryo-EM has advanced our understanding of pathogens, such as SARS-CoV-2(<xref ref-type="bibr" rid="c30">Rapp et al., 2022</xref>), and has had a direct impact on drug development(<xref ref-type="bibr" rid="c39">Wigge et al., 2020</xref>).</p>
<p>Cryo-EM is an expensive and highly involved technique. For example, high-end microscopes cost millions of dollars to purchase and require yearly service contracts costing hundreds of thousands of dollars and full-time staff to maintain the instrument. To collect cryo-EM data, users require microscope time for multiple days to collect sufficient high-quality data in addition to waiting weeks or months to access high-end cryo-EM instruments. Thus, increasing the throughput of cryo-EM data collection is critical for advancing biomedical research efforts and reducing the cost of cryo-EM.</p>
<p>Major advances in microscope hardware (e.g., detectors(<xref ref-type="bibr" rid="c23">McMullan et al., 2016</xref>) and aberration-free image shift(<xref ref-type="bibr" rid="c4">Cheng et al., 2018</xref>; <xref ref-type="bibr" rid="c38">Weis and Hagen, 2020</xref>)) have led to rapid data acquisition strategies. Despite collecting hundreds of exposures per hour, much of the collected data is discarded during processing. For example, from 2019 to mid-2021, only 50% of exposures collected in the Cianfrocco laboratory had resolution estimates of &lt; 6 Å. This is because cryo-EM users do not know <italic>a priori</italic> which regions of a cryo-EM grid will produce the highest resolution data. Analysis of micrograph quality across different regions of a grid highlights the complex data landscape users must navigate, where variations of data quality occur locally (within micron-sized areas of squares) and globally (across the entire grid) (<bold><xref rid="figED1" ref-type="fig">Extended Data Fig. 1</xref></bold>). Cryo-EM samples are challenging samples for data collection, indicating that path planning optimization in addition to rapid data acquisition stands to improve microscope performance and throughput.</p>
<p>Artificial intelligence provides a powerful framework to recognize patterns in complex datasets. Recently, incorporating deep learning models into a reinforcement learning (RL) algorithm enabled RL to surpass professional human performance in challenging games such as AlphaGo(<xref ref-type="bibr" rid="c33">Silver et al., 2016</xref>) and Dota 2(<xref rid="c26" ref-type="bibr">OpenAI et al., 2019</xref>). These approaches demonstrate superior capabilities in learning strategic moves from simulation data. Given that many problems in the real world involve perception, planning, and decision-making, RL may impact many areas of human life, such as self-driving vehicles(<xref ref-type="bibr" rid="c1">Balaji et al., 2020</xref>), robotics(<xref ref-type="bibr" rid="c11">Kalashnikov et al., 2018</xref>), healthcare(<xref ref-type="bibr" rid="c41">Yu et al., 2021</xref>), and even trading and finance(<xref ref-type="bibr" rid="c10">Hambly et al., 2021</xref>). However, the application of RL in life sciences remains underexplored due to the lack of domain knowledge needed to formulate RL into scientific processes.</p>
<p>As a step toward developing fully automated intelligent decision-making for cryo-EM data collection, we present an RL-based framework, cryoRL. The goal of cryoRL is to identify the optimal path across cryo-EM samples to collect as much high-quality data as possible in a given time period (see <bold>Problem Formulation</bold>). Our algorithm combines a low-magnification survey with pretrained classification models that feed into a deep-Q network for learning data collection policies. We benchmarked the performance of cryoRL against human subjects using a cryo-EM data collection simulator, allowing both cryoRL and humans to simulate data collection on the same dataset. Our results show that cryoRL outperforms 9 out of 10 human subjects, suggesting that cryoRL will serve as a framework to automate cryo-EM data collection from all cryo-EM instruments. Our data suggest that optimized path planning with cryoRL will enable an approximately 40% improvement in microscope throughput, thus improving access and throughput on these instruments, thereby reducing the overall cost of cryo-EM.</p>
<sec id="s1a">
<title>Problem formulation</title>
<p>In general, the cryo-EM data collection process can be viewed as a navigation problem in the sample space. The goal is to find a trajectory that maximizes the number of visited holes with high-quality data in a given time. This sequential process involves switching across images at different magnification levels, which can be time-consuming and expensive. We formulate the problem as a Markov decision process (MDP) in the following way: each hole represents a state, and at each state, the agent chooses the next hole to visit from the set of all unvisited holes, which forms the action space. The reward is given by whether the next hole contains good data or not, penalized by the time of moving the microscope stage.</p>
<p>More specifically, our environment is a partially observable MDP because the agent navigates based on the predicted quality scores that are often imperfect. By visiting some holes within a patch (or square), the agent may improve its prediction based on the new information collected locally (<italic>i</italic>.<italic>e</italic>., the true quality scores of the holes visited). This means that the optimal policy depends on the last state and a sequence of states. We, therefore, construct the features for our RL agent with predicted quality scores using observations from multiple previous steps and the summary statistics for the current patches and squares (see <bold><xref rid="tblED1" ref-type="table">Extended Data Table 1</xref></bold> for details on information used). Note that this also makes it significantly advantageous to apply RL instead of learning-based combinatorial optimization algorithms(<xref ref-type="bibr" rid="c2">Bengio et al., 2021</xref>; <xref ref-type="bibr" rid="c22">Mazyavkina et al., 2021</xref>), as the latter needs to solve the expensive optimization problem whenever a model is updated.</p>
<p>An effective planning algorithm, thus, should be able to identify promising regions with plentiful high-quality holes and program the microscope to focus on those regions to avoid frequent image switching. To achieve this, cryoRL aims to optimize an objective function as follows:
<disp-formula id="ueqn1">
<alternatives><graphic xlink:href="496614v2_ueqn1.gif" mimetype="image" mime-subtype="gif"/></alternatives>
</disp-formula>
where <italic>τ</italic> is a prespecified time duration, and <italic>r</italic>(<italic>h</italic><sub><italic>i</italic></sub>) is a reward for visiting a hole <italic>h</italic><sub><italic>i</italic></sub> based on the quality of <italic>h</italic><sub><italic>i</italic></sub> as well as the time cost <italic>t</italic>(<italic>h</italic><sub><italic>i</italic></sub>) of the microscope movement (see section <italic>Time cost and RL Rewards</italic>). In reality, the hole quality predictions can be noisy, posing additional challenges.</p>
<sec id="s1a1">
<title>Justification &amp; formulation for reinforcement learning (RL) in cryo-EM data collection</title>
<p>We propose to solve such an optimization problem by reinforcement learning (RL), which is well suited for sequential decision-making tasks. In the literature, the decision-making problem is formulated either as a multi-armed bandit (MAB) or RL. MAB makes the decision solely based on the quality of the arm, which does not provide effective path planning for our problem. As described above, our problem can be formulated as an MDP, so RL is an appropriate technique for our problem. Thus, we argue that RL is more suitable for our problem than other approaches, such as learning-based combinatorial optimization(<xref ref-type="bibr" rid="c2">Bengio et al., 2021</xref>; <xref ref-type="bibr" rid="c22">Mazyavkina et al., 2021</xref>).</p>
<p>For cryo-EM data collection, we need to use predicted quality during path planning. Combinatorial optimization techniques such as genetic algorithms and simulated annealing perform path planning based on prediction and do not consider observations. Thus, they usually do not perform well when the prediction is poor. Compared to combinatorial optimization, RL can incorporate observations into path planning for better decision-making. For instance, when there are too many low-quality holes observed in the current square, a good policy learned in cryoRL will choose to switch to another patch or grid for further exploration, even if the prediction indicates that the square has ‘good’ holes.</p>
<p>To further justify the use of RL, we argue that: 1) our RL features build on both the predicted score of a single hole with relatively low quality and global features reflecting the quality of patches and squares. Thus, it has the potential to do better than combinatorial optimization, which is based solely on local information. 2) During the test phase, new labels will be collected for the visited holes, from which the policy can improve itself by updating the global features. A combinatorial optimization algorithm may not enjoy such benefits.</p>
<p>RL is generally less heuristic than other optimization solvers such as Genetic Algorithm(<xref ref-type="bibr" rid="c37">Weise, 2009</xref>) and Simulated Annealing(<xref ref-type="bibr" rid="c14">Kirkpatrick, 1984</xref>). In related work, we compared the outcome of RL with the outcomes of GA and SA and found the performance of RL to be significantly better(<xref ref-type="bibr" rid="c7">Fan et al., 2022</xref>). Furthermore, although RL is computationally expensive in the training phase, it is quick when we deploy the trained policy within the system. Thus, it can make real-time decisions.</p>
</sec>
<sec id="s1a2">
<title>Time cost and RL Rewards</title>
<p>In real cryo-EM data collection, the time needed to collect a micrograph varies depending on how far the stage needs to be moved from its previous position. In this study, we defined the time cost <italic>t</italic>(<italic>h</italic><sub><italic>i</italic></sub>) as in <bold><xref rid="tblED2" ref-type="table">Extended Data Table 2</xref></bold>. We combine the time cost <italic>t</italic>(<italic>h</italic><sub><italic>i</italic></sub>) with the score of micrographs, where ‘good’ micrographs have high-resolution information present as measured by the maximum CTF-estimated resolution (“CTFMaxRes”). While CTFMaxRes is not a direct measure of particle quality in the micrographs, it is an approximate assessment of sample density and ice thickness. We use CTFMaxRes in this work, given its widespread use as a data curation metric, but, importantly, our framework can generalize to any metric for optimizing RL rewards.</p>
<p>When the CTFMaxRes of the micrograph collected from <italic>h</italic><sub><italic>i</italic></sub> is lower than a given threshold <italic>T</italic>, the reward for each hole visit <italic>r</italic>(<italic>h</italic><sub><italic>i</italic></sub>) is defined as:
<disp-formula id="ueqn2">
<alternatives><graphic xlink:href="496614v2_ueqn2.gif" mimetype="image" mime-subtype="gif"/></alternatives>
</disp-formula>
In this study, we assigned <italic>β</italic> = 0. 1, <italic>t</italic><sub>0</sub> = 1. 0, and <italic>T</italic> = 6 Å (unless specified otherwise). When the CTFMaxRes of the micrograph collected from <italic>h</italic><sub><italic>i</italic></sub> is larger than the given threshold <italic>T, r</italic>(<italic>h</italic><sub><italic>i</italic></sub>) is defined as:
<disp-formula id="ueqn3">
<alternatives><graphic xlink:href="496614v2_ueqn3.gif" mimetype="image" mime-subtype="gif"/></alternatives>
</disp-formula>
Thus, a partial reward can be gained if the obtained CTFMaxRes is only slightly higher than the threshold <italic>T</italic>. In this study, we presented data with <italic>T</italic> = 6 Å.</p>
</sec>
<sec id="s1a3">
<title>Snowball baseline policy</title>
<p>We designed a snowball baseline to compare with the results of cryoRL. This baseline estimates the quality of all the candidate holes in the dataset and then will start from a random hole target and aims to maximize the total number of micrographs in a given time duration regardless of the quality. To train this policy, we used <italic>T</italic> = 30 Å in the reward function so that the reward only depends on the time cost.</p>
</sec>
<sec id="s1a4">
<title>“Predict-Rank” policy</title>
<p>We designed another policy, “Predict-Rank,” as a heuristic baseline to compare with the results of cryoRL. This “Predict-Rank’’ policy used the predicted quality scores and ranked the grid-level images based on their overall predicted quality. For simplicity, we labeled holes with predicted CTFMaxRes below 6 Å as “good.” This is followed by a secondary ranking on the square images and is then followed by a third ranking on the patch-level images. This policy started from a random position and then moved to the “best patch” in the “best square” in the “best grid area,” collected all the predicted good holes, and then moved to the “second best patch” image, etc. This “Predict-Rank” policy serves as a very strong baseline when the prediction of the regressor is accurate.</p>
</sec>
</sec>
<sec id="s1b">
<title>Optimization of path planning on cryo-EM samples with cryoRL</title>
<p>Given an unexplored cryo-EM grid, the goal of a data collection session is to obtain the maximal number of micrographs with high-resolution information in a limited time. Importantly, the data collection path needs to be optimized by reducing the time cost associated with stage movement and Z-height adjustment of the microscope. Therefore, two critical problems in cryo-EM data acquisition are 1) quality prediction at the low or medium magnification and 2) trajectory planning during the data collection session.</p>
<p>In traditional cryo-EM data collection, users utilize a sequential approach to interrogate, assess, and steer data collection (<bold><xref rid="fig1" ref-type="fig">Fig. 1A</xref></bold>). First, a user will generate an atlas of low magnification “grid-level” images to obtain an overview of the sample (<bold><xref rid="fig1" ref-type="fig">Fig. 1A</xref></bold>). The user will examine the atlas and choose to collect micrographs from the holes in one patch, from a single square. Specifically, for each square selected, the user will capture a “square-level” image and several “patch-level” images at higher magnifications to visualize the overall shapes and relative intensities of each hole (<bold><xref rid="fig1" ref-type="fig">Fig. 1A</xref></bold>). Depending on the quality of the collected micrographs, the user decides to collect in the same patch, a different patch, or a different square. This iterative process will continue until the user finds a pattern that produces the highest quality data.</p>
<fig id="fig1" position="float" fig-type="figure">
<label>Figure 1.</label>
<caption><title>Overview of cryoRL approach.</title>
<p>(A) Traditional data collection involves a sequential investigation of a cryo-EM sample atlas, squares, and holes found within patches to obtain high-magnification micrographs. (B) Overview of cryoRL approach. (1) Preparation: Low magnification survey of square- and patch-level images are collected on an area of interest. (2) Data collection: A deep Q-network is trained using hole assessment (“Deep Regressor”) and grid image hierarchies are inputs. The network learns to output an action that is based on the current state on the grid.</p></caption>
<graphic xlink:href="496614v2_fig1.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>To automate cryo-EM data collection, we designed an RL-based data collection algorithm: ‘cryoRL’ (see <bold>Problem Formulation</bold>). CryoRL aims to optimize cryo-EM data collection by combining supervised regression and reinforcement learning (<bold><xref rid="fig1" ref-type="fig">Fig. 1B</xref></bold>). First, a deep regressor will predict a quality score for each hole image at medium magnification. Subsequently, an RL model will use these quality scores and the hierarchical information on the grid to output a trajectory of actions, i.e., to decide on the fly which positions should be used for collecting high-resolution micrographs.</p>
<p>In this work, we define micrograph quality based on the amount of signal in Fourier space for a given micrograph. Specifically, we calculate the maximum resolution at which the contrast transfer function (CTF) can be detected. This value - “CTFMaxRes” - is a routine value that is a standard part of cryo-EM processing(<xref ref-type="bibr" rid="c6">Cianfrocco and Kellogg, 2020</xref>; <xref ref-type="bibr" rid="c32">Rohou and Grigorieff, 2015</xref>). CTFMaxRes is a valid metric considering that it correlates with particle number and the signal-to-noise ratio of the images. Importantly, CTFMaxRes is a widely used parameter to filter out “bad” micrographs during single particle processing, such as removing micrographs with a CTFMaxRes of &gt; 6 Å. In cryoRL, the CTFMaxRes value of a micrograph defines the quality score of the corresponding hole-level image.</p>
<p>CryoRL relies on low-magnification grid mapping to facilitate path planning across the grid. We call this a “distributed” approach for data collection, which is contrary to the traditional “sequential” data collection strategy (<bold><xref rid="fig1" ref-type="fig">Fig. 1</xref></bold>). A distributed view of a grid provides a landscape of the grid, which is essential for trajectory planning. After collecting patch-level images across a square, which can take 1-2 minutes per square, all holes will be automatically identified and segmented. These hole images will constitute a candidate pool in cryoRL. Since these images are low magnification, this is automated and does not constitute a time-consuming step.</p>
<p>The reward function is a critical aspect of RL implementations as these rewards will guide RL behavior(<xref ref-type="bibr" rid="c19">Li, 2017</xref>). In cryoRL, we developed a reward scheme that values finding good micrographs from neighboring holes, where finding a good micrograph within the same patch has the highest reward (see <bold>Problem Formulation</bold> &amp; <bold>Methods</bold>). The reward function also reflects realistic considerations when operating the instrument: moving to neighboring holes is faster than switching areas of a square or region of a grid. cryoRL will reward the action of taking a “good” micrograph, and the reward amount is negatively correlated to the time it takes to perform the action (<bold><xref rid="tblED1" ref-type="table">Extended Data Table 1</xref></bold>, see <bold>Methods</bold>). Therefore, cryoRL takes account of both quality prediction and trajectory planning in a real-world setting with a practical consideration of the time cost. For a baseline comparison, we designed a “snowball baseline,” which aimed to maximize the total number of micrographs collected regardless of the quality, to compare the results of cryoRL with the outcomes of a semi-random data collection policy (see <bold>Problem Formulation</bold> &amp; <bold>Methods</bold>).</p>
<p>To test and implement cryoRL, we performed all path planning offline by running cryoRL on systematically collected datasets (see <bold>Methods</bold>). For these datasets, we imaged every hole across many squares (&gt; 10) to provide cryoRL with a landscape of holes from which to choose.</p>
</sec>
<sec id="s1c">
<title>CryoRL effectively navigates cryo-EM samples to identify high-quality data</title>
<p>We tested the performance of cryoRL offline on a cryo-EM sample of rabbit muscle Aldolase on a Quantifoil 1.2/1.3 grid from which we collected a systematic dataset (<bold><xref rid="fig2" ref-type="fig">Fig. 2A</xref></bold>, see <bold>Methods</bold>). For this sample, we trained the deep regressor and deep Q-network on a subset of the cryo-EM grid. The deep regressor successfully captured the correlation between hole images and CTFMaxRes values (<bold><xref rid="figED2" ref-type="fig">Extended Data Fig. 2A</xref> &amp; <xref rid="figED3" ref-type="fig">3A</xref></bold>). Using these trained models, cryoRL collected micrographs from “good” holes on the grid (<bold><xref rid="fig2" ref-type="fig">Fig. 2B</xref> &amp; <xref rid="fig2" ref-type="fig">2C</xref></bold>). Given that the overall candidate holes in this dataset are low quality (less than 40% of candidates had a CTFMaxRes &lt; 6 Å (<bold><xref rid="fig2" ref-type="fig">Fig. 2B</xref></bold>) - cryoRL collected ∼80% of images with a CTFMaxRes &lt; 6 Å (<bold><xref rid="fig2" ref-type="fig">Fig. 2C</xref></bold>). CryoRL also outperformed the Predict-Rank policy, which uses the information of the quality prediction but not reinforcement learning-based path planning (<bold><xref rid="fig2" ref-type="fig">Fig. 2C</xref></bold>).</p>
<fig id="fig2" position="float" fig-type="figure">
<label>Figure 2.</label>
<caption><title>cryoRL collects high quality cryo-EM data.</title>
<p>(A) Overview of cryo-EM grid used for systematic data collect. Yellow squares indicate regions where almost every hole was collected. (B) Comparison of CTFMaxRes value for all micrographs (gray) vs. cryoRL (yellow). (C) Comparison of cryoRL, Predict-Rank and snowball baseline. (D) Example square showing path of cryoRL. Holes were shaded if they were in the trajectory of cryoRL. (E) Zoom-in on panel in (D). (F) &amp; (G) cryoRL trajectory overlaid on ground-truth CTF values per hole.</p></caption>
<graphic xlink:href="496614v2_fig2.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>To visualize the behavior of cryoRL, we overlaid a cryoRL trajectory on the cryo-EM sample (<bold><xref rid="fig2" ref-type="fig">Fig. 2D-2G</xref></bold>). cryoRL visited six squares during data collection. Zooming in on a selected square, we see that this specific square contained holes with different ice thicknesses and quality (<bold><xref rid="fig2" ref-type="fig">Fig. 2D</xref></bold>). CryoRL successfully avoided empty holes or holes with very thick ice (<bold><xref rid="fig2" ref-type="fig">Fig. 2E</xref></bold>). Compared to the ground truth CTFMaxRes of all the candidate holes, we found that cryoRL collected micrographs with low CTFMaxRes only in the patches with many high-quality holes (<bold><xref rid="fig2" ref-type="fig">Fig. 2F</xref> &amp; <xref rid="fig2" ref-type="fig">2G</xref></bold>). Therefore, cryoRL learned an effective policy that minimizes the time cost increase from moving to a different patch. We conclude from these results that cryoRL successfully collected high-quality micrographs when trained on a small subset of the dataset.</p>
</sec>
<sec id="s1d">
<title>Transferred models enable effective path planning on different cryo-EM samples and grid types</title>
<p>Our result on Aldolase showed that cryoRL learns a policy to collect high-quality micrographs when both the regressor and RL network are trained from a subset of the same grid. However, RL models need to be trained on a subset of the dataset where all the possible holes are collected with a ground truth CTFMaxRes. A dataset like this with a sufficient sample size for training is usually unavailable and not practical to obtain. Therefore, RL models must have good transferability so they do not need to be trained on the same dataset.</p>
<p>To test the transferability of RL models, we collected a dataset of a different cryo-EM sample, Apoferritin (for transferability comparisons, see <bold><xref rid="tblED3" ref-type="table">Extended Data Table 3</xref></bold>). We utilized a general deep regressor that was trained on 100,578 hole images from the Cianfrocco laboratory from a variety of sample types with associated CTFMaxRes values (see <bold>Methods, <xref rid="figED2" ref-type="fig">Extended Data Fig. 2B</xref> &amp; <xref rid="figED3" ref-type="fig">3B</xref></bold>) in combination with the deep-Q network from Aldolase (<bold><xref rid="fig3" ref-type="fig">Fig. 3A</xref></bold>). The resulting images collected by cryoRL showed a strong enrichment for images &lt; 6 Å (<bold><xref rid="fig3" ref-type="fig">Fig. 3B</xref></bold>), indicating that the transferred models’ allowed high-quality data collection. The overall performance of cryoRL is 1.5 times above the baseline with ∼80% of collected images &lt; 6 Å (<bold><xref rid="fig3" ref-type="fig">Fig. 3C</xref></bold>). Surprisingly, even though the performance of the regressor was not perfect (<bold><xref rid="figED2" ref-type="fig">Extended Data Fig. 2B</xref> &amp; <xref rid="figED3" ref-type="fig">3B</xref></bold>), the Predict-Rank policy performed similarly to cryoRL (<bold><xref rid="fig3" ref-type="fig">Fig. 3C</xref></bold>).</p>
<fig id="fig3" position="float" fig-type="figure">
<label>Figure 3.</label>
<caption><title>Transferred models enable effective data collection by cryoRL.</title>
<p>(A) Schematic for apoferritin dataset. (B) CTFMaxRes histogram for cryoRL vs. all images. (C) Overall performance of cryoRL, Predict-Rank, and snowball baseline. (D) Schematic for RNA polymerase II (RNAPII) dataset. (E) CTFMaxRes histogram for cryoRL vs. all images. (F) Overall performance of cryoRL, Predict-Rank, and snowball baseline.</p></caption>
<graphic xlink:href="496614v2_fig3.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>Given the performance of cryoRL on Apoferritin, we switched to a different sample on a different grid: RNA Polymerase II (RNAPII) on Au-Flat 1.2/1.3. First, we carefully divided the atlas into halves. An expert (Michael Cianfrocco) freely collected on one half of the grid, while the other half was used for the systematic data collection that served as the ground truth for cryoRL. CryoRL utilized a deep regressor fine-tuned from the pretrained general regressor with a subset of holes from the RNAPII grid (see <bold>Methods, <xref rid="figED2" ref-type="fig">Extended Data Fig. 2C</xref> &amp; <xref rid="figED3" ref-type="fig">3C</xref></bold>). For the deep-Q network, instead of training on the same grid, we used the deep-Q model from the Aldolase dataset. Using the fine-tuned deep regressor and transferred deep-Q network (<bold><xref rid="fig3" ref-type="fig">Fig. 3D</xref></bold>), cryoRL collected high-quality images from the RNAPII dataset (<bold><xref rid="fig3" ref-type="fig">Fig. 3E</xref></bold>). A comparison of cryoRL versus the baseline shows two times more images below 4 Å (<bold><xref rid="fig3" ref-type="fig">Fig. 3F</xref></bold>). On the other hand, the Predict-Rank policy performed similar to the baseline (<bold><xref rid="fig3" ref-type="fig">Fig. 3F</xref></bold>), showing the inconsistency when the prediction result is noisy. For the data collected by the expert, we translated the trajectory with the time costs used in this study (<bold><xref rid="tblED1" ref-type="table">Extended Data Table 1</xref></bold>) and truncated the trajectories at 480 min. The performance of the expert was similar to cryoRL (<bold><xref rid="fig3" ref-type="fig">Fig. 3F</xref></bold>).</p>
</sec>
<sec id="s1e">
<title>CryoRL outperforms humans</title>
<p>To test human performance against cryoRL on the same dataset, we designed and implemented a cryo-EM simulator (see <bold>Methods, Supplemental Movie 1</bold>). We used a cryo-EM simulator to ensure that both human users and cryoRL have access to the exact same grid, square, hole, and exposure data to ensure an accurate comparison. We compared the performance of cryoRL versus human subjects on a new systematic dataset of rabbit muscle Aldolase on a different grid type: UltrAufoil 1.2/1.3 (“Aldolase<sup>Au</sup>”, <bold><xref rid="fig4" ref-type="fig">Fig. 4A</xref></bold>). This dataset consisted of 5822 hole images and their ground truth CTFMaxRes from 30 squares. We asked ten users ranging from 3 months to 10 years of cryo-EM experience (see <bold>Methods</bold>) to collect data with the simulator as if they were in a real data collection session. Furthermore, similar to the RNAPII dataset, we also divided the atlas into halves and assigned one half for expert data collection.</p>
<fig id="fig4" position="float" fig-type="figure">
<label>Figure 4.</label>
<caption><title>CryoRL outperforms humans.</title>
<p>(A) Schematic for Aldolase<sup>Au</sup> dataset. (B) Number of micrographs with CTFMaxRes &lt; 6 Å over the data collection time for cryoRL and human test subjects. (C) Overall performance of cryoRL, Predict-Rank, snowball baseline and human test subjects. (D) Statistics of data collection behaviors of cryoRL and human test subjects. (E) Pairwise Jaccard similarity coefficients between the micrographs collected by cryoRL and human test subjects.</p></caption>
<graphic xlink:href="496614v2_fig4.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>We compared the performance of human subjects with cryoRL that used the pretrained general deep regressor (<bold><xref rid="figED2" ref-type="fig">Extended Data Fig. 2D</xref> &amp; <xref rid="figED3" ref-type="fig">3D</xref></bold>) and the DQN trained with Aldolase<sup>Au</sup> (<bold><xref rid="fig4" ref-type="fig">Fig. 4A</xref></bold>). From the trajectories of the number of micrographs with CTFMaxRes &lt; 6 Å over time, we found that cryoRL outperformed 9 out of 10 human test subjects (<bold><xref rid="fig4" ref-type="fig">Fig. 4B</xref></bold>). Interestingly, human subjects showed a large variance in performance. The slopes of the lines indicated the “good data rate.” CryoRL showed a consistent “good data rate,” whereas the rate of most test subjects varied over time (<bold><xref rid="fig4" ref-type="fig">Fig. 4B</xref></bold>).</p>
<p>We quantified the average performance of human test subjects and the expert and compared them with that of the baseline, the Predict-Rank policy, and cryoRL (<bold><xref rid="fig4" ref-type="fig">Fig. 4C</xref></bold>). The baseline showed that this dataset contained only 12% of targets with a CTFMaxRes &lt; 6 Å (<bold><xref rid="fig4" ref-type="fig">Fig. 4C</xref></bold>). Surprisingly, the performance of the expert is even worse than the baseline (<bold><xref rid="fig4" ref-type="fig">Fig. 4C</xref></bold>). The average performance of humans exceeded the baseline, but the variance was significant (<bold><xref rid="fig4" ref-type="fig">Fig. 4C</xref>, <xref rid="figED4" ref-type="fig">Extended Data Fig. 4</xref></bold>). Predict-Rank policy performed similarly to the average human test subjects (<bold><xref rid="fig4" ref-type="fig">Fig. 4C</xref></bold>). CryoRL outperformed humans by about 43% on average, with a much lower variance, suggesting higher consistency (<bold><xref rid="fig4" ref-type="fig">Fig. 4C</xref></bold>).</p>
<p>Next, we wanted to determine the behaviors of cryoRL vs. human subjects. We found that cryoRL only visited four unique squares. In contrast, human users, on average, visited 12 squares (<bold><xref rid="fig4" ref-type="fig">Fig. 4D</xref></bold>). Consequently, cryoRL collected over 100 micrographs per square, three times more than the human test subjects (<bold><xref rid="fig4" ref-type="fig">Fig. 4D</xref></bold>). Given this behavior, we conclude that in minimizing stage movements, cryoRL collected more micrographs in total and more high-quality micrographs as a result.</p>
<p>We wanted to compare if the good micrographs collected by cryoRL and human subjects overlap. To do this, we quantified the pairwise similarities between the micrographs in each trajectory with the Jaccard similarity coefficient (<bold><xref rid="fig4" ref-type="fig">Fig. 4E</xref></bold>). Surprisingly, we found that human subjects had an average of 0.13 similarity coefficient (0 is uncorrelated, 1 perfectly correlated), further underscoring the variability of data collection (<bold><xref rid="fig4" ref-type="fig">Fig. 4E</xref></bold>). However, the three users who were able to collect over 200 micrographs &lt; 6 Å (Human-2, -7, and -9) had the highest similarity to cryoRL (<bold><xref rid="figED4" ref-type="fig">Extended Data Fig. 4</xref>, <xref rid="fig4" ref-type="fig">Fig. 4E</xref></bold>). Not surprisingly, the similarity among the best-performing users was relatively high (<bold><xref rid="fig4" ref-type="fig">Fig. 4E</xref></bold>). On the other hand, the three users who collected less than 100 good micrographs (Human-1, -3, and -10) had weak concordance with cryoRL and among themselves (<bold><xref rid="figED4" ref-type="fig">Extended Data Fig. 4</xref>, <xref rid="fig4" ref-type="fig">Fig. 4E</xref></bold>). This comparative analysis showed that good micrograph selections were alike within this dataset, but every bad micrograph selection was bad in its own way.</p>
<p>Finally, to show that the data collected by cryoRL on this dataset was more consistent than human test subjects, we processed the micrographs collected by cryoRL and human test subjects in the same way (<bold><xref rid="fig5" ref-type="fig">Fig. 5A</xref></bold>). Since cryoRL started from a random position we sampled ten trajectories out of the 50 trajectory runs produced by cryoRL. The final structure from the datasets cryoRL collected had resolutions ranging from 3.8 Å to 4.3 Å (<bold><xref rid="fig5" ref-type="fig">Fig. 5B &amp; 5C</xref>, <xref rid="figED5" ref-type="fig">Extended Data Fig 5</xref></bold>). In contrast, the resolutions of the structures from the datasets human test subjects collected ranged from 3.9 Å to 9.0 Å ((<bold><xref rid="fig5" ref-type="fig">Fig. 5B</xref> &amp; <xref rid="fig5" ref-type="fig">5C</xref>, <xref rid="figED5" ref-type="fig">Extended Data Fig 5</xref></bold>). Comparing the results from these human test subjects versus cryoRL shows that cryoRL archives consistency that human subjects could not achieve.</p>
<fig id="fig5" position="float" fig-type="figure">
<label>Figure 5.</label>
<caption><title>CryoRL data collection trajectories produce consistent reconstruction output.</title>
<p>(A) Standard workflow for analysis of all cryoRL and human datasets from Aldolase<sup>Au</sup> simulator data. Fourier shell correlation curves (FSC) for ten cryoRL (left) or human (right) trajectories after analysis using workflow in (A). (C) Comparison of FSC@0.143 resolution between cryoRL and human final reconstructions from trajectories. Error bars show S.D.</p></caption>
<graphic xlink:href="496614v2_fig5.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
</sec>
</sec>
<sec id="s2">
<title>Discussion</title>
<p>In this work, we show that cryoRL optimizes the path of cryo-EM image collection to maximize high-quality images in a limited time across four independent datasets. Among our four experiments, three were tested with transferred models, showing the generalizability of cryoRL. Our results showed that the RL networks can provide robustness and place cryoRL in the top 10% of human study subjects. Importantly, the deep-Q network is highly transferable as all four experiments shared the same deep-Q model (<bold><xref rid="tblED3" ref-type="table">Extended Data Table 3</xref></bold>).</p>
<p>Our design of low-magnification prediction with RL policy training enables cryoRL to identify optimal paths across cryo-EM samples. The deep regressor provides a consistent prediction of the data quality at the hole level, allowing cryoRL to map thousands of holes, a task that is nearly impossible for human users. We believe the challenge of mapping paths is highlighted in the cryo-EM simulator: many human subjects cannot keep a consistent rate of data quality collection (<bold><xref rid="fig4" ref-type="fig">Fig. 4B</xref></bold>).</p>
<p>CryoRL outperforms average cryo-EM users due to consistent data collection rates on local regions of high-quality images. Analysis of cryoRL behavior versus human subjects showed that cryoRL visited four squares, whereas human subjects visited an average of 12 squares (<bold><xref rid="fig4" ref-type="fig">Fig. 4D</xref></bold>). Moreover, from these four squares, cryoRL obtained a near-constant “good data collection rate” (<bold><xref rid="fig4" ref-type="fig">Fig. 4B</xref></bold>), whereas human subjects showed large variability in the rate of collection (<bold><xref rid="fig4" ref-type="fig">Fig. 4B</xref></bold>). From these data, we conclude that cryoRL can consistently collect high-quality data.</p>
<p>Data quality is difficult to infer from hole images since their magnification is usually not high enough. The Predict-Rank policy is a heuristic baseline that only depends on the result from the predicted CTFMaxRes. We found that the performance of Predict-Rank is very unstable throughout our four experiments. However, reinforcement learning was able to provide robustness when the regressor result was noisy.</p>
<p>CTFMaxRes is a metric that has been used for years in the field as a data curation approach. However, we acknowledge that, in many cases, it does not reflect the true quality of a micrograph. The generality of the cryoRL framework allows for any micrograph metric to serve as a target for reward. The deep regressor can also be trained to predict other metrics, like data quality measurement output by MicAssess(<xref ref-type="bibr" rid="c20">Li et al., 2020</xref>) or picked particle numbers, as long as the training can converge.</p>
<p>The reward table within cryoRL will enable tuning cryoRL for different data collection behaviors. For example, by increasing the reward for images from different squares, we can encourage cryoRL to explore larger regions of a sample, as in data screening. The time costs and the rewards associated with them can also be tuned to reflect the specifications of different instruments. We believe that cryoRL has great flexibility and potential to automate both data collection and data screening in various scenarios.</p>
<sec id="s2a">
<title>Limitations</title>
<p>Although we showed that cryoRL collected data better than most of the human test subjects, there are some limitations of our framework. First, the performance of cryoRL is directly related to the accuracy of the deep regressor. Although the RL networks provide some robustness to imperfect quality prediction results, if the grid type is not present in the training data, the performance of a general model will not be very accurate. For example, in the RNAPII dataset, the grid type was not present in the training data of our general model. We thus had to fine-tune the general regressor with a subset of the RNAPII data. As transferability is one of the biggest hurdles in the machine learning field, training a general model that will always be accurate on most datasets will be challenging. On the other hand, given that some samples may have specific hole types or may be visible at hole magnification (e.g., viruses, microtubules), a sample-specific deep regressor could be incorporated into cryoRL for increased accuracy of prediction. In the future, we anticipate that the regressor may also learn from the data just collected so that the decision-making can be improved over time. Semi-supervised learning(Oua<xref ref-type="bibr" rid="c20">li et al., 2020</xref>) or active learning(<xref ref-type="bibr" rid="c31">Ren et al., 2021</xref>) may be useful techniques that can be applied to cryoRL in the future. An online model will be ideal.</p>
<p>The “distributed” data collection scheme adds an up-front time cost to cryo-EM imaging sessions. In the current framework, the systematic survey may collect images that are clearly empty or too thick. We believe that the survey can be more efficient using human or AI-assisted square selection to identify the most promising squares to start(<xref ref-type="bibr" rid="c12">Kim et al., 2021</xref>). Also, we believe that z-height adjustment can be skipped when collecting patch images since they are merely used to provide the candidate hole images, so taking these patch images only takes 1-2 min per square.</p>
<p>CryoRL is proposed as an algorithm for optimized path planning on the cryo-EM grid, and it is not available in the current data collection software yet. Also, cryoRL does not include any square or hole finders; therefore, other algorithms (<xref ref-type="bibr" rid="c3">Bouvette et al., 2021</xref>; <xref ref-type="bibr" rid="c5">Cheng et al., 2023</xref>; <xref ref-type="bibr" rid="c12">Kim et al., 2021</xref>) are needed to be used in combination with cryoRL. Moreover, the square and hole detectors and square classifiers provide an automatic solution for collecting the prerequisite information for path planning in cryoRL.</p>
<p>Overall, we believe that optimized path planning using approaches like cryoRL will allow efficient microscope and expert-level performance without the need for human intervention. From our results, we estimate that microscopes will be 140% more productive than current usage, thus expanding the pool of available microscope time for users worldwide on high-end cryo-EM instruments. This will greatly increase the throughput of cryo-EM projects and help to reduce labor costs, and increase access to microscopes.</p>
</sec>
</sec>
</body>
<back>
<ack>
<title>Acknowledgments</title>
<p>We thank members of the Vos and Cianfrocco laboratories, especially Hye Jee Hahn and Nicholas Vangos for preparing cryo-EM samples of aldolase and apoferritin; Christopher Lilienthal for help with Leginon/Appion database interrogation. We thank the Protex facility at the University of Leicester, Louise Fairall, and Christos Savva for mouse apoferritin plasmid and protocol for purification. We thank Lucas Farnung for preparing the RNAPII samples. We thank Liz Kellogg, Joey Davis, and Bolei Zhou for giving us comments on this manuscript. The research reported in this publication was supported by the University of Michigan Cryo-EM Facility (U-M Cryo-EM). U-M Cryo-EM is grateful for support from the U-M Life Sciences Institute and the U-M Biosciences Initiative. This work was supported by R01GM143805 and S10OD020011 (M.A.C. &amp; Y.L.) in addition to DP2-GM146254 (S.M.V).</p>
</ack>
<sec id="s3">
<title>Author Contributions</title>
<p>Y.L., Q.F., J.C., M.A.C., and S.M.V conceived the project. M.A.C. and S.M.V. co-led the project. Y.L. and M.A.C. collected systematic datasets. Q.F. developed the reinforcement learning framework. Y.L. and Q.F. incorporated reinforcement learning into the cryo-EM data collection scheme and performed learning experiments. Y.L. developed and ran data analysis. V.D., J.Y.L, and L.Y. developed the cryo-EM data simulator. E.R.L. processed the apoferritin datasets. Y.L., Q.F., Z.X., M.A.C., and S.M.V. wrote the manuscript.</p>
</sec>
<sec id="s4">
<title>Competing Interests</title>
<p>Y.L., Q.F., J.C., M.A.C., and S.M.V. are listed as co-inventors on a patent related to the cryoRL algorithm. All other authors declare no competing interests.</p>
</sec>
<sec id="s5">
<title>Data availability statement</title>
<p>The source code of cryoRL is can be found on GitHub: <ext-link ext-link-type="uri" xlink:href="https://github.com/IBM/CryoRL-pytorch">https://github.com/IBM/CryoRL-pytorch</ext-link>. The cropped hole images for “Aldolase” can be downloaded from <ext-link ext-link-type="uri" xlink:href="https://github.com/yilaili/cryoRL-pytorch-data">https://github.com/yilaili/cryoRL-pytorch-data</ext-link>. The full database files and images are hosted on a Globus endpoint in the Cianfrocco laboratory.</p>
</sec>
<sec id="s6">
<title>Methods</title>
<sec id="s6a">
<title>Deep regressors</title>
<p>We applied deep regression to estimate the CTFMaxRes of each hole, which has a maximum value of 20 Å. The regressor, backboned by ResNet-50, takes as the input the holes cropped out from hole-level images based on the location information provided in the metadata. It is trained for 50 epochs with the Adam optimizer(<xref ref-type="bibr" rid="c13">Kingma and Ba, 2014</xref>) using <italic>l</italic><sub>2</sub> loss unless specified otherwise. A cosine scheduler(<xref ref-type="bibr" rid="c21">Loshchilov and Hutter, 2016</xref>) is adopted with an initial learning rate. In addition to the implementation in this study, the quality of a hole can also be categorized by a classifier, as done in(<xref ref-type="bibr" rid="c7">Fan et al., 2022</xref>). However, the classifier has to be re-trained when the categorization criteria change.</p>
<p>The same model architecture was used for the training of the regressor for Aldolase, the general regressor, and the fine-tuned regressor for RNAPII. The regressor for Aldolase used an initial learning rate of 0.0005 and a batch size of 128, with the training data size of 1197 and the validation data size of 2341. The general regressor used an initial learning rate of 0.001 and a batch size of 256, with the training data size of 80443 and the validation data size of 20135. The data used to train the general regressor consisted of hole images from different grid types and hole sizes. These grids included Quantifoil 1.2/1.3 and 2/2 as well as UltrAuFoil 1.2/1.3 from samples that ranged in molecular weight from ∼50 kDa to ∼1 MDa from images in the Cianfrocco laboratory from 2017-2021. The fine-tuned regressor for RNAPII used the general regressor as the pre-trained model and only the final fully-connected layer was trainable parameters. It was trained for 20 epochs with an initial learning rate of 0.0005 and a batch size of 64. The training data size was 4544 and the validation data size was 4109.</p>
</sec>
<sec id="s6b">
<title>RL Network</title>
<p>We applied the deep Q-learning approach(<xref ref-type="bibr" rid="c24">Mnih et al., 2013</xref>) to learn a planning policy for cryo-EM data collection. The DQN used in our work is a 3-layer MLP with ReLU activations. The size of each layer is 128, 256, and 128, respectively. Since moving the microscope to any target hole is considered a unique action from the agent in our RL system, the action space of the system has the same size as the training samples, which can be potentially large. In addition, during tests, the number of holes (i.e., actions) may vary case by case. Because of this, the general practice as many approaches do, which sets the number of output nodes in the network to the number of actions, is not practical for our case. While more sophisticated methods(<xref ref-type="bibr" rid="c17">Lazaric et al., 2007</xref>; Le et al., 2022) exist for dealing with varying space sizes, we applied a single output node to estimate the Q-value of a hole once each time and batch process all the actions efficiently. A detailed description of the components in our RL setup and training can be found in(<xref ref-type="bibr" rid="c7">Fan et al., 2022</xref>). In this paper, we set the duration in our system to 480 minutes for training.</p>
</sec>
<sec id="s6c">
<title>Features to DQN</title>
<p>A good RL policy, if possible, should always reward small microscope movements. In other words, the hole path planning strategy should prioritize areas with rich low CTFMaxRes holes first. The number of low CTFMaxRes holes on a patch (square or grid) image is closely related to the quality (or value) of the image in cryo-EM data collection. Based on this, we design hierarchical features for the DQN that represent the quality of images at different levels, including histograms of CTFMaxRes on unvisited holes and the number of visited and unvisited low CTFMaxRes holes. The histograms are smoothed by a Gaussian kernel to improve robustness against the imperfect regression results. We listed the details of these features, which are computed separately for each hole and linearly normalized between 0 and 1 in <bold><xref rid="tblED2" ref-type="table">Extended Data Table 2</xref></bold>. We also considered the history of the microscope movement by concatenating the features for the last <italic>k</italic> − 1 visited holes and the current one to be visited to form the final input to the DQN. In this study, <italic>k</italic> was empirically set to 4.</p>
</sec>
<sec id="s6d">
<title>Cryo-EM simulator and human study</title>
<p>We conducted a human study to directly compare the performance of cryoRL with humans. The dataset used was Aldolase<sup>Au</sup>. We developed a simulator that mimics real data collection (<bold>Supplemental Movie 1</bold>) without the waiting time to acquire each image. The hierarchical layers in the dataset were preserved and well reflected in the simulator. The tested users were asked to collect 450-500 micrographs, and the resulting trajectories were recorded. We asked the users to collect as many as good micrographs (with low CTFMaxRes), while trying to minimize the time cost of moving the stage to distance positions, as in a real data collection. The users were given the freedom to look through the low magnification images at different magnification hierarchies without penalty to provide a fair competition with cryoRL. We note that this type of analysis is not possible with the traditional “sequential” data collection strategy. The tested users were given the same time cost table (<bold><xref rid="tblED1" ref-type="table">Extended Data Table 1</xref></bold>). We then translated the trajectories with the time costs used in this manuscript and truncated the trajectories at 480 min to compare them with the performance by cryoRL on the same dataset. The simulator has two modes, “inspection mode” and “queueing mode”. In the inspection mode, the ground truth CTFMaxRes will be given once the hole is “collected”. In the queueing mode, the user may queue up a number of hole targets without knowing their ground truth CTFMaxRes values until switching to the inspection mode. The tested users include experts who are scientists with over 8 years of cryo-EM data collection experience and are still active in collecting data, and novices who have less than 1 year of experience in cryo-EM data collection but have prior knowledge of cryo-EM data collection. No significant difference was found between the average performances of the experts and the novices.</p>
</sec>
<sec id="s6e">
<title>Cryo-EM data processing</title>
<p>CTF estimation was performed in Warp(<xref ref-type="bibr" rid="c35">Tegunov and Cramer, 2019</xref>) for the complete Aldolase<sup>Au</sup> dataset (5822 total micrographs) and all trajectories, filtering from 30-3 Å and 0.2-10.0 µm defocus. Particles were picked with an expected diameter of 60 Å using WARP’s BoxNet2 neural network model (0.98 Å/pixel, 216 px box size). The remainder of the processing was conducted in CryoSPARC(<xref ref-type="bibr" rid="c29">Punjani et al., 2017</xref>), beginning with 2D classification (150 classes, no specified mask diameter). Particles corresponding to 2D class averages with a resolution below 10 Å were excluded from downstream processing. An initial 3D homogeneous refinement was performed on the remaining particles with C1 symmetry and EMD-21023(<xref ref-type="bibr" rid="c40">Wu et al., 2020</xref>) as the initial model. Particles and volumes from this initial refinement were then subjected to a 3D classification (5 classes, D2 symmetry) using CryoSPARC’s heterogeneous refinement tool. For human and cryoRL-selected trajectories, particles corresponding to the most populated 3D class were auto-refined with D2 symmetry. All resolution estimates are defined using a Fourier shell correlation (FSC) cutoff of 0.143. Tight masking yielded a final resolution of ∼4.0 Å averaged across 10 randomly sampled cryoRL trajectories and an average of ∼4.7 Å from the 10 trajectories by human test subjects, according to gold-standard FSC. Particles from the complete Aldolase<sup>Au</sup> dataset were subjected to a second round of 3D classification (5 classes, D2 symmetry) before a final 3D auto-refinement with D2 symmetry. The final resolution of the complete Aldolase<sup>Au</sup> dataset was ∼3.8 Å with tight masking applied. Images of all maps were captured using UCSF Chimera(<xref ref-type="bibr" rid="c28">Pettersen et al., 2004</xref>) (<bold><xref rid="figED5" ref-type="fig">Extended Data Fig. 5</xref></bold>).</p>
</sec>
<sec id="s6f">
<title>Jaccard similarity coefficient</title>
<p>The Jaccard similarity coefficient was calculated with the standard formula:
<disp-formula id="ueqn4">
<alternatives><graphic xlink:href="496614v2_ueqn4.gif" mimetype="image" mime-subtype="gif"/></alternatives>
</disp-formula>
where A and B are the two sets of micrographs that two different users or cryoRL collected.</p>
</sec>
<sec id="s6g">
<title>Cryo-EM sample preparation and data collection</title>
<p>Aldolase was prepared using rabbit muscle aldolase (Sigma Aldrich) at 1.6 mg/ml in a buffer of 20 mM HEPES (pH 7.4) and 50 mM NaCl onto either a freshly glow discharged Quantifoil 1.2/1.3 or UltrAuFoil grid plunge frozen using a Vitrobot Mark IV (Thermo Fisher Scientific). Recombinant mouse Apoferritin was purified as described in a protocol by Dr. Christos Savva. The sample was diluted to 4.1 mg/mL in buffer 50 mM Tris (pH 7.5), 100 mM NaCl, and 500 μM TCEP prior to application on a freshly glow discharged UltrAuFoil 1.2/1.3 grid using a Vitrobot Mark VI (Thermo Fisher Scientific). RNAPII was purified from <italic>S. cerevisiae</italic> as described(<xref ref-type="bibr" rid="c8">Farnung et al., 2021</xref>, <xref ref-type="bibr" rid="c9">2018</xref>). An RNAPII elongation complex was formed with factors Spt6, Spt4/5, and the Polymerase-associated complex 1 complex on a linear DNA construct as described(<xref ref-type="bibr" rid="c36">Vos et al., 2020</xref>). The complex was purified by size exclusion chromatography on an Äkta Micro (Cytvia) equipped with a Superose 6 3.2-300 column in a buffer containing 20 mM Na-HEPES pH 7.4, 75 mM NaCl, 3 mM MgCl2, 4% (v/v) glycerol. Fractions containing complex were assessed by SDS-PAGE, crosslinked with glutaraldehyde (PMID: 32541898), quenched, and dialyzed against a buffer containing 20 mM Na-HEPES pH 7.4, 75 mM NaCl, and 3 mM MgCl2 for 4 hrs at 4°C. The sample (final concentration 150-200 nM) was applied to freshly glow discharged Au-Flat 1.2/1.3 grids using a Vitrobot Mark VI (Thermo Fisher Scientific).</p>
<p>We imaged Aldolase and Apoferritin using a Talos Arctica (Thermo Fisher Scientific) equipped with a K2 Summit detector (Gatan Inc.) operating at 200 keV. Micrographs were collected in counted mode using a pixel size of 0.91Å/pixel. Aldolase<sup>Au</sup> was imaged using a Glacios (Thermo Fisher Scientific) equipped with a K2 Summit detector (Gatan Inc.) operating at 200 keV with a pixel size of 0.98Å/pixel in counted mode. RNAPII was imaged using a Titan Krios G2 equipped with a K3 detector (Gatan Inc.) behind a Gatan Imaging Filter (Gatan Inc.) operating at 300 keV with a slit width of 20 eV.</p>
<p>All data were collected using Leginon(<xref ref-type="bibr" rid="c34">Suloway et al., 2005</xref>). Movies were motion-corrected using MotionCor2(<xref ref-type="bibr" rid="c42">Zheng et al., 2017</xref>) and CTF-estimated with CTFFIND4(<xref ref-type="bibr" rid="c32">Rohou and Grigorieff, 2015</xref>) run from within the Appion environment(<xref ref-type="bibr" rid="c16">Lander et al., 2009</xref>).</p>
</sec>
<sec id="s6h">
<title>CryoRL specifics per grid</title>
<p>To train and test cryoRL on Aldolase, we collected a dataset of Aldolase using a Talos Arctica microscope equipped with a K2 detector. The dataset consisted of 3538 holes from 25 squares (<bold><xref rid="fig2" ref-type="fig">Fig. 2A</xref></bold>) and was split into training and test sets (1197 holes originating from 9 squares belong to the training set, and 2341 holes from the remaining 16 squares belong to the test set). Note that the training set represents only a small subset of the total data (33.8%). We trained both the deep regressor and RL network on the training set and applied the models on the test set to quantify the performance.</p>
<p>To test the transferability of RL models, we collected datasets of Apoferritin and RNA Polymerase II (RNAPII). The specifics of the regression models training and testing can be found in the “Deep regressors” section above. Specifically, the grid type used in RNAPII was not in the training set of the general regressor, therefore the prediction of the general regressor on RNAPII was poor. After fine-tuning, the performance of the regressor was still not optimal, but a general trend could be observed (<bold><xref rid="figED2" ref-type="fig">Extended Data Fig. 2C</xref></bold>). For RL networks, we simply used the RL model trained on the Aldolase dataset as a transferability test. We then applied the regressors and RL network to the test set to quantify the performance.</p>
<p>For Aldolase<sup>Au</sup>, we collected the systematic dataset consisting of 5822 holes from 30 squares. The general regressor and RL network trained on Aldolase were applied on this dataset to quantify the performance and compare it with the human study.</p>
</sec>
</sec>
<sec id="s7">
<title>Extended Figures</title>
<fig id="figED1" position="float" fig-type="figure">
<label>Extended Data Figure 1.</label>
<caption><title>Cryo-EM grids are complicated data landscapes.</title>
<p>(A) Overview of cryo-EM grid used for systematic data collection. Yellow squares indicate regions where almost every hole was collected. Regions a and b are shaded and zoomed in. (B) Zoom-in on the shaded regions a and b in (A), with ground truth CTFMaxRes values overlayed. (C) Zoom-in on the selected squares in (B) (top), with ground truth CTFMaxRes values overlaid (bottom). (B) and (C) share the same color bar. Note that in real data collection, ground truth CTFMaxRes values are unknown before the holes are visited.</p></caption>
<graphic xlink:href="496614v2_figED1.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<fig id="figED2" position="float" fig-type="figure">
<label>Extended Data Figure 2.</label>
<caption><title>Performance of the regressors on the test datasets.</title>
<p>(A) Performance of the regressor on the Aldolase dataset. The regressor was trained on a subset of the Aldolase dataset and tested on the rest of the dataset. (B) Performance of the general regressor on the Apoferritin dataset. (C) Performance of the regressor (fine-tuned from the general regressor) on the RNAPII dataset. (D) Performance of the general regressor on the Aldolase<sup>Au</sup> dataset.</p></caption>
<graphic xlink:href="496614v2_figED2.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<fig id="figED3" position="float" fig-type="figure">
<label>Extended Data Figure 3.</label>
<caption><title>Confusion matrices of the regressors on the test datasets.</title>
<p>(A) Confusion matrix of the regressor result on the Aldolase dataset at a cutoff of 6 Å. The regressor was trained on a subset of the Aldolase dataset and tested on the rest of the dataset. (B) Confusion matrix of the general regressor result on the Apoferritin dataset at a cutoff of 6 Å. (C) Confusion matrix of the regressor (fine-tuned from the general regressor) result on the RNAPII dataset at a cutoff of 6 Å. (D) Confusion matrix of the general regressor</p></caption>
<graphic xlink:href="496614v2_figED3.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<fig id="figED4" position="float" fig-type="figure">
<label>Extended Data Figure 4.</label>
<caption><title>Performance of each human test subject on the Aldolase<sup>Au</sup> dataset.</title>
<p>Detailed performance of each human test subject in the human study, compared with the performance of the baseline and cryoRL. Different grayscale colors indicate CTFMaxRes below 4 Å, between 4 Å and 5 Å, between 5 Å and 6 Å, and above 6 Å, as in the main text figures.</p></caption>
<graphic xlink:href="496614v2_figED4.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<fig id="figED5" position="float" fig-type="figure">
<label>Extended Data Figure 5.</label>
<caption><title>Sharpened 3D reconstructions of Aldolase<sup>Au</sup> from human and cryoRL trajectories.</title>
<p>Reconstructions from human subjects (gray) and cryoRL (orange).</p></caption>
<graphic xlink:href="496614v2_figED5.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<table-wrap id="tblED1" orientation="portrait" position="float">
<label>Extended Data Table 1.</label>
<caption><p>Input features to the deep-Q network</p></caption>
<graphic xlink:href="496614v2_tblED1.tif" mimetype="image" mime-subtype="tiff"/>
</table-wrap>
<table-wrap id="tblED2" orientation="portrait" position="float">
<label>Extended Data Table 2.</label>
<caption><p>Time cost table used in this study.</p></caption>
<graphic xlink:href="496614v2_tblED2.tif" mimetype="image" mime-subtype="tiff"/>
</table-wrap>
<table-wrap id="tblED3" orientation="portrait" position="float">
<label>Extended Data Table 3.</label>
<caption><p>Detailed information of the four experiments presented in this paper.</p></caption>
<graphic xlink:href="496614v2_tblED3.tif" mimetype="image" mime-subtype="tiff"/>
</table-wrap>
</sec>
<sec id="s8">
<title>Supplemental Data</title>
<p>Supplemental Movie 1 - Demonstration of the cryo-EM data collection simulator used in the human study.</p>
</sec>
<ref-list>
<title>References</title>
<ref id="c1"><mixed-citation publication-type="other"><string-name><surname>Balaji</surname> <given-names>B</given-names></string-name>, <string-name><surname>Mallya</surname> <given-names>S</given-names></string-name>, <string-name><surname>Genc</surname> <given-names>S</given-names></string-name>, <string-name><surname>Gupta</surname> <given-names>S</given-names></string-name>, <string-name><surname>Dirac</surname> <given-names>L</given-names></string-name>, <string-name><surname>Khare</surname> <given-names>V</given-names></string-name>, <string-name><surname>Roy</surname> <given-names>G</given-names></string-name>, <string-name><surname>Sun</surname> <given-names>T</given-names></string-name>, <string-name><surname>Tao</surname> <given-names>Y</given-names></string-name>, <string-name><surname>Townsend</surname> <given-names>B</given-names></string-name>, <string-name><surname>Calleja</surname> <given-names>E</given-names></string-name>, <string-name><surname>Muralidhara</surname> <given-names>S</given-names></string-name>, <string-name><surname>Karuppasamy</surname> <given-names>D.</given-names></string-name> <year>2020</year>. <source>DeepRacer: Autonomous Racing Platform for Experimentation with Sim2Real Reinforcement Learning2020 IEEE International Conference on Robotics and Automation (ICRA)</source>. pp. <fpage>2746</fpage>–<lpage>2754</lpage>.</mixed-citation></ref>
<ref id="c2"><mixed-citation publication-type="journal"><string-name><surname>Bengio</surname> <given-names>Y</given-names></string-name>, <string-name><surname>Lodi</surname> <given-names>A</given-names></string-name>, <string-name><surname>Prouvost</surname> <given-names>A.</given-names></string-name> <year>2021</year>. <article-title>Machine learning for combinatorial optimization: A methodological tour d’horizon</article-title>. <source>Eur J Oper Res</source> <volume>290</volume>:<fpage>405</fpage>–<lpage>421</lpage>.</mixed-citation></ref>
<ref id="c3"><mixed-citation publication-type="book"><string-name><surname>Bouvette</surname> <given-names>J</given-names></string-name>, <string-name><surname>Huang</surname> <given-names>Q</given-names></string-name>, <string-name><surname>Bartesaghi</surname> <given-names>A</given-names></string-name>, <string-name><surname>Borgnia</surname> <given-names>MJ.</given-names></string-name> <year>2021</year>. <source>Smartscope: AI-driven grid navigation for high-throughput cryo-EM2021 IEEE Applied Imagery Pattern Recognition Workshop (AIPR)</source>. <publisher-name>IEEE</publisher-name>. pp. <fpage>1</fpage>–<lpage>6</lpage>.</mixed-citation></ref>
<ref id="c4"><mixed-citation publication-type="journal"><string-name><surname>Cheng</surname> <given-names>A</given-names></string-name>, <string-name><surname>Eng</surname> <given-names>ET</given-names></string-name>, <string-name><surname>Alink</surname> <given-names>L</given-names></string-name>, <string-name><surname>Rice</surname> <given-names>WJ</given-names></string-name>, <string-name><surname>Jordan</surname> <given-names>KD</given-names></string-name>, <string-name><surname>Kim</surname> <given-names>LY</given-names></string-name>, <string-name><surname>Potter</surname> <given-names>CS</given-names></string-name>, <string-name><surname>Carragher</surname> <given-names>B.</given-names></string-name> <year>2018</year>. <article-title>High resolution single particle cryo-electron microscopy using beam-image shift</article-title>. <source>J Struct Biol</source> <volume>204</volume>:<fpage>270</fpage>–<lpage>275</lpage>.</mixed-citation></ref>
<ref id="c5"><mixed-citation publication-type="journal"><string-name><surname>Cheng</surname> <given-names>A</given-names></string-name>, <string-name><surname>Kim</surname> <given-names>PT</given-names></string-name>, <string-name><surname>Kuang</surname> <given-names>H</given-names></string-name>, <string-name><surname>Mendez</surname> <given-names>JH</given-names></string-name>, <string-name><surname>Chua</surname> <given-names>EYD</given-names></string-name>, <string-name><surname>Maruthi</surname> <given-names>K</given-names></string-name>, <string-name><surname>Wei</surname> <given-names>H</given-names></string-name>, <string-name><surname>Sawh</surname> <given-names>A</given-names></string-name>, <string-name><surname>Aragon</surname> <given-names>MF</given-names></string-name>, <string-name><surname>Serbynovskyi</surname> <given-names>V</given-names></string-name>, <string-name><surname>Neselu</surname> <given-names>K</given-names></string-name>, <string-name><surname>Eng</surname> <given-names>ET</given-names></string-name>, <string-name><surname>Potter</surname> <given-names>CS</given-names></string-name>, <string-name><surname>Carragher</surname> <given-names>B</given-names></string-name>, <string-name><surname>Bepler</surname> <given-names>T</given-names></string-name>, <string-name><surname>Noble</surname> <given-names>AJ.</given-names></string-name> <year>2023</year>. <article-title>Fully automated multi-grid cryoEM screening using Smart Leginon</article-title>. <source>IUCrJ</source> <volume>10</volume>:<fpage>77</fpage>–<lpage>89</lpage>.</mixed-citation></ref>
<ref id="c6"><mixed-citation publication-type="journal"><string-name><surname>Cianfrocco</surname> <given-names>MA</given-names></string-name>, <string-name><surname>Kellogg</surname> <given-names>EH.</given-names></string-name> <year>2020</year>. <article-title>What Could Go Wrong? A Practical Guide to Single-Particle Cryo-EM: From Biochemistry to Atomic Models</article-title>. <source>J Chem Inf Model</source> <volume>60</volume>:<fpage>2458</fpage>–<lpage>2469</lpage>.</mixed-citation></ref>
<ref id="c7"><mixed-citation publication-type="other"><string-name><surname>Fan</surname> <given-names>Q</given-names></string-name>, <string-name><surname>Li</surname> <given-names>Y</given-names></string-name>, <string-name><surname>Yao</surname> <given-names>Y</given-names></string-name>, <string-name><surname>Cohn</surname> <given-names>J</given-names></string-name>, <string-name><surname>Liu</surname> <given-names>S</given-names></string-name>, <string-name><surname>Vos</surname> <given-names>SM</given-names></string-name>, <string-name><surname>Cianfrocco</surname> <given-names>MA.</given-names></string-name> <year>2022</year>. <article-title>CryoRL: Reinforcement Learning Enables Efficient Cryo-EM Data Collection</article-title>. <source>arXiv [csLG]</source>.</mixed-citation></ref>
<ref id="c8"><mixed-citation publication-type="journal"><string-name><surname>Farnung</surname> <given-names>L</given-names></string-name>, <string-name><surname>Ochmann</surname> <given-names>M</given-names></string-name>, <string-name><surname>Engeholm</surname> <given-names>M</given-names></string-name>, <string-name><surname>Cramer</surname> <given-names>P.</given-names></string-name> <year>2021</year>. <article-title>Structural basis of nucleosome transcription mediated by Chd1 and FACT</article-title>. <source>Nat Struct Mol Biol</source> <volume>28</volume>:<fpage>382</fpage>–<lpage>387</lpage>.</mixed-citation></ref>
<ref id="c9"><mixed-citation publication-type="journal"><string-name><surname>Farnung</surname> <given-names>L</given-names></string-name>, <string-name><surname>Vos</surname> <given-names>SM</given-names></string-name>, <string-name><surname>Cramer</surname> <given-names>P.</given-names></string-name> <year>2018</year>. <article-title>Structure of transcribing RNA polymerase II-nucleosome complex</article-title>. <source>Nat Commun</source> <volume>9</volume>:<fpage>5432</fpage>.</mixed-citation></ref>
<ref id="c10"><mixed-citation publication-type="other"><string-name><surname>Hambly</surname> <given-names>B</given-names></string-name>, <string-name><surname>Xu</surname> <given-names>R</given-names></string-name>, <string-name><surname>Yang</surname> <given-names>H.</given-names></string-name> <year>2021</year>. <article-title>Recent Advances in Reinforcement Learning in Finance</article-title>. <source>arXiv [q-finMF]</source>.</mixed-citation></ref>
<ref id="c11"><mixed-citation publication-type="other"><string-name><surname>Kalashnikov</surname> <given-names>D</given-names></string-name>, <string-name><surname>Irpan</surname> <given-names>A</given-names></string-name>, <string-name><surname>Pastor</surname> <given-names>P</given-names></string-name>, <string-name><surname>Ibarz</surname> <given-names>J</given-names></string-name>, <string-name><surname>Herzog</surname> <given-names>A</given-names></string-name>, <string-name><surname>Jang</surname> <given-names>E</given-names></string-name>, <string-name><surname>Quillen</surname> <given-names>D</given-names></string-name>, <string-name><surname>Holly</surname> <given-names>E</given-names></string-name>, <string-name><surname>Kalakrishnan</surname> <given-names>M</given-names></string-name>, <string-name><surname>Vanhoucke</surname> <given-names>V</given-names></string-name>, Others. <year>2018</year>. <article-title>Qt-opt: Scalable deep reinforcement learning for vision-based robotic manipulation</article-title>. <source>arXiv. arXiv preprint</source> arXiv:180610293.</mixed-citation></ref>
<ref id="c12"><mixed-citation publication-type="other"><string-name><surname>Kim</surname> <given-names>PT</given-names></string-name>, <string-name><surname>Noble</surname> <given-names>AJ</given-names></string-name>, <string-name><surname>Cheng</surname> <given-names>A</given-names></string-name>, <string-name><surname>Bepler</surname> <given-names>T.</given-names></string-name> <year>2021</year>. <article-title>Learning to automate cryo-electron microscopy data collection with Ptolemy</article-title>. <source>arXiv [eessIV]</source>.</mixed-citation></ref>
<ref id="c13"><mixed-citation publication-type="other"><string-name><surname>Kingma</surname> <given-names>DP</given-names></string-name>, <string-name><surname>Ba</surname> <given-names>J.</given-names></string-name> <year>2014</year>. <article-title>Adam: A Method for Stochastic Optimization</article-title>. <source>arXiv [csLG]</source>.</mixed-citation></ref>
<ref id="c14"><mixed-citation publication-type="other"><string-name><surname>Kirkpatrick</surname> <given-names>S.</given-names></string-name> <year>1984</year>. <article-title>Optimization by simulated annealing: Quantitative studies</article-title>. <source>Journal of Statistical Physics</source>. doi:<pub-id pub-id-type="doi">10.1007/bf01009452</pub-id></mixed-citation></ref>
<ref id="c15"><mixed-citation publication-type="other"><string-name><surname>Kühlbrandt</surname> <given-names>W.</given-names></string-name> <year>2014</year>. <article-title>Biochemistry. The resolution revolution</article-title>. <source>Science</source>.</mixed-citation></ref>
<ref id="c16"><mixed-citation publication-type="journal"><string-name><surname>Lander</surname> <given-names>GC</given-names></string-name>, <string-name><surname>Stagg</surname> <given-names>SM</given-names></string-name>, <string-name><surname>Voss</surname> <given-names>NR</given-names></string-name>, <string-name><surname>Cheng</surname> <given-names>A</given-names></string-name>, <string-name><surname>Fellmann</surname> <given-names>D</given-names></string-name>, <string-name><surname>Pulokas</surname> <given-names>J</given-names></string-name>, <string-name><surname>Yoshioka</surname> <given-names>C</given-names></string-name>, <string-name><surname>Irving</surname> <given-names>C</given-names></string-name>, <string-name><surname>Mulder</surname> <given-names>A</given-names></string-name>, <string-name><surname>Lau</surname> <given-names>P-W</given-names></string-name>, <string-name><surname>Lyumkis</surname> <given-names>D</given-names></string-name>, <string-name><surname>Potter</surname> <given-names>CS</given-names></string-name>, <string-name><surname>Carragher</surname> <given-names>B.</given-names></string-name> <year>2009</year>. <article-title>Appion: an integrated, database-driven pipeline to facilitate EM image processing</article-title>. <source>J Struct Biol</source> <volume>166</volume>:<fpage>95</fpage>–<lpage>102</lpage>.</mixed-citation></ref>
<ref id="c17"><mixed-citation publication-type="journal"><string-name><surname>Lazaric</surname> <given-names>A</given-names></string-name>, <string-name><surname>Restelli</surname> <given-names>M</given-names></string-name>, <string-name><surname>Bonarini</surname> <given-names>A.</given-names></string-name> <year>2007</year>. <article-title>Reinforcement learning in continuous action spaces through sequential Monte Carlo methods</article-title>. <source>Adv Neural Inf Process Syst</source> <volume>20</volume>.</mixed-citation></ref>
<ref id="c18"><mixed-citation publication-type="journal"><string-name><surname>Le N</surname>, <given-names>Rathour VS</given-names></string-name>, <string-name><surname>Yamazaki</surname> <given-names>K</given-names></string-name>, <string-name><surname>Luu</surname> <given-names>K</given-names></string-name>, <string-name><surname>Savvides</surname> <given-names>M.</given-names></string-name> <year>2022</year>. <article-title>Deep reinforcement learning in computer vision: a comprehensive survey</article-title>. <source>Artificial Intelligence Review</source> <volume>55</volume>:<fpage>2733</fpage>–<lpage>2819</lpage>.</mixed-citation></ref>
<ref id="c19"><mixed-citation publication-type="other"><string-name><surname>Li</surname> <given-names>Y.</given-names></string-name> <year>2017</year>. <article-title>Deep Reinforcement Learning: An Overview</article-title>. <source>arXiv [csLG]</source>.</mixed-citation></ref>
<ref id="c20"><mixed-citation publication-type="journal"><string-name><surname>Li</surname> <given-names>Y</given-names></string-name>, <string-name><surname>Cash</surname> <given-names>JN</given-names></string-name>, <string-name><surname>Tesmer</surname> <given-names>JJG</given-names></string-name>, <string-name><surname>Cianfrocco</surname> <given-names>MA.</given-names></string-name> <year>2020</year>. <article-title>High-Throughput Cryo-EM Enabled by User-Free Preprocessing Routines</article-title>. <source>Structure</source> <volume>28</volume>:<fpage>858</fpage>–<lpage>869</lpage>.e3.</mixed-citation></ref>
<ref id="c21"><mixed-citation publication-type="other"><string-name><surname>Loshchilov</surname> <given-names>I</given-names></string-name>, <string-name><surname>Hutter</surname> <given-names>F.</given-names></string-name> <year>2016</year>. <article-title>SGDR: Stochastic Gradient Descent with Warm Restarts</article-title>. <source>arXiv [csLG]</source>.</mixed-citation></ref>
<ref id="c22"><mixed-citation publication-type="journal"><string-name><surname>Mazyavkina</surname> <given-names>N</given-names></string-name>, <string-name><surname>Sviridov</surname> <given-names>S</given-names></string-name>, <string-name><surname>Ivanov</surname> <given-names>S</given-names></string-name>, <string-name><surname>Burnaev</surname> <given-names>E.</given-names></string-name> <year>2021</year>. <article-title>Reinforcement learning for combinatorial optimization: A survey</article-title>. <source>Comput Oper Res</source> <volume>134</volume>:<fpage>105400</fpage>.</mixed-citation></ref>
<ref id="c23"><mixed-citation publication-type="book"><string-name><surname>McMullan</surname> <given-names>G</given-names></string-name>, <string-name><surname>Faruqi</surname> <given-names>AR</given-names></string-name>, <string-name><surname>Henderson</surname> <given-names>R.</given-names></string-name> <year>2016</year>. <chapter-title>Chapter One - Direct Electron Detectors</chapter-title> In: <person-group person-group-type="editor"><string-name><surname>Crowther</surname> <given-names>RA</given-names></string-name>, editor</person-group>. <source>Methods in Enzymology</source>. <publisher-name>Academic Press</publisher-name>. pp. <fpage>1</fpage>–<lpage>17</lpage>.</mixed-citation></ref>
<ref id="c24"><mixed-citation publication-type="other"><string-name><surname>Mnih</surname> <given-names>V</given-names></string-name>, <string-name><surname>Kavukcuoglu</surname> <given-names>K</given-names></string-name>, <string-name><surname>Silver</surname> <given-names>D</given-names></string-name>, <string-name><surname>Graves</surname> <given-names>A</given-names></string-name>, <string-name><surname>Antonoglou</surname> <given-names>I</given-names></string-name>, <string-name><surname>Wierstra</surname> <given-names>D</given-names></string-name>, <string-name><surname>Riedmiller</surname> <given-names>M.</given-names></string-name> <year>2013</year>. <article-title>Playing Atari with Deep Reinforcement Learning</article-title>. <source>arXiv [csLG]</source>.</mixed-citation></ref>
<ref id="c25"><mixed-citation publication-type="journal"><string-name><surname>Nogales</surname> <given-names>E</given-names></string-name>, <string-name><surname>Scheres</surname> <given-names>SHW.</given-names></string-name> <year>2015</year>. <article-title>Cryo-EM: A Unique Tool for the Visualization of Macromolecular Complexity</article-title>. <source>Mol Cell</source> <volume>58</volume>:<fpage>677</fpage>–<lpage>689</lpage>.</mixed-citation></ref>
<ref id="c26"><mixed-citation publication-type="other"><collab>OpenAI, :</collab>, <string-name><surname>Berner</surname> <given-names>C</given-names></string-name>, <string-name><surname>Brockman</surname> <given-names>G</given-names></string-name>, <string-name><surname>Chan</surname> <given-names>B</given-names></string-name>, <string-name><surname>Cheung</surname> <given-names>V</given-names></string-name>, <string-name><surname>Debiak</surname> <given-names>P</given-names></string-name>, <string-name><surname>Dennison</surname> <given-names>C</given-names></string-name>, <string-name><surname>Farhi</surname> <given-names>D</given-names></string-name>, <string-name><surname>Fischer</surname> <given-names>Q</given-names></string-name>, <string-name><surname>Hashme</surname> <given-names>S</given-names></string-name>, <string-name><surname>Hesse</surname> <given-names>C</given-names></string-name>, <string-name><surname>Józefowicz</surname> <given-names>R</given-names></string-name>, <string-name><surname>Gray</surname> <given-names>S</given-names></string-name>, <string-name><surname>Olsson</surname> <given-names>C</given-names></string-name>, <string-name><surname>Pachocki</surname> <given-names>J</given-names></string-name>, <string-name><surname>Petrov</surname> <given-names>M</given-names></string-name>, <string-name><surname>Pinto</surname> <given-names>HP d.</given-names></string-name>, <string-name><surname>Raiman</surname> <given-names>J</given-names></string-name>, <string-name><surname>Salimans</surname> <given-names>T</given-names></string-name>, <string-name><surname>Schlatter</surname> <given-names>J</given-names></string-name>, <string-name><surname>Schneider</surname> <given-names>J</given-names></string-name>, <string-name><surname>Sidor</surname> <given-names>S</given-names></string-name>, <string-name><surname>Sutskever</surname> <given-names>I</given-names></string-name>, <string-name><surname>Tang</surname> <given-names>J</given-names></string-name>, <string-name><surname>Wolski</surname> <given-names>F</given-names></string-name>, <string-name><surname>Zhang</surname> <given-names>S.</given-names></string-name> <year>2019</year>. <article-title>Dota 2 with Large Scale Deep Reinforcement Learning</article-title>. <source>arXiv [csLG]</source>.</mixed-citation></ref>
<ref id="c27"><mixed-citation publication-type="other"><string-name><surname>Ouali</surname> <given-names>Y</given-names></string-name>, <string-name><surname>Hudelot</surname> <given-names>C</given-names></string-name>, <string-name><surname>Tami</surname> <given-names>M.</given-names></string-name> <year>2020</year>. <article-title>An Overview of Deep Semi-Supervised Learning</article-title>. <source>arXiv [csLG]</source>.</mixed-citation></ref>
<ref id="c28"><mixed-citation publication-type="journal"><string-name><surname>Pettersen</surname> <given-names>EF</given-names></string-name>, <string-name><surname>Goddard</surname> <given-names>TD</given-names></string-name>, <string-name><surname>Huang</surname> <given-names>CC</given-names></string-name>, <string-name><surname>Couch</surname> <given-names>GS</given-names></string-name>, <string-name><surname>Greenblatt</surname> <given-names>DM</given-names></string-name>, <string-name><surname>Meng</surname> <given-names>EC</given-names></string-name>, <string-name><surname>Ferrin</surname> <given-names>TE.</given-names></string-name> <year>2004</year>. <article-title>UCSF Chimera--a visualization system for exploratory research and analysis</article-title>. <source>J Comput Chem</source> <volume>25</volume>:<fpage>1605</fpage>–<lpage>1612</lpage>.</mixed-citation></ref>
<ref id="c29"><mixed-citation publication-type="journal"><string-name><surname>Punjani</surname> <given-names>A</given-names></string-name>, <string-name><surname>Rubinstein</surname> <given-names>JL</given-names></string-name>, <string-name><surname>Fleet</surname> <given-names>DJ</given-names></string-name>, <string-name><surname>Brubaker</surname> <given-names>MA.</given-names></string-name> <year>2017</year>. <article-title>cryoSPARC: algorithms for rapid unsupervised cryo-EM structure determination</article-title>. <source>Nat Methods</source> <volume>14</volume>:<fpage>290</fpage>–<lpage>296</lpage>.</mixed-citation></ref>
<ref id="c30"><mixed-citation publication-type="journal"><string-name><surname>Rapp</surname> <given-names>M</given-names></string-name>, <string-name><surname>Shapiro</surname> <given-names>L</given-names></string-name>, <string-name><surname>Frank</surname> <given-names>J.</given-names></string-name> <year>2022</year>. <article-title>Contributions of single-particle cryoelectron microscopy toward fighting COVID-19</article-title>. <source>Trends Biochem Sci</source> <volume>47</volume>:<fpage>117</fpage>–<lpage>123</lpage>.</mixed-citation></ref>
<ref id="c31"><mixed-citation publication-type="journal"><string-name><surname>Ren</surname> <given-names>P</given-names></string-name>, <string-name><surname>Xiao</surname> <given-names>Y</given-names></string-name>, <string-name><surname>Chang</surname> <given-names>X</given-names></string-name>, <string-name><surname>Huang</surname> <given-names>P-Y</given-names></string-name>, <string-name><surname>Li</surname> <given-names>Z</given-names></string-name>, <string-name><surname>Gupta</surname> <given-names>BB</given-names></string-name>, <string-name><surname>Chen</surname> <given-names>X</given-names></string-name>, <string-name><surname>Wang</surname> <given-names>X.</given-names></string-name> <year>2021</year>. <article-title>A Survey of Deep Active Learning</article-title>. <source>ACM Comput Surv</source> <volume>54</volume>:<fpage>1</fpage>–<lpage>40</lpage>.</mixed-citation></ref>
<ref id="c32"><mixed-citation publication-type="journal"><string-name><surname>Rohou</surname> <given-names>A</given-names></string-name>, <string-name><surname>Grigorieff</surname> <given-names>N.</given-names></string-name> <year>2015</year>. <article-title>CTFFIND4: Fast and accurate defocus estimation from electron micrographs</article-title>. <source>J Struct Biol</source> <volume>192</volume>:<fpage>216</fpage>–<lpage>221</lpage>.</mixed-citation></ref>
<ref id="c33"><mixed-citation publication-type="journal"><string-name><surname>Silver</surname> <given-names>D</given-names></string-name>, <string-name><surname>Huang</surname> <given-names>A</given-names></string-name>, <string-name><surname>Maddison</surname> <given-names>CJ</given-names></string-name>, <string-name><surname>Guez</surname> <given-names>A</given-names></string-name>, <string-name><surname>Sifre</surname> <given-names>L</given-names></string-name>, <string-name><surname>van den Driessche</surname> <given-names>G</given-names></string-name>, <string-name><surname>Schrittwieser</surname> <given-names>J</given-names></string-name>, <string-name><surname>Antonoglou</surname> <given-names>I</given-names></string-name>, <string-name><surname>Panneershelvam</surname> <given-names>V</given-names></string-name>, <string-name><surname>Lanctot</surname> <given-names>M</given-names></string-name>, <string-name><surname>Dieleman</surname> <given-names>S</given-names></string-name>, <string-name><surname>Grewe</surname> <given-names>D</given-names></string-name>, <string-name><surname>Nham</surname> <given-names>J</given-names></string-name>, <string-name><surname>Kalchbrenner</surname> <given-names>N</given-names></string-name>, <string-name><surname>Sutskever</surname> <given-names>I</given-names></string-name>, <string-name><surname>Lillicrap</surname> <given-names>T</given-names></string-name>, <string-name><surname>Leach</surname> <given-names>M</given-names></string-name>, <string-name><surname>Kavukcuoglu</surname> <given-names>K</given-names></string-name>, <string-name><surname>Graepel</surname> <given-names>T</given-names></string-name>, <string-name><surname>Hassabis</surname> <given-names>D.</given-names></string-name> <year>2016</year>. <article-title>Mastering the game of Go with deep neural networks and tree search</article-title>. <source>Nature</source> <volume>529</volume>:<fpage>484</fpage>–<lpage>489</lpage>.</mixed-citation></ref>
<ref id="c34"><mixed-citation publication-type="journal"><string-name><surname>Suloway</surname> <given-names>C</given-names></string-name>, <string-name><surname>Pulokas</surname> <given-names>J</given-names></string-name>, <string-name><surname>Fellmann</surname> <given-names>D</given-names></string-name>, <string-name><surname>Cheng</surname> <given-names>A</given-names></string-name>, <string-name><surname>Guerra</surname> <given-names>F</given-names></string-name>, <string-name><surname>Quispe</surname> <given-names>J</given-names></string-name>, <string-name><surname>Stagg</surname> <given-names>S</given-names></string-name>, <string-name><surname>Potter</surname> <given-names>CS</given-names></string-name>, <string-name><surname>Carragher</surname> <given-names>B.</given-names></string-name> <year>2005</year>. <article-title>Automated molecular microscopy: the new Leginon system</article-title>. <source>J Struct Biol</source> <volume>151</volume>:<fpage>41</fpage>–<lpage>60</lpage>.</mixed-citation></ref>
<ref id="c35"><mixed-citation publication-type="other"><string-name><surname>Tegunov</surname> <given-names>D</given-names></string-name>, <string-name><surname>Cramer</surname> <given-names>P.</given-names></string-name> <year>2019</year>. <article-title>Real-time cryo-electron microscopy data preprocessing with Warp</article-title>. <source>Nat Methods</source>. doi:<pub-id pub-id-type="doi">10.1038/s41592-019-0580-y</pub-id></mixed-citation></ref>
<ref id="c36"><mixed-citation publication-type="journal"><string-name><surname>Vos</surname> <given-names>SM</given-names></string-name>, <string-name><surname>Farnung</surname> <given-names>L</given-names></string-name>, <string-name><surname>Linden</surname> <given-names>A</given-names></string-name>, <string-name><surname>Urlaub</surname> <given-names>H</given-names></string-name>, <string-name><surname>Cramer</surname> <given-names>P.</given-names></string-name> <year>2020</year>. <article-title>Structure of complete Pol II-DSIF-PAF-SPT6 transcription complex reveals RTF1 allosteric activation</article-title>. <source>Nat Struct Mol Biol</source> <volume>27</volume>:<fpage>668</fpage>–<lpage>677</lpage>.</mixed-citation></ref>
<ref id="c37"><mixed-citation publication-type="other"><string-name><surname>Weise</surname> <given-names>T.</given-names></string-name> <year>2009</year>. <article-title>Global optimization algorithms: Theory and application. ebook</article-title>. <source>Nature Inspired Computation and Applications Laboratory (NICAL), University of Science and Technology, China</source>.</mixed-citation></ref>
<ref id="c38"><mixed-citation publication-type="journal"><string-name><surname>Weis</surname> <given-names>F</given-names></string-name>, <string-name><surname>Hagen</surname> <given-names>WJH.</given-names></string-name> <year>2020</year>. <article-title>Combining high throughput and high quality for cryo-electron microscopy data collection</article-title>. <source>Acta Crystallogr D Struct Biol</source> <volume>76</volume>:<fpage>724</fpage>–<lpage>728</lpage>.</mixed-citation></ref>
<ref id="c39"><mixed-citation publication-type="journal"><string-name><surname>Wigge</surname> <given-names>C</given-names></string-name>, <string-name><surname>Stefanovic</surname> <given-names>A</given-names></string-name>, <string-name><surname>Radjainia</surname> <given-names>M.</given-names></string-name> <year>2020</year>. <article-title>The rapidly evolving role of cryo-EM in drug design</article-title>. <source>Drug Discov Today Technol</source> <volume>38</volume>:<fpage>91</fpage>–<lpage>102</lpage>.</mixed-citation></ref>
<ref id="c40"><mixed-citation publication-type="journal"><string-name><surname>Wu</surname> <given-names>M</given-names></string-name>, <string-name><surname>Lander</surname> <given-names>GC</given-names></string-name>, <string-name><given-names>Herzik MA</given-names> <surname>Jr</surname></string-name>. <year>2020</year>. <article-title>Sub-2 Angstrom resolution structure determination using single-particle cryo-EM at 200 keV</article-title>. <source>J Struct Biol X</source> <volume>4</volume>:<fpage>100020</fpage>.</mixed-citation></ref>
<ref id="c41"><mixed-citation publication-type="journal"><string-name><surname>Yu</surname> <given-names>C</given-names></string-name>, <string-name><surname>Liu</surname> <given-names>J</given-names></string-name>, <string-name><surname>Nemati</surname> <given-names>S</given-names></string-name>, <string-name><surname>Yin</surname> <given-names>G.</given-names></string-name> <year>2021</year>. <article-title>Reinforcement Learning in Healthcare: A Survey</article-title>. <source>ACM Comput Surv</source> <volume>55</volume>:<fpage>1</fpage>–<lpage>36</lpage>.</mixed-citation></ref>
<ref id="c42"><mixed-citation publication-type="journal"><string-name><surname>Zheng</surname> <given-names>SQ</given-names></string-name>, <string-name><surname>Palovcak</surname> <given-names>E</given-names></string-name>, <string-name><surname>Armache</surname> <given-names>J-P</given-names></string-name>, <string-name><surname>Verba</surname> <given-names>KA</given-names></string-name>, <string-name><surname>Cheng</surname> <given-names>Y</given-names></string-name>, <string-name><surname>Agard</surname> <given-names>DA.</given-names></string-name> <year>2017</year>. <article-title>MotionCor2: anisotropic correction of beam-induced motion for improved cryo-electron microscopy</article-title>. <source>Nat Methods</source> <volume>14</volume>:<fpage>331</fpage>–<lpage>332</lpage>.</mixed-citation></ref>
</ref-list>
</back>
<sub-article id="sa0" article-type="editor-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.88640.1.sa3</article-id>
<title-group>
<article-title>eLife Assessment</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<name>
<surname>Frost</surname>
<given-names>Adam</given-names>
</name>
<role specific-use="editor">Reviewing Editor</role>
<aff>
<institution-wrap>
<institution>University of California, San Francisco (Adjunct)</institution>
</institution-wrap>
<city>San Francisco</city>
<country>United States of America</country>
</aff>
</contrib>
</contrib-group>
<kwd-group kwd-group-type="evidence-strength">
<kwd>Solid</kwd>
</kwd-group>
<kwd-group kwd-group-type="claim-importance">
<kwd>Valuable</kwd>
</kwd-group>
</front-stub>
<body>
<p>Cryo-EM has become the dominant method in structural biochemistry, and making more efficient use of expensive microscope time is therefore of broad interest to academic and industrial users. The authors identify a bottleneck in cryoEM data collection, namely path optimization, and provide a <bold>valuable</bold> machine-learning model to overcome this bottleneck. The <bold>solid</bold> data presented suggests their model can replace a human operator to automate efficient data collection.</p>
</body>
</sub-article>
<sub-article id="sa1" article-type="referee-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.88640.1.sa2</article-id>
<title-group>
<article-title>Reviewer #1 (Public Review):</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<anonymous/>
<role specific-use="referee">Reviewer</role>
</contrib>
</contrib-group>
</front-stub>
<body>
<p>Li, Fan et al. designed and evaluated a reinforcement learning (RL) based model to automate the planning of an optimal path for the collection of data for single particle cryo-electron microscopy. The goal was to maximize the quality of the data while minimizing the time required for acquisition. They use a deep regressor (DR) to rank all the targets in the grid based on their quality as predicted from low-magnification images. In the cryo-RL model, the prediction of the DR is modified by the result of a deep Q-network (DQN) driven by a reward based on the real-time assessment of newly acquired images and a penalty based on the time required to move the microscope stage to explore new areas of the specimen. The DR and the DQN are trained on a set of low-magnification preview images and their corresponding high-magnification recordings labeled based on the quality of fit of the contrast transfer function (the CTFMaxRes parameter). The distribution of quality of a series of non-ranked trajectories was used as a snowball baseline (SB). Importantly, all tests in this paper were performed on four datasets collected by an exhaustive sampling of the grid. Thus, all data is available to all protocols.</p>
<p>When trained on a subset of squares from the same grid, DR+DQN outperforms DR which in turn outperforms SB. To improve transferability between specimens, both DR and DQN were trained with a large dataset sourced from a variety of samples and grid types imaged at the Cianfrocco Lab. Comparison of the performance of Cryo-RL (DR+DQN), DR, SB and of human subjects with different levels of expertise indicates shows that Cryo-RL yields the most high-resolution images in the shortest time. Further, the quality of the maps obtained from subsets of data selected using Cryo-RL is on par with the best datasets collected manually, although the latter showed marked variability.</p>
<p>The demonstration that a low-magnification image contains sufficient information to predict the quality of high magnification counterpart is very encouraging. However, the authors show that this translates into a high-resolution structure for one of the four datasets. The use of CTFMaxRes, although prevalent in the field, is an incomplete estimator of the quality of micrographs. Even though both the DQN and DR can be trained using different criteria, it is not clear how strong a correlation between alternative parameters and the low-magnification images would be.</p>
<p>This study concentrates on three &quot;well-behaved&quot; samples that tend to distribute evenly in the holes. The behavior of many macromolecules, e.g. orientation bias and stability, correlates with ice thickness in convoluted ways. Since ice thickness can vary drastically throughout a single hole, the overall appearance may not be sufficient to ensure a recording of the region where &quot;good particles&quot; concentrate. In these cases, sub-hole characterization from the low-magnification images will be necessary to target the appropriate areas. However, the feasibility of such an approach is yet to be determined. All that said, this is a timely publication that is likely to have a positive impact on the efficiency of data collection for cryo-EM.</p>
</body>
</sub-article>
<sub-article id="sa2" article-type="referee-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.88640.1.sa1</article-id>
<title-group>
<article-title>Reviewer #2 (Public Review):</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<anonymous/>
<role specific-use="referee">Reviewer</role>
</contrib>
</contrib-group>
</front-stub>
<body>
<p>The authors identify a bottleneck in cryoEM data collection, namely path optimization, and provide a method and software to attempt to solve this problem, then evaluate the solution based on several metrics including full downstream processing. In addition, the authors report on a cryoEM data collection simulator, which could be used to more efficiently train users and microscope operators if released. I have experience with cryo-EM and applications of machine learning to cryoEM. In my opinion, the results are convincing insofar as showing that the algorithm employed by cryoRL performs at least as well as humans and with greater consistency than humans. I think combining cryoRL with existing square &amp; hole targeting algorithms and collection software has the potential to result in a complete and efficient automated solution for high-resolution cryoEM data collection.</p>
</body>
</sub-article>
<sub-article id="sa3" article-type="referee-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.88640.1.sa0</article-id>
<title-group>
<article-title>Reviewer #3 (Public Review):</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<anonymous/>
<role specific-use="referee">Reviewer</role>
</contrib>
</contrib-group>
</front-stub>
<body>
<p>The data presented suggest that their algorithm can replace a human operator, which is a strong enough reason to publish and disseminate the technology. At the same time, aspects of the methods and results could benefit from a clearer explication. For example, the reported R^2 values for their model's performance are less than 0.5, (0.191, 0.2, 0.345, 0.467). I take this to mean the model's predictions are better than the mean value but that it will probably not generalize well for data it hasn't seen yet. Please comment.</p>
<p>Did the authors partition their data into a training set, a validation set, and a test set? From the manuscript, it wasn't obvious to me they withheld a test set (a set of data never seen by the model, which they used to evaluate the performance of the model selected based on the validation set). From Extended Data Figures 1 and 2, I inferred that the number of samples in the confusion matrix matches the validation size (n=2341). So, are they reporting validation results and not test results? Please explain.</p>
</body>
</sub-article>
</article>