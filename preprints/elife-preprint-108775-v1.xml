<?xml version="1.0" ?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.3 20210610//EN"  "JATS-archivearticle1-mathml3.dtd"><article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.3" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="nlm-ta">elife</journal-id>
<journal-id journal-id-type="publisher-id">eLife</journal-id>
<journal-title-group>
<journal-title>eLife</journal-title>
</journal-title-group>
<issn publication-format="electronic" pub-type="epub">2050-084X</issn>
<publisher>
<publisher-name>eLife Sciences Publications, Ltd</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">108775</article-id>
<article-id pub-id-type="doi">10.7554/eLife.108775</article-id>
<article-id pub-id-type="doi" specific-use="version">10.7554/eLife.108775.1</article-id>
<article-version-alternatives>
<article-version article-version-type="publication-state">reviewed preprint</article-version>
<article-version article-version-type="preprint-version">1.2</article-version>
</article-version-alternatives>
<article-categories><subj-group subj-group-type="heading">
<subject>Neuroscience</subject>
</subj-group>
</article-categories><title-group>
<article-title>Extracting Value Coding Features from Individual Serotonin Neurons</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-0698-5894</contrib-id>
<name>
<surname>Harkin</surname>
<given-names>Emerson F</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="aff" rid="a2">2</xref>
<xref ref-type="aff" rid="a3">3</xref>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-7278-4906</contrib-id>
<name>
<surname>Béïque</surname>
<given-names>Jean-Claude</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="aff" rid="a2">2</xref>
<xref ref-type="aff" rid="a3">3</xref>
</contrib>
<contrib contrib-type="author" corresp="yes">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-7383-3095</contrib-id>
<name>
<surname>Naud</surname>
<given-names>Richard</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="aff" rid="a2">2</xref>
<xref ref-type="aff" rid="a3">3</xref>
<xref ref-type="aff" rid="a4">4</xref>
<email>rnaud@uottawa.ca</email>
</contrib>
<aff id="a1"><label>1</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/03c4mmv16</institution-id><institution>Department of Cellular and Molecular Medicine, University of Ottawa</institution></institution-wrap>, <city>Ottawa</city>, <country country="CA">Canada</country></aff>
<aff id="a2"><label>2</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/03c4mmv16</institution-id><institution>Centre for Neural Dynamics, University of Ottawa</institution></institution-wrap>, <city>Ottawa</city>, <country country="CA">Canada</country></aff>
<aff id="a3"><label>3</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/03c4mmv16</institution-id><institution>Brain and Mind Institute, University of Ottawa</institution></institution-wrap>, <city>Ottawa</city>, <country country="CA">Canada</country></aff>
<aff id="a4"><label>4</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/03c4mmv16</institution-id><institution>Department of Physics, University of Ottawa</institution></institution-wrap>, <city>Ottawa</city>, <country country="CA">Canada</country></aff>
</contrib-group>
<contrib-group content-type="section">
<contrib contrib-type="editor">
<name>
<surname>Nelson</surname>
<given-names>Sacha B</given-names>
</name>
<role>Reviewing Editor</role>
<aff>
<institution-wrap>
<institution-id institution-id-type="ror">https://ror.org/05abbep66</institution-id><institution>Brandeis University</institution>
</institution-wrap>
<city>Waltham</city>
<country country="US">United States</country>
</aff>
</contrib>
<contrib contrib-type="senior_editor">
<name>
<surname>Nelson</surname>
<given-names>Sacha B</given-names>
</name>
<role>Senior Editor</role>
<aff>
<institution-wrap>
<institution-id institution-id-type="ror">https://ror.org/05abbep66</institution-id><institution>Brandeis University</institution>
</institution-wrap>
<city>Waltham</city>
<country country="US">United States</country>
</aff>
</contrib>
</contrib-group>
<author-notes>
<fn fn-type="coi-statement"><p>Competing interests: No competing interests declared</p></fn>
</author-notes>
<pub-date date-type="original-publication" iso-8601-date="2025-11-06">
<day>06</day>
<month>11</month>
<year>2025</year>
</pub-date>
<volume>14</volume>
<elocation-id>RP108775</elocation-id>
<history>
<date date-type="sent-for-review" iso-8601-date="2025-09-06">
<day>06</day>
<month>09</month>
<year>2025</year>
</date>
</history>
<pub-history>
<event>
<event-desc>Preprint posted</event-desc>
<date date-type="preprint" iso-8601-date="2025-08-12">
<day>12</day>
<month>08</month>
<year>2025</year>
</date>
<self-uri content-type="preprint" xlink:href="https://doi.org/10.1101/2025.07.28.667134"/>
</event>
</pub-history>
<permissions>
<copyright-statement>© 2025, Harkin et al</copyright-statement>
<copyright-year>2025</copyright-year>
<copyright-holder>Harkin et al</copyright-holder>
<ali:free_to_read/>
<license xlink:href="https://creativecommons.org/licenses/by/4.0/">
<ali:license_ref>https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
<license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p>
</license>
</permissions>
<self-uri content-type="pdf" xlink:href="elife-preprint-108775-v1.pdf"/>
<abstract>
<p>Adaptive behaviour requires animals to continually reevaluate the appetitive or aversive quality of their surroundings. Dorsal raphe serotonin neurons, the main source of serotonergic input to the forebrain, have been implicated in both signaling the quality of an animal’s environment and regulating reward-seeking and punishmentavoiding behaviour, but the precise quantity signaled by these neurons has remained unclear, as well as how these neurons relate with behaviour. Using open-access recordings of serotonergic neurons of the dorsal raphe nucleus while animals perform a dynamic Pavlovian task, we compare firing rate and behavioral data with a model that considers reward history accumulated over a tunable timescale. Our Bayesian parameter estimation supports that serotonergic neurons are consistent with reward history being estimated over about a hundred trials on average, with a heterogeneity across individual neurons spanning 30 to 300 trials. Anticipatory licking also correlated with reward history at multiple timescale, but could not be dissociated from that of a time/thirst nuisance variable and otherwise mostly on a timescale faster than seen in serotonergic cells. These results provide a more precise picture of the dynamics of serotonergic cells under a dynamic Pavlovian task.</p>
</abstract>
<kwd-group kwd-group-type="author">
<title>Keywords</title>
<kwd>serotonin</kwd>
<kwd>reinforcement learning</kwd>
<kwd>neural coding</kwd>
</kwd-group>
<funding-group>
<award-group id="funding-1">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="ror">https://ror.org/01gavpb45</institution-id>
<institution>Canadian Institutes of Health Research</institution>
</institution-wrap>
</funding-source>
<award-id>PJT- 175319</award-id>
</award-group>
<award-group id="funding-1a">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="ror">https://ror.org/01gavpb45</institution-id>
<institution>Canadian Institutes of Health Research</institution>
</institution-wrap>
</funding-source>
<award-id>PJT-175325</award-id>
</award-group>
</funding-group>
<custom-meta-group>
<custom-meta specific-use="meta-only">
<meta-name>publishing-route</meta-name>
<meta-value>prc</meta-value>
</custom-meta>
</custom-meta-group>
</article-meta>
<notes>
<fn-group content-type="summary-of-updates">
<title>Summary of Updates:</title>
<fn fn-type="update"><p>Updated discussion with a new paragraph.</p></fn>
</fn-group>
</notes>
</front>
<body>
<sec id="s1">
<label>1</label>
<title>Introduction</title>
<p>Adaptive behaviour requires animals to continually reevaluate the quality of their environment. The serotonin neurons of the dorsal raphe nucleus (DRN) have been implicated in regulating (<xref ref-type="bibr" rid="c1">1</xref>–<xref ref-type="bibr" rid="c8">8</xref>) and signaling (<xref ref-type="bibr" rid="c9">9</xref>–<xref ref-type="bibr" rid="c13">13</xref>) behaviours that relate to environment quality, including fleeing, feeding and mating. Conceptually similar, the concept of state value, central to many reinforcement learning algorithms, is a precisely defined proxy of environment quality. State value has been a central quantity for models of Pavlovian conditioning for decades (<xref ref-type="bibr" rid="c14">14</xref>). This quantity was recently shown to predict features of DRN neuron activity, supporting the idea that bulk serotonergic activity in the brain signals state value (<xref ref-type="bibr" rid="c12">12</xref>). The precise relationship between single serotonergic neuron activity and the ever changing state value, however, remains unclear as it would require a quantitative model fitting approach. This is challenging because, in reinforcement learning, state value is dynamic, continually updated based on prior experience due to both a reward time horizon (value discounting timescale) and a value estimation timescale. The problem therefore requires that the timescales as well as the relevance of the code be assessed simultaneously. Going further, given that serotonergic and dopaminergic activity follow reward association with different learning timescales (<xref ref-type="bibr" rid="c15">15</xref>), the question arises of whether features of the behaviour correlates with value code at the learning timescale found in the majority, only some, or none of the serotonergic neurons. This question can be addressed by fitting anticipatory licking with a model of value evolving over multiple timescales and comparing the timescale of behaviour adaptation with that of the adaptation of responses in serotonergic cells.</p>
<p>Approaches to model fitting and model selection are separated in two broad categories. Given multiple hypotheses, the frequentist approach assigns probability to data and will select the model for which the data is most likely. The Bayesian approach assigns instead a probability to the hypotheses. This is done by building a sufficiently general model and estimating the confidence interval on the parameters that regulate the switch between different hypotheses. Here we used the Bayesian approach to relate a state value model with serotonin neuron activity recorded in mice performing a task with fluctuating reward delivery. We first developed a mathematical framework able to fit a value model on single neuron responses. The result show that different neurons have heterogeneous coding in 1) the degree to which their firing is consistent with state value and 2) the time scale with which the value signal is learned. While different neurons show different learning timescales, the average learning timescale we found was around 100 trials (10-20 min), consistent with a prior report based on population responses (<xref ref-type="bibr" rid="c15">15</xref>). Then, we leveraged simultaneous recording of anticipatory licking in the same experiments to ask if this aspect of behaviour was related to value coding at the timescale recorded in the serotonergic neurons. Adapting our Bayesian approach to behaviour, we found that only the value estimated on timescales faster than those associated on average with the value code in the DRN were correlated with anticipatory licking. While some serotonin neurons faster learning timescales than others, they still did not track the evolution of behaviour. Hence our work provides a quantitative report of potency of the value code and its learning timescale in individual serotonin neurons, an observed timescale that generally does not match the timescales correlated with behaviour.</p>
</sec>
<sec id="s2">
<label>2</label>
<title>Results</title>
<p>We used an openly accessible data set where mice performed a dynamic Pavlovian task (<xref rid="fig1" ref-type="fig">Fig. 1</xref>; Ref. (<xref ref-type="bibr" rid="c16">16</xref>); see Methods). In this task, rewards were associated with a cue based on a probability of reward that changed in piecewise constant blocks. The activity of genetically identified serotonergic cells were recorded using extracellular electrodes. Anticipatory licking was also recorded. While the activity during the randomly initiated trials has previously been shown to relate with state value (<xref ref-type="bibr" rid="c12">12</xref>), we focused on the activity in the inter-trial period because the greater number of action potentials makes it more amenable to track learning-related changes and it allows us to ignore the effect of the discounting timescale in a value model since this timescale is shorter than the trial duration (<xref ref-type="bibr" rid="c10">10</xref>, <xref ref-type="bibr" rid="c12">12</xref>). This approach is supported by both theory and previous observations, whereby the value of the inter-trial period scales with the value of the trace period (<xref ref-type="bibr" rid="c17">17</xref>) (see Discussion).</p>
<fig id="fig1" position="float" fig-type="figure">
<label>Figure 1.</label>
<caption><title>Overview of experimental setup and conceptual model.</title>
<p><bold>A</bold> Experimental setup in the dynamic Pavlovian conditioning task of Grossman et al.(<xref ref-type="bibr" rid="c16">16</xref>). In vivo electrophysiological recordings of the activity of individual geneticallyidentifieddorsal raphe nucleus (DRN) serotonin neurons were collected from headfixedmice receiving stochastic water rewards in a trace conditioning task. Trialsconsisted of a 1 s odour cue followed by a 1 s trace period and 3 s reward collectionwindow. Inter-trial interval (ITI) durations followed an exponential distribution with mean 3.3 s. Rewards were delivered with probability 20%, 50%, or 80% in a block structure with random uncued transitions. See Methods and ref. 16 for details. <bold>B</bold> Conceptual model. Recent reward history is used to calculate value, defined as an estimate of the probability of receiving a reward in the upcoming trial. We hypothesize that high value is reflected in both an increase in the ITI firing rates of serotonin neurons and an increase in anticipatory licking. <bold>C</bold> Time-course of reward collection probability (top), serotonin neuron firing rate (middle), and number of anticipatory licks per trial (bottom) for an example recording session. For illustration purposes, all data are smoothed using Gaussian process regression (squared exponential kernel with length scale 20 trials, observation standard deviation set to <inline-formula><inline-graphic xlink:href="667134v2_inline72.gif" mimetype="image" mime-subtype="gif"/></inline-formula> percent, 62ms, and <inline-formula><inline-graphic xlink:href="667134v2_inline73.gif" mimetype="image" mime-subtype="gif"/></inline-formula> licks for top, middle, and bottom, respectively). Bands represent an approximate 95% CI. Note that firing rates were obtained by analyzing the mean inter-spike interval (ISI) in each ITI, which more closely follows a normal distribution, and inverting the results.</p></caption>
<graphic xlink:href="667134v2_fig1.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<sec id="s2a">
<label>2.1</label>
<title>Reward, behaviour, and neural activity evolve slowly over time</title>
<p>As a first step, we sought to determine the timescales over which behaviour and neural activity evolve in this experiment. Frequency analysis of the autocorrelation patterns of reward collection, anticipatory licking, and serotonin neuron firing collectively revealed peaks at two frequencies: one near 1<italic>/</italic>70 cycles trial<sup><italic>⨪</italic>1</sup>, corresponding to the upper limit of the block length, and another near 1<italic>/</italic>350 cycles trial<sup><italic>⨪</italic>1</sup>, corresponding to the mean duration of a recording session (<xref rid="fig2" ref-type="fig">Fig. 2</xref>). Whereas previous analysis of this data focused on short-term fluctuations over the course of fewer than ten trials (<xref ref-type="bibr" rid="c12">12</xref>, <xref ref-type="bibr" rid="c16">16</xref>), these results suggest that both behaviour and neural activity mainly evolve over significantly longer timescales.</p>
<fig id="fig2" position="float" fig-type="figure">
<label>Figure 2.</label>
<caption>
<title>Reward collection, anticipatory licking behaviour, and serotonin neuron firing rates evolve slowly over time in a dynamic Pavlovian task.</title>
<p>Left column shows sample autocorrelation (individual sessions or neurons in gray, mean across sessions or neurons in blue), right column shows the estimated power spectrum (computed from the corresponding mean autocorrelation, see <xref ref-type="sec" rid="s5c3">Section 5.3.3</xref>). <bold>A</bold> Autocorrelation and power spectrum of reward collection. The power spectrum has a peak at 1/63 cycles trial⨪1. N = 28 sessions. <bold>B</bold> Autocorrelation and power spectrum of anticipatory licking. The power spectrum has peaks at 1/377 cycles trial⨪1 and 1/63 cycles trial⨪1. N = 28 sessions. <bold>C</bold> Autocorrelation and power spectrum of an exponentially-weighted moving average of reward collection using a time constant of τ = 4.5 trials. Only the mean across N = 28 sessions is shown. The power spectrum has a peak at 1/64 cycles trial⨪1. Compare with B. <bold>D</bold> Autocorrelation and power spectrum of serotonin neuron firing activity, quantified as the mean inter-spike interval during each inter-trial interval. The power spectrum has a peak at 1/339 cycles trial⨪1. N = 37 neurons. <bold>E</bold> Autocorrelation and power spectrum of an exponentially-weighted moving average of reward collection using a time constant of τ = 45 trials. Only the mean across N = 28 sessions is shown. The power spectrum has a peaks at 1/319 cycles trial⨪1 and 1/69 cycles trial⨪1. Compare with D. Autocorrelations in C and E are normalized such that the autocorrelations at lag one match the means shown in B and D, respectively. For clarity, the autocorrorelation at zero lag is not shown. The 20–70 trial block length used in the experiment and the corresponding frequency range of 1/70–1/20 cycles trial⨪1 are indicated in gray.</p>
</caption>
<graphic xlink:href="667134v2_fig2.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>Interestingly, fluctuations corresponding to block length and session length were not represented equally in the dynamics of reward collection, anticipatory licking, and serotonin neuron activity. The power spectrum of reward col-lection showed a pronounced peak at 1<italic>/</italic>63 cycles trial<sup><italic>⨪</italic>1</sup> and much less power at lower frequencies (<xref rid="fig2" ref-type="fig">Fig. 2A</xref>), sug-gesting that the dynamics of reward collection are dominated by the block structure of the experiment rather than session-long trends. In contrast, the power spectrum of an-ticipatory licking showed peaks at both 1<italic>/</italic>63 cycles trial<sup><italic>⨪</italic>1</sup> and 1<italic>/</italic>377 cycles trial<sup><italic>⨪</italic>1</sup> (<xref rid="fig2" ref-type="fig">Fig. 2B</xref>). This pattern is not consistent with the idea that anticipatory licking simply reflects the number of rewards collected in the recent past, since frequency analysis of an exponentially-weighted moving average of collected rewards with a learning timescale of <italic>τ</italic> = 4.5 trials reveals only a single peak corresponding to the block length (<xref rid="fig2" ref-type="fig">Fig. 2C</xref>). Finally, analysis of serotonin neuron activity reveals a single peak at 1<italic>/</italic>339 cycles trial<sup><italic>⨪</italic>1</sup> (<xref rid="fig2" ref-type="fig">Fig. 2D</xref>). This is also not consistent with a short-term his-tory of collected rewards (<xref rid="fig2" ref-type="fig">Fig. 2C</xref>), but could arise from a medium-term reward history with a timescale similar to the average block length of 45 trials (<xref rid="fig2" ref-type="fig">Fig. 2E</xref>). Overall, we find that the dynamics of reward collection are domi-nated by fluctuations on a timescale that corresponds to the block length and serotonin neuron activity is dominated by session-long trends, while anticipatory licking displays a mixture of both timescales.</p>
</sec>
<sec id="s2b">
<label>2.2</label>
<title>Serotonin neuron activity is consistent with a slowly-evolving estimate of value</title>
<p>To directly examine the connection between serotonin neuron activity and reward history, we constructed a generative model of inter-trial interval firing statistics as a function of value <italic>v</italic><sub><italic>t</italic></sub>
<disp-formula id="eqn1">
<graphic xlink:href="667134v2_eqn1.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <italic>ρ</italic><sub><italic>t</italic>,[<italic>i</italic>]</sub> is the firing rate of neuron <italic>i</italic> during inter-trial interval <italic>t</italic>; <italic>β</italic><sub>0,[<italic>i</italic>]</sub> is the firing rate intercept, which represents the baseline firing rate when value is zero; <italic>β</italic><sub>1,[<italic>i</italic>]</sub> is the firing rate gain, which controls how quickly firing increases or decreases with increasing value; and <italic>ϵ</italic><sub><italic>t</italic>,[<italic>i</italic>]</sub> is a noise term (see <xref ref-type="sec" rid="s5b3">Section 5.2.3</xref>). We operationally define value as an estimate of the reward probability in the upcoming trial <italic>v</italic><sub><italic>t</italic>,[<italic>i</italic>]</sub> ≈ Pr [<italic>R</italic><sub><italic>t</italic>+1,[<italic>i</italic>]</sub> = 1] learned according to the Rescorla–Wagner rule
<disp-formula id="eqn2">
<graphic xlink:href="667134v2_eqn2.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <italic>r</italic><sub><italic>t</italic>,[<italic>i</italic>]</sub> is the reward received in trial <italic>t, v</italic><sub><italic>t</italic>,[<italic>i</italic>]</sub> is the value during the inter-trial interval immediately following <italic>r</italic><sub><italic>t</italic>,[<italic>i</italic>]</sub>, and <italic>τ</italic><sub>[<italic>i</italic>]</sub> is the learning timescale. Importantly, value learned in this way is equivalent to an exponentially-weighted moving average of past rewards with learning timescale <italic>τ</italic> and initial condition <italic>v</italic><sub>0</sub>
<disp-formula id="eqn3">
<graphic xlink:href="667134v2_eqn3.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
as used in the previous section. Overall, our model assumes that serotonin neuron activity reflects a moving average of recent rewards, where the meaning of “recent” is governed by the learning timescale <italic>τ</italic>. Thus <xref ref-type="disp-formula" rid="eqn2">Eq. 2</xref> defines our value model and <xref ref-type="disp-formula" rid="eqn1">Eq. 1</xref> defines how it is fit to the observed firing rate (<xref rid="fig3" ref-type="fig">Fig. 3A-B</xref>).</p>
<fig id="fig3" position="float" fig-type="figure">
<label>Figure 3.</label>
<caption>
<title>Value coding features of serotonin neurons.</title>
<p><bold>A</bold> Generative model of serotonin neuron activity. Rewards are passed into an exponentially-weighted moving average with timescale τ to estimate value vt (equivalent to learning value according to the Rescorla–Wagner rule) which is then scaled (by gain factor β1) and offset (by intercept β0) to produce an estimated firing rate <inline-formula><inline-graphic xlink:href="667134v2_inline74.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. The observed firing rate ρt is a noisy reflection of <inline-formula><inline-graphic xlink:href="667134v2_inline75.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. Note that the noise is autocorrelated, causing the observed firing rate to drift. See Methods for details. <bold>B</bold> Effects of varying firing rate gain β1 and learning timescale τ on the predicted firing rate <inline-formula><inline-graphic xlink:href="667134v2_inline76.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. Simulated rewards from alternating 85% and 15% reward probability blocks are shown at left, and model outputs are shown at right. Note that for illustration purposes, here we have used more extreme reward probabilities and more regular block structure than in the actual experiment. <bold>C</bold> Example of a value coding neuron with a short estimated learning timescale. Points and error bars indicate mean and SEM firing rate in each inter-trial interval. Blue line indicates the MAP value model prediction. For clarity, one outlier trial with very high estimated firing rate and the corresponding model prediction are not shown (note small gap in blue line near 375 trials). <bold>D</bold> Estimated normalized firing rate gain and learning timescale for each neuron. Points and error bars represent the median and IQR of the posterior, respectively. Neurons for which the 95% credibility interval for the normalized firing rate gain includes zero are designated putatively non-value-coding and are indicated in gray; the fraction of neurons that neurons that fall in this category (37.8%) is indicated in the pie chart. Exemplar neurons from C and E are labeled. For reference, timescales that correspond to approximately 5 min and 1 h are highlighted based on the average trial plus ITI duration (9.3 s). <bold>E</bold> Example of a value coding neuron with a long estimated learning timescale. Data and model presented as in A. For clarity, two outlier trials with very high estimated firing rate and corresponding model predictions are not shown. <bold>F</bold> Distribution of normalized firing rate gain across neurons. Distribution from the MAP model prediction is shown in blue, and the Bayesian prior used for model fitting is shown in black. For comparison, the distribution of normalized firing rate gain across neurons in ref. 9 is shown in gray. <bold>G</bold> Fraction of N = 37 neurons with positive firing rate gain. Positive firing rate gain indicates that the neuron is activated when value is high. Full posterior distribution is shown in blue, and the Bayesian prior used for model fitting is shown in black. For comparison, the estimated fraction of neurons in the data of ref. 9 are activated when value is high is shown in gray (bootstrap distribution). <bold>H</bold> Distribution of learning timescales in the full population of serotonin neurons. To illustrate uncertainty in this estimate, 30 draws from the posterior are shown. Samples from the prior are shown in gray. <bold>I</bold> Mean learning timescale in the full population of serotonin neurons. Full posterior distribution is shown in blue, and the flat prior is shown in black. For comparison, the estimated mean from ref. 15 is shown in gray. Note close agreement with our results.</p>
</caption>
<graphic xlink:href="667134v2_fig3.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>To assess whether this value model provides a meaningful account of the activity patterns of serotonin neurons in this experiment, we compared its ability to predict firing in held-out trials against two control models: one which assumes a constant firing rate and the other which assumes a session-wide linear trend. The value model performed significantly better than the two control models in terms of the average error across all neurons in this dataset (mean squared error on the mean inter-spike interval inheld-out trials of 0.0209 s<sup>2</sup> for the value model, 0.0219 s<sup>2</sup> for the constant firing rate model, and 0.0249 s<sup>2</sup> for the trend model; SEM <italic>&lt;</italic>0.0001 s<sup>2</sup> in each case; mean fivefold cross-validated accuracy, 10 repeats, <italic>N</italic> = 37 neurons and 12 387 trials), indicating that the population-level activity patterns of serotonin neurons are best understood as a code for value, consistent with our previous work (<xref ref-type="bibr" rid="c12">12</xref>).</p>
<p>The aggregate performance statistics presented above conceal significant heterogeneity in the activity patterns of serotonin neurons. Some neurons exhibited trial-to-trial fluctuations in inter-trial firing that are clearly consistent with value (<xref rid="fig3" ref-type="fig">Fig. 3C</xref>), while other individual neurons had a seemingly constant firing rate, and still others exhibited a slow decrease in firing over the course of the recording session that visually resembles a linear trend (<xref rid="fig3" ref-type="fig">Fig. 3E</xref>). Under our value coding model, this heterogeneity is explained in terms of variability in 1) the strength of the effect of value on firing (termed normalized firing rate gain <inline-formula><inline-graphic xlink:href="667134v2_inline1.gif" mimetype="image" mime-subtype="gif"/></inline-formula>) and 2) the learning timescale <italic>τ</italic>. The heterogeneity in learn-ing timescale spanned a large range, from 5 min to almost one hour, with the majority of neurons displaying a learning timescale between 17 and 33 min (100-200 trials). The non-overlapping credibility intervals in <xref rid="fig3" ref-type="fig">Fig. 3E</xref> shows that for those neurons, the learning timescale was different.</p>
<p>Across the different cells, the distribution of maximum a posteriori estimates (MAP) of the correlation with value coding (<italic>β</italic><sub>1</sub>) shifted to higher gain from the distribution used as a prior (<xref rid="fig3" ref-type="fig">Fig. 3F</xref>). This indicates a general tendency of cells to correlate with value estimated at different timescales. More specifically, to calculate the fraction of cells that were positively correlated with value, we computed the MAP distribution for the fraction of cells having a gain <italic>β</italic><sub>0</sub> larger than zero. We found a distribution concentrated around 80% of the cells (<xref rid="fig3" ref-type="fig">Fig. 3G</xref>). These estimates are show more consistent value coding than could be extracted from a previous study using classical trace conditioning (<xref ref-type="bibr" rid="c9">9</xref>), as shown in gray in <xref rid="fig3" ref-type="fig">Fig. 3F-G</xref>.</p>
<p>Turning to the statistics of the learning timescale across cells, <xref rid="fig3" ref-type="fig">Figure 3H</xref> shows samples from the prior and the posterior for the learning timescale parameter. As illustrated in <xref rid="fig3" ref-type="fig">Fig. 3D</xref>, the posterior estimates concentrated close to a timescale corresponding to 100 trials. This is made more precise by computing the posterior distribution for the mean learning timescale of the full population of serotonin neurons. Our posterior peaked sharply at a value of 125 trials, such that the average estimation timescale across the serotonergic population matches quite closely the estimate of 130 trials of similar duration from Ref. (<xref ref-type="bibr" rid="c15">15</xref>).</p>
</sec>
</sec>
<sec id="s3">
<label>3</label>
<title>The role of thirst as a confounding factor</title>
<p>It is possible, however, that confounding factors are integrated in the inference of the timescale and associated value code potency. We thus consider a control variable that relates to elapsed time or thirst, which we refer to as ‘thirst’ for short. It is defined as an inverse tally of the number of water rewards consumed (<xref ref-type="sec" rid="s5b2">Section 5.2.2</xref>). This type of of variable can influence motivation, behaviour, and perception of reward in this task. Although the rate of reward collection, and therefore the rate of thirst reduction, fluctuates over the course of the experiment, the overall time-course of thirst generally resembles a linear trend (<xref rid="fig4" ref-type="fig">Fig. 4B</xref>). As expected, this means that if the learning timescale <italic>τ</italic> is large, value and thirst closely resemble each other (<xref rid="fig4" ref-type="fig">Fig. 4C</xref>), leading to a high degree of correlation/confounding between the two variables when <italic>τ</italic> ≥45 trials (<xref rid="fig4" ref-type="fig">Fig. 4D</xref>). Thus, trend-like activity in a subset of serotonin neurons identified by our value coding model may actually be due to the effects of thirst. The timecourse of modeled thirst and value estimated on a long timescale are so similar, we sought to estimate what proportion of the neuron encode value in a manner that cannot be account for by thirst. To this end, we developed a second Bayesian model that can assess the degree with which a given neuron correlates with value or if its activity can be equally explained by value or thirst (see Methods; Mixture definition).</p>
<fig id="fig4" position="float" fig-type="figure">
<label>Figure 4.</label>
<caption>
<title>Value is confounded with thirst when learning is slow.</title>
<p><bold>A</bold> Dynamics of value as a function of the learning timescale τ. Each line represents one experimental session. An exemplar session is highlighted in blue. <bold>B</bold> Dynamics of thirst, defined as a quantity that decreases each time the animal consumes a water reward, starting at one and decreasing to zero over the course of a session. Each line represents one experimental session. The exemplar session from A is highlighted in green. <bold>C</bold> Comparison of value and thirst for the exemplar session highlighted in A and B. Value (blue) is shown using a learning timescale of τ = 70 trials. Thirst (green) is normalized so that its mean and standard deviation match those of value. <bold>D</bold> Confounding between value and thirst as a function of the learning timescale τ. Confounding is measured using the squared coefficient of determination, representing the fraction of variance in value that can be explained by thirst (and vice-versa). Each line represents one session. The exemplar session from A and B is highlighted in blue, and the black dot corresponds to the curves shown in C.</p>
</caption>
<graphic xlink:href="667134v2_fig4.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>Fitting this mixture model to our data, we estimated that approximately half of neurons encode value (posterior mean 48.1 %, 95 % CrI 27.3–69.9 %), while a large minority encode thirst (posterior mean 41.7 %, 95 % CrI 21.0–63.1 %) and a small fraction are null coding (posterior mean 10.2 %, 95 % CrI 0.5–26.5 %; see <xref rid="figS1" ref-type="fig">Fig. S1B</xref>). The high level of uncertainty on each of these estimates is mainly due to the moderate number of neurons in this dataset rather than statistical confounding between value, thirst, and null coding (for comparison, a frequentist 95 % CI on a proportion of 50 % would be 33.7–66.3 % for <italic>N</italic> = 37 even in the absence of confounding). Null coding is less common than value and thirst coding (posterior probability 97.4 %, prior probability 33.3 %), but it is unclear whether value coding is more common than thirst coding or vice versa (posterior probability that value coding is more common 61.2 %, prior probability 50.0 %). We conclude that a large fraction of serotonin neurons encode value, but that a larger scale experiment is needed to determine whether this is the most common tuning feature.In the subset of serotonin neurons that unambiguously encode value, we estimated that rewards are typically inte-grated over several dozen trials in order to estimate value (posterior mean learning timescale 72.9 trials, 95 % CrI 45.1–132.5 trials; <xref rid="figS1" ref-type="fig">Fig. S1C</xref>). We still observed a very high level of variability in this feature across neurons, with the timescale over which serotonin neuron activity integrates rewards spanning roughly an order of magnitude (posterior mean standard deviation of the learning timescale 0.289 log10 units, 95 % CrI 0.136–0.558; <xref rid="figS1" ref-type="fig">Fig. S1D</xref>). Specifically, we estimate that the fastest 10 % of value coding serotonin neurons integrate rewards over fewer than 31.1 trials (posterior mean, 95 % CrI 14.2–52.3 trials; <xref rid="figS1" ref-type="fig">Fig. S1E</xref>) while the slowest 10 % integrate rewards over more than 170.8 trials (posterior mean, 95 % CrI 85.0–574.2 trials; <xref rid="figS1" ref-type="fig">Fig. S1F</xref>), with 80 % of neurons falling in the middle. Consistent with our model-free analysis (<xref rid="fig2" ref-type="fig">Fig. 2D</xref> and <xref ref-type="fig" rid="fig2">E</xref>), we estimate that 76.2 % (posterior mean, 95 % CrI 50.1–94.7 %) of value coding neurons integrate rewards over a period longer than the average block length in this experiment (45 trials). In sum, as one would expect by the act of removing those cells which are associated with a slow value estimation, the presence of thirst as a confounding factor reduces the proportion of neurons that unambiguously code for value and their estimation timescale is shorter.</p>
<sec id="s3a">
<label>3.1</label>
<title>Anticipatory licking depends on thirst and short-term reward history</title>
<p>We next sought to identify possible behavioural correlates of serotonin neuron activity. To determine whether longterm reward history or thirst influence the rate of anticipatory licking, we fitted a model in which licking is driven by a latent variable that reflects a mixture of value estimated over three different timescales, a fast timescale (1 trial), a medium timescale (10 trials) and a slow timescale of which matches the distribution of timescales observed in serotonin neurons (<xref rid="figS1" ref-type="fig">Fig. S1</xref>), and thirst (illustrated in <xref rid="fig5" ref-type="fig">Fig. 5A</xref>). Importantly, neither the fast nor the medium timescale match that observed in serotonergic cells (shortest timescale in <xref rid="fig3" ref-type="fig">Fig. 3D</xref> is 30 trials). Since this experiment contains both normal rewarded trials and a small number of cued unrewarded catch trials, we further modeled the lick rate as being dependent on the animal’s perception of trial type (see Methods for details). Animals correctly perceived the trial type 93.6 % of the time (posterior mean, 95 % CrI 88.3–96.8 %, population parameter estimated using a hierarchi-cal model fitted to 9693 trials across 28 sessions), licking in response to the cue for rewarded trials but not in response to the cue for catch trials. The fact that animals correctly perceived catch trials and adjusted the rate of anticipatory licking accordingly confirms that this behaviour is at least partially related to value.</p>
<fig id="fig5" position="float" fig-type="figure">
<label>Figure 5.</label>
<caption>
<title>Analysis of anticipatory licking.</title>
<p><bold>A</bold> Overview of behavioural model. Value computed based on a short reward history (fast value, τ = 1 trial), medium reward history (medium value, τ = 10 trials), long reward history (slow value, τ chosen to match distribution found in serotonin neurons, mean of approximately 72 trials), and thirst are combined to form a latent that drives anticipatory licking if the animal believes it is in a r egular, rewarded trial rather than a catch trial. See Methods for details. <bold>B</bold> Data, MAP model prediction, and corresponding latent components for an exemplar session. For clarity, perceived catch trials are not shown (note gaps in blue line). <bold>C</bold> Mean weight assigned to 5-HT-related (slow value and thirst) vs. non-5-HT-related (fast and medium value) latent components across N = 28 sessions. <bold>D</bold> Mean weight assigned to medium value vs. fast value across N = 28 sessions. <bold>E</bold> Mean weight assigned to slow value vs. thirst across N = 28 sessions.</p>
</caption>
<graphic xlink:href="667134v2_fig5.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>The fitted behavioural model successfully extracted the main features of anticipatory licking visible in the raw data (<xref rid="fig5" ref-type="fig">Fig. 5B</xref>). In particular, fitted model predictions exhibited large modulations that reflect the block structure of the experiment, session-wide decreasing trends that may reflect satiety/thirst, and trial-to-trial fluctuations that reflect very short-term reward history. The first two of these features are consistent with our model-free analysis that pointed to anticipatory licking evolving over two timescales, one that reflects block structure and another that reflects a long-term trend (<xref rid="fig2" ref-type="fig">Fig. 2</xref>). Overall, our model explained the ma-jority of the observed variation in the rate of anticipatory licking (67.2 ± 14.3 % variance explained by MAP parameter estimates, mean ± SD, <italic>N</italic> = 28 sessions), further confirming that this behaviour depends on some mixture of value and thirst, while leaving open the possibility that other factors may play an important role.</p>
<p>Using the parameters estimated by our behavioural model, we next sought to determine the relative contributions of the value and thirst factors to anticipatory licking. We found that factors consistent with serotonin neuron activity, namely slow value and thirst, were collectively given a weight of 40.8 % (95 % CrI 34.0–47.7 %) even though these factors both evolve over timescales considerably longer than the block length in this experiment. Within the nonserotonergic factors (collectively weighted at 59.2 %, 95 % CrI 52.3–66.0 %; see <xref rid="fig5" ref-type="fig">Fig. 5C</xref>), fast value was given slightly more than half of the weight (60.4 %, 95 % CrI 51.1–69.4 %; see <xref rid="fig5" ref-type="fig">Fig. 5D</xref>), indicating that anticipatory licking depends meaningfully on value estimated over short and medium timescales. Within the serotonergic factors, the overwhelming majority of the weight was given to thirst (93.6 %, 95 % CrI 87.2–97.7 %; see <xref rid="fig5" ref-type="fig">Fig. 5E</xref>), indicating that value esti-mated over a timescale significantly longer than the aver-age block length correlates less with anticipatory licking than our simple model of thirst. Taken together, anticipatory licking is explained partially by value integration occurring at a faster time scale than seen in serotonergic cells and partially by value integration happening at a timescale that matches the serotonergic cells, but the part of the behaviour matching the timescale seen in sertonergic cells is better explained by a model of thirst than a model of value.</p>
</sec>
</sec>
<sec id="s4">
<label>4</label>
<title>Discussion</title>
<p>We have reported a Bayesian model fitting approach for how individual serotonin neurons encode the evolving state value over time. Our model accounts for additional factors such as thirst or elapsed time and reveals that neurons vary in how strongly their firing reflects state value and in the timescales over which they update this value, with an average learning timescale of between 10 and 20 minutes. By also analyzing simultaneous behavioral data, specifically anticipatory licking, we find that behaviour is in most part linked to value signals learned on faster timescales than those encoded by serotonin neurons, while the part that is consistent in the serotonergic estimation timescale can be entirely explained by thirst as a confounding factor. These results offer a detailed quantification of how individual serotonin neurons represent value and its learning dynamics, uncovering a mismatch between the value estimation timescales in serotonergic cells and those influencing behaviour.</p>
<sec id="s4a">
<title>Relationship between neural activity and behaviour</title>
<p>There is a significant amount of variation in both neural activity and behaviour that is not explained by the models considered here. We have not attempted to determine whether the unexplained variation is correlated between neural activity and behaviour in the corresponding sessions, leaving open the possibility that some signal other than thirst or value may be responsible for driving both neural activity and behaviour. In principle, we could figure this out by looking for correlations in the residuals of the neural activity and behavioural models, but we determined that this was not feasible due to technical challenges. In particular, the fact that the residuals in the neural model depend on the coding scheme used by each neuron, which is treated as uncertain in our approach, and the fact that the experiment contains catch trials which give the behavioral residuals a structure that is very difficult to model.</p>
</sec>
<sec id="s4b">
<title>Value of the trace period period</title>
<p>We have compared trial-to-trial dynamics of anticipatory licking, which mostly takes place in the trace period, with the trial-to-trial fluctuations of serotonergic neuron activity, which were recorded during the inter-trial period. This approach is supported by the prospective value theory, where the value in the inter-trial period scales with the value in the trace period. This is statements, however, arises from the dynamics of value after learning. The dynamics of value during learning depends heavily on the type of learning algorithm that is being used. For example, the use eligibility traces in the learning algorithm will alter the speed of value learning. Importantly, some learning algorithms can, in principle, make the learning timescale of periods far from the reward different from that close to the reward. Experimental observations of Ref. (<xref ref-type="bibr" rid="c12">12</xref>) do not support this possibility as, on a 5 trial horizon, the speed at which the trace period activity of serotonin neurons changed matched the speed measured in the inter-trial period.</p>
</sec>
<sec id="s4c">
<title>Estimation timescale of dopaminergic activity</title>
<p>Matias et al. (<xref ref-type="bibr" rid="c15">15</xref>) found that the reward associations reflected in bulk serotonergic activity changed over the course of approximately 130 trials. This was an order of magnitude slower that the reward associations reflected in bulk dopaminergic activity, which changed over the course of approximately 20 trials (see also Ref. (<xref ref-type="bibr" rid="c10">10</xref>)). Given that their trials were about the same duration as the trials in the experiment analyzed here (9-14 s in Ref. (<xref ref-type="bibr" rid="c15">15</xref>) vs. an average of 9 s in Ref. (<xref ref-type="bibr" rid="c16">16</xref>)), we can expect that dopaminergic activity would change over the time course of 20 trials in the mice recorded here. It is interesting to note that this learning timescale, by beeing close to the medium timescale used in <xref rid="fig5" ref-type="fig">Fig. 5</xref>, showed some correlation with anticipatory (<xref rid="fig5" ref-type="fig">Fig. 5D</xref>), suggesting that the value estimation timescale reflected in dopaminergic cells is more closely associated with behaviour than the value estimation timescale seen in serotonergic cells (<xref ref-type="bibr" rid="c15">15</xref>).</p>
</sec>
<sec id="s4d">
<title>Capturing activity fluctuations in vivo</title>
<p>Mathematical models have been developed for predicting activity fluctuations of single neurons in vitro (<xref ref-type="bibr" rid="c18">18</xref>–<xref ref-type="bibr" rid="c24">24</xref>) and in vivo (<xref ref-type="bibr" rid="c25">25</xref>–<xref ref-type="bibr" rid="c28">28</xref>). While it is difficult to compare model performance across different recording modalities and different metrics (<xref ref-type="bibr" rid="c29">29</xref>), we note that models of cortical neurons tend to achieve high prediction accuracy in slice (<xref ref-type="bibr" rid="c20">20</xref>, <xref ref-type="bibr" rid="c21">21</xref>, <xref ref-type="bibr" rid="c30">30</xref>, <xref ref-type="bibr" rid="c31">31</xref>) but very low prediction accuracy in vivo (<xref ref-type="bibr" rid="c25">25</xref>). This discrepancy may be attributed to many missing latent factors (<xref ref-type="bibr" rid="c27">27</xref>, <xref ref-type="bibr" rid="c32">32</xref>), population multiplexing of information (<xref ref-type="bibr" rid="c33">33</xref>–<xref ref-type="bibr" rid="c35">35</xref>) as well as the difficulty of capturing the relationship with cortical cell’s inputs (<xref ref-type="bibr" rid="c36">36</xref>–<xref ref-type="bibr" rid="c42">42</xref>). Serotonergic neurons on the other hand are not particularly well captured by integrate-and-fire models in vitro (<xref ref-type="bibr" rid="c24">24</xref>). In this context, the variance explained achieved by our model for predicting activity fluctuations in vivo is surprisingly good. In contrast to the cortex, serotonergic neurons of the dorsal raphe are not numerous and may the population may not be able to support population multiplexing (<xref ref-type="bibr" rid="c33">33</xref>). These neurons are also much less bursty and cortical neurons (<xref ref-type="bibr" rid="c43">43</xref>), indicating that they may also not be able to support burst multiplexing (<xref ref-type="bibr" rid="c35">35</xref>).</p>
</sec>
</sec>
<sec id="s5">
<label>5</label>
<title>Methods</title>
<sec id="s5a">
<label>5.1</label>
<title><italic>In vivo</italic> experiment</title>
<p>The Pavlovian conditioning experiment with dynamic reward probabilities has been reported previously by Grossman et al. (<xref ref-type="bibr" rid="c16">16</xref>). A brief summary follows.</p>
<p>Odour-cued water rewards were delivered to five waterrestricted C57/BL6 mice (four male, one female) over the course of 28 recording sessions, each of which lasted ~ 1 h.Rewards were delivered stochastically with a probability of 0.2, 0.5, or 0.8 which changed dynamically according to a block structure. Blocks lasted 20–70 trials (uniform distribu-tion), and the first block of each session always had a reward probability of 0.8. Catch trials consisting of a different odour cue followed by no reward were randomly interleaved with regular trials throughout the experiment at an average rate of 1<italic>/</italic>20 trials. Catch trials and trials in which a reward was available but not collected were deemed unrewarded for the purposes of our analysis. Mice collected 0.45 ± 0.04 rewards per trial and completed 356 ± 88 trials per session (mean ± SD across sessions). Inter-trial intervals followed an exponential distribution with mean <inline-formula><inline-graphic xlink:href="667134v2_inline2.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. Spike times of optogenetically-tagged serotonin transporter-expressing neurons were collected using tetrode recordings at a rate of 1–3 neurons per session (mean 1.32 neurons).</p>
<p>Experimental and surgical procedures were performed in compliance with the <italic>National Institutes of Health Guide for the Care and Use of Laboratory Animals</italic> and were approved by the Animal Care and Use Committee at Johns Hopkins University.</p>
</sec>
<sec id="s5b">
<label>5.2</label>
<title>Models</title>
<sec id="s5b1">
<label>5.2.1</label>
<title>Value</title>
<p>We define value as the expected reward in the upcoming trial, estimated using the Rescorla–Wagner learning rule
<disp-formula id="eqn4">
<graphic xlink:href="667134v2_eqn4.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <italic>v</italic><sub><italic>t</italic></sub> is the value during the inter-trial interval immediately following the reward <italic>r</italic><sub><italic>t</italic></sub> on trial <italic>t</italic>, and <italic>τ</italic> is the learning timescale.</p>
<p>The model is written in terms of the learning timescale <italic>τ</italic> instead of the more conventional learning rate <italic>α</italic> because the learning timescale can be interpreted as the number of trials over which past rewards are integrated in order to estimate the expected reward in the upcoming trial. However, it is important to note that the two are equivalent: τ = −1/ ln(1 − α)</p>
</sec>
<sec id="s5b2">
<label>5.2.2</label>
<title>Thirst</title>
<p>We define thirst as a quantity <italic>h</italic><sub><italic>t</italic></sub> that decreases by a fixed amount each time the animal consumes a water reward.</p>
<p>We arbitrarily set <italic>h</italic><sub>0</sub> = 1 and <italic>h</italic><sub><italic>T</italic></sub> = 0, where <italic>T</italic> is the number of trials, such that
<disp-formula id="eqn5">
<graphic xlink:href="667134v2_eqn5.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <italic>r</italic><sub><italic>x</italic></sub> ∈{0, 1} is the binary water reward received on trial <italic>x</italic>. Reward collection had the tendency to follow the time of since the start of the experiment, but showed individual differences across mice <xref rid="figS3" ref-type="fig">Fig. S3</xref>.</p>
</sec>
<sec id="s5b3">
<label>5.2.3</label>
<title>Latent variable model of neural activity</title>
<p>We model neural activity <inline-formula><inline-graphic xlink:href="667134v2_inline3.gif" mimetype="image" mime-subtype="gif"/></inline-formula> in terms of a latent firing rate <italic>ρ</italic><sub><italic>t</italic></sub> driven by a latent input <italic>x</italic><sub><italic>t</italic></sub>. We assume a linear effect of the input on the firing rate
<disp-formula id="eqn6">
<graphic xlink:href="667134v2_eqn6.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <italic>β</italic><sub>0</sub> is the baseline firing rate when the input is zero and <italic>β</italic><sub>1</sub> is the gain. In turn, we model the mean inter-spike interval <inline-formula><inline-graphic xlink:href="667134v2_inline4.gif" mimetype="image" mime-subtype="gif"/></inline-formula>, where <italic>ι</italic><sub><italic>t</italic>,1</sub>, <italic>ι</italic><sub><italic>t</italic>,2</sub>, …, <italic>ι</italic><sub><italic>t,M</italic></sub> are individual inter-spike intervals in trial <italic>t</italic>, in terms of the inverse firing rate, or frequency 1<italic>/ρ</italic><sub><italic>t</italic></sub>
<disp-formula id="eqn7">
<graphic xlink:href="667134v2_eqn7.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <italic>ϵ</italic><sub><italic>t</italic></sub> is the residual at time <italic>t</italic> due to a combination of spiking noise, measurement noise, and drift. This quantity could only be estimated when there were at least two spikes in the data (<xref rid="figS4" ref-type="fig">Fig. S4</xref>). We found that this method was more stable in such sparse firing than using spike trains and their associated likelihood functions (as in Refs. (<xref ref-type="bibr" rid="c20">20</xref>, <xref ref-type="bibr" rid="c21">21</xref>, <xref ref-type="bibr" rid="c24">24</xref>, <xref ref-type="bibr" rid="c44">44</xref>)).</p>
</sec>
<sec id="s5b4">
<title>Residual models</title>
<p>To simplify comparisons with null models based on constant firing rates or linear time trends (see <xref ref-type="sec" rid="s2b">Section 2.2</xref>), for the purposes of cross-validation we model the residuals <italic>ϵ</italic><sub><italic>t</italic></sub> as Gaussian white noise with time-varying variance
<disp-formula id="eqn8">
<graphic xlink:href="667134v2_eqn8.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <italic>σ</italic><sub><italic>ι</italic></sub> is the standard deviation of a single inter-spike interval and <italic>M</italic><sub><italic>t</italic></sub> is the number of inter-spike intervals in trial <italic>t</italic> (such that <inline-formula><inline-graphic xlink:href="667134v2_inline5.gif" mimetype="image" mime-subtype="gif"/></inline-formula>).</p>
<p>During inference, we model the residuals according to a third-order autoregressive process in order to properly account for drift (<xref rid="figS5" ref-type="fig">Fig. S5</xref>). The process is defined as
<disp-formula id="eqn9">
<graphic xlink:href="667134v2_eqn9.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="667134v2_inline6.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is Gaussian white noise driving the residuals and <italic>ϕ</italic><sub><italic>j</italic></sub> are weights constrained to [1, 1].</p>
<p>In both cases, we use Gaussian noise as the basis of our residual model. We have chosen Gaussian noise for two reasons: 1) inter-spike intervals recorded <italic>in vitro</italic> in identified serotonin neurons are approximately Gaussian (data not shown), and 2) the Lyapunov central limit theorem guarantees that the <italic>mean</italic> inter-spike interval <inline-formula><inline-graphic xlink:href="667134v2_inline7.gif" mimetype="image" mime-subtype="gif"/></inline-formula> that is the focus of our analysis converges to a Gaussian distribution (with variance proportional to 1<italic>/M</italic><sub><italic>t</italic></sub>) under mild conditions.</p>
</sec>
</sec>
<sec id="s5c">
<label>5.3</label>
<title>Data analysis</title>
<sec id="s5c1">
<label>5.3.1</label>
<title>Quantification of anticipatory licking</title>
<p>We measure anticipatory licking as the number of licks during the 2 s period between cue and reward onset.</p>
</sec>
<sec id="s5c2">
<label>5.3.2</label>
<title>Quantification of neural activity</title>
<p>Neural activity is measured as the mean inter-spike interval <inline-formula><inline-graphic xlink:href="667134v2_inline8.gif" mimetype="image" mime-subtype="gif"/></inline-formula> during each inter-trial interval. For inter-trial intervals with fewer than two spikes, the mean inter-spike interval is considered missing data.</p>
</sec>
<sec id="s5c3">
<label>5.3.3</label>
<title>Estimation of power spectra</title>
<p>To estimate the power spectra of reward collection, anticipatory licking behaviour, and serotonin neuron firing activity, we consider each of these as stochastic processes and extract the power spectra as the smoothed Fourier cosine transforms of the corresponding mean sample autocorrelation functions (<xref ref-type="bibr" rid="c45">45</xref>), ignoring missing data.</p>
<p>For example, taking <italic>x</italic><sub>1,[<italic>i</italic>]</sub>, <italic>x</italic><sub>2,[<italic>i</italic>]</sub>, …, <italic>x</italic><sub><italic>T</italic></sub>[<italic>i</italic>]<sub>,[<italic>i</italic>]</sub> to be the number of anticipatory licks on trials 1 to <italic>T</italic><sub>[<italic>i</italic>]</sub> for mouse <italic>i</italic>, we compute the autocorrelation at lag <italic>k</italic> up to 400 as
<disp-formula id="eqn10">
<graphic xlink:href="667134v2_eqn10.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="667134v2_inline9.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is the sample variance of <inline-formula><inline-graphic xlink:href="667134v2_inline10.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is the sample mean, and <inline-formula><inline-graphic xlink:href="667134v2_inline11.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is the number of (<italic>x</italic><sub><italic>j</italic>,[<italic>i</italic>]</sub>, <italic>x</italic><sub><italic>j</italic>+<italic>k</italic>,[<italic>i</italic>]</sub>) pairs for which neither <italic>x</italic><sub><italic>j</italic>,[<italic>i</italic>]</sub> nor <italic>x</italic><sub><italic>j</italic>+<italic>k</italic>,[<italic>i</italic>]</sub> are missing values. Note that we take the term inside the sum to be zero if either <italic>x</italic><sub><italic>j</italic>,[<italic>i</italic>]</sub> or <italic>x</italic><sub><italic>j</italic>+<italic>k</italic>,[<italic>i</italic>]</sub> is missing, and we consider <italic>c</italic><sub><italic>k</italic>,[<italic>i</italic>]</sub> itself to be missing if <inline-formula><inline-graphic xlink:href="667134v2_inline12.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. In the case of anticipatory licking, we treat the number of licks during catch trials as missing data. For firing activity, we treat the mean inter-spike interval during inter-trial intervals with fewer than two spikes as missing data. Reward data is never missing.</p>
<p>Given the sample autocorrelations of anticipatory licking <italic>c</italic><sub><italic>k</italic>,[1]</sub>, <italic>c</italic><sub><italic>k</italic>,[2]</sub>, …, <italic>c</italic><sub><italic>k</italic>,[<italic>N</italic>]</sub> for <italic>N</italic> = 28 recording sessions, we estimate the underlying autocorrelation function of the licking process as the mean of the sample autocorrelations
<disp-formula id="eqn11">
<graphic xlink:href="667134v2_eqn11.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="667134v2_inline13.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is the number of <italic>c</italic><sub><italic>k</italic>,[<italic>i</italic>]</sub> that are not missing, and where the term inside the sum is taken to be zero if <italic>c</italic><sub><italic>k</italic>,[<italic>i</italic>]</sub> is missing, as above. For firing activity, <italic>N</italic> = 37 neurons rather than 28 sessions.</p>
<p>Finally, the power spectrum is estimated from the autocorrelation function <inline-formula><inline-graphic xlink:href="667134v2_inline14.gif" mimetype="image" mime-subtype="gif"/></inline-formula> using the smoothed Fourier cosine transform
<disp-formula id="eqn12">
<graphic xlink:href="667134v2_eqn12.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="667134v2_inline15.gif" mimetype="image" mime-subtype="gif"/></inline-formula> denotes the estimated power at frequency <italic>f</italic> rather than a probability (following the notation of ref. 45), <italic>K</italic> = 399 is the maximum lag, and the <italic>λ</italic><sub><italic>k</italic></sub> are smoothing coefficients. The smoothing coefficients are set according to <italic>λ</italic><sub><italic>k</italic></sub> = exp[(<italic>k</italic><sup>4</sup><italic>/</italic>(<italic>K/</italic>2.5)<sup>4</sup>)], which is close to one for lags less than 100 and close to zero for lags greater than 200.</p>
</sec>
<sec id="s5c4">
<label>5.3.4</label>
<title>Hierarchical Bayesian model of value coding Notation</title>
<p>This section describes a model of data from multiple neurons. Sub-scripts in square brackets <sub>[·]</sub> are used to indicate quantities specific to a particular neuron. For example, <italic>τ</italic><sub>[<italic>i</italic>]</sub> is the learning timescale for neuron <italic>i</italic>.</p>
<sec id="s5c4a">
<title>Posterior definition</title>
<p>The log posterior density <italic>𝓁</italic><sub><italic>p</italic></sub> of our model of serotonin neuron activity is defined as
<disp-formula id="eqn13">
<graphic xlink:href="667134v2_eqn13.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <italic>C</italic> is a constant term that represents the log probability density of the data (the denominator in Bayes’ rule), <italic>p</italic>(<italic>θ</italic>) is the prior, <italic>N</italic> = 37 neurons, <italic>T</italic><sub>[<italic>i</italic>]</sub> is the number of trials for neuron <italic>i</italic>, and <inline-formula><inline-graphic xlink:href="667134v2_inline16.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is the likelihood of the mean interspike interval for neuron <italic>i</italic> on trial <italic>t</italic> given the parameters <italic>θ</italic>. Whenever <inline-formula><inline-graphic xlink:href="667134v2_inline17.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is missing, we take the corresponding likelihood to be one.</p>
</sec>
<sec id="s5c4b">
<title>Parameterization and priors</title>
<p>The choice of model parameterization has a dramatic effect on whether/how quickly the Hamiltonian Monte-Carlo algorithm used for Bayesian inference will converge (<xref ref-type="bibr" rid="c46">46</xref>), but does not affect the inferences that can be drawn about quantities of interest at convergence. For technical reasons, we have parameterized the model in terms of the following quantities:</p>
<list list-type="bullet">
<list-item><p>The learning timescale on a log10 scale log <italic>τ</italic><sub>[<italic>i</italic>]</sub>.</p></list-item>
<list-item><p>Normalized initial value for each neuron <inline-formula><inline-graphic xlink:href="667134v2_inline18.gif" mimetype="image" mime-subtype="gif"/></inline-formula>.</p></list-item>
<list-item><p>Firing rate intercept population log shape and scale parameters ln <italic>a</italic>, ln 1<italic>/b</italic>.</p></list-item>
<list-item><p>Firing rate intercept for each neuron <italic>β</italic><sub>0,[<italic>i</italic>]</sub>.</p></list-item>
<list-item><p>Normalized firing rate slope for each neuron <inline-formula><inline-graphic xlink:href="667134v2_inline19.gif" mimetype="image" mime-subtype="gif"/></inline-formula>.</p></list-item>
<list-item><p>Estimated ISI standard deviation for each neuron <italic>σ</italic><sub><italic>ι</italic>,[<italic>i</italic>]</sub>.</p></list-item>
<list-item><p>Drifting noise process coefficients for each neuron <italic>ϕ</italic><sub>1,[<italic>i</italic>]</sub>, <italic>ϕ</italic><sub>2,[<italic>i</italic>]</sub>, <italic>ϕ</italic><sub>3,[<italic>i</italic>]</sub> (only for inference).</p></list-item>
</list>
<p>Priors for all parameters are listed in <xref rid="tbl1" ref-type="table">Table 1</xref>.</p>
<table-wrap id="tbl1" orientation="portrait" position="float">
<label>Table 1.</label>
<caption><title>Summary of quantities of interest in the hierarchical Bayesian mixture model of serotonin neuron activity.</title></caption>
<graphic xlink:href="667134v2_tbl1.tif" mimetype="image" mime-subtype="tiff"/>
</table-wrap>
</sec>
<sec id="s5c4c">
<title>Likelihood</title>
<p>The likelihood <inline-formula><inline-graphic xlink:href="667134v2_inline20.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is derived by substituting the value <italic>v</italic><sub><italic>t</italic></sub> from Eq. (<xref ref-type="bibr" rid="c4">4</xref>) into the inter-spike interval model given by Eq. (<xref ref-type="bibr" rid="c7">7</xref>) evaluating the probability density of the residuals <italic>ϵ</italic><sub><italic>t</italic></sub> under the appropriate noise model. For cross-validation, we use the Gaussian white noise given in Eq. (<xref ref-type="bibr" rid="c8">8</xref>). For Bayesian inference, we use the drifting noise process given in Eq. (<xref ref-type="bibr" rid="c9">9</xref>).</p>
</sec>
</sec>
<sec id="s5c5">
<label>5.3.5</label>
<title>Hierarchical Bayesian mixture model of neural activity</title>
<sec id="s5c5a">
<title>Notation</title>
<p>This section describes a model of data from multiple neurons in terms of multiple possible coding schemes. In addition to sub-scripts in square brackets used to indicate quantities specific to a particular neuron, superscripts in round brackets <sup>(·)</sup> are used to indicate quantities or functions specific to a particular coding scheme. For ex-ample, <italic>p</italic><sup>(val)</sup> (<italic>x</italic><sub>[2]</sub>) denotes the probability density of <italic>x</italic> from neuron 2 under the value coding scheme.</p>
</sec>
<sec id="s5c5b">
<title>Mixture definition</title>
<p>To measure the value and thirst cod-ing features of serotonin neurons, we fitted a mixture model in which the time-dependent activity of each neuron <inline-formula><inline-graphic xlink:href="667134v2_inline21.gif" mimetype="image" mime-subtype="gif"/></inline-formula> reflects either value <italic>v</italic><sub><italic>t</italic>,[<italic>i</italic>]</sub>, thirst <italic>h</italic><sub><italic>t</italic>,[<italic>i</italic>]</sub>, or nothing (i.e., the underlying firing rate is constant), with corresponding likeli-hoods <inline-formula><inline-graphic xlink:href="667134v2_inline22.gif" mimetype="image" mime-subtype="gif"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="667134v2_inline23.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. Given the prior <italic>p</italic>(<italic>θ</italic>), the overall log posterior density of the mixture model is therefore given by
<disp-formula id="eqn14">
<graphic xlink:href="667134v2_eqn14.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <italic>C</italic> is a constant that represents the log probability density of the data (the denominator in Bayes’ rule), <italic>N</italic> = 37 neurons, <italic>T</italic><sub>[<italic>i</italic>]</sub> is the number of trials for neuron <italic>i</italic>, and the <italic>λ</italic> are mixing coefficients on the unit simplex Σ<sub><italic>z</italic></sub> <italic>λ</italic><sup>(<italic>z</italic>)</sup> = 1. When <inline-formula><inline-graphic xlink:href="667134v2_inline24.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is missing, we take the corresponding likelihoods to be 1. Details on the prior and likelihoods are given below.</p>
</sec>
<sec id="s5c5c">
<title>Parameterization</title>
<p>The mixture model is parameterized in terms of the following quantities:</p>
<list list-type="bullet">
<list-item><p>Mixing coefficients <italic>λ</italic><sup>(val)</sup>, <italic>λ</italic><sup>(thr)</sup>, <italic>λ</italic><sup>(null)</sup>.</p></list-item>
<list-item><p>Learning timescale population parameters <italic>µ</italic><sub>log <italic>τ</italic></sub>, <italic>σ</italic><sub>log <italic>τ</italic></sub>.</p></list-item>
<list-item><p>Standardized learning timescale for each neuron <inline-formula><inline-graphic xlink:href="667134v2_inline25.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. This parameterization is cho-sen to avoid a Neal’s funnel effect when <italic>σ</italic><sub>log <italic>τ</italic></sub> is small (<xref ref-type="bibr" rid="c46">46</xref>).</p></list-item>
<list-item><p>Normalized initial value for each cell <inline-formula><inline-graphic xlink:href="667134v2_inline26.gif" mimetype="image" mime-subtype="gif"/></inline-formula>.</p></list-item>
<list-item><p>Firing rate intercept population shape and scale parameters ln <italic>a</italic>, ln 1<italic>/b</italic>.</p></list-item>
<list-item><p>Estimated mean firing rate for each neuron <italic>B</italic><sub>[<italic>i</italic>]</sub>.</p></list-item>
<list-item><p>Normalized firing rate slopes for each neuron under the value and thirst models <inline-formula><inline-graphic xlink:href="667134v2_inline27.gif" mimetype="image" mime-subtype="gif"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="667134v2_inline28.gif" mimetype="image" mime-subtype="gif"/></inline-formula></p></list-item>
<list-item><p>Estimated ISI standard deviation for each neuron <italic>σ</italic><sub><italic>ι</italic>,[<italic>i</italic>]</sub>.</p></list-item>
<list-item><p>Drifting noise process coefficients for each neuron <italic>ϕ</italic><sub>1,[<italic>i</italic>]</sub>, <italic>ϕ</italic><sub>2,[<italic>i</italic>]</sub>, <italic>ϕ</italic><sub>3,[<italic>i</italic>]</sub> (only for inference).</p></list-item>
</list>
</sec>
<sec id="s5c5d">
<title>Firing rate intercepts</title>
<p>The firing rate intercepts <inline-formula><inline-graphic xlink:href="667134v2_inline29.gif" mimetype="image" mime-subtype="gif"/></inline-formula> are an important source of prior information in our model (see <xref rid="tbl1" ref-type="table">Table 1</xref>) even though they do not appear directly in its parameterization (see above). Under the value model, the firing rate intercept is derived from the estimated mean firing rate <italic>B</italic><sub>[<italic>i</italic>]</sub> and normalized firing rate slope <inline-formula><inline-graphic xlink:href="667134v2_inline30.gif" mimetype="image" mime-subtype="gif"/></inline-formula> according to
<disp-formula id="eqn15">
<graphic xlink:href="667134v2_eqn15.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <italic>v</italic><sub><italic>t</italic>,[<italic>i</italic>]</sub> is the mean value across trials with at least one ISI for neuron <italic>i</italic>. Note that the absolute derivative of this transformation is
<disp-formula id="eqn16">
<graphic xlink:href="667134v2_eqn16.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Under the thirst and null models, the firing rate intercept is equal to the baseline firing rate
<disp-formula id="eqn17">
<graphic xlink:href="667134v2_eqn17.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
To incorporate prior information about the firing rate intercepts <inline-formula><inline-graphic xlink:href="667134v2_inline31.gif" mimetype="image" mime-subtype="gif"/></inline-formula> into our model, we need to de-compose the overall prior <italic>p</italic>(<italic>θ</italic>) into a set of terms that de-pend on the <italic>β</italic><sub>0</sub>. First, we factorize <italic>p</italic>(<italic>θ</italic>) to obtain the prior probability of the mean firing rates <italic>B</italic><sub>[<italic>i</italic>]</sub> conditional on the remaining parameters <italic>θ</italic><sup>c</sup>
<disp-formula id="eqn18">
<graphic xlink:href="667134v2_eqn18.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Next, we marginalize the conditional probability of the mean firing rate over the coding schemes
<disp-formula id="ueqn1">
<graphic xlink:href="667134v2_ueqn1.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where we have assigned each of the three coding schemes an equal prior probability of 1<italic>/</italic>3. Using Eqs. (<xref ref-type="bibr" rid="c15">15</xref>) to (<xref ref-type="bibr" rid="c17">17</xref>), the above can be rewritten in terms of the <italic>β</italic><sub>0</sub> under each model
<disp-formula id="eqn19">
<graphic xlink:href="667134v2_eqn19.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where the first term includes an adjustment of <inline-formula><inline-graphic xlink:href="667134v2_inline32.gif" mimetype="image" mime-subtype="gif"/></inline-formula> to account for the change of variables from <italic>B</italic><sub>[<italic>i</italic>]</sub> to <inline-formula><inline-graphic xlink:href="667134v2_inline33.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. The second and third terms do not need an adjustment for the change of variables, nor do the slopes depend on other parameters <italic>θ</italic><sup>c</sup>.</p>
</sec>
<sec id="s5c5e">
<title>Priors Using Eqs. (<xref ref-type="bibr" rid="c18">18</xref>) and (<xref ref-type="bibr" rid="c19">19</xref>), the overall prior for the mixture model can be written as</title>
<p>
<disp-formula id="ueqn2">
<graphic xlink:href="667134v2_ueqn2.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where all of the parameters are conditionally independent except for <italic>λ</italic><sup>(val)</sup>, <italic>λ</italic><sup>(thr)</sup>, <italic>λ</italic><sup>(null)</sup> due to the simplex constraint. The exact form of the prior on each parameter is listed in <xref rid="tbl1" ref-type="table">Table 1</xref>.</p>
</sec>
<sec id="s5c5f">
<title>Value likelihood</title>
<p>The likelihood under the value model <inline-formula><inline-graphic xlink:href="667134v2_inline34.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is derived by substituting <italic>v</italic><sub><italic>t</italic>,[<italic>i</italic>]</sub> from Eq. (<xref ref-type="bibr" rid="c4">4</xref>) (using <italic>v</italic><sub>0,[<italic>i</italic>]</sub> for the initial condition) in for <italic>x</italic><sub><italic>t</italic></sub> in Eq. (<xref ref-type="bibr" rid="c6">6</xref>), yielding
<disp-formula id="ueqn3">
<graphic xlink:href="667134v2_ueqn3.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
The firing rate <inline-formula><inline-graphic xlink:href="667134v2_inline35.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is then substituted into the inter-spike interval model given in Eq. (<xref ref-type="bibr" rid="c7">7</xref>), yielding
<disp-formula id="ueqn4">
<graphic xlink:href="667134v2_ueqn4.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
which defines the Gaussian likelihood of <inline-formula><inline-graphic xlink:href="667134v2_inline36.gif" mimetype="image" mime-subtype="gif"/></inline-formula>.</p>
</sec>
<sec id="s5c5g">
<title>Thirst likelihood</title>
<p>The likelihood under the thirst model <inline-formula><inline-graphic xlink:href="667134v2_inline37.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is derived analogously to the value likelihood described above, using <italic>x</italic><sub><italic>t</italic></sub> = (<italic>h</italic><sub><italic>t</italic>,[<italic>i</italic>]</sub> − ⟨<italic>h</italic><sub><italic>t</italic>,[<italic>i</italic></sub>] ⟩)0.381 as the input to the firing rate model from Eq. (<xref ref-type="bibr" rid="c6">6</xref>). The thirst signal is centered so that <inline-formula><inline-graphic xlink:href="667134v2_inline38.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and scaled by a factor of 0.381 to approximately match the average dynamic range of value <italic>v</italic><sub><italic>t</italic>,[<italic>i</italic>]</sub> using <italic>τ</italic><sub>[<italic>i</italic>]</sub> = 70 trials and <italic>v</italic><sub>0,[<italic>i</italic>]</sub> = 0.8 ∀ <italic>i</italic>.</p>
</sec>
<sec id="s5c5h">
<title>Non-coding likelihood</title>
<p>The likelihood under the noncoding model <inline-formula><inline-graphic xlink:href="667134v2_inline39.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is derived analogously to the value and thirst likelihoods using <italic>x</italic><sub><italic>t</italic></sub> = 0 ∀ <italic>t</italic> in Eq. (<xref ref-type="bibr" rid="c6">6</xref>).</p>
</sec>
</sec>
<sec id="s5c6">
<label>5.3.</label>
<title>Hierarchical Bayesian model of anticipatory licking</title>
<sec id="s5c6a">
<title>Notation</title>
<p>Similar to previous sections, we use subscripts in square brackets ·<sub>[<italic>i</italic>]</sub> to denote quantities that are specific to session <italic>i</italic>.</p>
<p>Since this experiment contains a mixture of regular trials with stochastic rewards and catch trials in which reward was delivered, we model the number of anticipatory licks in trial <italic>t</italic> of session <italic>i, l</italic><sub><italic>t</italic>,[<italic>i</italic>]</sub>, as being dependent on whether the animal perceives that it is in a regular or catch trial. To indicate this dependence, we use the indicator <italic>z</italic><sub><italic>t</italic>,[<italic>i</italic>]</sub> = 1 to denote the event that the animal is in a regular trial and <inline-formula><inline-graphic xlink:href="667134v2_inline40.gif" mimetype="image" mime-subtype="gif"/></inline-formula> to denote the event that the animal is in a catch trial. Similarly, we use <inline-formula><inline-graphic xlink:href="667134v2_inline41.gif" mimetype="image" mime-subtype="gif"/></inline-formula> to indicate that the animal <italic>perceives</italic> that it is in a regular trial, and <inline-formula><inline-graphic xlink:href="667134v2_inline42.gif" mimetype="image" mime-subtype="gif"/></inline-formula> to indicate that the animal <italic>perceives</italic> that it is in a catch trial.</p>
</sec>
</sec>
</sec>
<sec id="s5d">
<title>Perceptual model of licking</title>
<p>We model the number of anticipatory licks <italic>l</italic><sub><italic>t</italic>,[<italic>i</italic>]</sub> a nonlinear function of a standard-ized latent variable <inline-formula><inline-graphic xlink:href="667134v2_inline43.gif" mimetype="image" mime-subtype="gif"/></inline-formula> (defined below) if the animal perceives that it is in a regular trial, and as being near zero if the animal perceives that is in a catch trial
<disp-formula id="eqn20">
<graphic xlink:href="667134v2_eqn20.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="667134v2_inline44.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is noise. The log posterior prob-ability density of the licking model is
<disp-formula id="eqn21">
<graphic xlink:href="667134v2_eqn21.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <italic>C</italic> is a constant that represents the log probability of the data; <italic>p</italic>(<italic>θ</italic>) is the prior; <italic>N</italic> is the number of recording sessions; <italic>T</italic><sub>[<italic>i</italic>]</sub> is the number of trials in session <italic>i</italic>; <italic>π</italic><sub>[<italic>i</italic>]</sub> is the probability that the animal perceives the trial type correctly in session <italic>i</italic>; and the likelihoods come from the normal densities implied by the noise terms in Eq. (<xref ref-type="bibr" rid="c20">20</xref>). We model the variability in <italic>π</italic><sub>[<italic>i</italic>]</sub> across sessions using a beta distribution
<disp-formula id="eqn22">
<graphic xlink:href="667134v2_eqn22.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
from which we can estimate the population mean correct perception probability reported in the main text.</p>
</sec>
<sec id="s5e">
<title>Licking in perceived regular trials</title>
<p>For perceived regular trials, we model the number of anticipatory licks as a non-linear function of a standardized latent variable <inline-formula><inline-graphic xlink:href="667134v2_inline45.gif" mimetype="image" mime-subtype="gif"/></inline-formula> (defined below)
<disp-formula id="eqn23">
<graphic xlink:href="667134v2_eqn23.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where logit<sup><italic>⨪</italic>1</sup>[·] is the logistic function; <inline-formula><inline-graphic xlink:href="667134v2_inline46.gif" mimetype="image" mime-subtype="gif"/></inline-formula> are the intercept, input gain, and output gain, respectively; and <italic>k</italic><sub>[<italic>i</italic>]</sub> is a parameter to control the shape of the nonlinear function (<italic>k</italic><sub>[<italic>i</italic>]</sub> <italic>&gt;</italic> 0). The subscript in square brackets <sub>[<italic>i</italic>]</sub> denotes a quantity that is specific to recording session <italic>i</italic>, analogous to the subscripts that denote neuron-specific quantities in the sections above.</p>
<p>For ease of fitting, we reparameterize the intercept <inline-formula><inline-graphic xlink:href="667134v2_inline47.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and input gain <inline-formula><inline-graphic xlink:href="667134v2_inline48.gif" mimetype="image" mime-subtype="gif"/></inline-formula> in the above model in terms of two an-chor points <italic>A</italic><sub>1,[<italic>i</italic>]</sub>, <italic>A</italic><sub>2,[<italic>i</italic>]</sub> that we constrain to be somewhere in the non-saturated range of the logistic function
<disp-formula id="eqn24">
<graphic xlink:href="667134v2_eqn24.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
and use these to back-calculate the input gain <inline-formula><inline-graphic xlink:href="667134v2_inline49.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and intercept <inline-formula><inline-graphic xlink:href="667134v2_inline50.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. This procedure ensures that when the standardized latent <inline-formula><inline-graphic xlink:href="667134v2_inline51.gif" mimetype="image" mime-subtype="gif"/></inline-formula> varies between <italic>⨪</italic>1 and 1, the output of the logistic function will vary between <italic>A</italic><sub>1,[<italic>i</italic>]</sub> and <italic>A</italic><sub>2,[<italic>i</italic>]</sub>, which we constrain to 0 <italic>&lt; A</italic><sub>1,[<italic>i</italic>]</sub> <italic>&lt;</italic> 1<italic>/</italic>2 and 1<italic>/</italic>2 <italic>&lt; A</italic><sub>2,[<italic>i</italic>]</sub> <italic>&lt;</italic> 1.</p>
<p>To obtain the input gain and intercept from the anchor points, we first solve Eq. (<xref ref-type="bibr" rid="c24">24</xref>) for <inline-formula><inline-graphic xlink:href="667134v2_inline52.gif" mimetype="image" mime-subtype="gif"/></inline-formula>, yielding
<disp-formula id="eqn25">
<graphic xlink:href="667134v2_eqn25.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Subtracting these two equations and rearranging yields an equation for <inline-formula><inline-graphic xlink:href="667134v2_inline53.gif" mimetype="image" mime-subtype="gif"/></inline-formula>
<disp-formula id="eqn26">
<graphic xlink:href="667134v2_eqn26.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
which can be substituted back into Eq. (<xref ref-type="bibr" rid="c25">25</xref>) to obtain <inline-formula><inline-graphic xlink:href="667134v2_inline54.gif" mimetype="image" mime-subtype="gif"/></inline-formula>.</p>
<sec id="s5e1">
<title>Latent</title>
<p>The unstandardized latent variable <italic>ξ</italic><sub><italic>t</italic>,[<italic>i</italic>]</sub> is defined as a mixture of thirst and value computed with three different learning timescales
<disp-formula id="eqn27">
<graphic xlink:href="667134v2_eqn27.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="667134v2_inline55.gif" mimetype="image" mime-subtype="gif"/></inline-formula> are mixing coeffi-cients constrained to the unit simplex (<italic>i</italic>.<italic>e</italic>., sum to one). We use a tilde <inline-formula><inline-graphic xlink:href="667134v2_inline56.gif" mimetype="image" mime-subtype="gif"/></inline-formula> to indicate a standardized variable
<disp-formula id="ueqn5">
<graphic xlink:href="667134v2_ueqn5.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Where⟨ ·⟩ denotes the mean across trials, as above. Note that the variable <inline-formula><inline-graphic xlink:href="667134v2_inline57.gif" mimetype="image" mime-subtype="gif"/></inline-formula> used to drive licking in Eq. (<xref ref-type="bibr" rid="c23">23</xref>) is a standardized version of Eq. (<xref ref-type="bibr" rid="c27">27</xref>). We model variability in the mixing coefficients across sessions using a Dirichlet distribution
<disp-formula id="eqn28">
<graphic xlink:href="667134v2_eqn28.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
from which we can estimate the population mean of each mixing coefficient reported in the main text.</p>
<p>The unstandardized values <italic>v</italic><sup>(<italic>x</italic>)</sup> used to drive the latent are parameterized by the initial value <inline-formula><inline-graphic xlink:href="667134v2_inline58.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and learning timescale <italic>τ</italic> <sup>(<italic>x</italic>)</sup> (recall Eq. (<xref ref-type="bibr" rid="c4">4</xref>)). The initial value is taken from a beta distribution and scaled to lie between 0.555 and 1
<disp-formula id="eqn29">
<graphic xlink:href="667134v2_eqn29.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
as in the neural activity models (<xref rid="tbl1" ref-type="table">Table 1</xref>). The fast values <italic>v</italic><sup>(fast)</sup> use <italic>τ</italic> = 1 trial and the medium values <italic>v</italic><sup>(med)</sup> use <italic>τ</italic> = 10 trials. The slow values <italic>v</italic><sup>(slow)</sup>, which are intended to reflect the potential influence of value-coding serotonin neurons on behaviour, use learning timescales taken from a log-normal distribution that closely approximates the posterior population distribution of learning timescales from the neural data
<disp-formula id="eqn30">
<graphic xlink:href="667134v2_eqn30.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
subject to <inline-formula><inline-graphic xlink:href="667134v2_inline59.gif" mimetype="image" mime-subtype="gif"/></inline-formula>, where
<disp-formula id="eqn31">
<graphic xlink:href="667134v2_eqn31.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
The parameters of the <italic>µ</italic> <sub>log <italic>τ</italic>,lick</sub>and <italic>σ</italic> <sub>log <italic>τ</italic>,lick</sub> distributions<sub>1,[<italic>i</italic>]</sub>were obtained via maximum likelihood fits to the corre-<sub>[<italic>i</italic>]</sub> sponding posterior distributions from the neural activity mixture model. This constrains the <inline-formula><inline-graphic xlink:href="667134v2_inline60.gif" mimetype="image" mime-subtype="gif"/></inline-formula> in the behavioural model to match the neural activity model, while accounting for uncertainty inherent in the neural model.</p>
</sec>
<sec id="s5e2">
<title>Parameterization and priors</title>
<p>For the purposes of fitting, the model is parameterized in terms of the following quantities:</p>
<list list-type="bullet">
<list-item><p>The correct perception probabilities <italic>π</italic><sub>[<italic>i</italic>]</sub> and their pop-ulation distribution parameters <italic>a</italic><sub><italic>π</italic></sub>, <italic>b</italic><sub><italic>π</italic></sub>.</p></list-item>
<list-item><p>Normalized initial value for each session <inline-formula><inline-graphic xlink:href="667134v2_inline61.gif" mimetype="image" mime-subtype="gif"/></inline-formula>, as in the neural activity models.</p></list-item>
<list-item><p>Standardized slow learning timescale for each session <inline-formula><inline-graphic xlink:href="667134v2_inline62.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and corresponding population distribution parameters <italic>µ</italic><sub>log <italic>τ</italic>,lick</sub>, <italic>σ</italic><sub>log <italic>τ</italic>,lick</sub>, as in the hierarchical neural activity model.</p></list-item>
<list-item><p>Mixing coefficients for each session <inline-formula><inline-graphic xlink:href="667134v2_inline63.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and corresponding population distribution parameters<italic>a</italic><sub>val, fast</sub>, <italic>a</italic><sub>val, med</sub>, <italic>a</italic><sub>val, slow</sub>, <italic>a</italic><sub>thr</sub>.</p></list-item>
<list-item><p>Nonlinear function anchor points for each session<italic>A</italic><sub>1,[<italic>i</italic>]</sub>, <italic>A</italic><sub>2,[<italic>i</italic>]</sub>.</p></list-item>
<list-item><p>Nonlinear function shape parameter on a log10 scalelog <italic>k</italic><sub>[<italic>i</italic>]</sub> for each session.</p></list-item>
<list-item><p>Nonlinear function output gain <inline-formula><inline-graphic xlink:href="667134v2_inline64.gif" mimetype="image" mime-subtype="gif"/></inline-formula> for each session.</p></list-item>
<list-item><p>Lick count standard deviation for each session <italic>σ</italic><sub><italic>l</italic>,[<italic>i</italic>]</sub>.</p></list-item>
</list>
</sec>
</sec>
</sec>
</body>
<back>
<sec id="s6">
<label>A</label>
<title>Justification for Bayesian approach: Baseline firing rate example</title>
<p>A limitation of the value coding model presented in Eqs. (<xref ref-type="bibr" rid="c1">1</xref>) and (<xref ref-type="bibr" rid="c2">2</xref>) is that the firing rate gain and intercept terms <italic>β</italic><sub><italic>1</italic></sub> and <italic>β</italic><sub>0</sub> are degenerate when the learning timescale <italic>τ</italic> is very long. This can make it difficult to determine whether a particular neuron with a long estimated learning timescale is activated by value (<italic>β</italic><sub>1</sub> <italic>&gt;</italic> 0) and has a low baseline firing rate, is inhibited by value (<italic>β</italic><sub>1</sub> <italic>&lt;</italic> 0) and has a high baseline firing rate, or even whether it is insensitive to value (<italic>β</italic><sub>1</sub>≈0) and has a moderate baseline firing rate purely based on the data likelihood. To see why, note from Eq. (<xref ref-type="bibr" rid="c3">3</xref>) that lim<sub><italic>τ</italic>→∞</sub> <italic>v</italic><sub><italic>t</italic></sub> = <italic>v</italic><sub>0</sub>, which implies that
<disp-formula id="eqn32">
<graphic xlink:href="667134v2_eqn32.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Since there are infinitely many combinations of <italic>β</italic><sub>0</sub> and <italic>β</italic><sub>1</sub> that satisfy the above equation, the likelihood of the firing rate given the slope and intercept <italic>p</italic>(<italic>ρ</italic><sub><italic>t</italic></sub> <italic>β</italic><sub>0</sub>, <italic>β</italic><sub>1</sub>) is not sufficient to identify the values of these parameters. This means that we need additional information beyond what is available in the data in order to estimate <italic>β</italic><sub>0</sub> and <italic>β</italic><sub>1</sub>. Fortunately, previous work has already established the normal range of baseline firing rates in serotonin neurons. Incorporating this knowledge into our model in the form of a prior distribution for <italic>β</italic><sub>0</sub> makes it possible to estimate the values of the remaining parameters, even if the data likelihood is insufficient.</p>
</sec>
<sec id="s7">
<label>B</label>
<title>Prior for firing rate intercepts</title>
<sec id="s7a">
<title>Background</title>
<p>To establish a prior for the firing rate intercepts <italic>β</italic><sub>0</sub> in our analysis, we took advantage of previous experiments reported in ref. 9. These experiments are similar to the dynamic Pavlovian experiment analyzed in the main text in important respects:</p>
<list list-type="bullet">
<list-item><p>Both sets of data consist of <italic>in vivo</italic> tetrode record-ings of identified dorsal raphe serotonin neurons in C57BL/6J mice.</p></list-item>
<list-item><p>Both sets of data are from head-fixed trace conditioning experiments.</p></list-item>
</list>
<p>The main differences between the two sets of experiments are as follows:</p>
<list list-type="bullet">
<list-item><p>The experiments from ref. 9 include reward and punishment conditions, while the dynamic Pavlovian experiment includes only rewards.</p></list-item>
<list-item><p>Reward and punishment block transitions were cued in ref. 9, while changes in reward probability in the dynamic Pavlovian experiment were not cued.</p></list-item>
<list-item><p>Unconditioned stimuli were deterministic in ref. 9 and stochastic in the dynamic Pavlovian experiment.</p></list-item>
</list>
<p>In view of these similarities and differences, we took the average baseline firing rate across reward <inline-formula><inline-graphic xlink:href="667134v2_inline65.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and punishment <inline-formula><inline-graphic xlink:href="667134v2_inline66.gif" mimetype="image" mime-subtype="gif"/></inline-formula> conditions from ref. 9 to be analogous to the baseline firing rate in our model <italic>β</italic><sub>0</sub>
<disp-formula id="eqn33">
<graphic xlink:href="667134v2_eqn33.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
allowing us to estimate the distribution of the firing rate intercept <italic>β</italic><sub>0</sub> across neurons from the <inline-formula><inline-graphic xlink:href="667134v2_inline67.gif" mimetype="image" mime-subtype="gif"/></inline-formula> pairs reported in ref. <xref rid="fig3" ref-type="fig">Figs. 3C</xref> and 6D.</p>
</sec>
<sec id="s7b">
<title>Data extraction and pooling</title>
<p>Using Web Plot Digitizer (<ext-link ext-link-type="uri" xlink:href="https://apps.autometris.io/wpd/">https://apps.autometris.io/wpd/</ext-link>), we extracted measurements of the mean pre-trial firing rates of <italic>N</italic> = 29 neurons during water reward and air puff punishment blocks of the trace conditioning experiment reported in ref. <xref rid="fig3" ref-type="fig">Fig. 3C</xref>, and <italic>N</italic> = 21 neurons during water or chocolate milk reward and quinine solution punishment blocks of the trace conditioning experiment reported in ref. Fig. 6D. Data were pooled across the two experiments because we did not observe significant differences in the distributions of firing rates across the two experiments (differences in <inline-formula><inline-graphic xlink:href="667134v2_inline68.gif" mimetype="image" mime-subtype="gif"/></inline-formula> are symmetric about zero, Mann–Whitney U-test <italic>p</italic> = 0.74, differences in <inline-formula><inline-graphic xlink:href="667134v2_inline69.gif" mimetype="image" mime-subtype="gif"/></inline-formula> are symmetric about zero, Mann–Whitney U-test <italic>p</italic> = 0.68).</p>
</sec>
<sec id="s7c">
<title>Results</title>
<p>The distribution of firing rate intercepts implied by ref. 9 is approximately gamma with mean 3.41 Hz and SD 2.34 Hz (<italic>β</italic><sub>0</sub> ~ Gamma[2.12, 1.61] using the shape <italic>α</italic> scale <italic>θ</italic> parameterization; maximum likelihood estimates obtained with &lt;monospace&gt;scipy.stats.gamma.fit&lt;/monospace&gt;; <xref rid="figS6" ref-type="fig">Fig. S6A</xref>). Since our goal is to arrive at a prior distribution for the firing rate intercepts in a new sample of neurons, we quantified the sampling-related uncertainty in our estimated intercept distribution using bootstrapping (<xref rid="figS6" ref-type="fig">Fig. S6B</xref>). We found that the bootstrap distribution of the natural log shape and scale parameters is a close match to a multivariate normal
<disp-formula id="ueqn6">
<graphic xlink:href="667134v2_ueqn6.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
as shown in <xref rid="figS6" ref-type="fig">Fig. S6C</xref>, which we therefore used as a prior for the distribution of firing rate intercepts in our analysis.</p>
</sec>
<sec id="s7d">
<title>Verification</title>
<p>The analogy between the cross-condition average firing rate in ref. 9 and the firing rate intercept <italic>β</italic><sub>0</sub> given in Eq. (<xref ref-type="bibr" rid="c33">33</xref>) depends on the assumption that the effects of rewards and punishments on the firing rates of serotonin neurons are of roughly equal magnitude and opposite sign, such that they cancel out when averaged. To guard against the possibility that this assumption is wrong, we reserved the baseline firing rates reported in ref. 9 Fig. 8S2A (measured under unspecified conditions) as a test dataset to check the baseline firing rate distribution implied by ref. <xref rid="fig3" ref-type="fig">Figs. 3C</xref> and 6D. The distribution of firing rate intercepts implied by Eq. (<xref ref-type="bibr" rid="c33">33</xref>) shown in <xref rid="figS6" ref-type="fig">Fig. S6</xref> closely agrees with the distribution implied by the test data (<xref rid="figS7" ref-type="fig">Fig. S7</xref>), validating our approach.</p>
</sec>
</sec>
<sec id="s8">
<label>C</label>
<title>Prior for firing rate gain</title>
<p>Using the same data as in Supplementary Note B, we established a prior for the normalized firing rate gain <inline-formula><inline-graphic xlink:href="667134v2_inline70.gif" mimetype="image" mime-subtype="gif"/></inline-formula> using
<disp-formula id="eqn34">
<graphic xlink:href="667134v2_eqn34.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <italic>β</italic><sub>0,[<italic>i</italic>]</sub> is estimated according to Eq. (<xref ref-type="bibr" rid="c33">33</xref>) and where we use <inline-formula><inline-graphic xlink:href="667134v2_inline71.gif" mimetype="image" mime-subtype="gif"/></inline-formula> as an estimate of <italic>β</italic><sub>1</sub>. This estimate is sensitive to mis-estimation of <italic>β</italic><sub>1</sub>, and, unlike with <italic>β</italic><sub>0</sub> (see Supplementary Note B), we are unaware of data that could be used to check our estimate. We therefore use Eq. (<xref ref-type="bibr" rid="c34">34</xref>) to set only a weak prior of <italic>β</italic><sub>1</sub><sup><italic>′</italic></sup> <italic>~ N</italic> (0, 0.75<sup>2</sup>) truncated to [<italic>⨪</italic>1, 1], as shown in <xref rid="figS8" ref-type="fig">Fig. S8</xref>.</p>
</sec>
<sec id="s9">
<label>D</label>
<title>Alternatives to mixture modelling approach</title>
<p>Here we have chosen to infer the properties of value, thirst, and null coding serotonin neurons using a mixture model due to important limitations of alternative approaches. In this section, we briefly outline the alternatives considered and why they were not chosen.</p>
<sec id="s9a">
<title>Problem definition</title>
<p>The goals of this work are 1) to measure the proportion of serotonin neurons that encode value and 2) to infer the properties of value coding neurons. To accomplish these goals, we have analyzed a dataset of measurements of the activity of a number of serotonin neurons. The challenges we faced are that 1) the only information we can use to determine whether an individual serotonin neuron encodes value is its activity over time, 2) the time course of activity in a serotonin neuron that encodes value is not necessarily very different than the time course of activity in a serotonin neuron that encodes thirst or where the activity drifts randomly (null coding), and 3) value, thirst, and null coding are particularly difficult to tell apart if the firing rate gain is small and/or if the learning timescale associated with value coding is long. To address these challenges, we needed to select an analysis approach that can cope with unlabeled data (challenge 1), high noise (challenge 2), and confounding that is uneven throughout the parameter space (challenge 3).</p>
</sec>
<sec id="s9b">
<title>Statistical null hypothesis testing</title>
<p>The most familiar way to address the first challenge listed above would be to use statistical null hypothesis testing to rule out thirst and null coding in a subset of neurons. For example, to rule out null coding, we might have adopted the circular trial permutation test from our previous work (<xref ref-type="bibr" rid="c12">12</xref>) and selected only the subset of neurons with activity patterns that are very unlikely under null coding (e.g. at the <italic>p &lt;</italic> 0.05 level) as being non-null-coding. A similar procedure could have been repeated for thirst coding to obtain a set of non-null-, non-thirst-coding neurons. By process of elimination, we would then consider these neurons to be value coding and analyze them further. The basic pattern of this approach will be familiar to most readers: apply a statistical test, label the neurons with <italic>p &lt;</italic> 0.05 as having the coding feature of interest, and then analyze only that subset.</p>
<p>While this approach adequately addresses the first challenge posed above, it does not address challenges two or three. Specifically, because it is generally difficult to tell apart serotonin neurons with value, thirst, or null coding features, and because typical statistical tests focus on limiting the rate of false positives rather than false negatives (including the circular trial permutation test from our previous work, ref. 17), it is likely that a meaningful fraction of value coding serotonin neurons would be discarded. Thus, a bias towards false negatives due to low statistical power could cause the fraction of value coding neurons to be meaningfully underestimated. A further problem with this approach is that the subset of serotonin neurons that <italic>are</italic> selected as value coding will be the neurons with value coding features that are the most different from the activity patterns observed in thirst and/or null coding neurons. In other words, there will be a bias towards selecting serotonin neurons with unusually high firing rate gains and short learning timescales. This phenomenon, whereby selecting data points according to statistical significance causes model parameters to be biased towards extremes, is well documented in the statistical literature (<xref ref-type="bibr" rid="c47">47</xref>–<xref ref-type="bibr" rid="c49">49</xref>). Overall, taking this approach would likely have led us to conclude that value coding serotonin neurons are less abundant and encode value more strongly and over a shorter timescale than is actually the case.</p>
</sec>
<sec id="s9c">
<title>Model comparison</title>
<p>A more sophisticated way to address the first challenge listed above would be to fit a value, thirst, and null coding model to each cell, compare their predictive accuracy (using cross-validation, AIC, BIC, etc.), and then label each cell as following the coding scheme corresponding to the best fitting model. Compared with the null hypothesis testing approach outlined above, this approach does not have a strong bias towards thirst or null coding, eliminating the tendency to conclude that value coding neurons are rarer and respond more strongly to recent rewards than is actually the case.</p>
<p>While the model comparison approach represents an improvement over null hypothesis testing in terms of our two main goals, it does not fully address challenges 2 and 3. Specifically, because this approach involves labeling individual neurons as being value, thirst, or null coding in order to conduct further analysis, information about the uncertainty of these labels is lost. This could pose a problem if the sample of serotonin neurons in the dataset analyzed here happens to be enriched in neurons with activity patterns that are only slightly more consistent with value coding than thirst coding, for example, simply due to chance. Since the model comparison approach does not take the strength of evidence for one coding scheme over another into consideration, we would be at risk of confidently concluding that a large fraction of neurons encode value with a low firing rate gain and long learning timescale. The general problem of label-based methods ignoring uncertainty in data labels is briefly discussed in ref. 50.</p>
</sec>
</sec>
<sec id="s10">
<title>Supplementary figures</title>
<fig id="figS1" position="float" fig-type="figure">
<label>Figure S1.</label>
<caption>
<title>Features of value and thirst coding in serotonin neurons.</title>
<p><bold>A</bold> Conceptual introduction to the value, thirst, and null coding mixture model. A hypothetical one-dimensional dataset of hairline measurements in tenured faculty is illustrated at top. A mixture model can infer the average hairlines of male and female faculty as well as the proportion of faculty that are male or female, even when gender information is missing from the data. Similarly, the mixture model of serotonin neuron coding features can infer the properties of value, thirst, and null coding neurons as well as the proportion of neurons of each type (bottom). <bold>B</bold> Inferred proportion of neurons that are value, thirst, or null coding. Brighter colours in the main plot indicate higher posterior density. The uniform prior is illustrated schematically at top right. <bold>C</bold> Mean learning timescale <italic>τ</italic> across the population of value-coding serotonin neurons. <bold>D</bold> Standard deviation of the learning timescale <italic>τ</italic> across the population of value-coding serotonin neurons on a log<sub>10</sub> scale. <bold>E</bold> 10<sup>th</sup> percentile of the distribution of the learning timescale <italic>τ</italic> across the population of value-coding serotonin neurons. <bold>F</bold> 90<sup>th</sup> percentile of the distribution of the learning timescale <italic>τ</italic> across the population of value-coding serotonin neurons. <bold>G</bold> Fraction of cells in this dataset with positive firing rate gain for value <italic>β</italic><sup>(val)</sup>. Pie plot shows the MAP estimate of the proportion of neurons with positive (negative) firing rate gain in black (gray). Note that the prior (black line) is based on a default assumption that positive and negative gains are equally common in the population. <bold>H</bold> Fraction of cells in this dataset with positive firing rate gain for thirst <italic>β</italic><sup>(thr)</sup>. Presented as in G. All parameter estimates are based on a model fitted to 12 387 trials from 37 neurons. Black lines and coloured histograms in C–H indicate the prior and posterior, respectively, for each parameter or derived feature. B–D show parameters that are directly included in the model, while E–H are derived from fitted parameters. Partial-pooling across neurons was used for the quantities shown in C–F, full pooling was used for the parameters in B, and no pooling was used for G or H. See <xref ref-type="sec" rid="s5c5">Section 5.3.5</xref> for details.</p>
</caption>
<graphic xlink:href="667134v2_figS1.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<fig id="figS2" position="float" fig-type="figure">
<label>Figure S2.</label>
<caption>
<title>Additional features of value, thirst, and null coding mixture model.</title>
<p>Related to <xref rid="figS1" ref-type="fig">Fig. S1</xref>. <bold>A</bold> Estimated normalized firing rate gain and learning timescale for each neuron. Points and error bars represent the median and IQR of the posterior. Neurons for which the 95 % credibility interval for the normalized firing rate gain includes zero are indicated in gray. <bold>B</bold> Distribution of estimated initial values <italic>v</italic><sub>0,[<italic>i</italic>]</sub> from the <italic>maximum a posteriori</italic> (MAP) sample (blue histogram) compared with the prior (black line). <bold>C</bold> Posterior distribution of mean firing rate in the population (blue) compared with the prior (black).</p>
</caption>
<graphic xlink:href="667134v2_figS2.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<fig id="figS3" position="float" fig-type="figure">
<label>Figure S3.</label>
<caption>
<title>Time-course of reward collection across recording sessions.</title>
<p><bold>A</bold> Heatmaps showing whether or not a reward was collected on each trial, aligned to either the start (left) or end (right) of the experiment. Trials in which a reward was collected are shown in gray, no-reward trials are shown in black. <bold>B</bold> Time-course of reward collection aligned to fraction of session length. Each gray line represents data from one row of A smoothed using Gaussian process regression (observation variance set to 0.45 <italic>×</italic> (1 <italic>⨪</italic> 0.45), squared exponential kernel with length scale 1<italic>/</italic>6). Black line represents the expected mean reward probability of 45 %. Note that the reward collection probability is high at the start of the experiment because the first block of trials always has a reward probability of 80 %. <bold>C</bold> Heatmaps showing trials where a reward was offered but not collected (ignored rewards), aligned as in A. Trials in which a reward was offered but not collected are shown in gray, trials in which a reward was either not offered or offered and collected are shown in black. <bold>D</bold> Time-course of the rate of ignored rewards, presented as in B.</p>
</caption>
<graphic xlink:href="667134v2_figS3.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<fig id="figS4" position="float" fig-type="figure">
<label>Figure S4.</label>
<caption>
<title>Time-course of inter-trial intervals (ITIs) with missing inter-spike interval (ISI) data across neurons.</title>
<p>Missing ISI data is the result of ITIs with fewer than two spikes. This can occur if the ITI is shorter than the mean ISI (the minimum ITI duration is 0 s while serotonin neuron ISIs are typically approx. 0.2–1 s), or if the neuron is lost due to spike sorting or other recording issues. <bold>A</bold> Heatmaps showing whether or not each ITI has at least one ISI, aligned to either the start (left) or end (right) of the experiment. ITIs with zero ISIs are shown in black, ITIs with at least one ISI are shown in gray. <bold>B</bold> Time-course of missing ISI data aligned to fraction of session length. Each gray line represents data from one row of A smoothed using Gaussian process regression (observation variance set to <italic>p ×</italic> (1 <italic>⨪ p</italic>), where <italic>p</italic> is the fraction of non-empty it is in the corresponding session; squared exponential kernel with length scale 1<italic>/</italic>6).</p>
</caption>
<graphic xlink:href="667134v2_figS4.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<fig id="figS5" position="float" fig-type="figure">
<label>Figure S5.</label>
<caption>
<title>Value coding model residuals compared with model assumptions.</title>
<p><bold>A</bold> Histogram of standardized inter-spike interval residuals (blue) compared with the normal distribution assumed by the model (black line). <bold>B</bold> Autocorrelation of standardized residuals for each neuron (gray lines) compared with the model assumption of zero autocorrelation (black line). For clarity, the autocorrelation at zero lag is not shown. Residuals are net of drift captured using a third-order autoregressive model.</p>
</caption>
<graphic xlink:href="667134v2_figS5.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<fig id="figS6" position="float" fig-type="figure">
<label>Figure S6.</label>
<caption>
<title>Firing rate intercept prior.</title>
<p><bold>A</bold> Histogram of estimated firing rate intercepts <italic>β</italic><sub>0</sub> from ref. 9 with fitted gamma distribution. <italic>N</italic> = 50 neurons from ref. <xref rid="fig3" ref-type="fig">Figs. 3C</xref> and 6D. <bold>B</bold> Gamma distributions fitted to bootstrapped firing rate intercept data from A. Note variability due to sampling error. <bold>C</bold> Estimated distribution of gamma distribution parameters across bootstrap samples. Contours show a kernel density estimate of the joint distribution of ln <italic>α</italic> (natural log shape) and ln <italic>θ</italic> (natural log scale) parameters across bootstrap samples. Heatmap shows fitted multivariate Gaussian distribution to be used as a prior. <bold>D</bold> Draws from Gaussian prior distribution over ln <italic>α</italic> and ln <italic>θ</italic>. Note close resemblance to the bootstrap distribution in B.</p>
</caption>
<graphic xlink:href="667134v2_figS6.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<fig id="figS7" position="float" fig-type="figure">
<label>Figure S7.</label>
<caption><title>Verification of firing rate intercept prior distribution.</title>
<p>Histogram of firing rate intercepts from ref. 9 Fig. 8S2A (test data; <italic>N</italic> = 28 neurons) and fitted gamma distribution (black line) compared with the distribution fitted to data from ref. <xref rid="fig3" ref-type="fig">Figs. 3C</xref> and 6D (dashed green line; <italic>N</italic> = 50 neurons).</p></caption>
<graphic xlink:href="667134v2_figS7.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<fig id="figS8" position="float" fig-type="figure">
<label>Figure S8.</label>
<caption><title>Prior for normalized firing rate gain.</title>
<p>Histogram of normalized firing rate gains <italic>β</italic><sub>1</sub><sup><italic>′</italic></sup> calculated according to Eq. (<xref ref-type="bibr" rid="c34">34</xref>) using data from ref. 9 <xref rid="fig3" ref-type="fig">Figs. 3C</xref> and 6D compared with truncated <italic>N</italic> (0, 0.75<sup>2</sup>) prior.</p></caption>
<graphic xlink:href="667134v2_figS8.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
</sec>
<ref-list>
<title>References</title>
<ref id="c1"><label>[1]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Melissa R</given-names> <surname>Warden</surname></string-name>, <string-name><given-names>Aslihan</given-names> <surname>Selimbeyoglu</surname></string-name>, <string-name><given-names>Julie J</given-names> <surname>Mirzabekov</surname></string-name>, <string-name><given-names>Maisie</given-names> <surname>Lo</surname></string-name>, <string-name><given-names>Kimberly R</given-names> <surname>Thompson</surname></string-name>, <string-name><given-names>Sung-Yon</given-names> <surname>Kim</surname></string-name>, <string-name><given-names>Avishek</given-names> <surname>Adhikari</surname></string-name>, <string-name><given-names>Kay M</given-names> <surname>Tye</surname></string-name>, <string-name><given-names>Loren M</given-names> <surname>Frank</surname></string-name>, and <string-name><given-names>Karl</given-names> <surname>Deisseroth</surname></string-name></person-group>. <article-title>A prefrontal cortex–brainstem neuronal projection that controls response to behavioural challenge</article-title>. <source>Nature</source>, <volume>492</volume>(<issue>7429</issue>):<fpage>428</fpage>–<lpage>432</lpage>, <year>2012</year>.</mixed-citation></ref>
<ref id="c2"><label>[2]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Changwoo</given-names> <surname>Seo</surname></string-name>, <string-name><given-names>Akash</given-names> <surname>Guru</surname></string-name>, <string-name><given-names>Michelle</given-names> <surname>Jin</surname></string-name>, <string-name><given-names>Brendan</given-names> <surname>Ito</surname></string-name>, <string-name><given-names>Brianna J</given-names> <surname>Sleezer</surname></string-name>, <string-name><given-names>Yi-Yun</given-names> <surname>Ho</surname></string-name>, <string-name><given-names>Elias</given-names> <surname>Wang</surname></string-name>, <string-name><given-names>Christina</given-names> <surname>Boada</surname></string-name>, <string-name><given-names>Nicholas A</given-names> <surname>Krupa</surname></string-name>, <string-name><given-names>Durgaprasad S</given-names> <surname>Kullakanda</surname></string-name>, <etal>et al.</etal></person-group> <article-title>Intense threat switches dorsal raphe serotonin neurons to a paradoxical operational mode</article-title>. <source>Science</source>, <volume>363</volume>(<issue>6426</issue>):<fpage>538</fpage>–<lpage>542</lpage>, <year>2019</year>.</mixed-citation></ref>
<ref id="c3"><label>[3]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Aaron S</given-names> <surname>Andalman</surname></string-name>, <string-name><given-names>Vanessa M</given-names> <surname>Burns</surname></string-name>, <string-name><given-names>Matthew</given-names> <surname>Lovett-Barron</surname></string-name>, <string-name><given-names>Michael</given-names> <surname>Broxton</surname></string-name>, <string-name><given-names>Ben</given-names> <surname>Poole</surname></string-name>, <string-name><given-names>Samuel J</given-names> <surname>Yang</surname></string-name>, <string-name><given-names>Logan</given-names> <surname>Grosenick</surname></string-name>, <string-name><given-names>Talia N</given-names> <surname>Lerner</surname></string-name>, <string-name><given-names>Ritchie</given-names> <surname>Chen</surname></string-name>, <string-name><given-names>Tyler</given-names> <surname>Benster</surname></string-name>, <etal>et al.</etal></person-group> <article-title>Neuronal dynamics regulating brain and behavioral state transitions</article-title>. <source>Cell</source>, <volume>177</volume>(<issue>4</issue>):<fpage>970</fpage>–<lpage>985</lpage>, <year>2019</year>.</mixed-citation></ref>
<ref id="c4"><label>[4]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>João C</given-names> <surname>Marques</surname></string-name>, <string-name><given-names>Meng</given-names> <surname>Li</surname></string-name>, <string-name><given-names>Diane</given-names> <surname>Schaak</surname></string-name>, <string-name><given-names>Drew N</given-names> <surname>Robson</surname></string-name>, and <string-name><given-names>Jennifer M</given-names> <surname>Li</surname></string-name></person-group>. <article-title>Internal state dynamics shape brainwide activity and foraging behaviour</article-title>. <source>Nature</source>, <volume>577</volume>(<issue>7789</issue>):<fpage>239</fpage>–<lpage>243</lpage>, <year>2020</year>.</mixed-citation></ref>
<ref id="c5"><label>[5]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Zhixiang</given-names> <surname>Liu</surname></string-name>, <string-name><given-names>Jingfeng</given-names> <surname>Zhou</surname></string-name>, <string-name><given-names>Yi</given-names> <surname>Li</surname></string-name>, <string-name><given-names>Fei</given-names> <surname>Hu</surname></string-name>, <string-name><given-names>Yao</given-names> <surname>Lu</surname></string-name>, <string-name><given-names>Ming</given-names> <surname>Ma</surname></string-name>, <string-name><given-names>Qiru</given-names> <surname>Feng</surname></string-name>, <string-name><given-names>Ju-en</given-names> <surname>Zhang</surname></string-name>, <string-name><given-names>Daqing</given-names> <surname>Wang</surname></string-name>, <string-name><given-names>Jiawei</given-names> <surname>Zeng</surname></string-name>, <etal>et al.</etal></person-group> <article-title>Dorsal raphe neurons signal reward through 5-ht and glutamate</article-title>. <source>Neuron</source>, <volume>81</volume>(<issue>6</issue>):<fpage>1360</fpage>– <lpage>1374</lpage>, <year>2014</year>.</mixed-citation></ref>
<ref id="c6"><label>[6]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Patricia A</given-names> <surname>Correia</surname></string-name>, <string-name><given-names>Eran</given-names> <surname>Lottem</surname></string-name>, <string-name><given-names>Dhruba</given-names> <surname>Banerjee</surname></string-name>, <string-name><given-names>Ana S</given-names> <surname>Machado</surname></string-name>, <string-name><given-names>Megan R</given-names> <surname>Carey</surname></string-name>, and <string-name><given-names>Zachary F</given-names> <surname>Mainen</surname></string-name></person-group>. <article-title>Transient inhibition and long-term facilitation of locomotion by phasic optogenetic activation of serotonin neurons</article-title>. <source>eLife</source>, <volume>6</volume>:<elocation-id>e20975</elocation-id>, <year>2017</year>. <pub-id pub-id-type="doi">10.7554/eLife.20975</pub-id></mixed-citation></ref>
<ref id="c7"><label>[7]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Eran</given-names> <surname>Lottem</surname></string-name>, <string-name><given-names>Dhruba</given-names> <surname>Banerjee</surname></string-name>, <string-name><given-names>Pietro</given-names> <surname>Vertechi</surname></string-name>, <string-name><given-names>Dario</given-names> <surname>Sarra</surname></string-name>, <string-name><given-names>Matthijs Oude</given-names> <surname>Lohuis</surname></string-name>, and <string-name><given-names>Zachary F</given-names> <surname>Mainen</surname></string-name></person-group>. <article-title>Activation of serotonin neurons promotes active persistence in a probabilistic foraging task</article-title>. <source>Nature communications</source>, <volume>9</volume>(<issue>1</issue>):<fpage>1000</fpage>, <year>2018</year>.</mixed-citation></ref>
<ref id="c8"><label>[8]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Katsuhiko</given-names> <surname>Miyazaki</surname></string-name>, <string-name><given-names>Kayoko W</given-names> <surname>Miyazaki</surname></string-name>, <string-name><given-names>Akihiro</given-names> <surname>Yamanaka</surname></string-name>, <string-name><given-names>Tomoki</given-names> <surname>Tokuda</surname></string-name>, <string-name><given-names>Kenji F</given-names> <surname>Tanaka</surname></string-name>, and <string-name><given-names>Kenji</given-names> <surname>Doya</surname></string-name></person-group>. <article-title>Reward probability and timing uncertainty alter the effect of dorsal raphe serotonin neurons on patience</article-title>. <source>Nature communications</source>, <volume>9</volume>(<issue>1</issue>):<fpage>2048</fpage>, <year>2018</year>.</mixed-citation></ref>
<ref id="c9"><label>[9]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Jeremiah Y</given-names> <surname>Cohen</surname></string-name>, <string-name><given-names>Mackenzie W</given-names> <surname>Amoroso</surname></string-name>, and <string-name><given-names>Naoshige</given-names> <surname>Uchida</surname></string-name></person-group>. <article-title>Serotonergic neurons signal reward and punishment on multiple timescales</article-title>. <source>eLife</source>, <volume>4</volume>:<elocation-id>e06346</elocation-id>, <year>2015</year>. <pub-id pub-id-type="doi">10.7554/eLife.06346</pub-id></mixed-citation></ref>
<ref id="c10"><label>[10]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Weixin</given-names> <surname>Zhong</surname></string-name>, <string-name><given-names>Yi</given-names> <surname>Li</surname></string-name>, <string-name><given-names>Qiru</given-names> <surname>Feng</surname></string-name>, and <string-name><given-names>Minmin</given-names> <surname>Luo</surname></string-name></person-group>. <article-title>Learning and stress shape the reward response patterns of serotonin neurons</article-title>. <source>Journal of Neuroscience</source>, <volume>37</volume>(<issue>37</issue>):<fpage>8863</fpage>–<lpage>8875</lpage>, <year>2017</year>.</mixed-citation></ref>
<ref id="c11"><label>[11]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Grace E</given-names> <surname>Paquelet</surname></string-name>, <string-name><given-names>Kassandra</given-names> <surname>Carrion</surname></string-name>, <string-name><given-names>Clay O</given-names> <surname>Lacefield</surname></string-name>, <string-name><given-names>Pengcheng</given-names> <surname>Zhou RenéHen</surname></string-name>,, and <string-name><given-names>Bradley R</given-names> <surname>Miller</surname></string-name></person-group>. <article-title>Single-cell activity and network properties of dorsal raphe nucleus serotonin neurons during emotionally salient behaviors</article-title>. <source>Neuron</source>, <volume>110</volume>(<issue>16</issue>):<fpage>2664</fpage>– <lpage>2679</lpage>, <year>2022</year>.</mixed-citation></ref>
<ref id="c12"><label>[12]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Emerson F</given-names> <surname>Harkin</surname></string-name>, <string-name><given-names>Cooper D</given-names> <surname>Grossman</surname></string-name>, <string-name><given-names>Jeremiah Y</given-names> <surname>Cohen</surname></string-name>, <string-name><given-names>Jean-Claude</given-names> <surname>Béïque</surname></string-name>, and <string-name><given-names>Richard</given-names> <surname>Naud</surname></string-name></person-group>. <article-title>A prospective code for value in the serotonin system</article-title>. <source>Nature</source>, <volume>641</volume> <fpage>952</fpage>–<lpage>959</lpage>, <year>2025</year>.</mixed-citation></ref>
<ref id="c13"><label>[13]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Michael B</given-names> <surname>Lynn</surname></string-name>, <string-name><given-names>Sean D</given-names> <surname>Geddes</surname></string-name>, <string-name><given-names>Mohamad</given-names> <surname>Chahrour</surname></string-name>, <string-name><given-names>Sébastien</given-names> <surname>Maillé</surname></string-name>, <string-name><given-names>Léa</given-names> <surname>Caya-Bissonnette</surname></string-name>, <string-name><given-names>Emerson</given-names> <surname>Harkin</surname></string-name>, <string-name><given-names>érik</given-names> <surname>Harvey-Girard</surname></string-name>, <string-name><given-names>Samir</given-names> <surname>Haj-Dahmane</surname></string-name>, <string-name><given-names>Richard</given-names> <surname>Naud</surname></string-name>, and <string-name><given-names>Jean-Claude</given-names> <surname>Béïque</surname></string-name></person-group>. <article-title>Nonlinear recurrent inhibition through facilitating serotonin release in the raphe</article-title>. <source>Nature Neuroscience</source>, <volume>28</volume> <fpage>1024</fpage>–<lpage>1037</lpage>, <year>2025</year>.</mixed-citation></ref>
<ref id="c14"><label>[14]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>R.</given-names> <surname>Sutton</surname></string-name></person-group>. <article-title>Learning to predict by the method of temporal differences</article-title>. <source>Machine learning</source>, <volume>3</volume>:<fpage>9</fpage>–<lpage>44</lpage>, <year>1988</year>.</mixed-citation></ref>
<ref id="c15"><label>[15]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Sara</given-names> <surname>Matias</surname></string-name>, <string-name><given-names>Eran</given-names> <surname>Lottem</surname></string-name>, <string-name><given-names>Guillaume P</given-names> <surname>Dugué</surname></string-name>, and <string-name><given-names>Zachary F</given-names> <surname>Mainen</surname></string-name></person-group>. <article-title>Activity patterns of serotonin neurons underlying cognitive flexibility</article-title>. <source>eLife</source>, <volume>6</volume>:<elocation-id>e20552</elocation-id>, <year>2017</year>. <pub-id pub-id-type="doi">10.7554/eLife.20552</pub-id></mixed-citation></ref>
<ref id="c16"><label>[16]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Cooper D</given-names> <surname>Grossman</surname></string-name>, <string-name><given-names>Bilal A</given-names> <surname>Bari</surname></string-name>, and <string-name><given-names>Jeremiah Y</given-names> <surname>Cohen</surname></string-name></person-group>. <article-title>Serotonin neurons modulate learning rate through uncertainty</article-title>. <source>Current Biology</source>, <volume>32</volume>(<issue>3</issue>):<fpage>586</fpage>–<lpage>599</lpage>, <year>2022</year>.</mixed-citation></ref>
<ref id="c17"><label>[17]</label><mixed-citation publication-type="preprint"><person-group person-group-type="author"><string-name><given-names>Emerson F</given-names> <surname>Harkin</surname></string-name>, <string-name><given-names>Cooper D</given-names> <surname>Grossman</surname></string-name>, <string-name><given-names>Jeremiah Y</given-names> <surname>Cohen</surname></string-name>, <string-name><given-names>Jean-Claude</given-names> <surname>Béïque</surname></string-name>, and <string-name><given-names>Richard</given-names> <surname>Naud</surname></string-name></person-group>. <article-title>Serotonin predictively encodes value</article-title>. <source>biorxiv</source>, <year>2023</year>.</mixed-citation></ref>
<ref id="c18"><label>[18]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>L</given-names> <surname>Paninski</surname></string-name>, <string-name><given-names>B</given-names> <surname>Lau</surname></string-name>, and <string-name><given-names>A</given-names> <surname>Reyes</surname></string-name></person-group>. <article-title>Noise-driven adaptation: in vitro and mathematical analysis</article-title>. <source>Neurocomputing</source>, <volume>52</volume>(<issue>54</issue>):<fpage>877</fpage>–<lpage>883</lpage>, <year>2003</year>.</mixed-citation></ref>
<ref id="c19"><label>[19]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>J.W.</given-names> <surname>Pillow</surname></string-name>, <string-name><given-names>L.</given-names> <surname>Paninski</surname></string-name>, and <string-name><given-names>E.P.</given-names> <surname>Simoncelli</surname></string-name></person-group>. <article-title>Maximum likelihood estimation of a stochastic integrate-and-fire model</article-title>. <source>Advances in Neural Information Processing Systems</source>, volume <volume>16</volume>, pages <fpage>1311</fpage>–<lpage>1318</lpage>, <year>2004</year>.</mixed-citation></ref>
<ref id="c20"><label>[20]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>S.</given-names> <surname>Mensi</surname></string-name>, <string-name><given-names>R.</given-names> <surname>Naud</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Avermann</surname></string-name>, <string-name><given-names>C. C. H.</given-names> <surname>Petersen</surname></string-name>, and <string-name><given-names>W.</given-names> <surname>Gerstner</surname></string-name></person-group>. <article-title>Parameter extraction and classification of three neuron types reveals two different adaptation mechanisms</article-title>. <source>Journal of Neurophysiology</source>, <volume>107</volume>:<fpage>1756</fpage>–<lpage>1775</lpage>, <year>2012</year>.</mixed-citation></ref>
<ref id="c21"><label>[21]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Christian</given-names> <surname>Pozzorini</surname></string-name>, <string-name><given-names>Richard</given-names> <surname>Naud</surname></string-name>, <string-name><given-names>Skander</given-names> <surname>Mensi</surname></string-name>, and <string-name><given-names>Wulfram</given-names> <surname>Gerstner</surname></string-name></person-group>. <article-title>Temporal whitening by powerlaw adaptation in neocortical neurons</article-title>. <source>Nat. Neurosci</source>., <volume>16</volume>(<issue>7</issue>):<fpage>942</fpage>–<lpage>948</lpage>, <year>2013</year>.</mixed-citation></ref>
<ref id="c22"><label>[22]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Christian</given-names> <surname>Pozzorini</surname></string-name>, <string-name><given-names>Skander</given-names> <surname>Mensi</surname></string-name>, <string-name><given-names>Olivier</given-names> <surname>Hagens</surname></string-name>, <string-name><given-names>Richard</given-names> <surname>Naud</surname></string-name>, <string-name><given-names>Christof</given-names> <surname>Koch</surname></string-name>, and <string-name><given-names>Wulfram</given-names> <surname>Gerstner</surname></string-name></person-group>. <article-title>Automated high-throughput characterization of single neurons by means of simplified spiking models</article-title>. <source>PLoS Comp. Biol</source>., <volume>11</volume>(<issue>6</issue>):<fpage>e1004275</fpage>, <year>2015</year>.</mixed-citation></ref>
<ref id="c23"><label>[23]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Corinne</given-names> <surname>Teeter</surname></string-name>, <string-name><given-names>Ramakrishnan</given-names> <surname>Iyer</surname></string-name>, <string-name><given-names>Vilas</given-names> <surname>Menon</surname></string-name>, <string-name><given-names>Nathan</given-names> <surname>Gouwens</surname></string-name>, <string-name><given-names>David</given-names> <surname>Feng</surname></string-name>, <string-name><given-names>Jim</given-names> <surname>Berg</surname></string-name>, <string-name><given-names>Aaron</given-names> <surname>Szafer</surname></string-name>, <string-name><given-names>Nicholas</given-names> <surname>Cain</surname></string-name>, <string-name><given-names>Hongkui</given-names> <surname>Zeng</surname></string-name>, <string-name><given-names>Michael</given-names> <surname>Hawrylycz</surname></string-name>, <etal>et al.</etal></person-group> <article-title>Generalized leaky integrate-and-fire models classify multiple neuron types</article-title>. <source>Nature communications</source>, <volume>9</volume>(<issue>1</issue>):<fpage>709</fpage>, <year>2018</year>.</mixed-citation></ref>
<ref id="c24"><label>[24]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Emerson F</given-names> <surname>Harkin</surname></string-name>, <string-name><given-names>Michael B</given-names> <surname>Lynn</surname></string-name>, <string-name><given-names>Alexandre</given-names> <surname>Payeur</surname></string-name>, <string-name><given-names>Jean-François</given-names> <surname>Boucher</surname></string-name>, <string-name><given-names>Léa</given-names> <surname>Caya-Bissonnette</surname></string-name>, <string-name><given-names>Dominic</given-names> <surname>Cyr</surname></string-name>, <string-name><given-names>Chloe</given-names> <surname>Stewart AndréLongtin</surname></string-name>,, <string-name><given-names>Richard</given-names> <surname>Naud</surname></string-name>, and <string-name><given-names>Jean-Claude</given-names> <surname>Béïque</surname></string-name></person-group>. <article-title>Temporal derivative computation in the dorsal raphe network revealed by an experimentally-driven augmented integrate-andfire modeling framework</article-title>. <source>eLife</source>, <volume>12</volume>:<elocation-id>e72951</elocation-id>, <year>2023</year>. <pub-id pub-id-type="doi">10.7554/eLife.72951</pub-id></mixed-citation></ref>
<ref id="c25"><label>[25]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Wilson</given-names> <surname>Truccolo</surname></string-name>, <string-name><given-names>Leigh R</given-names> <surname>Hochberg</surname></string-name>, and <string-name><given-names>John P</given-names> <surname>Donoghue</surname></string-name></person-group>. <article-title>Collective dynamics in human and monkey sensorimotor cortex: predicting single neuron spikes</article-title>. <source>Nature Neuroscience</source>, <volume>13</volume>(<issue>1</issue>):<fpage>105</fpage>–<lpage>111</lpage>, <month>Jun</month> <year>2010</year>.</mixed-citation></ref>
<ref id="c26"><label>[26]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Rick L</given-names> <surname>Jenison</surname></string-name>, <string-name><given-names>Antonio</given-names> <surname>Rangel</surname></string-name>, <string-name><given-names>Hiroyuki</given-names> <surname>Oya</surname></string-name>, <string-name><given-names>Hiroto</given-names> <surname>Kawasaki</surname></string-name>, and <string-name><given-names>Matthew A</given-names> <surname>Howard</surname></string-name></person-group>. <article-title>Value encoding in single neurons in the human amygdala during decision making</article-title>. <source>Journal of Neuroscience</source>, <volume>31</volume>(<issue>1</issue>):<fpage>331</fpage>–<lpage>338</lpage>, <year>2011</year>.</mixed-citation></ref>
<ref id="c27"><label>[27]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Vernon</given-names> <surname>Lawhern</surname></string-name>, <string-name><given-names>Wei</given-names> <surname>Wu</surname></string-name>, <string-name><given-names>Nicholas</given-names> <surname>Hatsopoulos</surname></string-name>, and <string-name><given-names>Liam</given-names> <surname>Paninski</surname></string-name></person-group>. <article-title>Population decoding of motor cortical activity using a generalized linear model with hidden states</article-title>. <source>Journal of neuroscience methods</source>, <volume>189</volume>(<issue>2</issue>):<fpage>267</fpage>– <lpage>280</lpage>, <year>2010</year>.</mixed-citation></ref>
<ref id="c28"><label>[28]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Antoine D</given-names> <surname>Madar</surname></string-name>, <string-name><given-names>Anqi</given-names> <surname>Jiang</surname></string-name>, <string-name><given-names>Can</given-names> <surname>Dong</surname></string-name>, and <string-name><given-names>Mark EJ</given-names> <surname>Sheffield</surname></string-name></person-group>. <article-title>Synaptic plasticity rules driving representational shifting in the hippocampus</article-title>. <source>Nature neuroscience</source>, <volume>28</volume> <fpage>848</fpage>–<lpage>860</lpage>, <year>2025</year>.</mixed-citation></ref>
<ref id="c29"><label>[29]</label><mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><given-names>R</given-names> <surname>Naud</surname></string-name> and <string-name><given-names>W</given-names> <surname>Gerstner</surname></string-name></person-group>. <chapter-title>The Performance (and limits) of Simple Neuron Models: Generalizations of the Leaky Integrate-and-Fire Model</chapter-title> <person-group person-group-type="editor"><string-name><given-names>N</given-names> <surname>Le Novère</surname></string-name></person-group> <source>Computational Systems Neurobiology</source>. <publisher-name>Springer</publisher-name>, <fpage>163</fpage>–<lpage>192</lpage> <year>2012</year>.</mixed-citation></ref>
<ref id="c30"><label>[30]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Renaud</given-names> <surname>Jolivet</surname></string-name>, <string-name><given-names>R</given-names> <surname>Kobayashi</surname></string-name>, <string-name><given-names>A</given-names> <surname>Rauch</surname></string-name>, <string-name><given-names>R</given-names> <surname>Naud</surname></string-name>, <string-name><given-names>S</given-names> <surname>Shinomoto</surname></string-name>, and <string-name><given-names>Wulfram</given-names> <surname>Gerstner</surname></string-name></person-group>. <article-title>A benchmark test for a quantitative assessment of simple neuron models</article-title>. <source>Journal of Neuroscience Methods</source>, <volume>169</volume>:<fpage>417</fpage>–<lpage>424</lpage>, <year>2008</year>.</mixed-citation></ref>
<ref id="c31"><label>[31]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Renaud</given-names> <surname>Jolivet</surname></string-name>, <string-name><given-names>F</given-names> <surname>Schürmann</surname></string-name>, <string-name><given-names>TK</given-names> <surname>Berger</surname></string-name>, <string-name><given-names>R</given-names> <surname>Naud</surname></string-name>, <string-name><given-names>W</given-names> <surname>Gerstner</surname></string-name>, and <string-name><given-names>A</given-names> <surname>Roth</surname></string-name></person-group>. <article-title>The quantitative singleneuron modeling competition</article-title>. <source>Biological Cybernetics</source>, <volume>99</volume>(<issue>4</issue>):<fpage>417</fpage>–<lpage>426</lpage>, <year>2008</year>.</mixed-citation></ref>
<ref id="c32"><label>[32]</label><mixed-citation publication-type="preprint"><person-group person-group-type="author"><string-name><given-names>Valerio</given-names> <surname>Francioni</surname></string-name>, <string-name><given-names>Vincent D</given-names> <surname>Tang</surname></string-name>, <string-name><given-names>Enrique HS</given-names> <surname>Toloza</surname></string-name>, <string-name><given-names>Norma J</given-names> <surname>Brown</surname></string-name>, and <string-name><given-names>Mark T</given-names> <surname>Harnett</surname></string-name></person-group>. <article-title>Vectorized instructive signals in cortical dendrites during a braincomputer interface task</article-title>. <source>bioRxiv</source>, <year>2023</year>. <pub-id pub-id-type="doi">10.1101/2023.11.03.565534</pub-id></mixed-citation></ref>
<ref id="c33"><label>[33]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>John P</given-names> <surname>Cunningham</surname></string-name> and <string-name><given-names>Byron M</given-names> <surname>Yu</surname></string-name></person-group>. <article-title>Dimensionality reduction for large-scale neural recordings</article-title>. <source>Nature neuroscience</source>, <volume>17</volume>(<issue>11</issue>):<fpage>1500</fpage>–<lpage>1509</lpage>, <year>2014</year>.</mixed-citation></ref>
<ref id="c34"><label>[34]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>João D</given-names> <surname>Semedo</surname></string-name>, <string-name><given-names>Amin</given-names> <surname>Zandvakili</surname></string-name>, <string-name><given-names>Christian K</given-names> <surname>Machens</surname></string-name>, M <string-name><given-names>Yu</given-names> <surname>Byron</surname></string-name>, and <string-name><given-names>Adam</given-names> <surname>Kohn</surname></string-name></person-group>. <article-title>Cortical areas interact through a communication subspace</article-title>. <source>Neuron</source>, <volume>102</volume>(<issue>1</issue>):<fpage>249</fpage>–<lpage>259</lpage>, <year>2019</year>.</mixed-citation></ref>
<ref id="c35"><label>[35]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Richard</given-names> <surname>Naud</surname></string-name> and <string-name><given-names>Henning</given-names> <surname>Sprekeler</surname></string-name></person-group>. <article-title>Sparse bursts optimize information transmission in a multiplexed neural code</article-title>. <source>Proc. Nat. Acad. Sci</source>, <year>2018</year>. <volume>115</volume>:<fpage>E6329</fpage>–<lpage>E6338</lpage>. doi: <pub-id pub-id-type="doi">10.1073/pnas.1720995115</pub-id>.</mixed-citation></ref>
<ref id="c36"><label>[36]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Daniel LK</given-names> <surname>Yamins</surname></string-name>, <string-name><given-names>Ha</given-names> <surname>Hong</surname></string-name>, <string-name><given-names>Charles F</given-names> <surname>Cadieu</surname></string-name>, <string-name><given-names>Ethan A</given-names> <surname>Solomon</surname></string-name>, <string-name><given-names>Darren</given-names> <surname>Seibert</surname></string-name>, and <string-name><given-names>James J</given-names> <surname>DiCarlo</surname></string-name></person-group>. <article-title>Performance-optimized hierarchical models predict neural responses in higher visual cortex</article-title>. <source>Proceedings of the National Academy of Sciences</source>, <volume>111</volume> (<issue>23</issue>):<fpage>8619</fpage>–<lpage>8624</lpage>, <year>2014</year>.</mixed-citation></ref>
<ref id="c37"><label>[37]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Pouya</given-names> <surname>Bashivan</surname></string-name>, <string-name><given-names>Kohitij</given-names> <surname>Kar</surname></string-name>, and <string-name><given-names>James J</given-names> <surname>DiCarlo</surname></string-name></person-group>. <article-title>Neural population control via deep image synthesis</article-title>. <source>Science</source>, <volume>364</volume>(<issue>6439</issue>):<fpage>eaav9436</fpage>, <year>2019</year>.</mixed-citation></ref>
<ref id="c38"><label>[38]</label><mixed-citation publication-type="preprint"><person-group person-group-type="author"><string-name><given-names>Martin</given-names> <surname>Schrimpf</surname></string-name>, <string-name><given-names>Jonas</given-names> <surname>Kubilius</surname></string-name>, <string-name><given-names>Ha</given-names> <surname>Hong</surname></string-name>, <string-name><given-names>Najib J</given-names> <surname>Majaj</surname></string-name>, <string-name><given-names>Rishi</given-names> <surname>Rajalingham</surname></string-name>, <string-name><given-names>Elias B</given-names> <surname>Issa</surname></string-name>, <string-name><given-names>Kohitij</given-names> <surname>Kar</surname></string-name>, <string-name><given-names>Pouya</given-names> <surname>Bashivan</surname></string-name>, <string-name><given-names>Jonathan</given-names> <surname>Prescott-Roy</surname></string-name>, <string-name><given-names>Franziska</given-names> <surname>Geiger</surname></string-name>, <etal>et al.</etal></person-group> <article-title>Brain-score: Which artificial neural network for object recognition is most brain-like?</article-title> <source>BioRxiv</source>, page <fpage>407007</fpage>, <year>2018</year>.</mixed-citation></ref>
<ref id="c39"><label>[39]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Grace W</given-names> <surname>Lindsay</surname></string-name></person-group>. <article-title>Convolutional neural networks as a model of the visual system: Past, present, and future</article-title>. <source>Journal of cognitive neuroscience</source>, <volume>33</volume>(<issue>10</issue>):<fpage>2017</fpage>–<lpage>2031</lpage>, <year>2021</year>.</mixed-citation></ref>
<ref id="c40"><label>[40]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Yara</given-names> <surname>Otor</surname></string-name>, <string-name><given-names>Shay</given-names> <surname>Achvat</surname></string-name>, <string-name><given-names>Nathan</given-names> <surname>Cermak</surname></string-name>, <string-name><given-names>Hadas</given-names> <surname>Benisty</surname></string-name>, <string-name><given-names>Maisan</given-names> <surname>Abboud</surname></string-name>, <string-name><given-names>Omri</given-names> <surname>Barak</surname></string-name>, <string-name><given-names>Yitzhak</given-names> <surname>Schiller</surname></string-name>, <string-name><given-names>Alon</given-names> <surname>Poleg-Polsky</surname></string-name>, and <string-name><given-names>Jackie</given-names> <surname>Schiller</surname></string-name></person-group>. <article-title>Dynamic compartmental computations in tuft dendrites of layer 5 neurons during motor behavior</article-title>. <source>Science</source>, <volume>376</volume>(<issue>6590</issue>):<fpage>267</fpage>–<lpage>275</lpage>, <year>2022</year>.</mixed-citation></ref>
<ref id="c41"><label>[41]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Alexandre</given-names> <surname>Payeur</surname></string-name>, Jean-Claude Béïque, and <string-name><given-names>Richard</given-names> <surname>Naud</surname></string-name></person-group>. <article-title>Classes of dendritic information processing</article-title>. <source>Current opinion in neurobiology</source>, <volume>58</volume>:<fpage>78</fpage>–<lpage>85</lpage>, <year>2019</year>.</mixed-citation></ref>
<ref id="c42"><label>[42]</label><mixed-citation publication-type="preprint"><person-group person-group-type="author"><string-name><given-names>Yuan</given-names> <surname>Zhang</surname></string-name>, <string-name><given-names>Yanhe</given-names> <surname>Liu</surname></string-name>, <string-name><given-names>Yachuang</given-names> <surname>Hu</surname></string-name>, <string-name><given-names>Zhenkun</given-names> <surname>Zhang</surname></string-name>, <string-name><given-names>Jie</given-names> <surname>Du</surname></string-name>, <string-name><given-names>Lele</given-names> <surname>Cui</surname></string-name>, <string-name><given-names>Qi</given-names> <surname>Liu</surname></string-name>, <string-name><given-names>Lin</given-names> <surname>Zhong</surname></string-name>, <string-name><given-names>Yu</given-names> <surname>Xin</surname></string-name>, <string-name><given-names>Ruiming</given-names> <surname>Chai</surname></string-name>, <etal>et al.</etal></person-group> <article-title>Dendritic computation for rule-based flexible categorization</article-title>. <source>bioRxiv</source>, <year>2025</year>. <pub-id pub-id-type="doi">10.1101/2025.06.03.657766</pub-id></mixed-citation></ref>
<ref id="c43"><label>[43]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Zachary</given-names> <surname>Friedenberger</surname></string-name>, <string-name><given-names>Emerson</given-names> <surname>Harkin</surname></string-name>, <string-name><given-names>Katalin</given-names> <surname>Tóth</surname></string-name>, and <string-name><given-names>Richard</given-names> <surname>Naud</surname></string-name></person-group>. <article-title>Silences, spikes and bursts: Threepart knot of the neural code</article-title>. <source>The Journal of Physiology</source>, <volume>601</volume>(<issue>23</issue>):<fpage>5165</fpage>–<lpage>5193</lpage>, <year>2023</year>.</mixed-citation></ref>
<ref id="c44"><label>[44]</label><mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><given-names>Wulfram</given-names> <surname>Gerstner</surname></string-name>, <string-name><given-names>Werner</given-names> <surname>Kistler</surname></string-name>, <string-name><given-names>Richard</given-names> <surname>Naud</surname></string-name>, and <string-name><given-names>Liam</given-names> <surname>Paninski</surname></string-name></person-group>. <source>Neuronal Dynamics</source>. <publisher-name>Cambridge University Press</publisher-name>, <publisher-loc>Cambridge</publisher-loc>, <year>2014</year>.</mixed-citation></ref>
<ref id="c45"><label>[45]</label><mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><given-names>George E.P.</given-names> <surname>Box</surname></string-name>, <string-name><given-names>Gwilym M.</given-names> <surname>Jenkins</surname></string-name>, and <string-name><given-names>Gregory C.</given-names> <surname>Reinsel</surname></string-name></person-group>. <chapter-title>Autocorrelation function and spectrum of stationary processes</chapter-title> <source>Time Series Analysis: Forecasting and Control</source>. <publisher-name>Wiley</publisher-name>, <year>2008</year>.</mixed-citation></ref>
<ref id="c46"><label>[46]</label><mixed-citation publication-type="preprint"><person-group person-group-type="author"><string-name><given-names>M.J.</given-names> <surname>Betancourt</surname></string-name> and <string-name><given-names>M.</given-names> <surname>Girolami</surname></string-name></person-group>. <article-title>Hamiltonian monte carlo for hierarchical models</article-title>. <source>arxiv</source>, <year>2013</year>.</mixed-citation></ref>
<ref id="c47"><label>[47]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Larry V</given-names> <surname>Hedges</surname></string-name></person-group>. <article-title>Estimation of effect size under nonrandom sampling: The effects of censoring studies yielding statistically insignificant mean differences</article-title>. <source>Journal of Educational Statistics</source>, <volume>9</volume>(<issue>1</issue>):<fpage>61</fpage>–<lpage>85</lpage>, <year>1984</year>.</mixed-citation></ref>
<ref id="c48"><label>[48]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Anton</given-names> <surname>Kühberger</surname></string-name>, <string-name><given-names>Astrid</given-names> <surname>Fritz</surname></string-name>, <string-name><given-names>Eva</given-names> <surname>Lermer</surname></string-name>, and <string-name><given-names>Thomas</given-names> <surname>Scherndl</surname></string-name></person-group>. <article-title>The significance fallacy in inferential statistics</article-title>. <source>BMC Research Notes</source>, <volume>8</volume>(<issue>1</issue>):<fpage>84</fpage>, <month>March</month> <year>2015</year>. ISSN 1756-0500. doi: <pub-id pub-id-type="doi">10.1186/s13104-015-1020-4</pub-id>.</mixed-citation></ref>
<ref id="c49"><label>[49]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ben van Calster</surname>, <given-names>Ewout W. Steyerberg</given-names></string-name>, <string-name><given-names>Gary S.</given-names> <surname>Collins</surname></string-name>, and <string-name><given-names>Tim</given-names> <surname>Smits</surname></string-name></person-group>. <article-title>Consequences of relying on statistical significance: Some illustrations</article-title>. <source>European Journal of Clinical Investigation</source>, <volume>48</volume>(<issue>5</issue>):<fpage>e12912</fpage>, <year>2018</year>. ISSN 1365-2362. doi: <pub-id pub-id-type="doi">10.1111/eci.12912</pub-id>.</mixed-citation></ref>
<ref id="c50"><label>[50]</label><mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><given-names>A.</given-names> <surname>Gelman</surname></string-name>, <string-name><given-names>J.B.</given-names> <surname>Carlin</surname></string-name>, <string-name><given-names>H.S.</given-names> <surname>Stern</surname></string-name>, <string-name><given-names>D.B.</given-names> <surname>Dunson</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Vehtari</surname></string-name>, and <string-name><given-names>D.B.</given-names> <surname>Rubin</surname></string-name></person-group>. <chapter-title>Finite mixture models</chapter-title> <source>Bayesian Data Analysis</source>, <publisher-name>O'Reilly</publisher-name> <year>2021</year>.</mixed-citation></ref>
</ref-list>
</back>
<sub-article id="sa0" article-type="editor-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.108775.1.sa3</article-id>
<title-group>
<article-title>eLife Assessment</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<name>
<surname>Nelson</surname>
<given-names>Sacha B</given-names>
</name>
<role specific-use="editor">Reviewing Editor</role>
<aff>
<institution-wrap>
<institution-id institution-id-type="ror">https://ror.org/05abbep66</institution-id><institution>Brandeis University</institution>
</institution-wrap>
<city>Waltham</city>
<country>United States of America</country>
</aff>
</contrib>
</contrib-group>
<kwd-group kwd-group-type="evidence-strength">
<kwd>Incomplete</kwd>
</kwd-group>
<kwd-group kwd-group-type="claim-importance">
<kwd>Valuable</kwd>
</kwd-group>
</front-stub>
<body>
<p>The authors used a Bayesian modeling framework to fit behavior and serotonin neuron activity to reward history across multiple timescales. A key goal was to distinguish value coding from other influences, particularly thirst, by comparing model fits across neurons. Although the question and approach are <bold>valuable</bold>, several limitations of the current manuscript mean that support for the conclusions is <bold>incomplete</bold>.</p>
</body>
</sub-article>
<sub-article id="sa1" article-type="referee-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.108775.1.sa2</article-id>
<title-group>
<article-title>Reviewer #1 (Public review):</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<anonymous/>
<role specific-use="referee">Reviewer</role>
</contrib>
</contrib-group>
</front-stub>
<body>
<p>Summary:</p>
<p>The authors aimed to determine whether individual serotonin neurons encode a slowly evolving estimate of environmental value during a dynamic Pavlovian conditioning task. They used a Bayesian modeling framework to fit neural activity and behavior to reward history across multiple timescales. A key goal was to distinguish value coding from other influences, particularly thirst, by comparing model fits across neurons. Ultimately, they sought to quantify the prevalence and properties of value coding in single serotonin neurons and assess its relationship to behavior.</p>
<p>Strengths:</p>
<p>The authors employ a Bayesian modeling framework that allows for nuanced hypothesis testing on long timescales of reward history. This approach is well-suited to the complexity of single-neuron data, where noise and variability can obscure meaningful patterns. By fitting generative models to both neural activity and behavior, the authors move beyond descriptive statistics to infer latent variables such as value and thirst, and quantify their contributions to firing rate.</p>
<p>The use of hierarchical Bayesian models enables partial pooling across neurons and sessions, improving parameter estimation while accounting for individual variability. The mixture modeling strategy further strengthens the analysis by explicitly testing whether neurons encode value, thirst, or neither - rather than assuming a single coding scheme. This avoids overfitting and provides a principled way to assess the prevalence and properties of value coding in the serotonergic population.</p>
<p>The authors also validate their modeling choices through cross-validation and comparisons with null and trend models, demonstrating that their value model explains neural activity better than simpler alternatives. This lends credibility to their claim that serotonin neurons encode slowly evolving estimates of value.</p>
<p>Weaknesses:</p>
<p>The authors' decision to analyze neural activity during the ITI is methodologically sound in terms of maximizing spike counts and improving statistical power for single-unit modeling. Their generative model performs best when applied to ITI firing, and the longer duration and higher spike density of this period make it well-suited for capturing slow dynamics in serotonergic neurons.</p>
<p>However, this strength simultaneously introduces a conceptual limitation. The behavioral readout-anticipatory licking-occurs during the cue periods, not the ITI. This creates a temporal disconnect between the neural and behavioral data streams. While the authors cite theoretical work suggesting that ITI value scales with trace period value, this assumption is not directly validated in the current dataset. As a result, it remains unclear whether ITI firing reflects behaviorally relevant value signals or merely captures slow fluctuations unrelated to immediate behavioral output. For example, after all of the analyses performed, the final results section point reads: &quot;Taken together, anticipatory licking is explained partially by value integration occurring at a faster time scale than seen in serotonergic cells and partially by value integration happening at a timescale that matches the serotonergic cells, but the part of the behaviour matching the timescale seen in serotonergic cells is better explained by a model of thirst than a model of value.&quot; This appears to negate much of the work of the prior analyses.</p>
<p>The manuscript lacks sufficient population-level illustrations of behavior. Figure 1 presents a single-session example, which does not allow the reader to assess consistency across mice or neurons. Figure 2 improves on this by showing individual traces and means, but the data are already processed and smoothed, obscuring raw behavioral variability.</p>
<p>Additionally, key behavioral metrics are not clearly defined. For instance, the calculation of &quot;reward collection probability&quot; is ambiguous. It is unclear whether this refers to licking during the cue, the outcome window, or some other period. The relationship between reward collection probability and anticipatory licking is also not explicitly described, making it difficult to interpret how these behavioral measures relate to the modeled value signals. The reader is also not shown what licking looks like during the ITI - the precise period the authors analyse and focus on.</p>
<p>Thirst plays a central role in the manuscript, both as a behavioral driver and as a confounding variable in interpreting serotonergic activity. However, the method used to quantify thirst, a linear decrease from an initial value following each drinking event, is overly simplistic and potentially misleading. This approach assumes that thirst diminishes uniformly with each reward, without accounting for the physiological complexity of hydration and satiety regulation.</p>
<p>In reality, thirst is influenced by multiple factors, including fluid balance, timing of intake, and individual variability. Modeling it as a monotonic function of reward consumption risks conflating motivational state with mere reward history. Given how prominently thirst features in the analysis and interpretation, a more nuanced or empirically validated measure would strengthen the manuscript's conclusions.</p>
<p>Minor, but I did not find Panel A of Figure S1 to be helpful to the manuscript. The panel says height, while the caption says hairline. This manuscript is not about faculty, height, or hairline.</p>
</body>
</sub-article>
<sub-article id="sa2" article-type="referee-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.108775.1.sa1</article-id>
<title-group>
<article-title>Reviewer #2 (Public review):</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<anonymous/>
<role specific-use="referee">Reviewer</role>
</contrib>
</contrib-group>
</front-stub>
<body>
<p>Summary:</p>
<p>The authors recently published a seminal work (Nature 2025), in which they proposed that the activity of serotonin neurons encodes a &quot;prospective code for value&quot; (value with low-pass filtered negative feedback, roughly resulting in rate-of-change + (compressed) value) and validated this proposal by analyzing several data sets and showing that their theory provided better fit than existing other theories. In the present work, the authors analyzed the activity of serotonin neurons and the licking behavior in reference to their theory by using the data of mice performing a dynamic Pavlovian task, in which the reward probability occasionally changed without a cue in a block-wise manner. While serotonin neuronal activity during task trials in the same data set was analyzed in their previous work, in the present work, the authors focused on the activity during inter-trial intervals and longer time-scale changes. The authors' analyses using Bayesian model fitting revealed that serotonin neurons' activities reflected reward history over long time scales (on average about 100 trials or 10~20 minutes) and the time scales for individual neurons considerably varied (30~300 trials, 5~60 minutes). Analysis of licking, on the other hand, revealed that licking frequency mainly reflected reward history over shorter time scales, and the remaining long-time-scale components could be mostly explained by (gradually decreasing) thirst.</p>
<p>Strengths:</p>
<p>(1) The results supported and further elaborated the authors' prospective value coding theory of serotonin.</p>
<p>(2) The results also raised a question about what then determines the frequency of licking behavior and how.</p>
<p>Weaknesses:</p>
<p>(1) A limitation of the current analyses is the lack of consideration of the effort cost of licking. Given that both involvement of serotonin in effort cost computation (Meyniel et al., 2016 eLife 17282) and the existence/influence of effort cost of licking (Hage et al., 2023 eLife 87238) have been suggested, it is desired to consider (most desirably, formally analyze) such an effect in the current data set. A simple way of incorporating effort cost would be to assume a small (free parameter) negative reward for every single licking (anticipatory and other) and combine these negative rewards with positive (liquid) rewards in the calculation of value. This may not drastically change the main claims of the present work, but could still provide insights into whether/how serotonin is involved in cost-benefit computation (or whether/how reward and cost are combined in the serotonin system).</p>
<p>(2) Another possibility related to effort cost is that the accumulation of effort cost of licking over a long time scale may cause fatigue. Since such a fatigue is expected to gradually increase across the entire session, potentially in a similar time course to thirst (but with a positive rather than negative slope), it may be needed to ask whether the suggested positive effect of thirst on licking (i.e., decrease of licking due to decrease of thirst) could be (partially) explained by a negative effect of fatigue (i.e., decrease of licking due to increase of fatigue).</p>
<p>(3) Are there also possibilities that the decrease of licking (partially) reflects a decrease in the degree of exploration (over the selection between licking and no-licking) and/or meta learning about the occasional sudden changes in the reward probability, such as the meta learning observed in animals engaging in a repetitive reversal learning task (Hattori et al., 2023 Nat Neurosci)?</p>
</body>
</sub-article>
<sub-article id="sa3" article-type="referee-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.108775.1.sa0</article-id>
<title-group>
<article-title>Reviewer #3 (Public review):</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<anonymous/>
<role specific-use="referee">Reviewer</role>
</contrib>
</contrib-group>
</front-stub>
<body>
<p>Summary:</p>
<p>The authors are reanalyzing previously published data to test the hypothesis that serotonin neurons encode state value. Here, the authors focus on analyzing the firing rate of serotonin neurons during the inter-trial interval, in which no cues or outcomes are delivered. The goal is to quantify and find neurons whose activity is explained by value encoding, and for those that have this property, determine what the timescale of reward integration is (e.g., a few trials, tens of trials, or the entire session) in individual neurons.</p>
<p>Strengths:</p>
<p>The major strengths are the use of a Bayesian modelling approach to extract value and thirst coding features from individual neurons, and comparison of the time course of adaptation of serotonin neurons with a behavioral output, licking in this case. I also appreciate the use of a separate dataset to establish prior distributions for baseline firing rate to be used in the modelling done here, which is an attempt to deal with the main weakness of this study:</p>
<p>Weaknesses:</p>
<p>The weakness of this study is the small number of neurons available for analysis, resulting in a small number of neurons that unequivocally are modulated by value.</p>
<p>The authors did achieve their aims, but the results show that it is hard to unequivocally separate value-coding neurons with long timescales from thirst-coding neurons, which is acknowledged by the authors.</p>
<p>While the experimental results do not allow for a strong conclusion regarding the distinction of value versus thirst coding in serotonin neurons, the methods employed and the rationale for using them are of great utility to the community and for considerations of behavioral task design and data analysis in future studies. This is a point that the authors could discuss/develop more.</p>
<p>Additional significance of the work:</p>
<p>The comparison between time courses for behavior (anticipatory licking) and serotonin activity (as well as the reference to dopamine activity's time course from a previous study) is of great significance for any researcher studying behavioral control. Mounting evidence suggests that multiple brain circuits contribute to any given action selection. Therefore, expecting a perfect alignment between the time course of neuromodulator activity and behavioral output might be unreasonable. For future studies, modelling behavioral output as a combination of policies determined by multiple brain circuits or neuromodulators might be a promising approach.</p>
</body>
</sub-article>
</article>