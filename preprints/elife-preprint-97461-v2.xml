<?xml version="1.0" ?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.3 20210610//EN"  "JATS-archivearticle1-mathml3.dtd"><article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.3" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="nlm-ta">elife</journal-id>
<journal-id journal-id-type="publisher-id">eLife</journal-id>
<journal-title-group>
<journal-title>eLife</journal-title>
</journal-title-group>
<issn publication-format="electronic" pub-type="epub">2050-084X</issn>
<publisher>
<publisher-name>eLife Sciences Publications, Ltd</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">97461</article-id>
<article-id pub-id-type="doi">10.7554/eLife.97461</article-id>
<article-id pub-id-type="doi" specific-use="version">10.7554/eLife.97461.2</article-id>
<article-version-alternatives>
<article-version article-version-type="publication-state">reviewed preprint</article-version>
<article-version article-version-type="preprint-version">1.4</article-version>
</article-version-alternatives>
<article-categories>
<subj-group subj-group-type="heading">
<subject>Evolutionary Biology</subject>
</subj-group>
</article-categories>
<title-group>
<article-title>Rafting a waterfall: Artificial selection for collective composition can succeed or fail depending on the initial and target values</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-3318-6377</contrib-id>
<name>
<surname>Lee</surname>
<given-names>Juhee</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="aff" rid="a2">2</xref>
<xref ref-type="author-notes" rid="fn1">*</xref>
</contrib>
<contrib contrib-type="author" corresp="yes">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-5693-381X</contrib-id>
<name>
<surname>Shou</surname>
<given-names>Wenying</given-names>
</name>
<xref ref-type="aff" rid="a3">3</xref>
<email>wenying.shou@gmail.com</email>
</contrib>
<contrib contrib-type="author" corresp="yes">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-3552-6275</contrib-id>
<name>
<surname>Park</surname>
<given-names>Hye Jin</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="aff" rid="a2">2</xref>
<email>hyejin.park@inha.ac.kr</email>
</contrib>
<aff id="a1"><label>1</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/01easw929</institution-id><institution>Department of Physics, Inha University</institution></institution-wrap>, <city>Incheon</city>, <country country="KR">Republic of Korea</country></aff>
<aff id="a2"><label>2</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/011hxwn54</institution-id><institution>Asia Pacific Center for Theoretical Physics</institution></institution-wrap>, <city>Pohang</city>, <country country="KR">Republic of Korea</country></aff>
<aff id="a3"><label>3</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/02jx3x895</institution-id><institution>Centre for Life’s Origins and Evolution, Department of Genetics, Evolution and Environment, University College London</institution></institution-wrap>, <city>London</city>, <country country="GB">United Kingdom</country></aff>
</contrib-group>
<contrib-group content-type="section">
<contrib contrib-type="editor">
<name>
<surname>Bitbol</surname>
<given-names>Anne-Florence</given-names>
</name>
<role>Reviewing Editor</role>
<aff>
<institution-wrap>
<institution>Ecole Polytechnique Federale de Lausanne (EPFL)</institution>
</institution-wrap>
<city>Lausanne</city>
<country>Switzerland</country>
</aff>
</contrib>
<contrib contrib-type="senior_editor">
<name>
<surname>Walczak</surname>
<given-names>Aleksandra M</given-names>
</name>
<role>Senior Editor</role>
<aff>
<institution-wrap>
<institution>CNRS</institution>
</institution-wrap>
<city>Paris</city>
<country>France</country>
</aff>
</contrib>
</contrib-group>
<author-notes>
<fn fn-type="present-address" id="fn1"><label>*</label><p>Present address: Integrated Science Lab, Umea university, Sweden</p></fn>
<fn fn-type="con"><p>Author contributions: J. Lee., W. Shou, H. J. Park designed research; J. Lee performed research; J. Lee, W. Shou, H. J. Park wrote the paper.</p></fn>
<fn fn-type="coi-statement"><p>Competing interests: No competing interests declared</p></fn>
</author-notes>
<pub-date date-type="original-publication" iso-8601-date="2024-05-29">
<day>29</day>
<month>05</month>
<year>2024</year>
</pub-date>
<pub-date date-type="update" iso-8601-date="2025-03-03">
<day>03</day>
<month>03</month>
<year>2025</year>
</pub-date>
<volume>13</volume>
<elocation-id>RP97461</elocation-id>
<history>
<date date-type="sent-for-review" iso-8601-date="2024-03-18">
<day>18</day>
<month>03</month>
<year>2024</year>
</date>
</history>
<pub-history>
<event>
<event-desc>Preprint posted</event-desc>
<date date-type="preprint" iso-8601-date="2024-01-02">
<day>02</day>
<month>01</month>
<year>2024</year>
</date>
<self-uri content-type="preprint" xlink:href="https://doi.org/10.1101/2023.03.07.531234"/>
</event>
<event>
<event-desc>Reviewed preprint v1</event-desc>
<date date-type="reviewed-preprint" iso-8601-date="2024-05-29">
<day>29</day>
<month>05</month>
<year>2024</year>
</date>
<self-uri content-type="reviewed-preprint" xlink:href="https://doi.org/10.7554/eLife.97461.1"/>
<self-uri content-type="editor-report" xlink:href="https://doi.org/10.7554/eLife.97461.1.sa3">eLife assessment</self-uri>
<self-uri content-type="referee-report" xlink:href="https://doi.org/10.7554/eLife.97461.1.sa2">Reviewer #1 (Public Review):</self-uri>
<self-uri content-type="referee-report" xlink:href="https://doi.org/10.7554/eLife.97461.1.sa1">Reviewer #2 (Public Review):</self-uri>
<self-uri content-type="referee-report" xlink:href="https://doi.org/10.7554/eLife.97461.1.sa0">Reviewer #3 (Public Review):</self-uri>
</event>
</pub-history>
<permissions>
<copyright-statement>© 2024, Lee et al</copyright-statement>
<copyright-year>2024</copyright-year>
<copyright-holder>Lee et al</copyright-holder>
<ali:free_to_read/>
<license xlink:href="https://creativecommons.org/licenses/by/4.0/">
<ali:license_ref>https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
<license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p>
</license>
</permissions>
<self-uri content-type="pdf" xlink:href="elife-preprint-97461-v2.pdf"/>
<abstract>
<p>Collectives, such as microbial communities, can perform functions beyond the capability of individual members. Enhancing these collective functions through artificial selection, however, presents significant challenges. Here, we explore the ‘rafting-a-waterfall’ phenomenon, a metaphor illustrating how the success in achieving a target population composition in microbial collectives depends on both the target characteristics and initial conditions. Specifically, collectives comprising fast-growing (F) and slow-growing (S) individuals were grown for a period of “maturation” time, and the collective with S-frequency closest to the target value is chosen to “reproduce” (inoculate) offspring collectives. Such collective selection is dictated by two opposing forces: during collective maturation, intra-collective selection acts like a waterfall, relentlessly driving the S-frequency to lower values, while during collective reproduction, inter-collective selection resembles a rafter striving to reach the target frequency. Due to this model structure, maintaining a target frequency requires the continued action of inter-collective selection. Using simulations and analytical calculations, we show that intermediate target S frequencies are the most challenging, akin to a target within the vertical drop of a waterfall, rather than above or below it. This arises because intra-collective selection is the strongest at intermediate S-frequencies, which can overpower inter-collective selection. While achieving low target S frequencies is consistently feasible, attaining high target S-frequencies requires an initially high S-frequency — much like a raft that can descend but not ascend a waterfall. The range of attainable target frequencies depends on the initial population size of the collectives: as the population size in Newborn collectives increases, the region of achievable target frequency is reduced until no frequency is achievable. In contrast, the number of collectives under selection plays a less critical role. In scenarios involving more than two populations, the evolutionary trajectory must navigate entirely away from the metaphorical ‘waterfall drop.’ Our findings illustrate that the strength of intra-collective evolution is frequency-dependent, with implications in experimental planning.</p>
</abstract>
<custom-meta-group>
<custom-meta specific-use="meta-only">
<meta-name>publishing-route</meta-name>
<meta-value>prc</meta-value>
</custom-meta>
</custom-meta-group>
</article-meta>
<notes>
<fn-group content-type="summary-of-updates">
<title>Summary of Updates:</title>
<fn fn-type="update"><p>The manuscript has been revised based on the referee report received from eLife.</p></fn>
</fn-group>
</notes>
</front>
<body>
<sec id="s1">
<title>Introduction</title>
<p>Microbial collectives can carry out functions that arise from interactions among member species. These functions, such as waste degradation [<xref ref-type="bibr" rid="c1">1</xref>, <xref ref-type="bibr" rid="c2">2</xref>], probiotics [<xref ref-type="bibr" rid="c3">3</xref>], and vitamin production [<xref ref-type="bibr" rid="c4">4</xref>], can be useful for human health and biotechnology. To improve collective functions, one can perform artificial selection (directed evolution) on collectives: Low-density “Newborn” collectives are allowed to “mature” during which cells proliferate and possibly mutate, and community function develops. “Adult” collectives with high functions are then chosen to reproduce, each seeding multiple offspring Newborns. Artificial selection of collectives have been attempted both in experiments [<xref ref-type="bibr" rid="c5">5</xref>–<xref ref-type="bibr" rid="c19">19</xref>] and in simulations [<xref ref-type="bibr" rid="c20">20</xref>–<xref ref-type="bibr" rid="c31">31</xref>], often with unimpressive outcomes.</p>
<p>One of the major challenges in selecting collectives is to ensure the inheritance of a collective function [<xref ref-type="bibr" rid="c32">32</xref>, <xref ref-type="bibr" rid="c33">33</xref>]. Inheritance from a parent collective to offspring collectives can be compromised by changes in genotype and species compositions. During maturation of a collective, genotype compositions within each species can change due to intra-collective selection favoring fast-growing individuals, while species compositions can change due to ecological interactions. Furthermore, during reproduction of a collective, genotype and species compositions of offspring can vary stochastically from those of the parent.</p>
<p>Here, we consider the selection of collectives comprising two or three populations with different growth rates, and our goal is to achieve a target composition in the Adult collective. This is a common quest: whenever a collective function depends on both populations, collective function is maximised, by definition, at an intermediate frequency (e.g. too little of either population will hamper function [<xref ref-type="bibr" rid="c23">23</xref>]). A selection cycle consists of three stages (<xref rid="fig1" ref-type="fig">Fig. 1</xref>). During collective maturation, intra-collective selection favors fast-growing individuals within a collective. At the end of maturation, inter-collective selection acts on collectives and favors those achieving the target composition. Finally during collective reproduction, offspring collectives sample stochastically from the parents, a process dominated by genetic drift.</p>
<p>We mathematically examine the selection of composition in collectives consisting of populations growing at different rates. Earlier work has demonstrated that nearly any target species composition can be achieved when selecting communities of two competing species with unequal growth rates [<xref ref-type="bibr" rid="c24">24</xref>, <xref ref-type="bibr" rid="c34">34</xref>], so long as the shared resource is depleted during collective maturation [<xref ref-type="bibr" rid="c24">24</xref>]. In this case initially, both species evolved to grow faster, and the slower-growing species was preserved due to stochastic fluctuations in species composition during collective reproduction. Eventually, both species evolved to grow sufficiently fast to deplete the shared resource during collective maturation, and evolution in competition coefficients then acted to stabilize species ratio to the target value [<xref ref-type="bibr" rid="c24">24</xref>]. Regardless, earlier studies are often limited to numerical explorations, with prohibitive costs for a full characterization of the parameter space for such nested populations (population of collectives, and populations of mutants within a collective). We made simplifying assumptions so that we can analytically examine the evolutionary tipping point between intra-collective and inter-collective selection. We show that this tipping point creates a “waterfall” effect which restricts not only which target compositions are achievable, but also the initial composition required to achieve the target. We also investigate how the range of achievable target composition is affected by the total population size in Newborns and the total number of collectives under selection. Finally, we show that the waterfall phenomenon extends to systems with more than 2 populations.</p>
<fig id="fig1" position="float" fig-type="figure">
<label>Figure 1.</label>
<caption><title>Schematic for artificial selection on collectives.</title>
<p>Each selection cycle begins with a total of <italic>g</italic> Newborn collectives, each with <italic>N</italic><sub>0</sub> total cells of slow-growing S population (light gray dots) and fast-growing F population (dark gray dots). During maturation (over time <italic>τ</italic>), S and F cells divide at rates <italic>r</italic><sub><italic>S</italic></sub> and <italic>r</italic><sub><italic>S</italic></sub> + <italic>ω</italic> (<italic>ω &gt;</italic> 0), respectively, and S mutates to F at rate <italic>µ</italic>. In the selection stage, the Adult collective with F frequency <italic>f</italic> closest to the target composition <inline-formula><inline-graphic xlink:href="531234v4_inline302.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is chosen to reproduce <italic>g</italic> Newborns for the next cycle. Newborns are sampled from the chosen Adult (yellow star) with <italic>N</italic><sub>0</sub> cells per Newborn. The selection cycle is then repeated until the F frequency reaches a steady state, which may or may not be the target composition. To denote a variable <italic>x</italic> of <italic>i</italic>-th collective in cycle <italic>k</italic> at time <italic>t</italic> (0 ≤ <italic>t</italic> ≤ <italic>τ</italic>), we use notation <inline-formula><inline-graphic xlink:href="531234v4_inline303.gif" mime-subtype="gif" mimetype="image"/></inline-formula> where <italic>x</italic> ∈ {<italic>S, F, s, f</italic>}. Note that time <italic>t</italic> = 0 is for Newborns and <italic>t</italic> = <italic>τ</italic> is for Adults.</p></caption>
<graphic xlink:href="531234v4_fig1.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
</sec>
<sec id="s2">
<title>Results and discussions</title>
<p>To enable the derivation of an analytical expression, we have made the following simplifications. First, growth is always exponential, without complications such as resource limitation, ecological interactions between the two populations, or density-dependent growth. Thus, the exponential growth equation can be used. Second, we consider only two populations (genotypes or species): the fast-growing F population with size <italic>F</italic> and the slow-growing S population with size <italic>S</italic>. We do not consider a spectrum of mutants or species, since with more than two populations, an analytical solution becomes very difficult. Finally, the single top-functioning community is chosen to reproduce, which allows us to employ the simplest version of the extreme value theory (see section below for further justification.)</p>
<p>Our goal is to select for collective composition in terms of F frequency <italic>f</italic> = <italic>F/</italic>(<italic>S</italic> + <italic>F</italic>), or equivalently, S frequency <italic>s</italic> = 1 − <italic>f</italic>. More precisely, we want collectives such that after maturation time <italic>τ, f</italic> (<italic>τ</italic>) is as close to the target value <inline-formula><inline-graphic xlink:href="531234v4_inline1.gif" mime-subtype="gif" mimetype="image"/></inline-formula> as possible (<xref rid="fig1" ref-type="fig">Fig. 1</xref>). Note that even if the target frequency has been achieved, since F frequency will always increase during maturation, inter-collective selection is required in each cycle to maintain the target frequency.</p>
<p>We will start with a complete model where S mutates to F at a nonzero mutation rate <italic>µ</italic>. We made this choice because it is more challenging to attain or maintain the target frequency when the abundance of fast-growing F is further increased via mutations. This scenario is encountered in biotechnology: an engineered pathway will slow down growth, and breaking the pathway (and thus faster growth) is much easier than the other way around. When the mutation rate is set to zero, the same model can be used to capture collectives of two species with different growth rates. We show that intermediate F frequencies or equivalently, intermediate S frequencies, are the hardest targets to achieve. We then show that similar conclusions hold when selecting for a target composition in collectives of more than two populations.</p>
<sec id="s2a">
<title>Model structure</title>
<p>A selection cycle (<xref rid="fig1" ref-type="fig">Fig. 1</xref>) starts with a total of <italic>g</italic> Newborn collectives. At the beginning of cycle <italic>k</italic> (<italic>t</italic> = 0), each Newborn collective has a fixed total cell number <inline-formula><inline-graphic xlink:href="531234v4_inline2.gif" mime-subtype="gif" mimetype="image"/></inline-formula> where <inline-formula><inline-graphic xlink:href="531234v4_inline3.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and<inline-formula><inline-graphic xlink:href="531234v4_inline4.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, denote the numbers of S and F cells in collective <italic>i</italic> (1 ≤ <italic>i</italic> ≤ <italic>g</italic>) at time <italic>t</italic> (0 ≤ <italic>t</italic> ≤ <italic>τ</italic>) of cycle <italic>k</italic>. The average F frequency among the <italic>g</italic> Newborn collectives is <italic>f</italic><sub><italic>k</italic>,0</sub>, such that the initial F cell number in each Newborn is drawn from the binomial distribution Binom <inline-formula><inline-graphic xlink:href="531234v4_inline5.gif" mime-subtype="gif" mimetype="image"/></inline-formula>.</p>
<p>Collectives are allowed to grow for time <italic>τ</italic> (‘Maturation’ in <xref rid="fig1" ref-type="fig">Fig. 1</xref>). During maturation, S and F grow at rates <italic>r</italic><sub><italic>S</italic></sub> and <italic>r</italic><sub><italic>S</italic></sub> + <italic>ω</italic> (<italic>ω &gt;</italic> 0), respectively. If maturation time <italic>τ</italic> is too small, a matured collective (“Adult”) does not have enough cells to reproduce <italic>g</italic> Newborn collectives with <italic>N</italic><sub>0</sub> cells. On the other hand, if maturation time <italic>τ</italic> is too long, fast-growing F will take over. Hence we set the maturation time <italic>τ</italic> = ln(<italic>g</italic> +1)<italic>/r</italic><sub><italic>S</italic></sub>, which guarantees sufficient cells to produce <italic>g</italic> Newborn collectives from a single Adult collective. At the end of a cycle, a single Adult with the highest function (with F frequency <italic>f</italic> closest to the target frequency <inline-formula><inline-graphic xlink:href="531234v4_inline6.gif" mime-subtype="gif" mimetype="image"/></inline-formula>) is chosen to reproduce <italic>g</italic> Newborn collectives each with <italic>N</italic><sub>0</sub> cells (‘Selection’ and ‘Reproduction’ in <xref rid="fig1" ref-type="fig">Fig. 1</xref>). Note that even though S and F do not compete for nutrients, they compete for space: because the total number of cells transferred to the next cycle is fixed, an overabundance of one population will reduce the likelihood of the other being propagated.</p>
<p>Collective function is dictated by the Adult’s F frequency <italic>f</italic>. Among all Adult collectives, the selected Adult is the one whose F frequency is closest to the target value, <inline-formula><inline-graphic xlink:href="531234v4_inline7.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. In contrast with findings from an earlier study [<xref ref-type="bibr" rid="c23">23</xref>], choosing top 1 is more effective than the less stringent “choosing top 5%”. In the earlier study, variation in the collective trait is partly due to nonheritable factors such as random fluctuations in Newborn biomass. In that context, a less stringent selection criterion proved more effective, as it helped retain collectives with favorable genotypes that might have exhibited suboptimal collective traits due to unfavorable nonheritable factors. However, since this study excludes nonheritable variations in collective traits, selecting the top 1 collective is more effective than selecting the top 5% (see <xref rid="figs11" ref-type="fig">Fig. 11</xref> in Supplementary Information).</p>
<p>The selected Adult, with F frequency denoted as <italic>f</italic> <sup>*</sup>, is then used to reproduce <italic>g</italic> offspring collectives, each with <italic>N</italic><sub>0</sub> total cells. The number of F cells in a Newborn follows a binomial distribution <italic>B</italic>(<italic>N</italic><sub>0</sub>, <italic>f</italic> <sup>*</sup>). By repeating the selection cycle, we aim to achieve and maintain the target composition <inline-formula><inline-graphic xlink:href="531234v4_inline8.gif" mime-subtype="gif" mimetype="image"/></inline-formula>.</p>
<table-wrap id="tbl1" orientation="portrait" position="float">
<label>Table I.</label>
<caption><title>Nomenclature</title></caption>
<graphic xlink:href="531234v4_tbl1.tif" mime-subtype="tiff" mimetype="image"/>
</table-wrap>
<p>Overall our model considers mutational stochasticity, as well as demographic stochasticity in terms of stochastic birth and stochastic sampling of a parent collective by offspring collectives. Other types of stochasticity, such as environmental stochasticity and measurement noise, are not considered and require future research.</p>
</sec>
<sec id="s2b">
<title>The success of collective selection is constrained by the target composition, and sometimes also by the initial composition</title>
<p>Since intra-collective selection favors F, we expect that a higher target <inline-formula><inline-graphic xlink:href="531234v4_inline9.gif" mime-subtype="gif" mimetype="image"/></inline-formula> (a lower target <italic>ŝ</italic>) is easier to achieve. By 'achieve', we mean the absolute error <italic>d</italic> between the target frequency <inline-formula><inline-graphic xlink:href="531234v4_inline10.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and the selected frequency averaged among independent simulations <italic>(f</italic> <sup>*</sup><italic>)</italic> is smaller than 0.05 (i.e.<inline-formula><inline-graphic xlink:href="531234v4_inline11.gif" mime-subtype="gif" mimetype="image"/></inline-formula>).</p>
<p>We fixed <italic>N</italic><sub>0</sub>, the total population size of a Newborn, to 1000, and obtained selection dynamics for various initial and target F frequencies by implementing stochastic simulations (Sec. I in Supplementary Information). If the target <inline-formula><inline-graphic xlink:href="531234v4_inline12.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is high (e.g. 0.9, <xref rid="fig2" ref-type="fig">Fig. 2a</xref> magenta), selection is successful (computed absolute errors in Supplementary Information <xref rid="figs4" ref-type="fig">Fig. 4</xref>): regardless of the initial frequency, <italic>f</italic> <sup>*</sup> of the chosen collective eventually converges to the target <inline-formula><inline-graphic xlink:href="531234v4_inline13.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and stays around it. In contrast, without collective-level selection (e.g. choosing a random collective to reproduce), F frequency increases until F reaches fixation (Supplementary information <xref rid="figs3" ref-type="fig">Fig. 3b</xref>).</p>
<fig id="fig2" position="float" fig-type="figure">
<label>Figure 2.</label>
<caption><title>Initial and target compositions determine the success of artificial selection on collectives.</title>
<p><bold>(a-c)</bold> F frequency of the selected Adult collective (<italic>f</italic> <sup>*</sup>) over cycles at different target <inline-formula><inline-graphic xlink:href="531234v4_inline304.gif" mime-subtype="gif" mimetype="image"/></inline-formula> values (dashed lines). <inline-formula><inline-graphic xlink:href="531234v4_inline305.gif" mime-subtype="gif" mimetype="image"/></inline-formula> between <italic>f</italic> <sup><italic>L</italic></sup> and <italic>f</italic> <sup><italic>H</italic></sup> (orange dotted and solid line segments) is inaccessible where selection will fail. <bold>a</bold> A high target F frequency (e.g. <inline-formula><inline-graphic xlink:href="531234v4_inline306.gif" mime-subtype="gif" mimetype="image"/></inline-formula>; magenta dotted line) can be achieved from any initial frequency (black dots). <bold>b</bold> An intermediate target frequency (e.g. <inline-formula><inline-graphic xlink:href="531234v4_inline307.gif" mime-subtype="gif" mimetype="image"/></inline-formula>; green dotted line) is never achievable, as all initial conditions converge to near <italic>f</italic> <sup><italic>H</italic></sup>. <bold>c</bold> A low target frequency (e.g.<inline-formula><inline-graphic xlink:href="531234v4_inline308.gif" mime-subtype="gif" mimetype="image"/></inline-formula>) is achievable, but only from initial frequencies below <italic>f</italic> <sup><italic>L</italic></sup>. For initial frequencies at <italic>f</italic> <sup><italic>L</italic></sup>, stochastic outcomes (grey curves) are observed: while some replicates reached the target frequency, others reached <italic>f</italic> <sup><italic>H</italic></sup>. For parameters, we used S growth rate <italic>r</italic><sub><italic>S</italic></sub> = 0.5, F growth advantage <italic>ω</italic> = 0.03, mutation rate <italic>µ</italic> = 0.0001, maturation time <italic>τ</italic>≈ 4.8, and <italic>N</italic><sub>0</sub> = 1000. The number of collectives <italic>g</italic> = 10. Each black line is averaged from independent 300 realizations. <bold>d</bold> Inter-collective selection opposes intra-collective selection. We plot probability density distributions of F frequency <italic>f</italic> during two consecutive cycles when selection is successful. Data correspond to cycles 31 and 32 from the second lowest initial point in <bold>c.</bold> Δ<italic>f</italic> is selection progress (see Box). Black triangle: median. <bold>e</bold> Two accessible regions (gold). Either high<inline-formula><inline-graphic xlink:href="531234v4_inline309.gif" mime-subtype="gif" mimetype="image"/></inline-formula> ; region 2) or low <inline-formula><inline-graphic xlink:href="531234v4_inline310.gif" mime-subtype="gif" mimetype="image"/></inline-formula> starting from low initial <italic>f</italic> (<inline-formula><inline-graphic xlink:href="531234v4_inline311.gif" mime-subtype="gif" mimetype="image"/></inline-formula>and <inline-formula><inline-graphic xlink:href="531234v4_inline312.gif" mime-subtype="gif" mimetype="image"/></inline-formula> ; region 1) can be achieved. We theoretically predict (by numerically integrating <xref ref-type="disp-formula" rid="eqn1">Eq. (1)</xref>) <italic>f</italic> <sup><italic>H</italic></sup> (orange solid line) and <italic>f</italic> <sup><italic>L</italic></sup> (orange dotted line), which agree with simulation results (gold regions). <bold>f</bold> Example trajectories from initial compositions (black dots) to the target compositions (dashed lines). The gold areas indicate the region of initial frequencies where the target frequency can be achieved. <bold>g</bold> The tension between intra-collective selection and inter-collective selection creates a “waterfall” phenomenon. See the main text for details.</p></caption>
<graphic xlink:href="531234v4_fig2.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
<p>In contrast, an intermediate target frequency (e.g. <inline-formula><inline-graphic xlink:href="531234v4_inline14.gif" mime-subtype="gif" mimetype="image"/></inline-formula> ; <xref rid="fig2" ref-type="fig">Fig. 2b green</xref>) is never achievable. High initial F frequencies (e.g. 0.6 and 0.95) decline toward the target, but stabilize at the “higher-threshold” <italic>f</italic> <sup><italic>H</italic></sup> (∼ 0.7, solid orange line segment in <xref rid="fig2" ref-type="fig">Fig. 2a-c</xref>) above the target. Low initial F frequencies (e.g. 0) increase toward the target, but then overshoot and stabilize at the <italic>f</italic> <sup><italic>H</italic></sup> value.</p>
<p>If the target frequency is low (e.g.<inline-formula><inline-graphic xlink:href="531234v4_inline15.gif" mime-subtype="gif" mimetype="image"/></inline-formula>; <xref rid="fig2" ref-type="fig">Fig. 2c</xref> dark blue), artificial selection succeeds when the initial frequency is below the “lower-threshold” <italic>f</italic> <sup><italic>L</italic></sup> (dotted orange line segment in <xref rid="fig2" ref-type="fig">Fig. 2a-c</xref>). Initial F frequencies above <italic>f</italic> <sup><italic>L</italic></sup> (e.g. 0.45 and 0.95) converge to <italic>f</italic> <sup><italic>H</italic></sup> instead. Initial F frequencies near <italic>f</italic> <sup><italic>L</italic></sup> display stochastic trajectories, converging to either <italic>f</italic> <sup><italic>H</italic></sup> or <italic>f</italic> <sup><italic>L</italic></sup>.</p>
<p>To achieve target <inline-formula><inline-graphic xlink:href="531234v4_inline16.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, inter-collective selection must overcome intra-collective selection. We can visualize the distributions of <italic>f</italic> over two consecutive cycles (bottom to top, <xref rid="fig2" ref-type="fig">Fig. 2d</xref>) where <italic>f</italic> started above target <inline-formula><inline-graphic xlink:href="531234v4_inline17.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. When Newborns matured into Adults, the distribution of <italic>f</italic> up-shifted due to intra-collective selection. The distribution of <italic>f</italic> was then down-shifted toward the target due to inter-collective selection. If the magnitude of down-shift exceeded that of up-shift, progress toward the target was made. During reproduction, the distribution of <italic>f</italic> retained the same mean but became broader due to stochastic sampling by the Newborns from their parent.</p>
<p>In summary, two regions of target frequencies are “accessible” in the sense that a target value in the region can be reached (gold in <xref rid="fig2" ref-type="fig">Fig. 2e, f</xref>): (1) target frequencies above <inline-formula><inline-graphic xlink:href="531234v4_inline18.gif" mime-subtype="gif" mimetype="image"/></inline-formula> or (2) target frequencies below <inline-formula><inline-graphic xlink:href="531234v4_inline19.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and starting at an average frequency below <inline-formula><inline-graphic xlink:href="531234v4_inline20.gif" mime-subtype="gif" mimetype="image"/></inline-formula>.</p>
</sec>
<sec id="s2c">
<title>Intra-collective evolution is the fastest at intermediate F frequencies, creating the “waterfall” phenomenon</title>
<p>To understand what gives rise to the two accessible regions, we calculated Δ<italic>f</italic>, the selection progress in F frequency over two consecutive cycles (<xref ref-type="boxed-text" rid="box1">Box 1</xref>, <xref ref-type="disp-formula" rid="eqn2">Eq. (2)</xref>). The solution (<xref rid="fig3" ref-type="fig">Fig. 3a</xref>, green) has the same shape as results from numerically integrating <xref ref-type="disp-formula" rid="eqn1">Eq. (1)</xref> (<xref rid="fig3" ref-type="fig">Fig. 3a</xref>, orange) and from stochastic simulations (<xref rid="fig3" ref-type="fig">Fig. 3a</xref>, blue).</p>
<fig id="fig3" position="float" fig-type="figure">
<label>Figure 3.</label>
<caption><title>Intra-collective selection and inter-collective selection jointly set the boundaries for selection success.</title>
<p><bold>a</bold> The change in F frequency over one cycle. When <inline-formula><inline-graphic xlink:href="531234v4_inline313.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is sufficiently low or high, inter-collective selection can lower the F frequency to below <inline-formula><inline-graphic xlink:href="531234v4_inline314.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. The points where Δ<italic>f</italic> = 0 (in the orange line) are denoted as <italic>f</italic> <sup><italic>L</italic></sup> and <italic>f</italic> <sup><italic>H</italic></sup>, corresponding to the boundaries in <xref rid="fig2" ref-type="fig">Fig. 2</xref>. <bold>b</bold> The distributions of frequency differences obtained by 1000 numerical simulations. The cyan, purple, and black box plots respectively indicate the changes in F frequency after intra-collective selection (the mean frequency among the 100 Adults minus the mean frequency among the 100 Newborns during maturation), after inter-collective selection (the frequency of the 1 selected Adult minus the mean frequency among the 100 Adults), and over one selection cycle (the frequency of the selected Adult of one cycle minus that of the previous cycle). The box ranges from 25% to 75% of the distribution, and the median is indicated by a line across the box. The upper and lower whiskers indicate maximum and minimum values of the distribution. ***: <italic>P &lt;</italic> 0.001 in an unpaired <italic>t</italic>-test.</p></caption>
<graphic xlink:href="531234v4_fig3.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
<p>If Δ<italic>f</italic> is negative, then inter-collective selection will succeed in countering intra-collective selection and reducing <italic>f</italic> toward the target. Δ<italic>f</italic> is negative if the selected <inline-formula><inline-graphic xlink:href="531234v4_inline21.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is low or high, but not if it is intermediate between <italic>f</italic> <sup><italic>L</italic></sup> and <italic>f</italic> <sup><italic>H</italic></sup> (<xref rid="fig3" ref-type="fig">Fig. 3a</xref>). This is because <italic>f</italic> increase during maturation is the most drastic when Newborn <italic>f</italic> is intermediate (<xref rid="fig3" ref-type="fig">Fig. 3b</xref>), for intuitive reasons: when Newborn <italic>f</italic> is low, the increase in <italic>f</italic> will be minor; when Newborn <italic>f</italic> is high, the fitness advantage of F over the population average is small and hence the increase is also minor. Thus, when Newborn F frequency is intermediate, intra-collective selection is the strongest and may overwhelm inter-collective selection (<xref rid="fig3" ref-type="fig">Fig. 3b</xref> and <xref rid="figs6" ref-type="fig">Fig. 6a</xref> in Supplementary Information). Not surprisingly, similar conclusions are derived where S and F are slow-growing and fast-growing species which cannot be converted through mutations (Sec. IV and <xref rid="figs8" ref-type="fig">Fig. 8</xref> in Supplementary Information).</p>
<p>Thus, inter-collective selection is akin to a raftman rowing the raft to a target, while intra-collective selection is akin to a waterfall. This metaphor is best understood in terms of S frequency <italic>s</italic> = 1 − <italic>f</italic>. The lower-threshold <italic>f</italic> <sup><italic>L</italic></sup> corresponds to higher-threshold in <italic>s</italic><sup><italic>H</italic></sup> = 1 − <italic>f</italic> <sup><italic>L</italic></sup>, while higher-threshold <italic>f</italic> <sup><italic>H</italic></sup> corresponds to lower-threshold in <italic>s</italic><sup><italic>L</italic></sup> = 1 − <italic>f</italic> <sup><italic>H</italic></sup>. Intra-collective selection is akin to a waterfall, driving the S frequency <italic>s</italic> from high to low (<xref rid="fig2" ref-type="fig">Fig. 2g</xref>). Intra-collective selection acts the strongest when <italic>s</italic> is intermediate (<italic>s</italic><sup><italic>L</italic></sup> <italic>&lt; s &lt;</italic> s<sup><italic>H</italic></sup>), similar to the vertical drop of the fall. Intra-collective selection acts weakly at high (<italic>&gt; s</italic><sup><italic>H</italic></sup>) or low (<italic>&lt; s</italic><sup><italic>L</italic></sup>) <italic>s</italic>, similar to the gentle sloped upper and lower pools of the fall (regions 1 and 2 of <xref rid="fig2" ref-type="fig">Fig. 2e, g</xref>). Thus, an intermediate target frequency can be impossible to achieve − a raft starting from the upper pool will be flushed down to <italic>s</italic><sup><italic>L</italic></sup> (<italic>f</italic> <sup><italic>H</italic></sup>), while a raft starting from the lower pool cannot go beyond <italic>s</italic><sup><italic>L</italic></sup> (<italic>f</italic> <sup><italic>H</italic></sup>). In contrast, a low target S frequency (in the lower pool) is always achievable. Finally, a high target S frequency (in the upper pool) can only be achieved if starting from the upper pool (as the raft can not jump to the upper pool if starting from below).</p>
<boxed-text id="box1">
<label>Box 1:</label>
<p>Changes in the distribution of F frequency <italic>f</italic> after one cycle</p>
<p>We consider the case where <inline-formula><inline-graphic xlink:href="531234v4_inline22.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, the F frequency of the selected Adult at cycle <italic>k</italic>, is above the target value <inline-formula><inline-graphic xlink:href="531234v4_inline23.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. This case is particularly challenging because intra-collective evolution favors fast-growing F and thus will further increase <italic>f</italic> away from the target. From <inline-formula><inline-graphic xlink:href="531234v4_inline24.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, Newborns of cycle <italic>k</italic> + 1 will have <italic>f</italic> fluctuating around <inline-formula><inline-graphic xlink:href="531234v4_inline25.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, and after they mature, the minimum <italic>f</italic> is selected <inline-formula><inline-graphic xlink:href="531234v4_inline26.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. If the selected composition at cycle <italic>k</italic> + 1 can be reduced compared to that of cycle <italic>k</italic> (i.e. <inline-formula><inline-graphic xlink:href="531234v4_inline27.gif" mime-subtype="gif" mimetype="image"/></inline-formula>), the system can evolve to the lower target value.</p>
<p>To find <inline-formula><inline-graphic xlink:href="531234v4_inline28.gif" mime-subtype="gif" mimetype="image"/></inline-formula> values such that <inline-formula><inline-graphic xlink:href="531234v4_inline29.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, we used the median value of the conditional probability distribution Ψ of <inline-formula><inline-graphic xlink:href="531234v4_inline30.gif" mime-subtype="gif" mimetype="image"/></inline-formula> (the F frequency of the selected Adult at cycle <italic>k</italic> + 1 being <italic>f</italic>) given the selected <inline-formula><inline-graphic xlink:href="531234v4_inline31.gif" mime-subtype="gif" mimetype="image"/></inline-formula> at cycle <italic>k</italic> (mathematical details in Sec. II in Supplementary Information). If the median value (Median<inline-formula><inline-graphic xlink:href="531234v4_inline32.gif" mime-subtype="gif" mimetype="image"/></inline-formula>) is smaller than <inline-formula><inline-graphic xlink:href="531234v4_inline33.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, then selection will likely be successful since the selected Adult in cycle <italic>k</italic> + 1 has more than 50% chance to have a reduced F frequency compared to cycle <italic>k</italic>.</p>
<p>There are two points where the median values are the same as <inline-formula><inline-graphic xlink:href="531234v4_inline34.gif" mime-subtype="gif" mimetype="image"/></inline-formula> (<xref rid="fig3" ref-type="fig">Fig. 3a</xref>), which are assigned as lower-threshold (<italic>f</italic> <sup><italic>L</italic></sup>) and higher-threshold (<italic>f</italic> <sup><italic>H</italic></sup>).</p>
<p>Following the extreme value theory, the conditional probability density function <inline-formula><inline-graphic xlink:href="531234v4_inline35.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is
<disp-formula id="eqn1">
<graphic xlink:href="531234v4_eqn1.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Equation (1) can be described as the product between two terms related to probability: (i) <inline-formula><inline-graphic xlink:href="531234v4_inline38.gif" mime-subtype="gif" mimetype="image"/></inline-formula> describes the probability density that any one of the <italic>g</italic> Adult collectives achieves <italic>f</italic> given <inline-formula><inline-graphic xlink:href="531234v4_inline39.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, and (ii) <inline-formula><inline-graphic xlink:href="531234v4_inline40.gif" mime-subtype="gif" mimetype="image"/></inline-formula> describes the probability that all other <italic>g</italic> − 1 collectives achieve frequencies above <italic>f</italic> and thus not selected.</p>
<p>Since computing the exact formula of Adults’ <italic>f</italic> distribution in cycle <italic>k</italic> + 1 is hard, we approximate it as Gaussian with mean <inline-formula><inline-graphic xlink:href="531234v4_inline41.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and variance <inline-formula><inline-graphic xlink:href="531234v4_inline42.gif" mime-subtype="gif" mimetype="image"/></inline-formula>.The Gaussian approximation on <xref ref-type="disp-formula" rid="eqn1">Eq. (1)</xref> requires sharp Gaussian distributions of <italic>S</italic>(<italic>τ</italic>) and <italic>F</italic> (<italic>τ</italic>) (i.e. <inline-formula><inline-graphic xlink:href="531234v4_inline43.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v4_inline44.gif" mime-subtype="gif" mimetype="image"/></inline-formula>). Compared to Gaussian, the exact <italic>S</italic>(<italic>τ</italic>) (negative binomial) distribution and <italic>F</italic> (<italic>τ</italic>) (Luria-Delbrück) distribution are right-skewed and heavy-tailed. However these problems are alleviated when the initial numbers of <italic>S</italic> and <italic>F</italic> cells are not small (on the order of 100). Additionally, the sharpness of distributions could be achieved (see <xref rid="figs1" ref-type="fig">Fig. 1</xref> in Supplementary Information).</p>
<p>To obtain an analytical solution of the change in <italic>f</italic> over one cycle, we first assume that in a Newborn collective, the number of S cells is distributed as Gaussian with mean <inline-formula><inline-graphic xlink:href="531234v4_inline45.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and variance <inline-formula><inline-graphic xlink:href="531234v4_inline46.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. Then, the number of F cells, <italic>F</italic><sub>0</sub> = <italic>N</italic><sub>0</sub> − <italic>S</italic><sub>0</sub>, is distributed as Gaussian with mean <inline-formula><inline-graphic xlink:href="531234v4_inline47.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and variance <inline-formula><inline-graphic xlink:href="531234v4_inline48.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. From these, we can calculate for Adult collectives the mean and variance of population sizes <italic>F</italic> (<italic>τ</italic>) (i.e. <inline-formula><inline-graphic xlink:href="531234v4_inline49.gif" mime-subtype="gif" mimetype="image"/></inline-formula>) and <italic>S</italic>(<italic>τ</italic>) (i.e.<inline-formula><inline-graphic xlink:href="531234v4_inline50.gif" mime-subtype="gif" mimetype="image"/></inline-formula>) (mathematical details in Sec. I in Supplementary Information). This task is simplified by the exponential growth of S and <inline-formula><inline-graphic xlink:href="531234v4_inline51.gif" mime-subtype="gif" mimetype="image"/></inline-formula> describes the fold-growth of S over maturation time <italic>τ</italic>, and since <italic>ω</italic> is the fitness advantage of F over S, <italic>W</italic><sub><italic>τ</italic></sub> = <italic>e</italic><sup><italic>ωτ</italic></sup> describes the fold change of F/S over time <italic>τ</italic>. From <inline-formula><inline-graphic xlink:href="531234v4_inline52.gif" mime-subtype="gif" mimetype="image"/></inline-formula> (mutation rate scaled with the fitness difference), <inline-formula><inline-graphic xlink:href="531234v4_inline53.gif" mime-subtype="gif" mimetype="image"/></inline-formula> (F frequency in the selected collective at cycle <italic>k</italic>), <italic>N</italic><sub>0</sub> (Newborn size), <inline-formula><inline-graphic xlink:href="531234v4_inline53a.gif" mime-subtype="gif" mimetype="image"/></inline-formula> (relative fitness advantage), we can calculate the mean and variance of F frequency among the Adults of <italic>k</italic> + 1 cycle <inline-formula><inline-graphic xlink:href="531234v4_inline54.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, detailed formula in <xref ref-type="disp-formula" rid="eqn40">Eqs. (40)</xref> and <xref ref-type="disp-formula" rid="eqn41">(41)</xref> in Supplementary Information).</p>
<p>Selection progress - the difference between the median value of the conditional probability distribution <inline-formula><inline-graphic xlink:href="531234v4_inline55.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and the selected frequency of <inline-formula><inline-graphic xlink:href="531234v4_inline56.gif" mime-subtype="gif" mimetype="image"/></inline-formula> (Sec. II in Supplementary Information) - can be expressed as:
<disp-formula id="eqn2">
<graphic xlink:href="531234v4_eqn2.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where Φ<sup>−1</sup>(…) is the inverse cumulative function of standard normal distribution (see main text for an example). We chose median because compared to mean, it is easier to get analytical expression since Φ<sup>−1</sup>(…) is known in a closed form. Regardless, using median generated results similar to simulations (<xref rid="figs7" ref-type="fig">Fig. 7</xref> in Supplementary Information). As expected, selection progress Δ<italic>f</italic> is governed by both the mean <inline-formula><inline-graphic xlink:href="531234v4_inline57.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and the variation (<italic>σ</italic><sub><italic>f</italic></sub> (<italic>τ</italic>)) in <italic>f</italic> among Adults.</p>
<p>When mutation rate <inline-formula><inline-graphic xlink:href="531234v4_inline58.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <italic>σ</italic><sub><italic>f</italic></sub> (<italic>τ</italic>) can be simplified to:
<disp-formula id="eqn3">
<graphic xlink:href="531234v4_eqn3.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
and
<disp-formula id="eqn4">
<graphic xlink:href="531234v4_eqn4.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
In the limit of small <inline-formula><inline-graphic xlink:href="531234v4_inline59.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, Equation (3) becomes <inline-formula><inline-graphic xlink:href="531234v4_inline60.gif" mime-subtype="gif" mimetype="image"/></inline-formula> while Equation (4) becomes <inline-formula><inline-graphic xlink:href="531234v4_inline61.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. Thus, both Newborn size (<italic>N</italic><sub>0</sub>) and fold-change in F/S during maturation (<italic>W</italic><sub><italic>τ</italic></sub>) are important determinants of selection progress.</p>
</boxed-text>
</sec>
<sec id="s2d">
<title>Manipulating experimental setups to expand the achievable target region</title>
<p>In <xref ref-type="disp-formula" rid="eqn2">Eq. (2)</xref> (<xref ref-type="boxed-text" rid="box1">Box 1</xref>), selection progress Δ<italic>f</italic> depends on the total number of collectives under selection (<italic>g</italic>). Δ<italic>f</italic> also depends on the mean and the standard deviation of Adult F frequency <inline-formula><inline-graphic xlink:href="531234v4_inline62.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <italic>σ</italic><sub><italic>f</italic></sub> (<italic>τ</italic>). <xref ref-type="disp-formula" rid="eqn3">Eqs. (3)</xref> and <xref ref-type="disp-formula" rid="eqn4">(4)</xref> (<xref ref-type="boxed-text" rid="box1">Box 1</xref>) provide simplified expressions of <inline-formula><inline-graphic xlink:href="531234v4_inline63.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <italic>σ</italic><sub><italic>f</italic></sub> (<italic>τ</italic>) when mutation rate <italic>µ</italic> has been set to 0. When mutation rate <italic>µ</italic> is not zero (<xref ref-type="disp-formula" rid="eqn40">Eqs. (40)</xref> and <xref ref-type="disp-formula" rid="eqn41">(41)</xref> in Section II of Supplementary Information), selection progress is additionally influenced by <inline-formula><inline-graphic xlink:href="531234v4_inline63a.gif" mime-subtype="gif" mimetype="image"/></inline-formula> (mutation rate <italic>µ</italic> scaled with fitness difference <italic>ω</italic>).</p>
<p>Our goal is to make Δ<italic>f</italic> as negative as possible so that any increase in <italic>f</italic> during collective maturation may be reduced. From <xref ref-type="disp-formula" rid="eqn2">Eq. (2)</xref> (<xref ref-type="boxed-text" rid="box1">Box 1</xref>), a small <italic>f</italic> (<italic>τ</italic>) will facilitate collective-level selection. Additionally, a large <italic>σ</italic><sub><italic>f</italic></sub> (<italic>τ</italic>) will also facilitate collective-level selection due to negative <inline-formula><inline-graphic xlink:href="531234v4_inline64.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. Note that since <inline-formula><inline-graphic xlink:href="531234v4_inline65.gif" mime-subtype="gif" mimetype="image"/></inline-formula> for <inline-formula><inline-graphic xlink:href="531234v4_inline66.gif" mime-subtype="gif" mimetype="image"/></inline-formula> corresponding to the number <italic>y</italic> such that the probability of a standard normal random variable being less than or equal to <italic>y</italic> is <inline-formula><inline-graphic xlink:href="531234v4_inline67.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is negative.</p>
<p>From <xref ref-type="disp-formula" rid="eqn4">Eq. (4)</xref> (<xref ref-type="boxed-text" rid="box1">Box 1</xref>), <italic>σ</italic><sub><italic>f</italic></sub> (<italic>τ</italic>) will be large if Newborn size <italic>N</italic><sub>0</sub> is small. Indeed, as Newborn size <italic>N</italic><sub>0</sub> declines, the region of achievable target frequency expands (larger gold area in <xref rid="fig4" ref-type="fig">Fig. 4a</xref>). If the Newborn size <italic>N</italic><sub>0</sub> is sufficiently small (e.g. ≤ 700 in our parameter regime), any target frequency can be reached. An analytical approximation of the maximal Newborn size permissible for all target frequencies is given in section III in Supplementary Information.</p>
<fig id="fig4" position="float" fig-type="figure">
<label>Figure 4.</label>
<caption><title>Expanding the success region for artificial collective selection.</title>
<p><bold>a</bold> Reducing the population size in Newborn <italic>N</italic><sub>0</sub> expands the region of success. In gold area, the probability that <inline-formula><inline-graphic xlink:href="531234v4_inline315.gif" mime-subtype="gif" mimetype="image"/></inline-formula> becomes smaller than <inline-formula><inline-graphic xlink:href="531234v4_inline316.gif" mime-subtype="gif" mimetype="image"/></inline-formula> in a cycle is more than 50%. We used <italic>g</italic> = 10 and <italic>τ</italic> ≈ 4.8. <xref rid="fig2" ref-type="fig">Figures 2</xref>-<xref rid="fig3" ref-type="fig">3</xref> correspond to <italic>N</italic><sub>0</sub> = 1000. Black dotted line indicates the critical Newborn size <inline-formula><inline-graphic xlink:href="531234v4_inline317.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, below which all target frequencies can be achieved. <bold>b</bold> Increasing the total number of collectives <italic>g</italic> also expands the region of success, although only slightly. We used a fixed Newborn size <italic>N</italic><sub>0</sub> = 1000. The maturation time <italic>τ</italic> (<italic>τ</italic> = log(100)<italic>/r</italic><sub><italic>S</italic></sub>≈ 9.2) is set to be long enough so that an Adult can generate at least 100 Newborns. <bold>c</bold> Increasing the maturation time <italic>τ</italic> shrinks the region of success. We used a fixed Newborn size <italic>N</italic><sub>0</sub> = 1000 and number of collectives <italic>g</italic> = 10.</p></caption>
<graphic xlink:href="531234v4_fig4.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
<p>From <xref ref-type="disp-formula" rid="eqn3">Eqs. (3)</xref> and <xref ref-type="disp-formula" rid="eqn4">(4)</xref> (<xref ref-type="boxed-text" rid="box1">Box 1</xref>), maturation time <italic>τ</italic> affects <inline-formula><inline-graphic xlink:href="531234v4_inline68.gif" mime-subtype="gif" mimetype="image"/></inline-formula> through <inline-formula><inline-graphic xlink:href="531234v4_inline69.gif" mime-subtype="gif" mimetype="image"/></inline-formula> (the fold change in F/S over <italic>τ</italic>), and affects <inline-formula><inline-graphic xlink:href="531234v4_inline69a.gif" mime-subtype="gif" mimetype="image"/></inline-formula> additionally through <inline-formula><inline-graphic xlink:href="531234v4_inline70.gif" mime-subtype="gif" mimetype="image"/></inline-formula> (fold-growth of S over <italic>τ</italic>). Longer <italic>τ</italic> increases <inline-formula><inline-graphic xlink:href="531234v4_inline71.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and is thus detrimental to selection progress. The relationship between <italic>σ</italic><sub><italic>f</italic></sub> (<italic>τ</italic>) and <italic>τ</italic> is not monotonic (<xref rid="figs6" ref-type="fig">Fig. 6c</xref> in Supplementary Information), meaning that an intermediate value of <italic>τ</italic> is the best for achieving large <italic>σ</italic><sub><italic>f</italic></sub> (<italic>τ</italic>). However, the effect of <inline-formula><inline-graphic xlink:href="531234v4_inline72.gif" mime-subtype="gif" mimetype="image"/></inline-formula> dominates that of <italic>σ</italic><sub><italic>f</italic></sub> (<italic>τ</italic>) and therefore, the region of success monotonically reduces with longer maturation time (<xref rid="fig4" ref-type="fig">Fig. 4c</xref>). Similarly, <inline-formula><inline-graphic xlink:href="531234v4_inline73.gif" mime-subtype="gif" mimetype="image"/></inline-formula> will be small if <italic>ω</italic> (fitness advantage of F over S) is small. Indeed, as <italic>ω</italic> become larger, the region of success becomes smaller (<xref rid="figs9" ref-type="fig">Fig. 9</xref> in Supplementary Information).</p>
<p><italic>g</italic>, the number of collectives under selection, also affects selection outcomes. As <italic>g</italic> increases, the value of <inline-formula><inline-graphic xlink:href="531234v4_inline74.gif" mime-subtype="gif" mimetype="image"/></inline-formula> becomes more negative, and so does Δ<italic>f</italic> - meaning collective-level selection will be more effective. Intuitively, with more collectives, the chance of finding a <italic>f</italic> closer to the target is more likely. Thus, a larger number of collectives broadens the region of success (<xref rid="fig4" ref-type="fig">Fig. 4b</xref>). However, the effect of <italic>g</italic> is not dramatic. To see why, we note that the only place that <italic>g</italic> appears is <xref ref-type="disp-formula" rid="eqn2">Eq. (2)</xref> in <inline-formula><inline-graphic xlink:href="531234v4_inline74a.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. When <italic>g</italic> becomes large, <inline-formula><inline-graphic xlink:href="531234v4_inline75.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is asymptotically expressed as <inline-formula><inline-graphic xlink:href="531234v4_inline76.gif" mime-subtype="gif" mimetype="image"/></inline-formula> ln (Section II in Supplementary Information)[<xref ref-type="bibr" rid="c35">35</xref>], and thus does not change dramatically as <italic>g</italic> varies.</p>
</sec>
<sec id="s2e">
<title>The waterfall phenomenon in a higher dimension</title>
<p>To examine the waterfall effect in a higher dimension, we investigate a three-population system where a faster-growing population (FF) grows faster than the fast-growing population (F) which grows faster than the slow-growing population (S) (<xref rid="fig5" ref-type="fig">Fig. 5a</xref> and Sec. VIII in Supplementary Information). In the three-population case, the evolutionary trajectory travels in a two-dimensional plane. A target population composition can be achieved if inter-collective selection can sufficiently reduce the frequencies of F as well as FF (accessible regions, gold in <xref rid="fig5" ref-type="fig">Fig. 5b</xref>).</p>
<fig id="fig5" position="float" fig-type="figure">
<label>Figure 5.</label>
<caption><title>In higher dimensions, the success of artificial selection requires the entire evolutionary trajectory remaining in the accessible region.</title>
<p><bold>a</bold> During collective maturation, a slow-growing population (S) (with growth rate <italic>r</italic><sub><italic>S</italic></sub> ; light gray) can mutate to a fast-growing population (F) (with growth rate <italic>r</italic><sub><italic>S</italic></sub> + <italic>ω</italic>; medium gray), which can mutate further into a faster-growing population (FF) (with growth rate <italic>r</italic><sub><italic>S</italic></sub> + 2<italic>ω</italic>; dark gray). Here, the rates of both mutational steps are <italic>µ</italic>, and <italic>ω &gt;</italic> 0. <bold>b</bold> Evolutionary trajectories from various initial compositions (open circles) to various targets. Intra-collective evolution favors FF over F (vertical blue arrow) over S (horizontal blue arrow). The accessible regions are marked gold (see Sec. I in Supplementary Information). We obtain final compositions starting from several initial compositions while aiming for different target compositions in i, ii, and iii. The evolutionary trajectories are shown in dots with color gradients from the initial to final time. (i) A target composition with a high FF frequency is always achievable. (ii) A target composition with intermediate FF frequency is never achievable. (iii) A target composition with low FF frequency is achievable only if starting from an appropriate initial composition such that the entire trajectory never meanders away from the accessible region. The figures are drawn using mpltern package [<xref ref-type="bibr" rid="c36">36</xref>]. <bold>c</bold> The accessible region in the three-population problem is interpreted as an extension of the two-population problem. First the accessible region between FF and S+F is given, and then the S+F region is stretched into S and F.</p></caption>
<graphic xlink:href="531234v4_fig5_new.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
<p>From numerical simulations, we identified two accessible regions: a small region near FF and a band region spanning from S to F (gold in <xref rid="fig5" ref-type="fig">Fig. 5b i</xref>). Intuitively, the rate at which FF grows faster than S+F is greater than the rate at which F grows faster than S (see section VIII in Supplementary Information). Thus, the problem can initially be reduced to a two-population problem (i.e. FF versus F+S; <xref rid="fig5" ref-type="fig">Fig. 5c</xref> left), and then expanded to a three-population problem (<xref rid="fig5" ref-type="fig">Fig. 5c</xref> right).</p>
<p>Similar to the two-population case, targets in the inaccessible region are never achievable (<xref rid="fig5" ref-type="fig">Fig. 5b ii</xref>), while those in the FF region are always achievable (<xref rid="fig5" ref-type="fig">Fig. 5b i</xref>). Strikingly, a target composition in an accessible region may not be achievable even when the initial composition is within the same region: once the composition escapes the accessible region, the trajectory cannot return back to the accessible region (<xref rid="fig5" ref-type="fig">Fig. 5biii</xref>, the leftmost initial condition). However, if the initial position is closer to the target in the accessible region, the target becomes achievable (<xref rid="fig5" ref-type="fig">Fig. 5b iii</xref>, initial condition near the bottom). Note that here, selection outcome is path-dependent in the sense of being sensitive to initial conditions. This phenomenon is distinct from hysteresis where path-dependence results from whether a tuning parameter is increased or decreased.</p>
<p>In conclusion, we have investigated the evolutionary trajectories of population compositions in collectives under selection, which are governed by intra-collective selection (which favors fast-growing populations) and inter-collective selection (which, in our case, strives to counter fast-growing populations). Intra-collective selection has the strongest effect at intermediate frequencies of faster-growing populations, potentially creating an inaccessible region of target frequency, analogous to the vertical drop of a waterfall. High and low target frequencies are both accessible, analogous to the lower- and the upper-pools of a waterfall, respectively. A less challenging target (high <inline-formula><inline-graphic xlink:href="531234v4_inline77.gif" mime-subtype="gif" mimetype="image"/></inline-formula>; low <italic>ŝ</italic>) is achievable from any initial position. In contrast, a more challenging target (low <inline-formula><inline-graphic xlink:href="531234v4_inline78.gif" mime-subtype="gif" mimetype="image"/></inline-formula>; high <italic>ŝ</italic>) is only achievable if the entire trajectory is contained within the region, similar to a raft striving to reach a point in the upper-pool must start at and remain in the upper pool. Our work suggests that the strength of intra-collective selection is not constant, and that strategically choosing an appropriate starting point can be essential for successful collective selection.</p>
</sec>
</sec>
<sec id="s3">
<title>Methods</title>
<sec id="s3a">
<title>Stochastic simulations</title>
<p>A selection cycle is composed of three steps: maturation, selection, and reproduction. At the beginning of the cycle <italic>k</italic>, a collective <italic>i</italic> has <inline-formula><inline-graphic xlink:href="531234v4_inline79.gif" mime-subtype="gif" mimetype="image"/></inline-formula> slow-growing cells and <inline-formula><inline-graphic xlink:href="531234v4_inline80.gif" mime-subtype="gif" mimetype="image"/></inline-formula> fast-growing cells. At the first cycle, mean F frequency of collectives are set to be <inline-formula><inline-graphic xlink:href="531234v4_inline81.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is sampled from the binomial distribution with mean <inline-formula><inline-graphic xlink:href="531234v4_inline82.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. Then, <inline-formula><inline-graphic xlink:href="531234v4_inline83.gif" mime-subtype="gif" mimetype="image"/></inline-formula> cells are in the collective <italic>i</italic>. In the maturation step, we calculate <inline-formula><inline-graphic xlink:href="531234v4_inline84.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v4_inline85.gif" mime-subtype="gif" mimetype="image"/></inline-formula> by using stochastic simulation. We can simulate the division and mutation of each individual cell stochastically by using tau-leaping algorithm [<xref ref-type="bibr" rid="c37">37</xref>, <xref ref-type="bibr" rid="c38">38</xref>](see <xref rid="figs3" ref-type="fig">Fig. 3a</xref> and <xref rid="figs3" ref-type="fig">b</xref> in Supplementary Information). However, individual-based simulations require a long computing time. Instead, we randomly sample <inline-formula><inline-graphic xlink:href="531234v4_inline86.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v4_inline87.gif" mime-subtype="gif" mimetype="image"/></inline-formula> from the joint probability density distribution <inline-formula><inline-graphic xlink:href="531234v4_inline88.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. To obtain <inline-formula><inline-graphic xlink:href="531234v4_inline89.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, we solve the master equation which describes a time evolution of probability distribution <inline-formula><inline-graphic xlink:href="531234v4_inline90.gif" mime-subtype="gif" mimetype="image"/></inline-formula> under the random processes (see Sec. I in Supplementary Information). We assumed that <inline-formula><inline-graphic xlink:href="531234v4_inline91.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v4_inline92.gif" mime-subtype="gif" mimetype="image"/></inline-formula> are independent (as S and F populations grow independently without ecological interactions), and thus <inline-formula><inline-graphic xlink:href="531234v4_inline93.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is product of two probability density functions <inline-formula><inline-graphic xlink:href="531234v4_inline94.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v4_inline95.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. Each distribution follows a Gaussian distribution, with the mean and variance numerically obtained from ordinary differential equations derived from the master equation (see Sec. I in Supplementary Information). We choose the collective with the closest frequency to the target <inline-formula><inline-graphic xlink:href="531234v4_inline96.gif" mime-subtype="gif" mimetype="image"/></inline-formula> to generates <italic>g</italic> Newborns. The number of F cells is sampled from the binomial distribution with the mean of <inline-formula><inline-graphic xlink:href="531234v4_inline97.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. We start a new cycle with those Newborn collectives. Then, the number of S cells in a collective <italic>i</italic> is <inline-formula><inline-graphic xlink:href="531234v4_inline98.gif" mime-subtype="gif" mimetype="image"/></inline-formula>.</p>
</sec>
<sec id="s3b">
<title>Analytical approach to the conditional probability</title>
<p>The conditional probability distribution <inline-formula><inline-graphic xlink:href="531234v4_inline99.gif" mime-subtype="gif" mimetype="image"/></inline-formula> of observing <inline-formula><inline-graphic xlink:href="531234v4_inline100.gif" mime-subtype="gif" mimetype="image"/></inline-formula> at a given <inline-formula><inline-graphic xlink:href="531234v4_inline101.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is calculated by the following procedure. Given the selected collective in cycle <italic>k</italic> with <inline-formula><inline-graphic xlink:href="531234v4_inline102.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, the collective-level reproduction proceeds by sampling <italic>g</italic> Newborn collectives with <italic>N</italic><sub>0</sub> cells in cycle <italic>k</italic> + 1. Each Newborn collective contains certain F numbers <inline-formula><inline-graphic xlink:href="531234v4_inline103.gif" mime-subtype="gif" mimetype="image"/></inline-formula> at the beginning of the cycle <italic>k</italic> + 1, which can be mapped into <inline-formula><inline-graphic xlink:href="531234v4_inline104.gif" mime-subtype="gif" mimetype="image"/></inline-formula> with the constraint of <italic>N</italic><sub>0</sub> cells. If the number of cells in the selected collective is large enough, the joint conditional distribution function <inline-formula><inline-graphic xlink:href="531234v4_inline105.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is well described by the product of <italic>g</italic> independent and identical Gaussian distribution 𝒩 (<italic>µ, σ</italic><sup>2</sup>). So we consider the frequencies of <italic>g</italic> Newborn collectives as <italic>g</italic> identical copies of the Gaussian random variable <italic>f</italic><sub><italic>k</italic>+1,0</sub>. The mean and variance of <italic>f</italic><sub><italic>k</italic>+1,0</sub> are given by <inline-formula><inline-graphic xlink:href="531234v4_inline106.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v4_inline107.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. Then, the conditional probability distribution function of <italic>f</italic><sub><italic>k</italic>+1,0</sub> being <italic>ζ</italic> is given by
<disp-formula id="eqn5">
<graphic xlink:href="531234v4_eqn5.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
After the reproduction step, the Newborn collectives grow for time <italic>τ</italic>. The frequency is changed from the given frequency <italic>ζ</italic> to <italic>f</italic> by division and mutation processes. We assume that the frequency <italic>f</italic> of an Adult is also approximated by a Gaussian random variable <inline-formula><inline-graphic xlink:href="531234v4_inline108.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. The mean <inline-formula><inline-graphic xlink:href="531234v4_inline109.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and variance <inline-formula><inline-graphic xlink:href="531234v4_inline110.gif" mime-subtype="gif" mimetype="image"/></inline-formula> are calculated by using means and variances of <italic>S</italic> and <italic>F</italic> (see Sec. II in Supplementary Information.) Since <inline-formula><inline-graphic xlink:href="531234v4_inline111.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v4_inline112.gif" mime-subtype="gif" mimetype="image"/></inline-formula> also depend on <italic>ζ</italic>, the conditional probability distribution function of <italic>f</italic><sub><italic>k</italic>+1,<italic>τ</italic></sub> being <italic>f</italic> is given by
<disp-formula id="eqn6">
<graphic xlink:href="531234v4_eqn6.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
The conditional probability distribution of an Adult collective in cycle <italic>k</italic> + 1 (<italic>f</italic><sub><italic>k</italic>+1,<italic>τ</italic></sub>) to have frequency <italic>f</italic> at a given <inline-formula><inline-graphic xlink:href="531234v4_inline113.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is calculated by multiplying two Gaussian distribution functions and integrating overall <italic>ζ</italic> values, which is given by
<disp-formula id="eqn7">
<graphic xlink:href="531234v4_eqn7.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Since we select the minimum frequency <inline-formula><inline-graphic xlink:href="531234v4_inline114.gif" mime-subtype="gif" mimetype="image"/></inline-formula> among <italic>g</italic> identical copies of <italic>f</italic><sub><italic>k</italic>+1,<italic>τ</italic></sub>, the conditional probability distribution function of <inline-formula><inline-graphic xlink:href="531234v4_inline115.gif" mime-subtype="gif" mimetype="image"/></inline-formula> follows a minimum value distribution, which is given in <xref ref-type="disp-formula" rid="eqn1">Eq. (1)</xref>. Here, for the case of <inline-formula><inline-graphic xlink:href="531234v4_inline116.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, the selected frequency <inline-formula><inline-graphic xlink:href="531234v4_inline117.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is the minimum frequency <inline-formula><inline-graphic xlink:href="531234v4_inline118.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. So we have <inline-formula><inline-graphic xlink:href="531234v4_inline119.gif" mime-subtype="gif" mimetype="image"/></inline-formula> by replacing <inline-formula><inline-graphic xlink:href="531234v4_inline120.gif" mime-subtype="gif" mimetype="image"/></inline-formula> with <inline-formula><inline-graphic xlink:href="531234v4_inline121.gif" mime-subtype="gif" mimetype="image"/></inline-formula>.</p>
<p>We assume that the conditional probability distribution in <xref ref-type="disp-formula" rid="eqn7">Eq. (7)</xref> follows a normal distribution, whose mean and variances are describe by <xref ref-type="disp-formula" rid="eqn40">Eq. (40)</xref> and <xref ref-type="disp-formula" rid="eqn41">Eq. (41)</xref>. Then, the extreme value theory [<xref ref-type="bibr" rid="c39">39</xref>] estimates the median of the selected Adult by
<disp-formula id="eqn8">
<graphic xlink:href="531234v4_eqn8.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
The selection progress Δ<italic>f</italic> in <xref ref-type="disp-formula" rid="eqn2">Eq. (2)</xref> is obtained by subtracting <inline-formula><inline-graphic xlink:href="531234v4_inline122.gif" mime-subtype="gif" mimetype="image"/></inline-formula> from <xref ref-type="disp-formula" rid="eqn8">Eq. (8)</xref>.</p>
</sec>
</sec>
</body>
<back>
<sec id="s4" sec-type="data-availability">
<title>Data and source code availability</title>
<p>Data and source code of stochastic simulations are available in <ext-link ext-link-type="uri" xlink:href="https://github.com/schwarzg/artificial_selection_collective_composition">https://github.com/schwarzg/artificial_selection_collective_composition</ext-link>.</p>
</sec>
<ack>
<title>Acknowledgments</title>
<p>J. Lee and H.J. Park were supported by the National Research Foundation of Korea grant funded by the Korea government (MSIT), Grant No. RS-2023-00214071 and RS-2024-00460958 and by an appointment to the JRG Program at the APCTP through the Science and Technology Promotion Fund and Lottery Fund of the Korean Government. W. Shou was supported by an Academy of Medical Sciences Professorship and a Royal Society Wolfson Fellowship. This was also supported by the Korean Local Governments–Gyeongsangbuk-do Province and Pohang City and INHA UNIVERSITY Research Grant. We thank Su-Chan Park, Li Xie, Alex Yuan, and Botond Major for constructive comments and discussions.</p>
</ack>
<ref-list>
<ref id="c1"><label>[1]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Woo</surname>, <given-names>S.</given-names></string-name>, <string-name><surname>Song</surname>, <given-names>I.</given-names></string-name> &amp; <string-name><surname>Cha</surname>, <given-names>H. J.</given-names></string-name></person-group> <article-title>Fast and facile biodegradation of polystyrene by the gut microbial flora of Plesiophthalmus davidis larvae</article-title>. <source>Applied and Environmental Microbiology</source> <volume>86</volume>, <fpage>e01361</fpage>–<lpage>20</lpage> (<year>2020</year>).</mixed-citation></ref>
<ref id="c2"><label>[2]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Sun</surname>, <given-names>J.</given-names></string-name>, <string-name><surname>Prabhu</surname>, <given-names>A.</given-names></string-name>, <string-name><surname>Aroney</surname>, <given-names>S. T.</given-names></string-name> &amp; <string-name><surname>Rinke</surname>, <given-names>C.</given-names></string-name></person-group> <article-title>Corrigendum: Insights into plastic biodegradation: community composition and functional capabilities of the superworm (Zophobas morio) microbiome in styrofoam feeding trials</article-title>. <source>Microbial Genomics</source> <volume>8</volume> (<year>2022</year>).</mixed-citation></ref>
<ref id="c3"><label>[3]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Bober</surname>, <given-names>J. R.</given-names></string-name>, <string-name><surname>Beisel</surname>, <given-names>C. L.</given-names></string-name> &amp; <string-name><surname>Nair</surname>, <given-names>N. U.</given-names></string-name></person-group> <article-title>Synthetic biology approaches to engineer probiotics and members of the human microbiota for biomedical applications</article-title>. <source>Annual Review of Biomedical Engineering</source> <volume>20</volume>, <fpage>277</fpage>–<lpage>300</lpage> (<year>2018</year>).</mixed-citation></ref>
<ref id="c4"><label>[4]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wang</surname>, <given-names>E.-X.</given-names></string-name>, <string-name><surname>Ding</surname>, <given-names>M.-Z.</given-names></string-name>, <string-name><surname>Ma</surname>, <given-names>Q.</given-names></string-name><string-name><surname>Dong</surname>, <given-names>X.-T.</given-names></string-name> &amp; <string-name><surname>Yuan</surname>, <given-names>Y.-J.</given-names></string-name></person-group> <article-title>Reorganization of a synthetic microbial consortium for one-step vitamin c fermentation</article-title>. <source>Microbial Cell Factories</source> <volume>15</volume>, <fpage>21</fpage> (<year>2016</year>).</mixed-citation></ref>
<ref id="c5"><label>[5]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Goodnight</surname>, <given-names>C. J.</given-names></string-name></person-group> <article-title>Experimental studies of community evolution i: The response to selection at the community level</article-title>. <source>Evolution</source> <volume>44</volume>, <fpage>1614</fpage>–<lpage>1624</lpage> (<year>1990</year>).</mixed-citation></ref>
<ref id="c6"><label>[6]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Goodnight</surname>, <given-names>C. J.</given-names></string-name></person-group> <article-title>Experimental studies of community evolution ii: The ecological basis of the response to community selection</article-title>. <source>Evolution</source> <volume>44</volume>, <fpage>1625</fpage>–<lpage>1636</lpage> (<year>1990</year>).</mixed-citation></ref>
<ref id="c7"><label>[7]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Swenson</surname>, <given-names>W.</given-names></string-name>, <string-name><surname>Wilson</surname>, <given-names>D. S.</given-names></string-name> &amp; <string-name><surname>Elias</surname>, <given-names>R.</given-names></string-name></person-group> <article-title>Artificial ecosystem selection</article-title>. <source>Proceedings of the National Academy of Sciences</source> <volume>97</volume>, <fpage>9110</fpage>–<lpage>9114</lpage> (<year>2000</year>).</mixed-citation></ref>
<ref id="c8"><label>[8]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Swenson</surname>, <given-names>W.</given-names></string-name>, <string-name><surname>Arendt</surname>, <given-names>J.</given-names></string-name> &amp; <string-name><surname>Wilson</surname>, <given-names>D. S.</given-names></string-name></person-group> <article-title>Artificial selection of microbial ecosystems for 3-chloroaniline biodegradation</article-title>. <source>Environmental Microbiology</source> <volume>2</volume>, <fpage>564</fpage>–<lpage>571</lpage> (<year>2000</year>).</mixed-citation></ref>
<ref id="c9"><label>[9]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Blouin</surname>, <given-names>M.</given-names></string-name>, <string-name><surname>Karimi</surname>, <given-names>B.</given-names></string-name>, <string-name><surname>Mathieu</surname>, <given-names>J.</given-names></string-name> &amp; <string-name><surname>Lerch</surname>, <given-names>T. Z.</given-names></string-name></person-group> <article-title>Levels and limits in artificial selection of communities</article-title>. <source>Ecology Letters</source> <volume>18</volume>, <fpage>1040</fpage>–<lpage>1048</lpage> (<year>2015</year>).</mixed-citation></ref>
<ref id="c10"><label>[10]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Panke-Buisse</surname>, <given-names>K.</given-names></string-name>, <string-name><surname>Poole</surname>, <given-names>A. C.</given-names></string-name>, <string-name><surname>Goodrich</surname>, <given-names>J. K.</given-names></string-name>, <string-name><surname>Ley</surname>, <given-names>R. E.</given-names></string-name> &amp; <string-name><surname>Kao-Kniffin</surname>, <given-names>J.</given-names></string-name></person-group> <article-title>Selection on soil microbiomes reveals reproducible impacts on plant function</article-title>. <source>The ISME Journal</source> <volume>9</volume>, <fpage>980</fpage>–<lpage>989</lpage> (<year>2015</year>).</mixed-citation></ref>
<ref id="c11"><label>[11]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Panke-Buisse</surname>, <given-names>K.</given-names></string-name>, <string-name><surname>Lee</surname>, <given-names>S.</given-names></string-name> &amp; <string-name><surname>Kao-Kniffin</surname>, <given-names>J.</given-names></string-name></person-group> <article-title>Cultivated sub-populations of soil microbiomes retain early flowering plant trait</article-title>. <source>Microbial Ecology</source> <volume>73</volume>, <fpage>394</fpage>–<lpage>403</lpage> (<year>2017</year>).</mixed-citation></ref>
<ref id="c12"><label>[12]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Jochum</surname>, <given-names>M. D.</given-names></string-name>, <string-name><surname>McWilliams</surname>, <given-names>K. L.</given-names></string-name>, <string-name><surname>Pierson</surname>, <given-names>E. A.</given-names></string-name> &amp; <string-name><surname>Jo</surname>, <given-names>Y.-K.</given-names></string-name></person-group> <article-title>Host-mediated microbiome engineering (hmme) of drought tolerance in the wheat rhizosphere</article-title>. <source>PLoS One</source> <volume>14</volume>, <fpage>e0225933</fpage> (<year>2019</year>).</mixed-citation></ref>
<ref id="c13"><label>[13]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wright</surname>, <given-names>R. J.</given-names></string-name>, <string-name><surname>Gibson</surname>, <given-names>M. I.</given-names></string-name> &amp; <string-name><surname>Christie-Oleza</surname>, <given-names>J. A.</given-names></string-name></person-group> <article-title>Understanding microbial community dynamics to improve optimal microbiome selection</article-title>. <source>Microbiome</source> <volume>7</volume>, <fpage>1</fpage>–<lpage>14</lpage> (<year>2019</year>).</mixed-citation></ref>
<ref id="c14"><label>[14]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Raynaud</surname>, <given-names>T.</given-names></string-name>, <string-name><surname>Devers</surname>, <given-names>M.</given-names></string-name>, <string-name><surname>Spor</surname>, <given-names>A.</given-names></string-name> &amp; <string-name><surname>Blouin</surname>, <given-names>M.</given-names></string-name></person-group> <article-title>Effect of the reproduction method in an artificial selection experiment at the community level</article-title>. <source>Frontiers in Ecology and Evolution</source> <volume>7</volume>, <fpage>416</fpage> (<year>2019</year>).</mixed-citation></ref>
<ref id="c15"><label>[15]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Jigyasa Arora</surname>, <given-names>A. S. M.</given-names></string-name>, <string-name><surname>Margaret</surname> <given-names>A.</given-names></string-name></person-group> <article-title>Mars Brisbin. Effects of microbial evolution dominate those of experimental host-mediated indirect selection</article-title>. <source>PeerJ</source> <volume>8</volume>, <fpage>e9350</fpage> (<year>2020</year>).</mixed-citation></ref>
<ref id="c16"><label>[16]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Chang</surname>, <given-names>C.-Y.</given-names></string-name>, <string-name><surname>Osborne</surname>, <given-names>M. L.</given-names></string-name>, <string-name><surname>Bajic</surname>, <given-names>D.</given-names></string-name> &amp; <string-name><surname>Sanchez</surname>, <given-names>A.</given-names></string-name></person-group> <article-title>Artificially selecting bacterial communities using propagule strategies</article-title>. <source>Evolution</source> <volume>74</volume>, <fpage>2392</fpage>–<lpage>2403</lpage> (<year>2020</year>).</mixed-citation></ref>
<ref id="c17"><label>[17]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mueller</surname>, <given-names>U. G.</given-names></string-name> <etal>et al.</etal></person-group> <article-title>Artificial selection on microbiomes to breed microbiomes that confer salt tolerance to plants</article-title>. <source>mSystems</source> <volume>6</volume>, <fpage>e01125</fpage>–<lpage>21</lpage> (<year>2021</year>).</mixed-citation></ref>
<ref id="c18"><label>[18]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Jacquiod</surname>, <given-names>S.</given-names></string-name> <etal>et al.</etal></person-group> <article-title>Artificial selection of stable rhizosphere microbiota leads to heritable plant phenotype changes</article-title>. <source>Ecology Letters</source> <volume>25</volume>, <fpage>189</fpage>–<lpage>201</lpage> (<year>2022</year>).</mixed-citation></ref>
<ref id="c19"><label>[19]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Raynaud</surname>, <given-names>T.</given-names></string-name>, <string-name><surname>Devers-Lamrani</surname>, <given-names>M.</given-names></string-name>, <string-name><surname>Spor</surname>, <given-names>A.</given-names></string-name> &amp; <string-name><surname>Blouin</surname>, <given-names>M.</given-names></string-name></person-group> <article-title>Community diversity determines the evolution of synthetic bacterial communities under artificial selection</article-title>. <source>Evolution</source> <volume>76</volume>, <fpage>1883</fpage>–<lpage>1895</lpage> (<year>2022</year>).</mixed-citation></ref>
<ref id="c20"><label>[20]</label><mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Penn</surname>, <given-names>A.</given-names></string-name></person-group> “<chapter-title>Modelling artificial ecosystem selection: A preliminary investigation</chapter-title>”. In <person-group person-group-type="editor"><string-name><surname>Banzhaf</surname>, <given-names>W.</given-names></string-name>, <string-name><surname>Ziegler</surname>, <given-names>J.</given-names></string-name>, <string-name><surname>Christaller</surname>, <given-names>T.</given-names></string-name>, <string-name><surname>Dittrich</surname>, <given-names>P.</given-names></string-name> &amp; <string-name><surname>Kim</surname>, <given-names>J.T.</given-names></string-name></person-group> (eds.) <source>Advances in Artificial Life</source>, <fpage>659</fpage>–<lpage>666</lpage> (<publisher-name>Springer Berlin Heidelberg</publisher-name>, <publisher-loc>Berlin, Heidelberg</publisher-loc>, <year>2003</year>).</mixed-citation></ref>
<ref id="c21"><label>[21]</label><mixed-citation publication-type="confproc"><person-group person-group-type="author"><string-name><surname>Penn</surname>, <given-names>A.</given-names></string-name> &amp; <string-name><surname>Harvey</surname>, <given-names>I.</given-names></string-name></person-group> “<article-title>The role of non-genetic change in the heritability, variation, and response to selection of artificially selected ecosystems</article-title>”. In <person-group person-group-type="editor"><string-name><surname>Pollack</surname>, <given-names>J.</given-names></string-name>, <string-name><surname>Bedau</surname>, <given-names>M. A.</given-names></string-name>, <string-name><surname>Husbands</surname>, <given-names>P.</given-names></string-name>, <string-name><surname>Watson</surname>, <given-names>R.A.</given-names></string-name> &amp; <string-name><surname>Ikegami</surname>, <given-names>T.</given-names></string-name></person-group> (eds.) <conf-name>Artificial Life IX: Proceedings of the Ninth International Conference on the Simulation and Synthesis of Artificial Life</conf-name>, vol. <volume>9</volume>, <fpage>352</fpage> (<publisher-name>MIT Press</publisher-name>, <year>2004</year>).</mixed-citation></ref>
<ref id="c22"><label>[22]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Williams</surname>, <given-names>H. T. P.</given-names></string-name> &amp; <string-name><surname>Lenton</surname>, <given-names>T. M.</given-names></string-name></person-group> <article-title>Artificial selection of simulated microbial ecosystems</article-title>. <source>Proceedings of the National Academy of Sciences</source> <volume>104</volume>, <fpage>8918</fpage> (<year>2007</year>).</mixed-citation></ref>
<ref id="c23"><label>[23]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Xie</surname>, <given-names>L.</given-names></string-name>, <string-name><surname>Yuan</surname>, <given-names>A. E.</given-names></string-name> &amp; <string-name><surname>Shou</surname>, <given-names>W.</given-names></string-name></person-group> <article-title>Simulations reveal challenges to artificial community selection and possible strategies for success</article-title>. <source>PLoS Biology</source> <volume>17</volume>, <fpage>e3000295</fpage> (<year>2019</year>).</mixed-citation></ref>
<ref id="c24"><label>[24]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Doulcier</surname>, <given-names>G.</given-names></string-name>, <string-name><surname>Lambert</surname>, <given-names>A.</given-names></string-name>, <string-name><surname>De Monte</surname>, <given-names>S.</given-names></string-name> &amp; <string-name><surname>Rainey</surname>, <given-names>P. B.</given-names></string-name></person-group> <article-title>Eco-evolutionary dynamics of nested darwinian populations and the emergence of community-level heredity</article-title>. <source>eLife</source> <volume>9</volume>, <elocation-id>e53433</elocation-id> (<year>2020</year>).</mixed-citation></ref>
<ref id="c25"><label>[25]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Xie</surname>, <given-names>L.</given-names></string-name> &amp; <string-name><surname>Shou</surname>, <given-names>W.</given-names></string-name></person-group> <article-title>Steering ecological-evolutionary dynamics to improve artificial selection of microbial communities</article-title>. <source>Nature Communications</source> <volume>12</volume>, <fpage>6799</fpage> (<year>2021</year>).</mixed-citation></ref>
<ref id="c26"><label>[26]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Chang</surname>, <given-names>C.-Y.</given-names></string-name> <etal>et al.</etal></person-group> <article-title>Engineering complex communities by directed evolution</article-title>. <source>Nature Ecology &amp; Evolution</source> <volume>5</volume>, <fpage>1011</fpage> (<year>2021</year>).</mixed-citation></ref>
<ref id="c27"><label>[27]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Fraboul</surname>, <given-names>J.</given-names></string-name>, <string-name><surname>Biroli</surname>, <given-names>G.</given-names></string-name> &amp; <string-name><surname>De Monte</surname>, <given-names>S.</given-names></string-name></person-group> <article-title>Artificial selection of communities drives the emergence of structured interactions</article-title>. <source>Journal of Theoretical Biology</source> <volume>571</volume>, <fpage>111557</fpage> (<year>2023</year>).</mixed-citation></ref>
<ref id="c28"><label>[28]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lalejini</surname>, <given-names>A.</given-names></string-name>, <string-name><surname>Dolson</surname>, <given-names>E.</given-names></string-name>, <string-name><surname>Vostinar</surname>, <given-names>A. E.</given-names></string-name> &amp; <string-name><surname>Zaman</surname>, <given-names>L.</given-names></string-name></person-group> <article-title>Artificial selection methods from evolutionary computing show promise for directed evolution of microbes</article-title>. <source>eLife</source> <volume>11</volume>, <elocation-id>e79665</elocation-id> (<year>2022</year>).</mixed-citation></ref>
<ref id="c29"><label>[29]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zaccaria</surname>, <given-names>M.</given-names></string-name>, <string-name><surname>Sandlin</surname>, <given-names>N.</given-names></string-name>, <string-name><surname>Soen</surname>, <given-names>Y.</given-names></string-name> &amp; <string-name><surname>Momeni</surname>, <given-names>B.</given-names></string-name></person-group> <article-title>Partner-assisted artificial selection of a secondary function for efficient bioremediation</article-title>. <source>iScience</source> <volume>26</volume>, <fpage>107632</fpage> (<year>2023</year>).</mixed-citation></ref>
<ref id="c30"><label>[30]</label><mixed-citation publication-type="preprint"><person-group person-group-type="author"><string-name><surname>Vessman</surname>, <given-names>B.</given-names></string-name>, <string-name><surname>Guridi-Fernández</surname>, <given-names>P.</given-names></string-name>, <string-name><surname>Arias-Sánchez</surname>, <given-names>F. I.</given-names></string-name> &amp; <string-name><surname>Mitri</surname>, <given-names>S.</given-names></string-name></person-group> <article-title>Novel artificial selection method improves function of simulated microbial communities</article-title>. <source>bioRxiv</source> (<year>2023</year>). <pub-id pub-id-type="doi">10.1101/2023.01.08.523165</pub-id> (accessed <date-in-citation content-type="access-date">18 December 2023</date-in-citation>).</mixed-citation></ref>
<ref id="c31"><label>[31]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Arias-Sánchez</surname>, <given-names>F. I.</given-names></string-name>, <string-name><surname>Vessman</surname>, <given-names>B.</given-names></string-name>, <string-name><surname>Haym</surname>, <given-names>A.</given-names></string-name>, <string-name><surname>Alberti</surname>, <given-names>G.</given-names></string-name> &amp; <string-name><surname>Mitri</surname>, <given-names>S.</given-names></string-name></person-group> <article-title>Artificial selection improves pollutant degradation by bacterial communities</article-title>. <source>Nature Communications</source> <volume>15</volume>, <fpage>7836</fpage> (<year>2024</year>).</mixed-citation></ref>
<ref id="c32"><label>[32]</label><mixed-citation publication-type="preprint"><person-group person-group-type="author"><string-name><surname>Xie</surname>, <given-names>L.</given-names></string-name>, <string-name><surname>Yuan</surname>, <given-names>A. E.</given-names></string-name> &amp; <string-name><surname>Shou</surname>, <given-names>W.</given-names></string-name></person-group> <article-title>A quantitative genetics framework for understanding the selection response of microbial communities</article-title>. <source>bioRxiv</source> (<year>2023</year>). <pub-id pub-id-type="doi">10.1101/2023.10.24.563725</pub-id> (accessed <date-in-citation content-type="access-date">28 December 2023</date-in-citation>).</mixed-citation></ref>
<ref id="c33"><label>[33]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Thomas</surname>, <given-names>J. L.</given-names></string-name>, <string-name><surname>Rowland-Chandler</surname>, <given-names>J.</given-names></string-name> &amp; <string-name><surname>Shou</surname>, <given-names>W.</given-names></string-name></person-group> <article-title>Artificial selection of microbial communities: what have we learnt and how can we improve?</article-title> <source>Current Opinion in Microbiology</source> <volume>77</volume>, <fpage>102400</fpage> (<year>2024</year>).</mixed-citation></ref>
<ref id="c34"><label>[34]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Rainey</surname>, <given-names>P. B.</given-names></string-name></person-group> <article-title>Major evolutionary transitions in individuality between humans and ai</article-title>. <source>Philosophical Transactions of the Royal Society B</source> <volume>378</volume>, <fpage>20210408</fpage> (<year>2023</year>).</mixed-citation></ref>
<ref id="c35"><label>[35]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Philip</surname>, <given-names>J.</given-names></string-name></person-group> <article-title>The function inverfc theta</article-title>. <source>Australian Journal of Physics</source> <volume>13</volume>, <fpage>13</fpage> (<year>1960</year>).</mixed-citation></ref>
<ref id="c36"><label>[36]</label><mixed-citation publication-type="software"><person-group person-group-type="author"><string-name><surname>Ikeda</surname>, <given-names>Y.</given-names></string-name>, <string-name><surname>Grabowski</surname>, <given-names>B.</given-names></string-name> &amp; <string-name><surname>Körmann</surname>, <given-names>F.</given-names></string-name></person-group> <article-title>mpltern 0.3.0: ternary plots as projections of Matplotlib</article-title> <source>Zenodo</source> (<year>2019</year>). URL <pub-id pub-id-type="doi">10.5281/zenodo.3528355</pub-id>.</mixed-citation></ref>
<ref id="c37"><label>[37]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Gillespie</surname>, <given-names>D. T.</given-names></string-name></person-group> <article-title>Approximate accelerated stochastic simulation of chemically reacting systems</article-title>. <source>The Journal of Chemical Physics</source> <volume>115</volume>, <fpage>1716</fpage>–<lpage>1733</lpage> (<year>2001</year>).</mixed-citation></ref>
<ref id="c38"><label>[38]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Cao</surname>, <given-names>Y.</given-names></string-name>, <string-name><surname>Gillespie</surname>, <given-names>D. T.</given-names></string-name> &amp; <string-name><surname>Petzold</surname>, <given-names>L. R.</given-names></string-name></person-group> <article-title>Efficient step size selection for the tau-leaping simulation method</article-title>. <source>The Journal of Chemical Physics</source> <volume>124</volume>, <fpage>044109</fpage> (<year>2006</year>).</mixed-citation></ref>
<ref id="c39"><label>[39]</label><mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Gumbel</surname>, <given-names>E. J.</given-names></string-name></person-group> <source>Statistics of extremes</source> (<publisher-name>Columbia university press</publisher-name>, <year>1958</year>).</mixed-citation></ref>
</ref-list>
<app-group>
<app id="s6">
<title>Supplementary information</title>
<p>In this supplementary information (SI), we present the mathematical details of all calculations in the main text, as well as additional figures. The SI is organized as follows: In section I, we provide the mathematical details of stochastic simulation of the selection cycle. In section II, we show the mathematical process to obtain the analytical expression of the selection progress in <xref ref-type="disp-formula" rid="eqn2">Eq.(2)</xref> in the main text. In section III, we provide the analytical approximation of the critical Newborn size. In section IV, we discuss a limiting case when mutation rate is zero. Section V provides the boundary of the region of success with different selective advantages. In section VI, we discuss specific scenarios under which mutation converts F to S. In section VII, we present an example in which more than one collective is selected for reproduction. In section VIII, we provide the mathematical details of the selection cycle for a three-population system. Finally, in section IX, we provide detailed derivations of equations from section I to section II.</p>
<sec id="s6a">
<label>I.</label>
<title>Stochastic simulation of the selection cycle</title>
<p>In the main text, we design a simple model of artificial selection on collectives. The selection cycle starts with <italic>g</italic> “Newborn” collectives which consist of two populations - slow-growing population (S) and fast-growing population (F). S mutate to F at a rate <italic>µ</italic>. The Newborns mature for a fixed time <italic>τ</italic>. The matured collective (“Adult”) with the highest function (with F frequency <italic>f</italic> closest to the target<inline-formula><inline-graphic xlink:href="531234v4_inline123.gif" mime-subtype="gif" mimetype="image"/></inline-formula>) is chosen to reproduce <italic>g</italic> Newborn collectives each with <italic>N</italic><sub>0</sub> cells.</p>
<p>In our selection cycle, variation among collectives mainly resulted from demographic noises during cell birth, cell mutation, and collective reproduction. In this section, we provide details of the simulation.</p>
<sec id="s6a1">
<title>Maturation</title>
<p>Here, we calculate the cell numbers during maturation. Each collective <italic>i</italic> (<italic>i</italic> = 1, …, <italic>g</italic>) has <inline-formula><inline-graphic xlink:href="531234v4_inline124.gif" mime-subtype="gif" mimetype="image"/></inline-formula> S cells and <inline-formula><inline-graphic xlink:href="531234v4_inline125.gif" mime-subtype="gif" mimetype="image"/></inline-formula> F cells where <italic>k</italic> is the cycle number and <italic>t</italic> indicates time (0 ≤ <italic>t</italic> ≤ <italic>τ</italic>). At the beginning of cycle <italic>k</italic> (<italic>t</italic> = 0), each Newborn collective has a total of <inline-formula><inline-graphic xlink:href="531234v4_inline126.gif" mime-subtype="gif" mimetype="image"/></inline-formula> cells. The collectives are allowed to “mature” for <italic>t</italic> = <italic>τ</italic> during which S and F grow at rates <italic>r</italic><sub><italic>S</italic></sub> and <italic>r</italic><sub><italic>S</italic></sub> + <italic>ω</italic> (<italic>ω &gt;</italic> 0), respectively. In this subsection, we ignore the cycle number index <italic>k</italic> and the collective index (<italic>i</italic>) for convenience. That is, we denote <inline-formula><inline-graphic xlink:href="531234v4_inline127.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v4_inline128.gif" mime-subtype="gif" mimetype="image"/></inline-formula> as <italic>S</italic>(<italic>t</italic>) and <italic>F</italic> (<italic>t</italic>), respectively.</p>
<p>We describe cell divisions of S and F cells and mutation from S to F with following chemical reaction rules:
<disp-formula id="eqn1a">
<graphic xlink:href="531234v4_eqn1a.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn2a">
<graphic xlink:href="531234v4_eqn2a.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn3a">
<graphic xlink:href="531234v4_eqn3a.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
One can run an individual-based simulation by counting the number of events occurring during collective maturation via the tau-leaping algorithm [<xref ref-type="bibr" rid="c1">1</xref>, <xref ref-type="bibr" rid="c2">2</xref>] to generate a sample trajectory of <italic>S</italic>(<italic>t</italic>) and <italic>F</italic> (<italic>t</italic>) for each collective. However, the individual-based simulation requires long computing times due to a large number of random events to be counted. Hence we used a ‘sampling method’ by sampling the numbers of S and F cells in collectives from a joint probability density distribution (jpdf) <italic>P</italic> (<italic>S, F, t</italic>) which denotes the probability density to have <italic>S</italic> number of S cells and <italic>F</italic> number of F cells at time <italic>t</italic> in the cycle. To do so, we require an analytical expression of <italic>P</italic> (<italic>S, F, t</italic>).</p>
<p>First, we assume that the chemical reactions in <xref ref-type="disp-formula" rid="eqn1">Eqs. (1)</xref>-<xref ref-type="disp-formula" rid="eqn3">(3)</xref> occur independently, and never occur simultaneously within a short time interval [<italic>t, t</italic> + <italic>dt</italic>). Then, the differential of <italic>P</italic> (<italic>S, F, t</italic>) with respect to time is given by
<disp-formula id="eqn4a">
<graphic xlink:href="531234v4_eqn4a.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
This master equation describes a probability density ‘flux’ at the state (<italic>S, F</italic>). The first term describes the scenario where a single birth event of a S cell happens during time interval [<italic>t, t</italic> + <italic>dt</italic>), which changes the collective’s composition from (<italic>S</italic>− 1, <italic>F</italic>) to (<italic>S, F</italic>). Similarly, the second term comes from a birth event of a F cell. The third term indicates the mutation event from (<italic>S</italic> +1, <italic>F</italic>− 1) to (<italic>S, F</italic>). The last term corresponds to the outflow of probability density by birth and mutation processes, which describes the changes from (<italic>S, F</italic>) to any other states.</p>
<p>Calculating the exact form of <italic>P</italic> (<italic>S, F, t</italic>) is not simple. Instead, we assume that the mutation rate is much smaller than the growth rates, and hence the correlation between <italic>S</italic> and <italic>F</italic> is sufficiently small. Additionally, S and F do not interact ecologically. Then, we can express <italic>P</italic> (<italic>S, F, t</italic>) as a product of two probability density functions (pdf) of <italic>S</italic>(<italic>t</italic>) and <italic>F</italic> (<italic>t</italic>), <italic>P</italic> (<italic>S, F, t</italic>) = <italic>P</italic> (<italic>S, t</italic>)<italic>P</italic> (<italic>F, t</italic>). We assume that each pdf of <italic>S</italic> and <italic>F</italic> can be approximated as Gaussian (𝒩), which is supported by the Central Limit Theorem and <xref rid="fig1" ref-type="fig">Fig. 1</xref>. In more detail, the cell numbers <italic>S</italic> and <italic>F</italic> are mainly determined by growth (<xref ref-type="disp-formula" rid="eqn1">Eqs. (1)</xref> and <xref ref-type="disp-formula" rid="eqn2">(2)</xref>), and also mutations (<xref ref-type="disp-formula" rid="eqn3">Eq. (3)</xref>). Even though the number of events would be different among different realizations, the mean numbers of events will follow Gaussian distributions. So, we can simply assume that the distributions of cell numbers also follow Gaussian distributions. This assumption requires that the distributions have insignificant skewness and no heavy tails, which we will numerically check afterwards. The pdfs of <italic>S</italic>(<italic>t</italic>) and <italic>F</italic> (<italic>t</italic>) are given by
<disp-formula id="eqn5a">
<graphic xlink:href="531234v4_eqn5a.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
and
<disp-formula id="eqn6a">
<graphic xlink:href="531234v4_eqn6a.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
That is, <italic>P</italic> (<italic>S, F, t</italic>) is written as
<disp-formula id="eqn7a">
<graphic xlink:href="531234v4_eqn7a.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Now we need means (<inline-formula><inline-graphic xlink:href="531234v4_inline129.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v4_inline130.gif" mime-subtype="gif" mimetype="image"/></inline-formula>) and variances (<inline-formula><inline-graphic xlink:href="531234v4_inline131.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and<inline-formula><inline-graphic xlink:href="531234v4_inline132.gif" mime-subtype="gif" mimetype="image"/></inline-formula>) of S and F cell numbers to express the distribution analytically.</p>
<p>The means are defined by <inline-formula><inline-graphic xlink:href="531234v4_inline133.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v4_inline134.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. The differential equations for means are obtained by applying the definition to the master equation in <xref ref-type="disp-formula" rid="eqn4">Eq. (4)</xref>, as
<disp-formula id="eqn8a">
<graphic xlink:href="531234v4_eqn8a.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn9">
<graphic xlink:href="531234v4_eqn9.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
We assume that the mutation rate <italic>µ</italic> is much smaller than <italic>r</italic><sub><italic>S</italic></sub> and <italic>ω</italic>. By solving <xref ref-type="disp-formula" rid="eqn8">Eq. (8)</xref> and <xref ref-type="disp-formula" rid="eqn9">Eq. (9)</xref>, the means <inline-formula><inline-graphic xlink:href="531234v4_inline135.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v4_inline136.gif" mime-subtype="gif" mimetype="image"/></inline-formula> are given by
<disp-formula id="eqn10">
<graphic xlink:href="531234v4_eqn10.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn11">
<graphic xlink:href="531234v4_eqn11.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="531234v4_inline137.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v4_inline138.gif" mime-subtype="gif" mimetype="image"/></inline-formula> are the mean numbers of S and F cells at the beginning of cycle, <italic>t</italic> = 0. Note that the second term of <xref ref-type="disp-formula" rid="eqn11">Eq. (11)</xref> is consistent with previous studies [<xref ref-type="bibr" rid="c3">3</xref>]. Now we introduce factors <inline-formula><inline-graphic xlink:href="531234v4_inline139.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <italic>W</italic><sub><italic>t</italic></sub> = <italic>e</italic><sup><italic>ωt</italic></sup> in <xref ref-type="disp-formula" rid="eqn10">Eqs. (10)</xref> and <xref ref-type="disp-formula" rid="eqn11">(11)</xref> in order to simplify the formula. <italic>R</italic><sub><italic>t</italic></sub> is the multiplying factor by which the S cell number increases after time <italic>t. W</italic><sub><italic>t</italic></sub> is the fold change in <italic>F/S</italic>. Then, we can rewrite
<disp-formula id="eqn12">
<graphic xlink:href="531234v4_eqn12.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn13">
<graphic xlink:href="531234v4_eqn13.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
We define the second momenta of <italic>S</italic> and <italic>F</italic> as
<disp-formula id="eqn14">
<graphic xlink:href="531234v4_eqn14.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn15">
<graphic xlink:href="531234v4_eqn15.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Then, the corresponding differential equations are given by
<disp-formula id="eqn16">
<graphic xlink:href="531234v4_eqn16.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn17">
<graphic xlink:href="531234v4_eqn17.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
The solution of <xref ref-type="disp-formula" rid="eqn16">Eq. (16)</xref> is
<disp-formula id="eqn18">
<graphic xlink:href="531234v4_eqn18.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn19">
<graphic xlink:href="531234v4_eqn19.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="531234v4_inline140.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is the second moment of initial values. Thus, the variance <inline-formula><inline-graphic xlink:href="531234v4_inline141.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is
<disp-formula id="eqn20">
<graphic xlink:href="531234v4_eqn20.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn21">
<graphic xlink:href="531234v4_eqn21.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="531234v4_inline142.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is a variance of S cell numbers at <italic>t</italic> = 0. In <xref ref-type="disp-formula" rid="eqn17">Eq. (17)</xref>, we require <inline-formula><inline-graphic xlink:href="531234v4_inline143.gif" mime-subtype="gif" mimetype="image"/></inline-formula> to calculate <inline-formula><inline-graphic xlink:href="531234v4_inline144.gif" mime-subtype="gif" mimetype="image"/></inline-formula>.<xref ref-type="disp-formula" rid="eqn4">Eq. (4)</xref> provides a differential equation for <inline-formula><inline-graphic xlink:href="531234v4_inline145.gif" mime-subtype="gif" mimetype="image"/></inline-formula> as
<disp-formula id="eqn22">
<graphic xlink:href="531234v4_eqn22.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
The solution of <xref ref-type="disp-formula" rid="eqn22">Eq. (22)</xref> is given by
<disp-formula id="eqn23">
<graphic xlink:href="531234v4_eqn23.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
By using <xref ref-type="disp-formula" rid="eqn23">Eq. (23)</xref>, the solution of <xref ref-type="disp-formula" rid="eqn17">Eq. (17)</xref> is given by
<disp-formula id="eqn24">
<graphic xlink:href="531234v4_eqn24.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="531234v4_inline146.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is the second moment of initial values. Thus, the variance <inline-formula><inline-graphic xlink:href="531234v4_inline147.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is given, up to the order of <italic>µ</italic>, by
<disp-formula id="eqn25">
<graphic xlink:href="531234v4_eqn25.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Using <inline-formula><inline-graphic xlink:href="531234v4_inline148.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <italic>W</italic><sub><italic>τ</italic></sub> = <italic>e</italic><sup><italic>ωτ</italic></sup>, we rewrite
<disp-formula id="eqn26">
<graphic xlink:href="531234v4_eqn26.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Using <xref ref-type="disp-formula" rid="eqn10">Eqs. (10)</xref>,<xref ref-type="disp-formula" rid="eqn11">(11)</xref>,<xref ref-type="disp-formula" rid="eqn20">(20)</xref>,<xref ref-type="disp-formula" rid="eqn25">(25)</xref>, we construct pdfs for <italic>S</italic>(<italic>t</italic>) and <italic>F</italic> (<italic>t</italic>) at the end of cycle <italic>t</italic> = <italic>τ</italic>. Then, we randomly sample a number from <italic>P</italic> (<italic>S, τ</italic>) for <italic>S</italic>(<italic>τ</italic>) and another number from <italic>P</italic> (<italic>F, τ</italic>) for <italic>F</italic> (<italic>τ</italic>). Those two numbers are cell numbers in a single Adult. We repeat this process for each Newborn to get cell numbers of all Adults. Note that the initial values for the Newborn <italic>i</italic> are <inline-formula><inline-graphic xlink:href="531234v4_inline149.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="531234v4_inline150.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. This process only requires two random numbers per collective while the result is consistent with the individual-based simulation.</p>
<fig id="figs1" position="float" fig-type="figure">
<label>Fig. 1.</label>
<caption><p>Comparison between the calculated Gaussian distribution (“Gauss”, with the mean and variances computed from <xref ref-type="disp-formula" rid="eqn10">Eqs. (10)</xref>,<xref ref-type="disp-formula" rid="eqn11">(11)</xref>,<xref ref-type="disp-formula" rid="eqn20">(20)</xref>,<xref ref-type="disp-formula" rid="eqn25">(25)</xref>) and simulations using tau-leaping (“tau”). The simulations run 3000 times. The initial number of cells are (<italic>S</italic><sub>0</sub>, <italic>F</italic><sub>0</sub>) = (990, 10), (500, 500), and (10, 990) for each column. The parameters <italic>r</italic> = 0.5, <italic>ω</italic> = 0.03, <italic>µ</italic> = 0.0001, and <italic>τ</italic> = 4.8 are used.</p></caption>
<graphic xlink:href="531234v4_fig1a.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
<p>Now, we check validity of Gaussian approximation for probability density functions of S and F populations. If we consider mutation from S to F as death in S population, then the process in S corresponds to a branching process with death. Also, the birth process in F including mutation results in a Luria-Delbrück distribution[<xref ref-type="bibr" rid="c3">3</xref>]. Thus the distributions of Adults’ S and F numbers are more skewed and heavy-tailed than Gaussian. But this problem is alleviated by larger initial S and F numbers and when the maturation time <italic>τ</italic> is not very long (see <xref rid="fig1" ref-type="fig">Fig. 1</xref>). Since we usually consider larger initial cell numbers, we use the Gaussian approximation on S and F populations in further calculations.</p>
</sec>
<sec id="s6a2">
<title>Selection</title>
<p>After sampling cell numbers of each Adult in the maturation step, we compute the F frequencies in each collectives <inline-formula><inline-graphic xlink:href="531234v4_inline151.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. We denote the F frequency of collective <italic>i</italic> at time <italic>t</italic> = <italic>τ</italic> in cycle <italic>k</italic> as <inline-formula><inline-graphic xlink:href="531234v4_inline152.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. Among the <italic>g</italic> Adults, we select one collective with the F frequency which is the closest value to the target frequency <inline-formula><inline-graphic xlink:href="531234v4_inline153.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. The selected Adult’s F frequency value is denoted by <inline-formula><inline-graphic xlink:href="531234v4_inline154.gif" mime-subtype="gif" mimetype="image"/></inline-formula>.</p>
<fig id="figs2" position="float" fig-type="figure">
<label>Fig. 2.</label>
<caption><p>Congruence between consecutive sampling (MHG for multivariate hypergeometric distribution) and independent binomial (BN) sampling. The initial numbers of cells are <italic>S</italic> = 8000 and <italic>F</italic> = 2000 for the left panel, and <italic>S</italic> = 20 and <italic>F</italic> = 5 for the right panel. 10000 samples are drawn for each distribution. Here, a parent collective is divided into 10 collectives.</p></caption>
<graphic xlink:href="531234v4_fig2a.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
<p>In mathematical expression, the selected frequency is defined by
<disp-formula id="eqn27">
<graphic xlink:href="531234v4_eqn27.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
</p>
</sec>
<sec id="s6a3">
<title>Reproduction</title>
<p>Using the chosen Adult, we generate <italic>g</italic> Newborn collectives for the next cycle <italic>k</italic> + 1. The most natural way is consecutive random sampling <italic>N</italic><sub>0</sub> cells from the selected Adult without replacement. In mathematical expression, we first randomly sample <inline-formula><inline-graphic xlink:href="531234v4_inline155.gif" mime-subtype="gif" mimetype="image"/></inline-formula> F cells and draw <inline-formula><inline-graphic xlink:href="531234v4_inline156.gif" mime-subtype="gif" mimetype="image"/></inline-formula> S cells from the selected Adult. Next, we sample <inline-formula><inline-graphic xlink:href="531234v4_inline157.gif" mime-subtype="gif" mimetype="image"/></inline-formula> F cells and <inline-formula><inline-graphic xlink:href="531234v4_inline158.gif" mime-subtype="gif" mimetype="image"/></inline-formula> S cells from the remaining cells in the Adult. We repeat the process <italic>g</italic> times. Then the jpdf to choose <inline-formula><inline-graphic xlink:href="531234v4_inline159.gif" mime-subtype="gif" mimetype="image"/></inline-formula> F cells, <inline-formula><inline-graphic xlink:href="531234v4_inline160.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, follows a multivariate hypergeometric distribution.</p>
<p>If we assume that the selected Adult size <inline-formula><inline-graphic xlink:href="531234v4_inline161.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is large enough compared to Newborn size <italic>N</italic><sub>0</sub>, the consecutive sampling is well approximated to the independent binomial sampling (see <xref rid="fig2" ref-type="fig">Fig. 2</xref>). Thus, we independently sample <italic>g</italic> numbers of F cells, <inline-formula><inline-graphic xlink:href="531234v4_inline162.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, from the binomial distribution. The probability mass function of each <inline-formula><inline-graphic xlink:href="531234v4_inline163.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is given by
<disp-formula id="eqn28">
<graphic xlink:href="531234v4_eqn28.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
After sampling, the numbers of S cells are set to be <inline-formula><inline-graphic xlink:href="531234v4_inline164.gif" mime-subtype="gif" mimetype="image"/></inline-formula> for each collective.</p>
<p>We can now start cycle <italic>k</italic> + 1 with these Newborn collectives. By repeating the above three steps (maturation, selection, and reproduction), we run the simulation until F frequency reaches a stationary state.</p>
<fig id="figs3" position="float" fig-type="figure">
<label>Fig. 3.</label>
<caption><p><bold>a</bold> Trajectories of F frequency for 10 collectives (<italic>g</italic> = 10) over time. The collective whose frequency is closest to the target value is selected in every cycle (black lines). The gray lines denote the other collectives. For parameters, we used S growth rate <italic>r</italic><sub><italic>S</italic></sub> = 0.5, F growth advantage <italic>ω</italic> = 0.03, mutation rate <italic>µ</italic> = 0.0001, maturation time <italic>τ</italic> ≈ 4.8, and <italic>N</italic><sub>0</sub> = 1000. <bold>b</bold> Comparison between frequency trajectories with selection (the chosen one Adult producing all offspring; black) and without selection (each Adult producing one offspring; blue) clearly shows the effect of artificial selection. The black line indicates F frequency of the selected collective <inline-formula><inline-graphic xlink:href="531234v4_inline318.gif" mime-subtype="gif" mimetype="image"/></inline-formula> at each cycle in <bold>a</bold>. The blue line indicates the average trajectory without selection <inline-formula><inline-graphic xlink:href="531234v4_inline319.gif" mime-subtype="gif" mimetype="image"/></inline-formula> (the average of <italic>g</italic> = 10 individual lineages without inter-collective selection at the end of each cycle).</p></caption>
<graphic xlink:href="531234v4_fig3a.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
</sec>
<sec id="s6a4">
<title>Simulation Result</title>
<p><xref rid="fig3" ref-type="fig">Figure 3</xref> presents the composition trajectories of all collectives using tau-leaping algorithm in the maturation step. The selected Adults have the closest composition to the target composition <inline-formula><inline-graphic xlink:href="531234v4_inline165.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. The selected Adult can have smaller F frequency than its parent Adult, so F frequency can be lowered after cycles.</p>
<p>In <xref rid="fig4" ref-type="fig">Fig. 4</xref>, we plot the absolute error <italic>d</italic> between the target frequency <inline-formula><inline-graphic xlink:href="531234v4_inline166.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v4_inline167.gif" mime-subtype="gif" mimetype="image"/></inline-formula> at the end of simulations (1000 cycles). Since the computing time for Tau-leaping algorithm (individual-based simulation) to reach 1000 cycles is very long, we used the sampling scheme in the above subsection. In the colormap, errors higher than 0.15 are marked with gray, which indicates selection failure. The dashed lines indicate the same boundary in <xref rid="fig2" ref-type="fig">Fig 2e</xref> in the main text.</p>
</sec>
</sec>
<sec id="s6b">
<label>II.</label>
<title>Conditional probability distribution of the selected collective frequency <italic>f</italic> <sup>*</sup> and selection progress Δ<italic>f</italic></title>
<p>In the main text, we identify the region of success by using selection progress <inline-formula><inline-graphic xlink:href="531234v4_inline168.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, which is obtained from conditional pdf of <inline-formula><inline-graphic xlink:href="531234v4_inline169.gif" mime-subtype="gif" mimetype="image"/></inline-formula> the F frequency of the selected Adult at cycle <italic>k</italic> + 1) given the selected <inline-formula><inline-graphic xlink:href="531234v4_inline170.gif" mime-subtype="gif" mimetype="image"/></inline-formula> at cycle <italic>k</italic>, written as <inline-formula><inline-graphic xlink:href="531234v4_inline171.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. We consider the challenging case where <inline-formula><inline-graphic xlink:href="531234v4_inline172.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is above the target value <inline-formula><inline-graphic xlink:href="531234v4_inline173.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, and therefore the Adult with minimum F frequency will be selected. To get an analytical expression of <inline-formula><inline-graphic xlink:href="531234v4_inline174.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, we first find the conditional pdf of <italic>f</italic> of Adults in cycle <italic>k</italic> + 1 given <inline-formula><inline-graphic xlink:href="531234v4_inline175.gif" mime-subtype="gif" mimetype="image"/></inline-formula> at cycle <italic>k</italic>. Then, we find <inline-formula><inline-graphic xlink:href="531234v4_inline176.gif" mime-subtype="gif" mimetype="image"/></inline-formula> from the minimum value distribution of F frequencies among <italic>g</italic> Adults. Below, we describe mathematical details of this process.</p>
<fig id="figs4" position="float" fig-type="figure">
<label>Fig. 4.</label>
<caption><p>Color map of the absolute error <inline-formula><inline-graphic xlink:href="531234v4_inline320.gif" mime-subtype="gif" mimetype="image"/></inline-formula> averaged selected collectives at the end of simulations (<italic>k</italic> = 1000) and the target frequency <inline-formula><inline-graphic xlink:href="531234v4_inline321.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. The solid and dashed lines are drawn by the arguments in the main text. For parameters, we used <italic>r</italic><sub><italic>S</italic></sub> = 0.5, <italic>ω</italic> = 0.03, <italic>µ</italic> = 0.0001, <italic>N</italic><sub>0</sub> = 1000, <italic>g</italic> = 10 and <italic>τ</italic> ≈ 4.8. The result is the average of 300 independent simulations. Compared to <xref rid="fig2" ref-type="fig">Fig. 2e</xref>, this figure has a higher resolution.</p></caption>
<graphic xlink:href="531234v4_fig4a.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
<p>Let us start from the reproduction step from the selected Adult in cycle <italic>k</italic>. We reproduce <italic>g</italic> Newborns in next cycle <italic>k</italic> + 1. Then the probability distribution of the F cell numbers in Newborn collectives is given in <xref ref-type="disp-formula" rid="eqn28">Eq. (28)</xref>. If the total number of cells in a Newborn collective <italic>N</italic><sub>0</sub> is large enough, <xref ref-type="disp-formula" rid="eqn28">Eq. (28)</xref> is approximated by the Gaussian distribution <inline-formula><inline-graphic xlink:href="531234v4_inline177.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. Then, the probability density function that <inline-formula><inline-graphic xlink:href="531234v4_inline178.gif" mime-subtype="gif" mimetype="image"/></inline-formula> to be <italic>ζ</italic> in Newborn collective <italic>i</italic> is
<disp-formula id="eqn29">
<graphic xlink:href="531234v4_eqn29.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
The Newborn collective <italic>i</italic> has initial cell numbers <inline-formula><inline-graphic xlink:href="531234v4_inline179.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v4_inline180.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. From here, we ignore cycle index <italic>k</italic> + 1 in subscript and <italic>i</italic> superscript for convenience.</p>
<p>Next, we write conditional pdf of Adults’ F frequency with given Newborn F frequency <italic>ζ</italic>. We assume that cell numbers in Adult <italic>S</italic>(<italic>τ</italic>) and <italic>F</italic> (<italic>τ</italic>) follow Gaussian distributions as in <xref ref-type="disp-formula" rid="eqn5">Eqs. (5)</xref> and <xref ref-type="disp-formula" rid="eqn6">(6)</xref>. Based on <xref ref-type="disp-formula" rid="eqn10">Eqs. (10)</xref>, <xref ref-type="disp-formula" rid="eqn11">(11)</xref>, <xref ref-type="disp-formula" rid="eqn20">(20)</xref>, and <xref ref-type="disp-formula" rid="eqn25">(25)</xref>, we have
<disp-formula id="eqn30">
<graphic xlink:href="531234v4_eqn30.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn31">
<graphic xlink:href="531234v4_eqn31.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <italic>G</italic><sub><italic>S</italic></sub>(<italic>τ</italic>) and <italic>G</italic><sub><italic>F</italic></sub> (<italic>τ</italic>) are random variable following the standard distribution 𝒩 (0, 1). Note that each Gaussian is sharp if Newborn size <italic>N</italic><sub>0</sub> is sufficiently large (<inline-formula><inline-graphic xlink:href="531234v4_inline181.gif" mime-subtype="gif" mimetype="image"/></inline-formula>and <inline-formula><inline-graphic xlink:href="531234v4_inline182.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. Then, we can approximately write <italic>f</italic> (<italic>τ</italic>) as
<disp-formula id="eqn32">
<graphic xlink:href="531234v4_eqn32.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
The mean of <italic>f</italic> is given by
<disp-formula id="eqn33">
<graphic xlink:href="531234v4_eqn33.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
and the variance is
<disp-formula id="eqn34">
<graphic xlink:href="531234v4_eqn34.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="531234v4_inline183.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <italic>W</italic><sub><italic>τ</italic></sub> = <italic>e</italic><sup><italic>ωτ</italic></sup>. The average Adult size is <inline-formula><inline-graphic xlink:href="531234v4_inline184.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. Thus the Adult’s F frequency <italic>f</italic> (<italic>τ</italic>) = <italic>f</italic><sub><italic>τ</italic></sub> follows the Gaussian distribution <inline-formula><inline-graphic xlink:href="531234v4_inline185.gif" mime-subtype="gif" mimetype="image"/></inline-formula> whose pdf is given by
<disp-formula id="eqn35">
<graphic xlink:href="531234v4_eqn35.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Next, we get the conditional pdf of <inline-formula><inline-graphic xlink:href="531234v4_inline186.gif" mime-subtype="gif" mimetype="image"/></inline-formula> (offspring Adult’s F frequency in cycle <italic>k</italic> + 1) given <inline-formula><inline-graphic xlink:href="531234v4_inline187.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. We multiply <xref ref-type="disp-formula" rid="eqn29">Eqs. (29)</xref> and <xref ref-type="disp-formula" rid="eqn35">(35)</xref> and take integral over <italic>ζ</italic>:
<disp-formula id="eqn36">
<graphic xlink:href="531234v4_eqn36.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
After maturation in cycle <italic>k</italic> + 1, the Adult with the smallest frequency is selected among <italic>g</italic> Adult collectives, denoted as <inline-formula><inline-graphic xlink:href="531234v4_inline188.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. The pdf of <inline-formula><inline-graphic xlink:href="531234v4_inline189.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is obtained by the theory of extreme value statistics [<xref ref-type="bibr" rid="c4">4</xref>]. The cumulative distribution function (cdf) of the minimum value <inline-formula><inline-graphic xlink:href="531234v4_inline190.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is given by
<disp-formula id="eqn37">
<graphic xlink:href="531234v4_eqn37.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
</p>
<fig id="figs5" position="float" fig-type="figure">
<label>Fig. 5.</label>
<caption><p>The probability density functions of the selected Adult’s F frequency <inline-formula><inline-graphic xlink:href="531234v4_inline322.gif" mime-subtype="gif" mimetype="image"/></inline-formula> subtracted by <inline-formula><inline-graphic xlink:href="531234v4_inline323.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. For simulations (blue), at each <inline-formula><inline-graphic xlink:href="531234v4_inline324.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, we performed 1000 stochastic simulations. The orange distribution represents <xref ref-type="disp-formula" rid="eqn39">Eq. (39)</xref> computed by numerical integration. The median values of the distributions are shown in <xref rid="fig4" ref-type="fig">Fig. 4a</xref> in the main text.</p></caption>
<graphic xlink:href="531234v4_fig5a.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
<p>Since frequencies are independent and identically distributed, <inline-formula><inline-graphic xlink:href="531234v4_inline191.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. Note that Prob<inline-formula><inline-graphic xlink:href="531234v4_inline192.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, and <xref ref-type="disp-formula" rid="eqn37">Eq. (37)</xref> becomes
<disp-formula id="eqn38">
<graphic xlink:href="531234v4_eqn38.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Then, the probability density function <inline-formula><inline-graphic xlink:href="531234v4_inline193.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is obtained by differentiating <xref ref-type="disp-formula" rid="eqn38">Eq. (38)</xref> with respect to <italic>f</italic> and replacing <inline-formula><inline-graphic xlink:href="531234v4_inline194.gif" mime-subtype="gif" mimetype="image"/></inline-formula>,
<disp-formula id="eqn39">
<graphic xlink:href="531234v4_eqn39.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
We compute the probability density function(39) by using numerical integration and compare it with the stochastic simulation results in <xref rid="fig5" ref-type="fig">Fig. 5</xref>. The two distributions are similar.</p>
<p>To get the analytic approximation of the median of <xref ref-type="disp-formula" rid="eqn39">Eq. (39)</xref>, we assume that the Adult’s F frequency distribution is Gaussian. Then we only need to calculate the mean <inline-formula><inline-graphic xlink:href="531234v4_inline195.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and variance <inline-formula><inline-graphic xlink:href="531234v4_inline196.gif" mime-subtype="gif" mimetype="image"/></inline-formula> of Adult’s F frequency. Instead of calculating the integral with respect to <italic>ζ</italic> in <xref ref-type="disp-formula" rid="eqn36">Eq. (36)</xref>, we put a set of initial value from Newborn’s F frequency distribution <inline-formula><inline-graphic xlink:href="531234v4_inline197.gif" mime-subtype="gif" mimetype="image"/></inline-formula> in <xref ref-type="disp-formula" rid="eqn12">Eqs. (12)</xref>,<xref ref-type="disp-formula" rid="eqn13">(13)</xref>,<xref ref-type="disp-formula" rid="eqn20">(20)</xref>,<xref ref-type="disp-formula" rid="eqn26">(26)</xref>: <inline-formula><inline-graphic xlink:href="531234v4_inline198.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="531234v4_inline199.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. Then we have
<disp-formula id="eqn40">
<graphic xlink:href="531234v4_eqn40.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn41">
<graphic xlink:href="531234v4_eqn41.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
which give rise to <xref ref-type="disp-formula" rid="eqn3">Eq. (3)</xref> and <xref ref-type="disp-formula" rid="eqn4">Eq. (4)</xref> in the main text, respectively. The functional form of <xref ref-type="disp-formula" rid="eqn40">Eqs.(40)</xref> and <xref ref-type="disp-formula" rid="eqn41">(41)</xref> are plotted in <xref rid="figs6" ref-type="fig">Fig. 6a</xref>.</p>
<fig id="figs6" position="float" fig-type="figure">
<label>Fig. 6.</label>
<caption><p><bold>a</bold> Mean (<xref ref-type="disp-formula" rid="eqn33">Eq. (33)</xref>) and variance (<xref ref-type="disp-formula" rid="eqn34">Eq. (34)</xref>) of <italic>f</italic> values of Adult collectives with respect to the Newborn frequency <italic>f</italic><sub>0</sub>. <bold>b</bold> Scaling relation of F frequency variance (<xref ref-type="disp-formula" rid="eqn41">Eq. (41)</xref>) with Newborn collective size <italic>N</italic><sub>0</sub>. The initial F frequency is 0.5. The parameters are <italic>r</italic><sub><italic>S</italic></sub> = 0.5, <italic>ω</italic> = 0.03, <italic>µ</italic> = 0.0001, and <italic>τ</italic> ≈ 4.8. <bold>c</bold> Relation of F frequency variance (<xref ref-type="disp-formula" rid="eqn41">Eq. (41)</xref>) with maturation time <italic>τ</italic>. Other parameters are the same as <bold>b</bold>.</p></caption>
<graphic xlink:href="531234v4_fig6.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
<p>The median (Median <inline-formula><inline-graphic xlink:href="531234v4_inline200.gif" mime-subtype="gif" mimetype="image"/></inline-formula>) of <xref ref-type="disp-formula" rid="eqn39">Eq. (39)</xref> satisfies <inline-formula><inline-graphic xlink:href="531234v4_inline201.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, which means <inline-formula><inline-graphic xlink:href="531234v4_inline202.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. If we assume that the distribution <xref ref-type="disp-formula" rid="eqn39">Eq. (39)</xref> is Gaussian, then the inverse function <inline-formula><inline-graphic xlink:href="531234v4_inline203.gif" mime-subtype="gif" mimetype="image"/></inline-formula> can be written as
<disp-formula id="eqn42">
<graphic xlink:href="531234v4_eqn42.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where Φ<sup>−1</sup>(<italic>y</italic>) is an inverse cumulative density function (CDF) of the normal distribution with mean <inline-formula><inline-graphic xlink:href="531234v4_inline204.gif" mime-subtype="gif" mimetype="image"/></inline-formula> in <xref ref-type="disp-formula" rid="eqn41">Eq. (41)</xref> and standard deviation <italic>σ</italic><sub><italic>f</italic></sub> (<italic>τ</italic>), a square root of <xref ref-type="disp-formula" rid="eqn41">Eq. (41)</xref>. Subtracting <inline-formula><inline-graphic xlink:href="531234v4_inline205.gif" mime-subtype="gif" mimetype="image"/></inline-formula> from <xref ref-type="disp-formula" rid="eqn42">Eq. (42)</xref> gives the selection progress
<disp-formula id="eqn43">
<graphic xlink:href="531234v4_eqn43.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
which is <xref ref-type="disp-formula" rid="eqn2">Eq. (2)</xref> in the main text.</p>
<fig id="figs7" position="float" fig-type="figure">
<label>Fig. 7.</label>
<caption><p>Median (orange) and mean (violet) have similar distributions. We performed 1000 simulations to get probability density. <bold>a</bold> <italic>g</italic> = 10, <bold>b</bold> <italic>g</italic> = 100, and <bold>c</bold> <italic>g</italic> = 1000. Initial F frequency is <inline-formula><inline-graphic xlink:href="531234v4_inline325.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. The parameters are <italic>r</italic><sub><italic>S</italic></sub> = 0.5, <italic>ω</italic> = 0.03, <italic>µ</italic> = 0.0001 and <italic>τ</italic> = ln[1000]<italic>/r</italic><sub><italic>S</italic></sub>.</p></caption>
<graphic xlink:href="531234v4_fig7.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
<p>Further, we get an asymptotic expression of Φ<sup>−1</sup>(ln 2<italic>/g</italic>) when <italic>g</italic> is large (or Φ<sup>−1</sup>(<italic>y</italic>) with small <italic>y</italic>).</p>
<p>Here, we introduce a method from [<xref ref-type="bibr" rid="c5">5</xref>]. We start from the CDF of the standard normal distribution, <inline-formula><inline-graphic xlink:href="531234v4_inline206.gif" mime-subtype="gif" mimetype="image"/></inline-formula> where the function erfc(<italic>x</italic>) is the complementary error function. To get the expression of Φ<sup>−1</sup>, we need an asymptotic expression of inverse of <italic>y</italic> = erfc(x) function (<italic>x</italic> = erfc<sup>−1</sup>(<italic>y</italic>)) as the inverse CDF <inline-formula><inline-graphic xlink:href="531234v4_inline207.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. The known asymptotic expansion of <italic>y</italic> = erfc(<italic>x</italic>) for large <italic>x</italic> is <inline-formula><inline-graphic xlink:href="531234v4_inline208.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. By taking logarithm of both sides, we have
<disp-formula id="eqn44">
<graphic xlink:href="531234v4_eqn44.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula></p>
<p>Replacing <italic>x</italic><sup>2</sup> on the righthand side in <xref ref-type="disp-formula" rid="eqn44">Eq. (44)</xref> into the expression itself, we get continued logarithmic form of
<disp-formula id="eqn45">
<graphic xlink:href="531234v4_eqn45.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Inserting <italic>x</italic> = erfc<sup>−1</sup>(<italic>y</italic>) (square root of <xref ref-type="disp-formula" rid="eqn45">Eq. (45)</xref>) into the inverse CDF <inline-formula><inline-graphic xlink:href="531234v4_inline210.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, we have <inline-formula><inline-graphic xlink:href="531234v4_inline211.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. So, the asymptotic expression of Φ<sup>−</sup> (ln 2<italic>/g</italic>) is given by
<disp-formula id="eqn46">
<graphic xlink:href="531234v4_eqn46.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
</p>
</sec>
<sec id="s6c">
<label>III.</label>
<title>Critical newborn size <italic>N̆<sub>0</sub></italic> to allow all target frequencies</title>
<p>First we note that <inline-formula><inline-graphic xlink:href="531234v4_inline213.gif" mime-subtype="gif" mimetype="image"/></inline-formula> in <xref ref-type="disp-formula" rid="eqn41">Eq. (41)</xref> is proportional to <inline-formula><inline-graphic xlink:href="531234v4_inline214.gif" mime-subtype="gif" mimetype="image"/></inline-formula> for the following reasons. Variance <inline-formula><inline-graphic xlink:href="531234v4_inline215.gif" mime-subtype="gif" mimetype="image"/></inline-formula> in <xref ref-type="disp-formula" rid="eqn20">Eq. (20)</xref> scales linearly with <italic>N</italic><sub>0</sub> since both <inline-formula><inline-graphic xlink:href="531234v4_inline216.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v4_inline217.gif" mime-subtype="gif" mimetype="image"/></inline-formula> scale linearly with <italic>N</italic><sub>0</sub>. Variance <inline-formula><inline-graphic xlink:href="531234v4_inline218.gif" mime-subtype="gif" mimetype="image"/></inline-formula> in <xref ref-type="disp-formula" rid="eqn25">Eq. (25)</xref> also scales linearly with <italic>N</italic><sub>0</sub> because <inline-formula><inline-graphic xlink:href="531234v4_inline219.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, and covariance <inline-formula><inline-graphic xlink:href="531234v4_inline220.gif" mime-subtype="gif" mimetype="image"/></inline-formula> all scale linearly with <italic>N</italic><sub>0</sub>. The mean Adult size <inline-formula><inline-graphic xlink:href="531234v4_inline221.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is also proportional to <italic>N</italic><sub>0</sub> because the average cell numbers in <xref ref-type="disp-formula" rid="eqn10">Eqs. (10)</xref> and <xref ref-type="disp-formula" rid="eqn11">(11)</xref> are linear with respect to <italic>N</italic><sub>0</sub>. Thus, the scaling relation of <xref ref-type="disp-formula" rid="eqn41">Eq. (41)</xref> is given by <inline-formula><inline-graphic xlink:href="531234v4_inline222.gif" mime-subtype="gif" mimetype="image"/></inline-formula>.</p>
<p>Small <italic>N</italic><sub>0</sub> makes all target frequencies achievable shown in <xref rid="fig4" ref-type="fig">Fig. 4a</xref> in the main text. That is because small <italic>N</italic><sub>0</sub> induces large <italic>σ</italic><sub><italic>f</italic></sub>, and thus <italic>N</italic><sub>0</sub> smaller than a certain critical value <inline-formula><inline-graphic xlink:href="531234v4_inline223.gif" mime-subtype="gif" mimetype="image"/></inline-formula> makes the selection progress Δ<italic>f</italic> always negative regardless of the value of <inline-formula><inline-graphic xlink:href="531234v4_inline224.gif" mime-subtype="gif" mimetype="image"/></inline-formula> (<italic>i</italic>.<italic>e</italic>.<inline-formula><inline-graphic xlink:href="531234v4_inline225.gif" mime-subtype="gif" mimetype="image"/></inline-formula>). That means the inter-collective selection overcomes intra-collective selection in any target frequencies. To get an analytical approximation of the critical newborn size <inline-formula><inline-graphic xlink:href="531234v4_inline226.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, we simply assume that selection progress Δ<italic>f</italic> is maximum at <inline-formula><inline-graphic xlink:href="531234v4_inline227.gif" mime-subtype="gif" mimetype="image"/></inline-formula> where the changes in <inline-formula><inline-graphic xlink:href="531234v4_inline228.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v4_inline229.gif" mime-subtype="gif" mimetype="image"/></inline-formula> are fastest. If the maximum value of Δ<italic>f</italic> is zero, all other values of <xref ref-type="disp-formula" rid="eqn42">Eq. (42)</xref> are negative, which naturally states all targets are achievable. Putting <inline-formula><inline-graphic xlink:href="531234v4_inline230.gif" mime-subtype="gif" mimetype="image"/></inline-formula>,<xref ref-type="disp-formula" rid="eqn40">Eqs. (40)</xref> and <xref ref-type="disp-formula" rid="eqn41">(41)</xref> become
<disp-formula id="eqn47">
<graphic xlink:href="531234v4_eqn47.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
and
<disp-formula id="eqn48">
<graphic xlink:href="531234v4_eqn48.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
So, by setting <inline-formula><inline-graphic xlink:href="531234v4_inline231.gif" mime-subtype="gif" mimetype="image"/></inline-formula> with <inline-formula><inline-graphic xlink:href="531234v4_inline232.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, we get a solution of
<disp-formula id="eqn49">
<graphic xlink:href="531234v4_eqn49.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Thus, all target frequencies are successfully selected with Newborn size <italic>N</italic><sub>0</sub> smaller than <inline-formula><inline-graphic xlink:href="531234v4_inline233.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. If mutation rate is zero, the critical value becomes
<disp-formula id="eqn50">
<graphic xlink:href="531234v4_eqn50.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
</p>
</sec>
<sec id="s6d">
<label>IV.</label>
<title>Selection without mutation <italic>µ</italic> = 0</title>
<p>When the mutation rate is zero, two genotypes behave as two distinct species. The compositional change is provided by <xref ref-type="disp-formula" rid="eqn42">Eq. (42)</xref> with setting <italic>µ</italic> = 0. Corresponding <inline-formula><inline-graphic xlink:href="531234v4_inline234.gif" mime-subtype="gif" mimetype="image"/></inline-formula> in <xref ref-type="disp-formula" rid="eqn40">Eq. (40)</xref> and <inline-formula><inline-graphic xlink:href="531234v4_inline235.gif" mime-subtype="gif" mimetype="image"/></inline-formula> in <xref ref-type="disp-formula" rid="eqn41">Eq.(41)</xref> become
<disp-formula id="eqn51">
<graphic xlink:href="531234v4_eqn51.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn52">
<graphic xlink:href="531234v4_eqn52.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
</p>
<fig id="figs8" position="float" fig-type="figure">
<label>Fig. 8.</label>
<caption><p>Simulation with zero mutation rate. Color map of the absolute error <inline-formula><inline-graphic xlink:href="531234v4_inline326.gif" mime-subtype="gif" mimetype="image"/></inline-formula> between frequency ⟨<italic>f</italic>*⟩ of the averaged selected collectives at the end of simulations (<italic>k</italic> = 1000) and the target frequency <inline-formula><inline-graphic xlink:href="531234v4_inline327.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. For parameters, we used <italic>r</italic><sub><italic>S</italic></sub> = 0.5, <italic>ω</italic> = 0.03, <italic>µ</italic> = 0, <italic>N</italic><sub>0</sub> = 1000, <italic>g</italic> = 10 and <italic>τ</italic> ≈ 4.8.</p></caption>
<graphic xlink:href="531234v4_fig8.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
<p><xref ref-type="disp-formula" rid="eqn51">Equations (51)</xref> and <xref ref-type="disp-formula" rid="eqn52">(52)</xref> suggest that when a community consists of two competing species, we obtain similar conclusions on the accessible region for target composition. The stochastic simulation results are present in <xref rid="figs8" ref-type="fig">Fig. 8</xref>.</p>
</sec>
<sec id="s6e">
<label>V.</label>
<title>STronger or weaker advantages <italic>ω</italic></title>
<p>The solution of equation (2) in main text provides the boundary values with varying the <italic>ω</italic>, the fitness advantage of F over S. We numerically calculate the solutions and plot in <xref rid="figs9" ref-type="fig">Fig. 9</xref>.</p>
</sec>
<sec id="s6f">
<label>VI.</label>
<title>Deleterious mutation <italic>ω &lt;</italic> 0</title>
<p>In the main text, we show the target composition can be achieved in some ranges of initial and target values when the mutation is beneficial to growth. The same analogy can be applied when the mutation is deleterious. Since the F cells grow slower than the S cells (<italic>ω &lt;</italic> 0), the F frequency naturally decreases in the maturation step. Then, the challenging case is selecting larger F frequency against to the intra-collective selection. So the conditional probability distribution <inline-formula><inline-graphic xlink:href="531234v4_inline236.gif" mime-subtype="gif" mimetype="image"/></inline-formula> that we consider now is a maximum value distribution of <xref ref-type="disp-formula" rid="eqn36">Eq. (36)</xref>. Thus, instead of <xref ref-type="disp-formula" rid="eqn37">Eq. (37)</xref>, we look for the cumulative distribution function of the maximum value <inline-formula><inline-graphic xlink:href="531234v4_inline237.gif" mime-subtype="gif" mimetype="image"/></inline-formula> such that
<disp-formula id="eqn53">
<graphic xlink:href="531234v4_eqn53.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
</p>
<fig id="figs9" position="float" fig-type="figure">
<label>Fig. 9.</label>
<caption><p>Change of success region in varying selective advantage <italic>ω. r</italic><sub><italic>S</italic></sub> = 0.5, <italic>ω</italic> = 0.03, <italic>µ</italic> = 0.0001, <italic>N</italic><sub>0</sub> = 1000, <italic>g</italic> = 10 and <italic>τ</italic> ≈ 4.8.</p></caption>
<graphic xlink:href="531234v4_fig9.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
<p>If all frequencies are independent and identical distributed random variables, the cumulative distribution function becomes
<disp-formula id="eqn54">
<graphic xlink:href="531234v4_eqn54.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Likewise in the previous section, we get the conditional probability density function by differentiating <xref ref-type="disp-formula" rid="eqn54">Eq. (54)</xref> with respect to <italic>f</italic> and replacing <inline-formula><inline-graphic xlink:href="531234v4_inline238.gif" mime-subtype="gif" mimetype="image"/></inline-formula> as
<disp-formula id="eqn55">
<graphic xlink:href="531234v4_eqn55.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
The distribution in <xref ref-type="disp-formula" rid="eqn55">Eq. (55)</xref> is evaluated for various <inline-formula><inline-graphic xlink:href="531234v4_inline239.gif" mime-subtype="gif" mimetype="image"/></inline-formula> in <xref rid="figs10" ref-type="fig">Fig. 10a</xref> with numerical simulations, and the median values of distributions are presented in <xref rid="figs10" ref-type="fig">Fig. 10b</xref>. In the case of <italic>ω</italic> = −0.03, the target frequency lower than around 0.3 and larger than around 0.7 can be selected. Since the sign of <italic>ω</italic> is opposite to the result in the main text, the diagram is reversed from <xref rid="fig2" ref-type="fig">Fig. 2e</xref> in the main text.</p>
</sec>
<sec id="s6g">
<label>VII.</label>
<title>Selecting more than one collective</title>
<p>In the main text, we choose one collective which has the closest frequency to the target among <italic>g</italic> collectives. Such ‘top 1’ strategy allows us to apply extreme value theory. However, ‘top 1’ may be too restrictive [<xref ref-type="bibr" rid="c6">6</xref>]. Thus, we test the ‘top-tier’ strategy by choosing top 5 among 100 Adults (<xref rid="figs11" ref-type="fig">Fig. 11</xref>). The top-tier strategy is shown to be inefficient in our system. This is because in [<xref ref-type="bibr" rid="c6">6</xref>], non-heritable variations−such as stochastic fluctuations in species composition introduced by pipetting − caused nonheritable variations in collective function. Nonheritable variations could potentially mask desired mutations if these mutations happened to occur in an ‘unlucky’ environment that yielded lower collective functions. Hence, lenient selection would allow the preservation of these mutations. In contrast here, stochastic fluctuations in genotype composition is heritable: a parent Newborn with lower F frequency <italic>f</italic> will tend to have offspring Newborns with lower <italic>f</italic> values. Hence, top-1 is more effective in this study.</p>
<fig id="figs10" position="float" fig-type="figure">
<label>Fig. 10.</label>
<caption><p>Artificial selection also works for deleterious mutation. <bold>a</bold> Conditional probability density functions of <inline-formula><inline-graphic xlink:href="531234v4_inline328.gif" mime-subtype="gif" mimetype="image"/></inline-formula> for various <inline-formula><inline-graphic xlink:href="531234v4_inline329.gif" mime-subtype="gif" mimetype="image"/></inline-formula> values. The left-hand side distribution is obtained from simulations and the right-hand side distribution is numerically obtained by evaluating <xref ref-type="disp-formula" rid="eqn55">Eq. (55)</xref>. Small triangles inside indicate the median values of the distributions. <bold>b</bold> the median value of distributions at a given <inline-formula><inline-graphic xlink:href="531234v4_inline330.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. The points where the shifted median becomes zero, Median <inline-formula><inline-graphic xlink:href="531234v4_inline331.gif" mime-subtype="gif" mimetype="image"/></inline-formula> are denoted as <italic>f</italic> <sup><italic>L</italic></sup> and <italic>f</italic> <sup><italic>U</italic></sup>, respectively. <bold>c</bold> The relative error between the target frequency <inline-formula><inline-graphic xlink:href="531234v4_inline332.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and the ensemble averaged selected frequency <inline-formula><inline-graphic xlink:href="531234v4_inline333.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is measured after 1000 cycles starting from the initial frequency <inline-formula><inline-graphic xlink:href="531234v4_inline334.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. Either the lower target frequencies or the higher target frequencies starting from the high initial frequencies can be achieved. The black dashed lines indicate the predicted boundary values <italic>f</italic> <sup><italic>U</italic></sup> and <italic>f</italic> <sup><italic>L</italic></sup> in <bold>a</bold>.</p></caption>
<graphic xlink:href="531234v4_fig10.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
</sec>
<sec id="s6h">
<label>VIII.</label>
<title>Extension to three-population system</title>
<p>We assume that collectives consist of three genotypes with slow-growing(S), fast-growing(F), and faster-growing(FF) types. The growth rate of S is <italic>r</italic><sub><italic>S</italic></sub>. Each mutation adds <italic>ω</italic> to the growth rate. Thus, the F and FF types have growth rates <italic>r</italic><sub><italic>S</italic></sub> + <italic>ω</italic> and <italic>r</italic><sub><italic>S</italic></sub> + 2<italic>ω</italic>, respectively. The mutation rate is <italic>µ</italic>. So, the birth and mutation events are written by the chemical reactions:
<disp-formula id="eqn56">
<graphic xlink:href="531234v4_eqn56.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn57">
<graphic xlink:href="531234v4_eqn57.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn58">
<graphic xlink:href="531234v4_eqn58.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn59">
<graphic xlink:href="531234v4_eqn59.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn60">
<graphic xlink:href="531234v4_eqn60.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
</p>
<fig id="figs11" position="float" fig-type="figure">
<label>Fig. 11.</label>
<caption><p>Selecting Top-5% outperforms selecting Top 1. We bred 100 collectives and chose either top-1 collective (solid line) or top-5 collectives (dashed line) with <italic>f</italic> closest to the target value <inline-formula><inline-graphic xlink:href="531234v4_inline335.gif" mime-subtype="gif" mimetype="image"/></inline-formula> (black dotted line).</p></caption>
<graphic xlink:href="531234v4_fig11.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
<p>We write a master equation of the processes for <italic>P</italic> (<italic>S, F, FF, t</italic>) which is the probability to have <italic>S, F</italic> and <italic>FF</italic> numbers of S, F, and FF cells at time <italic>t</italic>, respectively.
<disp-formula id="eqn61">
<graphic xlink:href="531234v4_eqn61.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
The composition of collective <italic>i</italic> in cycle <italic>k</italic> is now represented with two frequencies <inline-formula><inline-graphic xlink:href="531234v4_inline240.gif" mime-subtype="gif" mimetype="image"/></inline-formula> where the F frequency is <italic>f</italic> <inline-formula><inline-graphic xlink:href="531234v4_inline241.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and the FF frequency is <inline-formula><inline-graphic xlink:href="531234v4_inline242.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. Then, the target composition is set to be <inline-formula><inline-graphic xlink:href="531234v4_inline243.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. The composition of the selected Adult in cycle <italic>k</italic> is <inline-formula><inline-graphic xlink:href="531234v4_inline244.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. We apply the processes used in the above section II to obtain the conditional probability <inline-formula><inline-graphic xlink:href="531234v4_inline245.gif" mime-subtype="gif" mimetype="image"/></inline-formula> by using the master <xref ref-type="disp-formula" rid="eqn61">Eq. (61)</xref>. At the reproduction step in cycle <italic>k</italic>, we choose <italic>N</italic><sub>0</sub> cells from the selected Adult whose composition is <inline-formula><inline-graphic xlink:href="531234v4_inline246.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. Then, Newborn collectives are independently sampled from a multinomial distribution. For convenience, we drop the collective index (<italic>i</italic>). Then, the conditional joint probability mass function of <italic>F</italic><sub><italic>k</italic>+1,0</sub>, <italic>FF</italic><sub><italic>k</italic>+1,0</sub> cells is represented by
<disp-formula id="eqn62">
<graphic xlink:href="531234v4_eqn62.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where the number of S <italic>S</italic><sub><italic>k</italic>+1,0</sub> is automatically set to be <italic>S</italic><sub><italic>k</italic>+1,0</sub> = <italic>N</italic><sub>0</sub> − <italic>F</italic><sub><italic>k</italic>+1,0</sub> − <italic>FF</italic><sub><italic>k</italic>+1,0</sub>. Then, the approximated multivariate normal distribution is <inline-formula><inline-graphic xlink:href="531234v4_inline247.gif" mime-subtype="gif" mimetype="image"/></inline-formula> where the mean distribution is <inline-formula><inline-graphic xlink:href="531234v4_inline248.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and covariance matrix is <bold>M</bold><sub><italic>k</italic>+1</sub>. The diagonal terms of <bold>M</bold><sub><italic>k</italic>+1</sub> are variances <inline-formula><inline-graphic xlink:href="531234v4_inline249.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and the off-diagonal terms are covariances <inline-formula><inline-graphic xlink:href="531234v4_inline250.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. The matrix is given by
<disp-formula id="eqn63">
<graphic xlink:href="531234v4_eqn63.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Then a Newborn’s composition <bold><italic>ρ</italic></bold>(<italic>ζ, η</italic>) follows the multivariate Gaussian distribution <inline-formula><inline-graphic xlink:href="531234v4_inline251.gif" mime-subtype="gif" mimetype="image"/></inline-formula> whose joint probability distribution is given by
<disp-formula id="eqn64">
<graphic xlink:href="531234v4_eqn64.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
At the beginning of cycle <italic>k</italic>, a newborn collective starts from (<italic>S</italic><sub>0</sub>, <italic>F</italic><sub>0</sub>, <italic>FF</italic><sub>0</sub>) cells (for convenience, cycle index <italic>k</italic> is dropped.) In terms of (<italic>ζ, η</italic>), each initial numbers are <italic>S</italic><sub>0</sub> = <italic>N</italic><sub>0</sub>(1− <italic>ζ</italic> − <italic>η</italic>), <italic>F</italic><sub>0</sub> = <italic>N</italic><sub>0</sub><italic>ζ</italic>, and <italic>FF</italic><sub>0</sub> = <italic>N</italic><sub>0</sub><italic>η</italic>. Their initial covariance matrix is <inline-formula><inline-graphic xlink:href="531234v4_inline252.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. By using <xref ref-type="disp-formula" rid="eqn61">Eq. (61)</xref>, we can write ordinary differential equations up to the second moment.
<disp-formula id="eqn65">
<graphic xlink:href="531234v4_eqn65.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn66">
<graphic xlink:href="531234v4_eqn66.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn67">
<graphic xlink:href="531234v4_eqn67.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn68">
<graphic xlink:href="531234v4_eqn68.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn69">
<graphic xlink:href="531234v4_eqn69.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn70">
<graphic xlink:href="531234v4_eqn70.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn71">
<graphic xlink:href="531234v4_eqn71.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn72">
<graphic xlink:href="531234v4_eqn72.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn73">
<graphic xlink:href="531234v4_eqn73.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
The initial conditions of the system in coupled <xref ref-type="disp-formula" rid="eqn65">Eqs. (65)</xref>-<xref ref-type="disp-formula" rid="eqn73">(73)</xref> are obtained by the mean and (co)variances of <xref ref-type="disp-formula" rid="eqn62">Eq. (62)</xref>. By solving equations numerically, we obtain a set of mean cell numbers <inline-formula><inline-graphic xlink:href="531234v4_inline253.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and a set of variances <inline-formula><inline-graphic xlink:href="531234v4_inline254.gif" mime-subtype="gif" mimetype="image"/></inline-formula> as well as covariances (<italic>σ</italic><sub><italic>SF</italic></sub>, <italic>σ</italic><sub><italic>F FF</italic></sub>, <italic>σ</italic><sub><italic>SFF</italic></sub>). We assume that the covariances are smaller than the variances. We consider <italic>S, F</italic>, and <italic>FF</italic> as Gaussian random variables
<disp-formula id="eqn74">
<graphic xlink:href="531234v4_eqn74.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn75">
<graphic xlink:href="531234v4_eqn75.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn76">
<graphic xlink:href="531234v4_eqn76.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Then, the F frequency becomes
<disp-formula id="eqn77">
<graphic xlink:href="531234v4_eqn77.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="531234v4_inline255.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v4_inline256.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. Similarly, the FF frequency is
<disp-formula id="eqn78">
<graphic xlink:href="531234v4_eqn78.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="531234v4_inline257.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v4_inline258.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. The dynamic flow of F and FF frequencies during maturation is shown in <xref rid="figs12" ref-type="fig">Fig. 12a</xref>. If the covariances are small enough, we can approximate the joint probability distribution of Adult’s composition (<italic>f</italic><sub><italic>τ</italic></sub>, <italic>h</italic><sub><italic>τ</italic></sub>) = <bold>p</bold><sub><italic>τ</italic></sub> as
<disp-formula id="eqn79">
<graphic xlink:href="531234v4_eqn79.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
With cycle index <italic>k</italic>, we get conditional probability of matured collectives <inline-formula><inline-graphic xlink:href="531234v4_inline259.gif" mime-subtype="gif" mimetype="image"/></inline-formula> by
<disp-formula id="eqn80">
<graphic xlink:href="531234v4_eqn80.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
We select the Adult collective among <italic>g</italic> Adult collectives such that the change in frequencies during maturation could be compensated. During maturation, a frequency distribution moves in different directions in (<italic>f, h</italic>) space depending on the initial composition <inline-formula><inline-graphic xlink:href="531234v4_inline260.gif" mime-subtype="gif" mimetype="image"/></inline-formula> So, we take different directions to obtain the extreme value distributions. Considering only the sign of the frequency changes in <italic>f</italic> and <italic>h</italic>, we take either maximum or minimum. The mean change in <italic>h</italic> is always positive in the whole (<italic>f, h</italic>) space since <inline-formula><inline-graphic xlink:href="531234v4_inline261.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is always positive in <xref ref-type="disp-formula" rid="eqn67">Eq. (67)</xref>. Thus, we choose the minimum value <inline-formula><inline-graphic xlink:href="531234v4_inline262.gif" mime-subtype="gif" mimetype="image"/></inline-formula> in every selection step.</p>
<p>If the mean <inline-formula><inline-graphic xlink:href="531234v4_inline263.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is larger than <inline-formula><inline-graphic xlink:href="531234v4_inline264.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, the minimum value among <inline-formula><inline-graphic xlink:href="531234v4_inline265.gif" mime-subtype="gif" mimetype="image"/></inline-formula> will be chosen in selection step to compensate the frequency change in maturation step. Let us denote the selected valued of <italic>f</italic> and <italic>h</italic> as <inline-formula><inline-graphic xlink:href="531234v4_inline266.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v4_inline267.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. We temporarily drop time index <italic>τ</italic> for simplicity.</p>
<p>Then, the joint cumulative distribution function <inline-formula><inline-graphic xlink:href="531234v4_inline268.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is
<disp-formula id="eqn81">
<graphic xlink:href="531234v4_eqn81.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
The probability <inline-formula><inline-graphic xlink:href="531234v4_inline269.gif" mime-subtype="gif" mimetype="image"/></inline-formula> can be converted as
<disp-formula id="eqn82">
<graphic xlink:href="531234v4_eqn82.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="531234v4_inline270.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is a conditional joint cumulative distribution function of (<italic>f</italic> <sup>(<italic>i</italic>)</sup>, <italic>h</italic><sup>(<italic>i</italic>)</sup>). The marginal cumulative distribution functions are
<disp-formula id="eqn83">
<graphic xlink:href="531234v4_eqn83.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn84">
<graphic xlink:href="531234v4_eqn84.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Similarly, the probabilities <inline-formula><inline-graphic xlink:href="531234v4_inline271.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v4_inline272.gif" mime-subtype="gif" mimetype="image"/></inline-formula> are converted into <inline-formula><inline-graphic xlink:href="531234v4_inline273.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v4_inline274.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. Thus, the joint cumulative distribution function is
<disp-formula id="eqn85">
<graphic xlink:href="531234v4_eqn85.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Then, the conditional probability of the selected collective is given by
<disp-formula id="eqn86">
<graphic xlink:href="531234v4_eqn86.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="531234v4_inline275.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v4_inline276.gif" mime-subtype="gif" mimetype="image"/></inline-formula></p>
<p>If the mean <inline-formula><inline-graphic xlink:href="531234v4_inline277.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is smaller than <inline-formula><inline-graphic xlink:href="531234v4_inline278.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, the chosen collective is likely to have maximum <italic>f</italic> values among <italic>g</italic> matured collectives. Then, the definition of <italic>f</italic> <sup>*</sup> is written by <inline-formula><inline-graphic xlink:href="531234v4_inline279.gif" mime-subtype="gif" mimetype="image"/></inline-formula>.</p>
<p>We rewrite the joint cumulative distribution function <inline-formula><inline-graphic xlink:href="531234v4_inline280.gif" mime-subtype="gif" mimetype="image"/></inline-formula> to be little different from <xref ref-type="disp-formula" rid="eqn81">Eq. (81)</xref> because now we have to utilize the condition <italic>f</italic> <sup>*</sup> <italic>&lt; f</italic> instead of <italic>f</italic> <sup>*</sup> <italic>&gt; f</italic>,
<disp-formula id="eqn87">
<graphic xlink:href="531234v4_eqn87.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
The probability <inline-formula><inline-graphic xlink:href="531234v4_inline281.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is converted as
<disp-formula id="eqn88">
<graphic xlink:href="531234v4_eqn88.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn89">
<graphic xlink:href="531234v4_eqn89.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Thus, the joint cumulative distribution function is given by
<disp-formula id="eqn90">
<graphic xlink:href="531234v4_eqn90.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
In this case, the conditional probability distribution function is given by
<disp-formula id="eqn91">
<graphic xlink:href="531234v4_eqn91.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
By replacing (<italic>f, h</italic>) to <inline-formula><inline-graphic xlink:href="531234v4_inline282.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, we finally obtain the conditional probability distribution <inline-formula><inline-graphic xlink:href="531234v4_inline283.gif" mime-subtype="gif" mimetype="image"/></inline-formula>,
<disp-formula id="eqn92">
<graphic xlink:href="531234v4_eqn92.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Using <xref ref-type="disp-formula" rid="eqn92">Eq. (92)</xref>, we get the mean values of <italic>f</italic> <sup>*</sup> and <italic>h</italic><sup>*</sup> as
<disp-formula id="eqn93">
<graphic xlink:href="531234v4_eqn93.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn94">
<graphic xlink:href="531234v4_eqn94.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
We define the accessible region in frequency space where the signs of the changes in both F frequency and FF frequency after a cycle are opposite to that of maturation (see <xref rid="figs12" ref-type="fig">Fig. 12</xref>),
<disp-formula id="eqn95">
<graphic xlink:href="531234v4_eqn95.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="531234v4_inline284.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v4_inline285.gif" mime-subtype="gif" mimetype="image"/></inline-formula> are the mean values of F frequencies after the maturation step in cycle <italic>k</italic> + 1 before and after selection, respectively, and <italic>h</italic> values are defined similarly for FF. Or, if the condition is not met, the composition of the selected collective may diverge from the target composition after several cycles. The accessible regions are marked in the gold-colored area in <xref rid="figs12" ref-type="fig">Fig. 12b</xref>. Similar to the two-population case, the accessible region is shaped by the flow velocity of the composition during the maturation step, as depicted in the flow diagram in <xref rid="figs12" ref-type="fig">Fig. 12a</xref>. Both F and FF frequencies tend to increase, and the inter-collective selection can compensate for these changes if the composition changes slowly when the F and FF frequencies are small. However, if the changes occur too rapidly when the FF frequency is intermediate, the frequency cannot be stabilized. So the accessible region is limited to the regions where the composition changes slowly.</p>
<p>This is explainable by projecting the three-population problem into the two-population problem. The selective advantage of FF relative to the rest of collective mainly determines the accessible region. The growth rate of the rest varies from <italic>r</italic><sub><italic>S</italic></sub> to <italic>r</italic><sub><italic>S</italic></sub> + <italic>w</italic> according to F frequency, so the mean growth rate of the rest is written by <inline-formula><inline-graphic xlink:href="531234v4_inline286.gif" mime-subtype="gif" mimetype="image"/></inline-formula> where <italic>f</italic> <sup>′</sup>is F frequency in S+F. Then, the corresponding selective advantage of FF is <inline-formula><inline-graphic xlink:href="531234v4_inline287.gif" mime-subtype="gif" mimetype="image"/></inline-formula> which varies between <italic>ω</italic> to 2<italic>ω</italic>. Using <inline-formula><inline-graphic xlink:href="531234v4_inline288.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v4_inline289.gif" mime-subtype="gif" mimetype="image"/></inline-formula> similar to Sec. II, we get bounds of accessible region (see dashed-line in <xref rid="figs12" ref-type="fig">Fig. 12b</xref>). The boundary from projected problem agreed well with the original three-population problem.</p>
</sec>
<sec id="s6i">
<label>IX.</label>
<title>Derivation of equations</title>
<p>In this section, we go over the derivation of <xref ref-type="disp-formula" rid="eqn10">Eq. (10)</xref>-<xref ref-type="disp-formula" rid="eqn34">(34)</xref> for readers not equipped with advanced mathematics training.</p>
<p>Assumptions: <italic>µ ≪ ω, r</italic><sub><italic>S</italic></sub></p>
<fig id="figs12" position="float" fig-type="figure">
<label>Fig. 12.</label>
<caption><p><bold>a</bold> The flow of composition change in F and FF frequencies at each composition (<italic>f, h</italic>). Top corner indicates that FF cells fix in the collective. Right bottom corner means collectives with only F cells while collectives contain S cells only at left bottom corner. Arrow length means the speed of change. <bold>b</bold> The accessible regions are marked by the gold area. If the signs of changes in both F frequency and FF frequency after inter-collective selection are opposite to those during maturation, then the given composition is accessible. Otherwise, the composition is not accessible and will change after cycles. Dashed lines are the boundary of accessible region by projecting the collective into a two-population problem (FF vs. S+F). The figures are drawn using <italic>mpltern</italic> package [<xref ref-type="bibr" rid="c7">7</xref>].</p></caption>
<graphic xlink:href="531234v4_fig12.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
<sec id="s6i1">
<title><xref ref-type="disp-formula" rid="eqn10">Equations (10)</xref> and <xref ref-type="disp-formula" rid="eqn11">(11)</xref></title>
<p><xref ref-type="disp-formula" rid="eqn10">Equation (10)</xref> is straightforwardly solved by integrating <xref ref-type="disp-formula" rid="eqn8">Eq. (8)</xref>. <xref ref-type="disp-formula" rid="eqn11">Equation (11)</xref> is obtained from <xref ref-type="disp-formula" rid="eqn9">Eq. (9)</xref> using integration factor <inline-formula><inline-graphic xlink:href="531234v4_inline290.gif" mime-subtype="gif" mimetype="image"/></inline-formula>:
<disp-formula id="eqn96">
<graphic xlink:href="531234v4_eqn96.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn97">
<graphic xlink:href="531234v4_eqn97.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Integrating both sides, we get <inline-formula><inline-graphic xlink:href="531234v4_inline291.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. Thus,
<disp-formula id="eqn98">
<graphic xlink:href="531234v4_eqn98.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
</p>
</sec>
<sec id="s6i2">
<title>Equations (16) and (17)</title>
<p>Applying <xref ref-type="disp-formula" rid="eqn4">Eq. (4)</xref>, we have
<disp-formula id="eqn99">
<graphic xlink:href="531234v4_eqn99.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
We collect the two violet-colored terms and change the order of summation. Note that the first violet-colored term does not change regardless of whether <italic>S</italic> starts from 0 or 1 because the term is zero for <italic>S</italic> = 0. Thus, the first violet-colored term is equivalent to <inline-formula><inline-graphic xlink:href="531234v4_inline292.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. Let <italic>α</italic> = <italic>S</italic> − 1, and this becomes <inline-formula><inline-graphic xlink:href="531234v4_inline293.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. We reassign <italic>α</italic> as <italic>S</italic>, and obtain:
<disp-formula id="eqn100">
<graphic xlink:href="531234v4_eqn100.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
We collect the two green terms, and similarly obtain:
<disp-formula id="eqn101">
<graphic xlink:href="531234v4_eqn101.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Finally, we collect the two orange terms. For the first orange term, the sum is the same regardless of whether we start from <italic>S</italic> = 0 or −1. Let <italic>S</italic> start from −1, and we have
<disp-formula id="eqn102">
<graphic xlink:href="531234v4_eqn102.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Let <italic>α</italic> = <italic>S</italic> + 1, then the term becomes <inline-formula><inline-graphic xlink:href="531234v4_inline294.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. We reassign <italic>α</italic> as <italic>S</italic>, and additionally apply index change on <italic>F</italic> − 1:
<disp-formula id="eqn103">
<graphic xlink:href="531234v4_eqn103.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Now, add the three parts together, and we have
<disp-formula id="eqn104">
<graphic xlink:href="531234v4_eqn104.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
which is <xref ref-type="disp-formula" rid="eqn16">Eq. (16)</xref>. Likewise,
<disp-formula id="eqn105">
<graphic xlink:href="531234v4_eqn105.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn106">
<graphic xlink:href="531234v4_eqn106.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
which is <xref ref-type="disp-formula" rid="eqn17">Eq. (17)</xref>.</p>
</sec>
<sec id="s6i3">
<title><xref ref-type="disp-formula" rid="eqn18">Equation (18)</xref> and <xref ref-type="disp-formula" rid="eqn20">(20)</xref></title>
<p>Using integration factor <inline-formula><inline-graphic xlink:href="531234v4_inline295.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <xref ref-type="disp-formula" rid="eqn16">Eq. (16)</xref>, we have:
<disp-formula id="eqn107">
<graphic xlink:href="531234v4_eqn107.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn108">
<graphic xlink:href="531234v4_eqn108.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn109">
<graphic xlink:href="531234v4_eqn109.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Since <italic>µ ≪ r</italic><sub><italic>S</italic></sub>, we have
<disp-formula id="eqn110">
<graphic xlink:href="531234v4_eqn110.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="531234v4_inline296.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is the expected <italic>S</italic><sup>2</sup> at time 0. For <xref ref-type="disp-formula" rid="eqn20">Eq. (20)</xref>,
<disp-formula id="eqn111">
<graphic xlink:href="531234v4_eqn111.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
</p>
</sec>
<sec id="s6i4">
<title>Equation (22) and (23)</title>
<p>Since <inline-formula><inline-graphic xlink:href="531234v4_inline297.gif" mime-subtype="gif" mimetype="image"/></inline-formula>,
<disp-formula id="eqn112">
<graphic xlink:href="531234v4_eqn112.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
We can solve this, again using the integration factor technique above:
<disp-formula id="eqn113">
<graphic xlink:href="531234v4_eqn113.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Thus, we have
<disp-formula id="eqn114">
<graphic xlink:href="531234v4_eqn114.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
which results in
<disp-formula id="eqn115">
<graphic xlink:href="531234v4_eqn115.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
</p>
</sec>
<sec id="s6i5">
<title>Equation (24)</title>
<p>From <xref ref-type="disp-formula" rid="eqn17">Eq. (17)</xref>, we have
<disp-formula id="eqn116">
<graphic xlink:href="531234v4_eqn116.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
The right-hand side becomes
<disp-formula id="eqn117">
<graphic xlink:href="531234v4_eqn117.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Note that we have checked that the second and third terms of <inline-formula><inline-graphic xlink:href="531234v4_inline298.gif" mime-subtype="gif" mimetype="image"/></inline-formula> can be ignored after we compare the full calculation with this simpler version. Integrate both sides:
<disp-formula id="eqn118">
<graphic xlink:href="531234v4_eqn118.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Then, we have
<disp-formula id="eqn119">
<graphic xlink:href="531234v4_eqn119.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
</p>
</sec>
<sec id="s6i6">
<title><xref ref-type="disp-formula" rid="eqn25">Equation (25)</xref></title>
<p>
<disp-formula id="eqn120">
<graphic xlink:href="531234v4_eqn120.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
</p>
</sec>
<sec id="s6i7">
<title><xref ref-type="disp-formula" rid="eqn32">Equations (32)</xref>-<xref ref-type="disp-formula" rid="eqn34">(34)</xref></title>
<p>To derive this equation, we use the fact that 1<italic>/</italic>(1 + <italic>x</italic>) ∼1 − <italic>x</italic> for small <italic>x</italic>. We will omit (<italic>t</italic>) for simplicity. Also note that we are considering relatively large populations so that the standard deviation is much smaller than the mean.
<disp-formula id="eqn121">
<graphic xlink:href="531234v4_eqn121.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Recall that if <italic>A</italic> ∼ 𝒩 (<italic>µ</italic><sub><italic>A</italic></sub>, <italic>σ</italic><sub><italic>A</italic></sub>), <italic>B</italic> ∼ 𝒩 (<italic>µ</italic><sub><italic>B</italic></sub>, <italic>σ</italic><sub><italic>B</italic></sub>), then <inline-formula><inline-graphic xlink:href="531234v4_inline299.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. Thus, <italic>f</italic> is distributed as a Gaussian with the mean of
<disp-formula id="eqn122">
<graphic xlink:href="531234v4_eqn122.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Note that the initial value of mean <inline-formula><inline-graphic xlink:href="531234v4_inline300.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is equal to the mean of the binomial distribution <xref ref-type="disp-formula" rid="eqn29">Eq. (29)</xref>, <inline-formula><inline-graphic xlink:href="531234v4_inline301.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. The variance is
<disp-formula id="eqn123">
<graphic xlink:href="531234v4_eqn123.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
</p>
</sec>
</sec>
<ref-list>
<ref id="sc1"><label>[1]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Gillespie</surname>, <given-names>D. T.</given-names></string-name></person-group> <article-title>Approximate accelerated stochastic simulation of chemically reacting systems</article-title>. <source>The Journal of Chemical Physics</source> <volume>115</volume>, <fpage>1716</fpage>–<lpage>1733</lpage> (<year>2001</year>).</mixed-citation></ref>
<ref id="sc2"><label>[2]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Cao</surname>, <given-names>Y.</given-names></string-name>, <string-name><surname>Gillespie</surname>, <given-names>D. T.</given-names></string-name> &amp; <string-name><surname>Petzold</surname>, <given-names>L. R.</given-names></string-name></person-group> <article-title>Efficient step size selection for the tau-leaping simulation method</article-title>. <source>The Journal of Chemical Physics</source> <volume>124</volume>, <fpage>044109</fpage> (<year>2006</year>).</mixed-citation></ref>
<ref id="sc3"><label>[3]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zheng</surname>, <given-names>Q.</given-names></string-name></person-group> <article-title>Progress of a half century in the study of the luria–delbrück distribution</article-title>. <source>Mathematical Biosciences</source> <volume>162</volume>, <fpage>1</fpage>–<lpage>32</lpage> (<year>1999</year>).</mixed-citation></ref>
<ref id="sc4"><label>[4]</label><mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Gumbel</surname>, <given-names>E. J.</given-names></string-name></person-group> <source>Statistics of extremes</source> (<publisher-name>Columbia university press</publisher-name>, <year>1958</year>).</mixed-citation></ref>
<ref id="sc5"><label>[5]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Philip</surname>, <given-names>J.</given-names></string-name></person-group> <article-title>The function inverfc theta</article-title>. <source>Australian Journal of Physics</source> <volume>13</volume>, <fpage>13</fpage> (<year>1960</year>).</mixed-citation></ref>
<ref id="sc6"><label>[6]</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Xie</surname>, <given-names>L.</given-names></string-name>, <string-name><surname>Yuan</surname>, <given-names>A. E.</given-names></string-name> &amp; <string-name><surname>Shou</surname>, <given-names>W.</given-names></string-name></person-group> <article-title>Simulations reveal challenges to artificial community selection and possible strategies for success</article-title>. <source>PLoS Biology</source> <volume>17</volume>, <fpage>e3000295</fpage> (<year>2019</year>).</mixed-citation></ref>
<ref id="sc7"><label>[7]</label><mixed-citation publication-type="software"><person-group person-group-type="author"><string-name><surname>Ikeda</surname>, <given-names>Y.</given-names></string-name>, <string-name><surname>Grabowski</surname>, <given-names>B.</given-names></string-name> &amp; <string-name><surname>Körmann</surname>, <given-names>F.</given-names></string-name></person-group> <article-title>mpltern 0.3.0: ternary plots as projections of Matplotlib</article-title> <source>Zenodo</source> (<year>2019</year>). Available at <pub-id pub-id-type="doi">10.5281/zenodo.3528355</pub-id>.</mixed-citation></ref>
</ref-list>
</app>
</app-group>
</back>
<sub-article id="sa0" article-type="editor-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.97461.2.sa3</article-id>
<title-group>
<article-title>eLife Assessment</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<name>
<surname>Bitbol</surname>
<given-names>Anne-Florence</given-names>
</name>
<role specific-use="editor">Reviewing Editor</role>
<aff>
<institution-wrap>
<institution>Ecole Polytechnique Federale de Lausanne (EPFL)</institution>
</institution-wrap>
<city>Lausanne</city>
<country>Switzerland</country>
</aff>
</contrib>
</contrib-group>
<kwd-group kwd-group-type="evidence-strength">
<kwd>Compelling</kwd>
</kwd-group>
<kwd-group kwd-group-type="claim-importance">
<kwd>Important</kwd>
</kwd-group>
</front-stub>
<body>
<p>This <bold>important</bold> study of artificial selection in microbial communities shows that the possibility of selecting a desired fraction of slow and fast-growing types is impacted by their initial fractions. The evidence, which relies on mathematical analysis and simulations of a stochastic model, is <bold>compelling</bold>. It highlights the tension between selection at the strain and the community level. This study should be of interest to researchers interested in ecology, both theoretical and experimental.</p>
</body>
</sub-article>
<sub-article id="sa1" article-type="referee-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.97461.2.sa2</article-id>
<title-group>
<article-title>Reviewer #1 (Public review):</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<anonymous/>
<role specific-use="referee">Reviewer</role>
</contrib>
</contrib-group>
</front-stub>
<body>
<p>Summary:</p>
<p>The authors demonstrate with a simple stochastic model that the initial composition of the community is important in achieving a target frequency during the artificial selection of a community.</p>
<p>Strengths:</p>
<p>To my knowledge, the intra-collective selection during artificial selection has not been seriously theoretically considered. However, in many cases, the species dynamics during the incubation of each selection cycle is important and relevant to the outcome of the artificial selection experiment. Stochasticity from birth and death (demographic stochasticity) plays a big role in these species' abundance dynamics. This work uses a simple framework to tackle this idea meticulously.</p>
<p>This work may or may not be related to hysteresis (path dependency). If this is true, maybe it would be nice to have a discussion paragraph talking about how this may be the case. Then, this work would even attract the interest of people studying dynamical systems.</p>
<p>Weaknesses:</p>
<p>(1) Connecting structure and function.</p>
<p>
In typical artificial selection literature, most of them select the community based on collective function. Here in this paper, the authors are selecting a target composition. Although there is a schematic cartoon illustrating the relationship between collective function (y-axis) and the community composition in the main figure 1, there is no explicit explanation or justification of what may be the origin of this relationship. I think giving the readers a naïve idea about how this structure-function relationship arises in the introduction section would help. This is because the conclusion of this paper is that the intra-collective selection makes it hard to artificially select for a community that has an intermediate frequency of f (or s). If there is really evidence or theoretical derivation from this framework that indeed the highest function comes from the intermediate frequency of f, then the impact of this paper would increase because the conclusions of this stochastic model could allude to the reasons for the prevalent failures of artificial selection in literature.</p>
<p>(2) Explain intra-collective and inter-collective selection better for readers.</p>
<p>
The abstract, the introduction, and the result section use these terms or intra-collective and inter-collective selection without much explanation. For the wide readership of eLife, a clear definition in the beginning would help the audience grasp the importance of this paper, because these concepts are at the core of this work.</p>
<p>(3) Achievable target frequency strongly depending on the degree of demographic stochasticity.</p>
<p>
I would expect that the experimentalists would find these results interesting and would want to consider these results during their artificial selection experiments. The main figure 4 indicates that the Newborn size N0 is a very important factor to consider during the artificial selection experiment. This would be equivalent to how much bottleneck you impose on the artificial selection process in every iteration step (i.e., the ratio of serial dilution experiment). However, with a low population size, all target frequencies can be achieved, and therefore in these regimes, the initial frequency now does not matter much. It would be great for the authors to provide what the N0 parameter actually means during the artificial selection experiments. Maybe relative to some other parameter in the model. I know this could be very hard. But without this, the main result of this paper (initial frequency matters) cannot be taken advantage of by the experimentalists.</p>
<p>(4) Consideration of environmental stochasticity.</p>
<p>
The success (gold area of Figure 2d) in this framework mainly depends on the size of the demographic stochasticity (birth-only model) during the intra-collective selection. However, during experiments, a lot of environmental stochasticity appears to be occurring during artificial selection. This may be out of the scope of this study. But it would definitely be exciting to see how much environmental stochasticity relative to the demographic stochasticity (variation in the Gaussian distribution of F and S) matters in succeeding in achieving the target composition from artificial selection.</p>
<p>(5) Assumption about mutation rates</p>
<p>
If setting the mutation rates to zero does not change the result of the simulations and the conclusion, what is the purpose of having the mutation rates \mu? Also, is the unidirectional (S -&gt; F -&gt; FF) mutation realistic? I didn't quite understand how the mutations could fit into the story of this paper.</p>
<p>(6) Minor points</p>
<p>
In Figure 3b, it is not clear to me how the frequency difference for the Intra-collective and the Inter-collective selection is computed.</p>
<p>
In Figure 5b, the gold region (success) near the FF is not visible. Maybe increase the size of the figure or have an inset for zoom-in. Why is the region not as big as the bottom gold region?</p>
<p>Comments on revisions:</p>
<p>I thank the authors for addressing many points raised by the reviewers. Overall, the readability of the manuscript has improved with more context provided around why they were solving this specific problem. However, I've found many of the responses to be too terse. It would have been nicer if there had been more discussion and description of the thought process that led up to the conclusions they made for each comment or question. Instead, many of the responses only showed the screenshot of the text they added.</p>
<p>Most of my comments or questions were answered. Below are my comments on some of the authors' responses.</p>
<p>(2) Explain intra-collective and inter-collective selection better for readers.</p>
<p>
In the Abstract and Introduction, you've added more sentences about the intra-collective or inter-collective selection. However, these are either making analogies to the waterfall or just describing the result of the intra/inter-collective selection. I would still appreciate a proper definition of those terms, which is paramount for readers to understand the entire paper.</p>
<p>(4) Consideration of environmental stochasticity.</p>
<p>
I think providing the reason 'why' the paper focuses on demographic stochasticity and not environmental stochasticity will greatly justify the paper's work. For example, citing papers that actually performed artificial selection and pointing out that your model captures the stochasticity from those kinds of experiments would be great.</p>
<p>(5) Assumption about mutation rates.</p>
<p>
It would be great if you could add a citation in the added sentence to support your claim: &quot;This scenario is encountered in biotechnology: .....&quot;.</p>
</body>
</sub-article>
<sub-article id="sa2" article-type="referee-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.97461.2.sa1</article-id>
<title-group>
<article-title>Reviewer #3 (Public review):</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<anonymous/>
<role specific-use="referee">Reviewer</role>
</contrib>
</contrib-group>
</front-stub>
<body>
<p>The authors address the process of community evolution under collective-level selection for a prescribed community composition. They mostly consider communities composed of two types that reproduce at different rates, and that can mutate one into the other. Due to such difference in 'fitness' and to the absence of density dependence, within-collective selection is expected to always favour the fastest grower, but collective-level selection can oppose this tendency, to a certain extent at least. By approximating the stochastic within-generation dynamics and solving it analytically, the authors show that not only high frequencies of fast growers can be reproducibly achieved, aligned with their fitness advantage. Small target frequencies can also be maintained, provided that the initial proportion of fast growers is sufficiently small. In this regime, similar to the 'stochastic corrector' model, variation upon which selection acts is maintained by a combination of demographic stochasticity and of sampling at reproduction. These two regions of achievable target compositions are separated by a gap, encompassing intermediate frequencies that are only achievable when the bottleneck size is small enough or the number of communities is (disproportionately) large.</p>
<p>A similar conclusion, that stochastic fluctuations can maintain the system over evolutionary time far from the prevalence of the faster-growing type, is then confirmed by analyzing a three-species community, suggesting that the qualitative conclusions of this study are generalizable to more complex communities.</p>
<p>I expect that these results will be of broad interest to the community of researchers who strive to improve community-level selection but are often limited to numerical explorations, with prohibitive costs for a full characterization of the parameter space of such embedded populations. The realization that not all target collective functions can be as easily achieved and that they should be adapted to the initial conditions and the selection protocol is also a sobering message for designing concrete applications.</p>
<p>A major strength of this work is that the qualitative behaviour of the system is captured by an analytically solvable approximation so that the extent of the 'forbidden region' can be directly and generically related to the parameters of the selection protocol.</p>
<p>The phenomenon the authors characterize is ecological in nature, though it is maintained even when switching between types is possible. Calling this dynamics community evolution reflects a widespread ambiguity in the field, not ascribable just to this work.</p>
<p>Although different types compete for being represented in the next generation's propagules, within-generation ecology is here representative of exponential growth. As species interactions are commonly manifest in lab serial dilution experiments, it would be interesting if future work explores the extent of the robustness of these results to density-dependent demography.</p>
</body>
</sub-article>
<sub-article id="sa3" article-type="author-comment">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.97461.2.sa0</article-id>
<title-group>
<article-title>Author response:</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<name>
<surname>Lee</surname>
<given-names>Juhee</given-names>
</name>
<role specific-use="author">Author</role>
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-3318-6377</contrib-id></contrib>
<contrib contrib-type="author">
<name>
<surname>Shou</surname>
<given-names>Wenying</given-names>
</name>
<role specific-use="author">Author</role>
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-5693-381X</contrib-id></contrib>
<contrib contrib-type="author">
<name>
<surname>Park</surname>
<given-names>Hye Jin</given-names>
</name>
<role specific-use="author">Author</role>
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-3552-6275</contrib-id></contrib>
</contrib-group>
</front-stub>
<body>
<p>The following is the authors’ response to the original reviews.</p>
<p>Common comments</p>
<p>(1) Significance of zero mutation rate</p>
<p>Reviewers asked why we included mutation rate even though setting mutation rate to zero doesn’t change results. We think that including non-zero mutation rate makes our results more generalisable, and thus is a strength rather than weakness. To better motivate this choice, we have added a sentence to the beginning of Results:</p>
<p>(2) Writing the mu=0 case first</p>
<p>Reviewers suggested that we should first focus on the mu=0 case, and then generalize the result. The suggestions are certainly good. However, given the large amount of work involved in a re-organization, we have decided to adhere to our current narrative. However, we now only include equations where mu=0 in the main text, and have moved the case of nonzero mutation rate to Supplementary Information.</p>
<p>(3) Making equations more accessible</p>
<p>We have taken three steps to make equations more readable.</p>
<p>● Equations in the main text correspond to the case of zero-mutation rate.</p>
<p>● The original section on equation derivation is now in a box in the main text so that readers have the choice of skipping it but interested readers can still get a gist of where equations came from.</p>
<p>● We have provided a much more detailed interpretation of the equation (see page 10).</p>
<p>(4) Validity of the Gaussian approximation</p>
<p>Reviewers raised concerns about the validity of Gaussian approximation on F frequency𝑓(𝜏). The fact that our calculations closely match simulations suggest that this approximation is reasonable. Still, we added a discussion about the validity of this approximation in Box 1.</p>
<p>We also added to SI with various cases of initial S and F sizes. This figure shows that when either initial S or initial F is small, the distribution of𝑓(𝜏) is not normal. However, if initial S and F are both on the order of hundreds, then the distribution of 𝑓(𝜏) is approximately Gaussian.</p>
<disp-quote content-type="editor-comment">
<p><bold>Public Reviews:</bold></p>
<p>Summary:</p>
<p>The authors demonstrate with a simple stochastic model that the initial composition of the community is important in achieving a target frequency during the artificial selection of a community.</p>
<p>Strengths:</p>
<p>To my knowledge, the intra-collective selection during artificial selection has not been seriously theoretically considered. However, in many cases, the species dynamics during the incubation of each selection cycle are important and relevant to the outcome of the artificial selection experiment. Stochasticity from birth and death (demographic stochasticity) plays a big role in these species' abundance dynamics. This work uses a simple framework to tackle this idea meticulously.</p>
<p>This work may or may not be hysteresis (path dependency). If this is true, maybe it would be nice to have a discussion paragraph talking about how this may be the case. Then, this work would even attract the interest of people studying dynamic systems.</p>
</disp-quote>
<p>We have added this clarification in the main text:</p>
<p>“Note that here, selection outcome is path-dependent in the sense of being sensitive to initial conditions. This phenomenon is distinct from hysteresis where path-dependence results from whether a tuning parameter is increased or decreased.</p>
<disp-quote content-type="editor-comment">
<p>Weaknesses:</p>
<p>(1) Connecting structure and function</p>
<p>In typical artificial selection literature, most of them select the community based on collective function. Here in this paper, the authors are selecting a target composition. Although there is a schematic cartoon illustrating the relationship between collective function (y-axis) and the community composition in the main Figure 1, there is no explicit explanation or justification of what may be the origin of this relationship. I think giving the readers a naïve idea about how this structure-function relationship arises in the introduction section would help. This is because the conclusion of this paper is that the intra-collective selection makes it hard to artificially select a community that has an intermediate frequency of f (or s). If there is really evidence or theoretical derivation from this framework that indeed the highest function comes from the intermediate frequency of f, then the impact of this paper would increase because the conclusions of this stochastic model could allude to the reasons for the prevalent failures of artificial selection in literature.</p>
</disp-quote>
<p>We have added this to introduction: “This is a common quest: whenever a collective function depends on both populations, collective function is maximised, by definition, at an intermediate frequency (e.g. too little of either population will hamper function [23]).”</p>
<disp-quote content-type="editor-comment">
<p>(2) Explain intra-collective and inter-collective selection better for readers.</p>
<p>The abstract, the introduction, and the result section use these terms or intra-collective and inter-collective selection without much explanation. For the wide readership of eLife, a clear definition in the beginning would help the audience grasp the importance of this paper, because these concepts are at the core of this work.</p>
</disp-quote>
<p>This is a great point. We have added in Abstract:</p>
<p>“Such collective selection is dictated by two opposing forces: during collective maturation, intra-collective selection acts like a waterfall, relentlessly driving the S-frequency to lower values, while during collective reproduction, inter-collective selection resembles a rafter striving to reach the target frequency. Due to this model structure, maintaining a target frequency requires the continued action of inter-collective selection.”</p>
<p>and in Introduction</p>
<p>“A selection cycle consists of three stages (Fig. 1). During collective maturation, intra-collective selection favors fast-growing individuals within a collective. At the end of maturation, inter-collective selection acts on collectives and favors those achieving the target composition. Finally during collective reproduction, offspring collectives sample stochastically from the parents, a process dominated by genetic drift.”</p>
<disp-quote content-type="editor-comment">
<p>(3) Achievable target frequency strongly depending on the degree of demographic stochasticity.</p>
<p>I would expect that the experimentalists would find these results interesting and would want to consider these results during their artificial selection experiments. The main Figure 4 indicates that the Newborn size N0 is a very important factor to consider during the artificial selection experiment. This would be equivalent to how much bottleneck is imposed on the artificial selection process in every iteration step (i.e., the ratio of serial dilution experiment). However, with a low population size, all target frequencies can be achieved, and therefore in these regimes, the initial frequency now does not matter much. It would be great for the authors to provide what the N0 parameter actually means during the artificial selection experiments. Maybe relative to some other parameter in the model. I know this could be very hard. But without this, the main result of this paper (initial frequency matters) cannot be taken advantage of by the experimentalists.</p>
</disp-quote>
<p>We have added an analytical approximation for N0˘, the Newborn size below which all target frequencies can be achieved in SI.</p>
<p>Also, we have added lines indicating N0˘ in Fig4a.</p>
<disp-quote content-type="editor-comment">
<p>(4) Consideration of environmental stochasticity.</p>
<p>The success (gold area of Figure 2d) in this framework mainly depends on the size of the demographic stochasticity (birth-only model) during the intra-collective selection. However, during experiments, a lot of environmental stochasticity appears to be occurring during artificial selection. This may be out of the scope of this study. But it would definitely be exciting to see how much environmental stochasticity relative to the demographic stochasticity (variation in the Gaussian distribution of F and S) matters in succeeding in achieving the target composition from artificial selection.</p>
</disp-quote>
<p>You are correct that our work considers only demographic stochasticity.</p>
<p>Indeed, considering other types of stochasticity will be an exciting future research direction. We added in the main text:</p>
<p>“Overall our model considers mutational stochasticity, as well as demographic stochasticity in terms of stochastic birth and stochastic sampling of a parent collective by offspring collectives. Other types of stochasticity, such as environmental stochasticity and measurement noise, are not considered and require future research.”</p>
<disp-quote content-type="editor-comment">
<p>(5) Assumption about mutation rates</p>
<p>If setting the mutation rates to zero does not change the result of the simulations and the conclusion, what is the purpose of having the mutation rates \mu? Also, is the unidirectional (S -&gt; F -&gt; FF) mutation realistic? I didn't quite understand how the mutations could fit into the story of this paper.</p>
</disp-quote>
<p>This is a great point. We have added this to the beginning of Results to better motivate our study:</p>
<p>“We will start with a complete model where S mutates to F at a nonzero mutation rate µ. We made this choice because it is more challenging to attain or maintain the target frequency when the abundance of fast-growing <italic>F</italic> is further increased via mutations. This scenario is encountered in biotechnology: an engineered pathway will slow down growth, and breaking the pathway (and thus faster growth) is much easier than the other way around. When the mutation rate is set to zero, the same model can be used to capture collectives of two species with different growth rates.</p>
<p>See answer on common question 1.</p>
<disp-quote content-type="editor-comment">
<p>(6) Minor points</p>
<p>In Figure 3b, it is not clear to me how the frequency difference for the Intra-collective and the Inter-collective selection is computed.</p>
</disp-quote>
<p>We added a description in caption 3b.</p>
<disp-quote content-type="editor-comment">
<p>In Figure 5b, the gold region (success) near the FF is not visible. Maybe increase the size of the figure or have an inset for zoom-in. Why is the region not as big as the bottom gold region?</p>
</disp-quote>
<p>We increased the resolution of Fig 5b so that the gold region near FF is more visible.</p>
<p>We have added Fig 5c and the following explanation to the main text:</p>
<p>“From numerical simulations, we identified two accessible regions: a small region near FF and a band region spanning from S to F (gold in Fig. 5b i). Intuitively, the rate at which FF grows faster than S+F is greater than the rate at which F grows faster than S (see section VIII in Supplementary Information). Thus, the problem can initially be reduced to a two-population problem (i.e. FF versus F+S; Fig. 5c left), and then expanded to a three-population problem (Fig. 5c right).”</p>
<disp-quote content-type="editor-comment">
<p><bold>Recommendations For The Authors</bold></p>
<p>Since the conclusion of the model greatly depends on the noise (variation) of F and S in the Gaussian distribution, it would be nice to have a plot where the y-axis is the variation in terms of frequency and the x-axis is the s_0 or f_0 (frequency). In the plot, I would love to see how the variation in the frequency depends on the initial frequency of S and F. Maybe this is just trivial.</p>
</disp-quote>
<p>In the SI, we added Fig6a, as per your request. Previous Fig6 became Fig6b.</p>
<disp-quote content-type="editor-comment">
<p><bold>Reviewer #2 (Public review):</bold></p>
<p>The authors provide an analytical framework to model the artificial selection of the composition of communities composed of strains growing at different rates. Their approach takes into account the competition between the targeted selection at the level of the meta-community and the selection that automatically favors fast-growing cells within each replicate community. Their main finding is a tipping point or path-dependence effect, whereby compositions dominated by slow-growing types can only be reached by community-level selection if the community does not start and never crosses into a range of compositions dominated by fast growers during the dynamics.</p>
<p>These results seem to us both technically correct and interesting. We commend the authors on their efforts to make their work reproducible even when it comes to calculations via extensive appendices, though perhaps a table of contents and a short description of these appendices at the start of SI would help navigate them.</p>
</disp-quote>
<p>Thank you for the suggestion. We have added a paragraph at the beginning of SI.</p>
<disp-quote content-type="editor-comment">
<p>The main limitation in the current form of the article is that it could clarify how its assumptions and findings differ from and improve upon the rest of the literature:</p>
<p>-  Many studies discuss the interplay between community-level evolution and species- or strain-level evolution. But &quot;evolution&quot; can be a mix of various forces, including selection, drift/randomness, and mutation/innovation.</p>
<p>- This work's specificity is that it focuses strictly on constant community-level selection versus constant strain-level selection, all other forces being negligible (neither stochasticity nor innovation/mutation matter at either level, as we try to clarify now).</p>
</disp-quote>
<p>Note that intra-collective selection is not strictly “constant” in the sense that selection favoring F is the strongest at intermediate F frequency (Fig 3). However, we think that you mean that intra- and inter-collective selection are present in every cycle, and this is correct for our case, and for community selection in general.</p>
<disp-quote content-type="editor-comment">
<p>-  Regarding constant community-level selection, it is only briefly noted that &quot;once a target frequency is achieved, inter-collective selection is always required to maintain that frequency due to the fitness difference between the two types&quot; [pg. 3 {section sign}2]. In other words, action from the selector is required indefinitely to maintain the community in the desired state. This assumption is found in a fraction of the literature, but is still worth clarifying from the start as it can inform the practical applicability of the results.</p>
</disp-quote>
<p>This is a good point. We have added to abstract:</p>
<p>“Such collective selection is dictated by two opposing forces: during collective maturation, intra-collective selection acts like a waterfall, relentlessly driving the S-frequency to lower values, while during collective reproduction, inter-collective selection resembles a rafter striving to reach the target frequency. Due to this model structure, maintaining a target frequency requires the continued action of inter-collective selection.”</p>
<disp-quote content-type="editor-comment">
<p>- More importantly, strain-level evolution also boils down here to pure selection with a constant target, which is less usual in the relevant literature. Here, (1) drift from limited population sizes is very small, with no meaningful counterbalancing of selection, (2) pure exponential regime with constant fitness, no interactions, no density- or frequency-dependence, (3) there is no innovation in the sense that available types are unchanging through time (no evolution of traits such as growth rate or interactions) and (4) all the results presented seem unchanged when mutation rate mu = 0 (as noted in Appendix III), meaning that the conclusions are not &quot;about&quot; mutation in any meaningful way.</p>
</disp-quote>
<p>With regard to point (1), Figure 4a (reproduced below) shows how Newborn size affects the region of achievable targets. Indeed at large Newborn size (e.g. 5000 and above), no target frequency is achievable (since drift is too small to generate sufficient inter-community variation and consequently all communities are dominated by fast-growing F). However at Newborn size of for example 1000, there are two regions of accessible target frequencies. At smaller Newborn size, all target frequencies become achievable due to drift becoming sufficiently strong.</p>
<p>With regard to points (2) and (3), we have added to Introduction</p>
<p>“To enable the derivation of an analytical expression, we have made the following simplifications.</p>
<p>First, growth is always exponential, without complications such as resource limitation, ecological interactions between the two populations, or density-dependent growth. Thus, the exponential growth equation can be used. Second, we consider only two populations (genotypes or species): the fast-growing <italic>F</italic> population with size F and the slow-growing S population with size S. We do not consider a spectrum of mutants or species, since with more than two populations, an analytical solution becomes very difficult.”</p>
<p>With regard to point (4), we view this as a strength rather than weakness. We have added the following to the beginning of Results and Discussions:</p>
<p>“We will start with a complete model where S mutates to F at a nonzero mutation rate µ. We made this choice because it is more challenging to attain or maintain the target frequency when the abundance of fast-growing F is further increased via mutations.”</p>
<p>“When the mutation rate is set to zero, the same model can be used to capture collectives of two species with different growth rates.”</p>
<p>See Point 1 of Common comments.</p>
<disp-quote content-type="editor-comment">
<p>- Furthermore, the choice of mutation mechanism is peculiar, as it happens only from slow to fast grower: more commonly, one assumes random non-directional mutations, rather than purely directional ones from less fit to fitter (which is more of a &quot;Lamarckian&quot; idea). Given that mutation does not seem to matter here, this choice might create unnecessary opposition from some readers or could be considered as just one possibility among others.</p>
</disp-quote>
<p>We have added the following justification:</p>
<p>“This scenario is encountered in biotechnology: an engineered pathway will slow down growth, and breaking the pathway (and thus faster growth) is much easier than the other way around.”</p>
<disp-quote content-type="editor-comment">
<p>It would be helpful to have all these points stated clearly so that it becomes easy to see where this article stands in an abundant literature and contributes to our understanding of multi-level evolution, and why it may have different conclusions or focus than others tackling very similar questions.</p>
<p>Finally, a microbial context is given to the study, but the assumptions and results are in no way truly tied to that context, so it should be clear that this is just for flavor.</p>
</disp-quote>
<p>We have deleted “microbial” from the title, and revised our abstract:</p>
<disp-quote content-type="editor-comment">
<p><bold>Recommendations For The Authors</bold></p>
<p>(1) More details concerning our main remark above:</p>
<p>- The paragraph discussing refs [24, 33] is not very clear in how they most importantly differ from this study. Our impression is that the resource aspect is not very important for instance, and the main difference is that these other works assume that strains can change in their traits.</p>
</disp-quote>
<p>We are fairly sure that resource depletion is important in Rainey group’s study, as the attractor only evolved after both strains grew fast enough to deplete resources by the end of maturation. Indeed, evolution occurred in interaction coefficients which dictate the competition between strains for resources.</p>
<p>Regardless, you raised an excellent point. As discussed earlier, we have added the following:</p>
<p>“To enable the derivation of an analytical expression, we have made the following simplifications.</p>
<p>First, growth is always exponential, without complications such as resource limitation, ecological interactions between the two populations, or density-dependent growth. Thus, the exponential growth equation can be used. Second, we consider only two populations (genotypes or species): the fast-growing <italic>F</italic> population with size F and the slow-growing S population with size S. We do not consider a spectrum of mutants or species, since with more than two populations, an analytical solution becomes very difficult.”</p>
<disp-quote content-type="editor-comment">
<p>- We would advise the main text to focus on mu = 0, and only say in discussion that results can be generalized.</p>
</disp-quote>
<p>Your suggestion is certainly good. However, given the large amount of work involved in a reorganisation, we have decided to adhere to our current narrative. However, as discussed earlier, we have added this at the beginning of Results to help orient readers:</p>
<p>“We will start with a complete model where S mutates to F at a nonzero mutation rate µ. We made this choice because it is more challenging to attain or maintain the target frequency when the abundance of fast-growing F is further increased via mutations.”</p>
<p>“When the mutation rate is set to zero, the same model can be used to capture collectives of two species with different growth rates.”</p>
<disp-quote content-type="editor-comment">
<p>(2) We think the material on pg. 5 &quot;Intra-collective evolution is the fastest at intermediate F frequencies, creating the &quot;waterfall&quot; phenomenon&quot;, although interesting, could be presented in a different way. The mathematical details on how to find the probability distribution of the maximum of independent random variables (including Equation 1) will probably be skipped by most of the readers (for experienced theoreticians, it is standard content; for experimentalists, it is not the most relevant), as such I would recommend displacing them to SM and report only the important results.</p>
</disp-quote>
<p>This is an excellent suggestion. We have put a sketch of our calculations in a box in the main text to help orient interested readers. As before, details are in SI.</p>
<disp-quote content-type="editor-comment">
<p>Similarly, Equations 2, 3, and 4 are hard to read given the large amount of parameters and the low amount of simplification. Although exploring the effect of the different parameters through Figures 3 and 4 is useful, I think the role of the equations should be reconsidered:</p>
<p>i. Is it possible to rewrite them in terms of effective variables in a more concise way?</p>
</disp-quote>
<p>See Point 3 of Common comments.</p>
<disp-quote content-type="editor-comment">
<p>ii. Is it possible to present extreme/particular cases in which they are easier to interpret?</p>
</disp-quote>
<p>We have focused on the case where the mutation rate is zero. This makes the mathematical expressions much simpler (see above).</p>
<disp-quote content-type="editor-comment">
<p>(3) Is it possible to explain more in detail why the distribution of f_k+1 conditional to f_k^* is well approximated by a Gaussian? Also, have you explored to what extent the results would change if this were not true (in light of the few universal classes for the maximum of independent variables)?</p>
</disp-quote>
<p>Despite the appeal to the CLT and the histograms in the Appendix suggesting that the distribution looks a bit like a Gaussian at a certain scale, fluctuations on that scale are not necessarily what is relevant for the results - a rapid (and maybe wrong) attempt at a characteristic function calculation suggests that in your case, one does not obtain convergence to Gaussians unless we renormalize by S(t=0) and F(t=0), so it seems there is a justification missing in the text as is for the validity of this approximation (or that it is simply assumed).</p>
<p>See point 4 of Common comments.</p>
<disp-quote content-type="editor-comment">
<p><bold>Reviewer #3 (Public Reviews):</bold></p>
<p>The authors address the process of community evolution under collective-level selection for a prescribed community composition. They mostly consider communities composed of two types that reproduce at different rates, and that can mutate one into the other. Due to such differences in 'fitness' and to the absence of density dependence, within-collective selection is expected to always favour the fastest grower, but the collective-level selection can oppose this tendency, to a certain extent at least. By approximating the stochastic within-generation dynamics and solving it analytically, the authors show that not only high frequencies of fast growers can be reproducibly achieved, aligned with their fitness advantage. Small target frequencies can also be maintained, provided that the initial proportion of fast growers is sufficiently small. In this regime, similar to the 'stochastic corrector' model, variation upon which selection acts is maintained by a combination of demographic stochasticity and of sampling at reproduction. These two regions of achievable target compositions are separated by a gap, encompassing intermediate frequencies that are only achievable when the bottleneck size is small enough or the number of communities is (disproportionately) larger.</p>
<p>A similar conclusion, that stochastic fluctuations can maintain the system over evolutionary time far from the prevalence of the faster-growing type, is then confirmed by analyzing a three-species community, suggesting that the qualitative conclusions of this study are generalizable to more complex communities.</p>
<p>I expect that these results will be of broad interest to the community of researchers who strive to improve community-level selection, but are often limited to numerical explorations, with prohibitive costs for a full characterization of the parameter space of such embedded populations. The realization that not all target collective functions can be as easily achieved and that they should be adapted to the initial conditions and the selection protocol is also a sobering message for designing concrete applications.</p>
<p>A major strength of this work is that the qualitative behaviour of the system is captured by an analytically solvable approximation so that the extent of the 'forbidden region' can be directly and generically related to the parameters of the selection protocol.</p>
</disp-quote>
<p>Thanks so much for these positive comments.</p>
<disp-quote content-type="editor-comment">
<p>I however found the description of the results too succinct and I think that more could be done to unpack the mathematical results in a way that is understandable to a broader audience. Moreover, the phenomenon the authors characterize is of purely ecological nature. Here, mutations of the growth rate are, in my understanding, neither necessary (non-trivial equilibria can be maintained also when \mu =0) nor sufficient (community-level selection is necessary to keep the system far from the absorbing state) for the phenomenon described. Calling this dynamics community evolution reflects a widespread ambiguity, and is not ascribable just to this work. I find that here the authors have the opportunity to make their message clearer by focusing on the case where the 'mutation' rate \mu vanishes (Equations 39 &amp; 40 of the SI) - which is more easily interpretable, at least in some limits - while they may leave the more general equations 3 &amp; 4 in the SI.</p>
</disp-quote>
<p>See points 1-4 of Common comments.</p>
<disp-quote content-type="editor-comment">
<p>Combined with an analysis of the deterministic equations, that capture the possibility of maintaining high frequencies of fast growers, the authors could elucidate the dynamics that are induced by the presence of a second level of selection, and speculate on what would be the result of real open-ended evolution (not encompassed by the simple 'switch mutations' generally considered in evolutionary game theory), for instance discussing the invasibility (or not) of mutant types with slightly different growth rates.</p>
</disp-quote>
<p>Indeed, evolution is not restricted to two types. However, our main goal here is to derive an analytical expression, and it was difficult for even two types. For three-type collectives, we had to resort to simulations. Investigating the case where fitness effects of mutations are continuously distributed is beyond the scope of this study.</p>
<disp-quote content-type="editor-comment">
<p>The single most important model hypothesis that I would have liked to be discussed further is that the two types do not interact. Species interactions are not only essential to achieve inheritance of composition in the course of evolution but are generally expected to play a key role even on ecological time scales. I hope the authors plan to look at this in future work.</p>
</disp-quote>
<p>In our system, the S and F do interact in a competitive fashion: even though S and F are not competing for nutrients (which are always in excess), they are competing for space. This is because a fixed number of cells are transferred to the next cycle. Thus, the presence of F will for example reduce the chance of S being propagated. We have added this clarification to our main text:</p>
<p>“Note that even though S and F do not compete for nutrients, they compete for space: because the total number of cells transferred to the next cycle is fixed, an overabundance of one population will reduce the likelihood of the other being propagated.”</p>
<disp-quote content-type="editor-comment">
<p><bold>Recommendations For The Authors</bold></p>
<p>I felt the authors could put some additional effort into making their theoretical results meaningful for a population of readers who, though not as highly mathematically educated as they are, can nonetheless appreciate the implications of simple relations or scaling. Below, you find some suggestions:</p>
<p>(1) In order to make it clear that there is a 'natural' high-frequency equilibrium that can be reached even in the absence of selection, the authors could examine first the dynamics of the deterministic system in the absence of mutations, and use its equilibria to elucidate the combined role of the 'fitness' difference \omega and of the generation duration \tau in setting its value. The fact that these parameters always occur in combination (when there are no mutations) is a general and notable feature of the stochastic model as well. Moreover, this model would justify why you only focus on decreasing the frequency in the new generation.</p>
</disp-quote>
<p>Note that the ‘natural’ high-frequency equilibrium in the absence of collective selection is when fast grower F becomes fixed in the population. Following your suggestion, we have introduced two parameters 𝑅τ and 𝑊τ to reflect the coupling between ‘fitness’ and ‘generation duration’:</p>
<disp-quote content-type="editor-comment">
<p>(2) Since the phenomenon described in the paper is essentially ecological in nature (as the author states, it does not change significantly if the 'mutation rate' \mu is set to zero), I would put in the main text Equations 39 &amp; 40 of the SI in order to improve intelligibility.</p>
</disp-quote>
<p>See Point 2 at the beginning of this letter.</p>
<disp-quote content-type="editor-comment">
<p>These equations can be discussed in some detail, especially in the limit of small f^*_k, where I think it is worth discussing the different dependence of the mean and the variance of the frequency distribution on the system's parameters.</p>
</disp-quote>
<p>This is a great suggestion. We have added the following:</p>
<p>“In the limit of small <inline-formula id="sa3equ1"><inline-graphic xlink:href="elife-97461-sa3-equ1.jpg" mimetype="image" mime-subtype="jpeg"/></inline-formula>, Equation (3) becomes f <inline-formula id="sa3equ2"><inline-graphic xlink:href="elife-97461-sa3-equ2.jpg" mimetype="image" mime-subtype="jpeg"/></inline-formula> while Equation (4) becomes <italic>N<sub>0</sub></italic>) and fold-change in F/S during maturation (<inline-formula id="sa3equ3"><inline-graphic xlink:href="elife-97461-sa3-equ3.jpg" mimetype="image" mime-subtype="jpeg"/></inline-formula>. Thus, both Newborn size (<italic>W<sub>τ</sub></italic>) are important determinants of selection progress.</p>
<disp-quote content-type="editor-comment">
<p>(3) I would have appreciated an explanation in words of what are the main conceptual steps involved in attaining Equation 2, the underlying hypotheses (notably on community size and distributions), and the expected limits of validity of the approximation.</p>
</disp-quote>
<p>See points 3 and 4 at the beginning of this letter.</p>
<disp-quote content-type="editor-comment">
<p>(4) I think that some care needs to be put into explaining where extreme value statistics is used, and why is the median of the conditional distribution the most appropriate statistics to look at for characterizing the evolutionary trajectory (which seems to me mostly reliant on extreme values).</p>
</disp-quote>
<p>Great point! We added an explanation of using median value in Box 1.</p>
<p>and also added figure 7 to explaining it in SI.</p>
<disp-quote content-type="editor-comment">
<p>Showing in a figure the different distributions you are considering (for instance, plotting the conditional distribution for one generation in the trajectories displayed in Figure 2) would be useful to understand what information \bar f provides on a sequence of collective generations, where in principle there may be memory effects.</p>
</disp-quote>
<p>Thanks for this suggestion. We have added to Fig 2d panel to illustrate the shape and position of F frequency distributions in each step in the first two selection cycles.</p>
<disp-quote content-type="editor-comment">
<p>(5) Similarly, I do not understand why selecting the 5% best communities should push the system's evolution towards the high-frequency solution, instead of just slowing down the improvement (unless you are considering the average composition of the top best communities - which should be justified). I think that such sensitivity to the selection intensity should be appropriately referenced and discussed in the main text, as it is a parameter that experimenters are naturally led to manipulate.</p>
</disp-quote>
<p>In the main text, we have added this explanation:</p>
<p>“In contrast with findings from an earlier study [23], choosing top 1 is more effective than the less stringent “choosing top 5%”. In the earlier study, variation in the collective trait is partly due to nonheritable factors such as random fluctuations in Newborn biomass. In that context, a less stringent selection criterion proved more effective, as it helped retain collectives with favorable genotypes that might have exhibited suboptimal collective traits due to unfavorable nonheritable factors. However, since this study excludes nonheritable variations in collective traits, selecting the top 1 collective is more effective than selecting the top 5% (see Fig. 11 in Supplementary Information).”</p>
<disp-quote content-type="editor-comment">
<p>(6) Equation 1 could be explained in simpler terms as the product between the probability that one collective reaches the transmitted value times the probability that all others do worse than that. The current formulation is unclear, perhaps just a matter of English formulation.</p>
</disp-quote>
<p>We have revised our description to state:</p>
<disp-formula id="sa3equ4">
<graphic mime-subtype="jpg" xlink:href="elife-97461-sa3-equ4.jpg" mimetype="image"/>
</disp-formula>
<p>“Equation (1) can be described as the product between two terms related to probability: (i) <inline-formula id="sa3equ5"><inline-graphic xlink:href="elife-97461-sa3-equ5.jpg" mimetype="image" mime-subtype="jpeg"/></inline-formula> describes the probability density that any one of the <italic>g</italic> Adult collectives achieves <italic>f</italic> given <inline-formula id="sa3equ6"><inline-graphic xlink:href="elife-97461-sa3-equ6.jpg" mimetype="image" mime-subtype="jpeg"/></inline-formula>, and (ii) <italic>f</italic> and thus not selected.”<inline-formula id="sa3equ7"><inline-graphic xlink:href="elife-97461-sa3-equ7.jpg" mimetype="image" mime-subtype="jpeg"/></inline-formula> describes the probability that all other g – 1 collectives achieve frequencies above </p>
<disp-quote content-type="editor-comment">
<p>(7) I think that the discussion of the dependence of the boundaries of the 'waterfall' region with the difference in growth rate \omega is important and missing, especially if one wants to consider open-ended evolution of the growth rate - which can occur at steps of different magnitude.</p>
</disp-quote>
<p>We added a new chapter and figure in supplementary information on the threshold values when \omega varies. As expected, smaller \omega enlarges the success area.</p>
<p>We have also added a new figure panel to show how maturation time affects selection efficacy.</p>
<disp-quote content-type="editor-comment">
<p>(8) Notations are a bit confusing and could be improved. First of all, in most equations in the main text and SI, what is initially introduced as \omega appears as s. This is confusing because the letter s is also used for the frequency of the slow type.</p>
<p>The letter S is used to denote an attribute of cells (S cells), the type of cells (Equations 1-3 of the SI) and the number of these cells in the population, sometimes with different meanings in the same sentence. This is confusing, and I suggest referring to slow cells or fast cells instead (or at least to S-cells and F-cells), and keeping S and F as variables for the number of cells of the two types.</p>
</disp-quote>
<p>All typos related to the notation have been fixed. We use S and F as types, and <italic>S</italic> and <italic>F</italic> (italic) and population numbers.</p>
<disp-quote content-type="editor-comment">
<p>(9) On page 3, when introducing the sampling of newborns as ruled by a binomial distribution, the information that you are just transmitting one collective is needed, while it is conveyed later.</p>
</disp-quote>
<p>We have added this emphasis:</p>
<p>“At the end of a cycle, a single Adult with the highest function (with F frequency <italic>f</italic> closest to the target frequency <inline-formula id="sa3equ8"><inline-graphic xlink:href="elife-97461-sa3-equ8.jpg" mimetype="image" mime-subtype="jpeg"/></inline-formula>) is chosen to reproduce <italic>g</italic> Newborn collectives each with <italic>N<sub>0</sub></italic> cells (‘Selection’ and ’Reproduction’ in Fig. 1).”</p>
<disp-quote content-type="editor-comment">
<p>(10) I found that the abstract talks too early about the 'waterfall' phenomenon. As this is a concept introduced here, I suggest the authors first explain what it is, then use the term. It is a useful metaphor, but it should not obscure the more formal achievements of the paper.</p>
</disp-quote>
<p>We feel that the “waterfall” analogy offers a gentle helping hand to orient those who have not thought much about the phenomenon. We view abstract as an opportunity to attract readership, and thus the more accessible the better.</p>
<disp-quote content-type="editor-comment">
<p>(11) In the SI there are numerous typos and English language issues. I suggest the authors read carefully through it, and add line numbers to the next version so that more detailed feedback is possible.</p>
</disp-quote>
<p>Thank you for going through SI. We have gone through the SI, and fixed problems.</p>
</body>
</sub-article>
</article>