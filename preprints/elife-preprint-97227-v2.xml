<?xml version="1.0" ?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.3 20210610//EN"  "JATS-archivearticle1-mathml3.dtd"><article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.3" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="nlm-ta">elife</journal-id>
<journal-id journal-id-type="publisher-id">eLife</journal-id>
<journal-title-group>
<journal-title>eLife</journal-title>
</journal-title-group>
<issn publication-format="electronic" pub-type="epub">2050-084X</issn>
<publisher>
<publisher-name>eLife Sciences Publications, Ltd</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">97227</article-id>
<article-id pub-id-type="doi">10.7554/eLife.97227</article-id>
<article-id pub-id-type="doi" specific-use="version">10.7554/eLife.97227.2</article-id>
<article-version-alternatives>
<article-version article-version-type="publication-state">reviewed preprint</article-version>
<article-version article-version-type="preprint-version">1.2</article-version>
</article-version-alternatives>
<article-categories><subj-group subj-group-type="heading">
<subject>Structural Biology and Molecular Biophysics</subject>
</subj-group>
</article-categories>
<title-group>
<article-title>CTFFIND5 provides improved insight into quality, tilt and thickness of TEM samples</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" corresp="yes">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-9911-706X</contrib-id>
<name>
<surname>Elferich</surname>
<given-names>Johannes</given-names>
</name>
<xref ref-type="aff" rid="a1">a</xref>
<xref ref-type="aff" rid="a2">b</xref>
<email>johannes.elferich@umassmed.edu</email>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-5808-2649</contrib-id>
<name>
<surname>Kong</surname>
<given-names>Lingli</given-names>
</name>
<xref ref-type="aff" rid="a1">a</xref>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-2344-5163</contrib-id>
<name>
<surname>Zottig</surname>
<given-names>Ximena</given-names>
</name>
<xref ref-type="aff" rid="a1">a</xref>
<xref ref-type="aff" rid="a2">b</xref>
</contrib>
<contrib contrib-type="author" corresp="yes">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-1506-909X</contrib-id>
<name>
<surname>Grigorieff</surname>
<given-names>Nikolaus</given-names>
</name>
<xref ref-type="aff" rid="a1">a</xref>
<xref ref-type="aff" rid="a2">b</xref>
<email>niko@grigorieff.org</email>
</contrib>
<aff id="a1"><label>a</label><institution>RNA Therapeutics Institute, University of Massachusetts Chan Medical School</institution>, <city>Worcester</city>, <country>United States</country></aff>
<aff id="a2"><label>b</label><institution>Howard Hughes Medical Institute</institution>, <city>Chevy Chase</city>, <country>United States</country></aff>
</contrib-group>
<contrib-group content-type="section">
<contrib contrib-type="editor">
<name>
<surname>Scheres</surname>
<given-names>Sjors HW</given-names>
</name>
<role>Reviewing Editor</role>
<aff>
<institution-wrap>
<institution>MRC Laboratory of Molecular Biology</institution>
</institution-wrap>
<city>Cambridge</city>
<country>United Kingdom</country>
</aff>
</contrib>
<contrib contrib-type="senior_editor">
<name>
<surname>Cardona</surname>
<given-names>Albert</given-names>
</name>
<role>Senior Editor</role>
<aff>
<institution-wrap>
<institution>University of Cambridge</institution>
</institution-wrap>
<city>Cambridge</city>
<country>United Kingdom</country>
</aff>
</contrib>
</contrib-group>
<pub-date date-type="original-publication" iso-8601-date="2024-05-01">
<day>01</day>
<month>05</month>
<year>2024</year>
</pub-date>
<pub-date date-type="update" iso-8601-date="2024-11-06">
<day>06</day>
<month>11</month>
<year>2024</year>
</pub-date>
<volume>13</volume>
<elocation-id>RP97227</elocation-id>
<history>
<date date-type="sent-for-review" iso-8601-date="2024-02-26">
<day>26</day>
<month>02</month>
<year>2024</year>
</date>
</history>
<pub-history>
<event>
<event-desc>Preprint posted</event-desc>
<date date-type="preprint" iso-8601-date="2024-02-28">
<day>28</day>
<month>02</month>
<year>2024</year>
</date>
<self-uri content-type="preprint" xlink:href="https://doi.org/10.1101/2024.02.26.582023"/>
</event>
<event>
<event-desc>Reviewed preprint v1</event-desc>
<date date-type="reviewed-preprint" iso-8601-date="2024-05-01">
<day>01</day>
<month>05</month>
<year>2024</year>
</date>
<self-uri content-type="reviewed-preprint" xlink:href="https://doi.org/10.7554/eLife.97227.1"/>
<self-uri content-type="editor-report" xlink:href="https://doi.org/10.7554/eLife.97227.1.sa3">eLife assessment</self-uri>
<self-uri content-type="referee-report" xlink:href="https://doi.org/10.7554/eLife.97227.1.sa2">Reviewer #1 (Public Review):</self-uri>
<self-uri content-type="referee-report" xlink:href="https://doi.org/10.7554/eLife.97227.1.sa1">Reviewer #2 (Public Review):</self-uri>
<self-uri content-type="referee-report" xlink:href="https://doi.org/10.7554/eLife.97227.1.sa0">Reviewer #3 (Public Review):</self-uri>
</event>
</pub-history>
<permissions>
<copyright-statement>© 2024, Elferich et al</copyright-statement>
<copyright-year>2024</copyright-year>
<copyright-holder>Elferich et al</copyright-holder>
<ali:free_to_read/>
<license xlink:href="https://creativecommons.org/licenses/by/4.0/">
<ali:license_ref>https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
<license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p>
</license>
</permissions>
<self-uri content-type="pdf" xlink:href="elife-preprint-97227-v2.pdf"/>
<abstract>
<title>Abstract</title>
<p>Images taken by transmission electron microscopes are usually affected by lens aberrations and image defocus, among other factors. These distortions can be modeled in reciprocal space using the contrast transfer function (CTF). Accurate estimation and correction of the CTF is essential for restoring the high-resolution signal in cryogenic electron microscopy (cryoEM). Previously, we described the implementation of algorithms for this task in the <italic>cis</italic>TEM software package (<xref ref-type="bibr" rid="c4">Grant et al., 2018</xref>). Here we show that taking sample characteristics, such as thickness and tilt, into account can improve CTF estimation. This is particularly important when imaging cellular samples, where measurement of sample thickness and geometry derived from accurate modeling of the Thon ring pattern helps judging the quality of the sample. This improved CTF estimation has been implemented in CTFFIND5, a new version of the <italic>cis</italic>TEM program CTFFIND. We evaluated the accuracy of these estimates using images of tilted aquaporin crystals and eukaryotic cells thinned by focused ion beam milling. We estimate that with micrographs of sufficient quality CTFFIND5 can measure sample tilt with an accuracy of 3° and sample thickness with an accuracy of 5 nm.</p>
</abstract>
<custom-meta-group>
<custom-meta specific-use="meta-only">
<meta-name>publishing-route</meta-name>
<meta-value>prc</meta-value>
</custom-meta>
</custom-meta-group>
</article-meta>
<notes>
<notes notes-type="competing-interest-statement">
<title>Competing Interest Statement</title><p>The authors have declared no competing interest.</p></notes>
<fn-group content-type="summary-of-updates">
<title>Summary of Updates:</title>
<fn fn-type="update"><p>Various revisions in response to reviewer comments</p></fn>
</fn-group>
</notes>
</front>
<body>
<sec id="s1">
<title>Introduction</title>
<p>Transmission electron microscopy of biological specimens at cryogenic temperatures (cryoEM) has become a widely used method to image biomolecules at high resolution, both in solution and within the cell. To retrieve the high-resolution signal, the cryoEM images have to be corrected for the contrast-transfer function (CTF) of the microscope. Common parameters used to describe the CTF include an astigmatic defocus, the spherical aberration of the objective lens, and if appropriate, a phase shift introduced by a phase plate. The defocus and phase shift parameters are commonly estimated by fitting the Thon ring pattern (<xref ref-type="bibr" rid="c24">Thon, 1971</xref>) in the power spectrum of micrographs to a modeled power spectrum. The program CTFFIND4 (<xref ref-type="bibr" rid="c20">Rohou and Grigorieff, 2015</xref>) has been developed for this task and the model and conventions to describe the CTF are widely adopted in the field.</p>
<p>A limitation of CTFFIND4 is that it considers the whole imaged sample to be at the same objective defocus, which is a reasonable assumption for flat and thin samples, as is common in single-particle cryoEM. However, the increased thickness of cryoEM samples of cells may introduce additional modulations in the Thon ring pattern (<xref ref-type="bibr" rid="c25">Tichelaar et al., 2020</xref>) that can lead to errors in the CTF modeling when not accounted for. Furthermore, samples of cells are often tilted with respect to the optical axis of the microscope, either unintentionally due to thinning methods such as cryogenic focused ion beam (FIB) milling, or intentionally during electron cryo-tomography imaging. In both cases the effects are strongest at high-resolution, where the Thon rings are more tightly spaced.</p>
<p>Here we describe new features of CTFFIND5 that can fit the modulations of the Thon ring patterns and determine sample thickness and tilt using an extended CTF model with additional parameters. This not only increases the fidelity of the fit, as Thon rings at higher resolution can now be fitted reliably, but also gives valuable insight into the geometry of the sample that can aid the experimentalist.</p>
</sec>
<sec id="s2">
<title>Methods</title>
<sec id="s2a">
<title>Tilt estimation algorithm</title>
<p>Tilt estimation in CTFFIND5 follows a strategy that is similar to the implementation in CTFTILT (<xref ref-type="bibr" rid="c14">Mindell and Grigorieff, 2003</xref>). The tilt axis direction <italic>ϕ</italic> and tilt angle <italic>θ</italic> are determined by fitting Thon ring patterns locally, calculated from 128 × 128 pixel tiles that form a regular grid covering the micrograph (<xref rid="fig1" ref-type="fig">Fig. 1a</xref>). In this model, <italic>ϕ</italic> has a positive value ranging from 0° to 360° and describes the angle of the tilt axis to the X axis of the micrograph in the counterclockwise direction. The tilt angle <italic>θ</italic> has positive values ranging from 0° to 90° and describes the rotation of the sample around the tilt-axis in a counterclockwise direction. It is assumed that the defocus variation across the sample can be described by a tilted plane. Fits are evaluated using correlation coefficients between modeled CTFs and Thon ring patterns. Initially, the micrograph pixel size is adjusted (binned) by Fourier cropping to match the resolution limit of the fit set by the user and the micrograph is cropped to be square in order to speed up computation. A power spectrum is calculated from this binned and cropped image, a smooth background is calculated using a box convolution (<xref ref-type="bibr" rid="c14">Mindell and Grigorieff, 2003</xref>) and subtracted, the power spectrum is further binned to the tile size (128 × 128 pixels), and the fit of the tilted Thon ring patterns across the micrograph is initialized by fitting this highly binned power spectrum with a non-astigmatic CTF. This fit is then refined using a two-dimensional CTF with astigmatism. Rough values for the tilt axis and angle are then determined in a systematic search in 10° and 5°, respectively, using the locally fitted Thon ring patterns to score each pair of tilt axis and angle, followed by local refinement of tilt axis, angle and average defocus.</p>
<fig id="fig1" position="float" fig-type="figure">
<label>Figure 1.</label>
<caption><p>Tilt estimation and correction in CTFFIND5. (a) Power spectra are calculated in 128×128 pixel patches as indicated on a representative micrograph. The dots represent the locations of the patches and the box indicates patch size. (b) A model of the expected power spectrum in each patch given an average defocus <italic>Δf</italic>, tilt angle <italic>θ</italic>, and tilt axis <italic>ϕ</italic> is compared to the actual power spectra of tiles. After an optimal set of <italic>θ</italic> and <italic>ϕ</italic> has been found a corrected power spectrum is calculated by summing the tile power spectra, scaled to correct for the defocus difference. Power spectra shown are an exaggerated example. The convention of <italic>ϕ</italic> as a counterclockwise rotation from the x-axis is indicated. (c) Comparison of the original power spectrum (EPA, solid line, blue) to the tilt-corrected power spectrum (solid line, black). The tilt-corrected power spectrum exhibits clear peaks at higher spatial resolution than the uncorrected power spectrum, as evident by the “goodness-of-fit” scores (dashed lines). The estimated CTF parameters are <italic>Δf</italic><sub>1</sub> = 10603 A, <italic>Δf</italic><sub>2</sub> = 10193 A, <italic>α</italic> = 85.9° for the uncorrected power spectrum and <italic>Δf</italic><sub>1</sub> = 10492 A, <italic>Δf</italic><sub>2</sub> = 10342 A, <italic>α</italic> = 81.2°, <italic>θ</italic> = 12.3°, <italic>ϕ</italic> = 261.6° for the tilt-corrected power spectrum. The fit resolution is 5.9 Å for the uncorrected power spectrum (dashed line, blue) and 4.6 Å for the tilt-corrected spectrum (dashed line, black).</p></caption>
<graphic xlink:href="582023v2_fig1.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
<p>Finally, an average tilt-corrected power spectrum at a tile size requested by the user (usually 512 × 512 pixels) is calculated for diagnostic purposes and for further refinement of CTF parameters. The tilt correction is designed to remove most of the Thon ring blurring due to the defocus variation across the image. To minimize ring blurring, the power spectrum from each tile is adjusted according to its local average defocus, <italic>Δf</italic><sub><italic>average</italic></sub>, by magnifying it by a factor <italic>m</italic> with
<disp-formula id="eqn1">
<graphic xlink:href="582023v2_eqn1.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Since <italic>Δf</italic><sub><italic>local</italic></sub> will assume values across the image that are both smaller and larger than <italic>Δf</italic><sub><italic>average</italic></sub>, <italic>m</italic> will assume values smaller and larger than 1. The magnification / demagnification of the power spectrum compensates for the contraction / expansion of the Thon rings due to the local defocus change and produces approximately constant Thon ring patterns that can be averaged without losing the pattern (<xref rid="fig1" ref-type="fig">Fig. 1b</xref>). The compensation will have a small error if the spherical aberration is not zero. However, this error is sufficiently small to not visibly affect the Thon rings in the average.</p>
</sec>
<sec id="s2b">
<title>Verification of tilt estimation using tilted aquaporin crystals</title>
<p>To test the robustness and accuracy of the new fitting algorithm, the defocus and sample tilts of aquaporin 2D crystals (<xref ref-type="bibr" rid="c15">Murata et al., 2000</xref>) were estimated using a search range from 5000 Å to 50000 Å and a 100 Å step, low and high resolution limits of 30 Å to 5 Å, respectively, and a box size for the final power spectrum of 512 pixels. The estimated tilt angle <italic>θ</italic> and axis direction <italic>ϕ</italic> were compared with the values obtained by 2D crystallographic processing (<xref ref-type="bibr" rid="c14">Mindell and Grigorieff, 2003</xref>).</p>
</sec>
<sec id="s2c">
<title>Verification of tilt estimation using tilt series</title>
<p>Lamellae prepared from ER-HoxB8 cells were imaged using a Titan Krios 300 keV TEM controlled by SerialEM (<xref ref-type="bibr" rid="c10">Mastronarde, 2005</xref>). For each dataset, an initial exposure was taken with a magnification of 64,000, resulting in a pixel size of 1.6 Å and an exposure of 30 e<sup>-</sup>/Å<sup>2</sup>. This was followed by the acquisition of a tilt series at a magnification of 48,000, resulting in a pixel size of 2.087 Å. A total of 35 tilt images at a tilt interval of 3° were collected from -51° to 51°, relative to the milling angle, using a grouped dose-symmetric scheme (<xref ref-type="bibr" rid="c5">Hagen et al., 2017</xref>). The exposure per tilt was 3 e<sup>-</sup>/Å<sup>2</sup>, resulting in a total exposure of 105 e<sup>-</sup>/Å<sup>2</sup>.</p>
<p>Lamellae prepared by FIB milling usually exhibit a pre-tilt with respect to the grid surface due to the stage tilt in the FIB instrument. In the microscope, the direction of this pre-tilt will generally not line up with the goniometer tilt axis. For the alignment of a tomogram recorded from such a lamella, the relative orientation of these two axes will have to be determined, together with the precise amount of pre-tilt. We wrote a new <italic>cis</italic>TEM (<xref ref-type="bibr" rid="c4">Grant et al., 2018</xref>) program, called fit_tilt_model, to read the tilt angles and axes determined for each image in a tomographic tilt series and fit them to a model incorporating a pre-tilt and a single tomographic tilt axis. Using a rotation matrix <italic>R</italic><sub>0</sub> to represent the pre-tilt and rotation matrices <inline-formula><inline-graphic xlink:href="582023v2_inline1.gif" mime-subtype="gif" mimetype="image"/></inline-formula> to represent the tomographic tilt angles and axis read from the microscope, the overall sample orientations are given by
<disp-formula id="eqn2">
<graphic xlink:href="582023v2_eqn2.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<italic>R</italic><sub>0</sub> and <inline-formula><inline-graphic xlink:href="582023v2_inline2.gif" mime-subtype="gif" mimetype="image"/></inline-formula> are calculated from the tilt angles <italic>θ</italic> and axes <italic>ϕ</italic> as
<disp-formula id="eqn3">
<graphic xlink:href="582023v2_eqn3.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
Using the tilt information obtained with CTFFIND5, we now have a set of rotation matrices <italic>R</italic><sup><italic>i</italic></sup>, and together with the rotation matrices read from the microscope, <inline-formula><inline-graphic xlink:href="582023v2_inline3.gif" mime-subtype="gif" mimetype="image"/></inline-formula><inline-formula><inline-graphic xlink:href="582023v2_inline3a.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, we can calculate a set of pre-tilt estimates <italic>R</italic><sup><italic>i</italic></sup> from <xref ref-type="disp-formula" rid="eqn2">Eq. (2)</xref>. To determine the best overall pre-tilt <italic>R</italic><sub>0</sub>, we determine the plane-normal vectors <inline-formula><inline-graphic xlink:href="582023v2_inline4.gif" mime-subtype="gif" mimetype="image"/></inline-formula><inline-formula><inline-graphic xlink:href="582023v2_inline4a.gif" mime-subtype="gif" mimetype="image"/></inline-formula> of the sample by applying <italic>R</italic><sup><italic>i</italic></sup> to the vector [0,0,1] (<italic>z</italic>-coordinate along the beam direction), followed by calculating their mean <inline-formula><inline-graphic xlink:href="582023v2_inline5.gif" mime-subtype="gif" mimetype="image"/></inline-formula> as the normal vector of the best overall pre-tilt estimate. By calculating the root mean squared deviation of the normal vectors <inline-formula><inline-graphic xlink:href="582023v2_inline6.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, outliers can be identified and excluded to further refine <inline-formula><inline-graphic xlink:href="582023v2_inline7.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. The pre-tilt can then be determined as:
<disp-formula id="eqn4">
<graphic xlink:href="582023v2_eqn4.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
To generate more reliable defocus and tilt estimates, the defocus search range and resolution fitting range can be adjusted according to the experimental tilt range and image quality. For our cryoEM samples, the low and high resolution limits were set to 50 Å to 10 Å, respectively, and the defocus search interval was set to be between ± 10000 and ±20000 Å from the nominal defocus set during data collection.</p>
</sec>
<sec id="s2d">
<title>Sample thickness estimation</title>
<p>In CTFFIND5 we implemented a new <italic>CTF</italic><sub><italic>t</italic></sub> model function, based on the <italic>CTF</italic> function implemented in CTFFIND4 (<xref ref-type="bibr" rid="c20">Rohou and Grigorieff, 2015</xref>) and extended by the formula described by (<xref ref-type="bibr" rid="c13">McMullan et al., 2015</xref>):
<disp-formula id="eqn5">
<graphic xlink:href="582023v2_eqn5.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <italic>χ</italic> denotes the phase-shift as a function of the electron wavelength <italic>λ</italic>, the spatial frequency vector |qg|q, the objective defocus <italic>Δf</italic>, the spherical aberration <italic>C</italic><sub><italic>s</italic></sub>, the additional phase shift <italic>Δφ</italic>, and the fraction of amplitude contrast <italic>ω</italic><sub>2</sub>. The modulation of the CTF due to sample thickness <italic>t</italic> is described by the function sinc(<italic>ξ</italic>) with <italic>ξ</italic> defined as:
<disp-formula id="eqn6">
<graphic xlink:href="582023v2_eqn6.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
This sinc modulation envelope (<xref rid="fig3" ref-type="fig">Fig. 3a</xref>) attenuates the amplitude of the Thon rings with increasing spatial frequencies and produces nodes where the apparent amplitude is zero (<xref ref-type="bibr" rid="c25">Tichelaar et al., 2020</xref>). After the first node the thon rings appear “inverted” compared to the CTFFIND4 CTF model, with maxima in the thon rings appearing where the CTF model is 0. This causes the quality of fit indicator to rapidly decrease at the first node in CTFFIND4. The location of the first node is marked with a # in <xref rid="fig3" ref-type="fig">Fig. 3a</xref>.</p>
<fig id="fig2" position="float" fig-type="figure">
<label>Figure 2.</label>
<caption><p>Validation of tilt estimation using tilt series data and comparison of defocus estimation using CTFFIND4 and CTFFIND5. (a) Estimated tilt angle and axis of 40 micrographs of a tilt series taken on a FIB-milled biological specimen. For each image the tilt angle (dots, top plot) and tilt axis direction (crosses, second plot) are plotted as a function of the nominal stage angle. The data were fitted to a model of the specimen tilt and constant stage tilt axis before tilting the stage (red dashed line in first and second plot). The estimated stage tilt axis has an angle of 178.2° and the estimated specimen pre-tilt is 20.6° with a tilt axis of 171.8°, which is consistent with the FIB-milling angle of 20° and manual alignment of the milling direction to the goniometer tilt axis. The third plot shows the fit residuals for tilt angle and axis are plotted. The fourth and fifth plot show a plot of the estimated defocus value and fit resolution for each tilt image, as derived from CTFFIND4 (red) or CTFFIND5 (black. (b) Data for another tilt series plotted as described for (a). The estimated stage tilt axis is 179.8°, the estimated specimen pre-tilt is -21.9° with a tilt axis of 183.8°. This is consistent with this grid being inserted in the opposite orientation as the grid shown in (a), but still with a rough alignment of milling direction and tilt axis.</p></caption>
<graphic xlink:href="582023v2_fig2.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
<fig id="fig3" position="float" fig-type="figure">
<label>Figure 3.</label>
<caption><p>Sample thickness estimation by fitting Thon ring patterns. (a) Comparison of the CTF model used in CTFFIND4, and after applying the modulation function (right) described by <italic>(McMullan et al</italic>., <italic>2015)</italic>. A star symbol (*) denotes the position of the first zero in the CTF and a pound symbol (#) denotes the position of the first node. (b-d) Representative examples of Thon ring fitting in micrographs without (top-left graph) and with (bottom-leftgraph) thickness estimation. The micrograph is shown to the right. Each graph shows that EPA of the power spectrum in solid black lines, the fitted CTF model in dashed red lines, and the goodness of fit indicator as a dotted blue lines. (b) Thon ring fitting of a micrograph taken from a FIB-milling derived lamella. The tilt of the specimen was estimated to be 12.3°. When fitting without thickness estimation the estimated parameters were <italic>Δf</italic><sub>1</sub> = 10492 A, <italic>Δf</italic><sub>2</sub> = 10342 A, <italic>α</italic> = 81.2°. When taking sample thickness into account the estimated parameters were <italic>Δf</italic><sub>1</sub> = 10481 A, <italic>Δf</italic><sub>2</sub> = 10286 A, <italic>α</italic> = 69.6°, <italic>t</italic> = 969 A. The estimated fit resolution was 4.6 A and 3.4 A without and with sample thickness estimation, respectively. (c) Thon ring fitting of a micrograph taken from a FIB-milling derived lamella. The tilt of the specimen was estimated to be 6.7°. When fitting without thickness estimation the estimated parameters were <italic>Δf</italic><sub>1</sub> = 8002 A, <italic>Δf</italic><sub>2</sub> = 7717 A, <italic>α</italic> = 73.4°. When taking sample thickness into account the estimated parameters were <italic>Δf</italic><sub>1</sub> = 8549 A, <italic>Δf</italic><sub>2</sub> = 8343 A, <italic>α</italic> = 63.3°, <italic>t</italic> = 2017 A. The estimated fit resolution was 4.3 A and 4.2 A without and with sample thickness estimation, respectively. (d) Thon ring fitting of a micrograph taken from plunge frozen rotavirus double-layered particles (<xref ref-type="bibr" rid="c3">Grant and Grigorieff, 2015</xref>). When fitting without thickness estimation the estimated parameters were <italic>Δf</italic><sub>1</sub> = 7027 A, <italic>Δf</italic><sub>2</sub> = 6808 A, <italic>α</italic> = −20.3°. When taking sample thickness into account the estimated parameters were <italic>Δf</italic><sub>1</sub> = 7027 A, <italic>Δf</italic><sub>2</sub> = 6808 A, <italic>α</italic> = −22.9°, <italic>t</italic> = 850 A. The estimated fit resolution was 4.2 A and 3.2 A without and with sample thickness estimation, respectively.</p></caption>
<graphic xlink:href="582023v2_fig3.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
<p>If a user requests sample thickness estimation, the program will first fit the <italic>CTF</italic> model function as implemented in CTFFIND4. If the user also requested tilt estimation the tilt corrected power spectrum will be used for all subsequent steps. Initially, the “goodness of fit” resolution <italic>g</italic><sub><italic>GoF</italic></sub> will be used as an estimate for the frequency of the first node of the <italic>CTF</italic><sub><italic>t</italic></sub> function, which occurs when the sinc term in <xref ref-type="disp-formula" rid="eqn5">Eq. 5</xref> becomes 0 for the first time at <italic>ξ</italic> = <italic>π</italic>. By setting <italic>ξ</italic> = <italic>π</italic> in <xref ref-type="disp-formula" rid="eqn6">Eq. 6</xref>, we can obtain an estimate of the sample thickness <italic>t</italic>, from <italic>g</italic><sub><italic>GoF</italic></sub>:
<disp-formula id="eqn7">
<graphic xlink:href="582023v2_eqn7.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
If the option “Brute-force 1D fit” is selected, CTFFIND5 will further refine <italic>t</italic> and <italic>Δf</italic> by calculating the normalized cross-correlation between the radial average of the power spectrum, corrected for astigmatism by EquiPhase Averaging (EPA) as described in (<xref ref-type="bibr" rid="c29">Zhang, 2016</xref>), and <italic>CTF</italic><sub><italic>t</italic></sub>, searching systematically for the best combination of <italic>t</italic> in the range of 50-400 nm in 10 nm steps, and <italic>Δf</italic> in the range of ±200 nm from the previously fitted value, also in 10 nm steps.</p>
<p>Finally, if the option “2D-refinement” is selected, CTFFIND5 will optimize <italic>t, Δf</italic><sub>1</sub>, <italic>Δf</italic><sub>2</sub>, and <italic>ω</italic> using the same conjugate gradient algorithm used in CTFFIND4 and the normalized cross correlation between <italic>CTF</italic><sub><italic>t</italic></sub> and the 2D power spectrum as a scoring function.</p>
<p>After the optimal values for <italic>t</italic> and <italic>Δf</italic> have been obtained the “goodness of fit” crosscorrelation is recalculated using <italic>CTF</italic><sub><italic>t</italic></sub>, with a frequency window that is 1.5 times larger than in CTFFIND4 to avoid the drop-off in the node regions of <italic>CTF</italic><sub><italic>t</italic></sub>. For visualization, the astigmatism-corrected 1D power spectrum is displayed as oscillating around 0.5, as opposed to the default procedure in CTFFIND4, where the minima are scaled to 0. This is done to allow a better visual comparison to the <italic>CTF</italic><sub><italic>t</italic></sub> model.</p>
</sec>
<sec id="s2e">
<title>Verification of sample thickness estimation using the Beer-Lambert law</title>
<p>We used 655 micrographs collected from one lamella of ER-HoxB8 cells (dataset Lamella 1 from (<xref ref-type="bibr" rid="c2">Elferich et al., 2022</xref>). For each micrograph we calculated <inline-formula><inline-graphic xlink:href="582023v2_inline8.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, where <italic>I</italic> was the sum of all pixels in the illuminated area of the movie and <italic>I</italic><sub>0</sub> was the average of this sum for 45 micrographs collected over vacuum with the same energy filter settings. This value is expected to have a linear relationship with the thickness of the sample consistent with the Beer-Lambert law (<xref ref-type="bibr" rid="c18">Rice et al., 2018</xref>; <xref ref-type="bibr" rid="c28">Yan et al., 2015</xref>):
<disp-formula id="eqn8">
<graphic xlink:href="582023v2_eqn8.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <italic>κ</italic> is the apparent mean free path for inelastic scattering.</p>
<p>We then used CTFFIND5 to estimate the thickness <italic>t</italic> of each micrograph using the “Brute-force 1D fit” and “2D-refinement” setting, low and high resolution limits set to 30 Å and 5 Å, defocus search range set between 500 nm and 5000 nm, and low and high resolution limits for thickness estimation set to 10 Å and 3 Å. We used a “RANSAC” algorithm as implemented by the scikit-learn Python package (<xref ref-type="bibr" rid="c16">Pedregosa et al., 2011</xref>) to fit a linear model to the relationship of <inline-formula><inline-graphic xlink:href="582023v2_inline9.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <italic>t</italic>, while rejecting outliers. We then manually inspected every outlier of the model fit and categorized the reason for the discrepancy into “Occluded beam” (either from contamination or the edges of the lamella), “Low image signal” (in most cases exposures containing no cellular features), “Carbon/Platinum”, and “Lipid droplet” (see <xref rid="fig4" ref-type="fig">Fig. 4</xref>).</p>
<fig id="fig4" position="float" fig-type="figure">
<label>Figure 4.</label>
<caption><p>Validation of sample thickness estimation in CTFFIND5 by comparing the estimates to the intensity attenuation by the zero-loss energy filter. An estimation of the linear relationship using the RANSAC algorithm results in a slope of 1/316.6 nm and an x-axis intercept at -14 nm (red dashed line). Data points that were labeled as outliers by the RANSAC algorithm were manually inspected and color-coded according to visual inspection of the micrographs.</p></caption>
<graphic xlink:href="582023v2_fig4.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
</sec>
<sec id="s2f">
<title>Verification of sample thickness estimation using tomography</title>
<p>The same tilts series described in the section “Verification of tilt estimation using tilt series” were used here. For tomographic reconstruction, tilt movie frame motion correction was performed using SerialEM (<xref ref-type="bibr" rid="c10">Mastronarde, 2005</xref>), and tilt series were aligned using the IMOD software package (version 4.11, (<xref ref-type="bibr" rid="c12">Mastronarde and Held, 2017</xref>)). For coarse alignment, a high-frequency cutoff radius of 0.15 was used. A fiducial model was generated using patch tracking with patches of 450 × 450 pixels and a fractional overlap of patches of 0.33 × 0.33. High-tilt frames were omitted while generating the fiducial model. Robust fitting with a tuning factor of 1 was used for fine alignment. After computing the alignment, the fiducial model was edited by removing unreliable patches, and then alignments were re-computed. The edited models with the lowest residual mean errors and standard deviations were used for fine alignment. Tomogram positioning was used to correct the tilt angle offset. Fully aligned stacks were generated with a binning factor of 4, resulting in a tomogram pixel size of 8.3 Å. Tomograms were reconstructed using the SIRT-like filtering option in IMOD (<xref ref-type="bibr" rid="c11">Mastronarde, 1997</xref>; <xref ref-type="bibr" rid="c12">Mastronarde and Held, 2017</xref>) and manually inspected. The tomograms were back-projected along the y-axis using a homemade script, generating a small set of XZ projections. Thickness measurements on the projected central slices were performed using the display program included with the <italic>cis</italic>TEM software package (<xref ref-type="bibr" rid="c4">Grant et al., 2018</xref>).</p>
</sec>
<sec id="s2g">
<title>CTF correction of medium magnification lamella images</title>
<p>The CTF of the representative medium magnification image with a pixel size of 40 Å was estimated using CTFFIND5 with the following parameters: defocus range: 1,000,000 to 4,000,000 Å; search step 50,000 Å; low and high resolution limits: 400 Å and 80 Å. We then used the program apply_ctf, included with <italic>cis</italic>TEM, to flip the phases according to the estimated CTF. We furthermore implemented the Wiener-like filter described in (<xref ref-type="bibr" rid="c23">Tegunov and Cramer, 2019</xref>) in apply_ctf to produce the image shown in<xref rid="fig6" ref-type="fig">Fig. 6d</xref>.</p>
<fig id="fig5" position="float" fig-type="figure">
<label>Figure 5:</label>
<caption><p>Validation of sample thickness estimation in CTFFIND5 by tomography. The distribution of thickness measurements in seven tomograms are shown as box plots with the median indicated by a red line. The position on the x-axis corresponds to the thickness estimate by CTFFIND5. The black dashed line indicates identity. The red dashed line indicates the result of a linear fit.</p></caption>
<graphic xlink:href="582023v2_fig5.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
<fig id="fig6" position="float" fig-type="figure">
<label>Figure 6.</label>
<caption><p>CTF correction of medium magnification overviews. (a) Representative area of a micrograph of a cellular sample at a pixel size of 40 Å without CTF correction. (b) Fit of the power spectrum of the micrograph shown in panel a CTF model. (c-d) The same micrograph as shown in panel (a) after CTF correction by phase flipping (c) or with a Wiener-like filter (d). The custom fall-off parameter was set to 1.3 and the custom strength parameter was set to 0.7.</p></caption>
<graphic xlink:href="582023v2_fig6.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
</sec>
<sec id="s2h">
<title>Benchmarking CTFFIND5 runtimes</title>
<p>CTFFIND5 runtimes were measured using 3 representative micrographs (<xref rid="tbl2" ref-type="table">Table 2</xref>). As a baseline measurement, CTFFIND5 was run without estimation of tilt and sample thickness enabled. Then runtime was measured enabling either one of these options or both. Every test was repeated four times and the average and standard deviation of the last three runs are reported, to minimize the contribution of hard-drive speed. The tests were performed on a single core of an Intel Core i9-12900KF CPU.</p>
</sec>
</sec>
<sec id="s3">
<title>Results</title>
<sec id="s3a">
<title>Tilt estimation</title>
<p>We tested the tilt correction for the Thon rings on a representative micrograph taken from a cryo-FIB milled lamella. As expected, the correction results in the observation of Thon rings at higher spatial resolution (<xref rid="fig1" ref-type="fig">Fig. 1c</xref>). In this example, correcting for the estimated moderate tilt of 12.3° improved the highest resolution at which a reasonable fit could be obtained from 5.9 Å to 4.6 Å. The power spectrum also appears less noisy, which can be attributed to some low-pass filtering that occurs with the interpolation of the Thon ring patterns of individual tiles to perform the tilt correction.</p>
<p>To test the performance of the new CTFFIND5 sample tilt estimation, we used a dataset of images of tilted aquaporin crystals that were also used to benchmark the original CTFTILT implementation (<xref ref-type="bibr" rid="c14">Mindell and Grigorieff, 2003</xref>; <xref ref-type="bibr" rid="c15">Murata et al., 2000</xref>). <xref rid="tbl1" ref-type="table">Table 1</xref> compares the tilt information of the samples obtained from crystallographic analysis and the estimates obtained using CTFFIND5. Overall, the results of CTFFIND5 agree well with the aquaporin crystals information. The average discrepancy was 1.9° for the tilt axis direction and 1.5° for the tilt angle.</p>
<table-wrap id="tbl1" orientation="portrait" position="float">
<label>Table 1.</label>
<caption><title>Comparison of CTFFIND5 estimation of sample tilt with crystallographic analysis</title></caption>
<graphic xlink:href="582023v2_tbl1.tif" mime-subtype="tiff" mimetype="image"/>
<graphic xlink:href="582023v2_tbl1a.tif" mime-subtype="tiff" mimetype="image"/>
</table-wrap>
<table-wrap id="tbl2" orientation="portrait" position="float">
<label>Table 2.</label>
<caption><title>Runtime of CTFFIND5 on representative micrographs</title></caption>
<graphic xlink:href="582023v2_tbl2.tif" mime-subtype="tiff" mimetype="image"/>
</table-wrap>
<p>To test whether CTFFIND5 would be able to correctly assign tilt axis and angle for tilt series data, we analyzed two tilt series from different grids of lamellae prepared by cryo-FIB milling from mouse neutrophil-like cells (<xref ref-type="bibr" rid="c2">Elferich et al., 2022</xref>). We then plotted the estimated values for tilt axis and angle as a function of nominal stage tilt (<xref rid="fig2" ref-type="fig">Fig. 2</xref>). The estimated tilt angle shows a roughly linear relationship with the nominal stage tilt, but since CTFFIND5 reports only positive tilt angles the overall plot has a V-shape. The estimated tilt axis angle is approximately constant at high tilts but changes by about 180° at 0° estimated tilt, again due to the convention enforced by CTFFIND5. Notably, in both examples there is an offset of about 20° between nominal and estimated tilts, which is due to the pre-tilt of the specimen caused by FIB-milling at a shallow angle. To quantify and delineate both the tilt axis direction of the microscope and the pre-tilt of the specimen we fit all values to a model as described in Methods (<xref rid="fig2" ref-type="fig">Fig. 2</xref>). The fitting resulted in an estimated tilt axis angle of 178.2° and 179.8°, respectively, which is consistent with the SerialEM calibration of 178.4° and 176.3° for the stage tilt axis. The estimated pre-tilt values were 20.6 °and -21.9°, consistent with a FIB-milling angle of 20° and opposite orientation of the grids relative to the milling direction. The pre-tilt axis angles were estimated as 171.8° and 183.8°, which is consistent with the error expected from manually aligning the milling direction when inserting grids into the microscope.</p>
<p>To estimate the accuracy of the tilt estimation in tilt series, we calculated the mean absolute difference between the tilt and axis-angle estimates and the fitted model, excluding the axis-angle estimates at tilt angles under 5°. For the first tilt series we obtained accuracy estimates of 2.08° and 2.58° for tilt and axis-angles, respectively. In the second tilt series the accuracy estimates were 3.95° and 9.47°. In both cases the accuracy was lower than for the tilted aquaporin crystals, presumably due to the relatively short exposure of each micrograph in the tilt series. However, the substantially higher mean differences in the second tilt series suggest that the accuracy is highly dependent on the quality of the underlying data.</p>
</sec>
<sec id="s3b">
<title>Sample thickness estimation</title>
<p>Even after correcting for sample tilt we found that for FIB-milled samples we often could observe Thon-ring like modulation in the power spectrum at higher resolution than suggested by the goodness of fit estimate (<xref rid="fig3" ref-type="fig">Fig. 3b</xref>, top plot). These modulations are out of phase with the predicted modulations, as described by (<xref ref-type="bibr" rid="c13">McMullan et al., 2015</xref>) and (<xref ref-type="bibr" rid="c25">Tichelaar et al., 2020</xref>). We therefore implemented an extension of the CTF model as described by (<xref ref-type="bibr" rid="c13">McMullan et al., 2015</xref>) (<xref rid="fig3" ref-type="fig">Fig. 3a</xref>). For some images we found that the thickness could be well estimated by assuming that the goodness of fit resolution estimate obtained using the old model implemented in CTFFIND4 corresponds to the first node in the modulation function, according to <xref ref-type="disp-formula" rid="eqn7">Eq. (7)</xref>. With our new model, estimated CTF parameters were very similar to those from CTFFIND4, but the fit in CTFFIND5 extended to higher resolution (<xref rid="fig3" ref-type="fig">Fig. 3b</xref>).</p>
<p>In other images, mostly with defocus values under 1 µm and with a sample thickness over 200 nm, CTFFIND4 could fit the power spectrum before and after the first node using the old CTF model, with some deviations between the fit and the power spectrum (<xref rid="fig3" ref-type="fig">Fig. 3c</xref>).</p>
<p>Fitting the power spectrum with the new model in CTFFIND5 resulted in substantially different estimated CTF parameters and an improved fit, even though the goodness-of-fit estimation did not change. We also found that for some single-particle datasets of large particles, such as the rotavirus double-layered particle (<xref ref-type="bibr" rid="c3">Grant and Grigorieff, 2015</xref>), we could use CTFFIND5 to estimate the thickness of the sample, which resulted in CTF fits to higher resolution (<xref rid="fig3" ref-type="fig">Fig. 3d</xref>).</p>
<p>Based on these results we conclude that CTFFIND5 will provide more accurate CTF parameters for images of thick samples, such as those generated from FIB-milling. In addition, the fit provides a direct readout of the specimen thickness, which is important for judging specimen quality and the potential for high-resolution information that can be recovered from these images.</p>
</sec>
<sec id="s3c">
<title>Estimating the accuracy of sample thickness estimation using the Beer-Lambert law on energy filtered data</title>
<p>CryoEM is frequently performed using an energy filter to remove inelastically scattered electrons. The fraction of inelastically scattered electrons can be described by the Beer-Lambert law, which states that the fraction of electrons removed from the image is proportional to the thickness of the sample. The apparent mean free path for electron scattering has been experimentally determined for common cryoEM conditions (<xref ref-type="bibr" rid="c18">Rice et al., 2018</xref>). To test whether thickness estimation in CTFFIND5 is consistent with this method we used a dataset of 655 exposures of a lamella of ER-HoxB8 cells collected using the DeCo-LACE approach (<xref ref-type="bibr" rid="c2">Elferich et al., 2022</xref>). We used CTFFIND5 to estimate the thickness <italic>t</italic> of every exposure and plotted –<inline-formula><inline-graphic xlink:href="582023v2_inline10.gif" mime-subtype="gif" mimetype="image"/></inline-formula> against <italic>t</italic> (<xref rid="fig4" ref-type="fig">Fig. 4</xref>). Fitting the data to a linear modeldescribed in Methods (<xref ref-type="disp-formula" rid="eqn8">Eq. (8)</xref>), we found that 568 out of 655 exposures followed closely a linear relationship with a mean free path <italic>κ</italic> of 317 nm. Manual inspection of images that did not follow this linear relationship revealed that they either contained visible ice contamination, platinum deposits, or they were collected over ice without cellular features and displayed weak Thon rings. The value of <italic>κ</italic> is consistent the value found by (<xref ref-type="bibr" rid="c18">Rice et al., 2018</xref>), even though our dataset was collected without an objective aperture. The x-axis intercept of the linear model was -14.1 nm, meaning that the node position systematically predicts a smaller thickness than predicted by the Beer-Lambert law. This discrepancy is further discussed in the next section. To estimate the accuracy of the sample thickness determined by CTFFIND5 we calculated the mean absolute difference to the linear model, which was 4.8 nm. These data suggest that sample thickness determination using node-fitting is an alternative to using the Beer-Lambert law that has the advantage of not relying on the constant <italic>κ</italic> and the intensity <italic>I</italic><sub>0</sub>, both of which might not be readily available. Also, the two approaches are complementary as they rely on orthogonal mechanisms.</p>
</sec>
<sec id="s3d">
<title>Estimating the accuracy of sample thickness estimation using tomography</title>
<p>We used a dataset of seven micrographs collected from lamellae of ER-HoxB8 cells together with tilt series collected afterwards from the same locations to verify the accuracy of the thickness estimates obtained using CTFFIND5. We used CTFFIND5 to estimate the thickness (<italic>t</italic><sub><italic>CTFFIND</italic></sub>) for every location and compared it with the thickness estimated from the tomogram reconstructed from the tilt series (<italic>t</italic><sub><italic>TOMO</italic></sub>). We measured <italic>t</italic><sub><italic>TOMO</italic></sub> by manually estimating the distance between the surfaces of the lamella in three different positions.</p>
<p>When we plotted <italic>t</italic><sub><italic>CTFFIND</italic></sub> against <italic>t</italic><sub><italic>TOMO</italic></sub> we found that the values were highly correlated, but <italic>t</italic><sub><italic>TOMO</italic></sub> was consistently smaller than <italic>t</italic><sub><italic>CTFFIND</italic></sub> (<xref ref-type="fig" rid="fig5">Fig. 5</xref>). A linear fit revealed a slope of 0.95 and a y-axis intercept of 0.12 nm. This means that the CTFFIND5 thickness estimate is on average 1.05x higher than the thickness estimated by tomography. (<xref ref-type="bibr" rid="c25">Tichelaar et al., 2020</xref>) also report that estimating the thickness from the CTF nodes resulted in values roughly 1.1x higher than estimated by tomography. The reasons for the systematic discrepancies between thicknesses estimated by CTFFIND5 and estimates based on the Beer-Lambert law and tomography are unclear, but since they are small and CTFFIND5 estimates lie in between the other two estimates, they will provide comparable information.</p>
</sec>
<sec id="s3e">
<title>CTF estimation and correction assists biological interpretation of intermediate-magnification lamella images</title>
<p>During data collection of cryoEM data in cells, the operator frequently relies on images taken at low magnification to select areas of interest and establish their biological context. The pixel size of these images is usually about 40 Å, with a defocus of about 200 µm. This produces strong contrast from biological membranes but can sometimes also lead to substantial fringes near these membranes (<xref rid="fig5" ref-type="fig">Fig. 6a</xref>). We found that a simple CTF correction based on CTFFIND defocus estimates obtained from the overview images can reduce these fringes (<xref rid="fig5" ref-type="fig">Fig. 6b</xref>). A simple CTF correction can be done using the program apply_ctf, included with <italic>cis</italic>TEM, by phase flipping according to the fitted CTF (<xref rid="fig5" ref-type="fig">Fig. 6c</xref>). However, we found that including a Wiener filter-based amplitude correction described by (<xref ref-type="bibr" rid="c23">Tegunov and Cramer, 2019</xref>) produces a more naturally looking image that might be best suited to recognize cellular features (<xref rid="fig5" ref-type="fig">Fig. 6d</xref>).</p>
</sec>
<sec id="s3f">
<title>CTFFIND5 runtimes</title>
<p>To gauge the ability of CTFFIND5 to provide real time feedback during cryoEM data collection we measured its runtime on three representative micrographs (<xref rid="tbl2" ref-type="table">Table 2</xref>). Without estimation of tilt or sample thickness CTFIND5 performed CTF estimation roughly within a second. Estimation of the sample thickness adds roughly half a second to the runtime, therefore allowing CTF estimation within a timeframe comparable to typical exposure times. Estimation of the tilt on the other hand increased runtimes substantially to the order of several minutes, due to the exhaustive search of potential tilts over hundreds of power spectra. While these runtimes are substantially slower than cryoEM data acquisition, near real time estimation can be achieved by using multiple CPU cores.</p>
<p>Furthermore, optimization of the number of tiles used, better search algorithms, or implementations employing GPUs could increase the speed to the point where real time estimation is more feasible.</p>
</sec>
</sec>
<sec id="s4">
<title>Conclusion</title>
<p>The new features implemented in CTFFIND5 improve CTF estimation from the power spectra of cryoEM micrographs where assumptions made in its predecessor, CTFFIND4, namely a thin and untilted sample, do not hold. The tilt of the sample is estimated by fitting the CTF to the power spectra calculated from small patches across the image, similar to other software including CTFTilt (<xref ref-type="bibr" rid="c14">Mindell and Grigorieff, 2003</xref>), Ctfplotter (<xref ref-type="bibr" rid="c9">Mastronarde, 2024</xref>; <xref ref-type="bibr" rid="c27">Xiong et al., 2009</xref>), goCTF (<xref ref-type="bibr" rid="c21">Su, 2019</xref>), Bsoft (<xref ref-type="bibr" rid="c6">Heymann and Belnap, 2007</xref>), and Warp (<xref ref-type="bibr" rid="c23">Tegunov and Cramer, 2019</xref>). After estimation of the sample tilt, a tilt-corrected power spectrum is produced that exhibits stronger Thon rings at higher resolution.</p>
<p>To take into account the modulation of the power spectra by thick samples (<xref ref-type="bibr" rid="c13">McMullan et al., 2015</xref>; <xref ref-type="bibr" rid="c25">Tichelaar et al., 2020</xref>) we fit a modified CTF model, which increases the resolution of the fitted regions of the spectra and provides a read-out of the sample thickness. While the low exposures (3-5 e<sup>-</sup>/ Å<sup>2</sup>) typically used in electron cryo-tomography often preclude fitting of sample thickness from power spectra of individual images in the tilt series, we demonstrate that this works reliably for higher exposures (∼ 30 e<sup>-</sup>/ Å<sup>2</sup>) typically used for 2D template matching (2DTM) (<xref ref-type="bibr" rid="c8">Lucas et al., 2021</xref>; <xref ref-type="bibr" rid="c19">Rickgauer et al., 2017</xref>) and in-situ single particle analysis (<xref ref-type="bibr" rid="c1">Cheng et al., 2023</xref>).</p>
<p>We mainly developed these improvements for 2DTM applied to <italic>in-situ</italic> samples, e.g., prepared by cryo-FIB milling. Since the sample thickness and sample tilt are apparent from a single exposure, as opposed to a reconstructed tomogram, CTFFIND5 made it possible to quantify these parameters for every exposure. This is important information to judge the quality of the lamella before performing time-intensive further processing (<xref ref-type="bibr" rid="c7">Lucas and Grigorieff, 2023</xref>; <xref ref-type="bibr" rid="c26">Tuijtel et al., 2024</xref>). Furthermore, since the quality of fit estimation of CTFFIND5 goes to higher resolution in tilted and thick samples (<xref rid="fig1" ref-type="fig">Fig. 1c</xref>, <xref rid="fig3" ref-type="fig">Fig. 3b-d</xref>) it is a better indicator of micrograph quality than the same metric in CTFFIND4.</p>
<p>Even though we used tilt-series data to benchmark tilt estimation in CTFFIND5, there are certain drawbacks in its use for tilt series data. In contrast to software optimized for tilt-series data, such as Ctfplotter (<xref ref-type="bibr" rid="c9">Mastronarde, 2024</xref>), CTFFIND5 uses no prior information for tilt axis angle and sample tilt, resulting in reduced performance and potential also lower accuracy. Furthermore, there is no option to pool data from several tilt-angles to provide a more accurate defocus or astigmatism estimation. However, this also means that CTFFIND5 together with fit_tilt_model might be useful in troubleshooting angle conventions in tilt series data. Also, existing pipelines using CTFFIND4 might benefit from the tilt correction in the powerspectrum calculation introduced in CTFFIND5, which results in more robust defocus estimation at high tilt (<xref rid="fig2" ref-type="fig">Fig. 2</xref>).</p>
<p>While most single-particle samples are thin and flat and therefore do not benefit from CTFFIND5, there might be some samples, such as viral particles (<xref rid="fig3" ref-type="fig">Fig. 3d</xref>), where direct estimation of the ice thickness is valuable. However, even in these cases the defocus reported by CTFFIND5 is an average for the whole micrograph and per-particle CTF refinement, as implemented in <italic>cis</italic>TEM (<xref ref-type="bibr" rid="c4">Grant et al., 2018</xref>), RELION (<xref ref-type="bibr" rid="c30">Zivanov et al., 2018</xref>), or CryoSPARC (<xref ref-type="bibr" rid="c17">Punjani et al., 2017</xref>; <xref ref-type="bibr" rid="c31">Zivanov et al., 2020</xref>) will be still be required to actually recover high-resolution information during averaging. The ability to measure sample tilt might be useful for approaches where a tilted stage is used to overcome preferred particle orientation (<xref ref-type="bibr" rid="c22">Tan et al., 2017</xref>), as initial per particle defocus values can be derived from the tilt as reported by CTFFIND5 and the particle positions.</p>
<p>In summary, the improvements implemented in CTFFIND5 result in more accurate CTF estimation of thick and tilted samples and provide valuable information about the samples to the microscopist.</p>
</sec>
</body>
<back>
<sec id="s5" sec-type="data-availability">
<title>Data availability</title>
<p>The images of tilted aquaporin crystals were previously published (<xref ref-type="bibr" rid="c15">Murata et al., 2000</xref>) and are available at <italic><ext-link ext-link-type="uri" xlink:href="https://grigoriefflab.umassmed.edu/tilted_aquaporin_crystals">https://grigoriefflab.umassmed.edu/tilted_aquaporin_crystals</ext-link></italic>. The untilted exposures of ER-HOXB8 cells are available at EMPIAR (EMPIAR-11063). The tomogramsand tilt series from ER-HOXB8 cells have been deposited to EMDB (EMD-43419, EMD-43420, EMD-43424, EMD-43425, EMD-43427, EMD-43428, EMD-43429) and EMPIAR (EMPIAR-11854), respectively. The source code for CTFFIND5 is available at <italic><ext-link ext-link-type="uri" xlink:href="https://github.com/timothygrant80/cisTEM/tree/ctffind5">https://github.com/timothygrant80/cisTEM/tree/ctffind5</ext-link></italic> and binaries for most Linux distributions can be downloaded at <italic><ext-link ext-link-type="uri" xlink:href="https://cistem.org/development">https://cistem.org/development</ext-link></italic>.</p>
</sec>
<ack>
<title>Acknowledgments</title>
<p>We would like to thank members of the Grigorieff lab for testing CTFFIND5 and helpful discussion. We furthermore thank Benjamin Himes for helpful discussions and code review within <italic>cis</italic>TEM. We thank Alexis Rohou for comments on the manuscript. L.K. and N.G. gratefully acknowledge funding from the Chan Zuckerberg Initiative, grant #2021-234617 (5022).</p>
</ack>
<sec id="s6">
<title>Author contributions</title>
<p>Conceptualization: J.E. and N.G.; Data curation: J.E., L.K. and X.Z.; Formal analysis: J.E., L.K., X.Z. and N.G.; Funding acquisition: N.G.; Investigation: J.E., L.K. and X.Z.; Methodology: J.E., L.K. and N.G.; Project administration: J.E. and N.G.; Resources: J.E. and N.G.; Software: J.E., L.K. and N.G.; Supervision: J.E. and N.G.; Validation: J.E., L.K., X.Z. and N.G.; Visualization: J.E., L.K. and X.Z.; Writing – original draft: J.E., L.K., X.Z. and N.G.; Writing -review &amp; editing: J.E., L.K., X.Z. and N.G.;</p>
</sec>
<ref-list>
<title>Bibliography</title>
<ref id="c1"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Cheng</surname> <given-names>J</given-names></string-name>, <string-name><surname>Liu</surname> <given-names>T</given-names></string-name>, <string-name><surname>You</surname> <given-names>X</given-names></string-name>, <string-name><surname>Zhang</surname> <given-names>F</given-names></string-name>, <string-name><surname>Sui</surname> <given-names>S-F</given-names></string-name>, <string-name><surname>Wan</surname> <given-names>X</given-names></string-name>, <string-name><surname>Zhang</surname> <given-names>X.</given-names></string-name></person-group> <year>2023</year>. <article-title>Determining protein structures in cellular lamella at pseudo-atomic resolution by GisSPA</article-title>. <source>Nat Commun</source> <volume>14</volume>:<fpage>1282</fpage>. doi:<pub-id pub-id-type="doi">10.1038/s41467-023-36175-y</pub-id></mixed-citation></ref>
<ref id="c2"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Elferich</surname> <given-names>J</given-names></string-name>, <string-name><surname>Schiroli</surname> <given-names>G</given-names></string-name>, <string-name><surname>Scadden</surname> <given-names>DT</given-names></string-name>, <string-name><surname>Grigorieff</surname> <given-names>N.</given-names></string-name></person-group> <year>2022</year>. <article-title>Defocus Corrected Large Area Cryo-EM (DeCo-LACE) for label-free detection of molecules across entire cell sections</article-title>. <source>Elife</source> <volume>11</volume>:<fpage>e80980</fpage>. doi:<pub-id pub-id-type="doi">10.7554/eLife.80980</pub-id></mixed-citation></ref>
<ref id="c3"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Grant</surname> <given-names>T</given-names></string-name>, <string-name><surname>Grigorieff</surname> <given-names>N.</given-names></string-name></person-group> <year>2015</year>. <article-title>Measuring the optimal exposure for single particle cryo-EM using a 2.6 Å reconstruction of rotavirus VP6</article-title>. <source>eLife</source> <volume>4</volume>:<fpage>e06980</fpage>. doi:<pub-id pub-id-type="doi">10.7554/eLife.06980</pub-id></mixed-citation></ref>
<ref id="c4"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Grant</surname> <given-names>T</given-names></string-name>, <string-name><surname>Rohou</surname> <given-names>A</given-names></string-name>, <string-name><surname>Grigorieff</surname> <given-names>N.</given-names></string-name></person-group> <year>2018</year>. <article-title>cisTEM, user-friendly software for single-particle image processing</article-title>. <source>Elife</source> <volume>7</volume>:<fpage>e35383</fpage>. doi:<pub-id pub-id-type="doi">10.7554/eLife.35383</pub-id></mixed-citation></ref>
<ref id="c5"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Hagen</surname> <given-names>WJH</given-names></string-name>, <string-name><surname>Wan</surname> <given-names>W</given-names></string-name>, <string-name><surname>Briggs</surname> <given-names>JAG</given-names></string-name></person-group>. <year>2017</year>. <article-title>Implementation of a cryo-electron tomography tilt-scheme optimized for high resolution subtomogram averaging</article-title>. <source>Journal of Structural Biology, Electron Tomography</source> <volume>197</volume>:<fpage>191</fpage>–<lpage>198</lpage>. doi:<pub-id pub-id-type="doi">10.1016/j.jsb.2016.06.007</pub-id></mixed-citation></ref>
<ref id="c6"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Heymann</surname> <given-names>JB</given-names></string-name>, <string-name><surname>Belnap</surname> <given-names>DM</given-names></string-name></person-group>. <year>2007</year>. <article-title>Bsoft: image processing and molecular modeling for electron microscopy</article-title>. <source>J Struct Biol</source> <volume>157</volume>:<fpage>3</fpage>–<lpage>18</lpage>. doi:<pub-id pub-id-type="doi">10.1016/j.jsb.2006.06.006</pub-id></mixed-citation></ref>
<ref id="c7"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lucas</surname> <given-names>BA</given-names></string-name>, <string-name><surname>Grigorieff</surname> <given-names>N.</given-names></string-name></person-group> <year>2023</year>. <article-title>Quantification of gallium cryo-FIB milling damage in biological lamellae</article-title>. <source>Proceedings of the National Academy of Sciences</source> <volume>120</volume>:<fpage>e2301852120</fpage>. doi:<pub-id pub-id-type="doi">10.1073/pnas.2301852120</pub-id></mixed-citation></ref>
<ref id="c8"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lucas</surname> <given-names>BA</given-names></string-name>, <string-name><surname>Himes</surname> <given-names>BA</given-names></string-name>, <string-name><surname>Xue</surname> <given-names>L</given-names></string-name>, <string-name><surname>Grant</surname> <given-names>T</given-names></string-name>, <string-name><surname>Mahamid</surname> <given-names>J</given-names></string-name>, <string-name><surname>Grigorieff</surname> <given-names>N.</given-names></string-name></person-group> <year>2021</year>. <article-title>Locating macromolecular assemblies in cells by 2D template matching with cisTEM</article-title>. <source>eLife</source> <volume>10</volume>:<fpage>e68946</fpage>. doi:<pub-id pub-id-type="doi">10.7554/eLife.68946</pub-id></mixed-citation></ref>
<ref id="c9"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mastronarde</surname> <given-names>DN</given-names></string-name></person-group>. <year>2024</year>. <article-title>Accurate, automatic determination of astigmatism and phase with Ctfplotter in IMOD</article-title>. <source>J Struct Biol</source> <volume>216</volume>:<fpage>108057</fpage>. doi:<pub-id pub-id-type="doi">10.1016/j.jsb.2023.108057</pub-id></mixed-citation></ref>
<ref id="c10"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mastronarde</surname> <given-names>DN</given-names></string-name></person-group>. <year>2005</year>. <article-title>Automated electron microscope tomography using robust prediction of specimen movements</article-title>. <source>J Struct Biol</source> <volume>152</volume>:<fpage>36</fpage>–<lpage>51</lpage>. doi:<pub-id pub-id-type="doi">10.1016/j.jsb.2005.07.007</pub-id></mixed-citation></ref>
<ref id="c11"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mastronarde</surname> <given-names>DN</given-names></string-name></person-group>. <year>1997</year>. <article-title>Dual-Axis Tomography: An Approach with Alignment Methods That Preserve Resolution</article-title>. <source>Journal of Structural Biology</source> <volume>120</volume>:<fpage>343</fpage>–<lpage>352</lpage>. doi:<pub-id pub-id-type="doi">10.1006/jsbi.1997.3919</pub-id></mixed-citation></ref>
<ref id="c12"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mastronarde</surname> <given-names>DN</given-names></string-name>, <string-name><surname>Held</surname> <given-names>SR</given-names></string-name></person-group>. <year>2017</year>. <article-title>Automated tilt series alignment and tomographic reconstruction in IMOD</article-title>. <source>J Struct Biol</source> <volume>197</volume>:<fpage>102</fpage>–<lpage>113</lpage>. doi:<pub-id pub-id-type="doi">10.1016/j.jsb.2016.07.011</pub-id></mixed-citation></ref>
<ref id="c13"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>McMullan</surname> <given-names>G</given-names></string-name>, <string-name><surname>Vinothkumar</surname> <given-names>KR</given-names></string-name>, <string-name><surname>Henderson</surname> <given-names>R.</given-names></string-name></person-group> <year>2015</year>. <article-title>Thon rings from amorphous ice and implications of beam-induced Brownian motion in single particle electron cryo-microscopy</article-title>. <source>Ultramicroscopy</source> <volume>158</volume>:<fpage>26</fpage>–<lpage>32</lpage>. doi:<pub-id pub-id-type="doi">10.1016/j.ultramic.2015.05.017</pub-id></mixed-citation></ref>
<ref id="c14"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Mindell</surname> <given-names>JA</given-names></string-name>, <string-name><surname>Grigorieff</surname> <given-names>N.</given-names></string-name></person-group> <year>2003</year>. <article-title>Accurate determination of local defocus and specimen tilt in electron microscopy</article-title>. <source>J Struct Biol</source> <volume>142</volume>:<fpage>334</fpage>–<lpage>347</lpage>. doi:<pub-id pub-id-type="doi">10.1016/s1047-8477(03)00069-8</pub-id></mixed-citation></ref>
<ref id="c15"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Murata</surname> <given-names>K</given-names></string-name>, <string-name><surname>Mitsuoka</surname> <given-names>K</given-names></string-name>, <string-name><surname>Hirai</surname> <given-names>T</given-names></string-name>, <string-name><surname>Walz</surname> <given-names>T</given-names></string-name>, <string-name><surname>Agre</surname> <given-names>P</given-names></string-name>, <string-name><surname>Heymann</surname> <given-names>JB</given-names></string-name>, <string-name><surname>Engel</surname> <given-names>A</given-names></string-name>, <string-name><surname>Fujiyoshi</surname> <given-names>Y.</given-names></string-name></person-group> <year>2000</year>. <article-title>Structural determinants of water permeation through aquaporin-1</article-title>. <source>Nature</source> <volume>407</volume>:<fpage>599</fpage>–<lpage>605</lpage>. doi:<pub-id pub-id-type="doi">10.1038/35036519</pub-id></mixed-citation></ref>
<ref id="c16"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Pedregosa</surname> <given-names>F</given-names></string-name>, <string-name><surname>Varoquaux</surname> <given-names>G</given-names></string-name>, <string-name><surname>Gramfort</surname> <given-names>A</given-names></string-name>, <string-name><surname>Michel</surname> <given-names>V</given-names></string-name>, <string-name><surname>Thirion</surname> <given-names>B</given-names></string-name>, <string-name><surname>Grisel</surname> <given-names>O</given-names></string-name>, <string-name><surname>Blondel</surname> <given-names>M</given-names></string-name>, <string-name><surname>Prettenhofer</surname> <given-names>P</given-names></string-name>, <string-name><surname>Weiss</surname> <given-names>R</given-names></string-name>, <string-name><surname>Dubourg</surname> <given-names>V</given-names></string-name>, <string-name><surname>Vanderplas</surname> <given-names>J</given-names></string-name>, <string-name><surname>Passos</surname> <given-names>A</given-names></string-name>, <string-name><surname>Cournapeau</surname> <given-names>D</given-names></string-name>, <string-name><surname>Brucher</surname> <given-names>M</given-names></string-name>, <string-name><surname>Perrot</surname> <given-names>M</given-names></string-name>, <string-name><surname>Duchesnay</surname> <given-names>E.</given-names></string-name></person-group> <year>2011</year>. <article-title>Scikit-learn: Machine Learning in Python</article-title>. <source>Journal of Machine Learning Research</source> <volume>12</volume>:<fpage>2825</fpage>–<lpage>2830</lpage>.</mixed-citation></ref>
<ref id="c17"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Punjani</surname> <given-names>A</given-names></string-name>, <string-name><surname>Rubinstein</surname> <given-names>JL</given-names></string-name>, <string-name><surname>Fleet</surname> <given-names>DJ</given-names></string-name>, <string-name><surname>Brubaker</surname> <given-names>MA</given-names></string-name></person-group>. <year>2017</year>. <article-title>cryoSPARC: algorithms for rapid unsupervised cryo-EM structure determination</article-title>. <source>Nat Methods</source> <volume>14</volume>:<fpage>290</fpage>–<lpage>296</lpage>. doi:<pub-id pub-id-type="doi">10.1038/nmeth.4169</pub-id></mixed-citation></ref>
<ref id="c18"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Rice</surname> <given-names>WJ</given-names></string-name>, <string-name><surname>Cheng</surname> <given-names>A</given-names></string-name>, <string-name><surname>Noble</surname> <given-names>AJ</given-names></string-name>, <string-name><surname>Eng</surname> <given-names>ET</given-names></string-name>, <string-name><surname>Kim</surname> <given-names>LY</given-names></string-name>, <string-name><surname>Carragher</surname> <given-names>B</given-names></string-name>, <string-name><surname>Potter</surname> <given-names>CS</given-names></string-name></person-group>. <year>2018</year>. <article-title>Routine Determination of Ice Thickness for Cryo-EM Grids</article-title>. <source>J Struct Biol</source> <volume>204</volume>:<fpage>38</fpage>–<lpage>44</lpage>. doi:<pub-id pub-id-type="doi">10.1016/j.jsb.2018.06.007</pub-id></mixed-citation></ref>
<ref id="c19"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Rickgauer</surname> <given-names>JP</given-names></string-name>, <string-name><surname>Grigorieff</surname> <given-names>N</given-names></string-name>, <string-name><surname>Denk</surname> <given-names>W.</given-names></string-name></person-group> <year>2017</year>. <article-title>Single-protein detection in crowded molecular environments in cryo-EM images</article-title>. <source>eLife</source> <volume>6</volume>:<fpage>e25648</fpage>. doi:<pub-id pub-id-type="doi">10.7554/eLife.25648</pub-id></mixed-citation></ref>
<ref id="c20"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Rohou</surname> <given-names>A</given-names></string-name>, <string-name><surname>Grigorieff</surname> <given-names>N.</given-names></string-name></person-group> <year>2015</year>. <article-title>CTFFIND4: Fast and accurate defocus estimation from electron micrographs</article-title>. <source>J Struct Biol</source> <volume>192</volume>:<fpage>216</fpage>–<lpage>221</lpage>. doi:<pub-id pub-id-type="doi">10.1016/j.jsb.2015.08.008</pub-id></mixed-citation></ref>
<ref id="c21"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Su</surname> <given-names>M.</given-names></string-name></person-group> <year>2019</year>. <article-title>goCTF: Geometrically optimized CTF determination for single-particle cryo-EM</article-title>. <source>Journal of Structural Biology</source> <volume>205</volume>:<fpage>22</fpage>–<lpage>29</lpage>. doi:<pub-id pub-id-type="doi">10.1016/j.jsb.2018.11.012</pub-id></mixed-citation></ref>
<ref id="c22"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Tan</surname> <given-names>YZ</given-names></string-name>, <string-name><surname>Baldwin</surname> <given-names>PR</given-names></string-name>, <string-name><surname>Davis</surname> <given-names>JH</given-names></string-name>, <string-name><surname>Williamson</surname> <given-names>JR</given-names></string-name>, <string-name><surname>Potter</surname> <given-names>CS</given-names></string-name>, <string-name><surname>Carragher</surname> <given-names>B</given-names></string-name>, <string-name><surname>Lyumkis</surname> <given-names>D.</given-names></string-name></person-group> <year>2017</year>. <article-title>Addressing preferred specimen orientation in single-particle cryo-EM through tilting</article-title>. <source>Nat Methods</source> <volume>14</volume>:<fpage>793</fpage>–<lpage>796</lpage>. doi:<pub-id pub-id-type="doi">10.1038/nmeth.4347</pub-id></mixed-citation></ref>
<ref id="c23"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Tegunov</surname> <given-names>D</given-names></string-name>, <string-name><surname>Cramer</surname> <given-names>P.</given-names></string-name></person-group> <year>2019</year>. <article-title>Real-time cryo-electron microscopy data preprocessing with Warp</article-title>. <source>Nat Methods</source> <volume>16</volume>:<fpage>1146</fpage>–<lpage>1152</lpage>. doi:<pub-id pub-id-type="doi">10.1038/s41592-019-0580-y</pub-id></mixed-citation></ref>
<ref id="c24"><mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><surname>Thon</surname> <given-names>F.</given-names></string-name></person-group> <year>1971</year>. <source>Phase contrast transfer functionElectron Microscopy in Material Science</source>. <publisher-name>Academic Press</publisher-name> <publisher-loc>New York</publisher-loc>. pp. <fpage>570</fpage>–<lpage>625</lpage>.</mixed-citation></ref>
<ref id="c25"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Tichelaar</surname> <given-names>W</given-names></string-name>, <string-name><surname>Hagen</surname> <given-names>WJH</given-names></string-name>, <string-name><surname>Gorelik</surname> <given-names>TE</given-names></string-name>, <string-name><surname>Xue</surname> <given-names>L</given-names></string-name>, <string-name><surname>Mahamid</surname> <given-names>J.</given-names></string-name></person-group> <year>2020</year>. <article-title>TEM bright field imaging of thick specimens: nodes in Thon ring patterns</article-title>. <source>Ultramicroscopy</source> <volume>216</volume>:<fpage>113023</fpage>. doi:<pub-id pub-id-type="doi">10.1016/j.ultramic.2020.113023</pub-id></mixed-citation></ref>
<ref id="c26"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Tuijtel</surname> <given-names>MW</given-names></string-name>, <string-name><surname>Cruz-León</surname> <given-names>S</given-names></string-name>, <string-name><surname>Kreysing</surname> <given-names>JP</given-names></string-name>, <string-name><surname>Welsch</surname> <given-names>S</given-names></string-name>, <string-name><surname>Hummer</surname> <given-names>G</given-names></string-name>, <string-name><surname>Beck</surname> <given-names>M</given-names></string-name>, <string-name><surname>Turoňová</surname> <given-names>B.</given-names></string-name></person-group> <year>2024</year>. <article-title>Thinner is not always better: Optimizing cryo-lamellae for subtomogram averaging</article-title>. <source>Science Advances</source> <volume>10</volume>:<fpage>eadk6285</fpage>. doi:<pub-id pub-id-type="doi">10.1126/sciadv.adk6285</pub-id></mixed-citation></ref>
<ref id="c27"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Xiong</surname> <given-names>Q</given-names></string-name>, <string-name><surname>Morphew</surname> <given-names>MK</given-names></string-name>, <string-name><surname>Schwartz</surname> <given-names>CL</given-names></string-name>, <string-name><surname>Hoenger</surname> <given-names>AH</given-names></string-name>, <string-name><surname>Mastronarde</surname> <given-names>DN</given-names></string-name></person-group>. <year>2009</year>. <article-title>CTF determination and correction for low dose tomographic tilt series</article-title>. <source>Journal of Structural Biology</source> <volume>168</volume>:<fpage>378</fpage>–<lpage>387</lpage>. doi:<pub-id pub-id-type="doi">10.1016/j.jsb.2009.08.016</pub-id></mixed-citation></ref>
<ref id="c28"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Yan</surname> <given-names>R</given-names></string-name>, <string-name><surname>Edwards</surname> <given-names>TJ</given-names></string-name>, <string-name><surname>Pankratz</surname> <given-names>LM</given-names></string-name>, <string-name><surname>Kuhn</surname> <given-names>RJ</given-names></string-name>, <string-name><surname>Lanman</surname> <given-names>JK</given-names></string-name>, <string-name><surname>Liu</surname> <given-names>J</given-names></string-name>, <string-name><surname>Jiang</surname> <given-names>W.</given-names></string-name></person-group> <year>2015</year>. <article-title>Simultaneous determination of sample thickness, tilt, and electron mean free path using tomographic tilt images based on Beer-Lambert law</article-title>. <source>J Struct Biol</source> <volume>192</volume>:<fpage>287</fpage>–<lpage>296</lpage>. doi:<pub-id pub-id-type="doi">10.1016/j.jsb.2015.09.019</pub-id></mixed-citation></ref>
<ref id="c29"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhang</surname> <given-names>K.</given-names></string-name></person-group> <year>2016</year>. <article-title>Gctf: Real-time CTF determination and correction</article-title>. <source>Journal of Structural Biology</source> <volume>193</volume>:<fpage>1</fpage>–<lpage>12</lpage>. doi:<pub-id pub-id-type="doi">10.1016/j.jsb.2015.11.003</pub-id></mixed-citation></ref>
<ref id="c30"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zivanov</surname> <given-names>J</given-names></string-name>, <string-name><surname>Nakane</surname> <given-names>T</given-names></string-name>, <string-name><surname>Forsberg</surname> <given-names>BO</given-names></string-name>, <string-name><surname>Kimanius</surname> <given-names>D</given-names></string-name>, <string-name><surname>Hagen</surname> <given-names>WJ</given-names></string-name>, <string-name><surname>Lindahl</surname> <given-names>E</given-names></string-name>, <string-name><surname>Scheres</surname> <given-names>SH</given-names></string-name></person-group>. <year>2018</year>. <article-title>New tools for automated high-resolution cryo-EM structure determination in RELION-3</article-title>. <source>Elife</source> <volume>7</volume>:<fpage>e42166</fpage>. doi:<pub-id pub-id-type="doi">10.7554/eLife.42166</pub-id></mixed-citation></ref>
<ref id="c31"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zivanov</surname> <given-names>J</given-names></string-name>, <string-name><surname>Nakane</surname> <given-names>T</given-names></string-name>, <string-name><surname>Scheres</surname> <given-names>SHW</given-names></string-name></person-group>. <year>2020</year>. <article-title>Estimation of high-order aberrations and anisotropic magnification from cryo-EM data sets in RELION-3.1</article-title>. <source>IUCrJ</source> <volume>7</volume>:<fpage>253</fpage>–<lpage>267</lpage>. doi:<pub-id pub-id-type="doi">10.1107/S2052252520000081</pub-id></mixed-citation></ref>
</ref-list>
</back>
<sub-article id="sa0" article-type="editor-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.97227.2.sa3</article-id>
<title-group>
<article-title>eLife Assessment</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<name>
<surname>Scheres</surname>
<given-names>Sjors HW</given-names>
</name>
<role specific-use="editor">Reviewing Editor</role>
<aff>
<institution-wrap>
<institution>MRC Laboratory of Molecular Biology</institution>
</institution-wrap>
<city>Cambridge</city>
<country>United Kingdom</country>
</aff>
</contrib>
</contrib-group>
<kwd-group kwd-group-type="evidence-strength">
<kwd>Compelling</kwd>
</kwd-group>
<kwd-group kwd-group-type="claim-importance">
<kwd>Valuable</kwd>
</kwd-group>
</front-stub>
<body>
<p>This <bold>valuable</bold> work presents the latest version of CTFFIND, which is the most popular software for determination of the contrast transfer function (CTF) in cryo-electron microscopy. CTFFIND5 estimates and considers acquisition geometry and sample thickness, which leads to improved CTF determination. The paper describes <bold>compelling</bold> evidence that CTFFIND5 finds better CTF parameters than previous methods, in particular for tilted samples (e.g. for cryo-electron tomography) or where thickness is an issue (e.g. cellular samples, or electron microscopy at low voltages).</p>
</body>
</sub-article>
<sub-article id="sa1" article-type="referee-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.97227.2.sa2</article-id>
<title-group>
<article-title>Reviewer #1 (Public review):</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<anonymous/>
<role specific-use="referee">Reviewer</role>
</contrib>
</contrib-group>
</front-stub>
<body>
<p>This work presents CTFFIND5, a new version of the software for determination of the Contrast Transfer Function (CTF) that models the distortions introduced by the microscope in cryoEM images. CTFFIND5 can take acquisition geometry and sample thickness into consideration to improve CTF estimation.</p>
<p>To estimate tilt (tilt angle and tilt axis), the input image is split into tiles and correlation coefficients are computed between their power spectra and a local CTF model that includes the defocus variation according to a tilted plane. As a final step, by applying a rescaling factor to the power spectra of the tiles, an average tilt-corrected power spectrum is obtained used for diagnostic purposes and estimate the goodness of fit. This global procedure and the rescaling factor resemble those used in Bsoft, Warp, etc, with determination of the tilt parameters being a feature specific of CTFFIND5 (and formerly CTFTILT). The performance of the algorithm is evaluated with tilted 2D crystals and tilt-series, demonstrating accurate tilt estimation in general.</p>
<p>CTFFIND5 represents the first CTF determination tool that considers the thickness-related modulation envelope of the CTF firstly described by McMullan et al. (2015) and experimentally confirmed by Tichelaar et al. (2020). To this end, CTFFIND5 uses a new CTF model that takes the sample thickness into account. CTFFIND5 thus provides more accurate CTF estimation and, furthermore, gives an estimation of the sample thickness, which may be a valuable resource to judge the potential for high resolution. To evaluate the accuracy of thickness estimation in CTFFIND5, the authors use the Lambert-Beer law on energy-filtered data and also tomographic data, thus demonstrating that the estimates are reasonable for images with exposure around 30 e/A2. While consideration of sample thickness in CTF determination sounds ideally suited for cryoET, practical application under the standard acquisition protocols in cryoET (exposure of 3-5 e/A2 per image) is still limited. In this regard, the authors are precise in the conclusions and clearly identify the areas where thickness-aware CTF determination will be valuable at present: in situ single particle analysis and in vitro single particle cryoEM of large specimens (e.g. viral particles).</p>
<p>In conclusion, the manuscript introduces novel methods inside CTFFIND5 that improve CTF estimation, namely acquisition geometry and sample thickness. The evaluation demonstrates the performance of the new tool, with fairly accurate estimates of tilt axis, tilt angle and sample thickness and improved CTF estimation. The manuscript critically defines the current range of application of the new methods in cryoEM.</p>
</body>
</sub-article>
<sub-article id="sa2" article-type="referee-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.97227.2.sa1</article-id>
<title-group>
<article-title>Reviewer #2 (Public review):</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<anonymous/>
<role specific-use="referee">Reviewer</role>
</contrib>
</contrib-group>
</front-stub>
<body>
<p>This paper describes the latest version of the most popular program for CTF estimation for cryo-EM images: CTFFIND5. New features in CTFFIND5 are the estimation of tilt geometry, including for samples, like FIB-milled lamellae, that are pre-tilted along a different axis than the tilt axis of the tomographic experiment, plus the estimation of sample thickness from the expanded CTF model described by McMullan et al (2015). The results convincingly show the added value of the program for thicker and tilted images, such as are common in modern cryo-ET experiments. The program will therefore have a considerable impact on the field.</p>
<p>Comments on revised version:</p>
<p>My comments have been addressed adequately.</p>
</body>
</sub-article>
<sub-article id="sa3" article-type="author-comment">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.97227.2.sa0</article-id>
<title-group>
<article-title>Author response:</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<name>
<surname>Elferich</surname>
<given-names>Johannes</given-names>
</name>
<role specific-use="author">Author</role>
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-9911-706X</contrib-id></contrib>
<contrib contrib-type="author">
<name>
<surname>Kong</surname>
<given-names>Lingli</given-names>
</name>
<role specific-use="author">Author</role>
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-5808-2649</contrib-id></contrib>
<contrib contrib-type="author">
<name>
<surname>Zottig</surname>
<given-names>Ximena</given-names>
</name>
<role specific-use="author">Author</role>
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-2344-5163</contrib-id></contrib>
<contrib contrib-type="author">
<name>
<surname>Grigorieff</surname>
<given-names>Nikolaus</given-names>
</name>
<role specific-use="author">Author</role>
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-1506-909X</contrib-id></contrib>
</contrib-group>
</front-stub>
<body>
<p>The following is the authors’ response to the original reviews.</p>
<p>We thank the reviewers for their detailed comments. Several comments revolved around potential improvements in the 3D reconstructions that are obtained in later steps of the image processing pipelines for single-particle cryoEM and cryo-electron tomography. We have not investigated how our improvements in CTFFIND5 affect these downstream results and can therefore not make specific and quantitative statements in this regard. However, CTFFIND5 provided additional information about the sample that users will find useful (thickness, tilt) for selecting the data they would like to include in later processing, and how to process them. Furthermore, when the sample tilt of a thin specimen is known, local defocus estimates (e.g., per-particle defocus estimates) will be more accurate compared to estimates that ignore tilt information. In the following, we provide point-by-point responses to the reviewers’ comments.</p>
<disp-quote content-type="editor-comment">
<p><bold>Reviewer #1 (Public Review):</bold></p>
<p>This work presents CTFFIND5, a new version of the software for determination of the Contrast Transfer Function (CTF) that models the distortions introduced by the microscope in cryoEM images. CTFFIND5 can take acquisition geometry and sample thickness into consideration to improve CTF estimation.</p>
<p>To estimate tilt (tilt angle and tilt axis), the input image is split into tiles and correlation coefficients are computed between their power spectra and a local CTF model that includes the defocus variation according to a tilted plane. As a final step, by applying a rescaling factor to the power spectra of the tiles, an average tilt-corrected power spectrum is obtained and used for diagnostic purposes and to estimate the goodness of fit. This global procedure and the rescaling factor resemble those used in Bsoft, Warp, etc, with determination of the tilt parameters being a feature specific of CTFFIND5 (and formerly CTFTILT). The performance of the algorithm is evaluated with tilted 2D crystals and tiltseries, demonstrating accurate tilt estimation in some cases and some limitations in others. Further analysis of CTF determination with tilt-series, particularly showing whether there is accurate or stable estimation at high tilts, might be helpful to show the robustness of CTFFIND5 in cryoET.</p>
<p>CTFFIND5 represents the first CTF determination tool that considers the thickness-related modulation envelope of the CTF firstly described by McMullan et al. (2015) and experimentally confirmed by Tichelaar et al. (2020). To this end, CTFFIND5 uses a new CTF model that takes the sample thickness into account. CTFFIND5 thus provides more accurate CTF estimation and, furthermore, gives an estimation of the sample thickness, which may be a valuable resource to judge the potential for high resolution. To evaluate the accuracy of thickness estimation in CTFFIND5, the authors use the Lambert-Beer law on energy-filtered data and also tomographic data, thus demonstrating that the estimates are reasonable for images with exposure around 30 e/A2. While consideration of sample thickness in CTF determination sounds ideally suited for cryoET, practical application under the standard acquisition protocols in cryoET (exposure of 3-5 e/A2 per image) is still limited. In this regard, the authors are honest in the conclusions and clearly identify the areas where thickness-aware CTF determination will be valuable at present: e.g. in situ single particle analysis and in vitro single particle cryoEM of purified samples at low voltages.</p>
<p>In conclusion, the manuscript introduces novel methods inside CTFFIND5 that improve CTF estimation, namely acquisition geometry and sample thickness. The evaluation demonstrates the performance of the new tool, with fairly accurate estimates of tilt axis, tilt angle and sample thickness and improved CTF estimation. The manuscript critically defines the current range of application of the new methods in cryoEM.</p>
<p><bold>Reviewer #2 (Public Review):</bold></p>
<p>Summary:</p>
<p>This paper describes the latest version of the most popular program for CTF estimation for cryo-EM images: CTFFIND5. New features in CTFFIND5 are the estimation of tilt geometry, including for samples, like FIB-milled lamellae, that are pre-tilted along a different axis than the tilt axis of the tomographic experiment, plus the estimation of sample thickness from the expanded CTF model described by McMullan et al (2015). The results convincingly show the added value of the program for thicker and tilted images, such as are common in modern cryo-ET experiments. The program will therefore have a considerable impact on the field.</p>
<p>I have only minor suggestions for improvement below:</p>
<p>Abstract: &quot;[CTF estimation] has been one of the key aspects of the resolution revolution&quot;-&gt; This is a bit over the top. Not much changed in the actual algorithms for CTF estimation during the resolution revolution.</p>
</disp-quote>
<p>We have removed this statement in the abstract.</p>
<disp-quote content-type="editor-comment">
<p>L34: &quot;These parameters&quot; -&gt; Cs is typically given, only defocus (and if relevant phase shift) are estimated.</p>
</disp-quote>
<p>We have modified the introduction to reflect this. Page 3, L30-35</p>
<disp-quote content-type="editor-comment">
<p>L110-116: The text is ambiguous: are rotations defined clockwise or counter-clockwise? It would be good to explicitly state what subsequent rotations, in which directions and around which axes this transformation matrix (and the input/output angles in CTFFIND5) correspond to.</p>
</disp-quote>
<p>Thank you for pointing this out. We have revised the Methods section, Page 4 L57-61,  to explicitly define the convention for the tilt axis and tilt angle. We have also modified Fig. 1b to illustrate our convention for the tilt axis.</p>
<disp-quote content-type="editor-comment">
<p>L129-130: As a suggestion: it would be relatively easy, and possibly beneficial to the user, to implement a high-resolution limit that varies with the accumulated dose on the sample. One example of this exists in the tomography pipeline of RELION-5.</p>
</disp-quote>
<p>We appreciate the suggestion. However, since CTFFIND5 currently has no concept of a tilt-series and treats every micrograph independently, this would not be trivial to implement. As detailed below, CTFFIND5 in its current form is not targeted toward tomography processing, but its features might be useful for its use in pipelines for tomography processing, such as RELION-5. We made this more explicit in the conclusion section. Page 16 L390-399</p>
<disp-quote content-type="editor-comment">
<p>Substituting Eq (7) into Eq (6) yields ksi=pi, which cannot be true. If t is the sample thickness, then how can this be a function of the frequency g of the first node of the CTF function? The former is a feature of the sample, the latter is a parameter of the optical system. This needs correction.</p>
</disp-quote>
<p>We have rewritten the text describing equations 7 and 6 to avoid this confusion (Page 7, L146-153). The reviewer is right that inserting Eq. 7 into Eq. 6 yields ksi=psi, as in fact Eq. 7 is derived from Eq. 6, by substituting ksi=psi, since this describes the condition for the first node. Also, in this context, nodes in the CTF function refer to the places where the term sinc(ksi) becomes zero and therefore the CTF is apparently &quot;flat&quot;. The frequency at which this occurs is sample-thickness dependent. As explained below, the previous version of our manuscript did not point out the difference between the first zero and first node in the power spectrum. We have amended Fig. 3a to make this difference clearer.</p>
<disp-quote content-type="editor-comment">
<p><bold>Reviewer #3 (Public Review):</bold></p>
<p>In this manuscript, the authors detail improvements in the core CTFFIND (CTFFIND5 as implemented in cisTEM) algorithm that better estimates CTF parameters from titled micrographs and those that exhibit signal attenuation due to ice thickness. These improvements typically yield more accurate CTF values that better represent the data. Although some of the improvements result in slower calculations per micrograph, these can be easily overcome through parallelization.</p>
<p>There are some concerns outlined below that would benefit from further evaluation by the authors.</p>
<p>For the examples shown in Figure 3b, given the small differences in estimated defocus1 and 2, what type of improvements would be expected in the reconstructed tomograms? Do such improvements in estimates manifest in better tilt-series reconstruction?</p>
</disp-quote>
<p>As explained in our preface, we do not believe that these difference would manifest in any improvements during tilt-series reconstruction and would not create any meaningful differences, even when tomograms are reconstructed with CTF correction. They might become meaningful during subtomogram averaging, but subtomograms are usually corrected using per-particle CTF estimation, similar to single-particle processing. We have included a new paragraph in the discussion to describe potential benefits of CTFFIND5 for cryo-tomography, Page 16 L390-399.</p>
<disp-quote content-type="editor-comment">
<p>Similarly, the data shown in Figure 3C shows minimal improvements in the CTF resolution estimate (e.g., 4.3 versus 4.2 Å), but exhibited several hundred Å difference in defocus values. How do such differences impact downstream processing? Is such a difference overcame by per-particle (local) CTF refinements (like the authors mention in the discussion, see below)?</p>
</disp-quote>
<p>The difference in the defocus estimate (~600A) is substantially smaller than the thickness of the sample (2000A). Hence both estimates may be valid, depending on which particles inside the sample are considered. Particles with larger defocus errors could certainly be corrected by per-particle CTF refinement as long as the search range is chosen to be large enough. The main benefit of using CTFFIND5 is information for the user regarding the sample thickness to set the defocus search range appropriately.</p>
<disp-quote content-type="editor-comment">
<p>At which point does the thickness of the specimen preclude the ice thickness modulation to be included for &quot;accurate&quot; estimate? 500Å? 1000Å? 2000Å? Based on the data shown in Figure 3B, as high as 969 Å thick specimens benefit moderately (4.6 versus 3.4 Å fit estimate), but perhaps not significantly, from the ice thickness estimation. Considering the increased computational time for ice thickness estimation, such an estimate of when to incorporate for single-particle workflows would be beneficial.</p>
</disp-quote>
<p>As explained in our preface, the main benefit for single-particle workflows will be sample tilt estimation. This will provide more accurate per-particle defocus estimates, compared to estimates that do not take the tilt into account. For single-particle samples, the ice thickness in holes is probably more efficiently monitored using the Beer-Lambert law.</p>
<disp-quote content-type="editor-comment">
<p>It would seem that this statement could be evaluated herein: &quot;the analysis of images of purified samples recorded at lower acceleration voltages, e.g., 100 keV (McMullan et al., 2023), may also benefit since thickness-dependent CTF modulations will appear at lower resolution with longer electron wavelengths&quot;. There are numerous examples of 300kV, 200kV, and 100kV EMPIAR datasets to be compared and recommendations would be welcomed.</p>
</disp-quote>
<p>Publicly available datasets recorded at 100kV and 200kV were collected in very thin ice, making it difficult to demonstrate the stated benefits. We have removed this statement.</p>
<disp-quote content-type="editor-comment">
<p>Although logical, this statement is not supported by the data presented in this manuscript: &quot;The improvements of CTFFIND5 will provide better starting values for this refinement, yielding better overall CTF estimation and recovery of high-resolution information during 3D reconstruction.&quot;</p>
</disp-quote>
<p>We have revised this statement and now explain that the sample tilt information will provide more accurate per-particle defocus estimates, compared to estimates that do not take the tilt into account, Page 17, L400-409. We did not investigate how this will affect downstream processing results.</p>
<disp-quote content-type="editor-comment">
<p>Moreso, the lack of single-particle data evaluation does present a concern. Naively, these improvements would benefit all cryoEM data, regardless of modality.</p>
</disp-quote>
<p>We agree with the reviewer that all cryoEM modalities should benefit from more accurate defocus value estimates and have amended our concluding statement. However, how improved defocus values will benefit downstream processing results will depend on the processing pipeline, which includes various points of user input and data-dependent choices. We have therefore limited our analysis to the outputs of CTFFIND5.</p>
<disp-quote content-type="editor-comment">
<p><bold>Recommendations for the authors:</bold></p>
<p><bold>Reviewer #1 (Recommendations For The Authors):</bold></p>
<p>(1) CTFFIND5 in cryo-ET</p>
<p>(1.1) CTFFIND4 is prone to unreliable CTF estimates at high tilts in cryoET, a situation that can be identified by high variability or 'unstable' estimates as a function of the tilt angle. Prof. Mastronarde recently illustrated this situation in his article JSB 216:108057, 2024 (Fig. 7). Therefore, the authors could add results to show whether the improvements to tilt estimation introduced in CTFFIND5 overcome this problem. So, in addition to the estimation of tilt angle and tilt axis in Figure 2, the estimated defocus could also be shown.</p>
</disp-quote>
<p>We have worked with Prof. Mastronarde to help him use CTFFIND as a tool in his cryoET processing pipeline. Mastronarde chose CTFFIND because it contains algorithms and architecture that he could optimize for his purposes. CTFFIND5 is currently lacking the concept of a tilt series and can therefore not take advantage of the additional information that comes with tilt series. Our own applications for CTFFIND5 currently do not include tomography, and our results presented in Fig. 2 were obtained for validation of the tilt estimation feature. We did not attempt to duplicate Mastronarde’s optimization for reliable tilt series processing.</p>
<disp-quote content-type="editor-comment">
<p>Figure 2b of this manuscript already suggests that CTFFIND5 may exhibit some variability of defocus estimates at high tilts (in view of the variability of tilt axis angle). A strategy used in IMOD and TOMOCTF is to consider the tiles of a group of consecutive images (typically 35; especially at high tilts) to add more signal to the average spectrum, thus providing more reliable estimates (illustrated in Mastronarde's article JSB 216:108057, 2024, Fig. 8). Will the authors think that CTFFIND5 might include a strategy like this for cryoET tilt-series?</p>
</disp-quote>
<p>We currently do not have plans to develop CTFFIND5 as a tool for tomography as there are already other excellent tools available, some of them based on CTFFIND’s basic algorithms (see previous comment).</p>
<disp-quote content-type="editor-comment">
<p>(1.2) In cryoET, the CTF is often determined on the aligned tilt-series, with the tilt axis typically running along the Y axis. Has CTFFIND5 got the option to exclude estimation of the tilt geometry (tilt angle and/or axis) and, instead, take tilt geometry directly from the alignment and/or from the microscope??. This would significantly speed up determination of the CTF (in 1-2 seconds per image, according to Table 2) while still taking advantage of all power spectra in tilted images (as described in their tilt estimation algorithm) for improved CTF estimation. This strategy would be similar to what it is done in Bsoft and IMOD.</p>
</disp-quote>
<p>This is an excellent idea and we may implement this in an updated version. The current version is primarily meant for lamellae and single-particle samples where we usually have a single tilt in an unknown direction. For these cases, the suggested feature will have less benefit.</p>
<disp-quote content-type="editor-comment">
<p>Thus, I suggest that the authors should also include results comparing CTF estimation in aligned tilt-series with CTFFIND4 and with CTFFIND5 (with no tilt estimation but indeed taking the tilt information from the alignment or the microscope into account). The results would show that CTFFIND5 is more robust than CTFFIND4, especially at high tilts.</p>
</disp-quote>
<p>Thank you for this suggestion. We are now showing a comparison of defocus estimates from CTFFIND4 and CTFFIND5 in Fig. 2. Indeed, in one case CTFFIND5 seems to report more robust defocus values at high tilt.</p>
<disp-quote content-type="editor-comment">
<p>(1.3) The newer improvements in CTFFIND5 seem to be especially tailored to cryoET. The cryoET community will be highly attracted by these improvements. However, the current standard acquisition protocols (exposure of 3-5 e/A2 per image, tilts up to 60 degrees, etc) limit their full exploitation, particularly the thickness-aware CTF determination. I believe that adding a paragraph exclusively focused on cryoET and describing the potential benefits from CTFFIND5 and their limitations could enrich the Conclusion section. In this paragraph, the authors could highlight the great benefits from the tilt-aware CTF estimation. They could also discuss the current standard acquisition protocols (e.g. exposure 3-5 e/A2 per image, nominal defocus 3-5 microns, cellular thickness from 150 nm up to 200-300 nm that, at a tilt of 60 degrees, become 300 nm up to 400-600 nm) and their implications for the potential benefit from the improvements available in CTFFIND5.</p>
</disp-quote>
<p>This reviewer is clearly excited about the potential application of CTFFIND5 in cryoET. We are sorry that we are currently not developing CTFFIND5 in this direction.</p>
<disp-quote content-type="editor-comment">
<p>(1.4) Apologies for insisting on cryoET in the previous points. I am just trying to suggest ideas to make CTFFIND5 even more helpful in cryoET. You can consider them now, or for a future version of the software, or just ignore them.</p>
</disp-quote>
<p>Thanks for your suggestions. Since there is clearly demand for tools to process tomographic tilt series, we will keep these suggestions in mind for the future development of CTFFIND.</p>
<disp-quote content-type="editor-comment">
<p>(2) Tilt estimation</p>
<p>(2.1) Page 4. Tiles for the initial steps in tilt estimation are of size 128x128.  At which point tiles of larger size (e.g. 512x512) are used?. Please, define.</p>
</disp-quote>
<p>Thank you for pointing out this lack of clarity. For the tilt estimation, we used a tile size 128 x 128, which has been hard-coded in our program, as mentioned in line 68 on page4. For generating the final power spectrum, we usually use size 512 x 512. This tile size can be defined by the user when running the program. We have now clarified this on Page 4, L74-76.</p>
<disp-quote content-type="editor-comment">
<p>(2.2) Page 6 and/or page 11: evaluation of tilt estimation with tilt-series.</p>
<p>Please indicate the acquisition details of the tilt-series used for the evaluation, especially the exposure per image. This information is neither available in this manuscript nor in Elferich et al., 2022.</p>
<p>Please, add these acquisition details similarly to page 9 in this manuscript (evaluation of sample thickness estimation using tomography): pixel size, exposure per image and total exposure, number of images, tilt range and interval</p>
</disp-quote>
<p>The same tilt-series were used to verify tilt-estimation and sample thickness. We have revised the Methods section to make this clear on Page5, L98-105 and Page 10, L202.</p>
<disp-quote content-type="editor-comment">
<p>(2.3) Page 10. Section Results. Subsection Tilt estimation.</p>
<p>The authors use &quot;defocus correction&quot; to refer to their method for scaling the power spectra. &quot;Defocus correction&quot; might perhaps be a misleading term. In contrast, in page 4 the authors use the term &quot;tilt correction&quot;. Please, revise and make it consistent throughout the manuscript.</p>
</disp-quote>
<p>We agree and now use “tilt correction” throughout the manuscript.</p>
<disp-quote content-type="editor-comment">
<p>(2.4) Legend of Figure 2.</p>
<p>Please add what the red dashed curve represents. Also, please note there might be an error in the estimated stage tilt axis angle: the legend states &quot;171.8&quot; where in the main text it is &quot;178.2&quot; (apparently, the latter is the correct one).</p>
</disp-quote>
<p>Thank you for pointing this out. We have modified the legend and changed the number in the legend to 178.2°.</p>
<disp-quote content-type="editor-comment">
<p>(3) Thickness estimation</p>
<p>(3.1) Line 141, page 7. The sentence reads: &quot;The modulation of the CTF due to sample thickness t is described by the function E (current Equation 6), &quot;  I believe that the modulation envelope of the CTF due to sample thickness is not really E (current Equation 6), but the function sinc(E). Please, revise.</p>
</disp-quote>
<p>We have revised the manuscript as advised, Page 7, L148.</p>
<disp-quote content-type="editor-comment">
<p>(3.2) Line 148, page 7. The sentence reads &quot;an estimate of the frequency g of the first node of the CTF_t function &quot;</p>
<p>The concept of 'node' was introduced by Tichelaar et al. (2020). The authors should not assume that this concept is familiar to the readership. So, it is suggested that the authors should introduce this concept in this section. For instance, just after Equation 6 they could add a sentence like this: &quot;This sinc modulation envelope increasingly attenuates the amplitude of the Thon rings with increasing spatial frequencies in an oscillatory fashion, with locations where the amplitude is zero known as nodes (Tichelaar et al., 2020).&quot;</p>
</disp-quote>
<p>Thank you for this suggestion. We have revised the manuscript accordingly (Page 7, L151-156) and also marked the position of the first node in Fig. 3a.</p>
<disp-quote content-type="editor-comment">
<p>(3.3) Line 154, page 8: A citation is lacking: &quot;(corrected for astigmatism, as described in )&quot;. Perhaps the authors refer to the EPA (EquiPhase Averaging) method introduced by Zhang, JSB 193:1-12, 2016, 10.1016/j.jsb.2015.11.003.</p>
</disp-quote>
<p>Thanks for spotting this omission. We have added the appropriate reference.</p>
<disp-quote content-type="editor-comment">
<p>(3.4) Figure 3.</p>
<p>(3.4.1) Perhaps, the EPA (EquiPhase Averaging) method is used to reduce the 2D CTF to 1D curves, as represented in Figure 3b and 3c. Please, mention this in the legend of the figure or in the main text referring to Figure 3. The same might apply to Figure 1c.</p>
</disp-quote>
<p>Thanks for spotting this omission. We have clarified that this is indeed an EPA in the figure legends.</p>
<disp-quote content-type="editor-comment">
<p>(3.4.2) Please indicate what the colored curves represent in 3b and 3c: The fitted CTF model (dashed red) and the EPA or astimatism-corrected radial average of power spectrum (solid black) ?</p>
</disp-quote>
<p>Thanks for spotting this omission. We have added descriptions of the colored lines in these plots (red = modeled CTF, blue = goodness of fit).</p>
<disp-quote content-type="editor-comment">
<p>(3.4.3) Please note that the power spectrum (solid black curves in Figure 3b and 3c) does not look the same in the top and bottom panels: Without thickness estimation (top panels), the power spectrum is in the range [0,1] in Y, as expected. However, with thickness estimation (bottom panels), the power spectrum seems to have undergone a frequencydependent transformation (a rescaling or something that makes the power spectrum oscillates around 0.5 in Y). This transformation of the power spectrum resembles the thickness-induced sinc modulation of the CTF and seems to be appropriate to better fit the new thickness-aware CTF_t model in CTFFIND5 to the (transformed) power spectrum. However, this transformation of the power spectrum is not mentioned in the manuscript at all. Instead, according to the main text (page 8), the fitting method is based on the crosscorrelation between the new CTF model and the power spectrum, so I was expecting to see the same power spectrum black curve in the top and bottom panels. Please, clarify.</p>
</disp-quote>
<p>Indeed, CTFFIND5 displays the power spectrum differently after thickness estimation. We have revised the methods to explain this (page8, L178-181). The reviewer is also correct that the 1D lines plots of the Thon ring patterns in Fig. 3b and 3c are not identical. These 1D plots are generated from the 2D plots according to the fitted CTF, which is needed to follow the astigmatic rings and avoid blurring of the oscillations in the radial average. This means that different CTF fits will also result in somewhat different 1D plots. However, these differences only affect the 1D EPA plots shown to the user. The actual fitting is performed against the same 2D spectra.</p>
<disp-quote content-type="editor-comment">
<p>(3.4.4) Line 319, Page 14. &quot;A linear fit revealed ..&quot; It would be good to add a line with the linear fit in Figure 5.</p>
</disp-quote>
<p>Agreed. The revised Fig. 5 now shows a line for the linear fit.</p>
<disp-quote content-type="editor-comment">
<p>(3.5) New CTF Model</p>
<p>It is not clear from the text if the new CTF_t model is used at all times in CTFFIND5 or only when the user requests thickness estimation. Related to this, if the user requests both tilt estimation and thickness estimation, how is the CTF estimation process carried out in CTFFIND5?: Tilt and thickness are estimated at the same time? or one after the other (i.e. first the tilt is estimated, then followed by thickness estimation)?. Please, clarify.</p>
</disp-quote>
<p>The new CTF_t model is only used when the user requests thickness estimation. When both tilt-estimation and thickness estimation are requested, the tilt is estimated first and the corrected power spectrum is then fitted using the CTF_t model. We have revised the Methods section to explain this better, Page 8, L158-159.</p>
<disp-quote content-type="editor-comment">
<p>(4) Pages 14-15. Section &quot;CTF estimation and correction assists &quot;</p>
<p>This section just shows that correction of a highly underfocused image for the CTF with phase flipping or a Wiener filter reduces the CTF-induced fringes. I do not really understand the inclusion of this section to the manuscript. There is no contribution related to CTFFIND5.</p>
</disp-quote>
<p>The ability to apply a CTF correction to the input image according to Tegunov &amp; Cramer is a new feature of apply_ctf, a program included with cisTEM. We think that this section fits into the theme of CTFFIND5 because the correction adds valuable information about the samples, such as FIB-milled lamellae.</p>
<disp-quote content-type="editor-comment">
<p>If the authors prefer to keep this section, then please take the following points into account:</p>
<p>(4.1) Figure 6b: This is the only time that the term &quot;EPA&quot; (EquiPhase Averaging, I guess) is used in the manuscript. Please, spell it out somewhere in the manuscript, define what it means and add a proper citation, if convenient. This point is related to point 3.3 above.</p>
</disp-quote>
<p>We have added the appropriate reference and defined EPA in the methods section as indicated in the reply to point 3.3.</p>
<disp-quote content-type="editor-comment">
<p>(4.2) Figure 6d. The contrast of this image is poor. Please, increase the contrast (to be similar to Figure 6c) so that the details can be better discerned. The image also shows a grainy texture, likely artefacts from the Wiener filter due to excessive amplification. Maybe the 'strength parameter' S of the deconvolution Wiener filter (Tegunov &amp; Cramer, 2019) should be tuned down or the 'fall-off parameter' F tuned up to try to attenuate these artefacts.</p>
</disp-quote>
<p>Agreed. The revised figure shows panel d with increased contrast with the custom fall-off parameter set to 1.3 and the custom strength parameter set to 0.7.</p>
<disp-quote content-type="editor-comment">
<p>(5) CTFFIND5 runtimes</p>
<p>Table 2 shows that estimation of tilt increases the runtime up to 39 s in an image of 4070x2892 and to 208 s in one of 2880x2046. There is a significant difference between these two cases (39 s vs. 208 s) and the first image is much larger than the second. Why does CTFFIND5 on the smaller image take so long compared to the larger image?</p>
</disp-quote>
<p>During tilt estimation, the images are binned to a pixel size of 5 Å. This causes micrograph 1 to be substantially smaller (in pixels) than micrographs 2 and 3, resulting in the faster runtime.</p>
<disp-quote content-type="editor-comment">
<p>(6) Conclusions</p>
<p>(6.1) In the Conclusion section, the authors could elaborate a bit the insights about the sample quality provided by CTFFIND5. This is stated in the title of the manuscript, but it was hardly mentioned in the manuscript.</p>
</disp-quote>
<p>We have revised the conclusion to make this clearer (Page 16, L389-396). CTFFIND5 helps in estimating sample quality since (1) the sample thickness is an important determinant in the amount of high-resolution signal in a micrograph and (2) the estimated fit-resolution reflects more accurately the amount of signal present in a micrograph after tilt and sample thickness have been taken into account.</p>
<disp-quote content-type="editor-comment">
<p>(6.2) The authors nicely identify and describe the applications where thickness-aware CTF determination will be valuable: in situ single particle analysis and in vitro single particle cryoEM of purified samples at low voltages. Perhaps, CTFFIND5 will also be of great interest for single particle cryoEM of thick specimens (e.g. capsid of large viruses with diameter in the range 120-200 nm such as PBCV-1 or HSV-1).</p>
</disp-quote>
<p>Agreed. We have added this case to our Conclusions. (Fig. 3d)</p>
<disp-quote content-type="editor-comment">
<p>(7) Typographical errors:</p>
<p>line 161, page 8. &quot;1.5 time&quot; should be &quot;1.5 times&quot;</p>
<p>lines 185-191. All exposures are given in 'electrons/Angstrom', not in 'electrons/square Angstrom'</p>
<p>line 206, page 10. With &quot;slides&quot; the authors seem to mean &quot;slices&quot;</p>
<p>line 338, page 14: &quot;describeD by Tegunov&quot;</p>
<p>line 349, page 15. &quot;power spectra&quot;</p>
<p>lines 366 and 368, page 15: Note that Square Angstrom is written as &quot;A2&quot;. Put &quot;2&quot; with superscript.</p>
</disp-quote>
<p>Thank you for pointing out these errors. They have been corrected.</p>
<disp-quote content-type="editor-comment">
<p>(8) References:</p>
<p>Reference: Lucas et al., eLife 10 e68946. Year is lacking. Add year: 2021.</p>
<p>Reference: Yan et al. 2015 cited in line 169, page 8, does not appear in Bibliography. The authors may mean: Yan et al. 2015 JSB 192:287-296, 2015</p>
<p>It would be good to cite Bsoft, as it has a procedure similar to tilt-corrected CTF estimation: Heymann, Protein Science, 2021,</p>
</disp-quote>
<p>Thank you for carefully checking the cited references. We have revised the manuscript as suggested.</p>
<disp-quote content-type="editor-comment">
<p><bold>Reviewer #2 (Recommendations For The Authors):</bold></p>
<p>I have only minor suggestions for improvement below:</p>
<p>L218: &quot;these option&quot;</p>
</disp-quote>
<p>Corrected</p>
<disp-quote content-type="editor-comment">
<p>L243: &quot;chevron-shape&quot; -&gt; V-shape would be more accessible language for non-native speakers.</p>
</disp-quote>
<p>Changed</p>
<disp-quote content-type="editor-comment">
<p>L281: &quot;Based on these results we conclude that CTFFIND5 will provide more accurate CTF parameters&quot; -&gt; Given that the maximum resolutions of the fits by the old model and the new model are nearly the same, how big would the actual advantage of the new model be for subsequent sub-tomogram averaging?</p>
</disp-quote>
<p>Please see our response above, Reviewer #3 (Public Review),</p>
<disp-quote content-type="editor-comment">
<p>L376: The correct reference for RELION per-particle CTF estimation is Zivanov et al, (2018) [<ext-link ext-link-type="uri" xlink:href="https://elifesciences.org/articles/42166">https://elifesciences.org/articles/42166</ext-link>]. Also, the cryoSPARC paper referenced does not describe per-particle CTF estimation and should thus be removed from this context.</p>
</disp-quote>
<p>Thanks for pointing out these mistakes, which we have now corrected. We have chosen to keep the citation for CryoSPARC to reference the general software, but have added Ziavanov et.al. 2020 as suggested by the CryoSPARC website.</p>
<disp-quote content-type="editor-comment">
<p><bold>Reviewer #3 (Recommendations For The Authors):</bold></p>
<p>Minor:</p>
<p>Figure 1A legend - authors mention boxes but only 1 box is shown.</p>
</disp-quote>
<p>Thank you for pointing this out. For visual clarity we decided to only show one box. We have corrected the legend.</p>
<disp-quote content-type="editor-comment">
<p>Figure 1B - it would be nice if the boxes that contributed to the power spectra were mapped on Figure 1A</p>
</disp-quote>
<p>The shown power spectra are not actual data. Instead, we show power spectra with exaggerated defocus differences for visual clarity. We have revised the figure legends to make this clear.</p>
<disp-quote content-type="editor-comment">
<p>The Y-axis legends in Figure 2 are not aligned vertically</p>
</disp-quote>
<p>Corrected</p>
<disp-quote content-type="editor-comment">
<p>Figure 3A - CTFFIND4 is missing an &quot;I&quot;</p>
</disp-quote>
<p>Corrected</p>
<disp-quote content-type="editor-comment">
<p>Figure 3 - Y-axis legends are not aligned vertically</p>
</disp-quote>
<p>Corrected</p>
<disp-quote content-type="editor-comment">
<p>Page 16, line 376, Relion should be RELION</p>
</disp-quote>
<p>We have revised the manuscript as advised.</p>
<disp-quote content-type="editor-comment">
<p>Typo in equation 5, sinc versus sin?</p>
</disp-quote>
<p>“sinc” is correct here, since this is a thickness-dependent modulation of the CTF.</p>
<disp-quote content-type="editor-comment">
<p>Lambert-Beer's, Lambert-Beer are used variably but curious if Beer-Lambert should be used.</p>
</disp-quote>
<p>We have revised the manuscript as advised.</p>
</body>
</sub-article>
</article>