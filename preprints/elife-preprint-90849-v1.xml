<?xml version="1.0" ?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.3 20210610//EN"  "JATS-archivearticle1-mathml3.dtd"><article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.3" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="nlm-ta">elife</journal-id>
<journal-id journal-id-type="publisher-id">eLife</journal-id>
<journal-title-group>
<journal-title>eLife</journal-title>
</journal-title-group>
<issn publication-format="electronic" pub-type="epub">2050-084X</issn>
<publisher>
<publisher-name>eLife Sciences Publications, Ltd</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">90849</article-id>
<article-id pub-id-type="doi">10.7554/eLife.90849</article-id>
<article-id pub-id-type="doi" specific-use="version">10.7554/eLife.90849.1</article-id>
<article-version-alternatives>
<article-version article-version-type="publication-state">reviewed preprint</article-version>
<article-version article-version-type="preprint-version">1.1</article-version>
</article-version-alternatives>
<article-categories>
<subj-group subj-group-type="heading">
<subject>Genetics and Genomics</subject>
</subj-group>
<subj-group subj-group-type="heading">
<subject>Evolutionary Biology</subject>
</subj-group>
</article-categories>
<title-group>
<article-title>Hybridization breaks species barriers in long-term coevolution of a cyanobacterial population</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-3561-024X</contrib-id>
<name>
<surname>Birzu</surname>
<given-names>Gabriel</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Muralidharan</surname>
<given-names>Harihara Subrahmaniam</given-names>
</name>
<xref ref-type="aff" rid="a2">2</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Goudeau</surname>
<given-names>Danielle</given-names>
</name>
<xref ref-type="aff" rid="a3">3</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Malmstrom</surname>
<given-names>Rex R.</given-names>
</name>
<xref ref-type="aff" rid="a3">3</xref>
</contrib>
<contrib contrib-type="author" corresp="yes">
<name>
<surname>Fisher</surname>
<given-names>Daniel S.</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="corresp" rid="cor1">∗</xref>
<xref ref-type="author-notes" rid="n1">†</xref>
</contrib>
<contrib contrib-type="author" corresp="yes">
<name>
<surname>Bhaya</surname>
<given-names>Devaki</given-names>
</name>
<xref ref-type="aff" rid="a4">4</xref>
<xref ref-type="corresp" rid="cor1">∗</xref>
<xref ref-type="author-notes" rid="n1">†</xref>
</contrib>
<aff id="a1"><label>1</label><institution>Department of Applied Physics, Stanford University</institution>, Stanford, CA 94305, <country>USA</country></aff>
<aff id="a2"><label>2</label><institution>Department of Computer Science, University of Maryland, College Park</institution>, MD 20742, <country>USA</country></aff>
<aff id="a3"><label>3</label><institution>DOE Joint Genome Institute, Lawrence Berkeley National Laboratory</institution>, Berkeley, CA 94720, <country>USA</country></aff>
<aff id="a4"><label>4</label><institution>Department of Plant Biology, Carnegie Institution for Science</institution>, Stanford, CA 94305, <country>USA</country></aff>
</contrib-group>
<contrib-group content-type="section">
<contrib contrib-type="editor">
<name>
<surname>Coop</surname>
<given-names>Graham</given-names>
</name>
<role>Reviewing Editor</role>
<aff>
<institution-wrap>
<institution>University of California, Davis</institution>
</institution-wrap>
<city>Davis</city>
<country>United States of America</country>
</aff>
</contrib>
<contrib contrib-type="senior_editor">
<name>
<surname>Weigel</surname>
<given-names>Detlef</given-names>
</name>
<role>Senior Editor</role>
<aff>
<institution-wrap>
<institution>Max Planck Institute for Biology Tübingen</institution>
</institution-wrap>
<city>Tübingen</city>
<country>Germany</country>
</aff>
</contrib>
</contrib-group>
<author-notes>
<corresp id="cor1"><label>∗</label>Corresponding authors. E-mail: <email>dsfisher@stanford.edu</email> (D.S.F.); <email>dbhaya@carnegiescience.edu</email> (D.B.).</corresp>
<fn fn-type="equal" id="n1"><label>†</label><p>These authors contributed equally to this work.</p></fn>
</author-notes>
<pub-date date-type="original-publication" iso-8601-date="2023-11-07">
<day>07</day>
<month>11</month>
<year>2023</year>
</pub-date>
<volume>12</volume>
<elocation-id>RP90849</elocation-id>
<history>
<date date-type="sent-for-review" iso-8601-date="2023-08-11">
<day>11</day>
<month>08</month>
<year>2023</year>
</date>
</history>
<pub-history>
<event>
<event-desc>Preprint posted</event-desc>
<date date-type="preprint" iso-8601-date="2023-06-07">
<day>07</day>
<month>06</month>
<year>2023</year>
</date>
<self-uri content-type="preprint" xlink:href="https://doi.org/10.1101/2023.06.06.543983"/>
</event>
</pub-history>
<permissions>
<copyright-statement>© 2023, Birzu et al</copyright-statement>
<copyright-year>2023</copyright-year>
<copyright-holder>Birzu et al</copyright-holder>
<ali:free_to_read/>
<license xlink:href="https://creativecommons.org/licenses/by/4.0/">
<ali:license_ref>https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
<license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p>
</license>
</permissions>
<self-uri content-type="pdf" xlink:href="elife-preprint-90849-v1.pdf"/>
<abstract>
<title>Abstract</title>
<p>Bacterial species often undergo rampant recombination yet maintain cohesive genomic identity. Ecological differences can generate recombination barriers between species and sustain genomic clusters in the short term. But can these forces prevent genomic mixing during long-term coevolution? Cyanobacteria in Yellowstone hot springs comprise several diverse species that have coevolved for hundreds of thousands of years, providing a rare natural experiment. By analyzing more than 300 single-cell genomes, we show that despite each species forming a distinct genomic cluster, much of the diversity within species is the result of hybridization driven by selection, which has mixed their ancestral genotypes. This widespread mixing is contrary to the prevailing view that ecological barriers can maintain cohesive bacterial species and highlights the importance of hybridization as a source of genomic diversity.</p>
</abstract>

</article-meta>
<notes>
<notes notes-type="competing-interest-statement">
<title>Competing Interest Statement</title><p>The authors have declared no competing interest.</p></notes>
<fn-group content-type="external-links">
<fn fn-type="dataset"><p>
<ext-link ext-link-type="uri" xlink:href="https://github.com/gbirzu/yellowstone_cyanobacteria_hybridization.git">https://github.com/gbirzu/yellowstone_cyanobacteria_hybridization.git</ext-link>
</p></fn>
</fn-group>
</notes>
</front>
<body>
<p>The origin, persistence, and extinction of species in obligate sexual populations is a fundamental problem in evolutionary theory (<italic><xref ref-type="bibr" rid="c1">1</xref></italic>). But in bacteria, long thought to be primarily asexual, our understanding is still very limited (<italic><xref ref-type="bibr" rid="c2">2</xref>, <xref ref-type="bibr" rid="c3">3</xref></italic>). While it has long been known that bacteria can acquire non-essential genes from distantly-related strains (<italic><xref ref-type="bibr" rid="c4">4</xref></italic>), in recent years, studies across a wide range of bacteria have found that homologous recombination of core genes is also ubiquitous (<italic><xref ref-type="bibr" rid="c5">5</xref>–<xref ref-type="bibr" rid="c9">9</xref></italic>). How does the interplay between selection acting both asexually and on transferred elements, and barriers to recombination from geographical separation, mechanistic effects, and epistatic interactions lead to formation and maintenance of cohesive species?</p>
<p>One explanation is that ecological specialization provides barriers to recombination (<italic><xref ref-type="bibr" rid="c10">10</xref></italic>, <italic><xref ref-type="bibr" rid="c11">11</xref></italic>). This view is supported by evidence that selective sweeps of individual genes through parts of a population can lead to distinct ecological subtypes, or ecotypes, even in highly recombining bacterial populations (<italic><xref ref-type="bibr" rid="c12">12</xref></italic>–<italic><xref ref-type="bibr" rid="c14">14</xref></italic>). But it also raises an important open question: if species coexist and recombine with each other, do genetic differences continue to increase over evolutionary time or does recombination gradually break down barriers between species?</p>
<p>Answering this question is challenging because data on the underlying evolutionary dynamics is lacking. The time scales of direct observations and laboratory experiments are too short, while those corresponding to phylogenetic relationships between extant species are too long. And since spatial dynamics over these intermediate time scales are unknown in most bacteria (<italic><xref ref-type="bibr" rid="c8">8</xref></italic>, <italic><xref ref-type="bibr" rid="c15">15</xref></italic>) it is difficult to control for changes in local community structure during evolution. Therefore, microbial communities that coevolved for long time periods can act as natural experiments for studying bacterial speciation. The cyanobacterial populations found in hot springs from Yellowstone National Park form a natural incubator in which one such natural experiment is ongoing. These communities have two key features that allow us to identify and quantify the effects of coevolution on intermediate time scales.</p>
<p>First, like other thermophilic communities, these populations are geographically islolated (<italic><xref ref-type="bibr" rid="c16">16</xref></italic>, <italic><xref ref-type="bibr" rid="c17">17</xref></italic>). To date, the two most abundant species, <italic>Synechococcus</italic> A and B, have not been found outside of North America, suggesting that their global mixing time is much longer than for most other bacteria (<italic><xref ref-type="bibr" rid="c16">16</xref></italic>). Comparison of two isolate genomes from these species, OS-A and OS-B’, suggest a divergence time considerably longer than the formation of the Yellowstone caldera around 640, 000 years ago (<italic><xref ref-type="bibr" rid="c18">18</xref></italic>). This would imply their ancestors colonized the caldera independently.</p>
<p>Second, these populations have considerable sub-species diversity, suggesting ongoing evolutionary processes generate and maintain it. Analysis of variants of 16S rRNA and marker genes was initially interpreted as evidence of asexual ecotypes occupying distinct niches (<italic><xref ref-type="bibr" rid="c19">19</xref></italic>), <italic><xref ref-type="bibr" rid="c20">20</xref></italic>). However, deep amplicon data from a diverse, but largely OS-B’-like sample revealed extensive recombination (<italic><xref ref-type="bibr" rid="c7">7</xref></italic>). Genetic exchange with other genomic clusters—which we refer to as hybridization—was also evident, particularly with relatives of OS-A. To date, evidence of hybridization in bacteria has mainly been from comparisons between reference genomes from large genomic databases (<italic><xref ref-type="bibr" rid="c21">21</xref></italic>, <italic><xref ref-type="bibr" rid="c22">22</xref></italic>), with only a handful of studies investigating hybridization in natural environments (<italic><xref ref-type="bibr" rid="c23">23</xref>–<xref ref-type="bibr" rid="c25">25</xref></italic>). The primary focus of the current paper is to determine the impact of hybridization on the long-term coevolution of a natural microbial community.</p>
<p>Characterizing hybridization requires long-distance linkage between variants that cannot be obtained from traditional metagenomics. Strain isolates are often not representative of the population diversity (<italic><xref ref-type="bibr" rid="c26">26</xref></italic>, <italic><xref ref-type="bibr" rid="c27">27</xref></italic>), while metagenome assembly destroys linkage. Recruiting metagenomic reads to reference genomes can in some cases be used to infer linkage (<italic><xref ref-type="bibr" rid="c8">8</xref></italic>), but the high diversity of <italic>Synechococcus</italic> prevents us from using such approaches. To circumvent these problems, we used single-cell genomics (<italic><xref ref-type="bibr" rid="c27">27</xref>, <xref ref-type="bibr" rid="c28">28</xref></italic>) to obtain over 300 genomes from the Mushroom and Octopus Springs, which contain two of the most well-studied communities from the Yellowstone caldera (<italic><xref ref-type="bibr" rid="c29">29</xref></italic>)). This is to our knowledge the first large sample of genomes from hot spring cyanobacterial populations with minimal compositional bias.</p>
<p>Previous analysis of 16S amplicons identified two main clusters similar to OS-A and OS-B’, but also several others at frequencies below 1% (<italic><xref ref-type="bibr" rid="c18">18</xref></italic>). But whether clusters within 16S amplicons correspond to clusters at the whole genome level in such a rapidly recombining population is not clear (<italic><xref ref-type="bibr" rid="c7">7</xref></italic>, <italic><xref ref-type="bibr" rid="c30">30</xref></italic>). Therefore, we first compared each single-amplified genome (SAG) to <italic>Synechococcus</italic> OS-A and OS-B’. Almost all SAGs (330 out of 331) comprised two clusters with an average nucleotide divergence of 2% from one of the reference genomes and 15% from the other. We labeled the cluster closer to OS-A by <italic>α</italic> (128 SAGs) and the other by <italic>β</italic> (202 SAGs), to distinguish them from the reference genomes. Surprisingly, one SAG (approximately 70% complete) was 15% diverged from both OS-A and OS-B’ and formed a separate cluster which we labeled <italic>γ</italic> (<xref ref-type="fig" rid="fig1">fig. 1A</xref>). Clustering methods based on different metrics gave identical results (<xref ref-type="fig" rid="figs2">figs. S2</xref>-<xref ref-type="fig" rid="figs4">4</xref>).</p>
<fig id="fig1" position="float" orientation="portrait" fig-type="figure">
<label>Figure 1:</label>
<caption><title>Synechococcus population comprises three genomic clusters.</title>
<p>(<bold>A</bold>) The mean divergence across homologous genes from the two reference genomes is shown for every SAG in the data. Each dot represents a single SAG and is colored according to its assigned species. (<bold>B</bold>) The relative abundances of all three species across samples from different temperatures within Mushroom Spring. Abundances were estimated based on read recruitment from the metagenome to core genes from the <italic>γ</italic> SAG, as well as representative SAGs from the <italic>α</italic> and <italic>β</italic> populations. Dashed lines show the minimum detection frequencies from the SAG (black) and metagenome (gray) data, respectively (see SM, Sec. III). Shaded gray region shows temperature range of the 8 SAG samples.</p></caption>
<graphic xlink:href="543983v1_fig1.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>We used single-cell genomes as references and recruited reads from a large collection of metagenome samples to determine the abundance of <italic>γ</italic> across different environments (see SM, Sec. III). The abundance of <italic>γ</italic> was highly correlated with <italic>α</italic> (<xref ref-type="fig" rid="figs7">figs. S7</xref> and <xref ref-type="fig" rid="figs8">S8</xref>) and increased rapidly with temperature in the Mushroom Spring samples (<xref ref-type="fig" rid="fig1">fig. 1B</xref>). One interpretation of this pattern is that <italic>α</italic>, <italic>β</italic>, and <italic>γ</italic> represent distinct species adapted to different temperatures. Alternatively, high rates of recombination could generate different genotypes within each genome cluster that are adapted to different temperatures, with the relative frequencies of each cluster being only a correlate and not a causal driver of temperature adaptation. We therefore decided to quantify the frequencies of recombination between and within species and investigate its role in maintaining genetic diversity within the population.</p>
<p>We measured the decrease in linkage disequilibrium along the genome in <italic>α</italic> and <italic>β</italic> (SM, Sec. IV). Within <italic>β</italic>, the linkage disequilibrium <italic>σ</italic><sub><italic>d</italic></sub><sup>2</sup> decreased by around a factor of 10 over distances of 1 kbp (<xref ref-type="fig" rid="figs12">fig. S12</xref>). This agreed quantitatively with earlier results based on deep amplicon sequencing from ref. (<italic><xref ref-type="bibr" rid="c7">7</xref></italic>), which showed a decrease by a factor of <italic>∼</italic> 7 over distances of up to 300 bp. Over genome-wide length scales, linkage was small (<italic>σ</italic><sub><italic>d</italic></sub><sup>2</sup> = 0.06) and close to a fully-unlinked control (<italic>σ</italic><sub><italic>d</italic></sub><sup>2</sup> = 0.04). We found similar results for <italic>α</italic>, but with a quantitatively slower decrease in linkage by a factor of 8 over 1 kbp. Again genome-wide linkage values were close to the fully-unlinked control (<italic>σ</italic><sub><italic>d</italic></sub><sup>2</sup> = 0.14 for the data vs <italic>σ</italic><sub><italic>d</italic></sub><sup>2</sup> = 0.12 for the control). However, we noticed that around 40% of genes had diversities similar to <italic>β</italic> or higher, while the remaining 60% had little to no diversity (<xref ref-type="fig" rid="figs23">figs. S23</xref>-<xref ref-type="fig" rid="figs25">25</xref>). Surprisingly, we did not find evidence of substantial differences in recombination rates between the two sets of genes (<xref ref-type="fig" rid="figs15">fig. S15</xref>). However, the large heterogeneity in diversity led us to hypothesize that hybridization might play an important role in the evolution of the community.</p>
<p>We first focused our analysis on single genes and began by constructing a set of orthologous gene groups using a standard clustering based on sequence similarity (SM, Secs. II, VI). To distinguish between hybridization and horizontal gene transfer of accessory genes, which has been documented in Synechococcus and in many other bacteria (<italic><xref ref-type="bibr" rid="c21">21</xref></italic>, <italic>31</italic>–<italic>33</italic>), we focused only on core genes that appeared to be present in all genomes, by removing those groups which had a copy number per genome that were not close to one. For each core gene, we identified distinct clusters that could be reliably separated from each other and tentatively assigned them to each of the three species. We could identify such clusters in 70% of genes, including around 80 genes with more than three clusters (SM, Sec. V; <xref ref-type="fig" rid="figs17">fig. S17</xref>).</p>
<p>We searched for transfers of whole genes across species among the 70% of genes that could be split into distinct clusters. We found several dozen (100 in <italic>α</italic> and 84 in <italic>β</italic>) <italic>simple hybrid loci</italic>, in which some but not all of the cells had undergone hybridization (<xref ref-type="fig" rid="fig2">fig. 2AB</xref>). However, we excluded many other candidate hybridization events based on very conservative technical criteria so the rate of hybridization in the population is likely considerably higher (SM, Sec. V). In both species, simple hybrids were scattered along the genome and contained alleles from different donor species, implying multiple hybridization events occurred independently, as expected when recombined segments are much shorter than the genome. Around 40% of <italic>α</italic> hybrid alleles were present in multiple cells, while in <italic>β</italic> the fraction was lower, at around 20%. The high frequencies of some hybrid alleles—up to 20%—suggest they were the result of partial sweeps. Focusing on transfers between <italic>α</italic> and <italic>β</italic>, we found that a majority of non-singleton hybrid alleles were as diverse as those in the donor population (<xref ref-type="fig" rid="figs18">fig. S18</xref>). This implies multiple independent hybridization events took place at these loci and suggests these hybrids could have risen to high frequencies through soft sweeps (<italic><xref ref-type="bibr" rid="c34">34</xref></italic>). Surprisingly, we also found that more than half of hybrid alleles were from donors not present in the population, suggesting hybridization with other species not present in our samples. However, a systematic search over a much wider range of metagenomic samples did not find evidence of other <italic>Synechococcus</italic> species, implying that the donors have since gone extinct (SM, Sec. III; figs. S9-11). These results suggested the current population is descended from multiple cyanobacterial species that hybridized with each other. For further evidence supporting this hypothesis, we examined the 30% of core genes with a single mixed-species sequence cluster.</p>
<p>Closer inspection of almost 500 mixed-species sequence clusters revealed the majority were the result of extensive hybridization, with some others due to poor alignments caused by large numbers of indels (<xref ref-type="fig" rid="figs1">fig. S1</xref>). We therefore refer to these as <italic>mosaic hybrid loci</italic>. The mosaic loci were present throughout the genomes of both species, which suggests they were not the result of a small number of recent events but were instead the result of ongoing genetic exchange within the population (<xref ref-type="fig" rid="fig2">fig. 2AB</xref>). Within <italic>α</italic>, most of these loci were part of the 40% of high-diversity genes we found previously, confirming that the diversity at those loci was the result of hybridization. By contrast, the diversity of mosaic loci was typical of other loci within <italic>β</italic>, suggesting most of the <italic>β</italic> genome has undergone hybridization.</p>
<p>Is the genomic mixing between species the result of neutral processes or could positive selection for beneficial hybrids plan an important role? Distinguishing between these alternatives is difficult in general, so we instead focused on cases where beneficial hybrid genes swept through the entire host species, i.e., a population-wide sweep. Such full gene sweeps would greatly reduce the synonymous divergence between <italic>α</italic> and <italic>β</italic>, making them much easier to detect.</p>
<p>A systematic search revealed 100 very low divergence loci, spread across more than half a dozen <italic>diversity troughs</italic> (<xref rid="fig2" ref-type="fig">fig. 2C</xref>). Comparing alignments of typical genes and diversity trough genes revealed a dramatic difference in fixed substitutions between species, which can only be explained by a recent selective sweep. The largest diversity trough contained 28 genes (around 25% of diversity trough genes), most of which were part of a nitrogen-fixation pathway. The presence of the entire pathway among the diversity troughs strongly suggests at least one of the ancestors acquired the ability to fix nitrogen after it colonized the Yellowstone caldera and that this gave it a substantial selective advantage. The genetic diversity within the pathway genes gave further clues about the hybridization process. The diversity within the trough was similar for both species (<italic>π<sub>S</sub></italic> = 0.033 in <italic>α</italic> and <italic>π<sub>S</sub></italic> = 0.039 in <italic>β</italic>) and was close to the average diversity within <italic>β</italic> (<italic>π<sub>S</sub></italic> = 0.042), but more than an order of magnitude larger than the diversity within <italic>α</italic> at non-hybrid loci (<italic>π<sub>S</sub></italic>= 0.002; see SM, Sec. VII and <xref ref-type="fig" rid="figs19">fig. S19</xref>). This large discrepancy strongly suggests <italic>α</italic> acquired the pathway from <italic>β</italic> through multiple independent transfers, after they colonized the Yellowstone caldera.</p>
<fig id="fig2" position="float" orientation="portrait" fig-type="figure">
<label>Figure 2:</label>
<caption><title>Transfers of whole-gene alleles between species is common.</title>
<p>The frequency of hybrid gene alleles along the <italic>α</italic> (<bold>A</bold>) and <italic>β</italic> (<bold>B</bold>) genomes. Different colors show the donor species, with unknown species labeled <italic>X</italic> and shown in magenta. The orange lines on top show mosaic loci without distinct gene clusters. (<bold>C</bold>) The mean synonymous divergence between <italic>α</italic> and <italic>β</italic> at homologous loci, ordered according to OS-B’. Smoothed line over a sliding window of five genes with a step size of two genes is shown in black. Maximum and minimum divergences at each locus are shown in red and blue, respectively. (Insets, middle) A zoomed-in region from a typical genomic region (left) and a diversity trough (right), with dots representing individual genes. (Insets, bottom) Alignment segments of individual genes, subsampled to 40 sequences for clarity. The first sequence is arbitrarily chosen as the reference with each nucleotide represented by a different color. Other sites are colored gray if same as reference or using nucleotide colors if mutated. Left colored bars show the species of each genome.</p></caption>
<graphic xlink:href="543983v1_fig2.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>Selective sweeps of individual genes could also lead to mixing of other genomic segments from the donor species into the host population through genetic hitchhiking. If the diversity within the two hybridizing species is low, this process would result in blocks of tightly linked SNPs consisting of primarily two haplotypes, one from the host and another from the donor (<xref rid="fig3" ref-type="fig">fig. 3A</xref>). We developed a systematic method to search for SNP blocks based on clustering the SNP linkage matrix (see SM, Sec. VI). Despite using conservative thresholds, we found over one thousand of short SNP blocks in each species, scattered across hundreds of genes, including in highly-conserved ribosomal genes and genes in which distinct species clusters could be assigned (<xref ref-type="fig" rid="fig3">figs. 3BC</xref>, <xref ref-type="fig" rid="figs20">S20</xref>, <xref ref-type="fig" rid="figs21">S21</xref>). The divergences between SNP block haplotypes was similar to that between species, consistent with hybridization (<xref ref-type="fig" rid="figs22">figs. S22</xref>). To confirm their hybrid origin, we mapped the haplotypes from each block to the two other species in our sample. We found 75% (665 out of 877) of SNP blocks within <italic>α</italic> and 25% of those within <italic>β</italic> (256 out of 1046) contained a hybrid haplotype that was identical to the consensus sequence of one of the other species (<xref rid="fig3" ref-type="fig">fig. 3B</xref>). In addition, we found a comparable number of blocks that were statistically similar but did not match the other species (<xref ref-type="fig" rid="fig3">fig. 3BC</xref>). The most likely explanation is that these blocks resulted from hybridization with other cyanobacterial species, similar to the whole-gene hybrids found previously (<xref rid="fig2" ref-type="fig">fig. 2</xref>). Consistent with this explanation, we found that the relative contributions from different donors to hybrid alleles and to hybrid blocks were similar in each species (<xref ref-type="table" rid="tbls1">Table S1</xref>).</p>

<fig id="fig3" position="float" orientation="portrait" fig-type="figure">
<label>Figure 3:</label>
<caption><title>Hybridization between species leads to mixing of short DNA segments within single genes.</title>
<p>(<bold>A</bold>, top) Alignment segment of <italic>α</italic> cells from a representative locus with four SNP blocks. The inferred ancestral <italic>α</italic> haplotype is highlighted in orange and the hybrid haplotype (all <italic>β</italic> here) is shown in blue. (Middle) Illustration of SNP block analysis pipeline. (Right) The consensus alignment of the two <italic>α</italic> haplotypes, <italic>β</italic>, and <italic>γ</italic> is constructed. (Left) Pairwise divergences between consensus sequences are calculated. Note that <italic>α</italic><sub>2</sub> is identical to <italic>γ</italic> here. (<bold>B</bold>) The joint distribution of divergences of <italic>α</italic> SNP block haplotypes from the other species for all SNP blocks. Each point represents a haplotype with coordinates showing the divergence from <italic>β</italic> (x-axis) and <italic>γ</italic> (y-axis). The orange and blue dots show the two haplotypes from the example in (A). Marginal distributions are shown on the top and right. Note the high density of haplotypes near the axes, indicating transfer from one of the other known species. (<bold>C</bold>) Same as panel (B) for <italic>β</italic> block haplotypes. Note the much larger number of haplotypes far from the axes compared to (B), indicating transfers of unknown origin. (<bold>D</bold>) Histogram of linkage coefficients between pairs of block haplotypes at different loci for <italic>α</italic> (orange histogram) and <italic>β</italic> (blue histogram) compared to the expectation under a fully unlinked model (solid orange and blue lines, respectively).</p></caption>
<graphic xlink:href="543983v1_fig3.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>Do genome-scale epistatic interactions, possibly associated with ecological distinctions, lead to a small number of substrains with distinct combinations of block haplotypes or are haplotypes mixed by recombination? To answer this question we calculated the linkage coefficients between haplotypes for each pair of blocks and compared their distribution to a fully unlinked control (see SM, Sec. VI for details). Within the <italic>β</italic> species the two distributions were almost identical, implying that the genomes are consistent with a random mixture of block haplotypes, as was previously proposed (<italic><xref ref-type="bibr" rid="c7">7</xref></italic>). For <italic>α</italic> the linkage coefficients were statistically larger than those predicted from the unlinked control (<xref rid="fig3" ref-type="fig">fig. 3C</xref>), but the overall value was still low (<italic>r<sub>ij</sub></italic><sup>2</sup> 0.10 for data compared to <italic>r<sub>ij</sub></italic><sup>2</sup> 0.04 for the unlinked model). These results are consistent with the slower rate of linkage decrease within <italic>α</italic> compared to <italic>β</italic> discussed previously. We also found similar results for the linkage between hybrid gene alleles (SM, Sec. V). Thus, rather than finding clonal subpopulations, every one of the 300 cells in our sample has a unique combination of SNP block haplotypes.</p>
<p>By analyzing over 300 <italic>Synechococcus</italic> single-cell genomes, we show that hybridization plays a major role in shaping their genomic diversity. Our results suggest a simple scenario for the evolutionary history of the population (<xref rid="fig4" ref-type="fig">fig. 4</xref>; see also SM, Sec. VII). Multiple strains were geographically separated and evolved independently into distinct species from an ancestral population. They then colonized the Yellowstone caldera after its formation around 640, 000 years ago and have since been gradually hybridizing. The presence of genes with multiple sequence clusters suggests at least six independent colonizers, but the current population is dominated by the descendants of only three—the ancestors of <italic>α</italic>, <italic>β</italic>, and <italic>γ</italic>. The <italic>β</italic> population has been hybridizing with others and recombining with itself long enough that its genomes are a mosaic of different ancestral segments, consistent with a quasisexual population. But <italic>α</italic> still exhibits a large fraction of low-diversity genomic segments, interlaced with clearly hybridized segments. Molecular clock estimates using the low diversity regions of the <italic>α</italic> genomes suggest it emerged around 10<sup>4</sup><italic><sup>−</sup></italic><sup>5</sup> years ago and on these time scales the population is well-mixed across springs (SM, Sec. VII; <xref ref-type="fig" rid="figs26">fig. S26</xref>). Using the hybridized genomic segments of <italic>α</italic> as a control, we also estimated the contribution of de-novo mutations to the <italic>β</italic> diversity. This analysis suggests that the ancestor of <italic>β</italic> colonized the Yellowstone caldera soon after its formation (SM, Sec. VII).</p>
<fig id="fig4" position="float" orientation="portrait" fig-type="figure">
<label>Figure 4:</label>
<caption><title>Hybridization between previously isolated lineages is main source of diversity within the population.</title>
<p>(Main panel) An illustration of the evolutionary scenario consistent with the main results of this paper. A single common ancestor (gray) for the population (<italic>t</italic><sub>0</sub>) diverged into several species (four shown here) following spatial isolation (<italic>t</italic><sub>1</sub>). The species colonized the Yellowstone caldera, represented by the yellow rectangle, at different times (<italic>t</italic><sub>2</sub>–<italic>t</italic><sub>3</sub>) and began hybridizing. This process continued up to the present (<italic>t</italic><sub>4</sub>). (Top inset) Illustration of the mechanism for generating unlinked SNP blocks through recombination between a hybrid segment (blue) containing a beneficial region (red star) and the rest of the host species (orange). Note the four distinct haplotypes highlighted at the end. (Bottom inset) Zoom in of the ancestry of a particular genome (middle) compared with the donor (orange, top) and host (green, bottom) ancestral genomes. After the initial hybridization, recombination with other host genomes (red arrows) creates a mosaic structure across a range of genomic length scales.</p></caption>
<graphic xlink:href="543983v1_fig4.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>Diversity within species is often modeled using neutral processes (<italic><xref ref-type="bibr" rid="c3">3</xref>, <xref ref-type="bibr" rid="c35">35</xref>, <xref ref-type="bibr" rid="c36">36</xref></italic>). But in this <italic>Synechococcus</italic> population, there is overwhelming evidence for the crucial role played by selection. The diversity troughs resulted from selective sweeps through the whole population that likely overcame mechanistic barriers to recombination, genetic incompatibilities, and ecological differences, evident in the apparent preferences to different temperatures of the three species. Moreover, the thousands of blocks composed of tightly linked SNPs we observe are difficult to explain through neutral drift, due to the long time it would take for them to reach observable frequencies. Instead, genetic hitchhiking during selective sweeps is by far the most likely explanation.</p>
<p>Selective sweeps of single genes through subpopulations have been argued to lead to the formation of separate ecotypes, recombination barriers, and eventual speciation (<italic><xref ref-type="bibr" rid="c12">12</xref></italic>, <italic><xref ref-type="bibr" rid="c13">13</xref></italic>). But we find multiple cases of genes from one species partially sweeping through another, sometimes via several independent transfer events. Thus gene sweeps do not necessarily lead to ecological specialization, but can do the opposite, acting to homogenize the population. Overall, the population shows abundant evidence of hybridization on a wide range of genomic scales leading to both homogenization between species—through the erosion of genomic clusters—and diversification within species. How extensive hybridization affects, and is affected by, ecology and how the interplay between selection at both gene and genome scales shapes the diversity of long-term coexisting populations are intriguing questions for future work.</p>
<p>The importance of hybridization in eukaryotic evolution is increasingly being recognized but there have been few investigations in prokaryotes (<italic><xref ref-type="bibr" rid="c37">37</xref>, <xref ref-type="bibr" rid="c38">38</xref></italic>). Metagenomic studies on communities in acid mine drainages revealed several hybrid bacterial and archaeal populations whose genomes were mosaics of hundreds of kbp segments from two different ancestors (<italic><xref ref-type="bibr" rid="c23">23</xref>, <xref ref-type="bibr" rid="c24">24</xref></italic>). Those results are consistent with very recent hybridization, after the start of mining operations (<italic><xref ref-type="bibr" rid="c39">39</xref></italic>)). Our study shows the effects of this process over much longer time scales. At the level of individual genes, evidence for hybridization has been observed among commensal and pathogenic species of <italic>Campylobacter</italic> (<italic><xref ref-type="bibr" rid="c25">25</xref></italic>, <italic><xref ref-type="bibr" rid="c40">40</xref></italic>). But unlike the thermophilic <italic>Synechococcus</italic>, such host-associated bacteria are globally dispersed and have likely sampled many different environments, on a wide range of time scales, during their evolutionary history. It is thus difficult to identify which evolutionary forces drive their hybridization.</p>
<p>For the Yellowstone <italic>Synechococcus</italic>, a fortuitous combination of spatial separation and later mixing on the same time scales on which speciation and then hybridization can extensively shape—but not completely overwrite—their diversity, has enabled us to infer a great deal about the evolutionary history and the effects of full and partial sweeps. This provides a window into processes that shape species-level bacterial diversity. But for most bacterial populations, the effects of these processes are obscured by the broad range—and little knowledge—of the time scales on which different strains have co-occurred and are able to exchange DNA. Investigating whether hybridization plays a major role in these communities will thus require developing a predictive theory that can distinguish between possible evolutionary scenarios.</p>
</body>
<back>
<ack>
<title>Acknowledgments</title>
<p>We thank Benjamin H. Good, Alana Papula, and Freddy Bunbury for helpful comments and discussions.</p>
</ack>
<sec id="s100">
<title>Funding</title>
<p>G.B. and D.S.F. gratefully acknowledge support from the Simons Foundation via a Postdoctoral Fellowship Award 730295 to G.B. and Sabbatical Fellowship to D.S.F. This work was also supported by NSF Grants PHY-1607606 and PHY-2210386 to D.S.F. H.S.M. was supported by the National Institutes of Health grant R01-AI-100947 to Mihai Pop. D.B. acknowledges support from the NSF/BIO-BBSRC collaborative research grant 1921429, NSF MIM grant 2125965, Joint Genome Institute Community Sequencing Project 503441 and 509352, and the Carnegie Institution for Science. Samples processed for single cell genome amplification were collected using NP Park Permits: YELL-5494 to David Ward (multi year), YELL-5660 to D.B. (2007–2008), and YELL 5694 to D.B. (2007–2009). The work (proposal: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.46936/10.25585/60001132">https://doi.org/10.46936/10.25585/60001132</ext-link>) conducted by the U.S. Department of Energy Joint Genome Institute (<ext-link ext-link-type="uri" xlink:href="https://ror.org/04xmId337">https://ror.org/04xmId337</ext-link>), a DOE Office of Science User Facility, is supported by the Office of Science of the U.S. Department of Energy operated under Contract No. DE-AC02-05CH11231.</p>
</sec>
<sec id="s101">
<title>Authors contributions</title>
<p>G.B. designed and performed the data analysis, contributed to the design the project, and wrote the paper. H.S.M. analyzed the metagenome data. R.R.M. performed the single-cell sorting, sequencing, and assembly. D.G. performed the single-cell sorting, sequencing, and assembly. D.S.F. designed and supervised the data analysis, supervised and contributed to the design of the project, and wrote the paper. D.B. supervised and contributed to the design of the project and wrote the paper.</p>
</sec>
<sec id="s102">
<title>Competing interests</title>
<p>The authors declare no competing interests.</p>
</sec>
<sec id="s103">
<title>Data and materials availability</title>
<p>All SAG assemblies and metagenome samples used in this study can be found on the JGI website (<ext-link ext-link-type="uri" xlink:href="https://genome.jgi.doe.gov/portal/">https://genome.jgi.doe.gov/portal/</ext-link>) under the project ID 503441. The analyzed data and code used to produce the results are available on GitHub (https://github.com/gbirzu/yellowstone cyanobacteria hybridization.git).</p>
</sec>
<ref-list>
<title>References</title>
<ref id="c1"><label>1.</label><mixed-citation publication-type="book"><string-name><given-names>J. A.</given-names> <surname>Coyne</surname></string-name>, <string-name><given-names>H. A.</given-names> <surname>Orr</surname></string-name>, <source>Speciation</source> (<publisher-name>Sinauer Associates, Sunderland, Mass</publisher-name>., <year>2004</year>), isbn: 0-87893-091-4 978-0-87893-091-3 0-87893-089-2 978-0-87893-089-0.</mixed-citation></ref>
<ref id="c2"><label>2.</label><mixed-citation publication-type="journal"><string-name><given-names>C.</given-names> <surname>Fraser</surname></string-name>, <string-name><given-names>E. J.</given-names> <surname>Alm</surname></string-name>, <string-name><given-names>M. F.</given-names> <surname>Polz</surname></string-name>, <string-name><given-names>B. G.</given-names> <surname>Spratt</surname></string-name>, <string-name><given-names>W. P.</given-names> <surname>Hanage</surname></string-name>, <source>Science</source> <volume>323</volume>, <issue>741</issue> (Feb. <year>2009</year>).</mixed-citation></ref>
<ref id="c3"><label>3.</label><mixed-citation publication-type="journal"><string-name><given-names>E. P. C.</given-names> <surname>Rocha</surname></string-name>, <source>Molecular Biology and Evolution</source> <volume>35</volume>, <fpage>1338</fpage>–<lpage>1347</lpage>, issn: 0737-4038 (June <year>2018</year>).</mixed-citation></ref>
<ref id="c4"><label>4.</label><mixed-citation publication-type="journal"><string-name><given-names>M. C.</given-names> <surname>Rivera</surname></string-name>, <string-name><given-names>R.</given-names> <surname>Jain</surname></string-name>, <string-name><given-names>J. E.</given-names> <surname>Moore</surname></string-name>, <string-name><given-names>J. A.</given-names> <surname>Lake</surname></string-name>, <source>Proceedings of the National Academy of Sciences</source> <volume>95</volume>, <fpage>6239</fpage>–<lpage>6244</lpage> (May <year>1998</year>).</mixed-citation></ref>
<ref id="c5"><label>5.</label><mixed-citation publication-type="journal"><string-name><given-names>X.</given-names> <surname>Didelot</surname></string-name>, <string-name><given-names>M. C.</given-names> <surname>Maiden</surname></string-name>, <source>Trends in Microbiology</source> <volume>18</volume>, <fpage>31</fpage>5–322, issn: 0966-842X (July <year>2010</year>).</mixed-citation></ref>
<ref id="c6"><label>6.</label><mixed-citation publication-type="journal"><string-name><given-names>K.</given-names> <surname>Yahara</surname></string-name> <etal>et al.</etal>, <source>Molecular Biology and Evolution</source> <volume>33</volume>, <fpage>456</fpage>–<lpage>471</lpage>, issn: 0737-4038 (Oct. <year>2015</year>).</mixed-citation></ref>
<ref id="c7"><label>7.</label><mixed-citation publication-type="journal"><string-name><given-names>M. J.</given-names> <surname>Rosen</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Davison</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Bhaya</surname></string-name>, <string-name><given-names>D. S.</given-names> <surname>Fisher</surname></string-name>, <source>Science</source> <volume>348</volume>, <fpage>101</fpage>9 (May <year>2015</year>).</mixed-citation></ref>
<ref id="c8"><label>8.</label><mixed-citation publication-type="journal"><string-name><given-names>N. R.</given-names> <surname>Garud</surname></string-name>, <string-name><given-names>B. H.</given-names> <surname>Good</surname></string-name>, <string-name><given-names>O.</given-names> <surname>Hallatschek</surname></string-name>, <string-name><given-names>K. S.</given-names> <surname>Pollard</surname></string-name>, <source>PLOS Biology</source> <volume>17</volume>, <fpage>e30001</fpage>02 (Jan. <year>2019</year>).</mixed-citation></ref>
<ref id="c9"><label>9.</label><mixed-citation publication-type="other"><string-name><given-names>T.</given-names> <surname>Sakoparnig</surname></string-name>, <string-name><given-names>C.</given-names> <surname>Field</surname></string-name>, <string-name><given-names>E.</given-names> <surname>van Nimwegen</surname></string-name>, <source>eLife</source> 10, ed. by <string-name><given-names>A.</given-names> <surname>Nourmohammad</surname></string-name>, <string-name><given-names>A. M.</given-names> <surname>Walczak</surname></string-name>, <fpage>e65366</fpage>, issn: 2050-084X (Jan. <year>2021</year>).</mixed-citation></ref>
<ref id="c10"><label>10.</label><mixed-citation publication-type="journal"><string-name><given-names>N.</given-names> <surname>Kashtan</surname></string-name> <etal>et al.</etal>, <source>Science</source> <volume>344</volume>, <fpage>41</fpage>6 (Apr. <year>2014</year>).</mixed-citation></ref>
<ref id="c11"><label>11.</label><mixed-citation publication-type="journal"><string-name><given-names>P.</given-names> <surname>Arevalo</surname></string-name>, <string-name><given-names>D.</given-names> <surname>VanInsberghe</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Elsherbini</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Gore</surname></string-name>, <string-name><given-names>M. F.</given-names> <surname>Polz</surname></string-name>, <source>Cell</source> <volume>178</volume>, <fpage>820</fpage>–<lpage>834</lpage>.e14, issn: 0092-8674 (Aug. <year>2019</year>).</mixed-citation></ref>
<ref id="c12"><label>12.</label><mixed-citation publication-type="journal"><string-name><given-names>N. J.</given-names> <surname>Croucher</surname></string-name> <etal>et al.</etal>, <source>Science</source> <volume>331</volume>, <fpage>430</fpage> (Jan. <year>2011</year>).</mixed-citation></ref>
<ref id="c13"><label>13.</label><mixed-citation publication-type="journal"><string-name><given-names>B. J.</given-names> <surname>Shapiro</surname></string-name> <etal>et al.</etal>, <source>Science</source> <volume>336</volume>, <fpage>48</fpage> (Apr. <year>2012</year>).</mixed-citation></ref>
<ref id="c14"><label>14.</label><mixed-citation publication-type="journal"><string-name><given-names>Y.-J.</given-names> <surname>Bao</surname></string-name>, <string-name><given-names>B. J.</given-names> <surname>Shapiro</surname></string-name>, <string-name><given-names>S. W.</given-names> <surname>Lee</surname></string-name>, <string-name><given-names>V. A.</given-names> <surname>Ploplis</surname></string-name>, <string-name><given-names>F. J.</given-names> <surname>Castellino</surname></string-name>, <source>Scienti.fic Reports</source> <volume>6</volume>, <fpage>36644</fpage>, issn: 2045-2322 (Nov. <year>2016</year>).</mixed-citation></ref>
<ref id="c15"><label>15.</label><mixed-citation publication-type="journal"><string-name><given-names>C. A.</given-names> <surname>Hanson</surname></string-name>, <string-name><given-names>J. A.</given-names> <surname>Fuhrman</surname></string-name>, <string-name><given-names>M. C.</given-names> <surname>Horner-Devine</surname></string-name>, <string-name><given-names>J. B. H.</given-names> <surname>Martiny</surname></string-name>, <source>Nature Reviews Microbiology</source> <volume>10</volume>, <fpage>497</fpage>–<lpage>506</lpage>, issn: 1740-1534 (July <year>2012</year>).</mixed-citation></ref>
<ref id="c16"><label>16.</label><mixed-citation publication-type="journal"><string-name><given-names>R. T.</given-names> <surname>Papke</surname></string-name>, <string-name><given-names>N. B.</given-names> <surname>Ramsing</surname></string-name>, <string-name><given-names>M. M.</given-names> <surname>Bateson</surname></string-name>, <string-name><given-names>D. M.</given-names> <surname>Ward</surname></string-name>, <source>Environmental Microbiology</source> <volume>5</volume>, <fpage>650</fpage>–<lpage>659</lpage>, issn: 1462-2912 (<year>2003</year>).</mixed-citation></ref>
<ref id="c17"><label>17.</label><mixed-citation publication-type="journal"><string-name><given-names>R. J.</given-names> <surname>Whitaker</surname></string-name>, <string-name><given-names>D. W.</given-names> <surname>Grogan</surname></string-name>, <string-name><given-names>J. W.</given-names> <surname>Taylor</surname></string-name>, <source>Science</source> <volume>301</volume>, 976 (Aug. <year>2003</year>).</mixed-citation></ref>
<ref id="c18"><label>18.</label><mixed-citation publication-type="journal"><string-name><given-names>M. J.</given-names> <surname>Rosen</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Davison</surname></string-name>, <string-name><given-names>D. S.</given-names> <surname>Fisher</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Bhaya</surname></string-name>, <source>PLOS ONE</source> <volume>13</volume>, <fpage>e0205396</fpage> (Nov. <year>2018</year>).</mixed-citation></ref>
<ref id="c19"><label>19.</label><mixed-citation publication-type="journal"><string-name><given-names>D. M.</given-names> <surname>Ward</surname></string-name>, <string-name><given-names>M. J.</given-names> <surname>Ferris</surname></string-name>, <string-name><given-names>S. C.</given-names> <surname>Nold</surname></string-name>, <string-name><given-names>M. M.</given-names> <surname>Bateson</surname></string-name>, <source>Microbiology and Molecular Biology Reviews</source> <volume>62</volume>, <fpage>1353</fpage> (Dec. <year>1998</year>).</mixed-citation></ref>
<ref id="c20"><label>20.</label><mixed-citation publication-type="journal"><string-name><given-names>D. M.</given-names> <surname>Ward</surname></string-name> <etal>et al.</etal>, <source>Philosophical Transactions of the Royal Society B: Biological Sciences</source> <volume>361</volume>, <fpage>1997</fpage>– <lpage>2008</lpage> (Nov. <year>2006</year>).</mixed-citation></ref>
<ref id="c21"><label>21.</label><mixed-citation publication-type="journal"><string-name><given-names>C. S.</given-names> <surname>Smillie</surname></string-name> <etal>et al.</etal>, <source>Nature</source> <volume>480</volume>, <fpage>241</fpage>–<lpage>244</lpage>, issn: 1476-4687 (Dec. <year>2011</year>).</mixed-citation></ref>
<ref id="c22"><label>22.</label><mixed-citation publication-type="journal"><string-name><given-names>A.</given-names> <surname>Diop</surname></string-name>, <string-name><given-names>E. L.</given-names> <surname>Torrance</surname></string-name>, <string-name><given-names>C. M.</given-names> <surname>Stott</surname></string-name>, <string-name><given-names>L.-M.</given-names> <surname>Bobay</surname></string-name>, <source>Genome Biology</source> <volume>23</volume>, <fpage>239</fpage>, issn: 1474-760X (Nov. <year>2022</year>).</mixed-citation></ref>
<ref id="c23"><label>23.</label><mixed-citation publication-type="journal"><string-name><given-names>G. W.</given-names> <surname>Tyson</surname></string-name> <etal>et al.</etal>, <source>Nature</source> <volume>428</volume>, <fpage>37</fpage>–<lpage>43</lpage>, issn: 1476-4687 (Mar. <year>2004</year>).</mixed-citation></ref>
<ref id="c24"><label>24.</label><mixed-citation publication-type="journal"><string-name><given-names>I.</given-names> <surname>Lo</surname></string-name> <etal>et al.</etal>, <source>Nature</source> <volume>446</volume>, <fpage>537</fpage>–<lpage>541</lpage>, issn: 1476-4687 (Mar. <year>2007</year>).</mixed-citation></ref>
<ref id="c25"><label>25.</label><mixed-citation publication-type="journal"><string-name><given-names>S. K.</given-names> <surname>Sheppard</surname></string-name>, <string-name><given-names>N. D.</given-names> <surname>McCarthy</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Falush</surname></string-name>, <string-name><given-names>M. C. J.</given-names> <surname>Maiden</surname></string-name>, <source>Science</source> <volume>320</volume>, <fpage>237</fpage> (Apr. <year>2008</year>).</mixed-citation></ref>
<ref id="c26"><label>26.</label><mixed-citation publication-type="journal"><string-name><given-names>H. P.</given-names> <surname>Browne</surname></string-name> <etal>et al.</etal>, <source>Nature</source> <volume>533</volume>, <fpage>543</fpage>–<lpage>546</lpage>, issn: 1476-4687 (May <year>2016</year>).</mixed-citation></ref>
<ref id="c27"><label>27.</label><mixed-citation publication-type="web"><string-name><given-names>W.</given-names> <surname>Zheng</surname></string-name> <etal>et al.</etal>, <source>Science</source> <volume>376</volume>, eabm1483, eprint: <ext-link ext-link-type="uri" xlink:href="https://www.science.org/doi/pdf/10">https://www.science.org/doi/pdf/10</ext-link>. 1126/science.abm1483 (<year>2022</year>).</mixed-citation></ref>
<ref id="c28"><label>28.</label><mixed-citation publication-type="journal"><string-name><given-names>C.</given-names> <surname>Rinke</surname></string-name> <etal>et al.</etal>, <source>Nature</source> <volume>499</volume>, <fpage>431</fpage>–<lpage>437</lpage>, issn: 1476-4687 (July <year>2013</year>).</mixed-citation></ref>
<ref id="c29"><label>29.</label><mixed-citation publication-type="book"><string-name><given-names>D. M.</given-names> <surname>Ward</surname></string-name>, <string-name><given-names>R. W.</given-names> <surname>Castenholz</surname></string-name>, <string-name><given-names>S. R.</given-names> <surname>Miller</surname></string-name>, in <source>Ecology of Cyanobacteria II: Their Diversity in Space and Time</source> (<publisher-name>Springer Dordrecht, First</publisher-name>, <year>2012</year>), pp. <fpage>39</fpage>–<lpage>63</lpage>.</mixed-citation></ref>
<ref id="c30"><label>30.</label><mixed-citation publication-type="journal"><string-name><given-names>S. R.</given-names> <surname>Miller</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Carvey</surname></string-name>, <source>Microbial Ecology</source> <volume>78</volume>, <fpage>33</fpage>–<lpage>41</lpage>, issn: 1432-184X (July <year>2019</year>).</mixed-citation></ref>
<ref id="c31"><label>31.</label><mixed-citation publication-type="journal"><string-name><given-names>D.</given-names> <surname>Bhaya</surname></string-name> <etal>et al.</etal>, <source>The ISME Journal</source> <volume>1</volume>, <fpage>703</fpage>–<lpage>71</lpage>3, issn: 1751-7370 (Dec. <year>2007</year>).</mixed-citation></ref>
<ref id="c32"><label>32.</label><mixed-citation publication-type="journal"><string-name><given-names>M.</given-names> <surname>Groussin</surname></string-name> <etal>et al.</etal>, <source>Cell</source> <volume>184</volume>, <fpage>2053</fpage>–<lpage>2067</lpage>.e18, issn: 0092-8674 (Apr. <year>2021</year>).</mixed-citation></ref>
<ref id="c33"><label>33.</label><mixed-citation publication-type="journal"><string-name><given-names>T.</given-names> <surname>Hackl</surname></string-name> <etal>et al.</etal>, <source>Cell</source> <volume>186</volume>, <fpage>47</fpage>–<lpage>62</lpage>.e16, issn: 0092-8674 (Jan. <year>2023</year>).</mixed-citation></ref>
<ref id="c34"><label>34.</label><mixed-citation publication-type="journal"><string-name><given-names>P. W.</given-names> <surname>Messer</surname></string-name>, <string-name><given-names>D. A.</given-names> <surname>Petrov</surname></string-name>, <source>Trends in Ecology&amp; Evolution</source> <volume>28</volume>, <fpage>659</fpage>–<lpage>669</lpage>, issn: 0169-5347 (Nov. <year>2013</year>).</mixed-citation></ref>
<ref id="c35"><label>35.</label><mixed-citation publication-type="journal"><string-name><given-names>X.</given-names> <surname>Didelot</surname></string-name>, <string-name><given-names>D. J.</given-names> <surname>Wilson</surname></string-name>, <source>PLOS Computational Biology</source> <volume>11</volume>, <fpage>e1004041</fpage> (Feb. <year>2015</year>).</mixed-citation></ref>
<ref id="c36"><label>36.</label><mixed-citation publication-type="journal"><string-name><given-names>Z.</given-names> <surname>Chen</surname></string-name> <etal>et al.</etal>, <source>Nature Ecology &amp; Evolution</source> <volume>6</volume>, <fpage>183</fpage>–<lpage>194</lpage>, issn: 2397-334X (Feb. <year>2022</year>).</mixed-citation></ref>
<ref id="c37"><label>37.</label><mixed-citation publication-type="journal"><string-name><given-names>S.</given-names> <surname>Sankararaman</surname></string-name> <etal>et al.</etal>, <source>Nature</source> <volume>507</volume>, <fpage>354</fpage>–<lpage>357</lpage>, issn: 1476-4687 (Mar. <year>2014</year>).</mixed-citation></ref>
<ref id="c38"><label>38.</label><mixed-citation publication-type="other"><string-name><given-names>B. M.</given-names> <surname>Moran</surname></string-name>, <etal>et al.</etal>, eLife 10, ed. by P. J. Wittkopp, e69016, issn: 2050-084X (Aug. <year>2021</year>).</mixed-citation></ref>
<ref id="c39"><label>39.</label><mixed-citation publication-type="journal"><string-name><given-names>V. J.</given-names> <surname>Denef</surname></string-name>, <string-name><given-names>J. F.</given-names> <surname>Banfield</surname></string-name>, <source>Science</source> <volume>336</volume>, <fpage>462</fpage>–<lpage>466</lpage>, issn: 00368075, 10959203 (<year>2012</year>).</mixed-citation></ref>
<ref id="c40"><label>40.</label><mixed-citation publication-type="other"><string-name><given-names>E.</given-names> <surname>Mourkas</surname></string-name>, <etal>et al.</etal>, eLife 11, ed. by <string-name><given-names>B. S.</given-names> <surname>Cooper</surname></string-name>, <string-name><given-names>G.</given-names> <surname>Storz</surname></string-name>, <fpage>e73552</fpage>, issn: 2050-084X (Feb. <year>2022</year>).</mixed-citation></ref>
</ref-list>
<sec id="s1">
<label>I.</label><title>Materials and methods</title>
<sec id="s1a">
<label>I.1</label>
<title>Sample collection and sequencing</title>
<p>Cork borers (approximate diameter 0.5 to 1 mm) were used to collect mat core samples from Octopus Spring (44.53401N, 110.79781W) and Mushroom Spring (44.53861N, 110.79791W). Samples were collected in 2005, 2006, 2007 and 2009 under YNP Park Permits (YELL-5494, YELL-5660, YELL 5694). Cores were immediately frozen until later use. Frozen samples were shipped to the Joint Genome Institute (JGI) in 2019, where they were processed and sequenced.</p>
<p>At JGI, for disaggregation of sample, frozen mat cores were cut into pieces using a razor blade on glass over dry ice and aliquoted chunks of approximately 5 mm diameter. Next, 500 fLl PBS and 50 fLl of 500 mM NaEDTA were added. Samples were vortexed briefly, sonicated for I minute on benchtop sonicator, vortexed briefly again. Passed 25 times through a 25 gauge needle and run through a 35 fLm strainer cap. Next, 100 fLl were placed in 900 fLl PBS and stain with SYBR Green at IX. Samples were run on the Influx with Gate SYBR+ Cells and Gate 670/30 off of 632 autofluoresence. Next samples were sorted on a BD influx following the protocol outlined in Ref. (<italic><xref ref-type="bibr" rid="sc1">1</xref></italic>), and single-cells genomes were amplified with WGAX protocol as described in Ref. (<italic><xref ref-type="bibr" rid="sc2">2</xref></italic>). Certain samples from plate YuBhay.Octo06.RedA.3 received an additional treatment with lysozyme (20 min at room temp in 50 U/fLl prior to alkaline lysis) because of difficulty lysing the cells. Otherwise, they followed the standard alkaline lysis described in Ref. (<italic><xref ref-type="bibr" rid="sc2">2</xref></italic>). In brief, libraries were made with Nextera XT v2 kits and sequenced on an Illumina Novseq in 2 150 bp mode. Reads were assembled into contigs and annotated using the Integrated Microbial Genomes (IMG) platform as described in Ref. (<italic><xref ref-type="bibr" rid="sc3">3</xref></italic>). All of the data generated for this study is available on the JGI website, under the project ID 503441.</p>
</sec>
<sec id="s1b">
<label>I.2</label>
<title>Data processing</title>
<p>In this section we describe the procedure we used to process the single-amplified genomes (SAGs). Our analysis is based on grouping genes into orthologous gene clusters or <italic>orthogroups</italic>, which are then analyzed separately. This procedure makes it much easier to analyze the fragmented and incomplete genomes resulting from single-cell sequencing compared multiple sequence alignment (MSA) of entire genomes, which are sometimes used for analyzing genomes obtained from isolates. An alternative approach is to align the assemblies or even the raw reads to reference genomes. In our case, there are only two reference genomes available, OS-A and OS-B’, so aligning to them would likely result in biases in the inferred diversity.</p>
<p>There are several ways of constructing orthogroups: I. pairwise comparisons, or 2. graph methods. Graph methods have the advantage that they produce sets of mutually homologous genes so we decided to use this approach. There are several packages available for identifying homologous gene clusters among samples of different genomes. Most widely-used packages, such as OrthoDB (<xref ref-type="bibr" rid="sc4">4</xref>) and OrthoFinder (<xref ref-type="bibr" rid="sc5">5</xref>), were designed for finding homologs between different eukaryotic species and are inappropriate for studying large bacterial pangenomes (<xref ref-type="bibr" rid="sc6">6</xref>). More recently, several groups have developed packages that allow for efficient construction of large bacterial pangenomes (<xref ref-type="bibr" rid="sc6">6</xref>, <xref ref-type="bibr" rid="sc7">7</xref>). However, such packages are primarily aimed at studying large collection of isolate genomes and were not designed to handle samples with low genome coverage, which are common in single-cell sequencing projects such as ours. As a result we implemented a custom pipeline for processing the single-cell genome assemblies and constructing the pangenome from these sequences. The pipeline is divided into two parts: I. a pre-processsing step where assemblies are filtered for contamination and checked for misassemblies and misannotations, and 2. a gene clustering step, in which clusters of homologous genes are identified and paralogs are separated from true orthologs.</p>
<p>The second half of the pipeline closely follows the approach taken in Ref. (<italic><xref ref-type="bibr" rid="sc6">6</xref></italic>). A more detailed outline of the pipeline is given below. For details on our definition of the core genome and the assignment of sequence clusters within orthogroups to different species see Sec. V.</p>
</sec>
<sec id="s1c">
<label>1.3</label>
<title>Outline of data processing pipeline</title>
<p>1. Data pre-processing</p>
<p>2. Orthogroup clustering</p>
<p>3. Orthogroup MSA</p>
<p>4. Deep branch splitting</p>
<p>5. Orthogroup species clustering</p>
<p>6. Reference genome mapping</p>
<p>The rest of this section explains how each step in the pipeline was performed. Readers not interested in the details may wish to move on to the next section.</p>
<sec id="s1c1">
<label>1.</label>
<title>Data pre-processing.</title>
<p>The goal of this step is to remove I. SAGs from non-Synechococcus OS species, 2. SAGs that might have resulted from sequencing multiple cell in the same reaction well, and 3. contigs that might be the result of contamination from external DNA or other sequencing wells. We first removed all SAGs that were positive controls in which multiple cells were amplified in the same reaction well (all SAGs from the third column of the 384-well plate in our case). We then aligned all of the genes in our data to the OS-A and OS-B’ reference genomes using BLAST (alignment parameters: -evalue 1E-10 -word size 8 -qcov hsp perc 75.0). We then removed all SAGs with &gt; 50% of genes that did not map to either reference genome.The remaining SAGs are assumed to be from Synechococcus OS cells. Next, we filtered out all contigs without any hits to OS-A and OS-B’.This was done to avoid external DNA or cross-contamination from affecting the rate of hybridization we observed.</p>
<p>Next, we removed any remaining SAGs that were suspected to have been the result of sequencing multiple cells in the same well. We reasoned that sequencing multiple cells would lead to an increase in the number of duplicated genes in the SAG. We used the probability of sampling a gene with more than one copy in the two reference genomes, both 10%, as a benchmark and removed all SAGs with a multicopy frequency <italic>&gt;</italic> 20%.</p>
<p>Preliminary analysis of the data following the above filtering procedure revealed the existence of a small number of palindromic contigs, in which the first half of the sequence was mirrored exactly in the second half, that were very likely the result of assembly artifacts. To remove these artifacts we labeled the genes in each contig based on the hits to the reference genomes and used these to search for palindromic sequences within each contigs. We then removed any contig that contained a palindromic subsequence that was either longer than 4 genes or contained <italic>&gt;</italic> 50% of genes in the contig. Finally, we removed all partial genes from the remaining contigs to simplify the analysis of the multiple-sequence alignments (MSA), which we perfomed next.</p>
</sec>
<sec id="s1c2">
<label>2.</label>
<title>Orthogroup clustering.</title>
<p>The goal of this step is to obtain clusters of orthologous genes or <italic>orthogroups</italic>, which were used in subsequent analysis. To do this we followed Refs. (<italic><xref ref-type="bibr" rid="c6">6</xref></italic>, <italic><xref ref-type="bibr" rid="c7">7</xref></italic>) and used a Markov clustering algorithm to find groups of sequences that were similar to each other and well-separated from all other sequences (<italic><xref ref-type="bibr" rid="sc8">8</xref></italic>). The Markov clustering algorithm takes as input a similarity graph, where each node represents a gene sequence and the weight of each edge represents the similarity between the two sequences.</p>
<p>We constructed the gene similarity graph by translating all of the gene sequences in the filtered dataset and performing an all-to-all protein alignment using BLAST (alignment parameters: -evalue 1E-3 -word size 3 -qcov hsp perc 75.0). Other approaches either perform a pre-alignment clustering (<italic><xref ref-type="bibr" rid="sc7">7</xref></italic>) or use faster but less sensitive methods for all-to-all alignments (<italic><xref ref-type="bibr" rid="sc6">6</xref></italic>), but we found that this was not necessary in our case. The higher sensitivity provided by BLAST could help distinguish between paralogs within large gene families and minimize gene misassignments, but we did not extensively test how the performance would be affected by using other methods. We used the bitscore from the alignments to define the weight of each edge in the similarity graph. Using the bitscore instead of the e-value is a simple way to correct for the minimum e-value of 1<italic>E</italic> 180 in BLAST and has been shown previously to improve the clustering performance (<italic><xref ref-type="bibr" rid="sc9">9</xref></italic>).</p>
<p>We used MCL (v. 14-137) to cluster the resulting similarity graph and obtain orthogroups (<italic><xref ref-type="bibr" rid="sc8">8</xref></italic>). We used a relatively small inflation parameter (-I 1.5) in order to cluster genes aggressively and used subsequent steps in the pipeline to split clusters resulting from incorrect cluster assignments or the presence of paralogs (steps 5 and 6). As a first step, we did an additional clustering based on sequence length as follows. We constructed a graph in which all sequences in an orthogroup were represented as nodes and edges where attached between pairs of sequences if the difference between their lengths was less than 30% of their average length. We then identified all connected components in this graph. Because homologous genes in OS-A and OS-B’ sometimes have different lengths, we hypothesized that each orthgroup should contain at most two main clusters. We therefore used the following heuristic algorithm to filter out orthogroups with unusual gene length patterns that could possibly result from overly aggressive clustering. If a single length cluster was present or the largest cluster contained <italic>&gt;</italic> 80% of sequences, only the sequences from the largest cluster were kept and the rest were removed. If two clusters accounted for <italic>&gt;</italic> 80% of sequences, only the sequences in those two clusters were kept and the rest removed. In all other cases we removed the orthogroup from our dataset and did not include it in subsequent analysis.</p>
</sec>
<sec id="s1c3">
<label>3.</label>
<title>Orthogroup MSA.</title>
<p>The filtered orthogroups from the previous step were aligned using a custom codon-aware alignment algorithm. Briefly, nucleotide sequences were translated into protein sequences and aligned using MAFFT (v. 7.475 with default parameters) (<italic>IO</italic>). The alignments were then reverse-translated using nucleotide sequences as templates. After alignment, phylogenetic trees for each orthogroup were constructed using FastTree (v. 2.I.II with parameters -nj -noml) (<italic>II</italic>).</p>
</sec>
<sec id="s1c4">
<label>4.</label>
<title>Deep branch splitting.</title>
<p>In this step we separated gene clusters within the initial orthogroups that were joined by unsually long branches in the phylogenetic tree. Specifically, we implemented the following algorithm. For each orthogroup, we checked the branch length for each node in the phylogenetic tree and grouped any sequences with a branch length greater than a cutoff value <italic>b<sub>c</sub></italic> = 0.3 into separate orthogroups. Each newly-created orthogroup was realigned as in step 3 and the procedure was repeated until no new orthogroups could be separated. We used the results from previous analysis of homologous genes in OS-A and OS-B’, which showed that typical divergences were 0.15 (<xref ref-type="bibr" rid="c12"><italic>12</italic></xref>), as a benchmark to set <italic>b<sub>c</sub></italic>. Based on those results, we expected very few genuine homologs with divergences above <italic>b<sub>c</sub></italic> = 0.3. The clusters that resulted after this step represent the final orthogroups that were used in subsequent analysis.</p>
</sec>
<sec id="s1c5">
<label>5.</label>
<title>Orthogroup species clustering.</title>
<p>We next sought to determine which orthogroups could be reliably partitioned into distinct species clusters, which would be expected if the different species asexually diverged from a common ancestor. To do this, we implemented the following algorithm in a custom Python script. For each orthogroup, the alignments were trimmed to remove excess gaps at the edges using a custom script. We then calculated the fraction of sites with different nucleotide between each pair of sequences and hierarchically clustered the sequences using average linkage as implemented in the Python Scipy package (v. I.9.3) (<xref ref-type="bibr" rid="c13"><italic>13</italic></xref>). Preliminary clusters were assigned using a distance cutoff <italic>d<sub>c</sub></italic> = 0.075. To ensure that the clusters were well-separated and robust we implemented an additional check by requiring that the minimum distance between any two sequences from different clusters be at least <italic>c</italic> = 1.5 times greater than the maximum distance between any two sequences within either cluster. Any clusters which did not satisfy this criterion were designated as <italic>mosaic orthogroups</italic>. We validated the robustness of the cluster assignments by <italic>d<sub>c</sub></italic> and <italic>c</italic> and found only small changes in the results.</p>
</sec>
<sec id="s1c6">
<label>6.</label>
<title>Mapping to reference.</title>
<p>For this step we use reciprocal best hit (RBH) given by BLAST to map the consensus sequences to the OS-A and OS-B’ reference CDS. Since at this point in the pipeline most sequences within one OG are less that 10% diverged from each other, we use nucleotide sequences for this step to increase the accuracy of the mapping. The consensus sequence for each OG is constructed by finding at the consensus codon at each residue along the CDS after replacing all codons containing gaps by a gap codon. The resulting sequences that have RBH to OS-B’ are mapped onto those respective genes. The genes without RBH to OS-B’ are searched against OS-A and mapped to it if an RBH is found.</p>
<fig id="figs1" position="float" orientation="portrait" fig-type="figure">
<label>Figure S1:</label>
<caption><title>Examples of alignments of orthogroups with mixed-species clusters.</title>
<p>A random sample of 5 orthogroup alignments labeled as mixed-species clusters are shown. All alignments were trimmed to remove segments containing large fraction of gaps. Panels <bold>A</bold>-<bold>D</bold> (YSG 1519, YSG 0498, YSG 0215c, and YSG 1364) show varying degrees of hybridization between <italic>α</italic> and <italic>β</italic>. Panel <bold>E</bold> (YSG 0291) is the result of a poor initial alignment of the orthogroup leading to a large number of indels before trimming.</p></caption>
<graphic xlink:href="543983v1_figs1.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
</sec>
</sec>
<sec id="s1d">
<label>II.</label>
<title>SAG species assignment</title>
<p>In this section, we outline the method we used to assign genomes to each species cluster. We also verify the robustness of the species assignment by using three different methods and show that they give identical results.</p>
<p>Comparisons of genomes from bacterial populations often reveal clusters at different length and divergence scales (<xref ref-type="bibr" rid="c14"><italic>14</italic></xref>). But the interpretation of such clusters is controversial (<italic><xref ref-type="bibr" rid="c15">15</xref></italic>, <italic><xref ref-type="bibr" rid="c16">16</xref></italic>). There three main possible interpretations for such patterns. One interpretation is that the clusters represent the bacterial analog of eukaryotic species, which are sexually and ecologically isolated from each other. In practice a whole-genome divergence cutoff of 5% is frequently used to define bacterial species (<xref ref-type="bibr" rid="c14"><italic>14</italic></xref>) An alternative interpretation is that clusters are the result of clonal expansions of particular strains from a much more diverse and possibly more genetically homogeneous population. The third interpretation is that the clusters are the result of uneven sampling from a larger and more diverse population. The unique combination of having a large collection of genomes, with minimal compositional bias, from a geographically isolated population allows us to test these alternatives. We will mainly aim to distinguish between the first two interpretations and the third one by checking whether there are robust genomic clusters in our sample. More discussion on the evidence concerning the first two hypotheses can be found in Secs. III and V.</p>
<p>We used three different methods to check whether the genomes form robust clusters: the phylogenetic tree of the 16S rRNA sequences, average genome-wide divergence from the two reference genomes OS-A and OS-B’, and patters of divergences between triplets formed by the SAG and the two reference sequences at different loci. The phylogenetic tree of the 16S is the simplest and still the most commonly used method to characterize the diversity of natural microbial communities (<xref ref-type="bibr" rid="c17"><italic>17</italic></xref>). Because of its practical importance, we included it for comparison with the other two methods. However, in a highly recombining population like the Yellowstone Synechococcus, it is not clear to what extent the 16S divergence accurately reflects the whole genome diversity. To address this question, we used the divergences across the entire genome as a comparison. The main limitation of using summary statistics such as the average divergence across the entire genome is that it obscures heterogeneities along the genome that could have important ecological and evolutionary implications. There are different ways to address this concern. Here, we used an extension of a method first used in Ref. (<xref ref-type="bibr" rid="c12"><italic>12</italic></xref>), which provides a coarse description of the variation in the diversity patterns across different loci. We present the results from each of these analyses next.</p>
<p>We first constructed the phylogenetic tree of 16S sequences. Predicted 16S rRNA sequences (117 from 331 filtered SAGs) were extracted and aligned using MAFFT (v7.453) (<italic>IO</italic>). Two sequences (SAGs MA02MII 3 and MuA02C9) were incomplete and were removed from the analysis. The remaining (115) sequences were hierarchicaly clustered using the average linkage (UPGMA) method implemented in Scipy. Results are shown in <xref ref-type="fig" rid="figs4">Fig. S4</xref>, with the colored background showing the species assignment using whole genome divergences (see below) for comparison. We found perfect agreement between the whole-genome assignment and the largest three clusters in the 16S phylogenetic tree.</p>
<p>The average divergence within the <italic>α</italic> cluster approximately half that of <italic>β</italic> (1 10<italic><sup>−</sup></italic><sup>3</sup> vs. 2 10<italic><sup>−</sup></italic><sup>3</sup>). However, a significant fraction of the average divergence within <italic>β</italic> was due to two outliers (MuAIL16 and MusAIJ8). After removing the outliers, the average divergence within <italic>β</italic> decreased to 1.7 10<italic><sup>−</sup></italic><sup>3</sup>. Closer investigation of the alignments revelead that both outlier <italic>β</italic> sequences contained a short segment of 3 SNPs that were identical to all <italic>α</italic> sequences and different from all other <italic>β</italic> sequences, at positions 1067–1072. In addition, MuAIL16 contained larger segment of almost 200 bp (positions 390–570) containing 10 SNPs and an insertion that were different from all other <italic>β</italic> and were identical to the consensus <italic>α</italic>. Apart from these segments, the outlier sequences were typical of the <italic>β</italic> species. This pattern is similar to the SNP blocks discussed in the main text and in Sec. VI and therefore is likely the result of hybridization between <italic>α</italic> and <italic>β</italic>.</p>
<p>We compared the 16S rRNA clusters to whole-genome divergences from the two reference genomes, OS-A and OS-B’. We aligned all of the predicted genes from each SAG to all of the coding DNA sequences (CDS) from each reference genome using BLAST (v2.13.0+) (<xref ref-type="bibr" rid="c18"><italic>18</italic></xref>). For each SAG, we calculated the divergence to each reference genome (<italic>d</italic> = 1 pident<italic>/</italic>100) and calculated the average over the best hits across all genes. The results for all SAGs with more than 100 hits to both references are shown in <xref rid="fig2" ref-type="fig">Fig. 2A</xref>. Three clear clusters were observed, which we labeled as <italic>α</italic>, <italic>β</italic>, and <italic>γ</italic>. The species of each SAG was assigned as the label correspoding to the cluster it belonged to in <xref rid="fig2" ref-type="fig">Fig. 2A</xref>.</p>
<p>The previous two metrics do not reflect possible heterogeneity in the patterns of diversity along the genome. To characterize this variation on a gene-by-gene basis we extended a method that was previously used to analyze amplicond data from the Mushroom Spring in Ref. (<xref ref-type="bibr" rid="c12"><italic>12</italic></xref>). We refer to this method as <italic>gene triplet analysis</italic>. This analysis exploits the separation of scales between and within species clusters, at most loci and in most cells, we observed previously in order to coarse grain the high-dimensional matrix of pairwise divergences into a small number of discrete patterns. Specifically, we take triplets of sequences from the SAGs, OS-A, OS-B’, at loci where all three are homologous and calculate the divergences between all 3 pairs of sequences. These divergences typically form a triangle as shown in <xref ref-type="fig" rid="figs2">Fig. S21</xref>. To reduce the dimensionality of the data further, we define a main cloud diameter <italic>d<sub>M</sub></italic> = 0.1 for the diversity within species. We then classify the shape of the triangle into the 5 distinct patterns shown in <xref ref-type="fig" rid="figs2">Fig. S2</xref>, depending whether each side of the triangle is longer or shorter than <italic>d<sub>M</sub></italic> . For example, denote the divergence triplet by (<italic>d<sub>XA</sub>, d<sub>XB</sub>, d<sub>AB</sub></italic>), representing the divergences between the SAG sequence and OS-A, the SAG sequence and OS-B’, and OS-A and OS-B’, respectively. Then the first pattern in S2A (labeled “XA-B”) contains loci where <italic>d<sub>XA</sub> &lt; d<sub>M</sub></italic>, <italic>d<sub>XB</sub> d<sub>M</sub></italic>, and <italic>d<sub>AB</sub> &lt; d<sub>M</sub></italic>, the second pattern (labeled “XAB”) contains loci where <italic>d<sub>XA</sub> &lt; d<sub>M</sub></italic>, <italic>d<sub>XB</sub> &lt; d<sub>M</sub></italic>, and <italic>d<sub>AB</sub> &lt; d<sub>M</sub></italic>, and so on. The cutoff of <italic>d<sub>M</sub></italic> = 0.1 is the same as the one used in Ref. (<xref ref-type="bibr" rid="c12"><italic>12</italic></xref>) and provides a good separation between species at a gene by gene basis. The results of our analysis, however, do not depend on the specific value of <italic>d<sub>M</sub></italic> as discussed at the end.</p>
<p>For each SAG we assigned all genes that were orthologous to OS-A and OS-B’ to one of the 5 patterns described above. The three rows in <xref ref-type="fig" rid="figs2">Fig. S2</xref> show typical examples of an <italic>α</italic> (<xref ref-type="fig" rid="figs2">Fig. S2A</xref>), a <italic>β</italic> (<xref ref-type="fig" rid="figs2">Fig. S2B</xref>), and the <italic>γ</italic> (<xref ref-type="fig" rid="figs2">Fig. S2C</xref>) SAG . The majority of genes across each row in <xref ref-type="fig" rid="figs2">Fig. S2</xref> are found in the XA-B, XB-A, and X-A-B patterns, respectively. This is consistent with the species clusters we saw in the genome-wide average divergences from before. However, we also find a significant minority of genes forming other patterns, most notably XAB, representing genes where all three sequences are within the main cloud (<italic>d &lt; d<sub>M</sub></italic>). Some of these genes were contained in the diversity troughs discussed in the main text and in Sec.V. In the case of the <italic>γ</italic> SAG, the fact that X-A-B is the dominant pattern rules out the possibility that <italic>γ</italic> is a hybrid resulting from the mixture of <italic>α</italic> and <italic>β</italic>. Such hybrids have been observed after recent clonal expansions in acid mine drainage microbial communities (<italic><xref ref-type="bibr" rid="c19">19</xref></italic>), <italic><xref ref-type="bibr" rid="c20">20</xref></italic>), but do not appear to be present at substantial frequency in the Yellowstone community. Instead, it appears that <italic>γ</italic> is a distinct species that diverged from the other two around the same time <italic>α</italic> and <italic>β</italic> diverged from each other.</p>
<p>Using the pattern described above allows us to compare different SAGs to each other and allows us to test the robustness of the species assignment based on the average genome-wide divergence. Specifically, we assigned to each SAG a gene triple “fingerprint” <italic>f</italic> = (<italic>f<sub>XA</sub><sub>−B</sub>, f<sub>XAB</sub>, f<sub>X</sub><sub>−A−B</sub>, f<sub>X</sub><sub>−AB</sub>, f<sub>XB</sub><sub>−A</sub></italic>), representing the fraction of genes with each pattern <sup>2</sup> We then compared the fingerprints of each SAG with the species assignment based on the average divergence from OS-A and OS-B’ from <xref ref-type="fig" rid="fig1">Fig. 1A</xref>. We found that the fingerprints formed three clear patterns that exactly matched the assignments based on the average divergence (<xref ref-type="fig" rid="figs3">Fig. S3</xref>). We tested this assignment for different values of <italic>d<sub>M</sub></italic> ranging from 1% to 20% and found that the fingerprint patterns were robust across the entire range (data not shown). These results show that the classification into distinct species is robust and consistent across the three methods described.</p>
<fig id="figs2" position="float" orientation="portrait" fig-type="figure">
<label>Figure S2:</label>
<caption><title>Species clusters at the gene level approximately match those at the genome level.</title>
<p>Figures show gene-by-gene comparison of three cells to the OS-A and OS-B’ reference genomes. The cells shown are representative of the <italic>α</italic> (<bold>A</bold>; OctA1J9)and <italic>β</italic> (<bold>B</bold>; MRedA02H14 2) clusters and the one <italic>γ</italic> cell (<bold>C</bold>; OcA3L13). Each core gene with homologs in both OS-A and OS-B’ was compared to the references and the divergences plotted as a triangle with each side length equal to the divergence between a given pair. The cell sequence is represented by a black dot, with the OS-A and OS-B’ sequences represented by the orange upward and blue downward triangles, respectively. The black circle is a 10% radius which was chosen as a cutoff to classify each gene. The different columns show genes in one of the five possible patterns labeled as follows: XA-B (the cell sequence is less than 10% divergend from OS-A and more than 10% diverged from OS-B’), XAB (all three sequences are within 10% of each other), X-A-B (all three sequences are more than 10% diverged from each other), X-AB (the cell is more than 10% diverged from both OS-A and OS-B’, but both references are less than 10% diverged from each other), and XB-A (the cell is less than 10% diverged from OS-B’ and more than 10% diverged from OS-A).</p></caption>
<graphic xlink:href="543983v1_figs2.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<fig id="figs3" position="float" orientation="portrait" fig-type="figure">
<label>Figure S3:</label>
<caption><title>Proportion of gene triplet patterns shows three distinct clusters.</title>
<p>The proportion of genes in each of the five patterns shown in S2 is show of each cell passing our quality control criteria (see SI, Sec. I.2). Lines represent different cells and are colored according to the species classification based on whole-genome divergences.</p></caption>
<graphic xlink:href="543983v1_figs3.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<fig id="figs4" position="float" orientation="portrait" fig-type="figure">
<label>Figure S4:</label>
<caption><title>Phylogenetic tree inferred from 16S rRNA agrees with whole-genome species classification.</title>
<p>The pairwise divergences between all 16S sequences passing quality control was calculated from the multiple sequence alignment performed using MAFFT (<italic><xref ref-type="bibr" rid="sc10">10</xref></italic>). The tree was generated using a hierarchical agglomerative clustering algorithm with average linkage (UPGMA) as implemented in SciPy (<italic><xref ref-type="bibr" rid="sc13">13</xref></italic>)</p></caption>
<graphic xlink:href="543983v1_figs4.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
</sec>
<sec id="s1e">
<label>III.</label><title>Metagenome analysis</title>
<sec id="s1e1">
<label>III.1</label><title>Phylogeny of γ</title>
<p>Here we present the details of the phylogenetic analysis of the <italic>γ</italic> SAG, OA3L13 which shows that it represents a new uncharacterized species within the Yellowstone cyanobacteria population. To establish its phylogeny we used a concatenated alignment of marker genes, following Ref. (<xref ref-type="bibr" rid="c21"><italic>21</italic></xref>). Of the 31 marker genes used in Ref. (<xref ref-type="bibr" rid="c21"><italic>21</italic></xref>), 16 were covered in the <italic>γ</italic> SAG (<italic>dnaG</italic>, <italic>frr</italic>, <italic>pgk</italic>, <italic>rplA</italic>, <italic>rplK</italic>, <italic>rplL</italic>, <italic>rplM</italic>, <italic>rplS</italic>, <italic>rplT</italic>, <italic>rpsB</italic>, <italic>rpsI</italic>, <italic>rpsJ</italic>, <italic>rpsK</italic>, <italic>rpsM</italic>, <italic>smpB</italic>, and <italic>tsf</italic>) and were used to determine its phylogeny. We used a large collection of cyanobacterial genomes from Ref. (<italic><xref ref-type="bibr" rid="sc22">22</xref></italic>) to check for closely related species to <italic>γ</italic>. The concatenated alignment was constructed as follows. For each of the 16 marker genes, we extracted the alignment of all species labeled “Thermal springs” that were within one of the subsections labeled I through V in (<italic><xref ref-type="bibr" rid="sc22">22</xref></italic>) and added the <italic>γ</italic> sequence to the alignment. All “?” characters were replaced with “X”. The sequences were then realigned using MAFFT (v7.453) (<italic>IO</italic>) using default parameters and the alignments were concatenated and trimmed using trimal (vI.4.rev22) (<italic><xref ref-type="bibr" rid="sc23">23</xref></italic>) with default parameters. Finally, the resulting sequences were realigned using MAFFT and the phylogenetic trees were inferred using FastTree (v2.I.II) (<italic>II</italic>) with default parameters. The resulting tree is shown in <xref ref-type="fig" rid="figs5">Fig. S5</xref>.</p>
<p>To verify that the lack of other closely-related genomes to <italic>γ</italic> was not due to the incompleteness of our reference database, we searched for homologs to the 16 <italic>γ</italic> marker genes in the NCBI database. We used the Web version of blast on NCBI with the megablast settings and word size 16. For all 16 marker genes the top two hits were from OS-A and OS-B’, while all other high-scoring hits had less than 85% nucleotide identity. We also matching sequences to the 16S rRNA using the SILVA database (v138.I) (<italic><xref ref-type="bibr" rid="sc24">24</xref></italic>). Using the non-redundant version of the database (SSU Ref NR99) only gave hits to OS-A and OS-B’ sequences. Using the full database we did find several sequences that were less than 10 SNPs away from the <italic>γ</italic> sequence across the entire 16S rRNA (<italic>&gt;</italic> 99.7% identity), including one from a previous study of Yellowstone microbiomes (<italic><xref ref-type="bibr" rid="sc25">25</xref></italic>). The corresponding divergence of 3 <italic>·</italic> 10<italic><sup>−</sup></italic><sup>3</sup> is comparable to the typical diversity within species in our SAGs of 1 <italic>−</italic> 2 <italic>·</italic> 10<italic><sup>−</sup></italic><sup>3</sup> and much less than the typical divergence between species, which is approximately 2 <italic>−</italic> 4 <italic>·</italic> 10<italic><sup>−</sup></italic><sup>2</sup> (Sec. II).</p>
<table-wrap id="tbls1" orientation="portrait" position="float">
<label>Table S1:</label><caption><p>Best hits to OA3L13 16S rRNA in SILVA SSU Ref database.</p></caption>
<graphic xlink:href="543983v1_tbls1.tif" mimetype="image" mime-subtype="tiff"/>
</table-wrap>
<p>Inferred abundances of <italic>γ</italic> from metagenomic samples are consistent with a single <italic>γ</italic> SAG in our data (see Sec. III). To further verify that no other <italic>γ</italic> SAGs were accidentally excluded during quality control (see Sec. I.2) we performed a BLAST search (alignment parameters: -evalue 1E-10 -word size 9 -qcov hsp perc 75.0) of the <italic>γ</italic> genes against the contigs from the SAGs that were filtered out. The results were consistent with the majority of the excluded SAGs containing mostly <italic>α</italic> and <italic>β</italic> genes, with a smaller number of SAGs with divergences around twice as large (<xref ref-type="fig" rid="figs6">Fig. S6</xref>). This confirms that no other <italic>γ</italic> SAGs were present in our data.</p>
<fig id="figs5" position="float" orientation="portrait" fig-type="figure">
<label>Figure S5:</label>
<caption><p><italic>γ</italic> <bold>SAG represents a new distinct species within Yellowstone Synechococcus.</bold> Shows the maximum likelyhood tree obtained from an alignment of 16 marker genes present in the <italic>γ</italic> SAG together with all other thermophilic cyanobacteria from Ref. (<italic><xref ref-type="bibr" rid="sc22">22</xref></italic>). Colored labels show the two Yellowstone Synechococcus, OS-A (orange) and OS-B’ (blue), and the <italic>γ</italic> SAG OA3L13 (green).</p></caption>
<graphic xlink:href="543983v1_figs5.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<fig id="figs6" position="float" orientation="portrait" fig-type="figure">
<label>Figure S6:</label>
<caption><title>SAGs excluded during quality control do not include additional</title>
<p><italic>γ</italic> <bold>genomes.</bold> The distribution of divergences from the best BLAST hit to the <italic>γ</italic> SAG (OcA3L13) across genes for each SAG excluded during the quality control process (see Sec. I.2) is shown. Each line represents the probability density of divergences across genes for one of the 44 SAGs.</p></caption>
<graphic xlink:href="543983v1_figs6.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
</sec>
<sec id="s1e2">
<label>III.2</label><title>Estimating abundances of α, β, and γ</title>
<p>To estimate abundances of the three main species <italic>α</italic>, <italic>β</italic>, and <italic>γ</italic> in the Octopus and Mushroom Springs we recruited metagenomic reads from 34 samples taken from both springs (see Sec. I.I) to SAGs from each species. We chose the one <italic>γ</italic> SAG (OA3L13, 70% coverage) along with representative SAGs from <italic>α</italic> (MA02D15, 77% coverage) and <italic>β</italic> (OcA2H14, 96% coverage) as reference genomes. Hybridization on length scales longer than the typical read size (150 bp in our case) can lead to errors in our estimates of species abundances. To minimize these errors we only used core genes where three distinct species clusters could be identified and there was no evidence of hybridization in the single-cell data (see Secs. I.2 and V). This resulted in set of 400 genes for each reference. We aligned all the metagenomic reads to these target gene sequences using BowTie2 (v2.3.4, default parameters) (<italic><xref ref-type="bibr" rid="sc26">26</xref></italic>) and extracted reads aligning to each of the three reference sequences using Samtools (vI.7.0) (<italic><xref ref-type="bibr" rid="sc27">27</xref></italic>) and bedtools bamtofastq command (v2.26.0) (<italic><xref ref-type="bibr" rid="sc28">28</xref></italic>).</p>
<p>We assigned the recruited reads to each species clusters if their divergence from their respective reference was less than the “main cloud” radius <italic>d<sub>M</sub></italic> . We determined <italic>d<sub>M</sub></italic> self-consistently from the data as follows. For each reference, counted the number of reads that had divergences less than <italic>d<sub>M</sub></italic> from that reference sequence and more than <italic>d<sub>M</sub></italic> from the other two reference sequences, for <italic>d<sub>M</sub></italic> from 1% to 15%. If the population consists of species clusters with typical diversity <italic>π</italic>, the number of reads within the cloud will increase until <italic>d<sub>M</sub> π</italic>. As <italic>d<sub>M</sub></italic> approaches the typical divergence between species <italic>d</italic> 15%, more reads will start to map to multiple reference sequences so the number of reads uniquely assigned to each species cluster will decrease. Therefore, the number of reads uniquely assigned to each species cluster should have a maximum as a function of <italic>d<sub>M</sub></italic> . We indeed found this to be the case for all three species (data not shown). Empirically, we found that <italic>d<sub>M</sub></italic> = 5% was close to the maximum for all three species so we used this value throughout our analysis.</p>
<p>We found that the average depth of recruited reads across genes varied within the same sample. However the variations across samples were highly correlated, which confirmed that most reads aligning to our chosen genes came from genomes that were part of the same species cluster rather than from genes transferred across species (<xref ref-type="fig" rid="figs7">Fig. S7</xref>). We found that the genes that recruited the largest numbers of reads had reads depths that were much more similar within the same sample compared to other genes. Interestingly, we found much more variation in depth between genes within the <italic>γ</italic> cluster compared to <italic>α</italic> and <italic>β</italic> (<xref ref-type="fig" rid="figs7">Fig. S7</xref>). One likely explanation for this is that <italic>γ</italic> contains much more diversity compared to either <italic>α</italic> or <italic>β</italic>.</p>
<p>We estimated the abundance of each species cluster by averaging the depth of the 100 genes with the highest average depth across all samples for each cluster. We found that <italic>γ</italic> was more than an order of magnitude more abundant than our detection threshold given by the metagenomic read depth in 32 out of the 34 metagenome samples (<xref ref-type="fig" rid="figs8">Fig. S8</xref>). Moreover, its abundance in the two samples for which we had single-cell and metagenome data (MSe4 and OSM3) was close to the detection threshold of the single-cell samples, which was around 2%. This explains why we only obtained a single <italic>γ</italic> cell from the single-cell samples after our quality controls. Finally, we found that the abundance of <italic>γ</italic> was highly correlated with <italic>α</italic> across all samples and was only present at abundances higher than <italic>O</italic>(<xref ref-type="bibr" rid="sc1">1</xref>)% in the Mushroom Spring sample taken from 65 <italic><sup>◦</sup></italic>C. This suggests that <italic>γ</italic> is, together with <italic>α</italic>, primarily adapted to growth at higher temperatures.</p>
<fig id="figs7" position="float" orientation="portrait" fig-type="figure">
<label>Figure S7:</label>
<caption><title>Number of reads recruited to different loci from the three main species are highly correlated across samples.</title>
<p>The three panels show the average depth of reads recruited to representative SAGs from α (top), β (middle), and (bottom), respectively. Each panel shows 100 genes with the highest average read depth across samples, with each line representing one gene. Only reads that were &lt; 5% diverged from the reference genomes were included.</p></caption>
<graphic xlink:href="543983v1_figs7.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<fig id="figs8" position="float" orientation="portrait" fig-type="figure">
<label>Figure S8:</label>
<caption><title>Abundance of</title>
<p><italic>γ</italic> <bold>is significantly above detection threshold in 32 of 34 metagenomic samples and is highly correlated with</bold> <italic>α</italic>. The relative abundances of <italic>α</italic> (orange circles), <italic>β</italic> (blue squares), and <italic>γ</italic> (green diamonds) across all 34 metageomic samples. The detection threshold for the single-cell (<italic>f<sub>t</sub></italic> = 1<italic>/</italic>48 <italic>≈</italic> 0.021) and metagenomic samples are shown in black and grey dashed lines, respectively. The asterisks on the x-axis label the two samples (MSe4 and OSM3) with both single-cell and metagenomic data.</p></caption>
<graphic xlink:href="543983v1_figs8.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
</sec>
<sec id="s1e3">
<label>III.3</label><title>Other Synechococccus species</title>
<p>Are other <italic>Synechococcus</italic> species present in Mushroom or Octopus Spring apart from <italic>α</italic>, <italic>β</italic>, and <italic>γ</italic>? To answer this question, we again used the 34 samples from which we have high-depth metagenomes. We used BLAST with highly sensitive parameter choices to minimize the number of true <italic>Synechococcus</italic> reads not captured. For computational efficiency, we focused on the 100 genes with highest coverage depth in the metagenomes across all three references.</p>
<p>To determine how much of the population is in the <italic>α</italic>-<italic>β</italic>-<italic>γ</italic> main cloud, we used the same three SAGs as in the previous subsection as references and recruited reads using BLAST (-task blastn -evalue 1e-3 -word size 6 -num threads 32). Using these parameters, we could recruit reads belonging to the dominant <italic>Roseiflexus</italic> species in our samples, which is in a different phylum from <italic>Synechococcus</italic>. We were therefore confident that any reads from other potential <italic>Synechococcus</italic> species would be included in our analysis. To limit the analysis to just <italic>Synechococcus</italic> species, we removed all reads that were more than 20% diverged from all of our references from subsequent analysis.</p>
<p>Because of the large amount of data in this analysis, we focus on just the Mushroom Spring samples taken from different temperatures (MS temperature series). We recruited a total of 4, 522, 833 reads with an average depth per gene of 4980. We calculated the minimum divergence from the three reference sequences for each read and found 94% within 5% divergence of one of them (<xref ref-type="fig" rid="figs9">Fig. S9A</xref>). For comparison, we determined the typical divergences between species by dividing the reference sequences into 150 bp segments (the same size as our reads) and calculating the divergences between all three pairs of species (<xref ref-type="fig" rid="figs9">Fig. S9B</xref>). The middle 95-percentile of the combined distributions extended down to a divergence of around 5% (8 SNPs), consistent with our cutoff for the intraspecies divergences at these loci. These results are consistent with all of the <italic>Synechococcus</italic> reads being from one of the three species and set an upper bound on the relative abundance of any other species at below 4%.</p>
<p>To check how sensitive our detection method is to the presence of other species, we used the Mushroom Spring sample from 65 <italic><sup>◦</sup></italic>C, in which <italic>γ</italic> had a relatively high abundance. To mimic the presence of another species, we compared the previous distributions to the distribution of the minimum divergence from <italic>α</italic> and <italic>β</italic> only (dashed red line in <xref ref-type="fig" rid="figs9">Fig. S9A</xref>). We found a 19% decrease in cumulative number of reads within 5% from the references in this case, which was very close to the 21% abundance of <italic>γ</italic> we estimated in the previous subsection based on the average depth across loci. This shows that our method is sensitive to presence of other species and illustrates the benefits of combining single-cell and metagenome analysis for identifying unknown species.</p>
<fig id="figs9" position="float" orientation="portrait" fig-type="figure">
<label>Figure S9:</label>
<caption><title>Vast majority of <italic>Synechococcus</italic> core gene sequences are within the</title>
<p><italic>α</italic><bold>-</bold><italic>β</italic><bold>-</bold><italic>γ</italic> <bold>main cloud.</bold> (<bold>A</bold>) Cumulative distribution of the minimum divergence of each read from the reference sequences across all loci used in the left panel. Different colors represent samples taken from different temperatures from Mushroom Spring. Solid lines show minimum divergence from all three references and dashed lines from <italic>α</italic> and <italic>β</italic> only. Shaded olive region shows the typical divergences between species shown in the right panel. (<bold>B</bold>) Histogram of pairwise divergences between three representative SAGs for <italic>α</italic>, <italic>β</italic>, and <italic>γ</italic> at the 100 core loci chosen for illustration. Distributions are across all 150 bp segments from each locus. Shaded olive region the middle 95% percentile for the combined distribution.</p></caption>
<graphic xlink:href="543983v1_figs9.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>To further verify that no other <italic>Synechococcus</italic> species were present in our samples we closely examined the diversity of 16S sequences. We used only single reads in our analysis instead of trying to assemble full sequences to prevent misinference caused by hybridization. Because the diversity along the 16S sequence is highly heterogeneous, variation between read recruitment locations can dominate the variation between species. We controlled for this by limiting the analysis to reads that aligned within a given regions of the 16S. For 150 bp reads, we found that using segment sizes of 200 bp provided best compromise between increasing depth and minimizing variance due to alignment location. To find the most informative region, we calculated the nucleotide diversity at each site and averaged it over all 200 bp segments along the 16S (<xref ref-type="fig" rid="figs10">Fig. S10A</xref>). We found the diversity varied by more than a factor of four consistent with the presence of conserved and variable regions. The diversity was nearly identical when using all three species as reference genomes, suggesting our recruitment captured all sequences within the main cloud. The highest average diversity was close to 400-600 bp segment which we chose for further analysis.</p>
<p>We calculated the distribution of divergences from the <italic>γ</italic> allele for all reads recruited from this segment for MS temperature series. We found temperatures of 60 <italic><sup>◦</sup></italic>C and below had two distinct peaks close to 4% and 8% divergences. For comparison, we calculated the range of divergences from <italic>α</italic> and <italic>β</italic> for all 150 bp subsegments within the 400 <italic>−</italic> 600 bp segment and found these matched with the two peaks we observed. At 65 <italic><sup>◦</sup></italic>C we also found only two peaks, one close to zero and another close to 4%, consistent with our previous estimates showing that this sample mainly consisted of <italic>α</italic> and <italic>γ</italic> cells.</p>
<fig id="figs10" position="float" orientation="portrait" fig-type="figure">
<label>Figure S10:</label>
<caption><p>Diversity of <italic>Synechococcus</italic> 16S rRNA sequences from Mushroom Spring temperature series samples is entirely contained within the <italic>α</italic>-<italic>β</italic>-<italic>γ</italic> main cloud. (<bold>A</bold>) Average diversity <italic>H</italic> of metagenome reads from all 34 samples mapping to <italic>Synechococcus</italic> along the length of the 16S sequence. Averaging was done over all sites within a 200 bp window starting at the location given by the x-axis. Results for reads recruited using each of the three main species as a reference sequence are shown in different colors. Black dashed line indicates the 400 <italic>−</italic> 600 bp segment with the highest diversity which was chosen for subsequent analysis. (<bold>B</bold>) Distribution of nucleotide divergences from the <italic>γ</italic> allele within the 400 <italic>−</italic> 600 bp segment of the 16S for four different samples taken from Mushroom Spring. Shaded regions show the range of divergences of OS-A (orange) and OS-B’ (blue) from <italic>γ</italic> across all 51 windows of 150 bp length, corresponding to the range of expected divergences of reads from <italic>α</italic> and <italic>β</italic>.</p></caption>
<graphic xlink:href="543983v1_figs10.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>Do peaks correspond to single-species clusters or are they amalgamation of several distinct species with similar divergences from each other? To answer this question we constructed a multiple-sequence alignment of all of the 16S reads recruited across the 34 metagenome samples and performed a hierarchical clustering on the pairwise divergence matrix using average linkage. Pairwise divergences were calculated by padding the reads with gaps to ensure all sequences were 200 bp in length and calculating the nucleotide divergence ignoring any gaps. For the MS temperature series, we found 97% of reads were in one of the three clusters associated with <italic>α</italic>, <italic>β</italic>, or <italic>γ</italic> (<xref ref-type="fig" rid="figs11">Fig. S11A-D</xref>). Consisten with our previous results, samples below 65 <italic><sup>◦</sup></italic>C had two main clusters close to OS-A and OS-B’ (<xref ref-type="fig" rid="figs11">Fig. S11A-C</xref>), while at 65 <italic><sup>◦</sup></italic>C they were close to <italic>γ</italic> and OS-A (<xref ref-type="fig" rid="figs1">Fig. S11D</xref>). Aggregating across all 34 metagenome samples, we found that <italic>α</italic> and <italic>β</italic> were the two dominant clusters, with <italic>γ</italic> being the next largest (<xref ref-type="fig" rid="figs1">Fig. S11EF</xref>). We also observed a large difference in the overall abundances of <italic>α</italic> and <italic>β</italic> across the two springs, but the very large heterogeneity across samples we found previously (<xref ref-type="fig" rid="figs8">Fig. S8</xref>) suggests this is likely due to the particular samples used in this study and may not necessarily be an accurate reflection of the overall abundances in the two springs.</p>
<fig id="figs11" position="float" orientation="portrait" fig-type="figure">
<label>Figure S11:</label>
<caption><title>All <italic>Synechococcus</italic> 16S rRNA sequences from the metagenome samples belong to one of the three known species clusters.</title>
<p>(<bold>A</bold>-<bold>D</bold>) Each subpanel shows the matrix of pairwise divergences between all reads recruited to the 400 <italic>−</italic> 600 bp segment of the <italic>γ</italic> 16S rRNA sequence for the four samples from the MS temperature series. Dashed lines highlight the OS-A, OS-B’, and <italic>γ</italic> reference sequences in this segment for comparison. (<bold>E</bold>, <bold>F</bold>) Same as above using a subsample of reads recruited from all 34 metagenome samples divided by spring.</p></caption>
<graphic xlink:href="543983v1_figs11.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
</sec>
</sec>
<sec id="s1f">
<label>IV.</label><title>Linkage analysis</title>
<p>In this section we summarize our analysis of linkage disequilibrium within <italic>α</italic> and <italic>β</italic>. The structure of this section is as follows. We begin by reviewing definitions of two commonly-used ways to quantify linkage disequilibrium. We then compare the rate of decay of linkage disequilibrium within and between the two species. We next compare the decrease in linkage in the data to theoretical predictions from the neutral model and show that while the decay is similar to the neutral model prediction, the overall shape of the linkage decay curves cannot be fully explained by the classical neutral model. We then show that within <italic>α</italic> there is substantial heterogeneity in the rate of linkage decay in low-diversity regions compared to high-diversity ones. Surprisingly, we find that linkage decreases more rapidly in low-divergence regions, suggesting the absence of a clonal frame for <italic>α</italic> even on short time scales. The final subsection presents a technical validation of our method for processing alignments showing that our results are robust to filtering for outlier gene alleles.</p>
<sec id="s1f1">
<label>IV.1</label><title>Statistical measures of linkage disequilibrium</title>
<p>We used two distinct but related methods for quantifying linkage disequilibrium, <italic>σ</italic><sub><italic>d</italic></sub><sup>2</sup> and <italic>r</italic><sup>2</sup>. Both metrics are related to the correlation coefficient between alleles at two loci, but differ in their normalization. For a single pair of loci A and B with alleles A/a and B/b, we can define the correlation coefficient between their respective frequencies as
<disp-formula id="eqn1">
<alternatives><graphic xlink:href="543983v1_eqn1.gif" mimetype="image" mime-subtype="gif"/></alternatives>
</disp-formula></p>
<p>Using this expression, we can define a statistical measure of linkage as a function of distance along the genome by averaging over pairs of loci with with a given separation <italic>x</italic> = <italic>x<sub>A</sub> x<sub>B</sub></italic>, where <italic>x<sub>A</sub></italic> and <italic>x<sub>B</sub></italic> are the positions of the two loci along the genome. The two most common ways to perform the average are
<disp-formula id="eqn2">
<alternatives><graphic xlink:href="543983v1_eqn2.gif" mimetype="image" mime-subtype="gif"/></alternatives>
</disp-formula>
and
<disp-formula id="eqn3">
<alternatives><graphic xlink:href="543983v1_eqn3.gif" mimetype="image" mime-subtype="gif"/></alternatives>
</disp-formula></p>
<p>For a neutral panmitic and well-mixed population both metrics decrease as <italic>σ</italic><sub><italic>d</italic></sub><sup>2</sup>(<italic>x</italic>) <italic>∼ r</italic><sup>2</sup>(<italic>x</italic>) <italic>∼</italic> 1<italic>/x</italic>. For <italic>σ</italic><sub><italic>d</italic></sub><sup>2</sup>, there also exists an analytic expression (<italic><xref ref-type="bibr" rid="sc29">29</xref></italic>)):
<disp-formula id="eqn4">
<alternatives><graphic xlink:href="543983v1_eqn4.gif" mimetype="image" mime-subtype="gif"/></alternatives>
</disp-formula>
where <italic>N</italic> is the population size, and <italic>R</italic> the recombination rate per base pair per generation. When recombination is rare and occurs via crossover <italic>R</italic>(<italic>x</italic>) <italic>R</italic><sub>0</sub><italic>x</italic>, and the expression is consistent with the scaling <italic>σ</italic><sub><italic>d</italic></sub><sup>2</sup>(<italic>x</italic>) 1<italic>/x</italic> mentioned previously. While numerical and theoretical studies have shown that <italic>r<sub>ij</sub></italic><sup>2</sup> is more sensitive to low-frequency alleles compared to <italic>σ</italic><sub><italic>d</italic></sub><sup>2</sup> (<italic><xref ref-type="bibr" rid="c30">30</xref></italic>, <italic><xref ref-type="bibr" rid="c31">31</xref></italic>), our analysis did not reveal significant differences between two metrics. We therefore focus here on <italic>σ</italic><sub><italic>d</italic></sub><sup>2</sup> which is more commonly used and easier to compare to theoretical predictions. Figures illustrating the analogous results for <italic>r<sub>ij</sub></italic><sup>2</sup> can be found at the end of this section.</p>
<p>We calculated <italic>σ</italic><sub><italic>d</italic></sub><sup>2</sup>(<italic>x</italic>) and <italic>r</italic><sup>2</sup>(<italic>x</italic>) for <italic>α</italic> and <italic>β</italic> separately and together. Both procedures are similar so we focus on the analysis for all <italic>α</italic> and <italic>β</italic> sequences. Unless otherwise stated, all analyses were performed on alignments of individual genes and the results were averaged across genes. Using this method, we can easily obtain linkage information over distances of up to around 1 kbp. Over longer distances the results can be dominated by specific recombination events in small number of unusually long genes and are therefore less useful for quantifying genome-wide statistical patterns. We thus perform most of our analysis up to distances of around 1 kbp, except when caculating typical genome-wide linkage as discussed below.</p>
<p>Alignments for each orthogroup were first trimmed to remove segments with excess numbers of gaps. We then determined a consensus sequence by taking the most common codon sequence at each location along the reading frame, excluding gaps. Each nucleotide was the labeled 0 if it was a gap, 1 if it was the same as the consensus, and 2 if it was different from the consensus. While does not distinguish between biallelic and multi-allelic sites, the later are much more less common that the former and should not affect our conclusions. Finally, we calculated the two linkage coefficients using Eqs. S2 and Eqs. S3. To estimate linkage across distances longer than a single gene, we performed the average across SNPs spanning a pair of genes and then averaged the values across a random sample of 1000 pairs of genes.</p>
<p>The linkage calculations within each species were performed in an analogous way, with the exception of a two-step filtering process of the alignments at the beginning. We describe this procedure in detail at the end of this section.</p>
</sec>
<sec id="s1f2">
<label>IV.2</label><title>Linkage decrease within vs between species</title>
<fig id="figs12" position="float" orientation="portrait" fig-type="figure">
<label>Figure S12:</label>
<caption><title>Genetic linkage analysis shows extensive recombination within</title>
<p><italic>α</italic> <bold>and</bold> <italic>β</italic>. (<bold>A</bold>) Linkage disequilibrium <italic>σ</italic><sub><italic>d</italic></sub><sup>2</sup> as a function of separation between SNPs <italic>x</italic> averaged across all core genes among the <italic>α</italic> (orange circles), <italic>β</italic> (blue squares), or all of the cells (black diamonds). Genome-wide estimates from SNPs in different genes are shown to the right of the black dashed line using the same symbols. Fully unlinked controls for the genome-wide linkage are shown as horizontal lines of different colors. The main cloud cutoff for both <italic>α</italic> and <italic>β</italic> was set to <italic>c</italic> = 0.05. (<bold>B</bold>) Scatter plot of 16S and genome-wide divergences between all pairs of cells within the same species. Solid line shows a linear regression from which the Pearson correlation coefficient, <italic>R</italic>, within each species was calculated.</p></caption>
<graphic xlink:href="543983v1_figs12.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>Our analysis showed that within both <italic>α</italic> and <italic>β</italic>, linkage quickly decreased by approximately an order of magnitude over a distance of 1 kbp (orange circles and blue squares in <xref ref-type="fig" rid="figs12">Fig. S12A</xref>). However, when considering the population as a whole, we find linkage disequilibrium is maintained across the whole length of the genome (black diamonds in <xref ref-type="fig" rid="figs12">Fig. S12A</xref>). Within <italic>β</italic>, the linkage at distances of 1 kbp was identical to the genomewide linkage between random pairs of genes. Within <italic>α</italic>, the decrease was slower, but followed a similar pattern. The value of the genome-wide linkage was slightly higher than at 1 kbp, likely because of the reduced sample size at long genomic distances caused by poor genome coverage. Consistent with this, we found that the genomewide-linkage values in both species were close to completely unlinked controls obtained by randomly permuting each column of the alignments (<italic>σ</italic><sub><italic>d</italic></sub><sup>2</sup> = 0.14 vs <italic>σ</italic><sub><italic>d</italic></sub><sup>2</sup> = 0.12 in <italic>α</italic> and <italic>σ</italic><sub><italic>d</italic></sub><sup>2</sup> = 0.06 vs <italic>σ</italic><sub><italic>d</italic></sub><sup>2</sup> = 0.04 in <italic>β</italic>). Overall, these results suggest that the dynamics leading to the reassortment of alleles are similar in the two species and only differ in the length scale over which alleles become unlinked. We discuss this in more detail in the next section.</p>
<p>The fact that both species have similar levels of genomewide linkage despite the sample size of <italic>α</italic> being less than half of that of <italic>β</italic> shows that our estimates for the genomewide linkage are not significantly affected by the sample size effect. We further validated this by taking random samples from <italic>β</italic> main cloud equal to the size of the <italic>α</italic> main cloud at each locus and recalculating the linkage curves. We found the results for the full <italic>β</italic> main cloud and the subsampled main cloud were almost identical (<xref ref-type="fig" rid="figs13">Fig. S13</xref>). This shows that the sample size does not have a large effect on our results and cannot explain the differences in linkage decay between the two species.</p>
<fig id="figs13" position="float" orientation="portrait" fig-type="figure">
<label>Figure S13:</label>
<caption><title>Samples size has small effect on linkage estimates.</title>
<p>Linkage disequilibria curves for the whole <italic>α</italic> and <italic>β</italic> populations shown in S12 are compared to a random subsample of <italic>β</italic> sequences chosen to match the <italic>α</italic> sample size at each locus (shown in gray).</p></caption>
<graphic xlink:href="543983v1_figs13.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>The rapid decrease in linkage sets important limits on how much information about the diversity in the population is contained in samples of marker genes. To illustrate this, we performed a linear regression between the whole-genome divergences and the 16S rRNA divergence. Consistent with our previous analysis, we found slightly stronger linkage in <italic>α</italic> compared to <italic>β</italic>, but in both cases the correlations were weak and the 16S divergences explained less than 10% of the genome-wide divergences (<xref ref-type="fig" rid="figs12">Fig. S12B</xref>). These results show that frequent recombination in the population makes marker genes, such as the 16S rRNA, poor predictors of the genome-wide diversity.</p>
<fig id="figs14" position="float" orientation="portrait" fig-type="figure">
<label>Figure S14:</label>
<caption><title>Linkage decay curves for</title>
<p><italic>α</italic> <bold>and</bold> <italic>β</italic> <bold>are collapse on to the same curve after rescaling distances by average recombination rate</bold> <italic>ρ</italic>. (<bold>A</bold>) Shows same data as <xref ref-type="fig" rid="figs12">Fig. S12A</xref> for <italic>α</italic> and <italic>β</italic> together with the fit usings Eq. (S5). (<bold>B</bold>) Shows the linkage decay as a function of distances between sites rescaled by the recombination rates <italic>ρ</italic> fitted from (A). The solid black line shows the theoretical prediction from the neutral model given by Eq. S4.</p></caption>
<graphic xlink:href="543983v1_figs14.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
</sec>
<sec id="s1f3">
<label>IV.3</label><title>Comparison to theoretical predictions</title>
<p>To get a more quantitative understanding of the effects of recombination on the genetic diversity in our population we compared our previous results to theoretical predictions from population genetics. At short distances, the prediction from Eq. S4 is that <italic>σ</italic><sub><italic>d</italic></sub><sup>2</sup> = 5<italic>/</italic>11. However, in our data the value of <italic>σ</italic><sub><italic>d</italic></sub><sup>2</sup> for nearby sites was very close to one. While the Yellostone Synechococcus have a strong mutational bias towards GC nucleotides (<xref ref-type="bibr" rid="c12"><italic>12</italic></xref>), Eq. S4 is independent of the relative rates of mutations. As a result we conclude that the neutral model cannot explain the linkage curves we observe.</p>
<p>While the overall level of <italic>σ</italic><sub><italic>d</italic></sub><sup>2</sup> in our data is inconsistent with the neutral prediction, we can still ask whether the rate of decay with distance has a similar functional form. To do this we followed Ref. (<italic><xref ref-type="bibr" rid="sc32">32</xref></italic>) and fit the linkage curves to the following functional form:
<disp-formula id="eqn5">
<alternatives><graphic xlink:href="543983v1_eqn5.gif" mimetype="image" mime-subtype="gif"/></alternatives>
</disp-formula>
where <italic>ρ</italic> = 2<italic>NR</italic> is the population recombination rate. We performed the fit by choosing <italic>A</italic> such that the above expression matched the value of <italic>σ</italic><sub><italic>d</italic></sub><sup>2</sup> in the data for neighboring sites (<italic>x</italic> = 1). We then fitted the curves by eye by adjusting the value of <italic>ρ</italic>.</p>
<p>We found that this functional form could fit the data very well for both species up to distances of <italic>x</italic> 300 bp. For longer distances the linkage decrease was slightly slower than predicted by (S5). One possible interpretation of this slowdown is that longer distances have a signficant overlap with the distribution of lengths of recombined segments <italic>L<sub>r</sub></italic>, beyond which we expect linkage to reach the genomewide level (<italic><xref ref-type="bibr" rid="sc32">32</xref></italic>). This suggests that recombined segments as short as 300 bp might play an important role in recombination process within the population.</p>
<p>We further validated that the linkage curves have the same functional form by rescaling distances between sites by the recombination rate <italic>ρ</italic> inferred previously. We found a very good collapse of the linkage curves for the two species when plotted against the rescaled distances <xref ref-type="fig" rid="figs14">Fig. S14B</xref>. This strongly implies that the dynamics leading to the decay of linkage are the same in both species, with the differences between them being length scale over which sites are effectively linked.</p>
</sec>
<sec id="s1f4">
<label>IV.4</label><title>Lack of clonal frame in α</title>
<p>The lack of clonal structure implied by the rapid decrease in linkage found in our previous analysis is in line with recent studies showing recombination is more prevalent in bacteria than is traditionally thought (<italic><xref ref-type="bibr" rid="sc33">33</xref>, <xref ref-type="bibr" rid="sc34">34</xref></italic>). Nevertheless, because bacterial recombination occurs through the exchange of short segments, it is generally believed that in closely-related bacteria, corresponding to short times since their common ancestor, most of the diversity is the result of accumulation of mutations on a clonal backbone rather than reassortment of existing variants through recombination (<italic><xref ref-type="bibr" rid="sc34">34</xref></italic>). Several studies have found mostly clonal structure for divergences up to 5 10<italic><sup>−</sup></italic><sup>3</sup> 10<italic><sup>−</sup></italic><sup>2</sup>, with recombination playing an increasingly larger role for later times. Most of these studies have focused on human-associated bacteria, which can undergo very strong bottlenecks during transmission that may not be as common in environmental bacteria such as the Yellowstone Synechococcus. We therefore decided to take advantage of the genome heterogeneity within <italic>α</italic> to test the clonal frame hypothesis.</p>
<p>According to the clonal frame hypothesis, the low-diversity regions of the <italic>α</italic> genome analyzed in Sec. <bold>??</bold> would be the result of an earlier clonal expansion within <italic>α</italic>, with large divergence segments representing recombination with outside strains. We would therefore expect that in the low-divergence regions linkage should not decay. To test this hypothesis we averaged over the linkage curves over the low-diversity and high-diversity segments from Sec. <bold>??</bold> separately and compared their decay rates. Surprisingly, we found the opposite pattern—rather than staying constant, linkage in the low-diversity regions of <italic>α</italic> decreased more rapidly than high-divergence ones (<xref ref-type="fig" rid="figs15">Fig. S15</xref>). Moreover, within the low-divergence region there was a sudden downward shift in linkage by close to an order of magnitude at distances close around 100 300 bp. To verify that the linkage decrease on longer distances is not due to a small number of unsual genes, we also calculated the genomewide linkage within both the low and high diversity regions as before. We found the linkage was slightly higher within the high diversity regions (<italic>(σ<sub>d</sub></italic><sup>2</sup><italic>)</italic> = 0.15 compared to <italic>(σ<sub>d</sub></italic><sup>2</sup><italic>)</italic> = 0.11 in the low diversity regions), but both values were similar to the unlinked controls (<italic>(σ<sub>d</sub></italic><sup>2</sup><italic>)<sub>c</sub></italic> = 0.14 in the high diversity regions and <italic>(σ<sub>d</sub></italic><sup>2</sup><italic>)<sub>c</sub></italic> = 0.09 in the low diversity regions).</p>
<p>The rapid decrease in linkage in regions of low diversity is in striking contrast to studies on human-associated bacteria and suggest that even on the much shorter time scales implied by the <italic>α</italic> low diversity backbone (see Sec. VII), recombination is the dominant evolutionary force shaping the genetic diversity of Synechococcus. To quantify the relative contributions of recombination and mutations to the diversity within <italic>α</italic>, we used the parameters inferred from fitting our data to a panmitic neutral model with recombination. The relatively poor statistics from the low-diversity regions of the <italic>α</italic> genome prevent us from obtaining the population recombination rate <italic>ρ</italic> directly from linkage decay curves. However, the comparison between the low and high diversity regions from <xref ref-type="fig" rid="figs15">Fig. S15</xref> shows that the rate of linkage decay in the low diversity regions is at least comparable to the genome-wide estimate of <italic>ρ</italic> 0.03 we inferred from <xref ref-type="fig" rid="figs14">Fig. S14</xref>. We therefore used this value as an estimate for the rate of recombination breakpoints. The contribution from mutations is given by the typical number of mutations that have accumulated since the common ancestor <italic>θ<sub>S</sub></italic> = 2<italic>Nµ<sub>S</sub></italic>, which in the neutral model is equal to the nucleotide diversity. Using the synonymous diversity inferred in VII, we have <italic>θ<sub>S</sub> ≈</italic> 2 <italic>·</italic> 10<italic><sup>−</sup></italic><sup>3</sup>. This gives a ratio of <italic>ρ/θ<sub>S</sub> ≈</italic> 15.</p>
<p>If we apply a similar analysis to the <italic>β</italic> genomes we find <italic>ρ/θ<sub>S</sub></italic> 3. The discrepancy in <italic>ρ/θ</italic> between the two species is at first sight surprising given that <italic>α</italic> and <italic>β</italic> are closely-related species with similar physiologies that have inhabited the same environment for a long time. Several factors could contribute to this discrepancy, among them a decrease in the rate of recombination over evolutionary time, epistatic interactions that could suppress recombination rates at short distances, or an overestimation of the mutation rates due to a large contribution of the diversity coming from hybridization. The later would be roughly consistent with our estimates for the fraction of the diversity witin <italic>β</italic> contributed by hybridization (Sec. VI).</p>
<fig id="figs15" position="float" orientation="portrait" fig-type="figure">
<label>Figure S15:</label>
<caption><p>Hybridized and non-hybridized segments of the <italic>α</italic> genome have similar rates of linkage decrease. The decay of the linkage disequilibrium <italic>σ</italic><sub><italic>d</italic></sub><sup>2</sup> averaged over <italic>α</italic> loci that have undergone hybridization (orange circles) and loci that have not undergone hybridization (red crosses) is compared. Hybridized and non-hybridized loci were determined based on a 5% cutoff in the fraction of synonymous polymorphic sites within <italic>α</italic> (see Sec. VII).</p></caption>
<graphic xlink:href="543983v1_figs15.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
</sec>
<sec id="s1f5">
<label>IV.5</label><title>Linkage on intermediate length scales</title>
<p>Our analysis so far was limited to either distances up to the length of typical genes (1 kbp) or across the entire genome. Extending our analysis over distances in between these two extremes is difficult due to several technical challenges. The first is the fact that typical coverages for our SAGs is around 30%. Together with the a typical contig size of 10 kbp, this means that our sample size quickly decreases with distance. The second challenge is that at longer distances gene order might vary across genomes making it difficult to define a genomic distance at the population level.</p>
</sec>
<sec id="s1f6">
<label>IV.6</label><title>Linkage between multi-SNP alleles</title>
<p>We calculated the linkage disequilibrium between multi-SNP features, such as SNP blocks or hybrid alleles, using (SI) as in the case of biallelic SNPs. In the case of SNP blocks shown in <xref rid="fig3" ref-type="fig">Fig. 3E</xref> in the main text, we calculate the frequencies for the four haplotypes within SAGs that are covered at both loci. The unlinked controls (represented by solid lines in <xref rid="fig3" ref-type="fig">Fig. 3E</xref>) were obtained by a random permutation of the alleles at each locus independently, while keeping the SAGs that are covered at each locus fixed. This procedure preserves any correlations in genome coverage between nearby loci and provides the most accurate estimate of <italic>r<sub>AB</sub></italic><sup>2</sup> for a completely unlinked genome.</p>
<p>The linkage between hybrid gene alleles were calculated similarly as for the SNP blocks, except for the genotype assignment. At each locus, we labeled the most abundant allele using upper case letters (<italic>A</italic>, <italic>B</italic>, …) and grouped all of the remaining ones into a single allele labeled by a lower case letter (<italic>a</italic>, <italic>b</italic>, …). The linkage matrix <italic>r<sub>AB</sub></italic><sup>2</sup> and the unlinked control were calculated the same as previously described. The results for <italic>α</italic> were (<italic>r</italic><sup>2</sup><sub><italic>AB</italic></sub>) = 0.04 <italic>±</italic> 0.15 compared to <italic>(r</italic><sup>2</sup><sub><italic>AB</italic></sub>) = 0.02 <italic>±</italic> 0.11 for the unlinked control. For <italic>β</italic> the results were <italic>(r</italic><sup>2</sup><sub><italic>AB</italic></sub>) = 0.01 ± 0.09 compared to <italic>(r</italic><sup>2</sup><sub><italic>AB</italic></sub>) = 0.009 ± 0.08 for the unlinked control. Note that the average linkage disequilibrium was close to the unlinked controls in both species, with α having slightly higher linkage. These agree with those from the analysis of SNP blocks shown in the main text.</p>
</sec>
<sec id="s1f7">
<label>IV.7</label><title>Determining the main cloud cutoff for α and β</title>
<p>For each species, we first selected all of the sequences that belonged to SAGs assigned to that species (see Sec. II). We then calculated the consensus sequence for this group of sequences, as described above, and removed all sequences with divergences greater that a main cloud cutoff <italic>c</italic>. This is a simple way to remove sequences that are the result of gene-level hybridization (see Sec. V and (<italic><xref ref-type="bibr" rid="sc33">33</xref></italic>) for a similar procedure). We chose the main cloud cutoff for each species by calculating the linkage curves for different values and choosing the largest value for which the curves did not noticeably change (<xref ref-type="fig" rid="figs16">Fig. S16</xref>). Based on this criterion, we use <italic>c</italic> = 0.05 for <italic>α</italic> and <italic>c</italic> = 0.1 for <italic>β</italic> throughout.</p>
<fig id="figs16" position="float" orientation="portrait" fig-type="figure">
<label>Figure S16:</label>
<caption><p>The effect of the main cloud diameter <italic>c</italic> on the rate of linkage decay. The linkage decay within <italic>α</italic> (left panel) and <italic>β</italic> (right panel) is plotted for different main cloud cutoffs <italic>c</italic> (see main text). Note the convergence of the curves for <italic>c ≤</italic> 0.05.</p></caption>
<graphic xlink:href="543983v1_figs16.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
</sec>
</sec>
<sec id="s1g">
<label>V.</label><title>Gene-level hybridization</title>
<p>This section describes the method we used to quantify hybridization at the gene level. Our method is based on hierarchical clustering of sequences based on their pairwise distances. Using the method described in Sec. I.2, we determined which loci contained distinct clusters at the divergences we expect between species (15% at the nucleotide level, as shown in <xref ref-type="fig" rid="figs1">Fig. 1A</xref> and Sec. II). We then assigned labels to these clusters based on the composition of species to which the sequences belonged to. Finally, we searched for discrepancies between the gene and whole-genome labels, representing transfers of wholegene alleles from other species.</p>
<sec id="s1g1">
<label>V.1</label><title>Simple hybrid genes</title>
<p>We first assigned labels to the species-level clusters constructed as described in Sec. I.2. Based on the gene triplet results presented in Sec. II, we expect most sequences to be contained in two main clusters, close to OS-A and OS-B’, respectively, with at least one sequence forming a separate cluster whenever the orthogroup was covered in the <italic>γ</italic> SAG. Based on this expectation, we considered all of the clusters from each orthogroup in decreasing order of their sizes.</p>
<p>If we assume the clusters at the genome level are replicated at the gene level, we expect up to three clusters within each orthogroup, with sequences within each clusters mostly belonging to a single species. To distinguish between this and the case where rapid hybridization breaks down species clusters at the gene level we use an arbitrary threshold <italic>S</italic> = 0.9 for the fraction of sequences within a cluster belonging to the majority species. If the fraction of sequences in the largest cluster belonging to either <italic>α</italic> or <italic>β</italic> is less than <italic>S</italic>, we label the cluster M for <italic>mixed-species</italic>. Otherwise, we label the cluster A or B if the fraction of sequences from <italic>α</italic> or <italic>β</italic> genomes, respectively, is higher than <italic>S</italic>. We continue this process until both A and B labels are assigned. As a result, the labels A and B are assigned to the largest clusters that contain fractions greater than <italic>S</italic> of sequences from <italic>α</italic> and <italic>β</italic>, respectively, if these exist. If more than one A or B cluster is encountered before the other cluster is assigned, they are labeled sequentially as AI, A2, A3, etc. In cases where there are clusters still unlabeled after this process, the remaining clusters are labeled as C if they contain a sequence from the <italic>γ</italic> SAG or as X for unknown otherwise.</p>
<p>We next determined which orthogroups are part of the core genome. We defined a gene as a core gene if it is likely present in all of the genomes in our sample. The average coverage for each SAG in our sample was approximately 30% so it is not possible to directly determine whether some genes are always present. Instead, we use a statistical measure of the coverage to assign orthogroups to the core genome. Specifically, we used the rank-coverage plot across all orthogroups and SAGs (equivalent to the complementary cumulative distribution) to determine an appropriate cutoff for the core genome. The rank-coverage plot showed three distinct regions. First there were around a dozen orthogroups that had unsually high abundances, with the number of sequences in some cases being greater than the number of SAGs in our sample. These are likely multiple-copy genes and IS elements and were excluded from further analysis. Then there was a large plateau comprising over 1, 000 orthogroups with coverages in the range 100 150, followed by a sharp decrease (on a logarithmic scale) in the coverage. We found that setting a coverage threshold for the presence at 20% of the number of SAGs from each species approximately matched the shoulder between the plateau and the sharp decrease and so we used this as a criterion for assigning core genes.</p>
<p>The final step in our algorithm is to catalog hybridization events, which we do by simply searching for gene sequences whose labels were different from the whole-genome species assignment. Analysis of these results showed a large number of transfers, mainly from <italic>β</italic> into <italic>α</italic>, which came from contigs that did not contain any genes labeled as the host species. One explanation for the presence of such contigs is that they represents larger genomic segments flanked by repetitive regions (such as IS elements) that are transferred and integrated into the host genome. Long repetitive genomic segments can lead to contig breaks during assembly, which would explain the complete absence of genes belonging to the host cluster. Alternatively, such contigs could be the result of contamination with external DNA. However, the contamination hypothesis does not explain why there seem to be more transfers from <italic>β</italic> into <italic>α</italic> than vice versa. We also did not find any evidence of differences in the number of such transfers between the sample containing only <italic>α</italic> SAGs (OS2005, see Sec. IX) and samples containing mixtures of <italic>α</italic> and <italic>β</italic>. While this evidence suggests these transfers are very likely the result of hybridization, we cannot rule out the possibility of contamination. We therefore excluded all hybridization events on contigs that did not contain any genes labeled as the host genome from the analysis. The results of our analysis are summarized in <xref ref-type="fig" rid="figs2">Fig. 2AB</xref> in the main text.</p>
<fig id="figs17" position="float" orientation="portrait" fig-type="figure">
<label>Figure S17:</label>
<caption><title>Majority of orthogroups contain hybrid sequences.</title>
<p>Orthogroups were classified into four mutually exclusive groups depending on the amount of hybridization observed. The majority of mixed-species orthogroups are mosaic hybrids (see main text) and shown in orange. Orthogroups in which the local sequence clusters matched the whole genome ones were labeled as “no hybrids and shown in blue, those in which a single cell contained a sequence from a different cluster were labeled “singleton hybrids” and shown in green, and those in which multiple cells contained sequences from different clusters were labeled “non-singleton hybrids” and shown in red.</p></caption>
<graphic xlink:href="543983v1_figs17.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
</sec>
<sec id="s1g2">
<label>V.2</label><title>Diversity within hybrid genes</title>
<p>We quantified the diversity within simple hybrid genes as follows. For each non-singleton hybrid locus found in the previous step, we calculated the synonymous nucleotide diversity <italic>π<sub>S</sub></italic> among the hybrid sequences only, as described in VII (<xref ref-type="fig" rid="figs18">Fig. S18</xref>). We used two controls for comparison: the diversity within the donor population for <italic>α − β</italic> transfers, and the core genome diversity within the host population.</p>
<p>For transfers between <italic>α</italic> and <italic>β</italic> from either donor, we calculated the synonymous diversity in the donor species for each hybrid locus. If the hybrid gene alleles are the result of multiple independent hybridization events, we would expect the diversity among the hybrid sequences to be similar to that of the donor population. Such events would be analogous to soft sweeps (<italic><xref ref-type="bibr" rid="sc35">35</xref></italic>). Otherwise, if the hybrid sequence was only introduced once into the host population and then subsequently spread through recombination, we would expect much less diversity among the hybrid sequences compared to the donor population. We observed both types of transfers in our data. For transfers into <italic>α</italic>, approximately half of loci (17 out of 44) had identical hybrid sequences indicating a single introduction and subsequent spread through recombination. In the remaining cases, the typical diversity among the hybrid gene alleles was much higher than <italic>π<sub>S</sub></italic> 2 10<italic><sup>−</sup></italic><sup>3</sup> in the core <italic>α</italic> genome (see Sec. VII), suggesting that it is the result of multiple introductions from the donor population. For transfers from <italic>β</italic> into <italic>α</italic> specifically, 4 out of the 5 loci had diversity levels in <italic>α</italic> comparable to those of <italic>β</italic>, indicating that preferential transfer of specific variants was not an important factor in the hybridization process (<xref ref-type="fig" rid="figs18">Fig. S18</xref>, left panel). Similar conclusions can be drawn from the analysis of hybrids transfered into <italic>β</italic>, but there there were relatively fewer loci with no diversity (5 out of 18), while the loci consistent with multiple introductions had diversity comparable to the <italic>β</italic> core genome.</p>
<fig id="figs18" position="float" orientation="portrait" fig-type="figure">
<label>Figure S18:</label>
<caption><title>Simple hybrid genes have bimodal distribution of diversity across loci.</title>
<p>Diversity among hybrid sequences at simple hybrid loci. Each circle shows one of the non-singleton loci from <xref ref-type="fig" rid="fig2">Fig. 2AB</xref> within the <italic>α</italic> (left) and <italic>β</italic> (right) cells. The colors represent the different donor species, as labeled on the x-axis. For transfers between <italic>α</italic> and <italic>β</italic> the diversity within the donor group is shown as squares of the same color as a control. Sequences from the same locus are connected by a black line. The horizontal lines show the nucleotide diversity within the low diversity genomic regions of <italic>α</italic> (left panel, in orange) and the core genome of <italic>β</italic> (right panel, in blue), respectively.</p></caption>
<graphic xlink:href="543983v1_figs18.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>We performed a similar analysis for genes within diversity troughs (<xref ref-type="fig" rid="figs19">Fig. S19</xref>). Recall that diversity troughs were defined as regions where the synonymous divergence between <italic>α</italic> and <italic>β</italic> was much lower than typical (Fig. <xref rid="fig2" ref-type="fig">Fig. 2C</xref>). We found that despite the large decrease in divergence, these loci still contained considerable diversity, indicating they were either the result of soft sweeps or gene sweeps that had occurred sufficient time in the past for the present levels of the diversity to accumulate. To distinguish between these scenarios, we compared the diversity in each species at the diversity troughs to a random sample of core genes from the host species. Within <italic>β</italic>, we found that the two distributions were nearly identical (<xref ref-type="fig" rid="figs19">Fig. S19</xref> right), indicating that the trough diversity within <italic>β</italic> is typical of the core genome. Within <italic>α</italic>, however, we found that core genes were on average around a factor 20 less diverse than the diversity troughs. This strongly suggest that the diversity troughs genes, including the nitrogen fixation pathway <italic>nif</italic>, were acquired by <italic>α</italic> from other species within the caldera after colonization. The levels of diversity within the trough genes are consistent with multiple independent transfers from <italic>β</italic>, but multiple independent transfers from other species into both <italic>α</italic> and <italic>β</italic> could also contribute.</p>
<fig id="figs19" position="float" orientation="portrait" fig-type="figure">
<label>Figure S19:</label>
<caption><title>Typical diversity within diversity troughs is similar to</title>
<p><italic>β</italic> <bold>and much higher than the non-hybrid regions from</bold> <italic>α</italic>. (Left panel) The distribution of synonymous nucleotide diversity within <italic>α</italic> across all diversity trough genes is shown in purple. The distribution across a random sample of non-hybridized <italic>α</italic> genes of the same size is shown in orange for comparison. Non-hybridized <italic>α</italic> genes were determined using a 5% cutoff in the fraction of polymorphic synonymous sites (see Sec. VII). (Right panel) The distributio of synonymous nucleotide diversity with <italic>β</italic> core genes across all diversity trough genes is shown in purple. Here, the control distribution shown in blue is from a random sample of core <italic>β</italic> genes.</p></caption>
<graphic xlink:href="543983v1_figs19.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
</sec>
</sec>
<sec id="s1h">
<label>VI.</label>
<title>Linkage block detection and analysis</title>
<p>In this section we describe the method we used to discover SNP blocks and the statistical analyses we performed.</p>
<sec id="s1h1">
<label>VI.1</label><title>Processing alignments for SNP block detection</title>
<p>In order to identify linkage blocks originating from hybridization the raw alignments from the pangenome construction were processed as follows. We divided core OGs into distinct species clusters, as explained in Secs. I.2 and V, and removed any sequences from SAGs assigned to a different species than the cluster. This was done to avoid false positive blocks due to the presence of recently transferred whole-gene alleles from different species. For OGs with mixed-species mosaic clusters, all sequences in the cluster were initially included. Alignments were then trimmed and codons that contained a high frequency of gaps were removed. Finally, we defined a main cloud of sequences for <italic>α</italic> and <italic>β</italic> comprising sequences within a divergence diameter <italic>d<sub>M</sub></italic> = 0.1 from the consensus for each species and removed all sequences outside it.</p>
</sec>
<sec id="s1h2">
<label>VI.2</label><title>SNP block detection method</title>
<p>We used a linkage-based approach to search for evidence of hybridization within genes. Visual inspection of the alignments in the highly-diverse <italic>α</italic> genes and in most <italic>β</italic> genes revealed segments with high SNP density grouped into two haplotypes in strong linkage disequilibrium. We hypothesized that these SNP blocks were the result of intragenic hybridization and we developed an algorithm to systematically identify them.</p>
<p>The algorithm can be summarized by the following steps.
<list list-type="order">
<list-item><p>Read orthogroup alignment</p></list-item>
<list-item><p>Pre-process alignment</p>
<list list-type="alpha-lower">
<list-item><p>Trim alignment edges and remove columns with high fraction of gap codons</p></list-item>
<list-item><p>For each species, infer consensus sequence and remove sequences outside a predetermined diameter around the consensus</p></list-item>
<list-item><p>Replace all SNPs with absolute frequencies <italic>n &lt; n<sub>c</sub></italic> = 4 with the consensus for their respective columns</p></list-item></list></list-item>
<list-item><p>For each species <italic>s</italic>, subsample sequences from cells assigned to <italic>s</italic></p></list-item>
<list-item><p>Calculate the linkage matrix <italic>r<sub>ij</sub></italic><sup>2</sup> for all pairs of SNPs</p></list-item>
<list-item><p>Identify groups of consecutive SNPs with <italic>r<sub>ij</sub></italic><sup>2</sup> = 1, up to a rounding error of <italic>E</italic> = 10<italic><sup>−</sup></italic><sup>5</sup>, containing at least <italic>l<sub>min</sub></italic> = 5 SNPs</p></list-item></list></p>
<p>The inclusion of step 2c accounts for the possibility of more recent low-frequency SNPs emerging after the the initial hybridization took place. Note that typical alignments depths are 30 for <italic>α</italic> and 70 for <italic>β</italic>, and are considerably larger than <italic>n<sub>c</sub></italic>.</p>
<p>We applied the above algorithm to the alignments of all of the core genes and obtained a total of I,442 blocks within <italic>α</italic> and 2,153 blocks within <italic>β</italic>. Most blocks were short, but those in <italic>α</italic> were on average more than twice as long as those in <italic>β</italic> (<italic>(L)</italic> = 62 in <italic>α</italic> vs <italic>(L)</italic> = 29 in <italic>β</italic>; <xref ref-type="fig" rid="figs20">Fig. S20A</xref>). Similarly, <italic>α</italic> blocks contained more SNPs on average compared to <italic>β</italic>, although here the difference was less pronounced (<italic>(l)</italic> = 10.6 in <italic>α</italic> vs <italic>(l)</italic> = 7.8 in <italic>β</italic>; <xref ref-type="fig" rid="figs20">Fig. S20B</xref>).</p>
<fig id="figs20" position="float" orientation="portrait" fig-type="figure">
<label>Figure S20:</label>
<caption><title>Typical blocks are short and contain a handful of SNPs.</title>
<p>(<bold>A</bold>) The distribution of lengths of SNP blocks within <italic>α</italic> (orange) and <italic>β</italic> (blue) genomes, detected using the algorithm described in this section. (<bold>B</bold>) The distribution of the number of SNPs within the same blocks as in (A).</p></caption>
<graphic xlink:href="543983v1_figs20.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>To identify hybrid haplotypes, we first determined the consensus sequences for the two block haplotypes, together with the other two species within the block segment. We then labeled any haplotypes whose sequence was identical to one of the other two species as a hybrid segment with the corresponding species as the donor. These result are shown in <xref ref-type="table" rid="tbls2">Table S2</xref>.</p>
<table-wrap id="tbls2" orientation="portrait" position="float">
<label>Table S2:</label><caption><p>Number of SNP blocks within <italic>α</italic> and <italic>β</italic> containing haplotypes that mapped to different donor species.</p></caption>
<graphic xlink:href="543983v1_tbls2.tif" mimetype="image" mime-subtype="tiff"/>
</table-wrap>
<p>To control for other processes that could potentially produce similar patterns of linkage disequilibrium we compared the distributions of divergences between haplotypes and block lengths for cases where a hybrid haplotype could be identified directly to cases we could not. No obvious difference in the distributions could be seen between the two cases, consistent with our interpretation that the blocks without matches to other species in our sample are also the result of hybridization.</p>
</sec>
<sec id="s1h3">
<label>VI.3</label><title>Haplotype divergences</title>
<p>We further verified that the divergences between block haplotypes were consistent with what we would expect from hybridization. We calculated the fraction of nonsynonymous and synonymous nucleotide substitutions, <italic>p<sub>N</sub></italic> and <italic>p<sub>S</sub></italic>, respectively, between the consensus sequences of each haplotype (see Sec. VII).</p>
<fig id="figs21" position="float" orientation="portrait" fig-type="figure">
<label>Figure S21:</label>
<caption><title>Examples of blocks and hybrid sequences within ribosomal genes.</title>
<p>(<bold>A</bold>) Alignment of 16S sequences with a <italic>β</italic> cell containing a hybrid segment starting at around position 340 and ending around position 580 in the alignment. (<bold>B</bold>) Alignment of the SSU ribosomal protein rpsN with <italic>α</italic> cells ordered at the top and <italic>β</italic> cells at the bottom of the alignment. The first <italic>β</italic> cell was chosen as the reference sequence and is shown in color. (<bold>C</bold>) Segment of alignment of <italic>β</italic> sequences at the LSU ribosomal protein rplM. The reference sequence was chosen to illustrate short SNP block in the center of the alignment.</p></caption>
<graphic xlink:href="543983v1_figs21.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>We then removed blocks with either <italic>p<sub>N</sub></italic> or <italic>p<sub>S</sub></italic> were above a threshold of 0.6. This was done to avoid large errors in estimating the divergence, which we calculated using the Jukes-Cantor correction <italic>d</italic> = (3<italic>/</italic>4) ln(1 4<italic>p/</italic>3) (<italic><xref ref-type="bibr" rid="sc36">36</xref></italic>). The overall number of such blocks was small (46 out of 1442 in <italic>α</italic> and 143 out of 2008 in <italic>β</italic>) so their removal does not affect our conclusions about the typical blocks. We found that the distributions of both the nonsynonymous and synonymous divergences were similar to those previously reported from comparisons of OS-A and OS-B’ (<xref ref-type="bibr" rid="c12"><italic>12</italic></xref>), and consistent with our hybridization hypothesis (<xref ref-type="fig" rid="figs22">Fig. S22</xref>).</p>
<fig id="figs22" position="float" orientation="portrait" fig-type="figure">
<label>Figure S22:</label>
<caption><title>Block haplotypes have high synonymous and non-synonymous divergences, consistent with them being generated through hybridization.</title>
<p>Panels show histograms of nonsynonymous (blue) and synonymous (orange) divergences between the two haplotypes of SNP blocks from <italic>α</italic> (<bold>A</bold>) and <italic>β</italic> (<bold>B</bold>), respectively.</p></caption>
<graphic xlink:href="543983v1_figs22.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
</sec>
</sec>
<sec id="s1i">
<label>VII.</label>
<title>Genetic diversity analysis</title>
<p>In this section we present our analysis of the genetic diversity within individual genes in <italic>α</italic> and <italic>β</italic>. In the first subsection we define the different metrics we used and present the variations in diversity along the genome of both species. In the second subsection we show that a majority pf genes within <italic>α</italic> appear to have not undergone hybridization. By developing a method to differentiate between such genes and the rest we obtain an estimate for the time since the most common ancestor for <italic>α</italic> that is around an order of magnitude less than the naive estimate based on the average genomewide diversity. Finally, we compare the diversity pattern in <italic>α</italic> with <italic>β</italic> and discuss their implications.</p>
<sec id="s1i1">
<label>VII.1</label><title>Nucleotide diversity along the core genome</title>
<p>We quantified the nucleotide diversity across all genes in both <italic>α</italic> and <italic>β</italic> using the following procedure. Alignments were trimmed for excess gaps and sequences were assigned to each species as described in Sec. II. We then define the nucleotide diversity in the usual way as
<disp-formula id="eqn6">
<alternatives><graphic xlink:href="543983v1_eqn6.gif" mimetype="image" mime-subtype="gif"/></alternatives>
</disp-formula>
where <italic>I</italic> is an index for sequences in the alignment, <italic>I</italic> is the sample size, and <italic>π<sub>ij</sub></italic> is the fraction of nucleotide substitutions between <italic>i</italic> and <italic>j</italic>, excluding gaps. To calculate synonymous (<italic>π<sub>S</sub></italic>) and non-synonymous diversities (<italic>π<sub>N</sub></italic>) we replace <italic>π<sub>ij</sub></italic> with the fraction of synonymous (<italic>π<sup>S</sup><sub>ij</sub></italic>) and non-synonymous substitutions (<italic>π<sup>N</sup></italic>), respectively. We calculated <italic>π<sup>S</sup><sub>ij</sub></italic> and <italic>π<sup>N</sup><sub>ij</sub></italic> using two different methods: the fraction of four-fold degenerate (4D) and one-fold degenerate (ID) sites, respectively, at which <italic>i</italic> and <italic>j</italic> differ and using the Nei-Gojobori method (<italic><xref ref-type="bibr" rid="sc37">37</xref></italic>). We found that both methods gave similar results and used the one that was most convenient for each analysis.</p>
<p>To calculate the divergence between species, we first determined the proportion of sites that were substituted as follows:
<disp-formula id="eqn7">
<alternatives><graphic xlink:href="543983v1_eqn7.gif" mimetype="image" mime-subtype="gif"/></alternatives>
</disp-formula>
where <italic>I<sub>α</sub></italic> and <italic>I<sub>β</sub></italic> are the indices of sequences from <italic>α</italic> and <italic>β</italic> in the alignment and <italic>I<sub>α</sub></italic> and <italic>I<sub>β</sub></italic> are number of sequences from each species, respectively. The fraction of pairwise substitutions <italic>π<sub>ij</sub></italic> is the same as above. We then use the Jukes-Cantor correction (<italic><xref ref-type="bibr" rid="sc36">36</xref></italic>) to correct for the effect of multiple substitutions at a single site
<disp-formula id="eqn8">
<alternatives><graphic xlink:href="543983v1_eqn8.gif" mimetype="image" mime-subtype="gif"/></alternatives>
</disp-formula></p>
<p>The synonymous (<italic>d<sub>S</sub></italic>) and non-synonymous divergences (<italic>d<sub>N</sub></italic>) were calculated in a similar way by replacing <italic>π<sub>ij</sub></italic> with <italic>π<sup>S</sup><sub>ij</sub></italic> and <italic>π<sup>N</sup><sub>ij</sub></italic> in (S7), respectively.</p>
<p>Finally, to calculate the diversity within each species separately we take the sum in (S6) over <italic>I<sub>α</sub></italic> or <italic>I<sub>β</sub></italic> only.</p>
<p>We calculated the nucleotide diversity across the core genes in <italic>α</italic> and <italic>β</italic> and compared the variation in each along the genome (<xref ref-type="fig" rid="figs23">Fig. S23</xref>). Within <italic>α</italic> we found <italic>π</italic> varied wildly by more than an order of magnitude over short distances of a few tens of kbp (dark orange line in <xref ref-type="fig" rid="figs23">Fig. S23</xref>). By constrast, the diversity within <italic>β</italic> was much more homogenous and fluctuations were rarely larger than around a factor of two (dark blue line <xref ref-type="fig" rid="figs23">Fig. S23</xref>). However, within both species we found that the diversity between individual pairs of genomes was highly variable, with may pairs of genomes frequently being nearly identical at certain loci, but having otherwise typical divergences genomewide (light orange and blue lines in <xref ref-type="fig" rid="figs23">Fig. S23</xref>). This is consistent with our conclusion from the main text that genomewide linkage in both species is very weak (see also Sec. IV).</p>
<fig id="figs23" position="float" orientation="portrait" fig-type="figure">
<label>Figure S23:</label>
<caption><p><italic>α</italic> <bold>and</bold> <italic>β</italic> <bold>show distinct patterns of within-species diversity.</bold> The two panels show the nucleotide diversity <italic>π</italic> within <italic>α</italic> (top) and <italic>β</italic> (bottom) at all core genes ordered according to their respective reference genomes. The solid line shows the value of <italic>π</italic> estimated from all sequences, with values calculated from a subsample of 10 randomly chosen sequences shown in lighter colors. Both lines were smoothed by averaging over a sliding window of 5 genes with a step size of 2 genes.</p></caption>
<graphic xlink:href="543983v1_figs23.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
</sec>
<sec id="s1i2">
<label>VII.2</label><title>Diversity heterogeneity along core genome</title>
<p>There are two plausible explanations for the heterogeneity within <italic>α</italic> found in S23. The low diversity genes could be due to local sweeps similar to the ones that formed the diversity troughs shown in <xref rid="fig2" ref-type="fig">Fig. 2</xref> in the main text. Under this scenario, the high diversity genes would represent the typical diversity within <italic>α</italic> that has accumulated since its common ancestor and would be comparable to that of <italic>β</italic>. Alternatively, the low diversity genes could represent the typical diversity within <italic>α</italic>, with the high diversity genes being the result of hybridization with other species.</p>
<p>To distinguish between these two possibilities we developed a method to separate low diversity from high diversity genes within <italic>α</italic>. Specifically we calculated the fraction <italic>f<sub>l</sub><sup>S</sup></italic> = <italic>P<sup>S</sup>/L<sup>S</sup></italic> of 4D sites at locus <italic>l</italic> that were polymorphic within the <italic>α</italic> alignment. Here <italic>P<sub>l</sub><sup>S</sup></italic> is the number of synonymous polymorphisms and <italic>L<sub>l</sub><sup>S</sup></italic> the number synonymous sites at that gene. By using 4D sites we naturally control for differences in gene conservation. If mutation rates across loci do not vary too much, we expect the distribution of <italic>f<sub>l</sub><sup>S</sup></italic> across genes to be given by a Poisson distribution. The mean of this Poisson distribution can be fitted from the fraction of sites that are not polymorphic
<disp-formula id="eqn9">
<alternatives><graphic xlink:href="543983v1_eqn9.gif" mimetype="image" mime-subtype="gif"/></alternatives>
</disp-formula>
from which we get the following estimate for the mean:
<disp-formula id="eqn10">
<alternatives><graphic xlink:href="543983v1_eqn10.gif" mimetype="image" mime-subtype="gif"/></alternatives>
</disp-formula></p>
<p>When we compared this prediction to the data for <italic>α</italic> we found that the Poisson distribution gave an excellent fit for <italic>f<sub>l</sub><sup>S</sup></italic>,:S 0.05 (902 core orthogroups), but there was a minority of loci (654 core orthogroups) with <italic>f<sub>l</sub><sup>S</sup></italic> much larger than predicted from the Poisson (<xref ref-type="fig" rid="figs24">Fig. S24</xref>, left panel). Note that the agreement in the inset of <xref ref-type="fig" rid="figs24">Fig. S24</xref> (left panel) is based on a single fitting parameter. Based on these results we chose a threshold of <italic>f<sub>l</sub><sup>S</sup></italic> 0.05 to define the low diversity genes, with all other genes labeled as high diversity. To validate our partition, calculate the synonymous diversity <italic>π<sub>S</sub></italic> within each group. We found that our criterion produced a clear separation in the synonymous diversity, with low diversity genes having a mean <italic>π<sub>S</sub> ≈</italic> 1.7 <italic>×</italic> 10<italic><sup>−</sup></italic><sup>3</sup>, compared to <italic>π<sub>S</sub> ≈</italic> 3.4 <italic>×</italic> 10<italic><sup>−</sup></italic><sup>2</sup> for the high diversity genes.</p>
<fig id="figs24" position="float" orientation="portrait" fig-type="figure">
<label>Figure S24:</label>
<caption><title>Core genome diversity within</title>
<p><italic>α</italic> <bold>has bimodal distribution.</bold> (Left) Distribution of the fraction of polymorphic four-fold degenerate (4D) sites for each gene (blue histogram) is shown together with Poisson fit based on the number of genes without any polymorphic (black line and dots). Inset shows zoomed in region of low-diversity genes (<italic>&lt;</italic> 5% polymorphic 4D sites) together with the fit for clarity. (Right) Shows histogram of synonymous nucleotide diversity <italic>π<sub>S</sub></italic>for both low-diversity (blue) and high-diversity (orange) genes. Genes without polymorphic 4D sites were arbitrarily assigned a value <italic>π<sub>S</sub></italic>= 10<italic><sup>−</sup></italic><sup>5</sup> for illustration purposes.</p></caption>
<graphic xlink:href="543983v1_figs24.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<fig id="figs25" position="float" orientation="portrait" fig-type="figure">
<label>Figure S25:</label>
<caption><title>Core genome diversity within</title>
<p><italic>β</italic> <bold>is relatively homogeneous.</bold> (Left) Shows distribution of the fractions of polymorphic 4D sites for each gene (blue histogram) together with a Poisson fit based on the mean across all genes. (Right) Shows histogram of synonymous nucleotide diversity <italic>π<sub>S</sub></italic>. Genes without polymorphic 4D sites were arbitrarily assigned a value <italic>π<sub>S</sub></italic> = 10<italic><sup>−</sup></italic><sup>5</sup> for illustration purposes.</p></caption>
<graphic xlink:href="543983v1_figs25.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>Within the genes classified as low diversity were many essential genes, such as genes from the ribosomal protein cluster. In addition manual inspection of the alignments of high diversity genes revealed that most were either due to gene allele transfers (<xref rid="fig2" ref-type="fig">Fig. 2</xref>) or long linkage blocks that were identical to the <italic>β</italic> or <italic>γ</italic> sequences (<xref ref-type="bibr" rid="sc3">3</xref>). The simplest explanation for this pattern is then that the low diversity genes represent a genomic backbone shared by <italic>α</italic> cells from their common ancestor<sup>3</sup>, while the high diversity genes are the result of hybridization with the other species. This result shows that molecular clock estimate of the time since the most common ancestor based on <italic>T<sub>MRCA</sub></italic> = <italic>π<sub>S</sub>/</italic>(2<italic>µτ</italic>), where <italic>µ</italic> is the mutation rate per division and <italic>τ</italic> the generation time, should be interpreted with caution. In the case of <italic>α</italic> the estimate using the average <italic>π<sub>S</sub></italic> across the whole genome would be around an order of magnitude less than the true value, even without considering how mutation rates might change over such long time scales.</p>
<p>We performed a similar analysis for <italic>β</italic> but did not find any large peak near <italic>f<sub>l</sub><sup>S</sup></italic> = 0 (<xref ref-type="fig" rid="figs25">Fig. S25</xref>). Instead the distribution of <italic>f<sub>l</sub><sup>S</sup></italic> was close to unimodal but with significantly fatter tails compared to the Poisson. Given the excellent fit to the Poisson for <italic>α</italic> in the region where SNPs are purely due to mutations, this suggests that other mechanisms plat an important role in generating the diversity within <italic>β</italic>. The most parsimonious explanation is that the hybridization process we observed in <italic>α</italic> has covered most of the original <italic>β</italic> genome by this point, leading to a non-Poisson distribution of <italic>f<sub>l</sub><sup>S</sup></italic> similar to the high diversity regions of <italic>α</italic>. Further evidence in favour of this hypothesis is the presence of SNP blocks across a large fraction of <italic>β</italic> core genes, as discussed in the main text and VI.</p>
</sec>
<sec id="s1i3">
<label>VII.3</label><title>Contribution of hybridization to genetic diversity</title>
<p>The large number of SNP block found throughout the genomes of both <italic>α</italic> and <italic>β</italic> show that hybridization is an important source of genetic diversity for the <italic>Synechococcus</italic> population. However, because of the requirement for perfect linkage within SNP blocks, the total number of SNPs that are the result of hybridization is likely much higher than the one we infer from our algorithm. To obtain quantitative estimates of the total contribution from hybridization to the diversity we again use the <italic>α</italic> as a control. As shown previously, only 5% of the total diversity in the high-diversity loci from <italic>α</italic> can be attributed to mutations. These loci contained 603, 588 sites and 64, 462 SNPs, of which 10, 391 SNPs were found inside SNP blocks. Thus only around 17% of the SNPs that are likely the result of hybridization, or hybrid SNPs, are included in the SNP blocks.</p>
<p>Within the <italic>β</italic> core genome, we have 1, 591, 476 sites and 146, 906 SNPs, of which 14, 819 were within SNP blocks. Assuming a similar ratio of hybrid SNPs to SNPs in SNP blocks as in <italic>α</italic>, we estimate that around 90, 000 or approximately 60% of SNPs in <italic>β</italic> are the result of hybridization. This is consistent with <italic>β</italic> having evolved over longer time compared to <italic>α</italic>. However, our knowledge of how multi-locus SNP patterns change over the course of evolution is limited so the estimates for <italic>β</italic> should be interpreted with caution. In particular, if larger segments continue to be broken up due to recombination, it is likely that the fraction of hybrid SNPs within blocks would decrease over time for a constant minimum block size <italic>l<sub>min</sub></italic> (see Sec. VI). Thus the overall contribution of hybridization to the <italic>β</italic> genetic diversity may be even higher.</p>
</sec>
<sec id="s1i4">
<label>VII.4</label><title>Geological constraints on microbial evolution</title>
<p>Combining genetic diversity analysis with evidence from the geological record of the Yellowstone caldera allows us to make inferences about the evolutionary history of the Synechococcus population. If we assume that most of the fixed variants between species are the result of mutation accumulation, then we can use the typical synonymous divergence between species to infer the time since the most recent common ancestor for the whole population. Typical bacterial mutation rates for natural populations are around <italic>µ ∼</italic> 10<italic><sup>−</sup></italic><sup>9</sup>.<sup>5</sup> per bp per generation (<italic><xref ref-type="bibr" rid="sc38">38</xref></italic>). Using this rates as a baseline and assuming generation times of <italic>τ ∼</italic> 1 <italic>−</italic> 10 days gives an estimate of <italic>T<sub>MRCA</sub> ∼</italic> 10<sup>6</sup>.<sup>5</sup>–10<sup>7</sup>.<sup>5</sup> years (<xref ref-type="bibr" rid="c12"><italic>12</italic></xref>).</p>
<p>For our argument, the lower bound is the more important one since it determines whether we can exclude the single-colonizer hypothesis. A <italic>T<sub>MRCA</sub></italic> below 10<sup>6</sup>.<sup>5</sup> years would imply a shorter division time or higher mutation rate than our estimates. Our lower bound of one day for the division time is around the same as the fastest division rate observed in the laboratory. If the population is in steady state, as it appears to be, the division time sets the maximum generation time, which can be attained if the death rate is equally high. If the death rate is lower than this, other factors would limit cell division and the generation times would be longer. Taken together, we can be fairly confident that a generation time of one day is a hard lower bound.</p>
<p>The mutation rate is less certain since we do not have any reliable measurements and experimentally measured mutation rates might not be a good predictor of substitution rates over evolutionary times (<italic><xref ref-type="bibr" rid="sc39">39</xref></italic>)). We can instead use other bacteria to estimate a range of values. In wild-type E. coli, mutation rates of 2 10<italic><sup>−</sup></italic><sup>10</sup> per bp per generation have been measured in laboratory conditions (<italic><xref ref-type="bibr" rid="c40">40</xref></italic>), but mutator strains with rates that are up to 100 times higher are also known (<xref ref-type="bibr" rid="sc41"><italic>41</italic></xref>). In natural populations, rates as high as 4 10<italic><sup>−</sup></italic><sup>9</sup> have been inferred using longitudinal sequencing (<italic><xref ref-type="bibr" rid="sc42">42</xref></italic>). If we use 10<italic><sup>−</sup></italic><sup>8</sup>.<sup>5</sup> mutations per bp per generation as an upper bound, we would infer a lower bound of <italic>T<sub>MRCA</sub></italic> 10<sup>5</sup>.<sup>5</sup> years, which very narrowly overlap with the time since the foramtion of the Yellowstone caldera. Thus, while it is not inconceivable that the three species could have diverged within the caldera, such a scenario would requires all the relevant parameters to be at the limit of currently known values. In addition, such a scenario would require additional hypotheses to explain why the strains initially diverged into distinct species, with seemingly little genetic exchange between them (<xref ref-type="bibr" rid="c12"><italic>12</italic></xref>), and then only much later started to hybridize. Taken together, current evidence suggests the most likely scenario is that <italic>α</italic>, <italic>β</italic>, and <italic>γ</italic> diverged from a common ancestor before the formation of the caldera around 640 000 years ago.</p>
</sec>
<sec id="s1i5">
<label>VII.5</label><title>Upper bound on mixing time between springs</title>
<p>By using the diversity within <italic>α</italic> as a proxy for time, we can obtain estimates on the time scales of spatial mixing that influences the diversity within the population. To do this, we calculated the pairwise distances in the low diversity regions of the <italic>α</italic> genome between pairs of cells in each spring separately and pairs of cells from different springs. We found that the distribution all three distributions were similar (<xref ref-type="fig" rid="figs26">Fig. S26</xref>).</p>
<p>The mean of the distribution for cells Mushroom Spring was slightly lower than those from the Octopus spring (<italic>π<sub>S</sub></italic> = 8.6 10<italic><sup>−</sup></italic><sup>4</sup> vs <italic>π<sub>S</sub></italic> = 1.1 10<italic><sup>−</sup></italic><sup>3</sup>) and this difference could not be explained by difference in sample sizes between the two springs. However, both values were very close to the mean of cells from different springs (<italic>π<sub>S</sub></italic> = 1.0 10<italic><sup>−</sup></italic><sup>3</sup>). This suggests that the time scale of spatial processes relevant for the long-term evolution of the population, <italic>τ<sub>m</sub></italic>is much shorter time scales than <italic>T<sub>MRCA</sub></italic>for <italic>α</italic>. Taking <italic>T<sub>MRCA</sub>∼</italic> 3 <italic>·</italic> 10<sup>3</sup> years as a reference point sets an upper bound of <italic>τ<sub>m</sub>«</italic> 3 <italic>·</italic> 10<sup>3</sup> years.</p>
<fig id="figs26" position="float" orientation="portrait" fig-type="figure">
<label>Figure S26:</label>
<caption><title>Non-hybrid regions of</title>
<p><italic>α</italic> <bold>have similar levels of diversity within and between springs.</bold> The distribution of pairwise synonymous diversity was calculated across non-hybrid genes from the alpha <italic>α</italic> population for different subgroups of cells. Square symbols show the distributions for pairs of cells from the same spring (purple for Mushroom Spring and cyan for Octopus Spring). The cyano triangles show the distribution for a random subsample of cells from the Octopus Spring of the same size as the Mushroom Spring sample (<italic>n</italic> = 35) for comparison. The red diamonds show the distribution for pairs of cells from different springs. Non-hybrid genes were determined using a 5% cutoff in the fraction of polymorphic synonymous sites (see text).</p></caption>
<graphic xlink:href="543983v1_figs26.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
</sec>
<sec id="s1i6">
<label>VII.6</label><title>Proposed scenario for Synechococcus evolution</title>
<p>We propose the following scenario that is consistent with our previous discussion. First we argued that a small number (3-6, but possibly more) of Synechococcus populations that had been evolving separately for 10<sup>6</sup> 10<sup>7</sup> years independently colonized the Yellowstone caldera after its formation 640 000 years ago. After colonization, they started to hybridize leading to a gradual mixing of their genomes (<xref rid="fig4" ref-type="fig">Fig. 4A</xref>). This can be most clearly seen in the <italic>α</italic> species, where the diversity in core genes that do not show signs of hybridization is more than an order of magnitude less that those that do. Moreover, genes that have undergone hybridization account for the majority of diversity within <italic>α</italic>. Within <italic>β</italic> we do not observe such heterogeneity, but we find SNP blocks are even more prevalent than in <italic>α</italic> (<xref ref-type="table" rid="tbls2">Table S2</xref>). The simplest explanation for this pattern is that <italic>β</italic> has been undergoing hybridization for longer and by now all of its core genome has been mixed with other species. Consistent with this explanation, we find that only a small fraction of SNP blocks within <italic>β</italic> can be traced back to <italic>α</italic> (<xref ref-type="table" rid="tbls2">Table S2</xref>). Most of the <italic>β</italic> SNP blocks cannot be traced to either <italic>α</italic> or <italic>γ</italic> and are likely the result of a combination of hybridization with species that are not currently within the Lower Geyser Basin, have abundances lower than our detection threshold, or have gone extinct.</p>
</sec>
</sec>
<sec id="s1j">
<label>VIII.</label>
<title>Variation in hybridization across samples</title>
<p>In this section we describe how we quantified associations between genomic features and populations from different samples. Our primary focus was on differences in hybridization patterns so we analyzed the variations in hybrid gene and SNP block haplotype frequencies across different samples and locations. Given the small number of samples in our study, we limited the number of statistical tests we performed in order to avoid false positives. For each of the two main species, <italic>α</italic> and <italic>β</italic>, we tested for the effect of sample location and sample composition separately, as described below.</p>
<sec id="s1j1">
<label>VIII.1</label><title>Variation in SNP block haplotype frequencies</title>
<p>We considered two distinct hypotheses that could lead to associations between block haplotypes and environmental conditions from which the sample was taken. First, we considered if the community composition was associated with specific haplotypes by comparing samples in which a single species was present to samples which contained a mixture of <italic>α</italic> and <italic>β</italic>. For <italic>α</italic>, we chose the 48 cells from pure-<italic>α</italic> sample OS2005 as the test group and the 45 <italic>α</italic> cells from MS2004, MS2006, and OS2009 as the control. For <italic>β</italic>, we chose the 44 cells from the pure-<italic>β</italic> sample MS2005 as the test group and the 46 <italic>β</italic> cells from MS2004 and MS2006 as the control. We denote these two tests as “<italic>α</italic>-composition” and “<italic>β</italic>-composition” tests, respectively. Second, we considered the hypothesis that sample location was associated with specific haplotypes. For this test we divided all cells from each species into two groups labeled MS and OS, based on the location from which the sample was taken. These tests are denoted by “<italic>α</italic>-location” and “<italic>β</italic>-location”, respectively.</p>
<p>We used the following permutation test to find block haplotypes that were significantly associated with each environmental variable. We first removed all blocks in which the minority haplotype was below an arbitrary cutoff frequency, set at 5 sequences. This was done in order to avoid tests which were statistically underpowered. We then calculated the two-sided p-value for the association for each block individually using Fisher’s exact test.</p>
<table-wrap id="tbls3" orientation="portrait" position="float">
<label>Table S3:</label><caption><p>Result of tests for associations between SNP block haplotypes and two environmental variables related to the samples. The rows show the results of the different tests described in the main text. The p-value <italic>p</italic> for each block was determined using Fisher’s exact test and minimum p-value from the randomized control <italic>p<sup>min</sup><sub>rand</sub></italic> was used to correct for false-discovery rates (see main text for details). The first four columns show total number of blocks in each category. The last column shows the largest value of the <italic>p<sup>min</sup><sub>rand</sub> /p<sup>max</sup></italic> (most significant association) for each test.</p></caption>
<graphic xlink:href="543983v1_tbls3.tif" mimetype="image" mime-subtype="tiff"/>
</table-wrap>
<p>Because the sampling depth for each block is variable due to variations in coverage, standard methods that correct for the false-discovery rate are not well-suited in our case. We instead the following procedure to determine significant associations. We randomized the composition of the test and control cell groups for each test, while keeping the total number within each group fixed. We then recalculated the p-values using the same procedure as before and recorded the lowest p-value across all blocks <italic>p<sup>min</sup><sub>rand</sub></italic> . We used the ratio <italic>p<sup>min</sup> /p</italic> between the minimum p-value in the randomized control and the p-value in the test group as a measure of significance of the association. We arbitrarily set a threshold value of <italic>p<sup>min</sup><sub>rand</sub>/p<sub>t</sub></italic> = 10, above which associations were deemed highly significant. The results of these tests are summarized in <xref ref-type="table" rid="tbls3">Table S3</xref>.</p>
<p>Overall, we found very few blocks that were associated with either the sample composition or location. This is consistent with the results from the main text (3C), which showed that the block haplotypes are close to unlinked even on distances comparable to the whole genome. The largest number of associations was with the sample composition in the <italic>α</italic> species, consistent with the previously-mentioned results, which showed a small but statistically significant increase in linkage within the <italic>α</italic> species compared to the <italic>β</italic>. Nevertheless, the overall fraction of blocks whose haplotypes were strongly associated with the sample composition was 1.2% and still small. We therefore concluded that neither the composition of the population within samples or the location have a large effect on the hybridization patterns revealed by the SNP blocks. A complete table with the results of these tests can be found in the supplementary data tables.</p>
</sec>
<sec id="s1j2">
<label>VIII.2</label><title>Variation in hybrid gene transfers</title>
<p>We also examined variations in the rate of transfers of whole gene alleles across species. The lower overall number of such events compared to the SNP blocks make statistical tests for associations much more likely to yield false positives in this case. As a result, we limited the analysis to a qualitative comparison of the number of different types of transfers across samples shown in <xref ref-type="fig" rid="figs27">Fig. S27</xref>. We did not observe any systematic variations with either sample location or sample composition for either species.</p>
<fig id="figs27" position="float" orientation="portrait" fig-type="figure">
<label>Figure S27:</label>
<caption><title>Numbers and types of gene transfers between species are similar across samples.</title>
<p>The number of hybrid gene transfers from each donor found in <italic>α</italic> (<bold>A</bold>) and <italic>β</italic> (<bold>B</bold>) cells across all eight samples in the data. The labels <italic>A</italic>, <italic>B</italic>, and <italic>C</italic>, denote <italic>α</italic>, <italic>β</italic>, and <italic>γ</italic>, respectively, while <italic>X</italic> denotes other Synechococcucus clusters.</p></caption>
<graphic xlink:href="543983v1_figs27.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
</sec>
</sec>
<sec id="s1k">
<label>IX.</label>
<title>Data quality control</title>
<p>Beyond the processing steps outlined in Sec. I.2, we also explicitly verified that the hybridization patterns we observe cannot be explained by sequencing and genome assembly artifacts. Specifically, we tested if misassembly of reads from distinct alleles of the same gene could explain the presence of hybrid sequences. We considered two main sources of such reads: cross-contamination from neighboring reaction wells during whole-genome amplification (WGA) and the presence of paralogs horizontally transferred from other species.</p>
<p>Distinguishing between hybridization and artifacts is hard because both can lead to similar signals. Here, structure of data provides us natural controls. First, <italic>α</italic> has genes with low diversity and little sign of hybridization and high-diversity genes with extensive hybridization. We can use former to establish baseline for genome coverage and check for deviations in the later. If the hybridized genes are caused by misassemblies of actual between <italic>α</italic> genes and contamination from <italic>β</italic> or between different alleles of the same gene within <italic>α</italic> cells, we should see an increase in the coverage at these loci. Second, the variability in species composition across samples provides controls for cross-contamination between reaction wells. Specifically, OS2005 contained 48 cells, all classified as <italic>α</italic>, while MS2004, MS2006, and OS2009 together contained 45 <italic>α</italic> cells amplified on plates with mixtures of <italic>α</italic> and <italic>β</italic> cells in similar proportions (<xref ref-type="fig" rid="figs28">Fig. S28</xref>). We will refer to the former as the <italic>control SAGs sample</italic> and the later as the <italic>test SAGs sample</italic>. We used these two groups as a measure of the contribution of cross-contamination from neighboring <italic>β</italic> cells to the observed hybridization in <italic>α</italic>.</p>
<fig id="figs28" position="float" orientation="portrait" fig-type="figure">
<label>Figure S28:</label>
<caption><p><bold>Species composition is highly variable across samples.</bold></p></caption>
<graphic xlink:href="543983v1_figs28.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>We first divided the core <italic>α</italic> OGs into test and control groups as follows. We first divided OGs into low- and high-diversity groups based on the probability that synonymous sites are segregating in the sample using a cutoff at 0.05. From the low-diversity OGs, we chose the subset that were grouped into <italic>α</italic> and <italic>β</italic>, or <italic>α</italic>, <italic>β</italic>, and <italic>γ</italic> clusters during the pagenome construction (approximately 300 each out of a total of 800). These OGs were nearly clonal in the <italic>α</italic> sample and showed little no evidence of hybridization in our entire data. These OGs will form the <italic>control OG group</italic>. From the high-diversity OGs, we selected those where all sequences were grouped together in a single mixed-species cluster (300 out of a total of 600). These include the cases with the most extensive hybridization and thus formed the <italic>test OG group</italic>.</p>
<p>We validated that core gene coverage can be described by a random process in which each gene has a fixed probability <italic>p</italic> of being present in the assembly. We fitted the baseline probability <italic>p</italic> using the low-diversity genes from the OS2005 <italic>α</italic> cells. Many of these genes were clonal within the entire <italic>α</italic> sample and showed no evidence of hybridization with the other species in our sample. They thus provide a good baseline for the expected coverage in the absence of contamination. While the coverage among different SAGs was highly variable (<xref ref-type="fig" rid="figs29">Fig. S29A</xref>), we found that the distribution of coverages of different genes was well fitted by a Gaussian distribution with the mean and variance given by assuming each gene is an independent Bernoulli random variable with success probability <italic>p</italic> 0.29. We tested the independence assumption by calculating the covariance between the presence of different genes (<xref ref-type="fig" rid="figs29">Fig. S29C</xref>). Under our very simple model, any correlations between the coverage at different loci would be purely due to statistical fluctuations caused by finite sample sizes. The distribution of diagonal (<italic>C<sub>aa</sub></italic>) and off-diagonal (<italic>C<sub>ab</sub></italic>) components of the covariance matrix can then be calculated exactly given <italic>p</italic>. We compared the values obtained from the data with these predictions and found a very good agreement (<xref ref-type="fig" rid="figs29">Fig. S29D</xref>).</p>
<p>Having validated our gene presence model, we can now use it to perform simple but quite powerful test for different artifacts. Consider the extreme case where all of the hybrid genes we observe are the result of misassemblies of reads from two distinct alleles, one from <italic>α</italic> and one from either <italic>β</italic> or <italic>γ</italic>, from the same reaction well. Note that for this argument it is unimportant whether the alternative allele is due to contamination or genuine horizontal transfer that resulted in two distinct, unmixed copies of the gene. In either case, the probability of observing the gene in our assembly would be <italic>P<sub>obs</sub></italic>= <italic>p</italic>(2 <italic>p</italic>) 0.5, which is significantly higher than for a true single-copy gene. We tested for such an increase by comparing the distribution of coverages among <italic>α</italic> cells in the OS2005 sample of high-diversity genes that formed a single mixed cluster across all sequences in our data (see SI, Sec. I.2) and low-diversity genes with distinct <italic>α</italic> and <italic>β</italic> or <italic>α</italic>, <italic>β</italic>, and <italic>γ</italic> clusters. We found the two distributions were very similar to each other (<xref ref-type="fig" rid="figs30">Fig. S30A</xref>), with a small but statistically significant increase in the mean coverage at low-diversity genes with distinct species clusters (<italic>p<sub>control</sub></italic> 0.3 vs <italic>p<sub>test</sub></italic> 0.28). The difference is in the opposite direction from the one expected from the misassembly hypothesis, but it corresponds to less than an extra copy of a gene on average and is unlikely to have any consequence for our conclusions.</p>
<p>Note that the misassembly hypothesis above would also predict a specific pattern for the the sequences within <italic>α</italic>, with a large fraction 2(1 <italic>p</italic>)<italic>/</italic>(2 <italic>p</italic>) 0.83 having either the pure <italic>α</italic> or the pure <italic>β</italic> alleles, and <italic>p/</italic>(2 <italic>p</italic>) 0.17 containing a mixture. We do not find evidence of such patterns in our data. More importantly, the 0.17 fraction is an upper bound on the maximum frequency of mixtures that can be explained by through misassembly as any lower amounts of contamination would lead to fewer chimeric sequences. Note that both of the above tests take advantage of the fact that the typical genome coverage is low.</p>
<p>Using a similar method to the one described above we can also check for contributions from cross-contamination between reaction wells on the formation of chimeric sequences. Here, we compared the coverage distribution of mixed-species orthogroups in the mixed <italic>α β</italic> samples described previously with the control group from the all <italic>α</italic> sample OS2005. If cross contamination with <italic>β</italic> was a significant contributor to the presence of mixed-species orthogroups one would expect a large difference between the two distributions.</p>
<fig id="figs29" position="float" orientation="portrait" fig-type="figure">
<label>Figure S29:</label>
<caption><title>Genome coverage across core genes is well-explained by independent presence-absence model.</title><p><bold>(A)</bold> shows the presence-absence matrix <italic>P<sub>ia</sub></italic> of low-diversity OGs in the control SAG sample OS2005 (see main text for definitions). Rows and columns were ordered in decreasing order of the sums across the columns and rows, respec-tively. <bold><underline>(B)</underline></bold> shows the correlation matrix between OG presences defined as <italic>C<sub>ab</sub></italic> = <italic>N <sup>−</sup></italic><sup>1</sup> <sup>L</sup><italic><sup>N</sup> (</italic>(<italic>P<sub>ia</sub> − P<sub>i</sub></italic>)(<italic>P<sub>ib</sub> − P<sub>i</sub></italic>)<italic>)</italic>, where <italic>P<sub>i</sub></italic> = <italic>N <sup>−</sup></italic><sup>1</sup> <sup>L</sup><italic><sup>L</sup> P<sub>ia</sub></italic>. Note the use of the mean abundance for each SAG rather than <italic>p</italic> = (<italic>NL</italic>)<italic><sup>−</sup></italic><sup>1</sup> <sup>L</sup> <italic>i,a Pia</italic> to account for the large variability in coverage between SAGs. <bold>(C)</bold> shows the distribution of OG presences <italic>P<sub>a</sub></italic> = <italic>−</italic>1 <italic>N i</italic>=1 <italic>P<sub>ia</sub></italic>. The solid orange line shows the Gaussian fit under the assumption that each gene is a Bernoulli random variable with success probability <italic>p</italic>. <bold>(D)</bold> shows the distribution of the entries in the covariance matrix from (B) together with the predictions for the diagonal (orange) and off-diagonal (green) components under the assumption that each gene is independent and present in the final assembly with probability <italic>p</italic>. Note the value of <italic>p</italic> was obtained from panel (C) and there are no free parameters for the predicted curves.</p></caption>
<graphic xlink:href="543983v1_figs29.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>We did observe a large systematic difference between the two groups in the overall coverage <italic>p</italic> across all genes (data not shown), which was likely due to batch effects in the amplification and sequencing. We therefore compared the mean-centered distributions between the two groups and found no difference between them and the fit to the independent presence-absence model from before (<xref ref-type="fig" rid="figs30">Fig. S30B</xref>).</p>
<p>Beyond the indirect presence of hybridization given by the presence of mixed-species orthogroups, we also tested for any effect of cross-contamination on the presence of linkage blocks. We applied the same algorithm described in Sec. VI to the subsample of 48 <italic>α</italic> cells from OS2005 and compared the results with those from random samples of <italic>α</italic> cells from samples with mixtures of <italic>α</italic> and <italic>β</italic> cells. We found that the number of blocks detected in OS2005 was similar to the bootstrapped distribution from mixed <italic>α β</italic> samples (<xref ref-type="fig" rid="figs31">Fig. S31A</xref>). We also found the distribution of block lengths and divergences between block haplotypes to be similar as well (<xref ref-type="fig" rid="figs31">Fig. S31BC</xref>).</p>
<fig id="figs30" position="float" orientation="portrait" fig-type="figure">
<label>Figure S30:</label>
<caption><title>Variability in core gene presence is inconsistent with observed hybridization being dominated by artifacts.</title><p><bold>(A)</bold> compares the presence distributions among the control SAG sample of the test OG group (blue) with the control group (orange), as defined in the main text. <bold>(B)</bold> compares the presence distributions of the test OG group in the control (blue) and test (orange) SAG samples. The green line shows the fit from S29C. All distributions were centered at zero to control for batch effects (see main text).</p></caption>
<graphic xlink:href="543983v1_figs30.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<fig id="figs31" position="float" orientation="portrait" fig-type="figure">
<label>Figure S31:</label>
<caption><title>Linkage blocks are robust to large variations in species composition across samples. (A)</title>
<p>Boot-strapped distribution of the number of linkage blocks detected in alignments across 4-fold degenerate sites. The distribution was obtained by randomly choosing groups of 48 SAGs from samples containing mixtures of <italic>α</italic> and <italic>β</italic> SAGs (MS2004, MS2006, OS2006, OS2007, and OS2009). The arrow shows the number of blocks detected using the 48 SAGs from OS2005, which only contained <italic>α</italic> SAGs. Comparison of the distributions of block lengths (<bold>B</bold>) and divergence between the two haplotypes from each block (<bold>C</bold>) are shown in the other two panel. OS2005 (shown in blue) is compared to a randomly chosen sample from panel A (shown in orange).</p></caption>
<graphic xlink:href="543983v1_figs31.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>Based on the evidence presented above, we concluded that cross-contamination between reaction wells and genome assembly artifacts do not contribute significantly to the presence of mixed-species orthogroups or linkage blocks. While we cannot definitively exclude that some of the sequences we observe are the result of artifacts, the evidence above shows that they are rare enough to not have a significant effect on our main conclusions.</p>
</sec>
</sec>
<ref-list>
<title>References</title>
<ref id="sc1"><label>1.</label><mixed-citation publication-type="journal"><string-name><given-names>C.</given-names> <surname>Rinke</surname></string-name> <etal>et al.</etal>, <source>Nature Protocols</source> <volume>9</volume>, <fpage>1038</fpage>–<lpage>1048</lpage>, issn: 1750-2799 (May <year>2014</year>).</mixed-citation></ref>
<ref id="sc2"><label>2.</label><mixed-citation publication-type="journal"><string-name><given-names>R.</given-names> <surname>Stepanauskas</surname></string-name> <etal>et al.</etal>, <source>Nature Communications</source> <volume>8</volume>, <fpage>84</fpage>, issn: 2041-1723 (July <year>2017</year>).</mixed-citation></ref>
<ref id="sc3"><label>3.</label><mixed-citation publication-type="journal"><string-name><given-names>C.</given-names> <surname>Rinke</surname></string-name> <etal>et al.</etal>, <source>Nature</source> <volume>499</volume>, <fpage>431</fpage>–<lpage>437</lpage>, issn: 1476-4687 (July <year>2013</year>).</mixed-citation></ref>
<ref id="sc4"><label>4.</label><mixed-citation publication-type="journal"><string-name><given-names>E. V.</given-names> <surname>Kriventseva</surname></string-name>, <string-name><given-names>N.</given-names> <surname>Rahman</surname></string-name>, <string-name><given-names>O.</given-names> <surname>Espinosa</surname></string-name>, <string-name><given-names>E. M.</given-names> <surname>Zdobnov</surname></string-name>, <source>Nucleic Acids Research</source> <volume>36</volume>, <fpage>D271</fpage>–<lpage>D275</lpage>, issn: 0305-1048 (Oct. <year>2007</year>).</mixed-citation></ref>
<ref id="sc5"><label>5.</label><mixed-citation publication-type="journal"><string-name><given-names>D. M.</given-names> <surname>Emms</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Kelly</surname></string-name>, <source>Genome Biology</source> <volume>16</volume>, <issue>157</issue>, issn: 1474-760X (Aug. <year>2015</year>).</mixed-citation></ref>
<ref id="sc6"><label>6.</label><mixed-citation publication-type="journal"><string-name><given-names>W.</given-names> <surname>Ding</surname></string-name>, <string-name><given-names>F.</given-names> <surname>Baumdicker</surname></string-name>, <string-name><given-names>R. A.</given-names> <surname>Neher</surname></string-name>, <source>Nucleic Acids Research</source> <volume>46</volume>, <fpage>e5</fpage>–<lpage>e5</lpage>, issn: 0305-1048 (Jan. <year>2018</year>).</mixed-citation></ref>
<ref id="sc7"><label>7.</label><mixed-citation publication-type="journal"><string-name><given-names>A. J.</given-names> <surname>Page</surname></string-name> <etal>et al.</etal>, <source>Bioinformatics</source> <volume>31</volume>, <fpage>3691</fpage>–<lpage>3693</lpage>, issn: 1367-4803 (Nov. <year>2015</year>).</mixed-citation></ref>
<ref id="sc8"><label>8.</label><mixed-citation publication-type="journal"><string-name><given-names>A. J.</given-names> <surname>Enright</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Van Dongen</surname></string-name>, <string-name><given-names>C. A.</given-names> <surname>Ouzounis</surname></string-name>, <source>Nucleic Acids Research</source> <volume>30</volume>, <fpage>1575</fpage>–<lpage>1584</lpage>, issn: 0305-1048 (Apr. <year>2002</year>).</mixed-citation></ref>
<ref id="sc9"><label>9.</label><mixed-citation publication-type="journal"><string-name><given-names>T. R.</given-names> <surname>Gibbons</surname></string-name>, <string-name><given-names>S. M.</given-names> <surname>Mount</surname></string-name>, <string-name><given-names>E. D.</given-names> <surname>Cooper</surname></string-name>, <string-name><given-names>C. F.</given-names> <surname>Delwiche</surname></string-name>, <source>BMC bioinformatics</source> <volume>16</volume>, <fpage>1</fpage>–<lpage>14</lpage>, issn: 1471-2105 (<year>2015</year>).</mixed-citation></ref>
<ref id="sc10"><label>10.</label><mixed-citation publication-type="journal"><string-name><given-names>K.</given-names> <surname>Katoh</surname></string-name>, <string-name><given-names>D. M.</given-names> <surname>Standley</surname></string-name>, <source>Molecular Biology and Evolution</source> <volume>30</volume>, <fpage>772</fpage>–<lpage>780</lpage>, issn: 0737-4038 (Apr. <year>2013</year>).</mixed-citation></ref>
<ref id="sc11"><label>11.</label><mixed-citation publication-type="journal"><string-name><given-names>M. N.</given-names> <surname>Price</surname></string-name>, <string-name><given-names>P. S.</given-names> <surname>Dehal</surname></string-name>, <string-name><given-names>A. P.</given-names> <surname>Arkin</surname></string-name>, <source>PLOS ONE</source> <volume>5</volume>, <issue>e9490</issue> (Mar. <year>2010</year>).</mixed-citation></ref>
<ref id="sc12"><label>12.</label><mixed-citation publication-type="journal"><string-name><given-names>M. J.</given-names> <surname>Rosen</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Davison</surname></string-name>, <string-name><given-names>D. S.</given-names> <surname>Fisher</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Bhaya</surname></string-name>, <source>PLOS ONE</source> <volume>13</volume>, <fpage>e0205396</fpage> (Nov. <year>2018</year>).</mixed-citation></ref>
<ref id="sc13"><label>13.</label><mixed-citation publication-type="journal"><string-name><given-names>P.</given-names> <surname>Virtanen</surname></string-name>, <etal>et al.</etal>, <source>Nature Methods</source> <volume>17</volume>, <fpage>261</fpage>–<lpage>272</lpage>, issn: 1548-7105 (Mar. <year>2020</year>).</mixed-citation></ref>
<ref id="sc14"><label>14.</label><mixed-citation publication-type="journal"><string-name><given-names>C.</given-names> <surname>Jain</surname></string-name>, <string-name><given-names>L. M.</given-names> <surname>Rodriguez-R</surname></string-name>, <string-name><given-names>A. M.</given-names> <surname>Phillippy</surname></string-name>, <string-name><given-names>K. T.</given-names> <surname>Konstantinidis</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Aluru</surname></string-name>, <source>Nature Communications</source> <volume>9</volume>, 5114, issn: 2041-1723 (Nov. <year>2018</year>).</mixed-citation></ref>
<ref id="sc15"><label>15.</label><mixed-citation publication-type="journal"><string-name><given-names>F. M.</given-names> <surname>Cohan</surname></string-name>, <source>Annual Review of Microbiology</source> <volume>56</volume>, <fpage>457</fpage>–<lpage>487</lpage>, issn: 0066-4227 (Oct. <year>2002</year>).</mixed-citation></ref>
<ref id="sc16"><label>16.</label><mixed-citation publication-type="journal"><string-name><given-names>C.</given-names> <surname>Fraser</surname></string-name>, <string-name><given-names>E. J.</given-names> <surname>Alm</surname></string-name>, <string-name><given-names>M. F.</given-names> <surname>Polz</surname></string-name>, <string-name><given-names>B. G.</given-names> <surname>Spratt</surname></string-name>, <string-name><given-names>W. P.</given-names> <surname>Hanage</surname></string-name>, <source>Science</source> <volume>323</volume>, <fpage>741</fpage> (Feb. <year>2009</year>).</mixed-citation></ref>
<ref id="sc17"><label>17.</label><mixed-citation publication-type="journal"><string-name><given-names>P.</given-names> <surname>Yarza</surname></string-name> <etal>et al.</etal>, <source>Nature Reviews Microbiology</source> <volume>12</volume>, <fpage>635</fpage>–<lpage>645</lpage>, issn: 1740-1534 (Sept. <year>2014</year>).</mixed-citation></ref>
<ref id="sc18"><label>18.</label><mixed-citation publication-type="journal"><string-name><given-names>S. F.</given-names> <surname>Altschul</surname></string-name>, <string-name><given-names>W.</given-names> <surname>Gish</surname></string-name>, <string-name><given-names>W.</given-names> <surname>Miller</surname></string-name>, <string-name><given-names>E. W.</given-names> <surname>Myers</surname></string-name>, <string-name><given-names>D. J.</given-names> <surname>Lipman</surname></string-name>, <source>Journal of Molecular Biology</source> <volume>215</volume>, <fpage>403</fpage>–<lpage>410</lpage>, issn: 0022-2836 (Oct. <year>1990</year>).</mixed-citation></ref>
<ref id="sc19"><label>19.</label><mixed-citation publication-type="journal"><string-name><given-names>G. W.</given-names> <surname>Tyson</surname></string-name>, <etal>et al.</etal>, <source>Nature</source> <volume>428</volume>, <fpage>37</fpage>–<lpage>43</lpage>, issn: 1476-4687 (Mar. <year>2004</year>).</mixed-citation></ref>
<ref id="sc20"><label>20.</label><mixed-citation publication-type="journal"><string-name><given-names>I.</given-names> <surname>Lo</surname></string-name> <etal>et al.</etal>, <source>Nature</source> <volume>446</volume>, <fpage>537</fpage>–<lpage>541</lpage>, issn: 1476-4687 (Mar. <year>2007</year>).</mixed-citation></ref>
<ref id="sc21"><label>21.</label><mixed-citation publication-type="journal"><string-name><given-names>M.</given-names> <surname>Wu</surname></string-name>, <string-name><given-names>J. A.</given-names> <surname>Eisen</surname></string-name>, <source>Genome Biology</source> <volume>9</volume>, <fpage>R151</fpage>, issn: 1474-760X (Oct. <year>2008</year>).</mixed-citation></ref>
<ref id="sc22"><label>22.</label><mixed-citation publication-type="journal"><string-name><given-names>M.-Y.</given-names> <surname>Chen</surname></string-name> <etal>et al.</etal>, <source>The ISME Journal, issn</source>: <fpage>1751</fpage>–<lpage>7370</lpage> (Sept. <year>2020</year>).</mixed-citation></ref>
<ref id="sc23"><label>23.</label><mixed-citation publication-type="journal"><string-name><given-names>S.</given-names> <surname>Capella-Gutiérrez</surname></string-name>, <string-name><given-names>J. M.</given-names> <surname>Silla-Martínez</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Gabaldó n</surname></string-name>, <source>Bioinformatics</source> <volume>25</volume>, <fpage>1972</fpage>–<lpage>1973</lpage>, issn: 1367-4803 (Aug. <year>2009</year>).</mixed-citation></ref>
<ref id="sc24"><label>24.</label><mixed-citation publication-type="journal"><string-name><given-names>C.</given-names> <surname>Quast</surname></string-name> <etal>et al.</etal>, <source>Nucleic Acids Research</source> <volume>41</volume>, <fpage>D590</fpage>–<lpage>D596</lpage>, issn: 0305-1048 (Jan. <year>2013</year>).</mixed-citation></ref>
<ref id="sc25"><label>25.</label><mixed-citation publication-type="journal"><string-name><given-names>D. R.</given-names> <surname>Meyer-Dombard</surname></string-name> <etal>et al.</etal>, <source>Environmental Microbiology</source> <volume>13</volume>, <fpage>221</fpage>6–2231, issn: 1462-2912 (Aug. <year>2011</year>).</mixed-citation></ref>
<ref id="sc26"><label>26.</label><mixed-citation publication-type="journal"><string-name><given-names>B.</given-names> <surname>Langmead</surname></string-name>, <string-name><given-names>S. L.</given-names> <surname>Salzberg</surname></string-name>, <source>Nature Methods</source> <volume>9</volume>, <fpage>357</fpage>–<lpage>359</lpage>, issn: 1548-7105 (Apr. <year>2012</year>).</mixed-citation></ref>
<ref id="sc27"><label>27.</label><mixed-citation publication-type="journal"><string-name><given-names>H.</given-names> <surname>Li</surname></string-name> <etal>et al.</etal>, <source>Bioinformatics</source> <volume>25</volume>, <fpage>2078</fpage>–<lpage>2079</lpage>, issn: 1367-4803 (June <year>2009</year>).</mixed-citation></ref>
<ref id="sc28"><label>28.</label><mixed-citation publication-type="journal"><string-name><given-names>A. R.</given-names> <surname>Quinlan</surname></string-name>, <string-name><given-names>I. M.</given-names> <surname>Hall</surname></string-name>, <source>Bioinformatics</source> <volume>26</volume>, <fpage>841</fpage>–<lpage>842</lpage>, issn: 1367-4803 (Mar. <year>2010</year>).</mixed-citation></ref>
<ref id="sc29"><label>29.</label><mixed-citation publication-type="journal"><string-name><given-names>T.</given-names> <surname>Ohta</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Kimura</surname></string-name>, <source>Genetics</source> <volume>63</volume>, <fpage>229</fpage>–<lpage>238</lpage>, issn: 0016-6731, PMID: 5365295 (Sept. <year>1969</year>).</mixed-citation></ref>
<ref id="sc30"><label>30.</label><mixed-citation publication-type="journal"><string-name><given-names>R. R.</given-names> <surname>Hudson</surname></string-name>, <source>Genetics</source> <volume>109</volume>, <fpage>61</fpage>1 (Mar. <year>1985</year>).</mixed-citation></ref>
<ref id="sc31"><label>31.</label><mixed-citation publication-type="journal"><string-name><given-names>Y. S.</given-names> <surname>Song</surname></string-name>, <string-name><given-names>J. S.</given-names> <surname>Song</surname></string-name>, <source>Theoretical Population Biology</source> <volume>71</volume>, <fpage>49</fpage>–<lpage>60</lpage>, issn: 0040-5809 (Feb. <year>2007</year>).</mixed-citation></ref>
<ref id="sc32"><label>32.</label><mixed-citation publication-type="journal"><string-name><given-names>N. R.</given-names> <surname>Garud</surname></string-name>, <string-name><given-names>B. H.</given-names> <surname>Good</surname></string-name>, <string-name><given-names>O.</given-names> <surname>Hallatschek</surname></string-name>, <string-name><given-names>K. S.</given-names> <surname>Pollard</surname></string-name>, <source>PLOS Biology</source> <volume>17</volume>, <fpage>e30001</fpage>02 (Jan. <year>2019</year>).</mixed-citation></ref>
<ref id="sc33"><label>33.</label><mixed-citation publication-type="journal"><string-name><given-names>M. J.</given-names> <surname>Rosen</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Davison</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Bhaya</surname></string-name>, <string-name><given-names>D. S.</given-names> <surname>Fisher</surname></string-name>, <source>Science</source> <volume>348</volume>, <fpage>101</fpage>9 (May <year>2015</year>).</mixed-citation></ref>
<ref id="sc34"><label>34.</label><mixed-citation publication-type="other"><string-name><given-names>T.</given-names> <surname>Sakoparnig</surname></string-name>, <string-name><given-names>C.</given-names> <surname>Field</surname></string-name>, <string-name><given-names>E.</given-names> <surname>van Nimwegen</surname></string-name>, eLife 10, ed. by <string-name><given-names>A.</given-names> <surname>Nourmohammad</surname></string-name>, <string-name><given-names>A. M.</given-names> <surname>Walczak</surname></string-name>, <fpage>e65366</fpage>, issn: 2050-084X (Jan. <year>2021</year>).</mixed-citation></ref>
<ref id="sc35"><label>35.</label><mixed-citation publication-type="other"><string-name><given-names>P. W.</given-names> <surname>Messer</surname></string-name>, <string-name><given-names>D. A.</given-names> <surname>Petrov</surname></string-name>, <article-title>Trends in Ecology&amp; Evolution</article-title> <volume>28</volume>, <fpage>659</fpage>–<lpage>669</lpage>, issn: 0169-5347 (Nov. <year>2013</year>).</mixed-citation></ref>
<ref id="sc36"><label>36.</label><mixed-citation publication-type="other"><string-name><given-names>T. H.</given-names> <surname>Jukes</surname></string-name>, <string-name><given-names>C. R.</given-names> <surname>Cantor</surname></string-name>, in Mammalian Protein Metabolism, ed. by H. N. Munro (Academic Press, Jan. <year>1969</year>), pp. 21–132, isbn: 978-1-4832-3211-9.</mixed-citation></ref>
<ref id="sc37"><label>37.</label><mixed-citation publication-type="journal"><string-name><given-names>M.</given-names> <surname>Nei</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Gojobori</surname></string-name>, <source>Molecular Biology and Evolution</source> <volume>3</volume>, <fpage>41</fpage>8–426, issn: 0737-4038 (Sept. <year>1986</year>).</mixed-citation></ref>
<ref id="sc38"><label>38.</label><mixed-citation publication-type="journal"><string-name><given-names>Z.</given-names> <surname>Chen</surname></string-name> <etal>et al.</etal>, Nature Ecology &amp; <source>Evolution</source> <volume>6</volume>, <fpage>183</fpage>–<lpage>194</lpage>, issn: 2397-334X (Feb. <year>2022</year>).</mixed-citation></ref>
<ref id="sc39"><label>39.</label><mixed-citation publication-type="journal"><string-name><given-names>E. P. C.</given-names> <surname>Rocha</surname></string-name>, <source>Molecular Biology and Evolution</source> <volume>35</volume>, <fpage>1338</fpage>–<lpage>1347</lpage>, issn: 0737-4038 (June <year>2018</year>).</mixed-citation></ref>
<ref id="sc40"><label>40.</label><mixed-citation publication-type="journal"><string-name><given-names>H.</given-names> <surname>Lee</surname></string-name>, <string-name><given-names>E.</given-names> <surname>Popodi</surname></string-name>, <string-name><given-names>H.</given-names> <surname>Tang</surname></string-name>, <string-name><given-names>P. L.</given-names> <surname>Foster</surname></string-name>, <source>Proceedings of the National Academy of Sciences</source> <volume>109</volume>, <fpage>E2774</fpage>–<lpage>E2783</lpage> (<year>2012</year>).</mixed-citation></ref>
<ref id="sc41"><label>41.</label><mixed-citation publication-type="journal"><string-name><given-names>P. D.</given-names> <surname>Sniegowski</surname></string-name>, <string-name><given-names>P. J.</given-names> <surname>Gerrish</surname></string-name>, <string-name><given-names>R. E.</given-names> <surname>Lenski</surname></string-name>, <source>Nature</source> <volume>387</volume>, <fpage>703</fpage>–<lpage>705</lpage>, issn: 1476-4687 (June <year>1997</year>).</mixed-citation></ref>
<ref id="sc42"><label>42.</label><mixed-citation publication-type="journal"><string-name><given-names>N. A.</given-names> <surname>Moran</surname></string-name>, <string-name><given-names>H. J.</given-names> <surname>McLaughlin</surname></string-name>, <string-name><given-names>R.</given-names> <surname>Sorek</surname></string-name>, <source>Science</source> <volume>323</volume>, <fpage>379</fpage>–<lpage>382</lpage> (<year>2009</year>).</mixed-citation></ref>
</ref-list>
<fn-group>
<fn id="fn1"><label>1</label><p>Note that it is possible to have triplets of divergences that violate the triangle inequality, which cannot be represented as triangles in a two-dimensional space. In our data, such cases were rare but this may not be generally true, particularly for sequences that are not clearly separated and which are the result of extensive recombination. Note however that the classification into distinct patterns given below can still be done even in these cases.</p></fn>
<fn id="fn2"><label>2</label><p>Note that <sup>L</sup><italic><sub>i</sub> f<sub>i</sub></italic> = 1.</p></fn>
<fn id="fn3"><label>3</label><p>Note that this does not imply that the diversity within this backbone can be represented by an asexual phylogenetic tree, as is commonly assumed in the literature (<italic><xref ref-type="bibr" rid="sc34">34</xref></italic>). Indeed, as shown in Sec. IV, we still find significant linkage decrease in the low diversity regions of the <italic>α</italic> genome.</p></fn>
</fn-group>
</back>
<sub-article id="sa0" article-type="editor-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.90849.1.sa2</article-id>
<title-group>
<article-title>eLife Assessment</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<name>
<surname>Coop</surname>
<given-names>Graham</given-names>
</name>
<role specific-use="editor">Reviewing Editor</role>
<aff>
<institution-wrap>
<institution>University of California, Davis</institution>
</institution-wrap>
<city>Davis</city>
<country>United States of America</country>
</aff>
</contrib>
</contrib-group>
<kwd-group kwd-group-type="evidence-strength">
<kwd>Convincing</kwd>
</kwd-group>
<kwd-group kwd-group-type="claim-importance">
<kwd>Important</kwd>
</kwd-group>
</front-stub>
<body>
<p>This <bold>important</bold> study demonstrates widespread introgression between species of cyanobacteria in hot springs in Yellowstone National Park. Using single cell sequencing of hundreds of genomes, the authors provide one of the most <bold>convincing</bold> demonstrations to date of the importance of selection and hybridization in shaping polymorphism within a natural community. The strong enthusiasm for the paper is only dampened slightly by the methods not being described in the clearest possible manner.</p>
</body>
</sub-article>
<sub-article id="sa1" article-type="referee-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.90849.1.sa1</article-id>
<title-group>
<article-title>Reviewer #1 (Public Review):</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<anonymous/>
<role specific-use="referee">Reviewer</role>
</contrib>
</contrib-group>
</front-stub>
<body>
<p>Summary:</p>
<p>What are the overarching principles by which prokaryotic genomes evolve? This fundamental question motivates the investigations in this excellent piece of work. While it is still very common in this field to simply assume that prokaryotic genome evolution can be described by a standard model from mathematical population genetics, and fit the genomic data to such a model, a smaller group of researchers rightly insists that we should not have such preconceived ideas and instead try to carefully look at what the genomic data tell us about how prokaryotic genomes evolve. This is the approach taken by the authors of this work. Lacking a tight theoretical framework, the challenge of such approaches is to devise analysis methods that are robust to all our uncertainties about what the underlying evolutionary dynamics might be.</p>
<p>The authors here focus on a collection of ~300 single-cell genomes from a relatively well-isolated habitat with relatively simple species composition, i.e. cyanobacteria living in hotsprings in Yellowstone National Park, and convincingly demonstrate that the relative simplicity of this habitat increases our ability to interpret what the genomic data tells us about the evolutionary dynamics.</p>
<p>Using a very thorough and multi-faceted analysis of these data, the authors convincingly show that there are three main species of Synechococcus cyanobacteria living in this habitat, and that apart from very frequent recombination within each species (which is in line with insights from other recent studies) there is also a remarkably frequent occurrence of hybridization events between the different species, and with as of yet unidentified other genomes. Moreover, these hybridization events drive much of the diversity within each species. The authors also show convincing evidence that these hybridization events are not neutral but are driven by selected by natural selection.</p>
<p>Strengths:</p>
<p>The great strength of this paper is that, by not making any preconceived assumptions about what the evolutionary dynamics is expected to look like, but instead devising careful analysis methods to tease apart what the data tells us about what has happened in the evolution in these genomes, highly novel and unexpected results are obtained, i.e. the major role of hybridization across the 3 main species living in this habitat.</p>
<p>The analysis is very thorough and reading the detailed supplementary material it is clear that these authors took a lot of care in devising these methods and avoiding the pitfalls that unfortunately affect many other studies in this research area.</p>
<p>The picture of the evolutionary dynamics of these three Synechococcus species that emerge from this analysis is highly novel and surprising. I think this study is a major stepping stone toward the development of more realistic quantitative theories of genome evolution in prokaryotes.</p>
<p>The analysis methods that the authors employ are also partially novel and will no doubt be very valuable for analysis of many other datasets.</p>
<p>Weaknesses:</p>
<p>I feel the main weakness of this paper is that the presentation is structured such that it is extremely difficult to read. I feel readers have essentially no chance to understand the main text without first fully reading the 50-page supplement with methods and 31 supplementary materials. I think this will unfortunately strongly narrow the audience for this paper and below in the recommendations for the authors I make some suggestions as to how this might be improved.</p>
<p>A very interesting observation is that a lot of hybridization events (i.e. about half) originate from species other than the alpha, beta, and gamma Synechococcus species from which the genomes that are analyzed here derive. For this to occur, these other species must presumably also be living in the same habitat and must be relatively abundant. But if they are, why are they not being captured by the sampling? I did not see a clear explanation for this very common occurrence of hybridization events from outside of these Synechococcus species. The authors raise the possibility that these other species used to live in these hot springs but are now extinct. I'm not sure how plausible this is and wonder if there would be some way to find support for this in the data (e.g that one does not observe recent events of import from one of these unknown other species). This was one major finding that I believe went without a clear interpretation.</p>
<p>The core entities in the paper are groups of orthologous genes that show clear evidence of hybridization. It is thus very frustating that exactly the methods for identifying and classifying these hybridization events were really difficult to understand (sections I and V of the supplement). Even after several readings, I was unsure of exactly how orthogroups were classified, i.e. what the difference between M and X clusters is, what a `simple hybrid' corresponds to (as opposed to complex hybrids?), what precisely the definitions of singlet and non-singlet hybrids are, etcetera. It also seems that some numbers reported in the main text do not match what is shown in the supplement. For example, the main text talks about &quot;around 80 genes with more than three clusters (SM, Sec. V; fig. S17).&quot;, but there is no group with around 80 genes shown in Fig S17! And similarly, it says &quot;We found several dozen (100 in α and 84 in β) simple hybrid loci&quot; and I also cannot match those numbers to what is shown in the supplement. I am convinced that what the authors did probably made sense. But as a reader, it is frustrating that when one tries to understand the results in detail, it is very difficult to understand what exactly is going on. I mention this example in detail because the hybrid classification is the core of this paper, but I had similar problems in other sections.</p>
<p>Although I generally was quite convinced by the methods and it was clear that the authors were doing a very thorough job, there were some instances where I did not understand the analysis. For example, the way orthogroups were built is very much along the lines used by many in the field (i.e. orthoMCL on the graph of pairwise matchings, building phylogenies of connected components of the graph, splitting the phylogenies along long branches). But then to subdivide orthogroups into clusters of different species, the authors did not use the phylogenetic tree already built but instead used an ad hoc pairwise hierarchical average linkage clustering algorithm.</p>
</body>
</sub-article>
<sub-article id="sa2" article-type="referee-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.90849.1.sa0</article-id>
<title-group>
<article-title>Reviewer #2 (Public Review):</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<anonymous/>
<role specific-use="referee">Reviewer</role>
</contrib>
</contrib-group>
</front-stub>
<body>
<p>Summary:</p>
<p>
Birzu et al. describe two sympatric hotspring cyanobacterial species (&quot;alpha&quot; and &quot;beta&quot;) and infer recombination across the genome, including inter-species recombination events (hybridization) based on single-cell genome sequencing. The evidence for hybridization is strong and the authors took care to control for artefacts such as contamination during sequencing library preparation. Despite hybridization, the species remain genetically distinct from each other. The authors also present evidence for selective sweeps of genes across both species - a phenomenon which is widely observed for antibiotic resistance genes in pathogens, but rarely documented in environmental bacteria.</p>
<p>Strengths:</p>
<p>
This manuscript describes some of the most thorough and convincing evidence to date of recombination happening within and between cohabitating bacteria in nature. Their single-cell sequencing approach allows them to sample the genetic diversity from two dominant species. Although single-cell genome sequences are incomplete, they contain much more information about genetic linkage than typical short-read shotgun metagenomes, enabling a reliable analysis of recombination. The authors also go to great lengths to quality-filter the single-cell sequencing data and to exclude contamination and read mismapping as major drivers of the signal of recombination.</p>
<p>Weaknesses:</p>
<p>
Despite the very thorough and extensive analyses, many of the methods are bespoke and rely on reasonable but often arbitrary cutoffs (e.g. for defining gene sequence clusters etc.). Much of this is warranted, given the unique challenges of working with single-cell genome sequences, which are often quite fragmented and incomplete (30-70% of the genome covered). I think the challenges of working with this single-cell data should be addressed up-front in the main text, which would help justify the choices made for the analysis. The conclusions could also be strengthened by an analysis restricted to only a subset of the highest quality (&gt;70% complete) genomes. Even if this results in a much smaller sample size, it could enable more standard phylogenetic methods to be applied, which could give meaningful support to the conclusions even if applied to just ~10 genomes or so from each species. By building phylogenetic trees, recombination events could be supported using bootstraps, which would add confidence to the gene sequence clustering-based analyses which rely on arbitrary cutoffs without explicit measures of support.</p>
<p>The manuscript closes without a cartoon (Figure 4) which outlines the broad evolutionary scenario supported by the data and analysis. I agree with the overall picture, but I do think that some of the temporal ordering of events, especially the timing of recombination events could be better supported by data. In particular, is there evidence that inter-species recombination events are increasing or decreasing over time? Are they currently at steady-state? This would help clarify whether a newly arrived species into the caldera experiences an initial burst of accepting DNA from already-present species (perhaps involving locally adaptive alleles), or whether recombination events are relatively constant over time. These questions could be answered by counting recombination events that occur deeper or more recently in a phylogenetic tree. The cartoon also shows a 'purple' species that is initially present, then donates some DNA to the 'blue' species before going extinct. In this model, 'purple' DNA should also be donated to the more recently arrived 'orange' species, in proportion to its frequency in the 'blue' genome. This is a relatively subtle detail, but it could be tested in the real data, and this may actually help discern the order of the inferred recombination events.</p>
<p>The abstract also makes a bold claim that is not well-supported by the data: &quot;This widespread mixing is contrary to the prevailing view that ecological barriers can maintain cohesive bacterial species...&quot; In fact, the two species are cohesive in the sense that they are identifiable based on clustering of genome-wide genetic diversity (as shown in Fig 1A). I agree that the mixing is 'widespread' in the sense that it occurs across the genome (as shown in Figure 2A) but it is clearly not sufficient to erode species boundaries. So I believe the data is consistent with a Biological Species Concept (sensu Bobay &amp; Ochman, Genome Biology &amp; Evolution 2017) that remains 'fuzzy' - such that there are still inter-species recombination events, just not sufficient to erode the cohesion of genomic clusters. Therefore, I think the data supports the emerging picture of most bacteria abiding by some version of a BSC, and is not particularly 'contrary' to the prevailing view.</p>
<p>The final Results paragraph begins by posing a question about epistatic interactions, but fails to provide a definitive answer to the extent of epistasis in these genomes. Quantifying epistatic effects in bacterial genomes is certainly of interest, but might be beyond the scope of this paper. This could be a Discussion point rather than an underdeveloped section of the Results.</p>
</body>
</sub-article>
</article>