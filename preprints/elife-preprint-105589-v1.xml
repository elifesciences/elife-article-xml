<?xml version="1.0" ?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.3 20210610//EN"  "JATS-archivearticle1-mathml3.dtd"><article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.3" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="nlm-ta">elife</journal-id>
<journal-id journal-id-type="publisher-id">eLife</journal-id>
<journal-title-group>
<journal-title>eLife</journal-title>
</journal-title-group>
<issn publication-format="electronic" pub-type="epub">2050-084X</issn>
<publisher>
<publisher-name>eLife Sciences Publications, Ltd</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">105589</article-id>
<article-id pub-id-type="doi">10.7554/eLife.105589</article-id>
<article-id pub-id-type="doi" specific-use="version">10.7554/eLife.105589.1</article-id>
<article-version-alternatives>
<article-version article-version-type="publication-state">reviewed preprint</article-version>
<article-version article-version-type="preprint-version">1.1</article-version>
</article-version-alternatives>
<article-categories><subj-group subj-group-type="heading">
<subject>Computational and Systems Biology</subject>
</subj-group>
</article-categories>
<title-group>
<article-title>A network regularized linear model to infer spatial expression pattern for single cell</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-8085-0317</contrib-id>
<name>
<surname>Gu</surname>
<given-names>Chaohao</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="aff" rid="a2">2</xref>
<xref ref-type="aff" rid="a3">3</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Chen</surname>
<given-names>Hu</given-names>
</name>
<xref ref-type="aff" rid="a2">2</xref>
<xref ref-type="aff" rid="a3">3</xref>
</contrib>
<contrib contrib-type="author" corresp="yes">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-7608-0831</contrib-id>
<name>
<surname>Liu</surname>
<given-names>Zhandong</given-names>
</name>
<xref ref-type="aff" rid="a2">2</xref>
<xref ref-type="aff" rid="a3">3</xref>
<email>zhandonl@bcm.edu</email>
</contrib>
<aff id="a1"><label>1</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/02pttbw34</institution-id><institution>Graduate School of Biomedical Sciences, Program in Quantitative and Computational Biosciences, Baylor College of Medicine</institution></institution-wrap>, <city>Houston</city>, <country country="US">United States</country></aff>
<aff id="a2"><label>2</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/05cz92x43</institution-id><institution>Jan and Dan Duncan Neurologic Research Institute, Texas Children’s Hospital</institution></institution-wrap>, <city>Houston</city>, <country country="US">United States</country></aff>
<aff id="a3"><label>3</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/02pttbw34</institution-id><institution>Department of Pediatrics, Baylor College of Medicine</institution></institution-wrap>, <city>Houston</city>, <country country="US">United States</country></aff>
</contrib-group>
<contrib-group content-type="section">
<contrib contrib-type="editor">
<name>
<surname>Choi</surname>
<given-names>Jungmin</given-names>
</name>
<role>Reviewing Editor</role>
<aff>
<institution-wrap>
<institution>Korea University</institution>
</institution-wrap>
<city>Seoul</city>
<country>Republic of Korea</country>
</aff>
</contrib>
<contrib contrib-type="senior_editor">
<name>
<surname>Choi</surname>
<given-names>Murim</given-names>
</name>
<role>Senior Editor</role>
<aff>
<institution-wrap>
<institution>Seoul National University</institution>
</institution-wrap>
<city>Seoul</city>
<country>Republic of Korea</country>
</aff>
</contrib>
</contrib-group>
<author-notes>
<fn fn-type="coi-statement"><p>Competing interests: No competing interests declared</p></fn>
</author-notes>
<pub-date date-type="original-publication" iso-8601-date="2025-04-02">
<day>02</day>
<month>04</month>
<year>2025</year>
</pub-date>
<volume>14</volume>
<elocation-id>RP105589</elocation-id>
<history>
<date date-type="sent-for-review" iso-8601-date="2025-02-15">
<day>15</day>
<month>02</month>
<year>2025</year>
</date>
</history>
<pub-history>
<event>
<event-desc>Preprint posted</event-desc>
<date date-type="preprint" iso-8601-date="2024-11-22">
<day>22</day>
<month>11</month>
<year>2024</year>
</date>
<self-uri content-type="preprint" xlink:href="https://doi.org/10.1101/2024.11.20.624541"/>
</event>
</pub-history>
<permissions>
<copyright-statement>© 2025, Gu et al</copyright-statement>
<copyright-year>2025</copyright-year>
<copyright-holder>Gu et al</copyright-holder>
<ali:free_to_read/>
<license xlink:href="https://creativecommons.org/licenses/by/4.0/">
<ali:license_ref>https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
<license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p>
</license>
</permissions>
<self-uri content-type="pdf" xlink:href="elife-preprint-105589-v1.pdf"/>
<abstract>
<title>Abstract</title>
<p>Spatial transcriptomics, situated at the intersection of genomics and spatial biology, offers profound insights into the spatial organization of gene expression within tissues. However, its potential has been constrained by either limited resolution or throughput. While single-cell RNA-seq allows for in-depth profiling of cellular gene expression, the crucial spatial information is often sacrificed during sample collection. In a groundbreaking fusion of these two techniques, our research introduces the glmSMA computational algorithm. This innovative approach aims to predict cell locations by integrating scRNA-seq data with spatial-omics reference atlases. The essence of glmSMA lies in formulating cell mapping as a convex problem, strategically minimizing differences between cellular expression profiles and location expression profiles through L1 and Generalized L2 regularization. Our algorithm has undergone rigorous testing across diverse tissues, including mouse brain, drosophila embryo, and human PDAC samples. The compelling results validate glmSMA’s efficacy, demonstrating its capability to faithfully recapitulate spatial gene expression and anatomical structures. This marks a significant stride forward in overcoming the limitations of existing spatial transcriptomic techniques.</p>
</abstract>
<custom-meta-group>
<custom-meta specific-use="meta-only">
<meta-name>publishing-route</meta-name>
<meta-value>prc</meta-value>
</custom-meta>
</custom-meta-group>
</article-meta>

</front>
<body>
<sec id="s1">
<title>Background</title>
<p>Precise spatial regulation of gene expression at the individual cell level plays a crucial role in normal development and disease pathogenesis. A notable example is the spatial expression of the Hippo signaling pathway during early embryogenesis in Drosophila, which is essential for orchestrating the correct patterning of asynchronous cell proliferation<sup><xref ref-type="bibr" rid="c1">1</xref>,<xref ref-type="bibr" rid="c2">2</xref></sup>. While single-cell RNA sequencing (scRNA-seq) has revolutionized the measurement of a vast number of genes in individual cells, the inherent challenge lies in the loss of spatial information post-tissue digestion and cell dispersion<sup><xref ref-type="bibr" rid="c3">3</xref></sup>.</p>
<p>Spatial-omics techniques today fall into two main categories: Next-Gen Sequencing (NGS)-based methods and imaging-based methods. Examples of NGS-based methods include Slide-seq and spatial transcriptomics. Slide-seq offers genome-wide measurements for obtaining spatially resolved gene expression data at the single-cell level<sup><xref ref-type="bibr" rid="c4">4</xref></sup>. However, it comes with limitations, such as a low gene capture rate and relatively small barcoded bead size, resulting in a confined measurable area. On the other hand, spatial transcriptomics, exemplified by technologies like 10x Visium, provides high-quality mRNA transcripts over a larger area but at the cost of lower resolution compared to Slide-seq<sup><xref ref-type="bibr" rid="c5">5</xref></sup>. In addition, image-based methods resemble the fluorescence in-situ hybridization (FISH) technique<sup><xref ref-type="bibr" rid="c6">6</xref></sup>. FISH-like methods offer high-resolution mRNA level information in a tissue of interest. However, they often face constraints in the number of genes that can be measured. Navigating the strengths and limitations of these spatial-omics techniques is pivotal for advancing our understanding of spatial gene expression regulation in diverse biological contexts.</p>
<p>The seamless integration of single-cell and spatial transcriptomics (ST) data holds the promise of characterizing the spatial distribution of the entire transcriptome at single-cell resolution, harnessing the complementary insights offered by each. However, current integration methods fall short of providing satisfactory outcomes in real data analysis. Several cell-type deconvolution methods for ST data, including RCTD<sup><xref ref-type="bibr" rid="c7">7</xref></sup>, Cell2location<sup><xref ref-type="bibr" rid="c8">8</xref></sup>, and MIA<sup><xref ref-type="bibr" rid="c9">9</xref></sup>, exist; however, when applied to sequencing-based ST data, they merely estimate cell type proportions within spatial spots, lacking the capability to achieve true single-cell resolution. In addition to established NGS-based methods like Slide-seq and spatial transcriptomics, alternative approaches such as novosparc<sup><xref ref-type="bibr" rid="c10">10</xref></sup>, DistMap<sup><xref ref-type="bibr" rid="c11">11</xref></sup>, and CellTrek<sup><xref ref-type="bibr" rid="c12">12</xref></sup> contribute to the landscape of spatial-omics techniques. However, each method exhibits its own set of limitations. CellTrek<sup><xref ref-type="bibr" rid="c12">12</xref></sup>, for instance, faces a challenge in achieving high recall due to its automatic removal of at least 30% of cells with low confidence scores. This trade-off between precision and recall can impact the comprehensive capture of spatial information. Novosparc<sup><xref ref-type="bibr" rid="c10">10</xref></sup>, while promising, has primarily undergone testing in simulated datasets, raising questions about its real-world applicability and performance on authentic biological samples. DistMap<sup><xref ref-type="bibr" rid="c11">11</xref></sup>, while effective, is constrained by its suitability for simple tissues. This limitation stems from the oversimplification of gene expression through binarization, which may compromise its efficacy in capturing the complexity of spatial regulation in more intricate biological systems. Consequently, the persisting limitation of not attaining single-cell resolution remains unaddressed. In the context of image-based ST data, methods designed to infer unmeasured gene expressions, such as Tangram<sup><xref ref-type="bibr" rid="c13">13</xref></sup>, SpatialScope<sup><xref ref-type="bibr" rid="c14">14</xref></sup>, and CARD<sup><xref ref-type="bibr" rid="c15">15</xref></sup>, exhibit insufficient accuracy, particularly in the presence of sparse ST expression data. Thus, there persists a crucial need for precise statistical and computational methods to effectively bridge the gap between single-cell and ST datasets.</p>
</sec>
<sec id="s2">
<title>Methods</title>
<p>GlmSMA represents a groundbreaking integration of spatial transcriptomics and single-cell RNA sequencing (scRNA-seq) to predict cell locations within a spatial reference. This innovative approach involves constructing a linear regression model incorporating L1 norm and generalized L2 norm. The model aims to estimate the linear relationship between the location expression and cellular expression of specific marker genes, where the generalized L2 norm is induced by the graph Laplacian matrix calculated from spatial coordinates derived from the spatial reference. To achieve a balanced approach in selecting locations for single cells within limited areas, glmSMA leverages L1 and generalized L2 regularization. Marker genes, chosen for their high variability and elevated Moran’s I score, contribute to the model. Moreover, researchers have the flexibility to input their own marker gene list. In essence, glmSMA minimizes the location and cellular expression of marker genes, resulting in a focused selection of potential locations for each individual cell.</p>
<p>Validating the predicted cell locations poses a challenge due to the absence of ground truth in the experimental procedure. To address this, we employ multiple strategies. First, the Kullback-Leibler divergence (KL) is calculated between the original cell type distribution based on spatial transcriptomics and the predicted distribution. Lower KL scores indicate more accurate predictions. Second, Pearson’s correlation is computed on the spatial expression of marker genes between the reference and reconstructed patterns derived from cell mapping results. This analysis reveals a strong positive correlation in multiple tissues. Third, manual inspection of cell type distribution based on anatomical structures further contributes to the validation process. Through these comprehensive approaches, glmSMA offers a robust means of validating cell mapping results despite the absence of ground truth information.</p>
<sec id="s2a">
<label>2.1</label>
<title>Objective function to minimize</title>
<p>Suppose that the reference atlas has n positions with p genes, and the scRNA-seq data set has m cells with the same number of p genes (usually n &gt; m). We aimed to assign the m cells into n positions using linear regression model with L1 norm and generalized L2 norm via graph Laplacian. The initial step is to create the position to gene expression matrix and the cell to the gene expression matrix. Based on the two matrices, we create two graphs – position to position graph and cell to cell graph. If the Euclidean distance between two locations is lower than a specific threshold and the two locations belong to a same anatomical structure, the two locations are connected in the first graph. If the similarity of gene expression levels between two cells is lower than a specific threshold, the two cells are connected in the cell-to-cell graph. Then we create two random walk normalized graph Laplacian matrices, which encourage smoothness on coefficients that are connected in the two graphs.</p>
<p>Our model uses a linear method to measure the differences in gene expression levels in assigning cells to locations. The optimal solution minimizes the differences between gene expression levels of individual cells and gene expression levels of locations. For each individual cell, we want to minimize the following objective function,
<disp-formula id="ueqn1">
<graphic xlink:href="624541v1_ueqn1.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <italic>s</italic> ∈ <italic>R</italic><sup><italic>n</italic>×<italic>g</italic></sup> is the single-cell expression matrix (n is the number of cells, g is the number of genes),<italic>T</italic> ∈ <italic>R</italic><sup><italic>m</italic>×<italic>g</italic></sup> is marker genes expression matrix of reference atlas (g is number of genes, and m is the number of locations in the reference atlas), ℒ is normalized graph Laplacian matrix computed from the location distance graph, and <italic>w</italic> ∈ <italic>W</italic><sup><italic>i</italic>×<italic>j</italic></sup> is the personalized weight matrix for each location in each cell. The L1 norm penalization encourages sparsity on the coefficients, which guarantees that one cell can only be assigned into a small number of locations. The generalized L2 norm encourages the smoothness of the coefficients, which guarantees that cells with similar gene expression leve ls are more likely to be assigned into closer locations and one cell assignment is more likely to form a patch instead of scattered distribution. Overall, our method makes full use of the relationship between cell-to-cell physical distance and cell to location expression distance.</p>
</sec>
<sec id="s2b">
<label>2.2</label>
<title>Data analysis</title>
<p>For the Slide-seq data, we normalized the data in log-space following the previous pipeline [6]. Let <italic>d</italic><sub><italic>ij</italic></sub> be the raw count for gene i in cell j; we normalized it as
<disp-formula id="ueqn2">
<graphic xlink:href="624541v1_ueqn2.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
. Then we down-sampled the Slide-seq datasets by rounding the physical location coordinates to the next integer multiple of 50 and filtered out low quality locations, where positions with less than 50 genes expressed were discarded, resulting in 7,724 cells in the mouse cerebellum section and 7,790 cells in the mouse hippocampus section. Then we used summed transcriptomes of neighboring locations as the new expression profiles in the rounded locations.</p>
<p>To find the highly variable genes in the Slide-seq dataset, Raw counts in each cell were first normalized by the total counts and scaled by the median number of raw counts across all cells. For each cell we added a pseudocount of 1 before log transformation. Highly variable genes were selected based on the Fano factor, defined as <inline-formula><inline-graphic xlink:href="624541v1_inline1.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, where <italic>σ</italic><sup>2</sup> is the variance of gene expression and <inline-formula><inline-graphic xlink:href="624541v1_inline1a.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is the mean of expression across all cells. A certain mean threshold will be chosen for the Fano factor. For the 10x visium spatial transcriptomics data, we use the Seurat package to find the highly varible genes.</p>
<p>Next, we built a graph Laplacian matrix based on the spatial coordinates and anatomical structure. In physical space, we first constructed an undirected graph G = (V, E), where V is a set of nodes consisted of locations in the reference atlas and E is a set of edges consisted of the Euclidean distance between locations. Two locations are connected if the Euclidean distance between them is less than a selected threshold and both locations are in same anatomical structure. The random-walk normalized Laplacian matrix on physical locations is defined as,
<disp-formula id="ueqn3">
<graphic xlink:href="624541v1_ueqn3.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where D is the degree matrix and A is the adjacency matrix in graph G.</p>
<p>The elements of L are shown as,
<disp-formula id="ueqn4">
<graphic xlink:href="624541v1_ueqn4.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
</p>
</sec>
<sec id="s2c">
<label>2.3</label>
<title>Selection of regularization penalties</title>
<p>L1 norm encouraged the sparsity of the cell mapping and generalized L2 norm encouraged the smoothness of the cell mapping. If we want to map the cells to a large domain, we can increase the L2 parameters and decrease the L1 parameters. Also, we can increase L1 parameter to map cells to several sparse locations. For the simulated dataset, we used a stepwise increasement for the L1 and L2 parameters and found the optimal solution according to the highest prediction accuracy for the cell locations.</p>
</sec>
<sec id="s2d">
<label>2.4</label>
<title>glmSMA pipeline</title>
<p>To reconstruct spatial expression patterns, our algorithm performs the following steps:</p>
<list list-type="order">
<list-item><p>Read the gene expression matrix from scRNA-seq and location matrix from reference atlas</p></list-item>
<list-item><p>Optional:</p>
<list list-type="alpha-lower">
<list-item><p>Find the spatial differential expressed genes based on the moran’s I scores.</p></list-item>
<list-item><p>Find the highly variable genes</p></list-item>
<list-item><p>Find anchor genes from spatial reference atlas based on the scRNA-seq data</p>
<p>Then the input will be altered based on the genes of interest.</p></list-item></list>
</list-item>
<list-item><p>Construct the normalized graph Laplacian matrix based on the anatomical structures and Euclidean distance between locations.</p></list-item>
<list-item><p>Optional: Set personalized weight matrix for each location and cell.</p></list-item>
<list-item><p>Using glm to solve the convex function with L1 norm and generalized L2 norm. in the objective</p></list-item>
<list-item><p>Assign cells to targeting locations based on the distribution of function.</p></list-item>
<list-item><p>Reconstruct the spatial patterns based on the expression profiles in the scRNA-seq data and cell locations from the mapping results.</p></list-item>
</list>
</sec>
</sec>
<sec id="s3">
<title>Results</title>
<sec id="s3a">
<title>Overview of glmSMA</title>
<p>Presenting glmSMA, a novel linear regression model designed to integrate single-cell RNA sequencing (scRNA-seq) reference data with spatial transcriptomics (ST) data across various experimental platforms (<xref ref-type="fig" rid="fig1">Fig.1</xref>; Methods). glmSMA seamlessly accommodates both sequencing-based ST data (such as 10x Visium and Slide-seq) and image-based ST data, making it a versatile tool for spatial analysis. The model combines L1 and generalized L2 norm regularization, enabling it to resolve spot-level data containing multiple cells down to single-cell resolution—particularly excelling with sequencing-based ST data. The L1 norm induces sparsity in single-cell distribution, ensuring an efficient and focused representation of individual cells. Meanwhile, the generalized L2 norm, informed by a graph Laplacian constructed from anatomical structures and spatial coordinates, promotes smoothness in cell distribution within local regions<sup><xref ref-type="bibr" rid="c16">16</xref></sup>. This dual regularization approach allows glmSMA to accurately assign single cells to a limited number of small regions at single-cell resolution, offering a refined understanding of spatial organization. Through rigorous benchmarking on both simulated and in situ datasets, glmSMA has demonstrated robust performance, accurately mapping cells across diverse tissue types. Its application to various samples, including mouse brain, human PDAC, and Drosophila embryos, has revealed specific spatial gene expression patterns and provided new insights into cellular organization. Overall, glmSMA represents a powerful and versatile tool for unraveling spatial transcriptomic complexities, offering unprecedented precision in spatial gene expression analysis and making significant contributions to our understanding of tissue architecture.</p>
<fig id="fig1" position="float" fig-type="figure">
<label>Figure 1.</label>
    <caption><title>Overview of glmSMA.</title>
    <p>GlmSMA is designed to estimate the linear relationship between spatial gene expression at specific locations and cellular expression of marker genes, incorporating both L1 and generalized L2 norms for optimal mapping precision. The L1 norm encourages sparsity, ensuring that most single cells are assigned to a small, defined patch within the reference atlas. The generalized L2 norm, meanwhile, promotes smoothness in cell distribution by leveraging anatomical structures and spatial coordinates. This refined mapping can then be used to enhance original spatial patterns and facilitate detailed studies of cell-to-cell communication within the spatial context.</p></caption>
<graphic xlink:href="624541v1_fig1.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
</sec>
<sec id="s3b">
<title>GlmSMA successfully map single cells back to mouse cortex based on Spatial-transcriptiomcs data</title>
<p>Spatially resolved gene expression enables researchers to explore how gene expression varies across different regions of a tissue, providing valuable insights into tissue architecture and organization. However, the spatial resolution of 10x Genomics Visium is limited to approximately 55 µm per spot, which is relatively coarse compared to more advanced imaging-based methods like MERFISH or seqFISH<sup><xref ref-type="bibr" rid="c5">5</xref></sup>. This resolution may not capture finer spatial features, such as single-cell details or subtle gradients in gene expression. As a result, Visium may struggle to distinguish between closely related cell types that are in close proximity within the same tissue region. GlmSMA can address these limitations by incorporating scRNA-seq data. In this approach, individual cells are assigned to small spatial patches based on the 10x Visium dataset, allowing for more precise mapping and better resolution of cellular features within the tissue. To evaluate glmSMA’s performance in accurately mapping cells to their original locations using Spatial Transcriptomics data, we conducted a comparative analysis with CellTrek<sup><xref ref-type="bibr" rid="c12">12</xref></sup> and novosparc<sup><xref ref-type="bibr" rid="c10">10</xref></sup>. Our goal was to map 4,785 single cells, comprising 13 major cell types (Smart-seq2<sup><xref ref-type="bibr" rid="c17">17</xref></sup>), across 1,075 spots (Visum, 10x Genomics) in the mouse cortex. This dataset spanned six anatomical regions: L1, L2, L3, L4, L5, and L6. We then compared the mapping accuracy of the three algorithms.</p>
<p>GlmSMA accurately mapped 90% of the 4,785 cells back to their original anatomical structures with high confidence (<xref rid="fig2" ref-type="fig">Fig. 2a</xref>). For instance, L4 cells were correctly assigned to L4, and L2/3 IT cells were accurately mapped to L2 and L3<sup><xref ref-type="bibr" rid="c31">31</xref></sup>. In comparison, CellTrek<sup><xref ref-type="bibr" rid="c12">12</xref></sup> mapped approximately 60% of cells with high confidence, but the remaining cells were excluded due to low confidence scores (Supplementary Fig. 1). Novosparc<sup><xref ref-type="bibr" rid="c10">10</xref></sup> also mapped 90% of the cells, but its accuracy was lower; for example, around 100 L4 cells were mistakenly assigned to L2 or L3 (Supplementary Fig. 2 and Fig. 2c). Additionally, Novosparc tended to distribute cells more uniformly across the six layers, which does not reflect the actual spatial distribution.</p>
<fig id="fig2" position="float" fig-type="figure">
<label>Figure 2.</label>
<caption><title>glmSMA reconstruct spatial organization in the mouse cortex.</title>
<p>a, Comprehensive Mapping of Cells in the Mouse Brain Cortex: Mapping of 4,785 cells, representing 13 distinct cell types, within the mouse brain cortex, visualizing the spatial organization of these cellular populations. b, KL-Divergence Analysis Across Methods: A comparison of Kullback-Leibler (KL) divergence values between predicted cell type distributions and ground truth distributions across three methods. Results show that glmSMA achieves superior prediction accuracy for most cell types, aligning closely with actual distribution patterns. c, Comparison of predicted and ground truth cell distributions in specific cell types.</p></caption>
<graphic xlink:href="624541v1_fig2.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
<p>To quantify differences among the three algorithms, we calculated the KL-divergence between the predicted and ground truth distributions. Since we lacked exact ground truth for single-cell locations, we approximated the spatial cell distribution based on the spatial transcriptomics data and Allen Brain Atlas<sup><xref ref-type="bibr" rid="c19">19</xref>,<xref ref-type="bibr" rid="c20">20</xref></sup> using the Seurat package<sup><xref ref-type="bibr" rid="c18">18</xref></sup>. Based on the KL-divergence scores, glmSMA outperformed the other two algorithms for most major cell types, though CellTrek slightly outperformed glmSMA for Astro cells (<xref rid="fig2" ref-type="fig">Fig. 2b</xref>). Furthermore, the spatial patterns predicted by glmSMA and CellTrek for key cell types, such as L4 and L2/3 IT cells, closely resembled the ground truth distribution (<xref rid="fig2" ref-type="fig">Fig. 2c</xref>). In conclusion, glmSMA demonstrates its applicability in spatial transcriptomics data, showing better performance to CellTrek and novosparc, and accurately recapitulating the spatial distribution of individual cells.</p>
</sec>
<sec id="s3c">
<title>GlmSMA accurately predict cells enrichment in intestinal villus and human PDAC-A sample without spatially informative genes</title>
<p>Spatial-omics techniques, especially transcriptomics, may suffer from low sensitivity, leading to incomplete or sparse data. This occurs because only a subset of genes may be detected in each spatial spot (e.g., in spatial transcriptomics), especially for lowly expressed genes. Incomplete data reduces the ability to accurately characterize gene expression across the entire tissue and may miss critical molecular features or interactions. To investigate the accuracy of glmSMA in tissues with limited spatially informative genes, we applied the method to the human PDAC-A sample<sup><xref ref-type="bibr" rid="c9">9</xref></sup>. Our objective was to map 1,926 cells, representing 11 cell types, back to 428 locations across four anatomical regions: ductal epithelium, cancer region, stroma, and pancreatic tissue. Evidence suggests that as the physical distance between spots increases, the expression of marker genes becomes more distinct (<xref rid="fig3" ref-type="fig">Fig. 3a</xref>). However, Moran’s I score analysis revealed that most of the highly variable genes in this dataset did not exhibit clear spatial patterns. In fact, adjacent spots within a single anatomical region often showed markedly different gene expressions (<xref rid="fig3" ref-type="fig">Fig. 3b</xref> and Supplementary Fig. 3). Despite the absence of spatially informative genes, glmSMA successfully mapped the major cell types to their original locations, as confirmed by the ground truth from the study (<xref rid="fig3" ref-type="fig">Fig. 3c</xref>). As expected, ductal-like cells were primarily enriched in the ductal epithelium, cancerous cells were predominantly found in the cancer region, and acinar cells were most abundant in the pancreatic tissue. These results align with previous research<sup><xref ref-type="bibr" rid="c9">9</xref></sup>.</p>
<fig id="fig3" position="float" fig-type="figure">
<label>Figure 3.</label>
    <caption><title>Cell enrichment in the intestinal villus and human PDAC-sample lacking spatially informative genes.</title>
    <p>a, Violin plots illustrate the pairwise expression differences between spots. Expression differences increase as the physical distance between spots grows. b, Marker gene expression levels across different locations. Adjacent spots can exhibit significantly different expression levels. c, The enrichment of cell types in different anatomical structures. The predicted cell enrichment closely aligned with the ground truth for most cell types. d, The number of cells assigned to each region in intestinal villus.</p></caption>
<graphic xlink:href="624541v1_fig3.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
<p>Next, we investigated another tissue—intestinal villus—with similar challenges of lacking spatially informative genes<sup><xref ref-type="bibr" rid="c21">21</xref></sup>. Using the top 100 highly variable genes, we were able to correctly map 97% of the cells to their original layers (<xref rid="fig3" ref-type="fig">Fig. 3d</xref>). These findings demonstrate that glmSMA can perform well even when relying solely on highly variable genes.</p>
</sec>
<sec id="s3d">
<title>GlmSMA effectively assigns single cells to their original locations within the 3D surface of the Drosophila embryo</title>
<p>As technologies advance, 3D spatial transcriptomics is anticipated to become increasingly accessible and applicable across various research fields<sup><xref ref-type="bibr" rid="c26">26</xref></sup>. Our next objective is to assess whether our algorithm can accurately function in 3D space. Since most spatial transcriptomics datasets are derived from 2D tissue slices, we opted to use a simplified 3D surface model for this study. To establish a reference profile, we used an expression atlas of 60 out of 84 marker genes in developmental stage 5, sourced from the Berkeley Drosophila Transcription Network Project (BDTNP)<sup><xref ref-type="bibr" rid="c23">23</xref>,<xref ref-type="bibr" rid="c23">23</xref></sup>. Embryos in the BDTNP database were collected at this developmental stage, with fluorescent staining applied to label nuclei and the expression patterns of marker genes.</p>
<p>We mapped 1,297 single cells onto 3,039 locations in 3D space, with these cells distributed across the entire model (<xref rid="fig4" ref-type="fig">Fig. 4a</xref>). Due to the absence of ground truth for single cells, we adopted an alternative strategy: comparing the spatial differential patterns of well-known marker genes with our reconstructed patterns. Reconstructed patterns were generated by assigning scRNA expression data to their respective locations. Our algorithm, glmSMA, effectively captured the spatial expression patterns of marker genes (Supplementary Fig. 4). For instance, the reconstructed ftz patterns displayed segmental stripes similar to the ground truth, while sna expression was high on the ventral side and low on the dorsal side, as expected (<xref rid="fig4" ref-type="fig">Fig. 4c</xref>).</p>
<fig id="fig4" position="float" fig-type="figure">
<label>Figure 4.</label>
    <caption><title>Reconstruction of drosophila embryo.</title>
    <p>a, Overall 1,297 cell assignment in drosophila embryo. Multiple cells can be assigned to same locations. b, Individual cell assignment. Each cell will be assign to a small patch. c, Comparison of glmSMA, perler and novosparc results for reconstruction of marker genes in a drosophila embryo.</p></caption>
<graphic xlink:href="624541v1_fig4.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
<p>We further compared our algorithm to other methods. Both glmSMA and novosparc produced results consistent with the ground truth, while perler<sup><xref ref-type="bibr" rid="c24">24</xref></sup> struggled to replicate the patterns for some marker genes, such as ken (<xref rid="fig4" ref-type="fig">Fig. 4c</xref>). We also evaluated cell assignments on an individual level. When comparing our cell assignments to those generated by novosparc, used here as a reference, we found that our assignments were highly consistent (<xref rid="fig4" ref-type="fig">Fig. 4b</xref> &amp; Supplementary Fig. 5). For example, cell 232 was accurately assigned to the embryo’s frontal region. By incorporating L1 and L2 regularization, cells were encouraged to form more cohesive patches rather than being scattered across multiple locations (Supplementary Fig. 7). Overall, these results suggest that glmSMA performs well in assigning single cells within a 3D spatial framework.</p>
</sec>
<sec id="s3e">
<title>GlmSMA successfully maps single cells within the mouse brain at high resolution</title>
<p>Slide-seq is a powerful tool for spatial transcriptomics, offering high-resolution data and large-scale spatial maps of gene expression. However, its capture rate is relatively low, leading to a sparser dataset. To demonstrate glmSMA’s versatility in high-resolution data, we evaluated its performance in mapping cells within the mouse cerebellum. First, we established a reference atlas using Slide-seq, containing a sagittal section with 46,376 spatial locations, each containing 1–1.5 individual cells and covering 19,782 genes<sup><xref ref-type="bibr" rid="c10">10</xref></sup>. To simulate scRNA-seq data, we coarse-grained the cerebellum by binning neighboring locations in the reference atlas, following a method similar to that used by Nitzan et al. After simulation, we tested glmSMA’s ability to map the simulated 7,724 cells back to the original 46,376 locations using the top 100 highly variable genes. As expected, glmSMA accurately assigned 99% of the simulated cells to their original locations (<xref rid="fig5" ref-type="fig">Fig. 5a</xref>).</p>
<fig id="fig5" position="float" fig-type="figure">
<label>Figure 5.</label>
    <caption><title>Reconstruction of mouse cerebellum.</title>
    <p>a, Simulation results of glmSMA for cell assignment in the mouse cerebellum. b, Comparsion of glmSMA, DistMap, novosparc and perler results for Granule cell and Purkinje cell assignments in the mouse cerebellum. c, Comparsion of glmSMA, DistMap denovosparc and novosparc results for Granule cell assignment in the specific anatomical region. d, Reconstruction of Car8 gene using glmSMA with the reconstructed pattern consistent with the ground truth.</p></caption>
<graphic xlink:href="624541v1_fig5.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
<p>Next, we assessed glmSMA’s performance against other mapping algorithms. We obtained scRNA-seq data from DropViz<sup><xref ref-type="bibr" rid="c25">25</xref></sup>, which includes 5,138 cells from the mouse cerebellum, comprising 4,103 granule cells and 310 Purkinje cells. The majority of granule and Purkinje cells were correctly assigned to their anatomical structures, with expression patterns of marker genes, such as Car8, aligning well with the ground truth (<xref rid="fig5" ref-type="fig">Fig. 5b &amp; 5d</xref>). When comparing prediction accuracy across algorithms, glmSMA showed superior performance. While other algorithms often misassigned Purkinje cells into granule regions, glmSMA achieved higher accuracy, correctly mapping 3,798 out of 4,103 granule cells to their original anatomical structures (<xref rid="fig5" ref-type="fig">Fig. 5b &amp; 5c</xref>). Most Purkinje cells were also accurately assigned, surrounding the granule cells as expected.</p>
<p>Additionally, glmSMA demonstrated robust performance on the Slide-seq dataset from the mouse hippocampus (Supplementary Fig. 6). These findings underscore glmSMA’s strength in providing accurate spatial mapping in complex tissues like the cerebellum.</p>
</sec>
</sec>
<sec id="s4">
<title>Discussion</title>
<p>Here, we proposed a new method to map the individual cells back to their original locations by combining reference atlas and scRNA-seq data. We take advantage of both techniques in measuring gene expression levels in different tissues. ScRNA-seq can provide comprehensive expression profiles of many individual cells, but location information is missing due to experimental procedure. Slide-seq or FISH-based technology can capture expression profiles at cellular level but only for a limited number of genes. Although the Slide-seq technique can measure the whole genome in the desired tissue simultaneously, only a few numbers of genes are available for the downstream analysis after normalization and filtering.</p>
<p>Existing single-cell assignment methods face notable limitations. For instance, novoSparc primarily emphasizes simulated datasets, as seen in their focus on the simulated dataset. In the mouse cerebellum, rather than utilizing corresponding scRNA-seq data for spatial-omics information, they opted to simulate scRNA-seq data from the Slide-seq dataset. However, novosparc demonstrated suboptimal performance on real datasets, such as the mouse cortex, where the reconstructed spatial expression patterns of marker genes failed to fully reproduce the original patterns evident in ISH images. Another method, DistMap, oversimplifies mapping problems by binarizing expression profiles in both scRNA-seq data and the reference atlas. While effective in relatively simple tissues, the performance of this algorithm significantly diminishes in more complex tissues, such as the mouse brain. On the other hand, Celltrek primarily focuses on spatial transcriptomics data from 10x Visium, requiring a Seurat object as input. In terms of mapping results, it automatically removes at least 30% of cells with low confidence in most cases. In contrast, our method maximizes the relationship between cell expressions and locations. With enough number of marker genes, we can accurately place most cells into correct small patches. While achieving pinpoint accuracy for each individual cell in certain complex tissues may pose challenges, our approach consistently and accurately assigns them to relatively small regions.</p>
<p>Other established methods for mapping single-cell data into specific locations are limited to low resolution. For example, MIA and HMRF<sup><xref ref-type="bibr" rid="c27">27</xref></sup> are two methods focusing on locating cell types into regions. Instead of mapping thousands of cells back to several positions, they only aimed to map tens of cell types into large domains. Information on individual cells were lost after the mapping because they merged the expression profiles in the same cell type. In addition, their methods cannot be applied in locating cells back to small patches, but our algorithm can be used to locate cells into domains, demonstrated in the mouse cortex dataset. In the mouse cortex, we successfully mapped cells back to 6 large domains with high accuracy. Therefore, our algorithm provided accurate and high-resolution mapping for the scRNA-seq data compared with the existing low-resolution methods.</p>
<p>Our method to map individual cells back to their original locations also has limitations. First, the performance of our algorithm highly relied on the selection of marker gene sets. Due to the cost of building a reference atlas using FISH-like technology, we may not obtain enough number of gene candidates. However, this can be solved by preprocessing the scRNA-seq or bulk-RNA seq data<sup><xref ref-type="bibr" rid="c28">28</xref></sup>. The preprocessing step can help to shrink the size of marker gene candidates. Second, the current technology of generating reference atlas, such as Slide-Seq, remained significant defects. The data quality needed to be better improved because expression profiles of lots of well-known marker genes cannot be captured<sup><xref ref-type="bibr" rid="c29">29</xref></sup>. Despite limitations, our method still achieved good performance in integrating the scRNA-seq data and reference atlas. Most of the individual cells can be correctly mapped to several unique locations.</p>
<p>Combined with the strength of both scRNA-seq and Spatial-omics techniques, our analysis and reconstruction of spatial expression patterns identified specific cell organizations in physical space under the assumption that cells with closer physical distance are more likely to have more similar expression profiles. Reconstructed spatial patterns of specific marker genes in the mouse brain have been confirmed by the ISH images from Allen Brain Atlas and Hipposeq<sup><xref ref-type="bibr" rid="c30">30</xref></sup>. Also, our mapped results provided an alternative way to impute the low-quality data in Slide-seq.</p>
<sec id="s5">
<title>Conclusions</title>
<p>GlmSMA is a groundbreaking linear regression model meticulously crafted to seamlessly fuse scRNA-seq reference data with spatial transcriptomics (ST) data obtained from various experimental platforms. Through a comprehensive benchmarking process encompassing simulated and in situ datasets, glmSMA demonstrates unparalleled performance, successfully assigning single cells to their precise original locations. The application of glmSMA in mapping single cells back to their origins has revealed novel insights, underscoring its effectiveness as a versatile and potent tool for unraveling the intricacies of spatial transcriptomics.</p>
</sec>
</sec>
</body>
<back>
<sec id="d1e902" sec-type="additional-information">
<title>Additional information</title>
<sec id="s6">
<title>Code availability</title>
<p>Code related to this manuscript can be found at <ext-link ext-link-type="uri" xlink:href="https://github.com/liuzdlab/glmSMA/">https://github.com/liuzdlab/glmSMA/</ext-link>.</p>
</sec>
</sec>
<sec id="suppd1e902" sec-type="supplementary-material">
<title>Additional files</title>
<supplementary-material id="d1e850">
<label>Supplemental Figure 1</label>
<media xlink:href="supplements/624541_file08.pdf"/>
</supplementary-material>
<supplementary-material id="d1e857">
<label>Supplemental Figure 2</label>
<media xlink:href="supplements/624541_file09.pdf"/>
</supplementary-material>
<supplementary-material id="d1e864">
<label>Supplemental Figure 3</label>
<media xlink:href="supplements/624541_file10.pdf"/>
</supplementary-material>
<supplementary-material id="d1e871">
<label>Supplemental Figure 4</label>
<media xlink:href="supplements/624541_file11.pdf"/>
</supplementary-material>
<supplementary-material id="d1e879">
<label>Supplemental Figure 5</label>
<media xlink:href="supplements/624541_file12.pdf"/>
</supplementary-material>
<supplementary-material id="d1e886">
<label>Supplemental Figure 6</label>
<media xlink:href="supplements/624541_file13.pdf"/>
</supplementary-material>
<supplementary-material id="d1e893">
<label>Supplemental Figure 7</label>
<media xlink:href="supplements/624541_file14.pdf"/>
</supplementary-material>
</sec>
<ref-list>
<title>References</title>
<ref id="c1"><label>1.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Sun</surname>, <given-names>S.</given-names></string-name>, <string-name><surname>Reddy</surname>, <given-names>B.</given-names></string-name> &amp; <string-name><surname>Irvine</surname>, <given-names>K.</given-names></string-name></person-group> <article-title>Localization of Hippo signalling complexes and Warts activation in vivo</article-title>. <source>Nat Commun</source> <volume>6</volume>, <fpage>8402</fpage> (<year>2015</year>).</mixed-citation></ref>
<ref id="c2"><label>2.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Tomancak</surname>, <given-names>P.</given-names></string-name> <etal>et al.</etal></person-group> <article-title>Global analysis of patterns of gene expression during Drosophila embryogenesis</article-title>. <source>Genome Biol</source>. <volume>8</volume>, <fpage>R145</fpage> (<year>2007</year>).</mixed-citation></ref>
<ref id="c3"><label>3.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Macosko</surname>, <given-names>E.Z.</given-names></string-name> <etal>et al.</etal></person-group> (<year>2015</year>) <article-title>‘Highly parallel genome-wide expression profiling of individual cells using Nanoliter droplets’</article-title>, <source>Cell</source>, <volume>161</volume>(<issue>5</issue>), pp. <fpage>1202</fpage>–<lpage>1214</lpage>. doi:<pub-id pub-id-type="doi">10.1016/j.cell.2015.05.002</pub-id>.</mixed-citation></ref>
<ref id="c4"><label>4.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Rodriques</surname>, <given-names>S.G.</given-names></string-name> <etal>et al.</etal></person-group> (<year>2019</year>) <article-title>‘Slide-seq: A scalable technology for measuring genome-wide expression at high spatial resolution’</article-title>, <source>Science</source>, <volume>363</volume>(<issue>6434</issue>), pp. <fpage>1463</fpage>–<lpage>1467</lpage>. doi:<pub-id pub-id-type="doi">10.1126/science.aaw1219</pub-id>.</mixed-citation></ref>
<ref id="c5"><label>5.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ståhl</surname> <given-names>PL</given-names></string-name>, <string-name><surname>Salmén</surname> <given-names>F</given-names></string-name>, <string-name><surname>Vickovic</surname> <given-names>S</given-names></string-name>, <etal>et al.</etal></person-group> (<year>2016</year>). <article-title>Visualization and analysis of gene expression in tissue sections by spatial transcriptomics</article-title>. <source>Science</source>, <volume>353</volume>(<issue>6294</issue>), <fpage>78</fpage>–<lpage>82</lpage>.</mixed-citation></ref>
<ref id="c6"><label>6.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Cui</surname> <given-names>C</given-names></string-name>, <string-name><surname>Shu</surname> <given-names>W</given-names></string-name>, <string-name><surname>Li</surname> <given-names>P.</given-names></string-name></person-group> <article-title>Fluorescence In situ Hybridization: Cell-Based Genetic Diagnostic and Research Applications</article-title>. <source>Front Cell Dev Biol</source>. <year>2016</year>;<volume>4</volume>:<fpage>89</fpage>. Published 2016 Sep 5. doi:<pub-id pub-id-type="doi">10.3389/fcell.2016.00089</pub-id></mixed-citation></ref>
<ref id="c7"><label>7.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Cable</surname>, <given-names>D.M.</given-names></string-name> <etal>et al.</etal></person-group> (<year>2021</year>) <article-title>‘Robust decomposition of cell type mixtures in spatial transcriptomics’</article-title>, <source>Nature Biotechnology</source>, <volume>40</volume>(<issue>4</issue>), pp. <fpage>517</fpage>–<lpage>526</lpage>. doi:<pub-id pub-id-type="doi">10.1038/s41587-021-00830-w</pub-id>.</mixed-citation></ref>
<ref id="c8"><label>8.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Kleshchevnikov</surname>, <given-names>V.</given-names></string-name> <etal>et al.</etal></person-group> (<year>2022</year>) <article-title>‘Cell2location maps fine-grained cell types in spatial transcriptomics’</article-title>, <source>Nature Biotechnology</source>, <volume>40</volume>(<issue>5</issue>), pp. <fpage>661</fpage>–<lpage>671</lpage>. doi:<pub-id pub-id-type="doi">10.1038/s41587-021-01139-4</pub-id>.</mixed-citation></ref>
<ref id="c9"><label>9.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Moncada</surname>, <given-names>R.</given-names></string-name> <etal>et al.</etal></person-group> (<year>2020</year>) <article-title>‘Integrating microarray-based spatial transcriptomics and single-cell RNA-seq reveals tissue architecture in pancreatic ductal adenocarcinomas’</article-title>, <source>Nature Biotechnology</source>, <volume>38</volume>(<issue>3</issue>), pp. <fpage>333</fpage>–<lpage>342</lpage>. doi:<pub-id pub-id-type="doi">10.1038/s41587-019-0392-8</pub-id>.</mixed-citation></ref>
<ref id="c10"><label>10.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Nitzan</surname> <given-names>M</given-names></string-name>, <string-name><surname>Karaiskos</surname> <given-names>N</given-names></string-name>, <string-name><surname>Friedman</surname> <given-names>N</given-names></string-name>, <string-name><surname>Rajewsky</surname> <given-names>N.</given-names></string-name></person-group> <article-title>Gene expression cartography</article-title>. <source>Nature</source>. <year>2019</year>;<volume>576</volume>(<issue>7785</issue>):<fpage>132</fpage>–<lpage>137</lpage>. doi:<pub-id pub-id-type="doi">10.1038/s41586-019-1773-3</pub-id></mixed-citation></ref>
<ref id="c11"><label>11.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Karaiskos</surname> <given-names>N</given-names></string-name>, <string-name><surname>Wahle</surname> <given-names>P</given-names></string-name>, <string-name><surname>Alles</surname> <given-names>J</given-names></string-name>, <string-name><surname>Boltengagen</surname> <given-names>A</given-names></string-name>, <string-name><surname>Ayoub</surname> <given-names>S</given-names></string-name>, <string-name><surname>Kipar</surname> <given-names>C</given-names></string-name>, <string-name><surname>Kocks</surname> <given-names>C</given-names></string-name>, <string-name><surname>Rajewsky</surname> <given-names>N</given-names></string-name>, <string-name><surname>Zinzen</surname> <given-names>RP</given-names></string-name></person-group>. <article-title>The Drosophila embryo at single-cell transcriptome resolution</article-title>. <source>Science</source>. <year>2017</year> <month>Oct</month> 13;<volume>358</volume>(<issue>6360</issue>):<fpage>194</fpage>–<lpage>199</lpage>. doi: <pub-id pub-id-type="doi">10.1126/science.aan3235</pub-id>. Epub 2017 Aug 31. PMID: <pub-id pub-id-type="pmid">28860209</pub-id>.</mixed-citation></ref>
<ref id="c12"><label>12.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wei</surname>, <given-names>R.</given-names></string-name> <etal>et al.</etal></person-group> (<year>2022</year>) <article-title>‘Spatial charting of single-cell transcriptomes in tissues’</article-title>, <source>Nature Biotechnology</source>, <volume>40</volume>(<issue>8</issue>), pp. <fpage>1190</fpage>–<lpage>1199</lpage>. doi:<pub-id pub-id-type="doi">10.1038/s41587-022-01233-1</pub-id>.</mixed-citation></ref>
<ref id="c13"><label>13.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Biancalani</surname>, <given-names>T.</given-names></string-name> <etal>et al.</etal></person-group> (<year>2021</year>) <article-title>‘Deep learning and alignment of spatially resolved single-cell transcriptomes with Tangram’</article-title>, <source>Nature Methods</source>, <volume>18</volume>(<issue>11</issue>), pp. <fpage>1352</fpage>–<lpage>1362</lpage>. doi:<pub-id pub-id-type="doi">10.1038/s41592-021-01264-7</pub-id></mixed-citation></ref>
<ref id="c14"><label>14.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wan</surname>, <given-names>Xiaomeng</given-names></string-name> <etal>et al.</etal></person-group> (<year>2023a</year>) <article-title>‘Integrating spatial and single-cell transcriptomics data using deep generative models with SpatialScope’</article-title>, <source>Nature Communications</source>, <volume>14</volume>(<issue>1</issue>). doi:<pub-id pub-id-type="doi">10.1038/s41467-023-43629-w</pub-id>.</mixed-citation></ref>
<ref id="c15"><label>15.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Ma</surname>, <given-names>Y.</given-names></string-name> and <string-name><surname>Zhou</surname>, <given-names>X.</given-names></string-name></person-group> (<year>2022</year>) <article-title>‘Spatially informed cell-type deconvolution for spatial transcriptomics’</article-title>, <source>Nature Biotechnology</source>, <volume>40</volume>(<issue>9</issue>), pp. <fpage>1349</fpage>–<lpage>1359</lpage>. doi:<pub-id pub-id-type="doi">10.1038/s41587-022-01273-7</pub-id>.</mixed-citation></ref>
<ref id="c16"><label>16.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhang</surname>, <given-names>W.</given-names></string-name> <etal>et al.</etal></person-group> (<year>2013</year>) <article-title>‘Molecular pathway identification using biological network-regularized Logistic Models’</article-title>, <source>BMC Genomics</source>, <volume>14</volume>(<issue>S8</issue>). doi:<pub-id pub-id-type="doi">10.1186/1471-2164-14-s8-s7</pub-id>.</mixed-citation></ref>
<ref id="c17"><label>17.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Picelli</surname>, <given-names>S.</given-names></string-name> <etal>et al.</etal></person-group> (<year>2014</year>) <article-title>‘Full-length RNA-seq from single cells using SMART-SEQ2’</article-title>, <source>Nature Protocols</source>, <volume>9</volume>(<issue>1</issue>), pp. <fpage>171</fpage>–<lpage>181</lpage>. doi:<pub-id pub-id-type="doi">10.1038/nprot.2014.006</pub-id>.</mixed-citation></ref>
<ref id="c18"><label>18.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Satija</surname> <given-names>R</given-names></string-name>, <string-name><surname>Farrell</surname> <given-names>J</given-names></string-name>, <string-name><surname>Gennert</surname> <given-names>D</given-names></string-name>, <string-name><surname>Schier</surname> <given-names>A</given-names></string-name>, <string-name><surname>Regev</surname> <given-names>A.</given-names></string-name></person-group> <article-title>Spatial reconstruction of single-cell gene expression data</article-title>. <source>Nat Biotechnol</source>. <year>2015</year>;<volume>33</volume>(<issue>5</issue>):<fpage>495</fpage>–<lpage>502</lpage>. doi:<pub-id pub-id-type="doi">10.1038/nbt.3192</pub-id></mixed-citation></ref>
<ref id="c19"><label>19.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Jones</surname>, <given-names>A. R.</given-names></string-name>, <string-name><surname>Overly</surname>, <given-names>C. C.</given-names></string-name>, &amp; <string-name><surname>Sunkin</surname>, <given-names>S.M.</given-names></string-name></person-group> (<year>2009</year>). <article-title>The Allen Brain Atlas: 5 years and beyond</article-title>. <source>Nature Reviews Neuroscience</source>, <volume>10</volume>(<issue>12</issue>), <fpage>821</fpage>–<lpage>828</lpage>. <pub-id pub-id-type="doi">10.1038/nrn2733</pub-id></mixed-citation></ref>
<ref id="c20"><label>20.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Lein</surname>, <given-names>E.</given-names></string-name>, <string-name><surname>Hawrylycz</surname>, <given-names>M.</given-names></string-name>, <string-name><surname>Ao</surname>, <given-names>N.</given-names></string-name> <etal>et al.</etal></person-group> <article-title>Genome-wide atlas of gene expression in the adult mouse brain</article-title>. <source>Nature</source> <volume>445</volume>, <fpage>168</fpage>–<lpage>176</lpage> (<year>2007</year>). <pub-id pub-id-type="doi">10.1038/nature05453</pub-id></mixed-citation></ref>
<ref id="c21"><label>21.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Moor</surname>, <given-names>A. E.</given-names></string-name>, <etal>et al.</etal></person-group>, <article-title>Spatial reconstruction of single enterocytes uncovers broad zonation along the intestinal villus axis</article-title>. <source>Cell</source> <volume>175</volume>, <fpage>1156</fpage>–<lpage>1167</lpage> (<year>2018</year>).</mixed-citation></ref>
<ref id="c22"><label>22.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Yanik</surname>, <given-names>M. F.</given-names></string-name>, <string-name><surname>Custer</surname>, <given-names>T. W.</given-names></string-name>, &amp; <string-name><surname>Kunes</surname>, <given-names>S.</given-names></string-name></person-group> (<year>2015</year>). <article-title>The temporal dynamics of gene expression in the Drosophila brain reveal developmental patterns and functional networks</article-title>. <source>Nature</source>, <volume>520</volume>(<issue>7548</issue>), <fpage>332</fpage>–<lpage>338</lpage>. <pub-id pub-id-type="doi">10.1038/nature14279</pub-id></mixed-citation></ref>
<ref id="c23"><label>23.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Thurmond</surname> <given-names>J</given-names></string-name>, <string-name><surname>Goodman</surname> <given-names>JL</given-names></string-name>, <string-name><surname>Strelets</surname> <given-names>VB</given-names></string-name>, <string-name><surname>Attrill</surname> <given-names>H</given-names></string-name>, <string-name><surname>Gramates</surname> <given-names>LS</given-names></string-name>, <string-name><surname>Marygold</surname> <given-names>SJ</given-names></string-name>, <string-name><surname>Matthews</surname> <given-names>BB</given-names></string-name>, <string-name><surname>Millburn</surname> <given-names>G</given-names></string-name>, <string-name><surname>Antonazzo</surname> <given-names>G</given-names></string-name>, <string-name><surname>Trovisco</surname> <given-names>V</given-names></string-name>, <string-name><surname>Kaufman</surname> <given-names>TC</given-names></string-name>, <string-name><surname>Calvi</surname> <given-names>BR</given-names></string-name> and <collab>the FlyBase Consortium</collab></person-group>. (<year>2019</year>) <article-title>FlyBase 2.0: the next generation</article-title>. <source>Nucleic Acids Res</source>. <volume>47</volume>(<issue>D1</issue>) <fpage>D759</fpage>–<lpage>D765</lpage></mixed-citation></ref>
<ref id="c24"><label>24.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Okochi</surname>, <given-names>Y.</given-names></string-name> <etal>et al.</etal></person-group> (<year>2021</year>) <article-title>‘Model-based prediction of spatial gene expression via generative linear mapping’</article-title>, <source>Nature Communications</source>, <volume>12</volume>(<issue>1</issue>). doi:<pub-id pub-id-type="doi">10.1038/s41467-021-24014-x</pub-id>.</mixed-citation></ref>
<ref id="c25"><label>25.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Saunders</surname> <given-names>A*</given-names></string-name>, <string-name><surname>Macosko</surname> <given-names>E.Z*</given-names></string-name>, <string-name><surname>Wysoker</surname> <given-names>A</given-names></string-name>, <string-name><surname>Goldman</surname> <given-names>M</given-names></string-name>, <string-name><surname>Krienen</surname>, <given-names>F</given-names></string-name>, <string-name><surname>de Rivera</surname> <given-names>H</given-names></string-name>, <string-name><surname>Bien</surname> <given-names>E</given-names></string-name>, <string-name><surname>Baum</surname> <given-names>M</given-names></string-name>, <string-name><surname>Wang</surname> <given-names>S</given-names></string-name>, <string-name><surname>Bortolin</surname> <given-names>L</given-names></string-name>, <string-name><surname>Goeva</surname> <given-names>A</given-names></string-name>, <string-name><surname>Nemesh</surname> <given-names>J</given-names></string-name>, <string-name><surname>Kamitaki</surname> <given-names>N</given-names></string-name>, <string-name><surname>Brumbaugh</surname> <given-names>S</given-names></string-name>, <string-name><surname>Kulp</surname> <given-names>D</given-names></string-name> and <string-name><surname>McCarroll</surname>, <given-names>S.A.</given-names></string-name></person-group> <year>2018</year>. <article-title>Molecular Diversity and Specializations among the Cells of the Adult Mouse Brain. 2018</article-title>. <source>Cell</source>. <volume>174</volume>(<issue>4</issue>) <fpage>P1015</fpage>-<lpage>1030.E16</lpage></mixed-citation></ref>
<ref id="c26"><label>26.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Wang</surname> <given-names>X</given-names></string-name>, <string-name><surname>Allen</surname> <given-names>W</given-names></string-name>, <string-name><surname>Wright</surname> <given-names>M</given-names></string-name> <etal>et al.</etal></person-group> <article-title>Three-dimensional intact-tissue sequencing of single-cell transcriptional states</article-title>. <source>Science (1979)</source>. <year>2018</year>;<volume>361</volume>(<issue>6400</issue>):<fpage>eaat5691</fpage>. doi:<pub-id pub-id-type="doi">10.1126/science.aat5691</pub-id></mixed-citation></ref>
<ref id="c27"><label>27.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Zhu</surname> <given-names>Q</given-names></string-name>, <string-name><surname>Shah</surname> <given-names>S</given-names></string-name>, <string-name><surname>Dries</surname> <given-names>R</given-names></string-name>, <string-name><surname>Cai</surname> <given-names>L</given-names></string-name>, <string-name><surname>Yuan</surname> <given-names>GC</given-names></string-name></person-group>. <article-title>Identification of spatially associated subpopulations by combining scRNAseq and sequential fluorescence in situ hybridization data</article-title>. <source>Nat Biotechnol</source> <volume>36</volume>, <fpage>1183</fpage>–<lpage>1190</lpage> <year>2018</year>. doi:<pub-id pub-id-type="doi">10.1038/nbt.4260</pub-id></mixed-citation></ref>
<ref id="c28"><label>28.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Shapiro</surname>, <given-names>E.</given-names></string-name>, <string-name><surname>Biezuner</surname>, <given-names>T.</given-names></string-name> &amp; <string-name><surname>Linnarsson</surname>, <given-names>S.</given-names></string-name></person-group> <article-title>Single-cell sequencing-based technologies will revolutionize whole-organism science</article-title>. <source>Nat Rev Genet</source> <volume>14</volume>, <fpage>618</fpage>–<lpage>630</lpage> (<year>2013</year>). <pub-id pub-id-type="doi">10.1038/nrg3542</pub-id></mixed-citation></ref>
<ref id="c29"><label>29.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Stickels</surname>, <given-names>R.R.</given-names></string-name> <etal>et al.</etal></person-group> (<year>2020</year>) <article-title>‘Highly sensitive spatial transcriptomics at near-cellular resolution with Slide-SEQV2’</article-title>, <source>Nature Biotechnology</source>, <volume>39</volume>(<issue>3</issue>), pp. <fpage>313</fpage>–<lpage>319</lpage>. doi:<pub-id pub-id-type="doi">10.1038/s41587-020-0739-1</pub-id>.</mixed-citation></ref>
<ref id="c30"><label>30.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Cembrowski</surname> <given-names>MS</given-names></string-name>, <string-name><surname>Wang</surname> <given-names>L</given-names></string-name>, <string-name><surname>Sugino</surname> <given-names>K</given-names></string-name>, <string-name><surname>Shields</surname> <given-names>BC</given-names></string-name>, <string-name><surname>Spruston</surname> <given-names>N.</given-names></string-name></person-group> <article-title>Hipposeq: a comprehensive RNA-seq database of gene expression in hippocampal principal neurons</article-title>. <source>eLife</source>. <year>2016</year>;<volume>5</volume>:<elocation-id>e14997</elocation-id>. Published 2016 Apr 26. doi:<pub-id pub-id-type="doi">10.7554/eLife.14997</pub-id></mixed-citation></ref>
<ref id="c31"><label>31.</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><surname>Tasic</surname>, <given-names>B.</given-names></string-name> <etal>et al.</etal></person-group> <article-title>Adult mouse cortical cell taxonomy revealed by single cell transcriptomics</article-title>. <source>Nat. Neurosci</source>. <volume>19</volume>, <fpage>335</fpage>–<lpage>346</lpage> (<year>2016</year>).</mixed-citation></ref>
</ref-list>
</back>
<sub-article id="sa0" article-type="editor-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.105589.1.sa4</article-id>
<title-group>
<article-title>eLife Assessment</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<name>
<surname>Choi</surname>
<given-names>Jungmin</given-names>
</name>
<role specific-use="editor">Reviewing Editor</role>
<aff>
<institution-wrap>
<institution>Korea University</institution>
</institution-wrap>
<city>Seoul</city>
<country>Republic of Korea</country>
</aff>
</contrib>
</contrib-group>
<kwd-group kwd-group-type="evidence-strength">
<kwd>Incomplete</kwd>
</kwd-group>
<kwd-group kwd-group-type="claim-importance">
<kwd>Useful</kwd>
</kwd-group>
</front-stub>
<body>
<p>The study is <bold>useful</bold> for advancing spatial transcriptomics through its novel regression-based linear model (glmSMA) that integrates single-cell RNA-seq with spatial reference atlases, though its methodological framework remains <bold>incomplete</bold> regarding spatial communication applications and feature dependence. The approach demonstrates notable utility by enabling higher-resolution cell mapping across multiple biological systems and spatial platforms compared to existing tools.</p>
</body>
</sub-article>
<sub-article id="sa1" article-type="referee-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.105589.1.sa3</article-id>
<title-group>
<article-title>Reviewer #1 (Public review):</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<anonymous/>
<role specific-use="referee">Reviewer</role>
</contrib>
</contrib-group>
</front-stub>
<body>
<p>Liu et al., present glmSMA, a network-regularized linear model that integrates single-cell RNA-seq data with spatial transcriptomics, enabling high-resolution mapping of cellular locations across diverse datasets. Its dual regularization framework (L1 for sparsity and generalized L2 via a graph Laplacian for spatial smoothness) demonstrates robust performance of their model and offers novel tools for spatial biology, despite some gaps in fully addressing spatial communication.</p>
<p>Overall, the manuscript is commendable for its comprehensive benchmarking across different spatial omics platforms and its novel application of regularized linear models for cell mapping. I think this manuscript can be improved by addressing method assumptions, expanding the discussion on feature dependence and cell type-specific biases, and clarifying the mechanism of spatial communication.</p>
<p>The conclusions of this paper are mostly well supported by data, but some aspects of model development and performance evaluation need to be clarified and extended.</p>
<p>(1) What were the assumptions made behind the model? One of them could be the linear relationship between cellular gene expression and spatial location. In complex biological tissues, non-linear relationships could be present, and this would also vary across organ systems and species. Similarly, with regularization parameters, they can be tuned to balance sparsity and smoothness adequately but may not hold uniformly across different tissue types or data quality levels. The model also seems to assume independent errors with normal distribution and linear additive effects - a simplification that may overlook overdispersion or heteroscedasticity commonly observed in RNA-seq data.</p>
<p>(2) The performance of glmSMA is likely sensitive to the number and quality of features used. With too few features, the model may struggle to anchor cells correctly due to insufficient discriminatory power, whereas too many features could lead to overfitting unless appropriately regularized. The manuscript briefly acknowledges this issue, but further systematic evaluation of how varying feature numbers affect mapping accuracy would strengthen the claims, particularly in settings where marker gene availability is limited. A simple way to show some of this would be testing on multiple spatial omics (imaging-based) platforms with varying panel sizes and organ systems. Related to this, based on the figures, it also seems like the performance varies by cell type. What are the factors that contribute to this? Variability in expression levels, RNA quantity/quality? Biases in the panel? Personally, I am also curious how this model can be used similarly/differently if we have a FISH-based, high-plex reference atlas. Additional explanation around these points would be helpful for the readers.</p>
<p>(3) Application 3 (spatial communication) in the graphical abstract appears relatively underdeveloped. While it is clear that the model infers spatial proximities, further explanation of how these mappings translate into insights into cell-cell communication networks would enhance the biological relevance of the findings.</p>
<p>(4) What is the final resolution of the model outputs? I am assuming this is dictated by the granularity of the reference atlas and the imposed sparsity via the L1 norm, but if there are clear examples that would be good. In figures (or maybe in practice too), cells seem to be assigned to small, contiguous patches rather than pinpoint single-cell locations, which is a pragmatic compromise given the inherent limitations of current spatial transcriptomics technologies. Clarification on the precise spatial scale (e.g., pixel or micrometer resolution) and any post-mapping refinement steps would be beneficial for the users to make informed decisions on the right bioinformatic tools to use.</p>
</body>
</sub-article>
<sub-article id="sa2" article-type="referee-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.105589.1.sa2</article-id>
<title-group>
<article-title>Reviewer #2 (Public review):</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<anonymous/>
<role specific-use="referee">Reviewer</role>
</contrib>
</contrib-group>
</front-stub>
<body>
<p>Summary:</p>
<p>The author proposes a novel method for mapping single-cell data to specific locations with higher resolution than several existing tools.</p>
<p>Strengths:</p>
<p>The spatial mapping tests were conducted on various tissues, including the mouse cortex, human PDAC, and intestinal villus.</p>
<p>Weaknesses:</p>
<p>(1) Although the researchers claim that glmSMA seamlessly accommodates both sequencing-based and image-based spatial transcriptomics (ST) data, their testing primarily focused on sequencing-based ST data, such as Visium and Slide-seq. To demonstrate its versatility for spatial analysis, the authors should extend their evaluation to imaging-based spatial data.</p>
<p>(2) The definition of &quot;ground truth&quot; for spatial distribution is unclear. A more detailed explanation is needed on how the &quot;ground truth&quot; was established for each spatial dataset and how it was utilized for comparison with the predicted distribution generated by various spatial mapping tools.</p>
<p>(3) In the analysis of spatial mapping results using intestinal villus tissue, only Figure 3d supports their findings. The researchers should consider adding supplemental figures illustrating the spatial distribution of single cells in comparison to the ground truth distribution to enhance the clarity and robustness of their investigation.</p>
<p>(4) The spatial mapping tests were conducted on various tissues, including the mouse cortex, human PDAC, and intestinal villus. However, the original anatomical regions are not displayed, making it difficult to directly compare them with the predicted mapping results. Providing ground truth distributions for each tested tissue would enhance clarity and facilitate interpretation. For instance, in Figure 2a and Supplementary Figures 1 and 2, only the predicted mapping results are shown without the corresponding original spatial distribution of regions in the mouse cortex. Additionally, in Figure 3c, four anatomical regions are displayed, but it is unclear whether the figure represents the original spatial regions or those predicted by glmSMA. The authors are encouraged to clarify this by incorporating ground truth distributions for each tissue.</p>
<p>(5) The cell assignment results from the mouse hippocampus (Supplementary Figure 6) lack a corresponding ground truth distribution for comparison. DG and CA cells were evaluated solely based on the gene expression of specific marker genes. Additional analyses are needed to further validate the robustness of glmSMA's mapping performance on Slide-seq data from the mouse hippocampus.</p>
<p>(6) The tested spatial datasets primarily consist of highly structured tissues with well-defined anatomical regions, such as the brain and intestinal villus. It remains unclear whether glmSMA can be effectively applied to tissue types where anatomical regions are not distinctly separated, such as liver tissue. Further evaluation of such tissues would help determine the method's broader applicability.</p>
</body>
</sub-article>
<sub-article id="sa3" article-type="referee-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.105589.1.sa1</article-id>
<title-group>
<article-title>Reviewer #3 (Public review):</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<anonymous/>
<role specific-use="referee">Reviewer</role>
</contrib>
</contrib-group>
</front-stub>
<body>
<p>Summary:</p>
<p>The authors aim to develop glmSMA, a network-regularized linear model that accurately infers spatial gene expression patterns by integrating single-cell RNA sequencing data with spatial transcriptomics reference atlases. Their goal is to reconstruct the spatial organization of individual cells within tissues, overcoming the limitations of existing methods that either lack spatial resolution or sensitivity.</p>
<p>Strengths:</p>
<p>(1) Comprehensive Benchmarking:</p>
<p>Compared against CellTrek and Novosparc, glmSMA consistently achieved lower Kullback-Leibler divergence (KL divergence) scores, indicating better cell assignment accuracy.</p>
<p>Outperformed CellTrek in mouse cortex mapping (90% accuracy vs. CellTrek's 60%) and provided more spatially coherent distributions.</p>
<p>(2) Experimental Validation with Multiple Real-World Datasets:</p>
<p>The study used multiple biological systems (mouse brain, Drosophila embryo, human PDAC, intestinal villus) to demonstrate generalizability.</p>
<p>Validation through correlation analyses, Pearson's coefficient, and KL divergence support the accuracy of glmSMA's predictions.</p>
<p>Weaknesses:</p>
<p>(1) The accuracy of glmSMA depends on the selection of marker genes, which might be limited by current FISH-based reference atlases.</p>
<p>(2) glmSMA operates under the assumption that cells with similar gene expression profiles are likely to be physically close to each other in space which not be true under various heterogeneous environments.</p>
</body>
</sub-article>
<sub-article id="sa4" article-type="author-comment">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.105589.1.sa0</article-id>
<title-group>
<article-title>Author response:</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<name>
<surname>Gu</surname>
<given-names>Chaohao</given-names>
</name>
<role specific-use="author">Author</role>
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-8085-0317</contrib-id></contrib>
<contrib contrib-type="author">
<name>
<surname>Chen</surname>
<given-names>Hu</given-names>
</name>
<role specific-use="author">Author</role>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Liu</surname>
<given-names>Zhandong</given-names>
</name>
<role specific-use="author">Author</role>
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-7608-0831</contrib-id></contrib>
</contrib-group>
</front-stub>
<body>
<disp-quote content-type="editor-comment">
<p><bold>Reviewer #1 (Public review):</bold></p>
<p>Summary:</p>
<p>Liu et al., present glmSMA, a network-regularized linear model that integrates single-cell RNA-seq data with spatial transcriptomics, enabling high-resolution mapping of cellular locations across diverse datasets. Its dual regularization framework (L1 for sparsity and generalized L2 via a graph Laplacian for spatial smoothness) demonstrates robust performance of their model and offers novel tools for spatial biology, despite some gaps in fully addressing spatial communication.</p>
<p>Overall, the manuscript is commendable for its comprehensive benchmarking across different spatial omics platforms and its novel application of regularized linear models for cell mapping. I think this manuscript can be improved by addressing method assumptions, expanding the discussion on feature dependence and cell type-specific biases, and clarifying the mechanism of spatial communication.</p>
<p>The conclusions of this paper are mostly well supported by data, but some aspects of model development and performance evaluation need to be clarified and extended.</p>
</disp-quote>
<p>We thank the reviewer for their thoughtful comments. We will clarify the model assumptions and the feature selection process to make it more understandable. To clarify, the performance of glmSMA does not depend on cell type. For some rare cell types, the small number of cells can lead to a drop in performance. To better illustrate our results and reduce cell type-specific biases, we will shuffle and randomly sample the cell types.</p>
<disp-quote content-type="editor-comment">
<p>(1) What were the assumptions made behind the model? One of them could be the linear relationship between cellular gene expression and spatial location. In complex biological tissues, non-linear relationships could be present, and this would also vary across organ systems and species. Similarly, with regularization parameters, they can be tuned to balance sparsity and smoothness adequately but may not hold uniformly across different tissue types or data quality levels. The model also seems to assume independent errors with normal distribution and linear additive effects - a simplification that may overlook overdispersion or heteroscedasticity commonly observed in RNA-seq data.</p>
</disp-quote>
<p>Thank you for this comment. We acknowledge that the non-linear relationships can be present in complex tissues and may not be fully captured by a linear model.</p>
<p>Our choice of a linear model was guided by an investigation of the relationship in the current datasets, which include intestinal villus, mouse brain, and fly embryo.</p>
<p>There is a linear correlation between expression distance and physical distance [Nitzan et al]. Within a given anatomical structure, cells in closer proximity exhibit more similar expression patterns. In tissues where non-linear relationships are more prevalent—such as the human PDAC sample—our mapping results remain robust. We acknowledge that we have not yet tested our algorithm in highly heterogeneous regions like the liver, and we plan to include such analyses in future work if necessary. Regarding the regularization parameters, we agree that the balance between sparsity and smoothness is sensitive to tissue-specific variation and data quality. In our current implementation, we explored a range of values to find robust defaults.</p>
<disp-quote content-type="editor-comment">
<p>(2) The performance of glmSMA is likely sensitive to the number and quality of features used. With too few features, the model may struggle to anchor cells correctly due to insufficient discriminatory power, whereas too many features could lead to overfitting unless appropriately regularized. The manuscript briefly acknowledges this issue, but further systematic evaluation of how varying feature numbers affect mapping accuracy would strengthen the claims, particularly in settings where marker gene availability is limited. A simple way to show some of this would be testing on multiple spatial omics (imaging-based) platforms with varying panel sizes and organ systems. Related to this, based on the figures, it also seems like the performance varies by cell type. What are the factors that contribute to this? Variability in expression levels, RNA quantity/quality? Biases in the panel? Personally, I am also curious how this model can be used similarly/differently if we have a FISH-based, high-plex reference atlas. Additional explanation around these points would be helpful for the readers.</p>
</disp-quote>
<p>Thank you for this thoughtful comment. The performance of our method is indeed sensitive to the number and quality of selected features. To optimize feature selection, we employed multiple strategies, including Moran’s I statistic, identification of highly variable genes, and the Seurat pipeline to detect anchor genes linking the spatial transcriptomics data with the reference atlas. The number of selected markers depends on the quality of the data. For high-quality datasets, fewer than 100 markers are typically sufficient for accurate prediction. To address this more clearly, we will revise the manuscript to include detailed descriptions of our feature selection process and demonstrate how varying the number of selected features impacts performance.</p>
<p>We evaluated our method across diverse tissue types and platforms—including Slide-seq, 10x Visium, and Virtual-FISH—which represent both sequencing-based and imaging-based spatial transcriptomics technologies. Our model consistently achieved strong performance across these settings. It's worth noting that the performance of other methods, such as CellTrek [Wei et al] and novoSpaRc [Nitzan et al], also depends heavily on feature selection. In particular, performance degrades substantially when fewer features are used.</p>
<p>We do not believe that the observed performance is directly influenced by cell type composition. Major cell types are typically well-defined, and rare cell types comprise only a small fraction of the dataset. For these rare populations, a single misclassification can disproportionately impact metrics like KL divergence due to small sample size. However, this does not necessarily indicate a systematic cell type–specific bias in the mapping. To mitigate this issue, we will implement shuffling and sampling procedures to reduce potential bias introduced by rare cell types.</p>
<disp-quote content-type="editor-comment">
<p>(3) Application 3 (spatial communication) in the graphical abstract appears relatively underdeveloped. While it is clear that the model infers spatial proximities, further explanation of how these mappings translate into insights into cell-cell communication networks would enhance the biological relevance of the findings.</p>
</disp-quote>
<p>Thank you for this valuable feedback. We agree that further elaboration on the connection between spatial proximity and cell–cell communication would enhance the biological interpretation of our results. While our current model focuses on inferring spatial relationships, we may provide some cell-cell communications in the future.</p>
<disp-quote content-type="editor-comment">
<p>(4) What is the final resolution of the model outputs? I am assuming this is dictated by the granularity of the reference atlas and the imposed sparsity via the L1 norm, but if there are clear examples that would be good. In figures (or maybe in practice too), cells seem to be assigned to small, contiguous patches rather than pinpoint single-cell locations, which is a pragmatic compromise given the inherent limitations of current spatial transcriptomics technologies. Clarification on the precise spatial scale (e.g., pixel or micrometer resolution) and any post-mapping refinement steps would be beneficial for the users to make informed decisions on the right bioinformatic tools to use.</p>
</disp-quote>
<p>Thank you for the comment. For each cell, our algorithm generates a probability vector that indicates its likely spatial assignment along with coordinate information. We will include the resolution and the number of cells assigned to each spot in future versions. In our framework, each cell is mapped to one or more spatial locations with associated probabilities. Depending on the amount of regularization through L1 and L2 norms, a cell may be localized to a small patch or distributed over a broader domain. For the 10x Visium data, we applied a repelling algorithm to enhance visualization [Wei et al]. If a cell’s original location is already occupied, it is reassigned to a nearby neighborhood to avoid overlap. The users can also see the entire regularization path by varying the penalty terms.</p>
<p>Nitzan M, Karaiskos N, Friedman N, Rajewsky N. Gene expression cartography. Nature. 2019;576(7785):132-137. doi:10.1038/s41586-019-1773-3</p>
<p>Wei, R. et al. (2022) ‘Spatial charting of single-cell transcriptomes in tissues’, Nature Biotechnology, 40(8), pp. 1190–1199. doi:10.1038/s41587-022-01233-1.</p>
<disp-quote content-type="editor-comment">
<p><bold>Reviewer #2 (Public review):</bold></p>
<p>Summary:</p>
<p>The author proposes a novel method for mapping single-cell data to specific locations with higher resolution than several existing tools.</p>
</disp-quote>
<p>Thank you for recognizing our contribution. Our goal was to develop a method that achieves higher spatial resolution in mapping single-cell data compared to existing tools. We are encouraged by the results and will continue to refine the approach to improve accuracy and generalizability across platforms and tissue types.</p>
<disp-quote content-type="editor-comment">
<p>Strengths:</p>
<p>The spatial mapping tests were conducted on various tissues, including the mouse cortex, human PDAC, and intestinal villus.</p>
</disp-quote>
<p>Thank you for this comment. We believe that evaluating our method across diverse tissue types—such as the mouse cortex, human PDAC, and intestinal villus—demonstrates its robustness and broad applicability. We plan to continue expanding these evaluations to additional tissue contexts and species to further validate the method’s generalizability.</p>
<disp-quote content-type="editor-comment">
<p>Weakness:</p>
<p>(1) Although the researchers claim that glmSMA seamlessly accommodates both sequencing-based and image-based spatial transcriptomics (ST) data, their testing primarily focused on sequencing-based ST data, such as Visium and Slide-seq. To demonstrate its versatility for spatial analysis, the authors should extend their evaluation to imaging-based spatial data.</p>
</disp-quote>
<p>Thank you for the comment. We have tested our algorithm on the virtual FISH dataset from the fly embryo, which serves as an example of image-based spatial omics data. However, such datasets often contain a limited number of available genes. To address this, we will conduct additional testing on image-based data if needed. The Allen Brain Atlas provides high-quality ISH data, and we can select specific brain regions from this resource to further evaluate our algorithm if necessary [Lein et al]. Currently, we plan to focus more on the 10x Visium platform, as it supports whole-transcriptome profiling and offers a wide range of tissue samples for analysis.</p>
<disp-quote content-type="editor-comment">
<p>(2) The definition of &quot;ground truth&quot; for spatial distribution is unclear. A more detailed explanation is needed on how the &quot;ground truth&quot; was established for each spatial dataset and how it was utilized for comparison with the predicted distribution generated by various spatial mapping tools.</p>
</disp-quote>
<p>Thank you for the comment. To clarify how ground truth is defined across different tissues, we provide the following details. Direct ground truth for cell locations is often unavailable in scRNA-seq data due to experimental constraints. To address this, we adopted alternative strategies for estimating ground truth in each dataset:</p>
<p>- 10x Visium Data: We used the cell type distribution derived from spatial transcriptomics (ST) data as a proxy for ground truth. We then computed the KL divergence between this distribution and our model's predictions for performance assessment.</p>
<p>- Slide-seq Data: We validated predictions by comparing the expression of marker genes between the reconstructed and original spatial data.</p>
<p>- Fly Embryo Data: We used predicted cell locations from novoSpaRc as a reference for evaluating our algorithm.</p>
<p>These strategies allowed us to evaluate model performance even in the absence of direct cell location data. In addition, we can apply multiple evaluation strategies within a single dataset.</p>
<disp-quote content-type="editor-comment">
<p>(3) In the analysis of spatial mapping results using intestinal villus tissue, only Figure 3d supports their findings. The researchers should consider adding supplemental figures illustrating the spatial distribution of single cells in comparison to the ground truth distribution to enhance the clarity and robustness of their investigation.</p>
</disp-quote>
<p>Thank you for the comment. We will include additional details for this dataset in the supplementary figures. As the intestinal villus is a relatively simple tissue, most existing algorithms performed well on it. For this reason, we did not initially provide extensive details in the main text.</p>
<disp-quote content-type="editor-comment">
<p>(4) The spatial mapping tests were conducted on various tissues, including the mouse cortex, human PDAC, and intestinal villus. However, the original anatomical regions are not displayed, making it difficult to directly compare them with the predicted mapping results. Providing ground truth distributions for each tested tissue would enhance clarity and facilitate interpretation. For instance, in Figure 2a and Supplementary Figures 1 and 2, only the predicted mapping results are shown without the corresponding original spatial distribution of regions in the mouse cortex. Additionally, in Figure 3c, four anatomical regions are displayed, but it is unclear whether the figure represents the original spatial regions or those predicted by glmSMA. The authors are encouraged to clarify this by incorporating ground truth distributions for each tissue.</p>
</disp-quote>
<p>Thank you for the comment. To improve visualization, we will include anatomical structures alongside the mapping results in the next version, wherever such structures are available (e.g., mouse brain cortex, human PDAC sample, etc.). Regions will be color-coded to enhance clarity and make the spatial organization easier to interpret.</p>
<disp-quote content-type="editor-comment">
<p>(5) The cell assignment results from the mouse hippocampus (Supplementary Figure 6) lack a corresponding ground truth distribution for comparison. DG and CA cells were evaluated solely based on the gene expression of specific marker genes. Additional analyses are needed to further validate the robustness of glmSMA's mapping performance on Slide-seq data from the mouse hippocampus.</p>
</disp-quote>
<p>Thank you for the comment. The ground truth for DG and CA cells was not available. To better evaluate the model's performance, we will compute the KL divergence between the original and predicted cell type distributions, following the same approach used for the 10x Visium dataset.</p>
<disp-quote content-type="editor-comment">
<p>(6) The tested spatial datasets primarily consist of highly structured tissues with well-defined anatomical regions, such as the brain and intestinal villus. Anatomical regions are not distinctly separated, such as liver tissue. Further evaluation of such tissues would help determine the method's broader applicability.</p>
</disp-quote>
<p>Thank you for the comment. We have already tested our algorithm on the fly embryo, where anatomical structures are not well defined or clearly separated. If needed, we can further apply glmSMA to more complex tissues such as the liver. To clarify the role of anatomical structures in our model: glmSMA does not require anatomical information as input. Instead, it leverages a distance matrix between cells to apply L2 norm regularization. Despite the absence of anatomical information, the model still demonstrates strong performance. We will include results to illustrate its effectiveness without anatomical input. Additionally, we plan to evaluate the model on tissues where anatomical regions are not clearly delineated.</p>
<p>Lein, E., Hawrylycz, M., Ao, N. et al. Genome-wide atlas of gene expression in the adult mouse brain. Nature 445, 168–176 (2007). <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1038/nature05453">https://doi.org/10.1038/nature05453</ext-link></p>
<disp-quote content-type="editor-comment">
<p><bold>Reviewer #3 (Public review):</bold></p>
<p>Summary:</p>
<p>The authors aim to develop glmSMA, a network-regularized linear model that accurately infers spatial gene expression patterns by integrating single-cell RNA sequencing data with spatial transcriptomics reference atlases. Their goal is to reconstruct the spatial organization of individual cells within tissues, overcoming the limitations of existing methods that either lack spatial resolution or sensitivity.</p>
<p>Strengths:</p>
<p>(1) Comprehensive Benchmarking:</p>
<p>Compared against CellTrek and Novosparc, glmSMA consistently achieved lower Kullback-Leibler divergence (KL divergence) scores, indicating better cell assignment accuracy.</p>
<p>Outperformed CellTrek in mouse cortex mapping (90% accuracy vs. CellTrek's 60%) and provided more spatially coherent distributions.</p>
<p>(2) Experimental Validation with Multiple Real-World Datasets:</p>
<p>The study used multiple biological systems (mouse brain, Drosophila embryo, human PDAC, intestinal villus) to demonstrate generalizability.</p>
<p>Validation through correlation analyses, Pearson's coefficient, and KL divergence support the accuracy of glmSMA's predictions.</p>
</disp-quote>
<p>We thank reviewer #3 for their positive feedback and thoughtful recommendations.</p>
<disp-quote content-type="editor-comment">
<p>Weaknesses:</p>
<p>(1) The accuracy of glmSMA depends on the selection of marker genes, which might be limited by current FISH-based reference atlases.</p>
</disp-quote>
<p>We agree that the accuracy of glmSMA is influenced by the selection of marker genes, and that current FISH-based reference atlases may offer a limited gene set. To address this, we incorporate multiple feature selection strategies, including highly variable genes and spatially informative genes (e.g., via Moran’s I), to optimize performance within the available gene space. As more comprehensive reference atlases become available, we expect the model’s accuracy to improve further.</p>
<disp-quote content-type="editor-comment">
<p>(2) glmSMA operates under the assumption that cells with similar gene expression profiles are likely to be physically close to each other in space which not be true under various heterogeneous environments.</p>
</disp-quote>
<p>While this assumption effectively captures spatial continuity in many cases, we acknowledge that it may not hold across all biological contexts. To address this, we plan to refine our regularization strategy and evaluate the model's performance in heterogeneous tissue regions.</p>
</body>
</sub-article>
</article>