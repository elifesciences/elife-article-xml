<?xml version="1.0" ?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.3 20210610//EN"  "JATS-archivearticle1-mathml3.dtd"><article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.3" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="nlm-ta">elife</journal-id>
<journal-id journal-id-type="publisher-id">eLife</journal-id>
<journal-title-group>
<journal-title>eLife</journal-title>
</journal-title-group>
<issn publication-format="electronic" pub-type="epub">2050-084X</issn>
<publisher>
<publisher-name>eLife Sciences Publications, Ltd</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">91512</article-id>
<article-id pub-id-type="doi">10.7554/eLife.91512</article-id>
<article-id pub-id-type="doi" specific-use="version">10.7554/eLife.91512.1</article-id>
<article-version-alternatives>
<article-version article-version-type="publication-state">reviewed preprint</article-version>
<article-version article-version-type="preprint-version">1.1</article-version>
</article-version-alternatives>
<article-categories>
<subj-group subj-group-type="heading">
<subject>Computational and Systems Biology</subject>
</subj-group>
</article-categories>
<title-group>
<article-title>H3-OPT: Accurate prediction of CDR-H3 loop structures of antibodies with deep learning</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<name>
<surname>Chen</surname>
<given-names>Hedi</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="author-notes" rid="n1">#</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Fan</surname>
<given-names>Xiaoyu</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="author-notes" rid="n1">#</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Zhu</surname>
<given-names>Shuqian</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="author-notes" rid="n1">#</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Pei</surname>
<given-names>Yuchan</given-names>
</name>
<xref ref-type="aff" rid="a2">2</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Zhang</surname>
<given-names>Xiaochun</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Zhang</surname>
<given-names>Xiaonan</given-names>
</name>
<xref ref-type="aff" rid="a3">3</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Liu</surname>
<given-names>Lihang</given-names>
</name>
<xref ref-type="aff" rid="a3">3</xref>
</contrib>
<contrib contrib-type="author" corresp="yes">
<name>
<surname>Qian</surname>
<given-names>Feng</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="corresp" rid="cor1">*</xref>
</contrib>
<contrib contrib-type="author" corresp="yes">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-5830-0669</contrib-id>
<name>
<surname>Tian</surname>
<given-names>Boxue</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="corresp" rid="cor1">*</xref>
</contrib>
<aff id="a1"><label>1</label><institution>MOE Key Laboratory of Bioinformatics, State Key Laboratory of Molecular Oncology, School of Pharmaceutical Sciences, Tsinghua University</institution>, Beijing, 100084, <country>China</country></aff>
<aff id="a2"><label>2</label><institution>Tsinghua Institute of Multidisciplinary Biomedical Research, Tsinghua University</institution>, Beijing, 102206, <country>China</country></aff>
<aff id="a3"><label>3</label><institution>Department of Natural Language Processing, Baidu International Technology (Shenzhen) Co., Ltd</institution>, Shenzhen 518000, <country>China</country></aff>
</contrib-group>
<contrib-group content-type="section">
<contrib contrib-type="editor">
<name>
<surname>Sanchez</surname>
<given-names>Ignacio Enrique</given-names>
</name>
<role>Reviewing Editor</role>
<aff>
<institution-wrap>
<institution>CONICET / Universidad de Buenos Aires</institution>
</institution-wrap>
<city>Buenos Aires</city>
<country>Argentina</country>
</aff>
</contrib>
<contrib contrib-type="senior_editor">
<name>
<surname>Dötsch</surname>
<given-names>Volker</given-names>
</name>
<role>Senior Editor</role>
<aff>
<institution-wrap>
<institution>Goethe University Frankfurt</institution>
</institution-wrap>
<city>Frankfurt am Main</city>
<country>Germany</country>
</aff>
</contrib>
</contrib-group>
<author-notes>
<corresp id="cor1"><label>*</label>To whom correspondence should be addressed: Boxue Tian: <email>boxuetian@mail.tsinghua.edu.cn</email> Feng Qian: <email>qianfeng@tsinghua.edu.cn</email></corresp>
<fn id="n1"><label>#</label><p>These authors contribute equally to this work.</p></fn>
</author-notes>
<pub-date date-type="original-publication" iso-8601-date="2023-10-18">
<day>18</day>
<month>10</month>
<year>2023</year>
</pub-date>
<volume>12</volume>
<elocation-id>RP91512</elocation-id>
<history>
<date date-type="sent-for-review" iso-8601-date="2023-08-07">
<day>07</day>
<month>08</month>
<year>2023</year>
</date>
</history>
<pub-history>
<event>
<event-desc>Preprint posted</event-desc>
<date date-type="preprint" iso-8601-date="2023-08-21">
<day>21</day>
<month>08</month>
<year>2023</year>
</date>
<self-uri content-type="preprint" xlink:href="https://doi.org/10.1101/2023.08.19.553933"/>
</event>
</pub-history>
<permissions>
<copyright-statement>© 2023, Chen et al</copyright-statement>
<copyright-year>2023</copyright-year>
<copyright-holder>Chen et al</copyright-holder>
<ali:free_to_read/>
<license xlink:href="https://creativecommons.org/licenses/by/4.0/">
<ali:license_ref>https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
<license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p>
</license>
</permissions>
<self-uri content-type="pdf" xlink:href="elife-preprint-91512-v1.pdf"/>
<abstract>
<title>Abstract</title>
<p>Accurate prediction of the structurally diverse complementarity determining region heavy chain 3 (CDR-H3) loop structure remains a primary and long-standing challenge for antibody modeling. Here, we present the H3-OPT toolkit for predicting the 3D structures of monoclonal antibodies and nanobodies. H3-OPT combines the strengths of AlphaFold2 with a pre-trained protein language model, and provides a 2.24 Å average RMSD<sub>Cα</sub> between predicted and experimentally determined CDR-H3 loops, thus outperforming other current computational methods in our non-redundant high-quality dataset. The model was validated by experimentally solving three structures of anti-VEGF nanobodies predicted by H3-OPT. We examined the potential applications of H3-OPT through analyzing antibody surface properties and antibody-antigen interactions. This structural prediction tool can be used to optimize antibody-antigen binding, and to engineer therapeutic antibodies with biophysical properties for specialized drug administration route.</p>
</abstract>

</article-meta>
<notes>
<notes notes-type="competing-interest-statement">
<title>Competing Interest Statement</title><p>The authors have declared no competing interest.</p></notes>
<fn-group content-type="external-links">
<fn fn-type="dataset"><p>
<ext-link ext-link-type="uri" xlink:href="https://github.com/chdcg/H3-OPT">https://github.com/chdcg/H3-OPT</ext-link>
</p></fn>
</fn-group>
</notes>
</front>
<body>
<sec id="s1">
<title>Introduction</title>
<p>Antibodies protect the host by recognizing and neutralizing foreign microbes or viruses and provide immunity against future infections. Furthermore, the use of therapeutic antibodies is steadily increasing in clinical treatments for infectious diseases, cancers, and autoimmune disorders<sup><xref ref-type="bibr" rid="c1">1</xref>,<xref ref-type="bibr" rid="c2">2</xref></sup>. For example, anti-PD-L1 antibodies block PD-L1/PD-1 interactions to inhibit tumor growth in patients<sup><xref ref-type="bibr" rid="c3">3</xref></sup>. A typical monoclonal antibody (mAb) is composed of heavy and light chains, while a nanobody (Nb) has only a single-domain variable heavy chain. The CDR heavy chain 3 (CDR-H3) loop is the most variable region in both length and amino acid sequence, and it plays a central role in antigen binding for both mAbs and Nbs. The development of effective therapeutic antibodies requires the solved structures of candidate antibodies, including the CDR-H3. However, it is both costly and labor intensive to experimentally obtain structures, and thus computationally predicted structures are often used to guide antibody design<sup><xref ref-type="bibr" rid="c4">4</xref></sup>. Despite major advances in computational methods, structure prediction for CDR-H3 loops remains challenging.</p>
<p>Traditional template-based modeling methods, such as RosettaAntibody<sup><xref ref-type="bibr" rid="c5">5</xref></sup>, PIGS<sup><xref ref-type="bibr" rid="c6">6</xref></sup>, ABodyBuilder<sup><xref ref-type="bibr" rid="c7">7</xref></sup>, and MODELLER<sup><xref ref-type="bibr" rid="c8">8</xref></sup>, often provide demonstrably inaccurate predictions for CDR-H3 sequences<sup><xref ref-type="bibr" rid="c9">9</xref>–<xref ref-type="bibr" rid="c11">11</xref></sup>, and as a result, alternative artificial intelligence (AI)-based approaches, such as AlphaFold2 (AF2)<sup><xref ref-type="bibr" rid="c12">12</xref></sup>, trRosetta<sup><xref ref-type="bibr" rid="c13">13</xref></sup> and RoseTTAFold<sup><xref ref-type="bibr" rid="c14">14</xref></sup>, are increasing in popularity. AF2 has shown comparable accuracy to experimentally determined structures by capturing physical and biological information about protein folding, thus providing a versatile deep learning framework for structure prediction. Structure prediction methods using pre-trained protein language models (PLMs), e.g., HelixFold-Single<sup><xref ref-type="bibr" rid="c15">15</xref></sup> and ESMFold<sup><xref ref-type="bibr" rid="c16">16</xref></sup>, have shown comparable performance to AF2 with accelerated prediction speed. PLMs can be trained with datasets comprising tens of millions of unlabeled protein sequences in a self-supervised manner, and can be subsequently applied to a variety of downstream tasks, such as druggable protein target prediction<sup><xref ref-type="bibr" rid="c17">17</xref></sup>, predicting protein function, and protein design<sup><xref ref-type="bibr" rid="c18">18</xref>–<xref ref-type="bibr" rid="c20">20</xref></sup>. Antibody-specific tools such as IgFold<sup><xref ref-type="bibr" rid="c21">21</xref></sup>, tFold-Ab<sup><xref ref-type="bibr" rid="c22">22</xref></sup>, DeepAb<sup><xref ref-type="bibr" rid="c23">23</xref></sup> and NanoNet<sup><xref ref-type="bibr" rid="c24">24</xref></sup> have also been developed to improve accuracy in CDR-H3 prediction. Among them, IgFold leverages sequence representations from PLMs to efficiently predict antibody structures within seconds, and notably, IgFold can provide accuracy comparable to AF2, enabling high-throughput prediction of antibody structures.</p>
<p>In this study, we present H3-OPT, which combines features of AF2 and PLMs to predict antibody structures. We compare H3-OPT with several other antibody structure prediction methods and found that it can provide a lower average RMSD<sub>Cα</sub> for CDR-H3 loops than other algorithms in three subsets of varying difficulty. To further validate our model, we experimentally solved the structures of three anti-VEGF nanobodies predicted by H3-OPT<sup><xref ref-type="bibr" rid="c25">25</xref></sup>. We examined the potential applications of H3-OPT through analyzing antibody surface properties and antibody-antigen interactions. We demonstrate the informative value of high-quality H3 loops for predicting binding affinity, and further support the use of H3-OPT as a powerful and versatile tool for studying antigen-antibody interactions. This structural prediction tool can be used to optimize antibody-antigen binding, and to engineer therapeutic antibodies with biophysical properties.</p>
</sec>
<sec id="s2">
<title>Results</title>
<sec id="s2a">
<title>The H3-OPT workflow</title>
<p>Prior to training H3-OPT, we first conducted a thorough evaluation of currently available antibody structure prediction tools, including AF2, RoseTTAFold, trRosetta, NanoNet, DeepAb, MODELLER, and AbodyBuilder (Supplementary Section 1). AF2 provided high-accuracy predictions for the overall structures of both mAbs and Nbs, with template modeling scores (TM-scores) and global distance test scores (GDT scores) greater than 0.9. Based on the relatively higher accuracy of AF2 in structural predictions, its prediction was used to extract structural features of CDR-H3 loops for further optimization by H3-OPT. Using a mAb/Nb sequence and its Fv model structure from AF2 as input, H3-OPT was then used to generate a refined structure. As data quality has large effects on prediction accuracy, we constructed a non-redundant dataset with 1286 high-resolution (&lt;2.5 Å) antibody structures from SAbDab<sup><xref ref-type="bibr" rid="c26">26</xref></sup> (<xref rid="fig1" ref-type="fig">Fig. 1a</xref>). The dataset was then divided into training, validation, and test sets based on amino acid sequence identity, which was done by using the UCLUST<sup><xref ref-type="bibr" rid="c27">27</xref></sup> software. To assess the prediction results, the test set was split into 3 subgroups according to the differences in AF2 accuracy stemming from the length of CDR-H3 sequence: easy-to-predict targets (0 - 2 Å, Sub1); moderate difficulty targets (2 - 4 Å, Sub2); and challenging-to-predict targets (&gt; 4 Å, Sub3), with average CDR-H3 loop sequence lengths of 9.12, 11.08, and 16.43, respectively.</p>
<fig id="fig1" position="float" orientation="portrait" fig-type="figure">
<label>Fig. 1</label>
<caption><title>H3-OPT architecture.</title>
<p><bold>a,</bold> Schematic for dataset preparation. Structures were screened from the SAbDab database based on resolution and sequence identity. Clustering of the filtered, high-resolution structures yielded three datasets for training, validation, and testing. <bold>b,</bold> The workflow of H3-OPT includes two modules. The template module determines whether to use PSPM, while the PSPM module optimizes the AF2 input structures. <bold>c,</bold> The Template module retains AF2-predicted loops when the confidence score is greater than 0.8 and grafts CDR-H3 loops onto AF2 models for structures with an available template. <bold>d,</bold> In the PSPM, the network extracts residue-level information and pairwise residue representations from the AF2-predicted models, which are subsequently updated using weight-sharing blocks and concatenated with sequence representations from ESM2. The resulting data is used to predict the 3D coordinates of the H3 loops.</p></caption>
<graphic xlink:href="553933v1_fig1.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>The workflow of H3-OPT is depicted in <xref rid="fig1" ref-type="fig">Fig. 1b</xref>. H3-OPT consists of a Template module and a PLM-based structure prediction module (PSPM). The Template module determines whether to use PSPM to optimize CDR-H3 and comprises two sub-modules: a confidence-based module (CBM) and a template-grafting module (TGM). The CBM calculates an AF2 confidence score to evaluate the reliability of CDR-H3 loop sequence inputs through MSA and template searching. The TGM then identifies a template from the H3 template database and grafts the CDR-H3 loop onto the AF2 model if such a template is available (<xref rid="fig1" ref-type="fig">Fig. 1c</xref>). The PSPM contains a series of attention-based components to ensure that the complete structural context is extracted from the input sequences. Specifically, the PSPM employs a row-wise gated attention layer that updates residue-level information and exchanges information within residue pair representations and residue features to infer relationships between the spatial and residue representations. Additionally, by leveraging sequence-level representations from PLMs along with residue-level information, the PSPM can integrate high-information features, such as protein folding patterns, across a vast protein space to predict final three-dimensional (3D) atomic coordinates (<xref rid="fig1" ref-type="fig">Fig. 1d</xref>).</p>
<p>To better understand the contribution of each module to H3-OPT accuracy with varying factors, we next examined how incorporating different approaches through the Template and PSPM modules could improve accuracy of H3-OPT. While AF2 showed markedly stronger predictions than IgFold in Sub1 (<xref rid="fig2" ref-type="fig">Fig. 2a</xref>), IgFold provided higher accuracy in Sub3. In light of previous studies that showed PLM-based models are computationally more efficient but have unsatisfactory accuracy when high-resolution templates and MSA are available<sup><xref ref-type="bibr" rid="c16">16</xref></sup>, we therefore sought to combine the strengths of AF2 with PLM-based modeling. Similar to IgFold<sup><xref ref-type="bibr" rid="c21">21</xref></sup>, an initial version of H3-OPT lacking the CBM could not replicate the accuracy of AF2 in Sub1. Interestingly, we observed that AF2 confidence score shared a strong negative correlation with Cα-RMSDs (Pearson correlation coefficient =-0.67 (<xref rid="fig2" ref-type="fig">Fig. 2b</xref>), which led to us to hypothesize that AF2 models with high confidence scores might be sufficiently accurate, and therefore do not require further optimization. Following this notion, we incorporated a CBM sub-module that could directly retain high-confidence structures from AF2. TGM sub-module was added as a means of grafting identical H3 loop templates from public PDBs onto AF2-predicted models to further improve accuracy. Ablation studies in which the CBM or TGM were excluded to determine their respective contributions to the final predictive accuracy (<xref rid="fig2" ref-type="fig">Fig. 2c-f</xref>) revealed that H3-OPT without the Template Module could generate structures with average Cα-RMSDs of 1.76 Å, 2.76 Å, and 4.86 Å for the Sub1, Sub2, and Sub3 datasets, respectively. Incorporating only the CBM into our model significantly improved RMSD<sub>Cα</sub> score by 0.62 Å for Sub 1, but exerted negligible effects on Sub2 and Sub3. By contrast, including the TGM alone resulted in substantially improved RMSD<sub>Cα</sub> for Sub2 and Sub3 by 0.68 Å and 1.04 Å, respectively, suggesting that templates were more effective for relatively long CDR-H3 antibodies. These results suggested that the combination of TGM and CBM modules could leverage available templates to improve prediction accuracy.</p>
<fig id="fig2" position="float" orientation="portrait" fig-type="figure">
<label>Fig. 2</label>
<caption><title>Template module and ablation studies.</title>
<p><bold>a,</bold> Side-by-side comparison of Cα-RMSDs of AF2 and IgFold for Sub1 (n = 52); color scale for data points reflects CDR3 length. AF2 outperformed IgFold for targets left of the dashed diagonal; IgFold outperformed AF2 for targets right of the dashed diagonal. <bold>b,</bold> Correlations between AF2 confidence score and amino acid sequence length of CDR-H3 loops. Datapoint color indicates Cα-RMSD value for that target. The correlation coefficient for confidence score and CDR-H3 loop length is −0.5921. <bold>c,</bold> The accuracy of H3-OPT in 3 subgroups of the test set. ΔCα-RMSDs were calculated by subtracting the RMSD<sub>Cα</sub> of AF2 from that of H3-OPT. AF2 had higher accuracy for targets above the dashed line; H3-OPT had better accuracy for structures below the dashed line. <bold>d,</bold> Differences in H3-OPT accuracy without the template module. <bold>e,</bold> Differences in H3-OPT accuracy without the CBM. <bold>f,</bold> Differences in H3-OPT accuracy without the TGM.</p></caption>
<graphic xlink:href="553933v1_fig2.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>Since the large majority of sequences in Sub2 and Sub3 have long CDR-H3 loops with few sequence homologs, attaining high accuracy in structural predictions becomes increasingly challenging for AF2<sup><xref ref-type="bibr" rid="c28">28</xref></sup>. Inspired by IgFold and other PLM-based methods (<xref rid="fig3" ref-type="fig">Fig 3a</xref>), we thus developed a PSPM module to capture structural information from the sequence embeddings of PLMs<sup><xref ref-type="bibr" rid="c29">29</xref></sup>. The key innovations of the PSPM for our workflow were the integration of sequence-level representations from PLMs and the simplified architecture of AF2. ProtTrans-T5, AntiBERTy, and ESM2 were initially used without fine-tuning, resulting in overall average Cα-RMSDs of 2.40 Å, 2.49 Å, and 2.32 Å, respectively (<xref rid="tbl1" ref-type="table">Table 1</xref>). To improve accuracy, we employed a fine-tuning approach for the downstream CDR-H3 structure prediction task. As ESM2 outperformed other PLMs in our test set, we fine-tuned parameters of all ESM2 hidden layers, which resulted in an overall RMSD<sub>Cα</sub> of 2.24 Å for H3-OPT. It should be noted that most computational models, such as IgFold, froze PLM weights during model training<sup><xref ref-type="bibr" rid="c21">21</xref></sup>. Analysis of test subsets showed that H3-OPT could provide high accuracy in sidechain predictions, high template modeling scores (TM-scores), and high global distance test scores (GDT scores) in Sub2 and Sub3 (<xref rid="fig3" ref-type="fig">Fig 3b-c</xref>).</p>
<fig id="fig3" position="float" orientation="portrait" fig-type="figure">
<label>Fig. 3</label>
<caption><title>PSPM module.</title>
<p><bold>a,</bold> Side-by-side comparison of Cα-RMSDs for AF2 and IgFold in the Sub2 (n = 46) and Sub3 (n = 33) test sets. <bold>b</bold>, Comparison of prediction accuracy between AF2 and H3-OPT for Sub2 and Sub3 targets. Metrics including RMSDs, TM-scores, and GDT-scores were used to quantitatively assess similarity between predicted and experimental structures. <bold>c,</bold> Comparison of prediction accuracy between AF2 and H3-OPT using six metrics (RMSD<sub>Cα</sub>, RMSD<sub>backbone</sub>, RMSD<sub>sidechain</sub>, TM-score, GDT-TS score and GDT-HA score). Radar plots of the mean values of different methods and metrics in predictions of Sub2 and Sub3 targets.</p></caption>
<graphic xlink:href="553933v1_fig3.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<table-wrap id="tbl1" orientation="portrait" position="float">
<label>Table 1.</label>
<caption><title>Performance of H3-OPT with different PLMs</title></caption>
<graphic xlink:href="553933v1_tbl1.tif" mimetype="image" mime-subtype="tiff"/>
</table-wrap>
<p>To expand its generalizability, we simplified the Evoformer architecture and introduced parameter-sharing to directly predict Cartesian coordinates of CDR-H3 loops through both residue-level features and pair representations. In residue-level representations, rows represented amino acid types and structural features derived from AF2, while columns represented individual residues from the input sequence. The pair representations contained information about the residue pairs, such as Cα-Cα distance. These residue-level representations were updated by the attention-based layers and continuously communicated with pair representations; the pair representations were then updated via triangular multiplicative layers<sup><xref ref-type="bibr" rid="c28">28</xref></sup>. This simplified architecture improved model efficiency and avoided overfitting. We also applied a structural alignment strategy for feature extraction and model prediction. Given the high conservation of Fv structures, the alignment strategy was designed to effectively capture residue contribution to loop folding, resulting in improved training speed and accuracy. Token together, H3-OPT provided high-accuracy predictions for CDR-H3 loops, facilitating the development of antibody therapeutics.</p>
</sec>
<sec id="s2b">
<title>H3-OPT provides higher accuracy CDR-H3 models than existing structure prediction software</title>
<p>We then evaluated the performance of H3-OPT against currently available methods, including AF2, IgFold, HelixFold-Single, and ESMFold. H3-OPT achieved an average Cα root mean square deviation (RMSD<sub>Cα</sub>) of 2.24 Å for CDR-H3, while AF2 and IgFold had CDR-H3 RMSDs of 2.85 Å and 2.87 Å, respectively (<xref rid="fig4" ref-type="fig">Fig. 4a</xref>). HelixFold-Single and ESM-Fold generated comparatively poor predictions, with RMSDs for CDR-H3 of 3.39 Å and 4.23 Å, respectively. As shown in <xref rid="fig4" ref-type="fig">Fig. 4b</xref>, H3-OPT provided higher accuracy predictions than other methods in all 3 subgroups, with average RMSDs of 1.10 Å, 2.28 Å and 3.99 Å, respectively. While the predictions of H3-OPT were comparable to AF2 in Sub1, its accuracy was higher than AF2 in Sub2 and Sub3.</p>
<fig id="fig4" position="float" orientation="portrait" fig-type="figure">
<label>Fig. 4</label>
<caption><title>Accuracy of CDR-H3 loop prediction by H3-OPT.</title>
<p><bold>a,</bold> The performance of H3-OPT in the test set (n<sub>mAbs</sub> = 119, n<sub>Nbs</sub> = 12) relative to other methods. <bold>b</bold>, The performance of H3-OPT in structural predictions of 3 subgroups of the test set (n = 52, 46, and 33). <bold>c,</bold> H3-OPT structural predictions for three anti-VEGF nanobodies (PDB ID: 8IIU, 8IJZ, 8IJS).</p></caption>
<graphic xlink:href="553933v1_fig4.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>In light of these results, we then sought to validate H3-OPT using three experimentally determined structures of anti-VEGF nanobodies, including a wild-type (WT) and two mutant (Mut1 and Mut2) structures, that were recently deposited in protein data bank (<xref rid="fig4" ref-type="fig">Fig. 4c</xref>). Although Mut1 (E45A) and Mut2 (Q14N) shared the same CDR-H3 sequences as WT, only minor variations were observed in the CDR-H3. H3-OPT generated accurate predictions with Cα-RMSDs of 1.510 Å, 1.541 Å and 1.411 Å for the WT, Mut1, and Mut2, respectively. Subsequent comparison with IgFold, showed that IgFold could not accurately predict the short helix in CDR-H3, resulting in Cα-RMSDs of 2.776 Å (WT), 2.888 Å (Mut1), and 2.448 Å (Mut2) and more diverse conformations of Mut1 and Mut2. These results indicated that IgFold was capable of learning long-range correlations in protein sequences, but that these long-range correlations could introduce larger errors when MSA and templates were available. These results thus demonstrated that MSA could strongly influence the accuracy for which similar CDR-H3 template structures were available.</p>
</sec>
<sec id="s2c">
<title>H3-OPT can predict antibody surface properties</title>
<p>To demonstrate how improved CDR-H3 structural accuracy can assist antibody engineering, we applied H3-OPT to predict surface properties. Comparison of H3-OPT with AF2 for identifying surface amino acids (SAAs) by the relative accessible surface areas (rASAs) of CDR-H3 loops showed that H3-OPT could predict SAAs, on average, close to that of the native structures (9.46 vs 9.40, <xref rid="fig5" ref-type="fig">Fig. 5a</xref>), whereas AF2 predicted an average of 9.81 SAAs. Furthermore, H3-OPT predicted closer values to native structures than AF2 in predicting diverse surface properties, such as the distribution of hydrophilic or charged SAAs (<xref rid="fig5" ref-type="fig">Fig. 5b</xref>).</p>
<fig id="fig5" position="float" orientation="portrait" fig-type="figure">
<label>Fig. 5</label>
<caption><title>Analysis of surface patches.</title>
<p><bold>a,</bold> Analysis of surface amino acids for predicted H3 loops. Y-axis represents average number of surface residues for H3 loops (n = 131). <bold>b,</bold> Histogram of surface patches with different properties predicted by H3-OPT, AF2, or experimentally solved H3 loops. Error bars show standard deviations. <bold>c,</bold> Solvent-accessible surface area (SASA) analysis of predicted H3 loops. Values represent the difference in SASA between predicted and experimentally determined H3 structures using AF2 or H3-OPT. <bold>d,</bold> Comparison of the charged surface patches between H3-OPT and AF2 for target PDBID: 5U3P. Surface colors: Blue, positive charge; red, negative charge.</p></caption>
<graphic xlink:href="553933v1_fig5.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>To examine insights H3-OPT could provide into the biophysical properties of antibodies<sup><xref ref-type="bibr" rid="c30">30</xref></sup>, we next estimated the solvent-accessible surface areas (SASAs). The average SASAs of H3-OPT loops closely resembled that of the native structures, with larger differences in AF2 predictions (<xref rid="fig5" ref-type="fig">Fig. 5c</xref>). Plots of SASA distributions at each alignment position revealed smaller errors in H3-OPT than AF2, with ΔSASA ranging from -12.17 to 9.74 Å<sup><xref ref-type="bibr" rid="c2">2</xref></sup> (<xref ref-type="fig" rid="figs1">Extended Data Fig. 1</xref>). In addition, comparison of surface charge distributions on the predicted CDR-H3 loops generated by H3-OPT and AF2 in an electrostatic map of a representative structure (PDB 5U3P, <xref rid="fig5" ref-type="fig">Fig. 5d</xref>) showed that H3-OPT predictions were consistent with the experimental structure. These results collectively showed that accurate surface properties predicted by H3-OPT could provide insights into antibody folding and stability, as well as their interactions with antigens.</p>
</sec>
<sec id="s2d">
<title>H3-OPT can facilitate investigation of antibody-antigen interactions</title>
<p>To explore the potential applications of H3-OPT in studying antibody-antigen interactions, we analyzed contact patterns at predicted binding sites. Given that predicting the structure of an antibody-antigen complex remains challenging, we superimposed V<sub>H</sub> fragments from H3-OPT and AF2 onto experimentally determined native complex structures available in our test set. After identifying the contact residues of antigens by H3-OPT, we found that H3-OPT could substantially outperform AF2 (<xref rid="fig6" ref-type="fig">Fig. 6a</xref>), with a precision of 0.75 and accuracy of 0.94 compared to 0.66 precision and 0.92 accuracy of AF2. Next, we estimated the distances among interface residues, which are related to binding affinity at the interface. We found that H3-OPT had less error in distance metrics than predictions by AF2 across different distance thresholds, with average mean squared errors of 5.61 Å and 7.08 Å, respectively (<xref rid="fig6" ref-type="fig">Fig. 6b</xref>). Furthermore, calculation of H3 contact propensities to assess potential differences in binding patterns between the predicted and native structures using high-quality H3 conformations indicated that H3-OPT also displayed higher accuracy in predicting contact propensities (<xref rid="fig6" ref-type="fig">Fig. 6c</xref>).</p>
<fig id="fig6" position="float" orientation="portrait" fig-type="figure">
<label>Fig. 6</label>
<caption><title>Accuracy of H3-OPT predictions of antibody-antigen interactions.</title>
<p><bold>a,</bold> Performance of H3-OPT in binding site prediction. comparison of prediction accuracy between H3-OPT and AF2 for antibody-antigen binding sites (n = 27). Box represents interquartile range (IQR); horizontal line in the center of the box shows median. <bold>b,</bold> Comparison of the mean squared errors of residue pairs between H3-OPT and AF2 under different distance thresholds. The x-axis represents the experimentally determined distance between pairs of contacting residues at the binding site in the native structure. Y-axis shows mean squared errors of H3-OPT and AF2. <bold>c,</bold> Heatmaps of the frequency of pairwise residue-residue contacts across antibody-antigen interfaces. This analysis compares contact frequency of H3 loops predicted by AF2 or H3-OPT with the native structure. Darker shading indicates greater difference in contact frequency. <bold>d,</bold> The predicted H3 loops of two targets interacting with antigens (PDB: 2YC1, 6O9H). The epitopes are highlighted in red and antibody chains are green. H3-OPT could identify the epitopes of different antigens that form the complementary binding interface(s) for the CDR-H3 of antibodies.</p></caption>
<graphic xlink:href="553933v1_fig6.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>Finally, to test whether H3-OPT was reliable for investigation of the detailed mechanisms underlying antigen-antibody binding, we generated contact maps and calculated binding affinities for complex structures obtained by H3-OPT, AF2, or through experiments (see Methods for details). We found that contact maps predicted by H3-OPT were consistent with those observed in the experimental structures (<xref rid="fig6" ref-type="fig">Fig. 6d</xref>). Calculation of binding affinities through MD simulations showed that the average affinities of structures obtained by H3-OPT prediction were closer to those of experimentally determined structures than values obtained through AF2 (<xref rid="tbl2" ref-type="table">Table 2</xref>). These cumulative findings illustrate the informative value of high-quality H3 loops for predicting binding affinity and facilitating antibody engineering, and further support the use of H3-OPT as a powerful and versatile tool for investigating antigen-antibody interactions.</p>
<table-wrap id="tbl2" orientation="portrait" position="float">
<label>Table 2.</label>
<caption><title>Comparison of binding affinities obtained from MD simulations using AF2 and H3-OPT.</title></caption>
<graphic xlink:href="553933v1_tbl2.tif" mimetype="image" mime-subtype="tiff"/>
</table-wrap>
</sec>
</sec>
<sec id="s3">
<title>Discussion</title>
<p>Several platforms for in silico antibody engineering have been developed to improve binding affinity<sup><xref ref-type="bibr" rid="c31">31</xref>–<xref ref-type="bibr" rid="c34">34</xref></sup>, humanization<sup><xref ref-type="bibr" rid="c35">35</xref>,<xref ref-type="bibr" rid="c36">36</xref></sup> and stability<sup><xref ref-type="bibr" rid="c37">37</xref>,<xref ref-type="bibr" rid="c38">38</xref></sup>. At present, engineering these biophysical properties of therapeutic antibodies heavily relies on the availability of the structures of thousands of antibodies. The accurate structure of CDR-H3 is crucial for understanding the mechanism(s) of antigen-antibody interactions. Although AF2 performs well when MSA and templates are available, its predictive capability decreases for targets with long CDR-H3 loops. By contrast, PLMs leverage tens of millions of protein sequences to learn relevant structural patterns, consequently enhancing their capacity to predict orphan antibodies<sup><xref ref-type="bibr" rid="c39">39</xref></sup>. The results of IgFold indicate that PLMs, which incorporate transformer-based attention mechanisms, are capable of learning both local and global sequence information<sup><xref ref-type="bibr" rid="c21">21</xref></sup>. While global information can be useful for challenging targets, it may lead to large errors when templates were available, as demonstrated by our case study of anti-VEGF nanobodies (<xref rid="fig1" ref-type="fig">Fig. 1</xref>).</p>
<p>H3-OPT combines the strengths of AF2 and PLMs to predict the structures of mAbs and Nbs, and our results show that combining these features can improve the average RMSD<sub>Cα</sub> by 20% over that of AF2 or IgFold. However, H3-OPT is less efficient than PLM-based methods like IgFold because it relies on AF2 structures. To improve efficiency, one possible solution is to cluster the targets based on sequence identity and compute AF2 structures for each cluster, followed by generation of mutant structures. Despite the lower efficiency, H3-OPT offers several notable advantages over IgFold (<xref ref-type="fig" rid="figs2">Extended Data Fig. 2</xref>). First, H3-OPT incorporates a simplified version of Evoformer, which improves training efficiency. In addition, H3-OPT employs an alignment-based strategy to extract structural features that are then used to directly predict the Cα coordinates of H3 loops, effectively capturing the residue features relevant to loop folding. Moreover, we found that IgFold uses an augmented dataset containing AF2-predicted structures, which could potentially propagate errors during model training. In contrast, H3-OPT was trained by using high-quality and non-redundant antibody structures. Finally, H3-OPT also shows lower Cα-RMSDs compared to AF2 or tFold-Ab for the majority of targets in an expanded benchmark dataset, including all antibody structures from CAMEO 2022 (<xref ref-type="fig" rid="figs3">Extended Data Fig. 3</xref>).</p>
<p>Although H3-OPT can provide high accuracy with a small training dataset, it is likely that a larger dataset containing high-resolution structures will further improve our model. In the current study, we observed that the accuracy of AF2 CDR-H3 predictions was correlated with the length of the H3 loop. Thus, AF2 can provide accurate predictions for short loops with fewer than 10 amino acids, with PLM-based models offering little or no improvement in such cases. Conversely, antibodies with H3 loop lengths exceeding 25 residues (common in Sub3) pose a long-standing challenge for structural prediction algorithms, and none of the existing methods (including H3-OPT) tested here could provide accurate predictions due to a lack of homologous sequences and a high degree of freedom in this subgroup. Notably, H3-OPT outperformed AF2 in Sub3 because the context of protein sequences learned from ESM2 was fine-tuned to fit antibody structures. Furthermore, we envision that antibodies with H3 loop lengths ranging from 10 to 25 amino acids could be further optimized using PLMs with more model parameters. In addition, we attempted to optimize the H3 loop structure through molecular dynamics simulations and quantum mechanics-based methods (Supplementary Section 2). However, these approaches generally yielded less accurate predictions than AF2 due to inaccurately described solvent effects and other environmental factors. The development of a more accurate, physics-based method for modeling long loops may be another potentially effective strategy for improving H3-OPT.</p>
<p>Deep generative models are playing a vital role in the field of protein design, leading to several successful applications<sup><xref ref-type="bibr" rid="c40">40</xref>–<xref ref-type="bibr" rid="c45">45</xref></sup>. These models capture the intricate relationship between sequences and structures, enabling the generation of novel protein scaffolds not existing in nature. However, the potential immunogenicity concerns associated with these newly designed proteins require comprehensive preclinical and clinical investigations. Consequently, conventional mAbs and Nbs remain the prevailing choices in medicine. Recognizing that the properties of antibodies are heavily influenced by their structures, accurate prediction of the structures of mAbs and Nbs is of great significance in optimizing their therapeutic effectiveness and clinical relevance. To this end, H3-OPT has strong potential to accelerate optimization of antibody-antigen binding as well as engineering of therapeutic antibodies with specialized biophysical properties.</p>
</sec>
<sec id="s4">
<title>Method</title>
<sec id="s4a">
<title>H3-OPT dataset</title>
<p>Crystal structures of antibodies were obtained from SAbDab, a non-redundant nanobody database<sup><xref ref-type="bibr" rid="c46">46</xref></sup> and a subset of DeepAb. The structures with resolution greater than 2.5 Å or redundant sequences with 95% or greater identity were removed (<xref rid="fig1" ref-type="fig">Fig. 1a</xref>). We removed the structures with missing loops in CDR-H3 or lengths greater than 45. The structures with missing residues at CDR-H3 loops were also dropped. To enhance the generalizability of H3-OPT, the sequences were clustered based on a 90% similarity cutoff by using UCLUST<sup><xref ref-type="bibr" rid="c27">27</xref></sup>. The resulting clusters were then randomly divided into training, validating, and testing sets to avoid overestimation of performance. The number of sequences in training, validating and testing sets was 1021(925 mAbs, 96 Nbs), 134 (122 mAbs, 12Nbs) and 131 (119 mAbs, 12 Nbs), respectively, with average CDR-H3 loop length of 11.8, 11.9 and 11.7, respectively. Schrödinger v. 2017-2 (Schrödinger, New York, NY, USA), Numpy 1.18.5 and Pandas 1.0.5 was used for data preparation.</p>
</sec>
<sec id="s4b">
<title>Structure preparation</title>
<p>To address the transformational invariance for predicting 3D coordinates, we applied a structural alignment strategy. Prior to feature extraction, we removed all atoms of light chains in mAbs Fv structures and any non-standard residues in native structures. All antibody V<sub>H</sub> native structures were aligned using StructAlign module in Schrödinger with a randomly selected reference structure (PDBID: 1GIG). Next, we superimposed AF2 predicted models to their corresponding native structures. This alignment allowed the model to learn the interactions between residues located in H3 loops while disregarding the rotation and translation of the entire structure. The heavy chain fragments were determined using Chothia definitions<sup><xref ref-type="bibr" rid="c47">47</xref></sup>.</p>
</sec>
<sec id="s4c">
<title>Feature generation</title>
<p>As shown in <xref rid="tbl3" ref-type="table">Table 3</xref>, structural features were extracted and aggregated into the following inputs to PSPM of H3-OPT: A residue feature vector of size [N<sub>res</sub>, 34] was constructed by concatenating “Amino acid type”, “AF2 predicted coordinates”, “AF2 predicted backbone torsion angles”, “Torsion angles mask” and “Predicted residue mask”. The pairwise feature vector of size [N<sub>res</sub>, N<sub>res</sub>, 60] included the “Pairwise distances” and “Pairwise amino acid type”.</p>
<table-wrap id="tbl3" orientation="portrait" position="float">
<label>Table 3.</label>
<caption><title>Features to the model. N<sub>res</sub> is the number of residues.<sup><xref ref-type="bibr" rid="c28">28</xref></sup></title></caption>
<graphic xlink:href="553933v1_tbl3.tif" mimetype="image" mime-subtype="tiff"/>
</table-wrap>
</sec>
<sec id="s4d">
<title>Network architecture</title>
<p>H3-OPT took the predicted H3 loops of AF2 as input and generate the antibody structure with the optimized CDR-H3 loops as output. H3-OPT was composed of a Template module and a PSPM. The Template module contains two submodules, i.e., CBM and TGM. The CBM calculated the average confidence score of H3 residues and retained AF2 structures with confidence score greater than 0.8. The TGM grafted the template loop structure onto the input AF2 model, when their CDR-H3 sequences were identical. We replaced the predicted CDR-H3 loop generated by AF2 with the template loop by aligning corresponding atoms, which included Cα atoms and carbonyl carbon atoms in the first two residues and Cα atoms and backbone nitrogen atoms in the last two residues.</p>
<p>The input residue-level features are extracted from AF2 predicted structures as mentioned above, resulting in a dimension of <italic>L</italic> × 34, where L is the padding length of antibody heavy chain. Similarly, the pairwise features has a dimension of <italic>L</italic> × <italic>L</italic> × 60. The PSPM network began with a row-wise gated multi-head self-attention layer which updated residue-level features from pair representations. After that, the residue-level information updated the pair representations via outer product mean module. Pair representations were updated by two multiplicative update modules. During training, the weights of the attention layer and the triangle multiplicative update modules were updated 4 times per epoch. Then, the final hidden states from ESM2 (esm2_t33_650M_UR50D) were passed to a linear layer and then concatenated with the residue-level features to enable the learning of latent information from vast protein sequences. To predict all Cα coordinates for the CDR-H3 loop, the output vector was passed through three linear layers with a hidden size of 64. In summary, PSPM utilized an attention-based mechanism to learn the contribution of individual residues and incorporate sequence representations from PLMs into final predictions. We used OpenFold<sup><xref ref-type="bibr" rid="c48">48</xref></sup> (based on GitHub from June 2022: commit 3f57b4a041f063406059f42080ede6d495479617) to implement partial networks of AF2.</p>
<p>We employed a fine-tuning strategy to update the sequence representations in ESM2. Initially, we froze all weights of the 33 representation layers in ESM2 and updated only the weights of the attention layers and pair representation update modules. Subsequently, we fixed all weights of the remaining components in H3-OPT and performed fine-tuning exclusively on all hidden layers of ESM2 for the H3 loop prediction task. Finally, we fine-tuned all parameters of H3-OPT to predict the atomic coordinates of all CDR-H3 Cα atoms.</p>
<p>During training, we trained our model on the training set and validated it on the validation set. The dropout rates of H3-OPT were set to 0.25. Mean squared error (MSE) loss was utilized to train the model. We used Adam optimizer with a learning rate of 1LJ×LJ10<sup>−4</sup>, weight decay of 5LJ×LJ10<sup>−4</sup> for training. The model was trained on an NVIDIA V100 super GPU and took one hour per epoch over the entire training set with a batch size of 64. We randomly selected 10% of all structures for model validation. The H3-OPT was implemented using PyTorch 1.12.1 in Python 3.7.2. The hyperparameters used during training process for H3-OPT were presented in <xref rid="tbl4" ref-type="table">Table 4</xref>.</p>
<table-wrap id="tbl4" orientation="portrait" position="float">
<label>Table 4.</label>
<caption><title>Hyperparameters for H3-OPT models</title></caption>
<graphic xlink:href="553933v1_tbl4.tif" mimetype="image" mime-subtype="tiff"/>
</table-wrap>
</sec>
<sec id="s4e">
<title>Structure generation and refinement</title>
<p>We utilized a structure refinement strategy to generate structures of CDR-H3 loops and rectify structural errors. Initially, we used PSPM predictions to modify the Cα coordinates of predicted CDR-H3 loops generated by AF2. Then, we minimized the remaining atoms of the CDR-H3 loops, while keeping their Cα coordinates fixed, by using the OPLS 2005 force field<sup><xref ref-type="bibr" rid="c49">49</xref></sup>. After the initial energy minimization step, we applied a force constant of 10 kcal/mol to these fixed atoms to guarantee complete relaxation of the entire loops.</p>
</sec>
<sec id="s4f">
<title>Validation settings</title>
<p>H3-OPT, AF2, HelixFold-Single, IgFold and ESMFold were compared on the test subset. Given that tFold-Ab is only available on webserver, we compared H3-OPT with tFold-Ab on CAMEO 2022 dataset. We removed the target antibody structures from AF2 database before prediction to evaluate the performance of AF2. This ensured that the predictions depended solely on the information derived from other template structures, thus avoiding biased results. Since all other methods did not require MSA searching, we did not exclude these targets from their database. To predict the entire Fv structures, we included 50 glycine residues as a linker between the heavy chain and the light chain for antibodies<sup><xref ref-type="bibr" rid="c50">50</xref></sup>. The Cα-RMSDs of all predicted H3 loops were calculated after superimposing the V<sub>H</sub> backbone heavy atoms (without CDR-H3) to the reference structures. All structures were generated using publicly available code repositories: AF2 v2.1.1(based on GitHub the November 2021 version at GitHub: commit 91b43223422420d1783ed802c8b3a8382a9309fd), IgFold (based on GitHub from February 2023: commit 6a09298d165ed1deb438c0b6eefcbcb03ed0eca5), HelixFold-Single (based on GitHub from January 2023: commit 5f39b2c2a4ecc00b89ba05b95dc56212bdd5d886) and ESMFold v1 (based on GitHub from October 2022: commit dc823b89c6acb9f67caea53704c2a97524fbd456).</p>
</sec>
<sec id="s4g">
<title>Analysis of SASAs and pairwise residue contacts</title>
<p>We computed the SASAs and rASAs of all CDR-H3 loops by using the ANARCI webserver<sup><xref ref-type="bibr" rid="c51">51</xref></sup> with the default settings. Residue with an rASA greater than 25% was considered surface residues<sup><xref ref-type="bibr" rid="c52">52</xref></sup>. Subsequently, we applied AHo alignment software<sup><xref ref-type="bibr" rid="c53">53</xref></sup> to report the averaged SASA per alignment position. The samples and alignment positions with more than 10 gaps were removed to avoid randomness and bias, reducing the final samples to 123. Finally, the difference in SASAs between H3-OPT and AF2 was calculated by subtracting predicted H3 loops SASAs from the ground truth.</p>
<p>To examine the contribution of H3-OPT in discovering antibody-antigen interactions, we identified contact residue pairs that were within this distance as binding sites by setting a threshold of 5 Å. We next calculated the pairwise residue distance matrices for each individual predicted complex and native structure, where each element represented the closest distance between the heavy atoms of two residues. From these pairwise distances, we derived contact propensity matrices that specifically indicated the presence or absence of interactions between residues.</p>
</sec>
<sec id="s4h">
<title>Binding affinity calculation</title>
<p>We analyzed the binding affinities of antibody-antigen complexes predicted by AF2 and H3-OPT. Their relative binding affinities were calculated through molecular dynamics simulations. Initially, the missing side-chains and loops in the antibody structures were filled using the Protein Preparation Wizard module within Schrödinger software. Subsequently, the tLEaP module of AMBER<sup><xref ref-type="bibr" rid="c54">54</xref></sup> was employed to construct the simulation system with the ff19SB force field<sup><xref ref-type="bibr" rid="c55">55</xref></sup> and OPC solvent model<sup><xref ref-type="bibr" rid="c56">56</xref></sup>. Additionally, the simulation system was solvated with a 0.15 M NaCl solution. Energy minimization was performed through a 5000-step steepest descent algorithm, followed by a 5000-step conjugate gradient algorithm. Afterwards, a 25000-step NVT simulation with a time step of 1 fs was performed to gradually heat the system from 0 K to 100 K. A 250000-step NPT simulation with a time step of 2 fs was carried out to further heat the system from 100 K to 298 K. In the production run, 100-ns MD simulations were performed with a time step of 2 fs. The distance cutoff for nonbonded interactions was set to 10 Å, and the Berendsen algorithm was utilized to maintain isotropic pressure coupling at 1 bar. The Langevin algorithm was employed to maintain the simulation temperature at 298 K. The relative binding affinities of the antigen-antibody complexes were evaluated using the python script, which computed the MM/GBSA energies for the trajectory frames of last 10 ns.</p>
</sec>
<sec id="s4i">
<title>Data and code availability</title>
<p>The datasets of our study and the codes of H3-OPT are freely available at <ext-link ext-link-type="uri" xlink:href="https://github.com/chdcg/H3-OPT">https://github.com/chdcg/H3-OPT</ext-link>.</p>
</sec>
</sec>
<sec id="d1e983" sec-type="supplementary-material">
<title>Supporting information</title>
<supplementary-material id="d1e1086">
<label>Supplementary information</label>
<media xlink:href="supplements/553933_file09.docx"/>
</supplementary-material>
</sec>
</body>
<back>
<ack>
<title>Acknowledgments</title>
<p>This work was supported by the Tsinghua University Initiative Scientific Research Program (No.20221080048, No.20231080030), the Tsinghua-Peking University Center for Life Sciences (No.20111770319), Tsinghua University - Peking Union Medical College and Hospital Collaboration Foundation (No. 20191080837).</p>
</ack>
<sec id="s5">
<title>Author contributions</title>
<p>H.C. and B.T. conceptualized the project. H.C. and X.F. developed the methodology. S.Z. solved crystal structures. H.C. and L.L. performed structural modeling. H.C. wrote the original paper. Q.F., X.Z., and B.T. edited the paper.</p>
</sec>
<sec id="s6">
<title>Competing interests</title>
<p>The authors declare no competing interests.</p>
</sec>
<ref-list>
<title>Reference</title>
<ref id="c1"><label>1</label><mixed-citation publication-type="journal"><string-name><surname>Meganck</surname>, <given-names>R. M.</given-names></string-name> &amp; <string-name><surname>Baric</surname>, <given-names>R. S</given-names></string-name>. <article-title>Developing therapeutic approaches for twenty-first-century emerging infectious viral diseases</article-title>. <source>Nature Medicine</source> <volume>27</volume>, <fpage>401</fpage>–<lpage>410</lpage> (<year>2021</year>). <pub-id pub-id-type="doi">10.1038/s41591-021-01282-0</pub-id></mixed-citation></ref>
<ref id="c2"><label>2</label><mixed-citation publication-type="journal"><string-name><surname>Kaplon</surname>, <given-names>H.</given-names></string-name> &amp; <string-name><surname>Reichert</surname>, <given-names>J. M</given-names></string-name>. <article-title>Antibodies to watch in 2021</article-title>. <source>MAbs</source> <volume>13</volume>, <fpage>1860476</fpage> (<year>2021</year>). <pub-id pub-id-type="doi">10.1080/19420862.2020.1860476</pub-id></mixed-citation></ref>
<ref id="c3"><label>3</label><mixed-citation publication-type="journal"><string-name><surname>Brahmer</surname>, <given-names>J. R.</given-names></string-name> <etal>et al.</etal> <article-title>Safety and activity of anti-PD-L1 antibody in patients with advanced cancer</article-title>. <source>The New England Journal of Medicine</source> <volume>366</volume>, <fpage>2455</fpage>–<lpage>2465</lpage> (<year>2012</year>). <pub-id pub-id-type="doi">10.1056/NEJMoa1200694</pub-id></mixed-citation></ref>
<ref id="c4"><label>4</label><mixed-citation publication-type="journal"><string-name><surname>Aguilar Rangel</surname>, <given-names>M.</given-names></string-name>, <etal>et al.</etal> <article-title>Fragment-based computational design of antibodies targeting structured epitopes</article-title>. <source>Science Advances</source> <volume>8</volume>, <fpage>eabp9540</fpage> (<year>2022</year>). <pub-id pub-id-type="doi">10.1126/sciadv.abp9540</pub-id></mixed-citation></ref>
<ref id="c5"><label>5</label><mixed-citation publication-type="journal"><string-name><surname>Adolf-Bryfogle</surname>, <given-names>J.</given-names></string-name> <etal>et al.</etal> <article-title>RosettaAntibodyDesign (RAbD): A general framework for computational antibody design</article-title>. <source>PLoS Computational Biology</source> <volume>14</volume>, <fpage>e1006112</fpage> (<year>2018</year>). <pub-id pub-id-type="doi">10.1371/journal.pcbi.1006112</pub-id></mixed-citation></ref>
<ref id="c6"><label>6</label><mixed-citation publication-type="journal"><string-name><surname>Marcatili</surname>, <given-names>P.</given-names></string-name>, <string-name><surname>Rosi</surname>, <given-names>A.</given-names></string-name> &amp; <string-name><surname>Tramontano</surname>, <given-names>A</given-names></string-name>. <article-title>PIGS: automatic prediction of antibody structures</article-title>. <source>Bioinformatics</source> <volume>24</volume>, <fpage>1953</fpage>–<lpage>1954</lpage> (<year>2008</year>). <pub-id pub-id-type="doi">10.1093/bioinformatics/btn341</pub-id></mixed-citation></ref>
<ref id="c7"><label>7</label><mixed-citation publication-type="journal"><string-name><surname>Leem</surname>, <given-names>J.</given-names></string-name>, <string-name><surname>Dunbar</surname>, <given-names>J.</given-names></string-name>, <string-name><surname>Georges</surname>, <given-names>G.</given-names></string-name>, <string-name><surname>Shi</surname>, <given-names>J.</given-names></string-name> &amp; <string-name><surname>Deane</surname>, <given-names>C. M</given-names></string-name>. <article-title>ABodyBuilder: Automated antibody structure prediction with data–driven accuracy estimation</article-title>. <source>mAbs</source> <volume>8</volume>, <fpage>1259</fpage>–<lpage>1268</lpage> (<year>2016</year>). <pub-id pub-id-type="doi">10.1080/19420862.2016.1205773</pub-id></mixed-citation></ref>
<ref id="c8"><label>8</label><mixed-citation publication-type="journal"><string-name><surname>Eswar</surname>, <given-names>N.</given-names></string-name> <etal>et al.</etal> <article-title>Comparative Protein Structure Modeling Using Modeller</article-title>. <source>Current Protocols in Bioinformatics</source> <volume>15</volume>, <fpage>5.6.1</fpage>–<lpage>5.6.30</lpage> (<year>2006</year>). <pub-id pub-id-type="doi">10.1002/0471250953.bi0506s15</pub-id></mixed-citation></ref>
<ref id="c9"><label>9</label><mixed-citation publication-type="journal"><string-name><surname>Almagro</surname>, <given-names>J. C.</given-names></string-name> <etal>et al.</etal> <article-title>Second antibody modeling assessment (AMA-II)</article-title>. <source>Proteins: Structure, Function, and Bioinformatics</source> <volume>82</volume>, <fpage>1553</fpage>–<lpage>1562</lpage> (<year>2014</year>). <pub-id pub-id-type="doi">10.1002/prot.24567</pub-id></mixed-citation></ref>
<ref id="c10"><label>10</label><mixed-citation publication-type="journal"><string-name><surname>Teplyakov</surname>, <given-names>A.</given-names></string-name> <etal>et al.</etal> <article-title>Antibody modeling assessment II. Structures and models</article-title>. <source>Proteins: Structure, Function, and Bioinformatics</source> <volume>82</volume>, <fpage>1563</fpage>–<lpage>1582</lpage> (<year>2014</year>). <pub-id pub-id-type="doi">10.1002/prot.24554</pub-id></mixed-citation></ref>
<ref id="c11"><label>11</label><mixed-citation publication-type="journal"><string-name><surname>Almagro</surname>, <given-names>J. C.</given-names></string-name> <etal>et al.</etal> <article-title>Antibody modeling assessment</article-title>. <source>Proteins: Structure, Function, and Bioinformatics</source> <volume>79</volume>, <fpage>3050</fpage>–<lpage>3066</lpage> (<year>2011</year>). <pub-id pub-id-type="doi">10.1002/prot.23130</pub-id></mixed-citation></ref>
<ref id="c12"><label>12</label><mixed-citation publication-type="journal"><string-name><surname>Jumper</surname>, <given-names>J.</given-names></string-name> &amp; <string-name><surname>Hassabis</surname>, <given-names>D</given-names></string-name>. <article-title>Protein structure predictions to atomic accuracy with AlphaFold</article-title>. <source>Nature Methods</source> <volume>19</volume>, <fpage>11</fpage>–<lpage>12</lpage> (<year>2022</year>). <pub-id pub-id-type="doi">10.1038/s41592-021-01362-6</pub-id></mixed-citation></ref>
<ref id="c13"><label>13</label><mixed-citation publication-type="journal"><string-name><surname>Du</surname>, <given-names>Z.</given-names></string-name> <etal>et al.</etal> <article-title>The trRosetta server for fast and accurate protein structure prediction</article-title>. <source>Nature Protocols</source> <volume>16</volume>, <fpage>5634</fpage>–<lpage>5651</lpage> (<year>2021</year>). <pub-id pub-id-type="doi">10.1038/s41596-021-00628-9</pub-id></mixed-citation></ref>
<ref id="c14"><label>14</label><mixed-citation publication-type="journal"><string-name><surname>Baek</surname>, <given-names>M.</given-names></string-name> <etal>et al.</etal> <article-title>Accurate prediction of protein structures and interactions using a three-track neural network</article-title>. <source>Science</source> <volume>373</volume>, <fpage>871</fpage>–<lpage>876</lpage> (<year>2021</year>). doi:<pub-id pub-id-type="doi">10.1126/science.abj8754</pub-id></mixed-citation></ref>
<ref id="c15"><label>15</label><mixed-citation publication-type="journal"><string-name><surname>Fang</surname>, <given-names>X.</given-names></string-name> <etal>et al.</etal> <article-title>Helixfold-single: Msa-free protein structure prediction by using protein language model as an alternative</article-title>. <source>Preprint</source> at arXiv:2207.13921 (<year>2022</year>). <pub-id pub-id-type="doi">10.48550/arXiv.2207.13921</pub-id></mixed-citation></ref>
<ref id="c16"><label>16</label><mixed-citation publication-type="journal"><string-name><surname>Lin</surname>, <given-names>Z.</given-names></string-name> <etal>et al.</etal> <article-title>Evolutionary-scale prediction of atomic-level protein structure with a language model</article-title>. <source>Science</source> <volume>379</volume>, <fpage>1123</fpage>–<lpage>1130</lpage> (<year>2023</year>). <pub-id pub-id-type="doi">10.1126/science.ade2574</pub-id></mixed-citation></ref>
<ref id="c17"><label>17</label><mixed-citation publication-type="journal"><string-name><surname>Chen</surname>, <given-names>J.</given-names></string-name> <etal>et al.</etal> <article-title>QuoteTarget: A sequence-based transformer protein language model to identify potentially druggable protein targets</article-title>. <source>Protein Science</source> <volume>32</volume>, <fpage>e4555</fpage> (<year>2023</year>). <pub-id pub-id-type="doi">10.1002/pro.4555</pub-id></mixed-citation></ref>
<ref id="c18"><label>18</label><mixed-citation publication-type="journal"><string-name><surname>Hie</surname>, <given-names>B. L.</given-names></string-name> <etal>et al.</etal> <article-title>Efficient evolution of human antibodies from general protein language models</article-title>. <source>Nature Biotechnology</source> (<year>2023</year>). <pub-id pub-id-type="doi">10.1038/s41587-023-01763-2</pub-id></mixed-citation></ref>
<ref id="c19"><label>19</label><mixed-citation publication-type="journal"><string-name><surname>Ferruz</surname>, <given-names>N.</given-names></string-name>, <string-name><surname>Schmidt</surname>, <given-names>S.</given-names></string-name> &amp; <string-name><surname>Höcker</surname>, <given-names>B</given-names></string-name>. <article-title>ProtGPT2 is a deep unsupervised language model for protein design</article-title>. <source>Nature Communications</source> <volume>13</volume>, <fpage>4348</fpage> (<year>2022</year>). <pub-id pub-id-type="doi">10.1038/s41467-022-32007-7</pub-id></mixed-citation></ref>
<ref id="c20"><label>20</label><mixed-citation publication-type="journal"><string-name><surname>Madani</surname>, <given-names>A.</given-names></string-name> <etal>et al.</etal> <article-title>Large language models generate functional protein sequences across diverse families</article-title>. <source>Nature Biotechnology</source> (<year>2023</year>). <pub-id pub-id-type="doi">10.1038/s41587-022-01618-2</pub-id></mixed-citation></ref>
<ref id="c21"><label>21</label><mixed-citation publication-type="journal"><string-name><surname>Ruffolo</surname>, <given-names>J. A.</given-names></string-name>, <string-name><surname>Chu</surname>, <given-names>L.-S.</given-names></string-name>, <string-name><surname>Mahajan</surname>, <given-names>S. P.</given-names></string-name> &amp; <string-name><surname>Gray</surname>, <given-names>J. J</given-names></string-name>. <article-title>Fast, accurate antibody structure prediction from deep learning on massive set of natural antibodies</article-title>. <source>Nature Communications</source> <volume>14</volume> (<year>2023</year>). <pub-id pub-id-type="doi">10.1038/s41467-023-38063-x</pub-id></mixed-citation></ref>
<ref id="c22"><label>22</label><mixed-citation publication-type="journal"><string-name><surname>Wu</surname>, <given-names>J.</given-names></string-name>, <string-name><surname>Wu</surname>, <given-names>F.</given-names></string-name>, <string-name><surname>Jiang</surname>, <given-names>B.</given-names></string-name>, <string-name><surname>Liu</surname>, <given-names>W.</given-names></string-name> &amp; <string-name><surname>Zhao</surname>, <given-names>P</given-names></string-name>. <article-title>tFold-Ab: Fast and Accurate Antibody Structure Prediction without Sequence Homologs</article-title>. <source>Preprint at bioRxiv</source>, 2022.2011.2010.515918 (<year>2022</year>). <pub-id pub-id-type="doi">10.1101/2022.11.10.515918</pub-id></mixed-citation></ref>
<ref id="c23"><label>23</label><mixed-citation publication-type="journal"><string-name><surname>Ruffolo</surname>, <given-names>J. A.</given-names></string-name>, <string-name><surname>Sulam</surname>, <given-names>J.</given-names></string-name> &amp; <string-name><surname>Gray</surname>, <given-names>J. J</given-names></string-name>. <article-title>Antibody structure prediction using interpretable deep learning</article-title>. <source>Patterns</source> <volume>3</volume>, <fpage>100406</fpage> (<year>2022</year>). <pub-id pub-id-type="doi">10.1016/j.patter.2021.100406</pub-id></mixed-citation></ref>
<ref id="c24"><label>24</label><mixed-citation publication-type="journal"><string-name><surname>Cohen</surname>, <given-names>T.</given-names></string-name>, <string-name><surname>Halfon</surname>, <given-names>M.</given-names></string-name> &amp; <string-name><surname>Schneidman-Duhovny</surname>, <given-names>D</given-names></string-name>. <article-title>NanoNet: Rapid and accurate end-to-end nanobody modeling by deep learning</article-title>. <source>Frontiers in Immunology</source> <volume>13</volume>, <issue>958584</issue> (<year>2022</year>). <pub-id pub-id-type="doi">10.3389/fimmu.2022.958584</pub-id></mixed-citation></ref>
<ref id="c25"><label>25</label><mixed-citation publication-type="journal"><string-name><surname>Zhu</surname>, <given-names>S.</given-names></string-name> <etal>et al.</etal> <article-title>Polymorphic nanobody crystals as long-acting intravitreal therapy for wet age-related macular degeneration</article-title>. <source>Bioengineering &amp; Translational Medicine</source>, <fpage>e10523</fpage> (<year>2023</year>). <pub-id pub-id-type="doi">10.1002/btm2.10523</pub-id></mixed-citation></ref>
<ref id="c26"><label>26</label><mixed-citation publication-type="journal"><string-name><surname>Dunbar</surname>, <given-names>J.</given-names></string-name> <etal>et al.</etal> <article-title>SAbDab: the structural antibody database</article-title>. <source>Nucleic Acids Res</source> <volume>42</volume>, <fpage>D1140</fpage>–<lpage>1146</lpage> (<year>2014</year>). <pub-id pub-id-type="doi">10.1093/nar/gkt1043</pub-id></mixed-citation></ref>
<ref id="c27"><label>27</label><mixed-citation publication-type="journal"><string-name><surname>Edgar</surname>, <given-names>R. C</given-names></string-name>. <article-title>Search and clustering orders of magnitude faster than BLAST</article-title>. <source>Bioinformatics</source> <volume>26</volume>, <fpage>2460</fpage>–<lpage>2461</lpage> (<year>2010</year>). <pub-id pub-id-type="doi">10.1093/bioinformatics/btq461</pub-id></mixed-citation></ref>
<ref id="c28"><label>28</label><mixed-citation publication-type="journal"><string-name><surname>Jumper</surname>, <given-names>J.</given-names></string-name> <etal>et al.</etal> <article-title>Highly accurate protein structure prediction with AlphaFold</article-title>. <source>Nature</source> <volume>596</volume>, <fpage>583</fpage>–<lpage>589</lpage> (<year>2021</year>). <pub-id pub-id-type="doi">10.1038/s41586-021-03819-2</pub-id></mixed-citation></ref>
<ref id="c29"><label>29</label><mixed-citation publication-type="journal"><string-name><surname>Rives</surname>, <given-names>A.</given-names></string-name> <etal>et al.</etal> <article-title>Biological structure and function emerge from scaling unsupervised learning to 250 million protein sequences</article-title>. <source>PNAS</source> <volume>118</volume> (<year>2021</year>). <pub-id pub-id-type="doi">10.1073/pnas.2016239118</pub-id></mixed-citation></ref>
<ref id="c30"><label>30</label><mixed-citation publication-type="journal"><string-name><surname>Cong</surname>, <given-names>Y.</given-names></string-name> <etal>et al.</etal> <article-title>Anchor-Locker Binding Mechanism of the Coronavirus Spike Protein to Human ACE2: Insights from Computational Analysis</article-title>. <source>Journal of Chemical Information and Modeling</source> <volume>61</volume>, <fpage>3529</fpage>–<lpage>3542</lpage> (<year>2021</year>). <pub-id pub-id-type="doi">10.1021/acs.jcim.1c00241</pub-id></mixed-citation></ref>
<ref id="c31"><label>31</label><mixed-citation publication-type="journal"><string-name><surname>Lippow</surname>, <given-names>S. M.</given-names></string-name>, <string-name><surname>Wittrup</surname>, <given-names>K. D.</given-names></string-name> &amp; <string-name><surname>Tidor</surname>, <given-names>B</given-names></string-name>. <article-title>Computational design of antibody-affinity improvement beyond in vivo maturation</article-title>. <source>Nature Biotechnology</source> <volume>25</volume>, <fpage>1171</fpage>–<lpage>1176</lpage> (<year>2007</year>). <pub-id pub-id-type="doi">10.1038/nbt1336</pub-id></mixed-citation></ref>
<ref id="c32"><label>32</label><mixed-citation publication-type="journal"><string-name><surname>Riahi</surname>, <given-names>S.</given-names></string-name> <etal>et al.</etal> <article-title>Application of an integrated computational antibody engineering platform to design SARS-CoV-2 neutralizers</article-title>. <source>Antibody Therapeutics</source> <volume>4</volume>, <fpage>109</fpage>–<lpage>122</lpage> (<year>2021</year>). <pub-id pub-id-type="doi">10.1093/abt/tbab011</pub-id></mixed-citation></ref>
<ref id="c33"><label>33</label><mixed-citation publication-type="journal"><string-name><surname>Clark</surname>, <given-names>L. A.</given-names></string-name> <etal>et al.</etal> <article-title>Affinity enhancement of an in vivo matured therapeutic antibody using structure-based computational design</article-title>. <source>Protein Science</source> <volume>15</volume>, <fpage>949</fpage>–<lpage>960</lpage> (<year>2006</year>). <pub-id pub-id-type="doi">10.1110/ps.052030506</pub-id></mixed-citation></ref>
<ref id="c34"><label>34</label><mixed-citation publication-type="journal"><string-name><surname>Shan</surname>, <given-names>S.</given-names></string-name> <etal>et al.</etal> <article-title>Deep learning guided optimization of human antibody against SARS-CoV-2 variants with broad neutralization</article-title>. <source>PNAS</source> <volume>119</volume>, <fpage>e2122954119</fpage> (<year>2022</year>). <pub-id pub-id-type="doi">10.1073/pnas.2122954119</pub-id></mixed-citation></ref>
<ref id="c35"><label>35</label><mixed-citation publication-type="journal"><string-name><surname>Choi</surname>, <given-names>Y.</given-names></string-name>, <string-name><surname>Hua</surname>, <given-names>C.</given-names></string-name>, <string-name><surname>Sentman</surname>, <given-names>C. L.</given-names></string-name>, <string-name><surname>Ackerman</surname>, <given-names>M. E.</given-names></string-name> &amp; <string-name><surname>Bailey-Kellogg</surname>, <given-names>C</given-names></string-name>. <article-title>Antibody humanization by structure-based computational protein design</article-title>. <source>mAbs</source> <volume>7</volume>, <fpage>1045</fpage>–<lpage>1057</lpage> (<year>2015</year>). <pub-id pub-id-type="doi">10.1080/19420862.2015.1076600</pub-id></mixed-citation></ref>
<ref id="c36"><label>36</label><mixed-citation publication-type="journal"><string-name><surname>Kurella</surname>, <given-names>V. B.</given-names></string-name> &amp; <string-name><surname>Gali</surname>, <given-names>R</given-names></string-name>. <article-title>Structure guided homology model based design and engineering of mouse antibodies for humanization</article-title>. <source>Bioinformation</source> <volume>10</volume>, <fpage>180</fpage>–<lpage>186</lpage> (<year>2014</year>). <pub-id pub-id-type="doi">10.6026/97320630010180</pub-id></mixed-citation></ref>
<ref id="c37"><label>37</label><mixed-citation publication-type="journal"><string-name><surname>Tomar</surname>, <given-names>D. S.</given-names></string-name>, <string-name><surname>Singh</surname>, <given-names>S. K.</given-names></string-name>, <string-name><surname>Li</surname>, <given-names>L.</given-names></string-name>, <string-name><surname>Broulidakis</surname>, <given-names>M. P.</given-names></string-name> &amp; <string-name><surname>Kumar</surname>, <given-names>S</given-names></string-name>. <article-title>In Silico Prediction of Diffusion Interaction Parameter (k(D)), a Key Indicator of Antibody Solution Behaviors</article-title>. <source>Pharmaceutical Research</source> <volume>35</volume>, <issue>193</issue> (<year>2018</year>). <pub-id pub-id-type="doi">10.1007/s11095-018-2466-6</pub-id></mixed-citation></ref>
<ref id="c38"><label>38</label><mixed-citation publication-type="journal"><string-name><surname>Froning</surname>, <given-names>K.</given-names></string-name> <etal>et al.</etal> <article-title>Computational stabilization of T cell receptors allows pairing with antibodies to form bispecifics</article-title>. <source>Nature Communications</source> <volume>11</volume>, <fpage>2330</fpage> (<year>2020</year>). <pub-id pub-id-type="doi">10.1038/s41467-020-16231-7</pub-id></mixed-citation></ref>
<ref id="c39"><label>39</label><mixed-citation publication-type="journal"><string-name><surname>Chowdhury</surname>, <given-names>R.</given-names></string-name> <etal>et al.</etal> <article-title>Single-sequence protein structure prediction using a language model and deep learning</article-title>. <source>Nature Biotechnology</source> <volume>40</volume>, <fpage>1617</fpage>–<lpage>1623</lpage> (<year>2022</year>). <pub-id pub-id-type="doi">10.1038/s41587-022-01432-w</pub-id></mixed-citation></ref>
<ref id="c40"><label>40</label><mixed-citation publication-type="journal"><string-name><surname>Watson</surname>, <given-names>J. L.</given-names></string-name> <etal>et al.</etal> <article-title>De novo design of protein structure and function with RFdiffusion</article-title>. <source>Nature</source> (<year>2023</year>). <pub-id pub-id-type="doi">10.1038/s41586-023-06415-8</pub-id></mixed-citation></ref>
<ref id="c41"><label>41</label><mixed-citation publication-type="journal"><string-name><surname>Dauparas</surname>, <given-names>J.</given-names></string-name> <etal>et al.</etal> <article-title>Robust deep learning-based protein sequence design using ProteinMPNN</article-title>. <source>Science</source> <volume>378</volume>, <fpage>49</fpage>–<lpage>56</lpage> (<year>2022</year>). doi:<pub-id pub-id-type="doi">10.1126/science.add2187</pub-id></mixed-citation></ref>
<ref id="c42"><label>42</label><mixed-citation publication-type="journal"><string-name><surname>Shin</surname>, <given-names>J.-E.</given-names></string-name> <etal>et al.</etal> <article-title>Protein design and variant prediction using autoregressive generative models</article-title>. <source>Nature Communications</source> <volume>12</volume>, <fpage>2403</fpage> (<year>2021</year>). <pub-id pub-id-type="doi">10.1038/s41467-021-22732-w</pub-id></mixed-citation></ref>
<ref id="c43"><label>43</label><mixed-citation publication-type="journal"><string-name><surname>Luo</surname>, <given-names>S.</given-names></string-name> <etal>et al.</etal> <article-title>Antigen-specific antibody design and optimization with diffusion-based generative models for protein structures</article-title>. <source>Advances in Neural Information Processing Systems</source> <volume>35</volume>, <fpage>9754</fpage>–<lpage>9767</lpage> (<year>2022</year>).</mixed-citation></ref>
<ref id="c44"><label>44</label><mixed-citation publication-type="journal"><string-name><surname>Watson</surname>, <given-names>J. L.</given-names></string-name> <etal>et al.</etal> <article-title>Broadly applicable and accurate protein design by integrating structure prediction networks and diffusion generative models</article-title>. <source>Preprint at bioRxiv</source>, 2022.2012.2009.519842 (<year>2022</year>). <pub-id pub-id-type="doi">10.1101/2022.12.09.519842</pub-id></mixed-citation></ref>
<ref id="c45"><label>45</label><mixed-citation publication-type="journal"><string-name><surname>Ingraham</surname>, <given-names>J.</given-names></string-name>, <string-name><surname>Garg</surname>, <given-names>V.</given-names></string-name>, <string-name><surname>Barzilay</surname>, <given-names>R.</given-names></string-name> &amp; <string-name><surname>Jaakkola</surname>, <given-names>T</given-names></string-name>. <article-title>Generative models for graph-based protein design</article-title>. <source>Advances in neural information processing systems</source> <volume>32</volume> (<year>2019</year>).</mixed-citation></ref>
<ref id="c46"><label>46</label><mixed-citation publication-type="journal"><string-name><surname>Zavrtanik</surname>, <given-names>U.</given-names></string-name> &amp; <string-name><surname>Hadzi</surname>, <given-names>S</given-names></string-name>. <article-title>A non-redundant data set of nanobody-antigen crystal structures</article-title>. <source>Data Brief</source> <volume>24</volume>, <fpage>103754</fpage> (<year>2019</year>). <pub-id pub-id-type="doi">10.1016/j.dib.2019.103754</pub-id></mixed-citation></ref>
<ref id="c47"><label>47</label><mixed-citation publication-type="journal"><string-name><surname>Chothia</surname>, <given-names>C.</given-names></string-name> &amp; <string-name><surname>Lesk</surname>, <given-names>A. M</given-names></string-name>. <article-title>Canonical structures for the hypervariable regions of immunoglobulins</article-title>. <source>Journal of Molecular Biology</source> <volume>196</volume>, <fpage>901</fpage>–<lpage>917</lpage> (<year>1987</year>). <pub-id pub-id-type="doi">10.1016/0022-2836(87)90412-8</pub-id></mixed-citation></ref>
<ref id="c48"><label>48</label><mixed-citation publication-type="journal"><string-name><surname>Gustaf</surname>, <given-names>A.</given-names></string-name> <etal>et al.</etal> <article-title>OpenFold: Retraining AlphaFold2 yields new insights into its learning mechanisms and capacity for generalization</article-title>. <source>Preprint at bioRxiv</source>, 2022.2011.2020.517210 (<year>2022</year>). <pub-id pub-id-type="doi">10.1101/2022.11.20.517210</pub-id></mixed-citation></ref>
<ref id="c49"><label>49</label><mixed-citation publication-type="journal"><string-name><surname>Banks</surname>, <given-names>J. L.</given-names></string-name> <etal>et al.</etal> <article-title>Integrated Modeling Program, Applied Chemical Theory (IMPACT)</article-title>. <source>Journal of Computational Chemistry</source> <volume>26</volume>, <fpage>1752</fpage>–<lpage>1780</lpage> (<year>2005</year>). <pub-id pub-id-type="doi">10.1002/jcc.20292</pub-id></mixed-citation></ref>
<ref id="c50"><label>50</label><mixed-citation publication-type="journal"><string-name><surname>Mirdita</surname>, <given-names>M.</given-names></string-name> <etal>et al.</etal> <article-title>ColabFold: making protein folding accessible to all</article-title>. <source>Nature Methods</source> <volume>19</volume>, <fpage>679</fpage>–<lpage>682</lpage> (<year>2022</year>). <pub-id pub-id-type="doi">10.1038/s41592-022-01488-1</pub-id></mixed-citation></ref>
<ref id="c51"><label>51</label><mixed-citation publication-type="journal"><string-name><surname>Dunbar</surname>, <given-names>J.</given-names></string-name> &amp; <string-name><surname>Deane</surname>, <given-names>C. M</given-names></string-name>. <article-title>ANARCI: antigen receptor numbering and receptor classification</article-title>. <source>Bioinformatics</source> <volume>32</volume>, <fpage>298</fpage>–<lpage>300</lpage> (<year>2016</year>). <pub-id pub-id-type="doi">10.1093/bioinformatics/btv552</pub-id></mixed-citation></ref>
<ref id="c52"><label>52</label><mixed-citation publication-type="journal"><string-name><surname>Levy</surname>, <given-names>E. D</given-names></string-name>. <article-title>A simple definition of structural regions in proteins and its use in analyzing interface evolution</article-title>. <source>Journal of Molecular Biology</source> <volume>403</volume>, <fpage>660</fpage>–<lpage>670</lpage> (<year>2010</year>). <pub-id pub-id-type="doi">10.1016/j.jmb.2010.09.028</pub-id></mixed-citation></ref>
<ref id="c53"><label>53</label><mixed-citation publication-type="journal"><string-name><surname>Honegger</surname>, <given-names>A.</given-names></string-name> &amp; <string-name><surname>Pluckthun</surname>, <given-names>A</given-names></string-name>. <article-title>Yet another numbering scheme for immunoglobulin variable domains: an automatic modeling and analysis tool</article-title>. <source>Journal of Molecular Biology</source> <volume>309</volume>, <fpage>657</fpage>–<lpage>670</lpage> (<year>2001</year>). <pub-id pub-id-type="doi">10.1006/jmbi.2001.4662</pub-id></mixed-citation></ref>
<ref id="c54"><label>54</label><mixed-citation publication-type="journal"><string-name><surname>Salomon-Ferrer</surname>, <given-names>R.</given-names></string-name>, <string-name><surname>Case</surname>, <given-names>D. A.</given-names></string-name> &amp; <string-name><surname>Walker</surname>, <given-names>R. C</given-names></string-name>. <article-title>An overview of the Amber biomolecular simulation package</article-title>. <source>Wiley Interdisciplinary Reviews: Computational Molecular Science</source> <volume>3</volume>, <fpage>198</fpage>–<lpage>210</lpage> (<year>2013</year>). <pub-id pub-id-type="doi">10.1002/wcms.1121</pub-id></mixed-citation></ref>
<ref id="c55"><label>55</label><mixed-citation publication-type="journal"><string-name><surname>Tian</surname>, <given-names>C.</given-names></string-name> <etal>et al.</etal> <article-title>ff19SB: Amino-Acid-Specific Protein Backbone Parameters Trained against Quantum Mechanics Energy Surfaces in Solution</article-title>. <source>Journal of Chemical Theory and Computation</source> <volume>16</volume>, <fpage>528</fpage>–<lpage>552</lpage> (<year>2020</year>). <pub-id pub-id-type="doi">10.1021/acs.jctc.9b00591</pub-id></mixed-citation></ref>
<ref id="c56"><label>56</label><mixed-citation publication-type="journal"><string-name><surname>Izadi</surname>, <given-names>S.</given-names></string-name>, <string-name><surname>Anandakrishnan</surname>, <given-names>R.</given-names></string-name> &amp; <string-name><surname>Onufriev</surname>, <given-names>A. V</given-names></string-name>. <article-title>Building Water Models: A Different Approach</article-title>. <source>Journal of Physical Chemistry Letters</source> <volume>5</volume>, <fpage>3863</fpage>–<lpage>3871</lpage> (<year>2014</year>). <pub-id pub-id-type="doi">10.1021/jz501780a</pub-id></mixed-citation></ref>
</ref-list>
<sec>
<fig id="figs1" position="float" orientation="portrait" fig-type="figure">
<label>Extended Data Fig. 1</label>
<caption><title>Solvent-accessible surface area analysis of predicted H3 loops.</title>
<p>The values represent the difference in SASA between H3 structures predicted by AF2 or H3-OPT and experimentally determined structures. Positive values indicate that the predicted structures have more exposed surface area compared to the native structures; negative values indicate less exposed surface area.</p></caption>
<graphic xlink:href="553933v1_figs1.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<fig id="figs2" position="float" orientation="portrait" fig-type="figure">
<label>Extended Data Fig. 2</label>
<caption><title>Side-by-side comparison of the Cα-RMSDs of H3-OPT and IgFold for moderate difficulty targets (n = 46) and challenging predictions (n = 33) (Without TM).</title>
<p>Each point represents the Cα-RMSD values of different methods.</p></caption>
<graphic xlink:href="553933v1_figs2.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<fig id="figs3" position="float" orientation="portrait" fig-type="figure">
<label>Extended Data Fig. 3</label>
<caption><title>Comparison of accuracy between AF2, H3-OPT, and tFold-Ab methods using the CAMEO 2022 benchmark dataset.</title>
<p>The x-axis represents different targets; y-axis represents Cα-RMSD values.</p></caption>
<graphic xlink:href="553933v1_figs3.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
</sec>
</back>
<sub-article id="sa0" article-type="editor-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.91512.1.sa3</article-id>
<title-group>
<article-title>eLife Assessment</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<name>
<surname>Sanchez</surname>
<given-names>Ignacio Enrique</given-names>
</name>
<role specific-use="editor">Reviewing Editor</role>
<aff>
<institution-wrap>
<institution>CONICET / Universidad de Buenos Aires</institution>
</institution-wrap>
<city>Buenos Aires</city>
<country>Argentina</country>
</aff>
</contrib>
</contrib-group>
<kwd-group kwd-group-type="claim-importance">
<kwd>Important</kwd>
</kwd-group>
<kwd-group kwd-group-type="evidence-strength">
<kwd>Solid</kwd>
</kwd-group>
</front-stub>
<body>
<p>This work presents H3-OPT, a deep learning method that effectively combines existing techniques for the prediction of antibody structure. This work is <bold>important</bold> because the method can aid the design of antibodies, which are key tools in many research and industrial applications. The experiments for validation are <bold>solid</bold>, although several points remain partially unclear, such as (1) which examples constitute proper validation, (2) what the relevance of the molecular dynamics calculations as performed is, (3) the statistics for some of the comparisons, and (4) the lack of comparison with other existing methods.</p>
</body>
</sub-article>
<sub-article id="sa1" article-type="referee-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.91512.1.sa2</article-id>
<title-group>
<article-title>Reviewer #1 (Public Review):</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<anonymous/>
<role specific-use="referee">Reviewer</role>
</contrib>
</contrib-group>
</front-stub>
<body>
<p>Summary:</p>
<p>
The authors developed a deep learning method called H3-OPT, which combines the strength of AF2 and PLM to reach better prediction accuracy of antibody CDR-H3 loops than AF2 and IgFold. These improvements will have an impact on antibody structure prediction and design.</p>
<p>Strengths:</p>
<p>
The training data are carefully selected and clustered, the network design is simple and effective.</p>
<p>The improvements include smaller average Ca RMSD, backbone RMSD, side chain RMSD, more accurate surface residues and/or SASA, and more accurate H3 loop-antigen contacts.</p>
<p>The performance is validated from multiple angles.</p>
<p>Weaknesses:</p>
<p>
There are very limited prediction-then-validation cases, basically just one case.</p>
</body>
</sub-article>
<sub-article id="sa2" article-type="referee-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.91512.1.sa1</article-id>
<title-group>
<article-title>Reviewer #2 (Public Review):</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<anonymous/>
<role specific-use="referee">Reviewer</role>
</contrib>
</contrib-group>
</front-stub>
<body>
<p>This work provides a new tool (H3-Opt) for the prediction of antibody and nanobody structures, based on the combination of AlphaFold2 and a pre-trained protein language model, with a focus on predicting the challenging CDR-H3 loops with enhanced accuracy than previously developed approaches. This task is of high value for the development of new therapeutic antibodies. The paper provides an external validation consisting of 131 sequences, with further analysis of the results by segregating the test sets into three subsets of varying difficulty and comparison with other available methods. Furthermore, the approach was validated by comparing three experimentally solved 3D structures of anti-VEGF nanobodies with the H3-Opt predictions</p>
<p>Strengths:</p>
<p>
The experimental design to train and validate the new approach has been clearly described, including the dataset compilation and its representative sampling into training, validation and test sets, and structure preparation. The results of the in silico validation are quite convincing and support the authors' conclusions.</p>
<p>The datasets used to train and validate the tool and the code are made available by the authors, which ensures transparency and reproducibility, and allows future benchmarking exercises with incoming new tools.</p>
<p>Compared to AlphaFold2, the authors' optimization seems to produce better results for the most challenging subsets of the test set.</p>
<p>Weaknesses:</p>
<p>
The scope of the binding affinity prediction using molecular dynamics is not that clearly justified in the paper.</p>
<p>Some parts of the manuscript should be clarified, particularly the ones that relate to the experimental validation of the predictions made by the reported method. It is not absolutely clear whether the experimental validation is truly a prospective validation. Since the methodological aspects of the experimental determination are not provided here, it seems that this may not be the case. This is a key aspect of the manuscript that should be described more clearly.</p>
<p>Some Figures would benefit from a more clear presentation.</p>
</body>
</sub-article>
<sub-article id="sa3" article-type="referee-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.91512.1.sa0</article-id>
<title-group>
<article-title>Reviewer #3 (Public Review):</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<anonymous/>
<role specific-use="referee">Reviewer</role>
</contrib>
</contrib-group>
</front-stub>
<body>
<p>Summary:</p>
<p>
The manuscript introduces a new computational framework for choosing 'the best method' according to the case for getting the best possible structural prediction for the CDR-H3 loop. The authors show their strategy improves on average the accuracy of the predictions on datasets of increasing difficulty in comparison to several state-of-the-art methods. They also show the benefits of improving the structural predictions of the CDR-H3 in the evaluation of different properties that may be relevant for drug discovery and therapeutic design.</p>
<p>Strengths:</p>
<p>
The authors introduce a novel framework, which can be easily adapted and improved. The authors use a well-defined dataset to test their new method. A modest average accuracy gain is obtained in comparison to other state-of-the art methods for the same task while avoiding testing different prediction approaches.</p>
<p>Weaknesses:</p>
<p>
The accuracy gain is mainly ascribed to easy cases, while the accuracy and precision for moderate to challenging cases are comparable to other PLM methods (see Fig. 4b and Extended Data Fig. 2). That raises the question: how likely is it to be in a moderate or challenging scenario? For example, it is not clear whether the comparison to the solved X-ray structures of anti-VEGF nanobodies represents an easy or challenging case for H3-OPT. The mutant nanobodies seem not to provide any further validation as the single mutations are very far away from the CDR-H3 loop and they do not disrupt the structure in any way. Indeed, RMSD values follow the same trend in H3-OPT and IgFold predictions (Fig. 4c). A more challenging test and interesting application could be solving the structure of a designed or mutated CDR-H3 loop.</p>
<p>The proposed method lacks a confidence score or a warning to help guide the users in moderate to challenging cases.</p>
<p>The fact that AF2 outperforms H3-OPT in some particular cases (e.g. Fig. 2c and Extended Data Fig. 3) raises the question: is there still room for improvements? It is not clear how sensible is H3-OPT to the defined parameters. In the same line, bench-marking against other available prediction algorithms, such as OmegaFold, could shed light on the actual accuracy limit.</p>
</body>
</sub-article>
</article>