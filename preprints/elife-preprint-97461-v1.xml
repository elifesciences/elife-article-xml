<?xml version="1.0" ?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.3 20210610//EN"  "JATS-archivearticle1-mathml3.dtd"><article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.3" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="nlm-ta">elife</journal-id>
<journal-id journal-id-type="publisher-id">eLife</journal-id>
<journal-title-group>
<journal-title>eLife</journal-title>
</journal-title-group>
<issn publication-format="electronic" pub-type="epub">2050-084X</issn>
<publisher>
<publisher-name>eLife Sciences Publications, Ltd</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">97461</article-id>
<article-id pub-id-type="doi">10.7554/eLife.97461</article-id>
<article-id pub-id-type="doi" specific-use="version">10.7554/eLife.97461.1</article-id>
<article-version-alternatives>
<article-version article-version-type="publication-state">reviewed preprint</article-version>
<article-version article-version-type="preprint-version">1.3</article-version>
</article-version-alternatives>
<article-categories>
<subj-group subj-group-type="heading">
<subject>Evolutionary Biology</subject>
</subj-group>
</article-categories>
<title-group>
<article-title>Artificial selection for microbial collective composition can succeed or fail depending on the initial and target values</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-3318-6377</contrib-id>
<name>
<surname>Lee</surname>
<given-names>Juhee</given-names>
</name>
<xref ref-type="aff" rid="a1">a</xref>
<xref ref-type="aff" rid="a2">b</xref>
</contrib>
<contrib contrib-type="author" corresp="yes">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-5693-381X</contrib-id>
<name>
<surname>Shou</surname>
<given-names>Wenying</given-names>
</name>
<xref ref-type="aff" rid="a3">c</xref>
<xref ref-type="corresp" rid="cor1">1</xref>
</contrib>
<contrib contrib-type="author" corresp="yes">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-3552-6275</contrib-id>
<name>
<surname>Park</surname>
<given-names>Hye Jin</given-names>
</name>
<xref ref-type="aff" rid="a1">a</xref>
<xref ref-type="aff" rid="a2">b</xref>
<xref ref-type="corresp" rid="cor1">1</xref>
</contrib>
<aff id="a1"><label>a</label><institution>Department of Physics, Inha University</institution>, Incheon 22212, <country>Republic of Korea</country></aff>
<aff id="a2"><label>b</label><institution>Asia Pacific Center for Theoretical Physics</institution>, Pohang 37673, <country>Republic of Korea</country></aff>
<aff id="a3"><label>c</label><institution>Centre for Life’s Origins and Evolution, Department of Genetics, Evolution and Environment, University College London</institution>, London WC1E 6BT, <country>United Kingdom</country></aff>
</contrib-group>
<contrib-group content-type="section">
<contrib contrib-type="editor">
<name>
<surname>Bitbol</surname>
<given-names>Anne-Florence</given-names>
</name>
<role>Reviewing Editor</role>
<aff>
<institution-wrap>
<institution>Ecole Polytechnique Federale de Lausanne (EPFL)</institution>
</institution-wrap>
<city>Lausanne</city>
<country>Switzerland</country>
</aff>
</contrib>
<contrib contrib-type="senior_editor">
<name>
<surname>Walczak</surname>
<given-names>Aleksandra M</given-names>
</name>
<role>Senior Editor</role>
<aff>
<institution-wrap>
<institution>CNRS</institution>
</institution-wrap>
<city>Paris</city>
<country>France</country>
</aff>
</contrib>
</contrib-group>
<author-notes>
<corresp id="cor1"><label>1</label>To whom correspondence should be addressed. E-mail:<email>wenying.shou@gmail.com</email> and E-mail: <email>hyejin.park@inha.ac.kr</email></corresp>
<fn fn-type="others"><p>J. Lee., W. Shou, H. J. Park designed research; J. Lee performed research; J. Lee, W. Shou, H. J. Park wrote the paper.</p></fn>
<fn fn-type="others"><p>The authors declare no competing interest.</p></fn>
</author-notes>
<pub-date date-type="original-publication" iso-8601-date="2024-05-29">
<day>29</day>
<month>05</month>
<year>2024</year>
</pub-date>
<volume>13</volume>
<elocation-id>RP97461</elocation-id>
<history>
<date date-type="sent-for-review" iso-8601-date="2024-03-18">
<day>18</day>
<month>03</month>
<year>2024</year>
</date>
</history>
<pub-history>
<event>
<event-desc>Preprint posted</event-desc>
<date date-type="preprint" iso-8601-date="2024-01-02">
<day>02</day>
<month>01</month>
<year>2024</year>
</date>
<self-uri content-type="preprint" xlink:href="https://doi.org/10.1101/2023.03.07.531234"/>
</event>
</pub-history>
<permissions>
<copyright-statement>© 2024, Lee et al</copyright-statement>
<copyright-year>2024</copyright-year>
<copyright-holder>Lee et al</copyright-holder>
<ali:free_to_read/>
<license xlink:href="https://creativecommons.org/licenses/by/4.0/">
<ali:license_ref>https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
<license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p>
</license>
</permissions>
<self-uri content-type="pdf" xlink:href="elife-preprint-97461-v1.pdf"/>
<abstract>
<p>Microbial collectives, capable of functions beyond the reach of individual populations, can be enhanced through artificial selection. However, this process presents unique challenges. Here, we explore the ‘waterfall’ phenomenon, a metaphor describing how the success in achieving a desired genotype or species composition in microbial collectives can depend on both the target characteristics and initial conditions. We focus on collectives comprising fast-growing (F) and slow-growing (S) types, aiming to achieve specific S frequencies. Through simulations and analytical calculations, we show that intermediate target S frequencies might be elusive, akin to maintaining a raft’s position within a waterfall, rather than above or below it. This challenge arises because intra-collective selection, favoring F during growth, is the strongest at intermediate S frequencies, which can overpower counteracting inter-collective selection effects. Achieving low target S frequencies is consistently possible as expected, but high target S frequencies require an initially high S frequency — similar to a raft that can descend but not ascend a waterfall. The range of attainable target frequencies is significantly influenced by the initial population size of the collectives, while the number of collectives under selection plays a less critical role. In scenarios involving more than two types, the evolutionary trajectory must navigate entirely away from the metaphorical ‘waterfall drop.’ Our findings illustrate that the strength of intra-collective evolution is frequency-dependent, with implications in experimental planning.</p>
</abstract>
<kwd-group kwd-group-type="author">
<kwd>Artificial selection on microbial collectives</kwd>
<kwd>Variation and heredity of collective’s composition</kwd>
<kwd>Stochastic process</kwd>
</kwd-group>
</article-meta>
<notes>
<notes notes-type="competing-interest-statement">
<title>Competing Interest Statement</title><p>The authors have declared no competing interest.</p></notes>
<fn-group content-type="summary-of-updates">
<title>Summary of Updates:</title>
<fn fn-type="update"><p>The abstract is updated.</p></fn>
</fn-group>
</notes>
</front>
<body>
<sec id="s1">
<title>Introduction</title>
<p><bold>M</bold>icrobial collectives can carry out functions that arise from interactions among member species. These functions, such as waste degradation (<xref ref-type="bibr" rid="c1">1</xref>, <xref ref-type="bibr" rid="c2">2</xref>), probiotics (<xref ref-type="bibr" rid="c3">3</xref>), and vitamin production (<xref ref-type="bibr" rid="c4">4</xref>), can be useful for human health and biotechnology. To improve collective functions, one can perform artificial selection (directed evolution) on collectives: Low-density “Newborn” collectives are allowed to “mature” during which cells proliferate and possibly mutate, and community function develops. “Adult” collectives with high functions are then chosen to reproduce, each seeding multiple offspring Newborns. Artificial selection of collectives have been attempted both in experiments (<xref ref-type="bibr" rid="c5">5</xref>–<xref ref-type="bibr" rid="c19">19</xref>) and in simulations (<xref ref-type="bibr" rid="c20">20</xref>–<xref ref-type="bibr" rid="c30">30</xref>), often with unimpressive outcomes.</p>
<p>One of the major challenges in selecting collectives is to ensure the inheritance of a collective function (<xref ref-type="bibr" rid="c31">31</xref>, <xref ref-type="bibr" rid="c32">32</xref>). Inheritance can be compromised when genotype and species compositions change from a parent collective to offspring collectives. During maturation of a collective, genotype compositions within each species can be altered by intra-collective evolution, while species compositions can be shifted by ecological interactions. Furthermore, during reproduction of a collective, genotype and species compositions of offspring can vary stochastically from those of the parent.</p>
<p>Here, we consider the selection of collectives of two types with different growth rates to achieve a taget composition in the Adult collective. Earlier work has demonstrated that nearly any target species composition can be achieved when selecting communities of two competing species with unequal growth rates (<xref ref-type="bibr" rid="c24">24</xref>, <xref ref-type="bibr" rid="c33">33</xref>), so long as the shared resource is depleted during collective maturation (<xref ref-type="bibr" rid="c24">24</xref>). In this case, both species initially evolved to grow faster, and the slower-growing species was preserved due to stochastic fluctuations in species composition during collective reproduction. Eventually, both species evolved to grow sufficiently fast to deplete the shared resource during collective maturation, and evolution in competition coefficients then acted to stabilize species ratio to the target value (<xref ref-type="bibr" rid="c24">24</xref>).</p>
<p>Here, we mathematically examine the selection of target type compositions in two-type collectives when nutrient is always in excess. This allows us to analytically examine the evolutionary tipping point between intra-collective and inter-collective selection. We show that this tipping point creates a “waterfall” effect which restricts not only which target compositions are achievable, but also the initial composition required to achieve the target. We also investigate how the range of achievable target composition is affected by the population size in Newborns and the total number of collectives under selection. Finally, we show that the waterfall phenomenon extends to systems with more than 2 types.</p>
</sec>
<sec id="s2">
<title>Results and Discussions</title>
<p>We start with selecting for a target composition in collectives of fast-growing F and slow-growing S types. We show that intermediate F frequencies or equivalently, intermediate S frequencies, are the hardest targets to achieve. We then show that similar conclusions hold when selecting for a target composition in collectives of more than two types. We mainly describe in terms of F frequency <italic>f</italic> = <italic>F/</italic>(<italic>S</italic> + <italic>F</italic>), which is related to S frequency <italic>s</italic> = 1 − <italic>f</italic> .</p>
<sec id="s2a">
<title>A selection cycle</title>
<p>A selection cycle (<xref rid="fig1" ref-type="fig">Fig. 1</xref>) starts with a total of <italic>g</italic> Newborn collectives. We consider two genotypes - slow-growing type (S) and fast-growing type (F), with S mutating to F at a rate <italic>μ</italic>. At the beginning of cycle <italic>k</italic> (<italic>t</italic> = 0), a collective has a fixed total cell number <inline-formula><inline-graphic xlink:href="531234v3_inline1.gif" mimetype="image" mime-subtype="gif"/></inline-formula> where <inline-formula><inline-graphic xlink:href="531234v3_inline2.gif" mimetype="image" mime-subtype="gif"/></inline-formula>and <inline-formula><inline-graphic xlink:href="531234v3_inline3.gif" mimetype="image" mime-subtype="gif"/></inline-formula>denote the numbers of S and F cells in collective <italic>i</italic> (1 ≤ <italic>i</italic> ≤ <italic>g</italic>) at time <italic>t</italic> (0 ≤ <italic>t</italic> ≤ <italic>τ</italic>) of cycle <italic>k</italic>. The average F frequency among the <italic>g</italic> Newborn collectives is <inline-formula><inline-graphic xlink:href="531234v3_inline4.gif" mimetype="image" mime-subtype="gif"/></inline-formula>, such that the initial F cell number in each Newborn is drawn from the binomial distribution Binom <inline-formula><inline-graphic xlink:href="531234v3_inline5.gif" mimetype="image" mime-subtype="gif"/></inline-formula>.</p>
<fig id="fig1" position="float" fig-type="figure">
<label>Fig. 1.</label>
<caption><title>Schematic for artificial selection on collectives.</title>
<p>Each selection cycle begins with a total of <italic>g</italic> Newborn collectives (black open circles), each with <italic>N</italic><sub>0</sub> total cells of slow-growing type (S, red-colored dots) and fast-growing type (F, blue-colored dots). During maturation (over time <italic>τ</italic>), S and F cells divide at rates <italic>r</italic> and <italic>r</italic> + <italic>ω</italic> (<italic>ω &gt;</italic> 0), respectively. S mutates to F at rate <italic>μ</italic>. In the selection stage, the Adult collective with F frequency <italic>f</italic> closest to the target composition <inline-formula><inline-graphic xlink:href="531234v3_inline233.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is chosen to reproduce <italic>g</italic> Newborns for the next cycle. Newborns are sampled from the chosen Adult (yellow star) with <italic>N</italic><sub>0</sub> cells each Newborn. The selection cycle is then repeated until the F frequency reaches a steady state, which may or may not be the target composition. To denote a quantity <italic>x</italic> of <italic>i</italic>-th collective in cycle <italic>k</italic> at time <italic>t</italic> (0 ≤ <italic>t</italic> ≤ <italic>τ</italic>), we use notation <inline-formula><inline-graphic xlink:href="531234v3_inline234.gif" mimetype="image" mime-subtype="gif"/></inline-formula> where <italic>x</italic> ∈ {<italic>S, F, s, f</italic> }. Note that time <italic>t</italic> = 0 is for Newborns and <italic>t</italic> = <italic>τ</italic> is for Adults.</p></caption>
<graphic xlink:href="531234v3_fig1.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>Collectives are allowed to grow for time <italic>τ</italic> (‘Maturation’ in <xref rid="fig1" ref-type="fig">Fig. 1</xref>). During maturation, S and F grow at rates <italic>r</italic> and <italic>r</italic> + <italic>ω</italic> (<italic>ω &gt;</italic> 0), respectively. If maturation time <italic>τ</italic> is too small, matured collectives (“Adults”) do not have enough cells to reproduce <italic>g</italic> Newborn collectives with <italic>N</italic><sub>0</sub> cells. On the other hand, if maturation time <italic>τ</italic> is too long, fast-growing F will take over. Hence we set the maturation time <italic>τ</italic> = ln(<italic>g</italic> + 1)<italic>/r</italic>, which guarantees sufficient cells to produce <italic>g</italic> Newborn collectives from a single Adult collective.</p>
<p>At the end of a cycle, the Adult with the highest function is chosen to reproduce <italic>g</italic> Newborn collectives each with <italic>N</italic><sub>0</sub> cells (‘Selection’ and ‘Reproduction’ in <xref rid="fig1" ref-type="fig">Fig. 1</xref>). This allows us to employ the simplest version of the extreme value theory, and in our case, choosing top 1 outperforms a less stringent “choosing top 5%” selection regime. Collective function is dictated by the F frequency <italic>f</italic>, and is maximized at the target value <inline-formula><inline-graphic xlink:href="531234v3_inline6.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. Thus among all Adult collectives, the chosen Adult has F frequency <italic>f</italic> <sup>∗</sup> closest to the target value <inline-formula><inline-graphic xlink:href="531234v3_inline7.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. For the next cycle, the number of F cells in Newborns follow a binomial distribution with the mean value <italic>N</italic><sub>0</sub><italic>f</italic> <sup>∗</sup>. By repeating the selection cycle, we aim to achieve the target composition <inline-formula><inline-graphic xlink:href="531234v3_inline8.gif" mimetype="image" mime-subtype="gif"/></inline-formula>.</p>
</sec>
<sec id="s2b">
<title>The success of collective selection is constrained by the target composition, and sometimes also by the initial composition</title>
<p>Since intra-collective selection favors F, we expect that a higher target <inline-formula><inline-graphic xlink:href="531234v3_inline9.gif" mimetype="image" mime-subtype="gif"/></inline-formula> (a lower target <italic>ŝ</italic>) is easier to achieve. Note that once a target frequency is achieved, inter-collective selection is always required to maintain that frequency due to the fitness difference between the two types.</p>
<p>We fixed <italic>N</italic><sub>0</sub>,the total population size of a Newborn, to 1000, and obtained selection dynamics for various initial and target F frequencies by implementing stochastic simulations (<xref ref-type="sec" rid="s5a">Sec. 1</xref> in Supplementary Information). If the target value is high (e.g.<inline-formula><inline-graphic xlink:href="531234v3_inline10.gif" mimetype="image" mime-subtype="gif"/></inline-formula>, <xref rid="fig2" ref-type="fig">Figure 2<bold>a</bold></xref> magenta), selection is successful in the sense that the absolute error <italic>d</italic> between the target frequency <inline-formula><inline-graphic xlink:href="531234v3_inline11.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and the selected frequency averaged among independent simulations ⟨<italic>f</italic> <sup>∗</sup>⟩ is smaller than 0.05 (i.e <inline-formula><inline-graphic xlink:href="531234v3_inline12.gif" mimetype="image" mime-subtype="gif"/></inline-formula> computed absolute errors are shown in Supplementary Information <xref rid="figS3" ref-type="fig">Fig. S3</xref>). F frequency of the chosen collective eventually converges to the target value and stays around it, regardless of the initial frequency. In contrast, without collective-level selection (e.g. choosing a random collective to reproduce), F frequency increases until F reaches fixation (Supplementary information <xref rid="figS4" ref-type="fig">Fig. S4<bold>b</bold></xref>).</p>
<fig id="fig2" position="float" fig-type="figure">
<label>Fig. 2.</label>
<caption><title>Initial and target compositions determine the success of artificial selection on collectives.</title>
<p><bold>(a</bold>-<bold>c)</bold> Mutant frequency of the selected Adult collective (<italic>f</italic> <sup><italic>∗</italic></sup>) over cycles. The target frequency <inline-formula><inline-graphic xlink:href="531234v3_inline235.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is marked as a dotted line, while <italic>f</italic> <sup><italic>H</italic></sup> (black solid line) and <italic>f</italic> <sup><italic>L</italic></sup> (black dashed line) delineate boundary values that define the region of successful selection. <bold>a</bold> A high target F frequency (<inline-formula><inline-graphic xlink:href="531234v3_inline236.gif" mimetype="image" mime-subtype="gif"/></inline-formula> ; magenta dotted line) can be achieved from any initial frequency (black dots). <bold>b</bold> An intermediate target frequency (<inline-formula><inline-graphic xlink:href="531234v3_inline237.gif" mimetype="image" mime-subtype="gif"/></inline-formula> ; green dotted line) is never achievable, as all initial conditions converge to near <italic>f</italic> <sup><italic>H</italic></sup> . <bold>c</bold> A low target freqeuncy <inline-formula><inline-graphic xlink:href="531234v3_inline238.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is acheiveable, but only from initial frequencies below <italic>f</italic> <sup><italic>L</italic></sup>. For initial frequencies at <italic>f</italic> <sup><italic>L</italic></sup>, stochastic outcomes (grey curves) are observed: while some replicates reached the target frequency, other reached <italic>f</italic> <sup><italic>H</italic></sup>. For parameters, we used wildtype growth rate <italic>r</italic> = 0.5, F growth advantage <italic>ω</italic> = 0.03, mutation rate <italic>μ</italic> = 0.0001, maturation time <italic>τ</italic> ≈ 4.8, and <italic>N</italic><sub>0</sub> = 1000. The number of collective <italic>g</italic> = 10. Each black line is averaged from independent 300 realizations. <bold>d</bold> Two accessible regions (gold). Either high <inline-formula><inline-graphic xlink:href="531234v3_inline239.gif" mimetype="image" mime-subtype="gif"/></inline-formula> (region 2) or low <inline-formula><inline-graphic xlink:href="531234v3_inline240.gif" mimetype="image" mime-subtype="gif"/></inline-formula> starting from low initial <italic>f</italic> (region 1) can be achieved. We theoretically predict (by numerically integrating <xref ref-type="disp-formula" rid="eqn1">Eq. 1</xref>) the boundaries of success regions, <italic>f</italic> <sup><italic>H</italic></sup> (black solid line) and <italic>f</italic> <sup><italic>L</italic></sup> (black dashed lines), which agree with simulation results (gold regions). <bold>e</bold> Example trajectories from initial compositions (black dots) to the target compositions (dashed lines). The gold areas indicate the region of initial frequencies where the target frequency can be achieved. <bold>f</bold> The tension between intra-collective selection and inter-collective selection creates a “waterfall” phenomenon. See the main text for details.</p></caption>
<graphic xlink:href="531234v3_fig2.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>In contrast, an intermediate target frequency (e.g.<inline-formula><inline-graphic xlink:href="531234v3_inline13.gif" mimetype="image" mime-subtype="gif"/></inline-formula> <xref rid="fig2" ref-type="fig">Fig. 2<bold>b</bold></xref> green) is never achievable. High initial F frequencies (e.g. 0.6 and 0.95) decline toward the target, but stabilize at an “higher-threshold” (<italic>f</italic> <sup><italic>H</italic></sup> ∼ 0.7, solid line segment in <xref rid="fig2" ref-type="fig">Fig. 2<bold>a-c</bold></xref>) above the target. Low initial F frequencies (e.g. 0) increase toward the target, but then overshoot and stabilize at the <italic>f</italic> <sup><italic>H</italic></sup> value.</p>
<p>If the target frequency is low (e.g.<inline-formula><inline-graphic xlink:href="531234v3_inline14.gif" mimetype="image" mime-subtype="gif"/></inline-formula> <xref rid="fig2" ref-type="fig">Fig. 2<bold>c</bold></xref> red line), artificial selection succeeds when the initial frequency is below a “lower-threshold” (<italic>f</italic> <sup><italic>L</italic></sup>, dashed line segment in <xref rid="fig2" ref-type="fig">Fig. 2<bold>a-c</bold></xref>). Initial F frequencies above <italic>f</italic> <sup><italic>L</italic></sup> (e.g. 0.45 and 0.95) converge to <italic>f</italic> <sup><italic>H</italic></sup> instead. Initial F frequencies near <italic>f</italic> <sup><italic>L</italic></sup> display stochastic trajectories, converging to either <italic>f</italic> <sup><italic>H</italic></sup> or the target.</p>
<p>In summary, two regions of target frequencies are “accessible” in the sense that a target value in the region can be maintained once reached; gold in <xref rid="fig2" ref-type="fig">Fig. 2<bold>d, e</bold></xref>): (<xref ref-type="bibr" rid="c1">1</xref>) target frequencies above <inline-formula><inline-graphic xlink:href="531234v3_inline15.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and (<xref ref-type="bibr" rid="c2">2</xref>) target frequencies below <inline-formula><inline-graphic xlink:href="531234v3_inline16.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and starting at an average frequency below <inline-formula><inline-graphic xlink:href="531234v3_inline17.gif" mimetype="image" mime-subtype="gif"/></inline-formula>.</p>
</sec>
<sec id="s2c">
<title>Intra-collective evolution is the fastest at intermediate F frequencies, creating the “waterfall” phenomenon</title>
<p>To understand what gives rise to the two accessible regions, we calculated how the distribution of F frequency <italic>f</italic> might change after one cycle. We consider the case where <inline-formula><inline-graphic xlink:href="531234v3_inline18.gif" mimetype="image" mime-subtype="gif"/></inline-formula>, the F frequency of the selected Adult at cycle <italic>k</italic>, is above the target value <inline-formula><inline-graphic xlink:href="531234v3_inline19.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. This case is particularly challenging because intra-collective evolution favours fast-growing F and thus will further increase <italic>f</italic> away from the target. From <inline-formula><inline-graphic xlink:href="531234v3_inline20.gif" mimetype="image" mime-subtype="gif"/></inline-formula>, Newborns of cycle <italic>k</italic> + 1 will have <italic>f</italic> fluctuating around <inline-formula><inline-graphic xlink:href="531234v3_inline21.gif" mimetype="image" mime-subtype="gif"/></inline-formula>, and after they mature,in F frequency over one cycle, the minimum <italic>f</italic> is selected <inline-formula><inline-graphic xlink:href="531234v3_inline22.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. If the selected composition at cycle <italic>k</italic> + 1 can be reduced compared to that of cycle <italic>k</italic> (i.e. <inline-formula><inline-graphic xlink:href="531234v3_inline23.gif" mimetype="image" mime-subtype="gif"/></inline-formula>), the system can evolve to the lower target value.</p>
<p>Mathematically, the conditional probability distribution Ψ of <inline-formula><inline-graphic xlink:href="531234v3_inline24.gif" mimetype="image" mime-subtype="gif"/></inline-formula> (the F frequency of the selected Adult at cycle <italic>k</italic> + 1 being <italic>f</italic>) given the selected <inline-formula><inline-graphic xlink:href="531234v3_inline25.gif" mimetype="image" mime-subtype="gif"/></inline-formula> at cycle <italic>k</italic> is
<disp-formula id="eqn1">
<graphic xlink:href="531234v3_eqn1.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<xref ref-type="disp-formula" rid="eqn1">Equation 1</xref> can be broken down into two parts: (i) <inline-formula><inline-graphic xlink:href="531234v3_inline26.gif" mimetype="image" mime-subtype="gif"/></inline-formula> describes that any one of the <italic>g</italic> collectives must achieve <italic>f</italic>, where <inline-formula><inline-graphic xlink:href="531234v3_inline27.gif" mimetype="image" mime-subtype="gif"/></inline-formula> denotes the probability of an Adult (<italic>t</italic> = <italic>τ</italic>) in cycle <italic>k</italic> + 1 achieving <italic>f</italic> given <inline-formula><inline-graphic xlink:href="531234v3_inline28.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. (ii) <inline-formula><inline-graphic xlink:href="531234v3_inline29.gif" mimetype="image" mime-subtype="gif"/></inline-formula> describes that the remaining <italic>g</italic> − 1 collectives must all achieve a frequency above <italic>f</italic> (and thus not selected). <inline-formula><inline-graphic xlink:href="531234v3_inline30.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is calculated by integrating across <italic>ζ</italic> the term <inline-formula><inline-graphic xlink:href="531234v3_inline31.gif" mimetype="image" mime-subtype="gif"/></inline-formula> (the probability density of <italic>f</italic><sub><italic>k</italic>+1,0</sub> of a Newborn in cycle <italic>k</italic> + 1 achieving <italic>ζ</italic> given <inline-formula><inline-graphic xlink:href="531234v3_inline32.gif" mimetype="image" mime-subtype="gif"/></inline-formula>) multiplied by the term <inline-formula><inline-graphic xlink:href="531234v3_inline33.gif" mimetype="image" mime-subtype="gif"/></inline-formula> (the probability density of an Adult achieving <italic>f</italic>′ given Newborn’s frequency <italic>ζ</italic>, see Methods).</p>
<p>When we approximate the Adults’ <italic>f</italic> in cycle <italic>k</italic> + 1 as Guassian with mean <inline-formula><inline-graphic xlink:href="531234v3_inline34.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and variance <inline-formula><inline-graphic xlink:href="531234v3_inline35.gif" mimetype="image" mime-subtype="gif"/></inline-formula>, we can obtain an analytical solution of the change in <italic>f</italic> over one cycle - the difference between the median value of the conditional probability distribution Ψ <inline-formula><inline-graphic xlink:href="531234v3_inline36.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and the selected frequency of <inline-formula><inline-graphic xlink:href="531234v3_inline37.gif" mimetype="image" mime-subtype="gif"/></inline-formula> (<xref ref-type="sec" rid="s5b">Sec. 2</xref> in Supplementary Information):
<disp-formula id="eqn2">
<graphic xlink:href="531234v3_eqn2.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where
<disp-formula id="eqn3">
<graphic xlink:href="531234v3_eqn3.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
and
<disp-formula id="eqn4">
<graphic xlink:href="531234v3_eqn4.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<italic>e</italic> is Euler’s number (2.71828…), and Φ<sup>−1</sup>(…) is an inverse cumulative function of standard normal distribution. For those unfamiliar with Φ<sup>−1</sup>(…), <italic>y</italic> = Φ<sup>−1</sup>(<italic>x</italic>) (where 0 ≤ <italic>x</italic> ≤ 1) is the number such that the probability of a standard normal random variable being less than or equal to <italic>y</italic> is <italic>x</italic> (e.g. 0 = Φ<sup>−1</sup>(0.5)). <xref ref-type="disp-formula" rid="eqn2">Eq. [2]</xref> contains all experimental parameters, including <italic>g</italic> (the total number of collectives under selection), <italic>τ</italic> (maturation time), <italic>μ</italic> (mutation rate), <italic>r</italic> (growth rate of the slow-growing S type), and <italic>ω</italic> (growth advantage of F over S). <xref ref-type="disp-formula" rid="eqn2">Equation [2]</xref> has the same shape as results from numerically integrating <xref ref-type="disp-formula" rid="eqn1">Eq. [1]</xref> and from stochastic simulations (<xref rid="fig3" ref-type="fig">Fig. 3<bold>a</bold></xref>).</p>
<fig id="fig3" position="float" fig-type="figure">
<label>Fig. 3.</label>
<caption><title>Intra-collective selection and inter-collective selection jointly set the boundaries for selection success.</title>
<p><bold>a</bold> The change in F frequency over one cycle. When <inline-formula><inline-graphic xlink:href="531234v3_inline241.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is sufficiently low or high, inter-collective selection can lower the F frequency to below <inline-formula><inline-graphic xlink:href="531234v3_inline242.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. The points where Median<inline-formula><inline-graphic xlink:href="531234v3_inline243.gif" mimetype="image" mime-subtype="gif"/></inline-formula> are denoted as <italic>f</italic> <sup><italic>L</italic></sup> and <italic>f</italic> <sup><italic>H</italic></sup>, corresponding to the boundaries in <xref ref-type="fig" rid="fig2">Fig. 2</xref>. <bold>b</bold> The distributions of frequency differences obtained by 1000 numerical simulations. The cyan, purple, and black box plots indicate the changes in F frequency after intra-collective selection during maturation, after inter-collective selection, and over one selection cycle, respectively. The box ranges from 25% to 75% of the distribution, and the median is indicated by a line across the box. The upper and lower whiskers indicate maximum and minimum values of the distribution. ***: <italic>P &lt;</italic> 0.001 in an unpaired <italic>t</italic>-test.</p></caption>
<graphic xlink:href="531234v3_fig3.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>F frequency can be reduced if the selected <inline-formula><inline-graphic xlink:href="531234v3_inline38.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is low or high, but not if it is intermediate between <italic>f</italic> <sup><italic>L</italic></sup> and <italic>f</italic> <sup><italic>H</italic></sup> (<xref rid="fig3" ref-type="fig">Fig. 3a</xref>). Increase in <italic>f</italic> during maturation is the most drastic when Newborn <italic>f</italic> is around 0.5 (<xref rid="fig3" ref-type="fig">Fig. 3<bold>b</bold></xref> blue). This is intuitive: when Newborn <italic>f</italic> is low, the increase will be minor; when Newborn <italic>f</italic> is high, the fitness advantage of F over the population average is small and hence the increase is also minor. Thus, when Newborn F frequency is intermediate, inter-collective selection may not be able to counter intra-collective selection (<xref rid="fig3" ref-type="fig">Fig. 3<bold>b</bold></xref>).</p>
<p>Not surprisingly, similar conclusions are derived where S and F are slow-growing and fast-growing species which cannot be converted through mutations (<xref ref-type="sec" rid="s5c">Sec. 3</xref> and <xref rid="figS7" ref-type="fig">Fig. S7</xref> in Supplementary Infomation).</p>
<p>Overall, inter-collective selection is akin to a raftman, rowing the raft to a target, while intra-collective selection is akin to a waterfall. This metaphore is best understood in terms of S frequency <italic>s</italic> = 1 − <italic>f</italic> . Then, the lower-threshold <italic>f</italic> <sup><italic>L</italic></sup> corresponds to higher-threshold in <italic>s</italic><sup><italic>H</italic></sup> = 1 − <italic>f</italic> <sup><italic>L</italic></sup>, while higher-threshold <italic>f</italic> <sup><italic>H</italic></sup> corresponds to lower-threshold in <italic>s</italic><sup><italic>L</italic></sup> = 1 − <italic>f</italic> <sup><italic>H</italic></sup> . Intra-collective selection is akin to a waterfall, driving the S frequency <italic>s</italic> from high to low (<xref rid="fig2" ref-type="fig">Fig. 2<bold>f</bold></xref>). Intra-collective selection acts the strongest when <italic>s</italic> is intermediate (<italic>s</italic><sup><italic>L</italic></sup> <italic>&lt; s &lt;</italic> s<sup><italic>H</italic></sup>), similar to the vertical drop of the fall. Intra-collective selection acts weakly at high (<italic>&gt; s</italic><sup><italic>H</italic></sup>) or low (<italic>&lt; s</italic><sup><italic>L</italic></sup>) <italic>s</italic>, similar to the gentle sloped upper and lower pools of the fall (regions 1 and 2 of <xref rid="fig2" ref-type="fig">Fig. 2<bold>d, f</bold></xref> and <xref rid="fig3" ref-type="fig">Fig. 3<bold>a</bold></xref>). Thus, an intermediate target frequency can be impossible to achieve - a raft starting from the upper pool will be flushed down to <italic>s</italic><sup><italic>L</italic></sup> (<italic>f</italic> <sup><italic>H</italic></sup>), while a raft starting from the lower pool cannot go beyond <italic>s</italic><sup><italic>L</italic></sup> (<italic>f</italic> <sup><italic>H</italic></sup>). In contrast, a low target S frequency (in the lower pool) is always achievable. Finally, a high target S frequency (in the upper pool) can only be achieved if starting from the upper pool (as the raft can not jump to the upper pool if starting from below).</p>
</sec>
<sec id="s2d">
<title>Manipulating experimental setups to expand the achievable target region</title>
<p>Variation among collectives is a key element for successful selection. Here, variation among collectives originates from the stochastic nature of growth and mutation during collective maturation, and of sampling effects during collective reproduction. From <xref ref-type="disp-formula" rid="eqn4">Eq. [4]</xref>, the variance of <italic>f</italic> at time <italic>τ</italic> <inline-formula><inline-graphic xlink:href="531234v3_inline39.gif" mimetype="image" mime-subtype="gif"/></inline-formula> scales with <inline-formula><inline-graphic xlink:href="531234v3_inline40.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. Indeed, as Newborn size <italic>N</italic><sub>0</sub> declines, the region of acheivable of target frequency expands (larger gold area in <xref rid="fig4" ref-type="fig">Fig. 4<bold>a</bold></xref>). If the Newborn size <italic>N</italic><sub>0</sub> is smaller than ∼700, any target frequency can be reached when other parameters are fixed.</p>
<fig id="fig4" position="float" fig-type="figure">
<label>Fig. 4.</label>
<caption><title>Expanding the success region for artificial collective selection.</title>
<p><bold>a</bold> Reducing the population size in Newborn <italic>N</italic><sub>0</sub> expands the region of success. In gold area, the probability that <inline-formula><inline-graphic xlink:href="531234v3_inline244.gif" mimetype="image" mime-subtype="gif"/></inline-formula> becomes smaller than <inline-formula><inline-graphic xlink:href="531234v3_inline245.gif" mimetype="image" mime-subtype="gif"/></inline-formula> in a cycle is more than 50%. We used <italic>g</italic> = 10 and <italic>τ</italic> ≈ 4.8. <xref ref-type="fig" rid="fig2">Figures 2</xref>-<xref ref-type="fig" rid="fig3">3</xref> correspond to <italic>N</italic><sub>0</sub> = 1000. <bold>b</bold> Increasing the total number of collectives <italic>g</italic> also expands the region of success, although only slightly. We used a fixed Newborn size <italic>N</italic><sub>0</sub> = 1000. The maturation time <italic>τ</italic> (<italic>τ</italic> = log(100)<italic>/r</italic>) is set to be long enough so that an Adult can generate at least 100 Newborns.</p></caption>
<graphic xlink:href="531234v3_fig4.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>The number of collectives <italic>g</italic> also affects the selection outcomes. With more collectives, the chance to find a <italic>f</italic> closer to the target is more likely. Thus, a larger number of collectives broadens the region of success (<xref rid="fig4" ref-type="fig">Fig. 4b</xref>). However, the effect of <italic>g</italic> is not dramatic. To see why, we note that the only place that <italic>g</italic> appears is <xref ref-type="disp-formula" rid="eqn2">Eq. [2]</xref> in the form of <inline-formula><inline-graphic xlink:href="531234v3_inline41.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. When <italic>g</italic> becomes large, Φ<sup>−1</sup>(1<italic>/g</italic>) is asymptotically expressed as <inline-formula><inline-graphic xlink:href="531234v3_inline42.gif" mimetype="image" mime-subtype="gif"/></inline-formula> (<xref ref-type="sec" rid="s5b">Sec. 2</xref> in Supplementary Information)(<xref ref-type="bibr" rid="c34">34</xref>). Thus, <italic>φ</italic>(<italic>g</italic>) does not change dramatically as <italic>g</italic> varies.</p>
</sec>
<sec id="s2e">
<title>The waterfall phenomenon in a higher dimension</title>
<p>In contrast to the above two-type case where the evolutionary trajectory travels along a one-dimensional line from the initial frequency to the final frequency, in a three-type case the trajectory travels in a two-dimensional plane. To examine the waterfall effect in a higher dimension, we investigate a three-type system where a faster-growing type (FF) grows faster than the fast-growing type (F) which grows faster than the slow-growing type (S) (<xref rid="fig5" ref-type="fig">Fig. 5<bold>a</bold></xref> and <xref ref-type="sec" rid="s5g">Sec. 6</xref> in Supplementary Information). In this system, a target type composition can be achieved if inter-collective selection reduces the frequencies of F as well as FF (accessible region, gold in <xref rid="fig5" ref-type="fig">Fig. 5<bold>b</bold></xref>). Strikingly, a target composition in an accessible region may not be achievable even when the initial composition is within the same region: once the composition escapes the accessible region, the trajectory cannot return back to the accessible region (<xref rid="fig5" ref-type="fig">Fig. 5<bold>b</bold>iii</xref>, the leftmost initial condition). However, if the initial position is closer to the target in the accessible region, the target becomes achievable (<xref rid="fig5" ref-type="fig">Fig. 5<bold>b</bold>iii</xref>, initial condition near the bottom).</p>
<fig id="fig5" position="float" fig-type="figure">
<label>Fig. 5.</label>
<caption><title>In higher dimensions, the success of artificial selection requires the entire evolutionary trajectory remaining in the accessible region.</title>
<p><bold>a</bold> During collective maturation, a slow-growing type (S) (with growth rate <italic>r</italic>; dark red) can mutate to a fast-growing type (F) (with growth rate <italic>r</italic> + <italic>ω</italic>; blue), which can mutate further into a faster-growing type (FF) (with growth rate <italic>r</italic> + 2<italic>ω</italic>; purple). Here, the rates of both mutational steps are <italic>μ</italic>, and <italic>ω &gt;</italic> 0. <bold>b</bold> Evolutionary trajectories from various initial compositions (open circles) to various targets. Intra-collective evolution favors FF over F (vertical blue arrow) over S (horizontal blue arrow). The accessible regions are marked gold (see <xref ref-type="sec" rid="s5a">Sec. 1</xref> in Supplementary Information). We obtain final compositions starting from several initial compositions while aiming for different target compositions in i, ii, and iii. The evolutionary trajectories are shown in dots with color gradients from the initial to final time. (i) A target composition with a high FF frequency is always achievable. (ii) A target composition with intermediate FF frequency is never achievable. (iii) A target composition with low FF frequency is achievable only if starting from an appropriate initial composition such that the entire trajectory never meanders away from the accessible region. The figures are drawn using <italic>mpltern</italic> package (<xref ref-type="bibr" rid="c35">35</xref>).</p></caption>
<graphic xlink:href="531234v3_fig5.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>In conclusion, we have investigated the evolutionary trajectories of type composition in collectives under selection, which are governed by intra-collective selection (which favors fast-growing types) and inter-collective selection (which, in our case, strives to counter fast-growing types). Intra-collective selection has the strongest effect at intermediate frequencies of faster-growing types, potentially creating an inaccessible region analogous to the vertical drop of a waterfall. High and low target frequencies are both accessible, analogous to the lower- and the upper-pools of a waterfall, respectively. A less challenging target (low <italic>ŝ</italic>)is achievable from any initial position. In contrast, a more challenging target (high <italic>ŝ</italic>) is only achievable if the entire trajectory is contained within the region, similar to a raft striving to reach a point in the upper-pool must start at and remain in the upper pool. Our work suggests that the strength of intra-collective selection is not constant, and that strategically choosing an appropriate starting point can be essential for successful collective selection.</p>
</sec>
</sec>
<sec id="s3">
<title>Materials and Methods</title>
<sec id="s3a">
<title>Stochastic simulations</title>
<p>A selection cycle is composed of three steps: maturation, selection, and reproduction. At the beginning of the cycle <italic>k</italic>, a collective <italic>i</italic> has <inline-formula><inline-graphic xlink:href="531234v3_inline43.gif" mimetype="image" mime-subtype="gif"/></inline-formula> slow-growing cells and <inline-formula><inline-graphic xlink:href="531234v3_inline44.gif" mimetype="image" mime-subtype="gif"/></inline-formula> fast-growing cells. At the first cycle, mean F frequency of collectives are set to be <inline-formula><inline-graphic xlink:href="531234v3_inline45.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is sampled from the binomial distribution with mean <inline-formula><inline-graphic xlink:href="531234v3_inline46.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. Then, <inline-formula><inline-graphic xlink:href="531234v3_inline47.gif" mimetype="image" mime-subtype="gif"/></inline-formula> S cells are in the collective <italic>i</italic>. In the maturation step, we calculate <inline-formula><inline-graphic xlink:href="531234v3_inline48.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v3_inline49.gif" mimetype="image" mime-subtype="gif"/></inline-formula> by using stochastic simulation. We can simulate the division and mutation of each individual cell stochastically by using tau-leaping algorithm (<xref ref-type="bibr" rid="c36">36</xref>, <xref ref-type="bibr" rid="c37">37</xref>)(see <xref rid="figS4" ref-type="fig">Fig. S4<bold>a</bold></xref> and <xref ref-type="fig" rid="figS4"><bold>b</bold></xref> in Supplementray Information). However, individual-based simulation requires a long computing time. Instead, we randomly sample <inline-formula><inline-graphic xlink:href="531234v3_inline50.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v3_inline51.gif" mimetype="image" mime-subtype="gif"/></inline-formula> from the probability distribution <inline-formula><inline-graphic xlink:href="531234v3_inline52.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. To obtain <inline-formula><inline-graphic xlink:href="531234v3_inline53.gif" mimetype="image" mime-subtype="gif"/></inline-formula>, we solve the master equation which describes a time evolution of probability distribution, <inline-formula><inline-graphic xlink:href="531234v3_inline54.gif" mimetype="image" mime-subtype="gif"/></inline-formula> under the random processes (see <xref ref-type="sec" rid="s5a">Sec. 1</xref> in Supplementary Information). We assumed that <inline-formula><inline-graphic xlink:href="531234v3_inline55.gif" mimetype="image" mime-subtype="gif"/></inline-formula> follows the Gaussian distribution. The mean and variance of the distribution are numerically obtained from ordinary differential equations which is derived from the master equation (see <xref ref-type="sec" rid="s5a">Sec. 1</xref> in Supplementary Information). We choose the collective with the closest frequency to the target <inline-formula><inline-graphic xlink:href="531234v3_inline56.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. The selected collective generates <italic>g</italic> Newborns. The number of F cells is sampled from the binomial distribution with the mean of <inline-formula><inline-graphic xlink:href="531234v3_inline57.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. We start a new cycle with those Newborn collectives. Then, the number of S cells in a collective <italic>i</italic> is <inline-formula><inline-graphic xlink:href="531234v3_inline58.gif" mimetype="image" mime-subtype="gif"/></inline-formula></p>
</sec>
<sec id="s3b">
<title>Analytical approach to the conditional probability</title>
<p>The conditional probability distribution Ψ <inline-formula><inline-graphic xlink:href="531234v3_inline59.gif" mimetype="image" mime-subtype="gif"/></inline-formula> that we observe <inline-formula><inline-graphic xlink:href="531234v3_inline60.gif" mimetype="image" mime-subtype="gif"/></inline-formula> at a given <inline-formula><inline-graphic xlink:href="531234v3_inline61.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is calculated by the following procedure. Given the selected collective in cycle <italic>k</italic> with <inline-formula><inline-graphic xlink:href="531234v3_inline62.gif" mimetype="image" mime-subtype="gif"/></inline-formula>, the collective-level reproduction proceeds by sampling <italic>g</italic> Newborn collectives with <italic>N</italic><sub>0</sub> cells in cycle <italic>k</italic> +1. Each Newborn collective contains certain F numbers <inline-formula><inline-graphic xlink:href="531234v3_inline63.gif" mimetype="image" mime-subtype="gif"/></inline-formula> at the beginning of the cycle <italic>k</italic> + 1, which can be mapped into <inline-formula><inline-graphic xlink:href="531234v3_inline64.gif" mimetype="image" mime-subtype="gif"/></inline-formula> with the constraint of <italic>N</italic><sub>0</sub> cells. If the number of cells in the selected collective is large enough, the joint conditional distribution function <inline-formula><inline-graphic xlink:href="531234v3_inline65.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is well described by the product of <italic>g</italic> independent and identical Gaussian distribution 𝒩(<italic>μ, σ</italic><sup>2</sup>). So we consider the frequencies of <italic>g</italic> Newborn collectives as <italic>g</italic> identical copies of the Gaussian random variable <italic>f</italic><sub><italic>k</italic>+1,0</sub>. The mean and variance of <italic>f</italic><sub><italic>k</italic>+1,0</sub> are given by <inline-formula><inline-graphic xlink:href="531234v3_inline66.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v3_inline67.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. Then, the conditional probability distribution function of <italic>f</italic><sub><italic>k</italic>+1,0</sub> being <italic>ζ</italic> is given by
<disp-formula id="eqn5">
<graphic xlink:href="531234v3_eqn5.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
After the reproduction step, the Newborn collectives grow for time <italic>τ</italic> . The frequency is changed from the given frequency <italic>ζ</italic> to <italic>f</italic> by division and mutation processes. We assume that the frequency <italic>f</italic> of an Adult is also approximated by a Gaussian random variable <inline-formula><inline-graphic xlink:href="531234v3_inline68.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. The mean <inline-formula><inline-graphic xlink:href="531234v3_inline69.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and variance <inline-formula><inline-graphic xlink:href="531234v3_inline70.gif" mimetype="image" mime-subtype="gif"/></inline-formula> are calculated by using means and variances of <italic>S</italic> and <italic>F</italic> (see <xref ref-type="sec" rid="s5b">Sec. 2</xref> in Supplementary Information.) Since <inline-formula><inline-graphic xlink:href="531234v3_inline71.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v3_inline72.gif" mimetype="image" mime-subtype="gif"/></inline-formula> also depend on <italic>ζ</italic>, the conditional probability distribution function of <italic>f</italic><sub><italic>k</italic>+1,<italic>τ</italic></sub> being <italic>f</italic> is given by
<disp-formula id="eqn6">
<graphic xlink:href="531234v3_eqn6.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
The conditional probability distribution of an Adult collective in cycle <italic>k</italic> + 1 (<italic>f</italic><sub><italic>k</italic>+1,<italic>τ</italic></sub>) to have frequency <italic>f</italic> at a given <inline-formula><inline-graphic xlink:href="531234v3_inline73.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is calculated by producting two Gaussian distribution functions and integrating overall <italic>ζ</italic> values, which is given by
<disp-formula id="eqn7">
<graphic xlink:href="531234v3_eqn7.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Since we select the minimum frequency <inline-formula><inline-graphic xlink:href="531234v3_inline74.gif" mimetype="image" mime-subtype="gif"/></inline-formula> among <italic>g</italic> identical copies of <italic>f</italic><sub><italic>k</italic>+1,<italic>τ</italic></sub>, the conditional probability distribution function of <inline-formula><inline-graphic xlink:href="531234v3_inline75.gif" mimetype="image" mime-subtype="gif"/></inline-formula> follows a minimum value distribution, which is given in <xref ref-type="disp-formula" rid="eqn1">Eq. [1]</xref>. Here, For the case of <inline-formula><inline-graphic xlink:href="531234v3_inline76.gif" mimetype="image" mime-subtype="gif"/></inline-formula>, the selected frequency <inline-formula><inline-graphic xlink:href="531234v3_inline77.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is the minimum frequency <inline-formula><inline-graphic xlink:href="531234v3_inline78.gif" mimetype="image" mime-subtype="gif"/></inline-formula> So we have <inline-formula><inline-graphic xlink:href="531234v3_inline79.gif" mimetype="image" mime-subtype="gif"/></inline-formula> by replace <inline-formula><inline-graphic xlink:href="531234v3_inline80.gif" mimetype="image" mime-subtype="gif"/></inline-formula> to <inline-formula><inline-graphic xlink:href="531234v3_inline81.gif" mimetype="image" mime-subtype="gif"/></inline-formula></p>
<p>We assume that the conditional probability distribution in <xref ref-type="disp-formula" rid="eqn7">Eq. [7]</xref> follows a normal distribution, whose mean and variances are describe by <xref ref-type="disp-formula" rid="eqn3">Eq. [3]</xref> and <xref ref-type="disp-formula" rid="eqn4">Eq. [4]</xref>. Then, the extreme value theory (<xref ref-type="bibr" rid="c38">38</xref>) estimates the median of the selected Adult by
<disp-formula id="eqn8">
<graphic xlink:href="531234v3_eqn8.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
The F frequency difference in <xref ref-type="disp-formula" rid="eqn2">Eq. [2]</xref> is obtained by substracting <inline-formula><inline-graphic xlink:href="531234v3_inline82.gif" mimetype="image" mime-subtype="gif"/></inline-formula> from <xref ref-type="disp-formula" rid="eqn8">Eq. [8]</xref>.</p>
</sec>
</sec>
</body>
<back>
<sec id="s4">
<title>Data and source code availability</title>
<p>Data and source code of stochastic simulations are available in <ext-link ext-link-type="uri" xlink:href="https://github.com/schwarzg/artificial_selection_collective_composition">https://github.com/schwarzg/artificial_selection_collective_composition</ext-link></p>
</sec>
<ack>
<title>Acknowledgments</title>
<p>J. Lee and H.J. Park were supported by the National Research Foundation of Korea grant funded by the Korea government (MSIT), Grant No. RS-2023-00214071 (H.J.P.) and by an appointment to the JRG Program at the APCTP through the Science and Technology Promotion Fund and Lottery Fund of the Korean Government. W. Shou was supported by an Academy of Medical Sciences Professorship and a Royal Society Wolfson Fellowship. This was also supported by the Korean Local Governments– Gyeongsangbuk-do Province and Pohang City and INHA UNIVERSITY Research Grant. We thank Su-Chan Park, Li Xie, and Alex Yuan for constructive comments and discussions.</p>
</ack>
<ref-list>
<ref id="c1"><label>1.</label><mixed-citation publication-type="journal"><string-name><given-names>S</given-names> <surname>Woo</surname></string-name>, <string-name><given-names>I</given-names> <surname>Song</surname></string-name>, <string-name><given-names>HJ</given-names> <surname>Cha</surname></string-name>, <article-title>Fast and facile biodegradation of polystyrene by the gut microbial flora of Plesiophthalmus davidis larvae</article-title>. <source>Appl. Environ. Microbiol</source>. <volume>86</volume>, <fpage>e01361</fpage>–<lpage>20</lpage> (<year>2020</year>).</mixed-citation></ref>
<ref id="c2"><label>2.</label><mixed-citation publication-type="journal"><string-name><given-names>J</given-names> <surname>Sun</surname></string-name>, <string-name><given-names>A</given-names> <surname>Prabhu</surname></string-name>, <string-name><given-names>ST</given-names> <surname>Aroney</surname></string-name>, <string-name><given-names>C</given-names> <surname>Rinke</surname></string-name>, <article-title>Corrigendum: Insights into plastic biodegradation: community composition and functional capabilities of the superworm (Zophobas morio) microbiome in styrofoam feeding trials</article-title>. <source>Microb. Genomics</source> <volume>8</volume> (<year>2022</year>).</mixed-citation></ref>
<ref id="c3"><label>3.</label><mixed-citation publication-type="journal"><string-name><given-names>JR</given-names> <surname>Bober</surname></string-name>, <string-name><given-names>CL</given-names> <surname>Beisel</surname></string-name>, <string-name><given-names>NU</given-names> <surname>Nair</surname></string-name>, <article-title>Synthetic biology approaches to engineer probiotics and members of the human microbiota for biomedical applications</article-title>. <source>Annu. review biomedical engineering</source> <volume>20</volume>, <fpage>277</fpage>–<lpage>300</lpage> (<year>2018</year>).</mixed-citation></ref>
<ref id="c4"><label>4.</label><mixed-citation publication-type="journal"><string-name><given-names>EX</given-names> <surname>Wang</surname></string-name>, <string-name><given-names>MZ</given-names> <surname>Ding</surname></string-name>, <string-name><given-names>Q</given-names> <surname>Ma</surname></string-name>, <string-name><given-names>XT</given-names> <surname>Dong</surname></string-name>, <string-name><given-names>YJ</given-names> <surname>Yuan</surname></string-name>, <article-title>Reorganization of a synthetic microbial consortium for one-step vitamin c fermentation</article-title>. <source>Microb. Cell Factories</source> <volume>15</volume>, <fpage>21</fpage> (<year>2016</year>).</mixed-citation></ref>
<ref id="c5"><label>5.</label><mixed-citation publication-type="journal"><string-name><given-names>CJ</given-names> <surname>Goodnight</surname></string-name>, <article-title>Experimental studies of community evolution i: The response to selection at the community level</article-title>. <source>Evolution</source> <volume>44</volume>, <fpage>1614</fpage>–<lpage>1624</lpage> (<year>1990</year>).</mixed-citation></ref>
<ref id="c6"><label>6.</label><mixed-citation publication-type="journal"><string-name><given-names>CJ</given-names> <surname>Goodnight</surname></string-name>, <article-title>Experimental studies of community evolution ii: The ecological basis of the response to community selection</article-title>. <source>Evolution</source> <volume>44</volume>, <fpage>1625</fpage>–<lpage>1636</lpage> (<year>1990</year>).</mixed-citation></ref>
<ref id="c7"><label>7.</label><mixed-citation publication-type="journal"><string-name><given-names>W</given-names> <surname>Swenson</surname></string-name>, <string-name><given-names>DS</given-names> <surname>Wilson</surname></string-name>, <string-name><given-names>R</given-names> <surname>Elias</surname></string-name>, <article-title>Artificial ecosystem selection</article-title>. <source>Proc. Natl. Acad. Sci</source>. <volume>97</volume>, <fpage>9110</fpage>–<lpage>9114</lpage> (<year>2000</year>).</mixed-citation></ref>
<ref id="c8"><label>8.</label><mixed-citation publication-type="journal"><string-name><given-names>W</given-names> <surname>Swenson</surname></string-name>, <string-name><given-names>J</given-names> <surname>Arendt</surname></string-name>, <string-name><given-names>DS</given-names> <surname>Wilson</surname></string-name>, <article-title>Artificial selection of microbial ecosystems for 3-chloroaniline biodegradation</article-title>. <source>Environ. Microbiol</source>. <volume>2</volume>, <fpage>564</fpage>–<lpage>571</lpage> (<year>2000</year>).</mixed-citation></ref>
<ref id="c9"><label>9.</label><mixed-citation publication-type="journal"><string-name><given-names>K</given-names> <surname>Panke-Buisse</surname></string-name>, <string-name><given-names>AC</given-names> <surname>Poole</surname></string-name>, <string-name><given-names>JK</given-names> <surname>Goodrich</surname></string-name>, <string-name><given-names>RE</given-names> <surname>Ley</surname></string-name>, <string-name><given-names>J</given-names> <surname>Kao-Kniffin</surname></string-name>, <article-title>Selection on soil microbiomes reveals reproducible impacts on plant function</article-title>. <source>The ISME journal</source> <volume>9</volume>, <fpage>980</fpage>–<lpage>989</lpage> (<year>2015</year>).</mixed-citation></ref>
<ref id="c10"><label>10.</label><mixed-citation publication-type="journal"><string-name><given-names>M</given-names> <surname>Blouin</surname></string-name>, <string-name><given-names>B</given-names> <surname>Karimi</surname></string-name>, <string-name><given-names>J</given-names> <surname>Mathieu</surname></string-name>, <string-name><given-names>TZ</given-names> <surname>Lerch</surname></string-name>, <article-title>Levels and limits in artificial selection of communities</article-title>. <source>Ecol. Lett</source>. <volume>18</volume>, <fpage>1040</fpage>–<lpage>1048</lpage> (<year>2015</year>).</mixed-citation></ref>
<ref id="c11"><label>11.</label><mixed-citation publication-type="journal"><string-name><given-names>K</given-names> <surname>Panke-Buisse</surname></string-name>, <string-name><given-names>S</given-names> <surname>Lee</surname></string-name>, <string-name><given-names>J</given-names> <surname>Kao-Kniffin</surname></string-name>, <article-title>Cultivated sub-populations of soil microbiomes retain early flowering plant trait</article-title>. <source>Microb. Ecol</source>. <volume>73</volume>, <fpage>394</fpage>–<lpage>403</lpage> (<year>2017</year>).</mixed-citation></ref>
<ref id="c12"><label>12.</label><mixed-citation publication-type="journal"><string-name><given-names>RJ</given-names> <surname>Wright</surname></string-name>, <string-name><given-names>MI</given-names> <surname>Gibson</surname></string-name>, <string-name><given-names>JA</given-names> <surname>Christie-Oleza</surname></string-name>, <article-title>Understanding microbial community dynamics to improve optimal microbiome selection</article-title>. <source>Microbiome</source> <volume>7</volume>, <fpage>1</fpage>–<lpage>14</lpage> (<year>2019</year>).</mixed-citation></ref>
<ref id="c13"><label>13.</label><mixed-citation publication-type="journal"><string-name><given-names>MD</given-names> <surname>Jochum</surname></string-name>, <string-name><given-names>KL</given-names> <surname>McWilliams</surname></string-name>, <string-name><given-names>EA</given-names> <surname>Pierson</surname></string-name>, <string-name><given-names>YK</given-names> <surname>Jo</surname></string-name>, <article-title>Host-mediated microbiome engineering (hmme) of drought tolerance in the wheat rhizosphere</article-title>. <source>PLoS One</source> <volume>14</volume>, <fpage>e0225933</fpage> (<year>2019</year>).</mixed-citation></ref>
<ref id="c14"><label>14.</label><mixed-citation publication-type="journal"><string-name><given-names>AS Tiffany</given-names> <surname>Raynaud</surname></string-name>, <string-name><given-names>Marion</given-names> <surname>Devers</surname></string-name>, <string-name><given-names>M</given-names> <surname>Blouin</surname></string-name>, <article-title>Effect of the reproduction method in an artificial selection experiment at the community level</article-title>. <source>Front. Ecol. Evol</source>. <volume>7</volume>, <fpage>416</fpage> (<year>2019</year>).</mixed-citation></ref>
<ref id="c15"><label>15.</label><mixed-citation publication-type="journal"><string-name><given-names>CY</given-names> <surname>Chang</surname></string-name>, <string-name><given-names>ML</given-names> <surname>Osborne</surname></string-name>, <string-name><given-names>D</given-names> <surname>Bajic</surname></string-name>, <string-name><given-names>A</given-names> <surname>Sanchez</surname></string-name>, <article-title>Artificially selecting bacterial communities using propagule strategies</article-title>. <source>Evolution</source> <volume>74</volume>, <fpage>2392</fpage>–<lpage>2403</lpage> (<year>2020</year>).</mixed-citation></ref>
<ref id="c16"><label>16.</label><mixed-citation publication-type="journal"><string-name><given-names>ASM Jigyasa</given-names> <surname>Arora</surname></string-name>, <string-name><given-names>Margaret A. Mars</given-names> <surname>Brisbin</surname></string-name>, <article-title>Effects of microbial evolution dominate those of experimental host-mediated indirect selection</article-title>. <source>PeerJ</source> <volume>8</volume>, <fpage>e9350</fpage> (<year>2020</year>).</mixed-citation></ref>
<ref id="c17"><label>17.</label><mixed-citation publication-type="journal"><string-name><given-names>UG</given-names> <surname>Mueller</surname></string-name>, <etal>et al.</etal>, <article-title>Artificial selection on microbiomes to breed microbiomes that confer salt tolerance to plants</article-title>. <source>mSystems</source> <volume>6</volume>, <fpage>e01125</fpage>–<lpage>21</lpage> (<year>2021</year>).</mixed-citation></ref>
<ref id="c18"><label>18.</label><mixed-citation publication-type="journal"><string-name><given-names>T</given-names> <surname>Raynaud</surname></string-name>, <string-name><given-names>M</given-names> <surname>Devers-Lamrani</surname></string-name>, <string-name><given-names>A</given-names> <surname>Spor</surname></string-name>, <string-name><given-names>M</given-names> <surname>Blouin</surname></string-name>, <article-title>Community diversity determines the evolution of synthetic bacterial communities under artificial selection</article-title>. <source>Evolution</source> <volume>76</volume>, <fpage>1883</fpage>–<lpage>1895</lpage> (<year>2022</year>).</mixed-citation></ref>
<ref id="c19"><label>19.</label><mixed-citation publication-type="journal"><string-name><given-names>S</given-names> <surname>Jacquiod</surname></string-name>, <etal>et al.</etal>, <article-title>Artificial selection of stable rhizosphere microbiota leads to heritable plant phenotype changes</article-title>. <source>Ecol. Lett</source>. <volume>25</volume>, <fpage>189</fpage>–<lpage>201</lpage> (<year>2022</year>).</mixed-citation></ref>
<ref id="c20"><label>20.</label><mixed-citation publication-type="book"><string-name><given-names>A</given-names> <surname>Penn</surname></string-name>, “<chapter-title>Modelling artificial ecosystem selection: A preliminary investigation</chapter-title>” in <source>Advances in Artificial Life</source>, eds. <person-group person-group-type="editor"><string-name><given-names>W</given-names> <surname>Banzhaf</surname></string-name>, <string-name><given-names>J</given-names> <surname>Ziegler</surname></string-name>, <string-name><given-names>T</given-names> <surname>Christaller</surname></string-name>, <string-name><given-names>P</given-names> <surname>Dittrich</surname></string-name>, <string-name><given-names>JT</given-names> <surname>Kim</surname></string-name></person-group>. (<publisher-name>Springer Berlin Heidelberg</publisher-name>, <publisher-loc>Berlin, Heidelberg</publisher-loc>), pp. <fpage>659</fpage>–<lpage>666</lpage> (<year>2003</year>).</mixed-citation></ref>
<ref id="c21"><label>21.</label><mixed-citation publication-type="book"><string-name><given-names>A</given-names> <surname>Penn</surname></string-name>, <string-name><given-names>I</given-names> <surname>Harvey</surname></string-name>, “<chapter-title>The role of non-genetic change in the heritability, variation, and response to selection of artificially selected ecosystems</chapter-title>” in <source>Artificial Life IX: Proceedings of the Ninth International Conference on the Simulation and Synthesis of Artificial Life</source>, eds. <person-group person-group-type="editor"><string-name><given-names>J</given-names> <surname>Pollack</surname></string-name>, <string-name><given-names>MA</given-names> <surname>Bedau</surname></string-name>, <string-name><given-names>P</given-names> <surname>Husbands</surname></string-name>, <string-name><given-names>RA</given-names> <surname>Watson</surname></string-name>, <string-name><given-names>T</given-names> <surname>Ikegami</surname></string-name></person-group>. (<publisher-name>MIT Press</publisher-name>), Vol. <volume>9</volume>, p. <fpage>352</fpage> (<year>2004</year>).</mixed-citation></ref>
<ref id="c22"><label>22.</label><mixed-citation publication-type="journal"><string-name><given-names>HTP</given-names> <surname>Williams</surname></string-name>, <string-name><given-names>TM</given-names> <surname>Lenton</surname></string-name>, <article-title>Artificial selection of simulated microbial ecosystems</article-title>. <source>Proc. Natl. Acad. Sci</source>. <volume>104</volume>, <fpage>8918</fpage> (<year>2007</year>).</mixed-citation></ref>
<ref id="c23"><label>23.</label><mixed-citation publication-type="journal"><string-name><given-names>L</given-names> <surname>Xie</surname></string-name>, <string-name><given-names>AE</given-names> <surname>Yuan</surname></string-name>, <string-name><given-names>W</given-names> <surname>Shou</surname></string-name>, <article-title>Simulations reveal challenges to artificial community selection and possible strategies for success</article-title>. <source>PLoS Biol</source>. <volume>17</volume>, <fpage>e3000295</fpage> (<year>2019</year>).</mixed-citation></ref>
<ref id="c24"><label>24.</label><mixed-citation publication-type="journal"><string-name><given-names>G</given-names> <surname>Doulcier</surname></string-name>, <string-name><given-names>A</given-names> <surname>Lambert</surname></string-name>, <string-name><given-names>S</given-names> <surname>De Monte</surname></string-name>, <string-name><given-names>PB</given-names> <surname>Rainey</surname></string-name>, <article-title>Eco-evolutionary dynamics of nested darwinian populations and the emergence of community-level heredity</article-title>. <source>Elife</source> <volume>9</volume>, <fpage>e53433</fpage> (<year>2020</year>).</mixed-citation></ref>
<ref id="c25"><label>25.</label><mixed-citation publication-type="journal"><string-name><given-names>L</given-names> <surname>Xie</surname></string-name>, <string-name><given-names>W</given-names> <surname>Shou</surname></string-name>, <article-title>Steering ecological-evolutionary dynamics to improve artificial selection of microbial communities</article-title>. <source>Nat. Commun</source>. <volume>12</volume>, <fpage>6799</fpage> (<year>2021</year>).</mixed-citation></ref>
<ref id="c26"><label>26.</label><mixed-citation publication-type="journal"><string-name><given-names>CY</given-names> <surname>Chang</surname></string-name>, <etal>et al.</etal>, <article-title>Engineering complex communities by directed evolution</article-title>. <source>Nat. Ecol. &amp; Evol</source>. <volume>5</volume>, <fpage>1011</fpage> (<year>2021</year>).</mixed-citation></ref>
<ref id="c27"><label>27.</label><mixed-citation publication-type="journal"><string-name><given-names>J</given-names> <surname>Fraboul</surname></string-name>, <string-name><given-names>G</given-names> <surname>Biroli</surname></string-name>, <string-name><given-names>S</given-names> <surname>De Monte</surname></string-name>, <article-title>Artificial selection of communities drives the emergence of structured interactions</article-title>. <source>J. Theor. Biol</source>. <volume>571</volume>, <fpage>111557</fpage> (<year>2023</year>).</mixed-citation></ref>
<ref id="c28"><label>28.</label><mixed-citation publication-type="journal"><string-name><given-names>A</given-names> <surname>Lalejini</surname></string-name>,<string-name><given-names>E</given-names> <surname>Dolson</surname></string-name>, <string-name><given-names>AE</given-names> <surname>Vostinar</surname></string-name>, <string-name><given-names>L</given-names> <surname>Zaman</surname></string-name>, <article-title>Artificial selection methods from evolutionary computing show promise for directed evolution of microbes</article-title>. <source>Elife</source> <volume>11</volume>, <fpage>e79665</fpage> (<year>2022</year>).</mixed-citation></ref>
<ref id="c29"><label>29.</label><mixed-citation publication-type="journal"><string-name><given-names>M</given-names> <surname>Zaccaria</surname></string-name>, <string-name><given-names>N</given-names> <surname>Sandlin</surname></string-name>, <string-name><given-names>Y</given-names> <surname>Soen</surname></string-name>, <string-name><given-names>B</given-names> <surname>Momeni</surname></string-name>, <article-title>Partner-assisted artificial selection of a secondary function for efficient bioremediation</article-title>. <source>Iscience</source> <volume>26</volume>, <fpage>107632</fpage> (<year>2023</year>).</mixed-citation></ref>
<ref id="c30"><label>30.</label><mixed-citation publication-type="other"><string-name><given-names>B</given-names> <surname>Vessman</surname></string-name>, <string-name><given-names>P</given-names> <surname>Guridi-Fernández</surname></string-name>, <string-name><given-names>FI</given-names> <surname>Arias-Sánchez</surname></string-name>, <string-name><given-names>S</given-names> <surname>Mitri</surname></string-name>, <article-title>Novel artificial selection method improves function of simulated microbial communities</article-title>. <source>bioRxiv [preprint]</source> (<year>2023</year>) <pub-id pub-id-type="doi">10.1101/2023.01.08.523165</pub-id> (accessed <date-in-citation content-type="access-date">18 December 2023</date-in-citation>).</mixed-citation></ref>
<ref id="c31"><label>31.</label><mixed-citation publication-type="other"><string-name><given-names>L</given-names> <surname>Xie</surname></string-name>, <string-name><given-names>AE</given-names> <surname>Yuan</surname></string-name>, <string-name><given-names>W</given-names> <surname>Shou</surname></string-name>, <article-title>A quantitative genetics framework for understanding the selection response of microbial communities</article-title>. <source>bioRxiv [preprint]</source> (<year>2023</year>) <pub-id pub-id-type="doi">10.1101/2023.10.24.563725</pub-id> (accessed <date-in-citation content-type="access-date">28 December 2023</date-in-citation>).</mixed-citation></ref>
<ref id="c32"><label>32.</label><mixed-citation publication-type="journal"><string-name><given-names>JL</given-names> <surname>Thomas</surname></string-name>, <string-name><given-names>J</given-names> <surname>Rowland-Chandler</surname></string-name>, <string-name><given-names>W</given-names> <surname>Shou</surname></string-name>, <article-title>Artificial selection of microbial communities: what have we learnt and how can we improve?</article-title> <source>Curr. Opin. Microbiol</source>. <volume>77</volume>, <fpage>102400</fpage> (<year>2024</year>).</mixed-citation></ref>
<ref id="c33"><label>33.</label><mixed-citation publication-type="journal"><string-name><given-names>PB</given-names> <surname>Rainey</surname></string-name>, <article-title>Major evolutionary transitions in individuality between humans and ai</article-title>. <source>Philos. Transactions Royal Soc. B</source> <volume>378</volume>, <fpage>20210408</fpage> (<year>2023</year>).</mixed-citation></ref>
<ref id="c34"><label>34.</label><mixed-citation publication-type="journal"><string-name><given-names>J</given-names> <surname>Philip</surname></string-name>, <article-title>The function inverfc theta</article-title>. <source>Aust. J. Phys</source>. <volume>13</volume>, <fpage>13</fpage> (<year>1960</year>).</mixed-citation></ref>
<ref id="c35"><label>35.</label><mixed-citation publication-type="other"><string-name><given-names>Y</given-names> <surname>Ikeda</surname></string-name>, <string-name><given-names>B</given-names> <surname>Grabowski</surname></string-name>, <string-name><given-names>F</given-names> <surname>Körmann</surname></string-name>, <source>mpltern 0.3.0: ternary plots as projections of Matplotlib</source> (<year>2019</year>).</mixed-citation></ref>
<ref id="c36"><label>36.</label><mixed-citation publication-type="journal"><string-name><given-names>DT</given-names> <surname>Gillespie</surname></string-name>, <article-title>Approximate accelerated stochastic simulation of chemically reacting systems</article-title>. <source>The J. Chem. Phys</source>. <volume>115</volume>, <fpage>1716</fpage>–<lpage>1733</lpage> (<year>2001</year>).</mixed-citation></ref>
<ref id="c37"><label>37.</label><mixed-citation publication-type="journal"><string-name><given-names>Y</given-names> <surname>Cao</surname></string-name>, <string-name><given-names>DT</given-names> <surname>Gillespie</surname></string-name>, <string-name><given-names>LR</given-names> <surname>Petzold</surname></string-name>, <article-title>Efficient step size selection for the tau-leaping simulation method</article-title>. <source>The J. Chem. Phys</source>. <volume>124</volume>, <fpage>044109</fpage> (<year>2006</year>).</mixed-citation></ref>
<ref id="c38"><label>38.</label><mixed-citation publication-type="book"><string-name><given-names>EJ</given-names> <surname>Gumbel</surname></string-name>, <source>Statistics of extremes</source>. (<publisher-name>Columbia university press</publisher-name>), (<year>1958</year>).</mixed-citation></ref>
</ref-list>
<sec id="s5">
<title>Supplementary Information</title>
<sec id="s5a">
<label>1.</label>
<title>Stochastic simulation for the evolution of collective function</title>
<p>In the main text, we design a simple model of artificial selection on collectives. The collectives are composed of two genotypes, slow-growing (S) and fast-growing (F) genotypes. We start with <italic>g</italic> ‘Newborn’ collectives and each collective <italic>i</italic> (<italic>i</italic> = 1, …, <italic>g</italic>) has <inline-formula><inline-graphic xlink:href="531234v3_inline83.gif" mimetype="image" mime-subtype="gif"/></inline-formula> S cells and <inline-formula><inline-graphic xlink:href="531234v3_inline84.gif" mimetype="image" mime-subtype="gif"/></inline-formula> F cells. The index <italic>k</italic> is a cycle number and <italic>t</italic> is time indices where 0 ≤ <italic>t</italic> ≤ <italic>τ</italic> . At the beginning of cycle <italic>k</italic> (<italic>t</italic> = 0), any collective has a fixed total cell number <inline-formula><inline-graphic xlink:href="531234v3_inline85.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. The collectives are allowed to “mature” for <italic>t</italic> = <italic>τ</italic>, where S and F populations grow at rates of <italic>r</italic> and <italic>r</italic> + <italic>ω</italic>, respectively. S cells also mutate to F cells at a rate of <italic>μ</italic> per cell, and the back mutation from F to S is ignored. After maturation, we choose the collective with F frequency the closest to the target value <inline-formula><inline-graphic xlink:href="531234v3_inline86.gif" mimetype="image" mime-subtype="gif"/></inline-formula>, and the chosen collectiv e“reproduce” <italic>g</italic> newborn collectives each with <italic>N</italic><sub>0</sub> cells for the next cycle.</p>
<sec id="s5a1">
<title>Maturation</title>
<p>In this subsection, we ignore the cycle number index <italic>k</italic> and collective index (<italic>i</italic>) in convenience. So we denote <italic>S</italic>(<italic>t</italic>) and <italic>F</italic> (<italic>t</italic>) as representative notations of <inline-formula><inline-graphic xlink:href="531234v3_inline87.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v3_inline88.gif" mimetype="image" mime-subtype="gif"/></inline-formula>, respectively. The initial S and F cell numbers in a Newborn collective are <inline-formula><inline-graphic xlink:href="531234v3_inline89.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v3_inline90.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. We consider mutation that is beneficial to grow (<italic>ω &gt;</italic> 0).</p>
<p>We consider the population growth of <italic>S</italic>(<italic>t</italic>) and <italic>F</italic> (<italic>t</italic>) as a stochastic process. We use <italic>P</italic> (<italic>S, F, t</italic>) to denote the probability to have <italic>S</italic> S cells and <italic>F</italic> F at time <italic>t</italic> from the beginning of a cycle. Birth and mutation events stochastically happen which are represented by the three chemical reaction rules:
<disp-formula id="eqn1a">
<graphic xlink:href="531234v3_eqn1a.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn2a">
<graphic xlink:href="531234v3_eqn2a.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn3a">
<graphic xlink:href="531234v3_eqn3a.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <italic>S</italic> and <italic>F</italic> denote individual cells of a S type and a F type, respectively. The reaction rules can be simulated via tau-leaping algorithm (<xref ref-type="bibr" rid="sc1">1</xref>, <xref ref-type="bibr" rid="sc2">2</xref>), but the individual-based simulation requires long simulation times to get enough results. Hence we go over probability distribution <italic>P</italic> (<italic>S, F, t</italic>) to sample compositions instead of tracking all events that occurred in individual collectives. First, we calculate the distribution <italic>P</italic> (<italic>S, F, t</italic>) analytically, and then sample numbers of S and F cells from this distribution at the end of cycle <italic>t</italic> = <italic>τ</italic> . Below, we describe the derivation of <italic>P</italic> (<italic>S, F, t</italic>).</p>
<p>The master equation of <italic>P</italic> (<italic>S, F, t</italic>), which follows reaction rules <xref ref-type="disp-formula" rid="eqn1">Eq. [1</xref>-<xref ref-type="disp-formula" rid="eqn3">3]</xref>, is given by
<disp-formula id="eqn4a">
<graphic xlink:href="531234v3_eqn4a.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Here, <italic>dt</italic> is small such that at most one cell birth or mutation event could occur. The first term describes the scenario where a single birth event of a S cell happens during time interval [<italic>t, t</italic> + <italic>dt</italic>), which changes the collective’s composition from (<italic>S</italic> −1, <italic>F</italic>) to (<italic>S, F</italic>). Similarly, the second term comes from a birth event of a F cell. The third term indicates the mutation event. The last term corresponds to the outflow of probability density by birth and mutation processes, which induces the changes in composition from (<italic>S, F</italic>) to others.</p>
<p>Calculating the exact form of <italic>P</italic> (<italic>S, F, t</italic>) is not simple. Instead, we consider the probability distributions of <italic>S</italic>(<italic>t</italic>) and <italic>F</italic> (<italic>t</italic>) at time <italic>t</italic>. We assume that the mutation rate is much smaller than the growth rates, and hence the correlation between <italic>S</italic> and <italic>F</italic> is sufficiently small. Then, <italic>P</italic> (<italic>S, F, t</italic>) ∼ <italic>P</italic> (<italic>S, t</italic>)<italic>P</italic> (<italic>F, t</italic>). The distributions of <italic>S</italic> and <italic>F</italic> can be approximated as Gaussian (𝒩), which is supported by the Central Limit Theorem and <xref rid="figS1" ref-type="fig">Figure S1</xref> (note the concordance between the blue and green distributions). That is, the probability distribution <inline-formula><inline-graphic xlink:href="531234v3_inline91.gif" mimetype="image" mime-subtype="gif"/></inline-formula>.</p>
<p>The means are defined by <inline-formula><inline-graphic xlink:href="531234v3_inline92.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v3_inline93.gif" mimetype="image" mime-subtype="gif"/></inline-formula> The differential equations for means are obtained by applying the definition to the master equation in <xref ref-type="disp-formula" rid="eqn4">Eq. [4]</xref>, as
<disp-formula id="eqn5a">
<graphic xlink:href="531234v3_eqn5a.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn6a">
<graphic xlink:href="531234v3_eqn6a.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
We assume that the mutation rate <italic>μ</italic> is very smaller than <italic>r</italic> and <italic>ω</italic>. By solving <xref ref-type="disp-formula" rid="eqn5">Eq. [5]</xref> and <xref ref-type="disp-formula" rid="eqn6">Eq. [6]</xref>, the means <inline-formula><inline-graphic xlink:href="531234v3_inline94.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v3_inline95.gif" mimetype="image" mime-subtype="gif"/></inline-formula> are given by
<disp-formula id="eqn7a">
<graphic xlink:href="531234v3_eqn7a.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn8a">
<graphic xlink:href="531234v3_eqn8a.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="531234v3_inline96.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v3_inline97.gif" mimetype="image" mime-subtype="gif"/></inline-formula>are the mean number of S and F cells at the beginning of cycle <italic>t</italic> = 0. Note that the second term of <xref ref-type="disp-formula" rid="eqn8">Eq. [8]</xref> is consistent with the studies on the distribution of the number of F cells starting from <italic>S</italic><sub>0</sub> S cells (<xref ref-type="bibr" rid="sc3">3</xref>).</p>
<p>We define the second momenta of <italic>S</italic> and <italic>F</italic> as
<disp-formula id="eqn9">
<graphic xlink:href="531234v3_eqn9.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn10">
<graphic xlink:href="531234v3_eqn10.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Then, corresponding differential equations are given by
<disp-formula id="eqn11">
<graphic xlink:href="531234v3_eqn11.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn12">
<graphic xlink:href="531234v3_eqn12.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
The solution of <xref ref-type="disp-formula" rid="eqn11">Eq. [11]</xref> is
<disp-formula id="eqn13">
<graphic xlink:href="531234v3_eqn13.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn14">
<graphic xlink:href="531234v3_eqn14.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="531234v3_inline98.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is the second moment of initial values . Thus, the variance <inline-formula><inline-graphic xlink:href="531234v3_inline99.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is
<disp-formula id="eqn15">
<graphic xlink:href="531234v3_eqn15.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="531234v3_inline100.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is a variance of S cell numbers at the beginning of cycle <italic>t</italic> = 0. In <xref ref-type="disp-formula" rid="eqn12">Eq. [12]</xref>, we require <inline-formula><inline-graphic xlink:href="531234v3_inline101.gif" mimetype="image" mime-subtype="gif"/></inline-formula> to calculate <inline-formula><inline-graphic xlink:href="531234v3_inline102.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. The master <xref ref-type="disp-formula" rid="eqn4">Eq. [4]</xref> provides a differential equation for <inline-formula><inline-graphic xlink:href="531234v3_inline103.gif" mimetype="image" mime-subtype="gif"/></inline-formula> as
<disp-formula id="eqn16">
<graphic xlink:href="531234v3_eqn16.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
The solution of <xref ref-type="disp-formula" rid="eqn16">Eq. [16]</xref> is given by
<disp-formula id="eqn17">
<graphic xlink:href="531234v3_eqn17.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
By using <xref ref-type="disp-formula" rid="eqn17">Eq. [17]</xref>, the solution of <xref ref-type="disp-formula" rid="eqn12">Eq. [12]</xref> is given by
<disp-formula id="eqn18">
<graphic xlink:href="531234v3_eqn18.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="531234v3_inline104.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is the second moment of initial values . Thus, the variance <inline-formula><inline-graphic xlink:href="531234v3_inline105.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is given, up to the order of <italic>μ</italic>, by
<disp-formula id="eqn19">
<graphic xlink:href="531234v3_eqn19.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Using <xref ref-type="disp-formula" rid="eqn7">Eq. [7</xref>,<xref ref-type="disp-formula" rid="eqn8">8</xref>,<xref ref-type="disp-formula" rid="eqn15">15</xref>,<xref ref-type="disp-formula" rid="eqn19">19</xref>], we construct Gaussian distribution functions for <italic>S</italic>(<italic>t</italic>) and <italic>F</italic> (<italic>t</italic>), <inline-formula><inline-graphic xlink:href="531234v3_inline106.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v3_inline107.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. Then, numbers of S cells and F cells are randomly sampled from each distribution: <italic>S</italic> (<italic>τ</italic>) from <inline-formula><inline-graphic xlink:href="531234v3_inline108.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and <italic>F</italic>( <italic>τ</italic>) from <inline-formula><inline-graphic xlink:href="531234v3_inline109.gif" mimetype="image" mime-subtype="gif"/></inline-formula> . This process requires only two sampling steps for each collective.</p>
<fig id="figS1" position="float" fig-type="figure">
<label>Fig. S1.</label>
<caption><p>Comparison between the calculated Gaussian distribution (“Gauss”, with the mean and variances computed from <xref ref-type="disp-formula" rid="eqn7">Eq. [7</xref>,<xref ref-type="disp-formula" rid="eqn8">8</xref>,<xref ref-type="disp-formula" rid="eqn15">15</xref>,<xref ref-type="disp-formula" rid="eqn19">19</xref>]) and simulations using tau-leaping (“tau”) and sampling (“samp”) methods. The simulations run 500 times. The initial number of cells are <italic>S</italic><sub>0</sub> = 200 and <italic>F</italic><sub>0</sub> = 800. The parameters are <italic>r</italic> = 0.5, <italic>ω</italic> = 0.03, <italic>μ</italic> = 0.0001, and <italic>τ</italic> = 4.8.</p></caption>
<graphic xlink:href="531234v3_figS1.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
</sec>
<sec id="s5a2">
<title>Selection</title>
<p>After the maturation step is finished in cycle <italic>k</italic>, we compute the frequencies of the F cells in each collectives <inline-formula><inline-graphic xlink:href="531234v3_inline110.gif" mimetype="image" mime-subtype="gif"/></inline-formula> where we denote the frequency of collective <italic>i</italic> at time <italic>t</italic> = <italic>τ</italic> in cycle <italic>k</italic> as <inline-formula><inline-graphic xlink:href="531234v3_inline111.gif" mimetype="image" mime-subtype="gif"/></inline-formula> . We select one frequency which is the closest value to the target frequency <inline-formula><inline-graphic xlink:href="531234v3_inline112.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. The frequency selected at the cycle <italic>k</italic> is denoted by <inline-formula><inline-graphic xlink:href="531234v3_inline113.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. In mathematical expression, the selected frequency is
<disp-formula id="eqn20">
<graphic xlink:href="531234v3_eqn20.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
</p>
</sec>
<sec id="s5a3">
<title>Reproduction</title>
<p>We divide the selected collective into <italic>g</italic> Newborn collectives. We sample <inline-formula><inline-graphic xlink:href="531234v3_inline114.gif" mimetype="image" mime-subtype="gif"/></inline-formula>F cells from the selected collective for the Newborns in the next cycle <italic>k</italic> + 1. The exact description of reproduction step is described by consecutive sampling without replacement from the selected collective. Then the joint probability distribution <inline-formula><inline-graphic xlink:href="531234v3_inline115.gif" mimetype="image" mime-subtype="gif"/></inline-formula> follows a multivariate hypergeometric distribution. The selected collective is assumed to have <inline-formula><inline-graphic xlink:href="531234v3_inline116.gif" mimetype="image" mime-subtype="gif"/></inline-formula> cells and <inline-formula><inline-graphic xlink:href="531234v3_inline117.gif" mimetype="image" mime-subtype="gif"/></inline-formula> F cells. If the size of selected collective <inline-formula><inline-graphic xlink:href="531234v3_inline118.gif" mimetype="image" mime-subtype="gif"/></inline-formula>is large enough, the consecutive sampling is approximated to the independent binomial sampling (see <xref rid="figS2" ref-type="fig">Fig. S2</xref>). Thus, we independently sample <italic>g</italic> numbers of F cells, <inline-formula><inline-graphic xlink:href="531234v3_inline119.gif" mimetype="image" mime-subtype="gif"/></inline-formula>, from the binomial distribution. The probability mass function of <inline-formula><inline-graphic xlink:href="531234v3_inline120.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is given by
<disp-formula id="eqn21">
<graphic xlink:href="531234v3_eqn21.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
After the sampling, the numbers of S cells are set to be <inline-formula><inline-graphic xlink:href="531234v3_inline121.gif" mimetype="image" mime-subtype="gif"/></inline-formula> for each collective. These Newborn collectives start the maturation in the next cycle.</p>
</sec>
<sec id="s5a4">
<title>Simulation Result</title>
<p>In the main text, we simulate artificial selection by using stochastic simulation. In <xref rid="figS3" ref-type="fig">Fig. S3</xref>, we draw the absolute error <italic>d</italic> between the target frequency <inline-formula><inline-graphic xlink:href="531234v3_inline122.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v3_inline123.gif" mimetype="image" mime-subtype="gif"/></inline-formula> at the end of simulations (1000 cycles). In the colormap, errors higher than 0.15 are marked with gray, which indicates the failure of selection. The dashed lines indicate the same boundary in <xref rid="fig2" ref-type="fig">Fig 2<bold>d</bold></xref> in the main text.</p>
<p><xref rid="figS4" ref-type="fig">Figure S4</xref> presents the composition trajectories of all collectives using tau-leaping algorithm. The selected collectives have the closest compotisition to the target composition <inline-formula><inline-graphic xlink:href="531234v3_inline124.gif" mimetype="image" mime-subtype="gif"/></inline-formula> at the end of each cycle. The selected collective can have smaller frequency than its parent collective, so the composition can be lowered after cycles.</p>
</sec>
</sec>
<sec id="s5b">
<label>2.</label>
<title>Conditional probability distribution of the selected collective frequency <italic>f</italic> <sup>*</sup></title>
<p>Since maturation and reproduction are stochastic processes, the frequency <inline-formula><inline-graphic xlink:href="531234v3_inline125.gif" mimetype="image" mime-subtype="gif"/></inline-formula> of the selected collective at cycle <italic>k</italic> + 1 starting from <inline-formula><inline-graphic xlink:href="531234v3_inline126.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is also described by the probability distribution. In this case, <inline-formula><inline-graphic xlink:href="531234v3_inline127.gif" mimetype="image" mime-subtype="gif"/></inline-formula> depends on <inline-formula><inline-graphic xlink:href="531234v3_inline128.gif" mimetype="image" mime-subtype="gif"/></inline-formula>, and the distribution of <inline-formula><inline-graphic xlink:href="531234v3_inline129.gif" mimetype="image" mime-subtype="gif"/></inline-formula> follows the conditional probability distribution <inline-formula><inline-graphic xlink:href="531234v3_inline130.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. Below, we describe calculation of the conditional probability distribution <inline-formula><inline-graphic xlink:href="531234v3_inline131.gif" mimetype="image" mime-subtype="gif"/></inline-formula>.</p>
<p>We focus on the situation where the change of frequency in the selection step has the opposite direction of the maturation step. That means the target frequency <inline-formula><inline-graphic xlink:href="531234v3_inline132.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is smaller than <inline-formula><inline-graphic xlink:href="531234v3_inline133.gif" mimetype="image" mime-subtype="gif"/></inline-formula>, and the collective with the smallest frequency will be selected among <italic>g</italic> Newborn collectives. We can calculate the probability distribution of the Newborn collectives’ frequencies at the end of cycle <italic>k</italic> + 1 by using <xref ref-type="disp-formula" rid="eqn7">Eq. [7</xref>,<xref ref-type="disp-formula" rid="eqn8">8</xref>,<xref ref-type="disp-formula" rid="eqn15">15</xref>,<xref ref-type="disp-formula" rid="eqn19">19</xref>] and <xref ref-type="disp-formula" rid="eqn21">Eq. [21]</xref>. Then, we obtain a distribution of the minimum value among <italic>g</italic> copies of the collectives. The minimum value distribution is the conditional probability distribution <inline-formula><inline-graphic xlink:href="531234v3_inline134.gif" mimetype="image" mime-subtype="gif"/></inline-formula>.</p>
<p>Let us start the calculation from the reproduction step at the end of cycle <italic>k</italic>. The probability distribution of the F cell numbers in Newborn collectives is given in <xref ref-type="disp-formula" rid="eqn21">Eq. [21]</xref>. If the total number of cells in a Newborn collective <italic>N</italic><sub>0</sub> is large enough, <xref ref-type="disp-formula" rid="eqn21">Eq. [21]</xref> is approximated by the Gaussian distribution <inline-formula><inline-graphic xlink:href="531234v3_inline135.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. Then, the probability density function that <inline-formula><inline-graphic xlink:href="531234v3_inline136.gif" mimetype="image" mime-subtype="gif"/></inline-formula> to be <italic>ζ</italic> in Newborn collective <italic>i</italic> is
<disp-formula id="eqn22">
<graphic xlink:href="531234v3_eqn22.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
The Newborn collective <italic>i</italic> maturates in cycle <italic>k</italic> + 1 with the initial cell numbers <inline-formula><inline-graphic xlink:href="531234v3_inline137.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v3_inline138.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. Since all Newborn collectives are independent and identically distributed, we can drop the superscript (<italic>i</italic>) for simplicity. We can express <italic>S</italic>(<italic>t</italic>) and <italic>F</italic> (<italic>t</italic>) based on <xref ref-type="disp-formula" rid="eqn7">Eq. [7</xref>,<xref ref-type="disp-formula" rid="eqn8">8</xref>,<xref ref-type="disp-formula" rid="eqn15">15</xref>,<xref ref-type="disp-formula" rid="eqn19">19</xref>] as
<disp-formula id="eqn23">
<graphic xlink:href="531234v3_eqn23.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn24">
<graphic xlink:href="531234v3_eqn24.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <italic>G</italic><sub><italic>S</italic></sub> (<italic>t</italic>) and <italic>G</italic><sub><italic>F</italic></sub> (<italic>t</italic>) are random variable following the standard distribution 𝒩 (0, <xref ref-type="bibr" rid="sc1">1</xref>). Here we ignore cycle index <italic>k</italic> + 1 in subscription for convenience. Then, we can approximately write <italic>f</italic> (<italic>t</italic>) as
<disp-formula id="eqn25">
<graphic xlink:href="531234v3_eqn25.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
</p>
<fig id="figS2" position="float" fig-type="figure">
<label>Fig. S2.</label>
<caption><p>Comparison between consecutive sampling and independent binomial sampling. A parent collective is divided into 10 collectives. The histogram labeled with ‘MHG’ is the probability mass function of <italic>F</italic> of the fifth collective sampled via multivariate hypergeometric distribution. The independent binomial sampling is labeled with ‘BN’. The initial numbers of cells are <italic>S</italic> = 8000 and <italic>F</italic> = 2000 for the left panel, and <italic>S</italic> = 20 and <italic>F</italic> = 5 for the right panel. 10000 samples are drawn for each distribution.</p></caption>
<graphic xlink:href="531234v3_figS2.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<fig id="figS3" position="float" fig-type="figure">
<label>Fig. S3.</label>
<caption><p>Color map of the absolute error <inline-formula><inline-graphic xlink:href="531234v3_inline246.gif" mimetype="image" mime-subtype="gif"/></inline-formula> between frequency ⟨ <italic>f</italic> <sup><italic>*</italic></sup>⟩ of the averaged selected collectives at the end of simulations (<italic>k</italic> = 1000) and the target frequency <inline-formula><inline-graphic xlink:href="531234v3_inline247.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. The dashed lines are drawn by the arguments in the main text. For parameters, we used <italic>r</italic> = 0.5, <italic>ω</italic> = 0.03, <italic>μ</italic> = 0.0001, <italic>N</italic><sub>0</sub> = 1000, <italic>g</italic> = 10 and <italic>τ</italic> ≈ 4.8.</p></caption>
<graphic xlink:href="531234v3_figS3.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<fig id="figS4" position="float" fig-type="figure">
<label>Fig. S4.</label>
<caption><p><bold>a</bold> Trajectories of F frequency for 10 collectives (<italic>g</italic> = 10) over time. The collective whose frequency is closest to the target value is selected in every cycle (black lines). The gray lines denote the other collectives. For parameters, we used S growth rate <italic>r</italic> = 0.5, F growth advantage <italic>ω</italic> = 0.03, mutation rate <italic>μ</italic> = 0.0001, maturation time <italic>τ</italic> ≈ 4.8, and <italic>N</italic><sub>0</sub> = 1000. <bold>b</bold> Comparison between frequency trajectories with (black) and without (blue) selection clearly shows the effect of artificial selection. The black line indicates F frequency of the selected collective <inline-formula><inline-graphic xlink:href="531234v3_inline248.gif" mimetype="image" mime-subtype="gif"/></inline-formula> at each cycle in a. The blue line indicates the average trajectory without selection <inline-formula><inline-graphic xlink:href="531234v3_inline249.gif" mimetype="image" mime-subtype="gif"/></inline-formula> (the average of <italic>g</italic> = 10 individual lineages without collective-level selection at the end of each cycle).</p></caption>
<graphic xlink:href="531234v3_figS4.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>The mean of <italic>f</italic> is given by
<disp-formula id="eqn26">
<graphic xlink:href="531234v3_eqn26.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
and the variance is
<disp-formula id="eqn27">
<graphic xlink:href="531234v3_eqn27.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
The average size of collectives is <inline-formula><inline-graphic xlink:href="531234v3_inline139.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. In terms of a probability distribution, a random variable that a Adult’s F frequency <italic>f</italic> (<italic>τ</italic>) = <italic>f</italic><sub><italic>τ</italic></sub> follows the Gaussian distribution <inline-formula><inline-graphic xlink:href="531234v3_inline140.gif" mimetype="image" mime-subtype="gif"/></inline-formula> whose the probability density function is given by
<disp-formula id="eqn28">
<graphic xlink:href="531234v3_eqn28.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
With indices of cycle <italic>k</italic> and <italic>k</italic> + 1, the conditional probability that a offspring collective has frequency <italic>f</italic> after the maturation in cycle <italic>k</italic> + 1 from the parent frequency <inline-formula><inline-graphic xlink:href="531234v3_inline141.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is
<disp-formula id="eqn29">
<graphic xlink:href="531234v3_eqn29.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
After maturation in cycle <italic>k</italic> + 1, the collective with the smallest frequency <inline-formula><inline-graphic xlink:href="531234v3_inline142.gif" mimetype="image" mime-subtype="gif"/></inline-formula>is selected among <italic>g</italic> Adult collectives. The probability distribution function of <inline-formula><inline-graphic xlink:href="531234v3_inline143.gif" mimetype="image" mime-subtype="gif"/></inline-formula>is obtained by the extreme value statistics (<xref ref-type="bibr" rid="sc4">4</xref>). The cumulative distribution function of the minimum value <inline-formula><inline-graphic xlink:href="531234v3_inline144.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is given by
<disp-formula id="eqn30">
<graphic xlink:href="531234v3_eqn30.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
The above <xref ref-type="disp-formula" rid="eqn30">Eq. [30]</xref> simply states that <inline-formula><inline-graphic xlink:href="531234v3_inline145.gif" mimetype="image" mime-subtype="gif"/></inline-formula> if every single of <italic>g</italic> collectives at the end of maturation (time <italic>τ</italic>) in cycle <italic>k</italic> + 1 have frequencies greater than or equal to <italic>f</italic> . Frequencies are independent and identically distributed, and thus <inline-formula><inline-graphic xlink:href="531234v3_inline146.gif" mimetype="image" mime-subtype="gif"/></inline-formula> . Note that Prob <inline-formula><inline-graphic xlink:href="531234v3_inline147.gif" mimetype="image" mime-subtype="gif"/></inline-formula>, and <xref ref-type="disp-formula" rid="eqn30">Eq. [30]</xref> becomes
<disp-formula id="eqn31">
<graphic xlink:href="531234v3_eqn31.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Then, the probability density function <inline-formula><inline-graphic xlink:href="531234v3_inline148.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is obtained by differentiating <xref ref-type="disp-formula" rid="eqn31">Eq. [31]</xref> with respect to <italic>f</italic> and replacing <inline-formula><inline-graphic xlink:href="531234v3_inline149.gif" mimetype="image" mime-subtype="gif"/></inline-formula>,
<disp-formula id="eqn32">
<graphic xlink:href="531234v3_eqn32.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
We compute the probability density function [32] by using numerical integration and compare it with the stochastic simulation results in <xref rid="figS5" ref-type="fig">Fig. S5</xref>. Both distributions agree with each other.</p>
<p>To get the analytic approximation of the median of <xref ref-type="disp-formula" rid="eqn32">Eq. [32]</xref>, we assume that the F frequency distribution of Adult collective is Gaussian form. Thus, instead of calculating marginal probability with <italic>ζ</italic> variable as in <xref ref-type="disp-formula" rid="eqn29">Eq. [29]</xref>, we only calculate the mean <inline-formula><inline-graphic xlink:href="531234v3_inline150.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and variance <inline-formula><inline-graphic xlink:href="531234v3_inline151.gif" mimetype="image" mime-subtype="gif"/></inline-formula>, from Newborn’s frequency distribution of <inline-formula><inline-graphic xlink:href="531234v3_inline152.gif" mimetype="image" mime-subtype="gif"/></inline-formula>:
<disp-formula id="eqn33">
<graphic xlink:href="531234v3_eqn33.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn34">
<graphic xlink:href="531234v3_eqn34.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
which are <xref ref-type="disp-formula" rid="eqn3">Eq. [3]</xref> and Eq.[4] in the main text, respectively.</p>
<fig id="figS5" position="float" fig-type="figure">
<label>Fig. S5.</label>
<caption><p>The probability density functions of the selected collective’s frequency <inline-formula><inline-graphic xlink:href="531234v3_inline250.gif" mimetype="image" mime-subtype="gif"/></inline-formula>with the offset of <italic>f</italic> <sup><italic>*</italic></sup>. The blue distribution is obtained using 300 stochastic simulation results. The orange distribution represents <xref ref-type="disp-formula" rid="eqn32">Eq. [32]</xref> computed by numerical integration. The median values of the distributions are shown in <xref rid="figS3" ref-type="fig">Fig. S3<bold>a</bold></xref> in the main text.</p></caption>
<graphic xlink:href="531234v3_figS5.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>We note that <inline-formula><inline-graphic xlink:href="531234v3_inline153.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is proportional to<inline-formula><inline-graphic xlink:href="531234v3_inline154.gif" mimetype="image" mime-subtype="gif"/></inline-formula> . The variances in <xref ref-type="disp-formula" rid="eqn15">Eq. [15]</xref> and <xref ref-type="disp-formula" rid="eqn19">[19]</xref> are linearly scale with <italic>N</italic><sub>0</sub> by using <inline-formula><inline-graphic xlink:href="531234v3_inline155.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v3_inline156.gif" mimetype="image" mime-subtype="gif"/></inline-formula> from <xref ref-type="disp-formula" rid="eqn22">Eq. [22]</xref>. The mean collective size <inline-formula><inline-graphic xlink:href="531234v3_inline157.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is also proportional to <italic>N</italic><sub>0</sub> because the average cell numbers in <xref ref-type="disp-formula" rid="eqn7">Eq. [7]</xref> and <xref ref-type="disp-formula" rid="eqn8">[8]</xref> are linear to <italic>N</italic><sub>0</sub>. Thus, the scaling relation of <xref ref-type="disp-formula" rid="eqn27">Eq. [27]</xref> is given <inline-formula><inline-graphic xlink:href="531234v3_inline158.gif" mimetype="image" mime-subtype="gif"/></inline-formula>.</p>
<p>The median (Median<inline-formula><inline-graphic xlink:href="531234v3_inline159.gif" mimetype="image" mime-subtype="gif"/></inline-formula>) of <xref ref-type="disp-formula" rid="eqn32">Eq. [32]</xref> satisfies <inline-formula><inline-graphic xlink:href="531234v3_inline160.gif" mimetype="image" mime-subtype="gif"/></inline-formula>, which means <inline-formula><inline-graphic xlink:href="531234v3_inline161.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. If we assume the distribution <xref ref-type="disp-formula" rid="eqn32">Eq. [32]</xref> is the Gaussian form, the inverse function <inline-formula><inline-graphic xlink:href="531234v3_inline162.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is writen as
<disp-formula id="eqn35">
<graphic xlink:href="531234v3_eqn35.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where Φ<sup>−1</sup>(<italic>y</italic>) is an inverse cumulative density function (CDF) of the normal distribution with the mean <inline-formula><inline-graphic xlink:href="531234v3_inline163.gif" mimetype="image" mime-subtype="gif"/></inline-formula> in Eq.[34] and the standard deviation <italic>σ</italic><sub><italic>f</italic></sub> (<italic>τ</italic>), a square root of Eq.[34]. Substracting <inline-formula><inline-graphic xlink:href="531234v3_inline164.gif" mimetype="image" mime-subtype="gif"/></inline-formula> from <xref ref-type="disp-formula" rid="eqn35">Eq. [35]</xref> gives <xref ref-type="disp-formula" rid="eqn2">Eq. [2]</xref> in the main text.</p>
<p>Further, we get an asymptotic expression of Φ<sup>−1</sup>(ln 2<italic>/g</italic>) when <italic>g</italic> is large (or Φ<sup>−1</sup>(<italic>y</italic>) with small <italic>y</italic>). We start from the CDF of the standard normal distribution, <inline-formula><inline-graphic xlink:href="531234v3_inline165.gif" mimetype="image" mime-subtype="gif"/></inline-formula> where the function erfc(<italic>x</italic>) is an complementary error function. To get the expression of Φ<sup>−1</sup>, we need an asymptotic expression of inverse of <italic>y</italic> = erfc(x) function (<italic>x</italic> = erfc<sup>−1</sup>(<italic>y</italic>)) as the inverse <inline-formula><inline-graphic xlink:href="531234v3_inline166.gif" mimetype="image" mime-subtype="gif"/></inline-formula> . Here, we introduce a method in (<xref ref-type="bibr" rid="sc5">5</xref>). The known asymptotic expansion of <italic>y</italic> = erfc(<italic>x</italic>) for large <italic>x</italic> is erfc <inline-formula><inline-graphic xlink:href="531234v3_inline167.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. By taking logarithm in both side, we have
<disp-formula id="eqn36">
<graphic xlink:href="531234v3_eqn36.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Replacing <italic>x</italic><sup>2</sup> in the righthand side in <xref ref-type="disp-formula" rid="eqn36">Eq. [36]</xref> into the expression itself, we get continued logarithmic form of
<disp-formula id="eqn37">
<graphic xlink:href="531234v3_eqn37.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Inserting = erfc <sup>1</sup>(y) (square root of <xref ref-type="disp-formula" rid="eqn37">Eq. [37]</xref>) into the inverse CDF <inline-formula><inline-graphic xlink:href="531234v3_inline168.gif" mimetype="image" mime-subtype="gif"/></inline-formula>, we have <inline-formula><inline-graphic xlink:href="531234v3_inline169.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. So, the asymptotic expression of Φ<sup>−1</sup>(ln 2<italic>/g</italic>) is given by
<disp-formula id="eqn38">
<graphic xlink:href="531234v3_eqn38.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
</p>
</sec>
<sec id="s5c">
<label>3.</label>
<title>Selection without mutation</title>
<p>When the mutation rate is zero, two genotypes behave as two distinct species. So the S corresponds to the slower-growing species and the F corresponds to the faster-growing species. Then, our problem is generalized to the selection of two-species collective. The compositional change is provided by <xref ref-type="disp-formula" rid="eqn35">Eq. [35]</xref> with setting <italic>μ</italic> = 0. Corresponding <inline-formula><inline-graphic xlink:href="531234v3_inline170.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v3_inline171.gif" mimetype="image" mime-subtype="gif"/></inline-formula> become
<disp-formula id="eqn39">
<graphic xlink:href="531234v3_eqn39.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn40">
<graphic xlink:href="531234v3_eqn40.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<xref ref-type="disp-formula" rid="eqn39">Equations [39]</xref> and <xref ref-type="disp-formula" rid="eqn40">[40]</xref> suggest that when a community consists of two competing species, we obtain similar conclusions on the accessible region for target composition. The stochastic simulation results are present in <xref rid="figS7" ref-type="fig">Fig. S7</xref>.</p>
</sec>
<sec id="s5d">
<label>4.</label>
<title>Selecting more than one collective</title>
<p>In the main text, we choose one collective which have the closest frequency value to the target among <italic>g</italic> collectives. Such ‘Top 1’ stratedgy has an advantage on applying extreme value theory while it has potentially lose the ‘unlucky’ Adults (<xref ref-type="bibr" rid="sc6">6</xref>). Such ‘unlucky’ Adults are further to the target value than the selected one, but have possiblity to be selected in next cycle. The ‘Top tier’ stratedgy may secure the ‘unlucky’ Adult by choosing more than one collective (<xref ref-type="bibr" rid="sc6">6</xref>). So we test the ‘top-tier’ stratedgy by choosing 5 among 100 Adults with the distance from the target value in <xref rid="figS8" ref-type="fig">Fig. S8</xref>. The top-tier stratedgy is shown to be inefficient in the two-genotype system. This is because the system is too simple, so lower ranked Adult is lower again in next cycle.</p>
<fig id="figS6" position="float" fig-type="figure">
<label>Fig. S6.</label>
<caption><p>Scaling relation of F frequency variance (<xref ref-type="disp-formula" rid="eqn27">Eq. [27]</xref>) with Newborn collective size <italic>N</italic>0. The initial F frequency is 0.3. The parameters are <italic>r</italic> = 0.5, <italic>ω</italic> = 0.03, <italic>μ</italic> = 0.0001, and <italic>τ</italic> ≈ 4.8.</p></caption>
<graphic xlink:href="531234v3_figS6.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<fig id="figS7" position="float" fig-type="figure">
<label>Fig. S7.</label>
<caption><p>Color map of the absolute error <inline-formula><inline-graphic xlink:href="531234v3_inline251.gif" mimetype="image" mime-subtype="gif"/></inline-formula> between frequency ⟨<italic>f</italic> <sup><italic>*</italic></sup>⟩ of the averaged selected collectives at the end of simulations (<italic>k</italic> = 1000) and the target frequency <inline-formula><inline-graphic xlink:href="531234v3_inline252.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. For parameters, we used <italic>r</italic> = 0.5, <italic>ω</italic> = 0.03, <italic>μ</italic> = 0, <italic>N</italic>0 = 1000, <italic>g</italic> = 10 and <italic>τ</italic> ≈ 4.8.</p></caption>
<graphic xlink:href="531234v3_figS7.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<fig id="figS8" position="float" fig-type="figure">
<label>Fig. S8.</label>
<caption><p>Comparison of selecting Top-tier 5 with Top 1. We breed 100 collectives and choose 5 collectives with the closest to the target value.</p></caption>
<graphic xlink:href="531234v3_figS8.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
</sec>
<sec id="s5e">
<label>5.</label>
<title>Deleterious mutation</title>
<p>In the main text, we show the target composition can be achieved in some ranges of initial and target values when the mutation is beneficial to growth. The same analogy can be applied even when the mutation is deleterious. Since the F cells grow slower than the S cells (<italic>ω &lt;</italic> 0), the F frequency naturally decreases in the maturation step. Then, the conditional probability distribution <inline-formula><inline-graphic xlink:href="531234v3_inline172.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is a maximum value distribution of <xref ref-type="disp-formula" rid="eqn29">Eq. [29]</xref>. Thus, instead of <xref ref-type="disp-formula" rid="eqn30">Eq. [30]</xref>, we look for the cumulative distribution function of the maximum value <inline-formula><inline-graphic xlink:href="531234v3_inline173.gif" mimetype="image" mime-subtype="gif"/></inline-formula> such that
<disp-formula id="eqn41">
<graphic xlink:href="531234v3_eqn41.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
If all frequencies are independent and identical distributed random variables, the cumulative distribution function becomes
<disp-formula id="eqn42">
<graphic xlink:href="531234v3_eqn42.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Likewise in the previous section, we get the conditional probability density function by differentiating <xref ref-type="disp-formula" rid="eqn42">Eq. [42]</xref> with respect to <italic>f</italic> and replacing <inline-formula><inline-graphic xlink:href="531234v3_inline174.gif" mimetype="image" mime-subtype="gif"/></inline-formula> as
<disp-formula id="eqn43">
<graphic xlink:href="531234v3_eqn43.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
The distribution in <xref ref-type="disp-formula" rid="eqn43">Eq. [43]</xref> is evaluated for various <inline-formula><inline-graphic xlink:href="531234v3_inline175.gif" mimetype="image" mime-subtype="gif"/></inline-formula> in <xref rid="figS9" ref-type="fig">Fig. S9<bold>a</bold></xref> with numerical simulations and the median values of distributions are presented in <xref rid="figS9" ref-type="fig">Fig. S9<bold>b</bold></xref>. In the case of <italic>ω</italic> = − 0.03, the target frequency lower than around 0.3 and larger than around 0.7 can be selected. Since the sign of <italic>ω</italic> is opposite to the result in the main text, the diagram is reversed from <xref rid="fig2" ref-type="fig">Fig. 2<bold>d</bold></xref> in the main text.</p>
</sec>
<sec id="s5f">
<label>6.</label>
<title>Extension to the system including double-mutation</title>
<p>In the main text, we categorize the target frequencies based on whether the frequency change in the maturation step can be compensated in the selection step. Here, we extend the idea into more complex systems in order to suggest a possible generalization. We assume that collectives consist of three genotypes with slow-growing(S), fast-growing(F), and faster-growing(FF) types. The growth rate of S is <italic>r</italic>. Each mutation adds the growth rate with <italic>ω</italic>. So the F and FF type have growth rates with <italic>r</italic> + <italic>ω</italic> and <italic>r</italic> + 2<italic>ω</italic>, respectively. The mutation rate is <italic>μ</italic>. So, the birth and mutation events are written by the chemical reactions:
<disp-formula id="eqn44">
<graphic xlink:href="531234v3_eqn44.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn45">
<graphic xlink:href="531234v3_eqn45.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn46">
<graphic xlink:href="531234v3_eqn46.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn47">
<graphic xlink:href="531234v3_eqn47.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn48">
<graphic xlink:href="531234v3_eqn48.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Here, <italic>FF</italic> is an individual of a F type. We write a master equation of the processes for <italic>P</italic> (<italic>S, F, FF, t</italic>) which is the probability to have <italic>S</italic> S cells, <italic>F</italic> F cells, and <italic>FF</italic> FF cells at time <italic>t</italic>.
<disp-formula id="eqn49">
<graphic xlink:href="531234v3_eqn49.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
The composition of collective <italic>i</italic> in cycle <italic>k</italic> is now represented with two frequencies <inline-formula><inline-graphic xlink:href="531234v3_inline176.gif" mimetype="image" mime-subtype="gif"/></inline-formula> where the F frequency <inline-formula><inline-graphic xlink:href="531234v3_inline177.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and the FF frequency <inline-formula><inline-graphic xlink:href="531234v3_inline178.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. Then, the target composition is set to be <inline-formula><inline-graphic xlink:href="531234v3_inline179.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. The composition of the selected Adult in cycle <italic>k</italic> is <inline-formula><inline-graphic xlink:href="531234v3_inline180.gif" mimetype="image" mime-subtype="gif"/></inline-formula> . We apply the processes used in the above section 2 to obtain the conditional probability <inline-formula><inline-graphic xlink:href="531234v3_inline181.gif" mimetype="image" mime-subtype="gif"/></inline-formula> by using the master <xref ref-type="disp-formula" rid="eqn49">Eq. [49]</xref>.</p>
<p>At the reproduction step in cycle <italic>k</italic>, we choose <italic>N</italic><sub>0</sub> cells from the selected Adult whose composition is <inline-formula><inline-graphic xlink:href="531234v3_inline182.gif" mimetype="image" mime-subtype="gif"/></inline-formula> . Then, Newborn collectives are independently sampled from a multinomial distribution. For convenience, we drop the collective index (<italic>i</italic>). Then, the conditional probability mass function to choosing <italic>F</italic><sub><italic>k</italic>,0</sub>, <italic>FF</italic><sub><italic>k</italic>,0</sub> cells are represented by
<disp-formula id="eqn50">
<graphic xlink:href="531234v3_eqn50.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where the number of S <italic>S</italic><sub><italic>k</italic>+1,0</sub> is automatically set to be <italic>S</italic><sub><italic>k</italic>+1,0</sub> = <italic>N</italic><sub>0</sub> − <italic>F</italic><sub><italic>k</italic>+1,0</sub> − <italic>FF</italic><sub><italic>k</italic>+1,0</sub>. Then, the approximated multivariate normal distribution is <inline-formula><inline-graphic xlink:href="531234v3_inline183.gif" mimetype="image" mime-subtype="gif"/></inline-formula> where the mean distribution is <inline-formula><inline-graphic xlink:href="531234v3_inline184.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and covariance matrix is <bold>M</bold><sub><italic>k</italic>+1</sub>. The diagonal terms of <bold>M</bold><sub><italic>k</italic>+1</sub> are variances <inline-formula><inline-graphic xlink:href="531234v3_inline185.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and the offdiagonal terms are covariances <inline-formula><inline-graphic xlink:href="531234v3_inline186.gif" mimetype="image" mime-subtype="gif"/></inline-formula> . The matrix is given by
<disp-formula id="eqn51">
<graphic xlink:href="531234v3_eqn51.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
</p>
<fig id="figS9" position="float" fig-type="figure">
<label>Fig. S9.</label>
<caption><p>Artificial selection also works for deleterious mutation. <bold>a</bold> Conditional Probability density functions of <inline-formula><inline-graphic xlink:href="531234v3_inline253.gif" mimetype="image" mime-subtype="gif"/></inline-formula> for various <inline-formula><inline-graphic xlink:href="531234v3_inline254.gif" mimetype="image" mime-subtype="gif"/></inline-formula> values. The left-hand side distribution is obtained from simulations and the right-hand side distribution is numerically obtained by evaluating <xref ref-type="disp-formula" rid="eqn43">Eq. [43]</xref>. Small triangles inside indicate the median values of the distributions. <bold>b</bold> the median value of distributions at a given <inline-formula><inline-graphic xlink:href="531234v3_inline255.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. The points where the shifted median becomes zero, Median<inline-formula><inline-graphic xlink:href="531234v3_inline256.gif" mimetype="image" mime-subtype="gif"/></inline-formula> are denoted as <italic>f</italic> <sup><italic>L</italic></sup> and <italic>f</italic> <sup><italic>U</italic></sup>, respectively. <bold>c</bold> The relative error between the target frequency <inline-formula><inline-graphic xlink:href="531234v3_inline257.gif" mimetype="image" mime-subtype="gif"/></inline-formula>and the ensemble averaged selected frequency <inline-formula><inline-graphic xlink:href="531234v3_inline258.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is measured after 1000 cycles starting from the initial frequency <inline-formula><inline-graphic xlink:href="531234v3_inline259.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. Either the lower target frequencies or the higher target frequencies starting from the high initial frequencies can be achieved. The black dashed lines indicate the predicted boundary values <italic>f</italic> <sup><italic>U</italic></sup> and <italic>f</italic> <sup><italic>L</italic></sup> in <bold>a</bold>.</p></caption>
<graphic xlink:href="531234v3_figS9.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>Then a Newborn’s composition <bold><italic>ρ</italic></bold>(<italic>ζ, η</italic>) follows the multivariate Gaussian distribution <inline-formula><inline-graphic xlink:href="531234v3_inline187.gif" mimetype="image" mime-subtype="gif"/></inline-formula> whose the joint probability distribution function is given by
<disp-formula id="eqn52">
<graphic xlink:href="531234v3_eqn52.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
At the beginning of cycle <italic>k</italic>, a newborn collective starts to maturate from (<italic>S</italic><sub>0</sub>, <italic>F</italic><sub>0</sub>, <italic>FF</italic><sub>0</sub>) cells (for convenience, cycle index <italic>k</italic> is dropped.) In terms of (<italic>ζ, η</italic>), each initial numbers are <italic>S</italic><sub>0</sub> = <italic>N</italic><sub>0</sub>(1 − <italic>ζ</italic>− <italic>η</italic>), <italic>F</italic><sub>0</sub> = <italic>N</italic><sub>0</sub><italic>ζ</italic>, and <italic>FF</italic><sub>0</sub> = <italic>N</italic><sub>0</sub><italic>η</italic>. Their initial covariance matrix is <inline-formula><inline-graphic xlink:href="531234v3_inline188.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. By using <xref ref-type="disp-formula" rid="eqn49">Eq. [49]</xref>, we can write ordinary differential equations up to the second moment.
<disp-formula id="eqn53">
<graphic xlink:href="531234v3_eqn53.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn54">
<graphic xlink:href="531234v3_eqn54.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn55">
<graphic xlink:href="531234v3_eqn55.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn56">
<graphic xlink:href="531234v3_eqn56.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn57">
<graphic xlink:href="531234v3_eqn57.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn58">
<graphic xlink:href="531234v3_eqn58.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn59">
<graphic xlink:href="531234v3_eqn59.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn60">
<graphic xlink:href="531234v3_eqn60.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn61">
<graphic xlink:href="531234v3_eqn61.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
The initial conditions of the system in coupled Eqs. [53-61] are obtained by the mean and (co)variances of <xref ref-type="disp-formula" rid="eqn50">Eq. [50]</xref>. By solving equations numerically, we obtain a set of mean cell numbers <inline-formula><inline-graphic xlink:href="531234v3_inline189.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and a set of variances <inline-formula><inline-graphic xlink:href="531234v3_inline190.gif" mimetype="image" mime-subtype="gif"/></inline-formula> as well as covariances (<italic>σ</italic><sub><italic>SF</italic></sub>, <italic>σ</italic><sub><italic>FFF</italic></sub>, <italic>σ</italic><sub><italic>SFF</italic></sub>). We assume that the covariances are smaller than the variances. We consider <italic>S, F</italic>, and <italic>FF</italic> as Gaussian random variables
<disp-formula id="eqn62">
<graphic xlink:href="531234v3_eqn62.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn63">
<graphic xlink:href="531234v3_eqn63.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn64">
<graphic xlink:href="531234v3_eqn64.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Then, the F frequency becomes
<disp-formula id="eqn65">
<graphic xlink:href="531234v3_eqn65.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="531234v3_inline191.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v3_inline192.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. Similarly, the FF frequency is
<disp-formula id="eqn66">
<graphic xlink:href="531234v3_eqn66.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="531234v3_inline193.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v3_inline194.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. If the covariances are small enough, we can approximate the joint probability distribution of Adult’s composition (<italic>f</italic><sub><italic>τ</italic></sub>, <italic>h</italic><sub><italic>τ</italic></sub>) = <bold>p</bold><sub><italic>τ</italic></sub> as
<disp-formula id="eqn67">
<graphic xlink:href="531234v3_eqn67.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
With cycle index <italic>k</italic>, we get conditional probability of matured collectives <inline-formula><inline-graphic xlink:href="531234v3_inline195.gif" mimetype="image" mime-subtype="gif"/></inline-formula> by
<disp-formula id="eqn68">
<graphic xlink:href="531234v3_eqn68.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
We select the Adult collective among <italic>g</italic> Adult collectives such that the change in frequencies during maturation could be compensate. During maturation, a freuquency distribution moves different direction in (<italic>f, h</italic>) space depending on the initial composition <inline-formula><inline-graphic xlink:href="531234v3_inline196.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. So, we take different directions to obtain the extreme value distributions. Considering only the sign of the frequency changes in <italic>f</italic> and <italic>h</italic>, we take either maximum or minimum. The mean change in <italic>h</italic> is always positive in the whole (<italic>f, h</italic>) space since <inline-formula><inline-graphic xlink:href="531234v3_inline197.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is always positive in <xref ref-type="disp-formula" rid="eqn55">Eq. [55]</xref>. Thus, we choose the minimum value <inline-formula><inline-graphic xlink:href="531234v3_inline198.gif" mimetype="image" mime-subtype="gif"/></inline-formula> in every selection step.</p>
<p>If the mean <inline-formula><inline-graphic xlink:href="531234v3_inline199.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is larger than <inline-formula><inline-graphic xlink:href="531234v3_inline200.gif" mimetype="image" mime-subtype="gif"/></inline-formula>, the minimum value among <inline-formula><inline-graphic xlink:href="531234v3_inline201.gif" mimetype="image" mime-subtype="gif"/></inline-formula> will be chosen in selection step to compensate the frequency change in maturation step. Let us denote the selected valued of <italic>f</italic> and <italic>h</italic> <inline-formula><inline-graphic xlink:href="531234v3_inline202.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v3_inline203.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. We temporally drop time index <italic>τ</italic> for simplicity. Then, the joint cumulative distribution function <inline-formula><inline-graphic xlink:href="531234v3_inline204.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is
<disp-formula id="eqn69">
<graphic xlink:href="531234v3_eqn69.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
The probability <inline-formula><inline-graphic xlink:href="531234v3_inline205.gif" mimetype="image" mime-subtype="gif"/></inline-formula> can be converted as
<disp-formula id="eqn70">
<graphic xlink:href="531234v3_eqn70.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="531234v3_inline206.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is a conditional joint cumulative distribution function of (<italic>f</italic> <sup>(<italic>i</italic>)</sup>, <italic>h</italic><sup>(<italic>i</italic>)</sup>). The marginal cumulative distribution functions are
<disp-formula id="eqn71">
<graphic xlink:href="531234v3_eqn71.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn72">
<graphic xlink:href="531234v3_eqn72.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Similarly, the probabilities <inline-formula><inline-graphic xlink:href="531234v3_inline207.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v3_inline208.gif" mimetype="image" mime-subtype="gif"/></inline-formula> are converted into <inline-formula><inline-graphic xlink:href="531234v3_inline209.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v3_inline210.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. Thus, the joint cumulative distribution function is
<disp-formula id="eqn73">
<graphic xlink:href="531234v3_eqn73.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Then, the conditional probability of the selected collective is given by
<disp-formula id="eqn74">
<graphic xlink:href="531234v3_eqn74.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="531234v3_inline211.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v3_inline212.gif" mimetype="image" mime-subtype="gif"/></inline-formula>.</p>
<p>If the mean <inline-formula><inline-graphic xlink:href="531234v3_inline213.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is smaller than <inline-formula><inline-graphic xlink:href="531234v3_inline214.gif" mimetype="image" mime-subtype="gif"/></inline-formula>, the chosen collective is likely to have maximum <italic>f</italic> values among <italic>g</italic> matured collectives. Then, the definition of <italic>f</italic> <sup>*</sup> is written by <inline-formula><inline-graphic xlink:href="531234v3_inline215.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. We rewrite the joint cumulative distribution function <inline-formula><inline-graphic xlink:href="531234v3_inline216.gif" mimetype="image" mime-subtype="gif"/></inline-formula> to be little different from <xref ref-type="disp-formula" rid="eqn69">Eq. [69]</xref> because now we have to utilize the condition <italic>f</italic> <sup>*</sup> <italic>&lt; f</italic> instead of <italic>f</italic> <sup>*</sup> <italic>&gt; f</italic>,
<disp-formula id="eqn75">
<graphic xlink:href="531234v3_eqn75.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
The probability <inline-formula><inline-graphic xlink:href="531234v3_inline217.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is converted as
<disp-formula id="eqn76">
<graphic xlink:href="531234v3_eqn76.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Thus, the joint cumulative distribution function is given by
<disp-formula id="eqn77">
<graphic xlink:href="531234v3_eqn77.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
In this case, the conditional probability distribution function is given by
<disp-formula id="eqn78">
<graphic xlink:href="531234v3_eqn78.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
By replacing (<italic>f, h</italic>) to <inline-formula><inline-graphic xlink:href="531234v3_inline218.gif" mimetype="image" mime-subtype="gif"/></inline-formula>, we finally obtain the conditional probability distribution <inline-formula><inline-graphic xlink:href="531234v3_inline219.gif" mimetype="image" mime-subtype="gif"/></inline-formula>,
<disp-formula id="eqn79">
<graphic xlink:href="531234v3_eqn79.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Using <xref ref-type="disp-formula" rid="eqn79">Eq. [79]</xref>, we get the mean values of <italic>f</italic> <sup>*</sup> and <italic>h</italic><sup>*</sup> as
<disp-formula id="eqn80">
<graphic xlink:href="531234v3_eqn80.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn81">
<graphic xlink:href="531234v3_eqn81.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
We define the accessible region in frequency space where the signs of the changes in both F frequency and FF frequency after a cycle are opposite to that of maturation (see <xref rid="figS10" ref-type="fig">Fig. S10</xref>),
<disp-formula id="eqn82">
<graphic xlink:href="531234v3_eqn82.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="531234v3_inline220.gif" mimetype="image" mime-subtype="gif"/></inline-formula> and <inline-formula><inline-graphic xlink:href="531234v3_inline221.gif" mimetype="image" mime-subtype="gif"/></inline-formula> are the mean values after the maturation step in cycle <italic>k</italic> + 1. <xref rid="figS10" ref-type="fig">Figure S10<bold>a</bold></xref> shows a concise explanation of the classification of regions where the initial and target compositions satisfy the above conditions in <xref ref-type="disp-formula" rid="eqn82">Eq. [82]</xref>. Or, if the condition is not met, the composition of the selected collective may diverge from the target composition after several cycles. The accessible regions are marked in the gray-colored area in <xref rid="figS10" ref-type="fig">Fig. S10<bold>b</bold></xref>. Similar to the case of the two-genotype population, the accessible region is shaped by the flow velocity of the composition in the maturation step, as depicted in the flow diagram in <xref rid="figS10" ref-type="fig">Fig. S10<bold>b</bold></xref>. Both F and FF frequencies tend to increase, and the inter-collective selection can compensate for these changes if the composition changes slowly when the F and FF frequencies are small. However, if the changes occur too rapidly when the FF frequency is intermediate, the frequency cannot be stabilized. So the accessible region is limited to the regions where the composition changes slowly.</p>
<fig id="figS10" position="float" fig-type="figure">
<label>Fig. S10.</label>
<caption><p><bold>a</bold> The schematic procedure to determine accessible regions by collective selection. From the given parent composition (blue dot), the probability distribution of offspring Adults (<xref ref-type="disp-formula" rid="eqn68">Eq. [68]</xref>) is computed (marked in the orange-colored area). From Adult compositions, the probability distribution of the selected collective (Eq.[79]) is computed (marked in the green area). If the signs of the changes in both F frequency and FF frequency after the selection (from blue dot to green dot) are opposite to that of maturation (from blue dot to orange dot), the given composition is accessible. Otherwise, the composition is not accessible and will change after cycles. <bold>b</bold> The accessible regions are marked by the gray area. The vector field is the flow of compositions during maturation. The length and color of the arrows indicate the speed of composition changes. The figures are drawn using <italic>mpltern</italic> package (<xref ref-type="bibr" rid="sc7">7</xref>).</p></caption>
<graphic xlink:href="531234v3_figS10.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
</sec>
<sec id="s5g">
<label>7.</label>
<title>Derivation of equations</title>
<p>In this section, we go over the derivation of <xref ref-type="disp-formula" rid="eqn7">Eq. [7</xref>-<xref ref-type="disp-formula" rid="eqn27">27]</xref> for readers not equipped with advanced mathematics training.</p>
<p>Assumptions: <italic>μ</italic> ≪ <italic>ω, r</italic></p>
<p><bold><xref ref-type="disp-formula" rid="eqn7">Equations [7]</xref> and <xref ref-type="disp-formula" rid="eqn8">[8]</xref></bold>. <xref ref-type="disp-formula" rid="eqn7">Equation [7]</xref> is straightforwardly solved by integrating <xref ref-type="disp-formula" rid="eqn5">Eq. [5]</xref>. <xref ref-type="disp-formula" rid="eqn8">Equation [8]</xref> is obtained from <xref ref-type="disp-formula" rid="eqn6">Eq. [6]</xref> using integration factor <italic>e</italic><sup>−(<italic>r</italic>+<italic>ω</italic>)<italic>t</italic></sup>:
<disp-formula id="eqn83">
<graphic xlink:href="531234v3_eqn83.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn84">
<graphic xlink:href="531234v3_eqn84.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Integrating both sides, we get <inline-formula><inline-graphic xlink:href="531234v3_inline222.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. Thus,
<disp-formula id="eqn85">
<graphic xlink:href="531234v3_eqn85.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<bold><xref ref-type="disp-formula" rid="eqn11">Equations [11]</xref> and <xref ref-type="disp-formula" rid="eqn12">[12]</xref></bold>. Applying <xref ref-type="disp-formula" rid="eqn4">Eq. [4]</xref>, we have
<disp-formula id="eqn86">
<graphic xlink:href="531234v3_eqn86.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
We collect the two violet-colored terms and change the order of summation. Note that the first violet-colored term does not change regardless of whether <italic>S</italic> starts from 0 or 1 because the term is zero for <italic>S</italic> = 0. Thus, the first violet-colored term is equivalent to <inline-formula><inline-graphic xlink:href="531234v3_inline223.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. Let <italic>α</italic> = <italic>S</italic> − 1, and this becomes <inline-formula><inline-graphic xlink:href="531234v3_inline224.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. We reassign <italic>α</italic> as <italic>S</italic>, and obtain:
<disp-formula id="eqn87">
<graphic xlink:href="531234v3_eqn87.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
We collect the two green terms, and similarly obtain:
<disp-formula id="eqn88">
<graphic xlink:href="531234v3_eqn88.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Finally, we collect the two orange terms. For the first orange term, the sum is the same regardless of whether we start from <italic>S</italic> = 0 or −1. Let <italic>S</italic> start from −1, and we have <inline-formula><inline-graphic xlink:href="531234v3_inline225.gif" mimetype="image" mime-subtype="gif"/></inline-formula>,then the term becomes <inline-formula><inline-graphic xlink:href="531234v3_inline226.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. We reassign <italic>α</italic> as <italic>S</italic>, and additionally apply index change on <italic>F</italic> − 1:
<disp-formula id="eqn89">
<graphic xlink:href="531234v3_eqn89.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Now, add the three parts together, and we have
<disp-formula id="eqn90">
<graphic xlink:href="531234v3_eqn90.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
which is <xref ref-type="disp-formula" rid="eqn11">Eq. [11]</xref>. Likewise,
<disp-formula id="eqn91">
<graphic xlink:href="531234v3_eqn91.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn92">
<graphic xlink:href="531234v3_eqn92.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
which is <xref ref-type="disp-formula" rid="eqn12">Eq. [12]</xref>.</p>
<p><bold><xref ref-type="disp-formula" rid="eqn13">Equation [13]</xref> and <xref ref-type="disp-formula" rid="eqn15">[15]</xref></bold>. Using integration factor <italic>e</italic><sup>−2(<italic>r</italic>−<italic>μ</italic>)<italic>t</italic></sup> and <xref ref-type="disp-formula" rid="eqn11">Eq. [11]</xref>, we have:
<disp-formula id="eqn93">
<graphic xlink:href="531234v3_eqn93.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn94">
<graphic xlink:href="531234v3_eqn94.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<disp-formula id="eqn95">
<graphic xlink:href="531234v3_eqn95.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Since <italic>μ</italic> ≪ <italic>r</italic>,we have
<disp-formula id="eqn96">
<graphic xlink:href="531234v3_eqn96.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="531234v3_inline227.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is the expected <italic>S</italic><sup>2</sup> at time 0. For <xref ref-type="disp-formula" rid="eqn15">Eq. [15]</xref>,
<disp-formula id="eqn97">
<graphic xlink:href="531234v3_eqn97.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<bold><xref ref-type="disp-formula" rid="eqn16">Equation [16]</xref> and <xref ref-type="disp-formula" rid="eqn17">[17]</xref></bold>. Since <inline-formula><inline-graphic xlink:href="531234v3_inline228.gif" mimetype="image" mime-subtype="gif"/></inline-formula>,
<disp-formula id="eqn98">
<graphic xlink:href="531234v3_eqn98.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
We can solve this, again using the integration factor technique above:
<disp-formula id="eqn99">
<graphic xlink:href="531234v3_eqn99.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Thus, we have
<disp-formula id="eqn100">
<graphic xlink:href="531234v3_eqn100.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
which results in
<disp-formula id="eqn101">
<graphic xlink:href="531234v3_eqn101.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<bold><xref ref-type="disp-formula" rid="eqn18">Equation [18]</xref></bold>. From <xref ref-type="disp-formula" rid="eqn12">Eq. [12]</xref>, we have
<disp-formula id="eqn102">
<graphic xlink:href="531234v3_eqn102.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
</p>
<p>The right-hand side becomes
<disp-formula id="eqn103">
<graphic xlink:href="531234v3_eqn103.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Note that we have checked that the second and third terms of <inline-formula><inline-graphic xlink:href="531234v3_inline229.gif" mimetype="image" mime-subtype="gif"/></inline-formula> can be ignored after we compare the full calculation with this simpler version. Integrate both sides:
<disp-formula id="eqn104">
<graphic xlink:href="531234v3_eqn104.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Then, we have
<disp-formula id="eqn105">
<graphic xlink:href="531234v3_eqn105.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
<bold><xref ref-type="disp-formula" rid="eqn19">Equation [19]</xref></bold>.
<disp-formula id="eqn106">
<graphic xlink:href="531234v3_eqn106.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula></p>
<p><bold><xref ref-type="disp-formula" rid="eqn25">Equations [25]</xref>-<xref ref-type="disp-formula" rid="eqn27">[27]</xref></bold>. To derive this equation, we use the fact that 1<italic>/</italic>(1 + <italic>x</italic>) ∼1 − <italic>x</italic> for small <italic>x</italic>. We will omit (<italic>t</italic>) for simplicity. Also note that we are considering relatively large populations so that the standard deviation is much smaller than the mean.
<disp-formula id="eqn107">
<graphic xlink:href="531234v3_eqn107.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Recall that if <italic>A</italic> ∼ 𝒩 (<italic>μ</italic><sub><italic>A</italic></sub>, <italic>σ</italic><sub><italic>A</italic></sub>), <italic>B</italic> ∼ 𝒩 (<italic>μ</italic><sub><italic>B</italic></sub>, <italic>σ</italic><sub><italic>B</italic></sub>), then <italic>A</italic> − <italic>B</italic> ∼ 𝒩 (<italic>μ</italic><sub><italic>A</italic></sub> − <italic>μ</italic><sub><italic>B</italic></sub>, <inline-formula><inline-graphic xlink:href="531234v3_inline230.gif" mimetype="image" mime-subtype="gif"/></inline-formula>). Thus, <italic>f</italic> is distributed as a Gaussian with the mean of
<disp-formula id="eqn108">
<graphic xlink:href="531234v3_eqn108.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
Note that the initial value of mean <inline-formula><inline-graphic xlink:href="531234v3_inline231.gif" mimetype="image" mime-subtype="gif"/></inline-formula> is equal to the mean of the binomial distribution <xref ref-type="disp-formula" rid="eqn22">Eq. [22]</xref>, <inline-formula><inline-graphic xlink:href="531234v3_inline232.gif" mimetype="image" mime-subtype="gif"/></inline-formula>. The variance is
<disp-formula id="eqn109">
<graphic xlink:href="531234v3_eqn109.gif" mimetype="image" mime-subtype="gif"/>
</disp-formula>
</p>
</sec>
</sec>
<ref-list>
<title>References</title>
<ref id="sc1"><label>1.</label><mixed-citation publication-type="journal"><string-name><given-names>DT</given-names> <surname>Gillespie</surname></string-name>, <article-title>Approximate accelerated stochastic simulation of chemically reacting systems</article-title>. <source>The J. Chem. Phys</source>. <volume>115</volume>, <fpage>1716</fpage>–<lpage>1733</lpage> (<year>2001</year>).</mixed-citation></ref>
<ref id="sc2"><label>2.</label><mixed-citation publication-type="journal"><string-name><given-names>Y</given-names> <surname>Cao</surname></string-name>, <string-name><given-names>DT</given-names> <surname>Gillespie</surname></string-name>, <string-name><given-names>LR</given-names> <surname>Petzold</surname></string-name>, <article-title>Efficient step size selection for the tau-leaping simulation method</article-title>. <source>The J. Chem. Phys</source>. <volume>124</volume>, <fpage>044109</fpage> (<year>2006</year>).</mixed-citation></ref>
<ref id="sc3"><label>3.</label><mixed-citation publication-type="journal"><string-name><given-names>Q</given-names> <surname>Zheng</surname></string-name>, <article-title>Progress of a half century in the study of the luria–delbrück distribution</article-title>. <source>Math. Biosci</source>. <volume>162</volume>, <fpage>1</fpage>–<lpage>32</lpage> (<year>1999</year>).</mixed-citation></ref>
<ref id="sc4"><label>4.</label><mixed-citation publication-type="book"><string-name><given-names>EJ</given-names> <surname>Gumbel</surname></string-name>, <source>Statistics of extremes</source>. (<publisher-name>Columbia university press</publisher-name>), (<year>1958</year>).</mixed-citation></ref>
<ref id="sc5"><label>5.</label><mixed-citation publication-type="journal"><string-name><given-names>J</given-names> <surname>Philip</surname></string-name>, <article-title>The function inverfc theta</article-title>. <source>Aust. J. Phys</source>. <volume>13</volume>, <fpage>13</fpage> (<year>1960</year>).</mixed-citation></ref>
<ref id="sc6"><label>6.</label><mixed-citation publication-type="journal"><string-name><given-names>L</given-names> <surname>Xie</surname></string-name>, <string-name><given-names>AE</given-names> <surname>Yuan</surname></string-name>, <string-name><given-names>W</given-names> <surname>Shou</surname></string-name>, <article-title>Simulations reveal challenges to artificial community selection and possible strategies for success</article-title>. <source>PLoS Biol</source>. <volume>17</volume>, <fpage>e3000295</fpage> (<year>2019</year>).</mixed-citation></ref>
<ref id="sc7"><label>7.</label><mixed-citation publication-type="other"><string-name><given-names>Y</given-names> <surname>Ikeda</surname></string-name>, <string-name><given-names>B</given-names> <surname>Grabowski</surname></string-name>, <string-name><given-names>F</given-names> <surname>Körmann</surname></string-name>, <source>mpltern 0.3.0: ternary plots as projections of Matplotlib</source> (<year>2019</year>).</mixed-citation></ref>
</ref-list>
</back>
<sub-article id="sa0" article-type="editor-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.97461.1.sa3</article-id>
<title-group>
<article-title>eLife Assessment</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<name>
<surname>Bitbol</surname>
<given-names>Anne-Florence</given-names>
</name>
<role specific-use="editor">Reviewing Editor</role>
<aff>
<institution-wrap>
<institution>Ecole Polytechnique Federale de Lausanne (EPFL)</institution>
</institution-wrap>
<city>Lausanne</city>
<country>Switzerland</country>
</aff>
</contrib>
</contrib-group>
<kwd-group kwd-group-type="evidence-strength">
<kwd>Convincing</kwd>
</kwd-group>
<kwd-group kwd-group-type="claim-importance">
<kwd>Important</kwd>
</kwd-group>
</front-stub>
<body>
<p>This <bold>important</bold> study of artificial selection in microbial communities shows that the possibility of selecting a desired fraction of slow and fast-growing types is impacted by their initial fractions. The evidence, which relies on mathematical analysis and simulations of a stochastic model, is <bold>convincing</bold>. It highlights the tension between selection at the strain and the community level. This study should be of interest to researchers interested in ecology, both theoretical and experimental.</p>
</body>
</sub-article>
<sub-article id="sa1" article-type="referee-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.97461.1.sa2</article-id>
<title-group>
<article-title>Reviewer #1 (Public Review):</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<anonymous/>
<role specific-use="referee">Reviewer</role>
</contrib>
</contrib-group>
</front-stub>
<body>
<p>Summary:</p>
<p>The authors demonstrate with a simple stochastic model that the initial composition of the community is important in achieving a target frequency during the artificial selection of a community.</p>
<p>Strengths:</p>
<p>To my knowledge, the intra-collective selection during artificial selection has not been seriously theoretically considered. However, in many cases, the species dynamics during the incubation of each selection cycle are important and relevant to the outcome of the artificial selection experiment. Stochasticity from birth and death (demographic stochasticity) plays a big role in these species' abundance dynamics. This work uses a simple framework to tackle this idea meticulously.</p>
<p>This work may or may not be related to hysteresis (path dependency). If this is true, maybe it would be nice to have a discussion paragraph talking about how this may be the case. Then, this work would even attract the interest of people studying dynamic systems.</p>
<p>Weaknesses:</p>
<p>(1) Connecting structure and function</p>
<p>In typical artificial selection literature, most of them select the community based on collective function. Here in this paper, the authors are selecting a target composition. Although there is a schematic cartoon illustrating the relationship between collective function (y-axis) and the community composition in the main Figure 1, there is no explicit explanation or justification of what may be the origin of this relationship. I think giving the readers a naïve idea about how this structure-function relationship arises in the introduction section would help. This is because the conclusion of this paper is that the intra-collective selection makes it hard to artificially select a community that has an intermediate frequency of f (or s). If there is really evidence or theoretical derivation from this framework that indeed the highest function comes from the intermediate frequency of f, then the impact of this paper would increase because the conclusions of this stochastic model could allude to the reasons for the prevalent failures of artificial selection in literature.</p>
<p>(2) Explain intra-collective and inter-collective selection better for readers.</p>
<p>The abstract, the introduction, and the result section use these terms or intra-collective and inter-collective selection without much explanation. A clear definition in the beginning would help the audience grasp the importance of this paper, because these concepts are at the core of this work.</p>
<p>(3) Achievable target frequency strongly depending on the degree of demographic stochasticity.</p>
<p>I would expect that the experimentalists would find these results interesting and would want to consider these results during their artificial selection experiments. The main Figure 4 indicates that the Newborn size N0 is a very important factor to consider during the artificial selection experiment. This would be equivalent to how much bottleneck is imposed on the artificial selection process in every iteration step (i.e., the ratio of serial dilution experiment). However, with a low population size, all target frequencies can be achieved, and therefore in these regimes, the initial frequency now does not matter much. It would be great for the authors to provide what the N0 parameter actually means during the artificial selection experiments. Maybe relative to some other parameter in the model. I know this could be very hard. But without this, the main result of this paper (initial frequency matters) cannot be taken advantage of by the experimentalists.</p>
<p>(4) Consideration of environmental stochasticity.</p>
<p>The success (gold area of Figure 2d) in this framework mainly depends on the size of the demographic stochasticity (birth-only model) during the intra-collective selection. However, during experiments, a lot of environmental stochasticity appears to be occurring during artificial selection. This may be out of the scope of this study. But it would definitely be exciting to see how much environmental stochasticity relative to the demographic stochasticity (variation in the Gaussian distribution of F and S) matters in succeeding in achieving the target composition from artificial selection.</p>
<p>(5) Assumption about mutation rates</p>
<p>If setting the mutation rates to zero does not change the result of the simulations and the conclusion, what is the purpose of having the mutation rates \mu? Also, is the unidirectional (S -&gt; F -&gt; FF) mutation realistic? I didn't quite understand how the mutations could fit into the story of this paper.</p>
<p>(6) Minor points</p>
<p>In Figure 3b, it is not clear to me how the frequency difference for the Intra-collective and the Inter-collective selection is computed.</p>
<p>In Figure 5b, the gold region (success) near the FF is not visible. Maybe increase the size of the figure or have an inset for zoom-in. Why is the region not as big as the bottom gold region?</p>
</body>
</sub-article>
<sub-article id="sa2" article-type="referee-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.97461.1.sa1</article-id>
<title-group>
<article-title>Reviewer #2 (Public Review):</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<anonymous/>
<role specific-use="referee">Reviewer</role>
</contrib>
</contrib-group>
</front-stub>
<body>
<p>The authors provide an analytical framework to model the artificial selection of the composition of communities comprised of strains growing at different rates. Their approach takes into account the competition between the targeted selection at the level of the meta-community and the selection that automatically favors fast-growing cells within each replicate community. Their main finding is a tipping point or path-dependence effect, whereby compositions dominated by slow-growing types can only be reached by community-level selection if the community does not start and never crosses into a range of compositions dominated by fast growers during the dynamics.</p>
<p>These results seem to us both technically correct and interesting. We commend the authors on their efforts to make their work reproducible even when it comes to calculations via extensive appendices, though perhaps a table of contents and a short description of these appendices at the start of SI would help navigate them.</p>
<p>The main limitation in the current form of the article is that it could clarify how its assumptions and findings differ from and improve upon the rest of the literature:</p>
<p>- Many studies discuss the interplay between community-level evolution and species- or strain-level evolution. But &quot;evolution&quot; can be a mix of various forces, including selection, drift/randomness, and mutation/innovation.</p>
<p>- This work's specificity is that it focuses strictly on constant community-level selection versus constant strain-level selection, all other forces being negligible (neither stochasticity nor innovation/mutation matter at either level, as we try to clarify now).</p>
<p>- Regarding constant community-level selection, it is only briefly noted that &quot;once a target frequency is achieved, inter-collective selection is always required to maintain that frequency due to the fitness difference between the two types&quot; [pg. 3 {section sign}2]. In other words, action from the selector is required indefinitely to maintain the community in the desired state. This assumption is found in a fraction of the literature, but is still worth clarifying from the start as it can inform the practical applicability of the results.</p>
<p>- More importantly, strain-level evolution also boils down here to pure selection with a constant target, which is less usual in the relevant literature. Here, (1) drift from limited population sizes is very small, with no meaningful counterbalancing of selection, (2) pure exponential regime with constant fitness, no interactions, no density- or frequency-dependence, (3) there is no innovation in the sense that available types are unchanging through time (no evolution of traits such as growth rate or interactions) and (4) all the results presented seem unchanged when mutation rate mu = 0 (as noted in Appendix III), meaning that the conclusions are not &quot;about&quot; mutation in any meaningful way.</p>
<p>- Furthermore, the choice of mutation mechanism is peculiar, as it happens only from slow to fast grower: more commonly, one assumes random non-directional mutations, rather than purely directional ones from less fit to fitter (which is more of a &quot;Lamarckian&quot; idea). Given that mutation does not seem to matter here, this choice might create unnecessary opposition from some readers or could be considered as just one possibility among others.</p>
<p>It would be helpful to have all these points stated clearly so that it becomes easy to see where this article stands in an abundant literature and contributes to our understanding of multi-level evolution, and why it may have different conclusions or focus than others tackling very similar questions.</p>
<p>Finally, a microbial context is given to the study, but the assumptions and results are in no way truly tied to that context, so it should be clear that this is just for flavor.</p>
</body>
</sub-article>
<sub-article id="sa3" article-type="referee-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.97461.1.sa0</article-id>
<title-group>
<article-title>Reviewer #3 (Public Review):</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<anonymous/>
<role specific-use="referee">Reviewer</role>
</contrib>
</contrib-group>
</front-stub>
<body>
<p>The authors address the process of community evolution under collective-level selection for a prescribed community composition. They mostly consider communities composed of two types that reproduce at different rates, and that can mutate one into the other. Due to such differences in 'fitness' and to the absence of density dependence, within-collective selection is expected to always favour the fastest grower, but the collective-level selection can oppose this tendency, to a certain extent at least. By approximating the stochastic within-generation dynamics and solving it analytically, the authors show that not only high frequencies of fast growers can be reproducibly achieved, aligned with their fitness advantage. Small target frequencies can also be maintained, provided that the initial proportion of fast growers is sufficiently small. In this regime, similar to the 'stochastic corrector' model, variation upon which selection acts is maintained by a combination of demographic stochasticity and of sampling at reproduction. These two regions of achievable target compositions are separated by a gap, encompassing intermediate frequencies that are only achievable when the bottleneck size is small enough or the number of communities is (disproportionately) larger.</p>
<p>A similar conclusion, that stochastic fluctuations can maintain the system over evolutionary time far from the prevalence of the faster-growing type, is then confirmed by analyzing a three-species community, suggesting that the qualitative conclusions of this study are generalizable to more complex communities.</p>
<p>I expect that these results will be of broad interest to the community of researchers who strive to improve community-level selection, but are often limited to numerical explorations, with prohibitive costs for a full characterization of the parameter space of such embedded populations. The realization that not all target collective functions can be as easily achieved and that they should be adapted to the initial conditions and the selection protocol is also a sobering message for designing concrete applications.</p>
<p>A major strength of this work is that the qualitative behaviour of the system is captured by an analytically solvable approximation so that the extent of the 'forbidden region' can be directly and generically related to the parameters of the selection protocol.</p>
<p>I however found the description of the results too succinct and I think that more could be done to unpack the mathematical results in a way that is understandable to a broader audience. Moreover, the phenomenon the authors characterize is of purely ecological nature. Here, mutations of the growth rate are, in my understanding, neither necessary (non-trivial equilibria can be maintained also when \mu =0) nor sufficient (community-level selection is necessary to keep the system far from the absorbing state) for the phenomenon described. Calling this dynamics community evolution reflects a widespread ambiguity, and is not ascribable just to this work. I find that here the authors have the opportunity to make their message clearer by focusing on the case where the 'mutation' rate \mu vanishes (Equations 39 &amp; 40 of the SI) - which is more easily interpretable, at least in some limits - while they may leave the more general equations 3 &amp; 4 in the SI. Combined with an analysis of the deterministic equations, that capture the possibility of maintaining high frequencies of fast growers, the authors could elucidate the dynamics that are induced by the presence of a second level of selection, and speculate on what would be the result of real open-ended evolution (not encompassed by the simple 'switch mutations' generally considered in evolutionary game theory), for instance discussing the invasibility (or not) of mutant types with slightly different growth rates.</p>
<p>The single most important model hypothesis that I would have liked to be discussed further is that the two types do not interact. Species interactions are not only essential to achieve inheritance of composition in the course of evolution but are generally expected to play a key role even on ecological time scales. I hope the authors plan to look at this in future work.</p>
</body>
</sub-article>
</article>