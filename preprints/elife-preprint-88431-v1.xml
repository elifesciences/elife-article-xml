<?xml version="1.0" ?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.3 20210610//EN"  "JATS-archivearticle1-mathml3.dtd"><article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.3" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="nlm-ta">elife</journal-id>
<journal-id journal-id-type="publisher-id">eLife</journal-id>
<journal-title-group>
<journal-title>eLife</journal-title>
</journal-title-group>
<issn publication-format="electronic" pub-type="epub">2050-084X</issn>
<publisher>
<publisher-name>eLife Sciences Publications, Ltd</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">88431</article-id>
<article-id pub-id-type="doi">10.7554/eLife.88431</article-id>
<article-id pub-id-type="doi" specific-use="version">10.7554/eLife.88431.1</article-id>
<article-version-alternatives>
<article-version article-version-type="publication-state">reviewed preprint</article-version>
<article-version article-version-type="preprint-version">1.1</article-version>
</article-version-alternatives>
<article-categories>
<subj-group subj-group-type="heading">
<subject>Genetics and Genomics</subject>
</subj-group>
<subj-group subj-group-type="heading">
<subject>Computational and Systems Biology</subject>
</subj-group>
</article-categories>
<title-group>
<article-title>Spotless: a reproducible pipeline for benchmarking cell type deconvolution in spatial transcriptomics</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" corresp="yes">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-0922-0822</contrib-id>
<name>
<surname>Sang-aram</surname>
<given-names>Chananchida</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="aff" rid="a2">2</xref>
<xref ref-type="corresp" rid="cor1">*</xref>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-2934-5195</contrib-id>
<name>
<surname>Browaeys</surname>
<given-names>Robin</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="aff" rid="a2">2</xref>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-6636-7572</contrib-id>
<name>
<surname>Seurinck</surname>
<given-names>Ruth</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="aff" rid="a2">2</xref>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-0415-1506</contrib-id>
<name>
<surname>Saeys</surname>
<given-names>Yvan</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="aff" rid="a2">2</xref>
</contrib>
<aff id="a1"><label>1</label><institution>Data mining and Modelling for Biomedicine, VIB Center for Inflammation Research</institution>, Ghent, <country>Belgium</country></aff>
<aff id="a2"><label>2</label><institution>Department of Applied Mathematics, Computer Science and Statistics, Ghent University</institution>, Ghent, <country>Belgium</country></aff>
</contrib-group>
<contrib-group content-type="section">
<contrib contrib-type="editor">
<name>
<surname>Pinello</surname>
<given-names>Luca</given-names>
</name>
<role>Reviewing Editor</role>
<aff>
<institution-wrap>
<institution>Massachusetts General Hospital</institution>
</institution-wrap>
<city>Boston</city>
<country>United States of America</country>
</aff>
</contrib>
<contrib contrib-type="senior_editor">
<name>
<surname>Landry</surname>
<given-names>Christian R</given-names>
</name>
<role>Senior Editor</role>
<aff>
<institution-wrap>
<institution>Université Laval</institution>
</institution-wrap>
<city>Québec</city>
<country>Canada</country>
</aff>
</contrib>
</contrib-group>
<author-notes>
<corresp id="cor1"><label>*</label> Corresponding author; email: <email>chananchida.sangaram@ugent.be</email></corresp>
</author-notes>
<pub-date date-type="original-publication" iso-8601-date="2023-07-31">
<day>31</day>
<month>07</month>
<year>2023</year>
</pub-date>
<volume>12</volume>
<elocation-id>RP88431</elocation-id>
<history>
<date date-type="sent-for-review" iso-8601-date="2023-04-18">
<day>18</day>
<month>04</month>
<year>2023</year>
</date>
</history>
<pub-history>
<event>
<event-desc>Preprint posted</event-desc>
<date date-type="preprint" iso-8601-date="2023-03-24">
<day>24</day>
<month>03</month>
<year>2023</year>
</date>
<self-uri content-type="preprint" xlink:href="https://doi.org/10.1101/2023.03.22.533802"/>
</event>
</pub-history>
<permissions>
<copyright-statement>© 2023, Sang-aram et al</copyright-statement>
<copyright-year>2023</copyright-year>
<copyright-holder>Sang-aram et al</copyright-holder>
<ali:free_to_read/>
<license xlink:href="https://creativecommons.org/licenses/by/4.0/">
<ali:license_ref>https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
<license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p>
</license>
</permissions>
<self-uri content-type="pdf" xlink:href="elife-preprint-88431-v1.pdf"/>
<abstract>
<title>Abstract</title>
<p>Spatial transcriptomics (ST) is an emerging field that aims to profile the transcriptome of a cell while keeping its spatial context. Although the resolution of non-targeted ST technologies has been rapidly improving in recent years, most commercial methods do not yet operate at single-cell resolution. To tackle this issue, computational methods such as deconvolution can be used to infer cell type proportions in each spot by learning cell type-specific expression profiles from reference single-cell RNA-sequencing (scRNA-seq) data. Here, we benchmarked the performance of 11 deconvolution methods using 54 silver standards, 3 gold standards, and one in-depth case study on the liver. The silver standards were generated using our novel simulation engine <italic>synthspot</italic>, where we used six scRNA-seq datasets to create synthetic spots that followed one of nine different biological tissue patterns. The gold standards were generated using imaging-based ST technologies at single-cell resolution. We evaluated method performance based on the root-mean-squared error, area under the precision-recall curve, and Jensen-Shannon divergence. Our evaluation revealed that method performance significantly decreases in datasets with highly abundant or rare cell types. Moreover, we evaluated the stability of each method when using different reference datasets and found that having sufficient number of genes for each cell type is crucial for good performance. We conclude that while RCTD and cell2location are the top-performing methods, a simple off-the-shelf deconvolution method surprisingly outperforms almost half of the dedicated spatial deconvolution methods. Our freely available Nextflow pipeline allows users to generate synthetic data, run deconvolution methods and optionally benchmark them on their dataset (<ext-link ext-link-type="uri" xlink:href="https://github.com/saeyslab/spotless-benchmark">https://github.com/saeyslab/spotless-benchmark</ext-link>).</p>
</abstract>

</article-meta>
<notes>
<notes notes-type="competing-interest-statement">
<title>Competing Interest Statement</title><p>The authors have declared no competing interest.</p></notes>
</notes>
</front>
<body>
<sec id="s1">
<title>Introduction</title>
<p>Unlike single-cell sequencing, spatial transcriptome profiling technologies can uncover the location of cells, adding another dimension to the data that is essential for studying systems biology, e.g., cell-cell interactions and tissue architecture [<xref ref-type="bibr" rid="c1">1</xref>]. These approaches can be categorized into imaging- or sequencing-based methods, each of them offering complementary advantages [<xref ref-type="bibr" rid="c2">2</xref>]. As imaging-based methods use labeled hybridization probes to target specific genes, they offer subcellular resolution and high capture sensitivity, but are limited to a few hundreds or thousands of genes [<xref ref-type="bibr" rid="c3">3</xref>], [<xref ref-type="bibr" rid="c4">4</xref>]. On the other hand, sequencing-based methods offer an unbiased and transcriptome-wide coverage by using capture oligonucleotides with a polydT sequence [<xref ref-type="bibr" rid="c5">5</xref>], [<xref ref-type="bibr" rid="c6">6</xref>]. These oligos are printed in clusters, or <italic>spots</italic>, each with a location-specific barcode that allows identification of the originating location of a transcript. While the size of these spots initially started at 100µm in diameter, some recent sequencing technologies have managed to reduced their size to the subcellular level, thus closing the resolution gap with imaging technologies [<xref ref-type="bibr" rid="c7">7</xref>], [<xref ref-type="bibr" rid="c8">8</xref>]. However, these spots do not necessarily correspond to individual cells, and therefore, computational methods remain necessary to determine the cell-type composition of each spot.</p>
<p>Deconvolution and mapping are two types of cell type composition inference tools that can be used to disentangle populations from a mixed gene expression profile. In conjunction with the spatial dataset, a reference scRNA-seq dataset from an atlas or matched sequencing experiment is typically required in order to build cell type-specific gene signatures. Deconvolution infers the proportions of cell types in a spot by utilizing a regression or probabilistic framework, and methods specifically designed for ST data often incorporate additional model parameters to account for spot-to-spot variability. On the other hand, mapping approaches score a spot for how strongly its expression profile corresponds to those of specific cell types [<xref ref-type="bibr" rid="c9">9</xref>]. As such, deconvolution returns the <italic>proportion</italic> of cell types per spot, and mapping returns the <italic>probability</italic> of cell types belonging to a spot. Unless otherwise specified, we use the term “deconvolution” to refer to both deconvolution and mapping algorithms in this study.</p>
<p>Although there have been previous benchmarking studies by Li et al. (2022) and Yan and Sun (2023), several questions remain unanswered [<xref ref-type="bibr" rid="c10">10</xref>], [<xref ref-type="bibr" rid="c11">11</xref>]. First, the added value of algorithms specifically developed for the deconvolution of ST data has not been evaluated by comparing them to a baseline or bulk deconvolution method. Second, it is unclear which algorithms are better equipped to handle challenging scenarios, such as the presence of a highly abundant cell type throughout the tissue or the detection of a rare cell type in a single region of interest. Finally, the stability of these methods to variations in the reference dataset arising from changes in technology or protocols has not been assessed.</p>
<p>In this study, we aim to address these gaps in knowledge and provide a comprehensive evaluation of 11 deconvolution methods in terms of performance, stability, and scalability (<bold><xref rid="fig1" ref-type="fig">Figure 1</xref></bold>). The tools include eight spatial deconvolution methods (cell2location[<xref ref-type="bibr" rid="c12">12</xref>], DestVI[<xref ref-type="bibr" rid="c13">13</xref>], DSTG[<xref ref-type="bibr" rid="c14">14</xref>], RCTD[<xref ref-type="bibr" rid="c15">15</xref>], SpatialDWLS[<xref ref-type="bibr" rid="c16">16</xref>], SPOTlight[<xref ref-type="bibr" rid="c17">17</xref>], stereoscope[<xref ref-type="bibr" rid="c18">18</xref>], and STRIDE[<xref ref-type="bibr" rid="c19">19</xref>]), one bulk deconvolution method (MuSiC [<xref ref-type="bibr" rid="c20">20</xref>]), and two mapping methods (Seurat[<xref ref-type="bibr" rid="c21">21</xref>] and Tangram[<xref ref-type="bibr" rid="c22">22</xref>]). For all methods compared, we discussed with the original authors, in order to ensure that their method was run in an appropriate setting and with good parameter values. We also compare method performance with two baselines, a “null distribution” based on random proportions from a Dirichlet distribution, and predictions from the non-negative least squares (NNLS) algorithm. We evaluated method performance on a total of 57 synthetic datasets (54 silver standards and 3 gold standards) and 1 application dataset. Our benchmarking pipeline is completely reproducible and accessible through Nextflow (<ext-link ext-link-type="uri" xlink:href="http://github.com/saeyslab/spotless-benchmark">github.com/saeyslab/spotless-benchmark</ext-link>). Furthermore, each method is implemented inside a Docker container, which enables users to run the tools without requiring prior installation.</p>
<fig id="fig1" position="float" fig-type="figure">
<label>Figure 1.</label>
<caption><p>Overview of the benchmark. <bold>(A)</bold> The datasets used consist of silver standards generated from single-cell RNA-seq data, gold standards from imaging-based data, and a case study from liver data. Our simulation engine synthspot enables creation of artificial tissue patterns. <bold>(B)</bold> We evaluated deconvolution methods on three overall performance metrics (RMSE, AUPR, and JSD), and further checked specific aspects of performance, i.e., how well methods detect rare cell types and handle reference datasets from different sequencing technologies. <bold>(C)</bold> Our benchmarking pipeline is entirely accessible and reproducible through the use of Docker containers and Nextflow. <bold>(D)</bold> To evaluate performance on the liver case study, we leveraged prior knowledge of the localization and composition of cell types in the liver to calculate the AUPR and JSD. We also investigated method performance on three different sequencing protocols.</p></caption>
<graphic xlink:href="533802v1_fig1.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
</sec>
<sec id="s2">
<title>Results</title>
<sec id="s2a">
<title><italic>Synthspot</italic> allows simulation of artificial tissue patterns</title>
<p>Synthetic spatial datasets are commonly generated by developers of deconvolution methods as part of benchmarking their algorithms against others. However, these synthetic datasets typically have spots with random compositions that do not reflect the reality of tissue regions with distinct compositions, such as layers in the brain. To overcome this limitation, we developed our own simulator called <italic>synthspot</italic> that can generate synthetic tissue patterns with distinct regions, allowing for more realistic simulations (<ext-link ext-link-type="uri" xlink:href="http://github.com/saeyslab/synthspot">github.com/saeyslab/synthspot</ext-link>). We validated that our simulation procedure accurately models real data characteristics and that method performances are comparable between synthetic and real tissue patterns (<bold>Supplementary Note 1</bold>).</p>
<p>Within a synthetic dataset, <italic>synthspot</italic> creates artificial regions in which all spots belonging to the same region have the same prior frequencies. The prior frequencies correspond to the likelihood of sampling cells from a cell type, so spots within the same region will have similar compositions because they have the same prior frequencies. The priors are defined by the selected artificial tissue pattern, or <italic>abundance pattern</italic>, which determine the uniformity, distinctness, and rarity of cell types within and across regions (<bold><xref rid="fig1" ref-type="fig">Figure 1a</xref>, Figure S1</bold>). For example, the <italic>uniform</italic> characteristic will sample the same number of cells for all cell types in a spot, while <italic>diverse</italic> samples differing number of cells. The <italic>distinct</italic> characteristic constrains a cell type to only be present in one region, while <italic>overlap</italic> allows it to be present in multiple regions. Additionally, the <italic>dominant cell type</italic> characteristic randomly assigns a dominant cell type that is at least 5-15 times more abundant than others in each spot, while <italic>rare cell type</italic> does the opposite to create a cell type that is 5-15 times less abundant. The different characteristics can be combined in up to nine different abundance patterns, each representing a plausible biological scenario.</p>
</sec>
<sec id="s2b">
<title>Cell2location and RCTD perform well in synthetic data</title>
<p>Our synthetic spatial datasets consist of 54 silver standards generated from synthspot and 3 gold standards generated from imaging data with single-cell resolution (<bold>Supplementary Table 2a-b</bold>). For the silver standards, we used 9 abundance patterns with 6 publicly available scRNA-seq datasets, four of which were from mouse brain tissues (cortex, hippocampus, and two from cerebellum), one from mouse kidney, and one from human skin cancer. We generated 10 replicates for each of the 54 combinations, with each replicate containing around 750 spots (<bold>Figure S2</bold>). Half of the cells from each scRNA-seq dataset were used to generate the synthetic spots and the other half used as the reference for deconvolution. For the gold standard, we used two seqFISH+ sections of mouse brain cortex and olfactory bulb (63 spots x 10,000 genes each) and one STARMap section of mouse primary visual cortex (108 spots x 996 genes). We summed up counts from cells within circles of 55-µm diameter, which are the size of spots in the 10x Visium commercial platform.</p>
<p>We evaluated method performance with the root-mean-square error (RMSE), area under the precision-recall curve (AUPR), and Jensen-Shannon divergence (JSD) (<bold>Supplementary Note 2</bold>). The RMSE measures how numerically accurate the predicted proportions are, the AUPR measures how well a method can detect whether a cell type is present or absent, and the JSD measure similarities between two probability distributions.</p>
<p>For the silver standards, RCTD and cell2location were the top two performers across all metrics, followed by SpatialDWLS, stereoscope, and MuSiC (<bold><xref rid="fig2" ref-type="fig">Figure 2b</xref>, <xref rid="fig3" ref-type="fig">Figure 3a</xref></bold>). All other methods ranked worse than NNLS in at least two metrics. We ranked the methods for each of the 54 scenarios based on the median value across 10 replicates and summed the ranks across all scenarios to determine the overall ranking. Method performances were more consistent between abundance patterns than between datasets (<bold>Figure S4-S6</bold>). Most methods had worse performance in the two abundance patterns with a dominant cell type, and there was considerable performance variability between replicates due to different dominant cell types being selected in each replicate. Only RCTD and cell2location consistently outperformed NNLS in all metrics for these patterns (<bold>Figure S7</bold>).</p>
<fig id="fig2" position="float" fig-type="figure">
<label>Figure 2.</label>
<caption><p><bold>(a)</bold> Methods ordered according to the aggregated rankings of performance and scalability. <bold>(b)</bold> Performance of each method across metrics, artificial abundance patterns in the silver standard, and data sources. The ability to detect rare cell types and robustness against different reference datasets are also included. <bold>(c)</bold> Average runtime across silver standards and scalability towards more spots.</p></caption>
<graphic xlink:href="533802v1_fig2.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<fig id="fig3" position="float" fig-type="figure">
<label>Figure 3.</label>
<caption><p>Method performance on synthetic datasets, evaluated using root-mean-squared error (RMSE), area under the precision-recall curve (AUPR), and Jensen-Shannon divergence (JSD). NNLS is the baseline algorithm (shaded). Methods are ordered from best to worst summed ranks. <bold>(a)</bold> The rank distribution of each method across all 54 silver standards, based on the best median value across ten replicates for that standard. <bold>(b)</bold> Gold standards of seqFISH+ datasets (10,000 genes) and STARMap (400 genes). We took the average over seven field of views for the seqFISH+ dataset.</p></caption>
<graphic xlink:href="533802v1_fig3.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>For the gold standards, cell2location, MuSiC, and RCTD are the top three performers as well as the only methods to outrank NNLS in all three metrics (<bold><xref rid="fig3" ref-type="fig">Figure 3b</xref></bold>). As each seqFISH+ dataset consisted of seven field of views (FOVs), we used the average across FOVs as the representative value to be ranked for that dataset. Several FOVs were dominated by one cell type (<bold>Figure S3</bold>), which was similar to the dominant cell type abundance pattern in our silver standard. Consistent with the silver standard results, half of the methods did not perform well in these FOVs. In particular, SPOTlight, DestVI, stereoscope, and Tangram tended to predict less variation between cell type abundances. DSTG, SpatialDWLS, and Seurat predicted the dominant cell type in some FOVs, but did not predict the remaining cell type compositions accurately. Most methods performed worst in the STARMap dataset except for SpatialDWLS, SPOTlight, and Tangram.</p>
</sec>
<sec id="s2c">
<title>Detecting rare cell types remains challenging even for top-performing methods</title>
<p>Lowly abundant cell types often play an important role in development or disease progression, as in the case of stem cells and progenitor cells or circulating tumor cells [<xref ref-type="bibr" rid="c23">23</xref>]. As the occurrence of these cell types are often used to create prognostic models of patient outcomes, accurate detection of rare cell types is a key aspect of deconvolution tools [<xref ref-type="bibr" rid="c24">24</xref>], [<xref ref-type="bibr" rid="c25">25</xref>]. Here, we focus on the two <italic>rare cell type</italic> patterns in our silver standard (<italic>rare cell type diverse</italic> and <italic>regional rare cell type diverse</italic>), in which a rare cell type is 5-15 times less abundant than other cell types in either all or one synthetic region (<bold>Figure S1g-h</bold>). We evaluated methods based on the AUPR of the rare cell type only, in contrast to using two other metrics and considering all cell types together as done previously. This is because in prognostic models, the presence of rare cell types is often of more importance than the magnitude of the abundance itself. As such, it is more relevant that methods are able to correctly rank spots with and without the rare cell type.</p>
<p>We summed method rankings across the 12 combinations (6 scRNA-seq datasets x 2 rare cell type patterns), using the average AUPR of the replicates as the representative value for each combination. In line with our previous analysis, RCTD and cell2location were the best at predicting the presence of lowly abundant cell types (<bold><xref rid="fig2" ref-type="fig">Figure 2b</xref>, <xref rid="fig4" ref-type="fig">Figure 4a</xref></bold>). The AUPR is substantially lower if the rare cell type is only present in one region and not across the entire tissue, indicating that prevalence is also an important factor in detection. Nonetheless, the link between abundance and AUPR can be clearly observed, as seen by the PR curves of three cell types from the brain cortex dataset-regionally rare abundance pattern (<bold><xref rid="fig4" ref-type="fig">Figure 4b</xref></bold>). While most methods can detect cell types with moderate or high abundance, they usually have lower sensitivity for rare cell types, and hence lower AUPRs. To corroborate this, we visually inspected PR curves in each dataset-abundance pattern combination based on average cell type abundances and found similar patterns (<bold>Figure S8</bold>).</p>
<fig id="fig4" position="float" fig-type="figure">
<label>Figure 4.</label>
<caption><p>Detection of the rare cell type in the two <italic>rare cell type</italic> abundance patterns. <bold>(a)</bold> Area under the precision-recall curve in six datasets, averaged over ten replicates. Methods generally have better AUPR if the rare cell type is present in all regions compared to just one region. <bold>(b)</bold> Most methods can detect moderately and highly abundant cells, but their performance drops for lowly abundant cells.</p></caption>
<graphic xlink:href="533802v1_fig4.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
</sec>
<sec id="s2d">
<title>Technical variability between reference and spatial datasets can significantly impact predictions</title>
<p>Since deconvolution predictions exclusively rely on signatures learned from the scRNA-seq reference, it should come as no surprise that the choice of the reference dataset has been shown to have the largest impact on bulk deconvolution predictions [<xref ref-type="bibr" rid="c26">26</xref>]. Hence, deconvolution methods should ideally also account for platform effects, i.e., the capture biases that may occur from differing protocols and technologies being used to generate scRNA-seq and ST data.</p>
<p>To evaluate the stability of each method against reference datasets from different technological platforms, we devised the <italic>inter</italic>-dataset scenario, where we provided an alternative reference dataset to be used for deconvolution, in contrast to the <italic>intra-</italic>dataset analysis done previously, where the same reference dataset was used for both spot generation and deconvolution. We tested this on the brain cortex (SMART-seq) and two cerebellum (Drop-seq and 10x Chromium) silver standards. For the brain cortex, we used the 10x Chromium reference from the same atlas [<xref ref-type="bibr" rid="c27">27</xref>], and we simply swapped the references for the cerebellum datasets. To measure stability, we computed the JSD between the proportions predicted from the intra- and inter-dataset scenario.</p>
<p>Except for MuSiC, we see that methods with better performance – cell2location, RCTD, SpatialDWLS, and stereoscope – were also more stable against changing reference datasets (<bold><xref rid="fig2" ref-type="fig">Figure 2b</xref>, <xref rid="fig5" ref-type="fig">Figure 5</xref></bold>). Out of these four, only SpatialDWLS did not account for a platform effect in its model definition. Cell2location had the most stable predictions, ranking first in all three datasets, while both NNLS and MuSiC were consistently in the bottom three. For the rest of the methods, stability varied between datasets. DestVI performed well in the cerebellum datasets but not the brain cortex, and SPOTlight had the opposite problem. Stereoscope, RCTD, and SpatialDWLS always ranked in the top half, and DSTG the bottom half. As expected, deconvolution performance generally worsens in the inter-dataset scenario (<bold>Figure S10</bold>).</p>
<fig id="fig5" position="float" fig-type="figure">
<label>Figure 5.</label>
<caption><p>Stability against different reference datasets. For the same synthetic spatial datasets, two reference datasets were given and the Jensen-Shannon divergence (JSD) was computed between the predicted proportions. Methods are ordered based on stability, with a lower JSD indicating higher stability.</p></caption>
<graphic xlink:href="533802v1_fig5.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
</sec>
<sec id="s2e">
<title>Evaluation of methods on liver Visium datasets validate results on synthetic data</title>
<p>Although synthetic datasets are useful, it is also important to validate deconvolution methods on real sequencing-based ST data, as they may have different characteristics. For this purpose, we used four mouse liver Visium slides from the Guilliams et al. liver atlas [<xref ref-type="bibr" rid="c28">28</xref>]. The liver is a particularly interesting case study due to its tissue pattern, which is highly populated with hepatocytes (more than 60% abundant). This allows us to compare method performance with those of the <italic>dominant cell type</italic> abundance pattern from the silver standard, which was challenging for most methods. Furthermore, the liver atlas is also ideal for evaluating method stability, as it was generated using cells from three different experimental protocols: scRNA-seq following <italic>ex vivo</italic> digestion, scRNA-seq following <italic>in vivo</italic> liver perfusion, and single-nucleus RNA-seq (snRNA-seq) on frozen liver (<bold>Figure S11</bold>).</p>
<p>We assessed method performance using AUPR and JSD by leveraging prior knowledge of the <italic>localization</italic> and <italic>composition</italic> of cell types in the liver. Although the true composition of each spot is not known, we can assume the presence of certain cell types in certain locations in the tissue due to the zonated nature of the liver. Specifically, we calculated the AUPR of portal vein and central vein endothelial cells (ECs) under the assumption that they are present only in their respective locations. Next, we calculated the JSD of the expected and predicted cell type proportions in a liver sample. The expected cell type proportions were based on snRNA-seq data, which has been shown to best recapitulate the true cell compositions observed by confocal microscopy [<xref ref-type="bibr" rid="c28">28</xref>]. We ran each method on a combined reference containing all three experimental protocols (<italic>ex vivo</italic> scRNA-seq, <italic>in vivo</italic> scRNA-seq, and snRNA-seq), as well as on each protocol separately. To ensure consistency, we filtered each reference dataset to only include the nine cell types that were common to all three protocols.</p>
<p>We found that RCTD and cell2location were the best performers for both AUPR and JSD (<bold><xref rid="fig6" ref-type="fig">Figure 6</xref></bold>), achieving a JSD similar to the average pairwise JSD between four snRNA-seq samples. However, the JSD of Tangram, DSTG, SPOTlight, and stereoscope were worse than NNLS. Except for SPOTlight, these three methods were not able to accurately infer the overabundance of the dominant cell type, with stereoscope and Tangram predicting a uniform distribution of cell types (<bold>Figure S12</bold>). This corresponds to what we observed in the <italic>dominant cell type</italic> pattern of the silver standard and certain FOVs in the gold standard. However, there were some inconsistencies between the AUPR and JSD rankings, specifically with Seurat and SpatialDWLS ranking highly for JSD and lowly for AUPR. This is because the JSD is heavily influenced by the dominant cell type in the dataset, such that even when predicting only the dominant cell type per spot, Seurat still performed well in terms of JSD. However, it was unable to predict the presence of portal and central vein ECs in their respective regions (<bold>Figure S13</bold>). Therefore, both the AUPR and JSD must be considered when evaluating methods.</p>
<fig id="fig6" position="float" fig-type="figure">
<label>Figure 6.</label>
<caption><p>Method performance based on detecting portal/central vein endothelial cells in portal and central veins (AUPR), and by comparing distributions of all cell types (JSD). The biological variation is the average JSD between four snRNA-seq samples. All reference datasets here contain 9 cell types. Methods are ordered based on summed rank of all data points.</p></caption>
<graphic xlink:href="533802v1_fig6.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>We observed that using the combination of the three experimental protocols as the reference dataset did not necessarily result in the best performance, and it was often possible to achieve better or similar results by using a reference dataset from a single experimental protocol. The best reference varied between methods, and most methods did not exhibit consistent performance across all references. Interestingly, Cell2location, MuSiC, and NNLS had much higher JSD when using the snRNA-seq data as the reference, while RCTD and Seurat had the lowest JSD using this reference. To further evaluate the stability of the methods, we calculated the JSD between proportions predicted with different reference datasets. RCTD and Seurat showed the lowest JSD, indicating higher stability (<bold>Figure S14</bold>). Finally, we examined the predicted proportions when using the entire atlas without filtering, which contains all three protocols and 23 cell types instead of the 9 common cell types as before (<bold>Figure S12</bold>).</p>
<p>The additional 14 cell types made up around 20% of the ground truth proportions. While RCTD, Seurat, SpatialDWLS, and MuSiC retained the relative proportions of the 9 common cell types, the rest predicted substantially different cell compositions.</p>
</sec>
<sec id="s2f">
<title>Runtime and scalability</title>
<p>Most methods were able to deconvolve the datasets in less than 30 minutes and had only slight variability in the runtime (<bold><xref rid="fig7" ref-type="fig">Figure 7a</xref></bold>). Model-based methods like DestVI, stereoscope, cell2location, and STRIDE had the advantage that their model can be reused for synthetic datasets that were generated from the same single-cell dataset. The model fitting step is then constant for all synthetic datasets, as each one contains roughly 1000 spots. Often these model-based methods can also make use of GPU acceleration (e.g. through a PyTorch implementation), which we applied when available. We do not recommend running them on a CPU, as the runtime can increase by more than tenfold.</p>
<fig id="fig7" position="float" fig-type="figure">
<label>Figure 7.</label>
<caption><p><bold>(a)</bold> Runtime over the 540 silver standards, ordered by median runtime. GPU acceleration is used whenever possible (asterisks). Cell2location, stereoscope, DestVI, and STRIDE first run with a model building step for each single-cell reference (red points), which can be reused for 90 synthetic datasets. <bold>(b)</bold> Scalability of the methods based on varying the dimensions of the spatial dataset. We added the model building and fitting time to model-based methods. Methods are ordered based on total time.</p></caption>
<graphic xlink:href="533802v1_fig7.tif" mimetype="image" mime-subtype="tiff"/>
</fig>
<p>Next, we investigated the scalability of the methods by varying the dimensions of the spatial dataset (<bold><xref rid="fig7" ref-type="fig">Figure 7b</xref></bold>). We tested 16 combinations of spots (100, 1k, 5k, 10k) and genes (5k, 10k, 20k, 30k), while the single-cell dataset was kept at 5k cells and 30k genes. Here, we considered both the model building and fitting step in the runtime (if applicable). Tangram, Seurat, and SPOTlight had a constant runtime across all dimensions, each deconvolving the largest dataset (3 × 10<sup>8</sup> elements in total) in less than ten minutes. Other methods had increased runtime both when spots and genes were increased, except for DestVI who was only affected by the number of spots, and STRIDE by the number of genes. This was because DestVI only used 2,000 highly variable genes for deconvolution. Similarly, the scalability of RCTD, SpatialDWLS, Tangram, and SPOTlight are because they only make use of differentially expressed or cell type-specific marker genes. Stereoscope was the least scalable by far, taking over 8 hours for the largest dataset, and 3.5 hours for the smallest one. Note that many methods allow for parameters that can greatly affect runtime, such as the number of training epochs and/or the number of genes to use (<bold>Supplementary Table 1</bold>). For instance, here we have used all genes to run stereoscope (default parameters), but the authors have suggested that it is possible to use only 5000 genes in the model and maintain the same performance.</p>
</sec>
</sec>
<sec id="s3">
<title>Discussion</title>
<p>In this study, we performed a thorough investigation of various biologically relevant and previously unconsidered aspects related to deconvolution. We evaluated the performance of 11 deconvolution methods on 54 silver standards, 3 gold standards, and 1 Visium dataset using 3 complementary metrics. In addition, we incorporated two baselines, the NNLS algorithm and null distribution proportions. Our findings indicate that RCTD, cell2location, and SpatialDWLS were the highest ranked methods in terms of performance, consistent with previous studies [<xref ref-type="bibr" rid="c10">10</xref>], [<xref ref-type="bibr" rid="c11">11</xref>]. However, we also found that over half of the methods did not outperform the baseline (NNLS) and bulk deconvolution method (MuSiC). These results were consistent across the silver and gold standards, as well as the liver case study, demonstrating the generalizability and applicability of our simulation and benchmarking framework (<bold><xref rid="fig2" ref-type="fig">Figure 2</xref></bold>). We also found that the abundance pattern of the tissue and the reference dataset used had the most significant impact on method performance. Even top-performing methods struggled with challenging abundance patterns, such as when a rare cell type was present in only one region, or when a highly dominant cell type masks the signature of less abundant ones. Furthermore, different reference datasets could result in substantially different predicted proportions. Methods that accounted for technical variability in their models, such as cell2location and RCTD, were more stable to changes in the reference dataset than those that did not, such as SpatialDWLS.</p>
<p>Regarding the reference dataset, the number of genes per cell type (which is generally correlated to the sequencing depth) seems to have a significant impact on the performance of deconvolution methods. We observed that methods were less accurate in datasets with fewer genes per cell type (<bold>Figure S9</bold>). For example, all methods performed better in the single-nucleus cerebellum silver standard dataset, which had the same number of cell types as the single-cell cerebellum dataset, but on average 1,000 more genes per cell type. The kidney dataset was the most challenging for all methods, with most of its 16 cell types having less than 1,000 features. This was evident from the RMSE and JSD scores that were relatively close to the null distribution (<bold>Figure S4</bold>). In contrast, the 18 cell types in the brain cortex dataset had an average of 3,000-9,000 features, leading to much better performance for most methods compared to the kidney dataset despite having more cell types. This trend was also observed in the STARMap gold standard dataset, which consisted of only 996 genes. Most methods performed worse in the STARMap dataset except for SpatialDWLS, SPOTlight, and Tangram. Since these three methods only use marker genes for deconvolution, this may explain why the small number of genes (most of which are already marker genes) did not affect them as much.</p>
<p>In addition to performance, the runtime and scalability of a method is also a factor to consider. Although most methods’ runtimes were comparable on our silver standards, we have made use of GPU acceleration for Tangram, DestVI, stereoscope, and cell2location. As this might not be available for some users, using these methods on the CPU might require training on fewer epochs or selecting only a subset of genes. With all these factors in consideration, we recommend RCTD as a good starting point. In addition to being one of the best and fastest methods, it also allows CPU parallelization (i.e., using multiple cores) for users that may not have access to a GPU.</p>
<p>As a general guideline, we recommend comparing the result of multiple deconvolution methods, especially between cell2location and RCTD. If the predictions are highly contradictory, the reference dataset may not be of sufficiently good quality. We recommend obtaining scRNA-seq and spatial data from the same sample to reduce biological variability, as there will always be technical variability across platforms. This can also ensure that the same cell types will be present in both datasets [<xref ref-type="bibr" rid="c9">9</xref>]. If that is not possible, use a reference dataset that has sufficient sequencing depth (at least more than 1000 genes per cell type), preferably from a single platform. In addition to checking the dataset’s sequencing depth, one can also evaluate the reference dataset quality using our simulation engine <italic>synthspot</italic>. As in our silver standards, users can select the abundance pattern most resembling the real tissue to generate the synthetic spatial dataset. For a good reference, both cell2location and RCTD should nearly have an AUPR of one and JSD of zero. We have integrated this entire workflow (simulating synthetic data, executing deconvolution methods, and evaluating the predictions) in our Nextflow pipeline as well.</p>
<p>As spatial omics is still an emerging field, the development of new deconvolution methods can be anticipated in the future. Our benchmark provides a reliable and reproducible evaluation framework for current and upcoming deconvolution tools, making it a valuable resource for researchers in the field.</p>
</sec>
<sec id="d1e711" sec-type="supplementary-material">
<title>Supporting information</title>
<supplementary-material id="d1e799">
<label>Supplementary Figures</label>
<media xlink:href="supplements/533802_file09.pdf"/>
</supplementary-material>
<supplementary-material id="d1e806">
<label>Supplementary Notes</label>
<media xlink:href="supplements/533802_file10.pdf"/>
</supplementary-material>
<supplementary-material id="d1e813">
<label>Supplementary Table 1</label>
<media xlink:href="supplements/533802_file11.xlsx"/>
</supplementary-material>
<supplementary-material id="d1e820">
<label>Supplementary Table 2</label>
<media xlink:href="supplements/533802_file12.xlsx"/>
</supplementary-material>
</sec>
</body>
<back>
<ack>
<title>Acknowledgements</title>
<p>We would like to thank all the authors of the methods who provided valuable feedback on how to optimally run their algorithms. Their input has been crucial in enabling us to compare the methods in a fair manner. This study was funded by BOF (Ghent University, C.S.) and The Research Foundation - Flanders (1181318N, R.B.).</p>
</ack>
<sec id="s4">
<title>Methods</title>
<sec id="s4a">
<title>Synthspot</title>
<p>We generated synthetic spatial datasets using the <italic>synthspot</italic> R package (<ext-link ext-link-type="uri" xlink:href="http://github.com/saeyslab/synthspot">github.com/saeyslab/synthspot</ext-link>), whose spot generation process is modeled after that of SPOTlight [<xref ref-type="bibr" rid="c17">17</xref>]. This simulator generates synthetic spot data by considering the gene expression of one spot as a mixture of the expression of <italic>n</italic> cells (<italic>nn</italic> between 2 and 10, randomly sampled based on a uniform distribution). To generate one spot, the simulator samples <italic>nn</italic> cells from the input scRNA-seq data, sums their counts gene by gene, and downsamples the counts. The target number of counts for downsampling is picked from a normal distribution with mean and standard deviation of 20000 ± 5000 by default, but these values can be changed by the user. To mimic biological tissue, synthspot generates artificial regions, or groups of spots with similar cell type compositions (<bold>Figure S2</bold>). The prior distribution of each cell type in each region is influenced by the selected <italic>abundance pattern</italic>, called <italic>dataset type</italic> in the package (<bold>Supplementary Note 1</bold>). We used 9 out of the 17 possible abundance patterns. For each single-cell dataset, we generated ten replicates of each abundance pattern. For each replicate, we ran <italic>generate_synthetic_visium</italic> with five regions (<italic>n_regions</italic>), with minimally 100 spots and maximally 200 spots per region (<italic>n_spots_min, n_spots_max)</italic>, and target counts of 20000 ± 5000 per spot (<italic>visium_mean</italic>, and <italic>visium_sd</italic>). There were on average 750 spots per replicate.</p>
</sec>
<sec id="s4b">
<title>Methods execution</title>
<p>An overview of the 11 methods can be found in <bold>Supplementary Table 1</bold>. All methods require a reference scRNA-seq dataset with cell type annotations along with the spatial dataset as inputs. We ran the methods based on the tutorials provided, and tested different parameters whenever possible and used the best results (<bold>Supplementary Note 3</bold>). We contacted the authors for recommendations on how to run the methods. Cell2location, DestVI, stereoscope, and STRIDE were run in two steps, first training a model on the reference scRNA-seq data, and second predicting the cell type proportions using the model. Hence, a model trained on a scRNA-seq dataset can be reused for all abundance patterns of that dataset (9 patterns x 10 replicates).</p>
<p>For reproducibility, each method was installed inside a Docker container and can be run either using Docker or Singularity (Apptainer). We implemented a Nextflow pipeline to run the methods concurrently and compute their performance [<xref ref-type="bibr" rid="c29">29</xref>]. Our pipeline can be run in three modes 1) <italic>run_standard</italic> which is used to reproduce our analysis, 2) <italic>run_dataset</italic> which users can run the pipeline on their own scRNA-seq and spatial datasets, and 3) <italic>generate_and_run</italic> which takes a scRNA-seq dataset, generates synthetic datasets from it, and runs the pipeline. Furthermore, our pipeline can accept the single-cell and spatial inputs as a Seurat (.rds) or AnnData (.h5ad) object in <italic>any</italic> combination, and the proportions are output as a tab-separated file. Parameter tuning is also implemented. All analysis scripts and parameter configurations can be found at <ext-link ext-link-type="uri" xlink:href="https://github.com/saeyslab/spotless-benchmark">https://github.com/saeyslab/spotless-benchmark</ext-link>.</p>
<p>All methods were run on a high-performance computing cluster (HPC) with a SLURM scheduler. We made use of the GPU cluster (NVIDIA Volta V100) whenever possible. We started with 1 core and 8GB memory, dynamically increasing the memory by 8GB if the process would fail.</p>
</sec>
<sec id="s4c">
<title>Datasets</title>
<p>We used 3 and 54 datasets for the gold and silver standards, respectively. They can be downloaded on Zenodo (<ext-link ext-link-type="uri" xlink:href="https://zenodo.org/record/5763377">https://zenodo.org/record/5763377</ext-link>).</p>
<sec id="s4c1">
<title>Gold</title>
<p>The seqFISH+ dataset consisted of two mouse brain tissue slices (cortex and olfactory bulb) with 7 field of views (FOVs) per slice. Ten thousand genes were profiled for all FOVs. Each FOV had a dimension of 206 μm x 206 μm and a resolution of 103 nm per pixel. We simulated Visium spots of 55 μm diameter and disregarded the spot-to-spot distance, resulting in 9 spots per FOV and 126 spots for the entire dataset. The FOVs had varying number of cells and cell types per simulated spot (<bold>Supplementary Table 2A</bold>). We created a reference dataset for each tissue slice using the combined single-cell expression profiles from all seven FOVs. There were 17 cell types in the cortex tissue section and 9 cell types in the olfactory bulb tissue section.</p>
<p>The STARMap dataset of mouse primary visual cortex (VISp) is 1.4 mm x 0.3 mm and contains 1,020 genes and 973 cells. We generated Visium-like spots as above, assuming that 1 pixel = 810 nm, as this information was not provided. We removed any spot with hippocampal cell types, and removed unannotated and Reln cells from spots, resulting in 108 spots comprising 569 cells and 12 cell types in total (<bold>Supplementary Table 2A</bold>). We used the VISp scRNA-seq dataset from the Allen Brain Atlas as the reference [<xref ref-type="bibr" rid="c30">30</xref>]. After filtering for common genes, 996 genes remained.</p>
</sec>
<sec id="s4c2">
<title>Silver</title>
<p>We used five scRNA-seq datasets and one snRNA-seq dataset for the generation of silver standards (<bold>Supplementary Table 2B; Figure S9</bold>). All datasets are publicly available and already contained cell type annotations. We downsized each dataset by filtering out cells with an ambiguous cell type label and cell types with less than 25 cells, and keeping only highly variable genes (HVGs) that are expressed in at least 10% of cells from one cell type. We set this threshold at 25% for the brain cortex dataset. We further downsampled the kidney dataset to 15,000 cells. For the two cerebellum datasets, we integrated them following the method of [<xref ref-type="bibr" rid="c21">21</xref>], performed gene filtering on the integrated dataset, and only retained common cell types.</p>
</sec>
<sec id="s4c3">
<title>Liver</title>
<p>We downloaded scRNA-seq and spatial datasets of healthy mice from the liver cell atlas [<xref ref-type="bibr" rid="c28">28</xref>] (<bold>Supplementary Table 2C</bold>). The scRNA-seq data has 185,894 cells and 31,053 genes from three digestion protocols: <italic>ex vivo</italic> digestion, <italic>in vivo</italic> perfusion, and nuclei isolation. We used the finer annotation of CD45<sup>-</sup> cells, which among others, subclustered endothelial cells into portal vein, central vein, lymphatic, and liver sinusoidal endothelial cells. We only selected cell types that are at least 50 cells present in all three digests, resulting in nine cell types. The spatial data consisted of four Visium slides, containing on average 1,440 spots. Based on hepatocyte zonation markers, the zonation trajectory of each spot was calculated and then each spot was annotated as part of central, mid, periportal, or portal zone.</p>
<p>We ran deconvolution using five (sub)sets of the scRNA-seq reference: three digestion protocols that were filtered to nine common cell types, the combined dataset of these three, and the entire atlas. This entire atlas was not used to compute evaluation metrics but only to visualize method stability (<bold>Figure S12</bold>). Due to the large size of the references, we ran some methods differently. We ran stereoscope with 5000 HVGs and subsampled each cell type to a maximum of 250 cells (<italic>-sub</italic>). We gave STRIDE a number of topics to test (<italic>--ntopics 23 33 43 53 63</italic>) instead of the default range of [#cell types, #cell types × 3]. For Seurat, we ran <italic>FindTransferAnchors</italic> with the “rpca” (reciprocal PCA) option instead of “pcaproject”. MuSiC and SpatialDWLS use dense matrices in their code (in contrast to sparse matrices in other methods), resulting in a size limit of 2<sup>31</sup> elements in a matrix. Whenever this is exceeded, we downsampled the reference dataset by keeping maximally 10,000 cells per cell type, and keeping 3000 HVGs along with any genes that are at least 10% expressed in a cell type. Finally, for the combined reference, we provided the digest information to cell2location and Seurat.</p>
<p>To compute the AUPR, we considered only spots annotated as being in the central or portal zone. We considered the following ground truth for portal vein and central vein ECs:</p>
<table-wrap id="utbl1" orientation="portrait" position="float">
<graphic xlink:href="533802v1_utbl1.tif" mimetype="image" mime-subtype="tiff"/>
</table-wrap>
<p>For the JSD, we first calculated the average abundance of each cell type for each slide separately. Then, we selected four samples from the snRNA-seq digest (ABU11, ABU13, ABU17, ABU20), as they were the only ones that contained all 9 cell types in the sample, and also averaged the abundance of each cell type. Then, we calculated the pairwise JSD between each of the four slides and four snRNA-seq samples and reported the average JSD. The reference value is obtained by averaging the pairwise JSD between the four snRNA-seq samples.</p>
</sec>
</sec>
<sec id="s4d">
<title>Scalability</title>
<p>We generated a synthetic dataset of 10,000 spots and ∼31,000 genes from the liver atlas data using only the Nuc-seq part. We then used both the scRNA-seq data from the atlas as the reference dataset (both ex vivo and in vivo digestions). The synthetic dataset uses the prior distribution of cell types from the given data, so all spots have approximately the same composition (<italic>generate_synthetic_data_lite</italic> function from <italic>synthspot</italic>). The genes of the synthetic data were downsampled randomly, while the genes of the scRNA-seq data was downsampled based on the marker genes and HVGs. The spots/cells of both datasets were downsampled randomly (in a stratified manner for the reference dataset). We used the same parameters as we did for running the silver standard.</p>
</sec>
<sec id="s4e">
<title>Benchmark metrics</title>
<p>The root-mean-squared error (RMSE) between the known and predicted proportions (<italic>p</italic>) of a spot <italic>s</italic> for cell type <italic>z</italic>, in a reference dataset with <italic>Z</italic> cell types in total, is calculated as
<disp-formula id="eqn1">
<alternatives><graphic xlink:href="533802v1_eqn1.gif" mimetype="image" mime-subtype="gif"/></alternatives>
</disp-formula>
</p>
<p>The Jensen-Shannon divergence (JSD) is a smoothed and symmetric version of the Kullback-Leibler divergence (KL). It is calculated as
<disp-formula id="ueqn1">
<alternatives><graphic xlink:href="533802v1_ueqn1.gif" mimetype="image" mime-subtype="gif"/></alternatives>
</disp-formula>
</p>
<p>The RMSE and JSD values across all spots are averaged and used as the representative value for a replicate <italic>k</italic> for each dataset-abundance pattern combination. Note that the RMSE calculation takes the number of cell types into account and hence should not be compared between datasets.</p>
<p>We used the area under the precision-recall curve (AUPR) instead of area under the receiver-operating curve (ROC) because in our silver standard there are more cell types absent than present per spot, and such imbalanced datasets are better evaluated with the AUPR [<xref ref-type="bibr" rid="c31">31</xref>]. For the AUPR, we get one value for the entire replicate. First, we binarized the known proportions by considering a cell type to be present in a spot if its proportion is greater than zero, and absent if it is equal to zero. Then, we compute the micro-averaged AUPR by aggregating all cell types together. We calculated the JSD and AUPR using the R packages <italic>philentropy</italic> and <italic>precrec</italic>, respectively [<xref ref-type="bibr" rid="c32">32</xref>], [<xref ref-type="bibr" rid="c33">33</xref>].</p>
<p>To provide a reference value for both metrics, we used (1) random proportions based on probabilities drawn from a Dirichlet distribution and (2) NNLS. For the former, we generated a reference value for all 56 combinations using the average value of 100 iterations. The dimension of the <bold><italic>α</italic></bold> vector was equal to the number of cell types in the corresponding dataset, and all concentration values were set to 1.</p>
<p>For the NNLS baseline, we used the Lawson-Hanson NNLS implementation found in the <italic>nnls</italic> R package. We computed the single-cell reference profile by averaging the mean expression per gene for each cell type, and then used the function <italic>nnls</italic> to calculate the parameter estimates, which is then divided by the summed total to obtain the proportions. That is, we solve for <italic>β</italic> in the equation <bold><italic>Y</italic></bold> = <bold><italic>X</italic></bold><italic>β</italic>, with <bold><italic>Y</italic></bold> the spatial expression matrix and <bold><italic>X</italic></bold> the average gene expression profile per cell type from the scRNA-seq reference.</p>
</sec>
</sec>
<ref-list>
<title>References</title>
<ref id="c1"><label>[1]</label><mixed-citation publication-type="journal"><string-name><given-names>A.</given-names> <surname>Wagner</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Regev</surname></string-name>, and <string-name><given-names>N.</given-names> <surname>Yosef</surname></string-name>, “<article-title>Revealing the vectors of cellular identity with single-cell genomics</article-title>,” <source>Nat. Biotechnol</source>., vol. <volume>34</volume>, no. <issue>11</issue>, pp. <fpage>1145</fpage>–<lpage>1160</lpage>, <month>Nov</month>. <year>2016</year>, doi: <pub-id pub-id-type="doi">10.1038/nbt.3711</pub-id>.</mixed-citation></ref>
<ref id="c2"><label>[2]</label><mixed-citation publication-type="other"><string-name><given-names>M.</given-names> <surname>Asp</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Bergenstråhle</surname></string-name>, and <string-name><given-names>J.</given-names> <surname>Lundeberg</surname></string-name>, “<article-title>Spatially Resolved Transcriptomes—Next Generation Tools for Tissue Exploration</article-title>,” <source>BioEssays</source>, p. <fpage>1900221</fpage>, <month>May</month> <year>2020</year>, doi: <pub-id pub-id-type="doi">10.1002/bies.201900221</pub-id>.</mixed-citation></ref>
<ref id="c3"><label>[3]</label><mixed-citation publication-type="journal"><string-name><given-names>C.-H. L.</given-names> <surname>Eng</surname></string-name> <etal>et al.</etal>, “<article-title>Transcriptome-scale super-resolved imaging in tissues by RNA seqFISH+</article-title>,” <source>Nature</source>, vol. <volume>568</volume>, no. <issue>7751</issue>, pp. <fpage>235</fpage>–<lpage>239</lpage>, <year>2019</year>.</mixed-citation></ref>
<ref id="c4"><label>[4]</label><mixed-citation publication-type="journal"><string-name><given-names>C.</given-names> <surname>Xia</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Fan</surname></string-name>, <string-name><given-names>G.</given-names> <surname>Emanuel</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Hao</surname></string-name>, and <string-name><given-names>X.</given-names> <surname>Zhuang</surname></string-name>, “<article-title>Spatial transcriptome profiling by MERFISH reveals subcellular RNA compartmentalization and cell cycle-dependent gene expression</article-title>,” <source>Proc. Natl. Acad. Sci</source>., vol. <volume>116</volume>, no. <issue>39</issue>, pp. <fpage>19490</fpage>–<lpage>19499</lpage>, <month>Sep</month>. <year>2019</year>, doi: <pub-id pub-id-type="doi">10.1073/pnas.1912459116</pub-id>.</mixed-citation></ref>
<ref id="c5"><label>[5]</label><mixed-citation publication-type="journal"><string-name><given-names>S. G.</given-names> <surname>Rodriques</surname></string-name> <etal>et al.</etal>, “<article-title>Slide-seq: A scalable technology for measuring genome-wide expression at high spatial resolution</article-title>,” <source>Science</source>, vol. <volume>363</volume>, no. <issue>6434</issue>, pp. <fpage>1463</fpage>–<lpage>1467</lpage>, <month>Mar</month>. <year>2019</year>, doi: <pub-id pub-id-type="doi">10.1126/science.aaw1219</pub-id>.</mixed-citation></ref>
<ref id="c6"><label>[6]</label><mixed-citation publication-type="journal"><string-name><given-names>P. L.</given-names> <surname>Ståhl</surname></string-name> <etal>et al.</etal>, “<article-title>Visualization and analysis of gene expression in tissue sections by spatial transcriptomics</article-title>,” <source>Science</source>, vol. <volume>353</volume>, no. <issue>6294</issue>, pp. <fpage>78</fpage>–<lpage>82</lpage>, <month>Jul</month>. <year>2016</year>, doi: <pub-id pub-id-type="doi">10.1126/science.aaf2403</pub-id>.</mixed-citation></ref>
<ref id="c7"><label>[7]</label><mixed-citation publication-type="journal"><string-name><given-names>A.</given-names> <surname>Chen</surname></string-name> <etal>et al.</etal>, “<article-title>Spatiotemporal transcriptomic atlas of mouse organogenesis using DNA nanoball-patterned arrays</article-title>,” <source>Cell</source>, vol. <volume>185</volume>, no. <issue>10</issue>, pp. <fpage>1777</fpage>-<lpage>1792</lpage>.e21, <month>May</month> <year>2022</year>, doi: <pub-id pub-id-type="doi">10.1016/j.cell.2022.04.003</pub-id>.</mixed-citation></ref>
<ref id="c8"><label>[8]</label><mixed-citation publication-type="journal"><string-name><given-names>C.-S.</given-names> <surname>Cho</surname></string-name> <etal>et al.</etal>, “<article-title>Microscopic examination of spatial transcriptome using Seq-Scope</article-title>,” <source>Cell</source>, vol. <volume>184</volume>, no. <issue>13</issue>, pp. <fpage>3559</fpage>-<lpage>3572</lpage>.e22, <month>Jun</month>. <year>2021</year>, doi: <pub-id pub-id-type="doi">10.1016/j.cell.2021.05.010</pub-id>.</mixed-citation></ref>
<ref id="c9"><label>[9]</label><mixed-citation publication-type="journal"><string-name><given-names>S. K.</given-names> <surname>Longo</surname></string-name>, <string-name><given-names>M. G.</given-names> <surname>Guo</surname></string-name>, <string-name><given-names>A. L.</given-names> <surname>Ji</surname></string-name>, and <string-name><given-names>P. A.</given-names> <surname>Khavari</surname></string-name>, “<article-title>Integrating single-cell and spatial transcriptomics to elucidate intercellular tissue dynamics</article-title>,” <source>Nat. Rev. Genet</source>., vol. <volume>22</volume>, no. <issue>10</issue>, pp. <fpage>627</fpage>–<lpage>644</lpage>, <month>Oct</month>. <year>2021</year>, doi: <pub-id pub-id-type="doi">10.1038/s41576-021-00370-8</pub-id>.</mixed-citation></ref>
<ref id="c10"><label>[10]</label><mixed-citation publication-type="journal"><string-name><given-names>B.</given-names> <surname>Li</surname></string-name> <etal>et al.</etal>, “<article-title>Benchmarking spatial and single-cell transcriptomics integration methods for transcript distribution prediction and cell type deconvolution</article-title>,” <source>Nat. Methods</source>, vol. <volume>19</volume>, no. <issue>6</issue>, Art. no. <issue>6</issue>, <month>Jun</month>. <year>2022</year>, doi: <pub-id pub-id-type="doi">10.1038/s41592-022-01480-9</pub-id>.</mixed-citation></ref>
<ref id="c11"><label>[11]</label><mixed-citation publication-type="journal"><string-name><given-names>L.</given-names> <surname>Yan</surname></string-name> and <string-name><given-names>X.</given-names> <surname>Sun</surname></string-name>, “<article-title>Benchmarking and integration of methods for deconvoluting spatial transcriptomic data</article-title>,” <source>Bioinformatics</source>, vol. <volume>39</volume>, no. <issue>1</issue>, p. <fpage>btac805</fpage>, <month>Jan</month>. <year>2023</year>, doi: <pub-id pub-id-type="doi">10.1093/bioinformatics/btac805</pub-id>.</mixed-citation></ref>
<ref id="c12"><label>[12]</label><mixed-citation publication-type="other"><string-name><given-names>V.</given-names> <surname>Kleshchevnikov</surname></string-name> <etal>et al.</etal>, “<article-title>Comprehensive mapping of tissue cell architecture via integrated single cell and spatial transcriptomics</article-title>,” <source>bioRxiv</source>, p. 2020.11.15.378125, <month>Jan</month>. <year>2020</year>, doi: <pub-id pub-id-type="doi">10.1101/2020.11.15.378125</pub-id>.</mixed-citation></ref>
<ref id="c13"><label>[13]</label><mixed-citation publication-type="other"><string-name><given-names>R.</given-names> <surname>Lopez</surname></string-name> <etal>et al.</etal>, “<article-title>DestVI identifies continuums of cell types in spatial transcriptomics data</article-title>,” <source>Nat. Biotechnol</source>., <month>Apr</month>. <year>2022</year>, doi: <pub-id pub-id-type="doi">10.1038/s41587-022-01272-8</pub-id>.</mixed-citation></ref>
<ref id="c14"><label>[14]</label><mixed-citation publication-type="other"><string-name><given-names>Q.</given-names> <surname>Song</surname></string-name> and <string-name><given-names>J.</given-names> <surname>Su</surname></string-name>, “<article-title>DSTG: deconvoluting spatial transcriptomics data through graph-based artificial intelligence</article-title>,” <source>Brief. Bioinform</source>., <year>2021</year>, doi: <pub-id pub-id-type="doi">10.1093/bib/bbaa414</pub-id>.</mixed-citation></ref>
<ref id="c15"><label>[15]</label><mixed-citation publication-type="other"><string-name><given-names>D. M.</given-names> <surname>Cable</surname></string-name> <etal>et al.</etal>, “<article-title>Robust decomposition of cell type mixtures in spatial transcriptomics</article-title>,” <source>Nat. Biotechnol</source>., p. 2020.05.07.082750, <month>Feb</month>. <year>2021</year>, doi: <pub-id pub-id-type="doi">10.1038/s41587-021-00830-w</pub-id>.</mixed-citation></ref>
<ref id="c16"><label>[16]</label><mixed-citation publication-type="journal"><string-name><given-names>R.</given-names> <surname>Dong</surname></string-name> and <string-name><given-names>G.-C.</given-names> <surname>Yuan</surname></string-name>, “<article-title>SpatialDWLS: accurate deconvolution of spatial transcriptomic data</article-title>,” <source>Genome Biol</source>., vol. <volume>22</volume>, no. <issue>1</issue>, p. <fpage>145</fpage>, <month>Dec</month>. <year>2021</year>, doi: <pub-id pub-id-type="doi">10.1186/s13059-021-02362-7</pub-id>.</mixed-citation></ref>
<ref id="c17"><label>[17]</label><mixed-citation publication-type="other"><string-name><given-names>M.</given-names> <surname>Elosua-Bayes</surname></string-name>, <string-name><given-names>P.</given-names> <surname>Nieto</surname></string-name>, <string-name><given-names>E.</given-names> <surname>Mereu</surname></string-name>, <string-name><given-names>I.</given-names> <surname>Gut</surname></string-name>, and <string-name><given-names>H.</given-names> <surname>Heyn</surname></string-name>, “<article-title>SPOTlight: seeded NMF regression to deconvolute spatial transcriptomics spots with single-cell transcriptomes</article-title>,” <source>Nucleic Acids Res</source>., p. <fpage>2020</fpage>.06.03.131334, <month>Feb</month>. <year>2021</year>, doi: <pub-id pub-id-type="doi">10.1093/nar/gkab043</pub-id>.</mixed-citation></ref>
<ref id="c18"><label>[18]</label><mixed-citation publication-type="journal"><string-name><given-names>A.</given-names> <surname>Andersson</surname></string-name> <etal>et al.</etal>, “<article-title>Single-cell and spatial transcriptomics enables probabilistic inference of cell type topography</article-title>,” <source>Commun. Biol</source>., vol. <volume>3</volume>, no. <issue>1</issue>, pp. <fpage>1</fpage>–<lpage>8</lpage>, <year>2020</year>, doi: <pub-id pub-id-type="doi">10.1038/s42003-020-01247-y</pub-id>.</mixed-citation></ref>
<ref id="c19"><label>[19]</label><mixed-citation publication-type="journal"><string-name><given-names>D.</given-names> <surname>Sun</surname></string-name>, <string-name><given-names>Z.</given-names> <surname>Liu</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Li</surname></string-name>, <string-name><given-names>Q.</given-names> <surname>Wu</surname></string-name>, and <string-name><given-names>C.</given-names> <surname>Wang</surname></string-name>, “<article-title>STRIDE: accurately decomposing and integrating spatial transcriptomics using single-cell RNA sequencing</article-title>,” <source>Nucleic Acids Res</source>., vol. <volume>50</volume>, no. <issue>7</issue>, pp. <fpage>e42</fpage>–<lpage>e42</lpage>, <month>Apr</month>. <year>2022</year>, doi: <pub-id pub-id-type="doi">10.1093/nar/gkac150</pub-id>.</mixed-citation></ref>
<ref id="c20"><label>[20]</label><mixed-citation publication-type="journal"><string-name><given-names>X.</given-names> <surname>Wang</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Park</surname></string-name>, <string-name><given-names>K.</given-names> <surname>Susztak</surname></string-name>, <string-name><given-names>N. R.</given-names> <surname>Zhang</surname></string-name>, and <string-name><given-names>M.</given-names> <surname>Li</surname></string-name>, “<article-title>Bulk tissue cell type deconvolution with multi-subject single-cell expression reference</article-title>,” <source>Nat. Commun</source>., vol. <volume>10</volume>, no. <issue>1</issue>, p. <fpage>380</fpage>, <month>Dec</month>. <year>2019</year>, doi: <pub-id pub-id-type="doi">10.1038/s41467-018-08023-x</pub-id>.</mixed-citation></ref>
<ref id="c21"><label>[21]</label><mixed-citation publication-type="journal"><string-name><given-names>T.</given-names> <surname>Stuart</surname></string-name> <etal>et al.</etal>, “<article-title>Comprehensive Integration of Single-Cell Data</article-title>,” <source>Cell</source>, vol. <volume>177</volume>, no. <issue>7</issue>, pp. <fpage>1888</fpage>-<lpage>1902</lpage>.e21, <month>Jun</month>. <year>2019</year>, doi: <pub-id pub-id-type="doi">10.1016/j.cell.2019.05.031</pub-id>.</mixed-citation></ref>
<ref id="c22"><label>[22]</label><mixed-citation publication-type="journal"><string-name><given-names>T.</given-names> <surname>Biancalani</surname></string-name> <etal>et al.</etal>, “<article-title>Deep learning and alignment of spatially resolved single-cell transcriptomes with Tangram</article-title>,” <source>Nat. Methods</source>, vol. <volume>18</volume>, no. <issue>11</issue>, pp. <fpage>1352</fpage>–<lpage>1362</lpage>, <month>Nov</month>. <year>2021</year>, doi: <pub-id pub-id-type="doi">10.1038/s41592-021-01264-7</pub-id>.</mixed-citation></ref>
<ref id="c23"><label>[23]</label><mixed-citation publication-type="journal"><string-name><given-names>A.</given-names> <surname>Jindal</surname></string-name>, <string-name><given-names>P.</given-names> <surname>Gupta Jayadeva</surname></string-name>, and <string-name><given-names>D.</given-names> <surname>Sengupta</surname></string-name>, “<article-title>Discovery of rare cells from voluminous single cell expression data</article-title>,” <source>Nat. Commun</source>., vol. <volume>9</volume>, no. <issue>1</issue>, Art. no. <issue>1</issue>, <month>Nov</month>. <year>2018</year>, doi: <pub-id pub-id-type="doi">10.1038/s41467-018-07234-6</pub-id>.</mixed-citation></ref>
<ref id="c24"><label>[24]</label><mixed-citation publication-type="journal"><string-name><given-names>H. R.</given-names> <surname>Ali</surname></string-name>, <string-name><given-names>L.</given-names> <surname>Chlon</surname></string-name>, <string-name><given-names>P. D. P.</given-names> <surname>Pharoah</surname></string-name>, <string-name><given-names>F.</given-names> <surname>Markowetz</surname></string-name>, and <string-name><given-names>C.</given-names> <surname>Caldas</surname></string-name>, “<article-title>Patterns of Immune Infiltration in Breast Cancer and Their Clinical Implications: A Gene-Expression-Based Retrospective Study</article-title>,” <source>PLoS Med</source>., vol. <volume>13</volume>, no. <issue>12</issue>, pp. <fpage>1</fpage>–<lpage>24</lpage>, <year>2016</year>, doi: <pub-id pub-id-type="doi">10.1371/journal.pmed.1002194</pub-id>.</mixed-citation></ref>
<ref id="c25"><label>[25]</label><mixed-citation publication-type="journal"><string-name><given-names>E.</given-names> <surname>Sato</surname></string-name> <etal>et al.</etal>, “<article-title>Intraepithelial CD8+ tumor-infiltrating lymphocytes and a high CD8+/regulatory T cell ratio are associated with favorable prognosis in ovarian cancer</article-title>,” <source>Proc. Natl. Acad. Sci</source>., vol. <volume>102</volume>, no. <issue>51</issue>, pp. <fpage>18538</fpage>–<lpage>18543</lpage>, <month>Dec</month>. <year>2005</year>, doi: <pub-id pub-id-type="doi">10.1073/pnas.0509182102</pub-id>.</mixed-citation></ref>
<ref id="c26"><label>[26]</label><mixed-citation publication-type="journal"><string-name><given-names>F.</given-names> <surname>Vallania</surname></string-name> <etal>et al.</etal>, “<article-title>Leveraging heterogeneity across multiple datasets increases cell-mixture deconvolution accuracy and reduces biological and technical biases</article-title>,” <source>Nat. Commun</source>., vol. <volume>9</volume>, no. <issue>1</issue>, p. <fpage>4735</fpage>, <month>Dec</month>. <year>2018</year>, doi: <pub-id pub-id-type="doi">10.1038/s41467-018-07242-6</pub-id>.</mixed-citation></ref>
<ref id="c27"><label>[27]</label><mixed-citation publication-type="journal"><string-name><given-names>Z.</given-names> <surname>Yao</surname></string-name> <etal>et al.</etal>, “<article-title>A taxonomy of transcriptomic cell types across the isocortex and hippocampal formation</article-title>,” <source>Cell</source>, vol. <volume>184</volume>, no. <issue>12</issue>, pp. <fpage>3222</fpage>-<lpage>3241</lpage>.e26, <month>Jun</month>. <year>2021</year>, doi: <pub-id pub-id-type="doi">10.1016/j.cell.2021.04.021</pub-id>.</mixed-citation></ref>
<ref id="c28"><label>[28]</label><mixed-citation publication-type="journal"><string-name><given-names>M.</given-names> <surname>Guilliams</surname></string-name> <etal>et al.</etal>, “<article-title>Spatial proteogenomics reveals distinct and evolutionarily conserved hepatic macrophage niches</article-title>,” <source>Cell</source>, vol. <volume>185</volume>, no. <issue>2</issue>, pp. <fpage>379</fpage>-<lpage>396</lpage>.e38, <month>Jan</month>. <year>2022</year>, doi: <pub-id pub-id-type="doi">10.1016/j.cell.2021.12.018</pub-id>.</mixed-citation></ref>
<ref id="c29"><label>[29]</label><mixed-citation publication-type="journal"><string-name><given-names>P.</given-names> <surname>Di Tommaso</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Chatzou</surname></string-name>, <string-name><given-names>E. W.</given-names> <surname>Floden</surname></string-name>, <string-name><given-names>P. P.</given-names> <surname>Barja</surname></string-name>, <string-name><given-names>E.</given-names> <surname>Palumbo</surname></string-name>, and <string-name><given-names>C.</given-names> <surname>Notredame</surname></string-name>, “<article-title>Nextflow enables reproducible computational workflows</article-title>,” <source>Nat. Biotechnol</source>., vol. <volume>35</volume>, no. <issue>4</issue>, pp. <fpage>316</fpage>–<lpage>319</lpage>, <month>Apr</month>. <year>2017</year>, doi: <pub-id pub-id-type="doi">10.1038/nbt.3820</pub-id>.</mixed-citation></ref>
<ref id="c30"><label>[30]</label><mixed-citation publication-type="journal"><string-name><given-names>B.</given-names> <surname>Tasic</surname></string-name> <etal>et al.</etal>, “<article-title>Adult mouse cortical cell taxonomy revealed by single cell transcriptomics</article-title>,” <source>Nat. Neurosci</source>., vol. <volume>19</volume>, no. <issue>2</issue>, pp. <fpage>335</fpage>–<lpage>346</lpage>, <month>Feb</month>. <year>2016</year>, doi: <pub-id pub-id-type="doi">10.1038/nn.4216</pub-id>.</mixed-citation></ref>
<ref id="c31"><label>[31]</label><mixed-citation publication-type="other"><string-name><given-names>J.</given-names> <surname>Davis</surname></string-name> and <string-name><given-names>M.</given-names> <surname>Goadrich</surname></string-name>, “<article-title>The relationship between Precision-Recall and ROC curves</article-title>,” <source>in Proceedings of the 23rd international conference on Machine learning</source>, <year>2006</year>, pp. <fpage>233</fpage>–<lpage>240</lpage>.</mixed-citation></ref>
<ref id="c32"><label>[32]</label><mixed-citation publication-type="journal"><string-name><given-names>T.</given-names> <surname>Saito</surname></string-name> and <string-name><given-names>M.</given-names> <surname>Rehmsmeier</surname></string-name>, “<article-title>Precrec: fast and accurate precision-recall and ROC curve calculations in R</article-title>,” <source>Bioinformatics</source>, vol. <volume>33</volume> (<issue>1</issue>), pp. <fpage>145</fpage>–<lpage>147</lpage>, <year>2017</year>, doi: <pub-id pub-id-type="doi">10.1093/bioinformatics/btw570</pub-id>.</mixed-citation></ref>
<ref id="c33"><label>[33]</label><mixed-citation publication-type="journal"><string-name><given-names>H.-G.</given-names> <surname>Drost</surname></string-name>, “<article-title>Philentropy: Information Theory and Distance Quantification with R</article-title>,” <source>J. Open Source Softw</source>., vol. <volume>3</volume>, no. <issue>26</issue>, p. <fpage>765</fpage>, <month>Jun</month>. <year>2018</year>, doi: <pub-id pub-id-type="doi">10.21105/joss.00765</pub-id>.</mixed-citation></ref>
</ref-list>
</back>
<sub-article id="sa0" article-type="editor-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.88431.1.sa3</article-id>
<title-group>
<article-title>eLife Assessment</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<name>
<surname>Pinello</surname>
<given-names>Luca</given-names>
</name>
<role specific-use="editor">Reviewing Editor</role>
<aff>
<institution-wrap>
<institution>Massachusetts General Hospital</institution>
</institution-wrap>
<city>Boston</city>
<country>United States of America</country>
</aff>
</contrib>
</contrib-group>
<kwd-group kwd-group-type="evidence-strength">
<kwd>Solid</kwd>
</kwd-group>
<kwd-group kwd-group-type="claim-importance">
<kwd>Useful</kwd>
</kwd-group>
</front-stub>
<body>
<p>This study presents a comprehensive benchmarking approach, reviewing existing cell-type deconvolution methods in spatial transcriptomics. The authors not only assess these methods across various datasets but also successfully establish a reliable framework for their evaluation, notably highlighting RCTD and Cell2location for their performance. By implementing a full Nextflow pipeline, Docker containers, and a rigorous assessment of the simulator, this work offers robust insights that elevate the standards for future evaluations and provides a <bold>useful</bold> resource for those seeking to improve or develop new deconvolution methods. The thorough comparison and analysis of methods, coupled with a strong emphasis on reproducibility, provide <bold>solid</bold> support for the findings.</p>
</body>
</sub-article>
<sub-article id="sa1" article-type="referee-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.88431.1.sa2</article-id>
<title-group>
<article-title>Reviewer #1 (Public Review):</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<anonymous/>
<role specific-use="referee">Reviewer</role>
</contrib>
</contrib-group>
</front-stub>
<body>
<p>Cell type deconvolution is one of the early and critical steps in the analysis and integration of spatial omic and single cell gene expression datasets, and there are already many approaches proposed for the analysis. Sang-aram et al. provide an up-to-date benchmark of computational methods for cell type deconvolution.</p>
<p>In doing so, they provide some (perhaps subtle) additional elements that I would say are above the average for a benchmarking study: i) a full Nextflow pipeline to reproduce their analyses; ii) methods implemented in Docker containers (which can be used by others to run their datasets); iii) a fairly decent assessment of their simulator compared to other spatial omics simulators. A key aspect of their results is that they are generally very concordant between real and synthetic datasets. And, it is important that the authors include an appropriate &quot;simpler&quot; baseline method to compare against and surprisingly, several methods performed below this baseline. Overall, this study also has the potential to also set the standard of benchmarks higher, because of these mentioned elements.</p>
<p>The only weakness of this study that I can readily see is that this is a very active area of research and we may see other types of data start to dominate (CosMx, Xenium) and new computational approaches will surely arrive. The Nextflow pipeline will make the prospect of including new reference datasets and new computational methods easier.</p>
</body>
</sub-article>
<sub-article id="sa2" article-type="referee-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.88431.1.sa1</article-id>
<title-group>
<article-title>Reviewer #2 (Public Review):</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<anonymous/>
<role specific-use="referee">Reviewer</role>
</contrib>
</contrib-group>
</front-stub>
<body>
<p>In this manuscript Sangaram et al provide a systematic methodology and pipeline for benchmarking cell type deconvolution algorithms for spatial transcriptomic data analysis in a reproducible manner. They developed a tissue pattern simulator that starts from single-cell RNA-seq data to create silver standards and used spatial aggregation strategies from real in situ-based spatial technologies to obtain gold standards. By using several established metrics combined with different deconvolution challenges they systematically scored and ranked 11 deconvolution methods and assessed both functional and usability criteria. Altogether, they present a reusable and extendable platform and reach very similar conclusions to other deconvolution benchmarking paper, including that RCTD, SpatialDWLS and Cell2location typically provide the best results.</p>
<p>More specifically, the authors of this study sought to construct a methodology for benchmarking cell type deconvolution algorithms for spatial transcriptomic data analysis in a reproducible manner. The authors leveraged publicly available scRNA-seq, seqFISH, and STARMap datasets to create synthetic spatial datasets modeled after that of the Visium platform. It should be noted that the underlying experimental techniques of seqFISH and STARMap (in situ hybridization) do not parallel that of Visium (sequencing), which could bias simulated data. Furthermore, to generate the ground truth datasets cells and their corresponding count matrix are represented by simple centroids. Although this simplifies the analysis it might not necessarily accurately reflect Visium spots where cells could lie on a boundary and affect deconvolution results. On the other hand, the authors state that in silver standard datasets one half of the scRNA-seq data was used for simulation and the other half was used as a reference for the algorithms, but the method of splitting the data, i.e., at random or proportionally by cell type, was not specified. Supplying optimal reference data is important to achieve best performance, as the authors note in their conclusions.</p>
<p>The authors thoroughly and rigorously compare methods while addressing situational discrepancies in model performance, indicative of a strong analysis. The authors make a point to address both inter- and intra- dataset reference handling, which has a significant impact on performance. Major strengths of the simulation engine include the ability to downsample and recapitulate several cell and tissue organization patterns.</p>
<p>It's important to realize that deconvolution approaches are typically part of larger exploratory data analysis (EDA) efforts and require users to change parameters and input data multiple times. Furthermore, many users might not have access to more advanced computing infrastructure (e.g. GPU) and thus running time, computing needs, and scalability are probably key factors that researchers would like to consider when looking to deconvolve their datasets.</p>
<p>The authors achieve their aim to benchmark different deconvolution methods and the results from their thorough analysis support the conclusions that many methods are still outperformed by bulk deconvolution methods. This study further informs the need for cell type deconvolution algorithms that can handle both cell abundance and rarity throughout a given tissue sample.</p>
<p>The reproducibility of the methods described will have significant utility for researchers looking to develop cell type deconvolution algorithms, as this platform will allow simultaneous replication of the described analysis and comparison to new methods.</p>
</body>
</sub-article>
<sub-article id="sa3" article-type="referee-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.88431.1.sa0</article-id>
<title-group>
<article-title>Reviewer #3 (Public Review):</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<anonymous/>
<role specific-use="referee">Reviewer</role>
</contrib>
</contrib-group>
</front-stub>
<body>
<p>The authors thoroughly evaluate the performance and scalability of existing cell-type deconvolution methods. The paper builds on the existing knowledge by considering the suitability of deconvolution algorithms in the context of more challenging analyses where rare cell types are present or when dealing with unmatched references or noise introduced by a highly abundant cell type within the data. The paper also presents a new simulation framework for spatial transcriptomics data to support their benchmarking effort.</p>
<p>● Major strengths and weaknesses of the methods and results.</p>
<p>While most of the benchmarking studies rely on publicly available spatial transcriptomics datasets, one of the major strengths of the paper is the additional evidence support from their silver standard datasets. Leveraging computational processes synthspot, the authors generated abundant synthetic spatial transcriptomics data with replicates. In addition, the data generation process also accounts for 9 different biological patterns to stay close to real data quality. The authors also communicated with the original authors of each benchmarked method to ensure correct implementation and optimal performance. Figure 2 provides a clear and concise summary of the benchmark results, which will be of great assistance to users who are contemplating conducting deconvolution analysis.</p>
<p>The simulation setup has a significant weakness in the selection of reference single-cell RNAseq datasets used for generating synthetic spots. It is unclear why a mix of mouse and human scRNA-seq datasets were chosen, as this does not reflect a realistic biological scenario. This could call into question the findings of the &quot;detecting rare cell types remains challenging even for top-performing methods&quot; section of the paper, as the true &quot;rare cell types&quot; would not be as distinct as human skin cells in a mouse brain setting as simulated here. Furthermore, it is unclear why the authors developed Synthspot when other similar frameworks, such as SRTsim, exist. Have the authors explored other simulation frameworks? Finally, we would have appreciated the inclusion of tissue samples with more complex structures, such as those from tumors, where there may be more intricate mixing between cell types and spot types.</p>
<p>The authors have effectively accomplished their objectives in benchmarking deconvolution methods by thoughtfully designing the experiments and selecting appropriate evaluation metrics. This paper will be highly beneficial for the community.</p>
<p>This paper can provide guidance for selecting the most proper deconvolution methods under user-decided scenarios of the interests. Synthspot, allows for generating more realistic artificial tissue data with specific spatial patterns and is integrated as part of an easy-to-use and adaptable Nextflow pipeline. It might be worthwhile to clearly differentiate this work from previous work either in the benchmarking area or SRT data simulation area.</p>
</body>
</sub-article>
<sub-article id="sa4" article-type="author-comment">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.88431.1.sa4</article-id>
<title-group>
<article-title>Author Response:</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<name>
<surname>Sang-aram</surname>
<given-names>Chananchida</given-names>
</name>
<role specific-use="author">Author</role>
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-0922-0822</contrib-id></contrib>
<contrib contrib-type="author">
<name>
<surname>Browaeys</surname>
<given-names>Robin</given-names>
</name>
<role specific-use="author">Author</role>
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-2934-5195</contrib-id></contrib>
<contrib contrib-type="author">
<name>
<surname>Seurinck</surname>
<given-names>Ruth</given-names>
</name>
<role specific-use="author">Author</role>
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-6636-7572</contrib-id></contrib>
<contrib contrib-type="author">
<name>
<surname>Saeys</surname>
<given-names>Yvan</given-names>
</name>
<role specific-use="author">Author</role>
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-0415-1506</contrib-id></contrib>
</contrib-group>
</front-stub>
<body>
<p>We thank the reviewers for the constructive feedback and detailed reviews. To avoid any misunderstandings, we would like to add the following clarification. The comments from Reviewer 3 seem to indicate that in our simulator, synthspot, we mix cells from different data sets and even different species to create synthetic spots. The comment is the following:</p>
<disp-quote content-type="editor-comment">
<p>The choice to blend mouse and human scRNA-seq datasets in the simulation setup for generating synthetic spots is not ideal due to its departure from a realistic biological scenario.</p>
</disp-quote>
<p>We would like to point out that the synthetic spots we create for the silver standard data sets are always sampled from the same scRNAseq or snRNAseq data set to keep the simulations as biologically plausible as possible.</p>
<p>For each of the 6 public data sets, we create 9 different synthetic data sets, resulting in a total of 54 synthetic data sets. Each of these 9 data sets correspond to a different abundance pattern with spots representing combinations of cells sampled from this same public data set. Hence, these synthetic data sets always reflect cell types that actually co-occur in the tissue sections used to generate the underlying public scRNAseq or snRNAseq data set.</p>
</body>
</sub-article>
</article>