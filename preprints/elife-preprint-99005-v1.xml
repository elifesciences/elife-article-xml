<?xml version="1.0" ?><!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.3 20210610//EN"  "JATS-archivearticle1-mathml3.dtd"><article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.3" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="nlm-ta">elife</journal-id>
<journal-id journal-id-type="publisher-id">eLife</journal-id>
<journal-title-group>
<journal-title>eLife</journal-title>
</journal-title-group>
<issn publication-format="electronic" pub-type="epub">2050-084X</issn>
<publisher>
<publisher-name>eLife Sciences Publications, Ltd</publisher-name>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">99005</article-id>
<article-id pub-id-type="doi">10.7554/eLife.99005</article-id>
<article-id pub-id-type="doi" specific-use="version">10.7554/eLife.99005.1</article-id>
<article-version-alternatives>
<article-version article-version-type="publication-state">reviewed preprint</article-version>
<article-version article-version-type="preprint-version">1.1</article-version>
</article-version-alternatives>
<article-categories>
<subj-group subj-group-type="heading">
<subject>Neuroscience</subject>
</subj-group>
<subj-group subj-group-type="heading">
<subject>Computational and Systems Biology</subject>
</subj-group>
</article-categories>
<title-group>
<article-title>Sensorimotor delays constrain robust locomotion in a 3D kinematic model of fly walking</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" equal-contrib="yes">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-6244-8239</contrib-id>
<name>
<surname>Karashchuk</surname>
<given-names>Lili</given-names>
</name>
<xref ref-type="aff" rid="a1">1</xref>
<xref ref-type="author-notes" rid="n1">*</xref>
</contrib>
<contrib contrib-type="author" equal-contrib="yes">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-4931-8709</contrib-id>
<name>
<surname>Li</surname>
<given-names>Jing Shuang (Lisa)</given-names>
</name>
<xref ref-type="aff" rid="a2">2</xref>
<xref ref-type="author-notes" rid="n1">*</xref>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0009-0001-3003-2631</contrib-id>
<name>
<surname>Chou</surname>
<given-names>Grant M</given-names>
</name>
<xref ref-type="aff" rid="a4">4</xref>
</contrib>
<contrib contrib-type="author">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-6995-2681</contrib-id>
<name>
<surname>Walling-Bell</surname>
<given-names>Sarah</given-names>
</name>
<xref ref-type="aff" rid="a4">4</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Brunton</surname>
<given-names>Steven L</given-names>
</name>
<xref ref-type="aff" rid="a3">3</xref>
</contrib>
<contrib contrib-type="author" corresp="yes">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-5689-5806</contrib-id>
<name>
<surname>Tuthill</surname>
<given-names>John C</given-names>
</name>
<xref ref-type="aff" rid="a4">4</xref>
<xref ref-type="corresp" rid="cor1">†</xref>
</contrib>
<contrib contrib-type="author" corresp="yes">
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-4831-3466</contrib-id>
<name>
<surname>Brunton</surname>
<given-names>Bingni W</given-names>
</name>
<xref ref-type="aff" rid="a5">5</xref>
<xref ref-type="corresp" rid="cor1">†</xref>
</contrib>
<aff id="a1"><label>1</label><institution>Neuroscience Graduate Program, University of Washington</institution>, <city>Seattle</city>, <country>United States</country></aff>
<aff id="a2"><label>2</label><institution>Dept of Electrical Engineering and Computer Science, University of Michigan</institution>, <city>Ann Arbor</city>, <country>United States</country></aff>
<aff id="a3"><label>3</label><institution>Dept of Mechanical Engineering, University of Washington</institution>, <city>Seattle</city>, <country>United States</country></aff>
<aff id="a4"><label>4</label><institution>Dept of Physiology &amp; Biophysics, University of Washington</institution>, <city>Seattle</city>, <country>United States</country></aff>
<aff id="a5"><label>5</label><institution>Dept of Biology, University of Washington</institution>, <city>Seattle</city>, <country>United States</country></aff>
</contrib-group>
<contrib-group content-type="section">
<contrib contrib-type="editor">
<name>
<surname>Salinas</surname>
<given-names>Emilio</given-names>
</name>
<role>Reviewing Editor</role>
<aff>
<institution-wrap>
<institution>Wake Forest University School of Medicine</institution>
</institution-wrap>
<city>Winston-Salem</city>
<country>United States of America</country>
</aff>
</contrib>
<contrib contrib-type="senior_editor">
<name>
<surname>Cardona</surname>
<given-names>Albert</given-names>
</name>
<role>Senior Editor</role>
<aff>
<institution-wrap>
<institution>University of Cambridge</institution>
</institution-wrap>
<city>Cambridge</city>
<country>United Kingdom</country>
</aff>
</contrib>
</contrib-group>
<author-notes>
<corresp id="cor1"><label>†</label>Senior, corresponding authors: <email>bbrunton@uw.edu</email>, <email>tuthill@uw.edu</email></corresp>
<fn id="n1" fn-type="equal"><label>*</label><p>These authors contributed equally to this work</p></fn>
</author-notes>
<pub-date date-type="original-publication" iso-8601-date="2024-08-27">
<day>27</day>
<month>08</month>
<year>2024</year>
</pub-date>
<volume>13</volume>
<elocation-id>RP99005</elocation-id>
<history>
<date date-type="sent-for-review" iso-8601-date="2024-05-03">
<day>03</day>
<month>05</month>
<year>2024</year>
</date>
</history>
<pub-history>
<event>
<event-desc>Preprint posted</event-desc>
<date date-type="preprint" iso-8601-date="2024-04-22">
<day>22</day>
<month>04</month>
<year>2024</year>
</date>
<self-uri content-type="preprint" xlink:href="https://doi.org/10.1101/2024.04.18.589965"/>
</event>
</pub-history>
<permissions>
<copyright-statement>© 2024, Karashchuk et al</copyright-statement>
<copyright-year>2024</copyright-year>
<copyright-holder>Karashchuk et al</copyright-holder>
<ali:free_to_read/>
<license xlink:href="https://creativecommons.org/licenses/by/4.0/">
<ali:license_ref>https://creativecommons.org/licenses/by/4.0/</ali:license_ref>
<license-p>This article is distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution License</ext-link>, which permits unrestricted use and redistribution provided that the original author and source are credited.</license-p>
</license>
</permissions>
<self-uri content-type="pdf" xlink:href="elife-preprint-99005-v1.pdf"/>
<abstract>
<title>Abstract</title>
<p>Walking animals must maintain stability in the presence of external perturbations, despite significant temporal delays in neural signaling and muscle actuation. Here, we develop a 3D kinematic model with a layered control architecture to investigate how sensorimotor delays constrain robustness of walking behavior in the fruit fly, <italic>Drosophila</italic>. Motivated by the anatomical architecture of insect locomotor control circuits, our model consists of three component layers: a neural network that generates realistic 3D joint kinematics for each leg, an optimal controller that executes the joint kinematics while accounting for delays, and an inter-leg coordinator. The model generates realistic simulated walking that matches real fly walking kinematics and sustains walking even when subjected to unexpected perturbations, generalizing beyond its training data. However, we found that the model’s robustness to perturbations deteriorates when sensorimotor delay parameters exceed the physiological range. These results suggest that fly sensorimotor control circuits operate close to the temporal limit at which they can detect and respond to external perturbations. More broadly, we show how a modular, layered model architecture can be used to investigate physiological constraints on animal behavior.</p>
</abstract>
</article-meta>
<notes>
<notes notes-type="competing-interest-statement">
<title>Competing Interest Statement</title><p>The authors have declared no competing interest.</p></notes>
</notes>
</front>
<body>
<sec id="s1">
<label>1</label>
<title>Introduction</title>
<p>Animals as diverse as tardigrades (<xref ref-type="bibr" rid="c55">Nirody et al., 2021</xref>) and tapirs (<xref ref-type="bibr" rid="c18">Catavitello et al., 2018</xref>) use interlimb coordination to walk through complex terrain. When a walking animal encounters an unexpected perturbation (e.g., it is pushed or tripped), its ability to recover and sustain locomotion can be a matter of life and death. However, the presence of significant temporal delays in animal sensorimotor systems establish fundamental limits on how quickly animals can respond to external perturbations (<xref ref-type="bibr" rid="c53">More and Donelan, 2018</xref>). Sources of temporal delay include neural conduction (<xref ref-type="bibr" rid="c69">Sterling and Laughlin, 2015</xref>), synaptic transmission (<xref ref-type="bibr" rid="c62">Sabatini and Regehr, 1999</xref>), and electromechanical muscle activation (<xref ref-type="bibr" rid="c59">Pringle, 1978</xref>; <xref ref-type="bibr" rid="c3">Akiyama et al., 2010</xref>).</p>
<p>Sensorimotor delays pose a particular challenge for systems that rely on feedback control, because they limit the availability of up-to-date information on the state of the external environment (<xref ref-type="bibr" rid="c33">Franklin and Wolpert, 2011</xref>). For example, time delays limit robust performance in feedback control systems (<xref ref-type="bibr" rid="c32">Doyle et al., 2013</xref>), with model predictive control (MPC) (<xref ref-type="bibr" rid="c35">Garcia et al., 1989</xref>; <xref ref-type="bibr" rid="c17">Camacho and Alba, 2013</xref>; <xref ref-type="bibr" rid="c15">Brunton and Kutz, 2022</xref>) providing one algorithmic strategy to improve performance while maintaining robustness. In biological systems, theoretical studies suggest that some animals use predictive internal models to mitigate the effect of delays (<xref ref-type="bibr" rid="c53">More and Donelan, 2018</xref>; <xref ref-type="bibr" rid="c48">Li et al., 2023</xref>; <xref ref-type="bibr" rid="c30">Desmurget and Grafton, 2000</xref>). Limb compliance and other biomechanical adaptations can also compensate for unexpected perturbations within a limited range and mitigate the effect of sensorimotor delays (<xref ref-type="bibr" rid="c25">Daley, 2018</xref>; <xref ref-type="bibr" rid="c6">Ashtiani et al., 2021</xref>). However, the constraints that sensorimotor delays impose on robust locomotion have been difficult to quantify, because it is experimentally challenging to manipulate sensorimotor delays and observe their effects on animal locomotion (although this has been achieved in other motor systems, for example using focal cooling in singing birds (<xref ref-type="bibr" rid="c12">Banerjee et al., 2021</xref>)). Computational models of locomotion do not typically include delay as a tunable parameter, and most existing models of walking cannot sustain locomotion in the presence of delays and external perturbations.</p>
<p>Flies are agile, robust walkers, and the availability of genetic and behavioral tools in <italic>Drosophila</italic> makes them well-suited for investigating neural mechanisms of locomotor control (<xref ref-type="bibr" rid="c29">Deangelis et al., 2019</xref>; <xref ref-type="bibr" rid="c39">Goncalves et al., 2022</xref>; <xref ref-type="bibr" rid="c24">Cruz and Chiappe, 2023</xref>). The fly is also the only walking animal whose nervous system is almost completely mapped at synaptic resolution (<xref ref-type="bibr" rid="c34">Galili et al., 2022</xref>). Flies walk rhythmically with a continuum of stepping patterns that range from tetrapod (where two of six legs lift off the ground at a time) to tripod (three of six legs alternately lift off at a time) (<xref ref-type="bibr" rid="c29">Deangelis et al., 2019</xref>; <xref ref-type="bibr" rid="c52">Mendes et al., 2013</xref>; <xref ref-type="bibr" rid="c72">Szczecinski et al., 2018</xref>; <xref ref-type="bibr" rid="c80">Wosnitza et al., 2013</xref>; <xref ref-type="bibr" rid="c70">Strauss and Heisenberg, 1990</xref>; <xref ref-type="bibr" rid="c56">Nishii, 2000</xref>; <xref ref-type="bibr" rid="c58">Pratt et al., 2024</xref>). Each fly leg has five joints that move through 7 mechanical degrees of freedom (<xref ref-type="bibr" rid="c43">Karashchuk et al., 2021</xref>; <xref ref-type="bibr" rid="c49">Lobato-Rios et al., 2022</xref>) and are actuated by ∼18 muscles that are innervated by ∼70 motor neurons (<xref ref-type="bibr" rid="c10">Azevedo et al., 2022</xref>). Each leg motor neuron is uniquely identifiable (<xref ref-type="bibr" rid="c10">Azevedo et al., 2022</xref>) and receives thousands of synaptic inputs from hundreds of unique premotor neurons within the fly’s ventral nerve cord (VNC, <xref ref-type="bibr" rid="c47">Lesser et al. (2023)</xref>; <xref ref-type="bibr" rid="c19">Cheong et al. (2023)</xref>), a part of the invertebrate nervous system analogous to the vertebrate spinal cord. The architectural features of <italic>Drosophila</italic> locomotor control — joints, leg motor neurons, VNC — motivate the architecture of our proposed model.</p>
<p>Past models of insect multi-legged walking have taken three general approaches. The first approach models legs as coupled oscillators or inverted pendula without taking into account the mechanics of leg joints. Each leg is a single oscillator, and a network of oscillators is tuned to recreate oscillatory gait from measurements of foot falls (<xref ref-type="bibr" rid="c23">Couzin-Fuchs et al., 2015</xref>; <xref ref-type="bibr" rid="c60">Proctor and Holmes, 2018</xref>); alternatively, tripod gaits are approximated by spring-loaded inverted pendula (<xref ref-type="bibr" rid="c21">Chun et al., 2021</xref>). The second approach focuses on physical details of the legs and its joints. <xref ref-type="bibr" rid="c63">Schilling et al. (2013)</xref> uses a decentralized reactive controller to recreate hexapod walking patterns; <xref ref-type="bibr" rid="c37">Goldsmith et al. (2019)</xref> and <xref ref-type="bibr" rid="c38">Goldsmith et al. (2020)</xref> introduce a robotic platform; <xref ref-type="bibr" rid="c49">Lobato-Rios et al. (2022)</xref>, <xref ref-type="bibr" rid="c79">Wang-Chen et al. (2023)</xref>, and <xref ref-type="bibr" rid="c77">Vaxenburg et al. (2024)</xref> develop virtual fly simulations in a physics engine. Walking behavior in these models are also driven by coupled oscillators with tuned parameters that reproduce inter-leg coordination patterns; however, the underlying joint kinematics are typically unrealistic. The third approach uses normative learning and optimization to generate walking behaviors <italic>de novo</italic> — <xref ref-type="bibr" rid="c61">Ramdya et al. (2017)</xref> maximized fly walking speed by varying inter-leg coordination with a genetic algorithm, whereas (<xref ref-type="bibr" rid="c40">Heess et al., 2017</xref>) maximize walking speed in both bipedal and quadruped walkers with reinforcement learning. Normative models produce walking with varying degrees of realism, but they require clever selection of objectives with constraints and are computationally expensive. Further, any change in delay values would necessitate a computationally intensive retraining process. Notably, <xref ref-type="bibr" rid="c36">Geijtenbeek et al. (2013)</xref> include fixed sensorimotor delays in a bipedal model, but do not explore the effect of varying delay values. Overall, existing walking models offer kinematic or physiological accuracy, but few achieve both, and none consider the effect of varying sensorimotor delays.</p>
<p>Here, we develop a new model of fly walking with several key innovations. First, the model is trained on high-resolution 3D joint angle data from walking flies, which has only recently become possible due to new deep-learning based computer vision tools (<xref ref-type="bibr" rid="c43">Karashchuk et al., 2021</xref>). Second, the model’s multi-layered architecture achieves more than the sum of its parts: specifically, a neural network model recapitulates kinematic coordination of many joints, and an optimal controller allows the data-driven model to generalize to new scenarios (e.g. large delays and perturbations) without retraining. Third, the inclusion of delay as a tunable parameter allows us to systematically investigate the quantitative relationships between sensorimotor delays and robust walking. Fourth, we introduce a new method to quantitatively compare the kinematic similarity of real and simulated walking. Overall, these analyses suggest that neuromuscular delays limit how fast flies can walk while retaining robustness to unexpected perturbations. They also illustrate a general approach of using <italic>in silico</italic> experiments in virtual animals to investigate how fundamental physiological parameters constrain animal behavior.</p>
</sec>
<sec id="s2">
<label>2</label>
<title>Results</title>
<sec id="s2a">
<label>2.1</label>
<title>A kinematic model of fly walking that incorporates delays and accommodates perturbations</title>
<p>We designed a walking model with three functional layers (<xref rid="fig1" ref-type="fig">Fig. 1B</xref>), inspired by the hierarchical anatomical organization of the fly nervous system (<xref rid="fig1" ref-type="fig">Fig. 1A</xref>, <xref ref-type="bibr" rid="c27">Dallmann et al. (2021)</xref>). The three layers are an inter-leg <italic>phase coordinator</italic>, a <italic>trajectory generator</italic>, and an <italic>optimal controller</italic> that interfaces with a leg dynamics model. Each individual leg is modular and governed by its own dynamics, optimal controller, and trajectory generator. Inter-leg coordination is accomplished by the phase coordinator alone. In other words, the movement of each leg is not coupled to any other leg except through the phase of its current step cycle. This modularity is inspired by the segmental neuroanatomy of the VNC, in which each leg is controlled by distinct local premotor circuits and pools of motor neurons (<xref ref-type="bibr" rid="c47">Lesser et al., 2023</xref>; <xref ref-type="bibr" rid="c19">Cheong et al., 2023</xref>).</p>
<fig id="fig1" position="float" fig-type="figure">
<label>Figure 1.</label>
<caption><title>A layered model of fly walking that incorporates link-and-joint dynamics and sensorimotor delays.</title>
<p><bold>(A)</bold> The neural systems that control walking are hierarchically organized. The brain sends high-level commands (e.g. walking speed and direction) to the ventral nerve cord (VNC). Approximately 70 motor neurons (MNs, <xref ref-type="bibr" rid="c10">Azevedo et al. (2022)</xref>) control each leg. The cell bodies and dendrites of the MNs are in the VNC, and their axons innervate muscles in the leg. Each leg muscle is actuated, after some delay, following activation by one or more motor neurons. Sensorimotor circuits in the VNC also receive delayed sensory feedback via proprioceptors. <bold>(B)</bold> Multi-layered walking model architecture. Body-world interactions are mediated by a dynamics model. Proprioceptive feedback consists of joint angles and angular velocities (<xref ref-type="bibr" rid="c51">Mamiya et al., 2018</xref>). Each leg has an optimal controller operating at 600 Hz that interfaces with the dynamics model and a trajectory generator that generates realistic kinematics. The trajectory generator is learned from data and operates at 300 Hz. It interfaces with the phase coordinator, a Kuramoto oscillator that maintains inter-leg coupling. The trajectory generator and optimal controller mimic local circuits within each leg, so they do not interact with other legs. Phase coupling is the only information shared between all legs. <bold>(C)</bold> Dynamics model of a fly leg, derived from link-and-joint models and Euler-Lagrange equations. <bold>(D)</bold> Schematic of model training and execution process. Model parameters for each module are tuned independently, then the modules are assembled to generate walking with delays and in response to unexpected perturbations.</p></caption>
<graphic xlink:href="589965v1_fig1.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
<p>Each layer in the model is an abstraction for the layer below it, such that various elements of walking (e.g. joint control, inter-leg coordination) can be integrated through modules. Below, we describe each modular component of our model; more details on its derivation and implementation are elaborated in the Methods and Materials and Appendices. Although the model can turn and side-step, our analysis focuses on forward-walking — the model is driving the fly to walk straight in all simulations, unless otherwise stated.</p>
<sec id="s2a1">
<label>2.1.1</label>
<title>Inter-leg phase coordinator</title>
<p>To coordinate multi-legged walking, we modeled the step phase of each leg as an oscillator. We refer to the left and right legs as L1–3 and R1–3, respectively, where the front legs are L1 and R1. The phase coupling of the six leg oscillators establishes realistic inter-leg coordination. We use a Kuramoto oscillator model (Acebró <xref ref-type="bibr" rid="c2">n et al., 2005</xref>; <xref ref-type="bibr" rid="c71">Strogatz, 2000</xref>) to perform this coordination, as in <xref ref-type="bibr" rid="c60">Proctor and Holmes (2018)</xref>; equations and implementation details are in Methods and Materials. Briefly, the phase coordinator takes the instantaneous phases <italic>ϕ</italic> from all legs as input, then outputs the desired phases <italic>ϕ</italic><sub><italic>d</italic></sub> to all legs. These desired phases are synchronized across pairs of legs to maintain a tripod coordination pattern, even when subject to unpredictable perturbations. The phase coupling coefficient among legs is estimated from measured 3D joint kinematics of walking flies (<xref ref-type="bibr" rid="c43">Karashchuk et al., 2021</xref>). Without the phase coordinator, individual trajectory generators would generate realistic kinematics for each leg, but they would not be coordinated with each other.</p>
</sec>
<sec id="s2a2">
<label>2.1.2</label>
<title>Joint kinematics trajectory generator</title>
<p>The trajectory generator layer is responsible for producing realistic 3D joint kinematics of each leg. To express the relationships among all leg joint angles, we use an artificial neural network trained to generate angle trajectories. The modular design makes it possible to train trajectory generators separately from the inter-leg phase coordinator and optimal controller. Ultimately, the optimal controller integrates desired angle trajectories with proprioceptive joint angle feedback to output joint torques to the physical model of each leg.</p>
<p>As illustrated schematically in <xref rid="fig1" ref-type="fig">Fig. 1B</xref>, the inputs to the trajectory generator module are desired leg phase <italic>ϕ</italic><sub><italic>d</italic></sub>, joint angles <italic>θ</italic>, joint angular velocities <inline-formula><inline-graphic xlink:href="589965v1_inline1.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, and walking speed and direction of the fly. The trajectory generator then outputs the leg phase velocity <inline-formula><inline-graphic xlink:href="589965v1_inline2.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and desired angular accelerations <inline-formula><inline-graphic xlink:href="589965v1_inline3.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. This output is integrated to produce the desired angle and angular velocities <inline-formula><inline-graphic xlink:href="589965v1_inline4.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, which are the inputs to the optimal controller.</p>
<p>To train the network from data, we used joint kinematics of flies walking on a spherical treadmill, obtained from tracking 3D joint angles with Anipose (<xref ref-type="bibr" rid="c43">Karashchuk et al., 2021</xref>). Details on training approach and network properties are described in Methods and Materials. The walking speed and direction are signals that are not generated from other modules of the model, but are instead external inputs to the trajectory generator computed from the data; biologically, these signals are analogous to descending signals from the fly brain. This organization is motivated by the observation that walking velocity and direction have a substantial effect on joint angles, but they do not have a substantial effect on parameters and outputs of the phase coordinator (e.g., phase offsets), as substantiated in Appendix B.</p>
<p>After training and when assembled with the other layers of the model, the trajectory generator receives proprioceptive information on the observed, current state of the leg <inline-formula><inline-graphic xlink:href="589965v1_inline5.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, as well as the target desired phase <italic>ϕ</italic><sub><italic>d</italic></sub> from the phase coordinator. Thus, it generates a time-series of desired angles and angular velocities for some future interval and sends this time-series <inline-formula><inline-graphic xlink:href="589965v1_inline6.gif" mime-subtype="gif" mimetype="image"/></inline-formula> to the controller; it also estimates the current phase <inline-formula><inline-graphic xlink:href="589965v1_inline7.gif" mime-subtype="gif" mimetype="image"/></inline-formula> of the leg, which is passed to the phase coordinator.</p>
<p>In the absence of external perturbations, the trajectory generator produces realistic joint angles similar to those of walking flies, as we show below. When challenged with unpredictable external perturbations, the impact on the trajectory generator is mitigated by the optimal controller layer, which attempts to return the actual state to the desired state. This control is possible because the controller operates at a higher temporal frequency than the trajectory generator, so that the controller has adequate time to reject disturbances before communicating to the trajectory generator. We emphasize that all data used to train the trajectory generator came from experimental conditions with no external perturbations.</p>
</sec>
<sec id="s2a3">
<label>2.1.3</label>
<title>Control and dynamics</title>
<p>The optimal controller layer maintains walking kinematics in the presence of sensory and motor delays and helps compensate for external perturbations. At regular intervals, the controller receives a time-series of desired state trajectories <italic>θ</italic><sub><italic>d</italic></sub> from the trajectory generator layer. The controller then produces the necessary torques <italic>τ</italic> to track this trajectory for the given leg dynamics. External perturbations <italic>w</italic>, when present, enter through the dynamics and affect the state <inline-formula><inline-graphic xlink:href="589965v1_inline8.gif" mime-subtype="gif" mimetype="image"/></inline-formula>; the controller then senses the state and responds accordingly.</p>
<p>To design the controller, we first derived dynamical equations for each leg using link-and-joint models (<xref rid="fig1" ref-type="fig">Fig. 1C</xref>), then linearized these dynamics and designed a linear quadratic regulator (LQR) controller. This optimal controller senses the state of the leg via proprioceptive input, then determines the optimal motor output for walking. The controller makes use of internal predictive states to accommodate sensory and motor delays. A detailed description of the controller derivations can be found in Methods and Materials. We note that the walking and compensation capabilities of the overall model are not contingent upon any specific dynamics or controller formulation; any controller that adequately tracks the trajectory generator would suffice.</p>
</sec>
</sec>
<sec id="s2b">
<label>2.2</label>
<title>The model generates realistic walking kinematics</title>
<p>The layered model generates realistic 3D walking kinematics when compared to real kinematic data from walking flies (<xref rid="fig2" ref-type="fig">Fig. 2</xref>). Below, we provide qualitative and quantitative comparisons of joint angles, joint angular velocities, and phases of walking both within and across legs.</p>
<fig id="fig2" position="float" fig-type="figure">
<label>Figure 2.</label>
<caption><title>Walking model simulations produce realistic joint kinematics.</title>
<p><bold>(A)</bold> Example time-series of femur-tibia flexion (R1) and femur rotation (L2) for three different walking speeds: 8, 10, and 12 mm<bold>/</bold>s. Real data (orange) exhibited more variability than simulations (blue). <bold>(B)</bold> Angle vs. computed per-leg phase of femur-tibia flexion on leg R1 and femur rotation on leg L2 for four different walking speeds. Each plot contains data from 4 walking bouts with different initial conditions. <bold>(C)</bold> Average differences between model simulations and data, over a range of forward walking, turning, and side-stepping speeds over 500 distinct bouts. The dotted line (5.56 degrees) indicates uncertainty associated with markerless 3D joint tracking (<xref ref-type="bibr" rid="c43">Karashchuk et al., 2021</xref>). All simulations used a sensory delay of 10 ms and motor delay of 30 ms, based on values measured experimentally with electrophysiology from leg sensory and motor neurons/muscles (<xref ref-type="bibr" rid="c75">Tuthill and Wilson, 2016a</xref>; <xref rid="c11" ref-type="bibr">Azevedo et al., 2020</xref>). neurons/muscles (<xref rid="c75" ref-type="bibr">Tuthill and Wilson, 2016a</xref>; <xref rid="c11" ref-type="bibr">Azevedo et al., 2020</xref>).</p></caption>
<graphic xlink:href="589965v1_fig2.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
<sec id="s2b1">
<label>2.2.1</label>
<title>Qualitative evaluation of joint angle time-series and videos of walking kinematics</title>
<p>We first qualitatively compared simulated and real kinematics by examining time-series data and videos. In example trajectories of femur-tibia flexion angles of the right front and femur rotation angles of the left middle legs, the simulated time-series matched the mean, frequency, and pseudo-triangular shape of the fly data (<xref rid="fig2" ref-type="fig">Fig. 2A</xref>). Articulated animations of simulated and real trajectories for comparison are shown in Videos 1, 2, and 3. Although the model and data were largely similar, some differences stood out. For example, the simulated amplitudes were generally smaller than real amplitudes, and the simulated trajectories tended to be more regular.</p>
</sec>
<sec id="s2b2">
<label>2.2.2</label>
<title>Comparing joint angles and angular velocities versus phase</title>
<p>We next sought to quantitatively compare simulated and real joint angles. Direct comparisons of time-series trajectories are inadequate, because temporal offsets between time-series produce large mismatches even if the time-series are similar. For instance, if we shift a time-series trajectory by a half-cycle and compare it with itself, this will produce a large mismatch, even though the two trajectories are identical except for a misalignment in phase.</p>
<p>To compare real and simulated trajectories, we computed the step-cycle phase for each time-series and used this to plot the mean angles <italic>θ</italic> as a function of phase (<xref rid="fig2" ref-type="fig">Fig. 2B</xref>). Here we make the distinction between <italic>generated phase</italic>, the per-leg phases produced by the phase coordinator of the model, and <italic>computed phase</italic>, which can be computed for each joint from time-series data. Since we did not have access to the generated, desired phase for real fly data, all comparisons were made between computed phases.</p>
<p>When we averaged joint angles for all legs over 500 distinct walking bouts of 0.5 to 2 seconds in duration, we found that the mean differences between real and simulated joint angles were less than 6 degrees (<xref rid="fig2" ref-type="fig">Fig. 2C</xref>). This difference is comparable to the uncertainty associated with markerless tracking of 3D fly walking kinematics that we used as training data (5.56 degrees, from <xref ref-type="bibr" rid="c43">Karashchuk et al. (2021)</xref>). Errors for angular velocity were higher. Aggregate differences as a function of walking and turning velocity are shown in Appendix E.</p>
<p>The similarity between real and simulated data as a function of phase was consistent across the natural range of forward walking speeds (<xref rid="fig2" ref-type="fig">Fig. 2B</xref>). Plots for all legs and joints are shown in Appendices C and D. We further demonstrate the model’s capacity to simulate leg kinematics by comparing the phase coupling of simulated joint kinematics with real walking flies, both within and across legs, in Appendix F.</p>
</sec>
</sec>
<sec id="s2c">
<label>2.3</label>
<title>Model maintains walking under unpredictable external perturbations</title>
<p>When walking in natural environments, animals frequently navigate uneven or slippery terrain. Thus, robust sensorimotor control systems must detect and respond to such unexpected perturbations in order to maintain stable locomotion.</p>
<p>Here, we show that our model maintains realistic walking in the presence of external dynamic perturbations, despite being trained only on data of walking without perturbations. This performance is made possible by the combination of the trajectory generator and optimal controller in the model. By taking advantage of proprioceptive feedback, the optimal controller compensates for external perturbations, allowing the trajectory generator to sustain realistic joint angle trajectories.</p>
<p>We considered two types of perturbations: impulse and persistent stochastic. Impulse perturbations are analogous to when an animal experiences a brief, unexpected force (e.g., legs slipping on an unstable surface). We simulated impulse perturbations as a velocity that is added to all joints at a single time (i.e., a single time step in our simulation). The magnitude of this velocity is drawn from a normal distribution for each joint, where increasing perturbation strength increases the mean and variance of this distribution. Persistent stochastic perturbations displace all the legs, but not at the same time. We applied perturbations following a Poisson process with a mean rate of 10 Hz; in other words, over a period of time (1 second), for each leg at each timestep, we randomly select whether a impulse perturbation should be applied based on a Poisson distribution. Ranges of perturbation strengths used in our simulation correspond to estimates of biologically plausible values (as derived in Appendix G).</p>
<p>To evaluate the model’s ability to walk in the presence of perturbations, we compared time-series data before, during, and after perturbations across a range of walking speeds (<xref rid="fig3" ref-type="fig">Fig. 3B-C</xref>). For both types of perturbations, joint angle trajectories were different during perturbations, but recovered after the perturbation period ended. In the case of persistent stochastic perturbations, kinematics appeared approximately oscillatory even during perturbations, indicating that a semblance of walking was maintained. Example animations of simulated walking bouts with perturbations are shown in Videos 4–7.</p>
<fig id="fig3" position="float" fig-type="figure">
<label>Figure 3.</label>
<caption><title>The model sustains robust walking during and following perturbations.</title>
<p><bold>(A)</bold> Schematic of how perturbations are applied to the walking model. <bold>(B, C)</bold> Example time-series of femur-tibia flexion on leg R1 and femur rotation on leg L2 for three different walking speeds (8, 10, and 12 mm<bold>/</bold>s) before, during, and after perturbation. In panel B, an impulse perturbation of size 3.75 rad<bold>/</bold>s is applied at a single instant (dotted line), and its effects are analyzed over a brief time window (shaded blue area). In panel C, stochastic perturbations of size 1.875 rad<bold>/</bold>s are applied over a time window (shaded green area). Angle trajectories are visibly different during the analysis windows, but recover afterward. Perturbation effects appear similar across speeds. All simulations used a sensory delay of 10 ms and motor delay of 30 ms.</p></caption>
<graphic xlink:href="589965v1_fig3.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
<p>To quantify the extent to which perturbed kinematics resemble normal, unperturbed walking, we introduce a new quantitative metric termed <italic>kinematic similarity (KS)</italic>. For a given window of a kinematic trajectory, KS is computed by the log likelihood that it occurred in the real fly walking data (illustrated in <xref rid="fig4" ref-type="fig">Fig. 4A</xref> and detailed in Methods and Materials). Briefly, we reduce the experimental data to 2 dimensions using principal components analysis (PCA), then fit a kernel density estimator (KDE) to the resulting distribution. We then project each bout of simulated walking onto this subspace and evaluate the KDE model to obtain a log probability density function estimate, which corresponds to the kinematic similarity of the simulated bout to real walking bouts in the data. Lower values of KS mean lower similarity to data. When we applied this method to bouts from experimental data, we found that the average KS of experimental data was -1.627. Thus, we use KS <italic>&gt;</italic> −1.6 as a general threshold for evaluating the realism of joint angle trajectories. As expected, larger perturbations led to walking behaviors with lower KS, and KS was not strongly dependent on forward walking speed (<xref rid="fig4" ref-type="fig">Fig. 4B-C</xref>). For persistent stochastic perturbations, the model produced realistic joint angle trajectories (KS <italic>&gt;</italic> −1.6) for all simulated perturbation strengths. Impulse perturbations appeared to be more challenging for the model, as they resulted in lower KS. From the time-series, we observed that impulse perturbations resulted in greater instantaneous deviation from the standard waveform than persistent stochastic perturbations of the same magnitude. This is due to the fact that impulse perturbations produce simultaneous changes to all legs and joints, whereas persistent stochastic perturbations are spread out in time and typically non-simultaneous.</p>
<fig id="fig4" position="float" fig-type="figure">
<label>Figure 4.</label>
<caption><title>The walking model sustains realistic walking kinematics following impulse and persistent stochastic perturbations.</title>
<p><bold>(A)</bold> Method for computing kinematic similarity between real data and simulated walking. First, the full set of experimental data (from flies) is used to compute a Gaussian kernel density estimator (KDE). To quantify the similarity (to data) of a given bout of simulated walking, we apply the KDE to evaluate the log probability density function of each bout, a scalar value we refer to as kinematic similarity (KS). High KS indicates that the perturbed walking resembles the unperturbed walking from data, while low KS indicates that the perturbed walking deviates from data. The average KS value of bouts from experimental data was -1.627. <bold>(B, C)</bold> Kinematic similarity of simulated walking during perturbations for impulse and persistent stochastic perturbations. For each square of the heatmap, four simulations with different initial conditions were simulated and averaged. Simulations became less similar to data with increased perturbation strength. All simulations used a sensory delay of 10 ms and motor delay of 30 ms. Perturbation velocities were drawn from a random uniform distribution with mean <italic>perturbation strength</italic> (rad<bold>/</bold>s) and standard deviation of 0.1<italic>×</italic>mean.</p></caption>
<graphic xlink:href="589965v1_fig4.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
</sec>
<sec id="s2d">
<label>2.4</label>
<title>Effect of sensory and motor delays on walking</title>
<p>Temporal delays are inherent properties of sensorimotor control systems, but they are difficult to manipulate experimentally. Therefore, we used our model to investigate how changing sensory and motor delays affects locomotor robustness. We used measurements from the literature to estimate physiological delays for leg sensory and motor neurons in the <italic>Drosophila</italic> leg. Our estimate of sensory delay (5–15 ms) was based on the measured delay from spike initiation in a mechanosensory neuron in the <italic>Drosophila</italic> femur to the peak of an excitatory postsynaptic potential in a postsynaptic VNC neuron (<xref ref-type="bibr" rid="c75">Tuthill and Wilson, 2016a</xref>). Our estimate of motor delay (20–40 ms) was based on the time between spike initiation in a tibia motor neuron cell body to the onset of muscle force production, measured with a force probe (<xref ref-type="bibr" rid="c11">Azevedo et al., 2020</xref>).</p>
<p>Without external perturbations, the model produced realistic walking with arbitrary delays, since the controller can effectively compensate for large delays by using predictions of joint angles in the future. However, in the presence of external perturbations and high delay values, the model was unable to maintain realistic walking, since it could not respond rapidly enough to unexpected perturbations. Here we consider the composite effects of persistent stochastic perturbations with motor and sensor delays. Similar results for impulse perturbations are included in Appendix I.</p>
<p>We first fixed the sensory delay at 10 ms and measured the effect of varying motor delays. Examining the time-series data, we found that for low values of motor delay (10 ms, 20 ms), even stronger perturbations had almost no effect (<xref rid="fig5" ref-type="fig">Fig. 5A</xref>). However, at higher values of motor delay, the effects of the same perturbation became more pronounced, though the model still managed to recover after the perturbations ended. Over a range of perturbation strengths and walking speeds, the model maintained realistic walking (KS <italic>&gt;</italic> −1.6) up to about 30 ms of motor delay (<xref rid="fig5" ref-type="fig">Fig. 5C</xref>). This value is consistent with motor delays measured from the fruit fly leg, where the time between motor neuron spiking to the onset of muscle force production is about 30 ms (<xref ref-type="bibr" rid="c11">Azevedo et al., 2020</xref>).</p>
<fig id="fig5" position="float" fig-type="figure">
<label>Figure 5.</label>
<caption><title>The model maintains robust walking under persistent stochastic perturbations over specific ranges of motor and sensory delays.</title>
<p><bold>(A, B)</bold> Example time-series of femur-tibia flexion on leg R1 and femur rotation on leg L2 under various values of motor (10, 20, 30, 40 ms) and sensory delay (0, 5, 10, 15 ms). Perturbation effects became more noticeable with increasing delay values. <bold>(C, D, E)</bold> Similarity of during-perturbation walking to data across delay values, perturbation strengths, and forward speeds. For each square of the heatmap, four simulations with different initial conditions were simulated and evaluated. At low delay values, simulated walking maintained high similarity even under large perturbations. As perturbation strength and delays increased, simulated walking became less similar to data; the effect was more pronounced with increased delays. When we fixed one delay value and vary the other, the model maintained realistic walking (KS <italic>&gt;</italic> −1.6) up to about 30 ms of motor delay and 10 ms of sensory delay across a range of conditions. When we allowed both motor and sensory delay to vary, the model maintained realistic walking when the sum of the delays is no more than about 45 ms. <bold>(F)</bold> Post-perturbation walking with motor and sensory delays. The model was unable to recover from perturbations for large delay values. Unless otherwise stated, forward speed = 12 mm<bold>/</bold>s, and perturbation strength = 1.875 rad<bold>/</bold>s.</p></caption>
<graphic xlink:href="589965v1_fig5.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
<p>Next, we fixed the motor delay at 30 ms and observed the effect of varying sensory delays. From time-series data, we found that even at low values of sensory delay (0 ms, 5 ms), the effects of perturbations on model output were significant (<xref rid="fig5" ref-type="fig">Fig. 5B</xref>). When sensory delay increased, the effects of the perturbation became more pronounced. Over a range of perturbation strengths and walking speeds, the model maintained realistic walking (KS <italic>&gt;</italic> −1.6) up to about 10 ms of sensory delay (<xref rid="fig5" ref-type="fig">Fig. 5D</xref>). This range is consistent with experimental estimates of delays from mechanosensory neurons in the fly’s fly femur (<xref ref-type="bibr" rid="c75">Tuthill and Wilson, 2016a</xref>), although delays could be even longer for more distal sensors. For example, a sensory neuron at the tip of the tarsus would take ∼20 ms to travel 2 mm at an estimated conduction velocity of ∼0.3 m<bold>/</bold>s (<xref ref-type="bibr" rid="c75">Tuthill and Wilson, 2016a</xref>).</p>
<p>For any fixed set of values of motor and sensory delays, the KS of perturbed walking was not dependent on forward walking speed. In other words, slower walking did not improve the model’s ability to sustain walking during perturbations (<xref rid="fig5" ref-type="fig">Fig. 5C</xref> and <xref rid="fig5" ref-type="fig">D</xref>). We expand on this observation in the Discussion.</p>
<p>Last, we explored combinations of values for motor and sensory delays for fixed walking speed and perturbation strength. We observed that robust walking was not contingent on the specific values of motor and sensory delay, but rather the <italic>sum</italic> of these two values (<xref rid="fig5" ref-type="fig">Fig. 5E</xref>). That is, in order for the model to overcome a perturbation, the key parameter is the total delay between the perturbation onset and the motor response.</p>
<p>In summary, we used a virtual fly model of walking to perform <italic>in silico</italic> manipulations of sensory and motor delays, including delays exceeding physiologically-realistic values. When we tested the model across a range of delay values, we found that the model was able to maintain robust walking only within the physiological range. Outside of this range, the model could not maintain walking that was kinematically similar to real flies. This finding suggests that the fly locomotor control system operates close to the temporal limit at which it can detect and respond to external perturbations. Thus, we propose that sensory and motor delays establish a fundamental tradeoff between the speed and robustness of fly walking.</p>
</sec>
</sec>
<sec id="s3">
<label>3</label>
<title>Discussion</title>
<p>In this paper, we developed a computational model that realistically imitates 3D joint kinematics of walking <italic>Drosophila</italic> and incorporates sensorimotor delay as a tunable parameter. We then used the model to establish a quantitative relationship between sensorimotor delays and locomotor robustness. We found that the model’s ability to maintain walking following external perturbations significantly degrades for delay values that exceed known physiological values, suggesting that these parameters are fundamental constraints on fly locomotion. The formulation of a modular, multi-layered model for locomotor control makes new experimentally-testable hypotheses about fly motor control and can also be applied to investigate limbed locomotion in other organisms. Future extensions of the model include inclusion of premotor neural circuits from the fly connectome (<xref ref-type="bibr" rid="c47">Lesser et al., 2023</xref>; <xref ref-type="bibr" rid="c19">Cheong et al., 2023</xref>) and biomechanical interactions between the limb and the environment (<xref ref-type="bibr" rid="c49">Lobato-Rios et al., 2022</xref>; <xref ref-type="bibr" rid="c79">Wang-Chen et al., 2023</xref>; <xref ref-type="bibr" rid="c77">Vaxenburg et al., 2024</xref>).</p>
<sec id="s3a">
<label>3.1</label>
<title>Fundamental constraints on locomotion imposed by sensory and motor delays</title>
<p>Sensory and motor delays are inextricable properties of animal locomotor systems. To study the impact of delays on locomotor control, we developed a hierarchical walking model with explicit inclusion of physiological delays as tunable parameters. Importantly, the model incorporates delay while preserving behavioral realism, thus laying the groundwork for future studies on the effect of delay on other aspects of locomotion and sensorimotor control.</p>
<p>Our model predicts that at the same perturbation magnitude, walking robustness decreases as delays increase. This could be experimentally tested by altering conduction velocities in the fly, for example by increasing or decreasing the ambient temperature (<xref ref-type="bibr" rid="c12">Banerjee et al., 2021</xref>). If a warmer ambient temperature decreases delays in the fly, but fly walking robustness remains the same in response to a fixed perturbation, this would indicate a stronger role for central control in walking than our modeling results suggest.</p>
<p>Tradeoffs between energy, performance, and robustness establish fundamental constraints on animal locomotion. It is energetically expensive to build and maintain muscles and neurons that operate with low delay (<xref ref-type="bibr" rid="c69">Sterling and Laughlin, 2015</xref>). From a performance perspective, long delays limit reaction speed and limit control robustness, which can ultimately impact animal survival (<xref ref-type="bibr" rid="c53">More and Donelan, 2018</xref>). A third consideration is locomotor robustness, or the capacity to detect and respond to external perturbations. In flies, the axons of leg motor neurons and some proprioceptor axons are among the largest diameter cables in the leg nerve (<xref ref-type="bibr" rid="c57">Phelps et al., 2021</xref>), suggesting that the speed of these systems are under selective pressure.</p>
<p>Our model suggests that fly walking operates in a middle ground with respect to speed and robustness. Specifically, our model maintains normal walking for up to about 30 ms of motor delay and 10 ms of sensory delay. These values are strikingly close to measured values from <italic>Drosophila</italic>: 30 ms from motor neuron spike to peak force production in a femur muscle (<xref ref-type="bibr" rid="c11">Azevedo et al., 2020</xref>) and 6 ms from a femoral mechanosensory neuron spike to the onset of a postsynaptic response in the VNC (<xref ref-type="bibr" rid="c75">Tuthill and Wilson, 2016a</xref>).</p>
<p>In our model, robust locomotion was constrained by the cumulative sensorimotor delay. This result could be experimentally validated by comparing how animals with different ratios of sensory to motor delays respond to perturbations. Alternatively, it may be possible to manipulate sensory vs. motor delays in a single animal, perhaps by altering the development of specific neurons or ensheathing glia (<xref ref-type="bibr" rid="c45">Kottmeier et al., 2020</xref>). If sensory and motor delays have significantly different effects on walking quality, then additional compensatory mechanisms for delays could play a larger role than we expect, such as prediction through sensory integration, mechanical feedback, or compensation through central control. A rich and related topic for future exploration is the interaction of delays with body size and behavioral ecology, as longer limbs, heavier bodies, and<bold>/</bold>or more mechanically complex tasks may alter the tradeoffs between energetics, speed of force generation, noise, and robust sensorimotor control (<xref ref-type="bibr" rid="c46">Labonte et al., 2024</xref>).</p>
</sec>
<sec id="s3b">
<label>3.2</label>
<title>Role of proprioceptive feedback in fly walking</title>
<p>Our model provides insight into the role of proprioceptive feedback in fly walking, which remains an active area of research (<xref ref-type="bibr" rid="c27">Dallmann et al., 2021</xref>). Models of fly walking have generally ignored the role of feedback, relying instead on central pattern generators (<xref ref-type="bibr" rid="c49">Lobato-Rios et al., 2022</xref>; <xref ref-type="bibr" rid="c72">Szczecinski et al., 2018</xref>; <xref ref-type="bibr" rid="c4">Aminzare et al., 2018</xref>) or metachondral waves (<xref ref-type="bibr" rid="c29">Deangelis et al., 2019</xref>) to model kinematics. This assumption is in line with experimental work in cockroaches, which suggests that these fast-running insects rely on central control and mechanical feedback, particularly at high-speeds (<xref ref-type="bibr" rid="c23">Couzin-Fuchs et al., 2015</xref>; <xref ref-type="bibr" rid="c9">Ayali et al., 2015b</xref>). In contrast, studies in stick insects have shown that these slow-walking animals are highly dependent on proprioceptive feedback for leg coordination during walking (<xref ref-type="bibr" rid="c13">Bässler, 1977</xref>; <xref ref-type="bibr" rid="c8">Ayali et al., 2015a</xref>; <xref ref-type="bibr" rid="c63">Schilling et al., 2013</xref>).</p>
<p>Silencing mechanosensory chordotonal neurons alters step kinematics in walking <italic>Drosophila</italic> (<xref ref-type="bibr" rid="c52">Mendes et al., 2013</xref>; <xref ref-type="bibr" rid="c58">Pratt et al., 2024</xref>). However, the role of leg proprioception in overcoming external perturbations has not previously been studied in flies. In our model, which includes no limb compliance or other biomechanical adaptations, the fly effectively overcomes perturbations using only proprioceptive feedback. The need for proprioception to compensate for perturbations may be reduced when biomechanical mechanisms are present. Nonetheless, we hypothesize that removing proprioceptive feedback would impair an insect’s ability to sustain locomotion following external perturbations.</p>
</sec>
<sec id="s3c">
<label>3.3</label>
<title>Predictive control is critical for responding to perturbations due to motor delay</title>
<p>Sustaining realistic walking kinematics in the presence of perturbations and motor delays is a challenging task for any model. In our model, this design criterion motivated us to develop a compensatory prediction in the optimal controller formulation, based on <xref ref-type="bibr" rid="c68">Stenberg et al. (2022)</xref>. The controller compensates for the known motor delay by predicting future dynamics. We found that the model was quite sensitive to the <italic>prediction horizon</italic>, i.e., how far into the future the controller predicts. The model works best when the controller’s prediction horizon matches the motor delay — we thus used matched values in all simulations. We experimented with altering the prediction horizon to be less than the motor delay, with catastrophic consequences: the model ceased walking and mostly produced noise (not shown). From this observation, we deduce that future predictions are crucial in compensating for motor delays in our walking model, in agreement with previous theoretical work on predictive or “forward” models for sensorimotor control (<xref ref-type="bibr" rid="c30">Desmurget and Grafton, 2000</xref>; <xref ref-type="bibr" rid="c48">Li et al., 2023</xref>). We propose that fly motor circuits may encode predictions of future joint positions, so the fly may generate motor commands that account for motor neuron and muscle delays. Consistent with this hypothesis, <xref ref-type="bibr" rid="c28">Dallmann et al. (2023)</xref> recently found that descending motor commands from the brain excite GABAergic interneurons in the VNC that inhibit velocity-encoding proprioceptors. Thus, some proprioceptive feedback signals from the fly leg are predictively suppressed during self-generated movements.</p>
</sec>
<sec id="s3d">
<label>3.4</label>
<title>Layered model produces robust walking and facilitates local control</title>
<p>One key finding of our model is that robust walking in the presence of external perturbations can emerge from a local controller in combination with a trajectory generator that is trained only on perturbation-free walking. We did not model adaptation because compensation emerges as a property of a tuned controller with feedback. The success of this simple, layered model suggests that fast, robust locomotion could be maintained locally, requiring minimal plasticity within central circuits.</p>
<p>Layering is a familiar concept in network architecture and hardware<bold>/</bold>software stacks (<xref ref-type="bibr" rid="c20">Chiang et al., 2007</xref>) and has recently found applications as a modeling framework in biology and neuroscience (<xref ref-type="bibr" rid="c31">Doyle and Csete, 2011</xref>; <xref ref-type="bibr" rid="c54">Nakahira et al., 2021</xref>). In our model, the complex problem of multi-legged locomotion is broken down into three sub-problems (delayed control, joint kinematic generation, inter-leg coordination), each of which is delegated to a different layer.</p>
<p>Each layer provides an abstracted interface for the layer below it, which can also be thought of as a special case of modularity. The separation of function between layers reinforces that robust locomotion can be produced by local (i.e. per-leg) control signals. Per-leg modules could also be extended to control more legs, generalizing to locomotor control in isopods and millipedes. Instead of redesigning the overall coordination and locomotor control circuits, basic duplication and subsequent fine tuning may be sufficient.</p>
<p>Beyond walking, our layered model framework could be applied to other animals with distinct locomotor strategies, including flying, swimming, slithering, and digging. The key ingredients required for the model are: (1) a functional inter-limb coordinator, (2) sufficient 3D kinematics data to train a trajectory-generator layer, and (3) a controller that adequately tracks the trajectory for some dynamical model of the animal. The dynamical model may be linearized (as we did here) and controlled with a standard controller; other approaches include successive (per-timestep) linearization with linear model predictive control (MPC) (<xref ref-type="bibr" rid="c14">Berberich et al., 2022</xref>), or fully nonlinear control techniques (<xref ref-type="bibr" rid="c65">Slotine and Li, 1991</xref>).</p>
<p>The layered model approach also has potential applications for bio-mimetic robotic locomotion. For simplicity, we used a linearized link-and-joint dynamical model. However, one could also replace this dynamical model to control a hexapod robot such as in <xref ref-type="bibr" rid="c37">Goldsmith et al. (2019)</xref>. Due to its modular nature, the other modules (trajectory generator, inter-leg coordinator) would remain unchanged and the resulting model could, in theory, generate 3D kinematics for bio-mimetic walking on a robotic platform. Overall, the model can be thought of as performing a layered implementation of imitation learning, which is a popular technique in robotics.</p>
</sec>
<sec id="s3e">
<label>3.5</label>
<title>Towards biomechanical and neural realism</title>
<p>The goal of our model was to produce realistic 3D joint kinematics while incorporating sensory and motor delays. To achieve this, the model contains several physiological simplifications. First, our dynamics model did not allow dynamical coupling between legs through the mechanics of the body, as the legs are only coupled neurally through the phase coordinator. However, in real bodies, the legs are also dynamically coupled through the body and its weight distribution over the legs (<xref ref-type="bibr" rid="c26">Dallmann et al., 2017</xref>). Our model also did not consider explicit leg-ground contact interactions. Rather, interactions with the ground were implicitly taken into account by the trajectories learned by the neural network, though they were not made explicit in the dynamics. Our goal was to mimic the kinematic trajectory, a problem known in robotics as <italic>motion control</italic>. However, including ground contact interactions would require computing ground contact forces, which are currently unavailable in the kinematics dataset we used.</p>
<p>In order to model ground contact forces and joint torques, force-based learning would need be incorporated into the trajectory generator, requiring a new dataset or extrapolating force values (e.g. via a physics-based model). Further, the controller would need to be reformulated to use <italic>impedance control</italic> or <italic>hybrid control</italic> techniques (<xref ref-type="bibr" rid="c16">Buss et al., 2002</xref>; <xref ref-type="bibr" rid="c5">Arevalo and Garcia, 2012</xref>; <xref ref-type="bibr" rid="c64">Sciavicco and Siciliano, 2012</xref>). These approaches are commonplace in robotics to deal with dynamics control problems, which concern both kinematic trajectories <italic>and</italic> external contact forces. The inclusion of explicit leg-ground contact interactions would also make it harder for the model to recover when perturbed, because perturbations during walking often occur upon contact with the ground (e.g. the ground is slippery or bumpy).</p>
<p>A promising avenue for future investigation is integration of our controller architecture with a virtual physics model (<xref ref-type="bibr" rid="c49">Lobato-Rios et al., 2022</xref>; <xref ref-type="bibr" rid="c79">Wang-Chen et al., 2023</xref>; <xref ref-type="bibr" rid="c77">Vaxenburg et al., 2024</xref>), which would facilitate incorporation of dynamical coupling between legs, as well as leg-ground contact interactions. The inclusion of these features may require additional coordination between the legs, which might decrease allowable values of sensory and motor delay.</p>
<p>Another step toward biological realism is the incorporation of explicit proprioceptors, muscles, tendons, and other biomechanical aspects of the exoskeleton. The proprioceptive neurons in the femoral chordotonal organ of each fly leg encode angles and angular derivatives (<xref ref-type="bibr" rid="c51">Mamiya et al., 2018</xref>). Additional proprioceptive feedback is provided by hair plate sensory neurons (limit detectors) and campaniform sensilla (load sensors), which are distributed across each leg (<xref ref-type="bibr" rid="c76">Tuthill and Wilson, 2016b</xref>). Thus, our use of joint state <italic>θ</italic>, <inline-formula><inline-graphic xlink:href="589965v1_inline9.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, likely underestimates the resolution of proprioceptive feedback to the fly motor system. We anticipate that the increased sensory resolution from more detailed proprioceptor models and the stability from mechanical compliance of limbs in a more detailed biomechanical model would make the system easier to control and increase the allowable range of delay parameters. Conversely, we expect that modeling the nonlinearity and noise inherent to biological sensors and actuators may decrease the allowable range of delay parameters.</p>
<p>A further step towards biological realism would be to constrain the trajectory generator and optimal controller using patterns of synaptic connectivity within sensorimotor circuits of the fly VNC. This is now feasible using recent connectomes of the <italic>Drosophila</italic> VNC (<xref ref-type="bibr" rid="c10">Azevedo et al., 2022</xref>; <xref ref-type="bibr" rid="c73">Takemura et al., 2023</xref>). However, many challenges remain for connectome-constrained models, because many important physiological parameters are still unknown.</p>
<p>Our layered approach could be a useful framework for learning principles from closed loop models, despite having incomplete information about the biological system. For instance, the trajectory generator model could be replaced by a combination of a connectome simulation and artificial neural networks, with the constraint on the artificial neural network dynamics coming from the complete circuit generating robust walking in simulation. Future work could also incorporate more detailed delay structures based on compartmental models of neurons from the connectome. With increasing realism, such closed-loop models provide a promising means to investigate how complex neural circuits interact with proprioceptive feedback to control robust locomotor behaviors.</p>
</sec>
</sec>
<sec id="s4">
<label>4</label>
<title>Methods and Materials</title>
<sec id="s4a">
<label>4.1</label>
<title>Tracking joint angles of <italic>D. melanogaster</italic> walking in 3D</title>
<p>We obtained fruit fly <italic>D. melanogaster</italic> walking kinematics data following the procedure previously described in <xref ref-type="bibr" rid="c43">Karashchuk et al. (2021)</xref>. Briefly, a fly was tethered to a tungsten wire and positioned on a frictionless spherical treadmill ball suspended on compressed air. Six cameras captured the movement of all of the fly’s legs. Using Anipose, we tracked 30 keypoints on the fly at 300 Hz, which are the following 5 points on each of the 6 legs: body-coxa, coxa-femur, femur-tibia, and tibia-tarsus joints, as well as the tip of the tarsus.</p>
<p>To fit the model described in this paper, we extracted a subset of the tracking data when the fly walking, as opposed to non-walking behaviors including standing, grooming, etc. To isolate bouts of walking, we used the behavior classifier described in <xref ref-type="bibr" rid="c43">Karashchuk et al. (2021)</xref>. We further selected walking bouts of at least 0.5 seconds (150 video frames) in length, and where the femur-tibia flexion angle of the left front leg had a range of at least 30 degrees.</p>
<p>In total, our dataset consisted of 3473 walking bouts from 45 flies total. The average length of a walking bout was 0.877 seconds (263 frames), with 3049.7 seconds of walking total (914,909 frames).</p>
</sec>
<sec id="s4b">
<label>4.2</label>
<title>Inter-leg phase coordinator</title>
<p>We model the coordination between legs as phase-coupled Kuramoto oscillators (<xref ref-type="bibr" rid="c71">Strogatz, 2000</xref>), where the frequency of each oscillator is driven by the trajectory generator described in the next section.</p>
<p>Specifically, the phase for a leg <italic>i</italic> is <italic>ϕ</italic><sub><italic>i</italic></sub> and evolves according to its derivative <inline-formula><inline-graphic xlink:href="589965v1_inline10.gif" mime-subtype="gif" mimetype="image"/></inline-formula>
<disp-formula id="eqn1">
<graphic xlink:href="589965v1_eqn1.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <italic>F</italic><sub><italic>i</italic></sub> is the trajectory generator function for leg <italic>i, α</italic> is the coupling strength, and <inline-formula><inline-graphic xlink:href="589965v1_inline11.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is the steady-state phase offset between legs <italic>i</italic> and <italic>j</italic>.</p>
<p>We model the coupling across the legs as all-to-all coupling, with coupling strength <italic>α</italic> = 6.5. We found this coupling strength best reproduced the phase coupling distributions from the real data (as shown in Appendix F).</p>
<p>We estimate <inline-formula><inline-graphic xlink:href="589965v1_inline12.gif" mime-subtype="gif" mimetype="image"/></inline-formula> from the walking data by taking the circular mean over phase differences of pairs the legs during walking bouts. We find that the phase offset across legs is not modulated across walking speeds in our dataset (see Appendix B), so we model <inline-formula><inline-graphic xlink:href="589965v1_inline13.gif" mime-subtype="gif" mimetype="image"/></inline-formula> as a single constant independent of speed.</p>
</sec>
<sec id="s4c">
<label>4.3</label>
<title>Trajectory generator</title>
<p>A trajectory generator model was formulated for each of the six legs and fit separately to fly walking data tracked during tethered walking without any external perturbations.</p>
<sec id="s4c1">
<label>4.3.1</label>
<title>Model formulation</title>
<p>We formulate the trajectory generator as the function
<disp-formula id="eqn2">
<graphic xlink:href="589965v1_eqn2.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <italic>θ</italic> is a vector of joint angles, <inline-formula><inline-graphic xlink:href="589965v1_inline14.gif" mime-subtype="gif" mimetype="image"/></inline-formula> s a vector of joint angle derivatives, <italic>v</italic> is the desired walking speed and direction, and <italic>ϕ</italic> is the phase of the leg. Initially, we explored using the trajectory generator to directly output angles and angular velocities <inline-formula><inline-graphic xlink:href="589965v1_inline15.gif" mime-subtype="gif" mimetype="image"/></inline-formula>; however, we found that more realistic (i.e. similar to data) trajectories were produced when we used the trajectory generator to output angular acceleration <inline-formula><inline-graphic xlink:href="589965v1_inline16.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, which we integrated to produce the desired angle and angular velocities. Note that <italic>v</italic> is not communicated to or from the layers above and below; instead, we consider walking speed and direction to be given as commands descending from the brain.</p>
<p>To compute a trajectory given an input <italic>v</italic> and an initial <italic>ϕ, θ</italic>, and <inline-formula><inline-graphic xlink:href="589965v1_inline17.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, we integrate the function <italic>F</italic> numerically using the midpoint method (<xref ref-type="bibr" rid="c50">Lotkin, 1956</xref>). Following methods from <xref ref-type="bibr" rid="c41">Holden et al. (2017)</xref> and <xref ref-type="bibr" rid="c81">Zhang et al. (2018)</xref>, we represent the function <italic>F</italic> as a multilayer perceptron neural network with 2 hidden layers of with 512 units each. We use ELU (<xref ref-type="bibr" rid="c22">Clevert et al., 2015</xref>) as our nonlinearity. In total, the multilayer perceptron has 274,437 parameters for T1 legs and 272,388 parameters for T2 and T3 legs, with the slight difference in parameters due to the different number of joint angles (dimension of <italic>θ</italic>) modeled for a given leg.</p>
</sec>
<sec id="s4c2">
<label>4.3.2</label>
<title>Training data</title>
<p>To train the multilayer perceptron network used to represent <italic>F</italic>, we used the fly walking data, tracked as described in the section above. The training data consists of joint angles <italic>θ</italic>, computed <inline-formula><inline-graphic xlink:href="589965v1_inline18.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <inline-formula><inline-graphic xlink:href="589965v1_inline19.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, and walking velocity <italic>v</italic>. We estimated the walking cycle phase <italic>ϕ</italic> using a Hilbert transform over the femur-tibia flexion angle for T1 legs, femur rotation angle for T2 legs, and coxa-femur angle for T3 legs. For each phase, we filtered the corresponding angle using a first-order Butterworth bandpass filter with 3 Hz and 60 Hz as critical frequencies, using the scipy library (<xref ref-type="bibr" rid="c78">Virtanen et al., 2020</xref>). Then, we applied a Hilbert transform to each angle to obtain a complex waveform. We estimate the walking cycle phase from each complex waveform by estimating the angle of each point in the waveform.</p>
</sec>
<sec id="s4c3">
<label>4.3.3</label>
<title>Training procedure</title>
<p>Training the neural network representing <italic>F</italic> from data was performed in two steps, minimizing its error in predicting one time step, then minimizing its error in predicting a short time trajectory.</p>
<p>In the first step, we minimized the error of <italic>F</italic> for predicting <inline-formula><inline-graphic xlink:href="589965v1_inline20.gif" mime-subtype="gif" mimetype="image"/></inline-formula> over one time step, given the corresponding <inline-formula><inline-graphic xlink:href="589965v1_inline21.gif" mime-subtype="gif" mimetype="image"/></inline-formula> from the training data. We minimized the mean squared error of the prediction, normalized by the variance for each dimension. We trained our network for 300 iterations over the full training data using a batch size of 2500 training samples, using gradient descent with the Adam algorithm (<xref ref-type="bibr" rid="c44">Kingma and Ba, 2017</xref>). To ensure a robust function at this step, we applied dropout to a random 5% of the hidden units (<xref ref-type="bibr" rid="c67">Srivastava et al., 2014</xref>). We standardized the input and output training data to the multilayer perceptron so that has a mean of 0 and standard deviation of 1.</p>
<p>In the second step, we minimize the error of <italic>F</italic> for predicting a trajectory <italic>θ</italic> when numerically integrated over a short time horizon in the future. Specifically, we integrate <italic>F</italic> over <italic>T</italic> = 60 steps given initial conditions <inline-formula><inline-graphic xlink:href="589965v1_inline22.gif" mime-subtype="gif" mimetype="image"/></inline-formula> to produce an estimated trajectory of <inline-formula><inline-graphic xlink:href="589965v1_inline23.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. Here we minimized the loss:
<disp-formula id="eqn3">
<graphic xlink:href="589965v1_eqn3.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
using gradient descent with the Adam algorithm (<xref ref-type="bibr" rid="c44">Kingma and Ba, 2017</xref>). During training, we clip gradients to a norm of 10 to stabilize training.</p>
<p>The training was implemented using Tensorflow (<xref ref-type="bibr" rid="c1">Abadi et al., 2015</xref>) running on a computer with NVIDIA GeForce RTX 2070 GPU and AMD Ryzen Threadripper 1920X 12-Core Processor.</p>
</sec>
</sec>
<sec id="s4d">
<label>4.4</label>
<title>Leg dynamics and optimal controller formulation</title>
<p>All techniques used for dynamics formulation are standard tools from control theory. We begin with a link-and-joint model of the fly leg, as shown in <xref rid="fig1" ref-type="fig">Fig. 1C</xref>. For simplicity, we only model joints that exhibit large ranges of movement during naturalistic walking and turning. For instance, varying femur rotation is important to the movements of the middle legs, but the front legs exhibit near-constant femur rotation (<xref ref-type="bibr" rid="c43">Karashchuk et al., 2021</xref>); thus, a femur rotation joint is included for the middle and hind legs only. The joints included for each leg is shown in <xref rid="tbl1" ref-type="table">Table 1</xref>.</p>
<table-wrap id="tbl1" orientation="portrait" position="float">
<label>Table 1:</label>
<caption><title>Joints included for leg models</title></caption>
<graphic xlink:href="589965v1_tbl1.tif" mime-subtype="tiff" mimetype="image"/>
</table-wrap>
<p>We write the Denavit-Hartenberg (DH) table of the leg model and use this to systematically derive the Euler-Langrange matrix equations of motion:
<disp-formula id="eqn4">
<graphic xlink:href="589965v1_eqn4.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <italic>τ</italic> is the vector of joint torques; <italic>θ</italic>, <inline-formula><inline-graphic xlink:href="589965v1_inline24.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="589965v1_inline25.gif" mime-subtype="gif" mimetype="image"/></inline-formula> are vectors of joint angles, angular velocity, and angular acceleration; <italic>M, C, B</italic>, are the inertia, Coriolis, and friction matrices, and <italic>g</italic> is the gravity vector.</p>
<p>Let us define the state to be the angles and angular derivatives <inline-formula><inline-graphic xlink:href="589965v1_inline26.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and input to be torques <italic>τ</italic>. We next rearrange (4) into the form, <inline-formula><inline-graphic xlink:href="589965v1_inline27.gif" mime-subtype="gif" mimetype="image"/></inline-formula> so that
<disp-formula id="eqn5">
<graphic xlink:href="589965v1_eqn5.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
To linearize this system, we choose equilibrium values <inline-formula><inline-graphic xlink:href="589965v1_inline28.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <inline-formula><inline-graphic xlink:href="589965v1_inline29.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, such that <inline-formula><inline-graphic xlink:href="589965v1_inline30.gif" mime-subtype="gif" mimetype="image"/></inline-formula>. In particular, <inline-formula><inline-graphic xlink:href="589965v1_inline31.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is taken to be the average joint angles for each leg joint computed from the data. It follows that <inline-formula><inline-graphic xlink:href="589965v1_inline32.gif" mime-subtype="gif" mimetype="image"/></inline-formula> and <inline-formula><inline-graphic xlink:href="589965v1_inline33.gif" mime-subtype="gif" mimetype="image"/></inline-formula> gives the desired equilibrium.</p>
<p>We linearized about this equilibrium point, which leads to an equation of the following form:
<disp-formula id="eqn6">
<graphic xlink:href="589965v1_eqn6.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="589965v1_inline34.gif" mime-subtype="gif" mimetype="image"/></inline-formula> <italic>A</italic> and <italic>B</italic> are the Jacobians with respect to <italic>q</italic> and <italic>τ</italic>, respectively. In other words,
<disp-formula id="eqn7">
<graphic xlink:href="589965v1_eqn7.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn8">
<graphic xlink:href="589965v1_eqn8.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
In our code, we use the SymPyBotics toolbox (<xref ref-type="bibr" rid="c66">Sousa, 2013</xref>) to obtain symbolic equations for the quantities in (4), then numerically compute Jacobian values.</p>
<p>Next, we rewrite the system in discrete time using a sampling interval <italic>T</italic>, which is typically chosen to be an integer multiple of sampling interval from the data (the tracking data was acquired every <italic>T</italic> = 1<bold>/</bold>300 seconds). In our controller simulations, we use <italic>T</italic> = 1<bold>/</bold>600 seconds. The discretized dynamics are thus written as:
<disp-formula id="eqn9">
<graphic xlink:href="589965v1_eqn9.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <italic>A</italic> = <italic>I</italic> + <italic>A</italic><sub><italic>c</italic></sub><italic>T</italic> and <italic>B</italic> = <italic>B</italic><sub><italic>c</italic></sub><italic>T</italic>.</p>
<p>Finally, we perform a coordinate shift to error dynamics. This allows us to apply standard control techniques for trajectory tracking. We define the tracking error to be <italic>y</italic> = <italic>q</italic> − <italic>q</italic><sub><italic>d</italic></sub>, where <italic>q</italic><sub><italic>d</italic></sub> is the desired state, and this error obeys the following dynamics:
<disp-formula id="eqn10a">
<graphic xlink:href="589965v1_eqn10a.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn10b">
<graphic xlink:href="589965v1_eqn10b.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <italic>w</italic> is the external perturbation. <italic>w</italic><sub><italic>traj</italic></sub> represents the effect of constantly changing trajectories — for example, if the desired trajectory at the current time-step is some value <italic>a</italic>, and the desired trajectory at the next time-step is some other value <italic>b</italic>, then this is equivalent to introducing a perturbation of <italic>b</italic> − <italic>a</italic>. Error <italic>y</italic> is of dimension <italic>n</italic><sub><italic>y</italic></sub> (8 for front legs, and 6 for the other legs), and input <italic>u</italic> is of dimension <inline-formula><inline-graphic xlink:href="589965v1_inline35.gif" mime-subtype="gif" mimetype="image"/></inline-formula>.</p>
<p>To include motor delay (known as <italic>actuation</italic> delay in controls literature) and sensory delay, we make use of an augmented state formulations as introduced in <xref ref-type="bibr" rid="c68">Stenberg et al. (2022)</xref>. Let the motor delay be <italic>d</italic><sub><italic>motor</italic></sub> steps and let the sensory delay be <italic>d</italic><sub><italic>sense</italic></sub> steps. Our augmented state vector <italic>z</italic>(<italic>t</italic>) is then written as follows:
<disp-formula id="eqn11">
<graphic xlink:href="589965v1_eqn11.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <italic>y</italic> is the error from (10); <italic>f</italic> contains predicted future errors up to <italic>d</italic><sub>motor</sub> time steps in the future of dimension <italic>d</italic><sub>motor</sub> * <italic>n</italic><sub><italic>y</italic></sub>; <italic>a</italic> contains motor signals from up to <italic>d</italic><sub>motor</sub> steps ago of dimension <italic>d</italic><sub>motor</sub> * <italic>n</italic><sub><italic>u</italic></sub>; <italic>s</italic> contains sensing signals from up to <italic>d</italic><sub>sense</sub> steps ago of dimension <italic>d</italic><sub>sense</sub> * <italic>n</italic><sub><italic>y</italic></sub>; and <italic>g</italic> contains information about future trajectory effects <italic>w</italic><sub>traj</sub> up to <italic>d</italic><sub>motor</sub> time steps in the future of dimension <italic>d</italic><sub>motor</sub> * <italic>n</italic><sub><italic>y</italic></sub>.</p>
<p>Finally, we write the overall system in the form of
<disp-formula id="eqn12">
<graphic xlink:href="589965v1_eqn12.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn13">
<graphic xlink:href="589965v1_eqn13.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <italic>F, G</italic>, and <italic>H</italic> are formulated using <italic>A</italic> and <italic>B</italic> according to techniques described in <xref ref-type="bibr" rid="c68">Stenberg et al. (2022)</xref>, and <italic>w</italic><sub><italic>aug</italic></sub>(<italic>t</italic>) contains the perturbations from (10), appropriately rearranged and zero-padded.</p>
<p>We note that <italic>u</italic> represents the motor signal, which must be delayed for some amount of timesteps (via <italic>a</italic>) before affecting the system; similarly, the sensory signal is delayed for several timesteps (via <italic>s</italic>) before reaching the controller via <italic>r</italic>.</p>
<p>To achieve effective trajectory tracking, we seek a control law under which <italic>y</italic> remains small. This can be achieved using the Linear Quadratic Gaussian (LQG) controller (Å ström and Murray, 2021) The controller is governed by the following equations:
<disp-formula id="eqn14">
<graphic xlink:href="589965v1_eqn14.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
<disp-formula id="eqn15">
<graphic xlink:href="589965v1_eqn15.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <inline-formula><inline-graphic xlink:href="589965v1_inline36.gif" mime-subtype="gif" mimetype="image"/></inline-formula> is the estimate of the state, estimated via a steady-state Kalman filter; <italic>L</italic> and <italic>K</italic> are the optimal observer and controller matrices, respectively, synthesized via discrete algebraic Riccati equations.</p>
</sec>
<sec id="s4e">
<label>4.5</label>
<title>Generate joint trajectories of the complete model with perturbations</title>
<p>The full model integrates all of the modules to generate trajectories of joint angles over time. The phase coordinator and trajectory generators combine to compute the desired joint angles <italic>θ</italic><sub><italic>i</italic></sub> for each leg <italic>i</italic>, and the controller implements them constrained by the dynamics. We run the full model at 600 Hz.</p>
<p>At each time step, we first update the phases of the legs <italic>ϕ</italic><sub><italic>i</italic></sub> based on the phase coupling equation above. Every 2 timesteps, we update the target joint angles <inline-formula><inline-graphic xlink:href="589965v1_inline37.gif" mime-subtype="gif" mimetype="image"/></inline-formula> using the trajectory generator model. We run the trajectory generator <italic>F</italic> for <italic>d</italic><sub>motor</sub> time steps on its own, by continually integrating its output. This future trajectory forms the basis of <italic>f</italic>, the predicted future errors used to guide the controller.</p>
<p>Each time step, we run the controller and dynamics model to control the torque <italic>τ</italic> so that the joint angles <italic>θ</italic> go towards the target joint angles <inline-formula><inline-graphic xlink:href="589965v1_inline38.gif" mime-subtype="gif" mimetype="image"/></inline-formula> If there is a disturbance, we apply it to the joint angles and derivatives at this point. Every 8 timesteps, we set <inline-formula><inline-graphic xlink:href="589965v1_inline39.gif" mime-subtype="gif" mimetype="image"/></inline-formula>, so that the trajectory generator predicts an intended trajectory in line with the current state.</p>
<p>For the perturbation numerical experiments described in the Results, we ran all simulations for 1800 timesteps at 600 Hz. For persistent stochastic perturbations, we applied the perturbation from 600th timestep to 1200th timestep. For impulse perturbations, we applied a single strong perturbation at 600th timestep.</p>
<p>We ran all our simulations on an Intel(R) Core(TM) i9-9940X CPU. We used GNU Parallel (<xref ref-type="bibr" rid="c74">Tange, 2011</xref>) to run simulations on multiple cores simultaneously.</p>
</sec>
<sec id="s4f">
<label>4.6</label>
<title>Computing Kinematic Similarity (KS) by quantifying likelihood of walking kinematics relative to ground truth</title>
<p>We followed a multi-step procedure in order to quantify the likelihood of the simulated walking kinematics relative to observed distribution of walking kinematics. This procedure is schematized in <xref rid="fig4" ref-type="fig">Fig. 4A</xref>.</p>
<p>To fit our likelihood model, we first performed Principal Components Analysis (PCA) to reduce the tracked joint angles from our 3D kinematics data to 2 dimensions per frame. To account for the circular nature of rotation angles, we performed PCA on the combination of sines and cosines of each angle. Next, we used a Gaussian Kernel Density Estimation (KDE) to estimate the probability density function of the principal components. Thus, we obtained a likelihood model for joint angle kinematics at each frame.</p>
<p>We chose 2 dimensions for PCA for two key reasons. First, these 2 dimensions alone accounted for a large portion of the variance in the data (43.1% total, with 30.5% for first component and 12.7% for second component). There was a big drop in variance explained from the first to the second component, but no sudden drop in the next 10 components. Second, the KDE procedure only works effectively in low-dimensional spaces, and the minimal number of dimensions needed to obtain circular dynamics for walking is 2.</p>
<p>We run our model described above to produce simulated joint angle trajectories. To estimate a likelihood of a simulated set of angles, we first projected them onto the same principal components identified from the observed kinematics. Then, we use the KDE model to estimate the logarithmic probability density function (log PDF) for each frame during the perturbation; we refer to this as the <italic>kinematic similarity (KS)</italic>. For persistent stochastic perturbations, we estimated mean KS during the perturbation, from 600th timestep to 1200th timestep. For impulse perturbations, we estimated mean KS in the transient recovery process, which we estimated to be from 610th timestep to the 800th timestep.</p>
</sec>
<sec id="s4g">
<label>4.7</label>
<title>Visualization of joint movement trajectories</title>
<p>For Video 1, we visualized the simulated and real joint movements using the biomechanical fly body model from <xref ref-type="bibr" rid="c77">Vaxenburg et al. (2024)</xref>. For each frame, we ran an inverse kinematics optimization over the model angles to match the simulated or real joint positions of the fly. We did not simulate realistic physics of the fly legs and their interactions with the ground in these visualizations. In our data, the fly thorax was fixed and the wings were removed, so in these visualizations, we also fixed every other degree-of-freedom in the fly model besides the 6 legs. For the remaining videos, we visualized the joints as ball-and-stick models using matplotlib (<xref ref-type="bibr" rid="c42">Hunter, 2007</xref>).</p>
</sec>
<sec id="s4h">
<label>4.8</label>
<title>Code and data availability</title>
<p>Code is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/lambdaloop/layered-walking/">https://github.com/lambdaloop/layered-walking/</ext-link>. The data used in this study will be released publicly upon publication and privately by request.</p>
</sec>
</sec>
</body>
<back>
<sec id="s5">
<title>Contributions</title>
<p>LK, JSL, SLB, JCT, and BWB conceived of the study. LK and JSL developed the model, ran simulations, and performed the analyses. GMC and SW-B collected data of fly walking. LK and GMC visualized the walking fly videos. LK, JSL, JCT, and BWB interpreted the results and wrote the paper. All authors reviewed and edited the paper.</p>
</sec>
<ack>
<title>Acknowledgments</title>
<p>We thank J. Doyle for initial discussions on layered feedback models, N. Csomay-Shanklin for initial discussions on deriving models of legged locomotion, A. Nair for discussions around coupled oscillator models, A. Schwarze for discussions around sensorimotor feedback loops, E. Dickinson for technical assistance, and members of the Tuthill and Brunton labs for helpful discussions and feedback on this manuscript. We are grateful to R. Vaxenburg, I. Siwanowicz, and S. Turaga for help adapting their virtual fly model for visualizing real and simulated fly walking.</p>
<p>This work has been funded by a National Science Foundation Graduate Research Fellowship to LK; a NSERC Postgraduate Scholarship (NSERC PGSD3-557385-2021) to JSL; a Searle Scholar Award, a Klingenstein-Simons Fellowship, a Pew Biomedical Scholar Award, a McKnight Scholar Award, a Sloan Research Fellowship, the New York Stem Cell Foundation, and NIH R01NS102333 to JCT; JCT is a New York Stem Cell Foundation – Robertson Investigator; Air Force Office of Scientific Research award FA9550-19-1-0386 and the Richard &amp; Joan Komen University Chair to BWB.</p>
</ack>
<ref-list>
<title>References</title>
<ref id="c1"><mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><given-names>M.</given-names> <surname>Abadi</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Agarwal</surname></string-name>, <string-name><given-names>P.</given-names> <surname>Barham</surname></string-name>, <string-name><given-names>E.</given-names> <surname>Brevdo</surname></string-name>, <string-name><given-names>Z.</given-names> <surname>Chen</surname></string-name>, <string-name><given-names>C.</given-names> <surname>Citro</surname></string-name>, <string-name><given-names>G. S.</given-names> <surname>Corrado</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Davis</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Dean</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Devin</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Ghemawat</surname></string-name>, <string-name><given-names>I.</given-names> <surname>Goodfellow</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Harp</surname></string-name>, <string-name><given-names>G.</given-names> <surname>Irving</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Isard</surname></string-name>, <string-name><given-names>Y.</given-names> <surname>Jia</surname></string-name>, <string-name><given-names>R.</given-names> <surname>Jozefowicz</surname></string-name>, <string-name><given-names>L.</given-names> <surname>Kaiser</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Kudlur</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Levenberg</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Mane</surname></string-name>, <string-name><given-names>R.</given-names> <surname>Monga</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Moore</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Murray</surname></string-name>, <string-name><given-names>C.</given-names> <surname>Olah</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Schuster</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Shlens</surname></string-name>, <string-name><given-names>B.</given-names> <surname>Steiner</surname></string-name>, <string-name><given-names>I.</given-names> <surname>Sutskever</surname></string-name>, <string-name><given-names>K.</given-names> <surname>Talwar</surname></string-name>, <string-name><given-names>P.</given-names> <surname>Tucker</surname></string-name>, <string-name><given-names>V.</given-names> <surname>Vanhoucke</surname></string-name>, <string-name><given-names>V.</given-names> <surname>Vasudevan</surname></string-name>, <string-name><given-names>F.</given-names> <surname>Viegas</surname></string-name>, <string-name><given-names>O.</given-names> <surname>Vinyals</surname></string-name>, <string-name><given-names>P.</given-names> <surname>Warden</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Wattenberg</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Wicke</surname></string-name>, <string-name><given-names>Y.</given-names> <surname>Yu</surname></string-name>, and <string-name><given-names>X.</given-names> <surname>Zheng</surname></string-name></person-group>. <source>TensorFlow: Large-Scale Machine Learning on Heterogeneous Distributed Systems</source>, <year>2015</year>.</mixed-citation></ref>
<ref id="c2"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>J. A. Acebró</given-names> <surname>n</surname></string-name>, <string-name><given-names>L. L.</given-names> <surname>Bonilla</surname></string-name>, <string-name><given-names>C. J. P.</given-names> <surname>Vicente</surname></string-name>, <string-name><given-names>F.</given-names> <surname>Ritort</surname></string-name>, and <string-name><given-names>R.</given-names> <surname>Spigler</surname></string-name></person-group>. <article-title>The kuramoto model: A simple paradigm for synchronization phenomena</article-title>. <source>Reviews of modern physics</source>, <volume>77</volume>(<issue>1</issue>):<fpage>137</fpage>, <year>2005</year>.</mixed-citation></ref>
<ref id="c3"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Y.</given-names> <surname>Akiyama</surname></string-name>, <string-name><given-names>K.</given-names> <surname>Iwabuchi</surname></string-name>, <string-name><given-names>Y.</given-names> <surname>Furukawa</surname></string-name>, and <string-name><given-names>K.</given-names> <surname>Morishima</surname></string-name></person-group>. <article-title>Electrical stimulation of cultured lepidopteran dorsal vessel tissue: an experiment for development of bioactuators</article-title>. <source>In Vitro Cellular &amp; Developmental Biology-Animal</source>, <volume>46</volume>:<fpage>411</fpage>–<lpage>415</lpage>, <year>2010</year>.</mixed-citation></ref>
<ref id="c4"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Z.</given-names> <surname>Aminzare</surname></string-name>, <string-name><given-names>V.</given-names> <surname>Srivastava</surname></string-name>, and <string-name><given-names>P.</given-names> <surname>Holmes</surname></string-name></person-group>. <article-title>Gait Transitions in a Phase Oscillator Model of an Insect Central Pattern Generator</article-title>. <source>SIAM Journal on Applied Dynamical Systems</source>, <volume>17</volume>(<issue>1</issue>):<fpage>626</fpage>– <lpage>671</lpage>, <year>2018</year>. ISSN <issn>1536-0040</issn>. doi:<pub-id pub-id-type="doi">10.1137/17M1125571</pub-id>. URL <ext-link ext-link-type="uri" xlink:href="https://epubs.siam.org/doi/10.1137/17M1125571">https://epubs.siam.org/doi/10.1137/17M1125571</ext-link>.</mixed-citation></ref>
<ref id="c5"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>J. C.</given-names> <surname>Arevalo</surname></string-name> and <string-name><given-names>E.</given-names> <surname>Garcia</surname></string-name></person-group>. <article-title>Impedance control for legged robots: An insight into the concepts involved</article-title>. <source>IEEE Transactions on Systems, Man, and Cybernetics, Part C (Applications and Reviews)</source>, <volume>42</volume>(<issue>6</issue>):<fpage>1400</fpage>–<lpage>1411</lpage>, <year>2012</year>.</mixed-citation></ref>
<ref id="c6"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>M. S.</given-names> <surname>Ashtiani</surname></string-name>, <string-name><given-names>A. Aghamaleki</given-names> <surname>Sarvestani</surname></string-name>, and <string-name><given-names>A.</given-names> <surname>Badri-Spröwitz</surname></string-name></person-group>. <article-title>Hybrid parallel compliance allows robots to operate with sensorimotor delays and low control frequencies</article-title>. <source>Frontiers in Robotics and AI</source>, <volume>8</volume>, <year>2021</year>.</mixed-citation></ref>
<ref id="c7"><mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><given-names>K. J.</given-names> <surname>Åström</surname></string-name> and <string-name><given-names>R. M.</given-names> <surname>Murray</surname></string-name></person-group>. <source>Feedback systems: an introduction for scientists and engineers</source>. <publisher-name>Princeton university press</publisher-name>, <year>2021</year>.</mixed-citation></ref>
<ref id="c8"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>A.</given-names> <surname>Ayali</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Borgmann</surname></string-name>, <string-name><given-names>A. B</given-names> <surname>üschges</surname></string-name>, <string-name><given-names>E.</given-names> <surname>Couzin-Fuchs</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Daun-Gruhn</surname></string-name>, and <string-name><given-names>P.</given-names> <surname>Holmes</surname></string-name></person-group>. <article-title>The comparative investigation of the stick insect and cockroach models in the study of insect locomotion</article-title>. <source>Current Opinion in Insect Science</source>, <volume>12</volume>:<fpage>1</fpage>–<lpage>10</lpage>, <month>Dec</month>. <year>2015a</year>. ISSN <issn>22145745</issn>. doi:<pub-id pub-id-type="doi">10.1016/j.cois.2015.07.004</pub-id>.</mixed-citation></ref>
<ref id="c9"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>A.</given-names> <surname>Ayali</surname></string-name>, <string-name><given-names>E.</given-names> <surname>Couzin-Fuchs</surname></string-name>, <string-name><given-names>I.</given-names> <surname>David</surname></string-name>, <string-name><given-names>O.</given-names> <surname>Gal</surname></string-name>, <string-name><given-names>P.</given-names> <surname>Holmes</surname></string-name>, and <string-name><given-names>D.</given-names> <surname>Knebel</surname></string-name></person-group>. <article-title>Sensory feedback in cock-roach locomotion: Current knowledge and open questions</article-title>. <source>Journal of Comparative Physiology A</source>, <volume>201</volume>(<issue>9</issue>):<fpage>841</fpage>–<lpage>850</lpage>, <month>Sept</month>. <year>2015b</year>. ISSN <issn>1432-1351</issn>. doi:<pub-id pub-id-type="doi">10.1007/s00359-014-0968-1</pub-id>.</mixed-citation></ref>
<ref id="c10"><mixed-citation publication-type="preprint"><person-group person-group-type="author"><string-name><given-names>A.</given-names> <surname>Azevedo</surname></string-name>, <string-name><given-names>E.</given-names> <surname>Lesser</surname></string-name>, <string-name><given-names>B.</given-names> <surname>Mark</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Phelps</surname></string-name>, <string-name><given-names>L.</given-names> <surname>Elabbady</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Kuroda</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Sustar</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Moussa</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Kandelwal</surname></string-name>, <string-name><given-names>C. J.</given-names> <surname>Dallmann</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Agrawal</surname></string-name>, <string-name><given-names>S.-Y. J.</given-names> <surname>Lee</surname></string-name>, <string-name><given-names>B.</given-names> <surname>Pratt</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Cook</surname></string-name>, <string-name><given-names>K.</given-names> <surname>Skutt-Kakaria</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Gerhard</surname></string-name>, <string-name><given-names>R.</given-names> <surname>Lu</surname></string-name>, <string-name><given-names>N.</given-names> <surname>Kemnitz</surname></string-name>, <string-name><given-names>K.</given-names> <surname>Lee</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Halageri</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Castro</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Ih</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Gager</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Tammam</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Dorkenwald</surname></string-name>, <string-name><given-names>F.</given-names> <surname>Collman</surname></string-name>, <string-name><given-names>C.</given-names> <surname>Schneider-Mizell</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Brittain</surname></string-name>, <string-name><given-names>C. S.</given-names> <surname>Jordan</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Dickinson</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Pacureanu</surname></string-name>, <string-name><given-names>H. S.</given-names> <surname>Seung</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Macrina</surname></string-name>, <string-name><given-names>W.-C. A.</given-names> <surname>Lee</surname></string-name>, and <string-name><given-names>J. C.</given-names> <surname>Tuthill</surname></string-name></person-group>. <article-title>Tools for comprehensive reconstruction and analysis of Drosophila motor circuits</article-title>. <source>bioRxiv</source>, <month>Dec</month>. <year>2022</year>. doi:<pub-id pub-id-type="doi">10.1101/2022.12.15.520299</pub-id>.</mixed-citation></ref>
<ref id="c11"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>A. W.</given-names> <surname>Azevedo</surname></string-name>, <string-name><given-names>E. S.</given-names> <surname>Dickinson</surname></string-name>, <string-name><given-names>P.</given-names> <surname>Gurung</surname></string-name>, <string-name><given-names>L.</given-names> <surname>Venkatasubramanian</surname></string-name>, <string-name><given-names>R. S.</given-names> <surname>Mann</surname></string-name>, and <string-name><given-names>J. C.</given-names> <surname>Tuthill</surname></string-name></person-group>. <article-title>A size principle for recruitment of drosophila leg motor neurons</article-title>. <source>Elife</source>, <volume>9</volume>:<fpage>e56754</fpage>, <year>2020</year>.</mixed-citation></ref>
<ref id="c12"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>A.</given-names> <surname>Banerjee</surname></string-name>, <string-name><given-names>R.</given-names> <surname>Egger</surname></string-name>, and <string-name><given-names>M. A.</given-names> <surname>Long</surname></string-name></person-group>. <article-title>Using focal cooling to link neural dynamics and behavior</article-title>. <source>Neuron</source>, <volume>109</volume>(<issue>16</issue>):<fpage>2508</fpage>–<lpage>2518</lpage>, <month>Aug</month>. <year>2021</year>. ISSN <issn>0896-6273</issn>. doi:<pub-id pub-id-type="doi">10.1016/j.neuron.2021.05.029</pub-id>.</mixed-citation></ref>
<ref id="c13"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>U.</given-names> <surname>Bässler</surname></string-name></person-group>. <article-title>Sensory control of leg movement in the stick insect Carausius morosus</article-title>. <source>Biological Cybernetics</source>, <volume>25</volume>(<issue>2</issue>):<fpage>61</fpage>–<lpage>72</lpage>, <month>June</month> <year>1977</year>. ISSN <issn>1432-0770</issn>. doi:<pub-id pub-id-type="doi">10.1007/BF00337264</pub-id>.</mixed-citation></ref>
<ref id="c14"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>J.</given-names> <surname>Berberich</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Köhler</surname></string-name>, <string-name><given-names>M. A. M</given-names> <surname>üller</surname></string-name>, and <string-name><given-names>F.</given-names> <surname>Allgöwer</surname></string-name></person-group>. <article-title>Linear tracking mpc for nonlinear systems—part i: The model-based case</article-title>. <source>IEEE Transactions on Automatic Control</source>, <volume>67</volume>(<issue>9</issue>):<fpage>4390</fpage>–<lpage>4405</lpage>, <year>2022</year>.</mixed-citation></ref>
<ref id="c15"><mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><given-names>S. L.</given-names> <surname>Brunton</surname></string-name> and <string-name><given-names>J. N.</given-names> <surname>Kutz</surname></string-name></person-group>. <source>Data-Driven Science and Engineering: Machine Learning, Dynamical Systems, and Control</source>. <publisher-name>Cambridge University Press</publisher-name>, <edition>2nd</edition> edition, <year>2022</year>.</mixed-citation></ref>
<ref id="c16"><mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><given-names>M.</given-names> <surname>Buss</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Glocker</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Hardt</surname></string-name>, <string-name><given-names>O.</given-names> <surname>Von Stryk</surname></string-name>, <string-name><given-names>R.</given-names> <surname>Bulirsch</surname></string-name>, and <string-name><given-names>G.</given-names> <surname>Schmidt</surname></string-name></person-group>. <chapter-title>Nonlinear hybrid dynamical systems: modeling, optimal control, and applications</chapter-title>. <source>In Modelling, Analysis, and Design of Hybrid Systems</source>, pages <fpage>311</fpage>–<lpage>335</lpage>. <publisher-name>Springer</publisher-name>, <year>2002</year>.</mixed-citation></ref>
<ref id="c17"><mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><given-names>E. F.</given-names> <surname>Camacho</surname></string-name> and <string-name><given-names>C. B.</given-names> <surname>Alba</surname></string-name></person-group>. <source>Model predictive control</source>. <publisher-name>Springer Science &amp; Business Media</publisher-name>, <year>2013</year>.</mixed-citation></ref>
<ref id="c18"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>G.</given-names> <surname>Catavitello</surname></string-name>, <string-name><given-names>Y.</given-names> <surname>Ivanenko</surname></string-name>, and <string-name><given-names>F.</given-names> <surname>Lacquaniti</surname></string-name></person-group>. <article-title>A kinematic synergy for terrestrial locomotion shared by mammals and birds</article-title>. <source>eLife</source>, <volume>7</volume>:<fpage>e38190</fpage>, <month>Oct</month>. <year>2018</year>. ISSN <issn>2050-084X</issn>. doi:<pub-id pub-id-type="doi">10.7554/eLife.38190</pub-id>.</mixed-citation></ref>
<ref id="c19"><mixed-citation publication-type="preprint"><person-group person-group-type="author"><string-name><given-names>H. S. J.</given-names> <surname>Cheong</surname></string-name>, <string-name><given-names>K.</given-names> <surname>Eichler</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Stuerner</surname></string-name>, <string-name><given-names>S. K.</given-names> <surname>Asinof</surname></string-name>, <string-name><given-names>A. S.</given-names> <surname>Champion</surname></string-name>, <string-name><given-names>E. C.</given-names> <surname>Marin</surname></string-name>, <string-name><given-names>T. B.</given-names> <surname>Oram</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Sumathipala</surname></string-name>, <string-name><given-names>L.</given-names> <surname>Venkatasubramanian</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Namiki</surname></string-name>, <string-name><given-names>I.</given-names> <surname>Siwanowicz</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Costa</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Berg</surname></string-name>, <string-name><given-names>J. F. P.</given-names> <surname>Team</surname></string-name>, <string-name><given-names>G. S. X. E.</given-names> <surname>Jefferis</surname></string-name>, and <string-name><given-names>G. M.</given-names> <surname>Card</surname></string-name></person-group>. <article-title>Transforming descending input into behavior: The organization of premotor circuits in the Drosophila Male Adult Nerve Cord connectome</article-title>. <source>bioRxiv</source>, <month>June</month> <year>2023</year>. doi:<pub-id pub-id-type="doi">10.1101/2023.06.07.543976</pub-id>.</mixed-citation></ref>
<ref id="c20"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>M.</given-names> <surname>Chiang</surname></string-name>, <string-name><given-names>S. H.</given-names> <surname>Low</surname></string-name>, <string-name><given-names>A. R.</given-names> <surname>Calderbank</surname></string-name>, and <string-name><given-names>J. C.</given-names> <surname>Doyle</surname></string-name></person-group>. <article-title>Layering as optimization decomposition: A mathematical theory of network architectures</article-title>. <source>Proceedings of the IEEE</source>, <volume>95</volume>(<issue>1</issue>):<fpage>255</fpage>–<lpage>312</lpage>, <year>2007</year>. doi:<pub-id pub-id-type="doi">10.1109/JPROC.2006.887322</pub-id>.</mixed-citation></ref>
<ref id="c21"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>C.</given-names> <surname>Chun</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Biswas</surname></string-name>, and <string-name><given-names>V.</given-names> <surname>Bhandawat</surname></string-name></person-group>. <article-title>Drosophila uses a tripod gait across all walking speeds, and the geometry of the tripod is important for speed control</article-title>. <source>eLife</source>, <volume>10</volume>:<fpage>e65878</fpage>, <month>feb</month> <year>2021</year>. doi:<pub-id pub-id-type="doi">10.7554/eLife.65878</pub-id>.</mixed-citation></ref>
<ref id="c22"><mixed-citation publication-type="preprint"><person-group person-group-type="author"><string-name><given-names>D.-A.</given-names> <surname>Clevert</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Unterthiner</surname></string-name>, and <string-name><given-names>S.</given-names> <surname>Hochreiter</surname></string-name></person-group>. <article-title>Fast and accurate deep network learning by exponential linear units (elus)</article-title>. <source>arXiv</source> arXiv:<pub-id pub-id-type="arxiv">1511.07289</pub-id>, <year>2015</year>.</mixed-citation></ref>
<ref id="c23"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>E.</given-names> <surname>Couzin-Fuchs</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Kiemel</surname></string-name>, <string-name><given-names>O.</given-names> <surname>Gal</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Ayali</surname></string-name>, and <string-name><given-names>P.</given-names> <surname>Holmes</surname></string-name></person-group>. <article-title>Intersegmental coupling and recovery from perturbations in freely running cockroaches</article-title>. <source>Journal of Experimental Biology</source>, <volume>218</volume>(<issue>2</issue>):<fpage>285</fpage>– <lpage>297</lpage>, <year>2015</year>. doi:<pub-id pub-id-type="doi">10.1242/jeb.112805</pub-id>.</mixed-citation></ref>
<ref id="c24"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>T. L.</given-names> <surname>Cruz</surname></string-name> and <string-name><given-names>M. E.</given-names> <surname>Chiappe</surname></string-name></person-group>. <article-title>Multilevel visuomotor control of locomotion in drosophila</article-title>. <source>Current Opinion in Neurobiology</source>, <volume>82</volume>:<fpage>102774</fpage>, <year>2023</year>.</mixed-citation></ref>
<ref id="c25"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>M. A.</given-names> <surname>Daley</surname></string-name></person-group>. <article-title>Understanding the agility of running birds: sensorimotor and mechanical factors in avian bipedal locomotion</article-title>. <source>Integrative and comparative biology</source>, <volume>58</volume>(<issue>5</issue>):<fpage>884</fpage>–<lpage>893</lpage>, <year>2018</year>.</mixed-citation></ref>
<ref id="c26"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>C. J.</given-names> <surname>Dallmann</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Hoinville</surname></string-name>, <string-name><given-names>V. D</given-names> <surname>ürr</surname></string-name>, and <string-name><given-names>J.</given-names> <surname>Schmitz</surname></string-name></person-group>. <article-title>A load-based mechanism for inter-leg coor-dination in insects</article-title>. <source>Proceedings of the Royal Society B: Biological Sciences</source>, <volume>284</volume>(<issue>1868</issue>):<fpage>20171755</fpage>, <year>2017</year>.</mixed-citation></ref>
<ref id="c27"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>C. J.</given-names> <surname>Dallmann</surname></string-name>, <string-name><given-names>P.</given-names> <surname>Karashchuk</surname></string-name>, <string-name><given-names>B. W.</given-names> <surname>Brunton</surname></string-name>, and <string-name><given-names>J. C.</given-names> <surname>Tuthill</surname></string-name></person-group>. <article-title>A leg to stand on: computational models of proprioception</article-title>. <source>Current Opinion in Physiology</source>, <volume>22</volume>:<fpage>100426</fpage>, <year>2021</year>. doi:<pub-id pub-id-type="doi">10.1016/j.cophys.2021.03.001</pub-id>.</mixed-citation></ref>
<ref id="c28"><mixed-citation publication-type="preprint"><person-group person-group-type="author"><string-name><given-names>C. J.</given-names> <surname>Dallmann</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Agrawal</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Cook</surname></string-name>, <string-name><given-names>B. W.</given-names> <surname>Brunton</surname></string-name>, and <string-name><given-names>J. C.</given-names> <surname>Tuthill</surname></string-name></person-group>. <article-title>Presynaptic inhibition selectively suppresses leg proprioception in behaving Drosophila</article-title>. <source>bioRxiv</source>, <month>Oct</month>. <year>2023</year>. doi:<pub-id pub-id-type="doi">10.1101/2023.10.20.563322</pub-id>.</mixed-citation></ref>
<ref id="c29"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>B. D.</given-names> <surname>Deangelis</surname></string-name>, <string-name><given-names>J. A.</given-names> <surname>Zavatone-Veth</surname></string-name>, and <string-name><given-names>D. A.</given-names> <surname>Clark</surname></string-name></person-group>. <article-title>The manifold structure of limb coordination in walking drosophila</article-title>. <source>eLife</source>, <volume>8</volume>:<fpage>1</fpage>–<lpage>33</lpage>, <year>2019</year>. doi:<pub-id pub-id-type="doi">10.7554/eLife.46409</pub-id>.</mixed-citation></ref>
<ref id="c30"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>M.</given-names> <surname>Desmurget</surname></string-name> and <string-name><given-names>S.</given-names> <surname>Grafton</surname></string-name></person-group>. <article-title>Forward modeling allows feedback control for fast reaching movements</article-title>. <source>Trends in cognitive sciences</source>, <volume>4</volume>(<issue>11</issue>):<fpage>423</fpage>–<lpage>431</lpage>, <year>2000</year>.</mixed-citation></ref>
<ref id="c31"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>J. C.</given-names> <surname>Doyle</surname></string-name> and <string-name><given-names>M.</given-names> <surname>Csete</surname></string-name></person-group>. <article-title>Architecture, constraints, and behavior</article-title>. <source>Proceedings of the National Academy of Sciences</source>, <volume>108</volume>(<issue>Supplement 3</issue>):<fpage>15624</fpage>–<lpage>15630</lpage>, <year>2011</year>.</mixed-citation></ref>
<ref id="c32"><mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><given-names>J. C.</given-names> <surname>Doyle</surname></string-name>, <string-name><given-names>B. A.</given-names> <surname>Francis</surname></string-name>, and <string-name><given-names>A. R.</given-names> <surname>Tannenbaum</surname></string-name></person-group>. <source>Feedback control theory</source>. <publisher-name>Courier Corporation</publisher-name>, <year>2013</year>.</mixed-citation></ref>
<ref id="c33"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>D. W.</given-names> <surname>Franklin</surname></string-name> and <string-name><given-names>D. M.</given-names> <surname>Wolpert</surname></string-name></person-group>. <article-title>Computational mechanisms of sensorimotor control</article-title>. <source>Neuron</source>, <volume>72</volume>(<issue>3</issue>):<fpage>425</fpage>–<lpage>442</lpage>, <year>2011</year>.</mixed-citation></ref>
<ref id="c34"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>D. S.</given-names> <surname>Galili</surname></string-name>, <string-name><given-names>G. S.</given-names> <surname>Jefferis</surname></string-name>, and <string-name><given-names>M.</given-names> <surname>Costa</surname></string-name></person-group>. <article-title>Connectomics and the neural basis of behaviour</article-title>. <source>Current opinion in insect science</source>, <volume>54</volume>:<fpage>100968</fpage>, <year>2022</year>.</mixed-citation></ref>
<ref id="c35"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>C. E.</given-names> <surname>Garcia</surname></string-name>, <string-name><given-names>D. M.</given-names> <surname>Prett</surname></string-name>, and <string-name><given-names>M.</given-names> <surname>Morari</surname></string-name></person-group>. <article-title>Model predictive control: theory and practice—a survey</article-title>. <source>Automatica</source>, <volume>25</volume>(<issue>3</issue>):<fpage>335</fpage>–<lpage>348</lpage>, <year>1989</year>.</mixed-citation></ref>
<ref id="c36"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>T.</given-names> <surname>Geijtenbeek</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Van De Panne</surname></string-name>, and <string-name><given-names>A. F.</given-names> <surname>Van Der Stappen</surname></string-name></person-group>. <article-title>Flexible muscle-based locomotion for bipedal creatures</article-title>. <source>ACM Transactions on Graphics (TOG)</source>, <volume>32</volume>(<issue>6</issue>):<fpage>1</fpage>–<lpage>11</lpage>, <year>2013</year>.</mixed-citation></ref>
<ref id="c37"><mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><given-names>C.</given-names> <surname>Goldsmith</surname></string-name>, <string-name><given-names>N.</given-names> <surname>Szczecinski</surname></string-name>, and <string-name><given-names>R.</given-names> <surname>Quinn</surname></string-name></person-group>. <chapter-title>Drosophibot: A fruit fly inspired bio-robot</chapter-title>. <source>In Biomimetic and Biohybrid Systems</source>, pages <fpage>146</fpage>–<lpage>157</lpage>. <publisher-name>Springer International Publishing</publisher-name>, <year>2019</year>. doi:<pub-id pub-id-type="doi">10.1007/978-3-030-24741-613</pub-id>.</mixed-citation></ref>
<ref id="c38"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>C. A.</given-names> <surname>Goldsmith</surname></string-name>, <string-name><given-names>N. S.</given-names> <surname>Szczecinski</surname></string-name>, and <string-name><given-names>R. D.</given-names> <surname>Quinn</surname></string-name></person-group>. <article-title>Neurodynamic modeling of the fruit fly drosophila melanogaster</article-title>. <source>Bioinspiration and Biomimetics</source>, <volume>15</volume>(<issue>6</issue>), <year>2020</year>. doi:<pub-id pub-id-type="doi">10.1088/1748-3190/ab9e52</pub-id>.</mixed-citation></ref>
<ref id="c39"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>A. I.</given-names> <surname>Goncalves</surname></string-name>, <string-name><given-names>J. A.</given-names> <surname>Zavatone-Veth</surname></string-name>, <string-name><given-names>M. R.</given-names> <surname>Carey</surname></string-name>, and <string-name><given-names>D. A.</given-names> <surname>Clark</surname></string-name></person-group>. <article-title>Parallel locomotor control strategies in mice and flies</article-title>. <source>Current Opinion in Neurobiology</source>, <volume>73</volume>:<fpage>102516</fpage>, <year>2022</year>. doi:<pub-id pub-id-type="doi">10.1016/j.conb.2022.01.001</pub-id>.</mixed-citation></ref>
<ref id="c40"><mixed-citation publication-type="preprint"><person-group person-group-type="author"><string-name><given-names>N.</given-names> <surname>Heess</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Tb</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Sriram</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Lemmon</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Merel</surname></string-name>, <string-name><given-names>G.</given-names> <surname>Wayne</surname></string-name>, <string-name><given-names>Y.</given-names> <surname>Tassa</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Erez</surname></string-name>, <string-name><given-names>Z.</given-names> <surname>Wang</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Eslami</surname></string-name>, <etal>et al.</etal></person-group> <article-title>Emergence of locomotion behaviours in rich environments</article-title>. <source>arXiv</source> arXiv:<pub-id pub-id-type="arxiv">1707.02286</pub-id>, <year>2017</year>.</mixed-citation></ref>
<ref id="c41"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>D.</given-names> <surname>Holden</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Komura</surname></string-name>, and <string-name><given-names>J.</given-names> <surname>Saito</surname></string-name></person-group>. <article-title>Phase-functioned neural networks for character control</article-title>. <source>ACM Transactions on Graphics</source>, <volume>36</volume>(<issue>4</issue>):<fpage>42</fpage>:1–42:13, <month>July</month> <year>2017</year>. doi:<pub-id pub-id-type="doi">10.1145/3072959.3073663</pub-id>.</mixed-citation></ref>
<ref id="c42"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>J. D.</given-names> <surname>Hunter</surname></string-name></person-group>. <article-title>Matplotlib: A 2d graphics environment</article-title>. <source>Computing in Science &amp; Engineering</source>, <volume>9</volume>(<issue>3</issue>): <fpage>90</fpage>–<lpage>95</lpage>, <year>2007</year>. doi:<pub-id pub-id-type="doi">10.1109/MCSE.2007.55</pub-id>.</mixed-citation></ref>
<ref id="c43"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>P.</given-names> <surname>Karashchuk</surname></string-name>, <string-name><given-names>K. L.</given-names> <surname>Rupp</surname></string-name>, <string-name><given-names>E. S.</given-names> <surname>Dickinson</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Walling-Bell</surname></string-name>, <string-name><given-names>E.</given-names> <surname>Sanders</surname></string-name>, <string-name><given-names>E.</given-names> <surname>Azim</surname></string-name>, <string-name><given-names>B. W.</given-names> <surname>Brunton</surname></string-name>, and <string-name><given-names>J. C.</given-names> <surname>Tuthill</surname></string-name></person-group>. <article-title>Anipose: a toolkit for robust markerless 3d pose estimation</article-title>. <source>Cell reports</source>, <volume>36</volume> (<issue>13</issue>):<fpage>109730</fpage>, <year>2021</year>.</mixed-citation></ref>
<ref id="c44"><mixed-citation publication-type="preprint"><person-group person-group-type="author"><string-name><given-names>D. P.</given-names> <surname>Kingma</surname></string-name> and <string-name><given-names>J.</given-names> <surname>Ba</surname></string-name></person-group>. <article-title>Adam: A Method for Stochastic Optimization</article-title>. <source>arXiv</source>:<pub-id pub-id-type="arxiv">1412.6980</pub-id> [cs], <month>Jan</month>. <year>2017</year>.</mixed-citation></ref>
<ref id="c45"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>R.</given-names> <surname>Kottmeier</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Bittern</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Schoofs</surname></string-name>, <string-name><given-names>F.</given-names> <surname>Scheiwe</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Matzat</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Pankratz</surname></string-name>, and <string-name><given-names>C.</given-names> <surname>Klämbt</surname></string-name></person-group>. <article-title>Wrapping glia regulates neuronal signaling speed and precision in the peripheral nervous system of drosophila</article-title>. <source>Nature communications</source>, <volume>11</volume>(<issue>1</issue>):<fpage>4491</fpage>, <year>2020</year>.</mixed-citation></ref>
<ref id="c46"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>D.</given-names> <surname>Labonte</surname></string-name>, <string-name><given-names>P. J.</given-names> <surname>Bishop</surname></string-name>, <string-name><given-names>T. J.</given-names> <surname>Dick</surname></string-name>, and <string-name><given-names>C. J.</given-names> <surname>Clemente</surname></string-name></person-group>. <article-title>Dynamic similarity and the peculiar allometry of maximum running speed</article-title>. <source>Nature Communications</source>, <volume>15</volume>(<issue>1</issue>):<fpage>2181</fpage>, <year>2024</year>.</mixed-citation></ref>
<ref id="c47"><mixed-citation publication-type="preprint"><person-group person-group-type="author"><string-name><given-names>E.</given-names> <surname>Lesser</surname></string-name>, <string-name><given-names>A. W.</given-names> <surname>Azevedo</surname></string-name>, <string-name><given-names>J. S.</given-names> <surname>Phelps</surname></string-name>, <string-name><given-names>L.</given-names> <surname>Elabbady</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Cook</surname></string-name>, <string-name><given-names>B.</given-names> <surname>Mark</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Kuroda</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Sustar</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Moussa</surname></string-name>, <string-name><given-names>C. J.</given-names> <surname>Dallmann</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Agrawal</surname></string-name>, <string-name><given-names>S.-Y. J.</given-names> <surname>Lee</surname></string-name>, <string-name><given-names>B.</given-names> <surname>Pratt</surname></string-name>, <string-name><given-names>K.</given-names> <surname>Skutt-Kakaria</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Gerhard</surname></string-name>, <string-name><given-names>R.</given-names> <surname>Lu</surname></string-name>, <string-name><given-names>N.</given-names> <surname>Kemnitz</surname></string-name>, <string-name><given-names>K.</given-names> <surname>Lee</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Halageri</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Castro</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Ih</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Gager</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Tammam</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Dorkenwald</surname></string-name>, <string-name><given-names>F.</given-names> <surname>Collman</surname></string-name>, <string-name><given-names>C.</given-names> <surname>Schneider-Mizell</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Brittain</surname></string-name>, <string-name><given-names>C. S.</given-names> <surname>Jordan</surname></string-name>, <string-name><given-names>H. S.</given-names> <surname>Seung</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Macrina</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Dickinson</surname></string-name>, <string-name><given-names>W.-C. A.</given-names> <surname>Lee</surname></string-name>, and <string-name><given-names>J. C.</given-names> <surname>Tuthill</surname></string-name></person-group>. <article-title>Synaptic architecture of leg and wing motor control networks in Drosophila</article-title>. <source>bioRxiv</source>, <month>May</month> <year>2023</year>.</mixed-citation></ref>
<ref id="c48"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>J. S.</given-names> <surname>Li</surname></string-name>, <string-name><given-names>A. A.</given-names> <surname>Sarma</surname></string-name>, <string-name><given-names>T. J.</given-names> <surname>Sejnowski</surname></string-name>, and <string-name><given-names>J. C.</given-names> <surname>Doyle</surname></string-name></person-group>. <article-title>Internal feedback in the cortical perception– action loop enables fast and accurate behavior</article-title>. <source>Proceedings of the National Academy of Sciences</source>, <volume>120</volume>(<issue>39</issue>):<fpage>e2300445120</fpage>, <year>2023</year>.</mixed-citation></ref>
<ref id="c49"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>V.</given-names> <surname>Lobato-Rios</surname></string-name>, <string-name><given-names>S. T.</given-names> <surname>Ramalingasetty</surname></string-name>, <string-name><given-names>P. G.</given-names> <surname>Ozdil</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Arreguit</surname></string-name>, <string-name><given-names>A. J.</given-names> <surname>Ijspeert</surname></string-name>, and <string-name><given-names>P.</given-names> <surname>Ramdya</surname></string-name></person-group>. <article-title>Neuromechfly, a neuromechanical model of adult drosophila melanogaster</article-title>. <source>Nature Methods</source>, <volume>19</volume> (<issue>5</issue>):<fpage>620</fpage>–<lpage>627</lpage>, <year>2022</year>. doi:<pub-id pub-id-type="doi">10.1038/s41592-022-01466-7</pub-id>.</mixed-citation></ref>
<ref id="c50"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>M.</given-names> <surname>Lotkin</surname></string-name></person-group>. <article-title>A Note on the Midpoint Method of Integration</article-title>. <source>Journal of the ACM</source>, <volume>3</volume>(<issue>3</issue>):<fpage>208</fpage>–<lpage>211</lpage>, <month>July</month> <year>1956</year>. ISSN <issn>0004-5411</issn>, <issn>1557-735X</issn>. doi:<pub-id pub-id-type="doi">10.1145/320831.320840</pub-id>.</mixed-citation></ref>
<ref id="c51"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>A.</given-names> <surname>Mamiya</surname></string-name>, <string-name><given-names>P.</given-names> <surname>Gurung</surname></string-name>, and <string-name><given-names>J. C.</given-names> <surname>Tuthill</surname></string-name></person-group>. <article-title>Neural Coding of Leg Proprioception in Drosophila</article-title>. <source>Neuron</source>, <volume>100</volume>(<issue>3</issue>):<fpage>636</fpage>–<lpage>650.e6,</lpage> <year>2018</year>. ISSN <issn>08966273</issn>. doi:<pub-id pub-id-type="doi">10.1016/j.neuron.2018.09.009</pub-id>. URL <ext-link ext-link-type="uri" xlink:href="https://linkinghub.elsevier.com/retrieve/pii/S0896627318307827">https://linkinghub.elsevier.com/retrieve/pii/S0896627318307827</ext-link>.</mixed-citation></ref>
<ref id="c52"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>C. S.</given-names> <surname>Mendes</surname></string-name>, <string-name><given-names>I.</given-names> <surname>Bartos</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Akay</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Márka</surname></string-name>, and <string-name><given-names>R. S.</given-names> <surname>Mann</surname></string-name></person-group>. <article-title>Quantification of gait parameters in freely walking wild type and sensory deprived Drosophila melanogaster</article-title>. <source>eLife</source>, <volume>2</volume>, <month>Jan</month>. <year>2013</year>. ISSN <issn>2050-084X</issn>. doi:<pub-id pub-id-type="doi">10.7554/eLife.00231</pub-id>.</mixed-citation></ref>
<ref id="c53"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>H. L.</given-names> <surname>More</surname></string-name> and <string-name><given-names>J. M.</given-names> <surname>Donelan</surname></string-name></person-group>. <article-title>Scaling of sensorimotor delays in terrestrial mammals</article-title>. <source>Proceedings of the Royal Society B</source>, <volume>285</volume>(<issue>1885</issue>):<fpage>20180613</fpage>, <year>2018</year>.</mixed-citation></ref>
<ref id="c54"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>Y.</given-names> <surname>Nakahira</surname></string-name>, <string-name><given-names>Q.</given-names> <surname>Liu</surname></string-name>, <string-name><given-names>T. J.</given-names> <surname>Sejnowski</surname></string-name>, and <string-name><given-names>J. C.</given-names> <surname>Doyle</surname></string-name></person-group>. <article-title>Diversity-enabled sweet spots in layered architectures and speed–accuracy trade-offs in sensorimotor control</article-title>. <source>Proceedings of the National Academy of Sciences</source>, <volume>118</volume>(<issue>22</issue>):<fpage>e1916367118</fpage>, <year>2021</year>.</mixed-citation></ref>
<ref id="c55"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>J. A.</given-names> <surname>Nirody</surname></string-name>, <string-name><given-names>L. A.</given-names> <surname>Duran</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Johnston</surname></string-name>, and <string-name><given-names>D. J.</given-names> <surname>Cohen</surname></string-name></person-group>. <article-title>Tardigrades exhibit robust interlimb coordination across walking speeds and terrains</article-title>. <source>Proceedings of the National Academy of Sciences</source>, <volume>118</volume>(<issue>35</issue>):<fpage>e2107289118</fpage>, <month>Aug</month>. <year>2021</year>. doi:<pub-id pub-id-type="doi">10.1073/pnas.2107289118</pub-id>.</mixed-citation></ref>
<ref id="c56"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>J.</given-names> <surname>Nishii</surname></string-name></person-group>. <article-title>Legged insects select the optimal locomotor pattern based on the energetic cost</article-title>. <source>Biological Cybernetics</source>, <volume>83</volume>(<issue>5</issue>):<fpage>435</fpage>–<lpage>442</lpage>, <year>2000</year>. doi:<pub-id pub-id-type="doi">10.1007/s004220000175</pub-id>.</mixed-citation></ref>
<ref id="c57"><mixed-citation publication-type="other"><person-group person-group-type="author"><string-name><given-names>J. S.</given-names> <surname>Phelps</surname></string-name>, <string-name><given-names>D. G. C.</given-names> <surname>Hildebrand</surname></string-name>, <string-name><given-names>B. J.</given-names> <surname>Graham</surname></string-name>, <string-name><given-names>A. T.</given-names> <surname>Kuan</surname></string-name>, <string-name><given-names>L. A.</given-names> <surname>Thomas</surname></string-name>, <string-name><given-names>T. M.</given-names> <surname>Nguyen</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Buhmann</surname></string-name>, <string-name><given-names>A. W.</given-names> <surname>Azevedo</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Sustar</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Agrawal</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Liu</surname></string-name>, <string-name><given-names>B. L.</given-names> <surname>Shanny</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Funke</surname></string-name>, <string-name><given-names>J. C.</given-names> <surname>Tuthill</surname></string-name>, and <string-name><given-names>W.-C. A.</given-names> <surname>Lee</surname></string-name></person-group>. <article-title>Reconstruction of motor control circuits in adult Drosophila using automated transmission electron microscopy</article-title>. <source>Cell</source>, page S0092867420316834, <month>Jan</month>. <year>2021</year>. ISSN <issn>00928674</issn>. doi:<pub-id pub-id-type="doi">10.1016/j.cell.2020.12.013</pub-id>.</mixed-citation></ref>
<ref id="c58"><mixed-citation publication-type="preprint"><person-group person-group-type="author"><string-name><given-names>B. G.</given-names> <surname>Pratt</surname></string-name>, <string-name><given-names>S.-Y. J.</given-names> <surname>Lee</surname></string-name>, <string-name><given-names>G. M.</given-names> <surname>Chou</surname></string-name>, and <string-name><given-names>J. C.</given-names> <surname>Tuthill</surname></string-name></person-group>. <article-title>Miniature linear and split-belt treadmills reveal mechanisms of adaptive motor control in walking Drosophila</article-title>, <source>bioRxiv</source> <month>Feb</month>. <year>2024</year>.</mixed-citation></ref>
<ref id="c59"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>J. W. S.</given-names> <surname>Pringle</surname></string-name></person-group>. <article-title>The croonian lecture, 1977 - stretch activation of muscle: function and mechanism</article-title>. <source>Proceedings of the Royal Society of London. Series B. Biological Sciences</source>, <volume>201</volume>(<issue>1143</issue>):<fpage>107</fpage>–<lpage>130</lpage>, <year>1978</year>.</mixed-citation></ref>
<ref id="c60"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>J. L.</given-names> <surname>Proctor</surname></string-name> and <string-name><given-names>P.</given-names> <surname>Holmes</surname></string-name></person-group>. <article-title>The effects of feedback on stability and maneuverability of a phase-reduced model for cockroach locomotion</article-title>. <source>Biological Cybernetics</source>, <volume>112</volume>(<issue>4</issue>):<fpage>387</fpage>–<lpage>401</lpage>, <year>2018</year>. doi:<pub-id pub-id-type="doi">10.1007/s00422-018-0762-1</pub-id>.</mixed-citation></ref>
<ref id="c61"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>P.</given-names> <surname>Ramdya</surname></string-name>, <string-name><given-names>R.</given-names> <surname>Thandiackal</surname></string-name>, <string-name><given-names>R.</given-names> <surname>Cherney</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Asselborn</surname></string-name>, <string-name><given-names>R.</given-names> <surname>Benton</surname></string-name>, <string-name><given-names>A. J.</given-names> <surname>Ijspeert</surname></string-name>, and <string-name><given-names>D.</given-names> <surname>Floreano</surname></string-name></person-group>. <article-title>Climbing favours the tripod gait over alternative faster insect gaits</article-title>. <source>Nature Communications</source>, <volume>8</volume>: <fpage>14494</fpage>, <month>Feb</month>. <year>2017</year>. ISSN <issn>2041-1723</issn>. doi:<pub-id pub-id-type="doi">10.1038/ncomms14494</pub-id>.</mixed-citation></ref>
<ref id="c62"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>B.</given-names> <surname>Sabatini</surname></string-name> and <string-name><given-names>W.</given-names> <surname>Regehr</surname></string-name></person-group>. <article-title>Timing of synaptic transmission</article-title>. <source>Annual review of physiology</source>, <volume>61</volume>(<issue>1</issue>): <fpage>521</fpage>–<lpage>542</lpage>, <year>1999</year>.</mixed-citation></ref>
<ref id="c63"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>M.</given-names> <surname>Schilling</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Hoinville</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Schmitz</surname></string-name>, and <string-name><given-names>H.</given-names> <surname>Cruse</surname></string-name></person-group>. <article-title>Walknet, a bio-inspired controller for hexapod walking</article-title>. <source>Biological Cybernetics</source>, <volume>107</volume>(<issue>4</issue>):<fpage>397</fpage>–<lpage>419</lpage>, <month>Aug</month>. <year>2013</year>. doi:<pub-id pub-id-type="doi">10.1007/s00422-013-0563-5</pub-id>.</mixed-citation></ref>
<ref id="c64"><mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><given-names>L.</given-names> <surname>Sciavicco</surname></string-name> and <string-name><given-names>B.</given-names> <surname>Siciliano</surname></string-name></person-group>. <source>Modelling and control of robot manipulators</source>. <publisher-name>Springer Science &amp; Business Media</publisher-name>, <year>2012</year>.</mixed-citation></ref>
<ref id="c65"><mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><given-names>J.-J. E.</given-names> <surname>Slotine</surname></string-name> and <string-name><given-names>W.</given-names> <surname>Li</surname></string-name></person-group>. <source>Applied nonlinear control</source>. <publisher-name>Prentice hall Englewood Cliffs, NJ</publisher-name>, <year>1991</year>.</mixed-citation></ref>
<ref id="c66"><mixed-citation publication-type="web"><person-group person-group-type="author"><string-name><given-names>C. D.</given-names> <surname>Sousa</surname></string-name></person-group>. <source>Sympybotics v1.0</source>, <year>2013</year>. URL <ext-link ext-link-type="uri" xlink:href="https://github.com/cdsousa/SymPyBotics">https://github.com/cdsousa/SymPyBotics</ext-link>.</mixed-citation></ref>
<ref id="c67"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>N.</given-names> <surname>Srivastava</surname></string-name>, <string-name><given-names>G.</given-names> <surname>Hinton</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Krizhevsky</surname></string-name>, <string-name><given-names>I.</given-names> <surname>Sutskever</surname></string-name>, and <string-name><given-names>R.</given-names> <surname>Salakhutdinov</surname></string-name></person-group>. <article-title>Dropout: A simple way to prevent neural networks from overfitting</article-title>. <source>The journal of machine learning research</source>, <volume>15</volume> (<issue>1</issue>):<fpage>1929</fpage>–<lpage>1958</lpage>, <year>2014</year>.</mixed-citation></ref>
<ref id="c68"><mixed-citation publication-type="confproc"><person-group person-group-type="author"><string-name><given-names>J.</given-names> <surname>Stenberg</surname></string-name>, <string-name><given-names>J. S.</given-names> <surname>Li</surname></string-name>, <string-name><given-names>A. A.</given-names> <surname>Sarma</surname></string-name>, and <string-name><given-names>J. C.</given-names> <surname>Doyle</surname></string-name></person-group>. <article-title>Internal feedback in biological control: Diversity, delays, and standard theory</article-title>. In <conf-name>Proceedings of the IEEE American Control Conference</conf-name>, pages <fpage>462</fpage>–<lpage>467</lpage>, <year>2022</year>.</mixed-citation></ref>
<ref id="c69"><mixed-citation publication-type="book"><person-group person-group-type="author"><string-name><given-names>P.</given-names> <surname>Sterling</surname></string-name> and <string-name><given-names>S. B.</given-names> <surname>Laughlin</surname></string-name></person-group>. <source>Principles of neural design</source>. <publisher-name>MIT Press</publisher-name>, <year>2015</year>.</mixed-citation></ref>
<ref id="c70"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>R.</given-names> <surname>Strauss</surname></string-name> and <string-name><given-names>M.</given-names> <surname>Heisenberg</surname></string-name></person-group>. <article-title>Coordination of legs during straight walking and turning in Drosophila melanogaster</article-title>. <source>Journal of comparative physiology A, Sensory, neural, and behavioral physiology</source>, <volume>167</volume>(<issue>3</issue>):<fpage>403</fpage>–<lpage>412</lpage>, <month>Aug</month>. <year>1990</year>. doi:<pub-id pub-id-type="doi">10.1007/bf00192575</pub-id>.</mixed-citation></ref>
<ref id="c71"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>S. H.</given-names> <surname>Strogatz</surname></string-name></person-group>. <article-title>From Kuramoto to Crawford: Exploring the onset of synchronization in populations of coupled oscillators</article-title>. <source>Physica D: Nonlinear Phenomena</source>, <volume>143</volume>(<issue>1-4</issue>):<fpage>1</fpage>–<lpage>20</lpage>, <month>Sept</month>. <year>2000</year>. ISSN <issn>01672789</issn>. doi:<pub-id pub-id-type="doi">10.1016/S0167-2789(00)00094-4</pub-id>.</mixed-citation></ref>
<ref id="c72"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>N. S.</given-names> <surname>Szczecinski</surname></string-name>, <string-name><given-names>T. Bockem</given-names> <surname>ühl</surname></string-name>, <string-name><given-names>A. S.</given-names> <surname>Chockley</surname></string-name>, and <string-name><given-names>A. B</given-names> <surname>üschges</surname></string-name></person-group>. <article-title>Static stability predicts the continuum of interleg coordination patterns in Drosophila</article-title>. <source>Journal of Experimental Biology</source>, <volume>221</volume> (<issue>22</issue>):<fpage>jeb189142</fpage>, <month>Nov</month>. <year>2018</year>. ISSN <issn>0022-0949</issn>, <issn>1477-9145</issn>. doi:<pub-id pub-id-type="doi">10.1242/jeb.189142</pub-id>.</mixed-citation></ref>
<ref id="c73"><mixed-citation publication-type="preprint"><person-group person-group-type="author"><string-name><given-names>S.-y.</given-names> <surname>Takemura</surname></string-name>, <string-name><given-names>K. J.</given-names> <surname>Hayworth</surname></string-name>, <string-name><given-names>G. B.</given-names> <surname>Huang</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Januszewski</surname></string-name>, <string-name><given-names>Z.</given-names> <surname>Lu</surname></string-name>, <string-name><given-names>E. C.</given-names> <surname>Marin</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Preibisch</surname></string-name>,<string-name><given-names>C. S.</given-names> <surname>Xu</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Bogovic</surname></string-name>, <string-name><given-names>A. S.</given-names> <surname>Champion</surname></string-name>, <string-name><given-names>H. S.</given-names> <surname>Cheong</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Costa</surname></string-name>, <string-name><given-names>K.</given-names> <surname>Eichler</surname></string-name>, <string-name><given-names>W.</given-names> <surname>Katz</surname></string-name>, <string-name><given-names>C.</given-names> <surname>Knecht</surname></string-name>, <string-name><given-names>F.</given-names> <surname>Li</surname></string-name>, <string-name><given-names>B. J.</given-names> <surname>Morris</surname></string-name>, <string-name><given-names>C.</given-names> <surname>Ordish</surname></string-name>, <string-name><given-names>P. K.</given-names> <surname>Rivlin</surname></string-name>, <string-name><given-names>P.</given-names> <surname>Schlegel</surname></string-name>, <string-name><given-names>K.</given-names> <surname>Shinomiya</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Stürner</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Zhao</surname></string-name>, <string-name><given-names>G.</given-names> <surname>Badalamente</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Bailey</surname></string-name>, <string-name><given-names>P.</given-names> <surname>Brooks</surname></string-name>, <string-name><given-names>B. S.</given-names> <surname>Canino</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Clements</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Cook</surname></string-name>, <string-name><given-names>O.</given-names> <surname>Duclos</surname></string-name>, <string-name><given-names>C. R.</given-names> <surname>Dunne</surname></string-name>, <string-name><given-names>K.</given-names> <surname>Fairbanks</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Fang</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Finley-May</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Francis</surname></string-name>, <string-name><given-names>R.</given-names> <surname>George</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Gkantia</surname></string-name>, <string-name><given-names>K.</given-names> <surname>Harrington</surname></string-name>, <string-name><given-names>G. P.</given-names> <surname>Hopkins</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Hsu</surname></string-name>, <string-name><given-names>P. M.</given-names> <surname>Hubbard</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Javier</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Kainmueller</surname></string-name>, <string-name><given-names>W.</given-names> <surname>Korff</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Kovalyak</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Krzemiński</surname></string-name>, <string-name><given-names>S. A.</given-names> <surname>Lauchie</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Lohff</surname></string-name>, <string-name><given-names>C.</given-names> <surname>Maldonado</surname></string-name>, <string-name><given-names>E. A.</given-names> <surname>Manley</surname></string-name>, <string-name><given-names>C.</given-names> <surname>Mooney</surname></string-name>, <string-name><given-names>E.</given-names> <surname>Neace</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Nichols</surname></string-name>, <string-name><given-names>O.</given-names> <surname>Ogundeyi</surname></string-name>, <string-name><given-names>N.</given-names> <surname>Okeoma</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Paterson</surname></string-name>, <string-name><given-names>E.</given-names> <surname>Phillips</surname></string-name>, <string-name><given-names>E. M.</given-names> <surname>Phillips</surname></string-name>, <string-name><given-names>C.</given-names> <surname>Ribeiro</surname></string-name>, <string-name><given-names>S. M.</given-names> <surname>Ryan</surname></string-name>, <string-name><given-names>J. T.</given-names> <surname>Rymer</surname></string-name>, <string-name><given-names>A. K.</given-names> <surname>Scott</surname></string-name>, <string-name><given-names>A. L.</given-names> <surname>Scott</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Shepherd</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Shinomiya</surname></string-name>, <string-name><given-names>C.</given-names> <surname>Smith</surname></string-name>, <string-name><given-names>N.</given-names> <surname>Smith</surname></string-name>, <string-name><given-names>A.</given-names> <surname>Suleiman</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Takemura</surname></string-name>, <string-name><given-names>I.</given-names> <surname>Talebi</surname></string-name>, <string-name><given-names>I. F.</given-names> <surname>Tamimi</surname></string-name>, <string-name><given-names>E. T.</given-names> <surname>Trautman</surname></string-name>, <string-name><given-names>L.{</given-names> <surname>Umayam</surname></string-name>, <string-name><given-names>J. J.</given-names> <surname>Walsh</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Yang</surname></string-name>, <string-name><given-names>G. M.</given-names> <surname>Rubin</surname></string-name>, <string-name><given-names>L. K.</given-names> <surname>Scheffer</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Funke</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Saalfeld</surname></string-name>, <string-name><given-names>H. F.</given-names> <surname>Hess</surname></string-name>, <string-name><given-names>S. M.</given-names> <surname>Plaza</surname></string-name>, <string-name><given-names>G. M.</given-names> <surname>Card</surname></string-name>, <string-name><given-names>G. S.</given-names> <surname>Jefferis</surname></string-name>, and <string-name><given-names>S.</given-names> <surname>Berg</surname></string-name></person-group>. <article-title>A Connectome of the Male Drosophila Ventral Nerve Cord</article-title>. <source>bioRxiv</source>, <month>June</month> <year>2023</year>. doi:<pub-id pub-id-type="doi">10.1101/2023.06.05.543757</pub-id>.</mixed-citation></ref>
<ref id="c74"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>O.</given-names> <surname>Tange</surname></string-name></person-group>. <article-title>GNU parallel-The Command-Line Power Tool</article-title>.;<source>login: The USENIX Magazine</source>, <volume>36</volume>(<issue>1</issue>): <fpage>42</fpage>–<lpage>47</lpage>, <year>2011</year>.</mixed-citation></ref>
<ref id="c75"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>J. C.</given-names> <surname>Tuthill</surname></string-name> and <string-name><given-names>R. I.</given-names> <surname>Wilson</surname></string-name></person-group>. <article-title>Parallel transformation of tactile signals in central circuits of drosophila</article-title>. <source>Cell</source>, <volume>164</volume>(<issue>5</issue>):<fpage>1046</fpage>–<lpage>1059</lpage>, <year>2016a</year>.</mixed-citation></ref>
<ref id="c76"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>J. C.</given-names> <surname>Tuthill</surname></string-name> and <string-name><given-names>R. I.</given-names> <surname>Wilson</surname></string-name></person-group>. <article-title>Mechanosensation and Adaptive Motor Control in Insects</article-title>. <source>Current Biology</source>, <volume>26</volume>(<issue>20</issue>):<fpage>R1022</fpage>–<lpage>R1038</lpage>, <month>Oct</month>. <year>2016b</year>. ISSN <issn>09609822</issn>. doi:<pub-id pub-id-type="doi">10.1016/j.cub.2016.06.070</pub-id>.</mixed-citation></ref>
<ref id="c77"><mixed-citation publication-type="preprint"><person-group person-group-type="author"><string-name><given-names>R.</given-names> <surname>Vaxenburg</surname></string-name>, <string-name><given-names>I.</given-names> <surname>Siwanowicz</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Merel</surname></string-name>, <string-name><given-names>A. A.</given-names> <surname>Robie</surname></string-name>, <string-name><given-names>C.</given-names> <surname>Morrow</surname></string-name>, <string-name><given-names>G.</given-names> <surname>Novati</surname></string-name>, <string-name><given-names>Z.</given-names> <surname>Stefanidi</surname></string-name>, <string-name><given-names>G. M.</given-names> <surname>Card</surname></string-name>, <string-name><given-names>M. B.</given-names> <surname>Reiser</surname></string-name>, <string-name><given-names>M. M.</given-names> <surname>Botvinick</surname></string-name>, <etal>et al.</etal></person-group> <article-title>Whole-body simulation of realistic fruit fly locomotion with deep reinforcement learning</article-title>. <source>bioRxiv</source>, pages <fpage>2024</fpage>–<lpage>03</lpage>, <year>2024</year>.</mixed-citation></ref>
<ref id="c78"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>P.</given-names> <surname>Virtanen</surname></string-name>, <string-name><given-names>R.</given-names> <surname>Gommers</surname></string-name>, <string-name><given-names>T. E.</given-names> <surname>Oliphant</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Haberland</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Reddy</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Cournapeau</surname></string-name>, <string-name><given-names>E.</given-names> <surname>Burovski</surname></string-name>, <string-name><given-names>P.</given-names> <surname>Peterson</surname></string-name>, <string-name><given-names>W.</given-names> <surname>Weckesser</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Bright</surname></string-name>, <string-name><given-names>S. J.</given-names> <surname>van der Walt</surname></string-name>, <string-name><given-names>M.</given-names> <surname>Brett</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Wilson</surname></string-name>, <string-name><given-names>K. J.</given-names> <surname>Millman</surname></string-name>, <string-name><given-names>N.</given-names> <surname>Mayorov</surname></string-name>, <string-name><given-names>A. R. J.</given-names> <surname>Nelson</surname></string-name>, <string-name><given-names>E.</given-names> <surname>Jones</surname></string-name>, <string-name><given-names>R.</given-names> <surname>Kern</surname></string-name>, <string-name><given-names>E.</given-names> <surname>Larson</surname></string-name>, <string-name><given-names>C. J.</given-names> <surname>Carey</surname></string-name>, <string-name><given-names>İ.</given-names> <surname>Polat</surname></string-name>, <string-name><given-names>Y.</given-names> <surname>Feng</surname></string-name>, <string-name><given-names>E. W.</given-names> <surname>Moore</surname></string-name>, <string-name><given-names>J.</given-names> <surname>VanderPlas</surname></string-name>, <string-name><given-names>D.</given-names> <surname>Laxalde</surname></string-name>, <string-name><given-names>J.</given-names> <surname>Perktold</surname></string-name>, <string-name><given-names>R.</given-names> <surname>Cimrman</surname></string-name>, <string-name><given-names>I.</given-names> <surname>Henriksen</surname></string-name>, <string-name><given-names>E. A.</given-names> <surname>Quintero</surname></string-name>, <string-name><given-names>C. R.</given-names> <surname>Harris</surname></string-name>, <string-name><given-names>A. M.</given-names> <surname>Archibald</surname></string-name>, <string-name><given-names>A. H.</given-names> <surname>Ribeiro</surname></string-name>, <string-name><given-names>F.</given-names> <surname>Pedregosa</surname></string-name>, and <string-name><given-names>P.</given-names> <surname>van Mulbregt</surname></string-name></person-group>. <article-title>SciPy 1.0: Fundamental algorithms for scientific computing in Python</article-title>. <source>Nature Methods</source>, <volume>17</volume>(<issue>3</issue>):<fpage>261</fpage>–<lpage>272</lpage>, <month>Mar</month>. <year>2020</year>. ISSN <issn>1548-7105</issn>. doi:<pub-id pub-id-type="doi">10.1038/s41592-019-0686-2</pub-id>.</mixed-citation></ref>
<ref id="c79"><mixed-citation publication-type="preprint"><person-group person-group-type="author"><string-name><given-names>S.</given-names> <surname>Wang-Chen</surname></string-name>, <string-name><given-names>V. A.</given-names> <surname>Stimpfling</surname></string-name>, <string-name><given-names>P. G.</given-names> <surname>özdil</surname></string-name>, <string-name><given-names>L.</given-names> <surname>Genoud</surname></string-name>, <string-name><given-names>F.</given-names> <surname>Hurtak</surname></string-name>, and <string-name><given-names>P.</given-names> <surname>Ramdya</surname></string-name></person-group>. <article-title>NeuroMechFly 2.0, a framework for simulating embodied sensorimotor control in adult Drosophila</article-title>. <source>bioRxiv</source>, <month>Sept</month>. <year>2023</year>. doi:<pub-id pub-id-type="doi">10.1101/2023.09.18.556649</pub-id>.</mixed-citation></ref>
<ref id="c80"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>A.</given-names> <surname>Wosnitza</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Bockem ühl</surname></string-name>, <string-name><given-names>M. D</given-names> <surname>übbert</surname></string-name>, <string-name><given-names>H.</given-names> <surname>Scholz</surname></string-name>, and <string-name><given-names>A. B</given-names> <surname>üschges</surname></string-name></person-group>. <article-title>Inter-leg coordination in the control of walking speed in Drosophila</article-title>. <source>Journal of Experimental Biology</source>, <volume>216</volume>(<issue>3</issue>):<fpage>480</fpage>–<lpage>491</lpage>, <month>Feb</month>. <year>2013</year>. ISSN <issn>0022-0949, 1477-9145</issn>. doi:<pub-id pub-id-type="doi">10.1242/jeb.078139</pub-id>.</mixed-citation></ref>
<ref id="c81"><mixed-citation publication-type="journal"><person-group person-group-type="author"><string-name><given-names>H.</given-names> <surname>Zhang</surname></string-name>, <string-name><given-names>S.</given-names> <surname>Starke</surname></string-name>, <string-name><given-names>T.</given-names> <surname>Komura</surname></string-name>, and <string-name><given-names>J.</given-names> <surname>Saito</surname></string-name></person-group>. <article-title>Mode-adaptive neural networks for quadruped motion control</article-title>. <source>ACM Transactions on Graphics</source>, <volume>37</volume>(<issue>4</issue>):<fpage>145</fpage>:1–145:11, <month>July</month> <year>2018</year>. ISSN <issn>0730-0301</issn>. doi:<pub-id pub-id-type="doi">10.1145/3197517.3201366</pub-id>.</mixed-citation></ref>
</ref-list>
<sec id="d1e2023" sec-type="supplementary-material">
<title>Supporting information</title>
<supplementary-material id="d1e6185">
<label>Video 1</label>
<caption>
<p>Model generates forward walking similar to real flies. Shown is an example comparison of real and simulated fly walking kinematics, visualized on a fly model by inverse kinematics (no further physics simulation).</p>
</caption>
<media xlink:href="supplements/589965_file02.mp4"/>
</supplementary-material>
<supplementary-material id="d1e6197">
<label>Video 2</label>
<caption>
<p>Video 2: Model generates forward walking that is visually similar to data. (Top row) Example simulated 3D pose trajectories at 8, 10, 12, and 14 mm<bold>/</bold>s forward walking (0 mm<bold>/</bold>s turning and side speeds). (Bottom row) Example 3D pose trajectories from data at the same speeds for comparison. Note that we fix angles joints not included in the model</p>
</caption>
<media xlink:href="supplements/589965_file03.mp4"/>
</supplementary-material>
<supplementary-material id="d1e6214">
<label>Video 3</label>
<caption>
<p>Video 3: Model generates walking with nonzero rotation and side speeds visually similar to the data. (Top row) Example simulated 3D pose trajectories of fly walking with some nonzero side or rotation speed. Forward speed is 12 mm<bold>/</bold>s throughout. (Bottom row) Example 3D pose trajectories from data with similar speeds.</p>
</caption>
<media xlink:href="supplements/589965_file04.mp4"/>
</supplementary-material>
<supplementary-material id="d1e6229">
<label>Video 4</label>
<caption>
<p>Video 4: Model generates robust walking under impulse perturbation with varying motor delays. Shown are example simulated 3D pose trajectories of fly walking with 10 ms sensory delay and varying motor delays. Below are mean kinematic similarity values during the perturbation.</p>
</caption>
<media xlink:href="supplements/589965_file05.mp4"/>
</supplementary-material>
<supplementary-material id="d1e6242">
<label>Video 5</label>
<caption>
<p>Video 5: Model generates robust walking under persistent stochastic perturbation with varying motor delays. Shown are example simulated 3D pose trajectories of fly walking with 10 ms sensory delay and varying motor delays. Below are mean kinematic similarity values during the perturbation.</p>
</caption>
<media xlink:href="supplements/589965_file06.mp4"/>
</supplementary-material>
<supplementary-material id="d1e6254">
<label>Video 6</label>
<caption>
<p>Video 6: Model generates robust walking under impulse perturbation with varying sensory delays. Shown are example simulated 3D pose trajectories of fly walking with 30 ms motor delay and varying sensory delays. Below are mean kinematic similarity values during the perturbation.</p>
</caption>
<media xlink:href="supplements/589965_file07.mp4"/>
</supplementary-material>
<supplementary-material id="d1e6266">
<label>Video 7</label>
<caption>
<p>Video 7: Model generates robust walking under persistent stochastic perturbation with varying sensory delays. Shown are example simulated 3D pose trajectories of fly walking with 30 ms motor delay and varying sensory delays. Below are mean kinematic similarity values during the perturbation.</p>
</caption>
<media xlink:href="supplements/589965_file08.mp4"/>
</supplementary-material>
</sec>
<app-group>
<app id="app1">
<title>Appendix</title>
<sec id="s7a">
<label>B</label>
<title>Velocity and phase distributions in data</title>
<fig id="fig6" position="float" fig-type="figure">
<label>Figure 6.</label>
<caption><title>Velocity and phase distributions in data justify selection of model simulation parameters.</title>
<p><bold>(A)</bold> Cumulative distribution functions and number of frames associated with various forward, rotation, and side-step velocities in data. Rotation (i.e. yaw) and right<bold>/</bold>left walking peaked at 0 mm<bold>/</bold>s, while forward<bold>/</bold>backward walking achieved a sustained peak from approximately 4 mm<bold>/</bold>s to 10 mm<bold>/</bold>s. Most model-generated simulations in the paper adhered to this range. <bold>(B)</bold> Rotation vs. side-step velocity. Each dot on the scatter plot represents a single bout from data. Rotation velocity and side-step velocity were highly correlated with one another in data. <bold>(C)</bold> Phase offsets between legs in data over a range of walking velocities and rotational velocities. Side-step velocities were omitted from study since (as previously demonstrated) they were highly correlated with rotation velocity. Phase offsets remained relatively constant over a range of forward and rotational velocities.</p></caption>
<graphic xlink:href="589965v1_fig6.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
</sec>
<sec id="s7b">
<label>C</label>
<title>Angle vs. phase plots for all legs and joints</title>
<p>These plots are supplementary to <xref ref-type="fig" rid="fig2">Fig. 2B</xref>.</p>
<fig id="fig7" position="float" fig-type="figure">
<label>Figure 7.</label>
<caption><title>Simulated walking reproduced realistic joint angles.</title>
<p>Angle vs. computed per-leg phase of all joints on all legs for four different walking speeds. All simulations used a sensory delay of 10 ms and motor delay of 30 ms, consistent with experimental values. Some oddities were observed in real data, for instance in L3 femur flexion and R1 body-coxa flexion. The model does not quite capture these oddities.</p></caption>
<graphic xlink:href="589965v1_fig7.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
</sec>
<sec id="s7c">
<label>D</label>
<title>Angular velocity vs. phase plots for all legs and joints</title>
<p>These plots are supplementary to <xref ref-type="fig" rid="fig2">Fig. 2D</xref>.</p>
<fig id="fig8" position="float" fig-type="figure">
<label>Figure 8.</label>
<caption><title>Simulated walking reproduced realistic joint angular velocities.</title>
<p>Angular velocity vs. computed per-leg phase of all joints on all legs for four different walking speeds. All simulations used a sensory delay of 10 ms and motor delay of 30 ms, consistent with experimental values.</p></caption>
<graphic xlink:href="589965v1_fig8.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
</sec>
<sec id="s7d">
<label>E</label>
<title>Differences between model and data</title>
<p>These plots are supplementary to <xref ref-type="fig" rid="fig2">Fig. 2E</xref>.</p>
<fig id="fig9" position="float" fig-type="figure">
<label>Figure 9.</label>
<caption><title>Simulated walking resembled data over a range of forward, turning, and side-stepping velocities.</title>
<p>Average differences between model simulations over 500 distinct bouts. All simulations use a sensory delay of 10 ms and motor delay of 30 ms, consistent with experimental values. The dotted line (5.56 degrees) indicates uncertainty associated with data collection.</p></caption>
<graphic xlink:href="589965v1_fig9.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
</sec>
<sec id="s7">
<label>F</label>
<title>Phase coupling within and across legs</title>
<p>We quantify the model’s capacity to simulate leg kinematics by comparing the phase coupling of simulated joint kinematics with real walking flies, both within and across legs. A phase difference probability density peak of close to zero between two joint angles means that they are strongly coupled, whereas a broader peak means they are weakly coupled.</p>
<p>To assess the effectiveness of the model’s inter-leg coordination, we compared phase coupling across legs for simulated vs. real walking. We found that the model reproduced patterns in the data, with some exceptions. Here, a phase difference of zeros means the two legs are synchronized, whereas a phase difference of <italic>π</italic> means the two legs move in anti-phase. Fly data showed largely tripod coordination, so that L1-R2-L3 are synchronized with each other and also anti-phase with R1-L2-R3. The model showed coupling properties that were qualitatively similar to coupling properties of the data, with moderate variations in phase difference (i.e. peak location) and synchronization strength (i.e. peak height). Some minor differences may also be due to violations of our assumption of constant phase offset across forward walking speeds. This assumption holds true over a large range of speeds, but breaks down at the lowest walking speeds (see Appendix B). In the model, the phase coordinator is responsible for representing inter-leg coupling; these results suggest that the underlying Kuramoto oscillator reproduces naturalistic coupling patterns.</p>
<p>Next, we examined within-leg coupling in data, where phase synchronizations between different joints on the same leg can be both strong (e.g. L3 coxa-femur flexion to femur-tibia flexion) and weak (e.g. R2 femur-tibia flexion to femur rotation). Despite the mirror symmetry of the fly, within-leg coupling is not necessarily symmetric in the data — for instance, compare L2 and R2 coxa-femur flexion. All within-leg synchronizations (i.e. peaks) in data were reproduced by the model; however, the model generally exhibited stronger synchronization (i.e. higher peaks) than the data. In some cases (e.g. L3 femur rotation to femur-tibia flexion), the model exhibited synchronizations that are not present in the data. Overall, the model generally exhibits stronger within-leg coupling when compared to the data.</p>
<p>The trajectory generator is responsible for reproducing the per-leg inter-joint coupling, so these results suggest that the neural network learned stronger coupling values than are present in the data. This result is consistent with the time-series comparisons, where we observed that the model produced more regular joint angle trajectories than the fly (<xref rid="fig2" ref-type="fig">Fig. 2A</xref>).</p>
<fig id="fig10" position="float" fig-type="figure">
<label>Figure 10.</label>
<caption><title>Simulated walking reproduced across- and within-leg coupling characteristics of data.</title>
<p><bold>(A)</bold> Phase coupling across legs. We compared phases of representative joints across legs. Model coupling qualitatively resembled data coupling, with moderate variations in phase difference (i.e. peak location) and synchronization strength (i.e. peak height). A strong peak in probability density indicates synchronization, whereas broader peaks indicate weak synchronization. A single peak at zero on the horizontal axis indicates that the two joint phases are coupled to match; a single peak elsewhere indicates that the two joint phases are coupled with some phase offset. Simulations were performed over a range of forward walking, turning, and side-stepping speeds over 500 distinct bouts. <bold>(B, C)</bold> Phase coupling within each leg. For each leg, we compared phases between a representative joint for the leg (denoted “target” on the image) and other joints on the leg. Gaps are present as we did not include all 5 joints for all legs in the model. All synchronizations (i.e. peaks) in data are reproduced by the model. However, simulations generally exhibited stronger synchronization (i.e. higher peaks).</p></caption>
<graphic xlink:href="589965v1_fig10.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
</sec>
<sec id="s8">
<label>G</label>
<title>Estimate of plausible stochastic perturbation values</title>
<p>Here we derive an estimate of the maximum plausible stochastic perturbation magnitude corresponding to a sudden gust of wind. Wind force experienced by a given leg is
<disp-formula id="eqn16">
<graphic xlink:href="589965v1_eqn16.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <italic>ρ, v</italic>, and <italic>A</italic> are the density of air, wind speed, and perpendicular area (to wind direction) of the leg. The resulting acceleration is
<disp-formula id="eqn17">
<graphic xlink:href="589965v1_eqn17.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <italic>m</italic> is the mass of the fly.</p>
<p>We assume, generously, that the leg experiences the same acceleration. Since the controller operates at a frequency of <italic>f</italic>, we can approximate the angular velocity (i.e. perturbation) <italic>ω</italic> generated by the slip acceleration in one timestep for one joint on the leg as
<disp-formula id="eqn18">
<graphic xlink:href="589965v1_eqn18.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <italic>r</italic> is the length of the leg.</p>
<p>Substituting in values used in our model (<italic>m</italic> = 0.7e-6 kg, <italic>f</italic> = 600 Hz, <italic>r</italic> = 0.0015 m), and let <italic>ρ</italic> = 1.2 kg<bold>/</bold>m<sup>3</sup> (standard value), <italic>v</italic> = 6 m<bold>/</bold>s (corresponding to a strong 21 km<bold>/</bold>h wind), and <italic>A</italic> = 0.15e-6 m<sup>2</sup> (corresponding to a 1.5mm by 0.1mm leg), we obtain a maximum joint perturbation magnitude of <italic>ω</italic> = 5.1 rad<bold>/</bold>s.</p>
</sec>
<sec id="s9">
<label>H</label>
<title>Estimate of plausible impulse perturbation values</title>
<p>We estimate the maximum plausible impulse perturbation corresponding to a sudden slip. Assume that a leg steps at an angle of <italic>θ</italic> (from the vertical) onto a flat, frictionless ground. The resulting horizontal acceleration would be
<disp-formula id="eqn19">
<graphic xlink:href="589965v1_eqn19.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <italic>g</italic> is acceleration due to gravity.</p>
<p>Assume the controller operates at a frequency of <italic>f</italic>. We can approximate the angular velocity (i.e. perturbation) <italic>ω</italic> generated by the slip acceleration in one timestep for a joint on the leg as
<disp-formula id="eqn20">
<graphic xlink:href="589965v1_eqn20.gif" mime-subtype="gif" mimetype="image"/>
</disp-formula>
where <italic>r</italic> is the length of the leg. Plugging in values of <italic>g</italic> = 9.81 m/s<sup>2</sup> (standard value), <italic>f</italic> = 600 Hz (value used in the model), <italic>r</italic> = 0.0015 m (value used in the model), and <italic>θ</italic> = 45 degrees (quite a large slip angle), we obtain a perturbation value of n <italic>ω</italic> = 10.9 rad/s.</p>
</sec>
<sec id="s10">
<label>I</label>
<title>Effect of sensory and motor delays on walking under impulse perturbations</title>
<p>The results shown in <xref rid="fig5" ref-type="fig">Fig. 5</xref> correspond to persistent stochastic perturbations. Here, we present similar results for impulse perturbations here. Maximum values of motor and sensory delay values remain reasonably close to known values in physiology.</p>
<fig id="fig11" position="float" fig-type="figure">
<label>Figure 11.</label>
<caption><title>Model generated robust walking under persistent stochastic perturbations over select ranges of motor and sensory delays, revealing fundamental constraints on delay values.</title>
<p><bold>(A, B)</bold> Example simulated time-series of femur-tibia flexion on leg R1 and femur rotation on leg L2 under various values of motor (10, 20, 30, 40 ms) and sensory delay (0, 5, 10, 15 ms). Perturbation effects were more noticeable with increased delay values. <bold>(C, D, E)</bold> KS of simulated during-perturbation walking to data, for various values of delay, perturbation strength, and forward speeds. For each square of the heatmap, four simulations with different initial conditions were simulated and evaluated. As perturbation strength and delays increased, simulated walking became less similar to data; the effect was more pronounced with increased delays. When we fixed one delay value and varied the other, The model maintained realistic walking (KS <italic>&gt;</italic> −1.6) up to about 25 ms of motor delay and 8 ms of sensory delay across a range of conditions. When we allowed both motor and sensory delay to vary, the model maintained realistic walking when the sum of the delays was no more than about 40 ms. <bold>(F)</bold> Post-perturbation walking with motor and sensory delays. The model is able to recover from perturbations for very large values of delay. Unless otherwise stated, forward speed = 12 mm<bold>/</bold>s, and perturbation strength = 5 rad<bold>/</bold>s.</p></caption>
<graphic xlink:href="589965v1_fig11.tif" mime-subtype="tiff" mimetype="image"/>
</fig>
</sec>
</app>
</app-group>
</back>
<sub-article id="sa0" article-type="editor-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.99005.1.sa3</article-id>
<title-group>
<article-title>eLife Assessment</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<name>
<surname>Salinas</surname>
<given-names>Emilio</given-names>
</name>
<role specific-use="editor">Reviewing Editor</role>
<aff>
<institution-wrap>
<institution>Wake Forest University School of Medicine</institution>
</institution-wrap>
<city>Winston-Salem</city>
<country>United States of America</country>
</aff>
</contrib>
</contrib-group>
<kwd-group kwd-group-type="evidence-strength">
<kwd>Solid</kwd>
</kwd-group>
<kwd-group kwd-group-type="claim-importance">
<kwd>Valuable</kwd>
</kwd-group>
</front-stub>
<body>
<p>This <bold>valuable</bold> study presents a computational model that simulates walking motions in Drosophila and suggests that, if sensorimotor delays in the neural circuitry were any longer, the system would be easily destabilized by external perturbations. The hierarchical control model is sensible and the evidence supporting the conclusions is <bold>solid</bold>. However, because the modular model has many interacting components with varying degrees of biological realism, it is difficult to judge the degree to which the observed differences between simulation and empirical data are meaningful, and the precise source of the discrepancies.</p>
</body>
</sub-article>
<sub-article id="sa1" article-type="referee-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.99005.1.sa2</article-id>
<title-group>
<article-title>Reviewer #1 (Public Review):</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<anonymous/>
<role specific-use="referee">Reviewer</role>
</contrib>
</contrib-group>
</front-stub>
<body>
<p>Summary:</p>
<p>In this work, the authors present a novel, multi-layer computational model of motor control to produce realistic walking behaviour of a Drosophila model in the presence of external perturbations and under sensory and motor delays. The novelty of their model of motor control is that it is modular, with divisions inspired by the fly nervous system, with one component based on deep learning while the rest are based on control theory. They show that their model can produce realistic walking trajectories. Given the mostly reasonable assumptions of their model, they convincingly show that the sensory and motor delays present in the fly nervous system are the maximum allowable for robustness to unexpected perturbations.</p>
<p>Their fly model outputs torque at each joint in the leg, and their dynamics model translates these into movements, resulting in time-series trajectories of joint angles. Inspired by the anatomy of the fly nervous system, their fly model is a modular architecture that separates motor control at three levels of abstraction:</p>
<p>
(1) oscillator-based model of coupling of phase angles between legs,</p>
<p>
(2) generation of future joint-angle trajectories based on the current state and inputs for each leg (the trajectory generator), and</p>
<p>
(3) closed-loop control of the joint-angles using torques applied at every joint in the model (control and dynamics).</p>
<p>These three levels of abstraction ensure coordination between the legs, future predictions of desired joint angles, and corrections to deviations from desired joint-angle trajectories. The parameters of the model are tuned in the absence of external perturbations using experimental data of joint angles of a tethered fly. A notable disconnect from reality is that the dynamics model used does not model the movement of the body and ground contacts as is the case in natural walking, nor the movement of a ball for a tethered fly, but instead something like legs moving in the air for a tethered fly.</p>
<p>In order to validate the realism of the generated simulated walking trajectories, the authors compare various attributes of simulated to real tethered fly trajectories and show qualitative and quantitative similarities, including using a novel metric coined as Kinematic Similarity (KS). The KS score of a trajectory is a measure of the likelihood that the trajectory belongs to the distribution of real trajectories estimated from the experimental data. While such a metric is a useful tool to validate the quality of simulated data, there is some room for improvement in the actual computation of this score. For instance, the KS score is computed for any given time-window of walking simulation using a fraction of information from the joint-angle trajectories. It is unclear if the remaining information in joint-angle trajectories that are not used in the computation of the KS score can be ignored in the context of validating the realism of simulated walking trajectories.</p>
<p>The authors validate simulated walking trajectories generated by the trained model under a range of sensorimotor delays and external perturbations. The trained model is shown to generate realistic joint-angle trajectories in the presence of external perturbations as long as the sensorimotor delays are constrained within a certain range. This range of sensorimotor delays is shown to be comparable to experimental measurements of sensorimotor delays, leading to the conclusion that the fly nervous system is just fast enough to be robust to perturbations.</p>
<p>Strengths:</p>
<p>This work presents a novel framework to simulate Drosophila walking in the presence of external perturbations and sensorimotor delay. Although the model makes some simplifying assumptions, it has sufficient complexity to generate new, testable hypotheses regarding motor control in Drosophila. The authors provide evidence for realistic simulated walking trajectories by comparing simulated trajectories generated by their trained model with experimental data using a novel metric proposed by the authors. The model proposes a crucial role in future predictions to ensure robust walking trajectories against external perturbations and motor delay. Realistic simulations under a range of prediction intervals, perturbations, and motor delays generating realistic walking trajectories support this claim. The modular architecture of the framework provides opportunities to make testable predictions regarding motor control in Drosophila. The work can be of interest to the Drosophila community interested in digitally simulating realistic models of Drosophila locomotion behaviors, as well as to experimentalists in generating testable hypotheses for novel discoveries regarding neural control of locomotion in Drosophila. Moreover, the work can be of broad interest to neuroethologists, serving as a benchmark in modelling animal locomotion in general.</p>
<p>Weaknesses:</p>
<p>As the authors acknowledge in their work, the control and dynamics model makes some simplifying assumptions about Drosophila physics/physiology in the context of walking. For instance, the model does not incorporate ground contact forces and inertial effects of the fly's body. It is not clear how these simplifying assumptions would affect some of the quantitative results derived by the authors. The range of tolerable values of sensorimotor delays that generate realistic walking trajectories is shown to be comparable with sensorimotor delays inferred from physiological measurements. It is unclear if this comparison is meaningful in the context of the model's simplifying assumptions. The authors propose a novel metric coined as Kinematic Similarity (KS) to distinguish realistic walking trajectories from unrealistic walking trajectories. Defining such an objective metric to evaluate the model's predictions is a useful exercise, and could potentially be applied to benchmark other computational animal models that are proposed in the future. However, the KS score proposed in this work is calculated using only the first two PCA modes that cumulatively account for less than 50% of the variance in the joint angles. It is not obvious that the information in the remaining PCA modes may not change the log-likelihood that occurs in the real walking data.</p>
</body>
</sub-article>
<sub-article id="sa2" article-type="referee-report">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.99005.1.sa1</article-id>
<title-group>
<article-title>Reviewer #2 (Public Review):</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<anonymous/>
<role specific-use="referee">Reviewer</role>
</contrib>
</contrib-group>
</front-stub>
<body>
<p>Summary:</p>
<p>In this study, Karashchuk et al. develop a hierarchical control system to control the legs of a dynamic model of the fly. They intend to demonstrate that temporal delays in sensorimotor processing can destabilize walking and that the fly's nervous system may be operating with as long of delays as could possibly be corrected for.</p>
<p>Strengths:</p>
<p>Overall, the approach the authors take is impressive. Their model is trained using a huge dataset of animal data, which is a strength. Their model was not trained to reproduce animal responses to perturbations, but it successfully rejects small perturbations and continues to operate stably. Their results are consistent with the literature, that sensorimotor delays destabilize movements.</p>
<p>Weaknesses:</p>
<p>The model is sophisticated and interesting, but the reviewer has great concerns regarding this manuscript's contributions, as laid out in the abstract:</p>
<p>(1) Much simpler models can be used to show that delays in sensorimotor systems destabilize behavior (e.g., Bingham, Choi, and Ting 2011; Ashtiani, Sarvestani, and Badri-Sproewitz 2021), so why create this extremely complex system to test this idea? The complexity of the system obscures the results and leaves the reviewer wondering if the instability is due to the many, many moving parts within the model. The reviewer understands (and appreciates) that the authors tested the impact of the delay in a controlled way, which supports their conclusion. However, the reviewer thinks the authors did not use the most parsimonious model possible, and as such, leave many possible sources for other causes of instability.</p>
<p>(2) In a related way, the reviewer is not sure that the elements the authors introduced reflect the structure or function of the fly's nervous system. For example, optimal control is an active field of research and is behind the success of many-legged robots, but the reviewer is not sure what evidence exists that suggests the fly ventral nerve cord functions as an optimal controller. If this were bolstered with additional references, the reviewer would be less concerned.</p>
<p>(3) &quot;The model generates realistic simulated walking that matches real fly walking kinematics...&quot;. The reviewer appreciates the difficulty in conducting this type of work, but the reviewer cannot conclude that the kinematics &quot;match real fly walking kinematics&quot;. The range of motion of several joints is 30% too small compared to the animal (Figure 2B) and the reviewer finds the video comparisons unpersuasive. The reviewer would understand if there were additional constraints, e.g., the authors had designed a robot that physically could not complete the prescribed motions. However the reviewer cannot think of a reason why this simulation could not replicate the animal kinematics with arbitrary precision, if that is the goal.</p>
</body>
</sub-article>
<sub-article id="sa3" article-type="author-comment">
<front-stub>
<article-id pub-id-type="doi">10.7554/eLife.99005.1.sa0</article-id>
<title-group>
<article-title>Author response:</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<name>
<surname>Karashchuk</surname>
<given-names>Lili</given-names>
</name>
<role specific-use="author">Author</role>
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-6244-8239</contrib-id></contrib>
<contrib contrib-type="author">
<name>
<surname>Li</surname>
<given-names>Jing Shuang (Lisa)</given-names>
</name>
<role specific-use="author">Author</role>
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0003-4931-8709</contrib-id></contrib>
<contrib contrib-type="author">
<name>
<surname>Chou</surname>
<given-names>Grant M</given-names>
</name>
<role specific-use="author">Author</role>
<contrib-id contrib-id-type="orcid">http://orcid.org/0009-0001-3003-2631</contrib-id></contrib>
<contrib contrib-type="author">
<name>
<surname>Walling-Bell</surname>
<given-names>Sarah</given-names>
</name>
<role specific-use="author">Author</role>
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-6995-2681</contrib-id></contrib>
<contrib contrib-type="author">
<name>
<surname>Brunton</surname>
<given-names>Steven L</given-names>
</name>
<role specific-use="author">Author</role>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Tuthill</surname>
<given-names>John C</given-names>
</name>
<role specific-use="author">Author</role>
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-5689-5806</contrib-id></contrib>
<contrib contrib-type="author">
<name>
<surname>Brunton</surname>
<given-names>Bingni W</given-names>
</name>
<role specific-use="author">Author</role>
<contrib-id contrib-id-type="orcid">http://orcid.org/0000-0002-4831-3466</contrib-id></contrib>
</contrib-group>
</front-stub>
<body>
<p>We thank the editor and reviewers for their supportive comments about our modeling approach and conclusions, and for raising several valid concerns; we address them briefly below.</p>
<p>Concerns about model’s biological realism and impact on interpretations</p>
<p>The goal of this paper was to use an interpretable and modular model to investigate the impact of varying sensorimotor delays. Aspects of the model (e.g. layered architecture, modularity) are inspired by biology; at the same time, necessary abstractions and simplifications (e.g. using an optimal controller) are made for interpretability and generalizability, and they reflect common approaches from past work. The hypothesized effects of certain simplifying assumptions are discussed in detail in Section 3.5. Furthermore, the modularity of our model allows us to readily incorporate additional biological realism (e.g. biomechanics, connectomics, and neural dynamics) in future work. In the revision, we will add citations and edits to the text to clarify these points.</p>
<p>Concerns that the model is overly complex</p>
<p>To investigate the impact of sensorimotor delays on locomotion, we built a closed-loop model that recapitulates the complex joint trajectories of fly walking. We agree that locomotion models face a tradeoff between simplicity/interpretability and realism — therefore, we developed a model that was as simple and interpretable as possible, while still reasonably recapitulating joint trajectories and generalizing to novel simulation scenarios. Along these lines, we also did not select a model that primarily recreates empirical data, as this would hinder generalizability and add unnecessary complexity to the model. We do not think these design choices are significant weaknesses of this model; in fact, few comparable models account for all joints involved in locomotion, and fewer explicitly compare model kinematics with kinematics from data. We will add citations and edits to the text to clarify these points in the revision.</p>
<p>Concerns about the validity of the Kinematic Similarity (KS) metric to evaluate walking</p>
<p>We chose to incorporate only the first two PCA modes dimensions in the KS metric because the kernel density estimator performs poorly for high dimensional data. Our primary use of this metric was to indicate whether the simulated fly continues walking in the presence of perturbations. For technical reasons, it is not feasible to perform equivalent experiments on real walking flies, which is one of the reasons we explore this phenomenon with the model. We note the dramatic shift from walking to non-walking as delay increases (Figure 5). To be thorough, in the revision, we will investigate the effect of incorporating additional PCA modes, and whether this affects the interpretation of our results. We will additionally edit the discussion and presentation of the KS metric to clarify its purpose in this study. We agree with the reviewers that the KS metric is too coarse to reflect fine details of joint kinematics; indeed, in the unperturbed case, we evaluate our model’s performance using other metrics based on comparisons with empirical data (Figures 2, 7, 8).</p>
</body>
</sub-article>
</article>